<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö• ‚úîÔ∏è üëçüèº Contr√¥le des ressources. Personnalisez SwiftGen üÜö üàµ üè∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probablement, dans chaque grand projet iOS, celui qui dure longtemps peut tomber sur des ic√¥nes qui ne sont utilis√©es nulle part, ou acc√©der √† des cl√©...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Contr√¥le des ressources. Personnalisez SwiftGen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hh/blog/423381/"><p>  Probablement, dans chaque grand projet iOS, celui qui dure longtemps peut tomber sur des ic√¥nes qui ne sont utilis√©es nulle part, ou acc√©der √† des cl√©s de localisation qui ont disparu depuis longtemps.  Le plus souvent, de telles situations r√©sultent de l'inattention, et l'automatisation est le meilleur rem√®de contre l'inattention. </p><br><p>  Au sein de l'√©quipe iOS de HeadHunter, nous accordons une grande attention √† l'automatisation des t√¢ches de routine qu'un d√©veloppeur peut rencontrer.  Avec cet article, nous voulons commencer un cycle d'histoires sur ces outils et approches qui simplifient notre travail quotidien. </p><br><p>  Il y a quelque temps, nous avons r√©ussi √† prendre le contr√¥le des ressources des applications √† l'aide de l'utilitaire SwiftGen.  Comment le configurer, comment vivre avec et comment cet utilitaire aide √† d√©placer la v√©rification de la pertinence des ressources vers le compilateur, et nous parlerons de cat. </p><br><p><img src="https://habrastorage.org/webt/dl/sy/-c/dlsy-cocqhwmu02tsyr4aoukf-y.jpeg"></p><a name="habracut"></a><br><p>  SwiftGen est un utilitaire qui vous permet de g√©n√©rer du code Swift pour acc√©der √† diverses ressources d'un projet Xcode, parmi lesquelles: </p><br><ul><li>  polices </li><li>  les couleurs </li><li>  storyboards; </li><li>  cha√Ænes de localisation; </li><li>  actifs. </li></ul><br><p>  Tout le monde peut √©crire un code similaire pour initialiser des images ou des cha√Ænes de localisation: </p><br><pre><code class="swift hljs">logoImageView.image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: <span class="hljs-string"><span class="hljs-string">"Swift"</span></span>) nameLabel.text = <span class="hljs-type"><span class="hljs-type">String</span></span>( format: <span class="hljs-type"><span class="hljs-type">NSLocalizedString</span></span>(<span class="hljs-string"><span class="hljs-string">"languages.swift.name"</span></span>, comment: <span class="hljs-string"><span class="hljs-string">""</span></span>), locale: <span class="hljs-type"><span class="hljs-type">Locale</span></span>.current )</code> </pre> <br><p>  Pour indiquer le nom de l'image ou de la cl√© de localisation, nous utilisons des litt√©raux de cha√Æne.  Ce qui est √©crit entre guillemets doubles n'est pas valid√© par le compilateur ou l'environnement de d√©veloppement (Xcode).  C'est l√† que r√©side l'ensemble des probl√®mes suivants: </p><br><ul><li>  Vous pouvez faire une faute de frappe; </li><li>  vous pouvez oublier de mettre √† jour l'utilisation du code apr√®s avoir modifi√© ou supprim√© la cl√© / l'image. </li></ul><br><p>  Voyons comment nous pouvons am√©liorer ce code avec SwiftGen. </p><br><p>  Pour notre √©quipe, la g√©n√©ration n'√©tait pertinente que pour les cha√Ænes et les actifs, et ils seront abord√©s dans l'article.  La g√©n√©ration pour d'autres types de ressources est similaire et, si vous le souhaitez, est facilement ma√Ætris√©e ind√©pendamment. </p><br><h2 id="vnedrenie-v-proekt">  Mise en ≈ìuvre du projet </h2><br><p>  Vous devez d'abord installer SwiftGen.  Nous avons choisi de l'installer via CocoaPods comme un moyen pratique de distribuer l'utilitaire entre tous les membres de l'√©quipe.  Mais cela peut √™tre fait d'autres mani√®res, qui sont d√©crites en d√©tail dans la <a href="">documentation</a> .  Dans notre cas, il <code>pod 'SwiftGen'</code> ajouter le <code>pod 'SwiftGen'</code> , puis d'ajouter une nouvelle phase de construction ( <code>Build Phase</code> ) qui lancera SwiftGen avant de construire le projet. </p><br><pre> <code class="plaintext hljs">"$PODS_ROOT"/SwiftGen/bin/swiftgen</code> </pre> <br><p>  Il est important d'ex√©cuter SwiftGen avant de d√©marrer la phase de <code>Compile Sources</code> pour √©viter les erreurs lors de la compilation du projet. </p><br><p><img src="https://habrastorage.org/webt/gx/1t/xw/gx1txw1lfcxmghilpakndv_wnck.png"></p><br><p>  Nous sommes maintenant pr√™ts √† adapter SwiftGen √† notre projet. </p><br><h2 id="nastroyka-swiftgen">  Configurer SwiftGen </h2><br><p>  Tout d'abord, vous devez configurer les mod√®les par lesquels le code d'acc√®s aux ressources sera g√©n√©r√©.  L'utilitaire contient d√©j√† un ensemble de mod√®les pour g√©n√©rer du code, ils peuvent tous √™tre consult√©s sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> et, en principe, ils sont pr√™ts √† l'emploi.  Les mod√®les sont √©crits en langage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Stencil</a> , vous le connaissez peut-√™tre si vous avez utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sourcery</a> ou jou√© avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kitura</a> .  Si vous le souhaitez, chacun des mod√®les peut √™tre adapt√© √† leurs propres guides. <br>  Par exemple, prenez le mod√®le g√©n√©r√© par <code>enum</code> pour acc√©der aux cha√Ænes de localisation.  Il nous a sembl√© que dans la norme il y a trop de superflu et cela peut √™tre simplifi√©.  Un exemple simplifi√© avec des commentaires explicatifs se trouve sous le spoiler. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de mod√®le</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">{#      #} {% set accessModifier %}{% if param.publicAccess %}public{% else %}internal{% endif %}{% endset %} {#    #} {% macro parametersBlock types %}{% filter removeNewlines:"leading" %} {% for type in types %} _ p{{forloop.counter}}: {{type}}{% if not forloop.last %}, {% endif %} {% endfor %} {% endfilter %}{% endmacro %} {% macro argumentsBlock types %}{% filter removeNewlines:"leading" %} {% for type in types %} p{{forloop.counter}}{% if not forloop.last %}, {% endif %} {% endfor %} {% endfilter %}{% endmacro %} {#       enum        #} {% macro recursiveBlock table item sp %} {{sp}}{% for string in item.strings %} {{sp}}{% if not param.noComments %} {{sp}}/// {{string.translation}} {{sp}}{% endif %} {{sp}}{% if string.types %} {{sp}}{{accessModifier}} static func {{string.name|swiftIdentifier:"pretty"|lowerFirstWord|escapeReservedKeywords}}({% call parametersBlock string.types %}) -&gt; String { {{sp}} return localize("{{string.key}}", {% call argumentsBlock string.types %}) {{sp}}} {{sp}}{% else %} {{sp}}{{accessModifier}} static let {{string.name|swiftIdentifier:"pretty"|lowerFirstWord|escapeReservedKeywords}} = localize("{{string.key}}") {{sp}}{% endif %} {{sp}}{% endfor %} {{sp}}{% for child in item.children %} {{sp}}{{accessModifier}} enum {{child.name|swiftIdentifier:"pretty"|escapeReservedKeywords}} { {{sp}}{% set sp2 %}{{sp}} {% endset %} {{sp}}{% call recursiveBlock table child sp2 %} {{sp}}} {{sp}}{% endfor %} {% endmacro %} import Foundation {#   enum #} {% set enumName %}{{param.enumName|default:"L10n"}}{% endset %} {{accessModifier}} enum {{enumName}} { {% if tables.count &gt; 1 %} {% for table in tables %} {{accessModifier}} enum {{table.name|swiftIdentifier:"pretty"|escapeReservedKeywords}} { {% call recursiveBlock table.name table.levels " " %} } {% endfor %} {% else %} {% call recursiveBlock tables.first.name tables.first.levels " " %} {% endif %} } {#  enum Localization         #} extension Localization { fileprivate static func localize(_ key: String, _ args: CVarArg...) -&gt; String { return String( format: NSLocalizedString(key, comment: ""), locale: Locale.current, arguments: args ) } }</code> </pre> </div></div><br><p>  Il est pratique d'enregistrer le fichier de mod√®le lui-m√™me √† la racine du projet, par exemple, dans le dossier <code>SwiftGen/Templates</code> afin que ce mod√®le soit disponible pour tous ceux qui travaillent sur le projet. <br>  L'utilitaire prend en charge la configuration via le fichier YAML <code>swiftgen.yml</code> , dans lequel vous pouvez sp√©cifier les chemins d'acc√®s aux fichiers source, aux mod√®les et aux param√®tres suppl√©mentaires.  Cr√©ez-le √† la racine du projet dans le dossier <code>Swiftgen</code> , puis regroupez les autres fichiers li√©s au script dans le m√™me dossier. <br>  Pour notre projet, ce fichier peut ressembler √† ceci: </p><br><pre> <code class="plaintext hljs">xcassets: - paths: ../SwiftGenExample/Assets.xcassets templatePath: Templates/ImageAssets.stencil output: ../SwiftGenExample/Image.swift params: enumName: Image publicAccess: 1 noAllValues: 1 strings: - paths: ../SwiftGenExample/en.lproj/Localizable.strings templatePath: Templates/LocalizableStrings.stencil output: ../SwiftGenExample/Localization.swift params: enumName: Localization publicAccess: 1 noComments: 0</code> </pre> <br><p>  En fait, les chemins d'acc√®s aux fichiers et aux mod√®les y sont indiqu√©s, ainsi que les param√®tres suppl√©mentaires qui sont pass√©s au contexte du mod√®le. <br>  √âtant donn√© que le fichier n'est pas √† la racine du projet, nous devons sp√©cifier le chemin d'acc√®s √† celui-ci lors du d√©marrage de Swiftgen.  Modifiez notre script de d√©marrage: </p><br><pre> <code class="plaintext hljs">"$PODS_ROOT"/SwiftGen/bin/swiftgen config run --config SwiftGen/swiftgen.yml</code> </pre> <br><p>  Maintenant, notre projet peut √™tre assembl√©.  Apr√®s l'assemblage, deux fichiers <code>Localization.swift</code> et <code>Image.swift</code> doivent appara√Ætre dans le dossier du projet le long des chemins sp√©cifi√©s dans <code>Image.swift</code> .  Ils doivent √™tre ajout√©s au projet Xcode.  Dans notre cas, les fichiers g√©n√©r√©s contiennent les √©l√©ments suivants: </p><br><div class="spoiler">  <b class="spoiler_title">Pour les cordes:</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Localization</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Languages</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ObjectiveC</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/// General-purpose, object-oriented programming language that adds Smalltalk-style messaging to the C programming language public static let description = localize("languages.objective-c.description") /// https://en.wikipedia.org/wiki/Objective-C public static let link = localize("languages.objective-c.link") /// Objective-C public static let name = localize("languages.objective-c.name") } public enum Swift { /// General-purpose, multi-paradigm, compiled programming language developed by Apple Inc. for iOS, macOS, watchOS, tvOS, and Linux public static let description = localize("languages.swift.description") /// https://en.wikipedia.org/wiki/Swift_(programming_language) public static let link = localize("languages.swift.link") /// Swift public static let name = localize("languages.swift.name") } } public enum MainScreen { /// Language public static let title = localize("main-screen.title") public enum Button { /// View in Wikipedia public static let title = localize("main-screen.button.title") } } } extension Localization { fileprivate static func localize(_ key: String, _ args: CVarArg...) -&gt; String { return String( format: NSLocalizedString(key, comment: ""), locale: Locale.current, arguments: args ) } }</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Pour les images:</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Image</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Logos</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> objectiveC: <span class="hljs-type"><span class="hljs-type">UIImage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> image(named: <span class="hljs-string"><span class="hljs-string">"ObjectiveC"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> swift: <span class="hljs-type"><span class="hljs-type">UIImage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> image(named: <span class="hljs-string"><span class="hljs-string">"Swift"</span></span>) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(named name: String)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIImage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bundle = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: <span class="hljs-type"><span class="hljs-type">BundleToken</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-type"><span class="hljs-type">UIImage</span></span>(named: name, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: bundle, compatibleWith: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"Unable to load image named \(name)."</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> image } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BundleToken</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> </div></div><br><p>  Vous pouvez maintenant remplacer toutes les utilisations des cha√Ænes de localisation et d'initialisation d'images de la forme <code>UIImage(named: "")</code> par ce que nous avons g√©n√©r√©.  Cela nous facilitera le suivi des modifications ou la suppression des cl√©s de cha√Æne de localisation.  Dans tous ces cas, le projet ne sera tout simplement pas assembl√© tant que toutes les erreurs associ√©es aux modifications n'auront pas √©t√© corrig√©es. <br>  Apr√®s les modifications, notre code ressemble √† ceci: </p><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logos = <span class="hljs-type"><span class="hljs-type">Image</span></span>.<span class="hljs-type"><span class="hljs-type">Logos</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> localization = <span class="hljs-type"><span class="hljs-type">Localization</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setupWithLanguage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> language: ProgrammingLanguage)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> language { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .<span class="hljs-type"><span class="hljs-type">Swift</span></span>: logoImageView.image = logos.swift nameLabel.text = localization.<span class="hljs-type"><span class="hljs-type">Languages</span></span>.<span class="hljs-type"><span class="hljs-type">Swift</span></span>.name descriptionLabel.text = localization.<span class="hljs-type"><span class="hljs-type">Languages</span></span>.<span class="hljs-type"><span class="hljs-type">Swift</span></span>.description wikiUrl = localization.<span class="hljs-type"><span class="hljs-type">Languages</span></span>.<span class="hljs-type"><span class="hljs-type">Swift</span></span>.link.toURL() <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .<span class="hljs-type"><span class="hljs-type">ObjectiveC</span></span>: logoImageView.image = logos.objectiveC nameLabel.text = localization.<span class="hljs-type"><span class="hljs-type">Languages</span></span>.<span class="hljs-type"><span class="hljs-type">ObjectiveC</span></span>.name descriptionLabel.text = localization.<span class="hljs-type"><span class="hljs-type">Languages</span></span>.<span class="hljs-type"><span class="hljs-type">ObjectiveC</span></span>.description wikiUrl = localization.<span class="hljs-type"><span class="hljs-type">Languages</span></span>.<span class="hljs-type"><span class="hljs-type">ObjectiveC</span></span>.link.toURL() } }</code> </pre> <br><h2 id="nastroyka-proekta-v-xcode">  Configuration d'un projet dans Xcode </h2><br><p>  Il y a un probl√®me avec les fichiers g√©n√©r√©s: ils peuvent √™tre modifi√©s manuellement par erreur, et comme ils sont √©cras√©s √† partir de z√©ro √† chaque compilation, ces modifications peuvent √™tre perdues.  Pour √©viter cela, vous pouvez verrouiller les fichiers pour l'√©criture apr√®s avoir <code>SwiftGen</code> script <code>SwiftGen</code> . <br>  Ceci peut √™tre r√©alis√© en utilisant la <code>chmod</code> .  Nous r√©√©crivons notre <code>Build Phase</code> avec le lancement de SwiftGen comme suit: </p><br><pre> <code class="plaintext hljs">PODSROOT="$1" OUTPUT_FILES=() COUNTER=0 while [ $COUNTER -lt ${SCRIPT_OUTPUT_FILE_COUNT} ]; do tmp="SCRIPT_OUTPUT_FILE_$COUNTER" OUTPUT_FILES+=(${!tmp}) COUNTER=$[$COUNTER+1] done for file in "${OUTPUT_FILES[@]}" do if [ -f $file ] then chmod a=rw "$file" fi done $PODSROOT/SwiftGen/bin/swiftgen config run --config SwiftGen/swiftgen.yml for file in "${OUTPUT_FILES[@]}" do chmod a=r "$file" done</code> </pre> <br><p>  Le script est assez simple.  Avant de d√©marrer la g√©n√©ration, si les fichiers existent, nous leur accordons des autorisations d'√©criture.  Apr√®s avoir ex√©cut√© le script, nous bloquons la possibilit√© de modifier des fichiers. <br>  Pour faciliter l'√©dition et la v√©rification du script pour r√©vision, il est pratique de le placer dans un fichier <code>runswiftgen.sh</code> distinct.  La version finale du script avec des modifications mineures peut √™tre trouv√©e <a href="">ici</a> .  Maintenant, notre <code>Build Phase</code> ressemblera √† ceci: nous transmettons le chemin d'acc√®s au dossier Pods √† l'entr√©e de script: </p><br><pre> <code class="plaintext hljs">"$SRCROOT"/SwiftGen/runswiftgen.sh "$PODS_ROOT"</code> </pre> <br><p>  Nous reconstruisons le projet, et maintenant lorsque vous essayez de modifier manuellement le fichier g√©n√©r√©, un avertissement appara√Æt: </p><br><p><img src="https://habrastorage.org/webt/-n/ly/km/-nlykmdjarer-97mhderydx5psq.png"></p><br><p>  Ainsi, le dossier avec Swiftgen contient maintenant un fichier de configuration, un script pour verrouiller les fichiers et lancer <code>Swiftgen</code> et un dossier avec des mod√®les personnalis√©s.  Il est pratique de l'ajouter au projet pour une √©dition ult√©rieure si n√©cessaire. </p><br><p><img src="https://habrastorage.org/webt/yw/dk/kq/ywdkkqfdjws_a32syu94hscr4cm.png"></p><br><p>  Et comme les <code>Image.swift</code> <code>Localization.swift</code> et <code>Image.swift</code> g√©n√©r√©s automatiquement, vous pouvez les ajouter √† .gitignore afin de ne pas avoir √† r√©soudre les conflits apr√®s la <code>git merge</code> . </p><br><p>  Je voudrais √©galement attirer l'attention sur la n√©cessit√© de sp√©cifier des fichiers d'entr√©e / sortie pour la construction de la phase SwiftGen si votre projet utilise le nouveau syst√®me de construction Xcode (c'est le syst√®me de construction par d√©faut avec Xcode 10).  Dans la liste Fichiers d'entr√©e, vous devez sp√©cifier tous les fichiers sur la base desquels le code est g√©n√©r√©.  Dans notre cas, il s'agit du script lui-m√™me, de la configuration, des mod√®les, des fichiers .strings et .xcassets: </p><br><pre> <code class="plaintext hljs">$(SRCROOT)/SwiftGen/runswiftgen.sh $(SRCROOT)/SwiftGen/swiftgen.yml $(SRCROOT)/SwiftGen/Templates/ImageAssets.stencil $(SRCROOT)/SwiftGen/Templates/LocalizableStrings.stencil $(SRCROOT)/SwiftGenExample/en.lproj/Localizable.strings $(SRCROOT)/SwiftGenExample/Assets.xcassets</code> </pre> <br><p>  Dans les fichiers de sortie, nous mettons les fichiers dans lesquels SwiftGen g√©n√®re le code: </p><br><pre> <code class="plaintext hljs">$(SRCROOT)/SwiftGenExample/Image.swift $(SRCROOT)/SwiftGenExample/Localization.swift</code> </pre> <br><p>  L'indication de ces fichiers est n√©cessaire pour que le syst√®me de g√©n√©ration puisse d√©cider d'ex√©cuter le script, selon la pr√©sence ou l'absence de modifications dans les fichiers, et √† quel moment de l'assemblage du projet ce script doit √™tre ex√©cut√©. </p><br><h2 id="itogi">  R√©sum√© </h2><br><p>  SwiftGen est un bon outil pour se prot√©ger contre notre n√©gligence lorsque nous travaillons avec des ressources de projet.  Avec lui, nous avons pu g√©n√©rer automatiquement du code pour acc√©der aux ressources de l'application et d√©placer une partie du travail sur la v√©rification de la pertinence des ressources pour le compilateur, ce qui signifie simplifier un peu notre travail.  De plus, nous avons mis en place le projet Xcode pour que le travail ult√©rieur avec l'outil soit plus pratique. </p><br><p>  <strong>Avantages:</strong> </p><br><ol><li>  Contr√¥le plus facile des ressources du projet. </li><li>  Les erreurs de frappe sont r√©duites, il devient possible d'utiliser l'auto-substitution. </li><li>  Les erreurs sont v√©rifi√©es au stade de la compilation. </li></ol><br><p>  <strong>Inconv√©nients:</strong> </p><br><ol><li>  Aucun support pour Localizable.stringsdict. </li><li>  Les ressources non utilis√©es ne sont pas prises en compte. </li></ol><br><p>  Un exemple complet peut √™tre vu sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423381/">https://habr.com/ru/post/fr423381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423371/index.html">Volvo pr√©sente un camion √©lectrique autonome sans cabine</a></li>
<li><a href="../fr423373/index.html">Raisonnement artificiel sans d√©fauts fatals sans r√©seaux de neurones</a></li>
<li><a href="../fr423375/index.html">Des scientifiques cor√©ens ont trouv√© un moyen d'√©viter d'endommager les parois du tokamak en raison de l'instabilit√© du plasma</a></li>
<li><a href="../fr423377/index.html">Ensemble PgModeler</a></li>
<li><a href="../fr423379/index.html">Pourquoi une renonciation compl√®te √† l'argent peut √™tre trop co√ªteuse pour les pays en d√©veloppement</a></li>
<li><a href="../fr423383/index.html">Modification d'Ajax js pour ajax Asp .net mvc</a></li>
<li><a href="../fr423385/index.html">Cours "Fondamentaux de la programmation"</a></li>
<li><a href="../fr423391/index.html">CLRium # 4: R√©union communautaire .Net</a></li>
<li><a href="../fr423393/index.html">R√©seaux de neurones bas√©s sur des r√®gles</a></li>
<li><a href="../fr423395/index.html">Tesla √©tablit un record trimestriel de voitures √©lectriques produites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>