<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ù üë¥üèΩ üóº Mad Converter GIF'ok para stickers animados para Telegram üë®üèæ‚Äçüî¨ üóØÔ∏è üìô</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em vez de mil palavras ... 


 O xZibit tamb√©m est√° feliz, porque aqui os GIFs s√£o inseridos em adesivos para serem inseridos nos GIFs do KDPV! 

 E a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mad Converter GIF'ok para stickers animados para Telegram</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460411/">  <i>Em vez de mil palavras ...</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z_/rg/73/z_rg73ltg3tgl4zh602urowmjps.gif"></div><br>  <i>O xZibit tamb√©m est√° feliz, porque aqui os GIFs s√£o inseridos em adesivos para serem inseridos nos GIFs do KDPV!</i> <br><br>  E agora sobre os detalhes da implementa√ß√£o. <br><a name="habracut"></a><br>  Tudo come√ßou com uma discuss√£o no bate-papo do desenvolvedor do Telegram sobre o pr√≥ximo recurso: <br><br><img src="https://habrastorage.org/webt/zu/s5/x1/zus5x1ydd89sejezp98ztbnygto.png" alt="Bohdan Horbeshko, [04/04/19 20:21] Hmm, mas o bot provavelmente s√≥ aceitar√° gifs e depois converter√° ... | Vitaly, [19/04/19 20:22] do gif para Jason? Eu teria olhado :))) | Bohdan Horbeshko, [04.07.19 20:22] E por que n√£o? H√° um editor de modelo do PlayCanvas no JSON. | Vitaly, [19/04/04 20:23] e como est√° o gif? exportar pixel por pixel? :) Bohdan Horbeshko, [04/04/19 20:24] Obviamente, o mundo da TI viu e n√£o tolerar√° tais distor√ß√µes."><br><br>  Um homem disse - um homem fez!  O primeiro prot√≥tipo em Pillow e svgwrite, analisando GIFs em pixels e convertendo-os em quadrados de vetor com visualiza√ß√µes em SVG, foi gravado em um dia de folga. <br><br>  A divers√£o come√ßou ainda mais ... <br><br><h3>  JSON √© um formato aberto, eles disseram ... </h3><br>  At√© agora, com os formatos no Telegram, eles continuavam enganando.  Suporte feito para anima√ß√µes GIF - na verdade, elas s√£o convertidas em v√≠deo MP4.  Suporte feito para adesivos - eles s√£o enviados para PNG, mas convertidos em WebP.  Desta vez, tudo √© mais honesto: isso na entrada e depois na sa√≠da. <br><br>  Para adesivos animados, o Telegram n√£o usa GIFs, v√≠deos ou at√© mesmo alguns formatos de gr√°ficos vetoriais bem estabelecidos, como SVG, ou Deus pro√≠ba Cthulhu!  Flash.  Ele usa um formato newfangled que surgiu sob a asa do Airbnb - Lottie.  At√© agora, ele tinha alguma fama entre os desenvolvedores de dispositivos m√≥veis, mas gra√ßas ao Telegram, ele pode ganhar mais popularidade. <br><br>  Em ess√™ncia, os arquivos Lottie s√£o projetos Adobe After Effects serializados em JSON que maximizam todos os recursos deste programa.  Com a tela, infelizmente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nem tudo √© t√£o r√≥seo</a> .  Embora existam muitas implementa√ß√µes "oficiais" prontas da biblioteca para renderizar Lottie, apenas para as plataformas cobertas pelo Telegram: Android, iOS, Qt e Web - apenas parte dos recursos do formato √© implementada em todas elas.  O Telegram foi ainda mais longe e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">limitou a</a> lista de recursos suportados, bem como ‚Äúveio‚Äù com seu pr√≥prio formato, que difere do Lottie usual apenas por <code>"tgs": 1</code> o GZip e o par√¢metro <code>"tgs": 1</code> .  Acho que sei onde Denis Popov est√° trabalhando agora!  :-) <br><br>  E se tudo estiver muito bom com a documenta√ß√£o para bibliotecas para plataformas diferentes, ent√£o, infelizmente, n√£o foi poss√≠vel encontrar pelo menos alguma descri√ß√£o do dispositivo de formato - apenas o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esquema JSON</a> nas fontes da lottie-web.  Eu tive que mexer nas anima√ß√µes existentes para entender os conceitos gerais do formato.  Tamb√©m houve discrep√¢ncias entre arquivos reais e o esquema: em particular, nas <a href="">camadas do tipo 4</a> , de acordo com o esquema, os objetos aninhados s√£o armazenados na propriedade <code>"it"</code> - no entanto, em arquivos reais, a chave √© chamada de <code>"shapes"</code> e <code>"it"</code> n√£o funciona. <br><br>  As nuances esclarecidas do formato: <br><br><ul><li>  Um arquivo consiste em camadas.  Ao contr√°rio do GIF, aqui cada camada pode ter um hor√°rio de in√≠cio e t√©rmino arbitr√°rio para a exibi√ß√£o.  V√°rias transforma√ß√µes podem <b>ser</b> aplicadas √† camada (mais precisamente, <b>√© necess√°rio</b> ): escala, rota√ß√£o, altera√ß√£o da transpar√™ncia, etc.  As camadas podem at√© ser tridimensionais (proibidas para o telegrama). </li><li>  Uma camada consiste em "formas".  Eles t√™m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muitos</a> tipos, alguns n√£o podem ser usados ‚Äã‚Äãno telegrama.  Na pr√°tica, para que uma camada apare√ßa, ela deve incluir tr√™s formas: um caminho (nas anima√ß√µes conclu√≠das, geralmente √© o tipo <code>"sh"</code> - curvas de Bezier; o conversor at√© agora usa apenas o tipo <code>"rc"</code> - ret√¢ngulos), o preenchimento (o tipo <code>"fl"</code> ) e a transforma√ß√£o ( digite <code>"tr"</code> ). </li><li>  Voc√™ pode at√© incluir elementos raster, criar camadas de texto e estabelecer relacionamentos entre os par√¢metros de camada e forma por meio de express√µes.  Todos esses brindes tamb√©m s√£o proibidos no Telegram. </li></ul><br>  O primeiro problema segue diretamente daqui: <b>redund√¢ncia</b> .  Embora os valores padr√£o para os par√¢metros de transforma√ß√£o tenham sido adicionados recentemente ao esquema JSON, eles n√£o s√£o implementados nas bibliotecas.  Portanto, perguntar explicitamente ainda √© necess√°rio. <br><br>  Parece que isso n√£o √© um problema?  Mesmo um simples GZip faz um bom trabalho na compacta√ß√£o de dados flagrantemente repetitivos, e 1 MB de JSON bruto se transforma magicamente em algumas dezenas de kilobytes, que silenciosamente atingem o limite estabelecido de 64 kB.  L√° estava! <br><br>  Eu carrego, o que significa uma anima√ß√£o gordinha que exibe calmamente web-lottie no Telegram - e aqui, em vez de uma pixel art condicionalmente bonita, o olhar est√°tico e emba√ßado para mim √© o seguinte: <br><br><img src="https://habrastorage.org/webt/vd/10/_x/vd10_xlbyqsapibkpdsqndlplai.png"><br><br>  O que √© isso ?!  Mas aconteceu que h√° claramente um <b>limite</b> n√£o especificado <b>de 1 MB</b> nos dados descompactados.  Um representante da equipe do Telegram <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">confirmou</a> rapidamente e anunciou o pr√≥ximo aumento no limite para 2 MB. <br><br>  Mesmo que resolvam esses problemas, os adesivos que ultrapassam 1 MB de dados n√£o compactados e n√£o cont√™m transforma√ß√µes ser√£o inacess√≠veis aos usu√°rios de vers√µes mais antigas do Telegram.  Portanto, provavelmente ter√° que cumprir as restri√ß√µes no futuro. <br><br><h3>  Transpar√™ncia √© importante. </h3><br>  O Pillow, juntamente com o OpenCV, pode ser chamado de padr√£o da ind√∫stria para processamento de imagens em Python.  Al√©m disso, tamb√©m √© bem aprimorado para os recursos de GIF: suporta cores indexadas e d√° acesso √† paleta.  Ele suporta a convers√£o de um mapa de pixels em uma matriz NumPy, o que √© importante para o processamento produtivo.  At√© coleta estat√≠sticas sobre cores!  Mas tamb√©m havia desvantagens: <br><br><ol><li>  N√£o havia uma maneira documentada de obter o √≠ndice de cores transparente.  Eu tive que assumir como solu√ß√£o tempor√°ria que a cor transparente √© a mais comum, mas em GIFs reais esse nem sempre √© o caso. </li><li>  A mesma coisa com um atraso entre os quadros: Pillow fornece apenas os pr√≥prios quadros como uma sequ√™ncia de imagens, sem informa√ß√µes sobre os atrasos. </li><li>  √Äs vezes, os quadros parciais s√£o sobrepostos incorretamente. </li></ol><br>  Portanto, eu tive que procurar uma substitui√ß√£o.  O m√≥dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gif2numpy</a> agiu como ele.  Ele √© "aprimorado" para os recursos GIF e fornece acesso a todas as propriedades t√©cnicas da imagem e dos quadros individuais, incluindo o <abbr title="Extens√£o de Controle Gr√°fico">GCE</abbr> .  Assim, ele resolve o problema de atrasos na leitura. <br><br>  A transpar√™ncia, como se viu, n√£o √© totalmente compat√≠vel com o gif2numpy: as cores s√£o imediatamente convertidas em tr√™s canais com profundidade de bits em bytes, sem levar em considera√ß√£o a profundidade de bits e salvar os √≠ndices de cores.  Felizmente, o m√≥dulo consiste em um arquivo, por isso n√£o foi dif√≠cil inclu√≠-lo no projeto e modific√°-lo, reservando a cor <code>#FE00FE</code> para transpar√™ncia. <br><br>  O problema do quadro parcial n√£o foi trivial para resolver.  O gif2numpy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tenta sobrepor</a> esses quadros ao anterior, no entanto, ele n√£o verifica os par√¢metros de sobreposi√ß√£o, o que nem sempre fornece o resultado correto.  Para n√£o mexer nas bandeiras, o processamento preliminar de imagens usando <code>gifsicle</code> com a tecla <code>--unoptimize</code> √© <code>--unoptimize</code> - converte quadros parciais em quadros completos.  E, ao mesmo tempo, os leva a usar a paleta global, o que eliminou a necessidade de processar separadamente a cor transparente ao usar sua pr√≥pria paleta de quadros. <br><br><h3>  Aperte-me com mais for√ßa </h3><br>  Os quadrados s√£o bons, mas com essas limita√ß√µes, voc√™ precisa mostrar mais imagina√ß√£o; caso contr√°rio, at√© GIFs em miniatura n√£o ser√£o "arrastados" para o telegrama. <br><br>  Algo semelhante ao <abbr title="Codifica√ß√£o de comprimento de execu√ß√£o">RLE foi usado primeiro</abbr> : quadrados adjacentes horizontalmente da mesma cor s√£o combinados em um ret√¢ngulo. <br><br>  A seguir, a explora√ß√£o dos recursos da Lottie.  Como cada camada possui um hor√°rio de in√≠cio e t√©rmino arbitr√°rios, √© poss√≠vel aplicar uma t√©cnica usada h√° muito tempo pelos codecs de v√≠deo e parcialmente no pr√≥prio GIF: os quadrados que permanecem no mesmo local por v√°rios quadros podem ser mesclados em uma camada, durante a qual as altera√ß√µes na exibi√ß√£o v√°rios outros.  At√© agora, implementado apenas para pares de camadas adjacentes. <br><br><h3>  Planos de desenvolvimento </h3><br>  As id√©ias que podem ser aplicadas aqui s√£o em massa: <br><br><ul><li>  <b>Reconhe√ßa √°reas de uma cor de qualquer tamanho.</b>  Voc√™ pode dividi-los em um conjunto de ret√¢ngulos, para os quais existe um <a href="">bom algoritmo</a> .  Tamb√©m √© aconselh√°vel convert√™-los em um contorno, mas isso √© ofuscado pela necessidade de especificar todos os pontos das curvas de Bezier em Lottie - ret√¢ngulos em alguns casos podem ser mais vantajosos. </li><li>  <b>Reconhe√ßa o movimento.</b>  A t√©cnica, novamente, √© usada h√° muito tempo em codecs de v√≠deo.  Se o mesmo contorno n√£o mudar de forma de quadro para quadro, mas apenas as coordenadas - em vez de duplica√ß√£o em v√°rias camadas, coloque-o na mesma camada com transforma√ß√£o. </li><li>  <b>Reconhe√ßa a "cobertura" de uma √°rea com outra.</b>  Um exemplo: <br><br><pre> <code class="plaintext hljs">...... .O..O. ...... .OOOO. ......</code> </pre><br>  Pixels de cores diferentes s√£o sobrepostos a um ret√¢ngulo de uma cor.  Em vez de dividir esse ret√¢ngulo em v√°rios pequenos, ou transform√°-lo em um contorno de forma complexa - voc√™ pode simplesmente sobrep√¥-lo sobre o ret√¢ngulo inteiro. </li><li>  <b>Vetoriza√ß√£o de curvas e elipses, reconhecimento de gradientes.</b>  Isso estragar√° o charme dos pixels, mas melhorar√° a compressibilidade de alguns GIFs por ordens de magnitude.  Os gradientes s√£o mesmo nos "Koloboks" antediluvianos, eu garanto! <img src="https://habrastorage.org/getpro/habr/post_images/98f/cc9/e83/98fcc9e832a79a6a2ffeb8f7fd2a64ae.gif" alt=": D"></li><li>  <b>Compress√£o com perdas.</b>  Antes de tudo, a elimina√ß√£o do pontilhamento, e mesmo em fotos excessivamente suaves, n√£o impedir√° a modera√ß√£o da cor.  O gifsic acima mencionado provavelmente ir√° lidar com isso. </li></ul><br><h3>  Refer√™ncias </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fontes</a> .  Assustador em alguns lugares. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O canal</a> no qual eu carrego pacotes de GIFs convertidos com √™xito. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt460411/">https://habr.com/ru/post/pt460411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt460397/index.html">In√≠cio r√°pido com WebComponents</a></li>
<li><a href="../pt460399/index.html">Indicador de carregamento SVG no Vue.js</a></li>
<li><a href="../pt460403/index.html">Vantagens e desvantagens do HugePages</a></li>
<li><a href="../pt460405/index.html">Por que voc√™ precisa de mec√¢nica de jogo oculta</a></li>
<li><a href="../pt460409/index.html">Arduino e teclados (guia completo)</a></li>
<li><a href="../pt460413/index.html">7 sites e aplicativos √∫teis para aprender ingl√™s</a></li>
<li><a href="../pt460415/index.html">Apple Watch 4 (44 mm, 2019) vs Pebble Steel Classic (2014)</a></li>
<li><a href="../pt460419/index.html">Recupera√ß√£o de calor de gases de combust√£o: ambientalmente amig√°vel</a></li>
<li><a href="../pt460421/index.html">Switch √≥ptico TP-Link T2600G-28SQ para provedores de servi√ßos: uma revis√£o detalhada</a></li>
<li><a href="../pt460423/index.html">WAL no PostgreSQL: 3. Ponto de Verifica√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>