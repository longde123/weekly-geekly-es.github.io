<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🔧 ⛲️ 👩‍🏭 “看来这已经发生了？” 搜索类似的事件和索赔 🗿 🏇🏾 📧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="每个花了一定时间支持系统的人都对déjàvu感觉很熟悉，因为他们收到了新的应用程序：“就是这样，它已经被整理出来了，但我不记得是多么的精确”。 您可以花时间，深入研究以前的应用程序，然后尝试找到类似的应用程序。 这将有所帮助：可以更快地解决事件，甚至有可能发现根本原因并一劳永逸地解决问题。 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>“看来这已经发生了？” 搜索类似的事件和索赔</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472210/"><p> 每个花了一定时间支持系统的人都对déjàvu感觉很熟悉，因为他们收到了新的应用程序：“就是这样，它已经被整理出来了，但我不记得是多么的精确”。 您可以花时间，深入研究以前的应用程序，然后尝试找到类似的应用程序。 这将有所帮助：可以更快地解决事件，甚至有可能发现根本原因并一劳永逸地解决问题。 </p><br><p> 刚加入团队的“年轻”员工头脑中没有这样的故事。 他们很可能不知道类似的事件发生在例如六个月到一年前。 隔壁房间的同事决定了那件事。 </p><br><p> 最有可能的是，“年轻”员工不会在事件数据库中查找类似内容，而是会从头解决问题。 花更多的时间，积累经验，下一次会更快。 也许他们会立即在新应用程序的流中忘记它。 下次一切都会再次发生。 </p><br><p> 我们已经在使用ML模型<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">对事件</a>进行<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">分类</a> 。 为了帮助我们的团队更有效地处理应用程序，我们创建了另一个ML模型来准备“先前已关闭的类似事件”列表。 详细信息-下切。 </p><a name="habracut"></a><br><h2 id="chto-nam-nuzhno"> 我们需要什么？ </h2><br><p> 对于每个传入事件，有必要在历史记录中查找“类似”的封闭事件。  “相似性”的定义应该在事件开始时就出现，最好在支持人员开始分析之前。 </p><br><p> 为了比较事件，有必要在联系时使用用户提供的信息：简要说明，详细说明（如果有），用户记录的任何属性。 </p><br><p> 该团队支持4组系统。 我要用于搜索相似事件的事件总数约为10,000。 </p><br><h2 id="pervoe-reshenie"> 首要决定 </h2><br><p> 目前没有有关事件“相似性”的经过验证的信息。 因此，目前必须推迟培训暹罗网络的最新选择。 <br> 首先想到的是由上诉内容组成的“单词袋”的简单组合。 </p><br><p> 在这种情况下，事件处理过程如下： </p><br><ol><li> 突出显示必要的文本片段 </li><li> 文字预处理/清洁 </li><li>  TF-IDF矢量化 </li><li> 找到你最近的邻居 </li></ol><br><p> 显然，使用所描述的方法，相似性将基于字典的比较：在两个不同的事件中使用相同的单词或n-gram将被视为“相似性”。 </p><br><p> 当然，这是一种相当简化的方法。 但是请记住，如果用相似的词来描述问题，那么我们会评估用户点击的文字-最有可能的事件是相似的。 除了文本外，您还可以添加用户部门的名称，希望不同组织中相同部门的用户会遇到类似的问题。 </p><br><h3 id="vydelenie-neobhodimyh-tekstovyh-fragmentov"> 突出显示必要的文本片段 </h3><br><p> 我们以最简单的方式从service-now.com获取事件数据-通过以编程方式运行自定义报告，并以CSV文件的形式检索其结果。 </p><br><p> 在这种情况下，作为事件的一部分，在支持人员和用户之间交换的消息数据将以一个大文本字段的形式返回，并包含整个通信历史记录。 </p><br><p> 必须使用正则表达式“截断”来自此类字段的有关首次调用的信息。 </p><br><ul><li> 所有消息均由特征线&lt;when&gt;-&lt;who&gt;分隔。 </li><li> 消息通常以正式签名结尾，特别是如果通过电子邮件提出上诉。 该信息在重要单词列表中明显为“ fonil”，因此也必须删除签名。 </li></ul><br><p> 原来是这样的： </p><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_first_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(messages)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(messages) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment"># take the first message spl = re.split("\d{2}-\d{2}-\d{4} \d{2}:\d{2}:\d{2} - ((\w+((\s|-)\w+)?,(\s\w+)+)|\w{9}|guest)\s\(\w+\s\w+\)\n", messages.lower()) res = spl[-1] # cut off "mail footer" with finalization statements res = re.split("(best|kind)(\s)+regard(s)+", res)[0] # cut off "mail footer" with embedded pictures res = re.split("\[cid:", res)[0] # cut off "mail footer" with phone prefix res = re.split("\+(\d(\s|-)?){7}", res)[0] return res</span></span></code> </pre> <br><h3 id="predvaritelnaya-obrabotka-tekstov-incidenta"> 预处理事件文本 </h3><br><p> 为了提高分类的质量，对上诉文本进行了预处理。 </p><br><p> 使用事件描述中的一组正则表达式，找到了特征片段：日期，服务器名称，产品代码，IP地址，网址，不正确的名称形式等。 此类片段已替换为相应的概念标记。 </p><br><p> 最后，使用词干将单词变成一种通用形式。 这使我们摆脱了动词的复数形式和结尾。 众所周知的<code>snowballstemmer</code>被用作茎梗。 </p><br><p> 所有处理过程都组合到一个转换类中，可以在不同的过程中使用。 </p><br><p> 顺便说一下，事实证明（当然是通过实验）， <code>stemmer.stemWord()</code>方法不是线程安全的。 因此，如果您尝试在管道中实现并行文本处理（例如，使用<code>joblib</code> Prallel / delayed），则必须使用锁保护对词干分析器常规实例的访问。 </p><br><pre> <code class="python hljs">__replacements = [ (<span class="hljs-string"><span class="hljs-string">'(\d{1,3}\.){3}\d{1,3}'</span></span>, <span class="hljs-string"><span class="hljs-string">'IPV4'</span></span>), (<span class="hljs-string"><span class="hljs-string">'(?&lt;=\W)((\d{2}[-\/ \.]?){2}(19|20)\d{2})|(19|20)\d{2}([-\/ \.]?\d{2}){2}(?=\W)'</span></span>, <span class="hljs-string"><span class="hljs-string">'YYYYMMDD'</span></span>), (<span class="hljs-string"><span class="hljs-string">'(?&lt;=\W)(19|20)\d{2}(?=\W)'</span></span>, <span class="hljs-string"><span class="hljs-string">'YYYY'</span></span>), (<span class="hljs-string"><span class="hljs-string">'(?&lt;=\W)(0|1)?\d\s?(am|pm)(?=\W)'</span></span>, <span class="hljs-string"><span class="hljs-string">'HOUR'</span></span>), (<span class="hljs-string"><span class="hljs-string">'http[s]?:\/\/(?:[a-zA-Z]|[0-9]|[$-_@.&amp;+]|[!*\(\),]|(?:%[0-9a-fA-F][0-9a-fA-F]))+'</span></span>, <span class="hljs-string"><span class="hljs-string">'SOMEURL'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#      ] __stemmer_lock = threading.Lock() __stemmer = snowballstemmer.stemmer('english') def stem_string(text: str): def stem_words(word_list): with __stemmer_lock: res = __stemmer.stemWords(word_list) return res return " ".join(stem_words(text.split())) def clean_text(text: str): res = text for p in __replacements: res = re.sub(p[0], '#'+p[1]+'#', res) return res def process_record(record): txt = "" for t in record: t = "" if t == np.nan else t txt += " " + get_first_message(str(t)) return stem_string(clean_text(txt.lower())) class CommentsTextTransformer(BaseEstimator, TransformerMixin): _n_jobs = 1 def __init__(self, n_jobs=1): self._n_jobs = n_jobs def fit(self, X, y=None): return self def transform(self, X, y=None): features = Parallel(n_jobs=self._n_jobs)( delayed(process_record)(rec) for i, rec in enumerate(X.values) ) return np.array(features, dtype=object).reshape(len(X),)</span></span></code> </pre> <br><h3 id="vektorizaciya"> 向量化 </h3><br><p> 矢量化是由标准<code>TfidfVectorizer</code>使用以下设置进行的： </p><br><ul><li>  <code>max_features</code> = 10000 </li><li>  <code>ngram</code> =（1,3）-试图捕获稳定的组合和语义<code>ngram</code> </li><li>  <code>max_df</code> / <code>min_df</code>默认为左 </li><li>  <code>stop_words</code>英语单词的标准列表，以及其自己的其他单词集。 例如，一些用户提到分析人员的姓名，并且专有名称经常成为重要的属性。 </li></ul><br><p>  <code>TfidfVectorizer</code>本身默认情况下会进行L2归一化，因此入射向量已准备好测量它们之间的余弦距离。 </p><br><h3 id="poisk-pohozhih-incidentov"> 搜索类似事件 </h3><br><p> 该过程的主要任务是返回最近的N个邻居的列表。  <code>sklearn.neighbors.NearestNeighbors</code>类非常适合于此。 一个问题是它不能实现<code>transform</code>方法，否则就不能在<code>pipeline</code>使用它。 </p><br><p> 因此，有必要使它基于<code>Transformer</code> ，然后才将其置于<code>pipeline</code>的最后一步： </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NearestNeighborsTransformer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(NearestNeighbors, TransformerMixin)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, n_neighbors=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">5</span></span></span></span><span class="hljs-function"><span class="hljs-params">, radius=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, algorithm=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'auto'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, leaf_size=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">30</span></span></span></span><span class="hljs-function"><span class="hljs-params">, metric=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'minkowski'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, p=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params">, metric_params=None, n_jobs=None, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super(NearestNeighbors, self).__init__(n_neighbors=n_neighbors, radius=radius, algorithm=algorithm, leaf_size=leaf_size, metric=metric, p=p, metric_params=metric_params, n_jobs=n_jobs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, X, y=None)</span></span></span><span class="hljs-function">:</span></span> res = self.kneighbors(X, self.n_neighbors, return_distance=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre><br><h3 id="process-obrabotki"> 加工过程 </h3><br><p> 综上所述，我们得到了一个紧凑的过程： </p><br><pre> <code class="python hljs">p = Pipeline( steps=[ (<span class="hljs-string"><span class="hljs-string">'grp'</span></span>, ColumnTransformer( transformers=[ (<span class="hljs-string"><span class="hljs-string">'text'</span></span>, Pipeline(steps=[ (<span class="hljs-string"><span class="hljs-string">'pp'</span></span>, CommentsTextTransformer(n_jobs=<span class="hljs-number"><span class="hljs-number">-1</span></span>)), (<span class="hljs-string"><span class="hljs-string">"tfidf"</span></span>, TfidfVectorizer(stop_words=get_stop_words(), ngram_range=(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>), max_features=<span class="hljs-number"><span class="hljs-number">10000</span></span>)) ]), [<span class="hljs-string"><span class="hljs-string">'short_description'</span></span>, <span class="hljs-string"><span class="hljs-string">'comments'</span></span>, <span class="hljs-string"><span class="hljs-string">'u_impacted_department'</span></span>] ) ] )), (<span class="hljs-string"><span class="hljs-string">"nn"</span></span>, NearestNeighborsTransformer(n_neighbors=<span class="hljs-number"><span class="hljs-number">10</span></span>, metric=<span class="hljs-string"><span class="hljs-string">'cosine'</span></span>)) ], memory=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>)</code> </pre> <br><p> 训练后，可以使用<code>pickle</code>将<code>pipeline</code>保存到文件中，并用于处理传入的事件。 <br> 我们将与模型一起保存必要的入射场-以便稍后在模型运行时在输出中使用它们。 </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># inc_data - pandas.Dataframe,     # ref_data - pandas.Dataframe,    . #     .    # inc_data["recommendations_json"] = "" #   . # column_list -  ,          nn_dist, nn_refs = p.transform(inc_data[column_list]) for idx, refs in enumerate(nn_refs): nn_data = ref_data.iloc[refs][['number', 'short_description']].copy() nn_data['distance'] = nn_dist[idx] inc_data.iloc[idx]["recommendations_json"] = nn_data.to_json(orient='records') #     , .     -. inc_data[['number', 'short_description', 'recommendations_json']].to_json(out_file_name, orient='records')</span></span></code> </pre> <br><h2 id="pervye-rezultaty-primeneniya"> 首次申请结果 </h2><br><p> 同事们对引入“提示”系统的反应通常是非常积极的。 重复发生的事件开始得到更快的解决，我们开始着手进行故障排除。 </p><br><p> 但是，不能指望无监督学习系统会带来奇迹。 同事抱怨说，有时系统提供了完全不相关的链接。 有时甚至很难理解这些建议的来源。 </p><br><p> 显然，改进模型的领域很大。 某些缺陷可以解决，包括或排除事件的某些属性。 部分-通过为当前事件和“建议”之间的距离选择适当的截止级别。 可以考虑其他向量化方法。 </p><br><p> 但是主要的问题是缺乏推荐的质量指标。 如果是这样，就不可能理解“什么是好，什么是坏，什么是坏”，并在此基础上建立模型的比较。 </p><br><p> 我们无法访问http日志，因为该服务系统可远程工作（SaaS）。 我们进行了用户调查-但仅是定性的。 有必要进行定量评估，并在其基础上建立清晰的质量指标。 </p><br><p> 但是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在下一部分中将有</a>更多关于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">...</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN472210/">https://habr.com/ru/post/zh-CN472210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN472198/index.html">移动应用程序中推送消息的本地化</a></li>
<li><a href="../zh-CN472200/index.html">在覆盆子的俄罗斯学校中进行计算机科学课程的现代化：便宜又开朗</a></li>
<li><a href="../zh-CN472202/index.html">Windows 10 + Python = VS代码+ WSL</a></li>
<li><a href="../zh-CN472204/index.html">使用STM32F103微控制器（Blue Tablet）进行的简单实验</a></li>
<li><a href="../zh-CN472208/index.html">Android智能手机的OLED屏幕以及如何处理它们</a></li>
<li><a href="../zh-CN472212/index.html">如何从太空降落航天飞机</a></li>
<li><a href="../zh-CN472214/index.html">错误地预测分支会大大增加程序执行时间</a></li>
<li><a href="../zh-CN472216/index.html">我们应该建立什么物联网？ 一日内在Amazon上的物联网</a></li>
<li><a href="../zh-CN472220/index.html">为什么顶级物理学家不喜欢多世界的解释</a></li>
<li><a href="../zh-CN472222/index.html">“看书就听”：适合那些对音乐无动于衷的人-从古典到嘻哈</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>