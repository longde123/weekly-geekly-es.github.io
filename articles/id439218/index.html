<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🍳 🙏🏾 👌🏻 VK bot berlutut, atau bagaimana menyenangkan orang pada 14 Februari 🍭 😕 ⚡️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tentu saja, masing-masing dari kita mencintai hadiah, tetapi yang paling utama kita suka keinginan yang menyertai mereka. Dan, sampai baru-baru ini, k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VK bot berlutut, atau bagaimana menyenangkan orang pada 14 Februari</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439218/">  Tentu saja, masing-masing dari kita mencintai hadiah, tetapi yang paling utama kita suka keinginan yang menyertai mereka.  Dan, sampai baru-baru ini, kami tidak memiliki kesempatan untuk mengejutkan seseorang dengan kata-kata hangat sampai idenya muncul di pikiran: bagaimana jika kita memberi orang kesempatan untuk bertukar valentine (dengan hidung mereka 14 Februari, semuanya sama) tanpa meninggalkan kerangka kerja seperti biasa komunikasi - ruang obrolan jejaring sosial? <br><br>  Kata demi kata, dan ini dia - rencana bisnis yang sudah jadi untuk menciptakan suasana liburan Hari Valentine!  Akankah kita membuat orang bahagia? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/mp/13/dlmp134rko91zu7m-evwm5mlhem.jpeg" width="70%"></div><br><a name="habracut"></a><h2>  Demi gagasan tentang bulan! </h2><br>  Tentu saja, pertama-tama perlu membuat rencana aksi dan menggambarkan ide itu.  Karena kenyataan bahwa orang menjadi lebih pemalu, dan tidak selalu siap untuk mempercayai siapa pun, pilihan jatuh pada penulisan bot modis dan nyaman untuk VK, yang memiliki antarmuka yang akrab, akan selalu ada di tangan, dan anonimitas pesan akan di-hardcode dalam kode program. <br>  Sayangnya, di samping semua keuntungan di atas, komunitas memiliki dua kelemahan: bandwidth rendah (jumlah pesan per detik) dan larangan memulai dialog dengan pengguna acak (pengguna harus <b>terlebih dahulu</b> dan <b>secara eksplisit</b> setuju untuk menerima pesan atas nama komunitas). <br><br>  Jadi, kami memiliki pengguna yang siap mengirim kartu Valentine ke belahan jiwanya, penerima dan perantara dalam bentuk bot obrolan.  Skema interaksi sederhana, bot harus: menawarkan pengiriman → mengenali penerima → menyimpan hingga 14 Februari → mengirimkan → ulangi. <br><br>  Tapi ini, tentu saja, tidak cukup untuk imajinasi pikiran yang rakus, dan, untuk meningkatkan aktivitas dan keterlibatan audiens, skema interaksi lain dipikirkan, memungkinkan orang untuk berkenalan di dalam sistem, mengirim pesan kepada orang-orang secara acak.  Ini "valentines acak" dapat dihargai, dan jika valentine dua orang saling menyukai, kami memberi mereka kesempatan untuk mengobrol. <br><br><h4>  Penafian </h4><br>  <i>Proyek ini dibuat murni oleh antusiasme oleh dua orang, seorang programmer <s>setengah-berpendidikan</s> (saya) dan seorang penginspirasi ideologis (Stepan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">sadfun</a> Popov), tidak memiliki tujuan mengajari Anda sesuatu (meskipun dapat membantu Anda memahami esensi alam semesta), hanya menceritakan kisah penciptaan yang menarik. dan ikuti jalan dari ide ke implementasi yang naif.</i> <br><br><hr><br><h2>  Belajar berbicara dengan VK </h2><br>  Setelah melalui 3-4 pustaka yang berbeda atas permintaan <b>"NodeJS VK API"</b> , saya menyadari bahwa tidak ada pustaka yang sederhana dan fungsional yang memungkinkan kita untuk menggunakan janji, serta bekerja melalui eksekusi.  Ingat salah satu masalah yang dijelaskan di atas?  Ya, eksekusi permintaan ke VKontakte tidak secara langsung, tetapi dalam batch 25 memungkinkan Anda <b>untuk</b> meningkatkan throughput <b>secara signifikan</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/fl/bp/v3flbpnqymqn0wy51ohjddwenmo.png" width="70%"></div><br>  <i>Kemampuan komparatif dari berbagai metode permintaan ke VKontakte</i> <br><br>  Oleh karena itu, diputuskan untuk menulis sesuatu sendiri, solusi yang dapat diandalkan dan tidak terlalu kruk, berdasarkan perpustakaan <b>node-fetch</b> . <br><br>  Agar tidak memberikan semua kode di sini, saya hanya akan menjelaskan logika kerja. <br><br>  Karena permintaan dari program harus dikemas dalam satu eksekusi, mereka dikumpulkan dalam antrian LIFO, dan kemudian dikirim jika: <br><br><ul><li>  Panggilan 25 atau lebih (eksekusi maksimum) </li><li>  Sudah cukup waktu berlalu sejak pengiriman terakhir, setidaknya 50 milidetik, tetapi tidak lebih dari 150 (sehingga antrian bergerak, meskipun ukurannya kecil) </li></ul><br>  Permintaan dari antrian dikompilasi ke dalam kode VK Script, yang (dalam implementasi ini) terlihat seperti ini: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> returnables = []; returnables[<span class="hljs-number"><span class="hljs-number">0</span></span>] = API.messages.send({<span class="hljs-string"><span class="hljs-string">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">", !"</span></span>, <span class="hljs-string"><span class="hljs-string">"peer_id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"random_id"</span></span>: <span class="hljs-number"><span class="hljs-number">561427</span></span>}); returnables[<span class="hljs-number"><span class="hljs-number">1</span></span>] = API.users.get({<span class="hljs-string"><span class="hljs-string">"user_ids"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"fields"</span></span>: <span class="hljs-string"><span class="hljs-string">"sex"</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnables;</code> </pre> <br>  Setelah kode dieksekusi oleh permintaan ke VK, hasil dari setiap permintaan (berdasarkan indeks yang <i>dapat dikembalikan</i> ) kembali ke panggilan baliknya, dibungkus dengan indah dalam Janji.  Efisiensi pendekatan ini luar biasa - semakin <b>banyak</b> pengguna (dan, oleh karena itu, semakin banyak permintaan ke VKontakte untuk pengiriman), semakin <b>sedikit</b> keterlambatan dalam respons.  Untuk menjaga batas tetap terkendali, sistem pengiriman memiliki penghitung yang menunjukkan jumlah permintaan yang tersisa untuk detik ini, yang memungkinkan Anda memproses lonjakan pengunjung dengan cepat. <br><br><h2>  Belajar mendengarkan VK </h2><br>  Ada dua cara untuk menerima pemberitahuan tentang acara dari VKontakte: <b>Longpoll-request</b> dan <b>Callback-server</b> .  Server Anda nyaman karena tidak memerlukan gerakan khusus untuk digunakan, dan juga memungkinkan Anda untuk menerima notifikasi yang terlewat (misalnya, saat Anda me-restart server).  Server semacam itu dapat ditulis dalam beberapa baris menggunakan kelas <b>http.Server</b> asli. <br><br>  Semua ini menciptakan ekosistem ideal untuk logika program, yang nyaman digunakan. <br><br><h2>  Semuanya berakhir </h2><br>  Karena pengguna bebas melakukan apa pun dalam obrolan, dan kami tidak dapat menghentikannya, kami perlu membatasinya hingga jumlah yang wajar.  Mesin negara melakukan pekerjaan yang sangat baik untuk melakukan hal ini, mengatur setiap transisi yang mungkin dalam sistem, dan menggunakan tombol (parameter <b>keyboard</b> dalam pesan. Kirim) akan membuat menggunakan bot sesederhana satu sentuhan di layar. <br><br>  Berikut ini interaksi pengguna dengan bot: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sz/1o/fw/sz1ofwuethupwaiet4syf6ahl4u.png"></div><br>  Semua ini berubah menjadi seperangkat status ("Menu Utama", "Input Valentine" dan seterusnya), transisi di antaranya diatur dan dikirim dalam tombol, atau dikenal pada awalnya dan tidak berubah. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cq/dz/ml/cqdzmlalb1t2o-xpdet5mvfnnek.png"></div><br>  Omong-omong, tentang tombol.  Gamut warnanya non-invarian ( <b>4 warna</b> untuk semua kesempatan), tetapi tombollah yang memungkinkan untuk meminimalkan jumlah kesalahan pengguna.  Atas dasar mereka, Anda dapat benar-benar membangun sistem non-linear, itulah sebabnya mereka digunakan di mana-mana.  Dan dalam proyek ini juga. <br><br>  Tetapi Anda perlu memahami: jika Anda menargetkan audiens yang besar, Anda harus mempertimbangkan cara lain untuk berinteraksi, karena seseorang mungkin memiliki aplikasi lama ( <b>VK untuk iPad</b> , misalnya, belum diperbarui untuk waktu yang sangat lama, saya tidak akan berbohong, tetapi sepertinya lebih dari setahun, dan dukungan keyboard tidak ada).  Dan itu terjadi (ya, itu terjadi, saya memeriksa) bahwa orang-orang, tidak menyadari bahwa tombol dapat diklik, hanya menulis ulang konten mereka (dan kemudian parameter tombol payload, tentu saja, tidak ditransmisikan, dan semuanya dapat rusak). <br><br>  Perlu dicatat bahwa tidak semuanya terjadi semulus yang dijelaskan dalam diagram, dan kadang-kadang terjadi kasus yang aneh.  Misalnya, sistem untuk menentukan tautan VKontakte memproses secara salah pengguna yang tautan pendeknya dimulai dengan <b>id</b> dan memotongnya.  Kejutan dari orang-orang yang bertemu dengan bug ini tidak dapat dijelaskan, karena mereka menulis Valentine Valentine, tetapi ternyata Olezhka. <br><blockquote>  <b>Apa olezhka ????</b> </blockquote><h2>  Kecelakaan tidak disengaja </h2><br>  Jadi, jika semuanya jelas dengan valentine biasa, ada penerima dan pengirim, lalu bagaimana cara mengurangi dua orang asing?  Anda perlu menukar valentine mereka, dan jika orang-orang menyukai valentine satu sama lain, maka mereka harus diperkenalkan!  Ini dia, formula cinta! <br><br>  Meskipun ini terdengar menyedihkan, ia bekerja, dan menjadi lebih menarik bagi orang untuk bekerja dengan bot - mereka akan mendapatkan respons positif jika setidaknya ada satu orang (yang, tentu saja, bot akan mengurusnya). <br><br>  Nilai tambah besar dari ini - semakin banyak orang mengambil kesempatan ini, semakin banyak peluang mereka untuk saling mengenal, dan oleh karena itu, ini seperti permainan, membuat seseorang tetap mengobrol.  Patut diakui bahwa sesi rata-rata pengguna adalah ~ 7 menit, tetapi ada potensi untuk mengencangkan seseorang hingga <b>10-15</b> hanya demi fitur ini. <br><br>  Distribusi pesan memaksa skema yang terpisah, karena ada beberapa opsi untuk menggunakan bot ini, pengguna dapat kehilangan sesuatu, dan bot mengingatkannya dengan hati-hati. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pj/8a/bw/pj8abwsu2zjmkhotgiffi0jldse.jpeg"></div><br>  Sangat menarik bagaimana masalah kedua diselesaikan, dengan ketidakmampuan komunitas untuk memulai dialog dengan pengguna terlebih dahulu: sekarang masalah ini diselesaikan dengan pesan seperti itu. <br><blockquote>  Tapi saya punya syarat!  Agar penerima dapat menerima Valentine Anda, ia juga harus menulis surat kepada saya.  Tugas Anda sekarang adalah membujuknya untuk menulis sesuatu kepada saya.  Ini dilakukan agar Anda tidak takut berbicara dengannya! </blockquote>  Secara umum, tradisional "Bukan bug, tapi fitur!" <br><br><h2>  Kembang api di akhir </h2><br>  Itu saja!  Jika Anda tidak memperhitungkan beberapa kesulitan dalam memahami logika VK API, serta dengan mengkonfirmasi akun dengan salah satu penyedia, semuanya berjalan terlalu lancar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-7/gb/yt/-7gbythuuwaf87k6c-v4k5-shok.png"></div><br>  <i>Contoh mengobrol dengan bot</i> <br><br>  Bot bekerja dan akan menyenangkan orang-orang dengan kasih sayang, membuat mereka bahagia.  Ini dilakukan untuk membantu orang menjadi lebih ramah satu sama lain.  Anda dapat mengevaluasi semua ini sendiri di komunitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Valentinych - vk.com/verylovebot</a> , jika diinginkan.  Terima kasih atas perhatian anda! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439218/">https://habr.com/ru/post/id439218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439204/index.html">Meningkatkan efisiensi fotosintesis dengan modifikasi genetik tanaman</a></li>
<li><a href="../id439206/index.html">Bagaimana kami memecahkan masalah melanjutkan daftar putar di RecSys Challenge dan mengambil tempat ke-3</a></li>
<li><a href="../id439208/index.html">Oh, Kode Saya: Cara Kerja MAPS.ME</a></li>
<li><a href="../id439210/index.html">Jawa setelah letusan gunung berapi</a></li>
<li><a href="../id439216/index.html">pudge 500 row embeddable database di golang</a></li>
<li><a href="../id439220/index.html">Kota besar untuk perangkat seluler di Unity. Pengalaman dalam pengembangan dan optimalisasi</a></li>
<li><a href="../id439222/index.html">Apa itu manajemen API?</a></li>
<li><a href="../id439224/index.html">Lagi tentang diagram Voronoi</a></li>
<li><a href="../id439226/index.html">Scala + MXNet = Microservice dengan neuron in prod</a></li>
<li><a href="../id439232/index.html">JAMstack: Cara membuat blog Anda sendiri menggunakan Gatsby + Contentful + Netlify</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>