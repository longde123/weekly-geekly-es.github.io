<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏾‍⚖️ 👩🏼‍⚕️ 👭 Automatisierung für die Kleinsten. Zweiter Teil. Netzwerkdesign 👆 💆🏼 🌋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In den ersten beiden Artikeln habe ich das Thema Automatisierung angesprochen und dessen Rahmen skizziert, in der zweiten habe ich einen Exkurs in die...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatisierung für die Kleinsten. Zweiter Teil. Netzwerkdesign</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475614/">  In den ersten beiden Artikeln habe ich das Thema Automatisierung angesprochen und dessen Rahmen skizziert, in der zweiten habe ich einen Exkurs in die Netzwerkvirtualisierung als ersten Ansatz zur Automatisierung der Konfiguration von Diensten gemacht. <br>  Und jetzt ist es Zeit, ein physisches Netzwerkdiagramm zu zeichnen. <br><br>  Wenn Sie mit Rechenzentrumsnetzwerken nicht auf dem Laufenden sind, empfehle ich dringend, mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel darüber zu beginnen</a> . <br><br>  Alle Ausgaben: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">0. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil Null.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Planung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil eins (der nach null ist).</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Netzwerkvirtualisierung</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2. ADSM.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Zweiter Teil.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Netzwerkdesign</a> </li></ul><br>  Die in dieser Serie beschriebenen Vorgehensweisen sollten auf ein Netzwerk jeglicher Art und Größenordnung mit einer Vielzahl von Anbietern (Nr.) Anwendbar sein.  Ein universelles Beispiel für die Anwendung dieser Ansätze kann jedoch nicht beschrieben werden.  Daher werde ich mich auf die moderne Architektur des DC-Netzes konzentrieren: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klose Factory</a> . <br>  DCI arbeitet mit MPLS L3VPN. <br><br>  Ein Overlay-Netzwerk vom Host wird über dem physischen Netzwerk ausgeführt (dies kann OpenStack VXLAN oder Tungsten Fabric sein oder alles andere, das nur eine grundlegende IP-Konnektivität vom Netzwerk erfordert). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e13/b5a/aa8/e13b5aaa8e2c2161e75084de878ed741.jpg" width="600"></a> <br><br>  In diesem Fall erhalten wir ein relativ einfaches Szenario für die Automatisierung, da viele Geräte auf die gleiche Weise konfiguriert sind. <br><br>  Wir werden einen sphärischen Gleichstrom im Vakuum wählen: <br><br><ul><li>  Eine Version des Designs ist überall. </li><li>  Zwei Anbieter bilden zwei Ebenen des Netzwerks. </li><li>  Ein Gleichstrom gleicht einem anderen wie zwei Wassertropfen. </li></ul><br><hr><br><a name="habracut"></a><br><h1>  Inhalt </h1><br><ul><li>  <b>Physikalische Topologie</b> </li><li>  <b>Routing</b> </li><li>  <b>IP-Plan</b> </li><li>  <b>Laba</b> </li><li>  <b>Fazit</b> </li><li>  <b>Nützliche Links</b> </li></ul><br>  Lassen Sie unseren LAN_DC Service Provider beispielsweise Schulungsvideos über das Überleben in steckengebliebenen Aufzügen hosten. <br><br>  In Megacities ist dies sehr beliebt, daher gibt es viele physische Maschinen. <br><br>  Zunächst beschreibe ich das Netzwerk ungefähr so, wie ich es gerne sehen würde.  Und dann werde ich es für das Labor vereinfachen. <br><br><hr><br><br><h1>  Physikalische Topologie </h1><br><h2>  Standorte </h2><br>  LAN_DC wird 6 DCs haben: <br><ul><li>  Russland ( <b>RU</b> ): <br><ul><li>  Moskau ( <b>msk</b> ) </li><li>  Kazan ( <b>kzn</b> ) </li></ul><br></li><li>  Spanien ( <b>SP</b> ): <br><ul><li>  Barcelona ( <b>bcn</b> ) </li><li>  Malaga ( <b>mlg</b> ) </li></ul><br></li><li>  China ( <b>CN</b> ): <br><ul><li>  Shanghai ( <b>sha</b> ) </li><li>  Xi'an ( <b>sia</b> ) </li></ul><br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/c79/5f3/6f3/c795f36f3eb1553eaf32f909d570ed16.png" width="800"><br><hr><br><br><h2>  In DC (Intra-DC) </h2><br>  In allen Domänencontrollern identische interne Konnektivitätsnetzwerke basierend auf der Clos-Topologie. <br>  Welche Art von Netzwerken sind Klose und warum sind sie in einem separaten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> . <br><br>  In jedem DC gibt es 10 Racks mit Autos, die mit <b>A</b> , <b>B</b> , <b>C</b> usw. nummeriert sind. <br><br>  Jedes Rack hat 30 Autos.  Sie werden uns nicht interessieren. <br><br>  Außerdem gibt es in jedem Rack einen Switch, an den alle Maschinen angeschlossen sind - dies ist der <b>Top-of-the-Rack-Switch - ToR</b> oder im Sinne der Klose-Fabrik <b>Leaf</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3a/5da/d17/e3a5dad17c7aadf1cf95865deaa8e359.png" width="800"><br>  <i>Das allgemeine Schema der Fabrik.</i> <br><br>  Wir werden sie mit <i><b>XXX-</b> leaf <b>Y bezeichnen</b></i> , wobei <b>XXX</b> die aus drei Buchstaben bestehende Abkürzung DC und <b>Y</b> die Seriennummer ist.  Zum Beispiel <i>kzn-leaf11</i> . <br><blockquote>  In den Artikeln erlaube ich mir, die Begriffe Leaf und ToR recht leichtfertig als Synonyme zu verwenden.  Man muss jedoch bedenken, dass dies nicht so ist. <br>  ToR ist ein in ein Rack eingebauter Switch, mit dem Maschinen verbunden sind. <br>  Leaf ist die Rolle eines Geräts in einem physischen Netzwerk oder eines Switches der ersten Ebene in Bezug auf die Clos-Topologie. <br>  Das heißt, Leaf! = ToR. <br>  So kann Leaf beispielsweise ein EndofRaw-Schalter sein. <br>  Im Rahmen dieses Artikels werden wir sie jedoch trotzdem als Synonyme bezeichnen. <br></blockquote>  Jeder ToR-Switch ist wiederum mit vier Upstream-Aggregations-Switches verbunden - <b>Spine</b> .  Unter Spine'y wurde im DC ein Rack zugeteilt.  Wir werden es auf die gleiche Weise <i>benennen</i> : <i><b>XXX</b> -dorn <b>Y.</b></i> <br><br>  Im selben Rack befinden sich Netzwerkgeräte für die Konnektivität zwischen DCs - 2 Router mit integriertem MPLS.  Aber im Großen und Ganzen - das sind die gleichen Aufgaben.  Aus Sicht der Spine-Switches spielt es also keine Rolle, ob es einen normalen ToR mit angeschlossenen Maschinen oder einen Router für DCI gibt - eine verdammte Sache. <br><br>  Solche speziellen ToRs werden <b>Edge-Leaf genannt</b> .  Wir werden sie <i><b>XXX-</b> Kante <b>Y nennen.</b></i> <br><br>  Es wird so aussehen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/62c/83f/d27/62c83fd278227f1740e5cf4e64eaed4e.png" width="800"><br><br>  In dem Diagramm über Kante und Blatt habe ich mich wirklich auf die gleiche Ebene gesetzt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klassische dreistufige Netzwerke</a> haben uns gelehrt, den Uplink (der Begriff stammt eigentlich von hier) als Verbindung zu betrachten.  Und hier stellt sich heraus, dass der „Uplink“ von DCI wieder nach unten geht, was etwas gegen die übliche Logik verstößt.  Bei großen Netzwerken werden, wenn Rechenzentren weiter in kleinere Einheiten unterteilt werden - <b>PODs</b> (Point of Delivery) - separate <b>Edge-PODs</b> für DCI und den Zugriff auf externe Netzwerke zugewiesen. <br><br>  Der Einfachheit halber werde ich auch in Zukunft Edge auf Spine zeichnen, wobei wir uns vor Augen halten, dass es keine Informationen zu Spine und Unterschieden bei der Arbeit mit gewöhnlichen Leaf- und Edge-Leaf-Elementen gibt (obwohl es möglicherweise Nuancen gibt, aber im Allgemeinen ist das so). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca5/67d/9db/ca567d9db0c49c3baf63304443477102.png" width="600"><br>  <i>Fabrikplan mit Randblättern.</i> <br><br>  Trinity Leaf, Spine und Edge bilden ein Underlay-Netzwerk oder eine Factory. <br><br>  Die Aufgabe der Network Factory (Read Underlay) ist, wie wir bereits in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vorgängerversion</a> festgestellt haben, sehr, sehr einfach: IP-Konnektivität zwischen Maschinen innerhalb desselben DC und zwischen bereitzustellen. <br>  Aus diesem Grund wird das Netzwerk als Factory bezeichnet, genau wie beispielsweise eine Switching-Factory in modularen Netzwerkboxen, die in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SDSM14</a> ausführlicher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">beschrieben wird</a> . <br><blockquote>  Im Allgemeinen wird eine solche Topologie als Factory bezeichnet, da Fabric in Translation ein Fabric ist.  Und es ist schwer nicht zuzustimmen: <br><img src="https://habrastorage.org/getpro/habr/post_images/7e9/db7/2c3/7e9db72c353e6b5b050eb63de72bb111.png" width="300"><br></blockquote><br>  Fabrik vollständig L3.  Keine VLANs, kein Broadcast - das sind großartige Programmierer bei LAN_DC, sie können Anwendungen schreiben, die dem L3-Paradigma entsprechen, und virtuelle Maschinen erfordern keine Live-Migration, da die IP-Adresse gespeichert wird. <br><br>  Und nochmal: die Antwort auf die Frage, warum das Werk und warum L3 - in einem eigenen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> . <br><hr><br><br><h2>  DCI - Data Center Interconnect (Inter-DC) </h2><br>  DCI wird mit Edge-Leaf organisiert, das heißt, sie sind unser Ausgangspunkt zur Autobahn. <br>  Der Einfachheit halber nehmen wir an, dass DCs durch direkte Verbindungen verbunden sind. <br>  Wir schließen externe Konnektivität von der Betrachtung aus. <br><blockquote>  Mir ist bewusst, dass ich jedes Mal, wenn ich eine Komponente entferne, das Netzwerk erheblich vereinfache.  Und mit der Automatisierung unseres abstrakten Netzwerks wird alles in Ordnung sein, aber auf dem realen werden Krücken auftauchen. <br>  Ist das so.  Dennoch ist das Ziel dieser Reihe, Ansätze zu denken und zu bearbeiten und imaginäre Probleme nicht heldenhaft zu lösen. <br></blockquote><br>  Bei Edge-Leafs wird die Unterlage im VPN platziert und über das MPLS-Backbone (dieselbe direkte Verbindung) übertragen. <br><br>  Hier ist so ein Top-Level-Schema. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e4e/ad7/b78/e4ead7b7898490c29fa93f7375376aa8.png" width="800"><br><br><hr><br><br><h1>  Routing </h1><br><br>  Für das Routing innerhalb des DC verwenden wir BGP. <br>  Auf OSPF + LDP MPLS-Trunk <br>  Für DCI ist die Organisation der Konnektivität auf der Unterseite BGP L3VPN über MPLS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a55/3b1/30b/a553b130b286a50fd1c97fe8bb2b5b5b.png" width="800"><br>  <i>Allgemeines Routing-Schema</i> <br><br>  Es gibt keine OSPF und ISIS im Werk (Routing-Protokoll in der Russischen Föderation verboten). <br><br>  Dies bedeutet, dass keine automatische Erkennung und Berechnungen des kürzesten Pfades erforderlich sind - nur die manuelle (in der Tat automatische - hier geht es um die Automatisierung) Einrichtung des Protokolls, der Umgebung und der Richtlinien. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82b/426/251/82b4262513aeae7c12d6e1618182f272.png" width="600"><br>  <i>BGP-Routing-Schema im DC</i> <br><br>  <b>Warum BGP?</b> <br><br>  Es gibt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine ganze RFC</a> namens Facebook und Arista zu diesem Thema, in der erklärt wird, wie mit BGP <b>sehr große</b> Netzwerke von Rechenzentren aufgebaut werden.  Es liest sich fast wie eine Kunst, sehr zu empfehlen für einen trägen Abend. <br><br>  Und ein ganzer Abschnitt in meinem Artikel ist diesem Thema gewidmet.  Wohin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">schicke</a> ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dich?</a> <br><br>  Kurz gesagt, kein IGP eignet sich für Netzwerke großer Rechenzentren, in denen Tausende von Netzwerkgeräten zum Einsatz kommen. <br><br>  Darüber hinaus können Sie durch die Verwendung von BGP überall auf die Unterstützung mehrerer verschiedener Protokolle und die Synchronisierung zwischen diesen verzichten. <br><blockquote>  Hand aufs Herz, in unserer Fabrik, die mit hoher Wahrscheinlichkeit nicht schnell wachsen wird, würde OSPF für die Augen ausreichen.  Dies sind eigentlich die Probleme von Megascalern und Cloud-Titanen.  Aber stellen wir uns ein paar Probleme vor, die wir brauchen, und wir werden BGP verwenden, wie es Peter Lapukhov hinterlassen hat. <br></blockquote><br><hr><br><br><h2>  Routing-Richtlinien </h2><br>  Bei Leaf-Switches importieren wir BGP-Präfixe von Underlay-Schnittstellen mit Netzwerken. <br>  Wir werden eine BGP-Sitzung zwischen <b>jedem</b> Blatt-Wirbelsäulen-Paar haben, in der diese Unterlegungs-Präfixe in einem Pfützennetz angekündigt werden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/85a/4b0/38d/85a4b038dc57c9fc54f1fb1ad10a5172.png" width="800"><br><br>  In einem Rechenzentrum werden die in ToRe importierten Daten verteilt.  Auf Edge-Leafs werden sie aggregiert und in Remote-DCs angekündigt und auf ToRs gesenkt.  Das heißt, jeder ToR weiß genau, wie er zu einem anderen ToR in demselben DC gelangt und wo sich der Einstiegspunkt befindet, um zu dem ToR in einem anderen DC zu gelangen. <br><br>  In DCI werden Routen als VPNv4 übertragen.  Dazu wird auf dem Edge-Leaf die Schnittstelle zur Factory in VRF platziert, nennen wir es UNDERLAY, und die Nachbarschaft mit dem Dorn auf dem Edge-Leaf wird innerhalb des VRF und zwischen den Edge-Leafs in der VPNv4-Familie entstehen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/231/d58/9d6/231d589d6ae0bcd63e4f60028771cd95.png" width="800"><br><br>  Wir werden auch die erneute Ankündigung von Routen, die von Stacheln empfangen wurden, zu diesen verbieten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f0/f41/dfa/3f0f41dfa8510d48849ef8743f5b757a.png" width="500"><br><br>  Auf Leaf und Spine werden keine Loopbacks importiert.  Wir brauchen sie nur, um die Router-ID zu bestimmen. <br><br>  Bei Edge-Leafs wird es jedoch in Global BGP importiert.  Zwischen Loopback-Adressen richten Edge Leafs eine BGP-Sitzung in der IPv4-VPN-Familie miteinander ein. <br><br>  Zwischen den EDGE-Geräten befindet sich ein OSPF + LDP-Backbone.  Alles in einer Zone.  Extrem einfache Konfiguration. <br><br>  Hier ist ein Bild des Routings. <br><hr><br><br><h2>  BGP ASN </h2><br><h3>  Edge-Leaf ASN </h3><br>  Auf Edge-Leafs wird in allen DCs ein ASN vorhanden sein.  Es ist wichtig, dass es zwischen den Edge-Leafs iBGP gibt und dass wir nicht auf die Nuancen von eBGP stoßen.  Es sei 65535. In Wirklichkeit könnte es eine öffentliche AS-Nummer sein. <br><br><h3>  Wirbelsäule ASN </h3><br>  Bei Spine haben wir einen Lieferavis pro DC.  Beginnen wir hier mit der allerersten Nummer aus dem privaten AS-Bereich - 64512, 64513 usw. <br><br>  Warum ist ASN auf DC? <br><br>  Wir zerlegen diese Frage in zwei Teile: <br><br><ul><li>  Warum sind die gleichen Lieferavise auf allen Stacheln des gleichen DCs? </li><li>  Warum unterscheiden sie sich in verschiedenen DCs? </li></ul><br>  <b>Warum sind die gleichen Lieferavise auf allen Stacheln eines DC</b> <br><br>  So sieht die AS-Path Anderlay-Route auf dem Edge-Leaf aus: <br> <code>[leafX_ASN, <b>spine_ASN</b> , edge_ASN]</code> <br>  Wenn Sie versuchen, es wieder bei Spine anzumelden, wird es gelöscht, da sein AS (Spine_AS) bereits in der Liste enthalten ist. <br><br>  Innerhalb des DC sind wir jedoch völlig zufrieden, dass die Underlay-Routen, die nach Edge geklettert sind, nicht runtergehen können.  Die gesamte Kommunikation zwischen Hosts innerhalb des DC sollte innerhalb der Wirbelsäulenebene stattfinden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b3/cec/64c/0b3cec64c8666b0154f041bd64c9059b.png" width="800"><br><br>  Gleichzeitig erreichen die aggregierten Routen anderer DCs in jedem Fall ToRs frei - in ihrem AS-Path gibt es nur ASN 65535 - die Anzahl der AS Edge-Leafs, weil sie auf ihnen erstellt wurden. <br><br>  <b>Warum sind in verschiedenen DC unterschiedlich</b> <br><br>  Theoretisch müssen wir möglicherweise Loopbacks und einige virtuelle Servicemaschinen zwischen die Domänencontroller ziehen. <br><br>  Auf dem Host wird beispielsweise ein Route Reflector oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dasselbe VNGW</a> (Virtual Network Gateway) ausgeführt, das über BGP mit ToR gesperrt wird und dessen Loopback ankündigt, das von allen Domänencontrollern verfügbar sein sollte. <br><br>  So sieht sein AS-Pfad aus: <br> <code>[VNF_ASN, leafX_DC1_ASN, <b>spine_DC1_ASN</b> , edge_ASN, <b>spine_DC2_ASN</b> , leafY_DC2_ASN]</code> <br> <br>  Und hier sollte es nirgendwo doppelte Lieferavise geben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fee/b97/61f/feeb9761f4964eda7f7519464927f61e.png" width="800"><br><br>  Das heißt, Spine_DC1 und Spine_DC2 sollten sich unterscheiden, genau wie leafX_DC1 und leafY_DC2, und genau dem nähern wir uns. <br><blockquote>  Wie Sie wahrscheinlich wissen, gibt es Hacks, die es Ihnen ermöglichen, Routen mit sich wiederholenden ASNs entgegen dem Loop Prevention-Mechanismus (allowas-in bei Cisco) zu akzeptieren.  Und es hat sogar rechtmäßige Verwendungen.  Dies kann jedoch die Ausfallsicherheit des Netzwerks beeinträchtigen.  Und ich persönlich bin ein paar Mal reingefallen. <br><br>  Und wenn wir die Möglichkeit haben, keine gefährlichen Dinge zu benutzen, werden wir sie benutzen. <br></blockquote><br><h3>  Blatt asn </h3><br>  Wir haben eine individuelle ASN auf jedem Leaf-Switch im gesamten Netzwerk. <br>  Dies geschieht aus den oben genannten Gründen: AS-Pfad ohne Schleifen, BGP-Konfiguration ohne Lesezeichen. <br><br>  Damit Routen zwischen Leafs ungehindert passieren können, sollte AS-Path folgendermaßen aussehen: <br> <code>[leafX_ASN, spine_ASN, leafY_ASN]</code> <br>  Wobei leafX_ASN und leafY_ASN schön wären, anders zu sein. <br><br>  Dies ist auch für die Situation mit der Ankündigung des VNF-Loopback zwischen DCs erforderlich: <br> <code>[VNF_ASN, <b>leafX_DC1_ASN</b> , spine_DC1_ASN, edge_ASN, spine_DC2_ASN, <b>leafY_DC2_ASN</b> ]</code> <br> <br>  Wir werden einen 4-Byte-ASN verwenden und ihn basierend auf dem ASN und der Leaf-Switch-Nummer von Spine generieren, und zwar wie <i>folgt</i> : <i>Spine_ASN.0000X</i> . <br><hr><br><br>  Hier ist ein Bild mit ASN. <br><img src="https://habrastorage.org/getpro/habr/post_images/c4a/f3b/66c/c4af3b66cff4bb0589ee0c6ef98134cf.png" width="800"><br><hr><br><br><h1>  IP-Plan </h1><br><br>  Grundsätzlich müssen wir Adressen für folgende Verbindungen vergeben: <br><br><ol><li>  Unterlegen Sie die Netzwerkadressen zwischen ToR und der Maschine.  Sie müssen im gesamten Netzwerk eindeutig sein, damit jede Maschine mit jeder anderen kommunizieren kann.  Ideal für <b>10/8</b> .  Für jedes Rack / 26 mit Rand.  Wir werden / 19 für DC und / 17 für die Region zuweisen. <br></li><li>  Verknüpfungsadressen zwischen Leaf / Tor und Spine. <br><br>  Ich möchte sie algorithmisch zuweisen, dh aus den Namen der Geräte berechnen, die verbunden werden müssen. <br><br>  Sei es ... 169.254.0.0/16. <br>  <b>169.254.00X.Y / 31</b> , wobei <b>X</b> die Spine-Nummer und <b>Y</b> das P2P-Netzwerk / 31 ist. <br>  Auf diese Weise können Sie bis zu 128 Racks und bis zu 10 Spine im DC betreiben.  Linkadressen können (und werden) von DC zu DC wiederholt. </li><li>  Wir organisieren die Verbindung Wirbelsäule - Rand-Blatt in den Subnetzen <b>169.254.10X.Y / 31</b> , wobei <b>X</b> die Wirbelsäulennummer und <b>Y</b> das P2P-Netzwerk / 31 ist. </li><li>  Verknüpfen Sie Adressen vom Edge-Leaf mit dem MPLS-Backbone.  Hier ist die Situation etwas anders - der Ort, an dem alle Teile zu einem Kreis verbunden werden, sodass die Wiederverwendung derselben Adressen nicht funktioniert - Sie müssen das nächste freie Subnetz auswählen.  Aus diesem Grund werden wir <b>192.168.0.0/16</b> als Basis nehmen und die davon befreien. </li><li>  Loopback-Adressen.  Geben Sie ihnen den gesamten Bereich <b>172.16.0.0/12</b> . <br><ul><li>  Leaf - at / 25 per DC - die gleichen 128 Racks.  Ordnen Sie der Region mit / 23 zu. </li><li>  Wirbelsäule - von / 28 am DC - bis zu 16 Wirbelsäulen.  Ordnen Sie der Region mit / 26 zu. </li><li>  Edge-Leaf - von / 29 auf DC - bis zu 8 Boxen.  Ordnen Sie der Region mit / 27 zu. </li></ul></li></ol><br>  Wenn wir im DC nicht genug von den ausgewählten Bereichen haben (aber sie werden nicht da sein - wir geben vor, hyper-skeylerostvo zu sein), wählen Sie einfach den nächsten Block aus. <br><br>  Hier ist ein Bild mit IP-Adressierung. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/def/f08/e49/deff08e49e0fee39e0799dfac4fad2a4.png" width="800"><br><br>  Loopbacks: <br><table border="2"><tbody><tr><td>  <b>Präfix</b> </td><td>  <b>Gerätefunktion</b> </td><td>  <b>Region</b> </td><td>  <b>DC</b> </td></tr><tr><td>  172.16.0.0/23 </td><td rowspan="10">  Rand </td><td></td><td></td></tr><tr><td>  172.16.0.0/27 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.0.0/29 </td><td>  msk </td></tr><tr><td>  172.16.0.8/29 </td><td>  kzn </td></tr><tr><td>  172.16.0.32/27 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.0.32/29 </td><td>  bcn </td></tr><tr><td>  172.16.0.40/29 </td><td>  mlg </td></tr><tr><td>  172.16.0.64/27 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.0.64/29 </td><td>  sha </td></tr><tr><td>  172.16.0.72/29 </td><td>  sia </td></tr><tr><td>  172.16.2.0/23 </td><td rowspan="10">  Wirbelsäule </td><td></td><td></td></tr><tr><td>  172.16.2.0/26 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.2.0/28 </td><td>  msk </td></tr><tr><td>  172.16.2.16/28 </td><td>  kzn </td></tr><tr><td>  172.16.2.64/26 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.2.64/28 </td><td>  bcn </td></tr><tr><td>  172.16.2.80/28 </td><td>  mlg </td></tr><tr><td>  172.16.2.128/26 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.2.128/28 </td><td>  sha </td></tr><tr><td>  172.16.2.144/28 </td><td>  sia </td></tr><tr><td>  172.16.8.0/21 </td><td rowspan="10">  blatt </td><td></td><td></td></tr><tr><td>  172.16.8.0/23 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  172.16.8.0/25 </td><td>  msk </td></tr><tr><td>  172.16.8.128/25 </td><td>  kzn </td></tr><tr><td>  172.16.10.0/23 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  172.16.10.0/25 </td><td>  bcn </td></tr><tr><td>  172.16.10.128/25 </td><td>  mlg </td></tr><tr><td>  172.16.12.0/23 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  172.16.12.0/25 </td><td>  sha </td></tr><tr><td>  172.16.12.128/25 </td><td>  sia </td></tr></tbody></table><br><br>  Unterlage: <br><table border="2"><tbody><tr><td>  <b>Präfix</b> </td><td>  <b>Region</b> </td><td>  <b>DC</b> </td></tr><tr><td>  10.0.0.0/17 </td><td rowspan="3">  ru </td><td></td></tr><tr><td>  10.0.0.0/19 </td><td>  msk </td></tr><tr><td>  10.0.32.0/19 </td><td>  kzn </td></tr><tr><td>  10.0.128.0/17 </td><td rowspan="3">  sp </td><td></td></tr><tr><td>  10.0.128.0/19 </td><td>  bcn </td></tr><tr><td>  10.0.160.0/19 </td><td>  mlg </td></tr><tr><td>  10.1.0.0/17 </td><td rowspan="3">  cn </td><td></td></tr><tr><td>  10.1.0.0/19 </td><td>  sha </td></tr><tr><td>  10.1.32.0/19 </td><td>  sia </td></tr></tbody></table><br><hr><br><br><h1>  Laba </h1><br>  Zwei Anbieter.  Ein Netzwerk.  ADSM. <br><br>  Wacholder + Arista.  Ubuntu  Gute alte Eva. <br><br>  Die Menge der Ressourcen auf unserer Virtualochka in Miran ist immer noch begrenzt, sodass wir in der Praxis nur ein so vereinfachtes Netzwerk verwenden werden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/477/a27/096/477a2709633866d53fec5972e9417421.png" width="800"><br><br>  Zwei Rechenzentren: Kasan und Barcelona. <br><br><ul><li>  Jeweils zwei Stacheln: Juniper und Arista. </li><li>  Jeweils ein Torus (Leaf) - Juniper und Arista, wobei ein Host verbunden ist (nehmen wir hierfür die leichte Cisco IOL). </li><li>  Ein Edge-Leaf-Knoten (bisher nur Juniper). </li><li>  Ein Cisco-Switch, der alle regiert. </li><li>  Zusätzlich zu Netzwerkboxen wurde eine virtuelle Verwaltungsmaschine gestartet.  Ubuntu ausführen. <br>  Sie hat Zugriff auf alle Geräte, IPAM / DCIM-Systeme, eine Reihe von Python-Skripten, Ansible und alles, was wir sonst noch brauchen, dreht sich darauf. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die vollständige Konfiguration</a> aller Netzwerkgeräte, die wir versuchen, mithilfe von Automatisierung zu reproduzieren. <br><hr><br><br><h1>  Fazit </h1><br>  Auch akzeptiert?  Unter jedem Artikel ein kurzes Fazit ziehen? <br><br>  Deshalb haben wir uns für das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dreistufige</a> Klose-Netzwerk innerhalb des DC entschieden, weil wir viel Ost-West-Verkehr erwarten und ECMP wollen. <br><br>  Wir haben das Netzwerk in physische (Unterlage) und virtuelle (Überlagerung) unterteilt.  In diesem Fall startet die Überlagerung vom Host aus, wodurch die Anforderungen an die Unterlagerung vereinfacht werden. <br><br>  Wir haben BGP aufgrund seiner Skalierbarkeit und Flexibilität der Richtlinien als Routing-Protokoll für die Un-Relay-Netzwerke ausgewählt. <br><br>  Wir werden separate Knoten für die DCI-Organisation haben - Edge-Leaf. <br>  Auf der Amtsleitung befindet sich OSPF + LDP. <br>  DCI wird basierend auf MPLS L3VPN implementiert. <br>  Bei P2P-Verbindungen werden IP-Adressen anhand von Gerätenamen algorithmisch berechnet. <br>  Lupbacks werden nach der Rolle der Geräte und ihrer Position nacheinander zugewiesen. <br>  Unterlegungspräfixe - nur bei Blattschaltern nacheinander basierend auf ihrer Position. <br><br>  Angenommen, wir haben die Geräte derzeit nicht installiert. <br>  Daher besteht unser nächster Schritt darin, sie in die Systeme zu integrieren (IPAM, Inventarisierung), den Zugriff zu organisieren, eine Konfiguration zu generieren und bereitzustellen. <br><br>  Im nächsten Artikel werden wir uns mit Netbox befassen, dem Inventarisierungs- und IP-Speicherverwaltungssystem im DC. <br><hr><br><br><h1>  Vielen Dank </h1><br><ul><li>  Andrey Glazkov aka @glazgoo zum Korrekturlesen und Bearbeiten </li><li>  Alexander Klimenko aka @ v00lk zum Korrekturlesen und Bearbeiten </li><li>  Artyom Chernobay für KDPV </li></ul><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de475614/">https://habr.com/ru/post/de475614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de475600/index.html">Wie wir Prometheus verbunden haben</a></li>
<li><a href="../de475604/index.html">Konfigurieren der offiziellen PostgreSQL-Vorlage unter Zabbix 4.4</a></li>
<li><a href="../de475608/index.html">Google Tag Manager: Unscheinbare und nützliche Trigger-Einstellungen</a></li>
<li><a href="../de475610/index.html">Sichere LED-Tischleuchten, die die Sicht behalten</a></li>
<li><a href="../de475612/index.html">Vorausgesetzt, wann, Behauptungen und Vertrauen in die Umsetzung</a></li>
<li><a href="../de475618/index.html">So erstellen Sie einen Smart Python-Vertrag im Ontology-Netzwerk. Teil 2: Speicher-API</a></li>
<li><a href="../de475624/index.html">PHP-Watcher: Ein Tool, das die Entwicklung langlebiger Anwendungen vereinfacht</a></li>
<li><a href="../de475626/index.html">Können Autotests eine Person auf der Suche nach Schwachstellen ersetzen: Interview mit Alexandra Svatikova</a></li>
<li><a href="../de475630/index.html">Knative - eine k8s-basierte Plattform als Service mit serverloser Unterstützung</a></li>
<li><a href="../de475636/index.html">Inkrementieren Sie Vektorelemente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>