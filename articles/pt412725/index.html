<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèà üëµüèΩ üë¥üèΩ Como tornar sua infraestrutura de TI chata ‚òùüèº ‚õ™Ô∏è üé¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Michael DeHaan √© o homem que criou o Ansible. Muitas das coisas que os administradores de sistemas, engenheiros de lan√ßamento e DevOps fazem regularme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como tornar sua infraestrutura de TI chata</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/412725/">  Michael DeHaan √© o homem que criou o Ansible.  Muitas das coisas que os administradores de sistemas, engenheiros de lan√ßamento e DevOps fazem regularmente s√£o, para dizer o m√≠nimo, desinteressantes.  DeHaan quer que essas pessoas liberem seu tempo para coisas mais interessantes (no trabalho ou fora da porta do escrit√≥rio) e escrevam um c√≥digo de produto que libere o tempo do administrador. <br>  Mais tempo, menos adrenalina durante o hor√°rio comercial, menos scripts e menos erros. <br>  A prop√≥sito, voc√™ pode terminar de ler este par√°grafo conectando-se √† transmiss√£o ao vivo em 6 de junho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><img src="https://habrastorage.org/webt/4p/xi/b6/4pxib6asllealgf8sje7orcjsbg.png" width="100%"><br><a name="habracut"></a><br>  Se voc√™ ainda continuasse lendo ... <br><br><h3>  Respons√°vel: Integra√ß√£o e Entrega Cont√≠nuas </h3><br>  Ansible √© uma poderosa linguagem de automa√ß√£o de c√≥digo aberto.  Sim, √© √≥timo n√£o apenas para gerenciamento, mas tamb√©m para a implanta√ß√£o e orquestra√ß√£o de sistemas de TI.  O Ansible foi criado originalmente para resolver efetivamente uma ampla gama de tarefas de automa√ß√£o e como uma base universal simples para substituir os controles tradicionais, mas no final acabou sendo muito √∫til em muitas √°reas.  Por exemplo, garantindo zero tempo de inatividade durante a integra√ß√£o cont√≠nua e a entrega de aplicativos (CI / CD).  Geralmente, esse problema √© resolvido devido ao refinamento extensivo do software, ao uso de v√°rios pacotes de software e a muitos truques exclusivos de cada configura√ß√£o espec√≠fica.  O Ansible foi originalmente projetado especificamente para esses cen√°rios de orquestra√ß√£o e oferece uma solu√ß√£o pronta para uso "tudo em um". <br><br><h3>  Integra√ß√£o cont√≠nua e entrega de aplicativos (CI / CD) </h3><br>  Algumas verdades comuns.  A pr√°tica de desenvolver sistemas de software nos √∫ltimos 10 anos mostra que o longo ciclo de vida das vers√µes de software (modelo de desenvolvimento em cascata) tem uma sobrecarga muito maior em compara√ß√£o com um ciclo curto (o chamado desenvolvimento "iterativo" ou √°gil).  √â uma quest√£o de arritmia: quando os programadores est√£o come√ßando a trabalhar em uma nova vers√£o, simplesmente n√£o h√° nada para a equipe de TI respons√°vel pelos testes e pela implanta√ß√£o.  Por√©m, quanto mais pr√≥xima a vers√£o do lan√ßamento, mais profissionais de TI est√£o ocupados e mais frequentemente os programadores precisam alternar entre contextos, alternando entre trabalhar em bugs e planejar a pr√≥xima vers√£o. <br><br><img src="https://habrastorage.org/webt/qv/sl/b1/qvslb1fsnltkxftsz2hxtgebghg.png" align="right">  Al√©m disso, um longo ciclo aumenta o intervalo entre a identifica√ß√£o e a elimina√ß√£o de erros e defici√™ncias de software, o que √© especialmente cr√≠tico para grandes sistemas da web com um p√∫blico de usu√°rios multimilion√°rio.  Portanto, a ind√∫stria de software est√° adotando rapidamente metodologias √°geis sob o slogan "liberar mais r√°pido e com mais frequ√™ncia", para que os participantes no processo de desenvolvimento possam mudar seu contexto de trabalho com menos frequ√™ncia e criar, depurar e implementar melhorias e inova√ß√µes muito mais rapidamente. <br><br>  A automa√ß√£o do controle de qualidade, o desenvolvimento do TDD por meio de testes e outras t√©cnicas relacionadas aumentam ainda mais a efic√°cia dos novos m√©todos de trabalho.  Onde est√° a automa√ß√£o?  Onde est√£o as tecnologias que tornam as engrenagens mais r√°pidas e reduzem a participa√ß√£o humana ao m√≠nimo estritamente necess√°rio? <br><br>  E aqui, por exemplo, a Ansible e a Ansible Tower da Red Hat para orquestrar sistemas de TI como parte dos modernos processos de desenvolvimento de software. <br><br><h3>  Zero tempo de inatividade </h3><br>  Um pouco mais √≥bvio.  Tempo de inatividade significa lucros perdidos e clientes insatisfeitos.  Portanto, em sistemas de enfileiramento da Web, cujos usu√°rios est√£o distribu√≠dos em todos os fusos hor√°rios, o desligamento agendado √© permitido apenas em casos realmente graves, cuja lista claramente n√£o inclui a atualiza√ß√£o de vers√µes de aplicativos.  A situa√ß√£o √© semelhante em ambientes corporativos, onde a inacessibilidade de uma intranet ou sistema de contabilidade reduz drasticamente a produtividade dos funcion√°rios.  Portanto, qualquer automa√ß√£o de processo deve fornecer atualiza√ß√µes sem interromper as opera√ß√µes - em outras palavras, com tempo de inatividade zero. <br><br>  √â bem poss√≠vel obter tempo de inatividade zero, mas para isso precisamos de ferramentas apropriadas - como fornecer orquestra√ß√£o avan√ßada, em v√°rios n√≠veis e v√°rios est√°gios, como, por exemplo, o sistema Ansible. <br><br><h3>  Sistemas de cria√ß√£o de aplicativos </h3><br>  A entrega cont√≠nua (CD) come√ßa com a integra√ß√£o cont√≠nua (IC).  Um sistema que monitora os reposit√≥rios de c√≥digos-fonte em busca de altera√ß√µes, executa independentemente os testes correspondentes e cria automaticamente (e testa, idealmente) uma nova vers√£o do aplicativo a cada atualiza√ß√£o de c√≥digo, por exemplo, o projeto Jenkins (jenkins.io). <br><br>  Para retransmitir o bast√£o para o sistema de CD ap√≥s criar com √™xito uma nova vers√£o do aplicativo, o subsistema de cria√ß√£o do sistema de CI pode chamar Ansible para fornecer imediatamente essa nova vers√£o para aqueles que executam testes de unidade ou integra√ß√£o.  Em particular, Jenkins pode usar o Tower para implantar montagens em v√°rios ambientes, e o ambiente de teste ou intermedi√°rio pode ser modelado com base no ambiente de produ√ß√£o, o que melhora bastante a previsibilidade ao longo do ciclo de vida do software.  Os dados retornados pela Ansible a partir dos resultados da execu√ß√£o de scripts de automa√ß√£o podem estar diretamente envolvidos nas tarefas Build Systems do sistema Tower.  De fato, o Tower ainda permite testar cen√°rios de implanta√ß√£o em um ambiente intermedi√°rio antes de execut√°-los em servidores de "combate". <br><br><h3>  Atualiza√ß√£o de aplicativo multin√≠vel, um por um </h3><br>  O sistema de CD deve ser capaz de orquestrar os processos de atualiza√ß√£o sem interrup√ß√£o de aplicativos multin√≠veis.  Gra√ßas √† arquitetura push e aos recursos da orquestra√ß√£o de v√°rios n√≠veis, o Ansible pode lidar com essa tarefa atualizando qualquer n√≠vel de aplicativo por n√≠vel e trocando dados entre eles. <br><br>  Para implementar atualiza√ß√µes um por um, o Ansible usa scripts Play que permitem especificar com precis√£o o grupo de hosts de destino e atribuir tarefas (Fun√ß√£o) que devem ser executadas neles.  As tarefas geralmente s√£o an√∫ncios de que um recurso de TI espec√≠fico deve estar em um determinado estado, por exemplo, para uma vers√£o do software, um pacote espec√≠fico deve ser instalado e, para outra, √© necess√°rio verificar o reposit√≥rio de c√≥digos.  As topologias de aplicativos da Web, como regra, exigem atualiz√°-las em ordem estrita, e voc√™ ainda n√£o pode atualizar aplicativos e configura√ß√µes do sistema em todas as m√°quinas ao mesmo tempo. <br><br>  Quando o servi√ßo √© reiniciado, ele permanece indispon√≠vel por algum tempo e a substitui√ß√£o da vers√£o do aplicativo tamb√©m n√£o ocorre instantaneamente.  Portanto, antes de atualizar o sistema, o retiramos do pool de balanceamento.  Como resultado, voc√™ precisa automatizar as opera√ß√µes de conex√£o e desconex√£o de m√°quinas do pool.  Consistentemente √© a palavra-chave.  O Ansible pode controlar com muita precis√£o o tamanho da janela de uma atualiza√ß√£o sucessiva.  Bem, o desenvolvimento dessas atualiza√ß√µes √© realizado com muito cuidado e, em algum momento, ocorre uma falha, a atualiza√ß√£o √© suspensa para n√£o desativar o restante da infraestrutura de TI. <br><br><h3>  Implanta√ß√£o cont√≠nua para scripts de automa√ß√£o </h3><br>  Al√©m da funcionalidade de CD para servi√ßos que operam no modo de opera√ß√£o comercial, voc√™ tamb√©m pode organizar a implanta√ß√£o cont√≠nua de scripts de automa√ß√£o (conjuntos de instru√ß√µes do Ansible Playbook. N√£o pare de ler, na segunda parte, haver√° exemplos de playbooks).  Isso permite que administradores de sistema e desenvolvedores gerenciem scripts usando o reposit√≥rio de c√≥digo-fonte, testem esses scripts em um ambiente intermedi√°rio e os transfiram automaticamente para o ambiente de produ√ß√£o em caso de invas√£o bem-sucedida.  Em outras palavras, ao trabalhar com scripts, voc√™ obt√©m todas as vantagens metodol√≥gicas e outras do reposit√≥rio de c√≥digos central ao qual est√° acostumado ao desenvolver software. <br><br>  Fazer altera√ß√µes nas configura√ß√µes de software e sistema √© um dos principais motivos de interrup√ß√µes n√£o planejadas.  Portanto, al√©m dos testes automatizados, h√° controle humano.  Ele pode ser organizado integrando-se a um sistema de inspe√ß√£o de c√≥digo como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gerrit</a> , e aplicando as altera√ß√µes somente depois de aprovadas pelos camaradas respons√°veis. <br><br><h3>  Atualiza√ß√µes alternativas e sistemas de balanceamento de carga </h3><br>  O Ansible funciona de maneira muito independente com os sistemas de balanceamento de carga ao executar atualiza√ß√µes sucessivas.  Portanto, voc√™ pode simplesmente escrever em um script do Playbook, em qualquer ciclo para um grupo de hosts, algo como "executar esta a√ß√£o no sistema X em nome do host Y", e o Ansible cuidar√° do resto. <br><br>  O Ansible interage bem com balanceadores de carga de todos os tipos e pode definir um sinalizador para desconectar temporariamente um host, a fim de desativar o monitoramento de disponibilidade durante o per√≠odo de atualiza√ß√£o.  O esquema simples "desligar o monitoramento - remover do pool - atualizar o n√≠vel de software desejado - retornar ao pool - ativar o monitoramento" implementa facilmente uma atualiza√ß√£o seq√ºencial com tempo de inatividade zero e sem alarmes falsos.  E tudo isso em um modo totalmente automatizado, sem interven√ß√£o do operador. <br><br><h3>  Teste Intermedi√°rio Integrado </h3><br>  O Tower pode trabalhar com v√°rios arquivos de invent√°rio de recursos (Inventory), o que facilita o teste de cen√°rios de atualiza√ß√£o sucessivos em um ambiente intermedi√°rio antes de execut√°-los em servidores "de batalha".  Para fazer isso, basta simular o ambiente de produ√ß√£o no ambiente de teste, executar Ansible com o par√¢metro ‚Äú-i‚Äù e indicar qual arquivo de invent√°rio deve ser usado ao executar o script - no ambiente de teste ou no ambiente de produ√ß√£o.  O script em si n√£o precisa ser modificado. <br><br><h3>  Implanta√ß√£o do Controle de Vers√£o </h3><br>  Algumas pessoas gostam de empacotar aplicativos juntamente com pacotes de SO (RPM, debs etc.) mais quentes, mas geralmente, especialmente para aplicativos da Web, esse empacotamento n√£o √© necess√°rio.  Portanto, o Ansible inclui v√°rios m√≥dulos para implantar aplicativos diretamente dos sistemas de controle de vers√£o.  No script Playbook, voc√™ pode escrever uma reconcilia√ß√£o com o reposit√≥rio de c√≥digos para a marca ou n√∫mero de vers√£o especificado, ap√≥s o qual o Ansible verificar√° essa condi√ß√£o em todos os servidores de destino e ativar√° as pr√≥ximas etapas apenas se a vers√£o precisar ser substitu√≠da, eliminando assim a reinicializa√ß√£o desnecess√°ria do servi√ßo. <br><br><h3>  Integra√ß√£o com ferramentas de monitoramento </h3><br>  Como um sistema de orquestra√ß√£o completo, o Ansible suporta a integra√ß√£o com sistemas de gerenciamento de desempenho de aplicativos baseados em APM no n√≠vel de monitoramento.  Por exemplo, durante a fase de teste de implementa√ß√£o ou integra√ß√£o, voc√™ deve instalar ou atualizar o agente de software APM com o aplicativo.  O Ansible tem uma fun√ß√£o especial para isso e, ap√≥s instalar e ativar o agente, o Ansible pode configur√°-lo na pilha de monitoramento do APM (se ainda n√£o estiver configurado) para que os gerentes de aplicativos possam verificar imediatamente se a nova vers√£o foi instalada e funciona sem problemas. . <br><br>  Se algo der errado ap√≥s a atualiza√ß√£o do aplicativo no ambiente de produ√ß√£o, as ferramentas de monitoramento podem chamar Ansible para reverter para a vers√£o anterior.  Obviamente, apenas se essa revers√£o for permitida. <br><br><h3>  Notifica√ß√£o de evento </h3><br>  No paradigma de CI / CD, todos desejam receber notifica√ß√µes de eventos o mais r√°pido poss√≠vel.  O Ansible oferece ambas as fun√ß√µes integradas, incluindo um m√≥dulo de e-mail, al√©m de integra√ß√£o com ferramentas de notifica√ß√£o externas, como mensageiros instant√¢neos, redes sociais ou sistemas de registro de eventos. <br><br><h3>  Implanta√ß√£o usando um modelo de estado de recurso </h3><br>  Um dos principais recursos do Ansible, que o torna uma ferramenta muito √∫til para implantar aplicativos, √© o uso regular do modelo de estado de recurso nos processos de atualiza√ß√£o de software, que ganhou popularidade no gerenciamento de configura√ß√µes do sistema.  Ao contr√°rio dos controles tradicionais de c√≥digo aberto, o Ansible n√£o precisa estar equipado com nenhum software adicional ou scripts especiais para organizar a entrega do aplicativo. <br><br>  No Ansible, voc√™ pode registrar e controlar com precis√£o a ordem dos eventos em diferentes n√≠veis da arquitetura, o que permite delegar a√ß√µes a outros sistemas, bem como combinar diretivas do modelo de recursos (como "o pacote X deve estar no estado Y") e comandos de script tradicionais (como "executar script .sh ") dentro de um processo. <br><br>  O Ansible tamb√©m facilita a execu√ß√£o de verifica√ß√µes de v√°rias condi√ß√µes e a tomada de decis√µes com base em seus resultados.  A combina√ß√£o dos processos de configura√ß√£o do sistema e implanta√ß√£o de aplicativos em uma √∫nica cadeia de ferramentas √© muito mais eficiente que um esquema com v√°rias ferramentas especializadas e, al√©m disso, aumenta a consist√™ncia das pol√≠ticas e aplicativos do SO. <br><br><h3>  Teste de implanta√ß√£o </h3><br>  Quanto mais oportunidades, maior a responsabilidade.  A automa√ß√£o de processos de entrega cont√≠nua aumenta drasticamente o risco de implantar uma configura√ß√£o com falha em todos os n√≥s do sistema.  Para reduzir os riscos, o Ansible sugere inserir testes de controle no script, o que interromper√° a atualiza√ß√£o seq√ºencial se algo der errado.  Para testar v√°rias condi√ß√µes, incluindo o status do funcionamento dos servi√ßos, voc√™ pode implantar testes arbitr√°rios usando os m√≥dulos Comando ou Script e at√© criar testes como m√≥dulos Ansible separados. <br><br>  O m√≥dulo Fail pode interromper a execu√ß√£o do script no host a qualquer momento, o que permite detectar falhas no est√°gio inicial da atualiza√ß√£o seq√ºencial.  Por exemplo, devido √† diferen√ßa entre o ambiente intermedi√°rio e o ambiente de produ√ß√£o, o √∫ltimo gera um erro de configura√ß√£o, que desativa os servidores de "combate".  Nesse caso, uma sa√≠da de emerg√™ncia pode ser registrada no script Playbooks no primeiro est√°gio da atualiza√ß√£o seq√ºencial.  E se voc√™ tiver 100 servidores e o tamanho da janela de atualiza√ß√£o sucessiva for 10, essa parada de emerg√™ncia dar√° a voc√™ tempo para descobrir com calma, corrigir o script e continuar a atualiza√ß√£o. <br><br>  No caso de uma falha, o Ansible n√£o continua funcionando, deixando os sistemas em um estado semi-configurado e gera um erro para atrair a aten√ß√£o do operador e informar a ele em quais hosts o ciclo de atualiza√ß√£o ocorreu com erros e quantas altera√ß√µes foram feitas em cada plataforma.  O Ansible possui um modo de execu√ß√£o de simula√ß√£o, quando o sistema gera um relat√≥rio sobre quais altera√ß√µes teriam sido feitas se o script tivesse sido executado sem sua execu√ß√£o real. <br><br><h3>  Verifica√ß√£o de conformidade </h3><br>  Existem ambientes em que as configura√ß√µes mudam apenas quando n√£o h√° como n√£o existir.  Quaisquer altera√ß√µes nesses ambientes s√£o pr√©-analisadas.  Utiliza sistemas de entrega cont√≠nua "com reservas". <br><br>  O Ansible possui um modo de execu√ß√£o de simula√ß√£o (ativado pelo sinalizador "--check"), quando o sistema gera um relat√≥rio sobre quais altera√ß√µes seriam feitas quando o script fosse executado.  Nesse caso, a execu√ß√£o real do script n√£o ocorre, a execu√ß√£o da simula√ß√£o n√£o permite a captura de erros, mas ajuda a entender e analisar melhor os detalhes e os resultados das altera√ß√µes propostas. <br><br>  Por outro lado, mesmo com a implanta√ß√£o cont√≠nua de novos assemblies, o Ansible permite executar verifica√ß√µes de conformidade com muito mais frequ√™ncia para capturar o momento em que algumas coisas no ambiente de produ√ß√£o mudam como resultado da interven√ß√£o humana e precisam ser corrigidas executando o script Ansible correspondente, por exemplo, para alterar vers√£o do software, ajustar permiss√µes, etc. <br><br><h3>  Implanta√ß√£o do piloto autom√°tico </h3><br>  Se voc√™ mora em um mundo de orquestra√ß√£o de v√°rios est√°gios em v√°rios n√≠veis de processos sequenciais de atualiza√ß√£o de software com tempo de inatividade zero, o CI / CD provavelmente √© executado exclusivamente por operadores (manualmente e com automa√ß√£o parcial) e exige, como em uma rodada, a√ß√µes coordenadas de todos os participantes do processo.  O Ansible, juntamente com sua arquitetura exclusiva e a aus√™ncia de agentes de software nos hosts de destino (aumentando a seguran√ßa e eliminando a necessidade de gerenciar o pr√≥prio sistema de gerenciamento), pode facilmente descrever e automatizar processos de implanta√ß√£o complexos, ou seja, o Ansible implementa aqui o modo de piloto autom√°tico completo. <br><br>  Exemplos de scripts de automa√ß√£o Ansible podem ser encontrados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> , e agora daremos uma base e um exemplo de como escrever um script do Playbook que pode ser executado no Ansible ou no Ansible Tower.  Juntamente com uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lista de m√≥dulos</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">outros documentos,</a> ela ajudar√° voc√™ a aprender como criar seus pr√≥prios scripts de Playbooks. <br><br><h3>  O que √© um manual? </h3><br>  Um script do Playbook √© essencialmente um conjunto de execu√ß√µes enviadas para execu√ß√£o em um √∫nico host remoto ou grupo de hosts.  √â como um guia de montagem de m√≥veis da IKEA: siga as instru√ß√µes exatamente e obtenha exatamente o que voc√™ viu na loja.  √â assim que os scripts funcionam. <br><br><h3>  M√≥dulos </h3><br>  Criaremos um Playbook que instalar√° o servidor da web no host RHEL / CentOS 7 e criaremos um arquivo index.html nele, com base no modelo especificado no script.  O script de exemplo mostrado aqui est√° totalmente operacional e pronto para uso.  Abaixo, veremos um exemplo de script do Playbook e mostraremos como usar os m√≥dulos. <br><br><h3>  Autores (Autores) </h3><br>  Um autor √© algu√©m que cria instru√ß√µes que ser√£o executadas por m√≥dulos (geralmente juntamente com valores adicionais: argumentos, locais etc.).  Os m√≥dulos s√£o executados no host de destino na ordem em que seguem o script do Playbook (incluindo include'y e outros arquivos adicionais inclu√≠dos nele).  O estado do host muda (ou n√£o muda), dependendo dos resultados da execu√ß√£o do m√≥dulo, que s√£o exibidos na forma de sa√≠da Ansible e Tower. <br><br><h3>  Execu√ß√£o de script do Playbook </h3><br>  Primeiro, h√° algumas coisas que voc√™ precisa saber sobre a execu√ß√£o de scripts do Playbook.  O Playbook √© um tipo de sistema simb√≥lico que informa o m√≥dulo sobre a necessidade de executar alguma tarefa.  Para iniciar com √™xito o seu Playbook, √© importante entender os seguintes pontos: <br><br>  <b>1. Sistema de destino (Target)</b> <br>  Como os scripts do Playbook fornecem instru√ß√µes e interagem com os m√≥dulos, o Ansible acredita que voc√™ entende o que est√° tentando fazer e o automatiza.  √â por isso que dizemos que os Playbooks s√£o como instru√ß√µes ou instru√ß√µes: voc√™ diz aos elementos automatizados como deseja configurar a tarefa.  Mas, ao mesmo tempo, voc√™ precisa entender muito bem como o host de destino no qual o script do Playbook √© executado est√° funcionando. <br><br>  <b>2. Tarefas</b> <br>  Se voc√™ precisar iniciar um servidor Web em alguma parte do Playbook, precisar√° entender como isso √© feito para saber qual m√≥dulo de servi√ßo usar para isso e iniciar o servidor Web por nome.  Se o Playbook instalar o pacote de software, voc√™ deve saber como fazer isso no host de destino.  Voc√™ tamb√©m deve entender, pelo menos em um n√≠vel b√°sico, a ess√™ncia das tarefas executadas.  √â necess√°ria uma configura√ß√£o de host adicional para o software que voc√™ deseja instalar?  Existem ramifica√ß√µes dependendo das condi√ß√µes e valores dos argumentos?  Se alguma vari√°vel for passada no processo, voc√™ dever√° entender exatamente o que e por qu√™. <br><br>  <b>Exemplo de script do manual</b> <br>  O exemplo de script do Playbook a seguir ajudar√° voc√™ a entender o que acabou de ler.  O host de destino √© o servidor RHEL / CentOS 7, no qual nosso script instala o servidor da web NGINX e, em seguida, cria o arquivo index.html no diret√≥rio padr√£o da raiz da web.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s concluir a instala√ß√£o e criar o √≠ndice, o servidor da web √© iniciado. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* Nota: Para executar este exemplo de script do Playbook no Ansible Tower, voc√™ deve primeiro configurar o invent√°rio e as contas. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os Playbooks come√ßam com tr√™s h√≠fens YAML (---), seguidos por: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nome</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : simplesmente o nome do script para preservar a legibilidade do Playbook. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hosts</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Uma lista de hosts de destino nos quais o Ansible deve trabalhar. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Torne</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font><b><font style="vertical-align: inherit;">se</font></b><font style="vertical-align: inherit;"> : aqui escrevemos uma declara√ß√£o verdadeira para garantir que o nginx seja instalado sem problemas (esse campo nem sempre √© obrigat√≥rio).</font></font><br><br><pre><code class="hljs css">1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">---</span></span> 2 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">name</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nginx</span></span> 3 <span class="hljs-selector-tag"><span class="hljs-selector-tag">hosts</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">host</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.name</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ip</span></span> 4 <span class="hljs-selector-tag"><span class="hljs-selector-tag">become</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">true</span></span></code> </pre> <br>  Com o recuo como nas tr√™s linhas anteriores, h√° as <b>tarefas</b> : diretiva, ap√≥s a qual, com recuo adicional (de acordo com as regras de aninhamento de YAML), as tarefas s√£o listadas (reproduzidas).  Neste exemplo, temos duas tarefas e ambas usam o m√≥dulo Yum.  A primeira tarefa adiciona um reposit√≥rio epel-release para que voc√™ possa instalar o nginx.  Depois que o epel aparece no sistema, a segunda tarefa instala o pacote nginx. <br><br>  A diretiva <b>state</b> : significa que o Ansible deve verificar o estado do host de destino antes de executar outras a√ß√µes.  Em nosso exemplo, se j√° existe um reposit√≥rio ou nginx no host, o Ansible entende que n√£o √© necess√°rio executar essas duas tarefas e prossegue para o seguinte. <br><br><pre> <code class="hljs sql">1 tasks: 2 - name: Add epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> repo <span class="hljs-number"><span class="hljs-number">3</span></span> yum: <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Install</span></span> nginx <span class="hljs-number"><span class="hljs-number">8</span></span> yum: <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">10</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span></code> </pre> <br>  A p√°gina de download, que √© usada por padr√£o no nginx, √© √≥tima para verificar se o nginx foi instalado corretamente, mas voc√™ provavelmente desejar√° fazer isso usando o arquivo html start.  Neste exemplo, por simplicidade, o modelo do arquivo de √≠ndice est√° no mesmo diret√≥rio em que o Playbook √© iniciado.  O destino √© apenas o caminho padr√£o no nginix sem sites configurados. <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> Page <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> src: <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-number"><span class="hljs-number">4</span></span> dest: /usr/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/nginx/html/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html</code> </pre> <br>  A √∫ltima linha do nosso Playbook serve apenas para verificar se o servi√ßo nginx foi iniciado com √™xito (ou para inici√°-lo, se n√£o). <br><br><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> NGiNX <span class="hljs-number"><span class="hljs-number">2</span></span> service: <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">4</span></span> state: started</code> </pre> <br>  Todo o script do Playbook tinha aproximadamente o mesmo tamanho do par√°grafo de abertura deste post: <br><br><pre> <code class="hljs delphi"><span class="hljs-number"><span class="hljs-number">1</span></span> --- <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Install nginx <span class="hljs-number"><span class="hljs-number">3</span></span> hosts: host.<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>.ip <span class="hljs-number"><span class="hljs-number">4</span></span> become: true <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> tasks: <span class="hljs-number"><span class="hljs-number">7</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Add epel-release repo <span class="hljs-number"><span class="hljs-number">8</span></span> yum: <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: epel-release <span class="hljs-number"><span class="hljs-number">10</span></span> state: present <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Install nginx <span class="hljs-number"><span class="hljs-number">13</span></span> yum: <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">15</span></span> state: present <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Insert <span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> Page <span class="hljs-number"><span class="hljs-number">18</span></span> template: <span class="hljs-number"><span class="hljs-number">19</span></span> src: <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-number"><span class="hljs-number">20</span></span> dest: /usr/share/nginx/html/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: Start NGiNX <span class="hljs-number"><span class="hljs-number">23</span></span> service: <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: nginx <span class="hljs-number"><span class="hljs-number">25</span></span> state: started</code> </pre> <br><h3>  Sum√°rio </h3><br>  Os scripts do Playbook s√£o uma maneira f√°cil e conveniente de fazer muitas coisas com um pouco de c√≥digo.  No exemplo acima, usamos tr√™s m√≥dulos - yum, modelo e servi√ßo, para instalar o reposit√≥rio e o pacote de software no servidor, criar um arquivo a partir do modelo local e iniciar o servi√ßo que acabou de ser instalado.  Ao mesmo tempo, nosso script do Playbook saiu um pouco mais do que esta oferta!  E, embora o rod√°ssemos em um host, ele tamb√©m poderia ser executado em dezenas e centenas de servidores; para isso, √© necess√°rio fazer apenas pequenas altera√ß√µes.  Al√©m disso, o Tower permite colocar um script do Playbook em um modelo de trabalho para executar em um grupo de servidores na nuvem da AWS ou em um data center corporativo. <br><br>  Os recursos arquiteturais poss√≠veis e a capacidade de integra√ß√£o com os sistemas de CI, como o Jenkins, automatizam n√£o apenas os processos de gerenciamento de configura√ß√£o, mas tamb√©m uma gama muito maior de tarefas de TI.  √â por isso que chamamos carinhosamente o Ansible de um sistema de orquestra√ß√£o integrado, e n√£o apenas uma ferramenta de gerenciamento de implanta√ß√£o e configura√ß√£o de software. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt412725/">https://habr.com/ru/post/pt412725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt412715/index.html">Aprendendo a programa√ß√£o Go multithread com fotos</a></li>
<li><a href="../pt412717/index.html">Ol√° alien√≠genas; por favor n√£o nos mate</a></li>
<li><a href="../pt412719/index.html">ODM anuncia concurso de s√≠ntese de fala</a></li>
<li><a href="../pt412721/index.html">Tr√™s esperan√ßas da humanidade para a descoberta de alien√≠genas</a></li>
<li><a href="../pt412723/index.html">Procurando uma nova cor de bilh√µes de d√≥lares</a></li>
<li><a href="../pt412727/index.html">Como escolher uma ferramenta para prototipagem em 2018?</a></li>
<li><a href="../pt412729/index.html">GDPR. √â necess√°rio realiz√°-lo na R√∫ssia?</a></li>
<li><a href="../pt412735/index.html">Sair do concurso ATM Alone no PHDays 8</a></li>
<li><a href="../pt412737/index.html">Prote√ß√£o de dados pessoais de 3 bilh√µes de pessoas - semelhan√ßas e diferen√ßas na legisla√ß√£o nos pa√≠ses do BRICS</a></li>
<li><a href="../pt412739/index.html">C√£o pastor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>