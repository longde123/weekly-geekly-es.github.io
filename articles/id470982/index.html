<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍🤝‍👨🏻 🧝🏼 🕵🏻 Analisis komitmen dan tarik permintaan di Travis CI, Buddy, dan AppVeyor menggunakan PVS-Studio 🕠 👧🏾 🐜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mulai dari versi 7.04, penganalisa PVS-Studio untuk bahasa C dan C ++ di Linux dan macOS menyediakan fitur uji untuk memeriksa daftar file yang ditent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analisis komitmen dan tarik permintaan di Travis CI, Buddy, dan AppVeyor menggunakan PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/470982/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac4/d08/0e7/ac4d080e7661626569ef514abe190662.png" alt="Gambar 11"></div><br>  Mulai dari versi 7.04, penganalisa PVS-Studio untuk bahasa C dan C ++ di Linux dan macOS menyediakan fitur uji untuk memeriksa daftar file yang ditentukan.  Dengan menggunakan mode baru, Anda dapat mengonfigurasikan penganalisis untuk memeriksa komit dan menarik permintaan.  Artikel ini mencakup pengaturan pemeriksaan file modifikasi tertentu dari proyek GitHub dalam sistem CI (Continuous Integration) yang populer, seperti Travis CI, Buddy, dan AppVeyor. <br><a name="habracut"></a><br><h2>  Mode memeriksa daftar file </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio</a> adalah alat yang dirancang untuk mendeteksi kesalahan dan kerentanan potensial dalam kode sumber program, ditulis dalam C, C ++, C # dan Java.  Bekerja di sistem 64-bit pada Windows, Linux dan macOS. <br><br>  Dalam versi PVS-Studio 7.04 untuk Linux dan macOS sekarang ada mode memeriksa daftar file.  Ini berfungsi untuk proyek-proyek, yang sistem pembangunannya memungkinkan menghasilkan file <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">compile_commands.json</a> .  Diperlukan agar penganalisa untuk mendapatkan informasi tentang kompilasi file tertentu.  Jika sistem build Anda tidak mendukung pembuatan file compile_commands.json, Anda dapat mencoba membuat file seperti itu menggunakan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bear</a> . <br><br>  Mode ini memeriksa daftar file juga dapat digunakan dengan compiler run tracing log yang dihasilkan oleh strace (pvs-studio-analyzer trace).  Untuk melakukannya, pertama-tama Anda harus menyelesaikan pembangunan proyek penuh dan lacak sehingga penganalisa mengumpulkan informasi lengkap tentang parameter kompilasi semua file yang diperiksa. <br><br>  Namun, opsi ini memiliki kelemahan yang signifikan - Anda harus melakukan penelusuran build penuh dari seluruh proyek dengan setiap proses, yang bertentangan dengan gagasan pengecekan komit cepat.  Atau jika Anda menyimpan hasil penelusuran itu sendiri, proses analisis selanjutnya mungkin tidak lengkap jika seandainya setelah melacak struktur perubahan dependensi file sumber (misalnya, #include baru ditambahkan di salah satu file sumber). <br><br>  Oleh karena itu, kami tidak menyarankan menggunakan mode memeriksa daftar file dengan tracing log untuk memeriksa komit atau menarik permintaan.  Jika Anda bisa melakukan pengembangan bertahap saat memeriksa komit, pertimbangkan untuk menggunakan mode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analisis tambahan</a> . <br><br>  Daftar file sumber untuk analisis disimpan dalam file teks dan diteruskan ke penganalisis menggunakan parameter <i>-S</i> : <br><br><pre><code class="bash hljs">pvs-studio-analyzer analyze ... -f build/compile_commands.json -S check-list.txt</code> </pre> <br>  File ini berisi path relatif dan absolut ke file di mana setiap file baru datang pada baris baru.  Anda dapat menentukan nama file untuk analisis dan teks yang berbeda.  Sedangkan untuk teks, penganalisa akan melihat bahwa itu bukan nama file dan akan mengabaikan baris.  Mungkin bermanfaat untuk berkomentar jika file ditentukan secara manual.  Namun, seringkali daftar file akan dihasilkan selama analisis CI, misalnya, dapat berupa file dari komit atau permintaan tarik. <br><br>  Sekarang menggunakan mode ini Anda dapat dengan cepat memeriksa kode baru sebelum masuk ke cabang pengembangan utama.  <i>Bendera --indicate-warnings</i> telah ditambahkan di utilitas <i>plog-converter</i> sehingga sistem pemeriksaan merespons keberadaan peringatan penganalisa. <br><br><pre> <code class="bash hljs">plog-converter ... --indicate-warnings ... -o /path/to/report.tasks ...</code> </pre> <br>  Dengan tanda ini, konverter akan mengembalikan kode bukan nol jika ada peringatan dalam laporan analisa.  Anda dapat memblokir hook pra-komit, melakukan atau menarik permintaan dan menampilkan laporan analisa yang dihasilkan, membagikan atau mengirimkannya melalui pos. <br><br>  <i>Catatan</i>  <i>Selama analisis pertama dari daftar file, seluruh proyek akan diperiksa, karena penganalisa harus menghasilkan file dengan dependensi file sumber proyek dari file header.</i>  <i>Ini adalah kekhasan analisis file C dan C ++.</i>  <i>Di masa depan, file dependensi ini dapat di-cache dan akan diperbarui secara otomatis oleh penganalisa.</i>  <i>Keuntungan memeriksa komit menggunakan mode memeriksa daftar file di atas mode analisis tambahan adalah fakta bahwa Anda harus melakukan cache hanya file ini, bukan file objek.</i> <br><br><h2>  Prinsip umum analisis permintaan tarik </h2><br>  Keseluruhan analisis proyek membutuhkan banyak waktu, jadi masuk akal untuk memeriksa hanya sebagian saja.  Masalahnya adalah Anda harus memisahkan file baru dari sisa file proyek. <br><br>  Mari kita lihat contoh pohon komit dua cabang: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/722/646/68c/72264668c4a90b96ccb63f363a46c683.png" alt="Gambar 5"></div><br><br>  Bayangkan komit <i>A1</i> berisi kode dalam jumlah cukup besar yang sudah diperiksa.  Sebelumnya, kami telah membuat cabang dari komit <i>A1</i> dan mengubah beberapa file. <br><br>  Tentu saja, Anda telah memperhatikan bahwa setelah <i>A1</i> dua komit lainnya terjadi, dan dua cabang lainnya bergabung, karena kami tidak berkomitmen pada <i>master</i> .  Inilah saatnya ketika <i>perbaikan terbaru</i> siap.  Itu sebabnya kami mendapat permintaan tarik untuk penggabungan <i>B3</i> dan <i>A3</i> . <br><br>  Kami dapat memeriksa hasil penggabungan mereka, tetapi akan terlalu lama dan tidak masuk akal, karena hanya beberapa file yang telah dimodifikasi.  Oleh karena itu, lebih efisien untuk menganalisis hanya yang berubah. <br><br>  Untuk melakukannya, kami akan menerima perbedaan antara cabang, berada di KEPALA cabang, dari mana kami ingin bergabung menjadi master: <br><br><pre> <code class="bash hljs">git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list</code> </pre> <br>  Kami akan mempertimbangkan <i>$ MERGE_BASE</i> secara detail nanti.  Faktanya adalah bahwa tidak setiap layanan CI menyediakan informasi yang diperlukan di pangkalan gabungan, jadi setiap kali kita harus memikirkan cara-cara baru untuk mendapatkan data ini.  Ini akan dipertimbangkan secara terperinci di bawah ini untuk masing-masing layanan web yang dijelaskan. <br><br>  Jadi kami mendapat perbedaan antara cabang, yang merupakan daftar nama file yang dimodifikasi.  Sekarang kita perlu memberi makan file <i>.pvs-pr.list ini</i> ke penganalisa.  Kami telah mengarahkan ulang output ke sana sebelumnya. <br><br><pre> <code class="bash hljs">pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list</code> </pre> <br>  Setelah analisis, kita perlu mengkonversi file log (PVS-Studio.log) menjadi format yang mudah digunakan: <br><br><pre> <code class="bash hljs">plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Perintah ini akan menampilkan daftar kesalahan dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">stderr</a> (aliran kesalahan standar). <br><br>  Tangkapannya adalah kita tidak hanya perlu menampilkan kesalahan, tetapi juga melaporkan layanan build dan test kami tentang masalah tersebut.  Untuk melakukan ini, <i>flag</i> <i>-W</i> ( <i>--indicate-warning</i> ) telah ditambahkan di konverter.  Jika setidaknya ada satu penganalisa peringatan, kode pengembalian utilitas <i>plog-converter</i> akan berubah menjadi 2, yang pada gilirannya akan melaporkan layanan CI tentang potensi kesalahan dalam file permintaan tarik. <br><br><h2>  Travis ci </h2><br>  Konfigurasi dibuat dalam bentuk file <i>.travis.yml</i> .  Untuk kenyamanan, saya menyarankan Anda untuk mengisolasi semua perintah yang terkait dengan PVS-Studio dalam skrip bash terpisah dengan fungsi yang akan dipanggil dari file <i>.travis.yml</i> ( <i>bash script_name.sh function_name</i> ). <br><br>  Dengan memperluas skrip, Anda akan mendapatkan lebih banyak fungsi.  Di bagian <i>instal,</i> tulis yang berikut ini: <br><br><pre> <code class="xml hljs">install: - bash .travis.sh travis_install</code> </pre> <br>  Jika Anda memiliki beberapa instruksi, Anda dapat memindahkannya dalam skrip, setelah menghapus tanda hubung. <br><br>  Buka file <i>.travis.sh</i> dan tambahkan instalasi analyzer di fungsi <i>travis_install ()</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_install</span></span></span></span>() { wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update -qq sudo apt-get install -qq pvs-studio }</code> </pre> <br>  Sekarang mari kita tambahkan penganalisis yang dijalankan di bagian <i>skrip</i> : <br><br><pre> <code class="xml hljs">script: - bash .travis.sh travis_script</code> </pre> <br>  Dan dalam skrip bash: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TRAVIS_PULL_REQUEST</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"false"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> git diff --name-only origin/HEAD &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w }</code> </pre> <br>  Anda harus menjalankan kode ini setelah membangun proyek, misalnya, jika Anda memiliki build di CMake: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { CMAKE_ARGS=<span class="hljs-string"><span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CMAKE_ARGS}</span></span></span><span class="hljs-string">"</span></span> cmake <span class="hljs-variable"><span class="hljs-variable">$CMAKE_ARGS</span></span> CMakeLists.txt make -j8 }</code> </pre> <br>  Anda akan mendapatkan yang berikut ini: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { CMAKE_ARGS=<span class="hljs-string"><span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CMAKE_ARGS}</span></span></span><span class="hljs-string">"</span></span> cmake <span class="hljs-variable"><span class="hljs-variable">$CMAKE_ARGS</span></span> CMakeLists.txt make -j8 pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TRAVIS_PULL_REQUEST</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"false"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> git diff --name-only origin/HEAD &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w }</code> </pre> <br>  Kemungkinan besar, Anda sudah memperhatikan variabel lingkungan <i>$ TRAVIS_PULL_REQUEST</i> dan <i>$ TRAVIS_BRANCH</i> .  Travis CI menyatakannya sendiri: <br><br><ul><li>  <i>$ TRAVIS_PULL_REQUEST</i> menyimpan nomor permintaan tarik atau <i>salah</i> jika itu cabang biasa; </li><li>  <i>$ TRAVIS_REPO_SLUG</i> menyimpan nama repositori proyek. </li></ul><br>  Berikut algoritma operasional dari fungsi ini: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebe/643/58b/ebe64358b6f4cc73db5d4b0094919faa.png" alt="Gambar 13"></div><br>  Travis CI merespons kode kembali, sehingga keberadaan peringatan akan melaporkan layanan untuk menandai komit sebagai berisi kesalahan. <br><br>  Sekarang mari kita lihat lebih dekat pada baris kode ini: <br><pre> <code class="bash hljs">git diff --name-only origin/HEAD &gt; .pvs-pr.list</code> </pre> <br>  Faktanya adalah bahwa Travis CI secara otomatis menggabungkan cabang ketika menganalisis permintaan tarik: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/443/986/1f4/4439861f46637d41119e83f83e2e440b.png" alt="Gambar 8"></div><br>  Itu sebabnya kami menganalisis <i>A4</i> , bukan <i>B3-&gt; A3</i> .  Karena kekhasan ini, kita perlu mengevaluasi perbedaannya dengan <i>A3</i> , yang merupakan kepala cabang dari <i>asal</i> . <br><br>  Satu detail penting tetap - caching dependensi file header dari unit terjemahan yang dikompilasi (* .c, * .cc, * .cpp dan lainnya).  Penganalisis mengevaluasi dependensi ini selama menjalankan pertama dalam mode memeriksa daftar file dan kemudian menyimpannya dalam direktori .PVS-Studio.  Travis CI memungkinkan repositori caching, jadi kami akan menyimpan data di <i>direktori .PVS-Studio /</i> : <br><br><pre> <code class="xml hljs">cache: directories: - .PVS-Studio/</code> </pre> <br>  Kode ini harus ditambahkan dalam file <i>.travis.yml</i> : Direktori ini menyimpan berbagai data, dikumpulkan setelah analisis.  Data ini secara signifikan mempercepat proses selanjutnya dari analisis daftar file atau analisis tambahan.  Jika Anda tidak melakukannya, penganalisa akan menganalisis semua file setiap saat. <br><br><h2>  Sobat </h2><br>  Sama seperti Travis CI, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Buddy</a> memungkinkan Anda membangun dan menguji proyek dari GitHub secara otomatis.  Tidak seperti Travis CI, ini dikonfigurasi dalam antarmuka web (dukungan bash tersedia), sehingga tidak perlu menyimpan file konfigurasi dalam proyek. <br><br>  Pertama, kita perlu menambahkan langkah baru ke dalam pipa: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75e/2fd/36e/75e2fd36e9a4420ff74256429ff73e0c.gif" alt="Gambar 1"></div><br>  Mari kita tentukan kompiler yang digunakan untuk membangun proyek.  Perhatikan wadah buruh pelabuhan, dipasang pada langkah ini.  Misalnya, ada wadah khusus untuk GCC: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95b/837/7ad/95b8377adbac7e50e55d97c5b318f56c.png" alt="Gambar 6"></div><br>  Sekarang mari kita instal PVS-Studio dan utilitas yang diperlukan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/fba/02b/88efba02b5a4c34f55c4344744812cc7.gif" alt="Gambar 2"></div><br>  Tambahkan baris berikut ke editor: <br><br><pre> <code class="bash hljs">apt-get update &amp;&amp; apt-get -y install wget gnupg jq wget -q -O - https://files.viva64.com/etc/pubkey.txt | apt-key add - wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list apt-get update &amp;&amp; apt-get -y install pvs-studio</code> </pre> <br>  Mari beralih ke tab Jalankan (ikon pertama) dan tambahkan kode berikut ke bidang editor yang sesuai: <br><pre> <code class="bash hljs">pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${BUDDY_REPO_SLUG}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Jika Anda membaca bagian tentang Travs-CI, kode ini tidak asing bagi Anda.  Tapi di sini ada langkah baru: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7a/c65/3e3/a7ac653e3e89c4fc2a2b425b1ccefec8.png" alt="Gambar 14"></div><br>  Faktanya adalah bahwa sekarang kami menganalisis bukan hasil penggabungan, tetapi KEPALA cabang dengan permintaan tarik dicentang: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/722/646/68c/72264668c4a90b96ccb63f363a46c683.png" alt="Gambar 10"></div><br>  Jadi kita berada dalam komit <i>B3</i> dan kita perlu mendapatkan perbedaan dengan <i>A3</i> : <br><br><pre> <code class="bash hljs">PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${BUDDY_REPO_SLUG}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list</code> </pre> <br>  Untuk mendefinisikan <i>A3</i> mari kita gunakan API GitHub: <br><br><pre> <code class="bash hljs">https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${USERNAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${REPO}</span></span>/pulls/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span></code> </pre> <br>  Kami menggunakan variabel-variabel berikut, yang disediakan oleh Sobat: <br><br><ul><li>  <i>$ BUDDY_EXECUTION_PULL_REQEUST_NO</i> - jumlah permintaan tarik; </li><li>  <i>$ BUDDY_REPO_SLUG</i> - kombinasi nama pengguna dan repositori (misalnya, maks / uji). </li></ul><br>  Sekarang mari kita simpan perubahan, menggunakan tombol di bawah ini dan aktifkan analisis permintaan tarik: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74c/5d6/876/74c5d6876c07c0b2e0c10cdabb8b0f78.gif" alt="Gambar 3"></div><br>  Tidak seperti Travis CI, kami tidak perlu menentukan <i>.pvs-studio</i> untuk caching, karena Buddy secara otomatis menyimpan semua file untuk proses selanjutnya.  Jadi hal terakhir yang tersisa adalah menyimpan login dan kata sandi untuk PVS-Studio di Buddy.  Setelah menyimpan perubahan, kami akan kembali ke Pipeline.  Kita perlu beralih ke pengaturan variabel dan masukkan login dan kunci untuk PVS-Studio: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb1/816/e3e/eb1816e3e4aff72ad55b187ec1ebf0a2.gif" alt="Gambar 4"></div><br>  Setelah ini, cek akan dimulai dengan setiap permintaan tarik baru atau komit.  Jika komit berisi kesalahan, Buddy akan menunjukkannya di halaman permintaan tarik. <br><br><h2>  Pengantar </h2><br>  Pengaturan AppVeyor mirip dengan Sobat, karena semuanya terjadi di antarmuka web dan tidak perlu menambahkan file * .yml di repositori proyek. <br><br>  Mari kita pergi ke tab Pengaturan di ulasan proyek: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f11/2fc/576/f112fc576fc1f8bf7552625578093292.png" alt="Gambar 12"></div><br>  Gulir halaman ini ke bawah dan aktifkan penyimpanan cache untuk pembuatan permintaan tarik: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/8f3/f34/be88f3f34708075a49bdd13c65f5bc26.png" alt="Gambar 18"></div><br><br>  Sekarang mari kita beralih ke tab Lingkungan, di mana kita akan menentukan gambar untuk variabel lingkungan yang diperlukan dan dibangun: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/453/26a/80c/45326a80c62211c6b29bd16fad1ef0d1.png" alt="Gambar 19"></div><br>  Jika Anda sudah membaca bagian sebelumnya, Anda sudah terbiasa dengan dua variabel ini - <i>PVS_KEY</i> dan <i>PVS_USERNAME</i> .  Jika tidak, izinkan saya mengingatkan Anda bahwa mereka diperlukan untuk memeriksa lisensi penganalisa PVS-Studio.  Di masa depan, kita akan bertemu mereka lagi dalam skrip Bash. <br><br>  Pada halaman yang sama di bagian bawah, mari kita tentukan folder cache: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e2/967/dbf/4e2967dbfb796e2d0104d5b6539be65a.png" alt="Gambar 15"></div><br>  Jika kami tidak melakukannya, kami akan menganalisis seluruh proyek alih-alih beberapa file, tetapi akan menerima output untuk file yang ditentukan.  Jadi, penting untuk memasukkan nama repositori yang benar. <br><br>  Sekarang waktunya telah tiba untuk naskah pemeriksaan.  Buka tab Tes dan pilih Script: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5f/dbd/0d6/b5fdbd0d6d448174bc05222fe1965c1c.png" alt="Gambar 20"></div><br>  Kode berikut harus dimasukkan ke dalam formulir ini: <br><br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get -y install jq wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update &amp;&amp; sudo apt-get -y install pvs-studio pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> PWD=$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> -L) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ --dump-files --dump-log pvs-dump.log \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Mari kita perhatikan bagian kode berikut: <br><br><pre> <code class="bash hljs">PWD=$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> -L) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ --dump-files --dump-log pvs-dump.log \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  Ini adalah tugas yang cukup spesifik dari nilai output perintah pwd ke variabel, yang harus menyimpan nilai ini secara default.  Awalnya tampak aneh, tapi izinkan saya menjelaskan semuanya. <br><br>  Saat menyiapkan penganalisis di AppVeyor, saya menemukan perilaku penganalisa yang sangat aneh.  Di satu sisi, semuanya bekerja dengan benar, tetapi analisisnya tidak dimulai.  Butuh banyak waktu untuk memperhatikan bahwa kami berada di direktori / home / appveyor / proyek / testcalc /, sedangkan analis yakin bahwa kami berada di / opt / appveyor / build-agent /.  Pada saat itu saya menyadari bahwa variabel $ PWD adalah tipu.  Untuk alasan ini, saya secara manual memperbarui nilainya sebelum menjalankan analisis. <br><br>  Urutan tindakan selanjutnya sama dengan sebelumnya: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a99/1be/5b1/a991be5b13dd4e17ccb9cb47e4f48cf2.png" alt="Gambar 16"></div><br>  Sekarang lihat fragmen ini: <br><br><pre> <code class="bash hljs">PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>`</code> </pre> <br>  Di dalamnya kita mendapatkan perbedaan antara cabang, terkait dengan permintaan tarik dicentang.  Untuk melakukan ini, kita memerlukan variabel lingkungan berikut: <br><br><ul><li>  $ APPVEYOR_PULL_REQUEST_NUMBER - tarik nomor permintaan; </li><li>  $ APPVEYOR_REPO_NAME - nama pengguna dan repositori proyek. </li></ul><br><h2>  Kesimpulan </h2><br>  Yah, kami belum mempertimbangkan semua layanan integrasi berkesinambungan yang mungkin, namun, mereka semua memiliki spesifikasi operasional yang serupa.  Tetapi untuk caching, setiap layanan menemukan kembali rodanya sendiri, sehingga selalu berbeda. <br><br>  Dalam beberapa kasus (seperti dalam Travis-CI) dibutuhkan beberapa baris kode - dan caching berfungsi dengan sempurna.  Dalam kasus lain (seperti pada AppVeyor), Anda hanya perlu menentukan direktori dalam pengaturan.  Tetapi ada beberapa layanan, di mana Anda perlu membuat kunci khusus dan mencoba meyakinkan sistem untuk memberi Anda kesempatan untuk menulis ulang fragmen yang di-cache.  Karenanya, jika Anda ingin mengonfigurasi analisis permintaan tarik pada layanan integrasi berkelanjutan, yang tidak dipertimbangkan di atas, pertama-tama, pastikan Anda tidak akan mengalami masalah dengan caching. <br><br>  Terima kasih atas perhatian anda  Jika sesuatu tidak berhasil, Anda dapat dengan aman menulis surat kepada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dukungan</a> kami.  Kami akan memberi Anda petunjuk dan bantuan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id470982/">https://habr.com/ru/post/id470982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id470966/index.html">Kata Sandi Unix Ken Thompson</a></li>
<li><a href="../id470974/index.html">DNS pasif di tangan analis</a></li>
<li><a href="../id470976/index.html">Song of Ice (Bloody Enterprise) dan Flames (DevOps and IaC)</a></li>
<li><a href="../id470978/index.html">Riset pasar analis: di mana mereka belajar, alat apa yang mereka gunakan dan berapa banyak yang mereka hasilkan</a></li>
<li><a href="../id470980/index.html">Tugas yang diselesaikan robot perangkat lunak (RPA) di sektor perbankan</a></li>
<li><a href="../id470984/index.html">Analisis komitmen dan permintaan tarik di Travis CI, Buddy dan AppVeyor menggunakan PVS-Studio</a></li>
<li><a href="../id470988/index.html">Pendaftaran terbuka untuk Slerm DevOps di Moskow</a></li>
<li><a href="../id470990/index.html">Perangkat pemasaran online: 3 Aplikasi untuk meningkatkan komunikasi visual</a></li>
<li><a href="../id470994/index.html">JavaScript Pewarisan dari Sudut Pandang Seorang Nerd yang Bosan: Pabrik Konstruktor</a></li>
<li><a href="../id470996/index.html">Bagaimana tag <img> sederhana bisa menjadi risiko tinggi untuk bisnis?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>