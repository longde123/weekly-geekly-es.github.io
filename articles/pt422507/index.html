<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª üíæ üë©üèª PHP 7.3. Novidades ü¶Ö üèá üîì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sintaxe 


1. Suavizar os requisitos de sintaxe Heredoc e Nowdoc 
2. Suporte para v√≠rgulas √† direita em chamadas de fun√ß√£o e m√©todo 
3. Links na list(...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP 7.3. Novidades</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422507/"><p><img src="https://habrastorage.org/webt/qb/0s/qb/qb0sqbtbsney4hzc4erkjjqo0ki.png"></p><br><h1 id="sintaksis">  Sintaxe </h1><br><ol><li>  Suavizar os requisitos de sintaxe Heredoc e Nowdoc </li><li>  Suporte para v√≠rgulas √† direita em chamadas de fun√ß√£o e m√©todo </li><li> Links na <code>list()</code> </li></ol><br><h1 id="ustarevshie-vozmozhnosti-deprecated">  Recursos preteridos (preteridos) </h1><br><ol><li>  <code>image2wbmp()</code> descontinuada </li><li>  Os sinalizadores <code>FILTER_FLAG_SCHEME_REQUIRED</code> e <code>FILTER_FLAG_HOST_REQUIRED</code> ao usar <code>FILTER_VALIDATE_URL</code> </li><li>  Registrar constantes independentes obsoletas </li></ol><br><h1 id="novye-vozmozhnosti">  Novos recursos </h1><br><ol><li>  Lan√ßamento de exce√ß√£o opcional para erros nas <code>json_decode</code> <code>json_encode</code> e <code>json_decode</code> </li><li>  Adicionando a fun√ß√£o <code>is_countable()</code> </li><li>  Adicionando as fun√ß√µes <code>array_key_first()</code> e <code>array_key_last()</code> <a name="habracut"></a></li></ol><br><h1 id="izmeneniya">  Altera√ß√µes </h1><br><ol><li>  Migrando do PCRE para o PCRE2 </li></ol><br><h2 id="smyagchenie-trebovaniy-k-sintaksisu-heredoc-i-nowdoc">  Suavizar os requisitos de sintaxe Heredoc e Nowdoc </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Heredoc</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nowdoc</a> exigiram colocar o identificador de fechamento em primeiro lugar em uma nova linha. </p><br><p>  Um exemplo: </p><br><pre> <code class="php hljs">$foo = &lt;&lt;&lt;IDENTIFIER the crazy dog jumps over the lazy fox <span class="hljs-string"><span class="hljs-string">"foo"</span></span> bar; IDENTIFIER</code> </pre> <br><p>  Aqui, o <code>IDENTIFIER</code> fechamento <em>deve</em> ser o primeiro caractere da nova linha para que isso funcione.  Al√©m disso, n√£o deve haver outros caracteres ap√≥s o identificador de fechamento (exceto <code>;</code> que √© opcional). </p><br><p>  O RFC para PHP 7.3 sugere a remo√ß√£o desses requisitos para melhorar a legibilidade do c√≥digo.  Primeiro de tudo, para adicionar recuo ao usar identificadores <code>heredoc/nowdoc</code> . </p><br><p>  Lista completa de altera√ß√µes na sintaxe <code>heredoc/nowdoc</code> : </p><br><ol><li>  O identificador de fechamento n√£o precisa ser o primeiro caractere na sequ√™ncia. </li><li>  O identificador de fechamento √© recuado com espa√ßos ou tabula√ß√µes. </li><li>  Recuo (espa√ßos ou tabula√ß√µes) n√£o deve ser misturado.  Se voc√™ fizer isso, receber√° o <code>Parse error: Invalid indentation - tabs and spaces cannot be mixed in .. on line ..</code> </li><li>  O n√∫mero exato de espa√ßos / guias usados ‚Äã‚Äãantes do identificador de fechamento ser√° removido de cada linha da express√£o <code>heredoc/nowdoc</code> . </li><li>  Se o n√∫mero de caracteres de indenta√ß√£o usados ‚Äã‚Äãantes do identificador de fechamento for maior do que em qualquer uma das linhas da express√£o, voc√™ receber√° um <code>Parse error: Invalid body indentation level (expecting an indentation level of at least ..) in .. on line ..</code> </li><li>  v√°rias express√µes ap√≥s o identificador de fechamento funcionar√° sem erros </li></ol><br><p>  Aqui est√° um trecho que tira proveito dos novos recursos sem violar novas regras: </p><br><pre> <code class="php hljs">$foo = [<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>, &lt;&lt;&lt;EOT baz - hello world! -- ahoy EOT, <span class="hljs-string"><span class="hljs-string">'qux'</span></span>, <span class="hljs-string"><span class="hljs-string">'quux'</span></span> ]; var_dump($foo);</code> </pre> <br><p>  A sa√≠da ser√°: </p><br><pre> <code class="plaintext hljs">array(5) {        [0]=&gt;           string(3) "foo" [1]=&gt;           string(3) "bar" [2]=&gt;           string(29) "baz - hello world! -- ahoy" [3]=&gt; string(3) "qux" [4]=&gt; string(4) "quux" }     `</code> </pre> <br><p>  Observe que o recuo usado na declara√ß√£o usando <code>heredoc</code> n√£o <code>heredoc</code> exibido na sa√≠da de <code>var_dump()</code> e continuamos a listar os elementos da matriz ap√≥s o identificador <code>EOT</code> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  At√© voc√™ usar um conjunto de identificadores de caracteres <code>heredox/nowdoc</code> id√™nticos ao in√≠cio de uma linha, voc√™ estar√° em um cavalo. </p><br><pre> <code class="php hljs">$foo = &lt;&lt;&lt;HELLO HELLO_WORLD &lt;--         HELLOWORLD &lt;--     HELLO WORLD &lt;--    HELLO;</code> </pre> <br><p>  Se voc√™ tem <code>heredoc/nowdoc</code> sintaxe <code>heredoc/nowdoc</code> semelhante √† descrita acima, observo que, com o PHP 7.3, o PHP aceitar√° o primeiro literal <code>HELLO</code> e lan√ßar√° um erro na pr√≥xima linha.  Nas vers√µes anteriores, o <code>HELLO WORLD</code> n√£o <code>HELLO WORLD</code> percebido como um identificador final para o heredoc.  Obrigado <em>/ u / ImSuperObjective2</em> com reddit por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">apontar isso</a> </p><br><h2 id="podderzhka-konechnyh-zapyatyh-v-vyzovah-funkciy-i-metodov">  Suporte para v√≠rgulas √† direita em chamadas de fun√ß√£o e m√©todo </h2><br><p>  Essa √© uma altera√ß√£o simples que permite o uso de v√≠rgulas finais em <em>chamadas</em> e m√©todos de fun√ß√£o.  Isso n√£o afeta a declara√ß√£o. </p><br><p>  Por exemplo, a seguinte sintaxe ser√° poss√≠vel: </p><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  foo('bar', 'baz',); //        'baz'</span></span></code> </pre> <br><p>  Nas vers√µes anteriores ao PHP-7.3, o snippet acima gera um <code>PHP Parse error: syntax error, unexpected ')' in .. on line ..</code> </p><br><p>  Voc√™ n√£o pode usar mais de uma v√≠rgula no final ou v√≠rgulas para pular argumentos.  Isso √© principalmente uma altera√ß√£o para uma fun√ß√£o com par√¢metros vari√°veis.  Tamb√©m com novas edi√ß√µes, a sintaxe da matriz parecer√° mais consistente. </p><br><p>  Observe que voc√™ n√£o pode usar esse recurso nas declara√ß√µes de fun√ß√£o / m√©todo;  isto est√° errado: </p><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($bar, $baz, )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// nah, you can't do this. }</span></span></code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-1">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Nada.  O c√≥digo existente continuar√° funcionando.  Se voc√™ tiver chamadas de fun√ß√£o que aceitem par√¢metros vari√°veis, adicione v√≠rgulas √† direita nesses locais por conveni√™ncia.  Mas us√°-los em todos os lugares √© obviamente demais. </p><br><h2 id="ssylki-v-list">  Links na <code>list()</code> </h2><br><p>  A fun√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>list()</code></a> √© √∫til para atribuir valores rapidamente a vari√°veis ‚Äã‚Äãde uma matriz.  Antes do PHP 7.3, n√£o era poss√≠vel especificar uma vari√°vel por refer√™ncia.  Antes do PHP 7.3, o seguinte trecho levava a um erro fatal: </p><br><pre> <code class="php hljs">$arr = [<span class="hljs-string"><span class="hljs-string">'apple'</span></span>, <span class="hljs-string"><span class="hljs-string">'orange'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($a, &amp;$b) = $arr; $b = <span class="hljs-string"><span class="hljs-string">'banana'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $arr[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// Fatal error: [] and list() assignments cannot be by reference in .. on line ..</span></span></code> </pre> <br><p>  √â imposs√≠vel referir-se a vari√°veis <code>non-referencable</code> : <code>list($a, &amp;$b) = [12, 14];</code>  dar√° <code>Fatal error: Cannot assign reference to non referencable value in .. on line ..</code> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-2">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  N√£o.  Em vez de usar <code>list()</code> para preencher v√°rias vari√°veis, sugiro que voc√™ use objetos de valor para simplificar as coisas.  Eles ainda ser√£o passados ‚Äã‚Äãpor refer√™ncia, mas tornar√£o seu c√≥digo muito mais limpo. </p><br><h2 id="funkciya-image2wbmp-obyavlena-ustarevshey">  <code>image2wbmp()</code> descontinuada </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>image2wbmp()</code></a> fun√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>image2wbmp()</code></a> da extens√£o GD √© usada para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>image2wbmp()</code></a> imagens no formato WBMP (Wireless Bitmap).  No PHP 7.3, ele √© preterido em favor da fun√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>imagewbmp()</code></a> . </p><br><p>  Se voc√™ usar <code>image2wbmp()</code> , substitua o nome da fun√ß√£o por <code>imagewbmp</code> e tudo ficar√° bem!  Mais de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>5,500  image2wbmp()</code></a> no github e mais de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>39,300  imagewbmp()</code></a> .  Parece que a equipe de desenvolvimento do PHP est√° retirando recursos menos usados ‚Äã‚Äãpara minimizar o impacto. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-3">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Se voc√™ usar a fun√ß√£o <code>image2wbmp()</code> , substitua a chamada por <code>imagewbmp</code> .  Aproveite a automa√ß√£o que pode mudar isso para voc√™. </p><br><h2 id="flagi-filter_flag_scheme_required-i-filter_flag_host_required-pri-ispolzovanii-filter_validate_url-obyavleny-ustarevshimi">  Os sinalizadores <code>FILTER_FLAG_SCHEME_REQUIRED</code> e <code>FILTER_FLAG_HOST_REQUIRED</code> ao usar <code>FILTER_VALIDATE_URL</code> </h2><br><p>  Este √© um movimento para a frente.  Quando voc√™ usa <code>filter_var($var, FILTER_VALIDATE_URL)</code> , h√° dois sinalizadores adicionais que podem ser configurados para garantir uma verifica√ß√£o rigorosa da URL: <code>FILTER_FLAG_SCHEME_REQUIRED</code> e <code>FILTER_FLAG_HOST_REQUIRED</code> . <br>  A partir do PHP 5.2.1, esses dois sinalizadores s√£o aplicados implicitamente, independentemente de estarem definidos ou n√£o. </p><br><p>  Se o seu c√≥digo usar esses sinalizadores, exclua-os e tudo ficar√° bem.  Atualmente, existem mais de 5.000 resultados de pesquisa no github usando-os. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-4">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Como esses dois sinalizadores foram descontinuados, voc√™ ver√° uma notifica√ß√£o como: </p><br><pre> <code class="plaintext hljs">Deprecated: filter_var(): explicit use of FILTER_FLAG_SCHEME_REQUIRED and FILTER_FLAG_HOST_REQUIRED is deprecated in ...</code> </pre> <br><p>  Tudo o que voc√™ precisa fazer √© remover as duas bandeiras, como  eles <code>FILTER_VALIDATE_URL</code> est√£o impl√≠citos ao usar <code>FILTER_VALIDATE_URL</code> . </p><br><h2 id="registro-nezavisimye-konstanty-obyavleny-ustarevshimi">  Registrar constantes independentes obsoletas </h2><br><p>  A fun√ß√£o <code>define()</code> permite declarar uma constante no modo que n√£o diferencia mai√∫sculas de min√∫sculas.  Voc√™ deve declarar explicitamente uma constante com distin√ß√£o entre mai√∫sculas e min√∫sculas passando o terceiro par√¢metro da fun√ß√£o <code>true</code> .  Esse n√£o √© o comportamento padr√£o e provavelmente n√£o √© consistente com a capacidade de declarar constantes por meio da palavra-chave <code>const</code> . </p><br><pre> <code class="php hljs">define(<span class="hljs-string"><span class="hljs-string">'Foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'Bar'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br><p>  O c√≥digo acima lan√ßar√° uma notifica√ß√£o de obsolesc√™ncia: Descontinuado: <code>Deprecated: define(): Declaration of case-insensitive constants is deprecated in ...</code> </p><br><p>  Al√©m disso, ao tentar acessar constantes declaradas no <code>Deprecated: Case-insensitive constants are deprecated. The correct casing for this constant is "Foo"</code> ( <code>FOO</code> ), voc√™ ver√° um aviso bastante √∫til: <code>Deprecated: Case-insensitive constants are deprecated. The correct casing for this constant is "Foo"</code> <code>Deprecated: Case-insensitive constants are deprecated. The correct casing for this constant is "Foo"</code> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-5">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Voc√™ ter√° que ir para o c√≥digo base, onde constantes independentes de registro s√£o declaradas e subsequentemente corretas.  √â extremamente improv√°vel que haja problemas com isso, porque √© bastante trabalhoso capturar todos os casos de uso, mas, como resultado, o c√≥digo se tornar√° mais claro. </p><br><p>  N√£o encontrei nenhum exemplo desse uso no github, mas pelo menos o Drupal e o WordPress (dois projetos PHP bastante antigos e maduros) t√™m constantes que n√£o diferenciam mai√∫sculas de min√∫sculas. </p><br><h2 id="opcionalnyy-vybros-isklyucheniy-pri-oshibkah-v-funkciyah-json_encode-i-json_decode">  Lan√ßamento de exce√ß√£o opcional para erros nas <code>json_decode</code> <code>json_encode</code> e <code>json_decode</code> </h2><br><p>  Um dos meus favoritos.  Por todos esses anos, <code>json_encode()</code> e <code>json_decode()</code> sil√™ncio quanto a erros em vari√°veis ‚Äã‚ÄãPHP ou strings json, o que levou ao c√≥digo que foi marcado.  Este caso foi at√© na famosa cr√≠tica do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PHP: um fractal de design deficiente</a> . </p><br><blockquote>  <code>json_decode</code> retorna nulo para entrada inv√°lida, enquanto nulo √© um objeto absolutamente verdadeiro para JSON decodificado.  Essa fun√ß√£o n√£o √© confi√°vel, a menos que voc√™ chame <code>json_last_error</code> toda vez que a usar. </blockquote><p>  Levou 6 anos ap√≥s a publica√ß√£o no blog e tivemos a oportunidade de receber um erro sobre falhas do json: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { json_decode(<span class="hljs-string"><span class="hljs-string">"{"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>, JSON_THROW_ON_ERROR); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (\JsonException $exception) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $exception-&gt;getMessage(); <span class="hljs-comment"><span class="hljs-comment">//  "Syntax error" }</span></span></code> </pre> <br><p>  O novo <code>\JsonException</code> √© um descendente de <code>\Exception</code> , bem como a constante <code>JsonException</code> e a pr√≥pria <code>JsonException</code> est√£o no espa√ßo de nomes global. </p><br><p>  Eu recomendo que voc√™ comece a usar esse recurso.  Existem bibliotecas de terceiros, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daverandom / exception-json</a> , que implementam funcionalidades semelhantes para as vers√µes 7.2 e inferiores do PHP.  Com a apar√™ncia dessa fun√ß√£o no n√∫cleo do PHP, voc√™ pode remover este pacote e toneladas de c√≥digo de modelo feio com a chamada <code>json_last_error()</code> em todos os lugares onde voc√™ trabalha com o json. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-6">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Nada se voc√™ n√£o estiver usando sua pr√≥pria exce√ß√£o e / ou constante com os mesmos nomes. </p><br><h2 id="dobavlenie-funkcii-is_countable">  Adicionando a fun√ß√£o <code>is_countable()</code> </h2><br><p>  O PHP 7.2 possui muitas fun√ß√µes obsoletas e com erros.  Se voc√™ estiver no PHP 7.2.  call <code>count()</code> usando uma vari√°vel n√£o- <code>countable</code> , o PHP exibir√° um aviso sobre isso.  Nas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">edi√ß√µes gerais,</a> havia uma proposta para verificar a vari√°vel resultante como <code>countable</code> antes de us√°-la em <code>count()</code> . </p><br><p>  <code>countable</code> -variable √© uma matriz ou objeto que implementa a interface <code>\Countable</code> .  Como muitos c√≥digos padr√£o ser√£o usados ‚Äã‚Äãdurante a verifica√ß√£o, o PHP 7.3 introduziu uma nova fun√ß√£o <code>is_countable()</code> , que verifica a vari√°vel quanto a ... bem ... a possibilidade de usar <code>count()</code> . </p><br><p>  Eu escrevi um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">polyfile para is__countable ()</a> se voc√™ deseja come√ßar a usar esse recurso agora. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-7">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  At√© que sua pr√≥pria fun√ß√£o <code>is_countable()</code> seja <code>is_countable()</code> , n√£o haver√° problemas. </p><br><h2 id="dobavlenie-funkciy-array_key_first-i-array_key_last">  Adicionando as fun√ß√µes <code>array_key_first()</code> e <code>array_key_last()</code> </h2><br><p>  No PHP, existem 75 fun√ß√µes diferentes para trabalhar com matrizes, mas at√© agora n√£o houve uma maneira f√°cil de obter a primeira e a √∫ltima chave de uma matriz sem alterar o ponteiro da matriz ou iterar sobre todas as chaves (via <code>array_keys()</code> ) e obter o primeiro / √∫ltimo valor. </p><br><p>  Duas novas fun√ß√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>array_key_first()</code></a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>array_key_first()</code></a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><code>array_key_last()</code></a> permitindo que voc√™ fa√ßa isso. </p><br><p>  O RFC tamb√©m sugeriu a adi√ß√£o de <code>array_value_first()</code> e <code>array_value_last()</code> , mas esta parte n√£o passou na vota√ß√£o. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-8">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Se voc√™ n√£o declarou suas pr√≥prias <code>array_key_first()</code> e <code>array_key_last()</code> , n√£o h√° problema. </p><br><h2 id="migraciya-s-pcre-na-pcre2">  Migrando do PCRE para o PCRE2 </h2><br><p>  O PHP usa <em>express√µes regulares compat√≠veis com Perl</em> ou, em breve, <em>PCRE</em> na biblioteca para trabalhar com express√µes regulares.  Desde o PHP 7.2, a vers√£o 8.x da Biblioteca Legada do PCRE foi usada, e no PHP 7.3 o PCRE2 j√° ser√° usado.  Observe que o PCRE2 √© considerado uma nova biblioteca, embora seja amplamente compat√≠vel com o PCRE (8.x). </p><br><p>  A nova biblioteca √© mais agressiva na valida√ß√£o de padr√µes e pode levar a erros no c√≥digo existente.  O seguinte trecho ser√° inv√°lido no PHP 7.3: </p><br><pre> <code class="php hljs">preg_match(<span class="hljs-string"><span class="hljs-string">'/[\w-.]+/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre> <br><p>  O PHP emitir√° um aviso <code>Warning: preg_match(): Compilation failed: invalid range in character class at offset 3</code> . <br>  O problema com o padr√£o: para que isso funcione, o h√≠fen deve ser movido para o final ou escapado. </p><br><pre> <code class="php hljs">preg_match(<span class="hljs-string"><span class="hljs-string">'/[\w\-.]+/'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>);</code> </pre> <br><p>  O c√≥digo acima funcionar√° bem, n√£o apenas no PHP 7.3, mas tamb√©m nas vers√µes mais antigas.  No novo padr√£o, o h√≠fen √© escapado <code>-</code> para <code>\-</code> .  Esse √© o problema mais comum que voc√™ pode encontrar ao resolver problemas de compatibilidade. </p><br><p>  Esta √© uma mudan√ßa bem pequena, mas h√° uma chance de que tudo d√™ errado.  A mensagem de erro indica a posi√ß√£o exata do caractere na express√£o regular.  Certifique-se de verificar cuidadosamente seu c√≥digo.  Verifique suas express√µes regulares quanto √† compatibilidade com a sintaxe PCRE2 atrav√©s do <code>Regex Buddy</code> ou outro software similar.  Consulte a descri√ß√£o da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sintaxe PCRE2</a> e da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sintaxe</a> herdada do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PCRE para</a> obter mais informa√ß√µes. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>RFC</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>discuss√£o sobre Externals.io</em></a> <em>,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><em>implementa√ß√£o</em></a> </p><br><h3 id="vliyanie-na-obratnuyu-sovmestimost-9">  Impacto na compatibilidade com vers√µes anteriores </h3><br><p>  Como o PCRE2 √© mais exigente e rigoroso quanto aos modelos, algumas das chamadas <code>preg_match()</code> e similares podem n√£o funcionar.  A corre√ß√£o varia de simplesmente atualizar o modelo (por exemplo, h√≠fens de escape) at√© reescrever modelos.  Verifique se todos os seus testes foram aprovados. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt422507/">https://habr.com/ru/post/pt422507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt422493/index.html">Kubernetes (k8s) + Helm + GitLab CI / CD. Implantar corretamente</a></li>
<li><a href="../pt422495/index.html">Conto dos velhos √≠cones. O enigma de 18 cores. Cores transparentes e inversas</a></li>
<li><a href="../pt422497/index.html">A ICANN publicou um guia detalhado sobre o que esperar ao atualizar o KSK na zona raiz</a></li>
<li><a href="../pt422499/index.html">Mais uma vez sobre os componentes da web ...</a></li>
<li><a href="../pt422501/index.html">Novos processos tecnol√≥gicos para a produ√ß√£o de microchips est√£o sendo cada vez mais adiados - por qu√™?</a></li>
<li><a href="../pt422509/index.html">Resumo do livro "Never Eat Alone"</a></li>
<li><a href="../pt422511/index.html">Carregando dados no Splunk: Universal Forwarder vs Heavy Forwarder. Qual a diferen√ßa?</a></li>
<li><a href="../pt422513/index.html">7 dicas sobre como n√£o enfurecer um colega testador em suas f√©rias</a></li>
<li><a href="../pt422515/index.html">Dois semin√°rios on-line sobre mitaps e computa√ß√£o na mem√≥ria do Apache Ignite em setembro</a></li>
<li><a href="../pt422517/index.html">TelegramBot na nuvem Wolfram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>