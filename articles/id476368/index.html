<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎅🏼 🏅 🧓🏽 Membangun CI / CD Rumah dengan Tindakan GitHub dan Python 👩🏿‍💻 🏔️ 🙀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suatu malam, ketika saya pulang kerja, saya memutuskan untuk melakukan pekerjaan rumah. Saya membuat beberapa suntingan dan segera ingin bereksperimen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membangun CI / CD Rumah dengan Tindakan GitHub dan Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476368/"><p>  Suatu malam, ketika saya pulang kerja, saya memutuskan untuk melakukan pekerjaan rumah.  Saya membuat beberapa suntingan dan segera ingin bereksperimen dengan mereka.  Tetapi sebelum percobaan, saya harus masuk ke VPS, mendorong perubahan, membangun kembali wadah dan menjalankannya.  Kemudian saya memutuskan bahwa sudah waktunya untuk berurusan dengan pengiriman terus menerus. <br><img src="https://habrastorage.org/webt/xa/l4/dm/xal4dmowtxwpuoxxrutujwwy4fm.jpeg"></p><a name="habracut"></a><br><p>  Awalnya, saya punya pilihan antara Circle CI, Travis atau Jenkins.  Saya segera mengesampingkan Jenkins karena kurangnya kebutuhan akan alat yang begitu kuat.  Setelah membaca singkat tentang Travis, saya sampai pada kesimpulan bahwa nyaman untuk berkumpul dan mengujinya, tetapi Anda tidak dapat membayangkan pengiriman apa pun dengannya.  Saya belajar tentang Circle CI dari iklan yang terlalu mengganggu di youtube.  Saya mulai bereksperimen dengan contoh-contoh, tetapi pada beberapa titik saya keliru dan saya memiliki pengujian kekal, yang membuat saya banyak menit yang berharga untuk berkumpul (Secara umum, ada batas yang cukup di sana sehingga tidak perlu khawatir, tetapi itu mengenai saya).  Mengambil pencarian lagi, saya menemukan Tindakan Github.  Setelah bermain dengan contoh Memulai, saya mendapat kesan positif, dan setelah melihat sekilas pada dokumentasi, saya sampai pada kesimpulan bahwa sangat keren bahwa saya dapat menyimpan rahasia untuk perakitan, mengumpulkan dan secara praktis menyebarkan proyek di satu tempat.  Dengan mata berbinar, dia dengan cepat menggambar skema yang diinginkan, dan roda gigi berputar. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h1/fp/rv/h1fprvm3jru4em3vj0ae6xruu5i.jpeg" alt="rencana"></div><br><p>  Pertama, kami akan mencoba melakukan pengujian.  Sebagai percobaan, saya menulis server web sederhana di Flask dengan 2 titik akhir: </p><br><div class="spoiler">  <b class="spoiler_title">Mendaftar aplikasi web sederhana</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request, jsonify app = Flask(__name__) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_post_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: dict)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(data, dict): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> data.get(<span class="hljs-string"><span class="hljs-string">'name'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(data[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], str): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data.get(<span class="hljs-string"><span class="hljs-string">'age'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(data[<span class="hljs-string"><span class="hljs-string">'age'</span></span>], int): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> @app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span> @app.route(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" /api entpoint GET - returns json= {'status': 'test'} POST - { name - str not null age - int optional } :return: """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.method == <span class="hljs-string"><span class="hljs-string">'GET'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonify({<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> request.method == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> validate_post_data(request.json): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonify({<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonify({<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}), <span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> app.run(host=<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, port=<span class="hljs-number"><span class="hljs-number">8080</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre> </div></div><br><p>  Dan beberapa tes: </p><br><div class="spoiler">  <b class="spoiler_title">Daftar Tes Aplikasi</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tested_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlaskAppTests</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> tested_app.app.config[<span class="hljs-string"><span class="hljs-string">'TESTING'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.app = tested_app.app.test_client() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_get_hello_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) self.assertEqual(r.data, <span class="hljs-string"><span class="hljs-string">b'Hello World!'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_post_hello_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">405</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_get_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.get(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_correct_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">200</span></span>) r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_not_dict_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps([{<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>}])) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_no_name_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_bad_age_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-string"><span class="hljs-string">'100'</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: unittest.main()</code> : 'Den', 'usia': <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tested_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlaskAppTests</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> tested_app.app.config[<span class="hljs-string"><span class="hljs-string">'TESTING'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.app = tested_app.app.test_client() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_get_hello_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) self.assertEqual(r.data, <span class="hljs-string"><span class="hljs-string">b'Hello World!'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_post_hello_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">405</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_get_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.get(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_correct_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">200</span></span>) r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_not_dict_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps([{<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>}])) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_no_name_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_bad_age_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-string"><span class="hljs-string">'100'</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: unittest.main()</code> </pre> </div></div><br><p>  Output Cakupan: </p><br><pre> <code class="plaintext hljs">coverage report Name Stmts Miss Cover ------------------------------------------------------------------ src/app.py 28 2 93% src/tests.py 37 0 100% ------------------------------------------------------------------ TOTAL 65 2 96%</code> </pre> <br><p>  Sekarang buat tindakan pertama kami, yang akan menjalankan tes.  Menurut dokumentasi, semua tindakan harus disimpan dalam direktori khusus: </p><br><pre> <code class="bash hljs">$ mkdir -p .github/workflows $ touch .github/workflows/test_on_push.yaml</code> </pre> <br><p>  Saya ingin tindakan ini dijalankan pada acara push apa pun di cabang mana pun, kecuali untuk rilis (tag, karena akan ada pengujian terpisah): </p><br><pre> <code class="plaintext hljs">on: push: tags: - '!refs/tags/*' branches: - '*'</code> </pre> <br><p>  Kemudian kami membuat tugas yang akan berjalan di Ubuntu versi terbaru yang tersedia: </p><br><pre> <code class="plaintext hljs">jobs: run_tests: runs-on: [ubuntu-latest]</code> </pre> <br><p>  Dalam langkah-langkah, kami akan memeriksa kode, menginstal python, menginstal dependensi, menjalankan tes dan cakupan tampilan: </p><br><pre> <code class="plaintext hljs">steps: #   - uses: actions/checkout@master #  python   - uses: actions/setup-python@v1 with: python-version: '3.8' architecture: 'x64' - name: Install requirements #   run: pip install -r requirements.txt - name: Run tests run: coverage run src/tests.py - name: Tests report run: coverage report</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Semuanya bersama</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">name: Run tests on any Push event #    push    ,    . #      on: push: tags: - '!refs/tags/*' branches: - '*' jobs: run_tests: runs-on: [ubuntu-latest] steps: #   - uses: actions/checkout@master #  python   - uses: actions/setup-python@v1 with: python-version: '3.8' architecture: 'x64' - name: Install requirements #   run: pip install -r requirements.txt - name: Run tests run: coverage run src/tests.py - name: Tests report run: coverage report</code> </pre> </div></div><br><p>  Ayo coba buat komit dan lihat bagaimana aksi kita bekerja. <br><img src="https://habrastorage.org/webt/qy/v7/by/qyv7byybfnvpnkurriqvydsp_xk.png"><br>  <em>Lulus tes di antarmuka Tindakan</em> </p><br><p>  Hore, kami berhasil membuat aksi pertama dan menjalankannya!  Mari kita coba untuk memecahkan beberapa jenis tes dan lihat hasilnya: <br><img src="https://habrastorage.org/webt/dr/vn/_s/drvn_sgrq-esw6sgxjiylhhy02w.png"><br>  <em>Tes macet di antarmuka Tindakan</em> </p><br><p>  Tes gagal.  Indikator berubah merah dan bahkan menerima notifikasi melalui pos.  Apa yang kamu butuhkan!  3 dari 8 poin skema target dapat dianggap terpenuhi.  Sekarang mari kita coba berurusan dengan perakitan, penyimpanan gambar buruh pelabuhan kami. </p><br><p>  <strong>Catat!</strong>  <strong>Selanjutnya kita membutuhkan akun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buruh pelabuhan</a></strong> </p><br><p>  Pertama, kita menulis Dockerfile sederhana di mana aplikasi kita akan dieksekusi. </p><br><div class="spoiler">  <b class="spoiler_title">Dockerfile</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#     FROM python:3.8-alpine #        /app  COPY ./ /app #    RUN apk update &amp;&amp; pip install -r /app/requirements.txt --no-cache-dir #   (  Distutils) RUN pip install -e /app #      EXPOSE 8080 #       CMD web_server #    distutils      #CMD python /app/src/app.py</code> </pre> </div></div><br><p>  Untuk mengirim kontainer ke hub, Anda harus masuk ke buruh pelabuhan, tetapi karena saya tidak ingin seluruh dunia mempelajari kata sandi untuk akun tersebut, saya akan menggunakan rahasia yang tertanam dalam GitHub.  Secara umum, hanya kata sandi yang dapat dimasukkan ke dalam rahasia, dan sisanya akan dikodekan dalam * .yaml, dan ini akan berfungsi.  Tetapi saya ingin menyalin-tempel tindakan saya tanpa perubahan, dan untuk menarik semua informasi spesifik dari rahasia. </p><br><p><img src="https://habrastorage.org/webt/2c/h8/5t/2ch85tdbuovsc7ywejh5gmrmvgw.png"><br>  <em>Rahasia Github</em> </p><br><p>  DOCKER_LOGIN - masuk di hub.docker.com <br>  DOCKER_PWD - kata sandi <br>  DOCKER_NAME - nama repositori buruh pelabuhan untuk proyek ini (harus dibuat sebelumnya) </p><br><p>  Oke, persiapan sudah selesai, sekarang mari kita buat aksi kedua kami: </p><br><pre> <code class="bash hljs">$ touch .github/workflows/pub_on_release.yaml</code> </pre> <br><p>  Kami menyalin pengujian dari tindakan sebelumnya, dengan pengecualian pemicu peluncuran (saya tidak menemukan cara mengimpor tindakan).  Kami menggantinya dengan "Luncurkan saat rilis": </p><br><pre> <code class="plaintext hljs">on: release: types: [published]</code> </pre> <br><p>  <strong>PENTING!</strong>  <strong>Hal ini sangat penting untuk membuat kondisi on.event yang tepat</strong> <br>  Misalnya, jika on.release tidak menentukan jenis, maka peristiwa ini memicu setidaknya 2 peristiwa: diterbitkan dan dibuat.  Bahwa, akan diluncurkan setelah 2 dari proses perakitan. </p><br><p>  Sekarang dalam file yang sama kita akan melakukan tugas lain tergantung pada yang pertama: </p><br><pre> <code class="plaintext hljs">build_and_pub: needs: [run_tests]</code> </pre> <br><p>  perlu - mengatakan bahwa tugas ini tidak akan mulai sampai run_tests berakhir </p><br><p>  <strong>PENTING!</strong>  <strong>Jika Anda memiliki beberapa file tindakan, dan di dalamnya beberapa tugas, maka semuanya dijalankan secara bersamaan di lingkungan yang berbeda.</strong>  Lingkungan terpisah dibuat untuk setiap tugas, terlepas dari tugas lain.  jika Anda tidak menentukan kebutuhan, maka tugas pengujian dan rakitan akan diluncurkan secara bersamaan dan terpisah satu sama lain. </p><br><p>  Tambahkan variabel lingkungan di mana rahasia kita akan: </p><br><pre> <code class="plaintext hljs">env: LOGIN: ${{ secrets.DOCKER_LOGIN }} NAME: ${{ secrets.DOCKER_NAME }}</code> </pre> <br><p>  Sekarang langkah-langkah tugas kita, di dalamnya kita harus masuk ke buruh pelabuhan, mengumpulkan wadah dan menerbitkannya di registri: </p><br><pre> <code class="plaintext hljs">steps: - name: Login to docker.io run: echo ${{ secrets.DOCKER_PWD }} | docker login -u ${{ secrets.DOCKER_LOGIN }} --password-stdin - uses: actions/checkout@master - name: Build image run: docker build -t $LOGIN/$NAME:${GITHUB_REF:11} -f Dockerfile . - name: Push image to docker.io run: docker push $LOGIN/$NAME:${GITHUB_REF:11}</code> </pre> <br><p>  $ {GITHUB_REF: 11} adalah variabel github yang menyimpan baris dengan referensi ke peristiwa di mana pemicu bekerja (nama cabang, tag, dll.), Jika kita memiliki tag dengan format "v0.0.0" maka Anda perlu memangkas 11 yang pertama karakter, maka "0.0.0" tetap. </p><br><p>  Dorong kode dan buat tag baru.  Dan kami melihat bahwa kontainer kami berhasil dirakit dan dikirim ke registri, dan kami tidak menyalakan kata sandi kami di mana pun. </p><br><p><img src="https://habrastorage.org/webt/mg/yt/i-/mgyti-mww_fcqsmbiqk6zli7swo.png"><br>  <em>Bangun dan kirimkan kontainer dalam antarmuka Tindakan</em> </p><br><p>  Periksa hub: </p><br><p><img src="https://habrastorage.org/webt/ut/nw/vd/utnwvdtcprbqfpavnnirqmqim0s.png"><br>  <em>Wadah disimpan di hub buruh pelabuhan</em> </p><br><p>  Semuanya berfungsi, tetapi tugas yang paling sulit tetap - penyebaran.  Di sini Anda sudah memerlukan VPS dan alamat IP putih tempat kami akan menyebarkan wadah dan tempat Anda dapat mengirim kail.  Secara teori, di sisi VPS atau server rumah, Anda dapat menjalankan skrip pada mahkota, yang dalam kasus gambar baru akan memecatnya, atau entah bagaimana bermain dengan bot telegram.  Tentunya ada banyak cara untuk melakukan ini.  Tapi saya akan bekerja dengan ip eksternal.  Agar tidak pandai, saya menulis layanan web kecil di Flask dengan API sederhana. <br>  Singkatnya, ada 1 titik akhir “/”. <br>  Permintaan GET mengembalikan json dengan semua wadah aktif di host. <br>  POST - menerima data dalam format: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"owner"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"repository"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"v0.0.1"</span></span>, #    <span class="hljs-attr"><span class="hljs-attr">"ports"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"8080"</span></span>: <span class="hljs-number"><span class="hljs-number">8080</span></span>, “443”: <span class="hljs-number"><span class="hljs-number">443</span></span>} #      }</code> </pre> <br><p>  Apa yang terjadi pada tuan rumah: </p><br><ol><li>  dari json yang diterima nama gambar baru </li><li>  gambar baru menggembung </li><li>  jika gambar telah diunduh, maka wadah saat ini dihentikan dan dihapus </li><li>  wadah baru diluncurkan, dengan publikasi port (-p flag) </li></ol><br><p>  Semua pekerjaan dengan buruh pelabuhan dilakukan menggunakan perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buruh pelabuhan</a> </p><br><p>  Akan sangat salah untuk menerbitkan layanan seperti itu di Internet tanpa perlindungan minimal, dan saya membuat kemiripan dengan API KEY, layanan membaca token dari variabel lingkungan, dan kemudian membandingkannya dengan header {Otorisasi: CI_TOKEN} </p><br><div class="spoiler">  <b class="spoiler_title">Daftar server web untuk ditempatkan</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># coding=utf-8 import os import sys import logging import logging.config import logging.handlers from flask import Flask from flask import request, jsonify import docker log = logging.getLogger(__name__) app = Flask(__name__) docker_client = docker.from_env() MY_AUTH_TOKEN = os.getenv('CI_TOKEN', None) #       def init_logging(): """   :return: """ log_format = f"[%(asctime)s] [ CI/CD server ] [%(levelname)s]:%(name)s:%(message)s" formatters = {'basic': {'format': log_format}} handlers = {'stdout': {'class': 'logging.StreamHandler', 'formatter': 'basic'}} level = 'INFO' handlers_names = ['stdout'] loggers = { '': { 'level': level, 'propagate': False, 'handlers': handlers_names }, } logging.basicConfig(level='INFO', format=log_format) log_config = { 'version': 1, 'disable_existing_loggers': False, 'formatters': formatters, 'handlers': handlers, 'loggers': loggers } logging.config.dictConfig(log_config) def get_active_containers(): """     :return: """ containers = docker_client.containers.list() result = [] for container in containers: result.append({ 'short_id': container.short_id, 'container_name': container.name, 'image_name': container.image.tags, 'created': container.attrs['Created'], 'status': container.status, 'ports': container.ports, }) return result def get_container_name(item: dict) -&gt; [str, str]: """   image  POST  :param item: :return: """ if not isinstance(item, dict): return '' owner = item.get('owner') repository = item.get('repository') tag = item.get('tag', 'latest').replace('v', '') if owner and repository and tag: return f'{owner}/{repository}:{tag}', repository if repository and tag: return f'{repository}:{tag}', repository return '', '' def kill_old_container(container_name: str) -&gt; bool: """    ,   :param container_name: :return: """ try: #    container = docker_client.containers.get(container_name) #  container.kill() except Exception as e: #       log.warning(f'Error while delete container {container_name}, {e}') return False finally: #   ,     log.debug(docker_client.containers.prune()) log.info(f'Container deleted. container_name = {container_name}') return True def deploy_new_container(image_name: str, container_name: str, ports: dict = None): try: #   image  docker hub'a log.info(f'pull {image_name}, name={container_name}') docker_client.images.pull(image_name) log.debug('Success') kill_old_container(container_name) log.debug('Old killed') #    docker_client.containers.run(image=image_name, name=container_name, detach=True, ports=ports) except Exception as e: log.error(f'Error while deploy container {container_name}, \n{e}') return {'status': False, 'error': str(e)}, 400 log.info(f'Container deployed. container_name = {container_name}') return {'status': True}, 200 @app.route('/', methods=['GET', 'POST']) def MainHandler(): """ GET -      POST -      : { "owner": "gonfff", "repository": "ci_example", "tag": "v0.0.1", "ports": {"8080": 8080} } :return: """ if request.headers.get('Authorization') != MY_AUTH_TOKEN: return jsonify({'message': 'Bad token'}), 401 if request.method == 'GET': return jsonify(get_active_containers()) elif request.method == 'POST': log.debug(f'Recieved {request.data}') image_name, container_name = get_container_name(request.json) ports = request.json.get('ports') if request.json.get('ports') else None result, status = deploy_new_container(image_name, container_name, ports) return jsonify(result), status def main(): init_logging() if not MY_AUTH_TOKEN: log.error('There is no auth token in env') sys.exit(1) app.run(host='0.0.0.0', port=5000) if __name__ == '__main__': main()</span></span></code> format = log_format) <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># coding=utf-8 import os import sys import logging import logging.config import logging.handlers from flask import Flask from flask import request, jsonify import docker log = logging.getLogger(__name__) app = Flask(__name__) docker_client = docker.from_env() MY_AUTH_TOKEN = os.getenv('CI_TOKEN', None) #       def init_logging(): """   :return: """ log_format = f"[%(asctime)s] [ CI/CD server ] [%(levelname)s]:%(name)s:%(message)s" formatters = {'basic': {'format': log_format}} handlers = {'stdout': {'class': 'logging.StreamHandler', 'formatter': 'basic'}} level = 'INFO' handlers_names = ['stdout'] loggers = { '': { 'level': level, 'propagate': False, 'handlers': handlers_names }, } logging.basicConfig(level='INFO', format=log_format) log_config = { 'version': 1, 'disable_existing_loggers': False, 'formatters': formatters, 'handlers': handlers, 'loggers': loggers } logging.config.dictConfig(log_config) def get_active_containers(): """     :return: """ containers = docker_client.containers.list() result = [] for container in containers: result.append({ 'short_id': container.short_id, 'container_name': container.name, 'image_name': container.image.tags, 'created': container.attrs['Created'], 'status': container.status, 'ports': container.ports, }) return result def get_container_name(item: dict) -&gt; [str, str]: """   image  POST  :param item: :return: """ if not isinstance(item, dict): return '' owner = item.get('owner') repository = item.get('repository') tag = item.get('tag', 'latest').replace('v', '') if owner and repository and tag: return f'{owner}/{repository}:{tag}', repository if repository and tag: return f'{repository}:{tag}', repository return '', '' def kill_old_container(container_name: str) -&gt; bool: """    ,   :param container_name: :return: """ try: #    container = docker_client.containers.get(container_name) #  container.kill() except Exception as e: #       log.warning(f'Error while delete container {container_name}, {e}') return False finally: #   ,     log.debug(docker_client.containers.prune()) log.info(f'Container deleted. container_name = {container_name}') return True def deploy_new_container(image_name: str, container_name: str, ports: dict = None): try: #   image  docker hub'a log.info(f'pull {image_name}, name={container_name}') docker_client.images.pull(image_name) log.debug('Success') kill_old_container(container_name) log.debug('Old killed') #    docker_client.containers.run(image=image_name, name=container_name, detach=True, ports=ports) except Exception as e: log.error(f'Error while deploy container {container_name}, \n{e}') return {'status': False, 'error': str(e)}, 400 log.info(f'Container deployed. container_name = {container_name}') return {'status': True}, 200 @app.route('/', methods=['GET', 'POST']) def MainHandler(): """ GET -      POST -      : { "owner": "gonfff", "repository": "ci_example", "tag": "v0.0.1", "ports": {"8080": 8080} } :return: """ if request.headers.get('Authorization') != MY_AUTH_TOKEN: return jsonify({'message': 'Bad token'}), 401 if request.method == 'GET': return jsonify(get_active_containers()) elif request.method == 'POST': log.debug(f'Recieved {request.data}') image_name, container_name = get_container_name(request.json) ports = request.json.get('ports') if request.json.get('ports') else None result, status = deploy_new_container(image_name, container_name, ports) return jsonify(result), status def main(): init_logging() if not MY_AUTH_TOKEN: log.error('There is no auth token in env') sys.exit(1) app.run(host='0.0.0.0', port=5000) if __name__ == '__main__': main()</span></span></code> </pre> </div></div><br><p>  Untuk aplikasi ini, saya juga melakukan setup.py untuk menginstalnya di sistem.  Anda dapat menginstalnya menggunakan: </p><br><pre> <code class="bash hljs">$ python3 setup.sy install</code> </pre> <br><p>  asalkan Anda telah mengunduh file dan berada di direktori aplikasi ini. <br>  Setelah instalasi, Anda harus mengaktifkan aplikasi sebagai layanan sehingga ia memulai sendiri jika server reboot, untuk ini kami menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">systemd</a> <br>  Berikut ini contoh file konfigurasi: </p><br><pre> <code class="plaintext hljs">[Unit] Description=Deployment web server After=network-online.target [Service] Type=simple RestartSec=3 ExecStart=/usr/local/bin/ci_example Environment=CI_TOKEN=#&lt;I generate it with $(openssl rand -hex 20)&gt; [Install] WantedBy=multi-user.target</code> </pre><br><p>  Tinggal menjalankannya saja: </p><br><pre> <code class="bash hljs">$ sudo systemctl daemon-reload $ sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> ci_example.service $ sudo systemctl start ci_example.service</code> </pre> <br><p>  Anda dapat melihat log server pengiriman web menggunakan perintah </p><br><pre> <code class="bash hljs">$ sudo systemctl status ci_example.service</code> </pre> <br><p>  Bagian server sudah siap, tetap hanya untuk menambahkan hook ke tindakan kita.  Untuk melakukan ini, tambahkan rahasia alamat IP dari server kami dan CI_TOKEN yang kami hasilkan ketika kami menginstal aplikasi. <br>  Pada awalnya saya ingin menggunakan tindakan yang sudah jadi untuk curl dari pasar github, tapi sayangnya, itu menghilangkan tanda kutip dari badan permintaan POST, yang membuatnya tidak mungkin untuk mengurai json.  Ini jelas tidak cocok untuk saya, dan saya memutuskan untuk menggunakan curl bawaan di ubuntu (tempat saya mengumpulkan kontainer), yang notabene memiliki efek positif pada kinerja, karena tidak memerlukan perakitan wadah tambahan: </p><br><pre> <code class="plaintext hljs">deploy: needs: [build_and_pub] runs-on: [ubuntu-latest] steps: - name: Set tag to env run: echo ::set-env name=TAG::$(echo ${GITHUB_REF:11}) - name: Send webhook for deploy run: "curl --silent --show-error --fail -X POST ${{ secrets.DEPLOYMENT_SERVER }} -H 'Authorization: ${{ secrets.DEPLOYMENT_TOKEN }}' -H 'Content-Type: application/json' -d '{\"owner\": \"${{ secrets.DOCKER_LOGIN }}\", \"repository\": \"${{ secrets.DOCKER_NAME }}\", \"tag\": \"${{ env.TAG }}\", \"ports\": {\"8080\": 8080}}'"</code> </pre><br><p>  <strong>Catatan: sangat penting untuk menentukan sakelar --fail, jika tidak, permintaan apa pun akan berhasil, bahkan jika kesalahan diterima sebagai respons.</strong> <br>  Perlu juga dicatat bahwa variabel yang digunakan dalam permintaan tidak benar-benar variabel, tetapi fungsi khusus dipanggil dengan pengecualian GITHUB_REF, yang mengapa lama sekali saya tidak bisa mengerti mengapa permintaan itu tidak berfungsi dengan benar.  Tetapi setelah membuat fungsi dari itu, semuanya berhasil. </p><br><div class="spoiler">  <b class="spoiler_title">Tindakan membangun dan menggunakan</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">name: Publish on Docker Hub and Deploy on: release: types: [published] #       jobs: run_tests: #          runs-on: [ubuntu-latest] steps: #   - uses: actions/checkout@master #  python   - uses: actions/setup-python@v1 with: python-version: '3.8' architecture: 'x64' - name: Install requirements #   run: pip install -r requirements.txt - name: Run tests #   run: coverage run src/tests.py - name: Tests report run: coverage report build_and_pub: #      needs: [run_tests] runs-on: [ubuntu-latest] env: LOGIN: ${{ secrets.DOCKER_LOGIN }} NAME: ${{ secrets.DOCKER_NAME }} steps: - name: Login to docker.io #     docker.io run: echo ${{ secrets.DOCKER_PWD }} | docker login -u ${{ secrets.DOCKER_LOGIN }} --password-stdin #   - uses: actions/checkout@master - name: Build image #  image        hub.docker .. login/repository:version run: docker build -t $LOGIN/$NAME:${GITHUB_REF:11} -f Dockerfile . - name: Push image to docker.io #    registry run: docker push $LOGIN/$NAME:${GITHUB_REF:11} deploy: #         registry,      #    curl   needs: [build_and_pub] runs-on: [ubuntu-latest] steps: - name: Set tag to env run: echo ::set-env name=RELEASE_VERSION::$(echo ${GITHUB_REF:11}) - name: Send webhook for deploy run: "curl --silent --show-error --fail -X POST ${{ secrets.DEPLOYMENT_SERVER }} -H 'Authorization: ${{ secrets.DEPLOYMENT_TOKEN }}' -H 'Content-Type: application/json' -d '{\"owner\": \"${{ secrets.DOCKER_LOGIN }}\", \"repository\": \"${{ secrets.DOCKER_NAME }}\", \"tag\": \"${{ env.RELEASE_VERSION }}\", \"ports\": {\"8080\": 8080}}'"</code> </pre> </div></div><br><p>  Oke, kita kumpulkan semuanya, sekarang kita akan membuat rilis baru dan melihat aksinya. <br><img src="https://habrastorage.org/webt/07/dn/5q/07dn5qrqodyyfaulm6gpey7w8my.png"><br>  <em>Webhook ke penerapan tindakan antarmuka aplikasi</em> </p><br><p>  Semuanya ternyata, kami membuat permintaan GET ke layanan penyebaran (menampilkan semua wadah aktif di host): <br><img src="https://habrastorage.org/webt/gq/1w/yg/gq1wygbewjefugj8itjchn2ucki.png"><br>  <em>Digunakan di wadah VPS</em> </p><br><p>  Sekarang kami akan mengirimkan permintaan ke aplikasi yang kami gunakan: <br><img src="https://habrastorage.org/webt/hs/9x/hz/hs9xhzawrwliyoptcccjd-48bco.png"><br>  <em>DAPATKAN permintaan ke wadah yang digunakan</em> </p><br><img src="https://habrastorage.org/webt/jf/fy/xc/jffyxcdf8zyzfylylyufv8wlcp0.png" alt="Permintaan pos ke wadah yang digunakan"><br><p>  <em>Permintaan POST ke wadah yang digunakan</em> </p><br><p>  <strong>Kesimpulan</strong> <br>  GitHub Actions adalah alat yang sangat nyaman dan fleksibel yang dengannya Anda dapat melakukan banyak hal yang dapat sangat menyederhanakan hidup Anda.  Itu semua tergantung pada imajinasi. <br>  Mereka mendukung pengujian integrasi dengan layanan. <br>  Sebagai kelanjutan logis dari proyek ini dapat ditambahkan ke WebHook kemampuan untuk pengaturan transfer kustom untuk memulai wadah. <br>  Di masa depan saya akan mencoba untuk mengambil sebagai dasar proyek ini untuk penyebaran grafik helm ketika saya belajar dan bereksperimen dengan k8s </p><br><p>  Jika Anda memiliki semacam proyek rumahan, maka Tindakan GitHub dapat sangat mempermudah bekerja dengan repositori. </p><br><p>  Detail sintaks dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini.</a> <br>  Semua sumber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proyek</a> </p><cut text=" "></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id476368/">https://habr.com/ru/post/id476368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id476348/index.html">Bagaimana ahli kimia dari universitas negeri memperkenalkan prinsip-prinsip TI ke dalam pekerjaan mereka dan menjadi pemimpin tim</a></li>
<li><a href="../id476352/index.html">Manajemen Layanan Lapangan dan layanan lapangan. Sudahkah Rusia mencapai titik mengelola insinyur layanan lapangan?</a></li>
<li><a href="../id476354/index.html">Tiga Langkah Praktis untuk Menyimpan Sumber Daya Startup Anda</a></li>
<li><a href="../id476358/index.html">Layanan mesh untuk layanan microser. Bagian I</a></li>
<li><a href="../id476366/index.html">Atapnya berbunyi: bagaimana memahami bahwa sudah waktunya bagi seorang terapis dan bagaimana menemukannya</a></li>
<li><a href="../id476370/index.html">Situs web JetBrains resmi sekarang tersedia dalam bahasa Rusia</a></li>
<li><a href="../id476372/index.html">Teori kategori memungkinkan matematika untuk meninggalkan persamaan</a></li>
<li><a href="../id476374/index.html">The Wright Brothers: First Patent Trolls</a></li>
<li><a href="../id476378/index.html">Sembuh, CUDA - Intel Mengumumkan GPU 7nm untuk Pusat Data</a></li>
<li><a href="../id476380/index.html">Cryptocurrency trading - Bagaimana mengembangkan strategi yang berkelanjutan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>