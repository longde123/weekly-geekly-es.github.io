<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ç üßù üö≤ Appareil Sysadmin EDC: Linux dans votre poche üôÜüèæ üë®üèæ üñïüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chaque administrateur, peut-√™tre, avait un cas o√π quelque chose tombe soudainement en panne, et vous √™tes quelque part sur la route: vous allez en voi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Appareil Sysadmin EDC: Linux dans votre poche</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/409945/"> Chaque administrateur, peut-√™tre, avait un cas o√π quelque chose tombe soudainement en panne, et vous √™tes quelque part sur la route: vous allez en voiture, prenez un train ou, banalement, vous vous asseyez quelque part sur un banc de parc et vous d√©tachez et vous pr√©cipitez quelque part le d√©sir n'est pas le moindre.  Et vous devez le r√©parer.  Ou, au minimum, √©valuez l'√©chelle de l'animal √† fourrure blanche qui est arriv√©. <br><br>  Il est clair que vous pouvez le faire avec un smartphone ou une tablette, surtout si vous n'avez besoin que de passer par ssh.  Mais utiliser un √©cran tactile dans de tels cas, comme pour moi, c'est de la douleur et de la souffrance. <br><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hd/-j/nd/hd-jndx6jjchvd9ggnpyj-ynvhw.jpeg"></div><br>  Vous pouvez acheter un clavier, un support ou un support externe pour la tablette, mais je pense qu'il est plus facile de transporter un ordinateur portable complet avec vous.  Les lieux prendront √† peu pr√®s la m√™me chose. <br><a name="habracut"></a><br><h2>  Quelques souvenirs et raisonnements </h2><br>  Trop paresseux √† lire, vous pouvez imm√©diatement passer √† la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">partie pratique.</a> <br><br>  √Ä une certaine √©poque, lorsque les andro√Ødes et les iPhones n'existaient pas encore, pour de telles choses, j'ai utilis√© la ¬´tablette Internet¬ª Nokia N810.  Le combin√© a des dimensions avec un smartphone moderne, tout en ayant un clavier qwerty et m√™me avec Linux complet √† bord.  Ssh, vnc, rdesktop - oui pas de question!  De plus, j'ai activement utilis√© CAS Maxima lorsque j'avais besoin de calculer rapidement quelque chose et d'afficher le r√©sultat. <br><br><br> <a href=""><img src="https://habrastorage.org/webt/bd/e7/kx/bde7kxemqv5fuchk9o5aujaokte.jpeg"></a> <br> <a href=""><img src="https://habrastorage.org/webt/so/ya/xr/soyaxrvavdiymhza5xjuv0mhy7q.png"></a> <br><br>  Mais le temps a pass√©, les smartphones Android ont commenc√© √† appara√Ætre.  Voil√†, pensais-je: Linux presque √† part enti√®re, en m√™me temps, il n'est pas n√©cessaire d'avoir un autre appareil avec vous pour distribuer Internet.  J'ai commenc√© √† regarder l'appareil avec qwerty, qui me remplacerait par le bon vieux n810, qui √† ce moment-l√† √©tait assez fatigu√© (c√¢ble d'√©cran, batterie remplac√©e deux fois, clavier, bo√Ætier cass√©).  Le choix s'est port√© sur Motorola Milestone. <br><br>  Le voici, en partie, √† c√¥t√© de mon bon vieux Palm V et N810: <br><br> <a href=""><img src="https://habrastorage.org/webt/hh/vf/bm/hhvfbmnvsxhy_2srw11rhwt8r5g.jpeg"></a> <br><br>  Je dois dire que le produit ne justifiait pas la confiance.  Le clavier a √©t√© une d√©ception totale.  Pas m√™me √† cause de la disposition, mais √† cause de la tr√®s mauvaise fabrication: apr√®s six mois d'utilisation, il a commenc√© √† exfolier et √† tra√Æner. <br><br>  Le chargeur de d√©marrage crypt√© a ajout√© ses clous au cercueil: l'incapacit√© d'utiliser le noyau personnalis√© avec toutes les cons√©quences, le chroot Debian a mang√© la batterie comme si en soi, en raison des particularit√©s de l'alimentation, mais de toute fa√ßon, le produit a en quelque sorte r√©solu les t√¢ches qui lui √©taient assign√©es. <br><br>  √Ä tout le moins, il a continu√© √† √™tre utilis√© apr√®s l'expiration de la p√©riode d'obsolescence pr√©vue d√©termin√©e par le fabricant, lorsque plusieurs mod√®les plus r√©cents ont √©t√© publi√©s (diff√©rents, peut-√™tre avec une configuration l√©g√®rement modifi√©e et beaucoup de RAM), et il √©tait extr√™mement bogu√© et lent. <br><br>  D'accord, car le terminal ssh tombera et le smartphone (bien s√ªr, il engloutira une certaine quantit√© de vos cellules nerveuses).  Mais il y a des cas o√π vous devez vous accrocher √† un morceau de fer avec un c√¢ble de console ou supprimer tcpdump avec un p√©riph√©rique IP qui ne r√©pond pas afin que vous puissiez faire quelque chose avec. <br><br>  C'est tout simplement enchanteur quand, en raison de la pr√©sence d'un port COM sur la station d'accueil, une personne fait glisser un imb√©cile de shnuy de 17 pouces HP avec un quai et une alimentation de 1,5 kilogramme, puis se bloque avec tout cela sur l'escabeau devant le comptoir. <br><br>  R√©cemment, j'ai utilis√© le ThinkPad x220 12 "avec adaptateur usb2com. Mais de plus en plus j'ai commenc√© √† laisser l'ordinateur portable √† la maison, jusqu'√† ce qu'un jour (encore une fois)" $ username, tout se soit cass√©! ", Et je n'avais qu'un smartphone Android avec moi. <br><br><h2>  Le voici, le poisson de mes r√™ves (en fait non) </h2><br>  Et une fois que je suis tomb√© sur un produit appel√© GPD Pocket.  Un ordinateur portable √† part enti√®re sous la forme d'un re-smartphone ou d'une tablette sous-dimensionn√©e.  7 ", clavier qwerty, une marge d'autonomie d√©cente - euh, vous devez le prendre. J'ai command√©, re√ßu, d√©ball√©. <br><br>  Pour comparaison avec x220 et n810: <br><br> <a href=""><img src="https://habrastorage.org/webt/jg/kj/hq/jgkjhqw3ulrb3i956decqaladlk.jpeg"></a> <br><br>  Je ne d√©crirai pas les caract√©ristiques de ceux qui en ont besoin - ils le trouveront sur Internet, d'autant plus qu'il y a r√©cemment eu une critique √©coeurante de girbest ici.  Donnez juste l'√©chappement lshw et lspci: <br><br>  lshw: <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><pre><code class="plaintext hljs">:   : Default string (Default string) : Default string : Default string  ‚Ññ: Default string : 64 bits : smbios-3.0 dmi-3.0 vsyscall32 : boot=normal chassis=desktop family=Default string sku=Default string uuid=00020003-0004-0005-0006-000700080009 *-core :   : Default string : AMI Corporation  ID: 0 : Default string  ‚Ññ: Default string : Default string *-firmware : BIOS : American Megatrends Inc.  ID: 0 : 5.11 date: 08/07/2017 : 64KiB capacity: 4032KiB : pci upgrade shadowing cdboot bootselect socketedrom edd int13floppy1200 int13floppy720 int13floppy2880 int5printscreen int14serial int17printer acpi usb biosbootspecification uefi *-memory :    ID: 28 :      : 8GiB *-bank:0 : DIMM DDR3 1066 MHz (0,9 ns) : 00000000 : Hynix Semiconductor  ID: 0  ‚Ññ: 00000000 : A1_DIMM0 : 4GiB : 8 bits : 1066MHz (0.9ns) *-bank:1 : DIMM DDR3 1066 MHz (0,9 ns) : 00000000 : Hynix Semiconductor  ID: 1  ‚Ññ: 00000000 : A1_DIMM1 : 4GiB : 8 bits : 1066MHz (0.9ns) *-cache:0 : L1   ID: 32 : CPU Internal L1 : 224KiB capacity: 224KiB : internal write-back : level=1 *-cache:1 : L2   ID: 33 : CPU Internal L2 : 2MiB capacity: 2MiB : internal write-back unified : level=2 *-cpu :  : Intel(R) Atom(TM) x7-Z8750 CPU @ 1.60GHz : Intel Corp.  ID: 34   : cpu@0 : Intel(R) Atom(TM) x7-Z8750 CPU @ 1.60GHz : SOCKET 0 : 889MHz capacity: 2560MHz : 64 bits : 80MHz : x86-64 fpu fpu_exception wp vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx rdtscp constant_tsc arch_perfmon pebs bts rep_good nopl xtopology tsc_reliable nonstop_tsc cpuid aperfmperf tsc_known_freq pni pclmulqdq dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm sse4_1 sse4_2 movbe popcnt tsc_deadline_timer aes rdrand lahf_lm 3dnowprefetch epb pti tpr_shadow vnmi flexpriority ept vpid tsc_adjust smep erms dtherm ida arat cpufreq : cores=4 enabledcores=4 threads=4 *-pci : Host bridge : Intel Corporation : Intel Corporation  ID: 100   : pci@0000:00:00.0 : 34 : 32 bits : 33MHz : driver=iosf_mbi_pci : IRQ:0 *-display : VGA compatible controller : Intel Corporation : Intel Corporation  ID: 2   : pci@0000:00:02.0 : 34 : 64 bits : 33MHz : pm msi vga_controller bus_master cap_list rom : driver=i915 latency=0 : IRQ:123 :a0000000-a0ffffff :80000000-9fffffff ioport:f000(=64) :c0000-dffff *-generic:0 : Signal processing controller : Intel Corporation : Intel Corporation  ID: b   : pci@0000:00:0b.0 : 34 : 64 bits : 33MHz : msi pm cap_list : driver=proc_thermal latency=0 : IRQ:129 :a1a3b000-a1a3bfff *-usb : USB controller : Intel Corporation : Intel Corporation  ID: 14   : pci@0000:00:14.0 : 34 : 64 bits : 33MHz : pm msi xhci bus_master cap_list : driver=xhci_hcd latency=0 : IRQ:121 :a1a00000-a1a0ffff *-usbhost:0 : xHCI Host Controller : Linux 4.15.0-rc7-stockmind-gpdpocket xhci-hcd  ID: 0   : usb@1  : usb1 : 4.15 : usb-2.00 : driver=hub slots=7 speed=480Mbit/s *-usb:0 :  : Gaming Keyboard : SINO WEALTH  ID: 2   : usb@1:2 : 1.00 : usb-1.10 : driver=usbhid maxpower=100mA speed=1Mbit/s *-usb:1 :  USB- : BCM2045A0 : Broadcom Corp  ID: 3   : usb@1:3 : 1.12  ‚Ññ: B0F1ECED56A9 : usb-2.00 : driver=btusb maxpower=100mA speed=12Mbit/s *-usbhost:1 : xHCI Host Controller : Linux 4.15.0-rc7-stockmind-gpdpocket xhci-hcd  ID: 1   : usb@2  : usb2 : 4.15 : usb-3.00 : driver=hub slots=6 speed=5000Mbit/s *-generic:1 : Encryption controller : Intel Corporation : Intel Corporation  ID: 1a   : pci@0000:00:1a.0 : 34 : 32 bits : 33MHz : pm msi bus_master cap_list : driver=mei_txe latency=0 : IRQ:130 :a1900000-a19fffff :a1800000-a18fffff *-pci : PCI bridge : Intel Corporation : Intel Corporation  ID: 1c   : pci@0000:00:1c.0 : 34 : 32 bits : 33MHz : pci pciexpress msi pm normal_decode bus_master cap_list : driver=pcieport : IRQ:117 :a1000000-a14fffff *-network :   : BCM4356 802.11ac Wireless Network Adapter : Broadcom Corporation  ID: 0   : pci@0000:01:00.0  : wlp1s0 : 02  ‚Ññ: b0:f1:ec:ed:56:a8 : 64 bits : 33MHz : pm msi pciexpress bus_master cap_list ethernet physical wireless : broadcast=yes driver=brcmfmac driverversion=7.35.180.119 firmware=01-1a5c4016 ip=192.168.1.142 latency=0 multicast=yes wireless=IEEE 802.11 : IRQ:125 :a1400000-a1407fff :a1000000-a13fffff *-isa : ISA bridge : Intel Corporation : Intel Corporation  ID: 1f   : pci@0000:00:1f.0 : 34 : 32 bits : 33MHz : isa bus_master cap_list : driver=lpc_ich latency=0 : IRQ:0</code> </pre> </div></div><br>  lspci: <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">00:00.0 Host bridge: Intel Corporation Device 2280 (rev 34) 00:02.0 VGA compatible controller: Intel Corporation Device 22b0 (rev 34) 00:0b.0 Signal processing controller: Intel Corporation Device 22dc (rev 34) 00:14.0 USB controller: Intel Corporation Device 22b5 (rev 34) 00:1a.0 Encryption controller: Intel Corporation Device 2298 (rev 34) 00:1c.0 PCI bridge: Intel Corporation Device 22c8 (rev 34) 00:1f.0 ISA bridge: Intel Corporation Device 229c (rev 34) 01:00.0 Network controller: Broadcom Corporation BCM4356 802.11ac Wireless Network Adapter (rev 02)</code> </pre></div></div><br>  La qualit√© de construction est bonne, elle ne joue rien, elle ne grince pas, elle ne se plie pas.  Le bo√Ætier est en aluminium et en g√©n√©ral, l'appareil donne l'impression d'une sorte de bloc monolithique.  C'est un plus. <br><br>  Mais il y a aussi assez de contre.  √âcran brillant.  Non, ce n'est pas seulement brillant - c'est litt√©ralement un miroir.  C'est-√†-dire que vous observerez votre r√©flexion dans des conditions d'√©clairage non nul.  Il y avait un film protecteur dans le kit, mais cela n'a pas r√©solu le probl√®me. <br><br>  Le second est le clavier.  Le fait qu'elle soit est magnifique. <br><br> <a href=""><img src="https://habrastorage.org/webt/zx/ac/cf/zxaccfpxwmrrsoxazzhah3yffk0.jpeg"></a> <br><br>  Mais la fa√ßon dont il est mis en ≈ìuvre est honte et horreur.  Essayer de pirater sous le macbook, avec ces gros espaces entre les boutons - eh bien, pourquoi?  Apr√®s tout, le public cible, semble-t-il, n'est pas des chatons glamour - ils prennent juste le prochain ipad ou macbook.  N'ayez pas ces lacunes malheureuses, la taille des cl√©s pourrait √™tre agrandie. <br><br>  Le bouton Fn a une couche tr√®s maigre: ce sont 2 boutons pour r√©gler la luminosit√©, F1-F12 et Ins√©rer.  Pourquoi avons-nous besoin de la rang√©e du haut?  Il pourrait √™tre impl√©ment√© comme une couche distincte. <br><br>  Les utilisateurs de Vim sont particuli√®rement douloureux et souffrent avec un deux-points plac√© dans la rang√©e inf√©rieure √† c√¥t√© de ctrl. <br><br>  D'accord, tout va mal, nous allons le traiter, car il y a plusieurs fa√ßons (plus de d√©tails ci-dessous). <br><br>  Oh oui, il y a un trackpoint ici.  Ce qui pour moi, en tant qu'utilisateur exp√©riment√© de ThinkPad, me r√©chauffe l'√¢me.  Une seule chose mais: le trackpoint est situ√© au mauvais endroit et pour l'utiliser, vous devez plier le pouce.  Ceci, malheureusement, est incurable.  Mais pour quelques bonnets rouges suppl√©mentaires dans le kit, bien s√ªr, merci. <br><br>  Point de rep√®re de la personne en bonne sant√©: <br><img src="https://habrastorage.org/webt/hl/qp/9_/hlqp9_0jr_ergvl5hklnu3js1l4.jpeg"><br><br>  Trackpoint du fumeur: <br><img src="https://habrastorage.org/webt/vm/be/dm/vmbedms-h1ze_4cnu9_vpecgtri.jpeg"><br><br><h2>  Installer et configurer Linux sur GPD Pocket </h2><br>  Il est clair que les "fen√™tres", et les "fen√™tres 10" en particulier, ne sont pas ce dont j'ai besoin sur cet appareil, mais sont simplement contre-indiqu√©es. <br><br>  En raison des caract√©ristiques de l'appareil, telles que l'orientation de l'√©cran (il est tourn√© sur le c√¥t√©), il est impossible de simplement prendre et installer votre Debian pr√©f√©r√©e sans danser avec un tambourin. <br><br> <a href=""><img src="https://habrastorage.org/webt/j_/xy/ai/j_xyai5nsa-njzt67cjgkq4joq4.jpeg"></a> <br><br>  En principe, le site officiel a l'image officielle d'Ubuntu LTS 16.04 (qui me semble une bonne alternative √† Debian stable), mais apr√®s avoir lu les discussions sur Internet, il a √©t√© d√©cid√© d'utiliser le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GPD Pocket Ubuntu Respin</a> <br><br>  Je souligne, en g√©n√©ral, la chose √©vidente que seule une image construite sur Ubuntu peut √™tre utilis√©e et alimenter un script, par exemple, Debian, ne fonctionnera pas: <br><br><pre> <code class="plaintext hljs">$./build.sh debian-9.3.0-amd64-netinst.iso Display setting: Xorg-Standard Looking for kernel image... Extracting kernel files... Archive: gpdpocket-20180115-kernel-files.zip inflating: linux-headers-4.15.0-rc7-stockmind-gpdpocket_4.15.0-rc7-stockmind-gpdpocket-1_amd64.deb inflating: linux-image-4.15.0-rc7-stockmind-gpdpocket_4.15.0-rc7-stockmind-gpdpocket-1_amd64.deb inflating: linux-libc-dev_4.15.0-rc7-stockmind-gpdpocket-1_amd64.deb ./isorespin.sh: 'debian-9.3.0-amd64-netinst.iso' must be an Ubuntu (or Ubuntu flavour), Linux Mint, neon, elementary, BackBox or Peppermint desktop ISO.</code> </pre><br>  √Ä la sortie, nous obtenons le fichier linuxium-xubuntu-16.04-desktop-amd64.iso, que nous √©crivons sur la cl√© USB: <br><br><pre> <code class="plaintext hljs">#dd if=linuxium-xubuntu-16.04-desktop-amd64.iso of=/dev/sdX</code> </pre> <br>  Nous d√©marrons √† partir de celui-ci en d√©finissant le p√©riph√©rique de d√©marrage, en allant dans les param√®tres UEFI avec le bouton Supprimer au d√©marrage. <br><br>  La proc√©dure d'installation est triviale, je ne vois aucun sens √† la diffusion.  Je note seulement qu'il est pr√©f√©rable de le produire √† partir du mode Live, donc l'√©cran ne sera pas tourn√© sur le c√¥t√©. <br><br>  J'utilise le cryptage complet du disque, au cas o√π l'appareil serait soudainement perdu ou vol√©.  Donc, au moins, toutes vos cl√©s ssh (oui, je connais la protection par mot de passe et ssh-agent) et les connexions aux ressources Internet resteront intactes.  Par cons√©quent, je mets LVM sur LUKS, que je vous souhaite √©galement. <br><br><h2>  Corriger les curvulines </h2><br><h3>  Sommeil et hibernation </h3><br>  Ce serait bien de pouvoir jeter un ordinateur portable dans un sac et de l'oublier jusqu'√† ce qu'il soit n√©cessaire.  Heureusement, la taille et le poids le permettent.  Ce serait bien de ne pas d√©marrer, √† chaque fois, les applications n√©cessaires manuellement, mais simplement de continuer √† travailler l√† o√π vous vous √©tiez arr√™t√©. <br><br>  Le mode veille, semble-t-il, fonctionne hors de la bo√Æte.  Il est impl√©ment√© par des moyens r√©guliers, c'est-√†-dire via systemctl suspend.  Cependant, empiriquement, il a √©t√© constat√© que la consommation d'√©nergie dans ce mode n'est pas tr√®s inf√©rieure √† la consommation au ralenti.  Apparemment, l'appareil √©teint simplement l'√©cran, les interfaces r√©seau et √©teint le refroidisseur.  En cons√©quence, la batterie atterrira en z√©ro jour pendant deux jours. <br><br>  Besoin d'hibernation.  L'hibernation systemctl r√©guli√®re s'est av√©r√©e inop√©rante: l'√©tat est vid√© dans un swap, mais il ne peut pas r√©cup√©rer au d√©marrage. <br><br>  Je me suis souvenu qu'il existe un tel projet - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Userspace Software Suspend</a> et ses packages sont dans le r√©f√©rentiel. <br><br><pre> <code class="plaintext hljs">#apt install hibernate</code> </pre> <br>  Nous v√©rifions: <br><br><pre> <code class="plaintext hljs">#hibernate-disk</code> </pre> <br>  Voila, √ßa marche!  Le syst√®me s'est arr√™t√© et s'est arr√™t√©.  Apr√®s avoir entr√© le mot de passe LUKS, r√©cup√©r√©.  Mais le son et le wifi √©taient couverts, la luminosit√© du r√©tro√©clairage de l'√©cran √©tait r√©initialis√©e au maximum.  Nous allons le terminer. <br><br><h3>  Installez le n√©cessaire </h3><br>  Avant de proc√©der √† la configuration d'ACPI, vous devrez installer plusieurs utilitaires. <br><br>  Donc, pour r√©gler la luminosit√© de l'√©cran est responsable du r√©tro-√©clairage. <br><br><pre> <code class="plaintext hljs">#apt install xbacklight</code> </pre> <br>  L'ordinateur portable n'est pas un disque dur, mais un lecteur flash, donc je ne veux pas le tuer avec un swap.  Il y a une telle chose <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ZRam</a> , ici nous allons l'utiliser.  Maintenant, tout est simple avec cela, vous n'avez pas besoin de prescrire des feuilles dans rc.local, et il vous suffit de faire ce qui suit: <br><br><pre> <code class="plaintext hljs">#apt install zram-config #sudo systemctl enable zram-config.service</code> </pre><br>  Le script lui-m√™me calculera la quantit√© de m√©moire requise et fera un swapon. <br><br>  Comme correctement not√© dans les commentaires, la ressource flash mange non seulement le swap, mais aussi la journalisation.  Par cons√©quent, / tmp et / var / log seront plac√©s dans ram sur tmpfs.  Pour ce faire, ajoutez deux lignes √† / etc / fstab: <br><br><pre> <code class="plaintext hljs">tmpfs /tmp tmpfs nodev,nosuid,size=256M 0 0 tmpfs /var/log tmpfs nodev,nosuid,size=512M 0 0</code> </pre><br><br><h3>  Nous finissons acpi </h3><br>  Tout d'abord, d√©sactivez les gestionnaires systemg'shnyh.  Puisqu'il fait tout par ses propres moyens, mais ils sont inop√©rants.  Devise - nous faisons tout, mais nous faisons mal.  Par exemple, il n'a pas appris √† g√©rer la connexion d'un adaptateur d'alimentation ou d'un casque, de touches ou similaires. <br><br><div class="spoiler">  <b class="spoiler_title">Il a mang√© de l'acide et a toujours faim!</b>  <b class="spoiler_title">(4 Mo)</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/3g/yu/fa/3gyufa5pfygiidcnl4zw2xxmcxi.gif"></div></div><br>  /etc/systemd/logind.conf <br><br><pre> <code class="plaintext hljs">HandlePowerKey=ignore HandleLidSwitch=ignore</code> </pre><br><pre> <code class="plaintext hljs">#systemctl restart systemd-logind.service</code> </pre> <br>  Le d√©mon acpid est responsable du traitement des √©v√©nements acpi, dont les fichiers de configuration sont soudainement stock√©s dans / etc / acpi. <br><br>  Nous enverrons l'ordinateur portable en veille prolong√©e en appuyant sur le bouton d'alimentation.  Pour ce faire, modifiez les fichiers suivants (s'ils ne le sont pas, vous devez les cr√©er): <br><br>  / etc / acpi / events / powerbtn <br><br><pre> <code class="plaintext hljs">event=button[ /]power action=/etc/acpi/hibernate.sh</code> </pre><br>  /etc/acpi/hibernate.sh (avec commentaires) <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#!/bin/bash #    ,        LUKS mv /home/user/bin/lock /home/user/bin/nolock # - killall -9 pulseaudio # zram   swap systemctl stop zram-config.service swapon /dev/xubuntu-vg/swap_1 #    DISPLAY=:0.0 su user -c "xbacklight &gt;/tmp/xbl" #    umount -alt nfs4 umount -alt cifs # wpa_supplicant /sbin/wpa_cli suspend hibernate-disk sleep 2 #   DISPLAY=:0.0 su user -c "xbacklight -set `cat /tmp/xbl`" # wpa_supplicant /sbin/wpa_cli resume #  alsa,    . -     /sbin/alsa force-reload #     .  ,      DAC1,            amixer -c 1 set 'DAC1' 90% #    ,        killall i3lock #    mv /home/user/bin/nolock /home/user/bin/lock # zram systemctl start zram-config.service #    swapoff /dev/xubuntu-vg/swap_1</code> </pre></div></div><br>  L'hibernation automatique √† faible charge n'est pas facile √† mettre en ≈ìuvre, mais tr√®s simple: <br><br><pre> <code class="plaintext hljs">#apt install acpi</code> </pre> <br>  /etc/acpi/ifbatlowgotosleep.sh <br><br><pre> <code class="plaintext hljs">#!/bin/bash level=`/usr/bin/acpi -b|sed '/unava/d'|awk -F\ '{ print $4 }'|sed -e 's/,//' -e's/%//'` if [ "$level" -lt "10" ] then /etc/acpi/hibernate.sh fi</code> </pre><br>  Le script v√©rifie l'√©tat de charge.  S'il est inf√©rieur √† 10%, il ex√©cute le script d'hibernation ci-dessus. <br><br>  L'ex√©cution p√©riodique est d√©finie via crontab: <br><br><pre> <code class="plaintext hljs">$sudo crontab -e */3 * * * * /etc/acpi/ifbatlowgotosleep.sh 2&gt;/dev/null</code> </pre><br>  Dans mon cas, la batterie est interrog√©e toutes les 3 minutes. <br><br>  Le mode veille (systemctl suspend), comme mentionn√© ci-dessus, est assez inutile.  Par cons√©quent, je ne vois aucune raison de l'activer lors de la fermeture du couvercle.  De plus, il peut y avoir un d√©sir, par exemple, d'√©couter de la musique √† partir d'un ordinateur portable ferm√© dans votre poche (ce n'est pas pour rien qu'il s'agit de ¬´poche¬ª). <br><br>  Par cons√©quent, nous √©teignons simplement l'√©cran lors de la fermeture et l'allumons lors de l'ouverture. <br><br>  Supprimez / etc / acpi / lidbtn. <br><br>  Nous cr√©ons et √©ditons: <br><br>  / etc / acpi / events / lidclose: <br><br><pre> <code class="plaintext hljs">event=button/lid LID close action=/etc/acpi/lidclose.sh</code> </pre><br>  / etc / acpi / events / lidopen: <br><br><pre> <code class="plaintext hljs">event=button/lid LID open action=/etc/acpi/lidopen.sh</code> </pre><br>  /etc/acpi/lidopen.sh <br><br><pre> <code class="plaintext hljs">DISPLAY=:0.0 su user -c "xrandr --output DSI1 --off"</code> </pre> <br>  /etc/acpi/lidclose.sh <br><br><pre> <code class="plaintext hljs">DISPLAY=:0.0 su user -c "xrandr --output DSI1 --auto --rotate right --dpi 200"</code> </pre> <br>  R√©glez la valeur DPI √† votre convenance, et l'utilisateur est le nom simple de mon compte (changez-le en le v√¥tre). <br><br><h3>  Configuration des touches de contr√¥le du son et de la luminosit√© </h3><br>  Nous le faisons √† travers tous les m√™mes √©v√©nements acpi. <br><br>  / etc / acpi / events / voldown <br><br><pre> <code class="plaintext hljs">event=button[ /]volumedown action=/etc/acpi/volume-down.sh</code> </pre><br>  / etc / acpi / events / volup <br><br><pre> <code class="plaintext hljs">event=button[ /]volumeup action=/etc/acpi/volume-up.sh</code> </pre><br>  / etc / acpi / events / mute <br><br><pre> <code class="plaintext hljs">event=button[ /]mute action=/etc/acpi/volume-toggle.sh</code> </pre><br>  Scripts: <br><br>  /etc/acpi/volume-toggle.sh <br><br><pre> <code class="plaintext hljs">amixer -c 1 set 'Speaker Channel' toggle amixer -c 1 set 'Headphone Channel' toggle</code> </pre><br>  /etc/acpi/volume-up.sh <br><br><pre> <code class="plaintext hljs">amixer -c 1 set 'Headphone' 5%+ amixer -c 1 set 'Speaker' 5%+</code> </pre><br>  /etc/acpi/volume-down.sh <br><br><pre> <code class="plaintext hljs">amixer -c 1 set 'Headphone' 5%- amixer -c 1 set 'Speaker' 5%-</code> </pre><br>  De m√™me pour la luminosit√©: <br>  / etc / acpi / events / bdown <br><br><pre> <code class="plaintext hljs">event=button[ /]brightnessdown action=/etc/acpi/bdown.sh</code> </pre><br>  / etc / acpi / events / bup <br><br><pre> <code class="plaintext hljs">event=button[ /]brightnessup action=/etc/acpi/bup.sh</code> </pre><br>  /etc/acpi/bup.sh <br><br><pre> <code class="plaintext hljs">DISPLAY=:0.0 su user -c "xbacklight -inc 5%"</code> </pre><br>  /etc/acpi/bdown.sh <br><br><pre> <code class="plaintext hljs">DISPLAY=:0.0 su user -c "xbacklight -dec 5%"</code> </pre><br>  Permettez-moi de vous rappeler que l'utilisateur est le nom de mon compte.  Entrez le v√¥tre. <br><br><h3>  Casque </h3><br>  Merde ^ W Une puce Realtek ALC5645 particuli√®re n'est pas en mesure de d√©sactiver ind√©pendamment les haut-parleurs lorsque des √©couteurs sont connect√©s.  Vous devez apprendre au syst√®me comment le faire vous-m√™me. <br><br>  Il existe un tel script dans respin: <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#!/bin/bash set -e -u if [ "$1" = "jack/headphone" -a "$2" = "HEADPHONE" ]; then case "$3" in plug) sink="[Out] Headphones" ;; *) sink="[Out] Speaker" ;; esac for userdir in /run/user/*; do uid="$(basename $userdir)" user="$(id -un $uid)" if [ -f "$userdir/pulse/pid" ]; then su "$user" -c "pacmd set-sink-port alsa_output.platform-cht-bsw-rt5645.HiFi__hw_chtrt5645__sink $sink" fi done fi</code> </pre></div></div><br>  Mais √ßa ne marche pas.  Tente de passer par le contr√¥le de synchronisation de l'audio, mais il √©choue.  Parce que: <br><br><pre> <code class="plaintext hljs">$sudo su #su user -c "pacmd set-sink-port alsa_output.platform-cht-bsw-rt5645.HiFi__hw_chtrt5645__sink '[Out] Speaker'"    PulseAudio,        .</code> </pre><br>  La solution est simple: lorsque le processus audio n'a pas encore √©t√© appel√© par le client, il n'y a rien avec qui contacter pacmd.  Vous pouvez bien s√ªr ajouter la ligne de lancement de celui-ci √† rc.local, xinitrc ou m√™me √©crire une unit√© systemg distincte, mais j'ai pens√© qu'il valait mieux planifier ma propre b√©quille que d'en r√©parer d'autres.  Et j'ai √©crit mon propre sc√©nario, beaucoup moins monstrueux et sophistiqu√©, je pense. <br><br>  /etc/acpi/headphone-jack.sh <br><br><pre> <code class="plaintext hljs">#!/bin/bash set -e -u if [ "$3" = "plug" ]; then amixer -c 1 set 'Speaker Channel' mute &gt;/dev/null amixer -c 1 set 'Headphone Channel' unmute &gt;/dev/null else amixer -c 1 set 'Speaker Channel' unmute &gt;/dev/null amixer -c 1 set 'Headphone Channel' mute &gt;/dev/null fi</code> </pre><br><h3>  Nous traitons la mise en page et d'autres petites choses </h3><br>  Comme d√©j√† mentionn√©, la mise en page me rend furieux.  Le bouton de suppression est l'endroit o√π la barre oblique inverse et la barre devraient √™tre, les deux-points dans la rang√©e du bas, il n'est pas clair pourquoi le menu cl√©, l'onglet est l'endroit o√π l'√©vasion est dans les claviers normaux ... <br><br>  Je ne peindrai pas en d√©tail, avec l'analyse, je vais juste apporter mon ~ / .xmodmaprc et d√©crire comment cela se fait. <br><br>  Pour commencer, nous devons attraper le code cl√©.  Cela se fait en utilisant le programme xev (#apt install xev, yes).  Ex√©cutez, appuyez sur la touche souhait√©e et obtenez une sortie comme: <br><br><pre> <code class="plaintext hljs">KeyPress event, serial 33, synthetic NO, window 0x3200001, root 0x2c0, subw 0x0, time 187713326, (979,493), root:(982,1078), state 0x0, keycode 119 (keysym 0xffff, Delete), same_screen YES, XLookupString gives 1 bytes: (7f) "" XmbLookupString gives 1 bytes: (7f) "" XFilterEvent returns: False</code> </pre><br>  Nous avons besoin de la valeur "keycode 119". <br><br>  Ensuite, ouvrez ~ / .xmodmaprc et √©crivez-y <br><br><pre> <code class="plaintext hljs">keycode 119 = backslash bar backslash bar</code> </pre> <br>  Et nous introduisons l'ex√©cution de "xmodmap ~ / .xmodmaprc" dans votre xinitrc ou tout ce qui est appel√© lorsque vous d√©marrez votre DE ou WM pr√©f√©r√©. <br><br>  Mon ~ / .xmodmaprc: <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">pointer = 1 2 3 4 5 remove Lock = Caps_Lock remove Control = Control_L keycode 0x42 = Control_L keycode 135 = Alt_R keycode 0x25 = Super_R keycode 133 = Super_R add Control = Control_L keycode 113 = Left keycode 111 = Up keycode 114 = Right keycode 116 = Down keycode 110 = Home keycode 115 = End keycode 108 = ISO_Next_Group keycode 136 = ISO_First_Group keycode 49 = asciitilde grave asciitilde grave keycode 119 = backslash bar backslash bar keycode 51 = Delete keycode 48 = colon semicolon Cyrillic_zhe Cyrillic_ZHE keycode 47 = apostrophe quotedbl Cyrillic_e Cyrillic_E keycode 130 = XF86Explorer keycode 121 = XF86AudioMute keycode 198 = XF86AudioMicMute keycode 122 = XF86AudioLowerVolume keycode 123 = XF86AudioRaiseVolume keycode 37 = Tab clear mod5 add mod5 = XF86Explorer keycode 166 = Prior keycode 167 = Next</code> </pre></div></div><br>  Il utilise des choses douteuses pour la plupart des utilisateurs comme le transfert de ctrl vers caps-lock, tabulation vers ctrl_l, alt_gr vers menu et basculer la mise en page vers l'ancienne position altgr. <br><br>  J'utilise √©galement xcape pour √©muler la pression d'√©chappement avec un simple clic sur ctrl_l.  Appel√© comme ceci: <br><br><pre> <code class="plaintext hljs"> xcape -t 1000 -e "Control_L=Escape"</code> </pre> <br>  Comme je pr√©f√®re les th√®mes sombres qui sont plus confortables (j'ai une opinion, le raifort dirait) dans des conditions de faible luminosit√©, mais qui doivent souvent fonctionner en plein jour, il y a un petit truc: les couleurs de l'image peuvent √™tre invers√©es.  Pour ce faire, vous avez besoin du programme xcalib: <br><br><pre> <code class="plaintext hljs">#apt install xcalib</code> </pre> <br>  Inverser: <br><br><pre> <code class="plaintext hljs">$xcalib -i -a</code> </pre> <br>  Vous pouvez vous lier √† n'importe quel raccourci clavier pratique √† l'aide du gestionnaire de fen√™tres.  Je m'accroche √† Super_L + Backspace. <br><br><h2>  R√©sum√© </h2><br>  Les impressions de l'appareil sont plus positives que n√©gatives.  Je ne regrette pas l'argent d√©pens√©.  L'appareil ne prend pas beaucoup de place dans le sac, tient dans la poche d'un pantalon cargo et d'une veste de fum√©e. <br><br> <a href=""><img src="https://habrastorage.org/webt/xz/u5/a2/xzu5a2lnxboqgbrkw8chzh3zlzu.jpeg"></a> <br><br>  Cela fonctionne depuis longtemps √† partir de la batterie, pour le test j'ai fait d√©filer trois heures et demie des films avec le wifi allum√©, d√©charg√© quelque part de moiti√©.  Charge √† partir d'un paverbank avec USB-A via un adaptateur secteur. <br><br>  Toutes les curvulines molles rencontr√©es ont √©t√© trait√©es avec succ√®s. <br><br>  Il est regrettable qu'il n'y ait pas de port rj45, mais j'esp√®re qu'il sera r√©solu par l'adaptateur command√© avec USB.  L'absence de communications mobiles et de cam√©ras, d√©sormais, dans des conditions de surveillance totale, je pense plut√¥t un plus. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr409945/">https://habr.com/ru/post/fr409945/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr409933/index.html">Examen du SoC HiSilicon Kirin 970 Android - Performances et efficacit√©</a></li>
<li><a href="../fr409935/index.html">L'histoire "La vie est haute"</a></li>
<li><a href="../fr409937/index.html">Triomphe et vie quotidienne. Comment installer une fl√®che sur un gratte-ciel Lakhta Center. Partie 1</a></li>
<li><a href="../fr409939/index.html">Comment Bezos a r√©solu un probl√®me inattendu dans la publicit√© de sa colonne intelligente</a></li>
<li><a href="../fr409943/index.html">Pourquoi il est important que les √©coles consacrent plus de temps √† l'√©tude des math√©matiques discr√®tes</a></li>
<li><a href="../fr409947/index.html">Univers superfluide: la mati√®re noire comme condensat de Bose-Einstein</a></li>
<li><a href="../fr409949/index.html">Big Bang chaud et inflation</a></li>
<li><a href="../fr409951/index.html">Panneau LED avec WIFI Sonoff BN-SZ01</a></li>
<li><a href="../fr409953/index.html">Crise cardiaque et septic√©mie en 10 minutes</a></li>
<li><a href="../fr409955/index.html">Tesla r√©unit 50 000 foyers pauvres en Australie du Sud avec une centrale √©lectrique virtuelle de 250 MW</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>