<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ…ğŸ¿ âºï¸ ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ» ä½œæ›²å®¶æœ‰å¾ˆé•¿çš„çŸ­æœŸè®°å¿† ğŸ‘¦ğŸ» ğŸ’— ğŸ‘»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è‡ªåŠ¨ä½œæ›² 

 å­¦ä¹ ç¼–ç¨‹ä¹‹åï¼Œæˆ‘å‡ ä¹ç«‹å³æƒ³åˆ›å»ºèƒ½å¤Ÿåˆ›ä½œéŸ³ä¹çš„è½¯ä»¶ã€‚ 

 å‡ å¹´æ¥ï¼Œæˆ‘è¿›è¡Œäº†åŸå§‹çš„å°è¯•ï¼Œä»¥è‡ªåŠ¨ä¸ºâ€œæ··æ²Œè§†è§‰â€åˆ›ä½œéŸ³ä¹ã€‚ åŸºæœ¬ä¸Šï¼Œä½¿ç”¨ç®€å•çš„æ•°å­¦å…¬å¼æˆ–éŸ³ç¬¦éšæœºåºåˆ—çš„é—ä¼ çªå˜ã€‚ æˆ‘æœ€è¿‘åœ¨TensorFlowå’Œç¥ç»ç½‘ç»œçš„ç ”ç©¶å’Œåº”ç”¨ä¸­å–å¾—äº†ä¸€å®šçš„æˆåŠŸï¼Œå¹¶æˆåŠŸåœ°å¯»æ‰¾äº†ç»†èƒè‡ªåŠ¨æœº ï¼Œæˆ‘å†³å®šå°è¯•ä½¿ç”¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½œæ›²å®¶æœ‰å¾ˆé•¿çš„çŸ­æœŸè®°å¿†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470127/"><h2> è‡ªåŠ¨ä½œæ›² </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e91/f1e/b09/e91f1eb09e53ad458aaaeca5650b59aa.jpg" width="500"></div><br> å­¦ä¹ ç¼–ç¨‹ä¹‹åï¼Œæˆ‘å‡ ä¹ç«‹å³æƒ³åˆ›å»ºèƒ½å¤Ÿåˆ›ä½œéŸ³ä¹çš„è½¯ä»¶ã€‚ <br><br> å‡ å¹´æ¥ï¼Œæˆ‘è¿›è¡Œäº†åŸå§‹çš„å°è¯•ï¼Œä»¥è‡ªåŠ¨ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">â€œæ··æ²Œè§†è§‰â€</a>åˆ›ä½œéŸ³ä¹ã€‚ åŸºæœ¬ä¸Šï¼Œä½¿ç”¨ç®€å•çš„æ•°å­¦å…¬å¼æˆ–éŸ³ç¬¦éšæœºåºåˆ—çš„é—ä¼ çªå˜ã€‚ æˆ‘æœ€è¿‘åœ¨TensorFlowå’Œç¥ç»ç½‘ç»œçš„ç ”ç©¶å’Œåº”ç”¨ä¸­å–å¾—äº†ä¸€å®šçš„æˆåŠŸï¼Œå¹¶æˆåŠŸåœ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">å¯»æ‰¾äº†ç»†èƒè‡ªåŠ¨æœº</a> ï¼Œæˆ‘å†³å®šå°è¯•ä½¿ç”¨ç¥ç»ç½‘ç»œæ¥åˆ›ä½œéŸ³ä¹ã€‚ <br><br><h2> å¦‚ä½•è¿ä½œ </h2><br> ä½œæ›²å®¶æ•™äº†ä¸€ä¸ªå…·æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">é•¿</a>çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰çš„ç¥ç»ç½‘ç»œã€‚  LSTMç½‘ç»œéå¸¸é€‚åˆé¢„æµ‹æ•°æ®åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå†…å®¹ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">åœ¨æ­¤å¤„</a>é˜…è¯»æœ‰å…³LSTMçš„æ›´å¤šä¿¡æ¯ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0db/ce9/120/0dbce9120efb949af9aff64a8177c02f.png" title="LSTM-ä»¥è·å–åŸå§‹å°ºå¯¸" width="500"></div><br>  LSTMç½‘ç»œæ¥æ”¶å„ç§éŸ³ç¬¦åºåˆ—ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ˜¯å•é€šé“midiæ–‡ä»¶ï¼‰ã€‚ ç»è¿‡è¶³å¤Ÿçš„åŸ¹è®­ï¼Œå¥¹æœ‰æœºä¼šåˆ›ä½œä¸æ•™æç›¸ä¼¼çš„éŸ³ä¹ã€‚ <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f1/b32/98d/3f1b3298dededa70f51a95d42727aaf0.png" title="LSTM-ä»¥è·å–åŸå§‹å°ºå¯¸" width="500"></div><br>  LSTMå†…éƒ¨ç»“æ„ä¼¼ä¹ä»¤äººç”Ÿç•ï¼Œä½†æ˜¯ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">TensorFlow</a>å’Œ/æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">Keraså¯ä»¥</a>å¤§å¤§ç®€åŒ–LSTMçš„åˆ›å»ºå’Œå®éªŒã€‚ <br><br><h2> ç”¨äºæ¨¡å‹è®­ç»ƒçš„æºéŸ³ä¹ </h2><br> å¯¹äºè¿™æ ·ç®€å•çš„LSTMç½‘ç»œï¼Œå¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæºç»„æˆæ˜¯å•ä¸ªMidié€šé“å°±è¶³å¤Ÿäº†ã€‚ å¾ˆæ£’çš„æ˜¯ä»ç‹¬å¥åˆ°é’¢ç´çš„Midiæ–‡ä»¶ã€‚ æˆ‘åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">å¤å…¸é’¢ç´Midié¡µé¢</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">mfiles</a>ä¸Šæ‰¾åˆ°äº†å¸¦æœ‰é’¢ç´ç‹¬å¥çš„midiæ–‡ä»¶ï¼Œå¹¶ç”¨å®ƒä»¬æ¥è®­ç»ƒæˆ‘çš„æ¨¡å‹ã€‚ <br><br> æˆ‘å°†ä¸åŒä½œæ›²å®¶çš„éŸ³ä¹æ”¾åœ¨å•ç‹¬çš„æ–‡ä»¶å¤¹ä¸­ã€‚ å› æ­¤ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©Bachï¼Œå•å‡»â€œæ’°å†™â€æŒ‰é’®ï¼Œå¹¶è·å¾—ä¸€é¦–å¸Œæœ›ä¸Bachç›¸ä¼¼çš„æ­Œæ›²ã€‚ <br><br><h2>  LSTMæ¨¡å‹ </h2><br> æˆ‘ç¼–å†™ä»£ç æ‰€ä¾æ®çš„æ¨¡å‹é€‰æ‹©<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†</a>ä½œè€…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">SigurÃ°urSkÃºliSigurgeirssonçš„</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™ä¸ªç¤ºä¾‹ï¼Œ</a>ä»–åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æ­¤å¤„</a>è¯¦ç»†ä»‹ç»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">äº†</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯¥ç¤ºä¾‹</a> ã€‚ <br><br> æˆ‘è¿è¡Œäº†lstm.pyè„šæœ¬ï¼Œå¹¶åœ¨15å°æ—¶åå®Œæˆäº†åŸ¹è®­ã€‚ å½“æˆ‘è¿è¡Œpredict.pyç”Ÿæˆmidiæ–‡ä»¶æ—¶ï¼Œæˆ‘å¾ˆå¤±æœ›ï¼Œå› ä¸ºå®ƒä»¬ç”±ä¸€ä¸ªé‡å¤çš„éŸ³ç¬¦ç»„æˆã€‚ é‡å¤è®­ç»ƒä¸¤æ¬¡ï¼Œæˆ‘å¾—åˆ°ç›¸åŒçš„ç»“æœã€‚ <br><br> æºæ¨¡å‹ <br><br><pre><code class="python hljs">model = Sequential() model.add(CuDNNLSTM(<span class="hljs-number"><span class="hljs-number">512</span></span>,input_shape=(network_input.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], network_input.shape[<span class="hljs-number"><span class="hljs-number">2</span></span>]),return_sequences=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.3</span></span>)) model.add(CuDNNLSTM(<span class="hljs-number"><span class="hljs-number">512</span></span>, return_sequences=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.3</span></span>)) model.add(CuDNNLSTM(<span class="hljs-number"><span class="hljs-number">512</span></span>)) model.add(Dense(<span class="hljs-number"><span class="hljs-number">256</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.3</span></span>)) model.add(Dense(n_vocab)) model.add(Activation(<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)) model.compile(loss=<span class="hljs-string"><span class="hljs-string">'categorical_crossentropy'</span></span>, optimizer=<span class="hljs-string"><span class="hljs-string">'rmsprop'</span></span>,metrics=[<span class="hljs-string"><span class="hljs-string">"accuracy"</span></span>])</code> </pre> <br> å°†å›¾å½¢è¾“å‡ºæ·»åŠ åˆ°è„šæœ¬åï¼Œæˆ‘æ˜ç™½äº†ä¸ºä»€ä¹ˆæˆ‘çš„æ¨¡å‹ä¸èµ·ä½œç”¨ã€‚ å‡†ç¡®æ€§å¹¶æ²¡æœ‰éšç€æ—¶é—´çš„å¢é•¿è€Œå¢é•¿ã€‚ è¯·å‚é˜…ä¸‹é¢çš„å¸–å­ä¸­çš„å¥½å›¾ï¼Œè¿™äº›å›¾æ˜¾ç¤ºäº†å·¥ä½œæ¨¡å‹çš„å¤–è§‚ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28c/2ef/19d/28c2ef19dee58e8235a240b536162ceb.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå§‹å°ºå¯¸" width="500"></div><br> æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šè¿™æ ·ã€‚ ä½†æ”¾å¼ƒäº†è¯¥æ¨¡å‹å¹¶å¼€å§‹è°ƒæ•´è®¾ç½®ã€‚ <br><br><pre> <code class="python hljs">model = Sequential() model.add(CuDNNLSTM(<span class="hljs-number"><span class="hljs-number">512</span></span>, input_shape=(network_input.shape[<span class="hljs-number"><span class="hljs-number">1</span></span>], network_input.shape[<span class="hljs-number"><span class="hljs-number">2</span></span>]), return_sequences=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)) model.add(BatchNormalization()) model.add(CuDNNLSTM(<span class="hljs-number"><span class="hljs-number">256</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)) model.add(BatchNormalization()) model.add(Dense(<span class="hljs-number"><span class="hljs-number">128</span></span>, activation=<span class="hljs-string"><span class="hljs-string">"relu"</span></span>)) model.add(Dropout(<span class="hljs-number"><span class="hljs-number">0.2</span></span>)) model.add(BatchNormalization()) model.add(Dense(n_vocab)) model.add(Activation(<span class="hljs-string"><span class="hljs-string">'softmax'</span></span>)) model.compile(loss=<span class="hljs-string"><span class="hljs-string">'categorical_crossentropy'</span></span>, optimizer=<span class="hljs-string"><span class="hljs-string">'adam'</span></span>,metrics=[<span class="hljs-string"><span class="hljs-string">"accuracy"</span></span>])</code> </pre> <br> å®ƒæ›´ç´§å‡‘ï¼Œå…·æœ‰æ›´å°‘çš„LSTMå±‚ã€‚ æˆ‘è¿˜æ·»åŠ äº†BatchNormalizationï¼Œåœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">senddexè§†é¢‘ä¸­</a>çœ‹åˆ°äº†å®ƒã€‚ å¾ˆå¯èƒ½æœ‰æ›´å¥½çš„æ¨¡å‹ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å‹åœ¨æˆ‘æ‰€æœ‰çš„åŸ¹è®­è¯¾ç¨‹ä¸­éƒ½è¡¨ç°å¾ˆå¥½ã€‚ <br><br> æ³¨æ„ï¼Œåœ¨ä¸¤ä¸ªæ¨¡å‹ä¸­ï¼Œæˆ‘éƒ½ç”¨CuDNNLSTMæ›¿æ¢äº†LSTMã€‚ å› æ­¤ï¼Œç”±äºä½¿ç”¨äº†Cudaï¼Œæˆ‘è·å¾—äº†æ›´å¿«çš„LSTMåŸ¹è®­ã€‚ å¦‚æœæ‚¨æ²¡æœ‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æ”¯æŒCuda</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">GPU</a> ï¼Œåˆ™å¿…é¡»ä½¿ç”¨LSTMã€‚ æ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">sendtex</a>æä¾›çš„æŠ€å·§ã€‚ ä½¿ç”¨CuDNNLSTMå­¦ä¹ æ–°æ¨¡å‹å’Œç¼–å†™midiæ–‡ä»¶çš„é€Ÿåº¦å¿«å¤§çº¦äº”å€ã€‚ <br><br><h2> è¯¥æ¨¡å‹åº”è®­ç»ƒå¤šé•¿æ—¶é—´ </h2><br> ç»“æœä¸åŸå§‹éŸ³ä¹çš„ç›¸ä¼¼æ€§å–å†³äºæ¨¡å‹è®­ç»ƒçš„æŒç»­æ—¶é—´ï¼ˆæ—¶ä»£æ•°ï¼‰ã€‚ å¦‚æœæ—¶ä»£å¤ªå°‘ï¼Œé‚£ä¹ˆç»“æœå°†æœ‰å¤ªå¤šé‡å¤çš„éŸ³ç¬¦ã€‚ å¦‚æœæ—¶ä»£å¤ªå¤šï¼Œæ¨¡å‹å°†è¢«é‡æ–°è®­ç»ƒï¼Œåªéœ€å¤åˆ¶åŸå§‹éŸ³ä¹å³å¯ã€‚ <br><br> ä½†æ˜¯ä½ æ€ä¹ˆçŸ¥é“è¦åœæ­¢å¤šå°‘ä¸ªæ—¶ä»£å‘¢ï¼Ÿ <br><br> ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯æ·»åŠ ä¸€ä¸ªå›è°ƒï¼Œè¯¥å›è°ƒåœ¨500ä¸ªæ—¶ä»£è¿›è¡Œçš„è®­ç»ƒä¸­æ¯50ä¸ªæ—¶ä»£å­˜å‚¨æ¨¡å‹å’Œå‡†ç¡®æ€§/æŸå¤±å›¾ã€‚ å› æ­¤ï¼Œå®ŒæˆåŸ¹è®­åï¼Œæ‚¨å°†è·å¾—å¸¦æœ‰50ä¸ªæ—¶ä»£çš„å¢é‡çš„æ¨¡å‹å’Œå›¾å½¢ï¼Œæ˜¾ç¤ºäº†åŸ¹è®­çš„è¿›è¡Œæ–¹å¼ã€‚ <br><br> ä»¥ä¸‹æ˜¯æ¯50ä¸ªæ—¶ä»£ä¿å­˜ä¸€æ¬¡çš„è¿è¡Œç»“æœçš„å›¾å½¢ç»“æœï¼Œå¹¶åˆå¹¶ä¸ºä¸€ä¸ªåŠ¨ç”»GIFã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e93/357/716/e933577163ece7cc7e679edec71d0b90.gif"></div><br> è¿™äº›æ˜¯æˆ‘ä»¬æƒ³è¦çœ‹åˆ°çš„å›¾å½¢ã€‚ æŸå¤±åº”ä¸‹é™å¹¶ä¿æŒè¾ƒä½æ°´å¹³ã€‚ ç²¾åº¦åº”æé«˜å¹¶ä¿æŒæ¥è¿‘100ï¼…ã€‚ <br><br> å¿…é¡»ä½¿ç”¨ä¸€ä¸ªæ¨¡å‹ï¼Œè¯¥æ¨¡å‹å…·æœ‰ä¸å›¾é¦–æ¬¡è¾¾åˆ°å…¶æé™çš„æ—¶åˆ»ç›¸å¯¹åº”çš„æ—¶æœŸæ•°ã€‚ å¯¹äºä¸Šé¢æ˜¾ç¤ºçš„å›¾è¡¨ï¼Œå°†æ˜¯150ä¸ªæ—¶ä»£ã€‚ å¦‚æœä½¿ç”¨è¾ƒæ—§çš„æ¨¡å‹ï¼Œåˆ™å°†å¯¹å®ƒä»¬è¿›è¡Œé‡æ–°åŸ¹è®­ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½ä¼šå¯¼è‡´å¯¹åŸå§‹èµ„æ–™çš„ç®€å•å¤åˆ¶ã€‚ <br><br> å¯¹åº”äºè¿™äº›åˆ—çš„æ¨¡å‹åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">ä»æ­¤å¤„</a>è·å–çš„Anthemsç±»åˆ«çš„midiæ–‡ä»¶ä¸Šè¿›è¡Œäº†è®­ç»ƒã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åœ¨å…·æœ‰150ä¸ªæ—¶ä»£çš„æ¨¡å‹ä¸­è¾“å‡ºmidiæ•°æ®ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br>  100å‘¨æœŸæ¨¡å‹ä¸­çš„Midiè¾“å‡ºã€‚ <br><br> å³ä½¿æ˜¯å…·æœ‰100ä¸ªæ—¶ä»£çš„æ¨¡å‹ï¼Œä¹Ÿå¯èƒ½ä¼šè¿‡äºç²¾ç¡®åœ°å¤åˆ¶æºã€‚ è¿™å¯èƒ½æ˜¯ç”±äºè¦è¿›è¡ŒåŸ¹è®­çš„Midiæ–‡ä»¶æ ·æœ¬ç›¸å¯¹è¾ƒå°‘ã€‚ æœ‰äº†æ›´å¤šçš„ç¬”è®°ï¼Œå­¦ä¹ ä¼šæ›´å¥½ã€‚ <br><br><h2> å½“å­¦ä¹ ä¸å¥½æ—¶ </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/166/c17/97c/166c1797ceb0baa6894a982d55ce12ed.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå§‹å°ºå¯¸" width="500"></div><br> ä¸Šå›¾æ˜¾ç¤ºäº†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å¯èƒ½å‘ç”Ÿå’Œå‘ç”Ÿçš„äº‹æƒ…çš„ç¤ºä¾‹ã€‚ ä¸å¾€å¸¸ä¸€æ ·ï¼ŒæŸå¤±å‡å°‘äº†ï¼Œå‡†ç¡®æ€§æé«˜äº†ï¼Œä½†æ˜¯çªç„¶ä¹‹é—´ï¼Œå®ƒä»¬å¼€å§‹å˜å¾—ç–¯ç‹‚ã€‚ åœ¨æ­¤é˜¶æ®µï¼Œå¯èƒ½è¿˜éœ€è¦åœæ­¢ã€‚ è¯¥æ¨¡å‹å°†ä¸å†ï¼ˆè‡³å°‘ä»¥æˆ‘çš„ç»éªŒï¼‰ä¸å†æ­£ç¡®å­¦ä¹ ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¿å­˜çš„å…·æœ‰100ä¸ªæ—¶ä»£çš„æ¨¡å‹ä»ç„¶è¿‡äºéšæœºï¼Œè€Œå…·æœ‰150ä¸ªæ—¶ä»£çš„æ¨¡å‹å·²ç»è¿‡äº†å¤±æ•ˆçš„æ—¶åˆ»ã€‚ ç°åœ¨ï¼Œæˆ‘æ¯25ä¸ªä¸–çºªå°±å¾—æ•‘ä¸€æ¬¡ï¼Œå³ä½¿åœ¨å¥¹å†è®­ç»ƒå’Œæ’è½¦ä¹‹å‰ï¼Œä¹Ÿèƒ½é€šè¿‡æœ€å¥½çš„åŸ¹è®­å‡†ç¡®åœ°æ‰¾åˆ°æ¨¡å‹çš„ç†æƒ³æ—¶åˆ»ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/486/65a/eea/48665aeea577e093ad0d944a4b4a3a35.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå§‹å°ºå¯¸" width="500"></div><br> å­¦ä¹ é”™è¯¯çš„å¦ä¸€ä¸ªä¾‹å­ã€‚ æ­¤æ¨¡å‹æ˜¯åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">ä»æ­¤å¤„</a>è·å–çš„Midiæ–‡ä»¶ä¸Šè¿›è¡Œè®­ç»ƒçš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¥¹ä¿æŒäº†200å¤šä¸ªæ—¶ä»£ã€‚ å½“ä½¿ç”¨å…·æœ‰200ä¸ªæ—¶ä»£çš„æ¨¡å‹æ—¶ï¼Œåœ¨Midiä¸­å¯è·å¾—ä»¥ä¸‹ç»“æœã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> å¦‚æœä¸åˆ›å»ºå›¾å½¢ï¼Œæˆ‘ä»¬å°†æ°¸è¿œæ— æ³•çŸ¥é“æ¨¡å‹æ˜¯å¦å­˜åœ¨é—®é¢˜ä»¥åŠä½•æ—¶å‡ºç°é—®é¢˜ï¼Œè€Œä¸”å¦‚æœä¸ä»å¤´å¼€å§‹ï¼Œå°±æ— æ³•è·å¾—å¥½çš„æ¨¡å‹ã€‚ <br><br><h2> å…¶ä»–ä¾‹å­ </h2><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">è‚–é‚¦</a>çš„æ„å›¾åˆ›å»ºçš„å…·æœ‰75ä¸ªæ—¶ä»£çš„æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">Midiæ–‡ä»¶çš„</a> 50å¹´ä»£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">åœ£è¯èŠ‚ä½œæ–‡æ¨¡å‹</a> ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> ä¸€ä¸ªåŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">Midiæ–‡ä»¶çš„</a> 100ä¸ªå‘¨æœŸ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">çš„åœ£è¯èŠ‚ä½œæ–‡æ¨¡å‹</a> ã€‚ ä½†æ˜¯ä»–ä»¬çœŸçš„æ˜¯â€œåœ£è¯èŠ‚â€å—ï¼Ÿ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æ­¤å¤„</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æ­¤å¤„</a>è·å–çš„å·´èµ«Midiæ–‡ä»¶çš„300å†æ—¶æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäºBalakirevå”¯ä¸€çš„Midiæ–‡ä»¶çš„200å†æ—¶æ¨¡å‹ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æ­¤å¤„ä¸º</a> ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">Debussy</a>åˆæˆï¼Œå…·æœ‰200ä¸ªæ—¶ä»£çš„æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäºè«æ‰ç‰¹ä½œå“çš„175å¹´ä»£æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">èˆ’ä¼¯ç‰¹</a>æ„å›¾çš„å…·æœ‰100ä¸ªæ—¶ä»£çš„æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">èˆ’æ›¼</a>æ„å›¾çš„200å¹´ä»£æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æŸ´å¯å¤«æ–¯åŸºä½œå“çš„</a> 200å¹´ä»£æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäºæ°‘æ­Œçš„175ä¸ªæ—¶ä»£çš„æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäºæ‘‡ç¯®æ›²çš„100ä¸ªæ—¶ä»£çš„æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäºå©šç¤¼éŸ³ä¹çš„100å¹´ä»£æ¨¡å‹ã€‚ <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b21/d24/c00/b21d24c00c73a214714352d2c3b1f900.png" title="ç‚¹å‡»ä»¥å¬Midi" width="26"></a> <br><br> åŸºäºä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">YouTubeè§†é¢‘</a>éŸ³è½¨ä¸­æå–çš„è‡ªå·±çš„midiæ–‡ä»¶çš„200å†æ—¶æ¨¡å‹ã€‚ å¯èƒ½éœ€è¦é‡æ–°åŸ¹è®­ï¼Œå› ä¸ºå®ƒåŸºæœ¬ä¸Šä¼šç”Ÿæˆæˆ‘çš„çŸ­ä¸€å†²ç¨‹å’ŒäºŒå†²ç¨‹Midiæ–‡ä»¶çš„å‰¯æœ¬ã€‚ <br><br><h2> åˆ†æ•° </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">è·å¾—</a> Midiæ–‡ä»¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">SolMiRe</a>ç­‰åœ¨çº¿å·¥å…·å°†å…¶è½¬æ¢ä¸ºä¹è°±ã€‚ ä»¥ä¸‹æ˜¯ä¸Šé¢æ˜¾ç¤ºçš„midi Softology 200ä¸ªæ—¶ä»£æ–‡ä»¶çš„åˆ†æ•°ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1e4/7fe/2cc/1e47fe2cc3cada4e27671bfe27397226.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå§‹å°ºå¯¸" width="500"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccd/2ff/dff/ccd2ffdff1344ef7ad97a210dba6b17e.jpg" title="ç‚¹å‡»æŸ¥çœ‹åŸå§‹å°ºå¯¸" width="500"></div><br><h2> æˆ‘åœ¨å“ªé‡Œå¯ä»¥æµ‹è¯•ä½œæ›²å®¶ </h2><br>  LSTM Composerç°åœ¨åŒ…å«åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">â€œè§†è§‰å¼‚è±¡â€ä¸­</a> ã€‚ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/29c/abd/6ac/29cabd6acecf1baf6fd9f99e531d1f9e.jpg" width="500"></div><br> ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ç§æ ·å¼ï¼Œç„¶åå•å‡»â€œæ’°å†™â€ã€‚ å¦‚æœæ‚¨å®‰è£…äº†æœ€ä½é™åº¦çš„å¿…éœ€Pythonå’ŒTensorFlowï¼ˆè¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="noopener">æ­¤å¤„çš„</a>è¯´æ˜ï¼‰ï¼Œé‚£ä¹ˆåœ¨å‡ ç§’é’Ÿå†…ï¼ˆå¦‚æœæ‚¨å…·æœ‰å¿«é€Ÿçš„GPUï¼‰ï¼Œæ‚¨å°†æ”¶åˆ°ä¸€ä¸ªæ–°çš„æœºå™¨ç¼–å†™çš„midiæ–‡ä»¶ï¼Œæ‚¨å¯ä»¥æ”¶å¬è¯¥æ–‡ä»¶å¹¶ç”¨äºå…¶ä»–ç›®çš„ã€‚ æ²¡æœ‰ç‰ˆæƒï¼Œæ²¡æœ‰ä¸“åˆ©æƒã€‚ å¦‚æœæ‚¨ä¸æ»¡æ„ç»“æœï¼Œåˆ™å¯ä»¥å†æ¬¡å•å‡»â€œæ’°å†™â€ï¼Œå‡ ç§’é’Ÿåä¾¿å¯ä»¥å‡†å¤‡ä¸€ä¸ªæ–°çš„ä½œå“ã€‚ <br><br> ç»“æœè¿˜ä¸èƒ½ç®—æ˜¯æˆç†Ÿçš„ä½œå“ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä¸€äº›æœ‰è¶£çš„å°éŸ³ç¬¦åºåˆ—ï¼Œæˆ‘å°†æ¥ä¼šç”¨å®ƒä»¬æ¥åˆ›ä½œéŸ³ä¹ã€‚ åœ¨è¿™æ–¹é¢ï¼ŒLSTMä½œæ›²å®¶å¯ä»¥æˆä¸ºæ–°ä½œå“çµæ„Ÿçš„è‰¯å¥½æ¥æºã€‚ <br><br><h2>  Pythonæºç  </h2><br> ä»¥ä¸‹æ˜¯æˆ‘ç”¨äºLSTMè®­ç»ƒå’Œé¢„æµ‹çš„Pythonè„šæœ¬ä»£ç ã€‚ è¦ä½¿è¿™äº›è„šæœ¬èµ·ä½œç”¨ï¼Œå°±ä¸å¿…å®‰è£…Visions of Chaosï¼Œå¹¶ä¸”å¯ä»¥ä»å‘½ä»¤è¡Œå­¦ä¹ å’Œç”Ÿæˆmidiã€‚ <br><br> è¿™æ˜¯è®­ç»ƒè„šæœ¬<code>lstm_music_train.py</code> <br><br><div class="spoiler">  <b class="spoiler_title">lstm_music_train.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># based on code from https://github.com/Skuldur/Classical-Piano-Composer # to use this script pass in; # 1. the directory with midi files # 2. the directory you want your models to be saved to # 3. the model filename prefix # 4. how many total epochs you want to train for # eg python -W ignore "C:\\LSTM Composer\\lstm_music_train.py" "C:\\LSTM Composer\\Bach\\" "C:\\LSTM Composer\\" "Bach" 500 import os import tensorflow as tf # ignore all info and warning messages os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2' tf.compat.v1.logging.set_verbosity(tf.compat.v1.logging.ERROR) import glob import pickle import numpy import sys import keras import matplotlib.pyplot as plt from music21 import converter, instrument, note, chord from datetime import datetime from keras.models import Sequential from keras.layers.normalization import BatchNormalization from keras.layers import Dense from keras.layers import Dropout from keras.layers import CuDNNLSTM from keras.layers import Activation from keras.utils import np_utils from keras.callbacks import TensorBoard from shutil import copyfile # name of midi file directory, model directory, model file prefix, and epochs mididirectory = str(sys.argv[1]) modeldirectory = str(sys.argv[2]) modelfileprefix = str(sys.argv[3]) modelepochs = int(sys.argv[4]) notesfile = modeldirectory + modelfileprefix + '.notes' # callback to save model and plot stats every 25 epochs class CustomSaver(keras.callbacks.Callback): def __init__(self): self.epoch = 0 # This function is called when the training begins def on_train_begin(self, logs={}): # Initialize the lists for holding the logs, losses and accuracies self.losses = [] self.acc = [] self.logs = [] def on_epoch_end(self, epoch, logs={}): # Append the logs, losses and accuracies to the lists self.logs.append(logs) self.losses.append(logs.get('loss')) self.acc.append(logs.get('acc')*100) # save model and plt every 50 epochs if (epoch+1) % 25 == 0: sys.stdout.write("\nAuto-saving model and plot after {} epochs to ".format(epoch+1)+"\n"+modeldirectory + modelfileprefix + "_" + str(epoch+1).zfill(3) + ".model\n"+modeldirectory + modelfileprefix + "_" + str(epoch+1).zfill(3) + ".png\n\n") sys.stdout.flush() self.model.save(modeldirectory + modelfileprefix + '_' + str(epoch+1).zfill(3) + '.model') copyfile(notesfile,modeldirectory + modelfileprefix + '_' + str(epoch+1).zfill(3) + '.notes'); N = numpy.arange(0, len(self.losses)) # Plot train loss, train acc, val loss and val acc against epochs passed plt.figure() plt.subplots_adjust(hspace=0.7) plt.subplot(2, 1, 1) # plot loss values plt.plot(N, self.losses, label = "train_loss") plt.title("Loss [Epoch {}]".format(epoch+1)) plt.xlabel('Epoch') plt.ylabel('Loss') plt.subplot(2, 1, 2) # plot accuracy values plt.plot(N, self.acc, label = "train_acc") plt.title("Accuracy % [Epoch {}]".format(epoch+1)) plt.xlabel("Epoch") plt.ylabel("Accuracy %") plt.savefig(modeldirectory + modelfileprefix + '_' + str(epoch+1).zfill(3) + '.png') plt.close() # train the neural network def train_network(): sys.stdout.write("Reading midi files...\n\n") sys.stdout.flush() notes = get_notes() # get amount of pitch names n_vocab = len(set(notes)) sys.stdout.write("\nPreparing note sequences...\n") sys.stdout.flush() network_input, network_output = prepare_sequences(notes, n_vocab) sys.stdout.write("\nCreating CuDNNLSTM neural network model...\n") sys.stdout.flush() model = create_network(network_input, n_vocab) sys.stdout.write("\nTraining CuDNNLSTM neural network model...\n\n") sys.stdout.flush() train(model, network_input, network_output) # get all the notes and chords from the midi files def get_notes(): # remove existing data file if it exists if os.path.isfile(notesfile): os.remove(notesfile) notes = [] for file in glob.glob("{}/*.mid".format(mididirectory)): midi = converter.parse(file) sys.stdout.write("Parsing %s ...\n" % file) sys.stdout.flush() notes_to_parse = None try: # file has instrument parts s2 = instrument.partitionByInstrument(midi) notes_to_parse = s2.parts[0].recurse() except: # file has notes in a flat structure notes_to_parse = midi.flat.notes for element in notes_to_parse: if isinstance(element, note.Note): notes.append(str(element.pitch)) elif isinstance(element, chord.Chord): notes.append('.'.join(str(n) for n in element.normalOrder)) with open(notesfile,'wb') as filepath: pickle.dump(notes, filepath) return notes # prepare the sequences used by the neural network def prepare_sequences(notes, n_vocab): sequence_length = 100 # get all pitch names pitchnames = sorted(set(item for item in notes)) # create a dictionary to map pitches to integers note_to_int = dict((note, number) for number, note in enumerate(pitchnames)) network_input = [] network_output = [] # create input sequences and the corresponding outputs for i in range(0, len(notes) - sequence_length, 1): sequence_in = notes[i:i + sequence_length] # needs to take into account if notes in midi file are less than required 100 ( mod ? ) sequence_out = notes[i + sequence_length] # needs to take into account if notes in midi file are less than required 100 ( mod ? ) network_input.append([note_to_int[char] for char in sequence_in]) network_output.append(note_to_int[sequence_out]) n_patterns = len(network_input) # reshape the input into a format compatible with CuDNNLSTM layers network_input = numpy.reshape(network_input, (n_patterns, sequence_length, 1)) # normalize input network_input = network_input / float(n_vocab) network_output = np_utils.to_categorical(network_output) return (network_input, network_output) # create the structure of the neural network def create_network(network_input, n_vocab): ''' """ create the structure of the neural network """ model = Sequential() model.add(CuDNNLSTM(512, input_shape=(network_input.shape[1], network_input.shape[2]), return_sequences=True)) model.add(Dropout(0.3)) model.add(CuDNNLSTM(512, return_sequences=True)) model.add(Dropout(0.3)) model.add(CuDNNLSTM(512)) model.add(Dense(256)) model.add(Dropout(0.3)) model.add(Dense(n_vocab)) model.add(Activation('softmax')) model.compile(loss='categorical_crossentropy', optimizer='rmsprop',metrics=["accuracy"]) ''' model = Sequential() model.add(CuDNNLSTM(512, input_shape=(network_input.shape[1], network_input.shape[2]), return_sequences=True)) model.add(Dropout(0.2)) model.add(BatchNormalization()) model.add(CuDNNLSTM(256)) model.add(Dropout(0.2)) model.add(BatchNormalization()) model.add(Dense(128, activation="relu")) model.add(Dropout(0.2)) model.add(BatchNormalization()) model.add(Dense(n_vocab)) model.add(Activation('softmax')) model.compile(loss='categorical_crossentropy', optimizer='adam',metrics=["accuracy"]) return model # train the neural network def train(model, network_input, network_output): # saver = CustomSaver() # history = model.fit(network_input, network_output, epochs=modelepochs, batch_size=50, callbacks=[tensorboard]) history = model.fit(network_input, network_output, epochs=modelepochs, batch_size=50, callbacks=[CustomSaver()]) # evaluate the model print("\nModel evaluation at the end of training") train_acc = model.evaluate(network_input, network_output, verbose=0) print(model.metrics_names) print(train_acc) # save trained model model.save(modeldirectory + modelfileprefix + '_' + str(modelepochs) + '.model') # delete temp notes file os.remove(notesfile) if __name__ == '__main__': train_network()</span></span></code> </pre> </div></div><br> è¿™æ˜¯midi <code>lstm_music_predict.py</code>ç”Ÿæˆè„šæœ¬ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">lstm_music_predict.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># based on code from https://github.com/Skuldur/Classical-Piano-Composer # to use this script pass in; # 1. path to notes file # 2. path to model # 3. path to midi output # eg python -W ignore "C:\\LSTM Composer\\lstm_music_predict.py" "C:\\LSTM Composer\\Bach.notes" "C:\\LSTM Composer\\Bach.model" "C:\\LSTM Composer\\Bach.mid" # ignore all info and warning messages import os os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2' import tensorflow as tf tf.compat.v1.logging.set_verbosity(tf.compat.v1.logging.ERROR) import pickle import numpy import sys import keras.models from music21 import instrument, note, stream, chord from keras.models import Sequential from keras.layers import Dense from keras.layers import Dropout from keras.layers import Activation # name of weights filename notesfile = str(sys.argv[1]) modelfile = str(sys.argv[2]) midifile = str(sys.argv[3]) # generates a piano midi file def generate(): sys.stdout.write("Loading notes data file...\n\n") sys.stdout.flush() #load the notes used to train the model with open(notesfile, 'rb') as filepath: notes = pickle.load(filepath) sys.stdout.write("Getting pitch names...\n\n") sys.stdout.flush() # Get all pitch names pitchnames = sorted(set(item for item in notes)) # Get all pitch names n_vocab = len(set(notes)) sys.stdout.write("Preparing sequences...\n\n") sys.stdout.flush() network_input, normalized_input = prepare_sequences(notes, pitchnames, n_vocab) sys.stdout.write("Loading LSTM neural network model...\n\n") sys.stdout.flush() model = create_network(normalized_input, n_vocab) sys.stdout.write("Generating note sequence...\n\n") sys.stdout.flush() prediction_output = generate_notes(model, network_input, pitchnames, n_vocab) sys.stdout.write("\nCreating MIDI file...\n\n") sys.stdout.flush() create_midi(prediction_output) # prepare the sequences used by the neural network def prepare_sequences(notes, pitchnames, n_vocab): # map between notes and integers and back note_to_int = dict((note, number) for number, note in enumerate(pitchnames)) sequence_length = 100 network_input = [] output = [] for i in range(0, len(notes) - sequence_length, 1): sequence_in = notes[i:i + sequence_length] sequence_out = notes[i + sequence_length] network_input.append([note_to_int[char] for char in sequence_in]) output.append(note_to_int[sequence_out]) n_patterns = len(network_input) # reshape the input into a format compatible with LSTM layers normalized_input = numpy.reshape(network_input, (n_patterns, sequence_length, 1)) # normalize input normalized_input = normalized_input / float(n_vocab) return (network_input, normalized_input) # create the structure of the neural network def create_network(network_input, n_vocab): model = keras.models.load_model(modelfile) return model # generate notes from the neural network based on a sequence of notes def generate_notes(model, network_input, pitchnames, n_vocab): # pick a random sequence from the input as a starting point for the prediction start = numpy.random.randint(0, len(network_input)-1) int_to_note = dict((number, note) for number, note in enumerate(pitchnames)) pattern = network_input[start] prediction_output = [] # generate 500 notes for note_index in range(500): prediction_input = numpy.reshape(pattern, (1, len(pattern), 1)) prediction_input = prediction_input / float(n_vocab) prediction = model.predict(prediction_input, verbose=0) index = numpy.argmax(prediction) result = int_to_note[index] prediction_output.append(result) pattern.append(index) pattern = pattern[1:len(pattern)] if (note_index + 1) % 50 == 0: sys.stdout.write("{} out of 500 notes generated\n".format(note_index+1)) sys.stdout.flush() return prediction_output # convert the output from the prediction to notes and create a midi file from the notes def create_midi(prediction_output): offset = 0 output_notes = [] # create note and chord objects based on the values generated by the model for pattern in prediction_output: # pattern is a chord if ('.' in pattern) or pattern.isdigit(): notes_in_chord = pattern.split('.') notes = [] for current_note in notes_in_chord: new_note = note.Note(int(current_note)) new_note.storedInstrument = instrument.Piano() notes.append(new_note) new_chord = chord.Chord(notes) new_chord.offset = offset output_notes.append(new_chord) # pattern is a note else: new_note = note.Note(pattern) new_note.offset = offset new_note.storedInstrument = instrument.Piano() output_notes.append(new_note) # increase offset each iteration so that notes do not stack offset += 0.5 midi_stream = stream.Stream(output_notes) midi_stream.write('midi', fp=midifile) if __name__ == '__main__': generate()</span></span></code> </pre> </div></div><br><h2> æ¨¡å‹æ–‡ä»¶å¤§å° </h2><br> åœ¨æ··æ²Œè§†è§‰ä¸­åŒ…å«ç¥ç»ç½‘ç»œçš„ç¼ºç‚¹æ˜¯æ–‡ä»¶çš„å¤§å°ã€‚ å¦‚æœæ¨¡å‹çš„ç”Ÿæˆé€Ÿåº¦æ›´å¿«ï¼Œé‚£ä¹ˆæˆ‘åªéœ€æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œä»¥ä¾¿æœ€ç»ˆç”¨æˆ·å¯ä»¥è‡ªå·±è®­ç»ƒæ¨¡å‹ã€‚ ä½†æ˜¯ï¼Œç”±äºé’ˆå¯¹è®¸å¤šæ¨¡å‹çš„æŸäº›åŸ¹è®­è¯¾ç¨‹å¯èƒ½éœ€è¦å‡ å¤©çš„æ—¶é—´ï¼Œå› æ­¤è¿™å¹¶ä¸æ˜¯ç‰¹åˆ«å®ç”¨ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œæœ€å¥½è‡ªå·±è¿›è¡Œæ‰€æœ‰åŸ¹è®­å’Œæµ‹è¯•ï¼Œå¹¶ä»…æ·»åŠ æœ€ä½³çš„å·¥ä½œæ¨¡å‹ã€‚ è¿™ä¹Ÿæ„å‘³ç€æœ€ç»ˆç”¨æˆ·åªéœ€è¦æŒ‰ä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œç»è¿‡è®­ç»ƒçš„æ¨¡å‹å°±å¯ä»¥åˆ›ä½œéŸ³ä¹ä½œå“ã€‚ <br><br> æ¯ä¸ªæ¨¡å‹çš„å¤§å°ä¸º22 MBã€‚ åœ¨ç°ä»£Internetçš„æ¡ä»¶ä¸‹ï¼Œè¿™è¿˜ä¸ç®—ä»€ä¹ˆï¼Œä½†æ˜¯éšç€å‡ å¹´çš„å‘å±•ï¼Œã€Šè§†è§‰å¼‚è±¡ã€‹çš„å¤§å°é€æ¸å¢é•¿ï¼Œç›´åˆ°æœ€è¿‘æ‰çªç„¶ä»70 MBå¢é•¿åˆ°91 MBï¼ˆç”±äºç”¨äºæœç´¢è‡ªåŠ¨æœºçš„æ¨¡å‹ï¼‰ã€‚ å› æ­¤ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»…å‘ä¸»è¦çš„Visions Chaoså®‰è£…ç¨‹åºæ·»åŠ äº†ä¸€ä¸ªæ¨¡å‹ã€‚ å¯¹äºéœ€è¦æ›´å¤šåŠŸèƒ½çš„ç”¨æˆ·ï¼Œæˆ‘å‘å¸ƒäº†æŒ‡å‘å…¶ä»–1 GBæ¨¡å‹çš„é“¾æ¥ã€‚ ä»–ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„è„šæœ¬åŸºäºå…¶Midiæ–‡ä»¶åˆ›å»ºè‡ªå·±çš„æ¨¡å‹ã€‚ <br><br><h2> æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆï¼Ÿ </h2><br> åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒLSTMä½œæ›²å®¶æ˜¯ä½¿ç”¨ç¥ç»ç½‘ç»œä½œæ›²çš„æœ€ç®€å•çš„ä¾‹å­ã€‚ <br><br> æˆ‘å·²ç»åœ¨ç¥ç»ç½‘ç»œä¸Šæ‰¾åˆ°äº†å…¶ä»–éŸ³ä¹ä½œæ›²å®¶ï¼Œæˆ‘å°†åœ¨ä»¥åè¿›è¡Œå®éªŒï¼Œå› æ­¤æ‚¨å¯ä»¥æœŸæœ›ï¼Œåœ¨ã€Šæ··æ²Œçš„è§†è§‰ã€‹ä¸­ï¼Œå°†æœ‰å¯èƒ½è‡ªåŠ¨åˆæˆéŸ³ä¹ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470127/">https://habr.com/ru/post/zh-CN470127/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470115/index.html">æ‚¨çš„ç§»åŠ¨å¯¼èˆªå™¨ä½¿é©¾é©¶å˜å¾—å›°éš¾</a></li>
<li><a href="../zh-CN470117/index.html">å‡†å¤‡å¥½è”åˆæ”¶å‰²æœº</a></li>
<li><a href="../zh-CN470121/index.html">å…¬å¸ç¼–ç¨‹å­¦æ ¡æˆ–å¦‚ä½•è¿›å…¥IT</a></li>
<li><a href="../zh-CN470123/index.html">Yandex.Moneyé‡‘èé™·é˜±</a></li>
<li><a href="../zh-CN470125/index.html">ä¸è¦ä¸¥æ ¼åˆ¤æ–­åˆ«äººçš„ä»£ç </a></li>
<li><a href="../zh-CN470129/index.html">å£°æ˜å¼å†…å­˜ç®¡ç†</a></li>
<li><a href="../zh-CN470135/index.html">æ— éœ€ç¼–ç¨‹çš„äº¤äº’å¼Webåº”ç”¨ç¨‹åºï¼Ÿ å®¹æ˜“ï¼ Mavoåœ¨ä½ çš„æ€€é‡Œ</a></li>
<li><a href="../zh-CN470139/index.html">2ä¸ªç”Ÿæ´»æŠ€å·§ï¼šMicrosoft SQL Serverä¸­ä¼ ç»Ÿæœç´¢çš„æ›¿ä»£æ–¹æ³•</a></li>
<li><a href="../zh-CN470145/index.html">â€œå½“å¿ƒï¼ŒFASï¼â€ï¼šä¸ºä»€ä¹ˆå†›ç”¨ç¥¨åœ¨å¹¿å‘Šä¸­å¾ˆå±é™©ï¼Œä¸ºä»€ä¹ˆé‡è¦çš„æ˜¯è¦çŸ¥é“æ•°å­¦ï¼Œæ˜¯å¦æ€»æ˜¯éœ€è¦çœŸå®çš„äº‹å®</a></li>
<li><a href="../zh-CN470149/index.html">Javaä¸­å°†ä¸ä¼šæœ‰ä¸å¯å˜çš„é›†åˆ-ç°åœ¨æˆ–ç°åœ¨éƒ½ä¸ä¼š</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>