<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòæ üöå üòê Aspektorientierte PHP-Programmierung üóΩ üë∏üèø üò∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 Diesen Monat haben wir den ersten Satz des Backend PHP Developer- Kurses abgeschlossen und stellen sie mit Macht und Kraft ein (s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aspektorientierte PHP-Programmierung</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/415713/">  Hallo allerseits! <br><br>  Diesen Monat haben wir den ersten Satz des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Backend PHP Developer-</a> Kurses abgeschlossen und stellen sie mit Macht und Kraft ein (so viel wie m√∂glich in den Ferien).  Der Kurs wurde mit einem anderen Lehrer erg√§nzt - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Evgeny Volosatov</a> , den viele wahrscheinlich kennen.  Nun, wir teilen traditionell interessante Dinge. <br><br>  Lass uns gehen. <br><br>  In jeder Anwendung gibt es Teile des Codes, die mehrere Teile der Architektur gleichzeitig ‚Äûkreuzen‚Äú. <br><br>  Dieses Problem ist bei der Arbeit mit einem voll funktionsf√§higen Framework nicht so offensichtlich.  H√∂chstwahrscheinlich ist Ihr Problem weit verbreitet, und es besteht die M√∂glichkeit, dass das Framework es bereits gel√∂st hat, indem es eine Aufteilung der Verantwortung opfert oder eine Abstraktion √ºber dem Framework bereitstellt.  Viele Frameworks verwenden eine ereignisorientierte Architektur, um End-to-End-Funktionsprobleme zu l√∂sen.  Es kommt jedoch immer ein Moment, in dem das Framework nicht in der Lage ist, das gew√ºnschte Ma√ü an Kontrolle √ºber ein bestimmtes St√ºck Logik bereitzustellen.  Dies gilt insbesondere bei Verwendung von Mikroframes oder bei der Entwicklung mit spezialisierten Bibliotheken.  Je mehr Ihre Anwendung die Prinzipien der Aufgabentrennung ber√ºcksichtigt, desto gr√∂√üer ist die Rolle der End-to-End-Funktionalit√§t in Ihrer Architektur. <br><br><img src="https://habrastorage.org/webt/hg/2m/2n/hg2m2nmlz9m4ztlew8ezhfaz30o.png"><a name="habracut"></a><br><br><h2>  Aspektorientierte PHP-Programmierung </h2><br>  Aspect Oriented Programming (AOP) ist ein Programmierparadigma, das sich auf die Organisation und Modularisierung von End-to-End-Funktionen konzentriert.  Anwendungsf√§lle - ACLs, Protokollierung, Fehlerbehandlung, Caching. <br><br>  Die in PHP integrierten (internen) Annahmen (wenn Sie eine Funktion / Konstante / Klasse definieren, bleibt diese f√ºr immer definiert) erschweren die Implementierung des AOP-Paradigmas. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Li3</a> war der erste, der das Problem der End-to-End-Funktionalit√§t mithilfe eines Filtermechanismus l√∂ste, mit dem die Logik einer Methode durch Verschl√ºsse gefiltert werden kann.  Um die Methode filterbar zu machen, erfordert die Implementierung von Li3 das manuelle Hinzuf√ºgen von Vorlagencode.  Mit solchen Einschr√§nkungen sind AOP-Techniken auf Filtertechniken beschr√§nkt. <br><br>  Andere bekannte AOP-Implementierungen in PHP: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AOP</a> (PECL-Erweiterung) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geh!</a> </li></ul><br>  Die PECL AOP-Erweiterung ist ein interessanter, aber gleichzeitig riskanter Ansatz, da die Unterst√ºtzung f√ºr PECL-Erweiterungen nicht √ºblich ist.  Eine weitere Option sind Go! Libraries, eine AOP-Implementierung, die PHP-Code im laufenden Betrieb repariert und die Verwendung von AOP-Methoden erm√∂glicht. <br><br>  Es gibt andere Implementierungen, aber die meisten basieren auf Proxys (soweit ich wei√ü), und dieser Ansatz weist viele Einschr√§nkungen auf. <br><br><h2>  Neuer Typ in der Gegend </h2><br>  Die automatische Codegenerierung ist seit langem in PHP und wird in vielen Bibliotheken verwendet, beispielsweise in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ProxyManager.</a>  Und dank der Einf√ºhrung von Composer, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Go!</a>  zeigt, dass das direkte Bearbeiten von Code m√∂glich ist. <br><br>  Wenn die Codegenerierung immer noch als einfach angesehen werden kann, ist die Korrektur des Codes etwas komplizierter.  Erstens gibt es in PHP keinen integrierten Code-Parser, und zweitens gibt es nur sehr wenige Bibliotheken, die die Probleme beim Parsen von PHP-Code l√∂sen.  Die bekannteste ist die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHP-Parser-</a> Bibliothek.  PHP-Parser ist ein gro√üartiges Tool, aber selbst es ignoriert die Formatierung von Leerzeichen in generierten abstrakten Syntaxb√§umen.  Das macht es schwierig, den Code zu reparieren.  In der Tat ist der Code, der repariert werden muss, echter ausf√ºhrbarer Code.  Wenn Sie m√∂chten, dass das Backtracking fehlerfrei ist, m√ºssen Sie daher die Zeilennummern in der korrigierten Datei ber√ºcksichtigen. <br><br>  F√ºr diese Aufgabe verwenden wir den Kahlan JIT Code <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Patcher</a> .  Kahlan ist dank der JIT-Bearbeitungstechniken das neue Unit &amp; BDD-Testframework, das Stub- und Monkey-Patchcode direkt in Ruby oder JavaScript erm√∂glicht.  Unter der Haube finden wir, dass diese Bibliothek auf dem rudiment√§ren PHP-Parser basiert.  Trotzdem ist es schnell genug und stabil genug, um zu uns zu passen. <br><br>  Die Filterbibliothek ist unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/crysalead/filter</a> verf√ºgbar und kann wie folgt verwendet werden. <br><br>  Zun√§chst sollte der JIT-Code-Patcher so schnell wie m√∂glich initialisiert werden (z. B. unmittelbar nach dem Einschalten des Autoloade Composer): <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Lead</span></span>\<span class="hljs-title"><span class="hljs-title">Filter</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; Filters::patch(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  Beachten Sie, dass die Codebearbeitung nur f√ºr Klassen m√∂glich ist, die von Composer Autoload'er geladen wurden.  Wenn eine Klasse mit den Ausdr√ºcken require oder include hinzugef√ºgt wird, wird sie bereits vor dem Aufruf von Filters :: patch (true) geladen und daher nicht behoben. <br><br>  Standardm√§√üig wird der gesamte korrigierte Code unter / tmp / jit gespeichert. Sie k√∂nnen ihn jedoch jederzeit in Ihren eigenen Code √§ndern: <br><br><pre> <code class="php hljs">Filters::patch(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, [<span class="hljs-string"><span class="hljs-string">'cachePath'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'my/cache/path/jit'</span></span>]);</code> </pre> <br>  Zwischengespeicherte Dateien werden bei jedem √Ñndern einer PHP-Datei automatisch wiederhergestellt. <br><br>  Achtung!  <code>Filters::patch(true)</code> ist der einfachste Weg, den Patcher zu konfigurieren. Beachten Sie, dass Ihr gesamter Code repariert wird.  Es kann lange dauern, bis alle Methoden in Ihrer Codebasis in einen Filterabschluss eingeschlossen sind. <br><br>  Gl√ºcklicherweise sind im Projekt nur einige Methoden erforderlich, wenn die End-to-End-Funktionalit√§t bei gut gestaltetem Code eine entscheidende Rolle spielt.  Daher besteht der bevorzugte Ansatz darin, nur die Methoden zu korrigieren, die gefiltert werden: <br><br><pre> <code class="php hljs">Filters::patch([ <span class="hljs-string"><span class="hljs-string">'A\ClassName'</span></span>, <span class="hljs-string"><span class="hljs-string">'An\Example\ClassName::foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'A\Second\Example\ClassName'</span></span> =&gt; [<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>], ], [ <span class="hljs-string"><span class="hljs-string">'cachePath'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'my/cache/path/jit'</span></span>, ]);</code> </pre> <br>  Sie k√∂nnen also alle Methoden einer bestimmten Klasse festlegen, nur eine oder mehrere Methoden. <br><br><h2>  API-Filter </h2><br>  Nachdem der JIT-Patcher aktiviert ist, erstellen Sie einen Protokollfilter: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Chaos</span></span>\<span class="hljs-title"><span class="hljs-title">Filter</span></span>\<span class="hljs-title"><span class="hljs-title">Filters</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Chaos</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>\<span class="hljs-title"><span class="hljs-title">Database</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Monolog</span></span>\<span class="hljs-title"><span class="hljs-title">Logger</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Monolog</span></span>\<span class="hljs-title"><span class="hljs-title">Handler</span></span>\<span class="hljs-title"><span class="hljs-title">StreamHandler</span></span>; $logger = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Logger(<span class="hljs-string"><span class="hljs-string">'database'</span></span>); $logger-&gt;pushHandler(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamHandler(<span class="hljs-string"><span class="hljs-string">'my/log/path/db.log'</span></span>, Logger::WARNING)); Filters::apply(Database::class, <span class="hljs-string"><span class="hljs-string">'query'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($next, $sql, $data, $options)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($logger)</span></span></span><span class="hljs-function"> </span></span>{ $logger-&gt;info(<span class="hljs-string"><span class="hljs-string">'Ran SQL query: '</span></span> . $sql); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $next($sql, $data, $options); });</code> </pre><br>  Im obigen Beispiel wird ein SQL-Abfrageprotokollfilter f√ºr die Chaos-Datenbankbibliothek erstellt.  Weitere Informationen zum API-Filter finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github.com/crysalead/filter</a> . <br><br><h2>  Fazit </h2><br>  AOP ist meiner Meinung nach die eigentliche Antwort auf die End-to-End-Funktionalit√§t.  Alle anderen Abstraktionen sind gleicherma√üen redundant und in den meisten F√§llen auf einen bestimmten Rahmen beschr√§nkt.  Ich verliere nicht die Hoffnung, dass PHP eines Tages eine integrierte API f√ºr die aspektorientierte Programmierung bereitstellen wird.  Aber jetzt, denke ich, ist das Patchen von JIT-Code die beste Option, bei der die Vorteile den CPU-Overhead bei weitem √ºberwiegen, was praktisch vernachl√§ssigt werden kann, wenn das Patchen von JIT-Code nicht global angewendet wird. <br><br>  DAS ENDE <br><br>  Wie immer erwarten wir, wenn √ºberhaupt, Fragen, einen Wunsch und laden Sie zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einer offenen Lektion ein,</a> in der Sie einen interessanten Vortrag anh√∂ren und den neuen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lehrer</a> besser kennenlernen k√∂nnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de415713/">https://habr.com/ru/post/de415713/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de415699/index.html">Drei kurze Windows-Registrierungsgeschichten</a></li>
<li><a href="../de415701/index.html">Top 10: Die besten Joker 2017 Papers</a></li>
<li><a href="../de415705/index.html">Hacker haben Gentoo Linux-Repositories auf GitHub kompromittiert</a></li>
<li><a href="../de415707/index.html">Richard Hamming: Kapitel 18. Modellierung - I.</a></li>
<li><a href="../de415709/index.html">7 S√ºnden des Produktbesitzers</a></li>
<li><a href="../de415715/index.html">Die Geschichte des Zusammenbruchs und der wundersamen Rettung des Schimmels in KOMPAS-3D</a></li>
<li><a href="../de415717/index.html">Kann ich eine Lichtpistole f√ºr den LCD-Bildschirm herstellen? Kickstarter sammelt bereits Geld</a></li>
<li><a href="../de415721/index.html">Warum ben√∂tigt der Flaggschiff-Prozessor Top-Speicher? Testen des HyperX Fury DDR4-3466-Kits</a></li>
<li><a href="../de415723/index.html">Von Designern bis zur QS-Abteilung oder gibt es ein Leben nach der Fabrik</a></li>
<li><a href="../de415725/index.html">Saubere, schnelle Architektur als Alternative zu VIPER</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>