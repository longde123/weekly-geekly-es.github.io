<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛🏻 👩🏽‍🎓 🕹️ 我们突破了机器人的保护 👶🏻 🙎🏽 🏂🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近， incapsula已开始出现在许多外国站点上，该系统提高了站点的安全性，工作速度，同时又大大增加了软件开发人员的生命。 该系统的本质是使用JavaScript的全面保护，顺便说一下，许多DDOS机器人已经学会了执行甚至绕过CloudFlare。 今天，我们将学习封装，编写JS脚本反混淆器，并...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们突破了机器人的保护</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429662/"><img src="https://habrastorage.org/webt/kg/it/oe/kgitoeky0eoigux3dhyyhtj9hdy.jpeg"><br><br> 最近， <b>incapsula</b>已开始出现在许多外国站点上，该系统提高了站点的安全性，工作速度，同时又大大增加了软件开发人员的生命。 该系统的本质是使用JavaScript的全面保护，顺便说一下，许多DDOS机器人已经学会了执行甚至绕过CloudFlare。 今天，我们将学习封装，编写JS脚本反混淆器，并教我们的<s>DDOS</s>机器人如何解决它！ <br><a name="habracut"></a><br> 下面的屏幕快照中的网站是作为文章的一个很好的示例，在可疑主题的论坛上，与其他网站并没有什么不同，许多人正在为之寻找暴力手段，但是我还有另外一项任务-用于自动执行网站各种动作的软件。 <br><br> 让我们从检查查询开始，因为只有两个查询，这是第一个查询： <br><br><img src="https://habrastorage.org/webt/fq/ny/wq/fqnywqsbrzm9ffvjux0t0onl_f0.png"><br><br> 此请求将加载一个自然混淆的脚本： <br><br><img src="https://habrastorage.org/webt/ts/am/ln/tsamlnznbd7aoj5olinfx0vhab8.png"><br><br> 将eval更改为<b>document.write（）可以</b>使代码更具可读性： <br><br><img src="https://habrastorage.org/webt/dg/bx/qy/dgbxqyaozcow_dfee1vujsaxqd8.png"><br><br> 我不知道为什么，但是用于格式化输出代码的自动工具破坏了此代码，因此我不得不用手对其进行格式化，并为变量指定普通名称。 对于所有这些操作，我使用了一个简单的记事本++和一个文本替换功能，因此我们可以继续进行第一行的检查： <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x3a59=[<span class="hljs-string"><span class="hljs-string">'wpgXPQ=='</span></span>,<span class="hljs-string"><span class="hljs-string">'cVjDjw=='</span></span>,<span class="hljs-string"><span class="hljs-string">'Tk/DrFl/'</span></span>,<span class="hljs-string"><span class="hljs-string">'GMOMd8K2w4jCpw=='</span></span>,<span class="hljs-string"><span class="hljs-string">'wpkwwpE='</span></span>,<span class="hljs-string"><span class="hljs-string">'w6zDmmrClMKVHA=='</span></span>, ... ,<span class="hljs-string"><span class="hljs-string">'w4w+w5MGBQI='</span></span>,<span class="hljs-string"><span class="hljs-string">'w6TDr8Obw6TDlTJQaQ=='</span></span>];</code> </pre> <br> 这是一个包含加密函数名称和其他字符串的数组，因此我们需要寻找一个解密该数组的函数，无需走太远： <br><br><div class="spoiler">  <b class="spoiler_title">混淆代码</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Decrypt=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">base64_Encoded_Param,Key_Param</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CounterArray=[], CRC=<span class="hljs-number"><span class="hljs-number">0x0</span></span>, TempVar, result=<span class="hljs-string"><span class="hljs-string">''</span></span>, EncodedSTR=<span class="hljs-string"><span class="hljs-string">''</span></span>; base64_Encoded_Param=atob(base64_Encoded_Param); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=<span class="hljs-number"><span class="hljs-number">0</span></span>,input_length=base64_Encoded_Param.length;n&lt;input_length;n++){ EncodedSTR+=<span class="hljs-string"><span class="hljs-string">'%'</span></span>+(<span class="hljs-string"><span class="hljs-string">'00'</span></span>+base64_Encoded_Param.charCodeAt(n).toString(<span class="hljs-number"><span class="hljs-number">0x10</span></span>)).slice(<span class="hljs-number"><span class="hljs-number">-0x2</span></span>); } base64_Encoded_Param=<span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(EncodedSTR); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=<span class="hljs-number"><span class="hljs-number">0x0</span></span>;n&lt;<span class="hljs-number"><span class="hljs-number">0x100</span></span>;n++){ CounterArray[n]=n; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(n=<span class="hljs-number"><span class="hljs-number">0x0</span></span>;n&lt;<span class="hljs-number"><span class="hljs-number">0x100</span></span>;n++){ CRC=(CRC+CounterArray[n]+Key_Param.charCodeAt(n%Key_Param.length))%<span class="hljs-number"><span class="hljs-number">0x100</span></span>; TempVar=CounterArray[n]; CounterArray[n]=CounterArray[CRC]; CounterArray[CRC]=TempVar; } n=<span class="hljs-number"><span class="hljs-number">0x0</span></span>; CRC=<span class="hljs-number"><span class="hljs-number">0x0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0x0</span></span>;i&lt;base64_Encoded_Param.length;i++){ n=(n+<span class="hljs-number"><span class="hljs-number">0x1</span></span>)%<span class="hljs-number"><span class="hljs-number">0x100</span></span>; CRC=(CRC+CounterArray[n])%<span class="hljs-number"><span class="hljs-number">0x100</span></span>; TempVar=CounterArray[n]; CounterArray[n]=CounterArray[CRC]; CounterArray[CRC]=TempVar; result+=<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>.fromCharCode(base64_Encoded_Param.charCodeAt(i)^CounterArray[(CounterArray[n]+CounterArray[CRC])%<span class="hljs-number"><span class="hljs-number">0x100</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; };</code> </pre> <br></div></div><br> 如果我们单独调用它： <br><br><pre> <code class="javascript hljs">ParamDecryptor(<span class="hljs-string"><span class="hljs-string">'0x0'</span></span>, <span class="hljs-string"><span class="hljs-string">'0Et]'</span></span>)</code> </pre> <br> 这个结果将远远超出我们的预期。 另一个功能是要怪： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shift_array=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">number_of_shifts</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(--number_of_shifts){ EncodedParams[<span class="hljs-string"><span class="hljs-string">'push'</span></span>](EncodedParams[<span class="hljs-string"><span class="hljs-string">'shift'</span></span>]()); } };</code> </pre><br> 这是在一个非常意外的地方-在开始时就调用的函数，并检查cookie。 显然，开发人员因此“保护”了cookie支票免于被切掉。 如您所见-没什么复杂的，循环仅将数组移动指定数量的元素，在本例中为223个元素。 这个魔术数字223是从哪里来的？ 我从调用Cookie验证功能的电话中获得了这个数字，它看起来像0xdf并遵循以下路线： <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  function(EncodedParams,EncodedParamsShifts); //  (AllParams,0xdf); //0xdf =&gt; 223 //    var _0x5e622e=function(_0x486a40,_0x1de600){_0x486a40(++_0x1de600);}; _0x5e622e(shift_array,EncodedParamsShifts); //     : shift_array(++EncodedParamsShifts);</span></span></code> </pre><br> 自然，它每次都会改变，谁会怀疑... <br><br> 现在剩下的就是替换所有电话 <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x85e545=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[ParamDecryptor(<span class="hljs-string"><span class="hljs-string">'0x0'</span></span>, <span class="hljs-string"><span class="hljs-string">'0Et]'</span></span>)];</code> </pre> <br> 在 <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x85e545=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[<span class="hljs-string"><span class="hljs-string">'window'</span></span>];</code> </pre> <br> 或者，更好的是， <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ThisWindow=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window;</code> </pre> <br> 我按常规进行了最后一次转换。 哦，是的，他们完全忘记了以下几行： <br><br> <code>\x77\x6f\x4a\x33\x58\x68\x6b\x59\x77\x34\x44\x44\x6e\x78\x64\x70</code> <br> <br> 到普通视图。 没什么复杂的，这是一个常规的UrlEncode，将\ x更改为％并解码以得到以下行： <br><br> <code>woJ3XhkYw4DDnxdp</code> <br> <br> 然后我开始替换所有电话 <br><br><pre> <code class="javascript hljs">ParamDecryptor(<span class="hljs-string"><span class="hljs-string">'0x0'</span></span>, <span class="hljs-string"><span class="hljs-string">'0Et]'</span></span>)</code> </pre> <br> 使用我模块中的自写函数将已解密的行复制到 是的，代码并没有闪烁的光芒，截止日期很紧急（就像昨天通常需要的那样），我懒得思考， <s>因为我曾经使用鼠标编程</s> ，但是它仍然可以正常工作： <br><br><img src="https://habrastorage.org/webt/bc/29/92/bc29921g6sig2pulkkbovpnu88a.png"><br><br> 我从源代码几乎1v1重写了代码。 <br><br> 接下来，另一种混淆代码的方法引起了我的注意。 我必须编写一个相当大的函数来搜索此类调用： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'7'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(_0x30fe16[<span class="hljs-string"><span class="hljs-string">"XNg"</span></span>](_0x13d8ee,_0x5a370d))</code> </pre> <br> 并用更简单的类似物代替它们： <br><br><div class="spoiler">  <b class="spoiler_title">很棒的功能列表</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x30fe16={ <span class="hljs-string"><span class="hljs-string">'XNg'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x19aabd</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x425e3c,_0x481cd6</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x425e3c&lt;_0x481cd6;}, <span class="hljs-string"><span class="hljs-string">'sUd'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x320363</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0xa24206,_0x49d66b</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0xa24206&amp;_0x49d66b;}, <span class="hljs-string"><span class="hljs-string">'wMk'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x32974a</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x2cdcf4,_0x250e85</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x2cdcf4&gt;&gt;_0x250e85;}, <span class="hljs-string"><span class="hljs-string">'FnU'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x22ce98</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x2f5577,_0x4feea7</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x2f5577&lt;&lt;_0x4feea7;}, <span class="hljs-string"><span class="hljs-string">'mTe'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x35a8bc</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x11fecf,_0x29718e</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x11fecf&amp;_0x29718e;}, <span class="hljs-string"><span class="hljs-string">'doo'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x5ce08b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x4e5976,_0x4757ea</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x4e5976&gt;&gt;_0x4757ea;}, <span class="hljs-string"><span class="hljs-string">'vmP'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x5d415c</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x39dc96,_0x59022e</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x39dc96&lt;&lt;_0x59022e;}, <span class="hljs-string"><span class="hljs-string">'bGL'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0xd49b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x7e8c9f,_0x301346</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x7e8c9f|_0x301346;}, <span class="hljs-string"><span class="hljs-string">'rXw'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x4dfb4d</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x39d33a,_0x36fd1e</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x39d33a&lt;&lt;_0x36fd1e;}, <span class="hljs-string"><span class="hljs-string">'svD'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x387610</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x3cd4f7,_0x58fd9e</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x3cd4f7&amp;_0x58fd9e;}, <span class="hljs-string"><span class="hljs-string">'cuj'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x472c54</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x4e473a,_0x26f3fd</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x4e473a==_0x26f3fd;}, <span class="hljs-string"><span class="hljs-string">'OrY'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x3c6e85</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x445d0b,_0x1caacf</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x445d0b|_0x1caacf;}, <span class="hljs-string"><span class="hljs-string">'AKn'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x4dac5b</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x521c05,_0x27b6bd</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x521c05&gt;&gt;_0x27b6bd;}, <span class="hljs-string"><span class="hljs-string">'gtj'</span></span>:<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x5416f0</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x3e0965,_0x560062</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x3e0965&amp;_0x560062;} };</code> </pre> <br></div></div><br> 获得： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'7'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(_0x13d8ee &lt; _0x5a370d){</code> </pre> <br> 工作的算法非常简单，实际上，我们只是替换了变量： <br><br><ol><li> 在本例中，我们找到了数组的名称： <b>_0x30fe16</b> </li><li>  Parsim输入参数： <b>_0x425e3c，_0x481cd6</b> </li><li>  Parsim函数主体： <b>_0x425e3c &lt;_0x481cd6</b> </li><li> 将<b>_0x425e3c</b>替换为<b>_0x13d8ee</b> </li><li> 将<b>_0x481cd6</b>替换为<b>_0x5a370d</b> </li><li> 我们<b>得到</b> ： <b>_0x13d8ee &lt;_0x5a370d</b> </li><li> 用上面的代码替换<b>_0x30fe16.XNg（_0x13d8ee，_0x5a370d）</b> </li><li> 重复直到功能结束 </li></ol><br> 解析函数的名称，参数和主体是由一个常规函数完成的。 当然，在模块的最终版本中，这种方法并不是特别需要，只有1个调用稍微模糊了一些，但是客户说要做所有事情，因此做到了，此外，其他功能也变得更加清晰。 在其他站点上也有这样的设计： <br><br><div class="spoiler">  <b class="spoiler_title">显示大小写错误的代码</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x4dc9f4 = { <span class="hljs-string"><span class="hljs-string">'NTSjj'</span></span>: _0x3d6e1f.dEVDh, <span class="hljs-string"><span class="hljs-string">'tZeHx'</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_0x2a40cd, _0x2faf22</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _0x3d6e1f.JIehC(_0x2a40cd, _0x2faf22); }, <span class="hljs-string"><span class="hljs-string">'ocgoO'</span></span>: <span class="hljs-string"><span class="hljs-string">"https://site/login"</span></span>, <span class="hljs-string"><span class="hljs-string">'WmiOO'</span></span>: _0x3d6e1f.vsCuf }; <span class="hljs-comment"><span class="hljs-comment">//    ,      : var _0x3d6e1f = { 'dEVDh': "4|0|2|3|5|1", 'JIehC': function(_0x34757f, _0xd344e8) { return _0x34757f != _0xd344e8; }, 'vsCuf': ".countdownGroup", 'awUzV': function(_0x4b3914, _0x1f9e41) { return _0x4b3914 === _0x1f9e41; }, 'smOkd': "NSpHE", 'bvCub': function(_0x208c1d, _0x160d32) { return _0x208c1d(_0x160d32); }, 'PmBNl': function(_0x33524f, _0x29b35a) { return _0x33524f(_0x29b35a); }, 'Fhbrr': "#stopBtn", 'Vkpkf': function(_0x2de6ac, _0x31bb8b) { return _0x2de6ac + _0x31bb8b; }, 'HbSaV': function(_0x429822, _0x1a46e9) { return _0x429822 + _0x1a46e9; }, 'UsdKM': "https://site/register", 'JCXqh': "Timer started. ", 'GBXqx': function(_0x18f912, _0x5829b5) { return _0x18f912 / _0x5829b5; }, 'sSdZf': function(_0x45f64c, _0x152cb4) { return _0x45f64c(_0x152cb4); }, 'AAmKj': ".countdownTimer" };</span></span></code> </pre> </div></div><br> 如您所见，一个数组中的参数引用了另一个。 我简单地解决了这个问题： <br><br><ol><li> 解析所有数组 </li><li> 我们从代码中清除它们 </li><li> 将所有元素复制到关联数组（名称，值） </li><li> 在递归搜索循环中，我们寻找所有嵌套函数 </li><li> 用嵌套函数替换嵌套函数 </li><li> 以相同方式将所有链接扩展到字符串 </li></ol><br> 应用这种去混淆方法后，代码变得有点混乱了。 您可以通过两种方式立即注意到base64函数。 第一个： <br><br><pre> <code class="javascript hljs">CharArray=<span class="hljs-string"><span class="hljs-string">"ABCDE...XYZabcde...xyz0123456789+/"</span></span>;</code> </pre> <br> 第二个： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>[<span class="hljs-string"><span class="hljs-string">"btoa"</span></span>])<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>[<span class="hljs-string"><span class="hljs-string">"btoa"</span></span>]=_0x386a89;</code> </pre> <br> 您不再可以撤消并继续使用其他更重要的功能，或更确切地说，转到使用Cookie的功能。 我在<b>incap_ses_</b>行中找到了它，并注意到了另一个混淆芯片-使用循环的代码混淆： <br><br><div class="spoiler">  <b class="spoiler_title">显示代码</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x290283=<span class="hljs-string"><span class="hljs-string">"4|2|5|0|3|1"</span></span>[<span class="hljs-string"><span class="hljs-string">"split"</span></span>](<span class="hljs-string"><span class="hljs-string">'|'</span></span>), _0x290611=<span class="hljs-number"><span class="hljs-number">0x0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!![]){ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(_0x290283[_0x290611++]){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'0'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=<span class="hljs-number"><span class="hljs-number">0x0</span></span>;n&lt;CookieArray[<span class="hljs-string"><span class="hljs-string">"length"</span></span>];n++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x27e53a=CookieArray[n][<span class="hljs-string"><span class="hljs-string">"substr"</span></span>](<span class="hljs-number"><span class="hljs-number">0x0</span></span>,CookieArray[n][<span class="hljs-string"><span class="hljs-string">"indexOf"</span></span>](<span class="hljs-string"><span class="hljs-string">'='</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x4b4644=CookieArray[n][<span class="hljs-string"><span class="hljs-string">"substr"</span></span>](CookieArray[n][<span class="hljs-string"><span class="hljs-string">"indexOf"</span></span>](<span class="hljs-string"><span class="hljs-string">'='</span></span>)+<span class="hljs-number"><span class="hljs-number">0x1</span></span>,CookieArray[n][<span class="hljs-string"><span class="hljs-string">"length"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_0x5ebd6a[<span class="hljs-string"><span class="hljs-string">"test"</span></span>](_0x27e53a)){ResultCookieArray[ResultCookieArray[<span class="hljs-string"><span class="hljs-string">"length"</span></span>]]=_0x4b4644;} } <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResultCookieArray;<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x5ebd6a=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.RegExp(<span class="hljs-string"><span class="hljs-string">"^\s?incap_ses_"</span></span>);<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'3'</span></span>:_0x4d5690();<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'4'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ResultCookieArray=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.Array();<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span><span class="hljs-string"><span class="hljs-string">'5'</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CookieArray=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.document.cookie[<span class="hljs-string"><span class="hljs-string">"split"</span></span>](<span class="hljs-string"><span class="hljs-string">';'</span></span>);<span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre> <br></div></div><br> 一切都非常简单：我们按照执行顺序重新排列行：4 | 2 | 5 | 0 | 3 | 1并获得原始功能。 在最终版本中也不需要这种去混淆方法，但是它不会引起大问题，所有内容都以基本方式进行解析，主要要考虑的是可以存在嵌套循环，因此我只是进行了递归搜索。 <br><br><div class="spoiler">  <b class="spoiler_title">Cookies功能</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x30fe16={ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_0x2829d5</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ResultCookieArray=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.Array(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x5ebd6a=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.RegExp(<span class="hljs-string"><span class="hljs-string">"^\s?incap_ses_"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> CookieArray=<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.document.cookie[<span class="hljs-string"><span class="hljs-string">"split"</span></span>](<span class="hljs-string"><span class="hljs-string">';'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> n=<span class="hljs-number"><span class="hljs-number">0x0</span></span>;n&lt;CookieArray[<span class="hljs-string"><span class="hljs-string">"length"</span></span>];n++){ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x27e53a=CookieArray[n][<span class="hljs-string"><span class="hljs-string">"substr"</span></span>](<span class="hljs-number"><span class="hljs-number">0x0</span></span>,CookieArray[n][<span class="hljs-string"><span class="hljs-string">"indexOf"</span></span>](<span class="hljs-string"><span class="hljs-string">'='</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _0x4b4644=CookieArray[n][<span class="hljs-string"><span class="hljs-string">"substr"</span></span>](CookieArray[n][<span class="hljs-string"><span class="hljs-string">"indexOf"</span></span>](<span class="hljs-string"><span class="hljs-string">'='</span></span>)+<span class="hljs-number"><span class="hljs-number">0x1</span></span>,CookieArray[n][<span class="hljs-string"><span class="hljs-string">"length"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(_0x5ebd6a[<span class="hljs-string"><span class="hljs-string">"test"</span></span>](_0x27e53a)){ResultCookieArray[ResultCookieArray[<span class="hljs-string"><span class="hljs-string">"length"</span></span>]]=_0x4b4644;} } _0x4d5690(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResultCookieArray; }</code> </pre></div></div><br> 它只是将以<b>incap_ses_</b>开头的所有cookie <b>的</b>值<b>存储</b>在<b>数组中</b> ，然后另一种方法仅通过对ASCII码求和来计算其校验和： <br><br><div class="spoiler">  <b class="spoiler_title">显示代码</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TIncapsula</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CharCRC</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i, crc:integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> crc:=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i:=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Length(text) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> crc:=crc+ord(text[i]); result:=IntToStr(crc); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TIncapsula</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetCookieDigest</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:integer; res:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> res:=<span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i:=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FCookies.Count-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> res=<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> res:=CharCRC(browserinfo+FCookies[i]) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> res:=res+<span class="hljs-string"><span class="hljs-string">','</span></span>+CharCRC(browserinfo+FCookies[i]); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; result:=res; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br></div></div><br> 我们将需要进一步的校验和，现在让我们弄清楚从不同位置调用此_0x4d5690是什么样的功能。 为此，只需查看被调用的方法并为它们分配适当的名称即可： <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckDebugger</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.window.Date()[<span class="hljs-string"><span class="hljs-string">"getTime"</span></span>]() - RunTime) &gt; <span class="hljs-number"><span class="hljs-number">0x1f4</span></span>){ FuckDebugger(); } }</code> </pre> <br> 这个脚本的作者很天真:) <br><br> 另一个要点： <br><br><pre> <code class="javascript hljs">ParamDecryptor(<span class="hljs-string"><span class="hljs-string">'0x65'</span></span>, <span class="hljs-string"><span class="hljs-string">'\x55\xa9\xf9\x1c\x1a\xd5\xfc\x60'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//result = "ca3XP6zjTSB3w3gEwMl6lqgsdEVDTV9aF4rEDQ==";</span></span></code> </pre><br> 从这里开始，我们需要前5个字母： <b>ca3XP</b> ，下面我将告诉您原因。 记住，我们是根据Cookie值计算校验和的？ 现在我们需要它们来获取所谓的哈希。 <br><br><div class="spoiler">  <b class="spoiler_title">哈希函数</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TIncapsula</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDigestHash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Digest: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i:integer; CookieDigest, res:<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> CookieDigest:=GetCookieDigest; <span class="hljs-comment"><span class="hljs-comment">//85530,85722 res:=''; for i:=0 to Length(Digest)-1 do begin res:=res+IntToHex(ord(Digest[i+1]) + ord(CookieDigest[i mod Length(CookieDigest)+1]),1); end; result:=res; end;</span></span></code> </pre><br></div></div><br> 比较： <br><br><img src="https://habrastorage.org/webt/fy/qf/3y/fyqf3yx_4fy1vrfubc8z3zl5rqi.png"><br><br> 太好了！ 最后一步仍然是-接收响应的Cookie： <br><br><pre> <code class="javascript hljs">ResCooka=((((ParamDecryptor(btoa(PluginsInfo),<span class="hljs-string"><span class="hljs-string">"ca3XP"</span></span>)+<span class="hljs-string"><span class="hljs-string">",digest="</span></span>)+DigestArray)+<span class="hljs-string"><span class="hljs-string">",s="</span></span>)+AllDigestHash); Set_Cookies(<span class="hljs-string"><span class="hljs-string">"___utmvc"</span></span>,btoa(ResCooka),<span class="hljs-number"><span class="hljs-number">0x14</span></span>);</code> </pre> <br> 最初的原始代码将以base64编码的浏览器参数添加到移位的AllParams数组的末尾，并使用带有<b>ca3XP</b>密钥的ParamDecryptor函数“加密”了它们，然后删除了之前添加的元素。 我可以假定此拐杖是由于一个小功能而制成的：ParamDecryptor函数接受数组中元素的索引和密钥，这意味着您只能通过数组在其中传输字符串。 为什么不正确呢？ 程序员，先生。 <br><br> 好吧，实际上，一切就绪，cookie都准备好了，它仍然可以安装并发送请求。 是的，您不会接受它，因为有一个小细节，我希望保持沉默。 <br><br><h4> 最佳化 </h4><br>  Delphi中的代码片段只是一个原型。 根据客户的要求，去混淆器的所有代码都已在汇编器中重写，其执行速度提高了数倍。 以下对速度也有积极影响： <br><br><ol><li> 在循环的一次迭代中剪切掉多余的代码和数组。 这对于大幅减少代码量并在将来加快搜索速度是必要的。 </li><li> 由于代码中的函数没有混合在一起，我们知道它们的大概位置，因此，如果cookie安装函数位于最后，那么您至少需要从中间查找它。 </li><li> 预先搜索关键功能。 甚至在清除不必要垃圾中的代码时，汇编算法也会搜索它们。 </li><li> 在最终版本中，我摆脱了去混淆器大约一半的功能，这些功能是理解代码所必需的，而对于机器人来说则不是必需的，因为必要的参数毫无问题地得到了解决。 </li></ol><br><h4> 结论 </h4><br> 当我访问该站点时，我希望它能快速运行，并且使用此方法混淆JS脚本对用户不敬。 这有助于防止机器人攻击吗？ 不，当然，正如您所看到的，它实际上是在整个晚上花费的，并且仅花费几个三明治和几杯茶。 <br><br> 本文的目的是讨论此解决方案的操作原理，并说明其无用之处。 出于明显的原因，将不会发布用于避开此保护措施的现成模块（泄漏后，可怜的游戏停止转为akamai），他需要根据这项研究（大约一年前进行并且仍然有意义）亲自进行研究，而想要窃取别人的帐目去森林。 如有任何疑问，我随时准备在评论中回答。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN429662/">https://habr.com/ru/post/zh-CN429662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN429648/index.html">现在可以同时在iOS / Android和所有网络上通过TLS和HTTPS进行DNS转换[感谢Cloudflare]</a></li>
<li><a href="../zh-CN429652/index.html">开放式网络研讨会“ IT招聘：从应用程序到产品”</a></li>
<li><a href="../zh-CN429654/index.html">改善项目管理</a></li>
<li><a href="../zh-CN429656/index.html">人工智能也是错误的。 随着Amazon Go在美国为我们提供捷径-将来没有收银员和卖家的商店</a></li>
<li><a href="../zh-CN429658/index.html">SpaceX Starlink卫星互联网-“印刷货币许可证”</a></li>
<li><a href="../zh-CN429668/index.html">Google PageSpeed Insights已进行了彻底的更新，它将发生什么变化？</a></li>
<li><a href="../zh-CN429670/index.html">Java Script！= JavaScript。 一堂课有五个Java。 我们编写脚本以便我们永远记住</a></li>
<li><a href="../zh-CN429676/index.html">备份到磁带</a></li>
<li><a href="../zh-CN429678/index.html">我们如何将1000万行C ++代码转换为C ++ 14标准（然后转换为C ++ 17）</a></li>
<li><a href="../zh-CN429680/index.html">麻省理工学院的课程“计算机系统安全”。 讲座17：用户认证，第1部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>