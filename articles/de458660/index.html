<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤲🏾 🏇🏻 👩🏽‍🤝‍👨🏼 Nicht erfolgreiche Softwarebereitstellung stürzt Cloudflare-Dienst ab 👮 👍🏿 🤙</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dies ist ein kleiner temporärer Artikel, dem später eine vollständige Analyse und umfassende Informationen über das, was heute passiert ist, folgen we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nicht erfolgreiche Softwarebereitstellung stürzt Cloudflare-Dienst ab</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458660/"><p>  Dies ist ein kleiner temporärer Artikel, dem später eine vollständige Analyse und umfassende Informationen über das, was heute passiert ist, folgen werden. </p><br><p>  Heute, etwa 30 Minuten lang, konnten Besucher von Cloudflare-Sites den Fehler 502 sehen, der durch einen starken Anstieg der CPU-Auslastung unseres Netzwerks verursacht wurde.  Dies war auf eine fehlgeschlagene Softwarebereitstellung zurückzuführen.  Wir haben die Änderungen rückgängig gemacht, und jetzt funktioniert der Dienst wie gewohnt wie gewohnt, und alle Domänen, die Cloudflare verwenden, sind auf das normale Verkehrsniveau zurückgekehrt. </p><a name="habracut"></a><br><p>  Wir versichern Ihnen, dass es keinen Angriff gab, und entschuldigen uns zutiefst für das, was passiert ist.  Unsere Entwickler führen bereits eine detaillierte Fehleranalyse durch und versuchen herauszufinden, was getan werden muss, um solche Vorfälle in Zukunft zu vermeiden. </p><br><p>  <strong>Gepostet um 20:09 UTC:</strong> </p><br><p> Heute um 13:42 UTC wurde ein Fehler in unserem Netzwerk festgestellt, wodurch Besucher von Cloudflare-Domänen den Fehler 502 ("Bad Gateway") sahen.  Der Grund für diesen Fehler war die Bereitstellung einer falsch konfigurierten Regel in der Cloudflare Web Application Firewall (WAF) während des Standardprozesses der Bereitstellung neuer von Cloudflare WAF verwalteter Regeln. </p><br><p>  Die neuen Regeln wurden entwickelt, um den Blockierungsmechanismus von eingebettetem JavaScript zu verbessern, das bei Hackerangriffen verwendet wird.  Diese Regeln wurden im Simulationsmodus bereitgestellt, in dem normalerweise Fehler erkannt und protokolliert werden, ohne den Benutzerverkehr zu blockieren. Auf diese Weise können wir die Anzahl der Fehlalarme messen und sicherstellen, dass die neuen Regeln bei der Bereitstellung im Rahmen dieses Projekts ordnungsgemäß funktionieren. </p><br><p>  Leider enthielt eine dieser Regeln einen regulären Ausdruck, was zu einem Anstieg der CPU-Auslastung auf unseren Computern überall um bis zu 100% führte.  Aufgrund dieses Sprunges haben die Benutzer unseres Dienstes einen 502-Fehler festgestellt, und der Datenverkehr ist auf 82% gesunken. </p><br><p>  Die folgende Grafik zeigt den CPU-Lastsprung auf einem unserer PoPs: </p><br><p><img src="https://habrastorage.org/webt/to/mj/q1/tomjq1qowdfvsn_nbvx0d_3ei5s.png"></p><br><p>  Zum ersten Mal standen wir vor dem Problem der vollständigen Erschöpfung der CPU-Ressourcen, das für uns äußerst unerwartet war. </p><br><p>  Wir stellen ständig Software in unserem Netzwerk bereit und haben bereits automatisierte Systeme für die Ausführung von Tests und ein schrittweises Bereitstellungsverfahren entwickelt, um unangenehme Situationen zu vermeiden.  Leider war die weltweite Bereitstellung von WAF-Regeln ein einmaliger Prozess, der den heutigen Misserfolg verursachte. </p><br><p>  Um 14:02 UTC erkannten wir, was passiert war, und beschlossen, die WAF-Regelsätze vollständig zu deaktivieren, wodurch die CPU-Auslastung sofort normalisiert und der Datenverkehr wiederhergestellt wurde.  Wir haben es um 14:09 UTC gemacht. </p><br><p>  Danach haben wir die problematische Pull-Anforderung analysiert, die Änderungen in den relevanten Regeln rückgängig gemacht, unsere Aktionen getestet, um 100% sicher zu sein, dass der Fehler korrekt gefunden wurde, und dann die WAF-Regelsätze um 14:52 wiederhergestellt. </p><br><p>  Wir sind uns bewusst, wie viel Schaden diese Vorfälle unseren Benutzern zufügen.  In diesem Fall hat unser Testmechanismus die Aufgabe nicht bewältigt, und wir arbeiten bereits daran, sie zu verbessern und den Bereitstellungsprozess zu optimieren, um ähnliche Fehler in Zukunft zu vermeiden. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458660/">https://habr.com/ru/post/de458660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458648/index.html">CI / CD mit AWS und Bambus</a></li>
<li><a href="../de458650/index.html">Cyber ​​Challenge. Ein neues Level. Online-Wettbewerb von Rostelecom Solar</a></li>
<li><a href="../de458652/index.html">RamblerFront & Meetup # 7</a></li>
<li><a href="../de458654/index.html">Das Lurk-Virus hat Banken gehackt, während es von gewöhnlichen Angestellten geschrieben wurde</a></li>
<li><a href="../de458658/index.html">Wechsel von virtuellen Maschinen zu LXC-Containern: Gründe, Vorteile und gebrauchsfertige Anweisungen</a></li>
<li><a href="../de458662/index.html">EMI plant die Einführung von Flugzeugdrohnentests</a></li>
<li><a href="../de458666/index.html">Dummes Gehirn, versteckte Emotionen, heimtückische Algorithmen: die Entwicklung der Gesichtserkennung</a></li>
<li><a href="../de458670/index.html">Wie Prozessoren entworfen und hergestellt werden: die Zukunft der Computerarchitekturen</a></li>
<li><a href="../de458672/index.html">20 Fragen an IT-Unternehmen vor dem Jobwechsel</a></li>
<li><a href="../de458676/index.html">Wie Sie das Beste aus dem Informatikunterricht herausholen können</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>