<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•° üôéüèø üõéÔ∏è Tombol panggilan DIY. Raspberry Pi, MajorDoMo, Freeswitch dan Linphonec üê¨ ü§õüèª üÖæÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa waktu yang lalu, saya memiliki kebutuhan untuk berkomunikasi dengan seseorang setelah suatu penyakit yang secara fisik tidak dapat menggunaka...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tombol panggilan DIY. Raspberry Pi, MajorDoMo, Freeswitch dan Linphonec</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464309/">  Beberapa waktu yang lalu, saya memiliki kebutuhan untuk berkomunikasi dengan seseorang setelah suatu penyakit yang secara fisik tidak dapat menggunakan telepon.  Perangkat panggilan sederhana diperlukan, panggilan suara dilakukan dengan satu sentuhan tombol.  Namun, kebutuhan itu menghilang, setelah mengunjungi rumah sakit sendiri, memandangi para pasien, diperkirakan solusi semacam itu mungkin berguna. <br>  Sekarang saya melihat penggunaan pribadi perangkat ini sebagai bel pintu SIP. <br><br>  Mungkin dengan perubahan kecil, kombinasi telepon VoIP dengan sistem otomasi rumah.  Sebagai pilihan untuk digunakan - SIP bel, interkom, sistem komunikasi suara (klien-personel, direktur-sekretaris), dll. <br><br><img src="https://habrastorage.org/webt/lr/x1/5g/lrx15gxymgjqei5tsqgkgzxtaiy.jpeg"><br><br>  Seluruh keputusan dibuat pada perangkat lunak bebas dan sumber terbuka: sistem operasi - Raspbian Stretch (Debian 9), sistem otomasi rumah - MajorDoMo, server VoIP - Freeswitch, klien perangkat lunak IP-teleponi dengan kemampuan untuk bekerja dalam mode terminal Linphonec. <br><br>  Di bagian ini, di bawah potongan, kita terutama akan berbicara tentang menginstal klien SIP Linphonec konsol. <br><a name="habracut"></a><br>  Kami akan membutuhkan: <br><br><ol><li>  Raspberry Pi - Single Board Computer (Saya punya model Raspberry Pi 3B) </li><li>  Kartu memori micro SD setidaknya 16 GB, pengisi daya USB, perumahan. </li><li>  Kartu suara USB (salah satu yang termurah, yang digunakan Gembird), mikrofon, speaker (headphone). </li><li>  Tombol dan sepasang jumper BBJ untuk pin GPIO. </li></ol><br>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Langkah Pertama - Menginstal Gambar MajorDoMo untuk RPI</a> <br>  Saat ini, versi gambar saat ini untuk Raspberry Pi adalah v.  3.40.  Berikut ini deskripsi singkat gambar dan perubahan MajorDoMo: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">MajorDoMo Gambar Dasar untuk Raspberry Pi</a> <br><br>  Setelah instalasi dan saat sistem dinyalakan, sambungkan speaker ke konektor 3.5 - kami akan mendengar pesan sistem dan alamat IP Raspberry. <br><br>  Nama pengguna default adalah: pi kata sandi: raspberry. <br><br>  2. Pasang FREESWITCH, <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menginstal Server VoIP FRESWITCH untuk Raspberry</a> <br><br>  Setelah itu, kami melanjutkan ke pemasangan komponen yang diperlukan.  Langkah opsional, tetapi mungkin nanti berguna. <br><br><h4>  Instal RPi-Monitor </h4><br>  Instal utilitas monitor RPI yang kecil namun bermanfaat yang menunjukkan sumber daya Raspberry PI kami. <br><br>  RPi-Monitor adalah perangkat lunak pemantauan papan Raspberry Pi berbasis web.  Alat ini dapat bermanfaat untuk mengontrol penggunaan ruang disk, beban CPU, memori dan lalu lintas jaringan, suhu.  RPI-Monitor cukup mudah dipasang, dan secara visual menampilkan informasi tentang sistem. <br><br>  Pertama-tama, saya akan memberikan tautan ke sumber: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">RPi-Monitor</a> . <br><br>  Instal kunci publik RPi-Monitor dan tambahkan ke repositori tepercaya: <br><br><pre><code class="plaintext hljs">sudo apt-get install dirmngr sudo apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 2C0D3C0F sudo wget http://goo.gl/vewCLL -O /etc/apt/sources.list.d/rpimonitor.list</code> </pre> <br>  Selanjutnya, perbarui sistem dan instal monitor RPI itu sendiri: <br><br><pre> <code class="plaintext hljs">sudo apt-get update sudo apt-get install rpimonitor</code> </pre><br>  Buka IP komputer Anda di browser dengan port: 8888, di mana monitor berjalan, dan lihat status RPI. <br><br><img src="https://habrastorage.org/webt/97/xd/rb/97xdrbtse_r_tukes5aqhdz5c_8.png"><br><br><h4>  Memasang kartu audio USB dan mengatur suara di Raspberry Pi OS </h4><br>  Sayangnya, komputer mini Raspberry kami tidak memiliki mikrofon internal dan input untuknya.  Karena itu, untuk menghubungkan mikrofon, Anda harus menggunakan kartu suara USB eksternal.  Kami menghubungkan kartu ke port USB Raspberry, dan menjalankan perintah (yang menunjukkan perangkat suara dalam sistem): <br><br><pre> <code class="plaintext hljs">cat /proc/asound/cards</code> </pre> <br>  Kami melihat jawabannya dengan dua kartu, bcm2835 - built-in, eksternal didefinisikan sebagai Perangkat Audio USB: <br><br>  <i>0 [ALSA]: bcm2835_alsa - bcm2835 ALSA</i> <i><br></i>  <i>bcm2835 ALSA</i> <i><br></i>  <i>1 [Perangkat]: USB-Audio - Perangkat Audio USB</i> <i><br></i>  <i>GeneralPlus USB Audio Device di usb-3f980000.usb-1.4, kecepatan penuh</i> <br>  OS melihat kartu suara kami, tetapi belum terdaftar di sistem. <br><br>  Buat file: <br><br><pre> <code class="plaintext hljs">sudo nano /etc/modprobe.d/alsa-base.conf</code> </pre> <br>  Kami menulis (menempel) baris berikut: <br><br>  <i>opsi snd-usb-audio index = 1</i> <br><br>  Simpan (di editor Ctrl + X). <br><br>  Buat file lain: <br><br><pre> <code class="plaintext hljs">sudo nano /etc/asound.conf</code> </pre> <br>  Tambahkan konten: <br><br><div class="spoiler">  <b class="spoiler_title">isi file</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">pcm.!default { type plug slave { pcm "hw:1,0" } } ctl.!default { type hw card 1 }</code> </pre> <br></div></div><br>  Kami mengedit file konfigurasi berikut: <br><br><pre> <code class="plaintext hljs">sudo nano /usr/share/alsa/alsa.conf</code> </pre> <br>  Ubah kartu suara default dari 0 ke 1 (kartu USB), Jelas, default 0 adalah output suara bawaan komputer mini, tetapkan parameter berikut dalam 2 baris: <br><br><pre> <code class="plaintext hljs">defaults.ctl.card 1 defaults.pcm.card 1</code> </pre> <br>  Perubahan akan berlaku, setelah mem-boot ulang, kami membebani dengan mengetik di konsol: <br><br><pre> <code class="plaintext hljs">sudo reboot</code> </pre> <br>  Kami menghubungkan mikrofon dan speaker (headphone) ke kartu audio eksternal.  Setelah reboot, jalankan utilitas konfigurasi suara Alsamixer. <br><br><pre> <code class="plaintext hljs">alsamixer</code> </pre> <br>  Kami melihat perangkat kami yang kami tetapkan dalam sistem secara default: <br><br><img src="https://habrastorage.org/webt/bx/em/kt/bxemktswfv1xvsofnautaly542i.png"><br><br>  Gunakan tombol kursor kiri dan kanan, pilih perangkat yang diinginkan, atas dan bawah, sesuaikan, perhatikan simbol di bawah perangkat yang dipilih: <br><br>  xOOx - perangkat dihidupkan, xMMx - perangkat dimatikan.  Seperti yang dapat Anda lihat di tangkapan layar, mikrofon saya dimatikan secara default di sistem. <br>  Untuk menghidupkan / mematikan perangkat, Anda perlu menekan <b>M</b> pada keyboard. <br>  Keluar dari alsamixer (keluar ctr + C). <br>  Memeriksa suara di sistem.  Speaker dan mikrofon terhubung ke output USB kartu suara yang sesuai. <br><br>  Kami memberikan perintah: <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/test_record.wav</code> </pre> <br>  Dengan perintah ini, file suara direkam melalui mikrofon ke direktori yang sesuai (dalam kasus kami, pi rumah pengguna).  Berhenti merekam <b>Ctrl + c</b> . <br><br>  Periksa file yang direkam: <br><br><pre> <code class="plaintext hljs">aplay /home/pi/test_record.wav</code> </pre> <br>  Kami akan melakukan pemeriksaan yang lebih baik nanti. <br><br><h4>  Menginstal Klien VoIP Linphonec Console </h4><br>  Tidak banyak program yang dapat bekerja di OS tanpa antarmuka grafis, saya memilih paket Linphone. <br><br>  Paketnya cukup besar, ia memiliki banyak fitur potensial, tetapi sejauh ini kami hanya memerlukan utilitas kecil Linphonec yang dapat bekerja di terminal dan memiliki fungsi jawab otomatis (pick-up otomatis). <br><br>  Baginya, tindakan berikut akan dilakukan. <br><br>  Saya perhatikan bahwa ketika menginstal dari repositori Raspbian, versi 3.6.1 yang lebih lama diinstal, yang tidak berfungsi dengan baik dengan sistem suara ALSA, saya mengalami kehilangan suara, program macet beberapa kali. <br><br>  Karena itu, saya akan menggunakan versi yang lebih terkini. <br><br>  Untuk perakitan sendiri paket dari sumber, kami memasang dependensi tambahan: <br><br><pre> <code class="plaintext hljs">sudo apt-get install cmake automake autoconf libtool intltool yasm libasound2-dev libpulse-dev libv4l-dev nasm git libglew-dev</code> </pre><br>  Buka direktori home: <br><br><pre> <code class="plaintext hljs">cd /home/pi/</code> </pre> <br>  Unduh paket Linphone itu sendiri, unduhannya memakan waktu sekitar 20 menit. <br><br><pre> <code class="plaintext hljs">git clone git://git.linphone.org/linphone-desktop.git --recursive</code> </pre> <br>  Saya tidak bisa mengkompilasi dan mengkompilasi paket Linphone dari pertama atau bahkan kedua kalinya.  Karena itu, saya akan memberikan algoritma tindakan saya. <br><br>  Kami menghentikan hampir semua yang saat ini berjalan, tetapi saat ini layanan yang tidak digunakan, menggunakan sistem manajemen layanan systemctl. <br><br>  Ada kesalahan selama perakitan, PC mini kami tidak memiliki sumber daya yang cukup.  Bebaskan mereka untuk instalasi. <br><br><div class="spoiler">  <b class="spoiler_title">Menghentikan layanan</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">sudo systemctl stop freeswitch.service sudo systemctl stop majordomo.service sudo systemctl stop avahi-daemon.socket sudo systemctl stop avahi-daemon.service sudo systemctl stop mosquitto.service sudo systemctl stop mysql sudo systemctl stop mpd.service sudo systemctl stop mpd.socket sudo systemctl stop homebridge.service sudo systemctl stop nginx.service sudo systemctl stop bluetooth.target sudo systemctl stop bluetooth.service</code> </pre><br></div></div><br>  Untuk berjaga-jaga, kita dapat membuat file swap sementara (sebelum memulai ulang) (ruang hard disk), yang digunakan sistem operasi jika RAM tidak mencukupi. <br>  Untuk memeriksa apakah file swap termasuk dalam instalasi Raspbian (Debian) kami dengan mengetik: <br><br><pre> <code class="plaintext hljs">sudo swapon --show</code> </pre> <br>  Outputnya kosong, yang berarti bahwa sistem tidak memiliki file swap. <br>  Tambahkan 1G swap dan buat file: <br><br><pre> <code class="plaintext hljs">sudo fallocate -l 1G /swapfile</code> </pre> <br>  Hanya pengguna root yang dapat membaca dan menulis ke file halaman, jadi kami menetapkan izin yang benar: <br><br><pre> <code class="plaintext hljs">sudo chmod 600 /swapfile</code> </pre> <br>  Kami menggunakan alat mkswap untuk mengkonfigurasi area swap Linux dalam file dan mengaktifkannya dengan mengetikkan perintah berikut: <br><br><pre> <code class="plaintext hljs">sudo mkswap /swapfile sudo swapon /swapfile</code> </pre><br>  Buka direktori yang dibuat saat mengunduh paket: <br><br><pre> <code class="plaintext hljs">cd linphone-desktop</code> </pre> <br>  Kami mempersiapkan instalasi versi tanpa antarmuka grafis: <br><br><pre> <code class="plaintext hljs">sudo ./prepare.py no-ui -DENABLE_OPENH264=ON -DENABLE_WEBRTC_AEC=OFF -DENABLE_UNIT_TESTS=OFF -DENABLE_MKV=OFF -DENABLE_FFMPEG=ON -DENABLE_CXX_WRAPPER=OFF -DENABLE_NON_FREE_CODECS=ON -DENABLE_VCARD=OFF -DENABLE_BV16=OFF -DENABLE_V4L=OFF</code> </pre><br>  Bangun menggunakan atribut ‚Äìj4 (mis., Buat 4 utas pada saat yang sama. <br><br><pre> <code class="plaintext hljs">sudo make -j4</code> </pre> <br>  Saat memasang, kita dapat melihat status komputer kita di RPI-Monitor: <br><br><img src="https://habrastorage.org/webt/mo/av/vx/moavvxkzq01wxkp5hxayi-oip2y.png"><br><br>  Waktu membangun untuk saya adalah sekitar 30-40 menit. <br><br>  File program yang dikompilasi muncul di direktori OUTPUT / no-ui / bin.  Untuk menjalankan program, mari kita masuk ke dalamnya: <br><br><pre> <code class="plaintext hljs">cd OUTPUT/no-ui/bin</code> </pre> <br>  Periksa versi program: <br><br><pre> <code class="plaintext hljs">./linphonec -v</code> </pre> <br>  Kami mendapatkan hasilnya: versi: 3.12.0 <br>  Overloading Raspberry kami <br>  Saat memulai ulang, file swap menghilang, semua layanan yang berjalan yang terdaftar di startup dipulihkan. <br><br><h4>  Pengaturan awal Freeswitch kecil. </h4><br>  Server FREESWITCH diinstal secara default di direktori / usr / local / freeswitch /.  Folder conf berisi file konfigurasi.  Secara default, konfigurasi uji vanilla terinstal, yang sebagian besar berfungsi untuk membiasakan diri dengan kemungkinan server VoIP dan berisi sejumlah besar contoh yang jelas-jelas berlebihan untuk digunakan di rumah.  Pertama, mari kita lihat konfigurasi out of the box dari server VoIP. <br><br>  Edit file konfigurasi vars.xml <br><br><pre> <code class="plaintext hljs">sudo nano /usr/local/freeswitch/conf/vars.xml</code> </pre> <br>  Pertama-tama, ubah kata sandi default 1234 ke nilai yang berbeda, katakan 1111. Jika Anda tidak melakukan ini, maka sebelum setiap panggilan, jeda ditetapkan sebelum memanggil 10 detik. <br><br>  Secara default, seperti yang saya tulis di artikel sebelumnya, kami memiliki 20 nomor pelanggan 1001-1020.  Dialplan juga diinstal secara default. <br><br>  Untuk beberapa alasan, kali ini, dibandingkan dengan enam bulan yang lalu, ketika modul mod_xml_rpc dihidupkan, server terus-menerus macet. <br><br>  Dialplan FreeSWITCH memanfaatkan ekstensif ekspresi reguler.  Dialplan default bertanggung jawab untuk memproses panggilan, bagian selanjutnya dari file Local_Extension bertanggung jawab untuk mengirim ke nomor lokal kami.  Mengomentari beberapa baris: <br><br><pre> <code class="plaintext hljs">sudo nano /usr/local/freeswitch/conf/dialplan/defaults.xml</code> </pre> <br>  Pengeditan dialog, masukkan simbol komentar di bagian ini: <br><br><div class="spoiler">  <b class="spoiler_title">Pengeditan dialog angka 1001-1019</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Local_Extension"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"destination_number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"^(10[01][0-9])$"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"export"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dialed_extension=$1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- &lt;action application="bind_meta_app" data="1 bs execute_extension::dx XML features"/&gt; &lt;action application="bind_meta_app" data="2 bs record_session::$${recordings_dir}/${caller_id_number}.${strftime(%Y-%m-%d-%H-%M-%S)}.wav"/&gt; &lt;action application="bind_meta_app" data="3 bs execute_extension::cf XML features"/&gt; &lt;action application="bind_meta_app" data="4 bs execute_extension::att_xfer XML features"/&gt; --&gt;</span></span></code> </pre><br></div></div><br>  <i>Penyimpangan kecil, menurut saya, terlepas dari kemampuan FS bekerja, setelah beberapa perubahan kami, lebih baik untuk mengulang file konfigurasi FS untuk Anda sendiri, termasuk</i>  <i>berlangganan, dialplan, dll., tetapi Anda tidak dapat memasukkan semuanya dalam satu artikel, jadi kami beralih ke klien terminal kami.</i> <br><br><h4>  Konfigurasikan dan luncurkan klien terminal Linphonec </h4><br>  Jalankan Linphonec dalam mode jawab otomatis dari pengguna pi saat ini: <br><br><pre> <code class="plaintext hljs">/home/pi/linphone-desktop/OUTPUT/no-ui/bin/linphonec -a</code> </pre> <br>  Pada peluncuran pertama, Linphonec mencoba membuat file database dan file pengaturan.  Namun, peluncurannya salah. <br><br><div class="spoiler">  <b class="spoiler_title">kesalahan memulai linphonec</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019-08-02 18:02:58:715 mediastreamer-error-Connection to the pulseaudio server failed 2019-08-02 18:02:58:946 belle-sip-error-udp bind() failed for ::0 port 5060: Address already in use 2019-08-02 18:02:58:947 belle-sip-error-TCP bind() failed for ::0 port 5060: Address already in use 2019-08-02 18:02:59:126 liblinphone-fatal-Unable to open linphone database. Aborted</code> </pre> <br></div></div><br>  Awalnya, kita akan berurusan dengan kesalahan terakhir, membuka file database. <br><br>  File database dibuat di direktori home di sepanjang jalur berikut: /home/pi/.local/share/linphone <br>  File Linux (atau direktori) dianggap tersembunyi jika namanya dimulai dengan periode ‚Äú.‚Äù.  Misalnya, ".file".  Biasanya, file tersebut digunakan oleh aplikasi untuk menyimpan pengaturan, konfigurasi, dan informasi lain yang perlu disembunyikan dari pengguna. <br>  Buat direktori dari pengguna saat ini (pi) <br><pre> <code class="plaintext hljs">mkdir /home/pi/.local mkdir /home/pi/.local/share mkdir /home/pi/.local/share/linphone</code> </pre> <br>  Kami memulai program, program dimulai, tetapi memberikan kesalahan: <br><div class="spoiler">  <b class="spoiler_title">Kesalahan Pembukaan Port</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">2019-08-07 11:29:32:780 mediastreamer-error-Connection to the pulseaudio server failed 2019-08-07 11:29:32:866 belle-sip-error-udp bind() failed for ::0 port 5060: Address already in use 2019-08-07 11:29:32:866 belle-sip-error-TCP bind() failed for ::0 port 5060: Address already in use</code> </pre> <br></div></div><br>  Kami menemukan masalah pertama dalam membuat basis data, saat peluncuran awal, program menghasilkan file basis data. <br><br>  Kesalahan yang terkait dengan sistem suara Pulseaudio - tidak mengganggu fungsi program, saya berencana untuk menggunakan ALSA, jika perlu, server suara selalu dapat diinstal sebelumnya. <br><br>  Yang kedua - port 5060 sedang sibuk.  Port-port ini biasanya digunakan oleh aplikasi SIP.  Kita dapat keluar dari program dan memberikan perintah: <br><br><pre> <code class="plaintext hljs">sudo netstat -tulpn | grep LISTEN</code> </pre> <br>  Kita akan melihat bahwa port 5060 menggunakan server FREESWITCH VoIP kami.  Kami akan menggunakan porta gratis. <br><br>  Kami kembali ke program linphonec.  Dan lakukan sedikit pengaturan. <br><br>  Pertama-tama, ubah port untuk Linfon, kemudian tunjukkan pendaftaran ke server VoIP, periksa status pendaftaran dan lihat daftar kartu suara, kartu yang digunakan dan konfigurasikan pada USB eksternal (dengan indeks dalam program Linphone - 2): <br><br><pre> <code class="plaintext hljs">ports sip 5062 register sip:1001@192.168.15.13 192.168.15.13 1111 linphonec&gt; help register status register soundcard list soundcard show soundcard use 2 soundcard show</code> </pre><br><img src="https://habrastorage.org/webt/o3/1u/3d/o31u3dvxihunuxmqclxmbfkwfng.png"><br><br>  Di tim pendaftaran, kami menggunakan format berikut: Sip ID pengguna - secara default, kami memiliki 20 pelanggan dengan angka 1001-1019.  Nomor-nomor ini adalah nama pengguna pelanggan. Login Pelanggan @ [Nama domain] - nama domain - alamat IP Raspberry kami.  Proksi menyesap - cocok dengan alamat IP RPI, dan pada akhirnya - kata sandi pengguna yang baru saja kami atur 1111. <br><br>  Keluar dari program (Ctrl + x), pengaturan tidak selalu diterapkan dengan cepat.  Setelah keluar di direktori home / home / pi, file konfigurasi klien konsol muncul: .linphonerc. <br>  Kami sudah dapat melakukan perubahan dengan mengedit file konfigurasi klien SIP. <br>  Pada klien SIP konsol peluncuran baru. <br>  Sejalan dengan sesi SSH saat ini, buka yang baru, masuk menggunakan nama pengguna dan kata sandi Anda. <br>  Kami memulai alsamixer.  Dalam satu sesi, kami memiliki Linphonec, di sesi kedua, utilitas penyetelan suara. <br>  Kami membuat pengaturan panggilan dari klien SIP pada smartphone atau PC (seperti yang dijelaskan dalam artikel tentang menginstal FREESWITCH) dengan mengubah kata sandi default ke nomor Anda sendiri dan menekan nomor, dalam kasus kami 1001. Kita dapat pergi ke portal freswitch di IP_Raspberry: 8080, melihat registrasi pelanggan, status menelepon, dll. <br><br><img src="https://habrastorage.org/webt/wu/qq/ta/wuqqta-dhsd0j8nr_mixybesqam.png"><br><br>  Menggunakan alsamixer, kami menyesuaikan suara.  Perubahan suara diterapkan dengan cepat, tanpa keluar dari program. <br><br>  Sayangnya, karena penggunaan kartu audio yang murah, saya tidak dapat mencapai suara yang dapat diterima, sebuah gema terdengar di speaker.  Ini dapat diminimalkan, tetapi sepenuhnya dihapus - saya tidak berhasil. <br><br>  Karena itu, karena tidak mungkin menghapusnya dengan satu cara, kami menghilangkannya dengan cara lain. <br>  Tutup Linphonec, edit file konfigurasi: <br><br><pre> <code class="plaintext hljs">sudo nano /home/pi/.linphonerc</code> </pre> <br>  Di bagian suara, kami membawa tiga baris terakhir ke formulir ini: <br><br><div class="spoiler">  <b class="spoiler_title">Bagian Suara Linphonerc</b> <div class="spoiler_text"><pre> <code class="xml hljs">[sound] remote_ring=/home/pi/linphone-desktop/OUTPUT/no-ui/share/sounds/linphone/ringback.wav playback_gain_db=0.000000 mic_gain_db=0.000000 ringer_dev_id=ALSA: bcm2835 ALSA playback_dev_id=ALSA: bcm2835 ALSA capture_dev_id=ALSA: USB Audio Device</code> </pre><br></div></div><br>  Dengan cara ini, kami memaksa alat pendering dan keluaran suara bekerja pada jack raspberry 3.5 internal, dan alat perekam - mikrofon untuk bekerja melalui kartu suara eksternal - gema menghilang. <br><br>  Alihkan speaker ke konektor milik raspberry. <br><br>  Kami memperhitungkan momen berikut: saat memuat dan dalam beberapa kasus, sistem rumah pintar memutar pesan sistemnya melalui output audio ini. <br><br>  Matikan.  Kami meneruskan IP_Rasberry ke halaman utama, membuka sistem otomatisasi rumah MajorDoMo. <br><br>  Kami memasuki panel kontrol - objek Komputer (perluas perangkat) - Komputer ini pada tab Properti dan atur nilainya: <br><br><pre> <code class="plaintext hljs"> ThisComputer.minMsgLevel 100 ThisComputer.volumeLevel 0</code> </pre> <br><img src="https://habrastorage.org/webt/tr/to/tj/trtotjj9oalk1kj-3tddund0ggi.png"><br><br>  Tambahkan entri ke cron (program daemon yang dirancang untuk melakukan tugas pada waktu tertentu, atau pada interval tertentu. Utilitas crontab digunakan untuk mengedit tugas): <br><br><pre> <code class="plaintext hljs">crontab ‚Äìe</code> </pre> <br>  Saya perhatikan kami melakukan ini dari bawah pi pengguna. <br><br>  Masukkan baris di bagian paling akhir: <br><br><pre> <code class="xml hljs">@reboot /home/pi/linphone-desktop/OUTPUT/no-ui/bin/linphonec ‚Äìa</code> </pre> <br>  Saat memulai ulang, menyalakan komputer, baris ini meluncurkan program Linphonec dalam mode jawab otomatis. <br>  Kembali ke MajorDoMo: <br>  Mari kita pergi ke halaman utama, di bagian layanan: <br>  Di menu bagian ini, tombol dibuat untuk me-reboot (mematikan) komputer. <br>  Faktanya adalah bahwa untuk menghemat sumber daya kartu memori SD, perubahan dicatat dalam sistem "rumah pintar" setelah waktu tertentu (15 menit).  Karena itu, jika Anda perlu membebani raspberry, maka lebih baik melakukannya dengan benar.  Kami me-reboot sistem. <br><br><img src="https://habrastorage.org/webt/bn/wl/dg/bnwldg1njtqrveligvtgmkm9iya.png"><br><br>  Setelah reboot, pergi ke halaman utama MajorDoMo, pergi ke panel kontrol, dan seperti pada artikel terakhir kami membuat panggilan dari konsol menggunakan format berikut: <br><br><pre> <code class="xml hljs">GetURL("http://freeswitch:works@192.168.1.103:8080/webapi/originate?user/1001%201003%20XML%20default")</code> </pre> <br>  Mengikuti perintah, Linphonec secara otomatis mengangkat telepon.  Di speaker RPI, file suara sedang diputar, panggilan sedang dikirim ke softphone kedua (PC / smartphone).  Setelah mengangkat handset (dengan menekan tombol jawab dalam program), koneksi berhasil dibuat. <br><br><img src="https://habrastorage.org/webt/ry/4p/qk/ry4pqktur2kidele7g7hvs0mgou.png"><br><br>  Tentang ini, saya menyelesaikan bagian ini.  Saya akan mencoba menjelaskan sedikit nanti tentang tombol itu sendiri menggunakan GPIO dan mengatur panggilan di luar jaringan lokal saya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id464309/">https://habr.com/ru/post/id464309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id464295/index.html">Contoh menggunakan beberapa fitur JavaScript baru</a></li>
<li><a href="../id464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../id464303/index.html">Data deret waktu dalam DBMS relasional. Ekstensi TimescaleDB dan PipelineDB untuk PostgreSQL</a></li>
<li><a href="../id464305/index.html">Kecil ya. Membuka kotak microvirtual Firecracker</a></li>
<li><a href="../id464307/index.html">Pengujian integrasi layanan microser di Scala</a></li>
<li><a href="../id464315/index.html">Film di mana ada tanah. Penelitian Yandex dan sejarah singkat pencarian berdasarkan makna</a></li>
<li><a href="../id464317/index.html">Proyek Konbanwa</a></li>
<li><a href="../id464325/index.html">Bagaimana Scrumban Menyatukan yang Terbaik dari Metodologi Kanban dan Scrum</a></li>
<li><a href="../id464327/index.html">Perbandingan penggunaan memori GUI toolkit berbeda</a></li>
<li><a href="../id464331/index.html">Manfaat Tidak Berguna: Sintesis Bahan Kimia Penyerap UV dari Kacang Mete</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>