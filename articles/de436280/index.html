<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äçü§ù‚Äçüë®üèº üõÄüèæ üë° Implementieren Sie Honeypot auf Cisco-Routern üõ∏ üèÅ üë©‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mir kam der Gedanke, auf dem Cisco-Router einen Anschein des bekannten fail2ban-Pakets zu erwecken, indem ich nur den Router selbst verwendete. 

 Es ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementieren Sie Honeypot auf Cisco-Routern</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436280/"><img src="https://habrastorage.org/webt/w8/x1/n-/w8x1n-0iyfkeg1-5jzexhxudfrq.jpeg"><br><br>  Mir kam der Gedanke, auf dem Cisco-Router einen Anschein des bekannten fail2ban-Pakets zu erwecken, indem ich nur den Router selbst verwendete. <br><br>  Es funktioniert so.  Trap-Regeln werden in der Zugriffsliste erstellt, die an die Schnittstelle des Border-Internet-Routers angeh√§ngt ist.  Wenn eine Regel ausgel√∂st wird, wird ein Ereignis protokolliert.  Jede Zeile eines solchen Ereignisses enth√§lt eine spezielle Bezeichnung, um die Auswahl zu erleichtern.  Das Protokoll wird analysiert und alle IP-Adressen, die in den Trap fallen, werden in eine spezielle Objektgruppe eingegeben.  Diese Gruppe kann in derselben Zugriffsliste verwendet werden, um den Zugriff f√ºr Angreifer auf alle IP-Adressen und Ports unseres Netzwerks zu sperren. <br><br>  Um diesen Artikel zu verstehen, m√ºssen Sie wissen, was Zugriffslisten sind und wof√ºr sie bestimmt sind, und Sie m√ºssen auch wissen, wie Objektgruppen in Zugriffslisten verwendet werden. <br><a name="habracut"></a><br><h4>  Zugriffslistenfallen </h4><br>  Zum Beispiel schreiben wir eine Regel f√ºr eine Eingangszugriffsliste, nach der alle Versuche fallen, √ºber das Internet in den Telnet-Port unserer Ger√§te zu gelangen.  Bitte beachten Sie, dass am Ende der Regel ein eindeutiges Etikett ‚ÄûHONEYPOT001‚Äú angebracht ist.  Dann werden wir im Protokoll danach suchen. <br><br><pre><code class="plaintext hljs">ip access-list extended acl-WAN-In ‚Ä¶ deny tcp any any eq telnet log HONEYPOT001 ‚Ä¶</code> </pre> <br>  Es ist wichtig, die richtigen Kriterien f√ºr Fallen auszuw√§hlen. <br><br>  Versuche, von au√üen √ºber Port 23 (Telnet) eine Verbindung herzustellen, sind m√∂glicherweise am h√§ufigsten.  In diesem Fall wird die Objektgruppe sofort mit IP-Adressen von Bots aus dem gesamten Internet gef√ºllt, und der f√ºr Zugriffslisten zugewiesene Speicher wird einfach beendet. <br><br>  Sie k√∂nnen Versuche abfangen, eine Verbindung zu Ihrem Ger√§t √ºber Port 22 (ssh) herzustellen.  Sie sind eine Gr√∂√üenordnung kleiner als Telnet.  Sie k√∂nnen Versuche abfangen, auf eines Ihrer Ger√§te zuzugreifen. <br><br>  Eine gro√üe Anzahl von Bots kriecht auf Port 7547 und versucht, mithilfe des CPE-WAN-Verwaltungsprotokolls eine Verbindung herzustellen. <br><br>  Eine andere M√∂glichkeit w√§re, Versuche zu fangen, den an Port 4786 aktivierten Smart Install Client zu verwenden. <br><br>  Sie k√∂nnen auch einen Trap an Port 80 festlegen, indem Sie eine IP-Adresse ausw√§hlen, auf der Sie keinen Webserver haben.  Die Hauptsache hier ist, dass Suchmaschinenroboter nicht hineinfallen. <br><br>  Hier ist ein Beispiel f√ºr einen Trap auf einer IP-Adresse [192.0.2.10]. <br><br><pre> <code class="plaintext hljs">ip access-list extended acl-WAN-In ‚Ä¶ deny tcp any host 192.0.2.10 eq www log HONEYPOT002 ‚Ä¶</code> </pre><br><h4>  Protokollanalyse </h4><br>  Die Anmeldung am Router sollte nat√ºrlich im Voraus aktiviert werden, dann wird so etwas in das Protokoll aufgenommen: <br><br><pre> <code class="plaintext hljs">225435: Jan 11 08:57:13.838: %SEC-6-IPACCESSLOGP: list acl-WAN-In denied tcp 123.199.32.7(59472) -&gt; 192.0.2.9(23), 1 packet [HONEYPOT001]</code> </pre> <br>  Wir sehen, dass versucht wurde, von der externen IP-Adresse [123.199.32.7] auf den 23. Port unserer IP-Adresse [192.0.2.9] zuzugreifen.  Das Etikett "HONEYPOT001" in der Zeile ist ebenfalls vorhanden.  √úbrigens ist [123.199.32.7] ein echter Angreifer, der beim Schreiben eines Artikels erwischt wurde. <br><br>  Zum Parsen des Protokolls verwenden wir den Embedded Event Manager (EEM), ein in Cisco IOS integriertes Tool zur Automatisierung von Aufgaben und zur Optimierung des Softwareverhaltens. <br><br>  Erstellen Sie im Konfigurationsmodus des Routers ein Applet, das das Protokoll analysiert. Wenn sich in der Protokollzeile die Bezeichnung ‚ÄûHONEYPOT001‚Äú befindet, wird die IP-Adresse des Angreifers ausgeschnitten und diese Adresse der BlackList-Objektgruppe des Hosts hinzugef√ºgt. <br><br><pre> <code class="plaintext hljs">event manager applet honeypot event syslog occurs 1 pattern "HONEYPOT001" action 100 regexp "([0-9]+\.[0-9]+\.[0-9]+\.[0-9]+)" "$_syslog_msg" result IP_address action 200 if $_regexp_result eq "1" action 210 cli command "enable" action 220 cli command "conf t" action 230 cli command "object-group network hosts-BlackList" action 240 cli command "h $IP_address" action 250 cli command "end" action 260 syslog msg "IP address $IP_address added to blacklist" action 270 end action 300 cli command "exit"</code> </pre><br><ul><li>  Wenn die n√§chste Zeile im Protokoll mit der Bezeichnung ‚ÄûHONEYPOT001‚Äú gefunden wird, tritt ein Ereignis auf. </li><li>  Im Ereignishandler wird aus der Protokollzeile gem√§√ü dem Muster "([0-9] + \. [0-9] + \. [0-9] + \. [0-9] +)" die IP-Adresse des Angreifers herausgeschnitten und zugewiesen Variable IP_Adresse (Aktion 100); </li><li>  Wenn die Adresse erfolgreich ausgeschnitten wurde und keine Probleme beim Parsen der Zeile auftreten (Aktion 200), werden Konsolenbefehle ausgef√ºhrt, die die IP-Adresse zur Objektgruppe hinzuf√ºgen (Aktion 210 - 250). </li><li>  Im Protokoll wird ein Eintrag √ºber das Ausl√∂sen der Falle vorgenommen (Aktion 260). </li></ul><br><h4>  Zugriffssperre </h4><br>  Das erste, was mir in den Sinn kommt, ist die Verwendung der Objektgruppe, um Angreifer f√ºr alle Ressourcen unseres Netzwerks vollst√§ndig zu blockieren. <br><br>  Die Blockierungsregel muss sich in der Zugriffsliste √ºber der Regel mit dem Trap befinden, damit die gesperrte IP-Adresse nicht immer wieder in den Trap f√§llt. <br><br><pre> <code class="plaintext hljs">ip access-list extended acl-WAN-In ‚Ä¶ deny ip object-group hosts-BlackList any ‚Ä¶ deny tcp any any eq telnet log HONEYPOT001 ‚Ä¶</code> </pre><br><h4>  Amnestie </h4><br>  Fr√ºher oder sp√§ter √ºberschreitet die Objektgruppe alle zul√§ssigen Gr√∂√üen, sodass Sie eine Amnestie durchf√ºhren m√ºssen, indem Sie alte IP-Adressen daraus l√∂schen.  Dazu schreiben wir ein Applet, das dies beispielsweise einmal pro Woche um Mitternacht am Sonntag ausf√ºhrt. <br><br>  Auf dem Weg zum Schreiben werden wir zwei Fallstricke begegnen. <br><br>  Sie k√∂nnen die in der Zugriffsliste verwendete Objektgruppe nicht l√∂schen.  Daher m√ºssen Sie zuerst die Zeilennummer der Zugriffsliste ermitteln, in der die Gruppe verwendet wird.  In unserem Beispiel ist dies Zeile 60. Wir werden diese Nummer verwenden, um die Zeile mit der Gruppe aus der Zugriffsliste zu entfernen und sie dann an ihren urspr√ºnglichen Platz zur√ºckzubringen. <br><br>  Sie k√∂nnen keine leere Objektgruppe erstellen.  Daher f√ºgen wir sofort beim Erstellen einer Gruppe die IP-Adresse [255.255.255.255] hinzu.  Diese Adresse wird niemals von Routern weitergeleitet, die das lokale Netzwerk mit anderen Netzwerken verbinden. Daher erwarten wir keine Verbindungen von diesem Netzwerk. <br><br><pre> <code class="plaintext hljs">event manager applet DeleteBlackList event timer cron name timer-cron1 cron-entry "@weekly" action 100 cli command "enable" action 200 cli command "conf t" action 210 cli command "ip access-list ext acl-WAN-In" action 215 cli command "no 60" action 220 cli command "exit" action 225 cli command "no object-group net hosts-BlackList" action 230 cli command "object-group net hosts-BlackList " action 240 cli command "host 255.255.255.255" action 245 cli command "exit" action 250 cli command "ip access-list ext acl-WAN-In" action 255 cli command "60 deny ip object-group hosts-BlackList any" action 260 cli command "exit" action 265 cli command "end" action 300 syslog msg "Completed" action 400 cli command "exit"</code> </pre><br><ul><li>  Entfernen Sie die Regel mit der Objektgruppe aus der Zugriffsliste.  (Aktion 210 - 220); </li><li>  die Gruppe selbst l√∂schen (Aktion 225); </li><li>  Erstellen Sie die Objektgruppe erneut und geben Sie die Broadcast-IP-Adresse ein.  (Aktion 230 - 245); </li><li>  Wir bringen die Regel an den alten Ort in der Zugriffsliste zur√ºck.  (Aktion 250 - 260). </li></ul><br><h4>  Was tun, wenn Zugriffslisten-Tags nicht unterst√ºtzt werden? </h4><br>  Viele IOS erlauben trotz der Tatsache, dass die Funktion "Syslog Correlation ACL" in ihnen deklariert ist, keine Kennzeichnung von Zugriffslistenzeichenfolgen. <br><br>  In diesem Fall k√∂nnen Sie die sogenannten generierten Hashwerte verwenden.  (vom Ger√§t generierter Hashwert), der den Protokollnachrichtenzeilen hinzugef√ºgt wird. <br><br>  Wenn das IOS-nicht beide Optionen unterst√ºtzt, m√ºssen Sie die Analyse etwas komplizieren. <br>  Wir √§ndern die Regel mit einem Trap in der Zugriffsliste.  Anstelle von "log" verwenden wir "log-input". <br><br><pre> <code class="plaintext hljs">ip access-list extended acl-WAN-In ‚Ä¶ deny tcp any any eq telnet log-input ‚Ä¶</code> </pre><br>  In diesem Fall werden Informationen √ºber den Namen der physischen Schnittstelle und m√∂glicherweise √ºber die MAC-Adresse des Nachbarrouters, der das Paket weitergeleitet hat, zus√§tzlich in das Protokoll aufgenommen. <br>  Die folgende Meldung wird beispielsweise in das Protokoll aufgenommen: <br><br><pre> <code class="plaintext hljs">Jan 11 00:20:23 172.25.100.43 2394768: Jan 10 20:20:22.808: %FMANFP-6-IPACCESSLOGP: SIP1: fman_fp_image: list acl-WAN-In denied tcp 123.199.32.7(7537) Port-channel1.88-&gt; 192.0.2.9(23), 1 packet</code> </pre> <br><br>  Die Regel zum Aktivieren des Ereignisses hat dann folgende Form: <br><br><pre> <code class="plaintext hljs">event syslog occurs 1 pattern "Port-channel1\.88-&gt; 192\.0\.2\."</code> </pre><br><h4>  Was zu lesen </h4><br>  Informationen zur eindeutigen Identifizierung der Regeln, die die Nachricht im Protokoll generiert haben: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ACL-Syslog-Korrelation</a> <br><br>  Informationen zu Embedded Event Manager: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Konfigurationshandbuch f√ºr Embedded Event Manager</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436280/">https://habr.com/ru/post/de436280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436268/index.html">Wir sammeln ein komplettes Deck</a></li>
<li><a href="../de436270/index.html">35% der Runet-Zuschauer verwenden √ºberhaupt keinen Computer f√ºr das Internet</a></li>
<li><a href="../de436272/index.html">Visuelle Programmierung f√ºr Sonoff Basic</a></li>
<li><a href="../de436274/index.html">In Russland wird eine mobile Anwendung zur Unfallregistrierung erstellt</a></li>
<li><a href="../de436276/index.html">Dreidimensionale Visualisierung in Simulatoren von Fahrzeugen basierend auf der OpenSceneGraph-Engine</a></li>
<li><a href="../de436282/index.html">Herausforderung von einer ausl√§ndischen Firma oder wie ich ein Interview nicht bestanden habe</a></li>
<li><a href="../de436284/index.html">Hacken von Amazon Echo und Google Home zum Schutz der Privatsph√§re</a></li>
<li><a href="../de436288/index.html">Wie begann das Monopol oder ein wenig Aufhebens um den IBM PC 5150?</a></li>
<li><a href="../de436292/index.html">Kontrollieren, √§ndern, l√∂schen: Top 10 Berichte von DotNext 2018 Moskau</a></li>
<li><a href="../de436294/index.html">Zeitreihenmodellierung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>