<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèº üòâ üò¨ Erstellen eines Katzenhakens in Unity. Teil 1 üí° üè® üåè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Katzenhaken verleihen dem Spiel Spa√ü und interessante Mechanik. Sie k√∂nnen sie verwenden, um sich durch Level zu bewegen, in Arenen zu k√§mpfen und Geg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erstellen eines Katzenhakens in Unity. Teil 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414887/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/a3e/e5d/348a3ee5d95a10273c8bc644e3dbc7d9.gif" alt="Bild"></div><br>  Katzenhaken verleihen dem Spiel Spa√ü und interessante Mechanik.  Sie k√∂nnen sie verwenden, um sich durch Level zu bewegen, in Arenen zu k√§mpfen und Gegenst√§nde zu erhalten.  Trotz der scheinbaren Einfachheit kann die Physik des Seilmanagements und die Schaffung eines realistischen Verhaltens eine Herausforderung sein! <br><br>  Im ersten Teil dieses Tutorials implementieren wir unser eigenes zweidimensionales Hook-Cat-System und lernen Folgendes: <br><br><ul><li>  Erstellen Sie ein Zielsystem. </li><li>  Verwenden Sie den Linienrenderer und das Distanzgelenk, um das Seil zu erstellen. </li><li>  Wir werden dem Seil beibringen, sich um Spielobjekte zu wickeln. </li><li>  Berechnen Sie den Schwenkwinkel am Seil und erh√∂hen Sie die St√§rke in dieser Richtung. </li></ul><br><blockquote>  <em>Hinweis</em> : Dieses Lernprogramm richtet sich an fortgeschrittene und erfahrene Benutzer und behandelt keine Themen wie das Hinzuf√ºgen von Komponenten, das Erstellen neuer GameObject-Skripts und die C # -Syntax.  Wenn Sie Ihre Unity-Kenntnisse verbessern m√ºssen, lesen Sie unsere Tutorials <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Erste Schritte mit Unity</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einf√ºhrung in Unity Scripting</a> .  Da <em>DistanceJoint2D</em> in diesem Lernprogramm verwendet wird, sollten Sie auch die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Physikverbindungen in Unity 2D durchsehen</a> und erst dann zu diesem Lernprogramm zur√ºckkehren. </blockquote><a name="habracut"></a><br><h2>  An die Arbeit gehen </h2><br>  Laden Sie den <a href="">Entwurf</a> f√ºr dieses Tutorial herunter und √∂ffnen Sie ihn im Unity-Editor.  F√ºr den Betrieb ist Unity 2017.1 oder h√∂her erforderlich. <br><br>  √ñffnen Sie die Spielszene aus dem Ordner " <em>Szenen</em> " und sehen Sie, wo wir anfangen werden: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/973/819/22f/97381922f527deb0b338346d13083c13.png"></div><br>  Im Moment haben wir einen einfachen Spielercharakter (Schnecke) und Steine, die in der Luft h√§ngen. <br><br>  Wichtige Komponenten von GameObject <em>Player</em> sind bisher Capsule Collider und Rigidbody, die es ihm erm√∂glichen, mit physischen Objekten auf der Ebene zu interagieren.  Au√üerdem ist dem Charakter ein einfaches Bewegungsskript ( <em>PlayerMovement</em> ) beigef√ºgt, mit dem er auf dem Boden gleiten und einfache Spr√ºnge ausf√ºhren kann. <br><br>  Dr√ºcken Sie die <em>Play-</em> Taste, um das Spiel zu starten, und versuchen Sie, den Charakter zu steuern.  <em>A</em> und <em>D</em> bewegen es nach links / rechts, und wenn Sie die <em>Leertaste</em> dr√ºcken <em>,</em> springt es.  Versuche nicht zu rutschen und von der Klippe zu fallen, sonst wirst du sterben! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69a/8b5/841/69a8b58415940671c3519ceccfcf6ed7.png"></div><br>  Wir haben bereits die Grundlagen des Managements, aber das gr√∂√üte Problem ist jetzt das Fehlen von Katzenhaken. <br><br><h2>  Haken und Seile erstellen </h2><br>  Das Cat-Hook-System scheint zun√§chst recht einfach zu sein, aber f√ºr seine qualitativ hochwertige Implementierung m√ºssen viele Aspekte ber√ºcksichtigt werden.  Hier sind einige der Anforderungen f√ºr die zweidimensionale Cat-Hook-Mechanik: <br><br><ul><li>  Line Renderer zur Anzeige des Seils.  Wenn sich das Seil um Objekte wickelt, k√∂nnen wir dem Linienrenderer weitere Segmente hinzuf√ºgen und die Eckpunkte an den Punkten platzieren, die den Seilbr√ºchen entsprechen. </li><li>  DistanceJoint2D.  Es kann verwendet werden, um den aktuellen Ankerpunkt des Katzenhakens so zu befestigen, dass unsere Schnecke schwingen kann.  Au√üerdem k√∂nnen wir den Abstand einstellen, mit dem das Seil verl√§ngert und verkleinert werden kann. </li><li>  Untergeordnetes GameObject mit RigidBody2D, das abh√§ngig von der aktuellen Position des Ankerpunkts des Hakens verschoben werden kann.  Im Wesentlichen ist dies der Aufh√§nge- / Ankerpunkt des Seils. </li><li>  Raycast zum Werfen eines Hakens und zum Befestigen an Objekten. </li></ul><br>  W√§hlen Sie das <em>Player-</em> Objekt in der Hierarchie aus und f√ºgen Sie ein neues untergeordnetes <em>GameObject mit dem</em> Namen <em>RopeHingeAnchor hinzu</em> .  Dieses GameObject wird verwendet, um den Aufh√§ngungs- / Ankerpunkt des Katzenhakens zu positionieren. <br><br>  F√ºgen <em>Sie dem</em> <em>RopeHingeAnchor</em> <em>SpriteRenderer-</em> und <em>RigidBody2D-</em> Komponenten <em>hinzu</em> . <br><br>  Legen Sie f√ºr SpriteRenderer die <em>Sprite-</em> Eigenschaft so fest, dass der <em>UISprite-</em> Wert verwendet wird, und √§ndern Sie die <em>Reihenfolge in Layer</em> auf <em>2</em> .  Deaktivieren Sie die Komponente, indem Sie das <em>Kontrollk√§stchen</em> neben ihrem Namen <em>deaktivieren</em> . <br><br>  <em>Setzen Sie</em> f√ºr die <em>RigidBody2D-</em> Komponente die Body Type-Eigenschaft auf <em>Kinematic</em> .  Dieser Punkt wird nicht von der physischen Engine, sondern vom Code verschoben. <br><br>  W√§hlen Sie die <em>Seilebene</em> aus und setzen Sie die X- und Y-Skalierungswerte der Transformationskomponente auf <em>4</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e18/4aa/8e4/e184aa8e457a1e1d3928966b2ae3bca7.png"></div><br>  W√§hlen Sie <em>Player</em> erneut aus und h√§ngen Sie die neue <em>DistanceJoint2D-</em> Komponente an. <br><br>  Ziehen Sie den <em>RopeHingeAnchor</em> aus der Hierarchie auf die Eigenschaft <em>Connected Rigid Body</em> der <em>DistanceJoint2D-</em> Komponente und <em>deaktivieren</em> Sie <em>Auto Configure Distance</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e46/25b/b80/e4625bb804bb2ed2a0c5bee2aed0eade.gif"></div><br>  Erstellen Sie ein neues C # <em>-Skript</em> mit dem Namen <em>RopeSystem</em> im Projektordner " <em>Skripte</em> " und √∂ffnen Sie es im Code-Editor. <br><br>  Entfernen Sie die <code>Update</code> Methode. <br><br>  <code>RopeSystem</code> oben im Skript in der <code>RopeSystem</code> Klassendeklaration neue Variablen, die <code>Awake()</code> -Methode und die neue <code>Update</code> Methode hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 public GameObject ropeHingeAnchor; public DistanceJoint2D ropeJoint; public Transform crosshair; public SpriteRenderer crosshairSprite; public PlayerMovement playerMovement; private bool ropeAttached; private Vector2 playerPosition; private Rigidbody2D ropeHingeAnchorRb; private SpriteRenderer ropeHingeAnchorSprite; void Awake() { // 2 ropeJoint.enabled = false; playerPosition = transform.position; ropeHingeAnchorRb = ropeHingeAnchor.GetComponent&lt;Rigidbody2D&gt;(); ropeHingeAnchorSprite = ropeHingeAnchor.GetComponent&lt;SpriteRenderer&gt;(); } void Update() { // 3 var worldMousePosition = Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, Input.mousePosition.y, 0f)); var facingDirection = worldMousePosition - transform.position; var aimAngle = Mathf.Atan2(facingDirection.y, facingDirection.x); if (aimAngle &lt; 0f) { aimAngle = Mathf.PI * 2 + aimAngle; } // 4 var aimDirection = Quaternion.Euler(0, 0, aimAngle * Mathf.Rad2Deg) * Vector2.right; // 5 playerPosition = transform.position; // 6 if (!ropeAttached) { } else { } }</span></span></code> </pre> <br>  Lassen Sie uns jedes Teil der Reihe nach analysieren: <br><br><ol><li>  Wir verwenden diese Variablen, um die verschiedenen Komponenten zu verfolgen, mit denen das RopeSystem-Skript interagieren wird. </li><li>  Die <code>Awake</code> Methode beginnt zu Beginn des Spiels und deaktiviertopeJoint (die DistanceJoint2D-Komponente).  Au√üerdem wird <code>playerPosition</code> auf die aktuelle Position des Players gesetzt. </li><li>  Dies ist der wichtigste Teil der Hauptschleife von <code>Update()</code> .  Zuerst erhalten wir die Mauszeigerposition in der Welt mithilfe der <code>ScreenToWorldPoint</code> Kameramethode.  Dann berechnen wir die Blickrichtung, indem wir die Position des Spielers von der Position der Maus in der Welt abziehen.  Anschlie√üend erstellen wir damit <code>aimAngle</code> , eine Darstellung des <code>aimAngle</code> des Cursors.  Der Wert speichert einen positiven Wert im if-Konstrukt. </li><li>  <code>aimDirection</code> ist eine Wendung, die sp√§ter n√ºtzlich sein wird.  Der Z-Wert interessiert uns nur, da wir eine 2D-Kamera verwenden und dies das einzige entsprechende Betriebssystem ist.  Wir √ºbergeben <code>aimAngle * Mathf.Rad2Deg</code> , das den Bogenma√üwinkel in einen Winkel in Grad umwandelt. </li><li>  Die Position des Spielers wird mithilfe einer praktischen Variablen √ºberwacht, mit der Sie nicht st√§ndig auf <code>transform.Position</code> verweisen k√∂nnen. </li><li>  Schlie√ülich haben wir das <code>if..else</code> Konstrukt, mit dem wir bald feststellen werden, ob das Seil am Ankerpunkt befestigt ist. </li></ol><br>  Speichern Sie das Skript und kehren Sie zum Editor zur√ºck. <br><br>  <em>H√§ngen Sie</em> die <em>RopeSystem-</em> Komponente an das Player-Objekt an und h√§ngen Sie die verschiedenen Komponenten an die √∂ffentlichen Felder, die wir im <em>RopeSystem-</em> Skript erstellt haben.  Ziehen Sie <em>Player</em> , <em>Crosshair</em> und <em>RopeHingeAnchor</em> in die entsprechenden Felder: <br><br><ul><li>  <em>Seilscharnieranker</em> : RopeHingeAnchor </li><li>  <em>Seilverbindung</em> : Spieler </li><li>  <em>Fadenkreuz</em> : Fadenkreuz </li><li>  <em>Fadenkreuz-Sprite</em> : Fadenkreuz </li><li>  <em>Spielerbewegung</em> : Spieler </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e97/9ca/d2e/e979cad2e2690cc65e9fe237a9f6c47a.gif"></div><br>  Jetzt f√ºhren wir nur all diese komplizierten Berechnungen durch, aber bisher gibt es keine Visualisierung, die sie in Aktion zeigen k√∂nnte.  Aber keine Sorge, wir werden es bald tun. <br><br>  √ñffnen Sie das <em>RopeSystem-</em> Skript und f√ºgen Sie eine neue Methode hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCrosshairPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aimAngle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!crosshairSprite.enabled) { crosshairSprite.enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = transform.position.x + <span class="hljs-number"><span class="hljs-number">1f</span></span> * Mathf.Cos(aimAngle); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = transform.position.y + <span class="hljs-number"><span class="hljs-number">1f</span></span> * Mathf.Sin(aimAngle); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> crossHairPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(x, y, <span class="hljs-number"><span class="hljs-number">0</span></span>); crosshair.transform.position = crossHairPosition; }</code> </pre> <br>  Diese Methode positioniert das Visier basierend auf dem √ºbertragenen <code>aimAngle</code> (dem Float-Wert, den wir in <code>Update()</code> berechnet haben) so, dass es sich mit einem Radius von 1 Einheit um den Spieler dreht.  Wir f√ºgen auch einen Sprite-Bereich hinzu, falls dies noch nicht geschehen ist. <br><p>  In <code>Update()</code> √§ndern wir das Konstrukt <code>!ropeAttached</code> , um <code>!ropeAttached</code> so zu √ºberpr√ºfen, dass es folgenderma√üen aussieht: <br><br></p><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ropeAttached) { SetCrosshairPosition(aimAngle); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { crosshairSprite.enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Speichern Sie das Skript und f√ºhren Sie das Spiel aus.  Jetzt sollte unsere Schnecke in der Lage sein, mit einem Anblick zu zielen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/b1f/8ca/ffeb1f8ca53fbc0463aad677677fb837.gif"></div><br>  Die n√§chste Logik, die implementiert werden muss, ist ein Cat-Hook-Schuss.  Wir haben die Zielrichtung bereits festgelegt, daher ben√∂tigen wir eine Methode, die sie als Parameter erh√§lt. <br><br>  F√ºgen Sie die folgenden Variablen unter den Variablen im <em>RopeSystem-</em> Skript hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LineRenderer ropeRenderer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LayerMask ropeLayerMask; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ropeMaxCastDistance = <span class="hljs-number"><span class="hljs-number">20f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Vector2&gt; ropePositions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Vector2&gt;();</code> </pre> <br>  <em>LineRenderer</em> enth√§lt einen Link zu einem Linienrenderer, der das Seil zeichnet.  <em>Mit LayerMask</em> k√∂nnen Sie die Physik-Layer anpassen, mit denen der Hook interagieren kann.  Der Wert f√ºr <code>ropeMaxCastDistance</code> legt die maximale Entfernung fest, die Raycast "schie√üen" kann. <br><br>  Schlie√ülich wird die Positionsliste von Vector2 verwendet, um die Seilwickelpunkte zu verfolgen, auf die wir sp√§ter noch eingehen werden. <br><br>  F√ºgen Sie die folgenden neuen Methoden hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 private void HandleInput(Vector2 aimDirection) { if (Input.GetMouseButton(0)) { // 2 if (ropeAttached) return; ropeRenderer.enabled = true; var hit = Physics2D.Raycast(playerPosition, aimDirection, ropeMaxCastDistance, ropeLayerMask); // 3 if (hit.collider != null) { ropeAttached = true; if (!ropePositions.Contains(hit.point)) { // 4 //    ,    -  . transform.GetComponent&lt;Rigidbody2D&gt;().AddForce(new Vector2(0f, 2f), ForceMode2D.Impulse); ropePositions.Add(hit.point); ropeJoint.distance = Vector2.Distance(playerPosition, hit.point); ropeJoint.enabled = true; ropeHingeAnchorSprite.enabled = true; } } // 5 else { ropeRenderer.enabled = false; ropeAttached = false; ropeJoint.enabled = false; } } if (Input.GetMouseButton(1)) { ResetRope(); } } // 6 private void ResetRope() { ropeJoint.enabled = false; ropeAttached = false; playerMovement.isSwinging = false; ropeRenderer.positionCount = 2; ropeRenderer.SetPosition(0, transform.position); ropeRenderer.SetPosition(1, transform.position); ropePositions.Clear(); ropeHingeAnchorSprite.enabled = false; }</span></span></code> </pre> <br>  Der obige Code bewirkt Folgendes: <br><br><ol><li>  HandleInput wird von der <code>Update()</code> Schleife aufgerufen und fragt einfach die Eingabe der linken und rechten Maustaste ab. </li><li>  Wenn ein Linksklick registriert wird, wird die Seillinie eingeschaltet und ein 2D-Raycast von der Position des Spielers in Zielrichtung abgefeuert.  Die maximale Entfernung wird so eingestellt, dass die Hakenkatze nicht in unendlicher Entfernung geschossen werden kann, und eine Maske wird angewendet, damit die Schichten der Physik ausgew√§hlt werden k√∂nnen, mit denen Raycast kollidieren kann. </li><li>  Wenn ein Raycast-Treffer erkannt wird, <code>ropeAttached</code> <code>true</code> , und eine Liste der Positionen der Eckpunkte des Seils wird √ºberpr√ºft, um sicherzustellen, dass dort kein Punkt vorhanden ist. </li><li>  Wenn die Pr√ºfung wahr zur√ºckgibt, wird dem Butzen ein kleiner Kraftimpuls hinzugef√ºgt, so dass er √ºber dem Boden abprallt. Das <code>ropeJoint</code> (DistanceJoint2D) wird eingeschaltet, das auf den Abstand eingestellt ist, der dem Abstand zwischen dem Schneckenpunkt und dem Raycast-Trefferpunkt entspricht.  Ein Ankerpunkt-Sprite ist ebenfalls enthalten. </li><li>  Wenn Raycast nichts trifft, sind Line Renderer und RopeJoint deaktiviert und das Flag " <code>ropeAttached</code> ist falsch. </li><li>  Wenn die rechte Maustaste gedr√ºckt wird, wird die <code>ResetRope()</code> -Methode <code>ResetRope()</code> , mit der alle mit dem Seil / Haken verbundenen Parameter deaktiviert und auf die Werte zur√ºckgesetzt werden, die gelten sollten, wenn der Haken nicht verwendet wird. </li></ol><br>  <code>HandleInput()</code> ganz unten in unserer <code>Update</code> Methode einen Aufruf der neuen <code>HandleInput()</code> -Methode hinzu und √ºbergeben Sie den <code>aimDirection</code> Wert an <code>aimDirection</code> : <br><br><pre> <code class="cs hljs">HandleInput(aimDirection);</code> </pre> <br>  Speichern Sie die √Ñnderungen in <em>RopeSystem.cs</em> und kehren Sie zum Editor zur√ºck. <br><br><h2>  Ein Seil hinzuf√ºgen </h2><br>  Unsere Schnecke kann ohne Seil nicht durch die Luft fliegen, daher ist es an der Zeit, ihr etwas zu geben, das eine visuelle Darstellung des Seils darstellt und sich um Ecken "drehen" kann. <br><br>  Der Linienrenderer ist daf√ºr ideal, da er es uns erm√∂glicht, die Anzahl der Punkte und ihre Position im Raum der Welt zu √ºbertragen. <br><br>  Die Idee dabei ist, dass wir immer den ersten Scheitelpunkt des Seils (0) in der Position des Spielers speichern und alle anderen Scheitelpunkte dynamisch positioniert werden, wenn sich das Seil um etwas wickeln soll, einschlie√ülich der aktuellen Position des Scharniers, das der n√§chste Punkt entlang des Seils ist vom Spieler. <br><br>  W√§hlen Sie <em>Player</em> und f√ºgen Sie die <em>LineRenderer-</em> Komponente hinzu.  Stellen Sie die <em>Breite</em> auf <em>0,075 ein</em> .  Erweitern Sie die <em>Materialliste</em> und w√§hlen <em>Sie</em> als <em>Element 0</em> das <em>RopeMaterial-</em> Material aus, das sich im <em>Materialordner</em> des Projekts befindet.  W√§hlen Sie schlie√ülich f√ºr Line Renderer f√ºr <em>Texture Mode</em> die <em>Option Pro Segment verteilen</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c80/6aa/59f/c806aa59f875ac106babef5a8b57a6fc.png"></div><br>  Ziehen Sie die Line Renderer-Komponente in das Feld <em>Rope Renderer</em> der <em>Rope System-</em> Komponente. <br><br>  Klicken Sie auf die Dropdown-Liste der <em>Rope Layer Mask</em> und w√§hlen Sie als Ebenen aus, mit denen Raycast <em>Default, Rope und Pivot</em> interagieren k√∂nnen.  Aus diesem Grund kollidiert ein Raycast beim ‚ÄûAufnehmen‚Äú nur mit diesen Ebenen, nicht jedoch mit anderen Objekten, z. B. einem Player. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9f/eab/2c3/f9feab2c30cc84b83c94d39ce74acdea.gif"></div><br>  Wenn Sie das Spiel jetzt starten, werden Sie ein merkw√ºrdiges Verhalten bemerken.  Wenn wir auf einen Stein √ºber dem Kopf der Schnecke zielen und mit einem Haken schie√üen, bekommen wir einen kleinen Sprung nach oben, wonach sich unser Freund eher zuf√§llig verh√§lt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/815/abd/ae6/815abdae693911ed0ba56f14775e5488.gif"></div><br>  Wir haben den Abstand f√ºr das Distanzgelenk noch nicht festgelegt, au√üerdem sind die Eckpunkte des Linienrenderings nicht konfiguriert.  Daher sehen wir das Seil nicht, und da sich das Distanzgelenk direkt √ºber der Position der Schnecke befindet, dr√ºckt der aktuelle Wert des Distanzgelenkabstands es zu den Steinen darunter. <br><br>  Aber keine Sorge, jetzt werden wir dieses Problem l√∂sen. <br><br>  <em>F√ºgen Sie im</em> Skript <em>RopeSystem.cs</em> am Anfang der Klasse einen neuen Operator hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq;</code> </pre> <br>  Auf diese Weise k√∂nnen wir LINQ-Abfragen verwenden, die es uns in unserem Fall einfach erm√∂glichen, das erste oder letzte Element der Liste der <code>ropePositions</code> bequem zu finden. <br><br><blockquote>  <em>Hinweis</em> : Language Integrated Query (LINQ) ist der Name einer Reihe von Technologien, die auf der Einbettung von Abfragefunktionen direkt in C # basieren.  Hier k√∂nnen Sie mehr dar√ºber lesen. </blockquote><br>  F√ºgen Sie unter den anderen Variablen eine neue private Bool-Variable namens <code>distanceSet</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> distanceSet;</code> </pre> <br>  Wir werden diese Variable als Flag verwenden, damit das Skript erkennen kann, dass der Abstand des Seils (f√ºr den Punkt zwischen dem Spieler und dem aktuellen Referenzpunkt, an dem der Katzenhaken angebracht ist) korrekt eingestellt ist. <br><br>  F√ºgen Sie nun eine neue Methode hinzu, mit der wir die Positionen der Seilscheitelpunkte f√ºr das Rendern der Linie und den Abstand der Distanzverbindung in der gespeicherten Liste der Positionen mit Seil ( <code>ropePositions</code> ) <code>ropePositions</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateRopePositions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if (!ropeAttached) { return; } // 2 ropeRenderer.positionCount = ropePositions.Count + 1; // 3 for (var i = ropeRenderer.positionCount - 1; i &gt;= 0; i--) { if (i != ropeRenderer.positionCount - 1) // if not the Last point of line renderer { ropeRenderer.SetPosition(i, ropePositions[i]); // 4 if (i == ropePositions.Count - 1 || ropePositions.Count == 1) { var ropePosition = ropePositions[ropePositions.Count - 1]; if (ropePositions.Count == 1) { ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } else { ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } } // 5 else if (i - 1 == ropePositions.IndexOf(ropePositions.Last())) { var ropePosition = ropePositions.Last(); ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } } else { // 6 ropeRenderer.SetPosition(i, transform.position); } } }</span></span></code> </pre> <br>  Erl√§utern Sie den oben gezeigten Code: <br><br><ol><li>  Beenden Sie die Methode, wenn das Seil nicht befestigt ist. </li><li>  Wir weisen den Wert der <code>ropePositions</code> der Seillinie der Anzahl der in <code>ropePositions</code> gespeicherten <code>ropePositions</code> , plus 1 weiteren (f√ºr die Position des Spielers). </li><li>  Wir <code>ropePositions</code> Liste der <code>ropePositions</code> und f√ºhren eine <code>ropePositions</code> f√ºr jede Position (mit Ausnahme der letzten) durch. <code>ropePositions</code> die Position des Scheitelpunkts des Linienrenderers dem Wert der Position Vector2 zu, die vom Schleifenindex in der Liste der Seilpositionen gespeichert wird. </li><li>  Weisen Sie dem Ankerpunkt des Seils die zweite von der Endposition des Seils zu, in der sich der aktuelle Scharnier- / Ankerpunkt befinden sollte, oder machen Sie ihn zum Ankerpunkt, wenn wir nur eine Position des Seils haben.  Also setzen wir das DistanzseilJoint gleich dem Abstand zwischen dem Spieler und der aktuellen Position des Seils, die wir in der Schleife <code>ropeJoint</code> . </li><li>  Das if-Konstrukt behandelt den Fall, in dem die aktuelle Position des Seils in der Schleife vom Ende an zweiter Stelle steht.  d.h. der Punkt, an dem das Seil mit dem Objekt verbunden ist, d.h.  aktueller Scharnier- / Ankerpunkt. </li><li>  Dieser <code>else</code> Block behandelt das Zuweisen der Position des letzten Scheitelpunkts des Seils zum Wert der aktuellen Position des Spielers. </li></ol><br>  Denken Sie daran, den <code>UpdateRopePositions()</code> am Ende von <code>Update()</code> <code>UpdateRopePositions()</code> hinzuzuf√ºgen: <br><br><pre> <code class="cs hljs">UpdateRopePositions();</code> </pre> <br>  Speichern Sie die √Ñnderungen am Skript und f√ºhren Sie das Spiel erneut aus.  Machen Sie aus einem ‚Äûkleinen Raum‚Äú einen kleinen Sprung, indem Sie mit einem Haken auf einen Stein √ºber dem Charakter zielen und schie√üen.  Jetzt k√∂nnen Sie die Fr√ºchte Ihrer Arbeit genie√üen - die Schnecke schwankt ruhig √ºber den Steinen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b94/f87/d7c/b94f87d7c533fdae336e3818f7cf3908.gif"></div><br>  Jetzt k√∂nnen Sie zum Szenenfenster gehen, Player ausw√§hlen, das Verschieben-Werkzeug (standardm√§√üig die <em>W-</em> Taste) verwenden, um es zu verschieben, und beobachten, wie die beiden Eckpunkte des Renderings der Seillinie der Position des Hakens und der Position des Players zum Zeichnen des Seils folgen.  Nachdem wir den Player losgelassen haben, berechnet DistanceJoint2D die Entfernung korrekt und der Butzen schwingt weiter am angeschlossenen Scharnier. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/66e/18c/5e166e18ca7ff821025a920b1eaf849a.gif"></div><br><h2>  Umgang mit Wickelpunkten </h2><br>  Das Spielen mit einer schwingenden Schnecke ist bisher nicht n√ºtzlicher als ein wasserabweisendes Handtuch, daher m√ºssen wir es definitiv erg√§nzen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/3bd/43e/6e93bd43eb1ebff2241cb89af3b09f0a.png"></div><br>  Die gute Nachricht ist, dass die neu hinzugef√ºgte Methode zur Verarbeitung von Seilpositionen in Zukunft verwendet werden kann.  Bisher verwenden wir nur zwei Seilpositionen.  Einer ist mit der Position des Spielers verbunden und der zweite mit der aktuellen Position des Ankerpunkts des Hakens, wenn er auf ihn schie√üt. <br><br>  Das einzige Problem ist, dass wir zwar nicht alle m√∂glichen Positionen des Seils verfolgen, dies jedoch ein wenig Arbeit erfordert. <br><br>  Um die Positionen auf den Steinen zu erkennen, um die sich das Seil wickeln soll, und dem Linienrenderer eine neue Scheitelpunktposition hinzuzuf√ºgen, ben√∂tigen wir ein System, das bestimmt, ob der Scheitelpunkt des Kolliders zwischen der geraden Linie zwischen der aktuellen Position der Schnecke und dem aktuellen Scharnier- / Ankerpunkt des Seils liegt. <br><br>  Sieht so aus, als w√§re dies wieder Arbeit f√ºr den guten alten Raycast! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47a/52b/abe/47a52babe8fb16ef57a365b287dceb12.png"></div><br>  Zuerst m√ºssen wir eine Methode erstellen, die den n√§chstgelegenen Punkt im Collider basierend auf dem Trefferpunkt des Raycasts und den Kanten des Colliders findet. <br><br>  F√ºgen <em>Sie dem</em> Skript <em>RopeSystem.cs</em> eine neue Methode <em>hinzu</em> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 private Vector2 GetClosestColliderPointFromRaycastHit(RaycastHit2D hit, PolygonCollider2D polyCollider) { // 2 var distanceDictionary = polyCollider.points.ToDictionary&lt;Vector2, float, Vector2&gt;( position =&gt; Vector2.Distance(hit.point, polyCollider.transform.TransformPoint(position)), position =&gt; polyCollider.transform.TransformPoint(position)); // 3 var orderedDictionary = distanceDictionary.OrderBy(e =&gt; e.Key); return orderedDictionary.Any() ? orderedDictionary.First().Value : Vector2.zero; }</span></span></code> </pre><br>  Wenn Sie mit LINQ-Abfragen nicht vertraut sind, scheint dieser Code eine Art komplizierte C # -Magie zu sein. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e8/0d6/c88/9e80d6c88df7182190a87a8ca54dcb70.png"></div><br>  Wenn ja, dann haben Sie keine Angst.  LINQ leistet viel Arbeit f√ºr uns: <br><br><ol><li>  Diese Methode verwendet zwei Parameter - das <em>RaycastHit2D-</em> Objekt und das <em>PolygonCollider2D-Objekt</em> .  Alle Steine ‚Äã‚Äãauf dem Level haben PolygonCollider2D-Collider. Wenn wir also immer PolygonCollider2D-Formen verwenden, funktioniert dies einwandfrei. </li><li>  Hier beginnt die Magie der LINQ-Abfrage!  Hier transformieren wir die <em>Punktesammlung</em> des polygonalen Colliders in das <em>Vector2-</em> Positionsw√∂rterbuch (der Wert jedes Elements des W√∂rterbuchs ist die Position selbst), und dem Schl√ºssel jedes Elements wird der Abstand von diesem Punkt zum Positionsspieler des Spielers zugewiesen (Gleitkommawert).  Manchmal passiert hier etwas anderes: Die resultierende Position wird in den Weltraum konvertiert (standardm√§√üig werden die Positionen der Kolliderscheitelpunkte im lokalen Raum gespeichert, d. H. Lokal relativ zu dem Objekt, zu dem der Kollider geh√∂rt, und wir ben√∂tigen Positionen im Weltraum). </li><li>  Das W√∂rterbuch ist nach Schl√ºsseln sortiert.  Mit anderen Worten, um die Entfernung, die der aktuellen Position des Spielers am n√§chsten liegt.  Die n√§chstgelegene Entfernung wird zur√ºckgegeben, dh jeder Punkt, der mit dieser Methode zur√ºckgegeben wird, ist der Kolliderpunkt zwischen dem Spieler und dem aktuellen Punkt des Seilscharniers! </li></ol><br>  <em>Kehren wir zum</em> Skript <em>RopeSystem.cs zur√ºck</em> und f√ºgen oben eine neue private <em>Feldvariable</em> hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;Vector2, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; wrapPointsLookup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Vector2, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;();</code> </pre> <br>  Wir werden es verwenden, um die Positionen zu verfolgen, um die sich das Seil wickeln kann. <br><br>  Suchen Sie am Ende der <code>Update()</code> -Methode das <code>else</code> Konstrukt, das <code>crosshairSprite.enabled = false;</code> enth√§lt <code>crosshairSprite.enabled = false;</code>  und f√ºgen Sie Folgendes hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 if (ropePositions.Count &gt; 0) { // 2 var lastRopePoint = ropePositions.Last(); var playerToCurrentNextHit = Physics2D.Raycast(playerPosition, (lastRopePoint - playerPosition).normalized, Vector2.Distance(playerPosition, lastRopePoint) - 0.1f, ropeLayerMask); // 3 if (playerToCurrentNextHit) { var colliderWithVertices = playerToCurrentNextHit.collider as PolygonCollider2D; if (colliderWithVertices != null) { var closestPointToHit = GetClosestColliderPointFromRaycastHit(playerToCurrentNextHit, colliderWithVertices); // 4 if (wrapPointsLookup.ContainsKey(closestPointToHit)) { ResetRope(); return; } // 5 ropePositions.Add(closestPointToHit); wrapPointsLookup.Add(closestPointToHit, 0); distanceSet = false; } } }</span></span></code> </pre> <br>  Erkl√§ren Sie diesen Code: <br><br><ol><li>  Wenn einige Positionen in der <code>ropePositions</code> gespeichert sind, dann ... </li><li>  Wir schie√üen von der Position des Spielers in Richtung des Spielers, der die letzte Position des Seils aus der Liste betrachtet - den Ankerpunkt, an dem der Katzenhaken am Stein befestigt ist - mit einem Raycast-Abstand, der dem Abstand zwischen dem Spieler und der Position des Ankerpunkts des Seils entspricht. </li><li>  Wenn Raycast mit etwas kollidiert, wird der Collider dieses Objekts sicher in den Typ <em>PolygonCollider2D umgewandelt</em> .  W√§hrend es sich um einen echten PolygonCollider2D handelt, wird die n√§chstgelegene Scheitelpunktposition dieses Colliders mit der Methode zur√ºckgegeben, die wir zuvor als <em>Vector2 geschrieben haben</em> . </li><li>  Es wird von <code>wrapPointsLookup</code> √ºberpr√ºft, um sicherzustellen, dass dieselbe Position nicht erneut √ºberpr√ºft wird.  Wenn es aktiviert ist, werfen wir das Seil weg, schneiden es ab und lassen den Spieler fallen. </li><li>  Dann wird die Liste der <code>ropePositions</code> : Die Position wird hinzugef√ºgt, um die sich das Seil wickeln soll.  Das <code>wrapPointsLookup</code> W√∂rterbuch wird ebenfalls aktualisiert.  Schlie√ülich wird das Flag <code>distanceSet</code> zur√ºckgesetzt, damit die <code>UpdateRopePositions()</code> -Methode den Abstand des Seils mit der neuen L√§nge des Seils und der Segmente neu definieren kann. </li></ol><br>  <code>ResetRope()</code> in <code>ResetRope()</code> die folgende Zeile hinzu, damit das <code>wrapPointsLookup</code> W√∂rterbuch jedes Mal gel√∂scht wird, wenn ein Spieler ein Seil <code>wrapPointsLookup</code> : <br><br><pre> <code class="cs hljs">wrapPointsLookup.Clear();</code> </pre> <br>  Speichern und starten Sie das Spiel.  Schie√üen Sie den Katzenhaken in den Stein √ºber der Schnecke und bewegen Sie die Schnecke mit dem Verschieben-Werkzeug im Szenenfenster √ºber mehrere Steinleisten. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c62/999/f50/c62999f50094252b3850b8b4c54e2cdc.gif"></div><br>  So haben wir Seil gelehrt, um Gegenst√§nde zu wickeln! <br><br><h2>  Schaukelf√§higkeit hinzuf√ºgen </h2><br>  Die am Seil h√§ngende Schnecke ist ziemlich statisch.  Um dies zu beheben, k√∂nnen wir die Schwingf√§higkeit hinzuf√ºgen. <br><br>  Dazu m√ºssen wir eine Position senkrecht zur Position des Vorw√§rtsschwingens (seitw√§rts) erhalten, unabh√§ngig von dem Winkel, in den er schaut. <br><br>  √ñffnen Sie <em>PlayerMovement.cs</em> und f√ºgen Sie die folgenden zwei √∂ffentlichen Variablen oben im Skript hinzu: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 ropeHook; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> swingForce = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br>  Der <code>ropeHook</code> Variablen wird jede Position zugewiesen, an der sich der <code>swingForce</code> gerade befindet, und <code>swingForce</code> ist der Wert, den wir zum Hinzuf√ºgen der Swing-Bewegung verwenden. <br><br>  Ersetzen Sie die <code>FixedUpdate()</code> -Methode <code>FixedUpdate()</code> neue: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (horizontalInput &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span> || horizontalInput &gt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) { animator.SetFloat(<span class="hljs-string"><span class="hljs-string">"Speed"</span></span>, Mathf.Abs(horizontalInput)); playerSprite.flipX = horizontalInput &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isSwinging) { animator.SetBool(<span class="hljs-string"><span class="hljs-string">"IsSwinging"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1 -          var playerToHookDirection = (ropeHook - (Vector2)transform.position).normalized; // 2 -  ,     Vector2 perpendicularDirection; if (horizontalInput &lt; 0) { perpendicularDirection = new Vector2(-playerToHookDirection.y, playerToHookDirection.x); var leftPerpPos = (Vector2)transform.position - perpendicularDirection * -2f; Debug.DrawLine(transform.position, leftPerpPos, Color.green, 0f); } else { perpendicularDirection = new Vector2(playerToHookDirection.y, -playerToHookDirection.x); var rightPerpPos = (Vector2)transform.position + perpendicularDirection * 2f; Debug.DrawLine(transform.position, rightPerpPos, Color.green, 0f); } var force = perpendicularDirection * swingForce; rBody.AddForce(force, ForceMode2D.Force); } else { animator.SetBool("IsSwinging", false); if (groundCheck) { var groundForce = speed * 2f; rBody.AddForce(new Vector2((horizontalInput * groundForce - rBody.velocity.x) * groundForce, 0)); rBody.velocity = new Vector2(rBody.velocity.x, rBody.velocity.y); } } } else { animator.SetBool("IsSwinging", false); animator.SetFloat("Speed", 0f); } if (!isSwinging) { if (!groundCheck) return; isJumping = jumpInput &gt; 0f; if (isJumping) { rBody.velocity = new Vector2(rBody.velocity.x, jumpSpeed); } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die wichtigsten √Ñnderungen hierbei sind, dass die Flagge zuerst √ºberpr√ºft wird, </font></font><code>isSwinging</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sodass Aktionen nur ausgef√ºhrt werden, wenn die Schnecke am Seil h√§ngt. Au√üerdem f√ºgen wir eine Senkrechte zur Ecke der Schnecke hinzu, die ihren aktuellen Ankerpunkt oben am Seil anzeigt, jedoch senkrecht zur Richtung ihres Schwingens.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir erhalten den normalisierten Richtungsvektor vom Spieler zum Hakenbefestigungspunkt. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abh√§ngig davon, ob die Schnecke nach links oder rechts schwankt, wird die senkrechte Richtung mit berechnet </font></font><code>playerToHookDirection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Ein Debug-Draw-Aufruf wurde ebenfalls hinzugef√ºgt, damit Sie ihn auf Wunsch im Editor anzeigen k√∂nnen.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ñffnen Sie </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RopeSystem.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und </font><font style="vertical-align: inherit;">f√ºgen Sie </font><font style="vertical-align: inherit;">oben </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im else-Block</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> der </font></font><code>if(!ropeAttached)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Methode </font></font><code>Update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folgendes hinzu:</font></font><br><br><pre> <code class="cs hljs">playerMovement.isSwinging = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; playerMovement.ropeHook = ropePositions.Last();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">im if-Block</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desselben Designs </font></font><code>if(!ropeAttached)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folgendes hinzu:</font></font><br><br><pre> <code class="cs hljs">playerMovement.isSwinging = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Daher informieren wir das PlayerMovement-Skript, dass der Spieler schwingt, und bestimmen auch die letzte Position (mit Ausnahme der Position des Spielers) des Seils - mit anderen Worten den Ankerpunkt des Seils. </font><font style="vertical-align: inherit;">Dies ist erforderlich, um den senkrechten Winkel zu berechnen, den wir gerade zum PlayerMovement-Skript hinzugef√ºgt haben. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So sieht es aus, wenn Sie in einem laufenden Spiel Gizmos einschalten und A oder D dr√ºcken, um nach links / rechts zu schwingen:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5bd/6a5/4ed/5bd6a54ed3c8661e61b3bf765e50acfb.png"></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Seilabstieg hinzuf√ºgen </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben zwar nicht die F√§higkeit, das Seil auf und ab zu bewegen. </font><font style="vertical-align: inherit;">Obwohl die Schnecke im wirklichen Leben nicht leicht am Seil entlang steigen und fallen konnte, ist dies ein Spiel, in dem alles passieren kann, oder? </font><em><font style="vertical-align: inherit;">F√ºgen Sie</font></em></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oben im </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RopeSystem-</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Skript </font><font style="vertical-align: inherit;">zwei neue </font><em><font style="vertical-align: inherit;">Feldvariablen</font></em><font style="vertical-align: inherit;"> hinzu:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> climbSpeed = <span class="hljs-number"><span class="hljs-number">3f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isColliding;</code> </pre> <br> <code>climbSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Legt die Geschwindigkeit fest, mit der sich der Butzen auf dem Seil auf und ab bewegen kann, und </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wird als Flagge verwendet, um zu bestimmen, ob die Distanzverbindungseigenschaft des Distanzgelenkseils erh√∂ht oder verringert werden kann. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie diese neue Methode hinzu:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleRopeLength</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if (Input.GetAxis("Vertical") &gt;= 1f &amp;&amp; ropeAttached &amp;&amp; !isColliding) { ropeJoint.distance -= Time.deltaTime * climbSpeed; } else if (Input.GetAxis("Vertical") &lt; 0f &amp;&amp; ropeAttached) { ropeJoint.distance += Time.deltaTime * climbSpeed; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dieser Block </font></font><code>if..elseif</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">liest die Eingabe entlang der vertikalen Achse (auf / ab oder W / S auf der Tastatur) und </font></font><code>ropeAttached iscColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vergr√∂√üert oder verkleinert </font><font style="vertical-align: inherit;">unter Ber√ºcksichtigung der Flaggen </font><font style="vertical-align: inherit;">den Abstand </font></font><code>ropeJoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, wodurch der Effekt einer Verl√§ngerung oder Verk√ºrzung des Seils entsteht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir verkn√ºpfen diese Methode und f√ºgen ihren Aufruf am Ende hinzu </font></font><code>Update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cs hljs">HandleRopeLength();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir brauchen auch eine M√∂glichkeit, die Flagge zu setzen </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie am Ende des Skripts die folgenden zwei Methoden hinzu:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerStay2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider2D colliderStay</span></span></span><span class="hljs-function">)</span></span> { isColliding = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerExit2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider2D colliderOnExit</span></span></span><span class="hljs-function">)</span></span> { isColliding = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese beiden Methoden sind native Methoden der Basisklasse von MonoBehaviour-Skripten. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn Collider derzeit ein anderes physisches Objekt im Spiel ber√ºhrt, wird die Methode st√§ndig </font></font><code>OnTriggerStay2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgel√∂st und der Flagge einen </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wert </font><font style="vertical-align: inherit;">zugewiesen </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Dies bedeutet, dass dem isColliding-Flag ein Wert zugewiesen wird, wenn die Schnecke den Stein ber√ºhrt </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Methode wird </font></font><code>OnTriggerExit2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ausgel√∂st, wenn ein Collider den Bereich eines anderen Colliders verl√§sst und das Flag auf false setzt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beachten Sie: Die Methode </font></font><code>OnTriggerStay2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kann sehr rechenintensiv sein. Gehen Sie daher vorsichtig vor.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wohin als n√§chstes? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Starten Sie das Spiel erneut und dr√ºcken Sie diesmal die Pfeiltasten oder W / S, um das Seil auf und ab zu bewegen. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/a3e/e5d/348a3ee5d95a10273c8bc644e3dbc7d9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das fertige Projekt dieses Teils des Tutorials kann hier heruntergeladen </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">werden</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben einen langen Weg zur√ºckgelegt - von der nicht schwingenden Schnecke bis zur akrobatischen muschelfreien Gastropodenmolluske! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sie haben gelernt, wie Sie ein Zielsystem erstellen, das einen Katzenhaken auf jedes Objekt mit einem Kollider schie√üt, sich daran festh√§lt und gleichzeitig darauf schwingt und sich an einem dynamischen Seil um die Kanten von Objekten dreht! </font><font style="vertical-align: inherit;">Ausgezeichnete Arbeit.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dd/bb5/29d/4ddbb529d88b62441d7b2d91424bf906.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier fehlt jedoch eine wichtige Funktion - das Seil kann sich bei Bedarf nicht ‚Äûabwickeln‚Äú. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zweiten Teil des</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tutorials werden wir dieses Problem l√∂sen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber wenn Sie bereit sind, ein Risiko einzugehen, warum versuchen Sie es dann nicht selbst? </font><font style="vertical-align: inherit;">Sie k√∂nnen hierf√ºr ein W√∂rterbuch verwenden </font></font><code>wrapPointsLookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de414887/">https://habr.com/ru/post/de414887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de414877/index.html">Ein ungew√∂hnliches Objektiv f√ºr eine normale Kamera oder wie man aufh√∂rt, √ºber den Fokus nachzudenken</a></li>
<li><a href="../de414879/index.html">Warum 2 Extruder in einem 3D-Drucker?</a></li>
<li><a href="../de414881/index.html">Ein bisschen Backstage VK</a></li>
<li><a href="../de414883/index.html">Erinnerungen klangen neu: BBC hat das Soundarchiv des RemArc-Projekts aktualisiert</a></li>
<li><a href="../de414885/index.html">Wir besch√§ftigen uns mit Fehlern und ‚ÄûKr√ºcken‚Äú im einheitlichen staatlichen Register der juristischen Personen - dem staatlichen Register der juristischen Personen</a></li>
<li><a href="../de414889/index.html">Wenn digitale Agenturen IaaS ben√∂tigen</a></li>
<li><a href="../de414891/index.html">Entwicklergewohnheiten</a></li>
<li><a href="../de414893/index.html">Viber, WhatsApp, Telegramm - was ist besser?</a></li>
<li><a href="../de414895/index.html">Und f√ºr uns ist alles ‚Äûaufrecht‚Äú - DBMS Vertica</a></li>
<li><a href="../de414897/index.html">Datenzugriff in Mehrbenutzeranwendungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>