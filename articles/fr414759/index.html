<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😧 😼 🐣 Concours Servlet 👩‍⚕️ 🍒 👠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour à tous! 

 Nous lançons le septième volet du cours Java Developer . En plus d'un an d'existence de ce cours, il a été affiné, affiné, un nouve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Concours Servlet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/414759/">  Bonjour à tous! <br><br>  Nous lançons le septième volet du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cours Java Developer</a> .  En plus d'un an d'existence de ce cours, il a été affiné, affiné, un nouveau a été ajouté qui dépassait ce temps.  Le même flux diffère du reste en ce que nous avons introduit un nouveau système d'étapes, divisant le cours en trois parties et augmentant légèrement sa durée totale.  Alors maintenant, il ne sera pas nécessaire d'être épuisé pendant cinq mois consécutifs pour obtenir un certificat, mais de choisir calmement des périodes de deux mois et de suivre une formation.  Mais ce sont les paroles, revenons à notre tradition concernant les différents utilitaires précédant le lancement du cours. <br><br>  Allons-y. <br><br><h3>  1. Présentation </h3><br>  Le conteneur de servlet Java (ou serveur Web) est multithread: plusieurs requêtes vers le même servlet peuvent être exécutées simultanément.  Par conséquent, lors de l'écriture d'un servlet, vous devez tenir compte de la concurrence. <br><br>  Comme nous l'avons dit précédemment, une et une seule instance de servlet est créée et pour chaque nouvelle demande, le conteneur de servlet crée un nouveau thread pour exécuter les méthodes doGet () ou doPost () de la servlet. <br><br>  Par défaut, les servlets ne sont pas thread-safe, le programmeur doit s'en occuper lui-même.  Dans ce chapitre, nous discuterons de la compétition des servlets.  Il s'agit d'un concept très important, alors concentrez-vous. <br><br><h3>  2. Aperçu des discussions </h3><br><img src="https://habrastorage.org/webt/pd/ny/_n/pdny_ncj8kfu4odnv_15o_p6-ua.png"><a name="habracut"></a><br><br>  Un thread est un processus léger qui possède sa propre pile d'appels et accède aux données ouvertes d'autres threads du même processus (segment partagé).  Chaque thread a son propre cache. <br><br>  Lorsque nous disons qu'un programme est multithread, nous voulons dire que la même instance d'un objet génère plusieurs threads et traite un seul élément de code.  Cela signifie que plusieurs flux de contrôle consécutifs passent par le même bloc de mémoire.  Ainsi, plusieurs threads exécutent une instance d'un programme et, par conséquent, partagent des variables d'instance et peuvent essayer de lire et d'écrire ces variables partagées. <br><br>  Regardons un exemple Java simple. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Counter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter=<span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(“Inital Counter = ” + counter); counter ++; System.out.println(“Post Increment Counter = ” + counter); } }</code> </pre> <br>  Maintenant, nous créons deux threads Thread1 et Thread2 pour faire <code>doSomething()</code> .  En conséquence, il est possible que: <br><br><ol><li>  Thread1 lit une valeur de compteur de 10 </li><li>  Affiche le compteur initial = 10 et va augmenter </li><li>  Avant Thread1 incrémente le compteur, Thread2 incrémente également le compteur, en changeant le compteur à 11 </li><li>  Par conséquent, Thread1 a une valeur de compteur de 10, qui est déjà obsolète </li></ol><br>  Ce scénario est possible dans un environnement multithread, tel que les servlets, car les variables d'instance sont partagées par tous les threads s'exécutant dans la même instance. <br><br><h3>  3. Écriture de servlets thread-safe </h3><br>  J'espère que dans cette section, vous comprendrez les problèmes que j'essaie de souligner.  En cas de doute, relisez le point 2. <br><br>  Il y a certains points que nous devons considérer lors de l'écriture des servlets. <br><br><ol><li>  <code>Service()</code> , <code>doGet()</code> , <code>doPost()</code> ou, plus généralement, les méthodes <code>doXXX()</code> ne doivent pas mettre à jour ou modifier les variables d'instance, car les variables d'instance sont partagées par tous les threads de la même instance. </li><li>  S'il est nécessaire de modifier la variable d'instance, faites-le dans un bloc synchronisé. </li><li>  Les deux règles ci-dessus s'appliquent également aux variables statiques car elles sont également courantes. </li><li>  Les variables locales sont toujours thread-safe. </li><li>  Les objets de demande et de réponse sont sûrs pour l'utilisation car une nouvelle instance est créée pour chaque demande dans votre servlet et, par conséquent, pour chaque thread s'exécutant dans votre servlet. </li></ol><br>  Voici deux approches pour garantir la sécurité des threads: <br><br>  a) Synchronisez le bloc dans lequel vous modifiez l'instance ou les variables statiques (voir l'extrait de code ci-dessous). <br><br>  Nous vous recommandons de synchroniser le bloc dans lequel votre code modifie les variables d'instance au lieu de synchroniser la méthode complète afin d'améliorer les performances. <br><br>  Notez que nous devons verrouiller l'instance de servlet car nous devons sécuriser le thread d'instance de servlet spécifique. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThreadSafeServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpServlet</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doGet</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ServletException, IOException </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> counter</span></span>; { <span class="hljs-keyword"><span class="hljs-keyword">synchronized</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//code in this block is thread-safe so update the instance variable } //other processing; }</span></span></code> </pre> <br>  b) Modèle à un seul thread - implémentez l'interface SingleThreadModel pour rendre le thread simple, ce qui signifie qu'un seul thread exécutera la méthode service () ou doXXX () à la fois.  Un servlet à thread unique est plus lent sous charge car les nouvelles requêtes doivent attendre qu'une instance gratuite soit traitée <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.*; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThreadSafeServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleThreadModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter; <span class="hljs-comment"><span class="hljs-comment">// no need to synchronize as implemented SingleThreadModel @override public void doGet (HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException { }</span></span></code> </pre> <br>  L'utilisation de SingleThreadModel est obsolète car il est recommandé d'utiliser des blocs synchronisés. <br><br><h3>  4. Conclusion </h3><br>  Nous devons être très prudents lors de l'écriture des servlets, car "par défaut, les servlets ne sont pas thread-safe" <br><br><ol><li>  Si votre servlet n'a pas de variable statique ou de membre, ne vous inquiétez pas et votre servlet est thread-safe </li><li>  Si votre servlet lit simplement la variable d'instance, votre servlet est thread-safe. </li><li>  Si vous devez modifier une instance ou des variables statiques, mettez-les à jour dans un bloc synchronisé, en gardant l'instance verrouillée </li></ol><br>  Si vous suivez les règles ci-dessus et la prochaine fois que quelqu'un vous demandera: "Le thread de servlet est-il sûr?"  - Répondez en toute confiance: "Par défaut, ils ne le sont pas, mais" Mes servlets "sont thread-safe." <br><br>  LA FIN <br><br>  Comme toujours, nous attendons vos questions, suggestions, etc. ici ou vous pouvez demander à Sergey Petrelevich lors de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">leçon ouverte</a> sur le multithreading. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414759/">https://habr.com/ru/post/fr414759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414749/index.html">Gentleman sysadmin set</a></li>
<li><a href="../fr414751/index.html">Apprivoiser WSUS avec Ansible et plus</a></li>
<li><a href="../fr414753/index.html">Bus PCIe: les limitations physiques affectent-elles le taux de transfert?</a></li>
<li><a href="../fr414755/index.html">Hackathon est la solution au problème</a></li>
<li><a href="../fr414757/index.html">Format de présentation moderne</a></li>
<li><a href="../fr414761/index.html">5 sites d'actualités créatives en anglais</a></li>
<li><a href="../fr414763/index.html">Quatre types d'erreurs de chef de produit qui peuvent (et devraient) être évitées</a></li>
<li><a href="../fr414767/index.html">Implémentez IdM. À qui dois-je m'adresser pour résoudre les problèmes?</a></li>
<li><a href="../fr414769/index.html">Lancez le reciblage mobile avec Appsflyer: paramètres, rapports et liens</a></li>
<li><a href="../fr414771/index.html">DevOps sur HightLoad ++ Sibérie: démystifier les mythes et discuter des outils</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>