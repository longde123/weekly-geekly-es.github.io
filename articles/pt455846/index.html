<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî• üöÜ ü§∂üèæ Computa√ß√£o Distribu√≠da em Julia üö™ ü§¢ üò≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se o artigo anterior teve maior probabilidade de ser propagado, agora √© hora de testar os recursos de paraleliza√ß√£o de Julia em sua m√°quina. 
 Process...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Computa√ß√£o Distribu√≠da em Julia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455846/"><p><img src="https://habrastorage.org/webt/ud/o6/5u/udo65u8kthnpek7hzrcedxgzwtk.jpeg"></p><br><p>  Se o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior</a> teve maior probabilidade de ser propagado, agora √© hora de testar os recursos de paraleliza√ß√£o de Julia em sua m√°quina. </p><a name="habracut"></a><br><h2 id="mnogoyadernaya-ili-raspredelennaya-obrabotka">  Processamento multin√∫cleo ou distribu√≠do </h2><br><p> A implementa√ß√£o da computa√ß√£o paralela com mem√≥ria distribu√≠da √© fornecida pelo m√≥dulo <code>Distributed</code> como parte da biblioteca padr√£o fornecida com a Julia.  A maioria dos computadores modernos possui mais de um processador e v√°rios computadores podem ser agrupados em cluster.  Usar o poder desses m√∫ltiplos processadores permite realizar muitos c√°lculos mais rapidamente.  O desempenho √© afetado por dois fatores principais: a velocidade dos pr√≥prios processadores e a velocidade do acesso √† mem√≥ria.  No cluster, √© √≥bvio que esta CPU ter√° o acesso mais r√°pido √† RAM no mesmo computador (n√≥).  Talvez ainda mais surpreendente, esses problemas sejam relevantes em um laptop t√≠pico com v√°rios n√∫cleos devido a diferen√ßas na velocidade da mem√≥ria principal e do cache.  Portanto, um bom ambiente multiprocessador deve permitir que voc√™ controle a "propriedade" de uma parte da mem√≥ria por um processador espec√≠fico.  Julia fornece um ambiente multiprocessador baseado em mensagens que permite que os programas sejam executados simultaneamente em v√°rios processos em diferentes dom√≠nios de mem√≥ria. </p><br><p>  A implementa√ß√£o de mensagens de Julia √© diferente de outros ambientes, como o <abbr title="Nesse contexto, MPI refere-se ao padr√£o MPI-1. Come√ßando com o MPI-2, o comit√™ de padr√µes do MPI introduziu um novo conjunto de mecanismos de comunica√ß√£o, chamados coletivamente RMA (Remote Memory Access).">MPI</abbr> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">[1]</a> .  A comunica√ß√£o em Julia √© geralmente "unidirecional", o que significa que o programador precisa controlar explicitamente apenas um processo em uma opera√ß√£o de dois processos.  Al√©m disso, essas opera√ß√µes geralmente n√£o se parecem com "enviar uma mensagem" e "receber uma mensagem", mas sim com opera√ß√µes de n√≠vel superior, como chamadas para fun√ß√µes definidas pelo usu√°rio. </p><br><p>  A programa√ß√£o distribu√≠da em Julia se baseia em duas primitivas: <em>links</em> <em>remotos</em> e <em>chamadas remotas</em> .  Um link remoto √© um objeto que pode ser usado em qualquer processo para se referir a um objeto armazenado em um processo espec√≠fico.  Uma chamada remota √© uma solicita√ß√£o de um processo para chamar uma determinada fun√ß√£o de acordo com certos argumentos de outro processo (possivelmente o mesmo). </p><br><p>  Os links remotos t√™m duas formas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Future</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RemoteChannel</a> . </p><br><p>  Uma chamada remota retorna <code>Future</code> e faz isso imediatamente;  o processo que fez a chamada prossegue para a pr√≥xima opera√ß√£o, enquanto a chamada remota ocorre em outro lugar.  Voc√™ pode aguardar a conclus√£o da chamada remota com o comando de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">espera</a> para o <code>Future</code> retornado e tamb√©m pode obter o valor total do resultado usando a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">busca</a> . </p><br><p>  Por outro lado, temos RemoteChannels que s√£o reescritos.  Por exemplo, v√°rios processos podem coordenar seu processamento, referindo-se ao mesmo canal remoto.  Cada processo tem um identificador associado.  O processo que fornece o prompt interativo Julia sempre tem um identificador de 1. Os processos usados ‚Äã‚Äãpor padr√£o para opera√ß√µes simult√¢neas s√£o chamados de "trabalhadores".  Quando h√° apenas um processo, o processo 1 √© considerado funcionando.  Caso contr√°rio, todos os processos que n√£o sejam o processo 1 s√£o considerados trabalhadores. </p><br><p><img src="https://habrastorage.org/webt/vy/ts/gd/vytsgdo3oi1x52r901ibv8s4z1a.jpeg"></p><br><p>  Vamos ao que interessa.  <code>julia -pn</code> com <code>julia -pn</code> postscript fornece n fluxos de trabalho no computador local.  Geralmente, faz sentido que n seja igual ao n√∫mero de threads da CPU (n√∫cleos l√≥gicos) na m√°quina.  Observe que o argumento -p carrega implicitamente o m√≥dulo Distributed. </p><br><div class="spoiler">  <b class="spoiler_title">Como iniciar um postscript?</b> <div class="spoiler_text"><p>  As opera√ß√µes do console devem ser diretas para usu√°rios do Linux, incl.  Este programa educacional √© destinado a usu√°rios inexperientes do Windows. <br>  O Terminal Julia (REPL) fornece a capacidade de usar comandos do sistema: </p><br><pre> <code class="plaintext hljs">julia&gt; pwd() #     "C:\\Users\\User\\AppData\\Local\\Julia-1.1.0" julia&gt; cd("C:/Users/User/Desktop") #   julia&gt; run(`calc`) #     #     Windows. #      Process(`calc`, ProcessExited(0))</code> </pre> <br><p>  usando esses comandos, voc√™ pode iniciar Julia a partir de Julia, mas √© melhor n√£o se deixar levar </p><br><p><img src="https://habrastorage.org/webt/tb/yv/4m/tbyv4me6o0jhsk-5ap3xgdqivsq.png"></p><br><p>  Seria mais correto executar o <strong>cmd a</strong> partir de <em>julia / bin /</em> e executar o comando <code>julia -p 2</code> l√° ou uma op√ß√£o para os amantes de iniciar a partir de um atalho: na √°rea de trabalho, crie um documento no bloco de notas com o seguinte conte√∫do <code>C:\Users\User\AppData\Local\Julia-1.1.0\bin\julia -p 4</code> ( <em>especifique o endere√ßo e o n√∫mero de processos</em> ) e salve-o como um documento de texto com o nome <em>run.bat</em> .  Aqui, agora na √°rea de trabalho, h√° um arquivo de sistema de inicializa√ß√£o Julia para 4 n√∫cleos. </p><br><p>  Voc√™ pode usar outro m√©todo (especialmente relevante para o <em>Jupyter</em> ): </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed addprocs(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> </div></div><br><pre> <code class="julia hljs">$ ./julia -p <span class="hljs-number"><span class="hljs-number">2</span></span> julia&gt; r = remotecall(rand, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; s = <span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> .+ fetch(r) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(s) <span class="hljs-number"><span class="hljs-number">2</span></span>√ó<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">1.18526</span></span> <span class="hljs-number"><span class="hljs-number">1.50912</span></span> <span class="hljs-number"><span class="hljs-number">1.16296</span></span> <span class="hljs-number"><span class="hljs-number">1.60607</span></span></code> </pre><br><p>  O primeiro argumento a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chamar novamente</a> √© a fun√ß√£o chamada. <br>  A maioria dos programas concorrentes em Julia n√£o se refere a processos espec√≠ficos ou ao n√∫mero de processos dispon√≠veis, mas uma chamada remota √© considerada uma interface de baixo n√≠vel que fornece controle mais preciso. </p><br><p>  O segundo argumento para <code>remotecall</code> √© o identificador do processo que far√° o trabalho, e os argumentos restantes ser√£o passados ‚Äã‚Äãpara a fun√ß√£o chamada.  Como voc√™ pode ver, na primeira linha, pedimos ao processo 2 para criar uma matriz aleat√≥ria 2 por 2, e na segunda linha, pedimos para adicionar 1 a ela.  O resultado de ambos os c√°lculos est√° dispon√≠vel em dois futuros, re s.  A macro spawnat avalia a express√£o no segundo argumento para o processo especificado no primeiro argumento.  √Äs vezes, voc√™ pode precisar de um valor calculado remotamente.  Isso geralmente acontece quando voc√™ l√™ de um objeto remoto para obter os dados necess√°rios para a pr√≥xima opera√ß√£o local.  Existe uma fun√ß√£o <code>remotecall_fetch</code> para <code>remotecall_fetch</code> .  Isso √© equivalente a <code>fetch (remotecall (...))</code> , mas √© mais eficiente. </p><br><p>  Lembre-se de que <code>getindex(r, 1,1)</code> equivalente a <code>r[1,1]</code> , portanto, essa chamada recupera o primeiro elemento do futuro <code>r</code> . </p><br><p>  A <code>remotecall</code> chamada remota de chamada remota n√£o <code>remotecall</code> particularmente conveniente.  A macro <code>@spawn</code> facilita as <code>@spawn</code> .  Ele funciona com uma express√£o, n√£o uma fun√ß√£o e escolhe onde executar a opera√ß√£o para voc√™: </p><br><pre> <code class="julia hljs">julia&gt; r = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; s = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> .+ fetch(r) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(s) <span class="hljs-number"><span class="hljs-number">2</span></span>√ó<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">1.38854</span></span> <span class="hljs-number"><span class="hljs-number">1.9098</span></span> <span class="hljs-number"><span class="hljs-number">1.20939</span></span> <span class="hljs-number"><span class="hljs-number">1.57158</span></span></code> </pre> <br><p>  Observe que usamos <code>1 .+ Fetch(r)</code> vez de <code>1 .+ r</code>  Isso ocorre porque n√£o sabemos onde o c√≥digo ser√° executado; portanto, no caso geral, pode ser necess√°rio buscar para mover <code>r</code> para o processo de adi√ß√£o.  Nesse caso, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@spawn</a> √© inteligente o suficiente para executar c√°lculos para o processo que possui <code>r</code> , portanto, a busca n√£o ser√° operacional (nenhum trabalho √© feito).  (Vale a pena notar que a desova n√£o √© incorporada, mas definida em Julia como uma macro. Voc√™ pode definir suas pr√≥prias constru√ß√µes.) </p><br><p>  √â importante lembrar que, ap√≥s a extra√ß√£o, o <code>Future</code> armazenar√° seu valor em cache localmente.  Chamadas adicionais para buscar n√£o implicam um salto na rede.  Ap√≥s a sele√ß√£o de todos os futuros referentes, o valor armazenado exclu√≠do √© exclu√≠do. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O @async</a> √© semelhante ao <code>@spawn</code> , mas executa tarefas apenas no processo local.  N√≥s o usamos para criar uma tarefa de "feed" para cada processo.  Cada tarefa seleciona o pr√≥ximo √≠ndice, que deve ser calculado, aguarda a conclus√£o do processo e se repete at√© ficar sem √≠ndices. </p><br><p>  Observe que as tarefas do alimentador n√£o come√ßam a ser executadas at√© que a tarefa principal chegue ao final do bloco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@sync</a> , ap√≥s o que passa o controle e aguarda a conclus√£o de todas as tarefas locais antes de retornar da fun√ß√£o. </p><br><p>  Quanto √† v0.7 e superior, as tarefas do alimentador podem compartilhar o estado atrav√©s do nextidx, porque todas s√£o executadas no mesmo processo.  Mesmo que as tarefas sejam planejadas juntas, o bloqueio pode ser necess√°rio em alguns contextos, como na E / S ass√≠ncrona.  Isso significa que a altern√¢ncia de contexto ocorre apenas em pontos bem definidos: nesse caso, quando <code>remotecall_fetch</code> √© <code>remotecall_fetch</code> .  Esse √© o estado atual da implementa√ß√£o e pode ser alterado nas vers√µes futuras do Julia, pois foi projetado para ser capaz de concluir at√© N tarefas em processos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M: N Threading</a> .  Em seguida, precisamos de um modelo para obter / liberar bloqueios para o <code>nextidx</code> , pois n√£o √© seguro permitir que v√°rios processos leiam e gravem recursos ao mesmo tempo. </p><br><p>  Seu c√≥digo deve estar dispon√≠vel para qualquer processo que o execute.  Por exemplo, no prompt de Julia, digite o seguinte: </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> rand2(dims...) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>*rand(dims...) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> julia&gt; rand2(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>√ó<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">0.153756</span></span> <span class="hljs-number"><span class="hljs-number">0.368514</span></span> <span class="hljs-number"><span class="hljs-number">1.15119</span></span> <span class="hljs-number"><span class="hljs-number">0.918912</span></span> julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand2(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>)) ERROR: <span class="hljs-built_in"><span class="hljs-built_in">RemoteException</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">CapturedException</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">UndefVarError</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Symbol</span></span>(<span class="hljs-string"><span class="hljs-string">"#rand2"</span></span>)) Stacktrace: [...]</code> </pre> <br><p>  O processo 1 sabia da fun√ß√£o rand2, mas o processo 2 n√£o.  Na maioria das vezes, voc√™ baixa o c√≥digo de arquivos ou pacotes e possui uma flexibilidade significativa no controle de quais processos carregam o c√≥digo.  Considere o arquivo <code>DummyModule.jl</code> que cont√©m o seguinte c√≥digo: </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span> DummyModule <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> MyType, f <span class="hljs-keyword"><span class="hljs-keyword">mutable struct</span></span> MyType a::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> f(x) = x^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span> println(<span class="hljs-string"><span class="hljs-string">"loaded"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Para fazer refer√™ncia ao <code>MyType</code> em todos os processos, o <code>DummyModule.jl</code> deve ser carregado em cada processo.  Uma chamada para <code>include ('DummyModule.jl')</code> carrega apenas para um processo.  Para carreg√°-lo em cada processo, use a macro <code>@everywhere</code> (execute Julia com julia -p 2): </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> include(<span class="hljs-string"><span class="hljs-string">"DummyModule.jl"</span></span>) loaded From worker <span class="hljs-number"><span class="hljs-number">3</span></span>: loaded From worker <span class="hljs-number"><span class="hljs-number">2</span></span>: loaded</code> </pre> <br><p>  Como de costume, isso n√£o torna o DummyModule acess√≠vel a qualquer processo que exija uso ou importa√ß√£o.  Al√©m disso, quando um DummyModule √© inclu√≠do no escopo de um processo, ele n√£o √© inclu√≠do em nenhum outro: </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> .DummyModule julia&gt; MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>) MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>) julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) ERROR: On worker <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">UndefVarError</span></span>: MyType not defined ‚ãÆ julia&gt; fetch(<span class="hljs-meta"><span class="hljs-meta">@spawnat</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> DummyModule.MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)</code> </pre> <br><p>  No entanto, ainda √© poss√≠vel, por exemplo, enviar MyType para o processo que carregou o DummyModule, mesmo que n√£o esteja no escopo: </p><br><pre> <code class="julia hljs">julia&gt; put!(<span class="hljs-built_in"><span class="hljs-built_in">RemoteChannel</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>), MyType(<span class="hljs-number"><span class="hljs-number">7</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">RemoteChannel</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Channel</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Any</span></span>}}(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>)</code> </pre> <br><p>  O arquivo tamb√©m pode ser pr√©-carregado em v√°rios processos na inicializa√ß√£o com o sinalizador -L, e o script do driver pode ser usado para controlar os c√°lculos: </p><br><pre> <code class="julia hljs">julia -p &lt;n&gt; -L file1.jl -L file2.jl driver.jl</code> </pre> <br><p>  O processo Julia que executa o script do driver no exemplo acima tem um identificador 1, assim como o processo que fornece o prompt interativo.  Por fim, se DummyModule.jl n√£o for um arquivo separado, mas um pacote, o uso do DummyModule carregar√° o DummyModule.jl em todos os processos, mas somente o transferir√° para o escopo do processo para o qual o uso foi chamado. </p><br><h2 id="zapusk-i-upravlenie-rabochimi-processami">  Iniciando e gerenciando fluxos de trabalho </h2><br><p>  A instala√ß√£o b√°sica do Julia possui suporte interno para dois tipos de clusters: </p><br><ul><li>  O cluster local especificado com a op√ß√£o -p, como mostrado acima. </li><li>  M√°quinas de cluster usando a op√ß√£o --machine-file.  Isso usa o login ssh sem uma senha para iniciar os fluxos de trabalho de Julia (no mesmo caminho que o host atual) nas m√°quinas especificadas. </li></ul><br><p><img src="https://habrastorage.org/webt/dr/1b/7y/dr1b7y4ly3ashzsh19-7lwmvwni.jpeg"></p><br><p>  As fun√ß√µes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">addprocs</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rmprocs</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">worker</a> e outras est√£o dispon√≠veis como uma ferramenta de software para adicionar, remover e consultar processos em um cluster. </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed julia&gt; addprocs(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">2</span></span>-element <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  O m√≥dulo <code>Distributed</code> deve ser explicitamente carregado no processo principal antes de chamar <code>addprocs</code> .  Ele fica automaticamente dispon√≠vel para fluxos de trabalho.  Observe que os trabalhadores n√£o executam o script de inicializa√ß√£o <code>~/.julia/config/startup.jl</code> nem sincronizam seu estado global (como vari√°veis ‚Äã‚Äãglobais, defini√ß√µes de novos m√©todos e m√≥dulos carregados) com qualquer um dos outros processos em execu√ß√£o.  Outros tipos de clusters podem ser suportados escrevendo seu pr√≥prio <code>ClusterManager</code> , conforme descrito abaixo na se√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ClusterManager</a> . </p><br><h2 id="deystviya-s-dannymi">  A√ß√µes de dados </h2><br><p>  O envio de mensagens e a movimenta√ß√£o de dados comp√µem a maior parte da sobrecarga em um programa distribu√≠do.  Reduzir o n√∫mero de mensagens e a quantidade de dados enviados √© fundamental para obter desempenho e escalabilidade.  Para isso, √© importante entender a movimenta√ß√£o de dados realizada pelas v√°rias constru√ß√µes de programa√ß√£o distribu√≠da de Julia. </p><br><p>  <code>fetch</code> pode ser considerada uma opera√ß√£o expl√≠cita de movimenta√ß√£o de dados, pois solicita diretamente a movimenta√ß√£o de um objeto para a m√°quina local.  <code>@spawn</code> (e v√°rias constru√ß√µes relacionadas) tamb√©m move os dados, mas isso n√£o √© t√£o √≥bvio, portanto pode ser chamado de opera√ß√£o impl√≠cita de movimenta√ß√£o de dados.  Considere estas duas abordagens para construir e quadrar uma matriz aleat√≥ria: </p><br><p>  Tempos da maneira: </p><br><pre> <code class="julia hljs">julia&gt; A = rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>); julia&gt; Bref = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> A^<span class="hljs-number"><span class="hljs-number">2</span></span>; [...] julia&gt; fetch(Bref);</code> </pre> <br><p>  m√©todo dois: </p><br><pre> <code class="julia hljs">julia&gt; Bref = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>)^<span class="hljs-number"><span class="hljs-number">2</span></span>; [...] julia&gt; fetch(Bref);</code> </pre> <br><p>  A diferen√ßa parece trivial, mas na verdade √© bastante significativa devido ao comportamento do <code>@spawn</code> .  No primeiro m√©todo, uma matriz aleat√≥ria √© constru√≠da localmente e depois enviada para outro processo, onde √© quadrada.  No segundo m√©todo, uma matriz aleat√≥ria √© constru√≠da e elevada ao quadrado em outro processo.  Portanto, o segundo m√©todo envia muito menos dados que o primeiro.  Neste exemplo de brinquedo, os dois m√©todos s√£o f√°ceis de distinguir e escolher.  No entanto, em um programa real, projetar a movimenta√ß√£o de dados pode ser muito caro e provavelmente uma medida. </p><br><p>  Por exemplo, se o primeiro processo precisar da matriz A, o primeiro m√©todo poder√° ser melhor.  Ou, se a computa√ß√£o A for cara e usar apenas o processo atual, mov√™-lo para outro processo pode ser inevit√°vel.  Ou, se o processo atual tiver muito pouco em comum entre a <code>spawn</code> e a <code>fetch(Bref)</code> , talvez seja melhor eliminar completamente a simultaneidade.  Ou imagine que o <code>rand(1000, 1000)</code> substitu√≠do por uma opera√ß√£o mais cara.  Ent√£o pode fazer sentido adicionar outra declara√ß√£o de <code>spawn</code> apenas para esta etapa. </p><br><h2 id="globalnye-peremennye">  Vari√°veis ‚Äã‚Äãglobais </h2><br><p>  Express√µes executadas remotamente por spawn ou fechamentos especificados para execu√ß√£o remota usando <code>remotecall</code> , podem se referir a vari√°veis ‚Äã‚Äãglobais.  As liga√ß√µes globais no m√≥dulo <code>Main</code> s√£o tratadas de maneira um pouco diferente das liga√ß√µes globais em outros m√≥dulos.  Considere o seguinte snippet de c√≥digo: </p><br><pre> <code class="julia hljs">A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>) remotecall_fetch(()-&gt;sum(A), <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br><p>  Neste caso, a <code>sum</code> DEVE ser definida no processo remoto.  Observe que <code>A</code> √© uma vari√°vel global definida no espa√ßo de trabalho local.  O trabalhador 2 n√£o possui uma vari√°vel chamada <code>A</code> na se√ß√£o <code>Main</code> .  Enviar a fun√ß√£o de fechamento <code>() -&gt; sum(A)</code> para o trabalhador 2 faz com que <code>Main.A</code> seja definido em 2. <code>Main.A</code> continua existindo no trabalhador 2, mesmo ap√≥s o <code>remotecall_fetch</code> chamada <code>remotecall_fetch</code> . </p><br><p><img src="https://habrastorage.org/webt/kp/iv/xi/kpivxixwcfwqqzi4gv1dyqkjhcw.png"></p><br><p>  Chamadas remotas com refer√™ncias globais incorporadas (apenas no m√≥dulo principal) gerenciam vari√°veis ‚Äã‚Äãglobais da seguinte maneira: </p><br><ul><li>  Novas liga√ß√µes globais ser√£o criadas nas esta√ß√µes de trabalho de destino se forem referenciadas como parte de uma chamada remota. </li><li>  As constantes globais tamb√©m s√£o declaradas como constantes em n√≥s remotos. </li><li>  Os Globals s√£o reenviados ao funcion√°rio de destino apenas no contexto de uma chamada remota e somente se seu valor foi alterado.  Al√©m disso, o cluster n√£o sincroniza liga√ß√µes globais entre n√≥s.  Por exemplo: </li></ul><br><pre> <code class="julia hljs">A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>) remotecall_fetch(()-&gt;sum(A), <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment"># worker 2 A = rand(10,10) remotecall_fetch(()-&gt;sum(A), 3) # worker 3 A = nothing</span></span></code> </pre> <br><p>  A execu√ß√£o do fragmento acima leva ao fato de que <code>Main.A</code> no funcion√°rio 2 tem um valor diferente de <code>Main.A</code> no funcion√°rio 3, enquanto o valor de <code>Main.A</code> no n√≥ 1 √© zero. </p><br><p>  Como voc√™ provavelmente entendeu, embora a mem√≥ria associada √†s vari√°veis ‚Äã‚Äãglobais possa ser coletada quando elas s√£o reatribu√≠das ao dispositivo mestre, essas a√ß√µes n√£o s√£o executadas para os trabalhadores, pois as liga√ß√µes continuam a funcionar.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">claro!</a>  pode ser usado para reatribuir manualmente determinadas vari√°veis ‚Äã‚Äãglobais para <code>nothing</code> se elas n√£o forem mais necess√°rias.  Isso liberar√° qualquer mem√≥ria associada a eles como parte do ciclo normal de coleta de lixo.  Portanto, os programas devem ter cuidado ao acessar vari√°veis ‚Äã‚Äãglobais em chamadas remotas.  De fato, sempre que poss√≠vel, √© melhor evit√°-los.  Se voc√™ precisar fazer refer√™ncia a vari√°veis ‚Äã‚Äãglobais, considere usar blocos <code>let</code> para localizar vari√°veis ‚Äã‚Äãglobais.  Por exemplo: </p><br><pre> <code class="julia hljs">julia&gt; A = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); julia&gt; remotecall_fetch(()-&gt;A, <span class="hljs-number"><span class="hljs-number">2</span></span>); julia&gt; B = rand(<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>); julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> B = B remotecall_fetch(()-&gt;B, <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; julia&gt; <span class="hljs-meta"><span class="hljs-meta">@fetchfrom</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> InteractiveUtils.varinfo() name size summary ‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì ‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì ‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì‚Äì A <span class="hljs-number"><span class="hljs-number">800</span></span> bytes <span class="hljs-number"><span class="hljs-number">10</span></span>√ó<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>} Base <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span> Core <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span> Main <span class="hljs-built_in"><span class="hljs-built_in">Module</span></span></code> </pre> <br><p>  √â f√°cil ver que a vari√°vel global <code>A</code> definida no trabalhador 2, mas <code>B</code> gravada como uma vari√°vel local e, portanto, a liga√ß√£o para <code>B</code> n√£o existe no trabalhador 2. </p><br><h2 id="parallelnye-cikly">  Loops paralelos </h2><br><p><img src="https://habrastorage.org/webt/zv/m5/q_/zvm5q_scthnveue7fxljwa0dshu.jpeg"></p><br><p>  Felizmente, muitos c√°lculos √∫teis de simultaneidade n√£o requerem movimenta√ß√£o de dados.  Um exemplo t√≠pico √© uma simula√ß√£o de Monte Carlo, na qual v√°rios processos podem processar simultaneamente testes de simula√ß√£o independentes.  Podemos usar o <code>@spawn</code> para lan√ßar moedas em dois processos.  Primeiro, escreva a seguinte fun√ß√£o em <code>count_heads.jl</code> : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> count_heads(n) c::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:n c += rand(<span class="hljs-built_in"><span class="hljs-built_in">Bool</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  A fun√ß√£o count_heads simplesmente adiciona n bits aleat√≥rios.  Veja como podemos fazer alguns testes em duas m√°quinas e adicionar os resultados: </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> include_string(Main, $(read(<span class="hljs-string"><span class="hljs-string">"count_heads.jl"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)), <span class="hljs-string"><span class="hljs-string">"count_heads.jl"</span></span>) julia&gt; a = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> count_heads(<span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; b = <span class="hljs-meta"><span class="hljs-meta">@spawn</span></span> count_heads(<span class="hljs-number"><span class="hljs-number">100000000</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">Future</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-literal"><span class="hljs-literal">nothing</span></span>) julia&gt; fetch(a)+fetch(b) <span class="hljs-number"><span class="hljs-number">100001564</span></span></code> </pre> <br><p>  Este exemplo demonstra um padr√£o de programa√ß√£o paralela poderoso e frequentemente usado.  Muitas itera√ß√µes s√£o executadas independentemente em v√°rios processos e, em seguida, seus resultados s√£o combinados usando alguma fun√ß√£o.  O processo de uni√£o √© chamado de redu√ß√£o, porque geralmente reduz a classifica√ß√£o do tensor: o vetor de n√∫meros √© reduzido para um n√∫mero ou a matriz √© reduzida para uma linha ou coluna, etc.  No c√≥digo, isso geralmente se parece com isso: padr√£o <code>x = f(x, v [i])</code> , onde <code>x</code> √© a bateria, <code>f</code> √© a fun√ß√£o de redu√ß√£o e <code>v[i]</code> s√£o os elementos a serem reduzidos. </p><br><p>  √â desej√°vel que <code>f</code> seja associativo para que n√£o importe em que ordem as opera√ß√µes s√£o executadas.  Observe que o uso deste modelo com <code>count_heads</code> pode ser generalizado.  Usamos duas declara√ß√µes expl√≠citas de <code>spawn</code> , o que limita a simultaneidade a dois processos.  Para executar em qualquer n√∫mero de processos, podemos usar um loop <code>for</code> paralelo operando na mem√≥ria distribu√≠da, que pode ser gravada em Julia usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Distributed</a> , por exemplo: </p><br><pre> <code class="julia hljs">nheads = <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> (+) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">200000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>(rand(<span class="hljs-built_in"><span class="hljs-built_in">Bool</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>                (   <code>(+)</code> ).          .         . </p><br><p>  ,     <code>for</code>    ,    .  ,      ,          ,      .  ,    ,      . ,       : </p><br><pre> <code class="julia hljs">a = zeros(<span class="hljs-number"><span class="hljs-number">100000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">100000</span></span> a[i] = i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>      ,          .    ,  .  ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Shared Arrays</a> ,    ,    : </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharedArrays a = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>}(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span> a[i] = i <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  ¬´¬ª      ,      : </p><br><pre> <code class="julia hljs">a = randn(<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> (+) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">100000</span></span> f(a[rand(<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>)]) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>     <code>f</code>      ,    .    ,    ,    .      ,               <code>Future</code> ,   .     Future    ,    <code>fetch</code> ,      ,   <code>@sync</code> ,  <code>@sync distributed for</code> . </p><br><p>       ,              (,    ,      ).     ,  <em> </em> ,   Julia   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pmap</a> . ,            : </p><br><pre> <code class="julia hljs">julia&gt; M = <span class="hljs-built_in"><span class="hljs-built_in">Matrix</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>}[rand(<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>]; julia&gt; pmap(svdvals, M);</code> </pre> <br><p> <code>pmap</code>    ,        . , <code>distributed for</code>   ,    , ,    .      <code>pmap</code> ,   <code>distributed</code>   .   <code>distributed for</code>      . </p><br><h2 id="obschie-massivy-shared-arrays">   (Shared Arrays) </h2><br><p><img src="https://habrastorage.org/webt/gg/46/u5/gg46u5y_8bmejazw_ijxwzrbxie.jpeg"></p><br><p> Shared Arrays              .        <a href="">DArray</a> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SharedArray</a>  .  <a href="">DArray</a>         ,            ; ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SharedArray</a>        . </p><br><p> <code>SharedArray</code> ‚Äî  ,   ,              .  Shared Array    <code>SharedArrays</code> ,         .  <code>SharedArray</code>  (    )   ,        ,       .        <code>SharedArray</code> ,     .  ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Array</a> ,      <code>SharedArray</code> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sdata</a> .    <code>AbstractArray</code> <code>sdata</code>    ,    <code>sdata</code>     <code>Array</code> .      : </p><br><pre> <code class="julia hljs"><span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{T,N}(dims::<span class="hljs-built_in"><span class="hljs-built_in">NTuple</span></span>; init=<span class="hljs-literal"><span class="hljs-literal">false</span></span>, pids=<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>[])</code> </pre> <br><p>   <code>N</code> -     <code>T</code>   <code>dims</code>  ,   <code>pids</code> .     ,        ,      <code>pids</code> (  ,       ). </p><br><p>    <code>init</code>   <code>initfn(S :: SharedArray)</code> ,      .   ,      <code>init</code>    ,  . </p><br><p>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed julia&gt; addprocs(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>-element <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharedArrays julia&gt; S = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}((<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), init = S -&gt; S[localindices(S)] = myid()) <span class="hljs-number"><span class="hljs-number">3</span></span>√ó<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; S[<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> julia&gt; S <span class="hljs-number"><span class="hljs-number">3</span></span>√ó<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">SharedArrays.localindices</a>             . ,      ,  : </p><br><pre> <code class="julia hljs">julia&gt; S = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}((<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>), init = S -&gt; S[indexpids(S):length(procs(S)):length(S)] = myid()) <span class="hljs-number"><span class="hljs-number">3</span></span>√ó<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Int64</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}: <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><p>        ,    ,    .  Por exemplo: </p><br><pre> <code class="julia hljs"><span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> procs(S) <span class="hljs-meta"><span class="hljs-meta">@async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> remotecall_wait(fill!, p, S, p) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>    .     <em></em>    <code>pid</code> ,  ,     (    <code>S</code> ),   <code>pid</code> . </p><br><p>            ¬´¬ª: </p><br><pre> <code class="julia hljs">q[i,j,t+<span class="hljs-number"><span class="hljs-number">1</span></span>] = q[i,j,t] + u[i,j,t]</code> </pre> <br><p>   ,     ,   , ,  ,   :  <code>q [i,j,t]</code>    ,     <code>q[i,j,t+1]</code>     ,  ,  ,  <code>q[i,j,t]</code>      ,      <code>q[i,j,t+1]</code> .         .     .  ,    <code>(irange, jrange)</code> ,   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myrange(q::<span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>) idx = indexpids(q) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> idx == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># This worker is not assigned a piece return 1:0, 1:0 end nchunks = length(procs(q)) splits = [round(Int, s) for s in range(0, stop=size(q,2), length=nchunks+1)] 1:size(q,1), splits[idx]+1:splits[idx+1] end</span></span></code> </pre> <br><p>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_chunk!(q, u, irange, jrange, trange) <span class="hljs-meta"><span class="hljs-meta">@show</span></span> (irange, jrange, trange) <span class="hljs-comment"><span class="hljs-comment"># display so we can see what's happening for t in trange, j in jrange, i in irange q[i,j,t+1] = q[i,j,t] + u[i,j,t] end q end</span></span></code> </pre> <br><p>        <code>SharedArray</code> </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> advection_shared_chunk!(q, u) = advection_chunk!(q, u, myrange(q)..., <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><p>      ,       : </p><br><pre> <code class="julia hljs">julia&gt; advection_serial!(q, u) = advection_chunk!(q, u, <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@distributed</a> : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_parallel!(q, u) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> t = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">3</span></span>)-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-meta"><span class="hljs-meta">@distributed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>:size(q,<span class="hljs-number"><span class="hljs-number">1</span></span>) q[i,j,t+<span class="hljs-number"><span class="hljs-number">1</span></span>]= q[i,j,t] + u[i,j,t] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><p>  ,   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> advection_shared!(q, u) <span class="hljs-meta"><span class="hljs-meta">@sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> procs(q) <span class="hljs-meta"><span class="hljs-meta">@async</span></span> remotecall_wait(advection_shared_chunk!, p, q, u) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> q <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre> <br><p>    SharedArray    ,     (  <code>julia -p 4</code> ): </p><br><pre> <code class="julia hljs">julia&gt; q = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>}((<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>)); julia&gt; u = <span class="hljs-built_in"><span class="hljs-built_in">SharedArray</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">Float64</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>}((<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">500</span></span>));</code> </pre> <br><p>      JIT-     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@time</a>   : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_serial!(q, u); (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) <span class="hljs-number"><span class="hljs-number">830.220</span></span> milliseconds (<span class="hljs-number"><span class="hljs-number">216</span></span> allocations: <span class="hljs-number"><span class="hljs-number">13820</span></span> bytes) julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_parallel!(q, u); <span class="hljs-number"><span class="hljs-number">2.495</span></span> seconds (<span class="hljs-number"><span class="hljs-number">3999</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">289</span></span> MB, <span class="hljs-number"><span class="hljs-number">2.09</span></span>% gc time) julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> advection_shared!(q,u); From worker <span class="hljs-number"><span class="hljs-number">2</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">125</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">4</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">251</span></span>:<span class="hljs-number"><span class="hljs-number">375</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">3</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">126</span></span>:<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) From worker <span class="hljs-number"><span class="hljs-number">5</span></span>: (irange,jrange,trange) = (<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">376</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">499</span></span>) <span class="hljs-number"><span class="hljs-number">238.119</span></span> milliseconds (<span class="hljs-number"><span class="hljs-number">2264</span></span> allocations: <span class="hljs-number"><span class="hljs-number">169</span></span> KB)</code> </pre> <br><p>    <code>advection_shared!</code>  ,      ,         . </p><br><h3 id="obschie-massivy-i-raspredelennaya-sborka-musora">       </h3><br><p>    ,          . ,        ,         . <br>    ,     ,   ,  . </p><br><h1 id="parallelnyy-monte-karlo-v-julia">  -  Julia </h1><br><p>  ,             ,    ,        . </p><br><p>         <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03C0;</mi><mo>=</mo><mn>3.14159265...</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="17.48ex" height="2.057ex" viewBox="0 -780.1 7526.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-3C0" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-3D" x="851" y="0"></use><g transform="translate(1907,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-33"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-31" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-34" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-31" x="1780" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-35" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-39" x="2781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-32" x="3281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-36" x="3782" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-35" x="4282" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2E" x="4783" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2E" x="5061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2E" x="5340" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>œÄ</mi><mo>=</mo><mn>3.14159265...</mn></math></span></span><script type="math/tex" id="MathJax-Element-1">\pi = 3.14159265...</script> ,      ,   -.   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ pi </script> ,     <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi><mo>=</mo><mi>&amp;#x03C0;</mi><msup><mi>r</mi><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.033ex" height="2.419ex" viewBox="0 -935.7 3458.5 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-3C0" x="1979" y="0"></use><g transform="translate(2553,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-32" x="638" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>œÄ</mi><msup><mi>r</mi><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-3">S = \pi r^2</script>  onde <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>r</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.049ex" height="1.455ex" viewBox="0 -520.7 451.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-72" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> r </script> ‚Äî  .     -   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> \ pi </script>    , ..        <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>[</mo><mo>&amp;#x2212;</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy=&quot;false&quot;>]</mo><mn>2</mn></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.515ex" height="2.901ex" viewBox="0 -935.7 3235.6 1249" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2212" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-31" x="1057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2C" x="1557" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-31" x="2002" y="0"></use><g transform="translate(2503,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-5D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-32" x="393" y="513"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">[</mo><mo>‚àí</mo><mn>1</mn><mo>,</mo><mn>1</mn><msup><mo stretchy="false">]</mo><mn>2</mn></msup></math></span></span><script type="math/tex" id="MathJax-Element-6">[‚àí1,1]^2</script>   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>x</mi><mo>&amp;#x2212;</mo><mi>y</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.326ex" height="2.178ex" viewBox="0 -676.4 2292.9 937.7" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2212" x="794" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-79" x="1795" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>‚àí</mo><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">x-y</script>    ,    . </p><br><p><img src="https://habrastorage.org/webt/4v/ym/mb/4vymmbllbfnu3prcb3wfu0qqkje.png"></p><br><p>     ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>S</mi><mo>=</mo><mi>&amp;#x03C0;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.93ex" height="2.057ex" viewBox="0 -780.1 2553.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-3D" x="923" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-3C0" x="1979" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>=</mo><mi>œÄ</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">S=\pi</script> ,   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>r</mi><mo>=</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.31ex" height="1.937ex" viewBox="0 -728.2 2286.1 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-72" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-3D" x="729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-31" x="1785" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-9">r = 1</script> )    ( <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>A</mi><mo>=</mo><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.004ex" height="2.057ex" viewBox="0 -780.1 2585.1 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-3D" x="1028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-34" x="2084" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>A</mi><mo>=</mo><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-10">A = 4</script> )  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03C0;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mn>4</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.657ex" height="2.66ex" viewBox="0 -832 1574.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-3C0" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-2F" x="573" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMAIN-34" x="1074" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>œÄ</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mn>4</mn></math></span></span><script type="math/tex" id="MathJax-Element-11">\pi/4</script> ,      ,    ,          .  ,   <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> \ pi </script>      ,    .    <code>compute_pi (N)</code> ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> \ pi </script> ,  <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">N</script> . </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> compute_pi(N::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-comment"><span class="hljs-comment"># counts number of points that have radial coordinate &lt; 1, ie in circle n_landed_in_circle = 0 for i = 1:N x = rand() * 2 - 1 # uniformly distributed number on x-axis y = rand() * 2 - 1 # uniformly distributed number on y-axis r2 = x*x + y*y # radius squared, in radial coordinates if r2 &lt; 1.0 n_landed_in_circle += 1 end end return n_landed_in_circle / N * 4.0 end</span></span></code> </pre> <br><p>  ,     ,    <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/455846/&amp;usg=ALkJrhh1Fuhs1Xx-YzjSyyZIe8rmghC3NQ#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-15"> \ pi </script>  .      :   ,          ,     25  . </p><br><p>  Julia         <code>Pi.jl</code> (    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sublime Text</a> ,          ): </p><br><pre> <code class="julia hljs">C:\Users\User\AppData\Local\Julia-<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>\bin\julia -p <span class="hljs-number"><span class="hljs-number">4</span></span> julia&gt; include(<span class="hljs-string"><span class="hljs-string">"C:/Users/User/Desktop/Pi.jl"</span></span>)</code> </pre> <br><p>       </p><br><pre> <code class="julia hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Distributed addprocs(<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre> <br><p>       <em>Jupyter</em> </p><br><div class="spoiler"> <b class="spoiler_title">Pi.jl</b> <div class="spoiler_text"><pre> <code class="julia hljs"><span class="hljs-meta"><span class="hljs-meta">@everywhere</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> compute_pi(N::<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) n_landed_in_circle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment"># counts number of points that have radial coordinate &lt; 1, ie in circle for i = 1:N x = rand() * 2 - 1 # uniformly distributed number on x-axis y = rand() * 2 - 1 # uniformly distributed number on y-axis r2 = x*x + y*y # radius squared, in radial coordinates if r2 &lt; 1.0 n_landed_in_circle += 1 end end return n_landed_in_circle / N * 4.0 end function parallel_pi_computation(N::Int; ncores::Int=4) #       sum_of_pis = @distributed (+) for i=1:ncores compute_pi(ceil(Int, N / ncores)) end return sum_of_pis / ncores # average value end # ceil (T, x)     #  T,     x.</span></span></code> </pre> </div></div><br><p>       ,    : </p><br><pre> <code class="julia hljs">julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">6.818123</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.96</span></span> M allocations: <span class="hljs-number"><span class="hljs-number">99.838</span></span> MiB, <span class="hljs-number"><span class="hljs-number">0.42</span></span>% gc time) <span class="hljs-number"><span class="hljs-number">3.141562892</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-number"><span class="hljs-number">5.081638</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.12</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">62.953</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.141657252</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">3.504871</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.84</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">109.382</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.1415942599999997</span></span> julia&gt; <span class="hljs-meta"><span class="hljs-meta">@time</span></span> parallel_pi_computation(<span class="hljs-number"><span class="hljs-number">1000000000</span></span>, ncores = <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-number"><span class="hljs-number">3.093918</span></span> seconds (<span class="hljs-number"><span class="hljs-number">1.12</span></span> k allocations: <span class="hljs-number"><span class="hljs-number">71.938</span></span> KiB) <span class="hljs-number"><span class="hljs-number">3.1416889400000003</span></span> julia&gt; <span class="hljs-literal"><span class="hljs-literal">pi</span></span> ? = <span class="hljs-number"><span class="hljs-number">3.1415926535897</span></span>...</code> </pre> <br><p>  <em>JIT</em> - ‚Äî     .  ,    Julia  . ,             (       Multi-Threading, Atomic Operations, Channels  Coroutines). </p><br><h3 id="poleznye-ssylki">   </h3><br><p>   ,    ,   .  <a href="">MPI.jl</a>      <code>MPI</code> ,  <br> <a href="">DistributedArrays.jl</a>     . <br>       GPU,    : </p><br><ol><li>  (  C) <a href="">OpenCL.jl</a>  <a href="">CUDAdrv.jl</a>     OpenCL   CUDA. </li><li>  (  Julia)  <a href="">CUDAnative.jl</a>     CUDA . </li><li>  ,    ,   <a href="">CuArrays.jl</a>  <a href="">CLArrays.jl</a> </li><li>   ,   <a href="">ArrayFire.jl</a>  <a href="">GPUArrays.jl</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> -</a> </li><li>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> </li><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kynseed</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> </a> </li></ol><br><p>  , , .    ! </p><br><p><img src="https://habrastorage.org/webt/f2/4o/pr/f24oprfnnrnguwwb03xcyo__xx4.gif"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt455846/">https://habr.com/ru/post/pt455846/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt455832/index.html">Hist√≥rico de uma √∫nica investiga√ß√£o SQL</a></li>
<li><a href="../pt455834/index.html">Benchmarks para servidores Linux: 5 ferramentas abertas</a></li>
<li><a href="../pt455840/index.html">Como trabalhar com v√°rias consultas. Composi√ß√£o, Redutor, FP</a></li>
<li><a href="../pt455842/index.html">Espalhe uma lista vinculada individualmente. Edi√ß√£o Swift</a></li>
<li><a href="../pt455844/index.html">Criando um analisador Roslyn usando o teste de encapsulamento como exemplo</a></li>
<li><a href="../pt455848/index.html">T√©cnica para evitar comportamento indefinido ao acessar um singleton</a></li>
<li><a href="../pt455850/index.html">Caixa de ferramentas para pesquisadores - terceira edi√ß√£o: localizando e trabalhando com fontes</a></li>
<li><a href="../pt455852/index.html">Eleva√ß√£o sinusal e implanta√ß√£o simult√¢nea</a></li>
<li><a href="../pt455854/index.html">Como implementar menus de contexto no iOS 13</a></li>
<li><a href="../pt455856/index.html">Sensor sem fio de temperatura, umidade e press√£o atmosf√©rica no nRF52832</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>