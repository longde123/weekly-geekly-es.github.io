<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„Ä∞Ô∏è ü§õüèæ üí¶ DHCP + MySQL-Server in Python üë©üèª‚Äçüéì üë©üèø‚Äçü§ù‚Äçüë©üèΩ üö©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Der Zweck dieses Projekts war: 



- Lernen von DHCP √ºber ein IPv4-Netzwerk 
- Python lernen (etwas mehr als von Grund auf neu;)) 
- Ersetzen des DB2D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DHCP + MySQL-Server in Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445338/"><img src="https://habrastorage.org/webt/ju/n4/fb/jun4fbrj-eabxfgou112uxc5lac.png"><br><br>  Der Zweck dieses Projekts war: <br><br><ul><li>  Lernen von DHCP √ºber ein IPv4-Netzwerk </li><li>  Python lernen (etwas mehr als von Grund auf neu;)) </li><li>  Ersetzen des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DB2DHCP-</a> Servers (meine Gabel), des Originals <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> , der unter dem neuen Betriebssystem immer schwieriger zusammenzubauen ist.  Ja, und ich mag das nicht, die Bin√§rdatei, die "momentan nicht √§ndern" kann. </li><li>  Erhalten eines funktionierenden DHCP-Servers mit der M√∂glichkeit, die IP-Adresse des Teilnehmers √ºber den Mac des Teilnehmers oder eine Reihe von Mac-Switches + Port auszuw√§hlen (Option 82) </li><li>  ein anderes Fahrrad schreiben (Oh! das ist mein Lieblingsbesch√§ftigung) </li><li>  Lyuli √ºber seinen Blick auf Habrahabr informieren (oder besser einladen);) </li></ul><br>  Ergebnis: es funktioniert;) Getestet unter FreeBSD und Ubuntu OS.  Theoretisch kann der Code aufgefordert werden, unter jedem Betriebssystem zu arbeiten, weil  Der Code enth√§lt keine spezifischen Bindungen. <br>  Achtung  Viel weiter. <br><a name="habracut"></a><br>  Link zum Repository, damit Fans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"lebendig ber√ºhren" k√∂nnen.</a> <br><br>  Der Prozess der Installation, Konfiguration und Verwendung des Ergebnisses der ‚ÄûUntersuchung der Hardware‚Äú ist viel geringer und dann eine kleine Theorie zum DHCP-Protokoll.  F√ºr sich.  Und f√ºr die Geschichte;) <br><br><h1>  Ein bisschen Theorie </h1><br><h2>  Was ist DHCP? </h2><br>  Dies ist ein Netzwerkprotokoll, mit dem ein Ger√§t seine IP-Adresse (also andere Parameter wie ein Gateway, DNS usw.) von einem DHCP-Server herausfinden kann.  Pakete werden √ºber UDP ausgetauscht.  Das allgemeine Funktionsprinzip des Ger√§ts beim Anfordern von Netzwerkparametern lautet wie folgt: <br><br><ol><li>  Das Ger√§t (Client) sendet eine UDP-Broadcast-Anfrage (DHCPDISCOVER) √ºber das Netzwerk mit der Anfrage: "Nun, jemand, geben Sie mir eine IP-Adresse."  Normalerweise (aber nicht immer) stammt die Anforderung von Port 68 (Quelle) und das Ziel von Port 67 (Ziel).  Einige Ger√§te senden auch Pakete von Port 67.  Im DHCPDISCOVER-Paket ist die MAC-Adresse des Clientger√§ts enthalten. </li><li>  Alle im Netzwerk befindlichen DHCP-Server (und m√∂glicherweise mehrere) bilden ein Formular f√ºr das Ger√§t, das DHCPDISCOVER einen DHCPOFFER-Satz mit Netzwerkeinstellungen gesendet hat, und sendet ihn auch √ºber das Netzwerk.  Die Identifizierung, f√ºr die dieses Paket bestimmt ist, erfolgt an die MAC-Adresse des Clients, die zuvor in der DHCPDISCOVER-Anforderung angegeben wurde. </li><li>  Der Client empf√§ngt Pakete mit Angeboten f√ºr Netzwerkeinstellungen, w√§hlt die attraktivsten aus (die Kriterien k√∂nnen sich beispielsweise nach dem Zeitpunkt der Paketzustellung und der Anzahl der Zwischenrouten unterscheiden) und veranlasst den DHCP-Server, DHCPREQUEST mit Netzwerkeinstellungen offiziell anzufordern.  In diesem Fall geht das Paket an einen bestimmten DHCP-Server. </li><li>  Der Server, der DHCPREQUEST empfangen hat, sendet ein DHCPACK-Paket, in dem die Netzwerkeinstellungen f√ºr diesen Client erneut aufgelistet werden </li></ol><br><img src="https://habrastorage.org/webt/ki/vj/cn/kivjcno-qcqpx8jgqxra1rnspvi.png"><br><br>  Dar√ºber hinaus gibt es DHCPINFORM-Pakete, die vom Client stammen und deren Zweck darin besteht, den DHCP-Server dar√ºber zu informieren, dass der "Client aktiv ist" und die ausgegebenen Netzwerkeinstellungen verwendet.  Bei der Implementierung dieses Servers werden diese Pakete ignoriert. <br><br><h2>  Paketformat </h2><br><br>  Im Allgemeinen sieht der Ethernet-Paketrahmen ungef√§hr so ‚Äã‚Äãaus: <br><br><img src="https://habrastorage.org/webt/x6/uj/n0/x6ujn0ood0nch96zosj6ldkjt4s.png"><br><br>  In unserem Fall werden wir nur Daten direkt aus dem Inhalt des UDP-Pakets ohne die OSI-Schichtprotokoll-Header ber√ºcksichtigen, n√§mlich die DHCP-Struktur: <br><br><h3>  DHCPDISCOVER </h3><br>  Der Prozess zum Abrufen der IP-Adresse f√ºr das Ger√§t beginnt also mit der Tatsache, dass der DHCP-Client eine Broadcast-Anforderung von Port 68 an 255.255.255.255:67 sendet.  In diesem Paket enth√§lt der Client seine MAC-Adresse sowie das, was er vom DHCP-Server empfangen m√∂chte.  Die Struktur des Pakets ist in der folgenden Tabelle beschrieben. <br><br><div class="spoiler">  <b class="spoiler_title">DHCPDISCOVER-Paketstrukturtabelle</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Paketposition </td><td align="left">  Wert Name </td><td align="right">  Beispiel </td><td align="center">  Einreichung </td><td align="center">  Byte </td><td align="left">  Erkl√§rung </td></tr><tr><td align="right">  1 </td><td align="left">  Startanforderung </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Nachricht.  1 - Anfrage von Client zu Server, 2 - Antwort von Server zu Client </td></tr><tr><td align="right">  2 </td><td align="left">  Hardwaretyp </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Hardwareadresse in diesem Protokoll 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware passt L√§nge </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  MAC-Adressl√§nge des Ger√§ts </td></tr><tr><td align="right">  4 </td><td align="left">  Hopfen </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Anzahl der Zwischenstrecken </td></tr><tr><td align="right">  5 </td><td align="left">  Transaktions-ID </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Eindeutige Transaktionskennung.  Wird vom Client zu Beginn des Anforderungsvorgangs generiert </td></tr><tr><td align="right">  7 </td><td align="left">  Zweite verstrichen </td><td align="right">  0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Zeit in Sekunden seit Beginn des Prozesses zum Abrufen der Adresse </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp-Flags </td><td align="right">  0 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Einige Flags, die als Hinweis auf Protokollparameter gesetzt werden k√∂nnen </td></tr><tr><td align="right">  11 </td><td align="left">  Client-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Client-IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  15 </td><td align="left">  Ihre Client-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Vom Server vorgeschlagene IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  19 </td><td align="left">  N√§chste Server-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Server-IP-Adresse (falls bekannt) </td></tr><tr><td align="right">  23 </td><td align="left">  IP-Adresse des Relay-Agenten </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  IP-Adresse des Relay-Agenten (z. B. ein Switch) </td></tr><tr><td align="right">  27 </td><td align="left">  Client-MAC-Adresse </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  MAC-Adresse des Absenders des Pakets (Client) </td></tr><tr><td align="right">  31 </td><td align="left">  Auff√ºllen der Client-Hardware-Adresse </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Reservierter Platz.  Normalerweise Nullen </td></tr><tr><td align="right">  41 </td><td align="left">  Server-Hostname </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  Der Name des DHCP-Servers.  Normalerweise nicht √ºbertragen </td></tr><tr><td align="right">  105 </td><td align="left">  Name der Startdatei </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  Der Dateiname auf dem Server, der von plattenlosen Stationen w√§hrend des Startvorgangs verwendet wird </td></tr><tr><td align="right">  235 </td><td align="left">  Magischer Keks </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Die "magische" Zahl, mit der inkl.  Sie k√∂nnen feststellen, dass dieses Paket zum DHCP-Protokoll geh√∂rt </td></tr><tr><td colspan="7" align="center">  DHCP-Optionen.  Kann in beliebiger Reihenfolge gehen </td></tr><tr><td align="right">  236 </td><td align="left">  Optionsnummer </td><td align="right">  53 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option 53, die den Typ des DHCP-Pakets angibt <br><br>  1 - DHCPDISCOVER <br>  3 - DHCPREQUEST <br>  2 - DHCPOFFER <br>  5 - DHCPACK <br>  8 - DHCPINFORM </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  50 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Welche IP-Adresse m√∂chte der Client erhalten? </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  55 </td><td align="center"></td><td align="right">  1 </td><td rowspan="3" align="left">  Die vom Client angeforderten Netzwerkparameter.  Die Zusammensetzung kann unterschiedlich sein <br><br>  01 - Netzmaske <br>  03 - Gateway <br>  06 - DNS <br>  oc - Hostname <br>  0f - Netzwerkdom√§nenname <br>  1c - Adresse der Broadcast-Anfrage (Broadcast) <br>  42 - TFTP-Servername <br>  79 - Klassenlose statische Route </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  8 </td><td align="center"></td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01: 03: 06: 0c: 0f: 1c: 42: 79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  82 </td><td align="center">  Dez. </td><td align="left"></td><td rowspan="3" align="left">  Option 82, bei der die MAC-Adresse des Repeater-Ger√§ts und einige zus√§tzliche Werte √ºbertragen werden. <br><br>  Meistens der Switch-Port, auf dem der DHCP-Endclient ausgef√ºhrt wird. Zus√§tzliche Optionen sind in diese Option ‚Äûeingebettet‚Äú. Das erste Byte ist die Nummer der ‚ÄûUnteroption‚Äú, das zweite die L√§nge und dann der Wert. <br><br>  In diesem Fall sind in Option 82 die Unteroptionen verschachtelt: <br>  Agent Circuit ID = 00: 04: 00: 01: 00: 04, wobei die letzten beiden Bytes der DHCP-Client-Port sind, von dem die Anforderung stammt <br><br>  Agent Remote ID = 00: 06: c8: be: 19: 93: 11: 48 - MAC-Adresse des DHCP-Relay-Ger√§ts </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  18 </td><td align="center">  Dez. </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01.06 <br>  00: 04: 00: 01: 00: 04 <br>  02.08 <br>  00: 06: c8: be: 19: 93: 11: 48 </td><td align="center">  Hex </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Ende des Pakets </td><td align="right">  255 </td><td align="center">  Dez. </td><td align="right">  1 </td><td align="left">  255 symbolisiert das Ende des Pakets </td></tr></tbody></table><br></div></div><br><h3>  DHCPOFFER </h3><br>  Sobald der Server das DHCPDISCOVER-Paket empf√§ngt und sieht, dass er dem Client etwas von der angeforderten anbieten kann, bildet er eine Antwort daf√ºr - DHCPOFFER.  Die Antwort wird an den Port "von wo sie kam" gesendet, Broadcast, weil  Derzeit verf√ºgt der Client noch nicht √ºber eine IP-Adresse. Daher kann er ein Paket nur empfangen, wenn es gesendet wird.  Der Client erkennt, dass es sich um ein Paket von MAC handelt, an seiner Adresse innerhalb des Pakets sowie an der Transaktionsnummer, die er zum Zeitpunkt der Erstellung des ersten Pakets generiert. <br><br><div class="spoiler">  <b class="spoiler_title">DHCPOFFER-Paketstrukturtabelle</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Paketposition </td><td align="left">  Name des Wertes (allgemein) </td><td align="right">  Beispiel </td><td align="center">  Einreichung </td><td align="center">  Byte </td><td align="left">  Erkl√§rung </td></tr><tr><td align="right">  1 </td><td align="left">  Startanforderung </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Nachricht.  1 - Anfrage von Client zu Server, 2 - Antwort von Server zu Client </td></tr><tr><td align="right">  2 </td><td align="left">  Hardwaretyp </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Hardwareadresse in diesem Protokoll 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware passt L√§nge </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  MAC-Adressl√§nge des Ger√§ts </td></tr><tr><td align="right">  4 </td><td align="left">  Hopfen </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Anzahl der Zwischenstrecken </td></tr><tr><td align="right">  5 </td><td align="left">  Transaktions-ID </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Eindeutige Transaktionskennung.  Wird vom Client zu Beginn des Anforderungsvorgangs generiert </td></tr><tr><td align="right">  7 </td><td align="left">  Zweite verstrichen </td><td align="right">  0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Zeit in Sekunden seit Beginn des Prozesses zum Abrufen der Adresse </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp-Flags </td><td align="right">  0 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Einige Flags, die als Hinweis auf Protokollparameter gesetzt werden k√∂nnen.  In diesem Fall bedeutet 0 den Unicast-Anforderungstyp </td></tr><tr><td align="right">  11 </td><td align="left">  Client-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Client-IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  15 </td><td align="left">  Ihre Client-IP-Adresse </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Vom Server vorgeschlagene IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  19 </td><td align="left">  N√§chste Server-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Server-IP-Adresse (falls bekannt) </td></tr><tr><td align="right">  23 </td><td align="left">  IP-Adresse des Relay-Agenten </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  IP-Adresse des Relay-Agenten (z. B. ein Switch) </td></tr><tr><td align="right">  27 </td><td align="left">  Client-MAC-Adresse </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  MAC-Adresse des Absenders des Pakets (Client) </td></tr><tr><td align="right">  31 </td><td align="left">  Auff√ºllen der Client-Hardware-Adresse </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Reservierter Platz.  Normalerweise Nullen </td></tr><tr><td align="right">  41 </td><td align="left">  Server-Hostname </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  Der Name des DHCP-Servers.  Normalerweise nicht √ºbertragen </td></tr><tr><td align="right">  105 </td><td align="left">  Name der Startdatei </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  Der Dateiname auf dem Server, der von plattenlosen Stationen w√§hrend des Startvorgangs verwendet wird </td></tr><tr><td align="right">  235 </td><td align="left">  Magischer Keks </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Die "magische" Zahl, mit der inkl.  Sie k√∂nnen feststellen, dass dieses Paket zum DHCP-Protokoll geh√∂rt </td></tr><tr><td colspan="6" align="center">  DHCP-Optionen.  Kann in beliebiger Reihenfolge gehen </td></tr><tr><td align="right">  236 </td><td align="left">  Optionsnummer </td><td align="right">  53 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option 53, die den Typ des DHCP 2-Pakets angibt - DHCPOFFER </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  2 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option mit DHCP-Client-Netzwerkmaske </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  255.255.224.0 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  3 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option mit Standard-Gateway f√ºr DHCP-Clients </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  172.16.12.1 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  6 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option, die dem DNS-Client DHCP anbietet </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  8.8.8.8 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  51 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Die Lebensdauer der ausgegebenen Netzwerkparameter in Sekunden. Danach muss der DHCP-Client sie erneut anfordern </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  86400 </td><td align="center">  Dez. </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  82 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option 82 wiederholt, was in DHCPDISCOVER enthalten war </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  18 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dez. </td><td align="right">  18 </td></tr><tr><td align="left"></td><td align="left">  Ende des Pakets </td><td align="right">  255 </td><td align="center">  Dez. </td><td align="right">  1 </td><td align="left">  255 symbolisiert das Ende des Pakets </td></tr></tbody></table><br></div></div><br><h3>  DHCPREQUEST </h3><br>  Nachdem der Client DHCPOFFER empfangen hat, bildet er ein Paket mit einer Anforderung f√ºr Netzwerkparameter nicht an alle DHCP-Server im Netzwerk, sondern nur an einen bestimmten, dessen DHCPOFFER-Vorschlag ihm am besten gefallen hat.  Die Kriterien f√ºr "Gef√§llt mir" k√∂nnen unterschiedlich sein und h√§ngen von der Implementierung des DHCP-Clients ab.  Der Empf√§nger der Anforderung wird anhand der MAC-Adresse des DHCP-Servers angegeben.  Au√üerdem kann das DHCPREQUEST-Paket vom Client gesendet werden, ohne zuvor DHCPDISCOVER zu bilden, wenn die IP-Adresse des Servers zuvor empfangen wurde. <br><br><div class="spoiler">  <b class="spoiler_title">DHCPREQUEST-Paketstrukturtabelle</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Paketposition </td><td align="left">  Name des Wertes (allgemein) </td><td align="right">  Beispiel </td><td align="center">  Einreichung </td><td align="center">  Byte </td><td align="left">  Erkl√§rung </td></tr><tr><td align="right">  1 </td><td align="left">  Startanforderung </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Nachricht.  1 - Anfrage von Client zu Server, 2 - Antwort von Server zu Client </td></tr><tr><td align="right">  2 </td><td align="left">  Hardwaretyp </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Hardwareadresse in diesem Protokoll 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware passt L√§nge </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  MAC-Adressl√§nge des Ger√§ts </td></tr><tr><td align="right">  4 </td><td align="left">  Hopfen </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Anzahl der Zwischenstrecken </td></tr><tr><td align="right">  5 </td><td align="left">  Transaktions-ID </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Eindeutige Transaktionskennung.  Wird vom Client zu Beginn des Anforderungsvorgangs generiert </td></tr><tr><td align="right">  7 </td><td align="left">  Zweite verstrichen </td><td align="right">  0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Zeit in Sekunden seit Beginn des Prozesses zum Abrufen der Adresse </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp-Flags </td><td align="right">  8000 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Einige Flags, die als Hinweis auf Protokollparameter gesetzt werden k√∂nnen.  In diesem Fall "Broadcast" </td></tr><tr><td align="right">  11 </td><td align="left">  Client-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Client-IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  15 </td><td align="left">  Ihre Client-IP-Adresse </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Vom Server vorgeschlagene IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  19 </td><td align="left">  N√§chste Server-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Server-IP-Adresse (falls bekannt) </td></tr><tr><td align="right">  23 </td><td align="left">  IP-Adresse des Relay-Agenten </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  IP-Adresse des Relay-Agenten (z. B. ein Switch) </td></tr><tr><td align="right">  27 </td><td align="left">  Client-MAC-Adresse </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  MAC-Adresse des Absenders des Pakets (Client) </td></tr><tr><td align="right">  31 </td><td align="left">  Auff√ºllen der Client-Hardware-Adresse </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Reservierter Platz.  Normalerweise Nullen </td></tr><tr><td align="right">  41 </td><td align="left">  Server-Hostname </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  Der Name des DHCP-Servers.  Normalerweise nicht √ºbertragen </td></tr><tr><td align="right">  105 </td><td align="left">  Name der Startdatei </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  Der Dateiname auf dem Server, der von plattenlosen Stationen w√§hrend des Startvorgangs verwendet wird </td></tr><tr><td align="right">  235 </td><td align="left">  Magischer Keks </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Die "magische" Zahl, mit der inkl.  Sie k√∂nnen feststellen, dass dieses Paket zum DHCP-Protokoll geh√∂rt </td></tr><tr><td colspan="6" align="center">  DHCP-Optionen.  Kann in beliebiger Reihenfolge gehen </td></tr><tr><td align="right">  236 </td><td align="left">  Optionsnummer </td><td align="right">  53 </td><td align="center">  Dez. </td><td align="right">  3 </td><td rowspan="3" align="left">  Option 53, die den Typ des DHCP 3-Pakets angibt - DHCPREQUEST </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  3 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  61 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Client-ID: 01 (f√ºr Ehernet) + MAC-Adresse des Clients </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  7 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01: 2c: ab: 25: ff: 72: a6 </td><td align="center">  Hex </td><td align="right">  7 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  60 </td><td align="center">  Dez. </td><td align="left"></td><td rowspan="3" align="left">  "Herstellerklassen-ID."  In meinem Fall wird die Version des DHCP-Clients gemeldet.  Vielleicht geben andere Ger√§te etwas anderes zur√ºck.  Windows meldet beispielsweise MSFT 5.0 </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  11 </td><td align="center">  Dez. </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  udhcp 0.9.8 </td><td align="center">  String </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  55 </td><td align="center"></td><td align="right">  1 </td><td rowspan="3" align="left">  Die vom Client angeforderten Netzwerkparameter.  Die Zusammensetzung kann unterschiedlich sein <br><br>  01 - Netzmaske <br>  03 - Gateway <br>  06 - DNS <br>  oc - Hostname <br>  0f - Netzwerkdom√§nenname <br>  1c - Adresse der Broadcast-Anfrage (Broadcast) <br>  42 - TFTP-Servername <br>  79 - Klassenlose statische Route </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  8 </td><td align="center"></td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01: 03: 06: 0c: 0f: 1c: 42: 79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  82 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option 82 wiederholt, was in DHCPDISCOVER enthalten war </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  18 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dez. </td><td align="right">  18 </td></tr><tr><td align="left"></td><td align="left">  Ende des Pakets </td><td align="right">  255 </td><td align="center">  Dez. </td><td align="right">  1 </td><td align="left">  255 symbolisiert das Ende des Pakets </td></tr></tbody></table><br></div></div><br><h3>  DHCPACK </h3><br>  Als Best√§tigung f√ºr die Tatsache, dass "Ja, es ist Ihre IP-Adresse und ich werde sie niemand anderem geben" vom DHCP-Server, gibt es ein Paket im DHCPACK-Format vom Server zum Client.  Dies entspricht den √ºbrigen gesendeten Paketen.  Obwohl ich im folgenden Code des in Python implementierten DHCP-Servers f√ºr alle F√§lle jede Broadcast-Anforderung dupliziere, indem ich ein Paket an eine bestimmte Client-IP sende, sofern dies bereits bekannt ist.  Dar√ºber hinaus ist es dem DHCP-Server √ºberhaupt egal, ob das DHCPACK-Paket den Client erreicht hat.  Wenn der Client kein DHCPACK empf√§ngt, wiederholt er nach einer Weile einfach DHCPREQUEST <br><br><div class="spoiler">  <b class="spoiler_title">DHCPACK-Paketstrukturtabelle</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Paketposition </td><td align="left">  Name des Wertes (allgemein) </td><td align="right">  Beispiel </td><td align="center">  Einreichung </td><td align="center">  Byte </td><td align="left">  Erkl√§rung </td></tr><tr><td align="right">  1 </td><td align="left">  Startanforderung </td><td align="right">  2 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Nachricht.  1 - Anfrage von Client zu Server, 2 - Antwort von Server zu Client </td></tr><tr><td align="right">  2 </td><td align="left">  Hardwaretyp </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Art der Hardwareadresse in diesem Protokoll 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Hardware passt L√§nge </td><td align="right">  6 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  MAC-Adressl√§nge des Ger√§ts </td></tr><tr><td align="right">  4 </td><td align="left">  Hopfen </td><td align="right">  1 </td><td align="center">  Hex </td><td align="right">  1 </td><td align="left">  Anzahl der Zwischenstrecken </td></tr><tr><td align="right">  5 </td><td align="left">  Transaktions-ID </td><td align="right">  23: cf: de: 1d </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Eindeutige Transaktionskennung.  Wird vom Client zu Beginn des Anforderungsvorgangs generiert </td></tr><tr><td align="right">  7 </td><td align="left">  Zweite verstrichen </td><td align="right">  0 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Zeit in Sekunden seit Beginn des Prozesses zum Abrufen der Adresse </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp-Flags </td><td align="right">  8000 </td><td align="center">  Hex </td><td align="right">  2 </td><td align="left">  Einige Flags, die als Hinweis auf Protokollparameter gesetzt werden k√∂nnen.  In diesem Fall "Broadcast" </td></tr><tr><td align="right">  11 </td><td align="left">  Client-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Client-IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  15 </td><td align="left">  Ihre Client-IP-Adresse </td><td align="right">  172.16.134.61 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Vom Server vorgeschlagene IP-Adresse (falls vorhanden) </td></tr><tr><td align="right">  19 </td><td align="left">  N√§chste Server-IP-Adresse </td><td align="right">  0.0.0.0 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  Server-IP-Adresse (falls bekannt) </td></tr><tr><td align="right">  23 </td><td align="left">  IP-Adresse des Relay-Agenten </td><td align="right">  172.16.114.41 </td><td align="center">  String </td><td align="right">  4 </td><td align="left">  IP-Adresse des Relay-Agenten (z. B. ein Switch) </td></tr><tr><td align="right">  27 </td><td align="left">  Client-MAC-Adresse </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Hex </td><td align="right">  6 </td><td align="left">  MAC-Adresse des Absenders des Pakets (Client) </td></tr><tr><td align="right">  31 </td><td align="left">  Auff√ºllen der Client-Hardware-Adresse </td><td align="right"></td><td align="center">  Hex </td><td align="right">  10 </td><td align="left">  Reservierter Platz.  Normalerweise Nullen </td></tr><tr><td align="right">  41 </td><td align="left">  Server-Hostname </td><td align="right"></td><td align="center">  String </td><td align="right">  64 </td><td align="left">  Der Name des DHCP-Servers.  Normalerweise nicht √ºbertragen </td></tr><tr><td align="right">  105 </td><td align="left">  Name der Startdatei </td><td align="right"></td><td align="center">  String </td><td align="right">  128 </td><td align="left">  Der Dateiname auf dem Server, der von plattenlosen Stationen w√§hrend des Startvorgangs verwendet wird </td></tr><tr><td align="right">  235 </td><td align="left">  Magischer Keks </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Hex </td><td align="right">  4 </td><td align="left">  Die "magische" Zahl, mit der inkl.  Sie k√∂nnen feststellen, dass dieses Paket zum DHCP-Protokoll geh√∂rt </td></tr><tr><td colspan="6" align="center">  DHCP-Optionen.  Kann in beliebiger Reihenfolge gehen </td></tr><tr><td align="right">  236 </td><td align="left">  Optionsnummer </td><td align="right">  53 </td><td align="center">  Dez. </td><td align="right">  3 </td><td rowspan="3" align="left">  Option 53 zur Angabe des DHCP-Pakettyps 5 - DHCPACK </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  5 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  1 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option mit DHCP-Client-Netzwerkmaske </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  255.255.224.0 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  3 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option mit Standard-Gateway f√ºr DHCP-Clients </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  172.16.12.1 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  6 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option, die dem DNS-Client DHCP anbietet </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  8.8.8.8 </td><td align="center">  String </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  51 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Die Lebensdauer der ausgegebenen Netzwerkparameter in Sekunden. Danach muss der DHCP-Client sie erneut anfordern </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  4 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  86400 </td><td align="center">  Dez. </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left">  Optionsnummer </td><td align="right">  82 </td><td align="center">  Dez. </td><td align="right">  1 </td><td rowspan="3" align="left">  Option 82 wiederholt, was in DHCPDISCOVER enthalten war </td></tr><tr><td align="left"></td><td align="left">  Optionsl√§nge </td><td align="right">  18 </td><td align="center">  Dez. </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Optionswert </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dez. </td><td align="right">  18 </td></tr><tr><td align="left"></td><td align="left">  Ende des Pakets </td><td align="right">  255 </td><td align="center">  Dez. </td><td align="right">  1 </td><td align="left">  255 symbolisiert das Ende des Pakets </td></tr></tbody></table><br></div></div><br><br><h1>  Installation </h1><br>  Die Installation besteht tats√§chlich aus der Installation der f√ºr den Job erforderlichen Python-Module.  Es wird davon ausgegangen, dass MySQL bereits installiert und konfiguriert ist. <br><br><h2>  Freebsd </h2><br><pre>  pkg installiere python3
 python3 -m surepip
 pip3 installiert mysql-connector </pre><br><h2>  Ubuntu </h2><br><pre>  sudo apt-get install python3
 sudo apt-get install pip3
 sudo pip3 installiere mysql-connector </pre><br>  Wir erstellen die MySQL-Datenbank, f√ºllen den Speicherauszug pydhcp.sql aus und konfigurieren die Konfigurationsdatei. <br><br><h1>  Konfiguration </h1><br>  Alle Servereinstellungen sind im XML-Dateiformat.  Referenzdatei: <br><br><pre>  &lt;? xml version = "1.0"?&gt;
 &lt;config&gt;
     &lt;dhcpserver&gt;
	 &lt;host&gt; 0.0.0.0 &lt;/ host&gt;
         &lt;broadcast&gt; 255.255.255.255 &lt;/ broadcast&gt;
         &lt;DHCPServer&gt; 192.168.0.71 &lt;/ DHCPServer&gt;
	 &lt;LeaseTime&gt; 8600 &lt;/ LeaseTime&gt;
	 &lt;ThreadLimit&gt; 1 &lt;/ ThreadLimit&gt;
         &lt;defaultMask&gt; 255.255.255.0 &lt;/ defaultMask&gt;
         &lt;defaultRouter&gt; 192.168.0.1 &lt;/ defaultRouter&gt;
         &lt;defaultDNS&gt; 8.8.8.8 &lt;/ defaultDNS&gt;
     &lt;/ dhcpserver&gt;
     &lt;mysql&gt;
         &lt;host&gt; localhost &lt;/ host&gt;
	 &lt;Benutzername&gt; Test &lt;/ Benutzername&gt;
	 &lt;Kennwort&gt; Test &lt;/ Kennwort&gt;
	 &lt;Basename&gt; pydhcp &lt;/ Basisname&gt;
     &lt;/ myql&gt;
     &lt;Optionen&gt;
        &lt;option&gt; option_82_hex: sw_port1: 20:22 &lt;/ option&gt;       
        &lt;option&gt; option_82_hex: sw_port2: 16:18 &lt;/ option&gt;       
        &lt;option&gt; option_82_hex: sw_mac: 26: 40 &lt;/ option&gt;
     &lt;/ options&gt;    
     &lt;Anfrage&gt;
         &lt;Angebotsanzahl&gt; 3 &lt;/ Angebotsanzahl&gt;
	 &lt;offer_1&gt; W√§hlen Sie IP, Maske, Router und DNS von Benutzern aus, bei denen Upper (Mac) = Upper ('{option_82_AgentRemoteId_hex}') und Upper (Port) = Upper ('{Option_82_AgentCircuitId_port_hex}') &lt;/offer_1&gt;
         &lt;offer_2&gt; W√§hlen Sie IP, Maske, Router und DNS von Benutzern aus, bei denen Upper (Mac) = Upper ('{sw_mac}') und Upper (Port) = Upper ('{sw_port2}') &lt;/offer_2&gt;
         &lt;offer_3&gt; W√§hlen Sie IP, Maske, Router und DNS von Benutzern aus, bei denen Upper (Mac) = Upper ('{ClientMacAddress}') &lt;/offer_3&gt; ist
	 &lt;history_sql&gt; Werte in den Verlauf (id, dt, mac, ip, comment) einf√ºgen (null, now (), '{ClientMacAddress}', '{RequestedIpAddress}', 'DHCPACK / INFORM') &lt;/ history_sql&gt;
     &lt;/ query&gt;
 &lt;/ config&gt; </pre><br>  Jetzt detaillierter zu Tags: <br><br>  Der Abschnitt dhcpserver beschreibt die Grundeinstellungen zum Starten des Servers, n√§mlich: <br><ul><li>  Host - Welche IP-Adresse √ºberwacht der Server an Port 67? </li><li>  Broadcast - Welche IP ist eine Broadcast f√ºr DHCPOFFER und DHCPACK? </li><li>  DHCPServer - Wie lautet die IP-Adresse des DHCP-Servers? </li><li>  LeaseTime Lease-Zeit der ausgegebenen IP-Adresse </li><li>  ThreadLimit - wie viele Threads gleichzeitig ausgef√ºhrt werden, um eingehende UDP-Pakete auf Port 67 zu verarbeiten. Es wird davon ausgegangen, dass dies bei hoch geladenen Projekten hilfreich ist;) </li><li>  defaultMask, defaultRouter, defaultDNS - Was wird dem Abonnenten standardm√§√üig angeboten, wenn IP in der Datenbank gefunden wird, aber keine zus√§tzlichen Parameter f√ºr ihn angegeben sind </li></ul><br>  MySQL-Abschnitt: <br><br>  Host, Benutzername, Passwort, Basisname - alles spricht f√ºr sich.  Auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub ver√∂ffentlichte Beispieldatenbankstruktur</a> <br><br>  Abfrageabschnitt: In diesem Abschnitt werden die Anforderungen f√ºr ANGEBOT / ACK beschrieben: <br><br><ul><li>  Offer_Count - Die Anzahl der Zeilen mit Anforderungen, die ein Ergebnis der Form IP, Maske, Router, DNS zur√ºckgeben </li><li>  Offer_n ist die Abfragezeichenfolge.  Wenn die R√ºcksendung leer ist, wird die folgende Angebotsanforderung ausgef√ºhrt </li><li>  history_sql - Schreibanforderung zum Beispiel an den "Autorisierungsverlauf" durch den Abonnenten </li></ul><br>  Alle Variablen aus dem Optionsbereich oder Optionen aus dem DHCP-Protokoll k√∂nnen an Anforderungen teilnehmen. <br><br>  Abschnittsoptionen.  Hier ist es schon interessanter.  Hier k√∂nnen wir Variablen erstellen, die wir sp√§ter im Abfrageabschnitt verwenden k√∂nnen. <br><br>  Zum Beispiel: <br><br><pre><code class="plaintext hljs">option_82_hex:sw_port1:20:22</code> </pre> <br>  Diese Zeile ist der Befehl, die gesamte Zeile, die in der DHCP-Anforderung von Option 82 eingegangen ist, im Hex-Format im Bereich von 20 bis einschlie√ülich 22 Byte zu √ºbernehmen und in die neue Variable sw_port1 (den Switch-Port, von dem die Anforderung stammt) einzuf√ºgen. <br><br><pre> <code class="plaintext hljs">option_82_hex:sw_mac:26:40</code> </pre> <br>  Definieren Sie die Variable sw_mac und nehmen Sie hex aus dem Bereich 26:40 <br><br>  Sie k√∂nnen alle m√∂glichen Optionen anzeigen, die in Abfragen verwendet werden k√∂nnen, indem Sie den Server mit der Option -d starten.  Wir werden so etwas wie dieses Protokoll sehen: <br><br><pre>  - Das DHCPINFORM-Paket kam an Port 67 von 0025224ad764, b '\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a' ('172.30.114.25', 68).
 {'ClientMacAddress': '0025224ad764',
  'ClientMacAddressByte': b '\ x00% "J \ xd7d',
  'HType': 'Ethernet',
  'Hostname': b '\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a',
  'ReqListDNS': Richtig,
  'ReqListDomainName': Richtig,
  'ReqListPerfowmRouterDiscover': True,
  'ReqListRouter': Richtig,
  'ReqListStaticRoute': Richtig,
  'ReqListSubnetMask': Richtig,
  'ReqListVendorSpecInfo': 43,
  'RequestedIpAddress': '0.0.0.0',
  'Anbieter': b'MSFT 5.0 ',
  'chaddr': '0025224ad764',
  'ciaddr': '172.30.128.13',
  'flags': b '\ x00 \ x00',
  'giaddr': '172.30.114.25',
  'gpoz': 308,
  'hlen': 6,
  'Hopfen': 1,
  'htype': 'MAC',
  'magic_cookie': b'c \ x82Sc ',
  'op': 'DHCPINFORM',
  'Option12': 12,
  'option53': 53,
  'option55': 55,
  'option60': 60,
  'option61': 61,
  'option82': 82,
  'option_82_byte': b '\ x12 \ x01 \ x06 \ x00 \ x04 \ x00 \ x01 \ x00 \ x06 \ x02 \ x08 \ x00'
                    b '\ x06 \ x00 \ x1eX \ x9e \ xb2 \ xad',
  'option_82_hex': '12010600040001000602080006001e589eb2ad',
  'option_82_len': 18,
  'option_82_str': "b '\\ x12 \\ x01 \\ x06 \\ x00 \\ x04 \\ x00 \\ x01 \\ x00 \\ x06 \\ x02 \\ x08 \\ x00 \\ x06 \\ x00 \ \ x1eX \\ x9e \\ xb2 \\ xad '",
  'Ergebnis': Falsch,
  'secs': 768,
  'siaddr': '0.0.0.0',
  'sw_mac': '001e589eb2ad',
  'sw_port1': '06',
  'xidbyte': b '&lt;\ x89} \ x8c',
  'xidhex': '3c897d8c',
  'yiaddr': '0.0.0.0'} </pre><br>  Dementsprechend k√∂nnen wir jede Variable in {} einschlie√üen und sie wird in der SQL-Abfrage verwendet. <br><br>  Lassen Sie uns f√ºr den Verlauf erfassen, dass der Client die IP-Adresse erhalten hat: <br><br><img src="https://habrastorage.org/webt/mc/le/bu/mclebuj5du2u4mjtlaf9-a2ibo0.png"><br><br><img src="https://habrastorage.org/webt/eo/1q/lt/eo1qltnt_1ewtf0uwkenwywme3m.png"><br><br><h1>  Serverstart </h1><br>  ./pydhcpdb.py -d -c config.xml <br><br>  - d Ausgabemodus an die DEBUG-Konsole <br>  - c Konfigurationsdatei &lt;Dateiname&gt; <br><br><h1>  Nachbesprechung </h1><br>  Und jetzt mehr zur Implementierung des Servers in Python.  Das ist ein Schmerz.  Python wurde im laufenden Betrieb untersucht.  Viele Momente entstehen im Stil von: "Wow, ich habe irgendwie getan, was funktioniert."  √úberhaupt nicht optimiert und in dieser Form haupts√§chlich aufgrund der geringen Erfahrung mit der Entwicklung in Python belassen.  Ich werde auf die interessantesten Momente der Serverimplementierung im "Code" eingehen. <br><br><h2>  Parser f√ºr XML-Konfigurationsdateien </h2><br>  Das Standard-Python-Modul xml.dom wird verwendet.  Es scheint einfach zu sein, aber w√§hrend der Implementierung gab es einen sp√ºrbaren Mangel an vern√ºnftiger Dokumentation und Beispielen im Netzwerk, das dieses Modul verwendet. <br><br><pre>  tree = minidom.parse (gconfig ["config_file"])
     mconfig = tree.getElementsByTagName ("mysql")
     f√ºr elem in mconfig:        
         gconfig ["mysql_host"] = elem.getElementsByTagName ("host") [0] .firstChild.data      
         gconfig ["mysql_username"] = elem.getElementsByTagName ("username") [0] .firstChild.data      
         gconfig ["mysql_password"] = elem.getElementsByTagName ("password") [0] .firstChild.data      
         gconfig ["mysql_basename"] = elem.getElementsByTagName ("basename") [0] .firstChild.data      
     dconfig = tree.getElementsByTagName ("dhcpserver")
     f√ºr elem in dconfig:        
         gconfig ["Broadcast"] = elem.getElementsByTagName ("Broadcast") [0] .firstChild.data      
         gconfig ["dhcp_host"] = elem.getElementsByTagName ("host") [0] .firstChild.data      
         gconfig ["dhcp_LeaseTime"] = elem.getElementsByTagName ("LeaseTime") [0] .firstChild.data      
         gconfig ["dhcp_ThreadLimit"] = int (elem.getElementsByTagName ("ThreadLimit") [0] .firstChild.data)              
         gconfig ["dhcp_Server"] = elem.getElementsByTagName ("DHCPServer") [0] .firstChild.data              
         gconfig ["dhcp_defaultMask"] = elem.getElementsByTagName ("defaultMask") [0] .firstChild.data              
         gconfig ["dhcp_defaultRouter"] = elem.getElementsByTagName ("defaultRouter") [0] .firstChild.data              
         gconfig ["dhcp_defaultDNS"] = elem.getElementsByTagName ("defaultDNS") [0] .firstChild.data              
     qconfig = tree.getElementsByTagName ("Abfrage")
     f√ºr elem in qconfig:  
         gconfig ["Offer_Count"] = elem.getElementsByTagName ("Offer_Count") [0] .firstChild.data                          
         f√ºr num in range (int (gconfig ["quote_count"])):
             gconfig ["Angebot _" + str (num + 1)] = elem.getElementsByTagName ("Angebot _" + str (num + 1)) [0] .firstChild.data      
         gconfig ["history_sql"] = elem.getElementsByTagName ("history_sql") [0] .firstChild.data                          
     options = tree.getElementsByTagName ("options")       
     f√ºr elem in options:          
         node = elem.getElementsByTagName ("Option")
         f√ºr Optionen im Knoten:
             optionsMod.append (options.firstChild.data) </pre><br><h2>  Multithreading </h2><br>  Seltsamerweise ist Multithreading in Python sehr klar und einfach implementiert. <br><br><pre>  def PacketWork (Daten, Adr): 
 ...
 # Implementierung der Analyse des empfangenen Pakets und der Antwort darauf
 ...<font></font>
<font></font>
<font></font>
 w√§hrend wahr:
     data, addr = udp_socket.recvfrom (1024) # auf UDP-Paket warten
     thread = threading.Thread (target = PacketWork, args = (data, addr,)). start () # wie es kam - f√ºhren Sie die zuvor im Hintergrund definierte PacketWork-Funktion mit Parametern aus
     w√§hrend threading.active_count ()&gt; gconfig ["dhcp_ThreadLimit"]:
        time.sleep (1) # Wenn die Anzahl der bereits ausgef√ºhrten Threads gr√∂√üer ist als in den Einstellungen, warten Sie, bis sie kleiner werden </pre><br><br><h2>  DHCP-Paket empfangen / senden </h2><br>  Um UDP-Pakete abzufangen, die √ºber die Netzwerkkarte eingehen, m√ºssen Sie den Socket "erh√∂hen": <br><pre>  udp_socket = socket.socket (socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP)
 udp_socket.bind ((gconfig ["dhcp_host"], 67)) </pre><br>  wo die Flaggen sind: <br><br><ul><li>  AF_INET - bedeutet, dass das Adressformat IP: port ist.  Vielleicht AF_UNIX - wobei die Adresse durch den Dateinamen angegeben wird. </li><li>  SOCK_DGRAM - bedeutet, dass wir kein "Rohpaket" akzeptieren, sondern bereits eine Firewall durchlaufen und das Paket teilweise abgeschnitten haben.  Das hei√üt,  Wir erhalten nur das UDP-Paket ohne die "physische" Komponente des UDP-Paket-Wrappers.  Wenn Sie das SOCK_RAW-Flag verwenden, m√ºssen Sie auch diesen "Wrapper" analysieren. </li></ul><br>  Das Senden eines Pakets kann wie eine Sendung sein: <br><br><pre>  udp_socket.setsockopt (socket.SOL_SOCKET, socket.SO_BROADCAST, 1) # Schalten Sie den Socket in den Broadcast-Modus
                     rz = udp_socket.sendto (Paketpaket, (gconfig ["Broadcast"], 68)) </pre><br>  und an die Adresse "Woher kam das Paket": <br><pre>  udp_socket.setsockopt (socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # Schalten Sie den Socket in den Modus "Viele Listener"
                         rz = udp_socket.sendto (Paketpaket, Adr) </pre><br>  wobei SOL_SOCKET "Protokollebene" zum Einstellen von Optionen bedeutet, <br><br>  Die SO_BROADCAST-Option ist das Broadcast-Helmpaket <br><br>  Die Option SO_REUSEADDR schaltet den Socket in den Multi-Listener-Modus.  Theoretisch ist dies in diesem Fall nicht erforderlich, aber auf einem der von mir getesteten FreeBSD-Server funktionierte der Code ohne diese Option nicht. <br><br><h2>  Analyse von DHCP-Paketen </h2><br>  Hier hat mir Python sehr gut gefallen.  Es stellt sich heraus, dass Sie mit dem Bytecode ganz einfach umgehen k√∂nnen.  Erm√∂glichen, dass es sehr einfach ist, in Dezimalwerte, Zeichenfolgen und Hexadezimalwerte zu √ºbersetzen - d. H.  Was wir eigentlich brauchen, um die Struktur des Pakets zu verstehen.  So k√∂nnen Sie beispielsweise eine Reihe von Bytes in HEX und nur Bytes abrufen: <br><br><pre>  res ["xidhex"] = Daten [4: 8] .hex ()
     res ["xidbyte"] = Daten [4: 8] </pre><br>  , Bytes in eine Struktur packen: <br><br><pre>  res ["flags"] = pack ('BB', Daten [10], Daten [11]) </pre><br>  IP aus der Struktur abrufen: <br><br><pre>  res ["ciaddr"] = socket.inet_ntoa (pack ('BBBB', Daten [12], Daten [13], Daten [14], Daten [15])); </pre><br><br>  Umgekehrt: <br><br><pre>  res = res + socket.inet_pton (socket.AF_INET, gconfig ["dhcp_Server"]) </pre><br>  Das ist alles;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445338/">https://habr.com/ru/post/de445338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445326/index.html">R√ºcksichtslose Automatisierung. Director's Cut</a></li>
<li><a href="../de445328/index.html">Kinderrobotik neu denken</a></li>
<li><a href="../de445330/index.html">Kryptographie in Java. Signaturklasse</a></li>
<li><a href="../de445334/index.html">Wir haben DevOps. Lassen Sie uns alle Tester feuern</a></li>
<li><a href="../de445336/index.html">FlexiRemap¬Æ vs RAID</a></li>
<li><a href="../de445340/index.html">Erh√∂hen Sie die Netzwerksicherheit mithilfe eines Cloud-Analysators</a></li>
<li><a href="../de445344/index.html">OpenVox Unified Communications Platform</a></li>
<li><a href="../de445346/index.html">Wie schreibe ich eine schlechte API</a></li>
<li><a href="../de445348/index.html">SNA Hackathon 2019: Architektur vereinfachen - Funktionen vereinfachen</a></li>
<li><a href="../de445350/index.html">Sonata - SIP-Bereitstellungsserver</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>