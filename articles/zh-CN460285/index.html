<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ãŠ™ï¸ ğŸ˜· ğŸ‘¨ğŸ¾â€ğŸ« æˆ‘ä»¬æ­£åœ¨å‡†å¤‡PHPã€‚ foreachï¼Œarray_walkå’Œå…¶ä»–ä¸€äº›ä»¤äººææƒ§çš„å•è¯çš„æ—¶é—´å¦‚ä½• ğŸ…ğŸ» ğŸ± ğŸ¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="é‚£å¤©æ™šä¸Šï¼Œæ²¡æœ‰äº‹å¯åšã€‚ ç°åœ¨æ˜¯æ—¶å€™åˆ†æä¸€ä¸‹PHPä¸­æ•°ç»„æ’åºçš„ä¸€äº›å†…éƒ¨æ–¹æ³•ä¹‹é—´çš„å·®å¼‚äº†ã€‚ 

 æ¥è‡ªmasteråˆ†æ”¯çš„æºï¼ˆç°åœ¨æ˜¯7.4ï¼Œä¸­é—´æ˜¯8ï¼‰ 
 æ¥è‡ªPHP 7.3.0çš„æ“ä½œç ç”Ÿæˆå™¨ã€‚ 
 åœ¨7.3.6ä¸Šè¿›è¡Œæµ‹é‡ã€‚ 

 å¯¹äºä¹¦å‘†å­çš„å…è´£å£°æ˜ï¼šæåˆ°å‡ ä¸ªçº³ç§’å’Œå¤„ç†å™¨å‘¨æœŸï¼Œè¿™å°±æ˜¯ä¸€ä¸ªåä¸ºâ€œ hype...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æˆ‘ä»¬æ­£åœ¨å‡†å¤‡PHPã€‚ foreachï¼Œarray_walkå’Œå…¶ä»–ä¸€äº›ä»¤äººææƒ§çš„å•è¯çš„æ—¶é—´å¦‚ä½•</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/460285/"><img src="https://habrastorage.org/webt/eu/xq/ks/euxqksyqzr1n_r62nqjvxr0nzsk.png"><br><br> é‚£å¤©æ™šä¸Šï¼Œæ²¡æœ‰äº‹å¯åšã€‚ ç°åœ¨æ˜¯æ—¶å€™åˆ†æä¸€ä¸‹PHPä¸­æ•°ç»„æ’åºçš„ä¸€äº›å†…éƒ¨æ–¹æ³•ä¹‹é—´çš„å·®å¼‚äº†ã€‚ <br><br> æ¥è‡ªmasteråˆ†æ”¯çš„æºï¼ˆç°åœ¨æ˜¯7.4ï¼Œä¸­é—´æ˜¯8ï¼‰ <br> æ¥è‡ªPHP 7.3.0çš„æ“ä½œç ç”Ÿæˆå™¨ã€‚ <br> åœ¨7.3.6ä¸Šè¿›è¡Œæµ‹é‡ã€‚ <br><br> å¯¹äºä¹¦å‘†å­çš„å…è´£å£°æ˜ï¼šæåˆ°å‡ ä¸ªçº³ç§’å’Œå¤„ç†å™¨å‘¨æœŸï¼Œè¿™å°±æ˜¯ä¸€ä¸ªåä¸ºâ€œ hyperboleâ€çš„äº‰è®ºæ€§æŠ€å·§ã€‚ <br><br> å®é™…ä¸Šï¼Œä¹Ÿè®¸æœ‰å‡ åæˆ–å‡ ç™¾ä¸ªçº³ç§’å’Œæ•°åƒä¸ªåº¦é‡ï¼Œä½†æ˜¯å®ƒä»ç„¶å¾ˆå°ï¼Œä»¥è‡³äºéœ€è¦ä¿å­˜å®ƒä»¬è¡¨æ˜ä»£ç ä¸­æœ‰é”™è¯¯ã€‚ <br><a name="habracut"></a><br><h2> ç¼–è¯‘é˜¶æ®µ </h2><br>  <b>for</b> ï¼Œ <b>foreach</b> ï¼Œ <b>do</b>å’Œ<b>while</b>æ˜¯è¯¥è¯­è¨€çš„å…³é”®å­—ï¼Œè€Œ<b>array_ *</b>å‡½æ•°æ˜¯æ ‡å‡†åº“çš„å‡½æ•°ã€‚ å› æ­¤ï¼Œé¦–å…ˆï¼Œceteris paribusè§£æå™¨å°†æ‰§è¡Œå‡ çº³ç§’çš„é€Ÿåº¦ã€‚ <br><br><h3> è§£æå™¨ </h3><br> åœ¨<b>è¯­å¥</b>æ ‡è®°ä¹‹å‰ï¼Œæ‰€æœ‰è·¯å¾„å‡ç›¸åŒ <br><br><pre><code class="plaintext hljs">start -&gt; top_statement_list -&gt; top_statement -&gt; statement</code> </pre> <br> å¾ªç¯åœ¨<b>è¯­å¥</b>çº§åˆ«å®šä¹‰ï¼š <br><pre> <code class="plaintext hljs">-&gt;T_FOR '(' for_exprs ';' for_exprs ';' for_exprs ')' for_statement -&gt;T_FOREACH '(' expr T_AS foreach_variable ')' foreach_statement -&gt;T_FOREACH '(' expr T_AS foreach_variable T_DOUBLE_ARROW foreach_variable ')' foreach_statement -&gt;T_DO statement T_WHILE '(' expr ')' ';' -&gt;T_WHILE '(' expr ')' while_statement</code> </pre> <br>  <b>for_exprs</b>å’Œjust <b>expr</b>ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºï¼Œå¯¹äºç¬¬ä¸€ä¸ªï¼Œå…è®¸å†™å…¥å¤šä¸ª<b>expr</b> ï¼Œä»¥é€—å·åˆ†éš”ã€‚ <br><br>  <b>foreach_variable</b>æ˜¯ä¸€ç§æ„é€ ï¼Œé™¤äº†<b>å˜é‡ä¹‹å¤–</b> ï¼Œè¿˜ä½¿ç”¨<b>list</b>æˆ–<b>[]</b>è·Ÿè¸ªè§£å‹ç¼©ã€‚ <br><br>  <b>for_statement</b> ï¼Œ <b>foreach_statement</b> ï¼Œ <b>while_statement</b>ä¸æ ‡å‡†<b>è¯­å¥çš„</b>ä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬å¢åŠ äº†è§£ææ›¿ä»£è¯­æ³•çš„èƒ½åŠ›ï¼š <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($array <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $element): <span class="hljs-comment"><span class="hljs-comment">#do something endforeach;</span></span></code> </pre> <br> å‡½æ•°è°ƒç”¨è¢«æ›´æ·±åœ°åŸ‹è—ï¼š <br><br><pre> <code class="plaintext hljs">-&gt; expr -&gt; variable -&gt; callable_variable -&gt; function_call -&gt; name argument_list</code> </pre> <br>  <b>callable_variable</b> ï¼Œå—¯...å¥½ç¬‘ï¼Œä¸æ˜¯å—ï¼Ÿ  :) <br><br><h2> è®©æˆ‘ä»¬ç»§ç»­æ“ä½œç ã€‚ </h2><br> ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬ç®€å•åœ°å¯¹ç´¢å¼•æ•°ç»„è¿›è¡Œè¿­ä»£ï¼Œå¹¶æ‰“å°æ¯ä¸ªé”®å’Œå€¼ã€‚ æ˜¾ç„¶ï¼Œä¸ºè¿™æ ·çš„ä»»åŠ¡ä½¿ç”¨<b>for</b> ï¼Œ <b>while</b>å’Œ<b>do</b>æ˜¯æ²¡æœ‰é“ç†çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„ç›®æ ‡åªæ˜¯æ˜¾ç¤ºå†…éƒ¨è®¾å¤‡ã€‚ <br><br><h4> å‰è¨€ </h4><br><pre> <code class="php hljs">$arr = [<span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//        foreach($arr as $key =&gt; $value) echo $key.$value;</span></span></code> </pre> <br><pre> <code class="plaintext hljs">line #* EIO op fetch ext return operands --------------------------------------------------------------------------- 2 0 E &gt; ASSIGN !0, &lt;array&gt; 4 1 &gt; FE_RESET_R $4 !0, -&gt;7 2 &gt; &gt; FE_FETCH_R ~5 $4, !1, -&gt;7 3 &gt; ASSIGN !2, ~5 4 CONCAT ~7 !2, !1 5 ECHO ~7 6 &gt; JMP -&gt;2 7 &gt; FE_FREE $4 5 8 &gt; RETURN 1</code> </pre><br><h4> è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼š </h4><br>  <b>FE_RESET_R</b> ï¼šä¸ºæ•°ç»„<b>0</b>åˆ›å»ºä¸€ä¸ª<b>$ 4</b>è¿­ä»£å™¨ã€‚ æˆ–è€…ï¼Œå¦‚æœæ•°ç»„ä¸ºç©ºï¼Œåˆ™ç›´æ¥è½¬åˆ°æŒ‡ä»¤<b>7</b> ã€‚ <br>  <b>FE_FETCH_R</b> ï¼šæ‰§è¡Œè¿­ä»£æ­¥éª¤ï¼Œåœ¨<b>ã€œ5å¤„</b>æ£€ç´¢å½“å‰é”®ï¼Œåœ¨<b>ï¼1</b>å¤„å–å€¼ã€‚ æˆ–è€…ï¼Œå¦‚æœåˆ°è¾¾æ•°ç»„çš„æœ«å°¾ï¼Œåˆ™å®ƒå‰è¿›åˆ°æŒ‡ä»¤<b>7</b> ã€‚ <br> æŒ‡ä»¤<b>3-6</b>å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰è¶£ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªç»“è®ºï¼Œç„¶åè¿”å›<b>FE_FETCH_R</b> ã€‚ <br>  <b>FE_FREE</b> ï¼šé”€æ¯è¿­ä»£å™¨ã€‚ <br><br><h4> å¯¹äº... </h4><br><pre> <code class="php hljs">$length = count($arr); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $length; $i++) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $i.$arr[$i];</code> </pre> <br> è¿™å®é™…ä¸Šæ˜¯<b>ä¸€é˜µå­</b>çš„ç‰¹ä¾‹ <br><br><pre> <code class="php hljs">$i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($i &lt; $length) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $i.$arr[$i]; $i++; }</code> </pre> <br> è¿™å®é™…ä¸Šæ˜¯<b>if + goto</b>çš„ç‰¹ä¾‹ <br><br><pre> <code class="php hljs">$i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> check; body: <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $i.$arr[$i]; $i++; check: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($i &lt; $length) <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> body;</code> </pre> <br> è¿™ä¸‰ç§æƒ…å†µçš„æ“ä½œç å‡ ä¹ç›¸åŒã€‚ é™¤éä½¿ç”¨<b>if</b> ï¼Œ <b>å¦åˆ™JMPNZ</b>å°†ç”±äºè¿›å…¥<b>if</b>çš„ä¸»ä½“è€Œæ›´æ”¹ä¸ºä¸€å¯¹<b>JMPZ + JMP</b> ã€‚ <br> å¯¹äº<b>do</b>å¾ªç¯ï¼Œç”±äºå…¶éªŒè¯åçš„æ€§è´¨ï¼Œæ“ä½œç å°†ç•¥æœ‰ä¸åŒã€‚ <br><br><pre> <code class="plaintext hljs">line #* EIO op fetch ext return operands --------------------------------------------------------------------------- 3 0 E &gt; ASSIGN !0, &lt;array&gt; 5 1 COUNT ~4 !0 2 ASSIGN !1, ~4 6 3 ASSIGN !2, 0 4 &gt; JMP -&gt;10 5 &gt; FETCH_DIM_R ~7 !0, !2 6 CONCAT ~8 !2, ~7 7 ECHO ~8 8 POST_INC ~9 !2 9 FREE ~9 10 &gt; IS_SMALLER ~10 !2, !1 11 &gt; JMPNZ ~10, -&gt;5 12 &gt; &gt; RETURN 1</code> </pre> <br> ä¸å‡ºæ‰€æ–™ï¼Œè¿˜æœ‰æ›´å¤šçš„æ“ä½œç ã€‚ <br>  <b>0-2</b> ï¼šè®¡ç®—<b>$é•¿åº¦</b> ã€‚ <br>  <b>3ï¼š$ i = 0</b> <br>  <b>4ã€10ã€11</b> ï¼šå¯¹å‡ºå£çŠ¶å†µçš„åˆå§‹æ£€æŸ¥ï¼Œå®é™…ä¸Šæ˜¯å¯¹å¾ªç¯ä¸»ä½“çš„å‡ºå£æˆ–è¿‡æ¸¡çš„æ£€æŸ¥ã€‚ <br>  <b>5ï¼ˆFETCH_DIM_Rï¼‰ï¼š$ arr [$ i]</b> <br>  <b>6-7</b> ï¼šç»“è®º <br>  <b>8-9ï¼š$ i ++</b> ï¼ˆè¯·æ³¨æ„ï¼Œå³ä½¿ä¸éœ€è¦ï¼Œå¢é‡æ“ä½œç åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¼šè¿”å›ä¸€ä¸ªå€¼ã€‚å› æ­¤ï¼Œéœ€è¦é™„åŠ çš„<b>FREE</b>æŒ‡ä»¤æ¥æ¸…é™¤å®ƒï¼‰ã€‚ <br>  <b>10-11</b> ï¼šé€’å¢åæ£€æŸ¥é€€å‡ºæ¡ä»¶ã€‚ <br><br><h4> æˆ–è€…ä½ ä»ç„¶å¯ä»¥è¿­ä»£ </h4><br><pre> <code class="php hljs">$value = reset($arr); $key = key($arr); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>($key !== <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $key.$value; $value = next($arr); $key = key($arr); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">åºŠå•ï¼Œå› æ­¤æ‰°æµæ¿ä¸‹</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">line #* EIO op fetch ext return operands --------------------------------------------------------------------------- 3 0 E &gt; ASSIGN !0, &lt;array&gt; 5 1 INIT_FCALL 'reset' 2 SEND_REF !0 3 DO_ICALL $4 4 ASSIGN !1, $4 6 5 INIT_FCALL 'key' 6 SEND_VAR !0 7 DO_ICALL $6 8 ASSIGN !2, $6 7 9 &gt; JMP -&gt;20 8 10 &gt; CONCAT ~8 !2, !1 11 ECHO ~8 9 12 INIT_FCALL 'next' 13 SEND_REF !0 14 DO_ICALL $9 15 ASSIGN !1, $9 10 16 INIT_FCALL 'key' 17 SEND_VAR !0 18 DO_ICALL $11 19 ASSIGN !2, $11 7 20 &gt; IS_NOT_IDENTICAL ~13 !2, null 21 &gt; JMPNZ ~13, -&gt;10 11 22 &gt; &gt; RETURN 1</code> </pre> <br></div></div><br> æ­¤é€‰é¡¹å¾ˆå¥½ï¼Œå› ä¸ºå®ƒé€‚ç”¨äºä½¿ç”¨ä»»ä½•é”®è¿­ä»£æ•°ç»„ï¼Œè€Œä¸ä»…ä»…æ˜¯ä½¿ç”¨å•è°ƒé€’å¢çš„æ•´æ•°ã€‚ <br><br>  <b>reset</b> ï¼Œ <b>next</b>å’Œ<b>key</b>å‡½æ•°éå¸¸è½»å·§ï¼Œä½†æ˜¯è°ƒç”¨å®ƒä»¬ä»ç„¶æœ‰ä¸€äº›å¼€é”€ã€‚ è€Œä¸”ï¼Œæ­£å¦‚æˆ‘ä»¬ç¨åå°†çœ‹åˆ°çš„ï¼Œè¿™äº›æˆæœ¬å¾ˆé«˜ã€‚ <br><br> å°½ç®¡æ­¤æ–¹æ³•ä¸<b>foreach</b>çš„åŸç†éå¸¸ç›¸ä¼¼ï¼Œä½†å®ƒä»¬ä¹‹é—´æœ‰ä¸¤ä¸ªæ ¹æœ¬åŒºåˆ«ã€‚ <br><br>  1ï¼‰å°½ç®¡<b>reset</b> ï¼Œ <b>next</b>å’Œ<b>key</b> ï¼ˆä»¥åŠ<b>current</b> ï¼‰ç›´æ¥ä¸æ•°ç»„çš„å†…éƒ¨æŒ‡é’ˆä¸€èµ·å·¥ä½œï¼Œä½†æ˜¯<b>foreach</b>ä½¿ç”¨å…¶è‡ªå·±çš„è¿­ä»£å™¨ï¼Œå¹¶ä¸”ä¸ä¼šæ›´æ”¹å†…éƒ¨æŒ‡é’ˆçš„çŠ¶æ€ã€‚ <br><br> å³ <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($arr <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $v) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $v.<span class="hljs-string"><span class="hljs-string">' - '</span></span>.current($arr).PHP_EOL; <span class="hljs-comment"><span class="hljs-comment">//---------------- a - a b - a c - a</span></span></code> </pre> <br>  2ï¼‰å½“ä½¿ç”¨<b>foreach</b>æŒ‰å€¼è¿›è¡Œè¿­ä»£æ—¶ï¼Œæ— è®ºå¯¹å¾ªç¯å†…éƒ¨çš„æ•°ç»„è¿›è¡Œä»€ä¹ˆæ“ä½œï¼ŒåŸå§‹æ•°æ®é›†éƒ½ä¼šè¢«è¿­ä»£ <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($arr <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $v) { $arr = [<span class="hljs-string"><span class="hljs-string">'X'</span></span>,<span class="hljs-string"><span class="hljs-string">'Y'</span></span>,<span class="hljs-string"><span class="hljs-string">'Z'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $v.PHP_EOL; } var_dump($arr); <span class="hljs-comment"><span class="hljs-comment">//---------------- a b c array(3) { [0]=&gt; string(1) "X" [1]=&gt; string(1) "Y" [2]=&gt; string(1) "Z" }</span></span></code> </pre> <br> å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤RFCä¸­</a>é˜…è¯»åœ¨é“¾æ¥ä¸Šè¿›è¡Œè¿­ä»£æ—¶å°†å‘ç”Ÿçš„æƒ…å†µã€‚ é‚£é‡Œçš„ä¸€åˆ‡éƒ½ä¸æ˜¯é‚£ä¹ˆç®€å•ã€‚ <br><br><h4> å…·æœ‰åŒ¿ååŠŸèƒ½çš„<b>array_walk</b> </h4><br><pre> <code class="php hljs">array_walk($arr, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($value, $key)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $key.$value;});</code> </pre> <br> ç”±äºä½¿ç”¨äº†è‡ªå®šä¹‰å‡½æ•°ï¼Œå› æ­¤å°†æœ‰ä¸€ç»„é™„åŠ çš„æ“ä½œç ã€‚ <br><br><h4> åŠŸèƒ½ä»‹ç» </h4><br><pre> <code class="plaintext hljs">line #* EIO op fetch ext return operands --------------------------------------------------------------------------- 0 E &gt; RECV !0 1 RECV !1 2 CONCAT ~2 !1, !0 3 ECHO ~2 4 &gt; RETURN null</code> </pre><br><h4> ä¸»è¦ä»£å· </h4><br><pre> <code class="plaintext hljs">line #* EIO op fetch ext return operands --------------------------------------------------------------------------- 2 0 E &gt; ASSIGN !0, &lt;array&gt; 4 1 INIT_FCALL 'array_walk' 2 SEND_REF !0 3 DECLARE_LAMBDA_FUNCTION '%00%7Bclosure%7D%2Fin%2FHuNEK0x7f9fa62d105a' 4 SEND_VAL ~2 5 DO_ICALL 6 &gt; RETURN 1</code> </pre> <br> ç”±äº<b>array_walk</b>ä¸æ ‡å‡†åº“çš„å…¶ä½™åŠŸèƒ½ä¸€æ ·ï¼Œéƒ½æ˜¯å›ºæœ‰çš„ï¼Œå› æ­¤åœ¨å·²ç¼–è¯‘çš„æ“ä½œç ä¸­æ²¡æœ‰è¿­ä»£æœºåˆ¶ã€‚ <br><br>  <b>INIT_FCALL</b> ï¼šåˆå§‹åŒ–å¯¹<b>array_walk</b>çš„è°ƒç”¨ <br>  <b>SEND_REF</b> ï¼šå°†æ•°ç»„å¼•ç”¨æ”¾åœ¨è°ƒç”¨å †æ ˆä¸Š <br>  <b>DECLARE_LAMBDA_FUNCTION</b> ï¼šå£°æ˜ä¸€ä¸ªåŒ¿åå‡½æ•° <br>  <b>SEND_VAL</b> ï¼šæˆ‘ä»¬åœ¨è°ƒç”¨å †æ ˆä¸Šæ”¾ç½®äº†ä¸€ä¸ªåŒ¿åå‡½æ•° <br>  <b>DO_ICALL</b> ï¼šè¿è¡Œ<b>array_walk</b>æ‰§è¡Œ <br><br> æ¥ä¸‹æ¥ï¼Œè°ƒç”¨æ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„lambdaä¼šå‘ç”Ÿé­”æœ¯ã€‚ <br><br><h4> ä½¿ç”¨é¢„å®šä¹‰å‡½æ•°çš„<b>array_walk</b> </h4><br> ä¸ä½¿ç”¨åŒ¿åæ–¹æ³•è¿›è¡Œè°ƒç”¨æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œé™¤äº†å¯èƒ½æ¯”åœ¨è¿è¡Œæ—¶åˆ›å»ºlambdaçš„å¼€é”€å°‘ã€‚ <br><br><pre> <code class="plaintext hljs">line #* EIO op fetch ext return operands --------------------------------------------------------------------------- 3 0 E &gt; ASSIGN !0, &lt;array&gt; 9 2 INIT_FCALL 'array_walk' 3 SEND_REF !0 4 SEND_VAL 'my_echo' 5 DO_ICALL 6 &gt; RETURN 1</code> </pre> <br> ç»“è®ºæ˜¯å¸ç©ºè§æƒ¯çš„ã€‚  <b>foreachæ˜¯</b>ä¸ºè¿­ä»£æ•°ç»„é‡èº«å®šåˆ¶çš„ï¼Œè€Œå…¶ä½™çš„å¾ªç¯åªæ˜¯<b>if + goto</b>çš„åŒ…è£…ã€‚ <br><br> æ ‡å‡†åº“çš„åŠŸèƒ½æŒ‰ç…§é»‘åŒ£å­çš„åŸç†å·¥ä½œã€‚ <br><br><h2> æ½œæ°´æ›´æ·± </h2><br> é¦–å…ˆï¼Œè€ƒè™‘<b>for</b>åŠå…¶æ“ä½œç <b>FETCH_DIM_R</b>çš„æƒ…å†µï¼Œè¯¥æ“ä½œç ç”¨äºé€šè¿‡é”®æå–å€¼ã€‚ é€šè¿‡åœ¨å“ˆå¸Œè¡¨ï¼ˆ <b>ZEND_HASH_INDEX_FIND</b> ï¼‰ä¸­è¿›è¡Œæœç´¢æ¥æå–é¡¹ç›®ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæå–æ¥è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‹ç¼©æ•°ç»„</a> ï¼ˆé”®æ˜¯ä¸€ä¸ªè¿ç»­çš„æ•°å­—åºåˆ—ï¼‰-è¿™æ˜¯ä¸€ä¸ªç›¸å½“å®¹æ˜“ä¸”å¿«é€Ÿçš„æ“ä½œã€‚ å¯¹äºæœªåŒ…è£…çš„é˜µåˆ—ï¼Œä»·æ ¼ä¼šç¨é«˜ä¸€äº›ã€‚ <br><br> ç°åœ¨<b>foreach</b> ï¼ˆ <b>FE_FETCH_R</b> ï¼‰ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆé™ˆæ—§ï¼š <br><br><ol><li> æ£€æŸ¥è¿­ä»£å™¨æŒ‡é’ˆæ˜¯å¦åœ¨æ•°ç»„ä¹‹å¤– </li><li> æ£€ç´¢å½“å‰é”®å’Œå€¼ </li><li> å¢é‡æŒ‡é’ˆ </li></ol><br> å¥½å§ï¼Œåƒ<b>array_walk</b>è¿™æ ·çš„å‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å°½ç®¡å®ƒä»¬éƒ½åšä¸åŒçš„äº‹æƒ…ï¼Œä½†å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªç›¸åŒçš„åŸç†ã€‚ <br><br> å¦‚æœå®Œå…¨ç®€åŒ–ï¼Œåˆ™ï¼ˆä¼ªä»£ç ï¼‰ï¼š <br><br><pre> <code class="cpp hljs">reset_pointer() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { value = get_current_value() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-comment"><span class="hljs-comment">//  NULL,   zval  NULL key = get_current_key() call_function(myFunction, key, value) increment_pointer() } while(true)</span></span></code> </pre> <br> å®é™…ä¸Šï¼Œå†…éƒ¨çš„ä¸€åˆ‡éƒ½æ›´åŠ å¤æ‚ï¼Œä½†æ˜¯æœ¬è´¨æ˜¯ç›¸åŒçš„-åœ¨æ²¡æœ‰PHPè™šæ‹Ÿæœºå‚ä¸çš„æƒ…å†µä¸‹ï¼ˆä¸è€ƒè™‘å¯¹ç”¨æˆ·å®šä¹‰å‡½æ•°çš„è°ƒç”¨ï¼‰ï¼Œå¯ä»¥å¿«é€Ÿæœç´¢å“ˆå¸Œè¡¨ã€‚ <br><br><h2> å¥½å§ï¼Œä¸€äº›æµ‹é‡ </h2><br> æ¯•ç«Ÿï¼Œæ²¡æœ‰æµ‹é‡çš„ç‰©å“æ˜¯ä»€ä¹ˆï¼ˆä»å†…å­˜ä¸­å¾—å‡ºçš„ç»“æœç›¸å½“å¹³å‡ï¼Œä»¥è‡³äºåˆ é™¤äº†æµ‹é‡ï¼‰ã€‚ <br><br> ä½œä¸ºä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æ®ä¼ ç»Ÿï¼Œæˆ‘ä»¬å°†<b>zend_vm_execute.h</b>ç”¨äº70.108è¡Œã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">æ‰°æµæ¿è®¡é‡è„šæœ¬</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $array = explode(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>, file_get_contents(<span class="hljs-string"><span class="hljs-string">'/Users/rjhdby/CLionProjects/php-src/Zend/zend_vm_execute.h'</span></span>)); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myEcho</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($key, $value)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $key . $value; } ob_start(); $startTime = microtime(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; $i++) { <span class="hljs-comment"><span class="hljs-comment">// foreach ($array as $key =&gt; $value) { // echo $key . $value; // } // foreach ($array as $key =&gt; &amp;$value) { // echo $key . $value; // } // $length = count($array); // for ($j = 0; $j &lt; $length; $j++) { // echo $j . $array[$j]; // } // array_walk($array, function($value, $key) { // echo $key . $value; // }); // array_walk($array, static function($value, $key) { // echo $key . $value; // }); // array_walk($array, 'myEcho'); // $value = reset($array); // $key = key($array); // while($key !== null) { // echo $key.$value; // $value = next($array); // $key = key($array); // } } $endTime = microtime(true); ob_clean(); echo "time: " . ($endTime - $startTime);</span></span></code> </pre> <br></div></div><br> æ¯æ¬¡æµ‹é‡è¿è¡Œ10æ¬¡ï¼Œé€‰æ‹©æœ€é¢‘ç¹å‡ºç°çš„å‰4ä½æ•°å­—ã€‚ <br><br><pre> <code class="plaintext hljs">foreach time: 0.12159085273743 foreach(reference) time: 0.11191201210022 for, while time: 0.13130807876587 array_walk(lambda) time: 0.87953400611877 array_walk(static lambda) time: 0.87544417497211 array_walk(name) time: 0.50753092765808 next,key time: 1.06258893013</code> </pre> <br><h3> æ€»ç»“ä¸€ä¸‹ </h3><br> åˆ†æç»“æœæ—¶ï¼Œä¸è¦å¿˜è®°è€ƒè™‘å®ƒä»¬æ˜¯åœ¨é€šè¿‡7ä¸‡ä¸ªå…ƒç´ çš„æ•°ç»„çš„10æ¬¡ä¼ é€’ä¸­è·å¾—çš„ã€‚ <br><br> ç»å¯¹çš„åè‹±é›„æ˜¯<b>next / key</b>å¯¹<b>foreach</b>çš„â€œæ¨¡ä»¿â€ã€‚ é™¤éç»å¯¹å¿…è¦ï¼Œå¦åˆ™ä¸è¦è¿™æ ·åšã€‚ <br><br> å¸¦ç€lambdaçš„<b>array_walk</b>åœ¨ä»–çš„èƒŒä¸Šå‘¼å¸ï¼Œä½†æœ‰ç»†å¾®å·®åˆ«ã€‚ å³å°†åˆ°æ¥çš„å‡†æ—¶åˆ¶å¯ä»¥å¤§å¤§æ”¹å˜è¿™ç§çŠ¶å†µã€‚ ä¹Ÿè®¸ä¸å˜ã€‚ å°†ä¼šå¾ˆæœ‰è¶£ã€‚ <br> ä½¿ç”¨ç°æˆçš„å‡½æ•°è¿›è¡Œ<b>array_walk</b>æ˜¯ä¸€ä¸ªå¼ºé¡¹ã€‚ <br><br> ç”±äºåœ¨é“¾æ¥ä¸Šè¿›è¡Œè¿­ä»£æ—¶<b>foreachçš„</b>å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒï¼ˆå®ƒä½¿ç”¨<b>FE_FETCH_RW</b>æ“ä½œç è€Œä¸æ˜¯<b>FE_FETCH_R</b> ï¼‰ï¼Œå› æ­¤å¯¹å…¶è¿›è¡Œäº†å•ç‹¬çš„æµ‹é‡ã€‚ ä»–çš„ç»“æœç¡®å®æ›´å¿«ã€‚ <br><br> äº‹å®è¯æ˜ï¼ŒåŠ¨æ€åˆ›å»ºlambdaå¹¶ä¸æ˜¯æœ€ä¾¿å®œçš„æ“ä½œã€‚ ä¼¼ä¹åªåˆ›å»ºäº†10æ¬¡ã€‚ æœ‰å¿…è¦å­¦ä¹ ã€‚ <br><br> æ‰€æœ‰å…¶ä»–æ–¹æ³•å‡æ˜¾ç¤ºå‡ºå¤§è‡´ç›¸åŒçš„ç»“æœï¼Œä½†å·®è·å¾ˆå°ã€‚ <br><br> æ„Ÿè°¢æ‚¨çš„å…³æ³¨ï¼ <br><br> å¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®ï¼Œè¿˜å¯ä»¥â€œé€‰æ‹©â€-åœ¨è¯„è®ºä¸­å†™ã€‚ æˆ‘ä»åœ¨è€ƒè™‘lambda-è¿™æ ·çš„æ€§èƒ½ä¸‹é™éå¸¸å¥‡æ€ªã€‚ <br><br>  <b>UPD</b> <br> ä¸ºå…·æœ‰é™æ€lambdaçš„<b>array_walk</b>æ·»åŠ äº†è®¡é‡ã€‚ åŒºåˆ«ä¸æ˜æ˜¾ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460285/">https://habr.com/ru/post/zh-CN460285/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460273/index.html">Apple Payä¸­æœ€å°çš„æˆæƒ</a></li>
<li><a href="../zh-CN460275/index.html">æ‚¨ä¸ºä»€ä¹ˆä¸éœ€è¦å®Œç¾çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN460279/index.html">100äº¿ç¾å…ƒåˆåŒï¼šè°å°†ä¸ºäº”è§’å¤§æ¥¼åº”å¯¹äº‘</a></li>
<li><a href="../zh-CN460281/index.html">UX Writerå¦‚ä½•å¸®åŠ©æ”¹å–„äº§å“</a></li>
<li><a href="../zh-CN460283/index.html">æ–°çš„è‡ªå·±åŠ¨æ‰‹ç¼–ç¨‹è¯­è¨€</a></li>
<li><a href="../zh-CN460291/index.html">è¯·æ±‚çš„æ‰¹å¤„ç†é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆï¼ˆç¬¬1éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN460295/index.html">åœ¨Rustä¸­ï¼Œä¸å®‰å…¨æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN460297/index.html">WeakRef-æ·»åŠ åˆ°ECMAScriptæ ‡å‡†çš„å»ºè®®</a></li>
<li><a href="../zh-CN460301/index.html">æ–°ä¸€ä»£å¤§åŠŸç‡LEDç¯</a></li>
<li><a href="../zh-CN460305/index.html">AERODISKå¼•æ“ï¼šç¾éš¾æ€§çš„ã€‚ ç¬¬2éƒ¨åˆ†ã€‚Metrocluster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>