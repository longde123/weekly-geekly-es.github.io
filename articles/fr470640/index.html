<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🍳 🐥 🔻 Dimensionnement d'Elasticsearch 🙆 🧗🏼 🤼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Quelle est la taille d'un cluster dont j'ai besoin? 
 - Eh bien, ça dépend ... (gloussement de colère) 
 Elasticsearch est le cœur de la pile élasti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dimensionnement d'Elasticsearch</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/galssoftware/blog/470640/"><img src="https://habrastorage.org/webt/ro/ow/rs/roowrsc0jqrmwlmtiiuca083_r4.png"><br><br><blockquote>  - Quelle est la taille d'un cluster dont j'ai besoin? <br>  - Eh bien, ça dépend ... (gloussement de colère) </blockquote><br>  Elasticsearch est le cœur de la pile élastique, dans laquelle se déroule toute la magie des documents: émission, réception, traitement et stockage.  Les performances dépendent du nombre correct de nœuds et de l'architecture de la solution.  Et le prix, d'ailleurs, aussi, si votre abonnement est Gold ou Platinum. <br><br>  Les principales caractéristiques du matériel sont le disque (stockage), la mémoire (mémoire), les processeurs (calcul) et le réseau (réseau).  Chacun de ces composants est responsable de l'action qu'Elasticsearch effectue sur les documents, qui sont respectivement le stockage, la lecture, le calcul et la réception / transmission.  Parlons des principes généraux du dimensionnement et révélons le «ça dépend».  Et à la fin de l'article, vous trouverez des liens vers des webinaires et des articles connexes.  C'est parti! <br><a name="habracut"></a><br>  Cet article est basé sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le dimensionnement et la planification de la capacité du webinaire de David Moore</a> .  Nous avons complété son raisonnement par des liens et des commentaires pour le rendre un peu plus clair.  À la fin de l'article, une piste bonus est des liens vers des matériaux élastiques pour ceux qui veulent mieux se plonger dans le sujet.  Si vous avez une bonne expérience avec Elasticsearch, veuillez partager dans les commentaires comment concevoir un cluster.  Nous et tous nos collègues aimerions connaître votre opinion. <br><br><h1>  Architecture et opérations d'Elasticsearch </h1><br>  Au début de l'article, nous avons parlé de 4 composants qui forment le matériel: disque, mémoire, processeurs et réseau.  Le rôle d'un nœud affecte l'élimination de chacun de ces composants.  Un nœud peut jouer plusieurs rôles à la fois, mais avec la croissance du cluster, ces rôles doivent être répartis sur différents nœuds. <br><br>  <b>Les nœuds maîtres</b> surveillent la santé du cluster dans son ensemble.  Dans le travail du nœud maître, un quorum doit être observé, c'est-à-dire  leur nombre devrait être impair (peut-être 1, mais mieux 3). <br><br>  <b>Les nœuds de données</b> exécutent des fonctions de stockage.  Pour augmenter les performances du cluster, les nœuds doivent être divisés en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«chaud», «chaud» et «froid» (figé)</a> .  Les premiers sont pour l'accès en ligne, le second pour le stockage et le troisième pour l'archivage.  En conséquence, pour "chaud", il est raisonnable d'utiliser des disques SSD locaux, et pour les disques durs "chauds" et "froids", il convient localement ou en SAN. <br><br>  Pour déterminer la capacité de stockage des nœuds pour le stockage, Elastic recommande d'utiliser la logique suivante: «chaud» → 1:30 (30 Go d'espace disque par gigaoctet de mémoire), «chaud» → 1: 100, «froid» → 1: 500).  Sous le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tas JVM, pas plus de 50% de la mémoire totale</a> et pas plus de 30 Go pour éviter le raid du ramasse-miettes.  La mémoire restante sera utilisée comme cache du système d'exploitation. <br><br>  Les indicateurs de performances des instances Elastisearch tels que les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pools de threads et les files d'attente de threads sont</a> plus affectés par l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">utilisation du</a> cœur du processeur.  Les premiers sont formés sur la base des actions que le nœud effectue: rechercher, analyser, écrire et autres.  Les seconds sont la file d'attente des requêtes correspondantes de différents types.  Le nombre de processeurs Elasticsearch disponibles à utiliser est déterminé automatiquement, mais vous pouvez spécifier cette valeur manuellement dans les paramètres (cela peut être utile lorsque deux instances Elasticsearch ou plus s'exécutent sur le même hôte).  Le nombre maximal de pools de threads et de files d'attente de threads de chaque type peut être défini dans les paramètres.  La métrique des pools de threads est la métrique de performances principale pour Elasticsearch. <br><br>  <b>Les nœuds d'ingestion</b> prennent les données des collecteurs (Logstash, Beats, etc.), effectuent des conversions sur eux et écrivent dans l'index cible. <br><br>  <b>Les nœuds d'apprentissage automatique</b> sont destinés à l'analyse des données.  Comme nous l'avons écrit dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article sur l'apprentissage automatique dans Elastic Stack</a> , le mécanisme est écrit en C ++ et fonctionne en dehors de la JVM, qui exécute Elasticsearch lui-même, il est donc raisonnable d'effectuer de telles analyses sur un nœud distinct. <br><br>  <b>Les nœuds coordinateurs</b> acceptent une demande de recherche et l'acheminent.  La présence de ce type de nœud accélère le traitement des requêtes de recherche. <br><br>  Si nous considérons la charge sur les nœuds en termes de capacités d'infrastructure, la distribution sera quelque chose comme ceci: <br><div class="scrollable-table"><table><tbody><tr><td align="center">  <b>Noda</b> </td><td align="center">  <b>Conduire</b> </td><td align="center">  <b>La mémoire</b> </td><td align="center">  <b>CPU</b> </td><td align="center">  <b>Réseau</b> </td></tr><tr><td>  Maître </td><td align="center">  ↓ </td><td align="center">  ↓ </td><td align="center">  ↓ </td><td align="center">  ↓ </td></tr><tr><td>  Les données </td><td align="center">  ↑↑ </td><td align="center">  ↑ </td><td align="center">  ↑ </td><td align="center">  → </td></tr><tr><td>  Ingérer </td><td align="center">  ↓ </td><td align="center">  → </td><td align="center">  ↑ </td><td align="center">  → </td></tr><tr><td>  Apprentissage automatique </td><td align="center">  ↓ </td><td align="center">  ↑↑ </td><td align="center">  ↑↑ </td><td align="center">  → </td></tr><tr><td>  Coordinateur </td><td align="center">  ↓ </td><td align="center">  → </td><td align="center">  → </td><td align="center">  → </td></tr><tr><td colspan="5" align="center">  ↑↑ - très élevé, ↑ - élevé, → - moyen, ↓ - faible </td></tr></tbody></table></div><br>  Ensuite, nous présentons 4 principaux types d'opérations dans Elasticsearch, chacune nécessitant un certain type de ressource. <br><br>  <b>Index</b> - traitement et enregistrement d'un document dans l'index.  Le diagramme ci-dessous montre les ressources utilisées à chaque étape. <br><br><img src="https://habrastorage.org/webt/h0/80/ek/h080ekuwv9hk320oxjbzhe2myou.png"><br><br>  <b>Supprimer</b> - supprimer un document de l'index. <br><br><img src="https://habrastorage.org/webt/zn/f2/y8/znf2y8pjrr1gcwsijy8b0e7jqog.png"><br><br>  <b>Mise à jour</b> - Fonctionne comme Index et Supprimer, car les documents dans Elasticsearch sont immuables. <br><br>  <b>Recherche</b> - obtenir un ou plusieurs documents ou leur agrégation à partir d'un ou plusieurs index. <br><br><img src="https://habrastorage.org/webt/mw/wr/8g/mwwr8gypmhrb267m7z6eqefk5se.png"><br><br>  Nous avons compris l'architecture et les types de charges, passons maintenant à la formation d'un modèle de dimensionnement. <br><br><h1>  Dimensionnement d'Elasticsearch et questions avant sa formation </h1><br>  Elastic recommande d'utiliser deux stratégies de dimensionnement: orientée stockage et débit.  Dans le premier cas, les ressources disque et la mémoire sont d'une importance primordiale, et dans le second cas, la mémoire, la puissance du processeur et le réseau. <br><br><h3>  Dimensionnement de l'architecture Elasticsearch en fonction de la taille du stockage </h3><br>  Avant les calculs, nous obtenons les données initiales.  Besoin: <br><br><ul><li>  La quantité de données brutes par jour; </li><li>  La période de stockage des données en jours; </li><li>  Facteur de transformation des données (facteur json + facteur d'indexation + facteur de compression); </li><li>  Nombre de réplications de fragments; </li><li>  La quantité de nœuds de données de mémoire; </li><li>  Le rapport mémoire / données (1:30, 1: 100, etc.). </li></ul><br>  Malheureusement, le facteur de transformation des données n'est calculé qu'empiriquement et dépend de diverses choses: le format des données brutes, le nombre de champs dans les documents, etc.  Pour le savoir, vous devez charger une partie des données de test dans l'index.  Sur le sujet de ces tests, il y a une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vidéo intéressante de la conférence</a> et une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">discussion dans la communauté Elastic</a> .  En général, vous pouvez le laisser égal à 1. <br><br>  Par défaut, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Elasticsearch compresse les données en</a> utilisant l'algorithme LZ4, mais il y a aussi DEFLATE, qui appuie 15% de plus.  En général, une compression de 20 à 30% peut être obtenue, mais elle est également calculée empiriquement.  Lors du passage à l'algorithme DEFLATE, la charge sur la puissance de calcul augmente. <br><br>  Il y a encore des recommandations supplémentaires: <br><br><ul><li>  Déposez 15% pour avoir une réserve d'espace disque; </li><li>  Engagez 5% pour les besoins supplémentaires; </li><li>  Fixez 1 équivalent d'un nœud de données pour assurer une migration rapide. </li></ul><br>  Passons maintenant aux formules.  Il n'y a rien de compliqué ici, et nous pensons qu'il sera intéressant pour vous de vérifier la conformité de votre cluster avec ces recommandations. <br><blockquote>  <b>Quantité totale de données (Go)</b> = données brutes par jour * nombre de jours de stockage * facteur de transformation des données * (nombre de répliques - 1) </blockquote><br><blockquote>  <b>Stockage total des données (Go)</b> = Total des données (Go) * (1 + 0,15 stock + 0,05 besoins supplémentaires) </blockquote><br><blockquote>  <b>Nombre total de nœuds</b> = OK (Stockage total de données (Go) / Volume de mémoire par nœud / rapport mémoire / données + 1 équivalent de nœud de données) </blockquote><br><h3>  Dimensionnement de l'architecture Elasticsearch pour déterminer le nombre de fragments et de nœuds de données en fonction de la taille du stockage </h3><br>  Avant les calculs, nous obtenons les données initiales.  Besoin: <br><br><ul><li>  Le nombre de modèles d'index que vous allez créer; </li><li>  Le nombre de fragments de base et de répliques; </li><li>  Après combien de jours la rotation d'index sera effectuée, le cas échéant; </li><li>  Le nombre de jours pour stocker les indices; </li><li>  La quantité de mémoire pour chaque nœud. </li></ul><br>  Il y a encore des recommandations supplémentaires: <br><br><ul><li>  Ne dépassez pas 20 fragments par segment JVM de 1 Go sur chaque nœud; </li><li>  Ne dépassez pas 40 Go d'espace disque de partition. </li></ul><br>  Les formules sont les suivantes: <br><blockquote>  <b>Nombre de fragments</b> = Nombre de modèles d'index * Nombre de fragments principaux * (Nombre de fragments répliqués + 1) * Nombre de jours de stockage </blockquote><br><blockquote>  <b>Nombre de nœuds de données</b> = OK (nombre de fragments / (20 * mémoire pour chaque nœud)) <br></blockquote><br><h3>  Dimensionnement de la bande passante Elasticsearch </h3><br>  Le cas le plus courant lorsqu'une bande passante élevée est nécessaire est fréquent et dans les requêtes de recherche en grand nombre. <br><br>  Données initiales nécessaires pour le calcul: <br><br><ul><li>  Recherches de pointe par seconde; </li><li>  Temps de réponse admissible moyen en millisecondes; </li><li>  Nombre de cœurs et de threads par cœur de processeur sur les nœuds de données. </li></ul><br><blockquote>  Valeur maximale des threads = OK (nombre maximal de requêtes de recherche par seconde * nombre moyen de temps pour répondre à une requête de recherche en millisecondes / 1000 millisecondes) </blockquote><br><blockquote>  Pool de threads de volume = OKRUP ((nombre de cœurs physiques par nœud * nombre de threads par cœur * 3/2) +1) </blockquote><br><blockquote>  Nombre de nœuds de données = OK (valeur maximale du thread / volume du pool de threads) </blockquote><br>  Peut-être que toutes les données initiales ne seront pas entre vos mains lors de la conception de l'architecture, mais après avoir regardé le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">webinaire</a> ou lu cet article, une compréhension apparaîtra qui affecte en principe la quantité de ressources matérielles. <br><br>  Veuillez noter qu'il n'est pas nécessaire d'adhérer à l'architecture donnée (par exemple, créer des nœuds coord coord et des nœuds de gestionnaire).  Il suffit de savoir qu'une telle architecture de référence existe et qu'elle peut donner une amélioration des performances que vous ne pourriez pas obtenir par d'autres moyens. <br><br>  Dans l'un des articles suivants, nous publierons une liste complète des questions auxquelles il faut répondre pour déterminer la taille du cluster. <br><br>  Pour nous contacter, vous pouvez utiliser des messages personnels sur Habré ou le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">formulaire de feedback sur le site</a> . <br><br>  <b>Matériel supplémentaire</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Webinaire "Dimensionnement d'Elasticsearch et planification des capacités"</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Webinaire sur la planification des capacités d'Elasticsearch</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Discours à ElasticON sur le thème «Dimensionnement quantitatif des clusters»</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Webinaire sur l'utilitaire Rally pour déterminer les indicateurs de performance du cluster</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article sur les tailles d'Elasticsearch</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Webinaire sur la pile élastique</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470640/">https://habr.com/ru/post/fr470640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470622/index.html">Présentation des méthodes de sélection des fonctionnalités</a></li>
<li><a href="../fr470628/index.html">Construction navale de simulateur de vaisseau spatial</a></li>
<li><a href="../fr470632/index.html">Arend - Langage de type dépendant basé sur HoTT (partie 2)</a></li>
<li><a href="../fr470634/index.html">Identifiez la communauté intercommunautaire sur Instagram pour identifier les intérêts des utilisateurs</a></li>
<li><a href="../fr470638/index.html">Méthodes quasi-newtoniennes ou quand il y a trop de dérivées secondes pour Athos</a></li>
<li><a href="../fr470642/index.html">Découvrez Yandex.Station Mini. Grande histoire d'un petit appareil</a></li>
<li><a href="../fr470644/index.html">Pourquoi les blogs d'entreprise sont parfois aigris: quelques observations et conseils</a></li>
<li><a href="../fr470646/index.html">Mathématiques pour la science des données. Nouveau cours d'OTUS</a></li>
<li><a href="../fr470648/index.html">IBM LTO-8 - Un moyen facile de stocker des données froides</a></li>
<li><a href="../fr470650/index.html">Préparation des données dans un projet Data Science: recettes pour les jeunes femmes au foyer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>