<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏻‍💻 🤲🏿 🧔🏽 Interfaces pour dispositif d'oscillation de lit d'enfant - Du porte-clés au Web 🙎🏼 📽️ ❗️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Un peu plus d'un an s'est écoulé depuis la rédaction de mon premier article sur un appareil pour bercer un berceau. Pendant ce temps, j'ai développé u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interfaces pour dispositif d'oscillation de lit d'enfant - Du porte-clés au Web</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386293/"><div style="text-align:center;"><img src="https://habrastorage.org/files/a17/b69/b13/a17b69b1341b4ba38455428341654685.gif"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un peu plus d'un an s'est écoulé depuis la rédaction de mon premier </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">article</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sur un appareil pour bercer un berceau. </font><font style="vertical-align: inherit;">Pendant ce temps, j'ai développé un nouveau panneau de contrôle avec un écran, puis une interface web pour cet appareil. </font><font style="vertical-align: inherit;">Si vous souhaitez en savoir plus, bienvenue sur cat.</font></font><br>
<br>
<a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au début - quelques mots sur l'appareil lui-même, un bref résumé de la série précédente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, l'appareil est conçu pour faire pivoter un lit d'enfant avec un mécanisme à pendule. Une unité d'entraînement avec un électroaimant et de l'électronique à l'intérieur est installée sur la partie fixe du berceau. Un aimant en néodyme est fixé sur la partie mobile. En survolant un électroaimant, un aimant permanent induit un champ électromagnétique dont la forme détermine le moment de la connexion du même électroaimant à une source d'alimentation. Ainsi, l'électroaimant pousse au bon moment l'aimant permanent et, par conséquent, la partie mobile du berceau. En même temps, lorsque l'électro-aimant n'est pas alimenté, il joue le rôle d'un capteur de position pour la partie mobile du berceau.</font></font><br>
<br>
<img src="https://habrastorage.org/files/79a/544/62a/79a54462afb845d7b06548478ca65f9e.gif" height="350" align="left"><img src="https://habrastorage.org/getpro/geektimes/post_images/e80/6e9/0bd/e806e90bd42d464c72d0cef045499ea0.jpg" alt="image" height="350"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai fait la première copie de l'appareil pour moi. Ensuite, il s'est avéré que de tels appareils peuvent être vendus, et depuis plus de trois ans, je le fais avec plus ou moins de succès. Maintenant, en petits lots, quatre modèles d'appareils sont fabriqués et vendus par l'un des plus grands fabricants russes de meubles pour enfants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans le premier modèle du dispositif de basculement d'un lit d'enfant, une telle télécommande est utilisée comme panneau de commande. Il y a quatre boutons avec les fonctionnalités de «Démarrer», «Arrêter», «Plus fort» et «Plus faible». En conséquence, en utilisant cette télécommande, vous pouvez démarrer et arrêter le swing, ainsi que changer son intensité - choisissez l'un des six niveaux possibles. Le porte-clés fonctionne à une fréquence de 433 MHz et n'a aucun retour.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/845/aa6/11b/845aa611b6ee4769bed8bd30d1f63f4c.gif"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après un certain temps, une version simplifiée de l'appareil (modèle 0) a été développée, généralement sans panneau de commande. Ils ont secoué le berceau avec sa main - et il continue de se balancer indéfiniment. Arrêté - balancement arrêté. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de l'élaboration du deuxième modèle suivant du dispositif de balançoire (modèle 2), la tâche principale consistait à ajouter une minuterie pour le mal des transports et à démarrer la balançoire à partir du cri de l'enfant. Et cela s'est avéré être un problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le fait est que le temps de swing doit être réglé d'une manière ou d'une autre, en heures et minutes. Et la sensibilité du microphone serait également agréable à configurer d'une manière ou d'une autre. Mais tout cela nécessite une interface, et une télécommande «aveugle» à quatre boutons n'est clairement pas suffisante.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, la première pensée a été de faire quelques indications sur le boîtier de l'appareil. Mettez-y quelques LED et / ou un petit écran. Et contrôlez aussi, à l'aide de cette petite télécommande. Cependant, l'inconvénient de cette solution est que l'appareil est généralement installé dans un endroit inaccessible, quelque part sur la paroi arrière du lit contre le mur. Et les indications sur le boîtier dans ce cas ne seront tout simplement pas visibles. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il a donc été décidé de réaliser un panneau de contrôle avec écran. Un peu moins d'un an de développement - et l'appareil avec la télécommande est prêt!</font></font><br>
<br>
<img src="https://habrastorage.org/files/6a7/2bd/a6e/6a72bda6ecfa4102917ccc6e36500b74.gif" align="left" height="350"><img src="https://habrastorage.org/files/c9d/5ad/290/c9d5ad290d064d5ababcf7b905b865cf.gif" height="350"><div style="text-align:center;"><img src="https://habrastorage.org/files/a5f/177/1dc/a5f1771dccce41aebe3815e49227f58c.gif"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'intérieur de la console se trouve ATMega32A, l'écran est un écran de Nokia 1202 et l'émetteur-récepteur est NRF24L01 +. Le boîtier est standard prêt à l'emploi, le clavier est en film. Depuis la télécommande, vous pouvez régler l'heure du mal des transports, la sensibilité du microphone, l'intensité du swing, ainsi que démarrer et arrêter le processus. Pour le cas de plusieurs lits dans la même pièce, la possibilité de changer le canal de commande est prévue, puisque le NRF24L01 + le permet facilement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La console et l'appareil dialoguent constamment. Cela est fait pour la rétroaction - l'état actuel de l'appareil est affiché à l'écran, à savoir si le processus de swing est en cours ou non (si c'est le cas, l'image du berceau sur la télécommande oscille également), combien de temps il reste pour pomper, quels sont les paramètres actuels pour l'intensité du mal des transports et la sensibilité du microphone. Afin que les piles du panneau de commande ne se déchargent pas trop rapidement, un mode veille est fourni - si personne n'appuie sur les boutons de la télécommande pendant une demi-heure, la télécommande s'endormira.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après le développement et le lancement de «Model 2», quoique dans une production modeste mais toujours, j'ai continué à penser à améliorer le dispositif de swing. Ce serait génial, pensais-je, si vous pouviez contrôler l'appareil à partir d'un téléphone portable! Ou à partir d'une tablette. Par exemple, quand je dors, je mets un téléphone portable à côté de moi. Il y a un réveil et un courrier, et vous pouvez lire quelque chose avant le coucher. Et certainement de nombreux jeunes parents le font aussi. Pourquoi utiliser une télécommande séparée pour le dispositif pivotant alors qu'il est ici - chose universelle - un smartphone ou une tablette! Qu'il soit le panneau de contrôle, pensai-je.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelles sont les interfaces radio plus ou moins adaptées dans un smartphone moderne? Bluetooth et Wi-Fi. Au début, j'ai envisagé de contrôler l'appareil swing via Bluetooth. Des pros - il est facile à mettre en œuvre depuis le côté de l'appareil. Vous pouvez utiliser le module - le "pont" Bluetooth-UART, et c'est le problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Certes, du côté du smartphone - des problèmes continus.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Commencer par garder Bluetooth sur votre téléphone tout le temps est une mauvaise idée. De plus, pour chaque système d'exploitation, vous devrez écrire votre propre logiciel, ce sont au moins deux applications - pour Android et pour iPhone. Mais il y a aussi des téléphones sous Windows Phone ... Après avoir approfondi un peu le sujet, j'ai trouvé que rien ne pouvait fonctionner avec l'iPhone, il semble y avoir quelques limitations. Eh bien, même si tout fonctionne. Les candidatures doivent d'abord être rédigées. Publiez ensuite dans les magasins appropriés. Ensuite, ils doivent être maintenus en bon état de fonctionnement, pour corriger les erreurs, pour répondre aux commentaires des utilisateurs. Le problème est que je n'ai jamais rien fait de tout cela, pour moi c'est une "forêt sombre avec des partisans" et dans le bon sens pour cette partie du travail dont vous avez besoin pour embaucher une personne bien informée. Et de ne pas embaucher une seule fois, puis de collaborer constamment avec lui en termes de soutien de programme.Eh bien, ou apprenez tout par vous-même. Cela s'avère en quelque sorte coûteux et techniquement moche. Par conséquent, Bluetooth disparaît.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et puis j'ai découvert l'existence de l'ESP8266. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oui, beaucoup de choses ont déjà été écrites sur ces modules ici, en plus, il y a un excellent forum en russe sur eux. Il y a un peu moins d'un an, ayant commencé à envisager ce module pour mon application, je n'ai pas pu me forger une opinion sur ses capacités pendant longtemps. Et maintenant, à en juger par les questions des nouveaux arrivants sur le même forum, je constate que beaucoup ne savent pas de quoi ce module (puce) est capable. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une chose importante à dire ici - au départ, l'ESP8266 était «équipé» d'un SDK chinois très «brut» et «buggé», et donc la puce ne pouvait pas être utilisée pour résoudre de vraies tâches de «combat». Donc, bien sûr, il était possible de jouer, de faire clignoter la LED, mais il était impossible de faire quelque chose de stable.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Au cours de l'année écoulée, cependant, la situation a fondamentalement changé. Lors d'un forum en langue russe consacré à cette puce, l'un de ses participants a mis en œuvre un projet - "Développement d'une" bibliothèque "d'un petit serveur Web sur ESP8266." Une personne incognito incroyable se cachant sous le surnom pvvx, un firmware presque à lui seul créé pour ESP8266, qui vous permet de révéler pleinement les capacités de cette puce. Les codes sources du projet sont accessibles au public, l'auteur permet de les utiliser à votre guise, y compris à des fins commerciales. De plus, pvvx continue de compléter l'assemblage avec de nouvelles fonctionnalités, et, ce qui est très important, est activement présent sur le forum et ne se lasse pas (enfin, probablement) de conseiller les nouveaux arrivants (et pas les nouveaux arrivants aussi).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À la suite de cela, je n'ai pas peur du pathos, du travail exceptionnel, il est devenu possible (entre autres choses) de fournir à n'importe quel appareil une interface Web complète et stable. Les capacités de la puce et du micrologiciel ne sont pas limitées à cette application, mais j'avais besoin de résoudre ce problème. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les avantages de l'utilisation de l'ESP8266 sont évidents et, en outre, il n'existe actuellement aucune autre option comparable en termes de prix et de fonctionnalité.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En effet, au prix d'environ 170 roubles sur le module ESP8266, vous pouvez organiser un serveur web avec une interface de contrôle d'appareil, ce qui vous permet de ne pas écrire de programmes du tout sous n'importe quel système d'exploitation, une seule fois pour faire une interface web. Le module peut fonctionner comme point d'accès et comme station, ainsi que simultanément dans ces deux modes. Par exemple, en vous connectant au module en tant que point d'accès, vous pouvez configurer ses paramètres de communication, puis, si vous le souhaitez, connecter le module en tant que station à votre réseau Wi-Fi domestique. L'assemblage («dump», comme l'auteur l'appelle respectueusement) a de nombreux paramètres (plus de 250) disponibles à partir de l'interface Web.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, il existe d'autres firmwares pour ESP8266, mais aucun d'entre eux n'a des capacités, une stabilité et une qualité de travail telles que l'assemblage de pvvx (c'est mon opinion subjective en ce qui concerne ma tâche). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sur la base de ce micrologiciel, une interface Web a été développée pour un appareil à bascule pour lit d'enfant. Le composant WebPart lui-même a été rédigé de telle manière que le site s'affiche correctement sur différents écrans avec différentes tailles et résolutions. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/e3b/b52/a67/e3bb52a67c6cf9fdf15a8298999d67c2.jpg" alt="image" height="800" align="left"><img src="https://habrastorage.org/getpro/geektimes/post_images/f57/0b3/440/f570b344063bba844ebf23a8394eb634.jpg" alt="image" height="397" align="left"><img src="https://habrastorage.org/getpro/geektimes/post_images/4a6/8db/1f4/4a68db1f4fad6a2bfaea052ef086adaa.jpg" alt="image" height="397"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bien sûr, le matériel de l'appareil a dû être refait très bien (en fait - refait). L'algorithme swing est maintenant implémenté sur le microcontrôleur Attiny441, interagissant avec l'ESP8266 via UART. L'alimentation 3,3 volts est effectuée à l'aide du ST1S10. Carte optionnelle avec erreur (fixée par montage en surface):</font></font><br>
<br>
<img src="https://habrastorage.org/files/469/e9d/477/469e9d477ad747f39a40291cfad1b0fa.gif" height="350" align="left"><img src="https://habrastorage.org/files/595/0b9/378/5950b9378053444ba6b86cdf831d5ad6.gif" height="350"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ainsi, il est désormais plus facile que jamais de «lier» le Wi-Fi et une interface Web à n'importe quoi. </font><font style="vertical-align: inherit;">Dans le même temps, le système fonctionnera de manière assez stable et le coût des composants ne sera que d'environ 250 roubles (si vous calculez la liaison entière, pas seulement le module ESP8266 lui-même). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et donc l'interface Web de l'appareil pour faire basculer un lit d'enfant est apparue.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr386293/">https://habr.com/ru/post/fr386293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr386281/index.html">Collecte de fonds pour un scanner inhabituel qui peut rapidement faire face même avec des livres</a></li>
<li><a href="../fr386283/index.html">5 cas originaux de marques se faisant connaître à travers des jeux</a></li>
<li><a href="../fr386285/index.html">Présentation du mini PC LXBOX 3</a></li>
<li><a href="../fr386287/index.html">Le système de sauvetage collectif par avion de ligne a été créé. Ce n'est pas rentable - réponse dans les compagnies aériennes</a></li>
<li><a href="../fr386291/index.html">De quoi, de quoi, de quoi sont faits nos robots?</a></li>
<li><a href="../fr386295/index.html">Google Inbox aide désormais à répondre aux e-mails en utilisant la haute technologie</a></li>
<li><a href="../fr386297/index.html">En attente d'une infospace partagée</a></li>
<li><a href="../fr386299/index.html">Samsung a annoncé un nouveau bioprocesseur pour les appareils portables</a></li>
<li><a href="../fr386301/index.html">Virgin Galactic présentera la nouvelle version de SpaceShipTwo en février 2016</a></li>
<li><a href="../fr386303/index.html">Lampe intelligente qui sauvera des voleurs. Les expéditions Beon ont commencé</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>