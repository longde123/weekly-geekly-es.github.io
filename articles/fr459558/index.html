<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßíüèø üë®üèΩ‚ÄçüöÄ üöâ Comment commencer √† utiliser le mode utilisateur sous Linux üìÜ üïê üë±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction du traducteur: Dans le contexte de l'entr√©e massive dans notre vie de diff√©rents types de conteneurs, il peut √™tre tr√®s int√©ressant et ut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment commencer √† utiliser le mode utilisateur sous Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/459558/">  <i>Introduction du traducteur: Dans le contexte de l'entr√©e massive dans notre vie de diff√©rents types de conteneurs, il peut √™tre tr√®s int√©ressant et utile de d√©couvrir avec quelles technologies tout a commenc√© une fois.</i>  <i>Certaines d'entre elles peuvent √™tre utilis√©es √† ce jour, mais tout le monde ne se souvient pas de telles m√©thodes (ou sait si elles n'ont pas √©t√© trouv√©es lors de leur d√©veloppement rapide).</i>  <i>L'une de ces technologies est le mode utilisateur Linux.</i>  <i>L'auteur de l'original a farfouill√©, trouvant ce qui fonctionnait encore et ce qui ne fonctionnait pas beaucoup, et a rassembl√© quelque chose comme une instruction √©tape par √©tape sur la fa√ßon de d√©marrer UML maison en 2k19 pour moi-m√™me.</i>  <i>Et oui, nous avons invit√© l'auteur du post original de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Cadey</a> √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Habr</a> , donc si vous avez des questions, posez-les en anglais dans les commentaires.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/480/b5e/ecc/480b5eeccd71ac8e098a9e7b3b8bedb6.jpg" alt="image"><br><br>  Le mode utilisateur Linux est, en fait, le port du noyau Linux lui-m√™me.  Ce mode vous permet d'ex√©cuter un noyau Linux √† part enti√®re en tant que processus utilisateur et est g√©n√©ralement utilis√© par les d√©veloppeurs pour tester les pilotes.  Mais ce mode est √©galement utile comme outil d'isolement g√©n√©ral, dont le principe est similaire au fonctionnement des machines virtuelles.  Ce mode offre plus d'isolement que Docker, mais moins qu'une machine virtuelle √† part enti√®re comme KVM ou Virtual Box. <br><a name="habracut"></a><br>  En g√©n√©ral, le mode utilisateur peut sembler √©trange et difficile √† utiliser, mais il a toujours ses propres domaines d'application.  Apr√®s tout, c'est un noyau Linux √† part enti√®re, travaillant √† partir d'un utilisateur non privil√©gi√©.  Cette fonctionnalit√© vous permet d'ex√©cuter du code potentiellement non fiable sans aucune menace pour la machine h√¥te.  Et comme il s'agit d'un noyau √† part enti√®re, ses processus sont isol√©s de la machine h√¥te, c'est-√†-dire que les <b>processus ex√©cut√©s en mode utilisateur ne seront pas visibles pour l'h√¥te</b> .  Ce n'est pas comme le conteneur Docker habituel, auquel cas la machine h√¥te voit toujours les processus √† l'int√©rieur du r√©f√©rentiel.  Jetez un ≈ìil √† ce morceau de pstree depuis l'un de mes serveurs: <br><br><pre><code class="xml hljs">containerd‚îÄ‚î¨‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄdnsd‚îÄ‚îÄ‚îÄ19*[{dnsd}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄaerial‚îÄ‚îÄ‚îÄ21*[{aerial}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îÇ ‚îî‚îÄsurl ‚îÇ ‚îî‚îÄ9*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄtini‚îÄ‚î¨‚îÄh‚îÄ‚îÄ‚îÄ13*[{h}] ‚îÇ ‚îÇ ‚îî‚îÄs6-svscan‚îÄ‚îÄ‚îÄs6-supervise ‚îÇ ‚îî‚îÄ10*[{containerd-shim}] ‚îú‚îÄcontainerd-shim‚îÄ‚î¨‚îÄgoproxy‚îÄ‚îÄ‚îÄ14*[{goproxy}] ‚îÇ ‚îî‚îÄ9*[{containerd-shim}] ‚îî‚îÄ32*[{containerd}]</code> </pre> <br>  Et comparez cela au noyau Linux pstree en mode utilisateur: <br><br><pre> <code class="xml hljs">linux‚îÄ‚î¨‚îÄ5*[linux] ‚îî‚îÄslirp</code> </pre> <br>  Lorsque je travaille avec des conteneurs Docker, je peux voir les noms des processus qui s'ex√©cutent sur le syst√®me invit√© √† partir de l'h√¥te.  Avec le mode utilisateur Linux, ce n'est pas possible.  Qu'est-ce que cela signifie?  Cela signifie que les outils de surveillance qui fonctionnent via le sous-syst√®me d'audit de Linux <b>ne voient pas les</b> processus s'ex√©cuter sur le syst√®me invit√©.  Mais dans certaines situations, cette fonction peut devenir une √©p√©e √† double tranchant. <br><br>  En g√©n√©ral, l'int√©gralit√© du post ci-dessous est un ensemble d'√©tudes et de tentatives grossi√®res pour obtenir le r√©sultat souhait√©.  Pour ce faire, j'ai d√ª utiliser divers outils anciens, lire les sources du noyau, d√©boguer intensivement le code √©crit alors que j'√©tais encore √† l'√©cole primaire, et aussi parcourir les assemblages Heroku √† l'aide d'un binaire sp√©cial √† la recherche des outils dont j'avais besoin.  Tout ce travail a amen√© les gars de mon IRC √† m'appeler magique.  J'esp√®re que ce message servira de documentation fiable √† quelqu'un afin de tout lancer de la m√™me mani√®re, mais avec des noyaux et des versions de syst√®me d'exploitation plus r√©cents. <br><br><h3>  Personnalisation </h3><br>  La configuration du mode utilisateur Linux prend plusieurs √©tapes: <br><br><ul><li>  installation de d√©pendances sur l'h√¥te; </li><li>  T√©l√©chargement du noyau Linux </li><li>  configuration de l'assemblage du noyau; </li><li>  assemblage du noyau; </li><li>  installation binaire; </li><li>  configuration du syst√®me de fichiers invit√©; </li><li>  s√©lection des param√®tres de lancement du noyau; </li><li>  configuration du r√©seau invit√©; </li><li>  d√©marrage du noyau invit√©. </li></ul><br>  Je suppose que si vous d√©cidez de tout lancer vous-m√™me, vous ferez probablement tout ce qui est d√©crit dans certains syst√®mes Ubuntu ou Debian.  J'ai essay√© d'impl√©menter tout ce qui pr√©c√®de dans ma distribution pr√©f√©r√©e - Alpine, mais rien n'en est sorti, apparemment, car le noyau Linux avait une liaison stricte sur les glibc-isms pour les pilotes en mode utilisateur.  J'ai l'intention de signaler cela √† l'amont apr√®s avoir enfin compris le probl√®me. <br><br><h3>  Installer les d√©pendances sur l'h√¥te </h3><br>  Ubuntu n√©cessite au moins les packages suivants pour construire le noyau Linux (√† condition d'une installation propre): <br><br> <code>- 'build-essential' <br> - 'flex' <br> - 'bison' <br> - 'xz-utils' <br> - 'wget' <br> - 'ca-certificates' <br> - 'bc' <br> - 'linux-headers'</code> <br> <br>  Vous pouvez les installer en utilisant la commande suivante (avec les privil√®ges root ou en utilisant sudo): <br><br><pre> <code class="xml hljs">apt-get -y install build-essential flex bison xz-utils wget ca-certificates bc \ linux-headers-$(uname -r)</code> </pre> <br>  Notez que l'ex√©cution du programme de configuration du menu pour le noyau Linux n√©cessitera l'installation de <code>libncurses-dev</code> .  Veuillez vous assurer qu'il est install√© √† l'aide de la commande suivante (avec les privil√®ges root ou avec sudo): <br><br><pre> <code class="xml hljs">apt-get -y install libncurses-dev</code> </pre> <br><h3>  T√©l√©chargement du noyau </h3><br>  D√©terminez l'emplacement de chargement et d'assemblage ult√©rieur du noyau.  Pour cette op√©ration, vous devrez allouer environ 1,3 Go d'espace disque dur, alors assurez-vous d'en avoir un. <br><br>  Allez ensuite sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kernel.org</a> et obtenez l'URL pour t√©l√©charger la derni√®re version stable du noyau.  Au moment de la r√©daction de cet article: <a href="">https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</a> <br><br>  T√©l√©chargez ce fichier en utilisant <code>'wget'</code> : <br><br><pre> <code class="xml hljs">wget https://cdn.kernel.org/pub/linux/kernel/v5.x/linux-5.1.16.tar.xz</code> </pre> <br>  Et extrayez-le avec <code>'tar'</code> : <br><br><pre> <code class="xml hljs">tar xJf linux-5.1.16.tar.xz</code> </pre> <br>  Maintenant, nous entrons dans le r√©pertoire cr√©√© lors du d√©ballage de l'archive tar: <br><br><pre> <code class="xml hljs">cd linux-5.1.16</code> </pre> <br><h3>  Configuration de la construction du noyau </h3><br>  Le syst√®me de construction du noyau est une collection de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Makefiles</a> avec de <b>nombreux</b> outils et scripts personnalis√©s pour automatiser le processus.  Pour commencer, ouvrez le programme d'installation en ligne: <br><br><pre> <code class="xml hljs">make ARCH=um menuconfig</code> </pre> <br>  Il terminera partiellement l'assemblage et affichera une bo√Æte de dialogue pour vous.  Lorsque ¬´ <code>[Select]</code> ¬ª s'affiche en bas de la fen√™tre, vous pouvez effectuer la configuration √† l'aide des touches Espace ou Entr√©e.  Navigation sur la fen√™tre, comme d'habitude, avec les fl√®ches haut et bas du clavier, et la s√©lection des √©l√©ments - ¬´gauche¬ª ou ¬´droite¬ª. <br><br>  Un pointeur de vue ---&gt; signifie que vous vous trouvez dans un sous-menu accessible par la touche Entr√©e.  Le moyen de s'en sortir est √©videmment par ¬´ <code>[Exit]</code> ¬ª. <br><br>  Incluez les param√®tres suivants dans ¬´ <code>[Select]</code> ¬ª et assurez-vous qu'il y a un symbole ¬´[*]¬ª √† c√¥t√© d'eux: <br><br><pre> <code class="xml hljs">UML-specific Options: - Host filesystem Networking support (enable this to get the submenu to show up): - Networking options: - TCP/IP Networking UML Network devices: - Virtual network device - SLiRP transport</code> </pre> <br>  Tout de cette fen√™tre peut √™tre quitt√© en s√©lectionnant s√©quentiellement ¬´ <code>[Exit]</code> ¬ª.  Assurez-vous simplement qu'√† la fin, vous √™tes invit√© √† enregistrer la configuration et s√©lectionnez ¬´ <code>[Yes]</code> ¬ª. <br><br>  Je vous recommande de jouer avec les options de construction du noyau apr√®s avoir lu ce post.  Gr√¢ce √† ces exp√©riences, vous pouvez en apprendre beaucoup en termes de compr√©hension du travail de la m√©canique du noyau de bas niveau et de l'influence de diff√©rents drapeaux sur son assemblage. <br><br><h3>  Assemblage du noyau </h3><br>  Le noyau Linux est un excellent programme qui fait beaucoup de choses.  M√™me avec une configuration aussi minimale sur un ancien √©quipement, son assemblage peut prendre un certain temps.  Par cons√©quent, cr√©ez le noyau avec la commande suivante: <br><br><pre> <code class="xml hljs">make ARCH=um -j$(nproc)</code> </pre> <br>  Pourquoi?  Cette commande indiquera √† notre assembleur d'utiliser tous les c≈ìurs et threads de processeur disponibles pendant le processus de g√©n√©ration.  La commande <code>$(nproc)</code> √† la fin de Build remplace la sortie de la <code>nproc</code> , qui fait partie de <code>coreutils</code> dans la build Ubuntu standard. <br><br>  Apr√®s un certain temps, notre noyau sera compil√© dans un fichier ex√©cutable <code>./linux</code> . <br><br><h3>  Installation binaire </h3><br>  Puisque le mode utilisateur sur Linux cr√©e un binaire normal, vous pouvez l'installer comme n'importe quel autre utilitaire.  Voici comment je l'ai fait: <br><br><pre> <code class="xml hljs">mkdir -p ~/bin cp linux ~/bin/linux</code> </pre> <br>  Cela vaut √©galement la peine de v√©rifier que <code>~/bin</code> est dans votre <code>$PATH</code> : <br><br><pre> <code class="xml hljs">export PATH=$PATH:$HOME/bin</code> </pre> <br><h3>  Configuration du syst√®me de fichiers invit√© </h3><br>  Cr√©ez un r√©pertoire pour le syst√®me de fichiers invit√©: <br><br><pre> <code class="xml hljs">mkdir -p $HOME/prefix/uml-demo cd $HOME/prefix</code> </pre><br>  Ouvrez alpinelinux.org et dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la section des t√©l√©chargements,</a> trouvez le lien actuel pour t√©l√©charger <code>MINI ROOT FILESYSTEM</code> .  Au moment d'√©crire ces lignes, c'√©tait: <br><br><pre> <code class="xml hljs">http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  T√©l√©chargez cette archive tar en utilisant wget: <br><br><pre> <code class="xml hljs">wget -O alpine-rootfs.tgz http://dl-cdn.alpinelinux.org/alpine/v3.10/releases/x86_64/alpine-minirootfs-3.10.0-x86_64.tar.gz</code> </pre> <br>  Entrez maintenant dans le r√©pertoire du syst√®me de fichiers invit√© et d√©compressez l'archive: <br><br><pre> <code class="xml hljs">cd uml-demo tar xf ../alpine-rootfs.tgz</code> </pre> <br>  Les √©tapes d√©crites cr√©eront un petit mod√®le de syst√®me de fichiers.  En raison de la nature du syst√®me, l'installation de packages via Alpine Apk Manager sera extr√™mement difficile.  Mais ce FS suffira pour √©valuer l'id√©e g√©n√©rale. <br><br>  Nous avons √©galement besoin de l'outil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tini</a> pour supprimer la consommation de m√©moire par les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">processus zombies de</a> notre noyau invit√©. <br><br><pre> <code class="xml hljs">wget -O tini https://github.com/krallin/tini/releases/download/v0.18.0/tini-static chmod +x tini</code> </pre> <br><h3>  Cr√©ation d'une ligne de commande du noyau </h3><br>  Le noyau Linux, comme la plupart des autres programmes, poss√®de des arguments de ligne de commande accessibles en sp√©cifiant le commutateur <code>--help</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Sam - aide</b> <div class="spoiler_text"><pre> <code class="xml hljs">linux --help User Mode Linux v5.1.16 available at http://user-mode-linux.sourceforge.net/ --showconfig Prints the config file that this UML binary was generated from. iomem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> Configure <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag">&gt;</span></span> as an IO memory region named <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>. mem=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Amount</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">desired</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ram</span></span></span><span class="hljs-tag">&gt;</span></span> This controls how much "physical" memory the kernel allocates for the system. The size is specified as a number followed by one of 'k', 'K', 'm', 'M', which have the obvious meanings. This is not related to the amount of memory in the host. It can be more, and the excess, if it's ever used, will just be swapped out. Example: mem=64M --help Prints this message. debug this flag is not needed to run gdb on UML in skas mode root=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">file</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">containing</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">the</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fs</span></span></span><span class="hljs-tag">&gt;</span></span> This is actually used by the generic kernel in exactly the same way as in any other kernel. If you configure a number of block devices and want to boot off something other than ubd0, you would use something like: root=/dev/ubd5 --version Prints the version number of the kernel. umid=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> This is used to assign a unique identity to this UML machine and is used for naming the pid file and management console socket. con[0-9]*=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">&gt;</span></span> Attach a console or serial line to a host channel. See http://user-mode-linux.sourceforge.net/old/input.html for a complete description of this switch. eth[0-9]+=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">transport</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">options</span></span></span><span class="hljs-tag">&gt;</span></span> Configure a network device. aio=2.4 This is used to force UML to use 2.4-style AIO even when 2.6 AIO is available. 2.4 AIO is a single thread that handles one request at a time, synchronously. 2.6 AIO is a thread which uses the 2.6 AIO interface to handle an arbitrary number of pending requests. 2.6 AIO is not available in tt mode, on 2.4 hosts, or when UML is built with /usr/include/linux/aio_abi.h not available. Many distributions don't include aio_abi.h, so you will need to copy it from a kernel tree to your /usr/include/linux in order to build an AIO-capable UML nosysemu Turns off syscall emulation patch for ptrace (SYSEMU). SYSEMU is a performance-patch introduced by Laurent Vivier. It changes behaviour of ptrace() and helps reduce host context switch rates. To make it work, you need a kernel patch for your host, too. See http://perso.wanadoo.fr/laurent.vivier/UML/ for further information. uml_dir=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">directory</span></span></span><span class="hljs-tag">&gt;</span></span> The location to place the pid and umid files. quiet Turns off information messages during boot. hostfs=<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dir</span></span></span><span class="hljs-tag">&gt;</span></span>,<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">flags</span></span></span><span class="hljs-tag">&gt;</span></span>,... This is used to set hostfs parameters. The root directory argument is used to confine all hostfs mounts to within the specified directory tree on the host. If this isn't specified, then a user inside UML can mount anything on the host that's accessible to the user that's running it. The only flag currently supported is 'append', which specifies that all files opened by hostfs will be opened in append mode.</code> </pre> <br></div></div><br>  Cette banni√®re √©claire les principales options de lancement.  Lan√ßons le noyau avec l'ensemble d'options minimal requis: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ init=/bin/sh</code> </pre> <br>  Les lignes ci-dessus indiquent √† notre noyau ce qui suit: <br><br><ul><li>  Supposons que le syst√®me de fichiers racine soit le pseudo p√©riph√©rique <code>/dev/root</code> . </li><li>  Choisissez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hostfs</a> comme pilote du syst√®me de fichiers racine. </li><li>  Montez le syst√®me de fichiers invit√© que nous avons cr√©√© sur le p√©riph√©rique racine. </li><li>  Et oui, en mode lecture-√©criture. </li><li>  Utilisez seulement 64 m√©gaoctets de RAM (vous pouvez en utiliser beaucoup moins, selon ce que vous pr√©voyez de faire, mais 64 Mo semblent √™tre la taille optimale). </li><li>  Le noyau d√©marre automatiquement <code>/bin/sh</code> tant que processus d' <code>init</code> . </li></ul><br>  Ex√©cutez cette commande et vous devriez obtenir quelque chose comme ceci: <br><br><div class="spoiler">  <b class="spoiler_title">Une autre feuille</b> <div class="spoiler_text"><pre> <code class="xml hljs">Core dump limits : soft - 0 hard - NONE Checking that ptrace can change system call numbers...OK Checking syscall emulation patch for ptrace...OK Checking advanced syscall emulation patch for ptrace...OK Checking environment variables for a tempdir...none found Checking if /dev/shm is on tmpfs...OK Checking PROT_EXEC mmap in /dev/shm...OK Adding 32137216 bytes to physical memory to account for exec-shield gap Linux version 5.1.16 (cadey@kahless) (gcc version 7.4.0 (Ubuntu 7.4.0-1ubuntu1~18.04.1)) #30 Sun Jul 7 18:57:19 UTC 2019 Built 1 zonelists, mobility grouping on. Total pages: 23898 Kernel command line: root=/dev/root rootflags=/home/cadey/dl/uml/alpine rootfstype=hostfs rw mem=64M init=/bin/sh Dentry cache hash table entries: 16384 (order: 5, 131072 bytes) Inode-cache hash table entries: 8192 (order: 4, 65536 bytes) Memory: 59584K/96920K available (2692K kernel code, 708K rwdata, 588K rodata, 104K init, 244K bss, 37336K reserved, 0K cma-reserved) SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=1, Nodes=1 NR_IRQS: 15 clocksource: timer: mask: 0xffffffffffffffff max_cycles: 0x1cd42e205, max_idle_ns: 881590404426 ns Calibrating delay loop... 7479.29 BogoMIPS (lpj=37396480) pid_max: default: 32768 minimum: 301 Mount-cache hash table entries: 512 (order: 0, 4096 bytes) Mountpoint-cache hash table entries: 512 (order: 0, 4096 bytes) Checking that host ptys support output SIGIO...Yes Checking that host ptys support SIGIO on close...No, enabling workaround devtmpfs: initialized random: get_random_bytes called from setup_net+0x48/0x1e0 with crng_init=0 Using 2.6 host AIO clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 19112604462750000 ns futex hash table entries: 256 (order: 0, 6144 bytes) NET: Registered protocol family 16 clocksource: Switched to clocksource timer NET: Registered protocol family 2 tcp_listen_portaddr_hash hash table entries: 256 (order: 0, 4096 bytes) TCP established hash table entries: 1024 (order: 1, 8192 bytes) TCP bind hash table entries: 1024 (order: 1, 8192 bytes) TCP: Hash tables configured (established 1024 bind 1024) UDP hash table entries: 256 (order: 1, 8192 bytes) UDP-Lite hash table entries: 256 (order: 1, 8192 bytes) NET: Registered protocol family 1 console [stderr0] disabled mconsole (version 2) initialized on /home/cadey/.uml/tEwIjm/mconsole Checking host MADV_REMOVE support...OK workingset: timestamp_bits=62 max_order=14 bucket_order=0 Block layer SCSI generic (bsg) driver version 0.4 loaded (major 254) io scheduler noop registered (default) io scheduler bfq registered loop: module loaded NET: Registered protocol family 17 Initialized stdio console driver Using a channel type which is configured out of UML setup_one_line failed for device 1 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 2 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 3 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 4 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 5 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 6 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 7 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 8 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 9 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 10 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 11 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 12 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 13 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 14 : Configuration failed Using a channel type which is configured out of UML setup_one_line failed for device 15 : Configuration failed Console initialized on /dev/tty0 console [tty0] enabled console [mc-1] enabled Failed to initialize ubd device 0 :Couldn't determine size of device's file VFS: Mounted root (hostfs filesystem) on device 0:11. devtmpfs: mounted This architecture does not have kernel memory protection. Run /bin/sh as init process /bin/sh: can't access tty; job control turned off random: fast init done / #</code> </pre> <br></div></div><br>  La manipulation de ce qui pr√©c√®de nous donnera un <b>syst√®me invit√© au minimum</b> , sans choses comme <code>/proc</code> ou un nom d'h√¥te attribu√©.  Par exemple, essayez les commandes suivantes: <br><br> <code>- uname -av <br> - cat /proc/self/pid <br> - hostname</code> <br> <br>  Pour quitter le syst√®me invit√©, tapez <code>exit</code> ou appuyez sur control-d.  Cela tirera la coquille suivie d'une panique du noyau: <br><br><pre> <code class="xml hljs">/ # exit Kernel panic - not syncing: Attempted to kill init! exitcode=0x00000000 fish: ‚Äú./linux root=/dev/root rootflag‚Ä¶‚Äù terminated by signal SIGABRT (Abort)</code> </pre> <br>  Nous avons eu cette panique du noyau parce que le noyau Linux croit que le processus d'initialisation est toujours en cours d'ex√©cution.  Sans cela, le syst√®me ne peut plus fonctionner et s'arr√™te.  Mais comme il s'agit d'un processus en mode utilisateur, le r√©sultat se transmet √† <code>SIGABRT</code> , ce qui conduit √† la sortie. <br><br><h3>  Configuration du r√©seau invit√© </h3><br>  Et ici, chez nous, tout commence √† ne pas se d√©rouler comme pr√©vu.  Le r√©seau en mode utilisateur Linux est l'endroit o√π tout le concept d'un ¬´mode utilisateur¬ª limit√© commence √† s'effondrer.  Apr√®s tout, g√©n√©ralement au niveau du syst√®me, le r√©seau est limit√© √† <b>des</b> modes d'ex√©cution <b>privil√©gi√©s</b> pour nous tous des raisons claires. <br><br>  <i>Remarque</i>  <i>trans.: plus d'informations sur les diff√©rentes options pour travailler avec un r√©seau en UML peuvent √™tre lues <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .</i> <br><br><h3>  Voyage √† Slirp </h3><br>  Cependant, il existe un outil ancien et presque non pris en charge appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Slirp</a> , avec lequel le mode utilisateur Linux peut interagir avec le r√©seau.  Il fonctionne √† peu pr√®s comme une pile TCP / IP au niveau de l'utilisateur et ne n√©cessite aucune autorisation syst√®me pour s'ex√©cuter.  Cet outil a √©t√© <b>publi√© en 1995</b> et la derni√®re mise √† jour remonte √† <b>2006</b> .  Slirp est tr√®s vieux.  Pendant un temps sans support ni mises √† jour, les compilateurs sont all√©s si loin que maintenant cet outil ne peut √™tre d√©crit que comme une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´pourriture de code¬ª</a> . <br><br>  Alors, roulons Slirp √† partir des r√©f√©rentiels Ubuntu et essayons de l'ex√©cuter: <br><br><pre> <code class="xml hljs">sudo apt-get install slirp /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... fish: ‚Äú/usr/bin/slirp‚Äù terminated by signal SIGSEGV (Address boundary error)</code> </pre> <br>  Oh dieux.  Installons un d√©bogueur pour Slirp et voyons si nous pouvons comprendre ce qui se passe ici: <br><br><pre> <code class="xml hljs">sudo apt-get install gdb slirp-dbgsym gdb /usr/bin/slirp GNU gdb (Ubuntu 8.1-0ubuntu3) 8.1.0.20180409-git Copyright (C) 2018 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">licenses</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gpl.html</span></span></span><span class="hljs-tag">&gt;</span></span> This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type "show copying" and "show warranty" for details. This GDB was configured as "x86_64-linux-gnu". Type "show configuration" for configuration details. For bug reporting instructions, please see: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bugs</span></span></span><span class="hljs-tag">/&gt;</span></span>. Find the GDB manual and other documentation resources online at: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">http:</span></span></span><span class="hljs-tag">//</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">www.gnu.org</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">software</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">gdb</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">documentation</span></span></span><span class="hljs-tag">/&gt;</span></span>. For help, type "help". Type "apropos word" to search for commands related to "word"... Reading symbols from /usr/bin/slirp...Reading symbols from /usr/lib/debug/.build-id/c6/2e75b69581a1ad85f72ac32c0d7af913d4861f.debug...done. done. (gdb) run Starting program: /usr/bin/slirp Slirp v1.0.17 (BETA) Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500, 115200 baud] SLiRP Ready ... Program received signal SIGSEGV, Segmentation fault. ip_slowtimo () at ip_input.c:457 457 ip_input.c: No such file or directory.</code> </pre> <br>  L'erreur bat dans <a href="">cette ligne</a> .  Regardons stacktrace, peut-√™tre que quelque chose nous y aidera: <br><br><pre> <code class="xml hljs">(gdb) bt full #0 ip_slowtimo () at ip_input.c:457 fp = 0x55784a40 #1 0x000055555556a57c in main_loop () at ./main.c:980 so = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> so_next = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> timeout = {tv_sec = 0, tv_usec = 0} ret = 0 nfds = 0 ttyp = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> ttyp2 = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> best_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> tmp_time = <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">optimized</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">out</span></span></span><span class="hljs-tag">&gt;</span></span> #2 0x000055555555b116 in main (argc=1, argv=0x7fffffffdc58) at ./main.c:95 No locals.</code> </pre> <br>  Ici, nous voyons qu'un √©chec se produit au d√©but de la boucle principale, lorsque slirp essaie de v√©rifier les d√©lais d'attente.  √Ä ce stade, j'ai d√ª renoncer √† essayer de d√©boguer.  Mais voyons si Slirp compil√© √† partir de tris fonctionne.  J'ai recharg√© l'archive directement depuis le site Web de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sourceforge</a> , car faire glisser quelque chose √† partir de l√† via la ligne de commande est une douleur: <br><br><pre> <code class="xml hljs">cd ~/dl wget https://xena.greedo.xeserv.us/files/slirp-1.0.16.tar.gz tar xf slirp-1.0.16.tar.gz cd slirp-1.0.16/src ./configure --prefix=$HOME/prefix/slirp make</code> </pre> <br>  Ici, nous voyons des alertes sur les fonctions int√©gr√©es non d√©finies, c'est-√†-dire sur l'impossibilit√© de lier le fichier binaire r√©sultant.  Il semble qu'entre 2006 et ce moment, gcc ait cess√© de cr√©er des caract√®res utilis√©s dans les fonctions int√©gr√©es des fichiers compil√©s interm√©diaires.  Essayons de remplacer le <code>inline</code> par un commentaire vide et regardons le r√©sultat: <br><br><pre> <code class="xml hljs">vi slirp.h :6 a <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enter</span></span></span><span class="hljs-tag">&gt;</span></span> #define inline /**/ <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">escape</span></span></span><span class="hljs-tag">&gt;</span></span> :wq make</code> </pre> <br>  Non.  Cela ne fonctionne pas non plus.  Vous ne trouvez toujours pas les caract√®res de ces fonctions. <br><br>  √Ä ce stade, j'ai abandonn√© et j'ai commenc√© √† chercher des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">packages de construction Heroku</a> sur Github.  Ma th√©orie √©tait bas√©e sur le fait que certains paquets de construction Heroku contiendront les binaires dont j'ai besoin.  En cons√©quence, la recherche m'a conduit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  J'ai t√©l√©charg√© et d√©compress√© <code>uml.tar.gz</code> et <code>uml.tar.gz</code> trouv√© ce qui suit: <br><br><pre> <code class="xml hljs">total 6136 -rwxr-xr-x 1 cadey cadey 79744 Dec 10 2017 ifconfig* -rwxr-xr-x 1 cadey cadey 373 Dec 13 2017 init* -rwxr-xr-x 1 cadey cadey 149688 Dec 10 2017 insmod* -rwxr-xr-x 1 cadey cadey 66600 Dec 10 2017 route* -rwxr-xr-x 1 cadey cadey 181056 Jun 26 2015 slirp* -rwxr-xr-x 1 cadey cadey 5786592 Dec 15 2017 uml* -rwxr-xr-x 1 cadey cadey 211 Dec 13 2017 uml_run*</code> </pre> <br>  Ceci est un fichier slirp binaire!  Travaille-t-il? <br><br><pre> <code class="xml hljs">./slirp Slirp v1.0.17 (BETA) FULL_BOLT Copyright (c) 1995,1996 Danny Gasparovski and others. All rights reserved. This program is copyrighted, free software. Please read the file COPYRIGHT that came with the Slirp package for the terms and conditions of the copyright. IP address of Slirp host: 127.0.0.1 IP address of your DNS(s): 1.1.1.1, 10.77.0.7 Your address is 10.0.2.15 (or anything else you want) Type five zeroes (0) to exit. [autodetect SLIP/CSLIP, MTU 1500, MRU 1500] SLiRP Ready ...</code> </pre><br>  Ne tombe pas en panne - cela devrait donc fonctionner!  <code>~/bin/slirp</code> ce binaire dans <code>~/bin/slirp</code> : <br><br><pre> <code class="xml hljs">cp slirp ~/bin/slirp</code> </pre> <br>  Dans le cas o√π le cr√©ateur du package l'enl√®ve, j'ai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait un miroir</a> . <br><br><h3>  Configuration du r√©seau </h3><br>  Maintenant, configurons le r√©seau sur notre noyau invit√©.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mettre √† jour les options de lancement</a> : <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/bin/sh</code> </pre> <br>  Allumons maintenant le r√©seau: <br><br><pre> <code class="xml hljs">mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2</code> </pre> <br>  Les deux premi√®res commandes de configuration <code>/proc</code> et <code>/sys</code> n√©cessaires au fonctionnement d' <code>ifconfig</code> , qui configure une interface r√©seau pour communiquer avec Slirp.  La commande <code>route</code> configure une table de routage du noyau pour forcer tout le trafic √† travers le tunnel Slirp.  V√©rifions cela avec une requ√™te DNS: <br><br><pre> <code class="xml hljs">nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4006:81b::200e lga25s63-in-x0e.1e100.net</code> </pre> <br>  √áa marche! <br><br>  <i>Remarque: Apparemment, le message d'origine a √©t√© √©crit sur le bureau avec une carte r√©seau filaire ou une autre configuration qui ne n√©cessite pas de pilotes suppl√©mentaires.</i>  <i>Sur un ordinateur portable avec WiFi 8265 d'Intel, lorsque vous augmentez le r√©seau, une erreur se produit</i> <br><br><pre> <code class="bash hljs">/ <span class="hljs-comment"><span class="hljs-comment"># ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 slirp_tramp failed - errno = 2 ifconfig: ioctl 0x8914 failed: No such file or directory / #</span></span></code> </pre> <br>  <i>Apparemment, le noyau ne peut pas communiquer avec le pilote r√©seau.</i>  <i>Malheureusement, une tentative de compilation du micrologiciel dans le noyau n'a pas r√©solu le probl√®me.</i>  <i>Au moment de la publication, il n'√©tait pas possible de trouver une solution dans cette configuration particuli√®re.</i>  <i>Sur des configurations plus simples (par exemple, dans Virtualbox) l'interface monte correctement.</i> <br><br>  Automatisons la redirection √† l'aide du script shell suivant: <br><br><pre> <code class="xml hljs">#!/bin/sh # init.sh mount -t proc proc proc/ mount -t sysfs sys sys/ ifconfig eth0 10.0.2.14 netmask 255.255.255.240 broadcast 10.0.2.15 route add default gw 10.0.2.2 echo "networking set up" exec /tini /bin/sh</code> </pre> <br>  Et marquez-le comme ex√©cutable: <br><br><pre> <code class="xml hljs">chmod +x init.sh</code> </pre> <br>  Et puis apportez des modifications √† la ligne de commande du noyau: <br><br><pre> <code class="xml hljs">linux \ root=/dev/root \ rootfstype=hostfs \ rootflags=$HOME/prefix/uml-demo \ rw \ mem=64M \ eth0=slirp,,$HOME/bin/slirp \ init=/init.sh</code> </pre><br>  Et r√©p√©tez: <br><br><pre> <code class="xml hljs">SLiRP Ready ... networking set up /bin/sh: can't access tty; job control turned off nslookup google.com 8.8.8.8 Server: 8.8.8.8 Address 1: 8.8.8.8 dns.google Name: google.com Address 1: 172.217.12.206 lga25s63-in-f14.1e100.net Address 2: 2607:f8b0:4004:800::200e iad30s09-in-x0e.1e100.net</code> </pre> <br>  Le r√©seau est stable! <br><br><h3>  Fichier Docker </h3><br>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dockerfile</a> ,           .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a> ,    ,    .   ,       . <br><br><hr><br>  ,      ,    .  - ,          ,    User Mode  Linux       .                .     Docker ‚Äî    tar-,         <code>docker export</code> ,            . ,    shell-. <br><br>   Rkeene  #lobsters  Freenode.      Slirp      .    ,    Slackware    slirp,    Ubuntu  Alpine   slirp    Rkeene .     ,      -. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459558/">https://habr.com/ru/post/fr459558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459542/index.html">M√©canique de la gamification: arbre de comp√©tences</a></li>
<li><a href="../fr459544/index.html">Pourquoi la s√©rie de Tchernobyl d√©crit si mal l'√©nergie nucl√©aire</a></li>
<li><a href="../fr459550/index.html">Sauvegarde, Partie 5: Test de Bacula et Veeam Backup pour Linux</a></li>
<li><a href="../fr459552/index.html">Comment perdre l'acc√®s au syst√®me en direct en t√¢tonnant simplement le code source</a></li>
<li><a href="../fr459554/index.html">Gardez une trace des modifications de fichiers √† l'aide de Alerting OpenDistro for Elasticsearch</a></li>
<li><a href="../fr459560/index.html">Capacit√©s des centres de donn√©es de conteneurs: centre de commutation pr√™t √† l'emploi au Myanmar en 50 jours</a></li>
<li><a href="../fr459562/index.html">Programmation diff√©renciable</a></li>
<li><a href="../fr459564/index.html">Ce que les d√©veloppeurs doivent savoir sur l'entreprise</a></li>
<li><a href="../fr459568/index.html">Lettre verticale dans l'informatique moderne</a></li>
<li><a href="../fr459570/index.html">Beeline montre des annonces √† Google bot. Bot m√©content</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>