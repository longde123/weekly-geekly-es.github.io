<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêõ ü§≥üèº üëàüèΩ Wir beherrschen Async / Warten auf ein echtes Beispiel üêß üñêüèΩ üèë</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Das Konstrukt async / await ist ein relativ neuer Ansatz zum Schreiben von asynchronem Code in JavaScript. Es basiert auf Versprechungen und blockiert...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir beherrschen Async / Warten auf ein echtes Beispiel</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/436884/">  Das Konstrukt async / await ist ein relativ neuer Ansatz zum Schreiben von asynchronem Code in JavaScript.  Es basiert auf Versprechungen und blockiert daher nicht den Hauptstrom.  Die Innovation dieses Designs besteht darin, dass asynchroner Code dank ihm dem synchronen √§hnlich wird und sich √§hnlich verh√§lt.  Dies er√∂ffnet dem Programmierer gro√üe M√∂glichkeiten. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/537/9dd/4fe/5379dd4feb58df31f90432e428f37118.png" alt="Bild"></a> <br><br>  Vor dem Aufkommen von async / await wurden R√ºckrufe und Versprechen bei der Entwicklung asynchroner Programmmechanismen verwendet.  Der Autor des Materials, dessen √úbersetzung wir heute ver√∂ffentlichen, schl√§gt vor, dass Sie sich zuerst daran erinnern, wie man Code auf die alte Weise schreibt, und dann anhand eines realen Beispiels die Verwendung von async / await untersuchen. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">R√ºckrufe</font> </h2><br>  Hier ist ein Beispielcode, der R√ºckrufe (R√ºckruffunktionen) verwendet: <br><br><pre><code class="javascript hljs">setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {  <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'This runs after 1000 milliseconds.'</span></span>); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>);</code> </pre> <br>  Bei Verwendung der verschachtelten R√ºckruffunktionen tritt ein Problem auf, das als R√ºckrufh√∂lle bezeichnet wird.  Hier ist ein vereinfachtes Codebeispiel, um dieses Problem zu veranschaulichen: <br><br><pre> <code class="javascript hljs">asyncCallOne(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { asyncCallTwo(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   asyncCallThree(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     asyncCallFour(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {       asyncCallFive(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {         <span class="hljs-comment"><span class="hljs-comment">//         })     })   }) }) })</span></span></code> </pre> <br>  Wenn der Code Strukturen enth√§lt, die aus ineinander verschachtelten R√ºckrufen bestehen, ist ein solcher Code m√∂glicherweise schwer zu verstehen und schwer zu pflegen. <br><br><h2>  <font color="#3AC1EF">Versprechen</font> </h2><br>  Hier ist ein Beispielcode, der Versprechen verwendet (Versprechenobjekte): <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promiseFunction = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> add = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b</span></span></span><span class="hljs-function">) =&gt;</span></span> a + b; resolve(add(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); }); promiseFunction.then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(response); }).catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error); });</code> </pre> <br>  Die Funktion <code>promiseFunction()</code> aus diesem Beispiel gibt ein <code>Promise</code> Objekt zur√ºck, bei dem es sich um eine bestimmte Aktion handelt, die von der Funktion ausgef√ºhrt wird.  Ein Aufruf der Methode <code>resolve()</code> zeigt an, dass der Vorgang erfolgreich abgeschlossen wurde.  In solchen Konstruktionen wird auch die Versprechungsmethode <code>.then()</code> verwendet. Mit ihrer Hilfe k√∂nnen Sie nach erfolgreicher L√∂sung des Versprechens einen bestimmten R√ºckruf ausf√ºhren.  Die <code>.catch()</code> -Methode wird aufgerufen, wenn w√§hrend der Arbeit des Versprechens ein <code>.catch()</code> ist. <br><br><h2>  <font color="#3AC1EF">Asynchrone Funktionen</font> </h2><br>  Mit dem <code>async</code> Funktionen (asynchrone Funktionen) bieten uns die M√∂glichkeit, Code zu schreiben, der ordentlich und nicht mit Servicekonstrukten √ºberladen ist, sodass wir das gleiche Ergebnis erzielen k√∂nnen, das wir mit Versprechungen erhalten haben.  Es sollte beachtet werden, dass das <code>async</code> im Wesentlichen nur "syntaktischer Zucker" f√ºr Versprechen ist. <br><br>  Asynchrone Funktionen werden beim Deklarieren einer Funktion mit dem Schl√ºsselwort <code>async</code> erstellt.  Es sieht so aus: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> asyncFunction = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> () =&gt; { <span class="hljs-comment"><span class="hljs-comment">//  }</span></span></code> </pre> <br>  Asynchrone Funktionen k√∂nnen mit dem Schl√ºsselwort <code>await</code> angehalten werden.  Es kann nur in asynchronen Funktionen verwendet werden.  Sie k√∂nnen das Ergebnis der asynchronen Funktion zur√ºckgeben, das verf√ºgbar ist, nachdem eine solche Funktion die Ausf√ºhrung einer Aufgabe abgeschlossen hat. <br><br>  Vergleichen Sie die Operation einer asynchronen Funktion und ein Versprechen, das eine Zeichenfolge zur√ºckgibt: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   const asyncGreeting = async () =&gt; 'Greetings'; //  const promiseGreeting = () =&gt; new Promise(((resolve) =&gt; { resolve('Greetings'); })); asyncGreeting().then(result =&gt; console.log(result)); promiseGreeting().then(result =&gt; console.log(result));</span></span></code> </pre> <br>  Es ist leicht zu erkennen, dass Sie mit dem <code>async</code> asynchronen Code schreiben k√∂nnen, der synchron aussieht.  Dieser Code ist viel einfacher zu bearbeiten. <br><br>  Nachdem wir die grundlegenden Dinge behandelt haben, fahren wir mit unserem Beispiel fort. <br><br><h2>  <font color="#3AC1EF">W√§hrungsumrechner</font> </h2><br><h3>  <font color="#3AC1EF">‚ñç Vorbereitende Vorbereitung</font> </h3><br>  Hier werden wir eine einfache, aber kognitive Perspektive erstellen, um die Konstruktion der asynchronen / wartenden Anwendung zu untersuchen.  Es ist ein W√§hrungsumrechner, der reale Daten verwendet, die von den entsprechenden APIs erhalten wurden.  Das Programm akzeptiert den Betrag in einer bestimmten W√§hrung, den Code dieser W√§hrung sowie den W√§hrungscode, in den wir diesen Betrag umrechnen m√∂chten.  Danach zeigt das Programm das Ergebnis an, indem zuerst die aktuellen Daten zu den Wechselkursen heruntergeladen werden.  Das Programm zeigt auch eine Liste der L√§nder an, in denen Sie Geld in der W√§hrung ausgeben k√∂nnen, in die der angegebene Betrag √ºberwiesen wird. <br><br>  Insbesondere werden hier Daten aus zwei asynchronen Informationsquellen verwendet: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Currencylayer.com-</a> Dienst.  Auf dieser Site m√ºssen Sie ein kostenloses Konto erstellen und einen Schl√ºssel f√ºr den Zugriff auf die API (API Access Key) erhalten.  Von hier aus nehmen wir die Daten, die f√ºr die Umrechnung des Betrags von einer W√§hrung in eine andere erforderlich sind. </li><li>  Service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">restcountries.eu</a> .  Es kann ohne Registrierung verwendet werden.  Von hier laden wir Daten hoch, wo Sie die W√§hrung verwenden k√∂nnen, in die wir den angegebenen Geldbetrag umgerechnet haben. </li></ol><br>  Erstellen Sie ein neues Verzeichnis und f√ºhren Sie den Befehl <code>npm init</code> darin aus.  Wenn das Programm uns eine Frage zum Namen des zu erstellenden Pakets stellt, werden wir den <code>currency-converter</code> einf√ºhren.  Sie k√∂nnen andere Fragen des Programms nicht beantworten, indem <code>Enter</code> als Antwort die <code>Enter</code> dr√ºcken.  Installieren Sie anschlie√üend das Axios-Paket in unserem Projekt, indem <code>npm install axios --save</code> Befehl <code>npm install axios --save</code> in seinem Verzeichnis <code>npm install axios --save</code> .  Erstellen Sie eine neue Datei mit dem Namen <code>currency-converter.js</code> . <br><br>  Beginnen wir mit dem Schreiben des Programmcodes, indem wir Axios in dieser Datei verbinden: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> axios = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'axios'</span></span>);</code> </pre> <br>  Unser Projekt wird drei asynchrone Funktionen haben.  Der erste l√§dt W√§hrungsdaten.  Der zweite l√§dt L√§nderdaten.  Der dritte sammelt diese Daten, pr√§sentiert sie in einer benutzerfreundlichen Form und zeigt sie auf dem Bildschirm an. <br><br><h3>  <font color="#3AC1EF">‚ñç Die erste Funktion ist das asynchrone Laden von W√§hrungsdaten</font> </h3><br>  Erstellen wir eine asynchrone Funktion <code>getExchangeRate()</code> , die zwei Argumente <code>fromCurrency</code> : <code>fromCurrency</code> und <code>toCurrency</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getExchangeRate = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (fromCurrency, toCurrency) =&gt; {}</code> </pre> <br>  In dieser Funktion m√ºssen wir Daten laden.  Mit dem Konstrukt async / await k√∂nnen Sie die empfangenen Daten direkt in eine bestimmte Variable oder Konstante schreiben.  Vergessen Sie nicht, sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf der Site</a> zu registrieren und einen API-Zugriffsschl√ºssel zu erhalten, bevor Sie den Code f√ºr diese Funktion schreiben.  Zum Laden von Daten ben√∂tigen wir die folgende Konstruktion: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">'http://www.apilayer.net/api/live?access_key=[    API]'</span></span>);</code> </pre> <br>  Nach Erhalt der Systemantwort befinden sich die ben√∂tigten Daten im <code>response</code> unter <code>response.data.quotes</code> .  Hier ist das Fragment des Objekts mit den f√ºr uns interessanten Daten (es ist im Programm als <code>response.data</code> sichtbar): <br><br><pre> <code class="javascript hljs">{  <span class="hljs-string"><span class="hljs-string">"success"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,  <span class="hljs-string"><span class="hljs-string">"terms"</span></span>:<span class="hljs-string"><span class="hljs-string">"https:\/\/currencylayer.com\/terms"</span></span>,  <span class="hljs-string"><span class="hljs-string">"privacy"</span></span>:<span class="hljs-string"><span class="hljs-string">"https:\/\/currencylayer.com\/privacy"</span></span>,  <span class="hljs-string"><span class="hljs-string">"timestamp"</span></span>:<span class="hljs-number"><span class="hljs-number">1547891348</span></span>,  <span class="hljs-string"><span class="hljs-string">"source"</span></span>:<span class="hljs-string"><span class="hljs-string">"USD"</span></span>,  <span class="hljs-string"><span class="hljs-string">"quotes"</span></span>:{     <span class="hljs-string"><span class="hljs-string">"USDAED"</span></span>:<span class="hljs-number"><span class="hljs-number">3.673042</span></span>,     <span class="hljs-string"><span class="hljs-string">"USDAFN"</span></span>:<span class="hljs-number"><span class="hljs-number">75.350404</span></span>,     <span class="hljs-string"><span class="hljs-string">"USDALL"</span></span>:<span class="hljs-number"><span class="hljs-number">109.203989</span></span>, ...     <span class="hljs-string"><span class="hljs-string">"USDZWL"</span></span>:<span class="hljs-number"><span class="hljs-number">322.355011</span></span>  } }</code> </pre> <br>  Platzieren Sie das Objekt mit den Wechselkursen in der <code>rate</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rate = response.data.quotes;</code> </pre> <br>  Den Basisw√§hrungscode finden Sie unter <code>response.data.source</code> .  Wir schreiben den Code der Basisw√§hrung in die Konstante <code>baseCurrency</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseCurrency = response.data.source;</code> </pre> <br>  Da die von dieser API zur√ºckgegebenen Daten standardm√§√üig den Wechselkurs gegen√ºber dem US-Dollar (USD) darstellen, erstellen Sie eine konstante <code>usd</code> , in die wir das Ergebnis der Division von 1 durch den Wechselkurs schreiben, in dem der Betrag angegeben ist: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usd = <span class="hljs-number"><span class="hljs-number">1</span></span> / rate[<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${baseCurrency}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string">`</span></span>];</code> </pre> <br>  Achten Sie darauf, wie der Schl√ºssel gebildet wird, anhand dessen wir den Wert des Kurses erhalten.  In dem von der API erhaltenen Objekt, dessen Fragment oben angegeben ist, sind die Schl√ºssel Zeichenfolgen, die mit <code>USD</code> und mit dem Code der entsprechenden W√§hrung enden.  Da davon ausgegangen wird, dass unser Programm Zeichenfolgenw√§hrungscodes akzeptiert, generieren wir einen Schl√ºssel, indem wir eine Zeichenfolge verketten, die den Basisw√§hrungscode und die Funktion enth√§lt, die im Parameter <code>fromCurrency</code> an die Funktion <code>fromCurrency</code> wird. <br><br>  Um nun den Wechselkurs von <code>fromCurrency</code> zu <code>toCurrence</code> , multiplizieren wir die Konstante <code>usd</code> mit dem Kurs f√ºr <code>toCurrency</code> .  Es sieht so aus: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exchangeRate = usd * rate[<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${baseCurrency}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">`</span></span>];</code> </pre> <br>  Infolgedessen geben wir zur√ºck, was in <code>exchangeRate</code> .  So sieht der vollst√§ndige Code aus: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getExchangeRate = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (fromCurrency, toCurrency) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">'http://www.apilayer.net/api/live?access_key=[    API]'</span></span>);     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rate = response.data.quotes;     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseCurrency = response.data.source;     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usd = <span class="hljs-number"><span class="hljs-number">1</span></span> / rate[<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${baseCurrency}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string">`</span></span>];     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exchangeRate = usd * rate[<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${baseCurrency}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">`</span></span>];     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exchangeRate;   } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`Unable to get currency </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string"> and </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">`</span></span>);   } };</code> </pre> <br>  Beachten Sie, dass das regul√§re try / catch-Konstrukt verwendet wird, um Fehler zu behandeln, die w√§hrend der Ausf√ºhrung der Abfrage auftreten k√∂nnen. <br><br><h3>  <font color="#3AC1EF">‚ñç Die zweite Funktion ist das asynchrone Laden von L√§nderdaten</font> </h3><br>  Unsere zweite Funktion, <code>getCountries()</code> , die asynchron Informationen √ºber L√§nder l√§dt, in denen Sie die W√§hrung verwenden k√∂nnen, in die wir den in einer anderen W√§hrung angegebenen Betrag umrechnen, verwendet das ArgumentrencyCode: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCountries = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (currencyCode) =&gt; {}</code> </pre> <br>  Zum Laden von Daten verwenden wir den folgenden Befehl: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">`https://restcountries.eu/rest/v2/currency/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currencyCode}</span></span></span><span class="hljs-string">`</span></span>);</code> </pre> <br>  Wenn wir zum Beispiel den <code>HRK</code> Code (Croatian Kuna) in der Anfrage verwenden, erhalten wir als Antwort einen JSON-Code, von dem ein Fragment unten gezeigt wird: <br><br><pre> <code class="javascript hljs">[   {     <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"Croatia"</span></span>, ...  } ]</code> </pre> <br>  Es ist eine Reihe von Objekten mit Informationen √ºber L√§nder.  Die Namenseigenschaften dieser Objekte enthalten den Namen des Landes.  Sie k√∂nnen mit dem Konstrukt <code>response.data</code> auf dieses Array zugreifen.  Wir wenden die Array-Methode <code>map()</code> an, um die Namen von L√§ndern aus den empfangenen Daten zu extrahieren und diese Daten von der Funktion <code>getCountries()</code> , bei der es sich um ein Array von L√§ndernamen handelt: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.data.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">country</span></span></span><span class="hljs-function"> =&gt;</span></span> country.name);</code> </pre> <br>  Hier ist der vollst√§ndige Funktionscode von <code>getCountries()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCountries = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (currencyCode) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">`https://restcountries.eu/rest/v2/currency/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currencyCode}</span></span></span><span class="hljs-string">`</span></span>);     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.data.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">country</span></span></span><span class="hljs-function"> =&gt;</span></span> country.name);   } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`Unable to get countries that use </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currencyCode}</span></span></span><span class="hljs-string">`</span></span>);   } };</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçDritte Funktion - Datenerfassung und -ausgabe</font> </h3><br>  Unsere dritte asynchrone Funktion, <code>convertCurrency ()</code> , akzeptiert die Argumente von <code>fromCurrency</code> , <code>toCurrency</code> und <code>amount</code> - W√§hrungscodes und Betrag. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> convertCurrency = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (fromCurrency, toCurrency, amount) =&gt; {}</code> </pre> <br>  Darin erhalten wir zuerst den Wechselkurs: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exchangeRate = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getExchangeRate(fromCurrency, toCurrency);</code> </pre> <br>  Dann laden wir die Liste der L√§nder: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> countries = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getCountries(toCurrency);</code> </pre> <br>  Als n√§chstes f√ºhren wir die Konvertierung durch: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> convertedAmount = (amount * exchangeRate).toFixed(<span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre> <br>  Und nachdem alle erforderlichen Daten gesammelt wurden, geben wir die Zeile zur√ºck, die der Benutzer des Programms sehen wird: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${amount}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string"> is worth </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${convertedAmount}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">. You can spend these in the following countries: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${countries}</span></span></span><span class="hljs-string">`</span></span>;</code> </pre> <br>  Hier ist der vollst√§ndige Funktionscode: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> convertCurrency = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (fromCurrency, toCurrency, amount) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exchangeRate = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getExchangeRate(fromCurrency, toCurrency);   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> countries = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getCountries(toCurrency);   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> convertedAmount = (amount * exchangeRate).toFixed(<span class="hljs-number"><span class="hljs-number">2</span></span>);   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${amount}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string"> is worth </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${convertedAmount}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">. You can spend these in the following countries: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${countries}</span></span></span><span class="hljs-string">`</span></span>; };</code> </pre> <br>  Bitte beachten Sie, dass diese Funktion keinen Try / Catch-Block hat, da sie nur mit den Ergebnissen der beiden zuvor beschriebenen Funktionen funktioniert. <br><br><h3>  <font color="#3AC1EF">‚ñçStarten Sie das Programm</font> </h3><br>  Wir haben drei Funktionen vorbereitet, von denen zwei Daten von verschiedenen Diensten laden, und eine sammelt diese Daten und bereitet die Ausgabe vor.  Jetzt m√ºssen wir nur noch diese Funktion aufrufen und alles √ºbergeben, was wir brauchen.  Wir werden hier keine Mechanismen implementieren, die es erm√∂glichen, unser Programm √ºber die Befehlszeile mit der √úbertragung von W√§hrungs- und Summencodes darauf aufzurufen, obwohl Sie dies tun k√∂nnen, wenn Sie dies w√ºnschen.  Wir rufen einfach die Funktion <code>convertCurrency()</code> und √ºbergeben ihr die erforderlichen Daten: <br><br><pre> <code class="javascript hljs">convertCurrency(<span class="hljs-string"><span class="hljs-string">'EUR'</span></span>, <span class="hljs-string"><span class="hljs-string">'HRK'</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>)   .then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message);   }).catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error.message);   });</code> </pre> <br>  Hier wollen wir herausfinden, wie viel kroatische Kuna gegen 20 Euro eingetauscht werden kann und auf dem Weg herauszufinden, in welchen L√§ndern dieses Geld ausgegeben werden kann. <br><br>  Wir rufen das Programm auf, indem wir den folgenden Befehl in das Terminal eingeben: <br><br><pre> <code class="javascript hljs">node currency-converter.js</code> </pre> <br>  Als Antwort erhalten wir ungef√§hr Folgendes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/e8c/d79/a1de8cd79f378400212325e342fba4eb.png"></div><br>  <i><font color="#999999">Das Ergebnis des Programms</font></i> <br><br>  Hier f√ºr alle F√§lle den vollst√§ndigen Code unseres Projekts. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> axios = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'axios'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getExchangeRate = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (fromCurrency, toCurrency) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">'http://www.apilayer.net/api/live?access_key=[    API]'</span></span>);     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rate = response.data.quotes;     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> baseCurrency = response.data.source;     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usd = <span class="hljs-number"><span class="hljs-number">1</span></span> / rate[<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${baseCurrency}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string">`</span></span>];     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exchangeRate = usd * rate[<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${baseCurrency}</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">`</span></span>];     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> exchangeRate;   } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`Unable to get currency </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${fromCurrency}</span></span></span><span class="hljs-string"> and </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${toCurrency}</span></span></span><span class="hljs-string">`</span></span>);   } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getCountries = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (currencyCode) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">`https://restcountries.eu/rest/v2/currency/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currencyCode}</span></span></span><span class="hljs-string">`</span></span>);     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.data.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">country</span></span></span><span class="hljs-function"> =&gt;</span></span> country.name);   } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`Unable to get countries that use </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${currencyCode}</span></span></span><span class="hljs-string">`</span></span>);   } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> convertCurrency = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (fromCurrency, toCurrency, amount) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> exchangeRate = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getExchangeRate(fromCurrency, toCurrency);   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> countries = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> getCountries(toCurrency);   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> convertedAmount = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">amount * exchangeRate</span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toFixed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span></span><span class="hljs-function">);   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">return</span></span></span><span class="hljs-function"> `</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">{</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">amount</span></span></span><span class="hljs-function">} </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">{</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fromCurrency</span></span></span><span class="hljs-function">} </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">is</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">worth</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">{</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">convertedAmount</span></span></span><span class="hljs-function">} </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">{</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toCurrency</span></span></span><span class="hljs-function">}. </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">You</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">can</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">spend</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">these</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">in</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">the</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">following</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">countries</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">{</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">countries</span></span></span><span class="hljs-function">}`; }; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">convertCurrency</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'EUR'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'HRK'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20</span></span></span></span></span><span class="hljs-function">)   .</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">then</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(message</span></span></span><span class="hljs-function">) =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(message);   }).catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error.message);   });</code> </pre> <br><h2>  <font color="#3AC1EF">Zusammenfassung</font> </h2><br>  Wir hoffen, dass dieses Beispiel der Verwendung des Konstrukts async / await unter realen Bedingungen denjenigen geholfen hat, die dieses Konstrukt zuvor nicht verstanden haben, es herauszufinden. <br><br>  <b>Liebe Leser!</b>  Wenn Sie das Konstrukt async / await in der Praxis verwenden, teilen Sie uns bitte Ihre Eindr√ºcke mit. <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de436884/">https://habr.com/ru/post/de436884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de436872/index.html">PGConf.Russia 2019 kommt bald</a></li>
<li><a href="../de436874/index.html">Neujahrst√§nze rund um den FC-Adapter oder eine Geschichte dar√ºber, wie weit die Ursachen des Problems von den Symptomen entfernt sind</a></li>
<li><a href="../de436876/index.html">[SAP] SAPUI5 f√ºr Dummies Teil 1: Eine vollst√§ndige Schritt-f√ºr-Schritt-√úbung</a></li>
<li><a href="../de436878/index.html">BERT ist ein hochmodernes Sprachmodell f√ºr 104 Sprachen. Tutorial zum lokalen Starten von BERT und in Google Colab</a></li>
<li><a href="../de436880/index.html">Grundlagen der C ++ - Vorlage: Funktionsvorlagen</a></li>
<li><a href="../de436886/index.html">Verwenden von Babel und Webpack zum Einrichten eines React-Projekts von Grund auf neu</a></li>
<li><a href="../de436888/index.html">Geschichte zum Entwerfen einer API</a></li>
<li><a href="../de436890/index.html">React Tutorial Teil 10: Workshop zum Arbeiten mit Komponenteneigenschaften und zum Styling</a></li>
<li><a href="../de436892/index.html">React Tutorial Teil 11: Dynamische Markup-Bildung und die Map-Array-Methode</a></li>
<li><a href="../de436894/index.html">Kriechende IT-Apokalypse. Neue Cloud-Dienste werden einige Ingenieure arbeitslos machen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>