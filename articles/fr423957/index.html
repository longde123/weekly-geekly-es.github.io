<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèΩ üà∏ üêÑ G√©n√©ration de trafic dans l'espace utilisateur üíÜüèø üê¶ üë§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="G√©n√©ration de trafic √† l'aide de MoonGen + DPDK + Lua dans la vue de l'artiste 

 La neutralisation des attaques DDoS en conditions r√©elles n√©cessite ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>G√©n√©ration de trafic dans l'espace utilisateur</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/qrator/blog/423957/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/d4/ab/qb/d4abqbslioh-eskinpe4jhet0y4.jpeg"></div><br>  <i>G√©n√©ration de trafic √† l'aide de MoonGen + DPDK + Lua dans la vue de l'artiste</i> <br><br>  La neutralisation des attaques DDoS en conditions r√©elles n√©cessite des tests pr√©liminaires et des tests de diverses techniques.  L'√©quipement et les logiciels r√©seau doivent √™tre test√©s dans des conditions artificielles proches des conditions r√©elles - avec des flux de trafic intensifs simulant des attaques.  Sans de telles exp√©riences, il est extr√™mement difficile d'obtenir des informations fiables sur les caract√©ristiques sp√©cifiques et les limites de tout outil complexe. <br><br>  Dans cet article, nous allons r√©v√©ler certaines des m√©thodes de g√©n√©ration de trafic utilis√©es dans Qrator Labs. <br><br>  <b>AVERTISSEMENT</b> <br><br>  Nous recommandons fortement au lecteur de ne pas essayer d'utiliser les outils mentionn√©s pour attaquer des objets d'une infrastructure r√©elle.  L'organisation d'attaques DoS est punie par la loi et peut entra√Æner des sanctions s√©v√®res.  Qrator Labs effectue tous les tests dans un environnement de laboratoire isol√©. <br><a name="habracut"></a><br><h2>  Niveau technique moderne </h2><br>  Une t√¢che importante dans notre domaine consiste √† saturer l'interface Ethernet 10G avec de petits paquets, ce qui implique un traitement de 14,88 Mpps (millions de paquets par seconde).  Ci-apr√®s, nous consid√©rons les plus petits paquets de r√©seau Ethernet - 64 octets - car notre principal int√©r√™t est de maximiser le nombre de paquets transmis par unit√© de temps.  Un calcul simple montre que nous avons seulement environ 67 nanosecondes pour traiter un tel paquet. <br><br>  √Ä titre de comparaison, cette fois-ci est proche de ce dont un processeur moderne a besoin pour obtenir un morceau de donn√©es de la m√©moire s'il manque le cache.  Tout devient encore plus compliqu√© lorsque nous commen√ßons √† travailler avec des interfaces Ethernet 40G et 100G et essayons de les saturer compl√®tement jusqu'au d√©bit de ligne (les performances d√©clar√©es maximales possibles du p√©riph√©rique r√©seau). <br><br>  √âtant donn√© que dans le cas habituel, le flux de donn√©es passe par l'application dans l'espace utilisateur (espace utilisateur), puis par le noyau, pour finalement entrer dans le contr√¥leur r√©seau (NIC), la premi√®re et la plus simple id√©e est d'essayer de configurer la g√©n√©ration de paquets directement dans le noyau.  Un exemple d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">une telle solution</a> est le module nucl√©aire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pktgen</a> [2].  Cette m√©thode vous permet d'am√©liorer consid√©rablement les performances, mais pas assez flexible, car le moindre changement dans le code source dans le noyau entra√Æne un long cycle de construction, un red√©marrage des modules du noyau ou m√™me du syst√®me entier et, en fait, des tests, ce qui r√©duit la productivit√© globale (c'est-√†-dire que cela n√©cessite plus de temps de la part du programmeur et effort). <br><br>  Une autre approche possible consiste √† obtenir un acc√®s direct de l'espace utilisateur aux tampons de m√©moire du contr√¥leur de r√©seau.  Ce chemin est plus compliqu√©, mais vaut l'effort pour atteindre une productivit√© plus √©lev√©e.  Les inconv√©nients incluent une grande complexit√© et une faible flexibilit√©.  Des exemples de cette approche sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">netmap</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PF_RING</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DPDK</a> [4]. <br><br>  Un autre moyen efficace, quoique tr√®s co√ªteux, d'atteindre des performances √©lev√©es consiste √† utiliser un √©quipement non universel, mais sp√©cialis√©.  Exemple: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ixia</a> . <br><br>  Il existe √©galement des solutions bas√©es sur DPDK utilisant des scripts, ce qui augmente la flexibilit√© dans le contr√¥le des param√®tres du g√©n√©rateur et vous permet √©galement de varier le type de packages g√©n√©r√©s au d√©marrage.  Ci-dessous, nous d√©crivons notre propre exp√©rience avec l'un de ces outils - MoonGen. <br><br><h2>  Architecture MoonGen </h2><br>  Les caract√©ristiques distinctives de MoonGen sont: <br><br><ol><li>  Le traitement des donn√©es DPDK dans l'espace utilisateur est la principale raison du gain de performances; </li><li>  Lua [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5</a> ] pile avec des scripts simples au niveau sup√©rieur et des liaisons √† la biblioth√®que DPDK √©crite en C, en bas; </li><li>  Gr√¢ce √† la technologie JIT (juste √† temps), les scripts Lua fonctionnent assez rapidement, ce qui contredit quelque peu les id√©es g√©n√©ralement accept√©es sur l'efficacit√© des langages de script. </li></ol><br>  MoonGen peut √™tre consid√©r√© comme un wrapper Lua autour de la biblioth√®que DPDK.  Au moins les op√©rations DPDK suivantes sont visibles au niveau de l'interface utilisateur Lua: <br><br><ul><li>  Configuration des contr√¥leurs de r√©seau; </li><li>  Allocation et acc√®s direct aux pools et tampons de m√©moire, qui, √† des fins d'optimisation, doivent √™tre allou√©s dans des zones align√©es en continu; </li><li>  Acc√®s direct aux files d'attente RSS des contr√¥leurs de r√©seau; </li><li>  API de gestion des flux de calcul, prenant en compte l'h√©t√©rog√©n√©it√© des acc√®s m√©moire (NUMA et affinit√© CPU) [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">12</a> ]. </li></ul><br><img src="https://habrastorage.org/webt/qg/vh/ij/qgvhijgvyv0fe5m9vntekmwggxo.png"><br><br>  Architecture MoonGen, sch√©ma √† partir du mat√©riau [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1</a> ]. <br><br><h3>  Moongen </h3><br>  MoonGen est un g√©n√©rateur de paquets haute vitesse script√© bas√© sur la biblioth√®que DPDK.  Les scripts Lua contr√¥lent l'ensemble du processus: le script cr√©√© par l'utilisateur est responsable de la cr√©ation, de la modification et de l'envoi des packages.  Gr√¢ce √† la biblioth√®que de traitement de paquets LuaJIT et DPDK tr√®s rapide, cette architecture vous permet de saturer une interface Ethernet de 10 gigabits avec des paquets de 64 octets en utilisant un seul c≈ìur du CPU.  MoonGen vous permet d'atteindre cette vitesse m√™me lorsque le script Lua modifie chaque package.  Il n'utilise pas d'astuces comme la r√©utilisation du m√™me tampon du contr√¥leur r√©seau. <br><br>  MoonGen peut √©galement recevoir des paquets, c'est-√†-dire v√©rifier quels paquets ont √©t√© abandonn√©s par le syst√®me test√©.  √âtant donn√© que la r√©ception des paquets est contr√¥l√©e exclusivement par un script Lua personnalis√©, il peut √©galement √™tre utilis√© pour cr√©er des scripts de test plus complexes.  Par exemple, vous pouvez utiliser deux instances de MoonGen pour √©tablir une connexion entre elles.  Une telle configuration peut notamment √™tre utilis√©e pour tester les bo√Ætiers dits interm√©diaires (√©quipements entre le point d'envoi et de r√©ception du trafic), par exemple les pare-feu.  MoonGen se concentre sur quatre domaines principaux: <br><br><ul><li>  Haute performance et √©volutivit√© multic≈ìur: plus de 20 millions de paquets par seconde sur un seul c≈ìur de processeur; </li><li>  Flexibilit√©: chaque package est g√©n√©r√© en temps r√©el sur la base d'un script Lua cr√©√© par l'utilisateur; </li><li>  Horodatage exact: sur le mat√©riel ordinaire (marchandise), le marquage horaire est effectu√© avec une pr√©cision de la milliseconde; </li><li>  Contr√¥le pr√©cis des intervalles entre les paquets envoy√©s: g√©n√©ration fiable des mod√®les et types de trafic requis sur du mat√©riel ordinaire. </li></ul><br><h3>  DPDK </h3><br>  DPDK signifie Data Plane Development Kit et se compose de biblioth√®ques dont les fonctions principales sont d'augmenter les performances de g√©n√©ration de paquets r√©seau sur une grande vari√©t√© d'architectures de processeur central. <br><br>  Dans un monde o√π les r√©seaux informatiques deviennent le fondement de la communication humaine, les performances, la bande passante et la latence deviennent des param√®tres de plus en plus critiques pour des syst√®mes tels que les r√©seaux sans fil et l'infrastructure de c√¢bles, y compris tous leurs composants individuels: routeurs, √©quilibreurs de charge, pare-feu;  ainsi que des domaines d'application: transfert m√©dia (streaming), VoIP, etc. <br><br>  DPDK est un moyen l√©ger et pratique de cr√©er des tests et des scripts.  Le transfert de donn√©es dans l'espace utilisateur est quelque chose que nous n'observons pas si souvent, principalement parce que la plupart des applications communiquent avec les √©quipements r√©seau via le syst√®me d'exploitation et la pile du noyau, ce qui est l'oppos√© du mod√®le DPDK. <br><br><h3>  Lua </h3><br>  Le principal objectif de l'existence de Lua est de fournir des outils expressifs simples et flexibles qui sont extensibles pour des t√¢ches actuelles sp√©cifiques, au lieu d'un ensemble de primitives applicables dans un seul paradigme de programmation.  En cons√©quence, la langue de base est tr√®s l√©g√®re - l'int√©gralit√© de l'interpr√©teur ne prend que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">180 Ko</a> sous forme compil√©e et s'adapte facilement √† un large √©ventail d'impl√©mentations possibles. <br><br>  Lua est un langage dynamique.  Il est si compact qu'il peut √™tre plac√© sur presque n'importe quel appareil.  Lua prend en charge un petit ensemble de types: valeurs bool√©ennes, nombres (virgule flottante double pr√©cision) et cha√Ænes.  Les structures de donn√©es classiques, telles que les tableaux, les ensembles et les listes, peuvent √™tre repr√©sent√©es par la seule structure de donn√©es int√©gr√©e dans Lua - une table, qui est un tableau associatif h√©t√©rog√®ne. <br><br>  Lua utilise la compilation JIT (juste √† temps), donc, √©tant un langage de script, il affiche des performances comparables aux langages compil√©s tels que C [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">10</a> ]. <br><br><h2>  Pourquoi moongen </h2><br>  En tant qu'entreprise sp√©cialis√©e dans la neutralisation des attaques DDoS, Qrator Labs a besoin d'un moyen fiable pour cr√©er, mettre √† niveau et tester ses propres solutions de s√©curit√©.  C'est pour ces derniers, les tests, que diverses m√©thodes de g√©n√©ration de trafic simulant des attaques r√©elles sont n√©cessaires.  Cependant, il n'est pas si facile de simuler une attaque par inondation dangereuse, mais simple, aux 2-3 niveaux du mod√®le OSI, principalement en raison des difficult√©s √† atteindre des performances √©lev√©es dans la g√©n√©ration de paquets. <br><br>  En d'autres termes, pour une entreprise engag√©e dans la disponibilit√© et la neutralisation continues des DDoS, simuler diverses attaques DoS dans un environnement de laboratoire isol√© est un moyen de comprendre comment les diff√©rents √©quipements qui font partie des syst√®mes mat√©riels de l'entreprise se comporteront dans la r√©alit√©. <br><br>  MoonGen est un bon moyen de g√©n√©rer des valeurs de trafic proches de la limite pour le contr√¥leur de r√©seau avec un minimum de c≈ìurs de processeur.  Le transfert de donn√©es dans l'espace utilisateur am√©liore consid√©rablement les performances de la pile en question (MoonGen + DPDK), par rapport √† de nombreuses autres options pour g√©n√©rer des valeurs de trafic √©lev√©es.  L'utilisation de DPDK pur n√©cessite beaucoup plus d'efforts, vous ne devez donc pas √™tre surpris de notre d√©sir d'optimiser les performances.  Nous prenons √©galement en charge un clone [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7</a> ] du r√©f√©rentiel MoonGen d'origine afin d'√©tendre la fonctionnalit√© et la mise en ≈ìuvre de nos propres tests. <br><br>  Afin d'obtenir une flexibilit√© maximale, la logique de g√©n√©ration des packages est d√©finie par l'utilisateur √† l'aide du script Lua, qui est l'une des principales fonctionnalit√©s de MoonGen.  Dans le cas d'un traitement de paquets relativement simple, cette solution fonctionne assez rapidement pour saturer l'interface 10G sur un seul c≈ìur de processeur.  Une fa√ßon typique de modifier des packages entrants et d'en cr√©er de nouveaux consiste √† travailler avec des packages du m√™me type, dans lesquels seuls certains des champs changent. <br><br>  Un exemple est le test l3-tcp-syn-ack-flood, d√©crit ci-dessous.  Notez que toute modification du package peut √™tre effectu√©e dans le m√™me tampon, o√π le package g√©n√©r√© ou re√ßu √† l'√©tape pr√©c√©dente s'est av√©r√© √™tre.  En effet, de telles conversions de paquets sont effectu√©es tr√®s rapidement, car elles n'impliquent pas d'op√©rations co√ªteuses, telles que des appels syst√®me, l'acc√®s √† des sections de m√©moire potentiellement non mises en cache, etc. <br><br><h2>  Tests sur le mat√©riel Qrator Labs </h2><br>  Qrator Labs effectue tous les tests en laboratoire sur divers √©quipements.  Dans ce cas, nous avons utilis√© les contr√¥leurs d'interface r√©seau suivants: <br><br><ul><li>  Intel 82599ES 10G </li><li>  Mellanox ConnectX-4 40G </li><li>  Mellanox ConnectX-5 100G </li></ul><br>  Nous notons s√©par√©ment que lorsque vous travaillez avec des contr√¥leurs de r√©seau fonctionnant sur des normes sup√©rieures √† 10G, le probl√®me de performances devient plus aigu.  Aujourd'hui, il n'est pas possible de saturer l'interface 40G avec un seul c≈ìur, bien qu'avec un petit nombre de c≈ìurs, cela soit d√©j√† r√©aliste. <br><br>  Dans le cas des contr√¥leurs de r√©seau fabriqu√©s par Mellanox, il est possible de modifier certains param√®tres et r√©glages de l'appareil √† l'aide du guide de r√©glage [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3</a> ] fourni par le fabricant.  Cela vous permet d'augmenter les performances et, dans certains cas particuliers, d'approfondir le comportement de la carte r√©seau.  D'autres fabricants peuvent avoir des documents similaires pour leurs propres appareils hautes performances destin√©s √† un usage professionnel.  M√™me si vous ne trouvez pas un tel document dans le domaine public, il est toujours judicieux de contacter directement le fabricant.  Dans notre cas, les repr√©sentants de la soci√©t√© Mellanox ont √©t√© tr√®s gentils et, en plus de fournir de la documentation, ont rapidement r√©pondu √† nos questions, gr√¢ce auxquelles nous avons r√©ussi √† utiliser √† 100% la bande, ce qui √©tait tr√®s important pour nous. <br><br><h3>  Test d'inondation TCP SYN </h3><br>  L3-tcp-syn-ack-flood est un exemple de simulation d'une attaque comme SYN flood [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6</a> ].  Il s'agit d'une version √©tendue de Qrator Labs du test l3-tcp-syn-flood du r√©f√©rentiel principal MoonGen, qui est stock√© dans notre clone de r√©f√©rentiel. <br><br>  Notre test peut ex√©cuter trois types de processus: <br><br><ol><li>  G√©n√©rez un flux de paquets TCP SYN √† partir de z√©ro, en faisant varier les champs requis, tels que l'adresse IP source, le num√©ro de port source, etc. </li><li>  Cr√©ez une r√©ponse ACK valide pour chaque paquet SYN re√ßu selon TCP; </li><li>  Cr√©ez une r√©ponse SYN-ACK valide pour chaque paquet ACK re√ßu conform√©ment au protocole TCP. </li></ol><br>  Par exemple, la boucle de code interne (respectivement, la ¬´plus chaude¬ª) pour cr√©er des r√©ponses ACK est la suivante: <br><br><pre><code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> tx = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> rx = rxQ:recv(rxBufs) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, rx <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> buf = rxBufs[i] <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pkt = buf:getTcpPacket(ipv4) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> pkt.ip4:getProtocol() == ip4.PROTO_TCP <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> pkt.tcp:getSyn() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> (pkt.tcp:getAck() <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> synack) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> seq = pkt.tcp:getSeqNumber() <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> ack = pkt.tcp:getAckNumber() pkt.tcp:unsetSyn() pkt.tcp:setAckNumber(seq+<span class="hljs-number"><span class="hljs-number">1</span></span>) pkt.tcp:setSeqNumber(ack) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> tmp = pkt.ip4.src:get() pkt.ip4.src:set(pkt.ip4.dst:get()) pkt.ip4.dst:set(tmp) ‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">-- some more manipulations with packet fields tx = tx + 1 txBufs[tx] = buf end end if tx &gt; 0 then txBufs:resize(tx) txBufs:offloadTcpChecksums(ipv4) -- offload checksums to NIC txQ:send(txBufs) end</span></span></code> </pre> <br>  L'id√©e g√©n√©rale de cr√©er un ensemble de r√©ponses est la suivante.  Tout d'abord, vous devez supprimer le paquet de la file d'attente RX, puis v√©rifier si le type de paquet correspond √† celui attendu.  En cas de co√Øncidence, pr√©parez une r√©ponse en modifiant certains champs du package d'origine.  Enfin, placez le paquet cr√©√© dans la file d'attente TX en utilisant le m√™me tampon.  Pour am√©liorer les performances, au lieu de prendre les paquets un par un et de les modifier un par un, nous les agr√©gons, en extrayant tous les paquets disponibles de la file d'attente RX, en cr√©ant les r√©ponses correspondantes et en les mettant tous dans la file d'attente TX.  Malgr√© un nombre assez important de manipulations sur un m√™me package, les performances restent √©lev√©es, principalement en raison du fait que Lua JIT compile toutes ces op√©rations dans un petit nombre d'instructions de processeur.  De nombreux autres tests, non seulement TCP SYN / ACK, fonctionnent sur le m√™me principe. <br><br>  Le tableau ci-dessous montre les r√©sultats du test SYN flood (g√©n√©ration SYN sans tentatives de r√©ponse) √† l'aide de Mellanox ConnectX-4.  Cette carte r√©seau poss√®de deux ports 40G avec un plafond de performances th√©orique de 59,52 Mpps sur un port et 2 * 50 Mpps pour deux ports.  L'impl√©mentation sp√©cifique de la connexion de la carte r√©seau au PCIe limite quelque peu la bande passante (donnant 2 * 50 au lieu des 2 * 59,52 attendus). <br><table><tbody><tr><td>  <b>c≈ìurs par port</b> </td><td>  <b>1 port, Mpps</b> </td><td>  <b>2 ports, Mpps pour chaque port</b> </td></tr><tr><td>  1 </td><td>  20 </td><td>  19 </td></tr><tr><td>  2 </td><td>  38 </td><td>  36 </td></tr><tr><td>  3 </td><td>  56,5 </td><td>  47 </td></tr><tr><td>  4 </td><td>  59,5 </td><td>  50 </td></tr></tbody></table><br>  <i>Test d'inondation SYN;</i>  <i>Carte r√©seau: famille Mellanox Technologies MT27700 (ConnectX-4), double port 40G;</i>  <i>Processeur: Processeur Intel¬Æ Xeon¬Æ Silver 4114 √† 2,20 GHz</i> <br><br>  Le tableau suivant montre les r√©sultats du m√™me test d'inondation SYN effectu√© sur un Mellanox ConnectX-5 avec un port 100G. <br><table><tbody><tr><td>  <b>noyaux</b> </td><td>  <b>Mpps</b> </td></tr><tr><td>  1 </td><td>  35 </td></tr><tr><td>  2 </td><td>  69 </td></tr><tr><td>  3 </td><td>  104 </td></tr><tr><td>  4 </td><td>  127 </td></tr><tr><td>  5 </td><td>  120 </td></tr><tr><td>  6 </td><td>  131 </td></tr><tr><td>  7 </td><td>  132 </td></tr><tr><td>  8 </td><td>  144 </td></tr></tbody></table><br>  <i>Test d'inondation SYN;</i>  <i>Carte r√©seau: famille Mellanox Technologies MT27800 (ConnectX-5), port 100G unique;</i>  <i>Processeur: Processeur Intel¬Æ Xeon¬Æ Silver 4114 √† 2,20 GHz</i> <br><br>  Notez que dans tous les cas, nous atteignons plus de 96% du plafond de performance th√©orique sur un petit nombre de c≈ìurs de processeur. <br><br><h3>  Capturez le trafic entrant et enregistrez-le dans des fichiers PCAP </h3><br>  Un autre exemple du test est rx-to-pcap, qui tente de capturer tout le trafic entrant et de l'enregistrer dans un certain nombre de fichiers PCAP [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8</a> ].  Bien que ce test ne concerne pas sp√©cifiquement la g√©n√©ration de packages en tant que tels, il sert de d√©monstration du fait que le maillon le plus faible dans l'organisation du transfert de donn√©es via l'espace utilisateur est le syst√®me de fichiers.  M√™me le syst√®me de fichiers virtuel tmpfs ralentit consid√©rablement le flux.  Dans ce cas, 8 c≈ìurs du processeur central sont n√©cessaires pour utiliser 14,88 Mpps, tandis qu'un seul c≈ìur suffit pour recevoir (et r√©initialiser ou rediriger) la m√™me quantit√© de trafic. <br><br>  Le tableau suivant montre la quantit√© de trafic (en Mpps) qui a √©t√© re√ßue et enregistr√©e dans des fichiers PCAP situ√©s dans le syst√®me de fichiers ext2 sur le SSD (deuxi√®me colonne) ou sur le syst√®me de fichiers tmpfs (troisi√®me colonne). <br><table><tbody><tr><td>  <b>noyaux</b> </td><td>  <b>sur SSD, Mpps</b> </td><td>  <b>sur tmpfs, Mpps</b> </td></tr><tr><td>  1 </td><td>  1,48 </td><td>  1,62 </td></tr><tr><td>  2 </td><td>  4 </td><td>  4.6 </td></tr><tr><td>  3 </td><td>  6,94 </td><td>  8.1 </td></tr><tr><td>  4 </td><td>  9,75 </td><td>  11,65 </td></tr><tr><td>  5 </td><td>  12,1 </td><td>  13,8 </td></tr><tr><td>  6 </td><td>  13,38 </td><td>  14,47 </td></tr><tr><td>  7 </td><td>  14,4 </td><td>  14,86 </td></tr><tr><td>  8 </td><td>  14,88 </td><td>  14,88 </td></tr></tbody></table><br>  <i>Test Rx-to-pcap;</i>  <i>Carte r√©seau: Intel 82599ES 10 Gigabit;</i>  <i>CPU: Intel¬Æ Xeon¬Æ CPU E5-2683 v4 @ 2.10GHz</i> <br><br><h2>  Modification de MoonGen: tman Task Manager </h2><br>  Nous aimerions √©galement pr√©senter au lecteur notre propre extension de la fonctionnalit√© MoonGen, qui fournit une autre fa√ßon de lancer un groupe de t√¢ches pour les tests.  L'id√©e principale ici est de s√©parer la configuration g√©n√©rale et les param√®tres sp√©cifiques √† chaque t√¢che, vous permettant d'ex√©cuter un nombre arbitraire de t√¢ches diff√©rentes (c'est-√†-dire des scripts Lua) en m√™me temps.  Dans notre clone du r√©f√©rentiel MoonGen, l'impl√©mentation de MoonGen avec le gestionnaire de t√¢ches [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">9</a> ] est pr√©sent√©e, nous ne listerons ici que bri√®vement ses principales fonctions. <br><br>  La nouvelle interface de ligne de commande vous permet d'ex√©cuter simultan√©ment plusieurs t√¢ches de diff√©rents types.  Le sc√©nario de base est le suivant: <br><br><pre> <code class="bash hljs">./build/tman [tman options...] [-- &lt;task1-file&gt; [task1 options...]] [-- &lt;task2-file&gt; [task2 options...]] [-- ...]</code> </pre> <br>  De plus, ./build/tman -h fournit une aide d√©taill√©e. <br><br>  Cependant, il existe une limitation: les fichiers de travail Lua standard ne sont pas compatibles avec l'interface <i>tman</i> .  Le <i>fichier de</i> travail <i>tman</i> doit d√©finir clairement les objets suivants: <br><br><ul><li>  La fonction configure (analyseur) qui d√©crit les param√®tres du travail; </li><li>  La fonction de t√¢che (taskNum, txInfo, rxInfo, args), qui d√©crit le processus de t√¢che r√©el.  Ici, txInfo et rxInfo sont des tableaux de files d'attente RX et TX, respectivement;  args contient les param√®tres du gestionnaire de t√¢ches et la t√¢che elle-m√™me. </li><li>  Des exemples peuvent √™tre trouv√©s dans examples / tman. </li></ul><br>  L'utilisation du gestionnaire de t√¢ches vous donne plus de flexibilit√© pour ex√©cuter des tests h√©t√©rog√®nes. <br><br><h3>  Conclusions </h3><br>  La m√©thode propos√©e par MoonGen s'est av√©r√©e bien adapt√©e √† nos objectifs et a satisfait les employ√©s avec les r√©sultats obtenus.  Nous avons obtenu un outil tr√®s performant, tout en maintenant √† la fois l'environnement de test et le langage assez simples.  Les performances √©lev√©es de cette configuration sont obtenues gr√¢ce √† deux caract√©ristiques principales: l'acc√®s direct aux tampons du contr√¥leur d'interface r√©seau et la technique de compilation Just-In-Time dans Lua. <br><br>  En r√®gle g√©n√©rale, la r√©alisation d'un plafond th√©orique pour les performances d'un contr√¥leur d'interface r√©seau est une t√¢che r√©alisable.  Comme nous l'avons montr√©, un seul c≈ìur peut suffire √† saturer un port 10G, tandis qu'une charge compl√®te d'un port 100G ne pr√©sente pas de probl√®me particulier avec un plus grand nombre de c≈ìurs. <br><br>  Nous sommes particuli√®rement reconnaissants √† l'√©quipe Mellanox pour leur aide avec leur √©quipement et √† l'√©quipe MoonGen pour leur r√©action √† la correction des erreurs. <br><br><h2>  Mat√©riaux </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MoonGen: A Scriptable High-Speed ‚Äã‚ÄãPacket Generator - Paul Emmerich et al., Internet Measurement Conference 2015 (IMC'15), 2015</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pktgen</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Guide de r√©glage Mellanox</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kit de d√©veloppement de plan de donn√©es</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lua</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Syn flood</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Clone du r√©f√©rentiel MoonGen de Qrator Labs</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Format de fichier PCAP</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestionnaire de t√¢ches</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Performances Lua</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Livre blanc sur la virtualisation des fonctions r√©seau</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NUMA, acc√®s m√©moire non uniforme</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423957/">https://habr.com/ru/post/fr423957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423945/index.html">La Cour supr√™me a pr√©cis√© la proc√©dure √† suivre pour examiner les cas de reposts et de likes</a></li>
<li><a href="../fr423947/index.html">Nos donn√©es personnelles ne vous co√ªtent rien</a></li>
<li><a href="../fr423949/index.html">Un univers conforme √† nos croyances actuelles peut ne pas √™tre possible.</a></li>
<li><a href="../fr423953/index.html">Fonction humaine ou technologie de cessation d'emploi</a></li>
<li><a href="../fr423955/index.html">Comment nous avons cr√©√© un produit technologique et sommes tomb√©s au fond</a></li>
<li><a href="../fr423959/index.html">Caisses sous-marines - Pour robots</a></li>
<li><a href="../fr423961/index.html">Ne vous perdez pas: une nouvelle m√©thode pour diagnostiquer la d√©mence</a></li>
<li><a href="../fr423963/index.html">Kelvin Point Prologue</a></li>
<li><a href="../fr423965/index.html">Vous avez achet√© SIEM et √™tes s√ªr que SOC est dans votre poche, non?</a></li>
<li><a href="../fr423967/index.html">Toute la v√©rit√© sur RTOS. Article # 10. Scheduler: fonctionnalit√©s avanc√©es et pr√©servation du contexte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>