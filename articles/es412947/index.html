<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèæ üë®üèæ‚Äçüî¨ üêÖ Pruebas de carga en la nube de Azure. ¬øC√≥mo probar una gran tienda en l√≠nea en condiciones cercanas a la real? üç∞ üóÇÔ∏è üë®‚Äçüî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En este art√≠culo compartiremos nuestra propia experiencia pr√°ctica que obtuvimos al probar la aplicaci√≥n de aplicaciones web (tienda en l√≠nea) que se ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pruebas de carga en la nube de Azure. ¬øC√≥mo probar una gran tienda en l√≠nea en condiciones cercanas a la real?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/virtocommerce/blog/412947/">  En este art√≠culo compartiremos nuestra propia experiencia pr√°ctica que obtuvimos al probar la aplicaci√≥n de aplicaciones web (tienda en l√≠nea) que se ejecuta en la nube de MS Azure, as√≠ como tambi√©n describiremos qu√© herramientas utilizamos para resolver este problema y las conclusiones que se hicieron en base a los hallazgos resultados. <br><img src="https://habrastorage.org/webt/qy/hw/ih/qyhwihvqkt2hrypk0odlioyxwz0.jpeg"><br><a name="habracut"></a><br><h4>  Objeto de prueba </h4><br>  Elegimos VirtoCommerce Storefront (una aplicaci√≥n web utilizada como interfaz de las aplicaciones creadas en la plataforma VirtoCommerce) como objetos de prueba. <br><br>  Para obtener una imagen real de las capacidades del sistema, necesitamos simular las solicitudes de los usuarios lo m√°s cerca posible de la realidad.  No tiene sentido verificar la p√°gina principal, que puede estar en el cach√©, y luego afirmar que nuestra velocidad fue de 1k req / seg.  No tiene sentido en una m√©trica de rendimiento en la vida real. <br><br>  Por lo tanto, para que los resultados de nuestras pruebas sean estad√≠sticamente significativos y reflejen los indicadores de rendimiento del tr√°fico real lo m√°s cerca posible, se decidi√≥ utilizar consultas lo m√°s cercanas posible al comportamiento real del usuario en la tienda en l√≠nea. <cut></cut><br><br>  Deteng√°monos en las siguientes acciones, en las cuales consistir√° nuestra prueba "real": <br><br><table border="1"><tbody><tr><td><p>  <strong>Acci√≥n del usuario (tipo de prueba)</strong> </p><br></td><td><p>  <strong>Porcentaje de solicitudes totales</strong> </p><br></td></tr><tr><td><p>  Ver una p√°gina de categor√≠a √∫nica con sus productos. </p><br></td><td><p>  30% </p><br></td></tr><tr><td><p>  Ver una tarjeta de producto √∫nica </p><br></td><td><p>  40% </p><br></td></tr><tr><td><p>  Agregar art√≠culos al carrito </p><br></td><td><p>  10% </p><br></td></tr><tr><td><p>  Busque productos por una palabra clave o atributo √∫nico </p><br></td><td><p>  20% </p><br></td></tr></tbody></table><br>  <i>Fig.</i>  <i>1. Las principales acciones de los usuarios y su frecuencia espec√≠fica de uso.</i> <br><br><h4>  Preparaci√≥n de datos de prueba </h4><br>  La fase m√°s importante para cualquier prueba es la preparaci√≥n de datos.  Los datos de prueba deben seleccionarse de tal manera que corresponda lo m√°s posible a los datos en un sistema real, tanto en cantidad como en calidad (comunicaci√≥n, estructura, etc.).  Si es posible, la cantidad total de datos deber√≠a ser suficiente para que, al realizar la prueba, haya la menor cantidad posible de llamadas repetidas a los mismos datos, lo que evitar√° el uso frecuente de la memoria cach√© y, como resultado, obtendr√° la imagen m√°s pesimista del rendimiento del sistema. <br><br>  Los datos principales de la tienda en l√≠nea, por regla general, son: un cat√°logo de productos y categor√≠as con precios, descuentos e informaci√≥n sobre saldos. <br><br>  Como relleno del entorno de prueba, se utilizaron datos de cat√°logo reales, que se utilizar√°n en el entorno de producci√≥n principal: <br><br><img src="https://habrastorage.org/webt/kc/zm/o3/kczmo3vh9hjvjxaf6a0mn-zcaco.png"><br>  <i>Fig.2.</i>  <i>Datos utilizados para poblar el sistema bajo prueba.</i> <br><br>  Est√° claro que para un lector que no est√° familiarizado con la estructura del cat√°logo de VirtoCommerce, algunos tipos de datos pueden no significar nada, pero los presentaremos para al menos tener una idea del orden cuantitativo. <br><br><h4>  Preparaci√≥n de proyectos y pruebas de grabaci√≥n. </h4><br>  Como herramienta principal para las pruebas de carga, usaremos MS Visual Studio Enterprise 2017 (otras ediciones de estudio pueden no ser compatibles con este tipo de proyecto) y el tipo de proyecto <b>Proyecto de prueba de carga y rendimiento web</b> . <br><br><img src="https://habrastorage.org/webt/pq/pi/hz/pqpihzjuik_rtvxt9esckqbkkj4.png"><br>  <i>Fig.3.</i>  <i>Crea un nuevo proyecto.</i> <br><br>  Despu√©s de crear el proyecto, necesitaremos crear pruebas para cada una de las acciones del usuario definidas previamente.  Nos limitamos a crear una prueba para una acci√≥n de usuario como ejemplo, ya que el resto de las acciones se crean por analog√≠a. <br><br>  Para las pruebas, utilizaremos el tipo est√°ndar de prueba Web Performance Test, integrado en Visual Studio. <br><br>  Nuestra primera prueba que crearemos ser√° una prueba que revela los detalles del producto en una tienda en l√≠nea. <br><br>  Para crear una prueba, seleccione el tipo de prueba <b>"Prueba de rendimiento web"</b> de la lista que ofrece Studio, establezca el nombre <b>"Storefront-ProductDetail"</b> . <br><br><img src="https://habrastorage.org/webt/q2/hj/fk/q2hjfkrpoctrmaqtticvke7og-i.png"><br>  <i>Fig.4.</i>  <i>Elegir un tipo de prueba en Visual Studio.</i> <br><br>  Para este tipo de prueba, Visual Studio intentar√° inmediatamente abrir un navegador, donde ser√° posible hacer clic de forma interactiva en las acciones necesarias directamente en el sitio, pero no haremos esto, pero cerraremos inmediatamente el navegador y dejaremos de grabar.  Como resultado, obtenemos una prueba de <b>Storefront-ProductDetail.webtest</b> vac√≠a. <br><br>  A continuaci√≥n, necesitamos agregar una fuente de datos para esta prueba, de modo que podamos usar diferentes par√°metros de consulta dentro de la misma prueba, para esto, la <b>prueba de rendimiento web de</b> V <b>S Studio</b> brinda esa oportunidad. <br><br>  Como fuente de datos para nuestra prueba, utilizaremos una tabla en la base de datos donde se almacenan los registros del producto.  Despu√©s de eso, podremos usar los datos de la fuente conectada en la solicitud, que deber√≠a abrir los detalles del producto en la aplicaci√≥n probada.  Esto se logra insertando la construcci√≥n <i>"{{Nombre de fuente de datos. Nombre de tabla. Nombre de columna}}"</i> <br><br>  Como resultado, despu√©s de todas las manipulaciones, nuestra primera prueba tomar√° esta forma. <br><br><img src="https://habrastorage.org/webt/40/jo/tz/40jotzcj3gqlek8yi5qdwl8vgri.png"><br>  <i>Fig.</i>  <i>5. Contenido de la prueba.</i> <br><br>  Es hora de la primera ejecuci√≥n, intente ejecutar nuestra prueba y aseg√∫rese de que funcione correctamente. <br><br><img src="https://habrastorage.org/webt/r7/pb/c_/r7pbc_5z3mqk_hugwege27clcxe.png"><br>  <i>Fig.</i>  <i>6. El resultado de una sola prueba</i> <br><br>  Por analog√≠a, crearemos pruebas para todos nuestros otros escenarios. <br><br><img src="https://habrastorage.org/webt/f_/tv/5a/f_tv5aw-ilxk-apr4vehc5c5jvo.png"><br>  <i>Fig.</i>  <i>7. El conjunto de pruebas resultante</i> <br><br>  Despu√©s de eso, casi todo est√° listo para crear una prueba combinada que emular√° el comportamiento real del usuario en el sitio. <br><br>  Para hacer esto, agregue un nuevo <b>LoadTest</b> a nuestro proyecto <b>.</b> <br><br><img src="https://habrastorage.org/webt/ex/wd/ve/exwdvet-rwzbznri1na7mmqk2da.png"><br>  <i>Fig.8.</i>  <i>Crea una nueva prueba de carga</i> <br><br>  En el asistente que aparece, seleccione el tipo <b>Prueba de carga local</b> . <br><br><img src="https://habrastorage.org/webt/oa/pw/vf/oapwvf0exwvlj8k3zvd8byagwgg.png"><br>  <i>Fig.</i>  <i>9. Elegir un tipo de prueba</i> <br><br>  Este art√≠culo requiere alguna aclaraci√≥n, porque usted pregunta con raz√≥n: "¬øY qu√© en el local?"  El tema del art√≠culo trata sobre las pruebas con Teams Services y MS Azure, pero hay un matiz, ya que utilizamos fuentes de datos en forma de tablas u otros servicios externos para las pruebas, esto puede causar algunas dificultades cuando intentamos ejecutar esta prueba en la nube. <br><br>  Despu√©s de intentos in√∫tiles de hacer que tales pruebas funcionen en la nube, abandonamos esta empresa y decidimos usar las llamadas pruebas "grabadas" para las pruebas, que se obtienen al registrar las solicitudes generadas por las pruebas que se ejecutan localmente y conectadas a las fuentes de datos. <br><br>  Para grabar pruebas, utilizamos Fiddler, que tiene la capacidad de exportar solicitudes al formato de <b>Pruebas web de Visual Studio</b> .  Un poco m√°s adelante describiremos con m√°s detalle el procedimiento para registrar dicha prueba. <br><br>  En los siguientes pasos, seleccionamos la duraci√≥n de la prueba, el n√∫mero de usuarios y, lo m√°s importante, indicamos en qu√© pruebas consistir√° nuestro <b>MixedLoadTest</b> y en qu√© proporciones se utilizar√°n. <br><br><img src="https://habrastorage.org/webt/ii/gw/m1/iigwm179eca-z4wpfhjiuxkmcpy.png"><br>  <i>Fig.10.</i>  <i>Componentes de prueba</i> <br><br>  Como resultado, despu√©s de todas las acciones, obtenemos un <b>MixedLoadTest</b> combinado configurado para ejecutarse en una aplicaci√≥n implementada localmente. <br>  A continuaci√≥n, debemos ejecutar esta prueba e intentar registrar con <b>Fiddler</b> todas las solicitudes que se generar√°n como resultado de la prueba, as√≠ como obtener un "registro" que podamos ejecutar directamente en la nube. <br><br>  Primero ejecute <b>Fiddler</b> y nuestra prueba <b>MixedLoadTest</b> . <br><br><img src="https://habrastorage.org/webt/vo/i3/iv/voi3ivm3p2xqpotj13ielj2lpgu.png"><br>  <i>Fig.</i>  <i>11. El resultado de la prueba.</i> <br><br>  Despu√©s de procesar todos los datos, obtenemos esta imagen en Fiddler <br><br><img src="https://habrastorage.org/webt/a2/te/ne/a2teneaia7ipcwzdxiudn8y_fnw.png"><br>  <i>Fig.</i>  <i>12. Sesi√≥n de prueba en Fiddler</i> <br><br>  A continuaci√≥n, en Fiddler, guarde todas las sesiones en el formato de <b>Pruebas web</b> de <b>Visual Studio</b> , <i>Archivo -&gt; Exportar sesiones -&gt; Todas las sesiones -&gt; Pruebas web de Visual Studio</i> y agregue el archivo resultante al proyecto.  Perm√≠tame recordarle que esta acci√≥n es necesaria para que podamos obtener la prueba sin referencia a fuentes de datos externas, ya que comenzar este tipo de pruebas puede causar problemas en la nube. <br><br><img src="https://habrastorage.org/webt/o3/le/v4/o3lev4pmhf-xp8ygxdbpi4xjujs.png"><br>  <i>Fig.</i>  <i>13. Detalles de la prueba "grabada"</i> <br><br>  Ahora casi todo est√° listo para ejecutar nuestra prueba en la nube, el √∫ltimo paso para preparar la prueba es abrir el <b>MixedLoadTest</b> "grabado" en cualquier editor de texto y reemplazar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">localhost</a> : 8888 (direcci√≥n proxy, Fiddler) con la direcci√≥n de nuestra tienda en la nube. <br><br><h4>  Ejecutando una prueba en la nube </h4><br>  Para ejecutar las pruebas en la nube, necesitamos una cuenta v√°lida en <b>Visual Studio Team Services</b> . <br><br>  Cree un nuevo LoadTest, solo que esta vez seleccione <b>Prueba de carga basada en la nube con Visual Studio Team Services</b> . <br><br><img src="https://habrastorage.org/webt/un/a6/s_/una6s_qzrma_us5niajapmwrjdg.png"><br><br>  En los pr√≥ximos pasos, seleccionamos el centro de datos desde el que se generar√° el tr√°fico al recurso probado, as√≠ como el n√∫mero m√°ximo de agentes (usuarios) para el patr√≥n constante, o si queremos usar un aumento gradual de la carga, necesitamos establecer los par√°metros apropiados. <br><br><img src="https://habrastorage.org/webt/mi/vq/lb/mivqlbjaoikw-bzr1ztj_eg7zr4.png"><br><br>  En el paso de seleccionar pruebas, seleccionamos la √∫nica prueba que grabamos anteriormente usando <b>Fiddler</b> , emular√° la carga "real" en el recurso probado. <br><br><img src="https://habrastorage.org/webt/41/q4/os/41q4os13d7n0edb-hxxa5ouj1nq.png"><br><br>  Una vez completada la creaci√≥n, lanzamos una prueba, durante la cual el estudio mostrar√° algunas m√©tricas clave, como el rendimiento y el ancho de banda, as√≠ como tambi√©n construir√° gr√°ficos en tiempo real. <br><br><img src="https://habrastorage.org/webt/hc/wv/7b/hcwv7ba5ceomfnww-ccvbftn9_a.png"><br>  <i>Fig.</i>  <i>14. El proceso de ejecutar la prueba en la nube</i> <br><br>  Una vez completada la prueba, tambi√©n puede ver el informe web guardado en VSTS: <br><br><img src="https://habrastorage.org/webt/2l/h3/jp/2lh3jpyjwrqkndq1bjaf1q2ue7y.png"><br><img src="https://habrastorage.org/webt/xe/dx/zr/xedxzrpsrabonavgxjgw49frpvs.png"><br>  <i>Fig.</i>  <i>15. Informe web sobre el portal de Visual Studio Team Services</i> <br><br><h4>  An√°lisis de resultados </h4><br>  El punto m√°s importante es el procesamiento y an√°lisis de los resultados de la prueba.  Para la tarea en cuesti√≥n, fue necesario evaluar el rendimiento de una aplicaci√≥n que se ejecuta en varias configuraciones de las tarifas de Azure Web Apps B2 y B3. <br><br>  Para hacer esto, volvimos a ejecutar la prueba "grabada" para la aplicaci√≥n en diferentes configuraciones y registramos los resultados en un documento de Excel. <br><br>  Como resultado, obtuvimos este informe: <br><br><img src="https://habrastorage.org/webt/bp/oz/xh/bpozxhhhsjiuwwmwl2gmfcblluq.png"><br>  <i>Figura 16.</i>  <i>Informe de resultados de la prueba</i> <br><br>  Despu√©s de analizar los datos obtenidos, fue posible descubrir la carga m√°xima que nuestra aplicaci√≥n puede soportar: son aproximadamente 60 usuarios simult√°neos o 9 solicitudes / segundo.  con un tiempo promedio de retorno de p√°gina de 2.5 segundos.  El gr√°fico muestra que los problemas de rendimiento comienzan abruptamente despu√©s de un cierto valor umbral para el n√∫mero de solicitudes. <br><br>  Como result√≥ m√°s tarde, la raz√≥n de esto fue una carga del procesador del 100%, debido al hecho de que utilizamos una biblioteca de terceros para el procesamiento de p√°ginas del servidor, que utiliza expresiones regulares para tokenizar y analizar el marcado. <br><br><h4>  Conclusiones </h4><br>  La productividad de una aplicaci√≥n en desarrollo activo siempre tiene una fuerte tendencia a la degradaci√≥n, porque cualquier cambio, incluso el m√°s insignificante desde el punto de vista del desarrollador, puede tener consecuencias dram√°ticas para el rendimiento de la aplicaci√≥n.  En este sentido, las pruebas de rendimiento peri√≥dicas son un procedimiento importante que debe llevarse a cabo regularmente y ser parte de los procesos de Integraci√≥n Continua. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El proyecto en s√≠ y los informes recibidos como resultado de las pruebas est√°n disponibles en GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412947/">https://habr.com/ru/post/es412947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412933/index.html">Tesla abri√≥ parcialmente el c√≥digo fuente del Modelo S / X 2018.12</a></li>
<li><a href="../es412937/index.html">Hack de demostraci√≥n: PenTest Show mostrar√° lo f√°cil que es hackear la red de la oficina y los sistemas de seguridad para robar cualquier cosa</a></li>
<li><a href="../es412939/index.html">Probadores contra pruebas</a></li>
<li><a href="../es412941/index.html">Conferencia de Europa del Este de Java 2018: informes e impresiones</a></li>
<li><a href="../es412945/index.html">Gerentes de dependencia</a></li>
<li><a href="../es412949/index.html">Los astr√≥logos anuncian la semana de desarrollo de iOS en Avito</a></li>
<li><a href="../es412951/index.html">DotVVM - Comunicaci√≥n entre cliente y servidor</a></li>
<li><a href="../es412953/index.html">Calibraci√≥n de c√°mara Intel RealSense d435 con OpenCV2 y ROS</a></li>
<li><a href="../es412955/index.html">Pruebas de IU en Xcode con Embassy y Succulent</a></li>
<li><a href="../es412957/index.html">Mi Band 4 y Mi Band 5: el futuro de las pulseras inteligentes de Xiaomi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>