<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎏 🚀 🚰 Une machine d'état simple pour VueJS 🏨 👨🏾‍💻 😠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J'ai récemment rencontré une discussion intéressante sur Full Stack Radio - Bulding Better UI Components with State Machines . Le fait était que le co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une machine d'état simple pour VueJS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482250/"><img src="https://habrastorage.org/webt/xr/bx/uz/xrbxuzdugkczgzi3vugiuug2o6g.png"><br><br>  J'ai récemment rencontré une discussion intéressante sur Full Stack Radio - <a href="http://www.fullstackradio.com/130">Bulding Better UI Components with State Machines</a> .  Le fait était que le concept d'une machine d'état pourrait aider au développement des composants Vue.  J'ai commencé à regarder des solutions prêtes à l'emploi, mais elles n'étaient pas si simples, et je voulais faire une implémentation plus simple, dont je veux parler dans cet article.  L'article peut être utile non seulement pour ceux qui utilisent Vue, mais aussi pour les utilisateurs d'Angular, React, etc., ainsi que pour les programmeurs d'autres «dénominations». <br><a name="habracut"></a><br>  La discussion a porté sur un sujet proche de tous ceux qui ont écrit les composants.  Imaginez.  que vous écrivez un composant qui demande des données et que vous devez afficher le spinner pendant l'exécution de la requête.  Habituellement, dans de tels cas, vous créez une variable booléenne isLoading.  Initialement, isLoading = false et avant de demander des données, vous définissez la variable isLoading sur true.  Une fois les données arrivées, vous les définissez à nouveau sur false.  La visibilité Spinner est liée à isLoading. <br><br>  Cette approche fonctionne très bien.  Mais le composant est rarement aussi simple.  Et au cours du travail, il est toujours nécessaire de créer des variables logiques qui stockent différents états.  Le problème est que si vous avez une variable d'état, elle génère deux états, et deux variables logiques ont déjà quatre états, trois à huit, etc.  Et le problème est que le programmeur peut faire une erreur et ne pas traiter les états dans lesquels le système peut entrer.  Et cela conduit à une erreur.  De plus, il est assez difficile de comprendre un tel composant et il faut créer des conditions. <br><br>  La réponse est une machine d'état.  Le principe est simple - vous décrivez les états dans lesquels le système peut être, et les transitions entre les états.  Le fait d'avoir une telle machine peut éviter de nombreuses erreurs et déterminer de manière déclarative l'état du système. <br><br>  Il y a pas mal d'articles sur ce sujet (par exemple, <a href="https://www.phillipparker.io/articles/finite-state-machines-in-vue">Finite State Machines dans Vue</a> , mais la plupart d'entre eux, après une brève théorie, recommandent de connecter l'une des bibliothèques prêtes à l'emploi. Par exemple, <a href="https://github.com/davidkpiano/xstate">davidkpiano / xstate</a> . <br><br>  Je pensais que xstate était trop encombrant et je voulais essayer mon vélo.  De plus, c'est une excellente raison de faire ressortir un nouveau modèle pour moi. <br><br>  Voici le code pour jouer avec - <a href="https://jsfiddle.net/Rollroll/hwau3zj7/">State machine with Vue, version 2</a> .  Et voici la version brute, avec une approche légèrement différente - <a href="https://jsfiddle.net/Rollroll/qtw16rdn/">State machine with Vue, version 1</a> . <br>  Je suis parti de l'article <a href="https://choo.io/docs/state-machines/">State Machines</a> . <br><br>  Donc, la machine d'état: <br><br><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StateMachine</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span> (initialState, transitions) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = initialState <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transitions = transitions } transition (nextState, method, params) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> transitionsArray = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transitions[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(transitionsArray.indexOf(nextState) === <span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(method) method(...params) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = nextState <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state } }</code> </pre> <br>  Initialisez-le comme ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> machine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StateMachine(<span class="hljs-string"><span class="hljs-string">'idle'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">idle</span></span>: [<span class="hljs-string"><span class="hljs-string">'waitingConfirmation'</span></span>], <span class="hljs-attr"><span class="hljs-attr">waitingConfirmation</span></span>: [<span class="hljs-string"><span class="hljs-string">'idle'</span></span>,<span class="hljs-string"><span class="hljs-string">'waitingData'</span></span>], <span class="hljs-attr"><span class="hljs-attr">waitingData</span></span>: [<span class="hljs-string"><span class="hljs-string">'dataReady'</span></span>, <span class="hljs-string"><span class="hljs-string">'dataProblem'</span></span>], <span class="hljs-attr"><span class="hljs-attr">dataReady</span></span>: [<span class="hljs-string"><span class="hljs-string">'waitingConfirmation'</span></span>], <span class="hljs-attr"><span class="hljs-attr">dataProblem</span></span>: [<span class="hljs-string"><span class="hljs-string">'waitingConfirmation'</span></span>] })</code> </pre><br>  Dans les méthodes des composants, créez une fonction de transition: <br><br><pre> <code class="javascript hljs">transition(nextState, method = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, params = []) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.machineState = machine.transition(nextState, method, params) }</code> </pre><br>  Dans les événements, nous écrivons immédiatement où nous voulons aller: <br><br><pre> <code class="javascript hljs">@click=“transition(<span class="hljs-string"><span class="hljs-string">'waitingConfirmation'</span></span>)<span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre> <br>  Si vous devez appeler la méthode du composant en même temps, écrivez ceci: <br><br><pre> <code class="javascript hljs">@click=<span class="hljs-string"><span class="hljs-string">"transition('waitingData', getData, [222])”</span></span></code> </pre> <br>  Le deuxième paramètre est la méthode des composants qui doit être appelée avec cette transition. <br>  Le troisième paramètre est un tableau de variables pour cette méthode. <br><br>  A l'intérieur des méthodes, l'appel est: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transition(<span class="hljs-string"><span class="hljs-string">'dataReady'</span></span>)</code> </pre> <br>  Je n'ai délibérément pas masqué les boutons avec v-if, pour l'instant, leur couleur de police est grise.  Mais il est clair que cliquer dessus ne fonctionne pas si la machine ne le permet pas. <br><br>  En général, tout fonctionne, la solution est très simple.  Et surtout, nous avons réussi à décrire de manière déclarative le fonctionnement du composant.  Je suis moi-même presque prêt à appliquer cette approche dans une application réelle, mais je voudrais comprendre les avantages et les inconvénients de cette approche, et écouter les conseils d'experts plus expérimentés. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482250/">https://habr.com/ru/post/fr482250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482232/index.html">StackOverflow est plus qu'un simple référentiel de réponses à des questions stupides</a></li>
<li><a href="../fr482234/index.html">Modélisation numérique à analogique et mixte dans PADS Professional</a></li>
<li><a href="../fr482240/index.html">Nous démontons les premiers appareils TP-Link avec Wi-Fi 6: routeur Archer AX6000 et adaptateur Archer TX3000E</a></li>
<li><a href="../fr482244/index.html">Résultats des tests de caméras aveugles: iPhone, Pixel, Huawei, Samsung</a></li>
<li><a href="../fr482246/index.html">Réponses correctes et annonce du gagnant</a></li>
<li><a href="../fr482252/index.html">Toilette automatique pour chats - suite</a></li>
<li><a href="../fr482254/index.html">Expérience VonmoTrade. Partie 3: Livre des mandats. Traitement et stockage des informations commerciales</a></li>
<li><a href="../fr482256/index.html">L'IA et l'avenir du travail: perspectives d'emploi dans un avenir proche</a></li>
<li><a href="../fr482258/index.html">Comment fonctionnent les réseaux de neurones et pourquoi ils ont commencé à rapporter beaucoup d'argent</a></li>
<li><a href="../fr482260/index.html">TelegramBot. La fonctionnalité de base. Autocollants et émoticônes. (Partie 3)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>