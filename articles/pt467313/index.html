<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•™ üâê üöÜ Replica√ß√£o cruzada entre o PostgreSQL e o MySQL üßïüèæ üë∑ üéÜ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Descreverei a replica√ß√£o cruzada entre o PostgreSQL e o MySQL, bem como os m√©todos para configurar a replica√ß√£o cruzada entre esses dois servidores de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Replica√ß√£o cruzada entre o PostgreSQL e o MySQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/467313/"><p><img src="https://habrastorage.org/webt/ze/m9/h6/zem9h6cpvow7junwu4saxpddvpa.jpeg"></p><br><p>  Descreverei a replica√ß√£o cruzada entre o PostgreSQL e o MySQL, bem como os m√©todos para configurar a replica√ß√£o cruzada entre esses dois servidores de banco de dados.  Normalmente, os bancos de dados de replica√ß√£o cruzada s√£o chamados homog√™neos e esse √© um m√©todo conveniente de mover de um servidor de banco de dados relacional para outro. </p><br><p>  Os bancos de dados PostgreSQL e MySQL s√£o considerados relacionais, mas com extens√µes adicionais, eles oferecem recursos NoSQL.  Aqui discutiremos a replica√ß√£o entre o PostgreSQL e o MySQL, em termos de DBMS relacional. </p><br><p>  N√£o descreveremos toda a cozinha interna, apenas os princ√≠pios b√°sicos, para que voc√™ tenha uma id√©ia de como configurar a replica√ß√£o entre servidores de banco de dados, as vantagens, limita√ß√µes e cen√°rios de uso. </p><a name="habracut"></a><br><p>  Normalmente, a replica√ß√£o entre dois servidores de banco de dados id√™nticos √© realizada no modo bin√°rio ou atrav√©s de solicita√ß√µes entre o n√≥ principal (√© o publicador, mestre ou ativo) e o escravo (assinante, pendente ou passivo).  O objetivo da replica√ß√£o √© fornecer uma c√≥pia em tempo real do banco de dados mestre no lado escravo.  Nesse caso, os dados s√£o transferidos do mestre para o escravo, ou seja, do ativo para o passivo, porque a replica√ß√£o √© realizada apenas em uma dire√ß√£o.  Mas voc√™ pode configurar a replica√ß√£o entre dois bancos de dados em ambas as dire√ß√µes, para que os dados sejam transferidos do escravo para o mestre na configura√ß√£o ativo-ativo.  Tudo isso, incluindo a replica√ß√£o em cascata, possivelmente entre dois ou mais servidores de banco de dados id√™nticos.A configura√ß√£o ativo-ativo ou passivo-ativo depende da necessidade, da disponibilidade de tais recursos na configura√ß√£o inicial ou do uso de solu√ß√µes de configura√ß√£o externas e trade-offs existentes. . </p><br><p> A configura√ß√£o descrita √© poss√≠vel entre diferentes servidores de banco de dados.  O servidor pode ser configurado para receber dados replicados de outro servidor de banco de dados e ainda salvar instant√¢neos em tempo real dos dados replicados.  O MySQL e o PostgreSQL oferecem a maioria dessas configura√ß√µes por conta pr√≥pria ou com extens√µes de terceiros, incluindo m√©todos de log bin√°rio, bloqueios de disco e m√©todos baseados em instru√ß√µes e strings. </p><br><p>  A replica√ß√£o cruzada entre MySQL e PostgreSQL √© necess√°ria para uma √∫nica migra√ß√£o de um servidor de banco de dados para outro.  Esses bancos de dados usam protocolos diferentes, portanto n√£o podem ser conectados diretamente.  Para estabelecer a troca de dados, voc√™ pode usar uma ferramenta externa de c√≥digo aberto, por exemplo, pg_chameleon. </p><br><h3 id="chto-takoe-pg_chameleon">  O que √© pg_chameleon </h3><br><p>  O pg_chameleon √© um sistema de replica√ß√£o do MySQL para o PostgreSQL no Python 3. Ele usa a biblioteca de c√≥digo aberto mysql-replication, tamb√©m no Python.  As imagens de sequ√™ncia s√£o extra√≠das das tabelas MySQL e armazenadas como objetos JSONB no banco de dados PostgreSQL, e depois descriptografadas pela fun√ß√£o pl / pgsql e reproduzidas no banco de dados PostgreSQL. </p><br><h3 id="vozmozhnosti-pg_chameleon">  Recursos de Pg_chameleon </h3><br><p>  V√°rios esquemas MySQL do mesmo cluster podem ser replicados no mesmo banco de dados de destino do PostgreSQL com uma configura√ß√£o um para muitos <br>  Os nomes dos esquemas de origem e destino n√£o podem corresponder. <br>  Os dados de replica√ß√£o podem ser recuperados de uma r√©plica do MySQL em cascata. <br>  Tabelas que n√£o podem replicar ou gerar erros s√£o exclu√≠das. <br>  Cada fun√ß√£o de replica√ß√£o √© controlada por daemons. <br>  Controle usando par√¢metros e arquivos de configura√ß√£o com base no YAML. </p><br><h3 id="primer">  Exemplo </h3><br><div class="scrollable-table"><table><thead><tr><th>  Anfitri√£o </th><th>  vm1 </th><th>  vm2 </th></tr></thead><tbody><tr><td>  <strong>Vers√£o do SO</strong> </td><td>  CentOS Linux 7.6 x86_64 </td><td>  CentOS Linux 7.5 x86_64 </td></tr><tr><td>  <strong>Vers√£o do servidor DB</strong> </td><td>  MySQL 5.7.26 </td><td>  PostgreSQL 10.5 </td></tr><tr><td>  <strong>Porta do banco de dados</strong> </td><td>  3306 </td><td>  5433 </td></tr><tr><td>  <strong>Endere√ßo IP</strong> </td><td>  192.168.56.102 </td><td>  192.168.56.106 </td></tr></tbody></table></div><br><p>  Para come√ßar, prepare todos os componentes necess√°rios para instalar o pg_chameleon.  Neste exemplo, o Python 3.6.8 est√° instalado, o que cria um ambiente virtual e o ativa. </p><br><pre><code class="plaintext hljs">$&gt; wget https://www.python.org/ftp/python/3.6.8/Python-3.6.8.tar.xz $&gt; tar -xJf Python-3.6.8.tar.xz $&gt; cd Python-3.6.8 $&gt; ./configure --enable-optimizations $&gt; make altinstall</code> </pre> <br><p>  Ap√≥s a instala√ß√£o bem-sucedida do Python3.6, voc√™ precisa atender aos outros requisitos, por exemplo, criar e ativar um ambiente virtual.  Al√©m disso, o m√≥dulo pip √© atualizado para a vers√£o mais recente e √© usado para instalar o pg_chameleon.  Nos comandos abaixo, o pg_chameleon 2.0.9 √© intencionalmente instalado, embora a vers√£o mais recente seja 2.0.10.  Isso √© necess√°rio para evitar novos erros na vers√£o atualizada. </p><br><pre> <code class="plaintext hljs">$&gt; python3.6 -m venv venv $&gt; source venv/bin/activate (venv) $&gt; pip install pip --upgrade (venv) $&gt; pip install pg_chameleon==2.0.9</code> </pre> <br><p>  Em seguida, chamamos pg_chameleon (chameleon √© um comando) com o argumento set_configuration_files para ativar o pg_chameleon e criar diret√≥rios e arquivos de configura√ß√£o padr√£o. </p><br><pre> <code class="plaintext hljs">(venv) $&gt; chameleon set_configuration_files creating directory /root/.pg_chameleon creating directory /root/.pg_chameleon/configuration/ creating directory /root/.pg_chameleon/logs/ creating directory /root/.pg_chameleon/pid/ copying configuration example in /root/.pg_chameleon/configuration//config-example.yml</code> </pre> <br><p>  Agora criamos uma c√≥pia do config-example.yml como default.yml para que ele se torne o arquivo de configura√ß√£o padr√£o.  Um arquivo de configura√ß√£o de amostra para este exemplo √© mostrado abaixo. </p><br><pre> <code class="plaintext hljs">$&gt; cat default.yml --- #global settings pid_dir: '~/.pg_chameleon/pid/' log_dir: '~/.pg_chameleon/logs/' log_dest: file log_level: info log_days_keep: 10 rollbar_key: '' rollbar_env: '' # type_override allows the user to override the default type conversion into a different one. type_override: "tinyint(1)": override_to: boolean override_tables: - "*" #postgres destination connection pg_conn: host: "192.168.56.106" port: "5433" user: "usr_replica" password: "pass123" database: "db_replica" charset: "utf8" sources: mysql: db_conn: host: "192.168.56.102" port: "3306" user: "usr_replica" password: "pass123" charset: 'utf8' connect_timeout: 10 schema_mappings: world_x: pgworld_x limit_tables: # - delphis_mediterranea.foo skip_tables: # - delphis_mediterranea.bar grant_select_to: - usr_readonly lock_timeout: "120s" my_server_id: 100 replica_batch_size: 10000 replay_max_rows: 10000 batch_retention: '1 day' copy_max_memory: "300M" copy_mode: 'file' out_dir: /tmp sleep_loop: 1 on_error_replay: continue on_error_read: continue auto_maintenance: "disabled" gtid_enable: No type: mysql skip_events: insert: - delphis_mediterranea.foo #skips inserts on the table delphis_mediterranea.foo delete: - delphis_mediterranea #skips deletes on schema delphis_mediterranea update:</code> </pre> <br><p>  O arquivo de configura√ß√£o neste exemplo √© um arquivo de amostra com pg_chameleon com pequenas altera√ß√µes de acordo com os ambientes de origem e de destino, e a seguir √© apresentada uma vis√£o geral das v√°rias se√ß√µes do arquivo de configura√ß√£o. </p><br><p>  No arquivo de configura√ß√£o default.yml, h√° uma se√ß√£o de configura√ß√µes globais onde √© poss√≠vel controlar configura√ß√µes como o local do arquivo de bloqueio, o local dos logs, o per√≠odo de armazenamento dos logs etc. A pr√≥xima se√ß√£o √© a se√ß√£o de substitui√ß√£o de tipo, onde o conjunto √© especificado regras para substituir tipos durante a replica√ß√£o.  O exemplo padr√£o usa uma regra de redefini√ß√£o de tipo que converte tinyint (1) em um valor booleano.  Na pr√≥xima se√ß√£o, indicamos os detalhes da conex√£o com o banco de dados de destino.  No nosso caso, este √© um banco de dados PostgreSQL designado como pg_conn.  Na √∫ltima se√ß√£o, indicamos os dados de origem, ou seja, os par√¢metros de conex√£o do banco de dados de origem, o esquema de mapeamento dos bancos de dados de origem e de destino, as tabelas a serem ignoradas, tempo limite, mem√≥ria, tamanho do pacote.  Observe que ‚Äúorigens‚Äù √© indicado no plural, ou seja, podemos adicionar v√°rios bancos de dados de origem para o mesmo destino para definir a configura√ß√£o muitos-para-um. </p><br><p>  O banco de dados world_x no exemplo cont√©m 4 tabelas com linhas que a comunidade MySQL oferece para o exemplo.  Pode ser baixado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  O banco de dados de amostra vem na forma de tar e um arquivo compactado com instru√ß√µes para criar e importar seq√º√™ncias de caracteres. </p><br><p>  Um usu√°rio especial √© criado nos bancos de dados MySQL e PostgreSQL com o mesmo nome usr_replica.  No MySQL, ele recebe direitos adicionais para ler todas as tabelas replicadas. </p><br><pre> <code class="plaintext hljs">mysql&gt; CREATE USER usr_replica ; mysql&gt; SET PASSWORD FOR usr_replica='pass123'; mysql&gt; GRANT ALL ON world_x.* TO 'usr_replica'; mysql&gt; GRANT RELOAD ON *.* to 'usr_replica'; mysql&gt; GRANT REPLICATION CLIENT ON *.* to 'usr_replica'; mysql&gt; GRANT REPLICATION SLAVE ON *.* to 'usr_replica'; mysql&gt; FLUSH PRIVILEGES;</code> </pre> <br><p>  No lado do PostgreSQL, o banco de dados db_replica √© criado, o que aceita altera√ß√µes no banco de dados MySQL.  O usu√°rio usr_replica do PostgreSQL √© configurado automaticamente como o propriet√°rio dos dois esquemas pgworld_x e sch_chameleon que cont√™m tabelas replicadas reais e tabelas com diret√≥rios de replica√ß√£o, respectivamente.  O argumento create_replica_schema √© respons√°vel pela configura√ß√£o autom√°tica, como voc√™ ver√° abaixo. </p><br><pre> <code class="plaintext hljs">postgres=# CREATE USER usr_replica WITH PASSWORD 'pass123'; CREATE ROLE postgres=# CREATE DATABASE db_replica WITH OWNER usr_replica; CREATE DATABASE</code> </pre> <br><p>  O banco de dados MySQL est√° configurado com algumas altera√ß√µes para prepar√°-lo para replica√ß√£o, como mostrado abaixo.  Voc√™ precisar√° reiniciar o servidor de banco de dados para que as altera√ß√µes entrem em vigor. </p><br><pre> <code class="plaintext hljs">$&gt; vi /etc/my.cnf binlog_format= ROW binlog_row_image=FULL log-bin = mysql-bin server-id = 1</code> </pre> <br><p>  Agora √© importante verificar a conex√£o com os dois servidores de banco de dados para que n√£o haja problemas ao executar comandos pg_chameleon. </p><br><p>  No n√≥ PostgreSQL: </p><br><pre> <code class="plaintext hljs">$&gt; mysql -u usr_replica -Ap'admin123' -h 192.168.56.102 -D world_x</code> </pre> <br><p>  No n√≥ MySQL: </p><br><pre> <code class="plaintext hljs">$&gt; psql -p 5433 -U usr_replica -h 192.168.56.106 db_replica</code> </pre> <br><p>  Os tr√™s comandos a seguir pg_chameleon (chameleon) preparam o ambiente, adicionam a fonte e inicializam a r√©plica.  O argumento create_replica_schema em pg_chameleon cria o esquema padr√£o (sch_chameleon) e o esquema de replica√ß√£o (pgworld_x) no banco de dados PostgreSQL, como j√° dissemos.  O argumento add_source adiciona o banco de dados original √† configura√ß√£o lendo o arquivo de configura√ß√£o (default.yml) e, no nosso caso, √© mysql, e init_replica inicializa a configura√ß√£o com base nos par√¢metros no arquivo de configura√ß√£o. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon create_replica_schema --debug $&gt; chameleon add_source --config default --source mysql --debug $&gt; chameleon init_replica --config default --source mysql --debug</code> </pre> <br><p>  A sa√≠da desses tr√™s comandos obviamente indica sua execu√ß√£o bem-sucedida.  Todas as falhas ou erros de sintaxe s√£o indicadas em mensagens simples e claras com dicas de solu√ß√£o de problemas. </p><br><p>  Por fim, inicie a replica√ß√£o com start_replica e receba uma mensagem de sucesso. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon start_replica --config default --source mysql output: Starting the replica process for source mysql</code> </pre> <br><p>  O status da replica√ß√£o pode ser solicitado usando o argumento show_status, e os erros podem ser visualizados usando o argumento show_errors. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Resultado.</a> </p><br><p>  Como dissemos antes, cada fun√ß√£o de replica√ß√£o √© controlada por daemons.  Para visualiz√°-los, consultamos a tabela de processos com o comando ps do Linux, como mostrado abaixo. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Resultado.</a> </p><br><p>  A replica√ß√£o n√£o √© considerada configurada at√© test√°-la em tempo real, como mostrado abaixo.  Criamos uma tabela, inserimos alguns registros no banco de dados MySQL e chamamos o argumento sync_tables em pg_chameleon para atualizar os daemons e replicar a tabela com os registros no banco de dados PostgreSQL. </p><br><pre> <code class="plaintext hljs">mysql&gt; create table t1 (n1 int primary key, n2 varchar(10)); Query OK, 0 rows affected (0.01 sec) mysql&gt; insert into t1 values (1,'one'); Query OK, 1 row affected (0.00 sec) mysql&gt; insert into t1 values (2,'two'); Query OK, 1 row affected (0.00 sec)</code> </pre> <br><pre> <code class="plaintext hljs">$&gt; chameleon sync_tables --tables world_x.t1 --config default --source mysql Sync tables process for source mysql started.</code> </pre> <br><p>  Para confirmar os resultados do teste, consultamos a tabela no banco de dados PostgreSQL e exibimos as linhas. </p><br><pre> <code class="plaintext hljs">$&gt; psql -p 5433 -U usr_replica -d db_replica -c "select * from pgworld_x.t1"; n1 | n2 ----+------- 1 | one 2 | two</code> </pre> <br><p>  Se realizarmos a migra√ß√£o, os seguintes comandos pg_chameleon ser√£o o seu fim.  Os comandos precisam ser executados depois de termos certeza de que as linhas de todas as tabelas de destino foram replicadas e o resultado ser√° um banco de dados PostgreSQL perfeitamente migrado sem refer√™ncia ao banco de dados ou esquema de replica√ß√£o original (sch_chameleon). </p><br><pre> <code class="plaintext hljs">$&gt; chameleon stop_replica --config default --source mysql $&gt; chameleon detach_replica --config default --source mysql --debug</code> </pre> <br><p>  Se desejado, os seguintes comandos podem remover o esquema original de configura√ß√£o e replica√ß√£o. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon drop_source --config default --source mysql --debug $&gt; chameleon drop_replica_schema --config default --source mysql --debug</code> </pre> <br><h3 id="preimuschestva-pg_chameleon">  Benef√≠cios de pg_chameleon </h3><br><p>  F√°cil instala√ß√£o e configura√ß√£o. <br>  Solu√ß√£o de problemas conveniente e detec√ß√£o de anomalias com claras mensagens de erro. <br>  Voc√™ pode adicionar tabelas especiais adicionais √† replica√ß√£o ap√≥s a inicializa√ß√£o sem alterar o restante da configura√ß√£o. <br>  Voc√™ pode configurar v√°rios bancos de dados de origem para um destino, e isso √© muito conveniente se voc√™ combinar dados de um ou v√°rios bancos de dados MySQL em um banco de dados PostgreSQL. <br>  Voc√™ n√£o pode replicar tabelas selecionadas. </p><br><h3 id="nedostatki-pg_chameleon">  Desvantagens do pg_chameleon </h3><br><p>  Suportado apenas com o MySQL 5.5 e superior como fonte e o PostgreSQL 9.5 e superior como banco de dados de destino. <br>  Cada tabela deve ter uma chave prim√°ria ou exclusiva, caso contr√°rio, as tabelas s√£o inicializadas no processo init_replica, mas n√£o s√£o replicadas. <br>  Replica√ß√£o unidirecional - somente do MySQL para o PostgreSQL.  Portanto, √© adequado apenas para o esquema ativo-passivo. <br>  Somente o banco de dados MySQL pode ser a fonte, e o suporte ao banco de dados PostgreSQL, pois a fonte √© apenas experimental e com limita√ß√µes (saiba mais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> ) </p><br><h3 id="itogi-po-pg_chameleon">  Resultados Pg_chameleon </h3><br><p>  O m√©todo de replica√ß√£o no pg_chameleon √© √≥timo para migrar um banco de dados do MySQL para o PostgreSQL.  Um ponto negativo significativo √© que a replica√ß√£o √© apenas unidirecional; portanto, √© improv√°vel que os especialistas em banco de dados desejem us√°-la para outra coisa que n√£o a migra√ß√£o.  Mas o problema da replica√ß√£o unidirecional pode ser resolvido por outra ferramenta de c√≥digo aberto - o SymmetricDS. </p><br><p>  Leia mais na documenta√ß√£o oficial <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Ajuda na linha de comando pode ser encontrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://pgchameleon.org/documents/usage.html&amp;usg=ALkJrhgdMns-tnRdP0IsZycL4u9qEECoyA#">aqui</a> . </p><br><h3 id="obzor-symmetricds">  Vis√£o geral do SymmetricDS </h3><br><p>  O SymmetricDS √© uma ferramenta de c√≥digo aberto que replica qualquer banco de dados para qualquer outro banco de dados comum: Oracle, MongoDB, PostgreSQL, MySQL, SQL Server, MariaDB, DB2, Sybase, Greenplum, Informix, H2, Firebird e outras inst√¢ncias de banco de dados em nuvem, por exemplo Redshift e Azure, etc. Fun√ß√µes dispon√≠veis: sincroniza√ß√£o de bancos de dados e arquivos, replica√ß√£o de v√°rios bancos de dados l√≠deres, sincroniza√ß√£o filtrada, convers√£o e outros.  Esta √© uma ferramenta Java e requer uma libera√ß√£o padr√£o do JRE ou JDK (vers√£o 8.0 ou superior).  Aqui voc√™ pode registrar altera√ß√µes de dados em gatilhos no banco de dados de origem e envi√°-las ao banco de dados de destino correspondente na forma de pacotes. </p><br><h3 id="vozmozhnosti-symmetricds">  Recursos do SymmetricDS </h3><br><p>  A ferramenta √© independente da plataforma, ou seja, dois ou mais bancos de dados diferentes podem trocar dados. <br>  Os bancos de dados relacionais s√£o sincronizados escrevendo altera√ß√µes de dados e os bancos de dados baseados no sistema de arquivos usam a sincroniza√ß√£o de arquivos. <br>  Replica√ß√£o bidirecional usando os m√©todos Push and Pull com base em um conjunto de regras. <br>  A transmiss√£o de dados √© poss√≠vel atrav√©s de redes seguras e redes com baixa largura de banda. <br>  Recupera√ß√£o autom√°tica quando os n√≥s s√£o retomados ap√≥s uma falha e resolu√ß√£o autom√°tica de conflitos. <br>  APIs de extens√£o poderosas e compat√≠veis com a nuvem. </p><br><h3 id="primer-1">  Exemplo </h3><br><p>  O SymmetricDS pode ser configurado de duas maneiras: <br>  Um n√≥ principal (pai) que coordena centralmente a replica√ß√£o de dados entre dois n√≥s escravos (filhos) e a troca de dados entre n√≥s filhos √© realizada apenas atrav√©s do pai. <br>  O n√≥ ativo (n√≥ 1) pode trocar dados para replica√ß√£o com outro n√≥ ativo (n√≥ 2) sem um intermedi√°rio. </p><br><p>  Nos dois casos, os dados s√£o trocados usando Push e Pull.  Neste exemplo, veremos a configura√ß√£o ativo-ativo.  Descreva a arquitetura inteira por muito tempo. Confira o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guia</a> para saber mais sobre o SymmetricDS. </p><br><p>  A instala√ß√£o do SymmetricDS √© muito simples: baixe a vers√£o de c√≥digo aberto do arquivo zip <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a> e extraia-a onde quiser.  A tabela abaixo fornece informa√ß√µes sobre o local da instala√ß√£o e a vers√£o do SymmetricDS neste exemplo, bem como vers√µes de banco de dados, vers√µes do Linux, endere√ßos IP e portas para os dois n√≥s. </p><br><div class="scrollable-table"><table><thead><tr><th>  Anfitri√£o </th><th>  vm1 </th><th>  vm2 </th></tr></thead><tbody><tr><td>  <strong>Vers√£o do SO</strong> </td><td>  CentOS Linux 7.6 x86_64 </td><td>  CentOS Linux 7.6 x86_64 </td></tr><tr><td>  <strong>Vers√£o do servidor DB</strong> </td><td>  MySQL 5.7.26 </td><td>  PostgreSQL 10.5 </td></tr><tr><td>  <strong>Porta do banco de dados</strong> </td><td>  3306 </td><td>  5832 </td></tr><tr><td>  <strong>Endere√ßo IP</strong> </td><td>  192.168.1.107 </td><td>  192.168.1.112 </td></tr><tr><td>  <strong>Vers√£o SymmetricDS</strong> </td><td>  SymmetricDS 3.9 </td><td>  SymmetricDS 3.9 </td></tr><tr><td>  <strong>Caminho de instala√ß√£o do SymmetricDS</strong> </td><td>  /usr/local/symmetric-server-3.9.20 </td><td>  /usr/local/symmetric-server-3.9.20 </td></tr><tr><td>  <strong>Nome do n√≥ SymmetricDS</strong> </td><td>  corp-000 </td><td>  store-001 </td></tr></tbody></table></div><br><p>  Aqui instalamos o SymmetricDS em /usr/local/symmetric-server-3.9.20, e diferentes subdiret√≥rios e arquivos ser√£o armazenados ali.  Estamos interessados ‚Äã‚Äãnos exemplos e nos mecanismos de diret√≥rios aninhados.  O diret√≥rio de amostras cont√©m arquivos de configura√ß√£o de amostra com propriedades do host, bem como scripts SQL de amostra para iniciar rapidamente a demonstra√ß√£o. </p><br><p>  No diret√≥rio de amostras, vemos tr√™s arquivos de configura√ß√£o com propriedades do n√≥ - o nome mostra a natureza do n√≥ em um esquema espec√≠fico. </p><br><pre> <code class="plaintext hljs">corp-000.properties store-001.properties store-002.properties</code> </pre> <br><p>  O SymmetricDS possui todos os arquivos de configura√ß√£o necess√°rios para um esquema base de 3 n√≥s (op√ß√£o 1) e os mesmos arquivos podem ser usados ‚Äã‚Äãpara um esquema de 2 n√≥s (op√ß√£o 2).  Copie o arquivo de configura√ß√£o desejado do diret√≥rio de amostras para os mecanismos no host vm1.  Acontece assim: </p><br><pre> <code class="plaintext hljs">$&gt; cat engines/corp-000.properties engine.name=corp-000 db.driver=com.mysql.jdbc.Driver db.url=jdbc:mysql://192.168.1.107:3306/replica_db?autoReconnect=true&amp;useSSL=false db.user=root db.password=admin123 registration.url= sync.url=http://192.168.1.107:31415/sync/corp-000 group.id=corp external.id=000</code> </pre> <br><p>  Esse n√≥ na configura√ß√£o do SymmetricDS √© chamado corp-000 e a conex√£o com o banco de dados √© processada pelo driver mysql jdbc, que usa a cadeia de conex√£o especificada acima e as credenciais de login.  N√≥s nos conectamos ao banco de dados replica_db e as tabelas ser√£o criadas durante a cria√ß√£o do esquema.  sync.url mostra o site de comunica√ß√£o com o n√≥ para sincroniza√ß√£o. </p><br><p>  O n√≥ 2 no host vm2 √© configurado como store-001 e o restante √© especificado no arquivo node.properties abaixo.  O n√≥ store-001 executa o banco de dados PostgreSQL e pgdb_replica √© o banco de dados para replica√ß√£o.  registration.url permite que o host vm2 entre em contato com o host vm1 e obtenha detalhes de configura√ß√£o dele. </p><br><pre> <code class="plaintext hljs">$&gt; cat engines/store-001.properties engine.name=store-001 db.driver=org.postgresql.Driver db.url=jdbc:postgresql://192.168.1.112:5832/pgdb_replica db.user=postgres db.password=admin123 registration.url=http://192.168.1.107:31415/sync/corp-000 group.id=store external.id=001</code> </pre> <br><p>  O exemplo pr√©-criado do SymmetricDS cont√©m op√ß√µes para configurar a replica√ß√£o bidirecional entre dois servidores de banco de dados (dois n√≥s).  As etapas abaixo s√£o executadas no host vm1 (corp-000), que criar√° um esquema de exemplo com 4 tabelas.  Em seguida, executar create-sym-tables com o comando symadmin cria tabelas de diret√≥rios nas quais regras e dire√ß√£o de replica√ß√£o entre n√≥s ser√£o armazenadas.  Por fim, dados de amostra s√£o carregados nas tabelas. </p><br><pre> <code class="plaintext hljs">vm1$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm1$&gt; ./dbimport --engine corp-000 --format XML create_sample.xml vm1$&gt; ./symadmin --engine corp-000 create-sym-tables vm1$&gt; ./dbimport --engine corp-000 insert_sample.sql</code> </pre> <br><p>  No exemplo, as tabelas item e item_selling_price s√£o configuradas automaticamente para replicar de corp-000 para store-001, e as tabelas de venda (sale_transaction e sale_return_line_item) s√£o configuradas automaticamente para replicar da store-001 para corp-000.  Agora crie o esquema no banco de dados PostgreSQL no host vm2 (store-001) para prepar√°-lo para receber dados do corp-000. </p><br><pre> <code class="plaintext hljs">vm2$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm2$&gt; ./dbimport --engine store-001 --format XML create_sample.xml</code> </pre> <br><p>  Certifique-se de verificar se o banco de dados MySQL na vm1 possui tabelas de amostra e tabelas de diret√≥rio SymmetricDS.  Observe que as tabelas do sistema SymmetricDS (com o prefixo sym_) agora est√£o dispon√≠veis apenas no host corp-000, porque executamos o comando create-sym-tables e gerenciamos a replica√ß√£o.  E no banco de dados no n√≥ store-001, haver√° apenas 4 tabelas de exemplo sem dados. </p><br><p>  S√≥ isso.  O ambiente est√° pronto para executar processos do servidor sym nos dois n√≥s, como mostrado abaixo. </p><br><pre> <code class="plaintext hljs">vm1$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm1$&gt; sym 2&gt;&amp;1 &amp;</code> </pre> <br><p>  As entradas de log s√£o enviadas para o arquivo de log em segundo plano (symmetric.log) na pasta de log no diret√≥rio em que o SymmetricDS est√° instalado, bem como para a sa√≠da padr√£o.  O servidor sym agora pode ser iniciado no n√≥ store-001. </p><br><pre> <code class="plaintext hljs">vm2$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm2$&gt; sym 2&gt;&amp;1 &amp;</code> </pre> <br><p>  Se voc√™ executar o processo do servidor sym no host vm2, ele criar√° as tabelas de cat√°logos SymmetricDS no banco de dados PostgreSQL.  Se voc√™ executar o processo do servidor sym nos dois n√≥s, eles se coordenar√£o entre si para replicar dados de corp-000 para store-001.  Se, ap√≥s alguns segundos, consultarmos todas as 4 tabelas dos dois lados, veremos que a replica√ß√£o foi bem-sucedida.  Ou voc√™ pode enviar o bootstrap para store-001 de corp-000 com o seguinte comando. </p><br><pre> <code class="plaintext hljs">vm1$&gt; ./symadmin --engine corp-000 reload-node 001</code> </pre> <br><p>  Nesse ponto, um novo registro √© inserido na tabela de itens no banco de dados MySQL no host corp-000 (host: vm1) e voc√™ pode verificar sua replica√ß√£o no banco de dados PostgreSQL no host store-001 (host: vm2).  Vemos uma opera√ß√£o Pull para mover dados de corp-000 para store-001. </p><br><pre> <code class="plaintext hljs">mysql&gt; insert into item values ('22000002','Jelly Bean'); Query OK, 1 row affected (0.00 sec)</code> </pre> <br><pre> <code class="plaintext hljs">vm2$&gt; psql -p 5832 -U postgres pgdb_replica -c "select * from item" item_id | name ----------+----------- 11000001 | Yummy Gum 22000002 | Jelly Bean (2 rows)</code> </pre> <br><p>  Para executar uma opera√ß√£o Push para mover dados do store-001 para corp-000, insira um registro na tabela sale_transaction e verifique se a replica√ß√£o est√° conclu√≠da. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Resultado.</a> </p><br><p>  Vemos a configura√ß√£o bem-sucedida da replica√ß√£o bidirecional de tabelas de amostra entre os bancos de dados MySQL e PostgreSQL.  Para configurar a replica√ß√£o para novas tabelas de usu√°rios, fa√ßa o seguinte:  Criamos a tabela t1 como exemplo e configuramos as regras para sua replica√ß√£o da seguinte maneira.  Portanto, apenas configuramos a replica√ß√£o de corp-000 para store-001. </p><br><pre> <code class="plaintext hljs">mysql&gt; create table t1 (no integer); Query OK, 0 rows affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_channel (channel_id,create_time,last_update_time) values ('t1',current_timestamp,current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_trigger (trigger_id, source_table_name,channel_id, last_update_time, create_time) values ('t1', 't1', 't1', current_timestamp, current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_trigger_router (trigger_id, router_id, Initial_load_order, create_time,last_update_time) values ('t1', 'corp-2-store-1', 1, current_timestamp,current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><p>  A configura√ß√£o √© ent√£o notificada de uma altera√ß√£o no esquema, ou seja, a adi√ß√£o de uma nova tabela, usando o comando symadmin com o argumento sync-triggers, que recria os gatilhos para corresponder √†s defini√ß√µes da tabela.  O esquema de envio √© executado para enviar as altera√ß√µes de esquema para o n√≥ store-001 e a replica√ß√£o da tabela t1 √© configurada. </p><br><pre> <code class="plaintext hljs">vm1$&gt; ./symadmin -e corp-000 --node=001 sync-triggers vm1$&gt; ./symadmin send-schema -e corp-000 --node=001 t1</code> </pre> <br><h3 id="preimuschestva-symmetricds">  Benef√≠cios do SymmetricDS </h3><br><p>  F√°cil instala√ß√£o e configura√ß√£o, incluindo um conjunto de arquivos prontos com par√¢metros para criar um circuito com tr√™s ou dois n√≥s. <br>  Bancos de dados entre plataformas e independ√™ncia de plataforma, incluindo servidores, laptops e dispositivos m√≥veis. <br>  Replicar qualquer banco de dados para qualquer outro banco de dados localmente, em uma WAN ou na nuvem. <br>  A capacidade de trabalhar de maneira ideal com alguns bancos de dados ou v√°rios milhares para facilitar a replica√ß√£o. <br>  Vers√£o paga com interface gr√°fica e excelente suporte. </p><br><h3 id="nedostatki-symmetricds">  Desvantagens do SymmetricDS </h3><br><p>  √â necess√°rio determinar manualmente as regras e a dire√ß√£o da replica√ß√£o por meio das instru√ß√µes SQL na linha de comandos para carregar tabelas de diret√≥rio, o que √© inconveniente. <br>  A configura√ß√£o de muitas tabelas para replica√ß√£o pode ser entediante se voc√™ n√£o usar scripts para criar instru√ß√µes SQL que definem as regras e a dire√ß√£o da replica√ß√£o. <br>  Muita informa√ß√£o √© inserida nos logs e, √†s vezes, voc√™ precisa limpar o arquivo de log para que ele n√£o ocupe muito espa√ßo. </p><br><h3 id="itogi-po-symmetricds">  Resumo do SymmetricDS </h3><br><p>  O SymmetricDS permite configurar a replica√ß√£o bidirecional entre dois, tr√™s ou at√© v√°rios milhares de n√≥s para replicar e sincronizar arquivos.  Essa √© uma ferramenta exclusiva que executa independentemente muitas tarefas, por exemplo, recupera√ß√£o autom√°tica de dados ap√≥s um longo tempo de inatividade em um n√≥, troca segura e eficiente de dados entre n√≥s via HTTPS, gerenciamento autom√°tico de conflitos com base em um conjunto de regras etc. O SymmetricDS replica entre todos os bancos de dados, portanto, ele pode ser usado para uma variedade de cen√°rios, incluindo migra√ß√£o, atualiza√ß√£o, distribui√ß√£o, filtragem e convers√£o de dados entre plataformas. </p><br><p>  A amostra √© baseada no Guia de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in√≠cio</a> r√°pido oficial do SymmetricDS.  O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">guia do usu√°rio</a> detalha v√°rios conceitos relacionados √† configura√ß√£o da replica√ß√£o usando o SymmetricDS. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467313/">https://habr.com/ru/post/pt467313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467295/index.html">A t√£o esperada liga√ß√£o de exibi√ß√£o no Android</a></li>
<li><a href="../pt467299/index.html">Conceitos: simplificando a implementa√ß√£o das classes do STD Utility</a></li>
<li><a href="../pt467301/index.html">Como a IA funciona em Hitman (2016)</a></li>
<li><a href="../pt467303/index.html">A hist√≥ria do mais jovem programador do PSB: o hackathon tornou-se a porta do banco</a></li>
<li><a href="../pt467305/index.html">Quando a cidade √© inteligente: a experi√™ncia das megacidades</a></li>
<li><a href="../pt467317/index.html">Como o SoftBank engoliu o mundo</a></li>
<li><a href="../pt467323/index.html">Vis√£o geral dos recursos de programa√ß√£o do microcontrolador Qt Creator 4.10 e QBS 1.14</a></li>
<li><a href="../pt467327/index.html">Como me tornei programador aos 35 anos</a></li>
<li><a href="../pt467329/index.html">Os melhores produtos partem de problemas reais: interfone sobre trabalhos a serem realizados. Parte 1</a></li>
<li><a href="../pt467331/index.html">Venda + uma bela loja online no WordPress por US $ 269 "do zero" - nossa experi√™ncia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>