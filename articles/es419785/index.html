<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèΩ üçÆ üé§ C√≥mo funciona MSTP ‚òùüèø üìè üí™üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy hablemos de MSTP. Antes de tratar con MSTP, debe familiarizarse con los protocolos STP y RSTP . MSTP es una modificaci√≥n de RSTP y, por lo tanto, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo funciona MSTP</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419785/"> Hoy hablemos de MSTP.  Antes de tratar con MSTP, debe familiarizarse con los protocolos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STP</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RSTP</a> .  MSTP es una modificaci√≥n de RSTP y, por lo tanto, de STP.  Si RSTP es el mismo STP, solo que con un env√≠o m√°s optimizado de BPDU y STP funciona en general, entonces ¬øpor qu√© deber√≠amos crear un MSTP que funcione sobre la base de RSTP?  La caracter√≠stica principal de MSTP es la capacidad de trabajar con VLAN.  Algunos lectores pueden decir: "Espera, ¬øCisco pvst + y rpvst + no pueden trabajar con vlan?"  RPVST + y PVST + simplemente ejecutan instancias RSTP o STP independientes dentro de un solo l√≠mite de vlan.  Pero aqu√≠ hay problemas: <br><br><ul><li>  RPVST + y PVST + est√°n disponibles solo en equipos Cisco, y en Cisco no hay STP ni RSTP cl√°sicos.  ¬øQu√© debemos hacer si otros proveedores participan en la topolog√≠a? </li><li>  Cada instancia de STP y RSTP env√≠a BPDU cada dos segundos.  Si se omiten 100 vlanes en el puerto troncal, significa que se enviar√°n 100 mensajes en 2 segundos.  Lo cual no es demasiado bueno. </li><li>  Cisco tiene un l√≠mite en la cantidad de instancias STP o RSTP en un solo conmutador, seg√∫n el modelo.  Es decir, agregando 128 vlans en alg√∫n switch, enfrentaremos tal restricci√≥n.  Enlace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">aqu√≠</a> </li></ul><a name="habracut"></a><br>  Todos estos problemas se resuelven con √©xito mediante el protocolo MSTP de m√∫ltiples proveedores.  Intentaremos ocuparnos de su trabajo.  El esquema para construir una topolog√≠a sin bucle en RSTP es construir un gr√°fico sin intersecciones, independientemente de la topolog√≠a l√≥gica, sin considerar d√≥nde y c√≥mo se configuran los vlans.  En MSTP tenemos la oportunidad de combinar ciertos vlans en un grupo y construir una topolog√≠a separada para cada grupo.  Por ejemplo, eche un vistazo a dicha topolog√≠a: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/893/ec7/7a1/893ec77a1fc1abfe79a50798cbd67141.jpg" alt="Mi imagen"></a> <br><br>  Las PC act√∫an como segmentos de red.  PC1, PC3 es un segmento de red donde se usan vlans de 10 a 50, y PC2, PC4 son vlans de 50 a 100. En los conmutadores Sw1-4, se crean vlans de 10 a 100. Si usamos el protocolo RSTP, entonces segmentos PC1 y PC2 para llegar a los segmentos PC3 y PC4, respectivamente, debe usar una ruta com√∫n, eligi√©ndola entre dos posibles: <b>Sw1-Sw2-Sw4</b> o <b>Sw1-Sw3-Sw4</b> .  Desafortunadamente, no funcionar√° construir un circuito con distribuci√≥n de carga y una de estas rutas estar√° bloqueada y vac√≠a.  Con la ayuda de PVST + y RPVST +, ser√° posible hacer esto, pero existen los problemas mencionados anteriormente.  MSTP nos ayuda en este asunto, creando instancias RSTP para un grupo de vlans 10-50 y 50-100.  Se puede configurar que el interruptor ra√≠z para Vlan 10-50 sea Sw3 y para 50-100 - Sw2.  La <b>ruta Sw1-Sw3-Sw4</b> ser√° utilizada por vlan 10-50, la <b>ruta Sw1-Sw2-Sw4</b> ser√° utilizada por vlan 50-100.  La idea es crear instancias que combinen vlans y construyan un √°rbol RSTP por separado para cada instancia.  Por lo tanto, combinando vlana 10-50 y 51-100 en diferentes instancias, el protocolo MSTP le permitir√° construir √°rboles independientes para cada instancia.  La configuraci√≥n se ver√° as√≠: <br><blockquote>  configuraci√≥n de mst de √°rbol de expansi√≥n <br>  nota de nombre <br>  instancia 1 vlan 10-50 <br>  instancia 2 vlan 51-100 <br></blockquote>  Ser√° id√©ntico en los 4 interruptores.  Los interruptores con configuraci√≥n id√©ntica de estos par√°metros crean una regi√≥n.  Con respecto a las regiones, hablaremos con m√°s detalle a continuaci√≥n, mientras consideramos la topolog√≠a dentro de una regi√≥n.  Para cada caso, se selecciona su propio Root Bridge.  En Sw3, ingresamos el comando <b>principal de la ra√≠z mst 1 del √°rbol de expansi√≥n</b> para que Sw3 sea el puente ra√≠z para 10-50 vlans, y en la <b>ra√≠z principal del √°rbol de expansi√≥n mst 2 de</b> Sw2 para 51-100 vlans.  Resumiendo, cada instancia - <b>m√∫ltiples instancias de √°rbol de expansi√≥n (MSTI)</b> - combina vlana.  Y cada regi√≥n combina conmutadores que tienen el mismo MSTI.  Estrictamente hablando, en la regi√≥n, el interruptor debe tener los siguientes par√°metros: <br><br><ul><li>  nombre de regi√≥n: el nombre de la regi√≥n.  Definido por el comando de nombre. </li><li>  nivel de revisi√≥n - par√°metro de cambio de configuraci√≥n. </li><li>  MSTI </li></ul><br>  En cada regi√≥n hay una instancia de MSTI 0 (instancia 0), que se crea de manera predeterminada e incluye todos los vlans que no se incluyeron en otras instancias.  La instancia 0 se llama IST: <br>  <b>Internal Spanning Tree (IST)</b> es una copia especial del √°rbol de expansi√≥n que, por defecto, existe en cada regi√≥n MST.  IST asign√≥ el n√∫mero 0 (instancia 0).  Puede enviar y recibir tramas BPDU y sirve para administrar la topolog√≠a dentro de una regi√≥n.  Todas las VLAN configuradas en los conmutadores en esta regi√≥n MST est√°n vinculadas al IST de forma predeterminada. <br>  Root Bridge para IST se llama Regional Root Bridge.  Es a trav√©s de IST que se transmiten las tramas BPDU a trav√©s de las cuales se instala el √°rbol para cada instancia.  Veamos c√≥mo se ve BDPU en esta regi√≥n: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/603/7e8/9b6/6037e89b6888f6219b2bd82c2271c761.jpg" alt="Mi imagen"></a> <br><br>  Antes del comienzo de la Extensi√≥n MST, BPDU MSTP es muy dif√≠cil de separar de BPDU RSTP y, en t√©rminos generales, IST es un RSTP cl√°sico.  MSTP solo agrega datos en MSTI.  BPDU almacena informaci√≥n de puente ra√≠z para la instancia 0-2.  Por lo tanto, para todos los vlans y autoridades, solo se env√≠a un BPDU, que contiene toda la informaci√≥n necesaria.  Este es un gran ahorro sobre PVST + y RPVST +.  Veamos el resultado del comando show spanning-tree mst en el interruptor Sw2: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/211/365/372/2113653723bfbe70f327a68a1ea4f27d.jpg" alt="Mi imagen"></a> <br><br>  Por ejemplo 0 hay un campo especial - Ra√≠z regional.  Ra√≠z regional, seleccionamos Sw3 utilizando el <b>comando primario root spanning-tree mst 0</b> .  La ra√≠z regional es el interruptor ra√≠z para MSTI 0 dentro de la misma regi√≥n.  Para MSTI1, Root tambi√©n es Sw3, y para MSTI2 es Sw2.  En t√©rminos de bloqueo de puertos y convergencia, MSTP repite los principios de RSTP sobre la base de los cuales funciona, por lo que creo que el trabajo de MSTP dentro de una regi√≥n es bastante comprensible.  Considere una topolog√≠a con dos regiones: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/501/c74/f20/501c74f206c089449ca1238133fa5dd8.jpg" alt="Mi imagen"></a> <br><br>  Sobre la Regi√≥n A, se dijo anteriormente, ahora intentemos descubrir c√≥mo interact√∫an las regiones entre s√≠.  En la regi√≥n B, los conmutadores tienen la siguiente configuraci√≥n: <br><blockquote>  configuraci√≥n de mst de √°rbol de expansi√≥n <br>  nombre RegionB <br>  instancia 1 vlan 10-30 <br>  instancia 2 vlan 31-60 <br></blockquote>  Al mismo tiempo, Sw9 es la <b>ra√≠z primaria del √°rbol de expansi√≥n mst 1</b> es el interruptor ra√≠z para Vlan 10-30, y Sw10 es la <b>ra√≠z primaria del √°rbol de expansi√≥n mst 2</b> es el interruptor ra√≠z para Vlan 31-60. <br><br>  La construcci√≥n del √°rbol STP en la Regi√≥n B es similar a la Regi√≥n A y se ha descrito anteriormente.  Simplemente diga, ya que no configuramos el Root Bridge para MSTI 0 en la Regi√≥n B, ser√° seleccionado por la direcci√≥n MAC m√°s baja entre Sw9-12.  La direcci√≥n MAC m√°s peque√±a es Sw9.  Salida de comando con Sw10: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7f4/52a/bbd7f452a27ace3d97fc9b714bfed31a.jpg" alt="Mi imagen"></a> <br><br>  Para MSTI 0 Regional Root 5000.0009.0000 (Sw9).  A continuaci√≥n discutiremos por qu√© Sw9 y por qu√© la direcci√≥n de prioridad o amapola no tiene nada que ver con eso.  Ahora estamos m√°s interesados ‚Äã‚Äãen la cuesti√≥n de lo que suceder√° en la frontera.  Para que el √°rbol STP se construya correctamente entre regiones, se crea un √°rbol com√∫n para todas las regiones que usan MST0 (IST).  Tal √°rbol se llama CIST.  Vamos a presentar el concepto tambi√©n CST.  Entonces, primero recuerde el IST: <br><br><ul><li>  <b>Internal Spanning Tree (IST)</b> es una copia especial del √°rbol de expansi√≥n que existe por defecto en cada regi√≥n MST.  IST asign√≥ el n√∫mero 0 (instancia 0).  IST puede enviar y recibir tramas BPDU y sirve para administrar la topolog√≠a dentro de una regi√≥n.  Por defecto, todas las VLAN en la misma regi√≥n est√°n vinculadas a IST.  Si se crean varios MSTI en una regi√≥n, las VLAN que no est√°n asociadas a ellas permanecen vinculadas al IST.  En nuestras regiones A y B, se est√° construyendo un √°rbol STP independiente para vlans que no cayeron en las autoridades 1 y 2. El puente ra√≠z en IST se llama ra√≠z regional. </li><li>  <b>Common Spanning Tree (CST)</b> : un √°rbol que conecta las regiones y todos los conmutadores STP, RSTP, PVST +, RPVST + (no los conmutadores MST). </li><li>  <b>√Årbol de expansi√≥n com√∫n e interno (CIST)</b> : un √°rbol de expansi√≥n √∫nico que combina el CST y el IST de cada regi√≥n MST. </li></ul><br>  Para comprender los l√≠mites de cada √°rbol, sugiero el siguiente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">art√≠culo</a> . <br><br>  IST es un √°rbol dentro de una regi√≥n, CIST es un √°rbol entre regiones, CST es un √°rbol que combina √°rboles dentro de una regi√≥n y un √°rbol para conectar regiones. <br><br>  Desde que introdujimos el comando <b>principal ra√≠z spanning-tree mst 0</b> en Sw3, el puente ra√≠z CIST para ambas regiones ser√° Sw3.  Si solo hay una regi√≥n en toda la topolog√≠a, entonces el Puente ra√≠z regional y el Puente ra√≠z CIST coinciden.  Si hay muchas regiones, se selecciona la mejor Ra√≠z regional entre todas las regiones.  Adem√°s, los conmutadores que usan protocolos distintos de MSTP se pueden usar en la elecci√≥n para el rol de CIST Root Bridge.  Si intenta crear una imagen general, puede explicar la interacci√≥n de las regiones de la siguiente manera: cada regi√≥n parece ser una combinaci√≥n de varios conmutadores y se presenta a otros conmutadores como un conmutador virtual grande.  Es decir, si consideramos nuestra topolog√≠a a trav√©s de los ojos de la regi√≥n B, obtenemos la siguiente imagen: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/115/6f5/1d91156f550268ff06521adfff7a4136.jpg" alt="Mi imagen"></a> <br><br>  Ser√° similar para la regi√≥n A, la regi√≥n B estar√° representada por un interruptor.  En cada regi√≥n, cada conmutador tiene un puerto ra√≠z que lo conecta a la ra√≠z regional.  Cada regi√≥n tambi√©n selecciona un puerto ra√≠z para MSTI 0, que conduce a un puente ra√≠z CIST com√∫n.  Estos puertos pueden ser los puertos Gi1 / 1 en Sw9 y Sw10, ya que conectan regiones.  En nuestra topolog√≠a, Sw9 tiene la mejor ID de puente, luego se selecciona el puerto ra√≠z y en Sw10 se bloquea el puerto Gi1 / 1.  En Sw9, para MSTI 0, el puerto Gi1 / 1 es el puerto ra√≠z, pero, por ejemplo, para MSTI 1 y 2, hay un puerto ra√≠z para el puente ra√≠z de instancia y el puerto que conduce al puente ra√≠z CIST recibe una nueva funci√≥n: maestro.  De una regi√≥n a otra solo puede haber un canal de trabajo o, en otras palabras, solo un puerto maestro y solo en un conmutador.  Aqu√≠ hay informaci√≥n sobre el MST en el conmutador Sw9, en el que se seleccionar√° el puerto maestro, preste atenci√≥n al puerto Gi1 / 1: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7f4/52a/bbd7f452a27ace3d97fc9b714bfed31a.jpg" alt="Mi imagen"></a> <br><br>  Este puerto para MSTI 0, como dijimos, tiene el rol de Root, y para MSTI 1-2 Master.  Tambi√©n se introdujo un nuevo tipo de canal: P2p Bound (RSTP).  El tipo de l√≠mite se asigna a los puertos que bordean la otra regi√≥n u otra variante del protocolo STP.  La informaci√≥n sobre el puente ra√≠z CIST se transmite a la regi√≥n a trav√©s del puerto maestro, una caracter√≠stica distintiva es que este puerto no env√≠a BPDU por s√≠ mismo, sino que solo recibe, a diferencia del tipo de puerto P2P en RSTP.  La excepci√≥n son solo las BPDU con el indicador TC (cambio de topolog√≠a).  Veamos c√≥mo un conmutador en una regi√≥n procesa las BPDU de otra regi√≥n.  Como dijimos en el puerto maestro Gi1 / 1 Sw9, se recibir√°n BPDU de Sw1, mientras que Sw9 no se enviar√°, consid√©relo nuevamente: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/35e/f5a/4d835ef5a9fdc2514075fab810cf5cb9.jpg" alt="Mi imagen"></a> <br><br>  Sw1 env√≠a la misma BPDU, independientemente de si el conmutador env√≠a BPDU dentro o fuera de la regi√≥n.  Habiendo aceptado esta BPDU, Sw9 solo procesar√° la informaci√≥n antes del inicio del campo de extensi√≥n MST, solo esta informaci√≥n se usa para construir un √°rbol en la instancia 0. Aqu√≠ puede notar un hecho interesante: el identificador de ra√≠z (50: 00: 00: 03: 00: 00) coincide con la identificaci√≥n del puente (50: 00: 00: 03: 00: 00), aunque env√≠a el paquete Sw1 con el identificador de puente - 50: 00: 00: 01: 00: 00.  Esto confirma nuestra teor√≠a de que cada regi√≥n para otra est√° representada por un gran conmutador virtual.  Tambi√©n puede decir que entre las regiones tenemos el cl√°sico RSTP.  Pero hablemos del costo de la ruta ra√≠z.  Hay dos tipos de costos de ruta: internos y externos.  El costo de la ruta ra√≠z, que apunta a MSTI 0, es externo.  Y a pesar del hecho de que hay un canal m√°s de Sw1 a Root Bridge (Sw3), todav√≠a se indica como cero.  Era como si Root Bridge lo hubiera enviado.  Los costos internos de la ruta ra√≠z se enumeran en los campos debajo de la extensi√≥n MST.  El costo de la ruta ra√≠z interna CIST indica el costo de la ruta al puente ra√≠z regional para MSTI 0, y los campos debajo de MSTID 1 y 2 indican el costo de la ruta ra√≠z interna al puente ra√≠z para cada instancia, respectivamente.  El costo externo de la ruta ra√≠z tiene un papel especial y muy importante, determinar√° el puente ra√≠z regional, y no la prioridad y la direcci√≥n de la amapola, hicimos un comentario sobre esto anteriormente.  ¬°El interruptor que tiene el costo de ruta ra√≠z m√°s peque√±o hasta el puente ra√≠z CIST se convertir√° en el puente ra√≠z regional!  Por ejemplo, Sw9 y Sw10 tienen un costo de ruta ra√≠z de 20,000, igual al costo del puerto Gi1 / 1.  Y solo despu√©s de eso comienzan a comparar sus ID de Bridge.  Verifiquemos esto, cambie el costo del enlace a Sw10 y al mismo tiempo aumente su prioridad al m√°ximo para excluir su opci√≥n de seleccionar Ra√≠z regional por prioridad.  Introducimos los siguientes comandos: <br><blockquote>  Sw10 (config-if) # spanning-tree mst 0 prioridad 61440 <br>  Sw10 (config-if) # interfaz gigabitEthernet 1/1 <br>  Sw10 (config-if) # spanning-tree mst 0 cost 10000 <br></blockquote>  Y obtenemos que Sw10, a pesar de su terrible prioridad, se ha convertido en Regional Root Bridge: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/abd/51c/e5babd51cd3a12bfbe4e0ab94d9b474a.jpg" alt="Mi imagen"></a> <br><br>  Por lo tanto, la selecci√≥n del puente ra√≠z regional se produce en esta secuencia y el puente ra√≠z regional nunca puede ser un interruptor sin puertos fronterizos: <br><br><ul><li>  Costo de ruta externa m√°s bajo al puente ra√≠z CIST. </li><li>  Identificador regional m√°s bajo del puente. </li><li>  Identificador de puente CIST de BPDU de la regi√≥n con puente ra√≠z CIST. </li></ul><br>  Si, por ejemplo, agregamos un enlace entre Sw9 y Sw4 y pensamos en qu√© enlace se convertir√° en Maestro, entonces, con todos los par√°metros iguales, el campo CIST Bridge Identifier, que es m√°s bajo que la Extensi√≥n MST, se convertir√° en el campo determinante.  Mentimos un poco cuando dijimos que Sw9 no mira los datos debajo de la Extensi√≥n MST.  En este caso, se contar√° el identificador de puente CIST de la extensi√≥n MST. <br>  Ahora veamos el comportamiento de MST cuando agregamos conmutadores RPVST: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/d40/eff/45b/d40eff45b3025e0e1b47b6a352199390.jpg" alt="Mi imagen"></a> <br><br>  Son posibles dos casos: <br><br><ol><li>  Root Bridge es propiedad de RPVST. </li><li>  Root Bridge es propiedad de MSTP. </li></ol><br>  Considere primero el caso donde Sw3 contin√∫a siendo un puente ra√≠z CIST (es decir, el caso 2).  En este caso, Sw10 y Sw12 tan pronto como reciban BPDU de RSTP1 y RSTP2 para cada vlan, cambiar√°n el tipo de puerto Gi1 / 0 a <b>P2p Bound (PVST)</b> .  Este tipo significa que Sw10 y Sw12 en este puerto est√°n conectados a conmutadores RPVST y comenzar√°n a enviar copias de BPDU para MSTI0 (es decir, sin campos debajo de la extensi√≥n MST) a todos los vlanes permitidos en este puerto.  Por lo tanto, RSTP1 y RSTP2 no notar√°n que Sw10 y Sw12 usan un protocolo diferente.  Esta tecnolog√≠a en MSTP se llama <b>PVST Simulation,</b> y con ella obtenemos coordinaci√≥n entre diferentes interruptores. <br><br>  El caso cuando el Root Bridge se encuentra entre los conmutadores RPVST es m√°s complejo y no se recomienda.  Supongamos que tenemos RSTP1 es el puente ra√≠z para todos los vlan.  Para simplificar, suponemos que se crean los vlans 1-3 y se introduce el comando <b>spanning-tree vlan 1-3 priority 12288</b> , la prioridad m√°s baja entre los conmutadores RSTP y MSTP.  Sw10 comenzar√° a recibir BPDU para cada vlana.  Es muy importante comprender que el conmutador MSTP solo procesar√° las BPDU para Vlan 1. ¬øC√≥mo sucede esto? <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/d40/eff/45b/d40eff45b3025e0e1b47b6a352199390.jpg" alt="Mi imagen"></a> <br><br>  Dependiendo de cu√°ntos vlans est√©n configurados, se enviar√°n tantos paquetes RPVST + BPDU, pero adem√°s, tambi√©n se enviar√°n a trav√©s de la vDAN BPDU nativa con la direcci√≥n mac de destino: 01: 80: c2: 00: 00: 00.  Es esta direcci√≥n de amapola la que usa MSTP, los conmutadores PVST y RPVST usan una direcci√≥n de amapola diferente: 01: 00: 0c: cc: cc: cd.  Independientemente de qu√© vlan est√© configurado como nativo, la informaci√≥n para el primer vlan se transmitir√° en esta BPDU.  Solo este paquete ser√° procesado para construir el √°rbol por los conmutadores MSTP.  Las BPDU restantes para ciertos vlanes se usar√°n para verificar la protecci√≥n del nodo ra√≠z durante las simulaciones PVST (simulaci√≥n PVST de verificaci√≥n de consistencia basada en la protecci√≥n de ra√≠z).  ¬øQu√© tipo de cheque?  Tan pronto como configuremos RSTP1 utilizando un comando <b>12288 de prioridad de vlan 1-3 de √°rbol de expansi√≥n de este tipo</b> , en Sw10 obtendremos inmediatamente un error: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/098/25f/7a009825fc7dd326bc5e426493500385.jpg" alt="Mi imagen"></a> <br><br>  Tratemos de explicarlo.  Sw10 adopt√≥ un vlan BPDU nativo para vlan 1 con prioridad 12288 + 1.  Procesado y decidido que Gi1 / 0 es su puerto ra√≠z.  Luego vino el PVST BPDU para el resto del vlan (1-3), los estudi√≥ para verificar la integridad del interruptor ra√≠z y hab√≠a prioridades 12288 + 2, 12288 + 3 para el vlan 2-3, que son m√°s de 12288 + 1.  La integridad se derrumba: por un lado, debe ser el puerto ra√≠z, y obtener otras prioridades m√°s altas obliga al puerto a cambiar al rol designado.  Dicha ambig√ºedad no est√° permitida para tales protocolos, y MST bloquea este puerto, convirti√©ndolo en estado BKN, informando un error - <b>Bloqueando el puerto ra√≠z Gi1 / 0: Se recibi√≥ un PVST BPDU inferior inconsistente</b> .  Para evitar esto, es necesario que ni un solo vlan cuyas BPDU se transmitan en este puerto tengan una prioridad m√°s baja (m√°s) que el vlan 1. Es decir, si reducimos la prioridad del vlan 2‚Äì3 a 4096, obviamente es menor que vlana 1, luego corrige este problema. <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/0f6/4a6/c6d/0f64a6c6d9b21ae127cb5572c7ade92d.jpg" alt="Mi imagen"></a> <br><br>  Como puede ver, ha aparecido un mensaje que restablece el funcionamiento correcto del puerto: <b>inconsistencia de simulaci√≥n PVST borrada en el puerto GigabitEhternet 0/1</b> . <br><br>  Sobre esto, creo, para completar la conversaci√≥n sobre MSTP.  Enlaces √∫tiles a continuaci√≥n: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">www.cisco.com/c/en/us/support/docs/lan-switching/multiple-instance-stp-mistp-8021s/116464-configure-pvst-00.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">habrahabr.ru/post/128172</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">www.cisco.com/c/ru_s/support/docs/lan-switching/multiple-instance-stp-mistp-8021s/116464-configure-pvst-00.pdf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5000/sw/configuration/guide/cli_rel_4_0_1a/CLIConfigurationGuide/MST.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">networkengineering.stackexchange.com/questions/28716/multiple-spanning-tree-terminology-cst-ist-cist-and-exact-behavior</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">blog.sbolshakov.ru/11-3-mstp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">blog.ine.com/2010/02/22/understanding-mstp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">networklessons.com/spanning-tree/multiple-spanning-tree-mst</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419785/">https://habr.com/ru/post/es419785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419775/index.html">Mi versi√≥n del "dispositivo para sue√±os l√∫cidos" es una breve historia y una descripci√≥n de la primera versi√≥n</a></li>
<li><a href="../es419777/index.html">C√≥mo vender servidores NNN en los Pa√≠ses Bajos y no quedarse sin entusiasmo: secretos de ventas</a></li>
<li><a href="../es419779/index.html">Los pulmones crecidos se trasplantaron con √©xito a un cerdo; despu√©s de 5 a√±os, los ensayos en humanos son posibles</a></li>
<li><a href="../es419781/index.html">SpaceX celebr√≥ el primer taller de Marte</a></li>
<li><a href="../es419783/index.html">Hombre contra m√°quina: una nueva √©tica para la ciberseguridad</a></li>
<li><a href="../es419787/index.html">Club Club Report 2018, Cap√≠tulo 3.9: ‚ÄúRendimiento qu√≠ntuple de recursos‚Äù</a></li>
<li><a href="../es419789/index.html">Jimmy Wales Pensamientos: "Wikipedia es como una salchicha ..."</a></li>
<li><a href="../es419791/index.html">Apple rechaza el programa de afiliaci√≥n para promocionar aplicaciones de App Store</a></li>
<li><a href="../es419795/index.html">Tesla inform√≥ una p√©rdida r√©cord. Las acciones de la compa√±√≠a a√∫n subieron debido a las previsiones para el pr√≥ximo trimestre</a></li>
<li><a href="../es419797/index.html">Ingenier√≠a inversa del protocolo del panel desde el aire acondicionado inverter Electrolux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>