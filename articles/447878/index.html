<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïï üåÄ üõåüèº Comprobaci√≥n de rdesktop y xrdp con PVS-Studio üôèüèª ‚ÜòÔ∏è ‚ôãÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta es la segunda publicaci√≥n de nuestra serie de art√≠culos sobre los resultados de verificar el software de c√≥digo abierto que funciona con el proto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comprobaci√≥n de rdesktop y xrdp con PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/447878/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c3/022/209/0c302220992a72800d96b21b634c13f0.png" alt="Imagen3"></div><br>  Esta es la segunda publicaci√≥n de nuestra serie de art√≠culos sobre los resultados de verificar el software de c√≥digo abierto que funciona con el protocolo RDP.  Hoy vamos a echar un vistazo al cliente rdesktop y al servidor xrdp. <br><a name="habracut"></a><br>  El an√°lisis fue realizado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PVS-Studio</a> .  Este es un analizador est√°tico para c√≥digo escrito en C, C ++, C # y Java, y se ejecuta en Windows, Linux y macOS. <br><br>  Discutir√© solo los errores que me parecieron m√°s interesantes.  Por otro lado, dado que los proyectos son bastante peque√±os, no hay muchos errores en ellos de todos modos :). <br><br>  <b>Nota</b>  El art√≠culo anterior sobre la verificaci√≥n de FreeRDP est√° disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  rdesktop </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rdesktop</a> es un cliente RDP gratuito para sistemas basados ‚Äã‚Äãen UNIX.  Tambi√©n puede ejecutarse en Windows si est√° construido bajo Cygwin.  rdesktop se lanza bajo GPLv3. <br><br>  Este es un cliente muy popular.  Se utiliza como cliente predeterminado en ReactOS, y tambi√©n puede encontrar interfaces gr√°ficas de terceros para acompa√±arlo.  Sin embargo, el proyecto es bastante antiguo: se lanz√≥ por primera vez el 4 de abril de 2001 y tiene 17 a√±os, a partir de este escrito. <br><br>  Como ya dije, el proyecto es muy peque√±o: alrededor de 30 KLOC, lo cual es un poco extra√±o teniendo en cuenta su antig√ºedad.  Compare eso con FreeRDP con sus 320 KLOC.  Aqu√≠ est√° la salida de Cloc: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4a0/8e4/19f/4a08e419fa943d0792b40ea970d7d800.png" alt="Imagen1"></p><br><h3>  C√≥digo inalcanzable </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V779</a> C√≥digo inalcanzable detectado.  Es posible que haya un error presente.  rdesktop.c 1502 <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> handle_disconnect_reason(deactivated, ext_disc_reason); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (g_redirect_username) xfree(g_redirect_username); xfree(g_username); }</code> </pre> <br>  El primer error se encuentra inmediatamente en la funci√≥n <i>principal</i> : el c√≥digo que sigue a la declaraci√≥n de <i>retorno</i> estaba destinado a liberar la memoria asignada anteriormente.  Pero este defecto no es peligroso porque el sistema operativo liberar√° toda la memoria asignada previamente una vez que el programa finalice. <br><br><h3>  Sin manejo de errores </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V557</a> Array underrun es posible.  El valor del √≠ndice 'n' podr√≠a alcanzar -1.  rdesktop.c 1872 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">RD_BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subprocess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argv[], </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">str_handle_lines_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> linehandler, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> output[<span class="hljs-number"><span class="hljs-number">256</span></span>]; .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (n &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { n = read(fd[<span class="hljs-number"><span class="hljs-number">0</span></span>], output, <span class="hljs-number"><span class="hljs-number">255</span></span>); output[n] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= str_handle_lines(output, &amp;rest, linehandler, data); } .... }</span></span></code> </pre> <br>  El contenido del archivo se lee en el b√∫fer hasta que se alcanza EOF.  Al mismo tiempo, este c√≥digo carece de un mecanismo de manejo de errores, y si algo sale mal, <i>leer</i> devolver√° -1 y la ejecuci√≥n comenzar√° a leer m√°s all√° de los l√≠mites de la matriz de <i>salida</i> . <br><br><h3>  Usando EOF en char </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V739</a> EOF no debe compararse con un valor del tipo 'char'.  El '(c = fgetc (fp))' debe ser del tipo 'int'.  ctrl.c 500 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrl_send_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cmd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> result[CTRL_RESULT_SIZE], c, *escaped; .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((c = fgetc(fp)) != EOF &amp;&amp; index &lt; CTRL_RESULT_SIZE &amp;&amp; c != <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) { result[index] = c; index++; } .... }</code> </pre> <br>  Este c√≥digo implementa un manejo <i>EOF</i> incorrecto: si <i>fgetc</i> devuelve un car√°cter cuyo c√≥digo es 0xFF, se interpretar√° como el final del archivo ( <i>EOF</i> ). <br><br>  <i>EOF</i> es una constante t√≠picamente definida como -1.  Por ejemplo, en la codificaci√≥n CP1251, la √∫ltima letra del alfabeto ruso se codifica como 0xFF, que corresponde al n√∫mero -1 en el tipo <i>char</i> .  Significa que el car√°cter 0xFF, al igual que <i>EOF</i> (-1), se interpretar√° como el final del archivo.  Para evitar errores como ese, el resultado devuelto por la funci√≥n <i>fgetc</i> debe almacenarse en una variable de tipo <i>int</i> . <br><br><h3>  Errores tipogr√°ficos </h3><br>  <b>Fragmento 1</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V547 La</a> expresi√≥n 'write_time' siempre es falsa.  disk.c 805 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">RD_NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disk_set_information</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> write_time, change_time, access_time, mod_time; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (write_time || change_time) mod_time = MIN(write_time, change_time); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> mod_time = write_time ? write_time : change_time; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  El autor de este c√≥digo debe haber usado accidentalmente el <i>||</i>  operador en lugar de <i>&amp;&amp;</i> en la condici√≥n.  Veamos qu√© valores pueden tener las variables <i>write_time</i> y <i>change_time</i> : <ul><li>  Ambas variables tienen 0. En este caso, la ejecuci√≥n pasa a la rama <i>else</i> : la variable <i>mod_time</i> siempre se evaluar√° a 0 sin importar cu√°l sea la siguiente condici√≥n. </li><li>  Una de las variables tiene 0. En este caso, a <i>mod_time</i> se le asignar√° 0 (dado que la otra variable tiene un valor no negativo) ya que <i>MIN</i> elegir√° la menor de las dos. </li><li>  Ninguna variable tiene 0: se elige el valor m√≠nimo. </li></ul><br>  Cambiar esa l√≠nea a <i>write_time &amp;&amp; change_time</i> arreglar√° el comportamiento: <ul><li>  Solo una o ninguna de las variables tiene 0: se elige el valor distinto de cero. </li><li>  Ninguna variable tiene 0: se elige el valor m√≠nimo. </li></ul><br>  <b>Fragmento 2</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La</a> expresi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V547</a> es siempre cierta.  Probablemente el operador '&amp;&amp;' deber√≠a usarse aqu√≠.  disk.c 1419 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RD_NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disk_device_control</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RD_NTHANDLE handle, uint32 request, STREAM in, STREAM out)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((request &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) != <span class="hljs-number"><span class="hljs-number">20</span></span>) || ((request &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) != <span class="hljs-number"><span class="hljs-number">9</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RD_STATUS_INVALID_PARAMETER; .... }</code> </pre> <br>  De nuevo, parece ser el problema de usar el operador incorrecto, ya sea <i>||</i>  en lugar de <i>&amp;&amp;</i> o <i>== en</i> lugar de <i>! =</i> porque la variable no puede almacenar los valores 20 y 9 al mismo tiempo. <br><br><h3>  Copia ilimitada de cadenas </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V512</a> Una llamada de la funci√≥n 'sprintf' conducir√° al desbordamiento del b√∫fer 'fullpath'.  disk.c 1257 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">RD_NTSTATUS </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disk_query_directory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *dirname, fullpath[PATH_MAX]; .... <span class="hljs-comment"><span class="hljs-comment">/* Get information for directory entry */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(fullpath, <span class="hljs-string"><span class="hljs-string">"%s/%s"</span></span>, dirname, pdirent-&gt;d_name); .... }</code> </pre> <br>  Si pudieras seguir la funci√≥n hasta el final, ver√≠as que el c√≥digo est√° bien, pero puede romperse un d√≠a: solo un cambio descuidado terminar√° con un desbordamiento del b√∫fer ya que <i>sprintf</i> no est√° limitado de ninguna manera, por lo que es concatenante los caminos podr√≠an llevar la ejecuci√≥n m√°s all√° de los l√≠mites de la matriz.  Recomendamos reemplazar esta llamada con <i>snprintf (fullpath, PATH_MAX, ....)</i> . <br><br><h3>  Condici√≥n redundante </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V560</a> Una parte de la expresi√≥n condicional siempre es verdadera: add&gt; 0. scard.c 507 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inRepos</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(STREAM in, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> read)</span></span></span><span class="hljs-function"> </span></span>{ SERVER_DWORD add = <span class="hljs-number"><span class="hljs-number">4</span></span> - read % <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (add &lt; <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; add &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } }</code> </pre> <br>  La verificaci√≥n <i>add&gt; 0</i> no hace ninguna diferencia ya que la variable siempre ser√° mayor que cero porque <i>leer% 4</i> devuelve el resto, que nunca ser√° igual a 4. <br><br><h2>  xrdp </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">xrdp</a> es un servidor RDP de c√≥digo abierto.  El proyecto consta de dos partes: <br><br><ul><li>  xrdp: la implementaci√≥n del protocolo.  Se lanza bajo Apache 2.0. </li><li>  xorgxrdp: una colecci√≥n de controladores Xorg para usar con xrdp.  Se lanza bajo X11 (al igual que MIT, pero el uso en publicidad est√° prohibido) </li></ul><br>  El desarrollo se basa en rdesktop y FreeRDP.  Inicialmente, para poder trabajar con gr√°ficos, tendr√≠a que usar un servidor VNC separado o un servidor X11 especial con soporte RDP, X11rdp, pero estos se volvieron innecesarios con el lanzamiento de xorgxrdp. <br><br>  No hablaremos de xorgxrdp en este art√≠culo. <br><br>  Al igual que el proyecto anterior, xrdp es peque√±o, y consta de aproximadamente 80 KLOC. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/904/e44/6bd/904e446bdb2edc2f39c5db3c928a61ea.png" alt="Imagen2"></p><br><h3>  M√°s errores tipogr√°ficos </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V525</a> El c√≥digo contiene la colecci√≥n de bloques similares.  Verifique los elementos 'r', 'g', 'r' en las l√≠neas 87, 88, 89. rfxencode_rgb_to_yuv.c 87 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rfx_encode_format_rgb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *rgb_data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stride_bytes, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pixel_format, uint8 *r_buf, uint8 *g_buf, uint8 *b_buf)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (pixel_format) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RFX_FORMAT_BGRA: .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">64</span></span>) { *lr_buf++ = r; *lg_buf++ = g; *lb_buf++ = r; <span class="hljs-comment"><span class="hljs-comment">// &lt;= x++; } .... } .... }</span></span></code> </pre> <br>  Este c√≥digo proviene de la biblioteca librfxcodec, que implementa el c√≥dec jpeg2000 para trabajar con RemoteFX.  El canal de color "rojo" se lee dos veces, mientras que el canal "azul" no se lee en absoluto.  Defectos como este generalmente resultan del uso de copiar y pegar. <br><br>  Se encontr√≥ el mismo error en la funci√≥n similar <i>rfx_encode_format_argb</i> : <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V525</a> El c√≥digo contiene la colecci√≥n de bloques similares.  Verifique los elementos 'a', 'r', 'g', 'r' en las l√≠neas 260, 261, 262, 263. rfxencode_rgb_to_yuv.c 260 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x &lt; <span class="hljs-number"><span class="hljs-number">64</span></span>) { *la_buf++ = a; *lr_buf++ = r; *lg_buf++ = g; *lb_buf++ = r; x++; }</code> </pre> <br><h3>  Declaraci√≥n de matriz </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V557</a> Array overrun es posible.  El valor del √≠ndice 'i - 8' podr√≠a alcanzar 129. genkeymap.c 142 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// evdev-map.c int xfree86_to_evdev[137-8+1] = { .... }; // genkeymap.c extern int xfree86_to_evdev[137-8]; int main(int argc, char **argv) { .... for (i = 8; i &lt;= 137; i++) /* Keycodes */ { if (is_evdev) e.keycode = xfree86_to_evdev[i-8]; .... } .... }</span></span></code> </pre> <br>  En el archivo genkeymap.c, la matriz se declara 1 elemento m√°s corto de lo que implica la implementaci√≥n.  Sin embargo, no se producir√° ning√∫n error, porque el archivo evdev-map.c almacena el tama√±o correcto, por lo que no habr√° desbordamiento de la matriz, lo que lo convierte en un defecto menor en lugar de un verdadero error. <br><br><h3>  Comparaci√≥n incorrecta </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V560</a> Una parte de la expresi√≥n condicional siempre es falsa: (cap_len &lt;0).  xrdp_caps.c 616 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// common/parse.h #if defined(B_ENDIAN) || defined(NEED_ALIGN) #define in_uint16_le(s, v) do \ .... #else #define in_uint16_le(s, v) do \ { \ (v) = *((unsigned short*)((s)-&gt;p)); \ (s)-&gt;p += 2; \ } while (0) #endif int xrdp_caps_process_confirm_active(struct xrdp_rdp *self, struct stream *s) { int cap_len; .... in_uint16_le(s, cap_len); .... if ((cap_len &lt; 0) || (cap_len &gt; 1024 * 1024)) { .... } .... }</span></span></code> </pre> <br>  El valor de una variable de tipo <i>sin signo corto</i> se lee en una variable de tipo <i>int</i> y luego se verifica para que sea negativo, lo cual no es necesario porque un valor le√≠do de un tipo sin signo en un tipo m√°s grande nunca puede volverse negativo. <br><br><h3>  Cheques redundantes </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V560</a> Una parte de la expresi√≥n condicional siempre es verdadera: (bpp! = 16).  libxrdp.c 704 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> EXPORT_CC </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">libxrdp_send_pointer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct xrdp_session *session, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cache_idx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *mask, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bpp)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bpp == <span class="hljs-number"><span class="hljs-number">15</span></span>) &amp;&amp; (bpp != <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp;&amp; (bpp != <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp;&amp; (bpp != <span class="hljs-number"><span class="hljs-number">32</span></span>)) { g_writeln(<span class="hljs-string"><span class="hljs-string">"libxrdp_send_pointer: error"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... }</code> </pre> <br>  Las verificaciones no iguales no son necesarias porque la primera verificaci√≥n hace el trabajo.  El programador probablemente iba a usar el <i>||</i>  operador para filtrar argumentos incorrectos. <br><br><h2>  Conclusi√≥n </h2><br>  La comprobaci√≥n de hoy no revel√≥ ning√∫n error cr√≠tico, pero s√≠ revel√≥ un mont√≥n de defectos menores.  Dicho esto, estos proyectos, por peque√±os que sean, todav√≠a se usan en muchos sistemas y, por lo tanto, necesitan algo de pulido.  Un proyecto peque√±o no necesariamente debe tener toneladas de errores, por lo que probar el analizador solo en proyectos peque√±os no es suficiente para evaluar de manera confiable su efectividad.  Este tema se trata con m√°s detalle en el art√≠culo " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sentimientos confirmados por n√∫meros</a> ". <br><br>  La versi√≥n demo de PVS-Studio est√° disponible en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447878/">https://habr.com/ru/post/447878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447868/index.html">M√≥dulo de tel√©metro ultras√≥nico submarino. Parte dos</a></li>
<li><a href="../447870/index.html">Conceptos b√°sicos del motor de JavaScript: optimizaci√≥n de prototipos. Parte 1</a></li>
<li><a href="../447872/index.html">Alienware M15: port√°til para juegos compacto con amplias opciones de actualizaci√≥n</a></li>
<li><a href="../447874/index.html">Entrop√≠a informativa del caos</a></li>
<li><a href="../447876/index.html">Todo es muy malo o un nuevo tipo de intercepci√≥n de tr√°fico.</a></li>
<li><a href="../447880/index.html">Validaci√≥n de rdesktop y xrdp con el analizador PVS-Studio</a></li>
<li><a href="../447882/index.html">¬øHerramientas de red o d√≥nde comenzar el pentester?</a></li>
<li><a href="../447884/index.html">Descubrimos c√≥mo funcionar√° 5G en el rango de mil√≠metros en la calle y en interiores</a></li>
<li><a href="../447886/index.html">An√°lisis de registro de Nginx con Amazon Athena y Cube.js</a></li>
<li><a href="../447890/index.html">Gracias a Dios no soy gerente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>