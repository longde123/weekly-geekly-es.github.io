<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â›¹ğŸ½ ğŸ© ğŸš‰ Cï¼ƒï¼šä»»ä½•ä»»åŠ¡çš„ä¸€ä¸ªç”¨ä¾‹ ğŸ‘‚ğŸ¾ ğŸ¤¶ğŸ» ğŸ¹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å“ˆHaï¼ æˆ‘ä»¬ç»§ç»­è°ˆè®ºCï¼ƒä¸­çš„å¼‚æ­¥ç¼–ç¨‹ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºé€‚ç”¨äºå¼‚æ­¥ç¼–ç¨‹æ¡†æ¶ä¸­ä»»ä½•ä»»åŠ¡çš„å•ä¸ªç”¨ä¾‹æˆ–ç‰¹å®šäºç”¨æˆ·çš„æ–¹æ¡ˆã€‚ æˆ‘ä»¬å°†æ¶‰åŠåŒæ­¥ï¼Œæ­»é”ï¼Œæ“ä½œå‘˜è®¾ç½®ï¼Œå¼‚å¸¸å¤„ç†ç­‰ä¸»é¢˜ã€‚ ç«‹å³åŠ å…¥ï¼ 



 ä»¥å‰çš„ç›¸å…³æ–‡ç«  



- Cï¼ƒå¼‚æ­¥ç¼–ç¨‹ï¼šæ‚¨å¦‚ä½•å¤„ç†æ€§èƒ½ï¼Ÿ 
- è¦†ç›–Equalså’ŒGetHashCodeã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cï¼ƒï¼šä»»ä½•ä»»åŠ¡çš„ä¸€ä¸ªç”¨ä¾‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/421245/"> å“ˆHaï¼ æˆ‘ä»¬ç»§ç»­è°ˆè®ºCï¼ƒä¸­çš„å¼‚æ­¥ç¼–ç¨‹ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºé€‚ç”¨äºå¼‚æ­¥ç¼–ç¨‹æ¡†æ¶ä¸­ä»»ä½•ä»»åŠ¡çš„å•ä¸ªç”¨ä¾‹æˆ–ç‰¹å®šäºç”¨æˆ·çš„æ–¹æ¡ˆã€‚ æˆ‘ä»¬å°†æ¶‰åŠåŒæ­¥ï¼Œæ­»é”ï¼Œæ“ä½œå‘˜è®¾ç½®ï¼Œå¼‚å¸¸å¤„ç†ç­‰ä¸»é¢˜ã€‚ ç«‹å³åŠ å…¥ï¼ <br><br><img src="https://habrastorage.org/webt/fn/3y/w8/fn3yw8b2lmo8cbbziqaiogmvsxy.jpeg"><a name="habracut"></a><br><br><blockquote>  <b>ä»¥å‰çš„ç›¸å…³æ–‡ç« </b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cï¼ƒå¼‚æ­¥ç¼–ç¨‹ï¼šæ‚¨å¦‚ä½•å¤„ç†æ€§èƒ½ï¼Ÿ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¦†ç›–Equalså’ŒGetHashCodeã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½†æ˜¯æœ‰å¿…è¦å—ï¼Ÿ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨åˆ«äººçš„ä»£ç ä¸­å¯ä»¥æ‰¾åˆ°ä»€ä¹ˆï¼Ÿ</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">.NETçš„ä¸€äº›æœ‰ç”¨çš„ææ–™</a> </li></ul></blockquote><br> å¯ä»¥åŸºäºä¸€ç§ç”¨æˆ·åœºæ™¯æ¥è§£é‡ŠCï¼ƒä¸­å¼‚æ­¥æ–¹æ³•çš„å‡ ä¹æ‰€æœ‰éæ ‡å‡†è¡Œä¸ºï¼šå°†ç°æœ‰çš„åŒæ­¥ä»£ç è½¬æ¢ä¸ºå¼‚æ­¥åº”è¯¥å°½å¯èƒ½ç®€å•ã€‚ æ‚¨å¿…é¡»èƒ½å¤Ÿåœ¨æ–¹æ³•çš„è¿”å›ç±»å‹ä¹‹å‰æ·»åŠ asyncå…³é”®å­—ï¼Œå°†Asyncåç¼€æ·»åŠ è‡³è¯¥æ–¹æ³•çš„åç§°ï¼Œå¹¶åœ¨æ­¤å¤„å’Œæ–¹æ³•çš„æ–‡æœ¬åŒºåŸŸä¸­æ·»åŠ awaitå…³é”®å­—ï¼Œä»¥è·å–åŠŸèƒ½é½å…¨çš„å¼‚æ­¥æ–¹æ³•ã€‚ <br><br><img width="550" src="https://habrastorage.org/webt/di/uw/i8/diuwi85jehdfov_iozovmreg59s.png"><br><br> ä¸€ä¸ªâ€œç®€å•â€çš„åœºæ™¯ä¼šæå¤§åœ°æ”¹å˜å¼‚æ­¥æ–¹æ³•è¡Œä¸ºçš„è®¸å¤šæ–¹é¢ï¼šä»è®¡åˆ’ä»»åŠ¡çš„æŒç»­æ—¶é—´åˆ°å¤„ç†å¼‚å¸¸ã€‚ è¯¥è„šæœ¬çœ‹èµ·æ¥å¾ˆæœ‰è¯´æœåŠ›ä¸”æ„ä¹‰é‡å¤§ï¼Œä½†åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œå¼‚æ­¥æ–¹æ³•çš„ç®€å•æ€§æå…·è¯¯å¯¼æ€§ã€‚ <br><br><h2> åŒæ­¥ä¸Šä¸‹æ–‡ </h2><br> ç”¨æˆ·ç•Œé¢ï¼ˆUIï¼‰å¼€å‘æ˜¯ä¸Šè¿°æ–¹æ¡ˆç‰¹åˆ«é‡è¦çš„é¢†åŸŸã€‚ ç”±äºç”¨æˆ·ç•Œé¢çº¿ç¨‹ä¸­çš„å†—é•¿æ“ä½œï¼Œåº”ç”¨ç¨‹åºçš„å“åº”æ—¶é—´å¢åŠ ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼‚æ­¥ç¼–ç¨‹ä¸€ç›´è¢«è®¤ä¸ºæ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„å·¥å…·ã€‚ <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttonOk_ClickAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs args</span></span></span><span class="hljs-function">)</span></span> { textBox.Text = <span class="hljs-string"><span class="hljs-string">"Running.."</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 1 -- UI Thread var result = await _stockPrices.GetStockPricesForAsync("MSFT"); // 2 -- Usually non-UI Thread textBox.Text = "Result is: " + result; //3 -- Should be UI Thread }</span></span></code> </pre> <br> è¯¥ä»£ç çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜ã€‚ å¤§å¤šæ•°ç”¨æˆ·ç•Œé¢éƒ½æœ‰é™åˆ¶ï¼šUIå…ƒç´ åªèƒ½ç”±ç‰¹æ®Šçº¿ç¨‹æ›´æ”¹ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¬¬3è¡Œä¸­ï¼Œå¦‚æœä»»åŠ¡çš„æŒç»­æ—¶é—´æ˜¯åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸­å®‰æ’çš„ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜æ—©å·²ä¸ºäººæ‰€çŸ¥ï¼Œå¹¶ä¸”<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŒæ­¥ä¸Šä¸‹æ–‡</a>çš„æ¦‚å¿µ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·²</a>å‡ºç°åœ¨.NET Framework 2.0ç‰ˆæœ¬ä¸­ã€‚ <br><br> æ¯ä¸ªUIæä¾›äº†ç‰¹æ®Šçš„å®ç”¨ç¨‹åºï¼Œç”¨äºå°†ä»»åŠ¡ç¼–ç»„åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªä¸“ç”¨ç”¨æˆ·ç•Œé¢çº¿ç¨‹ä¸­ã€‚  Windowsçª—ä½“ä½¿ç”¨<code>Control.Invoke</code>æ–¹æ³•ï¼ŒWPF <code>Control.Invoke</code> Dispatcher.Invokeæ–¹æ³•ï¼Œå…¶ä»–ç³»ç»Ÿå¯ä»¥è®¿é—®å…¶ä»–æ–¹æ³•ã€‚ åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ä½¿ç”¨çš„æ–¹æ¡ˆåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šç›¸ä¼¼ï¼Œä½†æ˜¯åœ¨ç»†èŠ‚ä¸Šæœ‰æ‰€ä¸åŒã€‚ åŒæ­¥ä¸Šä¸‹æ–‡å…è®¸æ‚¨é€šè¿‡æä¾›APIåœ¨â€œç‰¹æ®Šâ€ä¸Šä¸‹æ–‡ä¸­è¿è¡Œä»£ç æ¥ä»å·®å¼‚ä¸­æŠ½è±¡å‡ºæ¥ï¼Œè¯¥â€œç‰¹æ®Šâ€ä¸Šä¸‹æ–‡é€šè¿‡<code>WindowsFormsSynchronizationContext</code> ï¼Œ <code>DispatcherSynchronizationContext</code>ç­‰æ´¾ç”Ÿç±»å‹æä¾›å¯¹æ¬¡è¦ç»†èŠ‚çš„å¤„ç†ã€‚ <br><br> ä¸ºäº†è§£å†³çº¿ç¨‹äº²ç¼˜å…³ç³»çš„é—®é¢˜ï¼ŒCï¼ƒç¨‹åºå‘˜å†³å®šåœ¨å®ç°å¼‚æ­¥æ–¹æ³•çš„åˆå§‹é˜¶æ®µè¿›å…¥å½“å‰çš„åŒæ­¥ä¸Šä¸‹æ–‡ï¼Œå¹¶åœ¨è¯¥ä¸Šä¸‹æ–‡ä¸­è®¡åˆ’æ‰€æœ‰åç»­æ“ä½œã€‚ ç°åœ¨ï¼Œåœ¨ç”¨æˆ·ç•Œé¢çº¿ç¨‹ä¸­æ‰§è¡Œawaitè¯­å¥ä¹‹é—´çš„æ¯ä¸ªå—ï¼Œè¿™ä½¿å¾—å®ç°ä¸»è„šæœ¬æˆä¸ºå¯èƒ½ã€‚ ä½†æ˜¯ï¼Œè¿™ç§è§£å†³æ–¹æ¡ˆå¼•èµ·äº†è®¸å¤šæ–°é—®é¢˜ã€‚ <br><br><h2> æ­»é” </h2><br> è®©æˆ‘ä»¬çœ‹ä¸€å°æ®µç›¸å¯¹ç®€å•çš„ä»£ç ã€‚ è¿™é‡Œæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// UI code private void buttonOk_Click(object sender, EventArgs args) { textBox.Text = "Running.."; var result = _stockPrices.GetStockPricesForAsync("MSFT").Result; textBox.Text = "Result is: " + result; } // StockPrices.dll public Task&lt;decimal&gt; GetStockPricesForAsync(string symbol) { await Task.Yield(); return 42; }</span></span></code> </pre> <br> æ­¤ä»£ç å¯¼è‡´<b>æ­»é”</b> ã€‚ ç”¨æˆ·ç•Œé¢çº¿ç¨‹å¼€å§‹å¼‚æ­¥æ“ä½œï¼Œå¹¶åŒæ­¥ç­‰å¾…ç»“æœã€‚ ä½†æ˜¯ï¼Œå¼‚æ­¥æ–¹æ³•æ— æ³•å®Œæˆï¼Œå› ä¸ºå¿…é¡»åœ¨å¯¼è‡´æ­»é”çš„ç”¨æˆ·ç•Œé¢çº¿ç¨‹ä¸­æ‰§è¡Œ<code>GetStockPricesForAsync</code>çš„ç¬¬äºŒè¡Œã€‚ <br><br> æ‚¨ä¼šåå¯¹è¿™ä¸ªé—®é¢˜å¾ˆå®¹æ˜“è§£å†³ã€‚ çš„ç¡®æ˜¯ã€‚ æ‚¨éœ€è¦ç¦æ­¢ä»ç”¨æˆ·ç•Œé¢ä»£ç å¯¹<code>Task.Result</code>æˆ–<code>Task.Wait</code>æ‰€æœ‰è°ƒç”¨ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ­¤ç±»ä»£ç æ‰€ä½¿ç”¨çš„ç»„ä»¶æ­£åœ¨åŒæ­¥ç­‰å¾…ç”¨æˆ·æ“ä½œçš„ç»“æœï¼Œåˆ™ä»ç„¶å¯èƒ½å‡ºç°æ­¤é—®é¢˜ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// UI code private void buttonOk_Click(object sender, EventArgs args) { textBox.Text = "Running.."; var result = _stockPrices.GetStockPricesForAsync("MSFT").Result; textBox.Text = "Result is: " + result; } // StockPrices.dll public Task&lt;decimal&gt; GetStockPricesForAsync(string symbol) { // We know that the initialization step is very fast, // and completes synchronously in most cases, // let's wait for the result synchronously for "performance reasons". InitializeIfNeededAsync().Wait(); return Task.FromResult((decimal)42); } // StockPrices.dll private async Task InitializeIfNeededAsync() =&gt; await Task.Delay(1);</span></span></code> </pre> <br> æ­¤ä»£ç å†æ¬¡å¯¼è‡´æ­»é”ã€‚ è§£å†³æ–¹æ³•ï¼š <br><br><ul><li> æ‚¨ä¸åº”ä½¿ç”¨<code>Task.Wait()</code>æˆ–<code>Task.Result</code>å’Œ </li><li> åœ¨åº“ä»£ç ä¸­ä½¿ç”¨<code>ConfigureAwait(false)</code> ã€‚ </li></ul><br> ç¬¬ä¸€æ¡å»ºè®®çš„å«ä¹‰å¾ˆæ˜ç¡®ï¼Œç¬¬äºŒæ¡æˆ‘ä»¬å°†åœ¨ä¸‹é¢è§£é‡Šã€‚ <br><br><h2> é…ç½®ç­‰å¾…è¯­å¥ </h2><br> ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­å‘ç”Ÿæ­»é”çš„åŸå› æœ‰ä¸¤ä¸ªï¼š <code>GetStockPricesForAsync</code> <code>Task.Wait()</code>å’Œåœ¨InitializeIfNeededAsyncçš„åç»­æ­¥éª¤ä¸­é—´æ¥ä½¿ç”¨åŒæ­¥ä¸Šä¸‹æ–‡ã€‚ å°½ç®¡Cï¼ƒç¨‹åºå‘˜ä¸å»ºè®®é˜»å¡å¯¹å¼‚æ­¥æ–¹æ³•çš„è°ƒç”¨ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä»ç„¶ä½¿ç”¨è¿™ç§é˜»å¡ã€‚  Cï¼ƒç¨‹åºå‘˜ä¸ºæ­»é”é—®é¢˜æä¾›äº†ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š <code>Task.ConfigureAwait(continueOnCapturedContext:false)</code> ã€‚ <br><br> å°½ç®¡å‡ºç°äº†å¥‡æ€ªçš„å¤–è§‚ï¼ˆå¦‚æœåœ¨æ²¡æœ‰å‘½åå‚æ•°çš„æƒ…å†µä¸‹æ‰§è¡Œæ–¹æ³•è°ƒç”¨ï¼Œåˆ™æ ¹æœ¬æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼‰ï¼Œè¯¥è§£å†³æ–¹æ¡ˆä»ä¼šæ‰§è¡Œå…¶åŠŸèƒ½ï¼šå®ƒåœ¨æ²¡æœ‰åŒæ­¥ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹æä¾›äº†å¼ºåˆ¶æ‰§è¡Œçš„ç»§ç»­ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStockPricesForAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> symbol</span></span></span><span class="hljs-function">)</span></span> { InitializeIfNeededAsync().Wait(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.FromResult((<span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>)<span class="hljs-number"><span class="hljs-number">42</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeIfNeededAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Task.Delay(<span class="hljs-number"><span class="hljs-number">1</span></span>).ConfigureAwait(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¡åˆ’<code>Task.Delay(1</code> ï¼‰ä»»åŠ¡çš„ç»§ç»­ï¼ˆè¿™é‡Œæ˜¯ç©ºè¯­å¥ï¼‰åœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ä¸­è¿›è¡Œè®¡åˆ’ï¼Œè€Œä¸æ˜¯åœ¨ç”¨æˆ·ç•Œé¢çº¿ç¨‹ä¸­è¿›è¡Œè®¡åˆ’ï¼Œè¿™æ ·å¯ä»¥æ¶ˆé™¤æ­»é”ã€‚ <br><br><h2> ç¦ç”¨åŒæ­¥ä¸Šä¸‹æ–‡ </h2><br> æˆ‘çŸ¥é“<code>ConfigureAwait</code>å®é™…ä¸Šå¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼Œä½†æ˜¯äº§ç”Ÿçš„æ›´å¤šã€‚ è¿™æ˜¯ä¸€ä¸ªå°ä¾‹å­ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStockPricesForAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> symbol</span></span></span><span class="hljs-function">)</span></span> { InitializeIfNeededAsync().Wait(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.FromResult((<span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>)<span class="hljs-number"><span class="hljs-number">42</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeIfNeededAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Initialize the cache field first await _cache.InitializeAsync().ConfigureAwait(false); // Do some work await Task.Delay(1); }</span></span></code> </pre> <br> çœ‹åˆ°é—®é¢˜äº†å—ï¼Ÿ æˆ‘ä»¬ä½¿ç”¨äº†<code>ConfigureAwait(false)</code> ï¼Œæ‰€ä»¥ä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ ä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚ <br><br>  <code>ConfigureAwait(false)</code>è¿”å›è‡ªå®šä¹‰çš„ç­‰å¾…è€…<code>ConfiguredTaskAwaitable</code>å¯¹è±¡ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“åªæœ‰åœ¨ä»»åŠ¡æœªåŒæ­¥å®Œæˆæ—¶æ‰ä½¿ç”¨å®ƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ<code>_cache.InitializeAsync()</code>åŒæ­¥å®Œæˆï¼Œåˆ™ä»ç„¶å¯èƒ½å‡ºç°æ­»é”ã€‚ <br><br> ä¸ºäº†æ¶ˆé™¤æ­»é”ï¼Œå¿…é¡»ä½¿ç”¨å¯¹<code>ConfigureAwait(false)</code>æ–¹æ³•çš„è°ƒç”¨æ¥â€œè£…é¥°â€æ‰€æœ‰ç­‰å¾…å®Œæˆçš„ä»»åŠ¡ã€‚ æ‰€æœ‰è¿™äº›çƒ¦äººå¹¶äº§ç”Ÿé”™è¯¯ã€‚ <br><br> æˆ–è€…ï¼Œå¯ä»¥åœ¨æ‰€æœ‰å…¬å…±æ–¹æ³•ä¸­ä½¿ç”¨awaiterè‡ªå®šä¹‰å¯¹è±¡ï¼Œä»¥åœ¨å¼‚æ­¥æ–¹æ³•ä¸­ç¦ç”¨åŒæ­¥ä¸Šä¸‹æ–‡ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttonOk_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs args</span></span></span><span class="hljs-function">)</span></span> { textBox.Text = <span class="hljs-string"><span class="hljs-string">"Running.."</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = _stockPrices.GetStockPricesForAsync(<span class="hljs-string"><span class="hljs-string">"MSFT"</span></span>).Result; textBox.Text = <span class="hljs-string"><span class="hljs-string">"Result is: "</span></span> + result; } <span class="hljs-comment"><span class="hljs-comment">// StockPrices.dll public async Task&lt;decimal&gt; GetStockPricesForAsync(string symbol) { // The rest of the method is guarantee won't have a current sync context. await Awaiters.DetachCurrentSyncContext(); // We can wait synchronously here and we won't have a deadlock. InitializeIfNeededAsync().Wait(); return 42; }</span></span></code> </pre> <br>  <code>Awaiters.DetachCurrentSyncContext</code>è¿”å›ä»¥ä¸‹å®šåˆ¶çš„awaiterå¯¹è±¡ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> DetachSynchronizationContextAwaiter : ICriticalNotifyCompletion { <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Returns true if a current synchronization context is null. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> It means that the continuation is called only when a current context </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> is presented. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public bool IsCompleted =&gt; SynchronizationContext.Current == null; public void OnCompleted(Action continuation) { ThreadPool.QueueUserWorkItem(state =&gt; continuation()); } public void UnsafeOnCompleted(Action continuation) { ThreadPool.UnsafeQueueUserWorkItem(state =&gt; continuation(), null); } public void GetResult() { } public DetachSynchronizationContextAwaiter GetAwaiter() =&gt; this; } public static class Awaiters { public static DetachSynchronizationContextAwaiter DetachCurrentSyncContext() { return new DetachSynchronizationContextAwaiter(); } }</span></span></code> </pre> <br>  <code>DetachSynchronizationContextAwaiter</code>æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šasyncæ–¹æ³•ä¸éé›¶åŒæ­¥ä¸Šä¸‹æ–‡ä¸€èµ·ä½¿ç”¨ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¼‚æ­¥æ–¹æ³•åœ¨æ²¡æœ‰åŒæ­¥ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹å·¥ä½œï¼Œåˆ™<code>IsCompleted</code>å±æ€§å°†è¿”å›trueï¼Œå¹¶ä¸”è¯¥æ–¹æ³•çš„ç»§ç»­å°†åŒæ­¥æ‰§è¡Œã€‚ <br><br> è¿™æ„å‘³ç€ï¼Œå½“ä»çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‰§è¡Œå¼‚æ­¥æ–¹æ³•æ—¶ï¼ŒæœåŠ¡æ•°æ®æ¥è¿‘äºé›¶ï¼Œå¹¶ä¸”ä¸ºå°†æ‰§è¡Œä»ç”¨æˆ·ç•Œé¢çº¿ç¨‹è½¬ç§»åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è€Œè¿›è¡Œäº†ä¸€æ¬¡ä»˜æ¬¾ã€‚ <br><br> ä¸‹é¢åˆ—å‡ºäº†æ­¤æ–¹æ³•çš„å…¶ä»–å¥½å¤„ã€‚ <br><br><ul><li>  <b>å‡å°‘é”™è¯¯çš„å¯èƒ½æ€§ã€‚</b>  <code>ConfigureAwait(false)</code>ä»…é€‚ç”¨äºæ‰€æœ‰ç­‰å¾…å®Œæˆçš„ä»»åŠ¡ã€‚ è‡³å°‘åº”è¯¥å¿˜è®°ä¸€ä»¶äº‹-å¯èƒ½ä¼šå‘ç”Ÿæ­»é”ã€‚ å¯¹äºè‡ªå®šä¹‰awaiterå¯¹è±¡ï¼Œè¯·è®°ä½ï¼Œæ‰€æœ‰å…¬å…±åº“æ–¹æ³•éƒ½å¿…é¡»ä»¥<code>Awaiters.DetachCurrentSyncContext()</code>å¼€å¤´ã€‚ é”™è¯¯åœ¨è¿™é‡Œæ˜¯å¯èƒ½çš„ï¼Œä½†å…¶å¯èƒ½æ€§è¦ä½å¾—å¤šã€‚ </li><li>  <b>ç”Ÿæˆçš„ä»£ç æ›´å…·å£°æ˜æ€§å’Œæ¸…æ™°æ€§ã€‚</b> å¯¹æˆ‘æ¥è¯´ï¼Œå¸¦æœ‰å¤šä¸ªè°ƒç”¨çš„<code>ConfigureAwait</code>æ–¹æ³•ä¼¼ä¹ä¸å¤ªå®¹æ˜“ç†è§£ï¼ˆç”±äºé¢å¤–çš„å…ƒç´ ï¼‰ï¼Œå¹¶ä¸”å¯¹äºåˆå­¦è€…æ¥è¯´ä¿¡æ¯ä¸è¶³ã€‚ </li></ul><br><h2> å¼‚å¸¸å¤„ç† </h2><br> è¿™ä¸¤ä¸ªé€‰é¡¹æœ‰ä»€ä¹ˆåŒºåˆ«ï¼š <br><br> ä»»åŠ¡mayFail = Task.FromExceptionï¼ˆæ–°ArgumentNullExceptionï¼ˆï¼‰ï¼‰; <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Case 1 try { await mayFail; } catch (ArgumentException e) { // Handle the error } // Case 2 try { mayFail.Wait(); } catch (ArgumentException e) { // Handle the error }</span></span></code> </pre> <br> åœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œä¸€åˆ‡éƒ½ç¬¦åˆé¢„æœŸ-æ‰§è¡Œé”™è¯¯å¤„ç†ï¼Œä½†æ˜¯åœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿã€‚  TPLå¹¶è¡Œä»»åŠ¡åº“è®¾è®¡ç”¨äºå¼‚æ­¥å’Œå¹¶è¡Œç¼–ç¨‹ï¼Œå¹¶ä¸”Task / Taskå¯ä»¥è¡¨ç¤ºå¤šä¸ªæ“ä½œçš„ç»“æœã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ<code>Task.Result</code>å’Œ<code>Task.Wait()</code>æ€»æ˜¯æŠ›å‡º<code>AggregateException</code> ï¼Œå®ƒå¯èƒ½åŒ…å«å¤šä¸ªé”™è¯¯çš„åŸå› ã€‚ <br><br> ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ä¸»è¦åœºæ™¯æ”¹å˜äº†æ‰€æœ‰äº‹æƒ…ï¼šç”¨æˆ·åº”è¯¥èƒ½å¤Ÿæ·»åŠ async / awaitè¿ç®—ç¬¦ï¼Œè€Œæ— éœ€æ¥è§¦é”™è¯¯å¤„ç†é€»è¾‘ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œawaitè¯­å¥å¿…é¡»ä¸<code>Task.Result</code> / <code>Task.Wait()</code> ï¼šå®ƒå¿…é¡»å–æ¶ˆ<code>AggregateException</code>å®ä¾‹ä¸­ä¸€ä¸ªå¼‚å¸¸çš„åŒ…è£…ã€‚ ä»Šå¤©ï¼Œæˆ‘ä»¬å°†é€‰æ‹©ç¬¬ä¸€ä¸ªä¾‹å¤–ã€‚ <br><br> å¦‚æœæ‰€æœ‰åŸºäºTaskçš„æ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„ï¼Œå¹¶ä¸”ä¸ä½¿ç”¨å¹¶è¡Œè®¡ç®—æ¥æ‰§è¡Œä»»åŠ¡ï¼Œé‚£ä¹ˆä¸€åˆ‡éƒ½å¾ˆå¥½ã€‚ ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸€åˆ‡éƒ½ä¸åŒï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Task&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; task1 = Task.FromException&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException()); Task&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; task2 = Task.FromException&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException()); <span class="hljs-comment"><span class="hljs-comment">// await will rethrow the first exception await Task.WhenAll(task1, task2); } catch (Exception e) { // ArgumentNullException. The second error is lost! Console.WriteLine(e.GetType()); }</span></span></code> </pre> <br>  <code>Task.WhenAll</code>è¿”å›ä¸€ä¸ªæœ‰ä¸¤ä¸ªé”™è¯¯çš„ä»»åŠ¡ï¼Œä½†æ˜¯ï¼Œawaitè¯­å¥ä»…æ£€ç´¢å¹¶å¡«å……ç¬¬ä¸€ä¸ªã€‚ <br><br> æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³æ­¤é—®é¢˜ï¼š <br><br><ol><li> æ‰‹åŠ¨æŸ¥çœ‹æœ‰è®¿é—®æƒé™çš„ä»»åŠ¡ï¼Œæˆ–è€… </li><li> é…ç½®TPLåº“ä»¥å¼ºåˆ¶å°†å¼‚å¸¸åŒ…è£…åœ¨å¦ä¸€ä¸ª<code>AggregateException</code> ã€‚ </li></ol><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Task&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; task1 = Task.FromException&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException()); Task&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; task2 = Task.FromException&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException()); <span class="hljs-comment"><span class="hljs-comment">// t.Result forces TPL to wrap the exception into AggregateException await Task.WhenAll(task1, task2).ContinueWith(t =&gt; t.Result); } catch(Exception e) { // AggregateException Console.WriteLine(e.GetType()); }</span></span></code> </pre> <br><h2> å¼‚æ­¥æ— æ•ˆæ–¹æ³• </h2><br> åŸºäºä»»åŠ¡çš„æ–¹æ³•è¿”å›ä¸€ä¸ªä»¤ç‰Œï¼Œè¯¥ä»¤ç‰Œå¯ç”¨äºå°†æ¥å¤„ç†ç»“æœã€‚ å¦‚æœä»»åŠ¡ä¸¢å¤±ï¼Œä»¤ç‰Œå°†å˜å¾—ä¸å¯è®¿é—®ï¼Œæ— æ³•è¢«ç”¨æˆ·ä»£ç è¯»å–ã€‚ è¿”å›voidæ–¹æ³•çš„å¼‚æ­¥æ“ä½œå°†å¼•å‘é”™è¯¯ï¼Œè¯¥é”™è¯¯æ— æ³•åœ¨ç”¨æˆ·ä»£ç ä¸­å¤„ç†ã€‚ ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œä»¤ç‰Œæ˜¯æ— ç”¨çš„ï¼Œç”šè‡³æ˜¯å±é™©çš„-ç°åœ¨æˆ‘ä»¬å°†çœ‹åˆ°å®ƒã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ä¸»è¦æ–¹æ¡ˆå‡è®¾å…¶å¿…é¡»ä½¿ç”¨ï¼š <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buttonOk_ClickAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs args</span></span></span><span class="hljs-function">)</span></span> { textBox.Text = <span class="hljs-string"><span class="hljs-string">"Running.."</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _stockPrices.GetStockPricesForAsync(<span class="hljs-string"><span class="hljs-string">"MSFT"</span></span>); textBox.Text = <span class="hljs-string"><span class="hljs-string">"Result is: "</span></span> + result; }</code> </pre> <br> ä½†æ˜¯ï¼Œå¦‚æœ<code>GetStockPricesForAsync</code>å¼•å‘é”™è¯¯æ€ä¹ˆåŠï¼Ÿ æœªå¤„ç†çš„å¼‚æ­¥voidæ–¹æ³•å¼‚å¸¸å°†ç¼–ç»„åˆ°å½“å‰çš„åŒæ­¥ä¸Šä¸‹æ–‡ä¸­ï¼Œä»è€Œè§¦å‘ä¸åŒæ­¥ä»£ç ç›¸åŒçš„è¡Œä¸ºï¼ˆæœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">AsyncMethodBuilder.cs</a> Webé¡µé¢ä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ThrowAsyncæ–¹æ³•</a> ï¼‰ã€‚ åœ¨Windowsçª—ä½“ä¸Šï¼Œäº‹ä»¶å¤„ç†ç¨‹åºä¸­çš„æœªå¤„ç†å¼‚å¸¸ä¼šè§¦å‘<code>Application.ThreadException</code>äº‹ä»¶ï¼Œå¯¹äºWPFï¼Œä¼šè§¦å‘<code>Application.DispatcherUnhandledException</code>äº‹ä»¶ï¼Œä¾æ­¤ç±»æ¨ã€‚ <br><br> å¦‚æœasync voidæ–¹æ³•æœªè·å¾—åŒæ­¥ä¸Šä¸‹æ–‡æ€ä¹ˆåŠï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœªå¤„ç†çš„å¼‚å¸¸ä¼šå¯¼è‡´è‡´å‘½çš„åº”ç”¨ç¨‹åºå´©æºƒã€‚ å®ƒä¸ä¼šè§¦å‘å°†è¦æ¢å¤çš„[ <code>TaskScheduler.UnobservedTaskException</code> ]äº‹ä»¶ï¼Œä½†æ˜¯å°†è§¦å‘<code>AppDomain.UnhandledException</code>ä¸å¯æ¢å¤äº‹ä»¶ï¼Œç„¶åå…³é—­åº”ç”¨ç¨‹åºã€‚ è¿™æ˜¯æœ‰æ„å‘ç”Ÿçš„ï¼Œè€Œè¿™æ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ç»“æœã€‚ <br><br> ç°åœ¨è®©æˆ‘ä»¬çœ‹å¦ä¸€ç§ä¼—æ‰€å‘¨çŸ¥çš„æ–¹å¼ï¼šä»…å°†å¼‚æ­¥voidæ–¹æ³•ç”¨äºç”¨æˆ·ç•Œé¢äº‹ä»¶å¤„ç†ç¨‹åºã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼Œasynch voidæ–¹æ³•å¾ˆå®¹æ˜“è¢«æ„å¤–è°ƒç”¨ã€‚ <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Task&lt;T&gt; ActionWithRetry&lt;T&gt;(Func&lt;Task&lt;T&gt;&gt; provider, Action&lt;Exception&gt; onError) { <span class="hljs-comment"><span class="hljs-comment">// Calls 'provider' N times and calls 'onError' in case of an error. } public async Task&lt;string&gt; AccidentalAsyncVoid(string fileName) { return await ActionWithRetry( provider: () =&gt; { return File.ReadAllTextAsync(fileName); }, // Can you spot the issue? onError: async e =&gt; { await File.WriteAllTextAsync(errorLogFile, e.ToString()); }); }</span></span></code> </pre> <br> ä¹çœ‹ä¹‹ä¸‹ï¼Œå¾ˆéš¾è¯´å‡ºlambdaè¡¨è¾¾å¼æ˜¯å‡½æ•°æ˜¯åŸºäºä»»åŠ¡çš„æ–¹æ³•è¿˜æ˜¯å¼‚æ­¥voidæ–¹æ³•ï¼Œå› æ­¤ï¼Œå°½ç®¡è¿›è¡Œäº†æœ€å½»åº•çš„æ£€æŸ¥ï¼Œä½†é”™è¯¯ä»å¯èƒ½è”“å»¶åˆ°æ‚¨çš„ä»£ç åº“ä¸­ã€‚ <br><br><h2> ç»“è®º </h2><br>  Cï¼ƒå¼‚æ­¥ç¼–ç¨‹çš„è®¸å¤šæ–¹é¢éƒ½å—åˆ°å•ä¸ªç”¨æˆ·åœºæ™¯çš„å½±å“-åªéœ€å°†ç°æœ‰ç”¨æˆ·ç•Œé¢åº”ç”¨ç¨‹åºçš„åŒæ­¥ä»£ç è½¬æ¢ä¸ºå¼‚æ­¥ä»£ç å³å¯ï¼š <br><br><ul><li> åœ¨ç»“æœåŒæ­¥ä¸Šä¸‹æ–‡ä¸­å®‰æ’äº†å¼‚æ­¥æ–¹æ³•çš„åç»­æ‰§è¡Œï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚ </li><li> ä¸ºäº†é˜²æ­¢å®ƒä»¬ï¼Œå¿…é¡»åœ¨å¼‚æ­¥åº“çš„ä»£ç ä¸­çš„ä»»ä½•åœ°æ–¹æ”¾ç½®è°ƒç”¨<code>ConfigureAwait(false)</code> ã€‚ </li><li> ç­‰å¾…ä»»åŠ¡ï¼› äº§ç”Ÿç¬¬ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä½¿å¹¶è¡Œç¼–ç¨‹çš„å¤„ç†å¼‚å¸¸çš„åˆ›å»ºå¤æ‚åŒ–ã€‚ </li><li> å¼•å…¥äº†å¼‚æ­¥voidæ–¹æ³•æ¥å¤„ç†ç”¨æˆ·ç•Œé¢äº‹ä»¶ï¼Œä½†å®ƒä»¬å¾ˆå®¹æ˜“å¶ç„¶æ‰§è¡Œï¼Œå¦‚æœå¼•å‘å¼‚å¸¸ï¼Œåˆ™å°†å¯¼è‡´åº”ç”¨ç¨‹åºå´©æºƒã€‚ </li></ul><br> å…è´¹å¥¶é…ªä»…åœ¨æ•é¼ å™¨ä¸­å‘ç”Ÿã€‚ æ˜“äºä½¿ç”¨æœ‰æ—¶ä¼šåœ¨å…¶ä»–é¢†åŸŸå¸¦æ¥å¾ˆå¤§çš„å›°éš¾ã€‚ å¦‚æœæ‚¨ç†Ÿæ‚‰Cï¼ƒä¸­çš„å¼‚æ­¥ç¼–ç¨‹çš„å†å²ï¼Œé‚£ä¹ˆæœ€å¥‡æ€ªçš„è¡Œä¸ºä¼¼ä¹ä¸å†é‚£ä¹ˆå¥‡æ€ªï¼Œå¹¶ä¸”å¤§å¤§å‡å°‘äº†å¼‚æ­¥ä»£ç ä¸­å‡ºé”™çš„å¯èƒ½æ€§ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN421245/">https://habr.com/ru/post/zh-CN421245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN421227/index.html">è·¨å¹³å°ç§»åŠ¨å¼€å‘æ¡†æ¶æ¦‚è¿°</a></li>
<li><a href="../zh-CN421229/index.html">æˆ‘å¤´ç–¼çš„æ•…äº‹</a></li>
<li><a href="../zh-CN421235/index.html">Magic Leap Oneçœ¼é•œ-å”®ä»·2295ç¾å…ƒï¼Œå¯ç»´æŠ¤æ€§3/10</a></li>
<li><a href="../zh-CN421241/index.html">ä¸­å¤®é“¶è¡Œè¦æ±‚å¯¹æ¶æ„ç«™ç‚¹è¿›è¡Œå®¡åˆ¤å‰å°é”</a></li>
<li><a href="../zh-CN421243/index.html">LLTRç¬¬2éƒ¨åˆ†ï¼šæ ¹æ®æ”¶é›†çš„ç»Ÿè®¡ä¿¡æ¯ç¡®å®šç½‘ç»œæ‹“æ‰‘çš„ç®—æ³•</a></li>
<li><a href="../zh-CN421247/index.html">å¦‚ä½•å°†å›¾å½¢è½¬æ¢ä¸ºå£°éŸ³ï¼Œä»¥åŠä¸ºä»€ä¹ˆéœ€è¦å®ƒ</a></li>
<li><a href="../zh-CN421249/index.html">ä¸ºä»€ä¹ˆåå°”è¡—é‡‘èå®¶å·¥ä½œè¿‡å¤šï¼Œå¹¶ä¸”å¯ä»¥è§£å†³ï¼Ÿ</a></li>
<li><a href="../zh-CN421251/index.html">å¤‡ä»½ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN421253/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å°¾è½¦ï¼Ÿ</a></li>
<li><a href="../zh-CN421255/index.html">ä¼Šéš†Â·é©¬æ–¯å…‹ï¼ˆElon Muskï¼‰æ”¾å¼ƒäº†å°†ç‰¹æ–¯æ‹‰è½¬å˜æˆç§äººå…¬å¸çš„è®¡åˆ’</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>