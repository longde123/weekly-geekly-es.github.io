<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñêüèΩ üëêüèø üå¨Ô∏è Dos en uno: monitor y reloj de calidad del aire programables por Wi-Fi üëÜüèæ üÉè üë©‚Äçüë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En un momento, me gust√≥ el monitor de calidad del aire de la publicaci√≥n de Sergei Silnov, "Monitor de aire dom√©stico compacto (CO2, temperatura, hume...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dos en uno: monitor y reloj de calidad del aire programables por Wi-Fi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442856/"><p>  En un momento, me gust√≥ el monitor de calidad del aire de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la</a> publicaci√≥n de Sergei Silnov, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Monitor de aire dom√©stico compacto (CO2, temperatura, humedad, presi√≥n) con Wi-Fi y una interfaz m√≥vil"</a> . </p><br><p>  En el monitor de calidad del aire (en adelante, el monitor) del proyecto de Sergey, el controlador ESP8266 procesa la informaci√≥n de los sensores de temperatura, humedad, presi√≥n y contenido de 2 en el aire y se muestra en una pantalla monocrom√°tica en varios cuadros.  Adem√°s, en el monitor, a trav√©s del formulario en el navegador, la clave de identificaci√≥n del servicio Blynk se almacena en la memoria ESP8266 y los datos se env√≠an autom√°ticamente a Blynk. </p><br><p>  El monitor ten√≠a un problema grave: se bloque√≥ al apagar / encender o incluso "parpadear" la tensi√≥n de alimentaci√≥n del monitor. </p><br><p>  Repet√≠ el proyecto con cambios menores, y para eliminar las congelaciones del monitor, agregu√© energ√≠a alternativa al circuito.  Simple como un rastrillo: el devanado del rel√© estaba bajo el voltaje del adaptador de CA / CC, y los contactos del rel√© cambiaron la alimentaci√≥n del adaptador a las bater√≠as cuando desapareci√≥ el voltaje en la red de 220V. </p><br><p>  Mi √©xito imaginario dur√≥ hasta la primera interrupci√≥n en la casa (esto sucede con nosotros).  Las bater√≠as baratas se agotaron antes de que apareciera el voltaje en los enchufes, y volv√≠ al punto de partida. </p><br><p>  Despu√©s de pisar su propio rastrillo, decid√≠ no buscar soluciones simples. </p><a name="habracut"></a><br><p>  Cambios / adiciones hechas al bosquejo por S. Silnov: </p><br><ul><li>  El monitor se desconecta autom√°ticamente 90 segundos despu√©s de apagar y encender nuevamente el voltaje de la fuente de alimentaci√≥n del monitor, si no hay Wi-Fi disponible en este momento. </li><li>  Los valores de temperatura l√≠mite, el contenido de CO2, la humedad del aire, as√≠ como la zona horaria y el horario de invierno / verano se ingresan en la memoria ESP8266, como la tecla Blynk, desde el formulario en el navegador. </li><li>  El cambio en los valores l√≠mite se simplifica radicalmente.  Si antes este procedimiento se realizaba a trav√©s del compilador de c√≥digo, ahora es suficiente cambiar el registro en uno de los campos del formulario de "0" a "1".  Este trabajo se ha convertido en factible, ni siquiera para usuarios avanzados. </li><li>  La informaci√≥n sobre el funcionamiento del monitor se muestra en la pantalla a color de 1,44 ‚Äù, 128x128 en un cuadro.  La salida de los par√°metros del aire m√°s all√° de los valores l√≠mite se muestra en el cuadro en color. </li><li>  En el monitor, el √≠ndice de calor (humindex) se calcula y se muestra en la pantalla. </li><li>  Las notificaciones se env√≠an desde el monitor por correo electr√≥nico si la temperatura, el contenido de CO2 o la humedad del aire est√°n fuera de los umbrales establecidos por el usuario. </li><li>  El monitor puede funcionar sin conectarse al servicio Blynk y la direcci√≥n de correo electr√≥nico. </li><li>  Se ha agregado un reloj anal√≥gico en tiempo real al monitor, que se sincroniza a trav√©s de Internet con el servidor de hora exacto. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/dp/hc/ba/dphcba8d2lt2ihdpvatv2m_a0pu.gif"></div><br><p>  Esta es una de las tareas no resueltas de mi proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Termostato ambiental inal√°mbrico programable por Wi-Fi con monitor de calidad del aire y otras funciones √∫tiles"</a> .  Decid√≠ formalizar esta tarea como un art√≠culo separado, porque hoy en d√≠a muchos est√°n interesados ‚Äã‚Äãen la calidad del aire en la vivienda. </p><br><h2>  Asamblea </h2><br><p>  Para ensamblar el dispositivo, necesitar√° componentes, una lista de los cuales y su costo estimado a los precios del sitio web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AliExpress</a> se muestran en la tabla. </p><br><p></p><table border="1"><tbody><tr><td>  <strong>Componente</strong> </td><td>  <strong>Precio ($)</strong> </td></tr><tr><td>  Tarjeta wifi NodeMCU CP2102 ESP8266 </td><td>  2,53 </td></tr><tr><td>  Sensor de temperatura y humedad DHT22 </td><td>  2,34 </td></tr><tr><td>  Sensor de contenido de CO2 MH Z-19 </td><td>  18.50 </td></tr><tr><td>  Pantalla TFTLCD 1.44 "SPI 128x128 </td><td>  2,69 </td></tr><tr><td>  Reloj RTC DS3231 </td><td>  1.00 </td></tr><tr><td>  Cables de montaje, otras bagatelas </td><td>  2,00 </td></tr><tr><td>  <strong><em>Total (aproximadamente):</em></strong> </td><td>  <strong><em>30</em></strong> </td></tr></tbody></table><br><p>  El cerebro del monitor es el controlador ESP8266 en la placa del m√≥dulo NodeMCU CP2102.  Recibe se√±ales de sensores, relojes y genera una se√±al de control de pantalla, sincroniza el reloj y tambi√©n env√≠a informaci√≥n a Blynk y correo electr√≥nico. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/qw/zn/q7/qwznq7uggbl-1rmx1esmdtwpopg.png"></a> </p><br><p>  Desafortunadamente, no encontr√© la biblioteca Fritzing para la pantalla a color de 1.44 ", 128x128 con un pinout de 8 pines, por lo que la pantalla tiene una pantalla de 11 pines.  Al montar, preste atenci√≥n no a la ubicaci√≥n de la salida de la pantalla en relaci√≥n con otros, sino a su carga funcional. </p><br><p>  Para aquellos a quienes no les gusta armar un prototipo para el diagrama de cableado, la tabla de conexi√≥n: </p><br><p></p><table border="1"><tbody><tr><td>  <strong>NodeMCU (GPIO)</strong> </td><td>  <strong>Pin de sensores</strong> </td></tr><tr><td>  D0 (GPIO 16) </td><td>  displ_1.44, CS </td></tr><tr><td>  D1 (GPIO 5) </td><td>  DS3231, SCL </td></tr><tr><td>  D2 (GPIO 4) </td><td>  DS3231, SDA </td></tr><tr><td>  D3 (GPIO 0) </td><td>  DHT22, DATOS; </td></tr><tr><td>  D4 (GPIO 2) </td><td>  displ_1.44, A0 </td></tr><tr><td>  D5 (GPIO 14) </td><td>  displ_1.44, SCK </td></tr><tr><td>  D6 (GPIO 12) </td><td>  displ_1.44, RST </td></tr><tr><td>  D7 (GPIO 13) </td><td>  displ_1.44, SDA </td></tr><tr><td>  D8 (GPIO 15) </td><td>  GND </td></tr><tr><td>  Tx </td><td>  MH-Z19, Rx </td></tr><tr><td>  Rx </td><td>  MH-Z19, Tx </td></tr><tr><td>  Vin (5V) </td><td>  displ_1.44, Vcc;  DHT22;  Mh-z19 </td></tr><tr><td>  3.3V </td><td>  displ_1.44, LED;  DS3231, Vcc </td></tr><tr><td>  GND </td><td>  Sensores, GND </td></tr></tbody></table><br><p>  Si usa una bater√≠a en lugar de una bater√≠a en el m√≥dulo del reloj, no olvide romper el circuito de carga de la bater√≠a, de lo contrario, la bater√≠a se hinchar√° despu√©s de unas pocas semanas de trabajar bajo voltaje.  Con una precisi√≥n de reloj autoalimentado de 2 segundos / a√±o, est√° garantizado. </p><br><p>  El voltaje del monitor de <em>5V</em> se puede suministrar desde el puerto USB de la computadora con un cable <em>USB</em> est√°ndar <em>- microUSB</em> al m√≥dulo <em>NodeMCU esp12</em> . </p><br><p>  El boceto del monitor para cargar en el ESP8266 est√° debajo del spoiler. </p><br><p>  Por si acaso, no seas demasiado vago para modificar el controlador I2C incorporado para el n√∫cleo Arduino ESP8266.  Las instrucciones est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><div class="spoiler">  <b class="spoiler_title">monitor boceto</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* *   :   Wi-Fi       * aqm_32F_14F_P */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;FS.h&gt; #include &lt;Arduino.h&gt; #include &lt;ESP8266WiFi.h&gt; //https://github.com/esp8266/Arduino // Wifi Manager #include &lt;DNSServer.h&gt; #include &lt;ESP8266WebServer.h&gt; #include &lt;WiFiManager.h&gt; //https://github.com/tzapu/WiFiManager //OLED #include &lt;SPI.h&gt; #include &lt;Adafruit_GFX.h&gt; #include &lt;TFT_ILI9163C.h&gt; //clock #include &lt;pgmspace.h&gt; #include &lt;TimeLib.h&gt; #include &lt;ESP8266WiFi.h&gt; #include &lt;WiFiUdp.h&gt; #include &lt;Wire.h&gt; #include &lt;RtcDS3231.h&gt; RtcDS3231&lt;TwoWire&gt; Rtc(Wire); #define countof(a) (sizeof(a) / sizeof(a[0])) //e-mail #include &lt;ESP8266WiFiMulti.h&gt; #include &lt;ESP8266HTTPClient.h&gt; #define USE_SERIAL Serial ESP8266WiFiMulti WiFiMulti; //e-mail, address char address[64] {"e-mail"}; // HTTP requests #include &lt;ESP8266HTTPClient.h&gt; // OTA updates #include &lt;ESP8266httpUpdate.h&gt; // Blynk #include &lt;BlynkSimpleEsp8266.h&gt; // Debounce #include &lt;Bounce2.h&gt; //https://github.com/thomasfredericks/Bounce2 // JSON #include &lt;ArduinoJson.h&gt; //https://github.com/bblanchon/ArduinoJson // Debounce interval in ms #define DEBOUNCE_INTERVAL 10 Bounce hwReset {Bounce()}; // Humidity/Temperature #include &lt;DHT.h&gt; #define DHTPIN 0 //D3 gpio0, DHT22 DATA #define DHTTYPE DHT22 // DHT 22 DHT dht(DHTPIN, DHTTYPE); // Blynk token char blynk_token[33] {"Blynk token"}; // Setup Wifi connection WiFiManager wifiManager; // Network credentials String ssid { "am180206" }; String pass { "vb654321" }; //flag for saving data bool shouldSaveConfig = false; // Sensors data float t {-100}, t_old{-100}; float hic {-1}, hic_old{-1}; int h {-1}, h_old{-1}; int co2 {-1}, co2_old{-1}; char Tmn[5]{}, Tmx[5]{}, Hmn[5]{}, Cmx[7]{}, tZ[5]{}, timeSW[4]{}, formFS[]{"0"}; //  t, h  co2, .  float Tmin, Tmax, Hmin, Cmax, tZone, timeSummerWinter, formatingFS; float trp = 0; int crbn, bl, ml=18000; int md; // : 1 - , 2 -  int blnk; // Color definitions #define BLACK 0x0000 #define BLUE 0x001F #define RED 0xF800 #define GREEN 0x07E0 #define CYAN 0x07FF #define MAGENTA 0xF81F #define YELLOW 0xFFE0 #define WHITE 0xFFFF #define GRAY 0x9999 #define __CS 16 //D0(gpio16)- CS(display) #define __DC 2 //D4 gpio2 - AO(display) #define __RST 12 // D6 gpio12 - RESET(display) //char datestring[20]; char time_r[9]; char date_r[12]; //analog clock uint16_t ccenterx = 64,ccentery = 70;//center x,y of the clock clock const uint16_t cradius = 40;//radius of the clock const float scosConst = 0.0174532925; float sx = 0, sy = 1, mx = 1, my = 0, hx = -1, hy = 0; float sdeg=0, mdeg=0, hdeg=0; uint16_t osx,osy,omx,omy,ohx,ohy; uint16_t x0 = 0, x1 = 0, yy0 = 0, yy1 = 0; //uint32_t targetTime = 0;// for next 1 second timeout uint8_t hh,mm,ss; //containers for current time TFT_ILI9163C display = TFT_ILI9163C(__CS, __DC, __RST); String utf8(String source) { int i,k; String target; unsigned char n; char m[2] = { '0', '\0' }; k = source.length(); i = 0; while (i &lt; k) { n = source[i]; i++; if (n &gt;= 0xC0) { switch (n) { case 0xD0: { n = source[i]; i++; if (n == 0x81) { n = 0xA8; break; } if (n &gt;= 0x90 &amp;&amp; n &lt;= 0xBF) n = n + 0x30; break; } case 0xD1: { n = source[i]; i++; if (n == 0x91) { n = 0xB8; break; } if (n &gt;= 0x80 &amp;&amp; n &lt;= 0x8F) n = n + 0x70; break; } } } m[0] = n; target = target + String(m); } return target; } // NTP Servers: //static const char ntpServerName[] = "us.pool.ntp.org"; static const char ntpServerName[] = "time.nist.gov"; //const int timeZone = 2; // , , , , ,  //const int timeSummer = 1; WiFiUDP Udp; unsigned int localPort = 2390; // local port to listen for UDP packets time_t getNtpTime(); void digitalClockDisplay(); void printDigits(int digits); void sendNTPpacket(IPAddress &amp;address); void readCO2(){ #define mySerial Serial static byte cmd[9] = {0xFF,0x01,0x86,0x00,0x00,0x00,0x00,0x00,0x79}; //  byte response[9]; byte crc = 0; while (mySerial.available())mySerial.read();//  UART   memset(response, 0, 9);//   mySerial.write(cmd,9);//    CO2 mySerial.readBytes(response, 9);// 9    //   crc = 0; for (int i = 1; i &lt;= 7; i++) { crc += response[i]; } crc = ((~crc)+1); { // CRC if ( !(response[0] == 0xFF &amp;&amp; response[1] == 0x86 &amp;&amp; response[8] == crc) ) { Serial.println("CRC error"); } else { //  CO2 co2 = (((unsigned int) response[2])&lt;&lt;8) + response[3]; Serial.println("CO2: " + String(co2) + "ppm"); } } } void sendMeasurements() { float t1 {-100}, hic1 {-1}; float h1 {-1}; // Temperature t1 = dht.readTemperature(); if ((t1 &gt; -1) and (t1 &lt; 100)) t = t1; Serial.println("T: " + String(t) + "*C"); // Humidity h1 = dht.readHumidity(); if ((h1 &gt; -1) and (h1 &lt; 100)) h = h1; Serial.println("H: " + String(h) + "%"); // Humindex hic1 = dht.computeHeatIndex(t, h, false); if (t &gt;= 21.0) hic = hic1; else hic = t; Serial.println("Ti: "+String(hic)+"*C"); // CO2 crbn++; if (crbn &gt; 110) {readCO2(); crbn = 0; Serial.println("CO2: " + String(co2) + "ppm"); } } void drawConnectionDetails() { display.clearScreen(); display.setTextSize(1); display.setCursor(12,24); display.setTextColor(WHITE); display.println(utf8("Connect to WiFi:")); display.setCursor(12,36); display.println(utf8("net: " + String(ssid))); display.setCursor(12,48); display.println(utf8("pass: " + String(pass))); display.setCursor(12,60); display.println(utf8("Open browser:")); display.setCursor(12,72); display.println(utf8("http://192.168.4.1")); display.setCursor(2,84); display.setTextColor(RED); display.println(utf8(" Enter your personal information!")); } void digitalClockDisplay() { // digital clock display of the time Serial.print(hour()); printDigits(minute()); printDigits(second()); Serial.print(" "); Serial.print(day()); Serial.print("."); Serial.print(month()); Serial.print("."); Serial.print(year()); Serial.println(); } void printDigits(int digits) { // utility for digital clock display: prints preceding colon and leading 0 Serial.print(":"); if (digits &lt; 10) Serial.print('0'); Serial.print(digits); } // NTP code const int NTP_PACKET_SIZE = 48; // NTP time is in the first 48 bytes of message byte packetBuffer[NTP_PACKET_SIZE]; //buffer to hold incoming &amp; outgoing packets time_t getNtpTime() { int tZoneI, timeSummerWinterI; tZoneI = (int)tZone; timeSummerWinterI = (int)timeSummerWinterI; IPAddress ntpServerIP; // NTP server's ip address while (Udp.parsePacket() &gt; 0) ; // discard any previously received packets Serial.println("Transmit NTP Request"); // get a random server from the pool WiFi.hostByName(ntpServerName, ntpServerIP); Serial.print(ntpServerName); Serial.print(": "); Serial.println(ntpServerIP); sendNTPpacket(ntpServerIP); uint32_t beginWait = millis(); while (millis() - beginWait &lt; 1500) { int size = Udp.parsePacket(); if (size &gt;= NTP_PACKET_SIZE) { Serial.println("Receive NTP Response"); Udp.read(packetBuffer, NTP_PACKET_SIZE); // read packet into the buffer unsigned long secsSince1900; // convert four bytes starting at location 40 to a long integer secsSince1900 = (unsigned long)packetBuffer[40] &lt;&lt; 24; secsSince1900 |= (unsigned long)packetBuffer[41] &lt;&lt; 16; secsSince1900 |= (unsigned long)packetBuffer[42] &lt;&lt; 8; secsSince1900 |= (unsigned long)packetBuffer[43]; return secsSince1900 - 2208988800UL + tZoneI * SECS_PER_HOUR + timeSummerWinterI * SECS_PER_HOUR; } } Serial.println("No NTP Response :-("); return 0; // return 0 if unable to get the time } // send an NTP request to the time server at the given address void sendNTPpacket(IPAddress &amp;address) { // set all bytes in the buffer to 0 memset(packetBuffer, 0, NTP_PACKET_SIZE); // Initialize values needed to form NTP request // (see URL above for details on the packets) packetBuffer[0] = 0b11100011; // LI, Version, Mode packetBuffer[1] = 0; // Stratum, or type of clock packetBuffer[2] = 6; // Polling Interval packetBuffer[3] = 0xEC; // Peer Clock Precision // 8 bytes of zero for Root Delay &amp; Root Dispersion packetBuffer[12] = 49; packetBuffer[13] = 0x4E; packetBuffer[14] = 49; packetBuffer[15] = 52; // all NTP fields have been given values, now // you can send a packet requesting a timestamp: Udp.beginPacket(address, 123); //NTP requests are to port 123 Udp.write(packetBuffer, NTP_PACKET_SIZE); Udp.endPacket(); } void draw(){ //temperature display.setTextSize(1); display.setCursor(1,6); display.setTextColor(CYAN); display.println(utf8("T: CO2:")); String t_p; t_p = String(t); char t_p_m [12]; t_p.toCharArray(t_p_m, 5); if (t != t_old) { display.fillRect(1,15,48,18,BLACK); display.setTextSize(2); display.setCursor(1,15); display.setTextColor(GREEN); if(t &lt; Tmin) display.setTextColor(RED); if(t &gt; Tmax) display.setTextColor(RED); if ((t &gt; -100) and (t &lt; 100)) display.println(utf8(String(t_p_m))); else display.println(utf8("----"));} //heat index display.setTextSize(1); display.setCursor(2,98); display.setTextColor(CYAN); display.println(utf8("H: Ti:")); String hic_p; hic_p = String(hic); char hic_p_m [12]; hic_p.toCharArray(t_p_m, 5); if (hic != hic_old) { display.fillRect(80,108,48,18,BLACK); display.setTextSize(2); display.setCursor(80,108); display.setTextColor(GREEN); // if(t &lt; Tmin) display.setTextColor(RED); if(hic &gt; 27.0) display.setTextColor(YELLOW); if(hic &gt; 31.0) display.setTextColor(RED); if ((hic &gt; 0) and (hic &lt; 100)) display.println(utf8(String(t_p_m))); else display.println(utf8("----"));} //CO2 if (co2 != co2_old) { display.fillRect(80,15,48,18,BLACK); display.setTextSize(2); display.setCursor(80,15); display.setTextColor(GREEN); if (co2 &gt; Cmax) display.setTextColor(RED); if (co2 &gt; 600) display.setTextColor(CYAN); if ((co2 &gt; -1) and (co2 &lt;= 2000)) display.println(utf8(String(co2))); else display.println(utf8("---")); } //humidity if (h != h_old) { display.fillRect(1,108,49,18,BLACK); display.setTextSize(2); display.setCursor(1,108); display.setTextColor(GREEN); if (h &lt; Hmin) display.setTextColor(RED); if (h &gt; 60) display.setTextColor(RED); if ((h &gt; -1) and (h &lt; 100)) display.println(utf8(String(h))); else display.println(utf8("--")); } //date if (hh==0) display.fillRect(28,1,60,10,BLACK); display.setCursor(28,1); display.setTextSize(1); display.setTextColor(CYAN); display.println(utf8(date_r)); //OFFLINE if (md == 2) { display.fillRect(106,44,18,8,RED); display.setCursor(106,44); display.setTextSize(1); display.setTextColor(CYAN); display.println(" A"); } //OFF BLYNK if (blnk == 1) { display.fillRect(106,44,18,8,RED); display.setCursor(106,44); display.setTextSize(1); display.setTextColor(CYAN); display.println(" B"); } } void synchronClockA() { Rtc.Begin(); Serial.print("IP number assigned by DHCP is "); Serial.println(WiFi.localIP()); Serial.println("Starting UDP"); Udp.begin(localPort); Serial.print("Local port: "); Serial.println(Udp.localPort()); Serial.println("waiting for sync"); setSyncProvider(getNtpTime); //setSyncInterval(300); if(timeStatus() != timeNotSet){ digitalClockDisplay(); Serial.println("here is another way to set rtc"); time_t t = now(); char date_0[12]; snprintf_P(date_0, countof(date_0), PSTR("%s %02u %04u"), monthShortStr(month(t)), day(t), year(t)); Serial.println(date_0); char time_0[9]; snprintf_P(time_0, countof(time_0), PSTR("%02u:%02u:%02u"), hour(t), minute(t), second(t)); Serial.println(time_0); Serial.println("Now its time to set up rtc"); RtcDateTime compiled = RtcDateTime(date_0, time_0); // printDateTime(compiled); Serial.println(""); if (!Rtc.IsDateTimeValid()) { // Common Cuases: // 1) first time you ran and the device wasn't running yet // 2) the battery on the device is low or even missing Serial.println("RTC lost confidence in the DateTime!"); // following line sets the RTC to the date &amp; time this sketch was compiled // it will also reset the valid flag internally unless the Rtc device is // having an issue } Rtc.SetDateTime(compiled); RtcDateTime now = Rtc.GetDateTime(); if (now &lt; compiled) { Serial.println("RTC is older than compile time! (Updating DateTime)"); Rtc.SetDateTime(compiled); } else if (now &gt; compiled) { Serial.println("RTC is newer than compile time. (this is expected)"); } else if (now == compiled) { Serial.println("RTC is the same as compile time! (not expected but all is fine)"); } // never assume the Rtc was last configured by you, so // just clear them to your needed state Rtc.Enable32kHzPin(false); Rtc.SetSquareWavePin(DS3231SquareWavePin_ModeNone); } } void synchronClock() { Rtc.Begin(); // WiFi.begin(lnet, key); wifiManager.autoConnect(ssid.c_str(), pass.c_str()); while (WiFi.status() != WL_CONNECTED) { delay(500); Serial.print("."); } Serial.println(" "); Serial.print("IP number assigned by DHCP is "); Serial.println(WiFi.localIP()); Serial.println("Starting UDP"); Udp.begin(localPort); Serial.print("Local port: "); Serial.println(Udp.localPort()); Serial.println("waiting for sync"); setSyncProvider(getNtpTime); if(timeStatus() != timeNotSet){ digitalClockDisplay(); Serial.println("here is another way to set rtc"); time_t t = now(); char date_0[12]; snprintf_P(date_0, countof(date_0), PSTR("%s %02u %04u"), monthShortStr(month(t)), day(t), year(t)); Serial.println(date_0); char time_0[9]; snprintf_P(time_0, countof(time_0), PSTR("%02u:%02u:%02u"), hour(t), minute(t), second(t)); Serial.println(time_0); Serial.println("Now its time to set up rtc"); RtcDateTime compiled = RtcDateTime(date_0, time_0); Serial.println(""); if (!Rtc.IsDateTimeValid()) { // Common Cuases: // 1) first time you ran and the device wasn't running yet // 2) the battery on the device is low or even missing Serial.println("RTC lost confidence in the DateTime!"); // following line sets the RTC to the date &amp; time this sketch was compiled // it will also reset the valid flag internally unless the Rtc device is // having an issue } Rtc.SetDateTime(compiled); RtcDateTime now = Rtc.GetDateTime(); if (now &lt; compiled) { Serial.println("RTC is older than compile time! (Updating DateTime)"); Rtc.SetDateTime(compiled); } else if (now &gt; compiled) { Serial.println("RTC is newer than compile time. (this is expected)"); } else if (now == compiled) { Serial.println("RTC is the same as compile time! (not expected but all is fine)"); } // never assume the Rtc was last configured by you, so // just clear them to your needed state Rtc.Enable32kHzPin(false); Rtc.SetSquareWavePin(DS3231SquareWavePin_ModeNone); } } void Clock(){ RtcDateTime now = Rtc.GetDateTime(); //Print RTC time to Serial Monitor hh = now.Hour(); mm = now.Minute(); ss = now.Second(); sprintf(date_r, "%d.%d.%d", now.Day(), now.Month(), now.Year()); if (mm &lt; 10) sprintf(time_r, "%d:0%d", hh, mm); else sprintf(time_r, "%d:%d", hh, mm); Serial.println(date_r); Serial.println(time_r); } //analog void drawClockFace(){ display.fillCircle(ccenterx, ccentery, cradius, BLUE); display.fillCircle(ccenterx, ccentery, cradius-4, BLACK); // Draw 12 lines for(int i = 0; i&lt;360; i+= 30) { sx = cos((i-90)*scosConst); sy = sin((i-90)*scosConst); x0 = sx*(cradius)+ccenterx; yy0 = sy*(cradius)+ccentery; x1 = sx*(cradius-8)+ccenterx; yy1 = sy*(cradius-8)+ccentery; display.drawLine(x0, yy0, x1, yy1, 0x0377); } // Draw 4 lines for(int i = 0; i&lt;360; i+= 90) { sx = cos((i-90)*scosConst); sy = sin((i-90)*scosConst); x0 = sx*(cradius+6)+ccenterx; yy0 = sy*(cradius+6)+ccentery; x1 = sx*(cradius-11)+ccenterx; yy1 = sy*(cradius-11)+ccentery; display.drawLine(x0, yy0, x1, yy1, 0x0377); } } //analog static uint8_t conv2d(const char* p) { uint8_t v = 0; if ('0' &lt;= *p &amp;&amp; *p &lt;= '9') v = *p - '0'; return 10 * v + *++p - '0'; } //analog void drawClockHands(uint8_t h,uint8_t m,uint8_t s){ // Pre-compute hand degrees, x &amp; y coords for a fast screen update sdeg = s * 6; // 0-59 -&gt; 0-354 mdeg = m * 6 + sdeg * 0.01666667; // 0-59 -&gt; 0-360 - includes seconds hdeg = h * 30 + mdeg * 0.0833333; // 0-11 -&gt; 0-360 - includes minutes and seconds hx = cos((hdeg-90)*scosConst); hy = sin((hdeg-90)*scosConst); mx = cos((mdeg-90)*scosConst); my = sin((mdeg-90)*scosConst); sx = cos((sdeg-90)*scosConst); sy = sin((sdeg-90)*scosConst); // Erase just old hand positions display.drawLine(ohx, ohy, ccenterx+1, ccentery+1, BLACK); display.drawLine(omx, omy, ccenterx+1, ccentery+1, BLACK); display.drawLine(osx, osy, ccenterx+1, ccentery+1, BLACK); // Draw new hand positions display.drawLine(hx*(cradius-20)+ccenterx+1, hy*(cradius-20)+ccentery+1, ccenterx+1, ccentery+1, WHITE); display.drawLine(mx*(cradius-8)+ccenterx+1, my*(cradius-8)+ccentery+1, ccenterx+1, ccentery+1, WHITE); display.drawLine(sx*(cradius-8)+ccenterx+1, sy*(cradius-8)+ccentery+1, ccenterx+1, ccentery+1, RED); display.fillCircle(ccenterx+1, ccentery+1, 3, RED); // Update old x&amp;y coords osx = sx*(cradius-8)+ccenterx+1; osy = sy*(cradius-8)+ccentery+1; omx = mx*(cradius-8)+ccenterx+1; omy = my*(cradius-8)+ccentery+1; ohx = hx*(cradius-20)+ccenterx+1; ohy = hy*(cradius-20)+ccentery+1; } void FaceClock(){ display.clearScreen(); display.setTextColor(WHITE, BLACK); osx = ccenterx; osy = ccentery; omx = ccenterx; omy = ccentery; ohx = ccenterx; ohy = ccentery; drawClockFace();// Draw clock face } void drawSynchron() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(WHITE); display.println(utf8(" Clock")); display.setTextSize(1); display.setCursor(2,68); display.setTextColor(WHITE); display.println(utf8("synchronization...")); } void drawWiFi() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(RED); display.println(utf8("Connection to Wi-Fi")); } void drawBlynk() { display.clearScreen(); display.setTextSize(2); display.setCursor(2,48); display.setTextColor(RED); display.println(utf8("Connection to Blynk")); } void mailer() { // wait for WiFi connection if((WiFiMulti.run() == WL_CONNECTED)) { HTTPClient http; Serial.print("[HTTP] begin...\n"); http.begin("http://skorovoda.in.ua/php/wst41.php?mymail="+String(address)+"&amp;t="+String(t) +"&amp;h="+String(h)+"&amp;co2="+String(co2)+"&amp;ID="+String(ESP.getChipId())); Serial.print("[HTTP] GET...\n"); // start connection and send HTTP header int httpCode = http.GET(); // httpCode will be negative on error if(httpCode &gt; 0) { // HTTP header has been send and Server response header has been handled Serial.printf("[HTTP] GET... code: %d\n", httpCode); // file found at server if(httpCode == HTTP_CODE_OK) { String payload = http.getString(); Serial.println(payload); } } else { Serial.printf("[HTTP] GET... failed, error: %s\n", http.errorToString(httpCode).c_str()); } http.end(); } } //callback notifying the need to save config void saveConfigCallback() { Serial.println("Should save config"); shouldSaveConfig = true; } void factoryReset() { Serial.println("Resetting to factory settings"); wifiManager.resetSettings(); SPIFFS.format(); ESP.reset(); } void printString(String str) { Serial.println(str); } bool loadConfigS() { Blynk.config(address); Serial.print("e-mail: "); Serial.println( address ); Blynk.config(tZ); Serial.print("T_Zone: "); Serial.println( tZ ); Blynk.config(Tmx); Serial.print("T max: "); Serial.println( Tmx ); Blynk.config(Cmx); Serial.print("CO2 max: "); Serial.println( Cmx ); Blynk.config(Tmn); Serial.print("T min: "); Serial.println( Tmn ); Blynk.config(Hmn); Serial.print("H min: "); Serial.println( Hmn ); Blynk.config(timeSW); Serial.print("Time Summer/Winter: "); Serial.println( timeSW ); Blynk.config(formFS); Serial.print("format FS: "); Serial.println( formFS ); Blynk.config(blynk_token, "blynk-cloud.com", 8442); Serial.print("token: " ); Serial.println( blynk_token ); } bool loadConfig() { Serial.println("Load config..."); File configFile = SPIFFS.open("/config.json", "r"); if (!configFile) { Serial.println("Failed to open config file"); return false; } size_t size = configFile.size(); if (size &gt; 1024) { Serial.println("Config file size is too large"); return false; } // Allocate a buffer to store contents of the file. std::unique_ptr&lt;char[]&gt; buf(new char[size]); // We don't use String here because ArduinoJson library requires the input // buffer to be mutable. If you don't use ArduinoJson, you may as well // use configFile.readString instead. configFile.readBytes(buf.get(), size); StaticJsonBuffer&lt;200&gt; jsonBuffer; JsonObject &amp;json = jsonBuffer.parseObject(buf.get()); if (!json.success()) { Serial.println("Failed to parse config file"); return false; } // Save parameters strcpy(blynk_token, json["blynk_token"]); strcpy(address, json["address"]); strcpy(tZ, json["tZ"]); strcpy(Tmx, json["Tmx"]); strcpy(Cmx, json["Cmx"]); strcpy(Tmn, json["Tmn"]); strcpy(Hmn, json["Hmn"]); strcpy(timeSW, json["timeSW"]); strcpy(formFS, json["formFS"]); } void configModeCallback (WiFiManager *wifiManager) { String url {"http://192.168.4.1"}; printString("Connect to WiFi:"); printString("net: " + ssid); printString("pw: "+ pass); printString("Open browser:"); printString(url); printString("to setup device"); drawConnectionDetails(); } void setupWiFi() { //set config save notify callback wifiManager.setSaveConfigCallback(saveConfigCallback); // Custom parameters WiFiManagerParameter custom_blynk_token("blynk_token", "Blynk token", blynk_token, 34); wifiManager.addParameter(&amp;custom_blynk_token); WiFiManagerParameter custom_address("address", "E-mail", address, 64); wifiManager.addParameter(&amp;custom_address); WiFiManagerParameter custom_tZ("tZ", "Time Zone", tZ, 5); wifiManager.addParameter(&amp;custom_tZ); WiFiManagerParameter custom_Tmn("Tmn", "T min", Tmn, 5); wifiManager.addParameter(&amp;custom_Tmn); WiFiManagerParameter custom_Tmx("Tmx", "T max", Tmx, 5); wifiManager.addParameter(&amp;custom_Tmx); WiFiManagerParameter custom_Cmx("Cmx", "C max", Cmx, 7); wifiManager.addParameter(&amp;custom_Cmx); WiFiManagerParameter custom_Hmn("Hmn", "H min", Hmn, 5); wifiManager.addParameter(&amp;custom_Hmn); WiFiManagerParameter custom_timeSW("timeSW", "Time Summer(1)/Winter(0)", timeSW, 4); wifiManager.addParameter(&amp;custom_timeSW); WiFiManagerParameter custom_formFS("formFS", "formating FS", formFS, 4); wifiManager.addParameter(&amp;custom_formFS); wifiManager.setAPCallback(configModeCallback); wifiManager.setTimeout(60); if (!wifiManager.autoConnect(ssid.c_str(), pass.c_str())) { md = 2; Serial.println("mode OffLINE :("); loadConfigS(); } //save the custom parameters to FS if (shouldSaveConfig) { Serial.println("saving config"); DynamicJsonBuffer jsonBuffer; JsonObject &amp;json = jsonBuffer.createObject(); json["blynk_token"] = custom_blynk_token.getValue(); json["address"] = custom_address.getValue(); json["tZ"] = custom_tZ.getValue(); json["Tmx"] = custom_Tmx.getValue(); json["Cmx"] = custom_Cmx.getValue(); json["Tmn"] = custom_Tmn.getValue(); json["Hmn"] = custom_Hmn.getValue(); json["timeSW"] = custom_timeSW.getValue(); json["formFS"] = custom_formFS.getValue(); File configFile = SPIFFS.open("/config.json", "w"); if (!configFile) { Serial.println("failed to open config file for writing"); } json.printTo(Serial); json.printTo(configFile); configFile.close(); //end save } //if you get here you have connected to the WiFi Serial.println("WiFi connected"); Serial.print("IP address: "); Serial.println(WiFi.localIP()); } void connectBlynk(){ if(String(blynk_token)== "Blynk token"){ blnk = 0; Serial.println("! Off Blynk!"); } else { Serial.println("Connecting to blynk..."); while (Blynk.connect() == false) { delay(500); Serial.println("Connecting to blynk..."); } } } void sendToBlynk(){ Blynk.virtualWrite(V1, t); Blynk.virtualWrite(V2, h); Blynk.virtualWrite(V3, co2); Blynk.virtualWrite(V5, hic); } void formatFS(){ SPIFFS.format(); SPIFFS.begin(); } void setup() { Serial.begin(115200); display.begin(); // Init filesystem if (!SPIFFS.begin()) { Serial.println("Failed to mount file system"); ESP.reset(); } md = 1; // Setup WiFi drawWiFi(); //"Connecting to Wi-Fi..." setupWiFi(); if(md == 1){ // Load configuration if (!loadConfig()) { Serial.println("Failed to load config"); // factoryReset(); } else { Serial.println("Config loaded"); } Blynk.config(address); Serial.print("e-mail: "); Serial.println( address ); Blynk.config(tZ); Serial.print("T_Zone: "); Serial.println( tZ ); Blynk.config(Tmx); Serial.print("T max: "); Serial.println( Tmx ); Blynk.config(Cmx); Serial.print("CO2 max: "); Serial.println( Cmx ); Blynk.config(Tmn); Serial.print("T min: "); Serial.println( Tmn ); Blynk.config(Hmn); Serial.print("H min: "); Serial.println( Hmn ); Blynk.config(timeSW); Serial.print("Time Summer/Winter: "); Serial.println( timeSW ); Blynk.config(formFS); Serial.print("format FS: "); Serial.println( formFS ); Blynk.config(blynk_token, "blynk-cloud.com", 8442); Serial.print("token: " ); Serial.println( blynk_token ); Tmax = atof (Tmx); Cmax = atof (Cmx); Tmin = atof (Tmn); Hmin = atof (Hmn); tZone = atof (tZ); timeSummerWinter = atof (timeSW); formatingFS = atof (formFS); drawSynchron(); synchronClock(); connectBlynk(); FaceClock(); if (formatingFS == 1) { formatFS(); } } else if(md == 2) { Tmax = atof (Tmx); Cmax = atof (Cmx); Tmin = atof (Tmn); Hmin = atof (Hmn); tZone = atof (tZ); timeSummerWinter = atof (timeSW); formatingFS = atof (formFS); synchronClockA(); FaceClock(); if (formatingFS == 1) { formatFS(); } } } void loop() { if (md == 2) Serial.println(":( OffLINE"); else if (md == 1) Serial.println(":) OnLINE"); sendMeasurements(); draw(); Clock(); drawClockHands(hh,mm,ss); if (ml &gt;= 480000) ml = 0; //  if ((ml &gt;= 20000) and ((t &gt; Tmax) or (co2 &gt; Cmax) or (t &lt; Tmin) or (h &lt; Hmin))) { mailer(); ml = 0; } Blynk.run(); if (bl &gt; 210){ // 30 sec sendToBlynk(); Serial.println("   Blynk"); bl = 0; } bl++; ml++; delay(100); t_old = t; hic_old = hic; h_old = h; co2_old = co2; Serial.println(" "); }</span></span></span></span></code> </pre> </div></div><br><p>  Si al menos uno de los par√°metros de aire est√° fuera de los umbrales establecidos, el dispositivo env√≠a un mensaje de correo electr√≥nico sobre los siguientes contenidos aproximadamente una vez por hora: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sb/s7/e5/sbs7e5g0boyq3gqvnyos8vhgpic.png"></a> </p><br><p>  Los mensajes de correo electr√≥nico se env√≠an mediante script PHP.  El script se carga en mi servidor de correo.  Ser√° necesario si planea enviar mensajes desde otro recurso. </p><br><div class="spoiler">  <b class="spoiler_title">script php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">//  - http://skorovoda.in.ua/php/aqm42.php?mymail=my_login@my.site.net&amp;t=22.2&amp;h=55&amp;co2=666 $EMAIL=0; $TEMPER=0; $vlaga=0; $carbon=0; $device=0; $EMAIL=$_GET["mymail"]; $device=$_GET["ID"]; echo $EMAIL; $TEMPER=$_GET["t"]; $vlaga=$_GET["h"]; $carbon=$_GET["co2"]; $mdate = date("H:i dmy"); echo &lt;&lt;&lt;END &lt;p&gt;: $TEMPER ¬∞&lt;p&gt; &lt;p&gt;: $vlaga %&lt;p&gt; &lt;p&gt;  : $carbon ppm&lt;p&gt; &lt;p&gt;--------------------&lt;p&gt; &lt;p&gt; ‚Ññ: $device&lt;p&gt; END; echo &lt;&lt;&lt;END &lt;p&gt;$mdate&lt;/p&gt; END; mail($EMAIL, "Air Quality Monitor " .$device. " v.051018","       ‚Ññ" .$device. " .        (,     )      . === : ".$TEMPER."¬∞C === ".": ".$vlaga."% === "."  : ".$carbon." ppm === "." ! === , : ".$mdate,"From: my_sensors@air-monitor.info \n") </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> </div></div><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/8w/7n/el/8w7nelwjfe3b2wumssuerp3o3pm.png"></div><br><p>  Enciende el monitor. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/75/wk/lw/75wklw7on-_tir_swognf_fsmoq.png"></div><br><p>  El dispositivo elev√≥ el punto de acceso am180206.  Encontramos este punto en la lista de redes disponibles y nos conectamos, la contrase√±a est√° en la pantalla.  Intente conectarse a este punto en un minuto y medio, de lo contrario, el monitor pasar√° autom√°ticamente al modo de bater√≠a.  Acerca del modo sin conexi√≥n: un poco m√°s tarde.  Luego abra la p√°gina del navegador http://192.168.4.1. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/0x/xs/8d/0xxs8da7p7nxulfkzh3c6k4ysvw.png"></div><br><p>  Haga clic en el bot√≥n <em>Configurar WiFi (sin escaneo)</em> .  Se abrir√° una p√°gina con el formulario de configuraci√≥n del termostato: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/u6/k_/qn/u6k_qn1o6venw84_jnfvrq5bwe4.png"></div><br><p>  Indique en el formulario el nombre y la contrase√±a de su red dom√©stica, la clave de identificaci√≥n BLynk, su correo electr√≥nico, zona horaria, horario de verano / invierno, as√≠ como los valores umbral de temperatura, humedad y contenido de CO2. </p><br><p>  Al elegir los valores de umbral para los par√°metros del aire, gu√≠ese por los indicadores que encontr√© en Internet: </p><br><p>  1. Temperatura confortable en la noche durante el sue√±o 19 ... 21 ¬∞ C, durante el d√≠a - 22 ... 23 ¬∞ C. </p><br><p>  2. La humedad relativa √≥ptima en la estaci√≥n fr√≠a se considera humedad del 30 ... 45%, y en la c√°lida - 30 ... 60%.  Indicadores m√°ximos de humedad m√°xima: en invierno no debe exceder el 60%, y en verano - 65%. </p><br><p>  3. El nivel m√°ximo de di√≥xido de carbono en las instalaciones no debe exceder 1000 ppm.  El nivel recomendado para dormitorios, habitaciones infantiles: no m√°s de 600 ppm.  La marca de 1400 ppm durante mucho tiempo es el l√≠mite del contenido de CO2 permitido en la habitaci√≥n.  Si hay m√°s, la calidad del aire se considera baja. </p><br><p>  El campo <em>e-mai</em> se puede dejar en blanco.  Luego, se perder√° la oportunidad de recibir cartas por correo electr√≥nico sobre la salida de par√°metros a√©reos m√°s all√° de los valores l√≠mite.  Sin la clave Blynk ingresada, perder√° la capacidad de recibir informaci√≥n sobre los par√°metros del aire a distancia.  Sin embargo, el monitor no se "perder√°" si los campos con los valores l√≠mite de los par√°metros del aire permanecen vac√≠os. </p><br><p>  Rellene sin dudar todos los campos del formulario con n√∫meros en formato de coma flotante, por ejemplo, la zona horaria es <em>2.0</em> .  El boceto proporciona la conversi√≥n posterior de n√∫meros al formato deseado. </p><br><p>  Despu√©s de guardar la configuraci√≥n en la memoria ESP8266 (bot√≥n <em>Guardar</em> ), el monitor se conectar√° a la red y comenzar√° a funcionar. </p><br><p>  Considere la imagen en la pantalla. </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/d3/b-/nrd3b-zotfdmjlxuo4pxlsg98c0.png"></div><br><p>  La fecha, la hora, la temperatura medida, el contenido de CO2 y la humedad del aire se explican por s√≠ mismas.  Aclarar√© si los par√°metros del aire van m√°s all√° de los l√≠mites establecidos, entonces su visualizaci√≥n en la pantalla cambiar√° de color verde a rojo. </p><br><p>  La letra "B" sobre un fondo rojo indica que el monitor est√° funcionando sin conectarse a Blynk, y si aparece la letra "A", la energ√≠a desapareci√≥ y no hab√≠a Wi-Fi en el momento en que apareci√≥ (el dispositivo se desconect√≥). </p><br><p>  En general, la aparici√≥n de color rojo en la pantalla deber√≠a alertar: hay desviaciones del funcionamiento normal del dispositivo. </p><br><p>  En la esquina inferior derecha de la pantalla vemos el √≠ndice de calor (√≠ndice de calor, humindex). </p><br><p>  <em>‚ÄúHumidex es una cantidad adimensional basada en el punto de roc√≠o.</em>  <em>Este √≠ndice es ampliamente utilizado en informes meteorol√≥gicos canadienses en el verano.</em> <em><br></em>  <em>Seg√∫n el Servicio Meteorol√≥gico de Canad√°, los valores de Humidex por encima de 30 causan algunas molestias, por encima de 40 causan grandes molestias y un valor por encima de 45 es peligroso.</em>  <em>Si humidex alcanza 54, el golpe de calor es inevitable.</em>  <em>El viento no tiene en cuenta este √≠ndice ".</em>  (Wikipedia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">humidex</a> ). </p><br><p>  Debe aclararse que el √≠ndice de calor se calcula solo para temperaturas relativamente altas, cuando la temperatura del aire medida es superior a 21 ¬∞ C.  Figurativamente, el √≠ndice de calor es la temperatura percibida en un d√≠a caluroso de verano sin viento. <br></p><br><p>  Seg√∫n la tabla del mismo art√≠culo en Wikipedia, la temperatura medida de 25 ¬∞ C a una humedad del 30% se siente como 24 ¬∞ C, a 50% - 28 ¬∞ C, y a 90% - 35 ¬∞ C (10 ¬∞ C m√°s que el term√≥metro).  En el interior, este indicador puede reducirse organizando una corriente de aire o encendiendo el ventilador.  El aire acondicionado se encender√° autom√°ticamente si configura la temperatura del aire acondicionado a no m√°s de 25 ¬∞ C.  El √≠ndice de calor, en mi opini√≥n, es un par√°metro m√°s relevante de la calidad del aire que, por ejemplo, la presi√≥n, en la que no podemos influir de ninguna manera. </p><br><p>  El sensor DHT22, como el DHT11, junto con el "menos" - baja precisi√≥n de la medici√≥n de humedad tiene un "plus" innegable: el bus de datos de este sensor tiene informaci√≥n sobre el √≠ndice de calor.  Aprovech√© este "plus" y mostr√© el √≠ndice de calor en la pantalla del dispositivo. <br></p><br><p>  Hay muchas quejas en Internet sobre la baja precisi√≥n del DHT22.  Para aquellos que est√°n decididos a negarse a usar este sensor en sus proyectos, les pido que busquen sensores de temperatura y humedad m√°s modernos HTU21D, Si7021 o SHT21. <br></p><br><p>  Es hora de lanzar la aplicaci√≥n Blynk en su tel√©fono inteligente. </p><br><p>  Configura tu aplicaci√≥n.  Variables para Blynk (no buscarlas en el boceto): temperatura - <em>V1</em> , humedad - <em>V2</em> , contenido de CO2 - <em>V3</em> , √≠ndice de calor - <em>V5</em> . </p><br><p>  En mi tel√©fono inteligente, la interfaz de Blynk'a se ve as√≠: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/dw/3e/zd/dw3ezdbdzpghvmnmsmt6lsazvia.png"></div><br><p>  El gr√°fico muestra la temperatura medida (amarillo), la humedad (azul), el √≠ndice de calor (p√∫rpura).  El primer pico en el gr√°fico es el calentamiento del sensor de presi√≥n-humedad en la palma de la mano: la curva del √≠ndice de calor se encuentra por encima de la curva de temperatura.  El segundo pico es el calentamiento del sensor con un secador de pelo.  La humedad del aire disminuye cuando el sensor se calienta con un secador de pelo, y la curva del √≠ndice de calor en algunas √°reas se repite o por debajo de la l√≠nea de temperatura.  (ver llamada). </p><br><p>  No se preocupe si la l√≠nea de temperatura ha desaparecido en el gr√°fico: a temperaturas inferiores a 21 ¬∞ C, la curva de √≠ndice de calor repite la curva de temperatura medida. </p><br><p>  Ahora estamos probando el funcionamiento del sistema de notificaci√≥n por correo electr√≥nico.  Ingrese la direcci√≥n http del c√≥digo php-script en la barra de direcciones del navegador (en el script, la l√≠nea con la direcci√≥n http est√° comentada).  Si no se ha olvidado de especificar su correo electr√≥nico en la configuraci√≥n y en la ventana del navegador (informaci√≥n, como en la imagen a continuaci√≥n), lo m√°s probable es que no haya problemas al recibir notificaciones.  La prueba es especialmente √∫til cuando transfiero un script php de mi servidor a otro. </p><br><p></p><p><img src="https://habrastorage.org/webt/lq/mc/8q/lqmc8qgoywmrc9t5ogsv3oravhk.png"></p><br><br><h2>  Conclusiones </h2><br><p>  No repetir√© lo que se ha hecho, pero me detendr√© en puntos ambiguos. </p><br><p>  L√≥gico, por ejemplo, es la pregunta "¬øPor qu√© est√° aqu√≠ el reloj?"  Se necesita un reloj de flecha para llenar la pantalla.  Aunque en la actualidad los relojes digitales est√°n integrados en casi todos los electrodom√©sticos, los anal√≥gicos tienen una ventaja: la escala de tiempo, gracias al dial, facilita la estimaci√≥n del tiempo de un evento.  No discutir√©, puedes hacerlo sin horas. </p><br><p>  En qu√© necesita trabajar: </p><br><p>  ‚Ä¢ Organice una fuente de alimentaci√≥n aut√≥noma para el monitor a partir de dos bater√≠as AA durante mucho tiempo, al menos un a√±o. </p><br><p>  ‚Ä¢ No vale la pena discutir la apariencia: aqu√≠ cada uno tiene su propia opini√≥n y posibilidades.  Por ejemplo, me gusta la opci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">avs24rus</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">utilizaba una pantalla de 7 "en un marco con impresi√≥n 3D como pantalla</a> . Puede reemplazar un marco costoso por uno barato de una baguette. Y en el modo de espera, visualice un paisaje, un retrato de su amada o una foto de ni√±os, tambi√©n tendr√° Marco de fotos original adem√°s. </p><br><p>  Si no es muy exigente en el aspecto est√©tico del problema, entonces quiz√°s algo similar le convenga: </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/webt/t9/mc/ad/t9mcadjmxmqqiseaztnhsj_odyw.png"></div><br><p>  <strong>Nota</strong>  Inicialmente, el monitor fue concebido como un dispositivo universal listo para usar en un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">termostato</a> .  Su versatilidad ha llevado a una complicaci√≥n injustificada del esquema.  Por lo tanto, luego rechac√© la posibilidad de usar la soluci√≥n de monitor en un termostato y edit√© la publicaci√≥n.  Las huellas de la versi√≥n anterior m√°s compleja del dispositivo permanecieron en los comentarios. </p><br><p>  Buena suerte </p><br><h2>  Mis marcadores sobre un tema de Habr </h2><br><p>  1. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Term√≥metro Wi-Fi en ESP8266 + DS18B20 por solo $ 4</a> </p><br><p>  2. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Monitor de aire dom√©stico compacto (CO2, temperatura, humedad, presi√≥n) con Wi-Fi y una interfaz m√≥vil</a> </p><br><p>  3. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Experiencia pr√°ctica con Blynk para un sensor de CO2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1</a> </p><br><p>  4. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Uso de la memoria de visualizaci√≥n SPI Flash para almacenar recursos gr√°ficos o mostrar una estaci√≥n meteorol√≥gica dom√©stica</a> </p><br><p>  5. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Medimos la concentraci√≥n de CO2 en el apartamento usando el MH-Z19</a> </p><br><p>  6. El <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lado oscuro de la MH-Z19</a> </p><br><p>  7. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Medimos la concentraci√≥n de CO2 en el apartamento usando el MH-Z19</a> </p><br><p>  Finalmente, gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@kumekay</a> por los valiosos consejos. <br>  La publicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"La experiencia pr√°ctica de usar Blynk para un sensor de CO2</a> me ayud√≥ a resolver el problema de volver a ingresar variables en la memoria ESP8622 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1 "</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@ a3x</a> .  Art√≠culo muy vers√°til! <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/442856/">https://habr.com/ru/post/442856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442840/index.html">Backend United 3: Jellied</a></li>
<li><a href="../442844/index.html">Kapitan al tim√≥n de Kubernetes</a></li>
<li><a href="../442846/index.html">Nuestra industria espacial. Una mirada a los problemas de la industria desde la perspectiva de un desarrollador ordinario</a></li>
<li><a href="../442852/index.html">Dell 6000 o hola desde 2005</a></li>
<li><a href="../442854/index.html">¬øC√≥mo hicimos el esquema del metro de Minsk?</a></li>
<li><a href="../442858/index.html">¬øHay demasiados elefantes en √Åfrica? C√≥mo la coexistencia pac√≠fica con las comunidades humanas puede ayudar en esto</a></li>
<li><a href="../442862/index.html">Prueba de participaci√≥n: Mirada interior</a></li>
<li><a href="../442864/index.html">¬øCu√°ntos a√±os tiene tu se√±or?</a></li>
<li><a href="../442866/index.html">La IA entrenada durante d√©cadas de experimentaci√≥n culinaria crea nuevos platos.</a></li>
<li><a href="../442868/index.html">Una breve excursi√≥n a los sistemas de enfriamiento del centro de datos. Pros y contras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>