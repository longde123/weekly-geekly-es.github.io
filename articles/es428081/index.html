<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìä üçÑ üë©‚Äçüè≠ Uso de RxJS en React Development para administrar el estado de la aplicaci√≥n üôÉ üõå üïµüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El autor del material, cuya traducci√≥n publicamos hoy, dice que aqu√≠ quiere demostrar el proceso de desarrollo de una aplicaci√≥n React simple que util...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uso de RxJS en React Development para administrar el estado de la aplicaci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/428081/">  El autor del material, cuya traducci√≥n publicamos hoy, dice que aqu√≠ quiere demostrar el proceso de desarrollo de una aplicaci√≥n React simple que utiliza RxJS.  Seg√∫n √©l, √©l no es un experto en RxJS, ya que √©l mismo est√° estudiando esta biblioteca y no rechaza la ayuda de personas conocedoras.  Su objetivo es llamar la atenci√≥n de la audiencia sobre formas alternativas de crear aplicaciones React, para inspirar al lector a hacer una investigaci√≥n independiente.  Este material no se puede llamar una introducci√≥n a RxJS.  Aqu√≠ se mostrar√° una de las muchas formas de usar esta biblioteca en el desarrollo de React. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/e85/553/cfd/e85553cfdb8db819c496c7d6ae9dad2b.png" alt="imagen"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Como empez√≥ todo</font> </h2><br>  Recientemente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mi cliente</a> me inspir√≥ a aprender sobre el uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxJS</a> para administrar el estado de las aplicaciones React.  Cuando audit√© el c√≥digo de la aplicaci√≥n para este cliente, quer√≠a saber mi opini√≥n sobre c√≥mo desarroll√≥ la aplicaci√≥n, dado que antes usaba exclusivamente el estado React local.  El proyecto lleg√≥ a un punto en el que no era razonable confiar √∫nicamente en React.  Primero, hablamos sobre el uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Redux o MobX</a> como un mejor medio para administrar el estado de su aplicaci√≥n.  Mi cliente cre√≥ un prototipo para cada una de estas tecnolog√≠as.  Pero no se detuvo en estas tecnolog√≠as, creando un prototipo de una aplicaci√≥n React que usa RxJS.  A partir de ese momento, nuestra conversaci√≥n se volvi√≥ mucho m√°s interesante. <br><br>  La aplicaci√≥n en cuesti√≥n era una plataforma de negociaci√≥n de criptomonedas.  Ten√≠a muchos widgets cuyos datos se actualizaron en tiempo real.  Los desarrolladores de esta aplicaci√≥n, entre otros, tuvieron que resolver las siguientes tareas dif√≠ciles: <br><br><ul><li>  Administre m√∫ltiples solicitudes de datos (as√≠ncronas). </li><li>  Actualizaci√≥n en tiempo real de una gran cantidad de widgets en el panel de control. </li><li>  La soluci√≥n al problema de los widgets y la conectividad de datos, ya que algunos widgets necesitaban datos no solo de algunas fuentes especiales, sino tambi√©n de otros widgets. </li></ul><br>  Como resultado, las principales dificultades que enfrentaron los desarrolladores no estaban relacionadas con la biblioteca React en s√≠, y adem√°s, podr√≠a ayudarlos en esta √°rea.  El principal problema era hacer que los mecanismos internos del sistema funcionaran correctamente, los que vinculaban los datos de la criptomoneda y los elementos de la interfaz creados por las herramientas React.  Fue en esta √°rea que las capacidades de RxJS resultaron ser muy √∫tiles, y el prototipo que me mostraron parec√≠a muy prometedor. <br><br><h2>  <font color="#3AC1EF">Usando RxJS en React</font> </h2><br>  Supongamos que tenemos una aplicaci√≥n que, despu√©s de realizar algunas acciones locales, realiza solicitudes a una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API de terceros</a> .  Te permite buscar por art√≠culo.  Antes de ejecutar la solicitud, necesitamos obtener el texto que se utiliza para formar esta solicitud.  En particular, nosotros, usando este texto, formamos una URL para acceder a la API.  Aqu√≠ est√° el c√≥digo del componente React que implementa esta funcionalidad <br><br><pre><code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ query, onChangeQuery }</span></span></span><span class="hljs-function">) =&gt;</span></span> (  <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">React with RxJS</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag">      </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">      </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{query}</span></span></span></span><span class="xml"><span class="hljs-tag">      </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onChangeQuery(event.target.value)}    /&gt;    </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{`http://hn.algolia.com/api/v1/search?query=${query}`}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); export default App;</span></span></code> </pre> <br>  Este componente carece de un sistema de gesti√≥n de estado.  El estado de la propiedad de <code>query</code> no se almacena en ning√∫n lado, la funci√≥n <code>onChangeQuery</code> tampoco actualiza el estado.  En el enfoque convencional, dicho componente est√° equipado con un sistema de gesti√≥n estatal local.  Se ve as√≠: <br><br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ constructor(props) {   <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {     query: '',   }; } onChangeQuery = query =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ query }); }; render() {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (     &lt;div&gt;       &lt;h1&gt;<span class="hljs-type"><span class="hljs-type">React</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">RxJS</span></span>&lt;/h1&gt;       &lt;input         <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"text"</span></span>         value={<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.query}         onChange={event =&gt;           <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.onChangeQuery(event.target.value)         }       /&gt;       &lt;p&gt;{`http:<span class="hljs-comment"><span class="hljs-comment">//hn.algolia.com/api/v1/search?query=${         this.state.query       }`}&lt;/p&gt;     &lt;/div&gt;   ); } } export default App;</span></span></code> </pre> <br>  Sin embargo, este no es el enfoque del que vamos a hablar aqu√≠.  En cambio, queremos establecer un sistema de gesti√≥n de estado de la aplicaci√≥n utilizando RxJS.  Veamos c√≥mo hacer esto usando Componente de orden superior (HOC). <br><br>  Si lo desea, puede implementar una l√≥gica similar en el componente de su <code>App</code> , pero lo m√°s probable es que, en alg√∫n momento de su trabajo en la aplicaci√≥n, decida dise√±ar dicho componente en forma de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">HOC</a> que sea adecuado para su reutilizaci√≥n. <br><br><h2>  <font color="#3AC1EF">Componentes React y RxJS de primer orden</font> </h2><br>  Descubriremos c√≥mo administrar el estado de las aplicaciones React utilizando RxJS, utilizando un componente de orden superior para este prop√≥sito.  En cambio, uno podr√≠a implementar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la plantilla de</a> accesorios de renderizado.  Como resultado, si no desea crear un componente de orden superior para este prop√≥sito, puede utilizar los componentes de orden superior observables <a href="">Recompose</a> with <code>mapPropsStream()</code> y <code>componentFromStream()</code> .  En esta gu√≠a, sin embargo, haremos todo por nuestra cuenta. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> withObservableStream = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...</span></span></span><span class="hljs-function">) =&gt;</span></span> Component =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   componentDidMount() {}   componentWillUnmount() {}   render() {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">       &lt;Component {...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.props} {...</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.state} </span></span><span class="hljs-regexp"><span class="hljs-function"><span class="hljs-params"><span class="hljs-regexp">/&gt;     );   } }; }; const App = ({ query, onChangeQuery }) =&gt; ( &lt;div&gt;   &lt;h1&gt;React with RxJS&lt;/</span></span></span></span><span class="hljs-function"><span class="hljs-params">h1&gt;   &lt;input     type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"text"</span></span></span></span><span class="hljs-function"><span class="hljs-params">     value={query}     onChange={event =&gt; onChangeQuery(event.target.value</span></span></span><span class="hljs-function">)}   /&gt;   &lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p</span></span></span><span class="hljs-function">&gt;{`</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">http</span></span></span><span class="hljs-function">://</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">hn</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">algolia</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">com</span></span></span><span class="hljs-function">/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">api</span></span></span><span class="hljs-function">/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">v1</span></span></span><span class="hljs-function">/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">search</span></span></span><span class="hljs-function">?</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">=</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$</span></span></span><span class="hljs-function">{</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">}`}&lt;/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p</span></span></span><span class="hljs-function">&gt; &lt;/</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">div</span></span></span><span class="hljs-function">&gt; ); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">export</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">default</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">withObservableStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...</span></span></span><span class="hljs-function">)(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">App</span></span></span><span class="hljs-function">);</span></span></code> </pre> <br>  Mientras que el componente de orden superior RxJS no realiza ninguna acci√≥n.  Solo transfiere su propio estado y propiedades al componente de entrada, que se planea expandir con su ayuda.  Como puede ver, al final, un componente de orden superior estar√° involucrado en la gesti√≥n del estado de React.  Sin embargo, este estado se obtendr√° del flujo observado.  Antes de comenzar a implementar HOC y usarlo con el componente de la <code>App</code> , necesitamos instalar RxJS: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> rxjs <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre> <br>  Ahora comencemos a usar un componente de orden superior e implementemos su l√≥gica: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { BehaviorSubject } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; ... const App = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ query, onChangeQuery }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">React with RxJS</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{query}</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onChangeQuery(event.target.value)}   /&gt;   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{`http://hn.algolia.com/api/v1/search?query=${query}`}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ); const query$ = new BehaviorSubject({ query: 'react' }); export default withObservableStream( query$, {   onChangeQuery: value =&gt; query$.next({ query: value }), } )(App);</span></span></code> </pre> <br>  El componente de la <code>App</code> s√≠ no cambia.  Acabamos de pasar dos argumentos a un componente de orden superior.  Los describimos: <br><br><ul><li>  Objeto observado  El argumento de <code>query</code> es un objeto observable que tiene un valor inicial, pero, adem√°s, devuelve, con el tiempo, nuevos valores (ya que este es un <code>BehaviorSubject</code> ).  Cualquiera puede suscribirse a este objeto observable.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Esto</a> es lo que dice la documentaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxJS</a> sobre los objetos de tipo <code>BehaviorSubject</code> : "Una de las opciones para los objetos <code>Subject</code> es un <code>BehaviorSubject</code> que utiliza el concepto de" valor actual ".  Almacena el √∫ltimo valor pasado a sus suscriptores, y cuando un nuevo observador se suscribe a √©l, inmediatamente recibe este "valor actual" del <code>BehaviorSubject</code> .  Tales objetos son muy adecuados para presentar datos, nuevas porciones de las cuales aparecen con el tiempo ". </li><li>  El sistema para emitir nuevos valores para el objeto observado (disparador).  La funci√≥n <code>onChangeQuery()</code> , pasada a trav√©s del HOC al componente de la <code>App</code> , es una funci√≥n regular que pasa el siguiente valor al objeto observado.  Esta funci√≥n se transfiere en el objeto, ya que puede ser necesario transferir a un componente de orden superior varias funciones que realizan ciertas acciones con los objetos observados. </li></ul><br>  Despu√©s de crear el objeto observado y suscribirse a √©l, el flujo de la solicitud deber√≠a funcionar.  Sin embargo, hasta ahora, el componente de orden superior en s√≠ mismo nos parece un cuadro negro.  Nos damos cuenta de eso: <br><br><pre> <code class="hljs scala">const withObservableStream = (observable, triggers) =&gt; <span class="hljs-type"><span class="hljs-type">Component</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   componentDidMount() {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscription = observable.subscribe(newState =&gt;       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ ...newState }),     );   }   componentWillUnmount() {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscription.unsubscribe();   }   render() {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (       &lt;<span class="hljs-type"><span class="hljs-type">Component</span></span> {...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props} {...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state} {...triggers} /&gt;     );   } }; };</code> </pre> <br>  Un componente de orden superior recibe un objeto observable y un objeto con disparadores (quiz√°s este objeto que contiene funciones se puede llamar un t√©rmino m√°s exitoso del l√©xico RxJS), representado en la firma de la funci√≥n. <br><br>  Los disparadores solo se pasan a trav√©s del HOC al componente de entrada.  Es por eso que el componente de la <code>App</code> recibe directamente la funci√≥n <code>onChangeQuery()</code> , que trabaja directamente con el objeto observado, pas√°ndole nuevos valores. <br><br>  El objeto observado utiliza el m√©todo del ciclo de vida del <code>componentDidMount()</code> para firmar y el m√©todo del <code>componentDidMount()</code> para darse de baja.  La cancelaci√≥n de la suscripci√≥n es necesaria para evitar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√©rdidas de memoria</a> .  En la suscripci√≥n del objeto observado, la funci√≥n solo env√≠a todos los datos entrantes de la secuencia al almac√©n de estado React local utilizando el <code>this.setState()</code> . <br><br>  Hagamos un peque√±o cambio en el componente de la <code>App</code> , que eliminar√° el problema que ocurre si el componente de orden superior no establece el valor inicial para la propiedad de <code>query</code> .  Si esto no se hace, entonces, al comienzo del trabajo, la propiedad de <code>query</code> ser√° <code>undefined</code> .  Gracias a este cambio, esta propiedad obtiene el valor predeterminado. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ query = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, onChangeQuery }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">React with RxJS</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{query}</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onChangeQuery(event.target.value)}   /&gt;   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{`http://hn.algolia.com/api/v1/search?query=${query}`}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> );</span></span></code> </pre> <br>  Otra forma de lidiar con este problema es establecer el estado inicial de la <code>query</code> en un componente de orden superior: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> withObservableStream = ( observable, triggers, initialState, ) =&gt; Component =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props) {     <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {       ...initialState,     };   }   componentDidMount() {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscription = observable.subscribe(newState =&gt;       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ ...newState }),     );   }   componentWillUnmount() {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscription.unsubscribe();   }   render() {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (       &lt;Component {...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props} {...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state} {...triggers} /&gt;     );   } }; }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = ({ query, onChangeQuery }) =&gt; ( ... ); export <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> withObservableStream( query$, {   onChangeQuery: value =&gt; query$.next({ query: value }), }, {   query: <span class="hljs-string"><span class="hljs-string">''</span></span>, } )(App);</code> </pre> <br>  Si prueba esta aplicaci√≥n ahora, el cuadro de entrada deber√≠a funcionar como se esperaba.  El componente de la <code>App</code> recibe del HOC, en forma de propiedades, solo el estado de la <code>query</code> y la funci√≥n <code>onChangeQuery</code> para cambiar el estado. <br><br>  La recuperaci√≥n y el cambio de estado se producen a trav√©s de objetos observables RxJS, a pesar del hecho de que se utiliza un almac√©n interno de estado React dentro del componente de orden superior.  No pude encontrar una soluci√≥n obvia al problema de la transmisi√≥n de datos desde una suscripci√≥n de objetos observados directamente a las propiedades del componente extendido ( <code>App</code> ).  Es por eso que tuve que usar el estado local de React en forma de una capa intermedia, que, adem√°s, es conveniente en t√©rminos de las causas de la nueva representaci√≥n.  Si conoce otra forma de lograr los mismos objetivos, puede compartirla en los comentarios. <br><br><h2>  <font color="#3AC1EF">Combinando objetos observados en React</font> </h2><br>  Creemos una segunda secuencia de valores, que, como la propiedad de <code>query</code> , se puede usar en el componente <code>App</code> .  M√°s tarde usaremos ambos valores, trabajando con ellos usando otro objeto observable. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SUBJECT = { <span class="hljs-attr"><span class="hljs-attr">POPULARITY</span></span>: <span class="hljs-string"><span class="hljs-string">'search'</span></span>, <span class="hljs-attr"><span class="hljs-attr">DATE</span></span>: <span class="hljs-string"><span class="hljs-string">'search_by_date'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> App = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ query = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject, onChangeQuery, onSelectSubject, }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">React with RxJS</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{query}</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onChange</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{event</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onChangeQuery(event.target.value)}   /&gt;   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     {Object.values(SUBJECT).map(value =&gt; (       </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">         </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{value}</span></span></span></span><span class="xml"><span class="hljs-tag">         </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> onSelectSubject(value)}         type="button"       &gt;         {value}       </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     ))}   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{`http://hn.algolia.com/api/v1/${subject}?query=${query}`}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> );</span></span></code> </pre> <br>  Como puede ver, el par√°metro <code>subject</code> se puede usar para refinar la solicitud al construir la URL utilizada para acceder a la API.  Es decir, los materiales se pueden buscar en funci√≥n de su popularidad o en la fecha de publicaci√≥n.  A continuaci√≥n, cree otro objeto observable que pueda usarse para cambiar el par√°metro <code>subject</code> .  Este observable se puede usar para asociar un componente de la <code>App</code> con un componente de orden superior.  De lo contrario, las propiedades pasadas al componente de la <code>App</code> no funcionar√°n. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { BehaviorSubject, combineLatest } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/index'</span></span>; ... const query$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject({ <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-string"><span class="hljs-string">'react'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subject$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(SUBJECT.POPULARITY); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> withObservableStream( combineLatest(subject$, query$, (subject, query) =&gt; ({   subject,   query, })), {   <span class="hljs-attr"><span class="hljs-attr">onChangeQuery</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> query$.next({ <span class="hljs-attr"><span class="hljs-attr">query</span></span>: value }),   <span class="hljs-attr"><span class="hljs-attr">onSelectSubject</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subject</span></span></span><span class="hljs-function"> =&gt;</span></span> subject$.next(subject), }, )(App);</code> </pre> <br>  El <code>onSelectSubject()</code> no es nuevo.  A trav√©s de un bot√≥n, se puede usar para cambiar entre dos estados <code>subject</code> .  Pero el objeto observado transferido a un componente de orden superior es algo nuevo.  Utiliza la funci√≥n <code>combineLatest()</code> de RxJS para combinar los √∫ltimos valores devueltos de dos (o m√°s) secuencias observadas.  Despu√©s de suscribirse al objeto observado, si se modifica alguno de los valores ( <code>query</code> o <code>subject</code> ), el suscriptor recibir√° ambos valores. <br><br>  Un complemento al mecanismo implementado por la funci√≥n <code>combineLatest()</code> es su √∫ltimo argumento.  Aqu√≠ puede establecer el orden de retorno de los valores generados por los objetos observados.  En nuestro caso, necesitamos que est√©n representados como un objeto.  Esto permitir√°, como antes, desestructurarlos en un componente de orden superior y escribirlos en el estado React local.  Como ya tenemos la estructura necesaria, podemos omitir el paso de envolver el objeto del objeto de <code>query</code> observado. <br><br><pre> <code class="hljs javascript">... const query$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subject$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(SUBJECT.POPULARITY); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> withObservableStream( combineLatest(subject$, query$, (subject, query) =&gt; ({   subject,   query, })), {   <span class="hljs-attr"><span class="hljs-attr">onChangeQuery</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> query$.next(value),   <span class="hljs-attr"><span class="hljs-attr">onSelectSubject</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subject</span></span></span><span class="hljs-function"> =&gt;</span></span> subject$.next(subject), }, )(App);</code> </pre> <br>  El objeto fuente, <code>{ query: '', subject: 'search' }</code> , as√≠ como todos los dem√°s objetos devueltos por el flujo combinado de objetos observados, son adecuados para desestructurarlos en un componente de orden superior y para escribir los valores correspondientes en el estado React local.  Despu√©s de actualizar el estado, como antes, se realiza la representaci√≥n.  Cuando inicie la aplicaci√≥n actualizada, deber√≠a poder cambiar ambos valores usando el campo de entrada y el bot√≥n.  Los valores modificados afectan la URL utilizada para acceder a la API.  Incluso si solo uno de estos valores cambia, el otro valor conserva su √∫ltimo estado, ya que la funci√≥n <code>combineLatest()</code> siempre combina los valores m√°s recientes emitidos por los flujos observados. <br><br><h2>  <font color="#3AC1EF">Axios y RxJS en React</font> </h2><br>  Ahora en nuestro sistema, la URL para acceder a la API se construye en base a dos valores de un objeto observable combinado, que incluye otros dos objetos observables.  En esta secci√≥n, utilizaremos la URL para cargar datos desde la API.  Es posible que pueda usar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sistema de carga de datos React</a> , pero cuando use objetos observables RxJS, debe agregar otra secuencia observable a nuestra aplicaci√≥n. <br><br>  Antes de comenzar a trabajar en el siguiente objeto observado, instale <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">axios</a> .  Esta es la biblioteca que usaremos para cargar datos de secuencias en el programa. <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> axios <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre> <br>  Ahora imagine que tenemos una serie de art√≠culos que el componente de la <code>App</code> deber√≠a generar.  Aqu√≠, como el valor del par√°metro predeterminado correspondiente, usamos una matriz vac√≠a, haciendo lo mismo que hicimos con otros par√°metros. <br><br><pre> <code class="hljs javascript">... const App = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ query = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject, stories = [], onChangeQuery, onSelectSubject, }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   ...   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{`http://hn.algolia.com/api/v1/${subject}?query=${query}`}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     {stories.map(story =&gt; (       </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{story.objectID}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">         </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{story.url</span></span></span></span><span class="xml"><span class="hljs-tag"> || </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">story.story_url</span></span></span></span><span class="xml"><span class="hljs-tag">}&gt;</span></span></span><span class="xml">           {story.title || story.story_title}         </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">       </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">     ))}   </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre> <br>  Para cada art√≠culo de la lista, se utiliza un valor de reserva debido al hecho de que la API a la que estamos accediendo no es uniforme.  Ahora, lo m√°s interesante, la implementaci√≥n de un nuevo objeto observable que es responsable de cargar datos en una aplicaci√≥n React que los visualizar√°. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { BehaviorSubject, combineLatest } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { flatMap, map } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; ... const query$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subject$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(SUBJECT.POPULARITY); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetch$ = combineLatest(subject$, query$).pipe( flatMap(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[subject, query]</span></span></span><span class="hljs-function">) =&gt;</span></span>   axios(<span class="hljs-string"><span class="hljs-string">`http://hn.algolia.com/api/v1/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${subject}</span></span></span><span class="hljs-string">?query=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${query}</span></span></span><span class="hljs-string">`</span></span>), ), map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> =&gt;</span></span> result.data.hits), ); ...</code> </pre> <br>  Un nuevo objeto observable es, nuevamente, una combinaci√≥n de <code>subject</code> y <code>query</code> observables, ya que, para construir la URL con la que accederemos a la API para cargar datos, necesitamos ambos valores.  En el m√©todo <code>pipe()</code> del objeto observado, podemos usar los llamados "operadores RxJS" para realizar ciertas acciones con los valores.  En este caso, asignamos dos valores que se colocan en la consulta, que axios usa para obtener el resultado.  Aqu√≠ usamos el operador <code>flatMap()</code> y no <code>map()</code> para acceder al resultado de la promesa resuelta con √©xito, y no a la promesa devuelta en s√≠.  Como resultado, despu√©s de suscribirse a este nuevo objeto observable, cada vez que se ingresa un nuevo <code>subject</code> o valor de <code>query</code> en el sistema desde otros objetos observables, se ejecuta una nueva <code>query</code> y el resultado est√° en la funci√≥n de suscripci√≥n. <br><br>  Ahora, nuevamente, podemos proporcionar un nuevo observable a un componente de orden superior.  Tenemos el √∫ltimo argumento para la funci√≥n <code>combineLatest()</code> nuestra disposici√≥n, esto hace posible <code>combineLatest()</code> directamente a una propiedad llamada <code>stories</code> .  Al final, esto representa c√≥mo estos datos ya se est√°n utilizando en el componente de la <code>App</code> . <br><br><pre> <code class="hljs lisp">export default withObservableStream( <span class="hljs-name"><span class="hljs-name">combineLatest</span></span>(   <span class="hljs-name"><span class="hljs-name">subject</span></span>$,   query$,   fetch$,   (<span class="hljs-name"><span class="hljs-name">subject</span></span>, query, stories) =&gt; ({     subject,     query,     stories,   }), ), {   onChangeQuery: value =&gt; query$.next(<span class="hljs-name"><span class="hljs-name">value</span></span>),   onSelectSubject: subject =&gt; subject$.next(<span class="hljs-name"><span class="hljs-name">subject</span></span>), }, )(<span class="hljs-name"><span class="hljs-name">App</span></span>)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  Aqu√≠ no hay disparador, ya que el objeto observado se activa indirectamente por otros dos flujos observados.  Cada vez que se cambia el valor en el campo de entrada ( <code>query</code> ) o se hace clic en el bot√≥n ( <code>subject</code> ), esto afecta al objeto de <code>fetch</code> observado, que contiene los √∫ltimos valores de ambas secuencias. <br><br>  Sin embargo, quiz√°s no necesitemos que cada vez que cambiemos el valor en el campo de entrada, esto afecte el objeto de <code>fetch</code> observado.  Adem√°s, no desear√≠amos que la <code>fetch</code> se vea afectada si el valor es una cadena vac√≠a.  Es por eso que podemos extender el objeto de <code>query</code> observable utilizando la instrucci√≥n de <code>debounce</code> , que elimina los cambios de consulta demasiado frecuentes.  Es decir, gracias a este mecanismo, un nuevo evento se acepta solo despu√©s de un tiempo predeterminado despu√©s del evento anterior.  Adem√°s, aqu√≠ utilizamos el operador de <code>filter</code> , que filtra los eventos de flujo si la cadena de <code>query</code> est√° vac√≠a. <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { BehaviorSubject, combineLatest, timer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { flatMap, map, debounce, filter } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/operators'</span></span>; ... const queryForFetch$ = query$.pipe( debounce(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> timer(<span class="hljs-number"><span class="hljs-number">1000</span></span>)), filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function"> =&gt;</span></span> query !== <span class="hljs-string"><span class="hljs-string">''</span></span>), ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fetch$ = combineLatest(subject$, queryForFetch$).pipe( flatMap(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[subject, query]</span></span></span><span class="hljs-function">) =&gt;</span></span>   axios(<span class="hljs-string"><span class="hljs-string">`http://hn.algolia.com/api/v1/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${subject}</span></span></span><span class="hljs-string">?query=</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${query}</span></span></span><span class="hljs-string">`</span></span>), ), map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function"> =&gt;</span></span> result.data.hits), ); ...</code> </pre> <br>  La declaraci√≥n <code>debounce</code> hace el trabajo de ingresar datos en el campo.  Sin embargo, cuando un bot√≥n hace clic en el valor del <code>subject</code> , la solicitud debe ejecutarse inmediatamente. <br><br>  Ahora, los valores iniciales para la <code>query</code> y el <code>subject</code> , que vemos cuando el componente de la <code>App</code> se muestra por primera vez, no son los mismos que los obtenidos a partir de los valores iniciales de los objetos observados: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> query$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(<span class="hljs-string"><span class="hljs-string">'react'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> subject$ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorSubject(SUBJECT.POPULARITY);</code> </pre> <br>  <code>subject</code> escribe en el <code>subject</code> , una cadena vac√≠a est√° en <code>query</code> .  Esto se debe al hecho de que fueron estos valores los que proporcionamos como par√°metros predeterminados para reestructurar la funci√≥n del componente de la <code>App</code> en la firma.  La raz√≥n de esto es porque necesitamos esperar la solicitud inicial ejecutada por el objeto <code>fetch</code> observable.  Como no s√© exactamente c√≥mo obtener valores inmediatamente de <code>query</code> observables y objetos <code>subject</code> en un componente de orden superior para escribirlos en un estado local, decid√≠ configurar nuevamente el estado inicial para el componente de orden superior. <br><br><pre> <code class="hljs scala">const withObservableStream = ( observable, triggers, initialState, ) =&gt; <span class="hljs-type"><span class="hljs-type">Component</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{   constructor(props) {     <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props);     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = {       ...initialState,     };   }   componentDidMount() {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscription = observable.subscribe(newState =&gt;       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ ...newState }),     );   }   componentWillUnmount() {     <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.subscription.unsubscribe();   }   render() {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (       &lt;<span class="hljs-type"><span class="hljs-type">Component</span></span> {...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props} {...<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state} {...triggers} /&gt;     );   } }; };</code> </pre> <br>  Ahora el estado inicial se puede proporcionar a un componente de orden superior como tercer argumento.  En el futuro, podemos eliminar la configuraci√≥n predeterminada para el componente de la <code>App</code> . <br><br><pre> <code class="hljs javascript">... const App = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ query, subject, stories, onChangeQuery, onSelectSubject, }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( ... ); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> withObservableStream( combineLatest(   subject$,   query$,   fetch$,   (subject, query, stories) =&gt; ({     subject,     query,     stories,   }), ), {   <span class="hljs-attr"><span class="hljs-attr">onSelectSubject</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subject</span></span></span><span class="hljs-function"> =&gt;</span></span> subject$.next(subject),   <span class="hljs-attr"><span class="hljs-attr">onChangeQuery</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function"> =&gt;</span></span> query$.next(value), }, {   <span class="hljs-attr"><span class="hljs-attr">query</span></span>: <span class="hljs-string"><span class="hljs-string">'react'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">subject</span></span>: SUBJECT.POPULARITY,   <span class="hljs-attr"><span class="hljs-attr">stories</span></span>: [], }, )(App);</code> </pre> <br>  Lo que me preocupa en este momento es que el estado inicial tambi√©n se establece en la declaraci√≥n de los objetos observados <code>query$</code> y <code>subject$</code> .  Este enfoque es propenso a errores, ya que la inicializaci√≥n de los objetos observados y el estado inicial del componente de orden superior comparten los mismos valores.  Me hubiera gustado m√°s si, en cambio, los valores iniciales se extrajeran de los objetos observados en un componente de orden superior para establecer el estado inicial.  Quiz√°s uno de los lectores de este material pueda compartir consejos en los comentarios sobre c√≥mo hacer esto. <br><br>  El c√≥digo para el proyecto de software que hicimos aqu√≠ se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  <font color="#3AC1EF">Resumen</font> </h2><br>  El objetivo principal de este art√≠culo es demostrar un enfoque alternativo para desarrollar aplicaciones React usando RxJS.  Esperamos que te haya dado algo para pensar.  A veces, Redux y MobX no son necesarios, pero quiz√°s en tales situaciones, RxJS sea justo lo que es adecuado para un proyecto espec√≠fico. <br><br>  <b>Estimados lectores!</b>  ¬øUtiliza RxJS cuando desarrolla aplicaciones React? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428081/">https://habr.com/ru/post/es428081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428069/index.html">Optimice el equilibrio de carga en la infraestructura de Veeam Backup & Replication</a></li>
<li><a href="../es428073/index.html">Rust 1.30 Lanzamiento</a></li>
<li><a href="../es428075/index.html">De todos modos, ¬°no puedes hacerlo! - Uso de interfaces e inyecci√≥n de dependencias para un dise√±o a largo plazo.</a></li>
<li><a href="../es428077/index.html">React.js: una gu√≠a para principiantes</a></li>
<li><a href="../es428079/index.html">Aplicaci√≥n de principios S√ìLIDOS para reaccionar al desarrollo de aplicaciones</a></li>
<li><a href="../es428083/index.html">Matriz de influencia de an√°lisis web: el sistema estrat√©gico de Avinash Koshik</a></li>
<li><a href="../es428085/index.html">Frontend contraataca: top 10 (?) HolyJS 2018 Piter informa</a></li>
<li><a href="../es428087/index.html">"Sin cerradura, o sin cerradura, esa es la pregunta" o "Un sue√±o saludable es peor que el r√°bano amargo"</a></li>
<li><a href="../es428089/index.html">"Calendario de prueba" para octubre. Comentarios: c√≥mo sucede</a></li>
<li><a href="../es428091/index.html">C√≥mo un estudiante interno cre√≥ el videojuego m√°s popular del mundo o el historial de juegos de Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>