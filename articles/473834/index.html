<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüéì ‚ô†Ô∏è üî£ Monitoreo de Blackbox en redes Clos. Informe Yandex üï∫ ‚úçüèæ üë®üèæ‚Äçüåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La topolog√≠a de los centros de datos y dispositivos modernos en ellos ya no nos permite estar contentos exclusivamente con el monitoreo de whitebox . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoreo de Blackbox en redes Clos. Informe Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/473834/">  La topolog√≠a de los centros de datos y dispositivos modernos en ellos ya no nos permite estar contentos exclusivamente con el <abbr title="Un tipo de monitoreo basado en m√©tricas obtenidas de las aplicaciones en el dispositivo. Por ejemplo, la supervisi√≥n de whitebox incluye recopilar registros y verificar el estado de las sesiones.">monitoreo de whitebox</abbr> .  Con el tiempo, necesitaba una herramienta que mostrara el rendimiento de dispositivos espec√≠ficos, en funci√≥n de la situaci√≥n real con la transferencia de tr√°fico (plano de datos) en cualquier parte de la <abbr title="Klose Network es un tipo de red de conmutaci√≥n de etapas m√∫ltiples descrita por Charles Klose. Ampliamente utilizado en centros de datos.">red de Clos</abbr> .  Hace unas semanas en la conferencia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Next Hop</a> , el ingeniero de red de Yandex, Alexander Klimenko, comparti√≥ su experiencia para resolver este problema. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/o3/kv/n3/o3kvn3oecpuipgvx68yuzfib4t4.jpeg"></a> <br><br>  - Trabajo en el departamento de operaci√≥n y desarrollo de la red Yandex, y a veces me veo obligado a resolver algunos problemas, en lugar de dibujar nubes hermosas en las hojas o inventar un futuro brillante.  La gente viene y dice que algo no les funciona.  Si se monitorea este asunto, si nuestros ingenieros de servicio ven que no funciona, entonces ser√° m√°s f√°cil para m√≠.  Entonces, esta media hora se dedicar√° al monitoreo. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/wi/m7/gn/wim7gnm9iv9s50sfcujeemna250.jpeg"><br><br>  Tarde o temprano, a todos se les ocurre la idea del monitoreo.  Es decir, al principio puede recopilar apelaciones de los propios usuarios, lo llamar√°n y le dir√°n que algo no funciona para ellos.  Pero est√° claro que tal sistema no escala bien.  Si tiene m√°s de un conmutador, si tiene una red suficientemente grande, con esta opci√≥n de monitoreo no puede ir muy lejos. <br><br>  Y tarde o temprano todos llegan a la conclusi√≥n de que es necesario recopilar algunos datos del equipo.  Este es el primer paso.  Pueden ser registros, varios datos sobre SNMP, ca√≠das, puede crear topolog√≠as de acuerdo con LLDP, etc. Hay un claro inconveniente: el dispositivo en s√≠ mismo le proporciona toda esta informaci√≥n.  Puede no decir nada, enga√±arte, etc. <br><br>  La etapa l√≥gica en el desarrollo de su monitoreo es el monitoreo en hosts.  Podemos decir que hay una peque√±a rama.  Si tiene suerte, o no, de tener una red en un proveedor, el proveedor puede ofrecerle algunas de sus propias opciones de monitoreo.  Pero el a√±o pasado en Next Hop, Dima Ershov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dijo</a> que nuestra f√°brica fue creada a partir de dos proveedores b√°sicos y que no podemos permitirnos ese lujo.  O podemos, pero solo parcialmente. <br><br>  Finalmente, la √∫ltima opci√≥n, que todos de alguna manera alcanzan con el desarrollo de la red.  Esto es monitoreo en hosts finales.  Yandex tiene tal monitoreo.  Se llama Netmon. <br><br><img src="https://habrastorage.org/webt/8j/kj/_w/8jkj_whnq8eze73jzmmc_w_c-_q.jpeg"><br><br>  En la parte inferior de la diapositiva <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hay un enlace con una presentaci√≥n detallada</a> sobre c√≥mo funciona Netmon.  Lo dir√© literalmente dentro de una diapositiva.  Si alguien quiere, lea la charla de otra conferencia de Netmon. <br><br>  Netmon son agentes que se instalan en casi todos los hosts de la red.  La tarea llega a los agentes: enviar algunos paquetes a alg√∫n nodo de red.  Pueden ser completamente diferentes: UDP, TCP, ICMP.  Puede ser como pinturas diferentes, es decir, DSCP y destino.  Los puertos de origen y destino tambi√©n pueden ser diferentes. <br><br>  Estos datos se agregan, se cargan en un almacenamiento separado, y obtenemos aqu√≠ un segmento como el de la derecha en la figura.  Una porci√≥n puede estar m√°s agregada o menos agregada, dependiendo de lo que queramos ver.  Por ejemplo, aqu√≠, hasta donde veo, tenemos una porci√≥n de toda la conectividad del centro de datos, es decir, entre todos nuestros centros de datos.  Podemos caer m√°s en los cuadrados: ver la conectividad entre el POD o dentro del edificio de un centro de datos;  a√∫n m√°s profundo: dentro del POD entre los bastidores;  e incluso m√°s profundo, incluso dentro del estante. <br><br><img src="https://habrastorage.org/webt/ea/iq/to/eaiqtolvrecwgo0apgnxdc2rgy0.jpeg"><br><br>  ¬øQu√© podr√≠a salir mal aqu√≠?  Una peque√±a digresi√≥n para aquellos que no vieron el pr√≥ximo salto del a√±o pasado. <br><br>  Usamos 400 gigabits por ToR, y en el primer momento de implementaci√≥n de esta f√°brica incluimos solo 200, porque hab√≠a tareas m√°s importantes.  No importa por qu√©  Encendieron 200, llegaron los servicios y dijeron: ¬øpor qu√© 200?  ¬°Queremos 400!  Comenz√≥ a encenderlo.  Y as√≠ sucedi√≥ que la segunda parte de la f√°brica, que incluimos, ten√≠a alg√∫n tipo de matrimonio en la memoria de las tarjetas.  Como resultado, encendemos la f√°brica y vemos esta imagen: <br><br><img src="https://habrastorage.org/webt/-m/mt/vb/-mmtvbpckx_kmr42-u3dwoditz4.jpeg"><br><br>  Este Netmon, los cuadrados rojos, est√° en llamas.  Entendemos que todo est√° perdido.  Nos agarramos de la cabeza, como Homero, e intentamos empujar algo fren√©ticamente.  Y qu√© presionar, qu√© apagar, no lo entendemos.  Es decir, Netmon nos muestra la presencia de un problema, pero no muestra d√≥nde, de hecho, el problema se encuentra en la red. <br><br><img src="https://habrastorage.org/webt/ef/sg/tu/efsgtu9frnrwu4mcwoajkhqtw4m.jpeg"><br><br>  Hemos llegado a la tarea que debemos completar.  ¬øQu√© hay que hacer?  Determine con qu√© dispositivo en la red hay un problema y ret√≠relo del servicio, ya sea autom√°ticamente o por fuerzas, por ejemplo, ingenieros en servicio. <br><br>  Adem√°s, las condiciones iniciales son tales que tenemos una topolog√≠a bastante regular, es decir, no hay v√≠nculos extra√±os entre giros de segundo nivel o entre toros.  Tenemos la mayor parte del tr√°fico: TCP, hay un lugar central, ya nos han informado, y los servidores se administran m√°s o menos centralmente.  Podemos llegar a este lugar central y declarar razonablemente: chicos, queremos hacerlo, por favor h√°galo. <br><br>  ¬øQu√© opciones hemos considerado? <br><br><img src="https://habrastorage.org/webt/y-/cx/1m/y-cx1mnilmeqpxmlibivrgychbq.jpeg"><br><br>  Lo primero que viene a la mente es el rastreo.  Por qu√©  Porque el mismo Netmon descarga los pares de origen y destino fallidos en un recopilador separado.  En consecuencia, podemos tomar esta tupla de 5, mirarla y hacer un seguimiento con los mismos par√°metros.  Y para agregar datos sobre qu√© enlace o por qu√© dispositivos pasa la mayor cantidad de rastros. <br><br>  Pero desafortunadamente, MPLS se usa en nuestra f√°brica (ahora nos estamos moviendo en la direcci√≥n opuesta a MPLS, pero tambi√©n necesitamos monitorear las viejas f√°bricas de alguna manera, pero no las descarte, en realidad).  Tenemos MPLS en la f√°brica, y el problema con MPLS y el rastreo es que necesita tunelizar el mensaje ICMP excedido por TTL, que subyace al rastreo.  Habiendo perdido tal mensaje de entrada a salida, podemos perder la supervisi√≥n misma.  Es decir, no entenderemos a trav√©s de qu√© nodos pas√≥ este mensaje.  Esto no nos conven√≠a para el monitoreo. <br><br><img src="https://habrastorage.org/webt/xl/bg/fr/xlbgfroj02orrytuqectvxi-n18.jpeg"><br><br>  Hay una segunda opci√≥n relacionada con ECMP.  Tomamos el mismo par de origen y destino, adem√°s de puerto de origen puerto de destino.  Llegamos a una pieza de hierro, a trav√©s de la API o de la CLI, alimentamos esta pieza de hierro a la pieza de hierro, y obtenemos la interfaz de salida.  Muchos dispositivos admiten este tipo de salida. <br><br>  Llegamos a ToR, vemos que ToR ha elegido un enlace izquierdo o derecho.  En este caso, el enlace izquierdo est√° hacia la izquierda S1. <br><br><img src="https://habrastorage.org/webt/pf/k1/fq/pfk1fq3l3zpso1b0dtteib-ip5a.jpeg"><br><br>  Llegamos a este S1, miramos, a la derecha S2, y de esta manera se form√≥ un camino listo. <br><br><img src="https://habrastorage.org/webt/lb/gu/7r/lbgu7r5ogih0uzo4zoazcczuuya.jpeg"><br><br>  Hay algunas desventajas.  En primer lugar, no todos los dispositivos pueden aceptar normalmente estos datos de entrada que les damos.  Esto se debe al hecho de que tenemos IPv6 y MPLS, as√≠ como al hecho de que algunos proveedores simplemente no implementaron esto.  El segundo inconveniente de esta soluci√≥n: confiamos en lo que el trozo de hierro nos dir√° nuevamente, en lugar de mirar lo que est√° sucediendo en los hosts.  Y finalmente, el tercer inconveniente: durante el tiempo que va y ve lo que sucede all√≠, algo ya puede cambiar en la red y sus datos no ser√°n relevantes. <br><br><img src="https://habrastorage.org/webt/dy/he/_s/dyhe_sdybz_8nsum0uce40pjg2c.jpeg"><br><br>  Luego nos encontramos con una interesante presentaci√≥n hecha por Facebook.  Nos gust√≥ la idea que propuso Facebook, decidimos intentar hacer algo similar. <br><br>  ¬øCu√°l fue la idea principal?  Use un programa eBPF en el host para colorear la retransmisi√≥n TCP y luego calcule el n√∫mero de dichos paquetes.  Desafortunadamente, no pudimos hacerlo en Facebook, tuvimos que inventar nuestra propia bicicleta.  Tratar√© de contarte sobre el camino del dolor y el sufrimiento por el que hemos pasado. <br><br><img src="https://habrastorage.org/webt/bt/5l/5e/bt5l5e9el6kbhutnjsamv3hpo5u.jpeg"><br><br>  Que hemos hecho  Por si acaso, se√±alar√© que la retransmisi√≥n de TCP son mensajes TCP que se repiten varias veces debido a que no se confirm√≥ su recepci√≥n.  Tenemos un programa eBPF instalado en el host y analiza si este mensaje TCP se retransmite o no.  Lo hace cursi, por n√∫mero de secuencia.  Si se transmite el mismo n√∫mero de secuencia en una sesi√≥n TCP, entonces esto es retransmitir. <br><br>  ¬øQu√© hacemos con tales paquetes?  Establecimos el √∫ltimo bit en el campo DSCP en uno para calcular a√∫n m√°s todo. <br><br><img src="https://habrastorage.org/webt/rk/nh/qm/rknhqmvuhuu9vss_juaqyzlxtza.jpeg"><br><br>  En t√©rminos generales, DSCP est√° relacionado de alguna manera con QoS, ¬øverdad?  Y con QoS, la historia en nuestra red es bastante complicada y antigua.  Tenemos ciertas pol√≠ticas que se supervisan en los conmutadores ToR.  A estas pol√≠ticas, acabamos de agregar la necesidad de contar m√°s y estos paquetes de colores. <br><br>  Por lo tanto, para paquetes de colores (l√©ase: para paquetes de retransmisi√≥n de TCP desde el host), simplemente agregamos otra cola de QoS.  Esto fue bastante f√°cil de hacer, porque todav√≠a ten√≠amos l√≠neas libres.  Adem√°s, esto es conveniente, porque en la etapa de transici√≥n entre IPv6 y MPLS en la f√°brica, es decir, en la etapa en que el paquete vuela S1 y sale a nuestra parte MPLS de la f√°brica, es conveniente tomar y volver a pintar EXP / TC en el encabezado del paquete MPLS para cada cola espec√≠fica. . <br><br><img src="https://habrastorage.org/webt/n1/jz/yy/n1jzyyspbgw39b3zv1xngyavgwm.jpeg"><br><br>  ¬øQu√© hacemos con estos datos?  Los recopilamos con filtros ACL est√°ndar, clase de tr√°fico.  Es decir, funciona, en principio, en cualquier proveedor.  Podemos recopilar y calcular el n√∫mero de dichos paquetes en todas partes. <br><br>  A continuaci√≥n, observamos la distribuci√≥n desigual de dichos paquetes en el POD.  En ella, por ejemplo, cuatro espinas, como en la imagen.  Si el n√∫mero de paquetes en los enlaces amarillos, en azul, en verde y en rojo es el mismo, entonces creemos que todo es m√°s o menos bueno.  Si en alg√∫n momento vemos un aumento, por ejemplo, en la columna vertebral m√°s a la derecha del primer nivel, entendemos que este dispositivo atrae retransmisi√≥n, algo est√° mal.  Luego tratamos de desmantelarlo o, al menos, arrendarlo.  Al menos cuando veamos problemas en Netmon, sabremos con qu√© dispositivo pueden surgir. <br><br><img src="https://habrastorage.org/webt/ky/9t/8u/ky9t8uf1v57wlbqmqsxmmtusipc.jpeg"><br><br>  ¬øC√≥mo se ve en los datos sin procesar simples?  Aqu√≠ hay dos gr√°ficos.  De hecho, estos son cuadros de retransmisi√≥n con ToR hacia la columna vertebral de primer nivel.  En el ejemplo, dos espinas en el m√≥dulo.  El gr√°fico superior es la agregaci√≥n de la primera columna vertebral, el gr√°fico inferior es la segunda columna vertebral.  Ver esto en este formulario no es muy conveniente, por lo que hemos agregado la agregaci√≥n de esta informaci√≥n. <br><br><img src="https://habrastorage.org/webt/ab/pu/-o/abpu-on4l0cwiglpfdftt7mzykc.jpeg"><br><br>  Se ve as√≠.  Hay un m√≥dulo en el que tres espinas, por alguna raz√≥n, no importa cu√°l, y vemos aqu√≠ una distribuci√≥n total de retransmisiones a tres espinas.  Es, en principio, bastante uniforme. <br><br><img src="https://habrastorage.org/webt/ar/m0/cm/arm0cmbz77k8bpdu8qqerqsttto.jpeg"><br><br>  Para la columna vertebral de segundo nivel, podemos tener varias desviaciones, llam√©moslas as√≠.  La topolog√≠a sigue siendo regular, pero dependiendo del centro de datos, podemos o no usar una arquitectura tipo placa.  El punto aqu√≠ es exactamente el mismo.  En un nivel, deber√≠amos tener aproximadamente la misma distribuci√≥n de paquetes de colores. <br><br><img src="https://habrastorage.org/webt/if/od/og/ifodogqs86mqbfgahucjzo_wrgi.jpeg"><br><br>  Veamos algunos ejemplos.  ¬øAlguien ve un problema en ese gr√°fico?  Hay un problema aqu√≠, pero no est√° all√≠ al mismo tiempo.  S√≠, este es el problema de Schr√∂dinger.  ¬øPor qu√© est√° ella all√≠ y no?  Debido a que vemos un aumento en el n√∫mero de retransmisiones, es directamente obvio que algo nos sucedi√≥.  Pero al mismo tiempo, vemos que este crecimiento es bastante uniforme.  Es decir, tres espinas azules, rojos, azules, incluso distribuci√≥n sobre ellos.  ¬øQu√© significa esto?  Que hubo alg√∫n tipo de problema en la red, pero no est√° relacionado con este nivel de agregaci√≥n de datos.  Ella esta en otro lugar. <br><br>  Tal vez alguien cerr√≥ el puerto en los firewalls, desconect√≥ alg√∫n cl√∫ster, es decir, algo sucedi√≥.  Pero no nos interesa en absoluto lo que estaba all√≠ y por qu√©.  Es decir, ni siquiera consideramos tal problema. <br><br><img src="https://habrastorage.org/webt/ie/_4/tz/ie_4tzqchudv3zrxi6vi_mcwxgm.jpeg"><br><br>  Y aqu√≠, tal vez, no tan claramente, pero el problema es visible.  Dos espinas en el m√≥dulo, 46 ‚Äã‚Äãpaquetes pintados volaron en uno y un poco en el segundo.  Entendemos que tenemos un problema con alg√∫n tipo de columna vertebral en la red, tenemos que hacer algo al respecto. <br><br>  ¬øPor qu√© habl√© primero sobre el camino del dolor y el sufrimiento?  Porque hay muchos problemas con tal soluci√≥n.  El problema principal es, por supuesto, el problema de cualquier monitoreo, esto es falso positivo.  Falso positivo fue bastante.  Principalmente debido al hecho de que usamos DSCP y generalmente estamos vinculados a QoS. <br><br><img src="https://habrastorage.org/webt/ht/md/rb/htmdrbopskl2febbslxadjbqtlw.jpeg"><br><br>  Descubrimos que los paquetes de otras personas vuelan en nuestra pintura y nos alertan sobre nuestro monitoreo.  Es decir, creemos que esto es una retransmisi√≥n, y alguien m√°s coloca sus paquetes all√≠ y, en general, nos estropea la imagen.  Naturalmente, comenzamos a comprender, encontramos muchos lugares donde pens√°bamos que funcionaba, pero en realidad no funciona de la manera en que pensamos.  Por ejemplo, el tr√°fico que ingresa a la red aparentemente deber√≠a repintarse, el tr√°fico con la clase CS6 y CS7 en los internos no deber√≠a ingresar a nuestra red.  Pero en algunos lugares hubo, digamos, defectos, y los tratamos con √©xito. <br><br>  Algunos fabricantes presentaron sorpresas en forma de contadores en la direcci√≥n de salida de dichos paquetes, y el chip funciona de tal manera que, de hecho, para procesar la lista de acceso saliente envuelve el tr√°fico nuevamente, mordiendo la mitad del ancho de banda del chip .  Fue de 900 gigabits por chip, se convirti√≥ en la mitad. <br><br>  E hicimos algunas mejoras debido al hecho de que la configuraci√≥n en el host puede ser diferente.  Es decir, alg√∫n host puede enviar retransmisiones con m√°s frecuencia, algunos host pueden con menos frecuencia, algunos dos, algunos cinco, y todo esto alerta nuestra supervisi√≥n, todo esto es falso positivo. <br><br>  Primero, abandonamos la idea de pintar cada retransmisi√≥n TCP.  Nos dimos cuenta de que, en principio, no necesitamos cada retransmisi√≥n para comprender d√≥nde est√° el problema.  Comenzamos a pintar solo SYN-retransmit.  SYN es el primer paquete de la sesi√≥n, esto es suficiente para que recibamos una se√±al.  Tambi√©n pintamos SYN-ACL. <br><br>  De todos modos, dio algunos falsos positivos.  Fuimos un poco m√°s lejos.  Comenzamos a pintar solo la primera retransmisi√≥n de SYN TCP en la sesi√≥n.  Es decir, en realidad hay varios de ellos enviados, pintamos cada uno, solo uno comenz√≥ a pintarse.  As√≠ que hemos llegado a lo que tenemos ahora. <br><br>  En total, hay Netmon, hay agentes en los hosts que colorean la primera retransmisi√≥n SYN en la sesi√≥n, y contamos estas retransmisiones en cada dispositivo, en casi todos los enlaces de nuestra red. <br><br><img src="https://habrastorage.org/webt/bk/pn/y1/bkpny1rbllgxlz8nf4v6wynm6ro.jpeg"><br><br>  Pero mirar con los ojos la imagen que sol√≠a mostrar no es muy conveniente.  Es decir, no puede venderlo a un oficial de servicio, porque en cada secci√≥n debe evaluarlo todo con sus ojos.  Y llegamos al hecho de que quiero tener una alerta.  Quiero que se encienda una luz: un dispositivo tal o cual es un problema;  Otro dispositivo es un problema. <br><br>  Recordemos algunas estad√≠sticas matem√°ticas.  La idea con alerta es que cada dispositivo es esencialmente una canasta.  Tenemos una probabilidad de √©xito y una probabilidad de falla para cuatro dispositivos.  La probabilidad de que la retransmisi√≥n llegue a la canasta, es decir, el √©xito, es ¬º.  Resulta una distribuci√≥n binomial. <br><br>  ¬øCu√°l es la dificultad de hacer una alerta aqu√≠?  El hecho de que no podamos hacer que los umbrales sean est√°ticos, no podemos decir: si llegan diez retransmisiones en un dispositivo y nueve en el otro, entonces no hay problema.  Y si diez y cinco, entonces hay un problema.  Porque si lo escalamos a mil PPS, esos datos ya no ser√°n relevantes.  1000 PPS y 800 PPS entre diferentes dispositivos es definitivamente un problema. <br><br>  No podemos establecer umbrales est√°ticos en PPS o bytes, no podemos establecerlos como un porcentaje, el mismo problema con ellos.  Por lo tanto, necesitamos una soluci√≥n que haga que este umbral sea m√°s o menos din√°mico, dependiendo de la cantidad de paquetes. <br><br>  Y el encanto de la distribuci√≥n binomial es que al aumentar el PPS tiende a ser normal, y para una distribuci√≥n normal, ya podemos calcular la expectativa, la varianza y calcular el intervalo de confianza, lo cual hicimos.  El intervalo de confianza para nosotros es 3NPQ, es decir, depende de la cantidad de paquetes a trav√©s del dispositivo.  Como resultado, tenemos un umbral de cambio din√°mico. <br><br>  As√≠ es como se ve nuestra se√±al en la imagen.  Si alg√∫n dispositivo queda fuera de la distribuci√≥n, levantamos una bandera, algo est√° mal. <br><br><img src="https://habrastorage.org/webt/0e/bo/c_/0eboc_4g2lwamtfgsdus0o-tqzi.jpeg"><br><br>  ¬øD√≥nde queremos desarrollar m√°s, qu√© queremos mejorar aqu√≠, adem√°s de, por supuesto, la lucha contra los falsos positivos?  En primer lugar, ¬øestar√≠amos interesados ‚Äã‚Äãen ver qu√© hab√≠a en el momento del problema?  Para hacer esto, tenemos una opci√≥n en el agente: Depuraci√≥n.  Podemos cargar exactamente lo que se retransmiti√≥, es decir, un paquete de 5 tuplas, por ejemplo, en un recopilador separado, y luego mirarlo.  Pero esto genera cierta carga en los hosts, por lo que a veces se nos proh√≠be hacerlo.  Queremos fijar ERSPAN y descargar dichos paquetes en el recopilador desde el hardware en s√≠, porque nadie nos proh√≠be hacer esto en el hardware. <br><br>  Dima Afanasyev <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dijo</a> c√≥mo desarrollaremos nuestras f√°bricas, y uno de los puntos fue la transici√≥n de la f√°brica MPLS a IPv6 solamente.  ¬øQu√© nos da esto?  MPLS tiene tres bits para el marcado de QoS.  En IPv6, al menos seis.  En este momento, solo se utilizan tres bits en nuestra red.  Es decir, todav√≠a tenemos tres bits m√°s en los que podemos poner, de hecho, cualquier informaci√≥n del host. <br><br>  Por ejemplo, ahora estamos pintando solo la primera retransmisi√≥n SYN de la sesi√≥n.  Y podemos colorear el segundo bit, por ejemplo, si el paquete va a una red externa.  Y podemos retransmitir, es decir, resaltar otra se√±al, que luego consideraremos por separado. <br><br>  Adem√°s, la transici√≥n al dise√±o con edge pod, cuando hemos realizado DCI en alg√∫n lugar en particular, nos amenaza con el hecho de que en este lugar podemos controlar con mayor precisi√≥n nuestro dominio diffserv.  Es decir, volver a pintar y hacer algo con pinturas para cortar el falso positivo. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como resultado, hacer todo lo anterior result√≥ ser bastante doloroso, pero interesante. </font><font style="vertical-align: inherit;">No hab√≠a nada de qu√© preocuparse. </font><font style="vertical-align: inherit;">Nosotros, de hecho, hemos desarrollado una soluci√≥n que todos pueden usar. </font><font style="vertical-align: inherit;">Se prueba en pr√°cticamente todos los proveedores, funciona, no es dif√≠cil. </font><font style="vertical-align: inherit;">Y realmente muestra qu√© dispositivo en la red hay un problema. </font><font style="vertical-align: inherit;">Por lo tanto, mi mensaje es: no tengas miedo de hacer lo mismo y deja que tu monitoreo permanezca verde. </font><font style="vertical-align: inherit;">Gracias por escuchar</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/473834/">https://habr.com/ru/post/473834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../473822/index.html">Oferta de trabajo en 1 d√≠a: c√≥mo entrevistamos y retroalimentamos el mismo d√≠a</a></li>
<li><a href="../473824/index.html">C√≥mo construir una tecnolog√≠a comercial para la planificaci√≥n de ventas en un solo sistema</a></li>
<li><a href="../473826/index.html">Autenticaci√≥n OTP en el servidor web Apache</a></li>
<li><a href="../473828/index.html">Visi√≥n por computadora como alternativa a los pases de oficina</a></li>
<li><a href="../473832/index.html">ShIoTiny: actualizaciones y notificaciones</a></li>
<li><a href="../473838/index.html">DJI Mavic Mini: el quadrocopter plegable m√°s ligero</a></li>
<li><a href="../473840/index.html">Transmita video desde un dispositivo Android a trav√©s de UDP a la aplicaci√≥n JAVA</a></li>
<li><a href="../473842/index.html">Resumen de noticias de octubre sobre aprendizaje autom√°tico e inteligencia artificial</a></li>
<li><a href="../473844/index.html">¬øPor qu√© necesitamos rangos de C ++ 20 en una trituradora simple?</a></li>
<li><a href="../473846/index.html">C√≥mo medir el rendimiento de las redes blockchain. M√©tricas clave</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>