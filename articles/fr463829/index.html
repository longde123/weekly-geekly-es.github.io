<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔲 🙎🏼 🤴 FreePBX Configuration d'Asterisk pour les notifications par e-mail des appels entrants manqués dans la file d'attente 🙃 🗒️ 🍭</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IP ATC Asterisk est un puissant processeur de téléphonie IP. Et l'interface Web FreePBX créée pour Asterisk simplifie considérablement la configuratio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>FreePBX Configuration d'Asterisk pour les notifications par e-mail des appels entrants manqués dans la file d'attente</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463829/"><img src="https://habrastorage.org/webt/ke/dl/08/kedl08qszm8sgw39uk2zteenbja.png" alt="image"><br>  IP ATC Asterisk est un puissant processeur de téléphonie IP.  Et l'interface Web FreePBX créée pour Asterisk simplifie considérablement la configuration et abaisse le seuil de connexion. <br>  Si vous pouvez proposer une sorte de tâche liée à la téléphonie IP, alors elle peut presque certainement être implémentée dans Asterisk.  Mais soyez sûr que la persévérance et l'endurance vous seront demandées. <br><br>  Nous avons dû configurer des notifications par e-mail des appels manqués.  Plus précisément, pour notifier par e-mail les cas où un appel entrant a été mis en file d'attente, mais personne (des agents) n'a répondu à cet appel entrant. <br><br>  Étonnamment, nous n'avons trouvé aucun outil régulier pour résoudre ce problème dans FreePBX.  Je vais parler de la façon dont nous avons résolu ce problème sous la coupe. <br><a name="habracut"></a><br>  <b>Préface</b> <br><br>  Avant de résoudre le problème «de front», nous avons certainement recherché des informations sur Internet, mais nous n'avons pas trouvé de solutions clé en main (peut-être qu'ils cherchaient mal, mais que pouvez-vous faire ...). <br><br>  Il n'y a pas autant de compétences professionnelles directement dans Asterisk que nous le souhaiterions, de sorte que la solution proposée <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> n'a pas été entièrement comprise et a été rejetée. <br><br>  J'ai aimé la solution proposée <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , même si elle n'a pas fonctionné.  Par conséquent, ils ont souligné que travailler dans Asterisk est nécessaire dans le contexte des [ext-queues].  Et puisque nous travaillons dans Freepbx, nous devons travailler dans le fichier de configuration «extensions_override_freepbx.conf».  Nous avons remarqué qu'il est pratique de «capturer les appels manqués» avant l'événement de raccrochage (fin d'un appel). <br>  Après avoir lu la discussion <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , l'idée est venue que nous devons filtrer la variable «Disposition» dans le CDR pour tous les agents dans la file d'attente.  Et après avoir lu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ces</a> informations, des étapes assez spécifiques ont été formées pour résoudre la tâche. <br><br>  <b>Qu'avons-nous:</b> <br><br>  Il existe FreePBX 13.0.197 qui utilise Asterisk 13.12.1.  Version du système d'exploitation SHMZ version 6.6 (finale).  La distribution est basée sur CentOS. <br><br>  L'astérisque est configuré avec IVR (menu vocal) dispersant les appels entrants dans différentes files d'attente (files d'attente).  Des agents (agents) sont affectés à chaque file d'attente, c'est-à-dire des agents. <br><br>  <b>Théorie</b> <br><br>  <b>Que se passe-t-il chez Asterisk</b> <br><br>  Lorsqu'un appel entrant arrive à Asterisk, cet appel est dirigé vers l'IVR.  L'appelant fait un choix en appuyant sur un numéro spécifique du téléphone et entre dans une file d'attente spécifique.  Après cela, tous les agents libres de la file d'attente reçoivent simultanément un appel. <br><br>  Afin de mieux comprendre ce qui se passe en ce moment et ce qui se passe ensuite, nous nous tournons vers Report CDR (Fig. 1). <br><br><img src="https://habrastorage.org/webt/sv/qg/86/svqg86ls1ot8x4lcl5syw7oq3w0.png" alt="image"><br>  <i>Fig.1</i> <br><br>  Lorsqu'un appel entrant tombait dans la file d'attente, pour tous les agents, la valeur de la variable "Disposition" devenait égale à "AUCUNE RÉPONSE" si les agents n'étaient pas occupés à ce moment.  La variable "Disposition" peut prendre d'autres valeurs (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://asterisk-pbx.ru/wiki/asterisk/cf/cdr</a> ), à l'exception de la valeur "ANSWERED".  Et au moment où l'un des agents répond à l'appel entrant, la valeur de la variable "Disposition" de cet agent devient égale à "REPONSE". <br>  Dans le rapport CDR, vous pouvez remarquer que lorsque l'appel est mis en file d'attente (dans la colonne App, la valeur devient «Queue»), tous les événements apparaissent avec le même «uniqueid» (colonne System). <br><br>  <b>CDR en bref</b> <br><br>  Il est important de comprendre ce qu'est un CDR et à quel moment dans le CDR les données que nous observons dans le rapport CDR sont entrées.  Le CDR, relatif au système d'exploitation, est la base de données dans laquelle Asterisk enregistre un rapport d'appel détaillé (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://asterisk-pbx.ru/wiki/asterisk/cf/cdr</a> ).  Dans notre cas, il s'agit d'une base de données appelée asteriskcdrdb, qui se trouve dans mysql.  Empiriquement, nous avons constaté que les données sur un appel avec un certain «uniqueid» ne sont pas entrées dans asteriskcdrdb immédiatement après l'occurrence d'un événement, mais après l'événement hangupcall (fin de l'appel). <br><br>  <b>Le principe de la solution créée</b> <br><br>  Puisque nous avons plus de connaissances en bash que de connaissances en astérisque, l'idée principale est la suivante.  Avant l'événement hangupcall, appelez le script bash.  Passez 3 paramètres à ce script.  Le premier paramètre est «uniqueid», pour filtrer les données reçues du CDR.  Le deuxième paramètre est «CALLERID (num)» (le numéro de l'appelant) pour savoir qui rappeler.  Le troisième paramètre est «NODEST» (numéro de file d'attente), auquel l'appel a été reçu, afin de savoir sur quel problème il y a eu un appel et à qui envoyer une notification par e-mail d'un appel manqué. <br>  Le script bash doit se connecter à la base de données asteriskcdrdb dans mysql et prendre toutes les valeurs de la variable "Disposition" avec un "uniqueid" spécifique.  A partir des données obtenues, il faut exclure les valeurs: "PAS DE REPONSE", "OCCUPÉ", "ECHEC", "INCONNU".  En conséquence, soit "RÉPONSE" restera - ils ont répondu à l'appel entrant, soit rien du tout - l'appel manqué. <br><br>  De plus, si l'appel a été manqué, le script doit envoyer une notification par e-mail. <br>  Pour l'avenir, je note un point important.  Asterisk exécute les commandes séquentiellement, en attendant leur exécution (ce qui est généralement logique).  Et nous appellerons le script bash avant l'exécution de la commande hangupcall.  Ainsi, au moment où le script est directement exécuté, les informations sur l'identifiant unique que nous recherchons ne seront pas encore entrées dans le CDR.  Pour résoudre ce problème, nous appellerons le script bash avec le paramètre «&amp;» afin qu'Asterisk passe immédiatement à l'étape suivante, c'est-à-dire hangupcall.  Et à l'intérieur du script bash, au tout début, nous allons définir un petit délai pour donner le temps à Asterisk d'entrer les données avec l '"uniqueid" qui nous intéresse dans le CDR. <br><br>  <b>Pratique</b> <br><br>  Avant de configurer Asterisk et de créer un script bash, vous devez configurer l'envoi de notifications par e-mail.  Pour cela, nous utiliserons l'utilitaire postfix. <br><br>  <b>Configuration de Postfix</b> <br><br>  Nous avons un domaine de messagerie "lucky.ru" situé à Yandex.  Nous configurerons postfix en mode client smtp et enverrons des lettres du compte asterisk@lucky.ru. <br>  La solution est prise à partir d'ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.dmosk.ru/miniinstruktions.php?mini=postfix-over-yandex</a> . <br><br>  Première installation / mise à jour / vérification des packages: <br><br><pre><code class="bash hljs">yum install postfix yum install mailx yum install cyrus-sasl cyrus-sasl-lib cyrus-sasl-plain</code> </pre> <br>  Nous n'écraserons pas le fichier de configuration principal de postfix «/etc/postfix/main.cf», mais le sauvegarderons: <br><br><pre> <code class="bash hljs">cp /etc/postfix/main.cf /etc/postfix/main.cf.sav</code> </pre> <br>  Nous éditons le fichier «/etc/postfix/main.cf» et le portons sous la forme suivante: <br><br><pre> <code class="bash hljs">nano /etc/postfix/main.cf <span class="hljs-comment"><span class="hljs-comment">##################### relayhost = smtp_sasl_auth_enable = yes smtp_sasl_password_maps = hash:/etc/postfix/private/sasl_passwd smtp_sasl_security_options = noanonymous smtp_sasl_type = cyrus smtp_sasl_mechanism_filter = login smtp_sender_dependent_authentication = yes sender_dependent_relayhost_maps = hash:/etc/postfix/private/sender_relay smtp_generic_maps = hash:/etc/postfix/generic smtp_tls_CAfile = /etc/postfix/ca.pem smtp_use_tls = yes smtputf8_autodetect_classes = all #####################</span></span></code> </pre> <br>  Toutes les lignes de "/etc/postfix/main.cf" ne peuvent pas être commentées.  Les commentaires de certaines lignes ne sont pas déterminés par l'analyseur et sont transmis au traitement, ce qui entraîne des erreurs.  Il vaut mieux refuser les commentaires à l'intérieur de ce fichier.  Vous pouvez expérimenter cela en exécutant «tail -f / var / log / messages» dans la fenêtre suivante. <br><br>  Je marquerai la ligne "smtputf8_autodetect_classes = all".  Cette entrée inclut utf-8 par défaut, ce qui vous permet d'utiliser l'alphabet cyrillique dans le corps de la lettre et dans la ligne d'objet sans manipulations supplémentaires (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://www.postfix.org/SMTPUTF8_README.html</a> ). <br><br>  Créez un répertoire pour les fichiers de configuration: <br><br><pre> <code class="bash hljs">mkdir /etc/postfix/private</code> </pre> <br>  Nous éditons le fichier "/ etc / postfix / private / sender_relay".  Dans ce document, vous devez spécifier à quel serveur smtp vous devez vous référer lorsque vous utilisez notre domaine de messagerie: <br><br><pre> <code class="bash hljs">nano /etc/postfix/private/sender_relay <span class="hljs-comment"><span class="hljs-comment">##################### @lucky.ru smtp.yandex.ru #####################</span></span></code> </pre> <br>  Nous éditons le fichier "/ etc / postfix / private / sasl_passwd".  Nous y indiquerons l'adresse e-mail que nous utiliserons pour envoyer des lettres, ainsi que le nom d'utilisateur et le mot de passe de ce compte (nous spécifions le nom d'utilisateur et le mot de passe via deux points): <br><br><pre> <code class="bash hljs">nano /etc/postfix/private/sasl_passwd <span class="hljs-comment"><span class="hljs-comment">##################### asterisk@lucky.ru asterisk@lucky.ru:password_asterisk #####################</span></span></code> </pre> <br>  Modification du fichier / etc / postfix / generic.  Nous y noterons les règles de remplacement de l'adresse sortante (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://wiki.merionet.ru/ip-telephoniya/30/postfix-nastrojka-otpravki-pochty-v-asterisk/</a> ): <br><br><pre> <code class="bash hljs">nano /etc/postfix/generic <span class="hljs-comment"><span class="hljs-comment">##################### root asterisk@lucky.ru root@localhost asterisk@lucky.ru root@localhost.localdomain asterisk@lucky.ru root@freepbx asterisk@lucky.ru root@freepbx.localdomain asterisk@lucky.ru root@asterisk asterisk@lucky.ru root@asterisk.localdomain asterisk@lucky.ru asterisk asterisk@lucky.ru asterisk@localhost asterisk@lucky.ru asterisk@localhost.localdomain asterisk@lucky.ru asterisk@freepbx asterisk@lucky.ru asterisk@freepbx.localdomain asterisk@lucky.ru asterisk@asterisk asterisk@lucky.ru asterisk@asterisk.localdomain asterisk@lucky.ru root@localdomain.localdomain asterisk@lucky.ru #####################</span></span></code> </pre> <br>  L'adresse sortante initiale dépend du contenu de «/ etc / hosts» et «/ etc / hostname», ainsi que du nom de l'utilisateur qui enverra la lettre.  Autrement dit, malgré le fait que nous utilisons le client smtp et envoyons des lettres de asterisk@lucky.ru, de toute façon, postfix remplacera initialement «quelque chose de propre» dans l'adresse de l'expéditeur et cela doit être corrigé par les règles de ce fichier de configuration. <br><br>  Je vais lister le contenu de mon fichier / etc / hosts: <br><br><pre> <code class="bash hljs">cat /etc/hosts <span class="hljs-comment"><span class="hljs-comment">##################### 127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4 asterisk.localdomain 127.0.0.1 localhost.localdomain localhost ::1 asterisk localhost localhost6 #####################</span></span></code> </pre> <br>  Il est important que le serveur ait n'importe quel domaine (la valeur après la période), car l'utilitaire de messagerie "recherche" le nom de domaine dans "/ etc / hosts" et s'il ne le "trouve" pas immédiatement, il continuera à le faire pendant plusieurs minutes et alors seulement envoyez une lettre.  Autrement dit, si le domaine n'est pas enregistré, la lettre partira avec un retard de plusieurs minutes. <br><br>  Je vais lister le contenu de mon fichier / etc / hostname: <br><br><pre> <code class="bash hljs">cat /etc/hostname <span class="hljs-comment"><span class="hljs-comment">##################### asterisk #####################</span></span></code> </pre> <br>  Ensuite, vous devez transférer les fichiers de configuration créés vers des bases de données indexées, pour ce faire, exécutez la commande suivante: <br><br><pre> <code class="bash hljs">postmap /etc/postfix/generic &amp;&amp; postmap /etc/postfix/private/{sasl_passwd,sender_relay}</code> </pre> <br>  Ensuite, nous devons télécharger et placer le certificat smtp.yandex.ru sur le serveur, pour ce faire, exécutez la commande suivante: <br><br><pre> <code class="bash hljs">openssl s_client -starttls smtp -crlf -connect smtp.yandex.ru:25 &gt; /etc/postfix/ca.pem</code> </pre> <br>  Mais une fois que les informations techniques seront affichées à l'écran, l'équipe "continuera de se bloquer".  Appuyez sur Ctrl + C pour l'annuler. <br><br>  Maintenant, supprimez manuellement toutes les ordures du fichier résultant et ne laissez que le certificat.  Vous devriez obtenir quelque chose comme ceci: <br><br><pre> <code class="bash hljs">nano /etc/postfix/ca.pem <span class="hljs-comment"><span class="hljs-comment">##################### -----BEGIN CERTIFICATE----- MIIGazCCBVOgAwIBAgIQcUU9mJXW4OUs5Gf0JfLtsjANBgkqhkiG9w0BAQsFADBf ... nRG0DfdqYIuPGApFORYe -----END CERTIFICATE----- #####################</span></span></code> </pre> <br>  Enfin, redémarrez postfix: <br><br><pre> <code class="bash hljs">service postfix restart</code> </pre> <br>  Nous envoyons une lettre de test: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"  "</span></span> | mail -s <span class="hljs-string"><span class="hljs-string">" "</span></span> admin@lucky.ru</code> </pre> <br>  admin@lucky.ru - adresse de destination <br><br>  Ceci termine la configuration posfix. <br><br>  <b>Écrire un script bash</b> <br><br>  Créez un répertoire pour stocker un script bash (ici, quelqu'un l'aime où): <br><br><pre> <code class="bash hljs">mkdir /home/asterisk/scripts</code> </pre> <br>  Créez un fichier de script bash: <br><br><pre> <code class="bash hljs">touch /home/asterisk/scripts/noanswer.sh</code> </pre> <br>  Nous donnons au fichier de script les autorisations pour exécuter: <br><br><pre> <code class="bash hljs">chmod +x /home/asterisk/scripts/noanswer.sh</code> </pre> <br>  En cas de doute sur les droits sur le fichier, vous pouvez donner un accès complet au fichier pendant le débogage.  Mais ce n'est "pas sûr". <br><br><pre> <code class="bash hljs">chmod 777 /home/asterisk/scripts/noanswer.sh</code> </pre> <br>  Le texte du script bash: <br><br><pre> <code class="bash hljs">nano /home/asterisk/scripts/noanswer.sh <span class="hljs-comment"><span class="hljs-comment">##################### #!/bin/bash sleep 7 res_sql="SELECT disposition FROM cdr WHERE uniqueid = '$1'" answer=`mysql -u freepbxuser -pPassword_freepbxuser -D asteriskcdrdb -B -N -e "$res_sql" | grep -E -v "NO ANSWER|BUSY|FAILED|UNKNOWN" | head -n 1` error_kod=0 if [ "$answer" != "ANSWERED" ] then case $3 in 68800) address="big_boss@lucky.ru" subject="  " ;; 63100) address="debian@lucky.ru" subject="  linux debian" ;; 63200) address="windows@lucky.ru" subject="  windows" ;; 63300) address="freebsd@lucky.ru" subject="  freebsd" ;; 63400) address="ubuntu@lucky.ru" subject="  linux ubuntu" ;; 63500) address="centos@lucky.ru" subject="  linux centos" ;; *) address="admin@lucky.ru" error_kod=1 ;; esac case $error_kod in 0) echo "    $2,  $subject." | mail -s "   $2" $address echo "   $address   $2,  $subject. uid=$1" | mail -s "   $2" admin@lucky.ru ;; 1) echo "   $2.  . uid=$1" | mail -s "   $2" admin@lucky.ru ;; esac fi #####################</span></span></code> </pre> <br>  Une brève analyse du script: <br>  "Sleep 7": <br><br>  C'est le même délai que celui que j'ai écrit plus tôt.  Nous avons un délai de 7 secondes.  Bien que, je pense, une seconde suffit. <br><br><pre> <code class="sql hljs">«res_sql="<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> disposition <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> cdr <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> uniqueid = <span class="hljs-string"><span class="hljs-string">'$1'</span></span><span class="hljs-string"><span class="hljs-string">"»:</span></span></code> </pre> <br>  La requête dans mysql nous mettons dans une variable distincte pour plus de commodité. <br><br>  Ensuite, nous faisons une demande dans mysql et filtrons la sortie résultante.  Nous supprimons toutes les options sauf "RÉPONDRE", le cas échéant.  S'il y a plusieurs valeurs «ANSWERED», alors une seule doit être laissée.  À la fin, dans la variable «réponse», nous obtenons «RÉPONSE» ou «». <br>  Si la valeur de la variable de réponse n'est pas égale à RÉPONSE, il s'agit d'un appel manqué.  En fonction du numéro de file d'attente, à l'aide de l'opérateur de cas, nous définirons l'adresse à laquelle il est nécessaire d'envoyer une notification par e-mail, et quoi écrire dans ce message (partie variable du message). <br><br>  Ce qui suit est une option lorsque la file d'attente est définie dans Asterisk, mais n'est pas décrite dans le script.  Dans ce cas, admin@lucky.ru recevra une lettre indiquant que la file d'attente n'est pas connue du script. <br><br>  Si la file d'attente est décrite, une lettre de destination et une lettre en double seront envoyées à admin@lucky.ru indiquant «uniqueid», afin que vous puissiez suivre les événements de cet appel, si nécessaire. <br><br>  Ceci termine le script. <br><br>  Je note que pour se connecter à mysql, nous avons utilisé le nom d'utilisateur et le mot de passe que nous avons reconnus à l'avance.  Dans FreePBX, afin de découvrir la connexion utilisateur Asterisk dans mysql, exécutez la commande suivante: <br><br><pre> <code class="bash hljs">cat /etc/amportal.conf | grep AMPDBUSER</code> </pre> <br>  Et afin de trouver le mot de passe de l'utilisateur Asterisk dans mysql, exécutez la commande suivante: <br><br><pre> <code class="bash hljs">cat /etc/amportal.conf | grep AMPDBPASS</code> </pre> <br>  <b>Configurer Asterisk</b> <br><br>  Nous utilisons FreePBX.  FreePBX a différents types de fichiers de configuration (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://asterisk-pbx.ru/wiki/freepbx/files</a> ), certains d'entre eux sont remplacés par FreePBX au redémarrage, et certains ne sont pas écrasés (ils sont appelés personnalisés), car ils sont spécialement conçus pour l'utilisateur. <br><br>  Nous travaillerons avec le fichier de configuration «extensions_override_freepbx.conf», car il est de type custom. <br><br>  Tout d'abord, assurez-vous que le fichier «extensions_override_freepbx.conf» est connecté dans le fichier «/etc/asterisk/extensions.conf».  Pour ce faire, exécutez la commande suivante: <br><br><pre> <code class="bash hljs">cat /etc/asterisk/extensions.conf | grep extensions_override_freepbx.conf <span class="hljs-comment"><span class="hljs-comment">##################### #include extensions_override_freepbx.conf #####################</span></span></code> </pre> <br>  Nous éditons le fichier "/etc/asterisk/extensions_override_freepbx.conf" et le portons sous la forme suivante: <br><br><pre> <code class="bash hljs">nano /etc/asterisk/extensions_override_freepbx.conf <span class="hljs-comment"><span class="hljs-comment">##################### [ext-queues] exten =&gt; h,1,System(/home/asterisk/scripts/noanswer.sh ${CDR(uniqueid)} ${CALLERID(num)} ${NODEST} &amp;) exten =&gt; h,2,Macro(hangupcall,) #####################</span></span></code> </pre> <br>  Comme je l'ai écrit plus tôt, le symbole «&amp;» à la fin est requis.  Étant donné que nous travaillerons dans un script bash avec des données CDR directement à partir de la base de données mysql, et que ces données ne sont entrées dans mysql qu'après avoir exécuté "exten =&gt; h, 2, Macro (hangupcall,)", nous n'avons pas besoin d'attendre la fin du script bash et passez à l'étape suivante dans Asterisk.  Et le script bash lui-même doit contenir un délai avant d'exécuter sa partie principale. <br><br>  Pour que les modifications du fichier de configuration «/etc/asterisk/extensions_override_freepbx.conf» prennent effet, vous devez redémarrer le noyau Asterisk avec la commande suivante: <br><br><pre> <code class="bash hljs">/usr/sbin/asterisk -rx <span class="hljs-string"><span class="hljs-string">"core restart now"</span></span></code> </pre> <br>  Cela doit être fait après la création du script bash. <br><br>  <b>Conclusion</b> <br><br>  C'est probablement la 1001e façon de «capturer les appels manqués» dans Asterisk.  Partagez dans les commentaires comment vous résolvez ce problème.  Et ce qui, à votre avis, peut être amélioré / refait / optimisé.  Nous serons reconnaissants pour les idées constructives. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463829/">https://habr.com/ru/post/fr463829/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463817/index.html">20 chefs de produits et la structure matricielle la plus multidimensionnelle de tous. Conversation avec Skyeng</a></li>
<li><a href="../fr463819/index.html">Verrous PostgreSQL: 2. Verrous de chaîne</a></li>
<li><a href="../fr463821/index.html">AMO, Bitrix, 1C et autres: comment choisir par où commencer?</a></li>
<li><a href="../fr463823/index.html">Version Rust 1.37.0: optimisation guidée par le profil, constantes sans nom et fournisseur de fret</a></li>
<li><a href="../fr463825/index.html">Outil de gestion de projet Google Sheets</a></li>
<li><a href="../fr463831/index.html">Quel est le problème avec l'enseignement informatique en Russie</a></li>
<li><a href="../fr463833/index.html">Une petite enquête sur les bloqueurs</a></li>
<li><a href="../fr463835/index.html">Cet IdO dangereux: menaces commerciales et solutions</a></li>
<li><a href="../fr463839/index.html">Museum DataArt. Calculatrices Lunolet et soviétique</a></li>
<li><a href="../fr463845/index.html">Télégramme, c'est qui?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>