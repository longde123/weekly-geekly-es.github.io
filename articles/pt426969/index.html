<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê§ ‚úä üçÑ Vigilant Lida: Automa√ß√£o de testes de seguran√ßa üîè üßòüèæ ü¶Ñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Boa tarde, queridos leitores. Meu nome √© Victor Burov, sou desenvolvedor do ISPsystem. No √∫ltimo post, falei sobre a ferramenta para cria√ß√£o de autote...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vigilant Lida: Automa√ß√£o de testes de seguran√ßa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ispsystem/blog/426969/">  Boa tarde, queridos leitores.  Meu nome √© Victor Burov, sou desenvolvedor do ISPsystem.  No √∫ltimo post, falei sobre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ferramenta para cria√ß√£o de autotestes</a> , hoje vou compartilhar minha experi√™ncia na automa√ß√£o de testes de seguran√ßa. <br><br><img src="https://habrastorage.org/webt/9t/xm/uy/9txmuy_rzmrhxjp0mbe4hfobvq8.jpeg"><br><br>  Inicialmente, as vulnerabilidades nos produtos foram pesquisadas por um funcion√°rio separado.  O teste manual levou muito tempo e n√£o garantiu que todas as vulnerabilidades fossem encontradas.  Tendo verificado as leis b√°sicas dos testes, chegamos √† conclus√£o de que ele pode ser automatizado.  Decidimos escrever um utilit√°rio que facilitar√° a vida do testador, economize seu tempo e permita que voc√™ verifique os produtos ap√≥s cada altera√ß√£o.  Como o testador foi chamado Lida, nomeamos o novo aplicativo em sua homenagem.  Em geral, em nossa empresa, tornou-se uma tradi√ß√£o chamar as ferramentas de teste pelos nomes dos testadores. <br><a name="habracut"></a><br>  Ap√≥s analisar os utilit√°rios de pesquisa de vulnerabilidades, cheguei √† conclus√£o de que todos precisam especificar as fun√ß√µes a serem chamadas e os par√¢metros usados.  Decidimos novamente aproveitar a interface unificada e formulamos os requisitos para o Lida. <br><br><h4>  Requisitos de inicializa√ß√£o: </h4><br><ol><li>  Crie automaticamente listas de fun√ß√µes. </li><li>  Op√ß√µes de preenchimento autom√°tico. </li><li>  Fazendo solicita√ß√µes de API. </li><li>  An√°lise da sa√≠da de dados ap√≥s a execu√ß√£o de fun√ß√µes. </li><li>  Pesquise vulnerabilidades nos dados. </li><li>  Forma√ß√£o de relat√≥rios. </li><li>  Configura√ß√µes flex√≠veis. </li></ol><br>  Perceber tudo isso n√£o foi f√°cil. <br><br><h2>  Implementa√ß√£o </h2><br><h3>  Ignorar formul√°rios e listas </h3><br>  Para encontrar vulnerabilidades em uma fun√ß√£o, ela deve ser executada passando os par√¢metros necess√°rios.  Nossa interface √© constru√≠da com base em listas e formul√°rios, para que voc√™ possa automatizar a coleta de dados processando documentos xml que descrevem a estrutura dos elementos da interface. <br><br>  Decidi iniciar o rastreamento no menu principal, entrando recursivamente em todas as listas aninhadas.  "Lida" abre a lista do primeiro n√≠vel.  Como regra, possui v√°rios bot√µes que invocam algumas fun√ß√µes. <br><br>  Se o bot√£o abrir o formul√°rio, o resultado da chamada ser√° um documento xml com n√≥s contendo informa√ß√µes sobre os campos: nome, validador, intervalo de valores v√°lidos.  Com base nessas informa√ß√µes, os valores do campo s√£o gerados.  Por exemplo, um n√∫mero ser√° gerado para int.  Se n√£o houver validador, uma sequ√™ncia aleat√≥ria ser√° gerada.  Ap√≥s preencher todos os campos do formul√°rio, uma solicita√ß√£o √© enviada. <br><br>  Se a fun√ß√£o for uma lista, ela ser√° aberta e as fun√ß√µes associadas aos bot√µes ser√£o chamadas para seus elementos. <br><br>  Ao verificar listas, surge um problema - todas as listas devem ter um conjunto de registros que garantam que todos os bot√µes da lista sejam clic√°veis. <br><br><h3>  Pesquisa por inje√ß√£o SQL </h3><br>  A inje√ß√£o de SQL √© provavelmente um dos problemas mais comuns para aplicativos, incluindo o nosso.  Muitas chamadas de fun√ß√£o geram v√°rias consultas ao DBMS.  Ocorre um erro quando par√¢metros que v√™m de fora s√£o substitu√≠dos no corpo da solicita√ß√£o "como est√£o".  As conseq√º√™ncias de tais erros podem ser tristes: do recebimento n√£o autorizado de dados √† exclus√£o de tabelas. <br><br>  Para iniciar a busca por inje√ß√µes de SQL, organizei a sa√≠da de todas as consultas SQL para um arquivo.  Depois que a fun√ß√£o √© executada, o aplicativo procura os valores dos par√¢metros passados ‚Äã‚Äãnas consultas SQL resultantes. <br><br>  <i>Voc√™ pode usar o log do pr√≥prio servidor SQL.</i>  <i>Mas, no nosso caso, s√≥ existe um m√©todo para executar consultas e adicionar log a ele n√£o foi dif√≠cil.</i>  <i>Gra√ßas a isso, sabemos exatamente qual desafio gerou essa ou aquela solicita√ß√£o.</i> <br><br>  Quando o valor do par√¢metro passado √© encontrado, o utilit√°rio passa um valor que cont√©m uma aspas simples para esse par√¢metro.  Se a cota√ß√£o for encontrada na mesma sequ√™ncia, o par√¢metro n√£o ser√° escapado - encontramos um local para inje√ß√£o de SQL. <br><br><h3>  An√°lise de chamadas do sistema </h3><br>  Um problema semelhante ocorre quando fazemos chamadas do sistema.  Decidi procur√°-los com strace e selecionei os par√¢metros de inicializa√ß√£o ideais para ele.  Exemplo de inicializa√ß√£o do ISPmanager: <br><br><pre><code class="xml hljs">strace -f -s 1024 -e trace=file,process bin/core ispmgr</code> </pre> <br>  Como nas inje√ß√µes de SQL, o Lida executa uma fun√ß√£o e analisa a sa√≠da strace para <i>encontrar os</i> valores dos par√¢metros passados ‚Äã‚Äãnas fun√ß√µes <i>open, unlink, rmdir, chmod chown, chflags, mknod, mkfifo, fcntl, symlink, link, execve, mkdir</i> . <br><br>  Se o par√¢metro for encontrado, o utilit√°rio passa um valor para ele, contendo, por exemplo, um caminho com uma transi√ß√£o para o diret√≥rio acima.  Se ficar como est√°, ser√° encontrada uma vulnerabilidade em potencial. <br><br>  A an√°lise da fun√ß√£o execve acabou sendo muito √∫til.  Ele permite determinar em quais argumentos da fun√ß√£o para executar arquivos execut√°veis ‚Äã‚Äãn√£o s√£o escapados.  Este erro √© muito caro, porque atrav√©s dele voc√™ pode obter acesso root ao servidor simplesmente alterando a senha. <br><br><blockquote>  Quando os usu√°rios encontram uma vulnerabilidade em nossos produtos, a empresa paga uma recompensa em dinheiro, cuja quantia depende da categoria de vulnerabilidade.  Essa abordagem pode ser mais barata do que procurar erros por conta pr√≥pria (o testador pode n√£o encontrar o erro e receber um sal√°rio). </blockquote><br>  <i>Outro teste interessante: verificar a ordem de chamar as fun√ß√µes stat e outras.</i>  <i>Freq√ºentemente, o acesso √© verificado primeiro por meio do stat e depois de algumas a√ß√µes inseguras, o que deixa a oportunidade de substitui√ß√£o.</i>  <i>Mas n√£o automatizamos isso.</i> <br><br><h3>  Verificando o acesso a objetos estranhos </h3><br>  Verificamos o acesso a objetos estranhos sob o usu√°rio para as entidades de outro usu√°rio e administrador.  Nesse modo, verificamos a capacidade de ler, modificar e visualizar as listas de elementos de um usu√°rio estrangeiro. <br><br>  O Lida ignora todas as fun√ß√µes dispon√≠veis em nome do propriet√°rio ou administrador e lembra seus elementos.  Em seguida, chama as mesmas fun√ß√µes com elementos de outro usu√°rio.  Em uma situa√ß√£o ideal, a resposta deve ser um erro como Acesso ou Perdido.  Se esse erro n√£o for recebido, √© muito prov√°vel que voc√™ possa ler os dados do usu√°rio de outra pessoa. <br><br>  Em alguns casos, a aus√™ncia de um erro n√£o significa que voc√™ pode acessar diretamente os objetos de outros usu√°rios.  No in√≠cio de tais fun√ß√µes, adicionamos uma verifica√ß√£o de permiss√µes de elemento.  Isso verifica n√£o apenas a seguran√ßa, mas tamb√©m a corre√ß√£o das respostas do servidor. <br><br><h3>  Valida√ß√£o de API </h3><br>  A valida√ß√£o da nossa API √© um b√¥nus adicional de verifica√ß√£o de vulnerabilidades nas fun√ß√µes.  Analisando relat√≥rios sobre o trabalho de Lida, aprendemos a retornar os tipos corretos de erros, tornamos nossa API mais conveniente e l√≥gica.  Como resultado, como no gravador, recebemos n√£o apenas uma verifica√ß√£o de seguran√ßa, mas tamb√©m verificamos novamente nossa API quanto √† "consist√™ncia". <br><br><h2>  Dificuldades </h2><br><h4>  Falsos positivos </h4><br>  O utilit√°rio pode trabalhar com todos os nossos produtos, portanto, verifica muitas fun√ß√µes diferentes.  Basicamente, os falsos positivos apareceram no modo de verificar o acesso a objetos estranhos.  Isso ocorre devido aos recursos dos bot√µes e fun√ß√µes. <br><br>  Os falsos positivos foram o maior problema de Lida.  Parecia que estava completamente depurado, mas ao verificar em pain√©is diferentes, surgiram novos falsos positivos.  Como resultado, houve v√°rias etapas de sua corre√ß√£o. <br><br><h4>  Cria√ß√£o de Entidades </h4><br>  A maioria das a√ß√µes no painel √© realizada em qualquer entidade (nome de dom√≠nio, banco de dados, etc.).  Para alcan√ßar o m√°ximo de automa√ß√£o, a Lida precisou criar essas entidades automaticamente.  Mas, na pr√°tica, isso foi dif√≠cil de implementar.  √Äs vezes, a valida√ß√£o √© realizada no c√≥digo, portanto nem sempre √© poss√≠vel substituir um valor de par√¢metro automaticamente.  O segundo motivo s√£o entidades dependentes.  Por exemplo, para criar uma caixa de correio, voc√™ precisa criar um dom√≠nio de email. <br><br>  Portanto, decidimos n√£o lutar pela automa√ß√£o completa.  Antes de iniciar, o testador cria entidades manualmente e tira uma captura instant√¢nea da m√°quina, pois as entidades ser√£o alteradas ap√≥s a verifica√ß√£o.  Isso permite que voc√™ n√£o pule a verifica√ß√£o de um grupo de fun√ß√µes em caso de cria√ß√£o malsucedida de uma entidade. <br><br><h4>  Chamando fun√ß√µes destrutivas </h4><br>  Quase toda lista possui fun√ß√µes para excluir ou desativar uma entidade.  Se voc√™ execut√°-los em sequ√™ncia, a entidade ser√° exclu√≠da antes de executar outras fun√ß√µes.  Eu defino essas fun√ß√µes e realizo outras.  Al√©m disso, adicionou uma chave que pro√≠be a execu√ß√£o de tais fun√ß√µes. <br><br>  Algumas fun√ß√µes reiniciam o servidor.  Eles precisam ser rastreados e adicionados √† lista de ignorados. <br><br>  Devido √† natureza da l√≥gica operacional, algumas fun√ß√µes reiniciam o painel.  Durante o teste de seguran√ßa, isso faz com que o painel inicie sem rastrear consultas SQL ou rastrear - a verifica√ß√£o adicional se torna sem sentido.  Voc√™ precisa acompanhar isso e reiniciar o painel no modo de rastreamento. <br><br><h4>  Verificando par√¢metros dependentes </h4><br>  Nos formul√°rios, existem campos para inserir texto, caixas de sele√ß√£o e listas suspensas, cujos valores dependem da disponibilidade de outros campos.  Cada valor do campo dependente pode ter uma se√ß√£o separada de c√≥digo; portanto, as partes em que podem permanecer n√£o verificadas. <br><br>  Para resolver esse problema, adicionei algoritmos para analisar campos dependentes e verificar todas as combina√ß√µes de controles dependentes. <br><br><h4>  Verificando os recursos n√£o dispon√≠veis na interface </h4><br>  As fun√ß√µes de servi√ßo n√£o est√£o dispon√≠veis para transi√ß√£o, mas podem conter vulnerabilidades.  Para identific√°-los e verific√°-los, temos uma fun√ß√£o especial que retorna uma lista de todas as fun√ß√µes registradas.  Comparamos esta lista com a lista de fun√ß√µes testadas.  N√£o existem metadados para fun√ß√µes de servi√ßo, portanto, √© imposs√≠vel verificar os par√¢metros processados ‚Äã‚Äãdentro <i>deles.Para de</i> alguma forma verificar tais fun√ß√µes, passo neles nossos par√¢metros padr√£o <i>elid, plid</i> e outros. <br><br><h2>  Conclus√£o </h2><br>  Inclu√≠mos Lida em todas as noites na Jenkins.  Com base nos resultados de seu trabalho, um relat√≥rio de verifica√ß√£o √© gerado, informa√ß√µes sobre a fun√ß√£o suspeita nele s√£o exibidas com todos os par√¢metros. <br><br>  A tarefa encerrada pelo desenvolvedor agora √© verificada n√£o apenas pelo testador, mas tamb√©m pela Lida.  O testador processa o relat√≥rio recebido: copia os par√¢metros da fun√ß√£o suspeita no navegador e analisa o comportamento e o painel de log.  Se a vulnerabilidade for confirmada, o erro ser√° registrado no desenvolvedor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt426969/">https://habr.com/ru/post/pt426969/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt426959/index.html">Instale o kubernetes via kubespray (armazenamento local, instale Elasticsearch + Fluentd + Kibana, prometheus)</a></li>
<li><a href="../pt426961/index.html">Como a Microsoft reescreveu o compilador C # em C # e o abriu</a></li>
<li><a href="../pt426963/index.html">Os aplicativos Flutter sonham com widgets baseados em plataforma?</a></li>
<li><a href="../pt426965/index.html">O que acontecer√° com o tratamento de erros no C ++ 2a</a></li>
<li><a href="../pt426967/index.html">Gerador de c√≥digo ABAP online</a></li>
<li><a href="../pt426971/index.html">Fatalismo no tratamento de erros</a></li>
<li><a href="../pt426973/index.html">Sandu√≠ches corporativos</a></li>
<li><a href="../pt426975/index.html">Coringa 2018: o imposs√≠vel √© poss√≠vel</a></li>
<li><a href="../pt426977/index.html">LibreOffice: pesadelo do contador</a></li>
<li><a href="../pt426979/index.html">Como aprender ingl√™s de gra√ßa: 3 ferramentas comuns e instru√ß√µes detalhadas para cada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>