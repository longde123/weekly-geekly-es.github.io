<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëèüèæ üë®üèæ‚Äç‚úàÔ∏è üßòüèΩ Servidor web CentOS 8 com php7, node.js e redis üë∑ üêï üóØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pref√°cio 
 Faz dois dias desde que a nova vers√£o do sistema operacional CentOS foi lan√ßada, a saber, o CentOS 8. E at√© agora existem alguns artigos na...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor web CentOS 8 com php7, node.js e redis</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469097/"><h2>  Pref√°cio </h2><br>  Faz dois dias desde que a nova vers√£o do sistema operacional CentOS foi lan√ßada, a saber, o CentOS 8. E at√© agora existem alguns artigos na Internet sobre como fazer algo nele, ent√£o decidi preencher essa lacuna.  Al√©m disso, falarei n√£o apenas sobre como instalar esse par de programas, mas tamb√©m sobre como geralmente vejo a instala√ß√£o do Linux em um ambiente virtual no mundo moderno para tarefas comuns, incluindo particionamento de disco e muito mais. <br><br>  Mas, no come√ßo, quero falar brevemente sobre por que voc√™ deve mudar para esta vers√£o de todas as anteriores, e h√° duas raz√µes para isso: <br><a name="habracut"></a><br><ol><li>  php7!  Na vers√£o anterior do CentOS, o php5.4 "ortodoxo" foi instalado ... <br><br>  Bem, se um pouco mais s√©rio, muitos pacotes passaram por v√°rias vers√µes em massa.  N√≥s (f√£s do sistema operacional redhat-like) finalmente entramos, se n√£o no futuro, pelo menos no presente.  E os apoiadores do Ubuntu n√£o v√£o mais rir de n√≥s e cutucar seus dedos, bem ... pelo menos por um tempo;). </li><li>  Transi√ß√£o de yum para dnf.  A principal diferen√ßa √© que agora o trabalho com v√°rias vers√µes de pacotes √© oficialmente suportado.  Bem aqui na figura oito, nunca foi √∫til para mim ainda, mas parece promissor. </li></ol><br><h2>  Criando uma m√°quina virtual </h2><br>  Os hipervisores s√£o diferentes e n√£o tenho o objetivo de aprimorar o leitor para um espec√≠fico; falarei sobre princ√≠pios gerais. <br><br><h3>  A mem√≥ria </h3><br>  Primeiro ... Para instalar o sistema CentOS a partir do 7, com certeza, e na minha opini√£o aos 6 era o mesmo (‚Äúmas isso n√£o √© preciso‚Äù), s√£o necess√°rios <i>pelo menos</i> 2 GB de RAM.  Portanto, eu aconselho voc√™ a come√ßar e dar muito. <br><br>  Mas se isso, ap√≥s a instala√ß√£o, a quantidade de mem√≥ria pode ser reduzida.  Com 1 GB, o sistema simples funciona muito bem, verifiquei. <br><br><h3>  Drive </h3><br>  Para uma instala√ß√£o normal, crie um disco virtual de 20 a 30 GB.  Isso √© suficiente para o sistema.  E um segundo disco para dados.  Ele pode ser adicionado na fase de cria√ß√£o de uma m√°quina virtual e depois.  Eu costumo adicionar mais tarde. <br><br><h3>  CPU </h3><br>  Em um n√∫cleo, um sistema simples n√£o diminui a velocidade.  E como os recursos s√£o escal√°veis ‚Äã‚Äãlivremente, n√£o vejo sentido em dar mais no est√°gio de instala√ß√£o (a menos que voc√™ conhe√ßa idealmente os requisitos e tenha pregui√ßa de entrar no configurador novamente) <br><br>  O restante geralmente pode ser deixado por padr√£o. <br><br><h2>  Instala√ß√£o em si </h2><br>  Ent√£o ... Iniciamos o instalador ... Pessoalmente, eu venho colocando esses servi√ßos h√° muito tempo apenas na forma de m√°quinas virtuais, por isso n√£o descreverei todas as grava√ß√µes do kit de distribui√ß√£o em uma unidade flash USB - apenas montei o ISO como um CD no meu hipervisor favorito, baixe-o e dirija-o. <br><br>  A instala√ß√£o b√°sica √© bastante t√≠pica, vou me concentrar apenas em alguns pontos. <br><br><h3>  Sele√ß√£o de fonte </h3><br>  Desde o lan√ßamento da oitava vers√£o, o espelho da Yandex ficou deitado o dia todo.  Bem, isto √©, aumenta periodicamente e, em seguida, novamente come√ßa a mostrar um erro.  Estou certo de que o assunto √© uma carga excessiva no servi√ßo.  Portanto, para indicar a fonte, eu pessoalmente tive que, em vez de inserir o endere√ßo usual, v√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , selecione o espelho que eu gosto l√° e insira manualmente o endere√ßo na janela do instalador.  √â importante lembrar que voc√™ deve especificar o caminho para a pasta em que o <b>diret√≥rio repodata est√° localizado</b> .  Por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mirror.corbina.net/pub/Linux/centos/8/BaseOS/x86_64/os</a> . <br><br><h3>  Divis√£o de disco </h3><br>  Esta quest√£o √© bastante religiosa na minha opini√£o.  Cada administrador tem sua pr√≥pria posi√ß√£o sobre esse assunto.  Mas ainda compartilho meu ponto de vista sobre a quest√£o. <br><br>  Sim, em princ√≠pio, voc√™ pode alocar todo o local para a raiz e o trabalho, na maioria das vezes √© at√© muito bom.  Por que cercar um jardim com se√ß√µes diferentes?  - As principais raz√µes para isso, na minha opini√£o 2: cotas e portabilidade. <br><br>  Por exemplo, se algo der errado e ocorrerem erros na se√ß√£o principal de dados, desejo poder carregar o sistema de qualquer maneira e executar medidas de ressuscita√ß√£o.  Portanto, eu pessoalmente aloco uma parti√ß√£o separada em / boot.  A√≠ reside o kernel e o carregador de inicializa√ß√£o.  Geralmente, 500 megabytes s√£o suficientes, mas em casos raros, pode demorar mais e, como j√° estamos acostumados a medir o espa√ßo com terabytes, aloco 2 GB para esta se√ß√£o.  E aqui √© importante que isso n√£o possa ser feito lvm. <br><br>  Em seguida, vem a raiz do sistema.  Para uma instala√ß√£o normal, nunca precisei de mais de 4 GB por sistema, mas durante eventos agendados, geralmente uso o diret√≥rio / tmp para descompactar distribui√ß√µes e n√£o vejo o ponto de destac√°-lo como uma se√ß√£o separada - em sistemas modernos, ele √© limpo automaticamente, portanto, n√£o √© preenchido. .  Ent√£o, na raiz eu aloco 8GB. <br><br>  Trocar ... Em geral, h√° pouco benef√≠cio pr√°tico com isso.  Se voc√™ come√ßou a usar o swap no servidor, hoje no mundo real isso significa apenas que o servidor precisa adicionar mais RAM.  Caso contr√°rio, os problemas de desempenho s√£o garantidos (ou algum programa tem vazamento de mem√≥ria).  Portanto, esta se√ß√£o √© apenas para fins de diagn√≥stico.  Portanto, 2 GB √© um grande n√∫mero.  Sim, n√£o importa quanta mem√≥ria o servidor tenha.  Sim, eu li todos os artigos em que est√° escrito sobre a propor√ß√£o de mem√≥ria para trocar volume ... IMHO, eles est√£o desatualizados.  Por 10 anos de pr√°tica, isso nunca foi √∫til para mim.  15 anos atr√°s eu os usei, sim. <br><br>  Todos podem decidir se deseja alocar / casa em uma se√ß√£o separada IMHO.  Se algu√©m usar ativamente esse diret√≥rio no servidor, √© melhor destacar.  Se ningu√©m - sem motivo. <br><br>  Em seguida, / var.  Na minha opini√£o, √© necess√°rio destac√°-lo.  Para iniciantes, voc√™ pode limitar-se a um n√∫mero de 4 GB e depois como vai.  E sim, com "como vai", quero dizer que <br><br><ol><li>  Primeiramente, voc√™ sempre pode montar outro disco no subdiret√≥rio / var (que mostrarei posteriormente com um exemplo) </li><li>  Em segundo lugar, temos lvm - voc√™ sempre pode adicionar.  E geralmente voc√™ deve adicionar quando muitos logs come√ßarem a aparecer l√°.  Mas nunca fui capaz de prever esse n√∫mero antecipadamente, ent√£o come√ßo com 2 GB e depois procuro. </li></ol><br>  O espa√ßo n√£o alocado permanecer√° livre no grupo de volumes, e voc√™ sempre poder√° us√°-lo mais tarde. <br><br><h4>  LVM </h4><br>  <b>Faz</b> sentido criar <b>todas as</b> parti√ß√µes, exceto / boot no LVM.  Sim, incluindo swap.  Sim, a troca de todas as dicas deve estar no in√≠cio do disco e, no caso do LVM, sua localiza√ß√£o n√£o pode ser determinada em princ√≠pio.  Mas como eu escrevi acima, seu sistema <i>n√£o deve</i> usar swap.  Portanto, n√£o importa onde ele esteja.  Bem, n√£o em 95 vivemos, honestamente! <br><br>  Al√©m disso, no LVM existem v√°rias entidades b√°sicas com as quais voc√™ deve poder viver: <br><br><ul><li>  volume f√≠sico </li><li>  grupo de volumes </li><li>  volume l√≥gico </li></ul><br>  Os volumes f√≠sicos s√£o agrupados, com cada volume f√≠sico em apenas um grupo e o grupo pode estar em v√°rios volumes f√≠sicos ao mesmo tempo. <br>  E os volumes l√≥gicos est√£o no mesmo grupo. <br><br>  Mas ... N√≥s, caramba, somos novamente o s√©culo 21 no quintal.  E os servidores s√£o virtuais.  N√£o faz sentido aplicar a eles os mesmos mecanismos que foram aplicados aos f√≠sicos.  E para virtual, √© importante ter dados separados do sistema!  Isso √© muito importante, em particular, pela capacidade de alternar rapidamente dados para outra m√°quina virtual (por exemplo, ao alternar para um novo sistema operacional) e, em geral, todos os tipos de vantagens √∫teis (backups separados por se√ß√µes usando o hipervisor, por exemplo).  Portanto, um grupo de volumes √© usado para o sistema e necessariamente outro √© usado para dados!  Essa separa√ß√£o l√≥gica ajuda muito na vida! <br><br>  Se voc√™ criou apenas um disco r√≠gido virtual ao criar uma m√°quina virtual, este √© o fim da configura√ß√£o.  E se dois, ent√£o simplesmente n√£o marque o segundo ainda. <br><br>  <b>Iniciamos a instala√ß√£o.</b> <br><br><h2>  P√≥s-instala√ß√£o </h2><br>  Portanto, o sistema rec√©m-instalado finalmente foi inicializado.  A primeira coisa a verificar √© a Internet. <br><br><pre><code class="bash hljs">ping ya.ru</code> </pre> <br>  Existe uma resposta?  - Tudo bem, pressione Ctrl-C. <br>  Caso contr√°rio, v√° configurar a rede, n√£o h√° vida sem isso, mas meu artigo n√£o √© sobre isso. <br><br>  Agora, se ainda n√£o estamos na raiz, vamos para a raiz, porque, para digitar tantos comandos com o sudo, eu pessoalmente vlom (e os administradores paran√≥icos me perdoam): <br><br><pre> <code class="bash hljs">sudo -i</code> </pre> <br>  Agora, a primeira coisa que digitamos <br><br><pre> <code class="bash hljs">dnf -y update</code> </pre> <br>  E se voc√™ ler este artigo em 2019, provavelmente nada acontecer√°, mas valeu a pena tentar. <br><br><h3>  Agora configure a unidade restante </h3><br>  Suponha que tenhamos uma parti√ß√£o xvda com um sistema, ent√£o o disco de dados ser√° xvdb.  Ok <br><br>  A maioria das dicas come√ßar√° com as palavras "Inicie o fdisk e crie uma parti√ß√£o ..." <br><br>  Ent√£o, isso <i>n√£o √© verdade</i> ! <br><br>  Vou repetir a panqueca novamente, porque √© importante!  Nesse caso, trabalhar com o LVM, que ocupa um todo, deixar um disco virtual criar parti√ß√µes nele √© prejudicial!  Cada palavra √© importante nesta frase.  Se trabalharmos sem LVM - √© necess√°rio.  Se dizemos no sistema de disco e dados - √© necess√°rio.  Se, por algum motivo, precisamos deixar metade do disco vazio - tamb√©m √© necess√°rio.  Mas geralmente todas essas suposi√ß√µes s√£o puramente te√≥ricas.  Como se decidirmos adicionar lugares √† se√ß√£o existente, a maneira mais f√°cil de fazer isso √© com essa configura√ß√£o.  E a facilidade de administra√ß√£o supera tanto que estamos deliberadamente avan√ßando em dire√ß√£o a essa configura√ß√£o. <br><br>  E a conveni√™ncia √© que, se voc√™ deseja expandir a se√ß√£o de dados, basta adicionar espa√ßo √† se√ß√£o virtual e expandir o grupo com vgextend e pronto!  Em casos raros, pode ser necess√°rio algo mais, mas pelo menos voc√™ n√£o precisa expandir no in√≠cio a l√≥gica, o que j√° √© bom.  E ent√£o, para expandir esse volume, recomenda-se excluir o existente no in√≠cio e criar um novo no topo ... O que n√£o parece muito bom e n√£o pode ser feito ao vivo, e a expans√£o de acordo com o cen√°rio especificado pode ser feita em tempo real sem desmontar a parti√ß√£o. <br><br>  No total, criamos um volume f√≠sico, depois um grupo de volumes, incluindo ele e, em seguida, uma se√ß√£o para o nosso servidor: <br><br><pre> <code class="bash hljs">pvcreate /dev/xvdb vgcreate data /dev/xvdb lvcreate -n www -L40G data mke2fs -t ext4 /dev/mapper/data-www</code> </pre><br>  Aqui, em vez da letra mai√∫scula "L" (e o tamanho em GB), voc√™ pode especificar uma letra pequena e indicar o tamanho relativo em vez do tamanho absoluto, por exemplo, para usar metade do espa√ßo atualmente dispon√≠vel no grupo de volumes, voc√™ deve especificar "-l + 50% GR√ÅTIS" <br><br>  E o √∫ltimo comando formata a parti√ß√£o no sistema de arquivos ext4 (que at√© agora, na minha pr√°tica, mostra a maior estabilidade caso tudo quebre, por isso prefiro). <br><br>  Agora monte a parti√ß√£o no lugar certo.  Para fazer isso, adicione a linha correta ao / etc / fstab: <br><br><pre> <code class="bash hljs">/dev/mapper/data-www /var/www ext4 defaults 1 2</code> </pre> <br>  E n√≥s digitamos <br><br><pre> <code class="bash hljs">mount /var/www</code> </pre> <br>  Se um erro aparecer - soamos o alarme!  Porque isso significa que temos um erro no / etc / fstab.  E que na pr√≥xima reinicializa√ß√£o teremos grandes problemas.  O sistema pode n√£o inicializar, o que geralmente √© muito triste para os servi√ßos em nuvem.  Portanto, voc√™ deve corrigir urgentemente a √∫ltima linha anexada ou exclu√≠-la completamente!  √â por isso que n√£o come√ßamos a escrever o comando mount manualmente - ent√£o n√£o ter√≠amos uma oportunidade excelente para verificar a configura√ß√£o dos aparelhos diretos para casa. <br><br>  Agora, na verdade, colocamos tudo o que quer√≠amos e abrimos as portas na Web: <br><br><pre> <code class="bash hljs">dnf groupinstall <span class="hljs-string"><span class="hljs-string">"Development Tools"</span></span> dnf -y install httpd @nodejs @redis php firewall-cmd --add-service http --permanent firewall-cmd --add-service https --permanent</code> </pre><br>  Opcionalmente, voc√™ tamb√©m pode colocar o banco de dados aqui, mas pessoalmente, tento mant√™-lo separado do servidor da web.  Embora mant√™-la perto seja mais r√°pido, sim.  A velocidade dos adaptadores de rede virtual geralmente est√° na regi√£o de gigabit e, ao trabalhar na mesma m√°quina, o acesso ocorre quase instantaneamente.  Mas menos seguro.  Aqui para quem √© mais importante. <br><br>  Agora adicione o par√¢metro ao arquivo de configura√ß√£o (crie uma nova e moderna ideologia do CentOS como esta) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"vm.overcommit_memory = 1"</span></span>&gt; /etc/sysctl.d/98-sysctl.conf</code> </pre> <br>  Reinicie o servidor. <br>  Nos coment√°rios, fui criticado por aconselh√°-lo a desativar o SeLinux, por isso vou corrigi-lo e escrever sobre o fato de que depois disso voc√™ deve se lembrar de configurar o SeLinux. <br>  <b>Na verdade, lucro!</b>  <b>:)</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt469097/">https://habr.com/ru/post/pt469097/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt469079/index.html">Python no c√≥digo do Visual Studio: atualiza√ß√£o de extens√£o de setembro</a></li>
<li><a href="../pt469085/index.html">Retiramos o software do microcontrolador protegido por senha Renesas M16C</a></li>
<li><a href="../pt469087/index.html">MVCC no PostgreSQL-2. Garfos, arquivos, p√°ginas</a></li>
<li><a href="../pt469093/index.html">Compara√ß√£o de bibliotecas menos populares e n√£o muito CLI: cliff, plac, plumbum e outras (parte 2)</a></li>
<li><a href="../pt469095/index.html">Lan√ßadas atualiza√ß√µes do ML.NET e do Model Builder: O que h√° de novo</a></li>
<li><a href="../pt469099/index.html">Tarefas de teste na entrevista do desenvolvedor - isso faz sentido?</a></li>
<li><a href="../pt469101/index.html">Aprendendo ingl√™s: como aprender a falar como falante nativo</a></li>
<li><a href="../pt469109/index.html">Brinquedos de madeira, parte tr√™s - 1989</a></li>
<li><a href="../pt469111/index.html">Substitua Object por var: o que poderia dar errado?</a></li>
<li><a href="../pt469115/index.html">Guia Discovery.js: In√≠cio r√°pido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>