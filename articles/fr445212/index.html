<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤷🏾 😍 😥 NetBIOS entre les mains d'un pirate 👩🏼‍🤝‍👩🏻 🤮 🙇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cet article contiendra une courte histoire sur ce que nous pouvons dire d'une chose aussi familière que NetBIOS . Quelles informations peut-il fournir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>NetBIOS entre les mains d'un pirate</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445212/"> Cet article contiendra une courte histoire sur ce que nous pouvons dire d'une chose aussi familière que <i>NetBIOS</i> .  Quelles informations peut-il fournir à un attaquant / pentester potentiel? <a name="habracut"></a><br><br>  Le domaine d'application démontré des techniques de reconnaissance concerne les réseaux internes, c'est-à-dire isolés et inaccessibles aux réseaux extérieurs.  En règle générale, ces réseaux existent pour toute entreprise, même la plus petite. <br><br>  <i>NetBIOS</i> lui-même est généralement utilisé pour obtenir un nom de réseau.  Et ce sera suffisant pour faire au moins 4 choses. <br><br><h4>  Découverte d'hôte </h4><br>  Du fait que NetBIOS peut utiliser UDP comme transport, sa vitesse permet de détecter des hôtes dans de très grands réseaux.  Ainsi, par exemple, l'outil <i>nbtscan</i> inclus dans le package du même nom ne peut résoudre les adresses réseau de type 192.168.0.0/16 qu'en 2 secondes (il peut mettre un réseau), tandis que l'analyse TCP traditionnelle prendra des dizaines de minutes.  Cette fonctionnalité peut être utilisée comme technique de balayage d'hôte dans de très grands réseaux qui ne sont pas connus avant de démarrer nmap.  Bien que le résultat ne garantisse pas une détection à 100%, puisque les hôtes Windows répondront la plupart du temps et pas tous, il vous permettra toujours de déterminer approximativement dans quelles plages se trouvent les hôtes actifs. <br><br><h4>  Identification de l'hôte </h4><br>  Utilisation des résultats de l'obtention de noms à partir d'adresses IP: <br><br><img src="https://habrastorage.org/webt/t7/pa/hv/t7pahvwb67vd6ee85boatugvgwg.png" alt="image"><br><br>  vous pouvez voir: en plus du fait que le nom révèle le propriétaire du poste de travail (bien que ce soit d'ailleurs loin d'être toujours le cas), l'une des adresses se démarque clairement des autres.  Nous pouvons voir que le nom <i>KALI a</i> été reçu.  Ce comportement est typique, en règle générale, pour l'implémentation <i>unix</i> de <i>SMB / NetBIOS</i> dans le cadre du progiciel <i>samba</i> ou de très vieux <i>Windows 2000</i> . <br><br>  Obtenir le nom <i>KALI</i> , tandis que sur d'autres hôtes, ce &lt; <i>inconnu</i> &gt; indique la présence de la soi-disant <i>session nulle</i> .  Avec les paramètres par défaut, le serveur <i>SMB</i> sous <i>linux y est</i> sujet.  <i>Null-session</i> ne vous permet d'obtenir que beaucoup d'informations supplémentaires, telles qu'une politique de mot de passe locale, une liste d'utilisateurs locaux, des groupes et une liste de ressources partagées (boule), de manière absolument anonyme (et nous n'avons pas entré de mot de passe, comme vous pouvez le voir à l'écran): <br><br><img src="https://habrastorage.org/webt/yr/v9/qs/yrv9qsux-chofihfntozw8i3xki.png" alt="image"><br><br>  Souvent, sur les serveurs <i>Linux SMB</i> , il y a des boules accessibles au public, non seulement pour la lecture, mais même pour l'écriture.  La présence des deux porte diverses menaces, dont l'utilisation dépasse le cadre de cet article. <br><br>  <i>NetBIOS</i> vous permet également d'obtenir les noms de tous les types que la station de travail stocke: <br><br><img src="https://habrastorage.org/webt/oo/mw/te/oomwtezmse069cd8umqv1s_x3k8.png" alt="image"><br><br>  dans ce cas, il vous permet de découvrir que l'hôte est également un <i>contrôleur de</i> domaine <i>ARRIVA</i> . <br><br>  Il convient également de prêter une attention supplémentaire au fait que <i>NetBIOS</i> vous permet d'obtenir une adresse <i>mac</i> .  De plus, contrairement aux requêtes arp, les requêtes NetBIOS peuvent aller au-delà du sous-réseau.  Cela peut être utile si, par exemple, vous devez trouver un ordinateur portable ou du matériel spécifique sur le réseau, en connaissant son fabricant.  Étant donné que les trois premiers octets de l'adresse <i>mac</i> identifient le fabricant, vous pouvez envoyer des demandes <i>NetBIOS</i> similaires à tous les sous-réseaux connus pour essayer de trouver le périphérique dont vous avez besoin (http://standards-oui.ieee.org/oui.txt). <br><br><h4>  Détermination de l'appartenance au domaine </h4><br>  Souvent, lorsque vous vous déplacez à travers des réseaux d'entreprise internes, il est nécessaire d'attaquer le poste de travail inclus dans le domaine (par exemple, pour élever les privilèges au niveau d'un administrateur de domaine) ou vice versa.  Dans ce cas, <i>NetBIOS peut à</i> nouveau vous aider: <br><br><img src="https://habrastorage.org/webt/ad/y0/rf/ady0rfad1qrtpy1l36xvreapkbo.png" alt="image"><br><br>  Dans ce cas, en utilisant <i>NetBIOS</i> , tous les noms de tous les types ont été obtenus.  Parmi eux, vous pouvez voir, en plus du nom du PC (ce qui a déjà été reçu auparavant), le nom du groupe de travail.  Par défaut pour <i>Windows,</i> il s'agit généralement de <i>WORKGROUP</i> ou <i>IVAN-PC</i> , mais si le poste de travail se trouve dans un domaine, son groupe de travail est le nom de domaine. <br><br>  Ainsi, en utilisant <i>NetBIOS,</i> vous pouvez savoir si un poste de travail se trouve dans un domaine et, si oui, dans lequel. <br><br>  Si vous souhaitez obtenir une liste d'hôtes de domaine au sein du sous-réseau, une seule demande de diffusion avec le nom du domaine dont vous avez besoin suffit: <br><br><img src="https://habrastorage.org/webt/_6/ya/e8/_6yae8vq5zo4jy6h2lnuyhybakq.png" alt="image"><br><br>  en conséquence, tous les hôtes de ce domaine répondront. <br><br><h4>  Découverte d'hôtes multi-hôtes </h4><br>  Et enfin, une autre technique probablement très peu connue, qui est tout simplement indispensable pour <i>trouver des moyens</i> de sécuriser, éventuellement même des réseaux physiquement isolés.  Il peut s'agir d'un réseau d'ateliers d'entreprises bourrés de contrôleurs.  Pour un attaquant, l'accès à ce réseau représente une opportunité d'influencer le processus technologique, et pour une entreprise il y a un risque de pertes énormes. <br><br>  Donc, l'essentiel est que même si le réseau est isolé du réseau d'entreprise, souvent certains administrateurs, soit en raison de leur paresse, soit en quelque sorte, aiment élever une autre carte réseau sur leur PC pour accéder à ce même réseau.  De plus, tout cela se produit bien sûr, en contournant toutes sortes de règles des pare-feu d'entreprise.  Pratique, oui, mais pas très sûr, si vous êtes piraté, vous deviendrez un pont vers ce réseau et porterez la responsabilité. <br>  Cependant, pour l'attaquant, il y a un problème: trouver l'administrateur même qui a rejoint le réseau sécurisé d'une manière illégale similaire.  De plus, ce n'est pas un problème facile pour le personnel de sécurité du réseau lui-même.  Dans les grandes entreprises, c'est vraiment une tâche difficile, comme pour trouver une aiguille dans une botte de foin. <br><br>  Dans cette situation, il y aurait deux options évidentes pour un attaquant: <br><br><ol><li>  essayez d'utiliser chaque PC du sous-réseau d'entreprise comme passerelle vers le réseau souhaité.  Ce serait très pratique, mais cela est rarement vu, car sur les hôtes <i>Windows, le</i> <i>transfert IP est</i> presque toujours désactivé.  De plus, une telle vérification n'est possible que dans son propre sous-réseau, et elle exige également que l'attaquant connaisse exactement l'adresse cible du réseau isolé </li><li>  essayez de vous connecter à distance à chaque hôte et exécutez la commande banale <i>ipconfig / ifconfig</i> .  Et ici, tout n'est pas si fluide.  Même si un attaquant a obtenu les droits d'un administrateur de domaine, personne n'a annulé les pare-feu et les pare-feu locaux.  Cette tâche n'est donc pas 100% automatisée.  En conséquence, il reste pénible d'aller à chaque hôte, en surmontant les pare-feu (bloquant souvent exactement le port 445 / tcp), en espérant enfin voir l'interface réseau convoitée. </li></ol><br>  Cependant, tout est beaucoup plus simple.  Il existe une astuce extrêmement simple qui vous permet d'obtenir une liste des interfaces réseau d'un hôte donné.  Disons que nous avons un certain hôte: <br><br><img src="https://habrastorage.org/webt/p2/1l/hh/p21lhhx8qdnfvpte4hrwblhsfvg.png" alt="image"><br><br>  il s'agit de l'adresse IP du résolveur inverse → nom du réseau.  Si nous essayons maintenant de créer un nom de réseau de résolution directe → adresse IP: <br><br><img src="https://habrastorage.org/webt/zr/2z/k9/zr2zk9waoscntarqir8zya9_dg0.png" alt="image"><br><br>  alors nous découvrirons que cet hôte est également une passerelle (apparemment) dans un autre réseau.  Il convient de noter que dans ce cas, la demande a été diffusée.  En d'autres termes, les hôtes ne l'entendront que depuis le sous-réseau de l'attaquant. <br><br>  Si l'hôte cible se trouve en dehors du sous-réseau, vous pouvez envoyer une demande ciblée: <br><br><img src="https://habrastorage.org/webt/-x/sx/7j/-xsx7j64cjly0xlhdqqglonc2fi.png" alt="image"><br><br>  Dans ce cas, on peut voir que la cible est en dehors du sous-réseau de l'attaquant.  En utilisant le commutateur -B, il a été indiqué que la demande devait être envoyée à une adresse spécifique, et non à l'adresse de diffusion. <br><br>  Maintenant, il ne reste plus qu'à collecter rapidement des informations à partir de l'ensemble du sous-réseau d'intérêt, et non à partir d'une seule adresse.  Pour ce faire, vous pouvez utiliser un petit script <i>python</i> : <br><br><img src="https://habrastorage.org/webt/lo/z3/th/loz3thmdajppwq2oqtqibp95qze.png" alt="image"><br><br>  Et après quelques secondes: <br><br><img src="https://habrastorage.org/webt/lz/e8/i4/lze8i4lom7sgz4zwnwz9_foc0na.png" alt="image"><br><br>  C'était un hôte dédié, dans ce cas improvisé, qui allait devenir la première cible de l'attaquant s'il poursuivait le réseau 172.16.1 / 24. <br><br><img src="https://habrastorage.org/webt/1q/ug/ma/1qugmatd6jlto6wh8rznegqhako.png" alt="image"><br><br>  Des noms en double sur différentes IP indiquent que l'hôte possède également deux cartes réseau, mais sur le même sous-réseau.  Il est à noter que <i>NetBIOS</i> ne divulgue pas d' <i>alias</i> (qui peut facilement être calculé via des requêtes arp en ip avec le même <i>mac</i> ).  Dans ce cas, les adresses IP ont différents <i>macs</i> . <br><br>  Un autre exemple d'utilisation de cette technique est le Wi-Fi public.  Parfois, il est possible de faire face à une situation où parmi les appareils invités, le personnel travaillant dans le segment fermé de l'entreprise est connecté au réseau public.  Ensuite, à l'aide de cette technique de reconnaissance, un attaquant pourra très rapidement déterminer lui-même un chemin pour passer dans un réseau fermé: <br><br><img src="https://habrastorage.org/webt/zx/x6/0l/zxx60lshqqv9ojgin72nusco_x4.jpeg" alt="image"><br><br>  Dans ce cas, parmi 65 clients Wi-Fi publics, il y avait deux postes de travail avec une interface supplémentaire, probablement liés au réseau d'entreprise. <br><br>  Si parfois un filtrage du trafic vers le port 445 / tcp est observé entre les segments du réseau ou directement sur les postes de travail, ce qui empêche la connexion à distance au système (exécution de code à distance), alors dans ce cas, le port 137 / udp est utilisé pour résoudre les noms sur <i>NetBIOS</i> , qui n'est presque jamais bloqué consciemment. se produit, car l'utilisabilité du réseau en souffrira beaucoup, par exemple, l'environnement réseau peut disparaître, etc. <br><br>  Comme on dit, l' <i>énumération est la clé</i> <br>  Existe-t-il une protection contre cela?  Ce n'est pas le cas, car ce n'est pas une vulnérabilité en tout.  Ce n'est que la fonctionnalité standard du petit que <i>Windows</i> a par défaut (sous <i>Linux, le</i> comportement est légèrement différent).  Et si vous, soudainement de manière incohérente, contournant les règles de routage du réseau rejoint un segment fermé, l'attaquant vous trouvera certainement et le fera très rapidement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445212/">https://habr.com/ru/post/fr445212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445202/index.html">Happy Potter et l'Ordre de CSS</a></li>
<li><a href="../fr445204/index.html">Conversion en continu des bases de données Firebird 2.5 au format ODS12 (Firebird 3.0)</a></li>
<li><a href="../fr445206/index.html">Réduisez les temps d'arrêt lors de la mise à niveau de Zimbra</a></li>
<li><a href="../fr445208/index.html">Niveaux de maturité informatique d'entreprise</a></li>
<li><a href="../fr445210/index.html">Colonie de crypto-monnaie</a></li>
<li><a href="../fr445214/index.html">Nous pompons les crochets React à l'aide de FRP</a></li>
<li><a href="../fr445220/index.html">AMD Radeon VII: puce haut de gamme (partie 3)</a></li>
<li><a href="../fr445222/index.html">Recevez une offre en 1 jour à l'équipe back-end lors de la Cosmonautics Day</a></li>
<li><a href="../fr445226/index.html">Le développement d'une fusée capable d'atteindre la lune coûtera à la Russie 740 milliards de roubles</a></li>
<li><a href="../fr445228/index.html">Cryptographie en Java. Classe Mac</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>