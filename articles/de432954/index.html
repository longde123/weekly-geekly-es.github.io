<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÆ ‚ùáÔ∏è üòõ Und wieder ins All: wie das Einhorn Stellarium besuchte üåà üö¥üèª üç∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="W√§hrend des gesamten Zeitraums ihres Bestehens haben die Menschen enorme Anstrengungen unternommen, um fast den gesamten Bereich des Sternenhimmels zu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Und wieder ins All: wie das Einhorn Stellarium besuchte</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/432954/">  W√§hrend des gesamten Zeitraums ihres Bestehens haben die Menschen enorme Anstrengungen unternommen, um fast den gesamten Bereich des Sternenhimmels zu untersuchen.  Bisher haben wir Hunderttausende von Asteroiden, Kometen, Nebeln und Sternen, Galaxien und Planeten untersucht.  Um all diese Sch√∂nheit selbst zu sehen, ist es nicht notwendig, das Haus zu verlassen und sich ein Teleskop zu kaufen.  Sie k√∂nnen Stellarium - ein virtuelles Planetarium - auf Ihrem Computer installieren und den Nachthimmel betrachten, der bequem auf der Couch liegt ... Aber ist es bequem?  Um die Antwort auf diese Frage herauszufinden, √ºberpr√ºfen wir Stellarium auf Fehler im Computercode. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/c8b/129/4b8c8b12983537442bfea4700cadca97.png"></div><br><a name="habracut"></a><br><h2>  Ein bisschen √ºber das Projekt ... </h2><br>  Wie auf der Wikipedia-Website beschrieben, ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Stellarium</a> ein virtuelles Open-Source-Planetarium, das f√ºr Linux, Mac OS X, Microsoft Windows, Symbian, Android und iOS sowie MeeGo verf√ºgbar ist.  Das Programm verwendet OpenGL- und Qt-Technologien, um in Echtzeit einen realistischen Himmel zu schaffen.  Mit Stellarium k√∂nnen Sie sehen, was Sie mit einem mittleren und sogar gro√üen Teleskop sehen k√∂nnen.  Das Programm bietet auch Beobachtungen von Sonnenfinsternissen und der Bewegung von Kometen. <br><br>  Stellarium wurde vom franz√∂sischen Programmierer Fabian Chereau erstellt, der das Projekt im Sommer 2001 startete.  Weitere bekannte Entwickler sind Robert Spearman, Johannes Gadzhozik, Matthew Gates, Timothy Reeves, Bogdan Marinov und Johan Meeris, der f√ºr das Kunstwerk verantwortlich ist. <br><br><h2>  ... und √ºber den Analysator </h2><br>  Die Analyse des Projekts wurde mit dem statischen Code-Analysator PVS-Studio durchgef√ºhrt.  Dies ist ein Tool zum Erkennen von Fehlern und potenziellen Schwachstellen im Quellcode von Programmen, die in C, C ++ und C # geschrieben wurden (bald in Java!).  Es l√§uft unter Windows, Linux und MacOS.  Es ist f√ºr diejenigen gedacht, die die Qualit√§t ihres Codes verbessern m√ºssen. <br><br>  Die Analyse war recht einfach.  Zuerst habe ich das Stellarium-Projekt von GitHub <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">heruntergeladen</a> und dann alle f√ºr die Assembly erforderlichen Pakete installiert.  Da das Projekt mit Qt Creator erstellt wurde, habe ich das Compiler-Startverfolgungssystem verwendet, das in die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Standalone-</a> Version des Analysators integriert ist.  Dort k√∂nnen Sie den fertigen Analysebericht anzeigen. <br><br>  Neue Leser und Benutzer von <b><i>Stellarium</i></b> haben sich vielleicht gefragt: Warum erscheint das Einhorn im Titel des Artikels und in welcher Beziehung steht es zur Codeanalyse?  Ich antworte: Ich bin einer der Entwickler von PVS-Studio und das Einhorn ist unser Lieblingsmaskottchen.  Also auf! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfc/8f2/aab/bfc8f2aaba0bf61f3b40d4d0765dd027.png"></div><br>  Ich hoffe, dass die Leser dank dieses Artikels etwas Neues f√ºr sich selbst lernen und Stellarium-Entwickler in der Lage sein werden, einige Fehler zu beseitigen und die Qualit√§t des Codes zu verbessern. <br><br>  Bringen Sie sich Kaffee mit einem Luftcroissant und machen Sie es sich bequem, denn wir gehen zum interessantesten Teil - einem √úberblick √ºber die Ergebnisse der Analyse und Analyse von Fehlern! <br><br><h2>  Verd√§chtige Bedingungen </h2><br>  F√ºr mehr Lesevergn√ºgen empfehle ich, nicht direkt auf die Warnung des Analysators zu schauen, sondern hier und weiter zu versuchen, selbst Fehler zu finden. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QZipReaderPrivate::scanFiles() { .... <span class="hljs-comment"><span class="hljs-comment">// find EndOfDirectory header int i = 0; int start_of_directory = -1; EndOfDirectory eod; while (start_of_directory == -1) { const int pos = device-&gt;size() - int(sizeof(EndOfDirectory)) - i; if (pos &lt; 0 || i &gt; 65535) { qWarning() &lt;&lt; "QZip: EndOfDirectory not found"; return; } device-&gt;seek(pos); device-&gt;read((char *)&amp;eod, sizeof(EndOfDirectory)); if (readUInt(eod.signature) == 0x06054b50) break; ++i; } .... }</span></span></code> </pre> <br>  <b>PVS-Studio-</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warnung</a> <b>:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V654</a> Die Bedingung 'start_of_directory == - 1' der Schleife ist immer wahr.  qzip.cpp 617 <br><br>  K√∂nnten Sie einen Fehler finden?  Wenn ja, dann loben. <br><br>  Der Fehler liegt im Zustand der <i>while-Schleife</i> .  <i>Dies</i> ist immer der Fall, da sich die Variable <i>start_of_directory</i> im Hauptteil der Schleife nicht √§ndert.  H√∂chstwahrscheinlich wird der Zyklus nicht ewig sein, da er <i>Return</i> und <i>Break</i> enth√§lt, aber ein solcher Code sieht seltsam aus. <br><br>  Es scheint mir, dass sie im Code vergessen haben, die Zuweisung <i>start_of_directory = pos</i> an der Stelle <i>vorzunehmen,</i> an der die Signatur √ºberpr√ºft wird.  Dann ist die <i>break-</i> Anweisung vielleicht √ºberfl√ºssig.  In diesem Fall kann der Code folgenderma√üen umgeschrieben werden: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> start_of_directory = <span class="hljs-number"><span class="hljs-number">-1</span></span>; EndOfDirectory eod; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (start_of_directory == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = device-&gt;size() - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)) - i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; <span class="hljs-number"><span class="hljs-number">65535</span></span>) { qWarning() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"QZip: EndOfDirectory not found"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } device-&gt;seek(pos); device-&gt;read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)&amp;eod, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readUInt(eod.signature) == <span class="hljs-number"><span class="hljs-number">0x06054b50</span></span>) start_of_directory = pos; ++i; }</code> </pre> <br>  Ich bin mir jedoch nicht sicher, wie der Code so aussehen soll.  Es ist am besten, wenn die Projektentwickler diesen Teil des Programms selbst analysieren und die erforderlichen √Ñnderungen vornehmen. <br><br>  Ein weiterer seltsamer Zustand: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StelProjectorCylinder</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StelProjector { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectViewportDiscontinuityInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3d&amp; capN, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> capD)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capN, capD)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cap.intersects(cap1) &amp;&amp; cap.intersects(cap2) &amp;&amp; cap.intersects(cap2); } };</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V501</a> Links und rechts vom Operator '&amp;&amp;' befinden sich identische Unterausdr√ºcke 'cap.intersects (cap2)'.  StelProjectorClasses.hpp 175 <br><br>  Wie Sie wahrscheinlich bereits vermutet haben, liegt der Fehler in der letzten Zeile der Funktion: Der Programmierer hat einen Tippfehler gemacht, und am Ende stellte sich heraus, dass die Funktion das Ergebnis unabh√§ngig vom Wert von <i>cap3 zur√ºckgibt</i> . <br><br>  Diese Art von Fehler ist √§u√üerst h√§ufig: In fast jedem verifizierten Projekt sind Tippfehler aufgetreten, die mit Namen der <i>Formnamen1</i> und <i>name2</i> und dergleichen <i>verkn√ºpft sind</i> .  In der Regel h√§ngen solche Fehler mit dem Kopieren und Einf√ºgen zusammen. <br><br>  Diese Code-Instanz ist ein Paradebeispiel f√ºr ein weiteres h√§ufiges Fehlermuster, f√ºr das wir sogar eine separate Ministudie durchgef√ºhrt haben.  Mein Kollege Andrei Karpov nannte es den " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Last-Line-Effekt</a> ".  Wenn Sie mit diesem Material nicht vertraut sind, empfehle ich, einen Tab im Browser zu √∂ffnen, um ihn sp√§ter zu lesen. Lassen Sie uns jedoch vorerst fortfahren. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BottomStelBar::updateText(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> updatePos) { .... updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location-&gt;text() != newLocation || updatePos) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fov-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fps-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatePos) { .... } }</code> </pre> <br>  <b>PVS-Studio-Warnungen:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V560</a> Ein Teil des bedingten Ausdrucks ist immer wahr: updatePos.  StelGuiItems.cpp 732 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V547 Der</a> Ausdruck 'updatePos' ist immer wahr.  StelGuiItems.cpp 831 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V763 Der</a> Parameter 'updatePos' wird vor seiner Verwendung immer im Funktionsk√∂rper neu geschrieben.  StelGuiItems.cpp 690 </li></ul><br>  Der Wert des <i>updatePos-</i> Parameters <i>wird</i> immer √ºberschrieben, bevor er verwendet wird, d. H.  Die Funktion funktioniert unabh√§ngig vom √ºbergebenen Wert gleich. <br><br>  Sieht komisch aus, nicht wahr?  An allen Stellen, an denen der Parameter <i>updatePos beteiligt ist</i> , ist dies der <i>Fall</i> .  Dies bedeutet, dass die Bedingungen <i>if (location-&gt; text ()! = NewLocation || updatePos)</i> und <i>if (updatePos)</i> immer wahr sind. <br><br>  Ein weiterer Ausschnitt: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> LandscapeMgr::onTargetLocationChanged(StelLocation loc) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pl &amp;&amp; flagEnvironmentAutoEnabling) { QSettings* conf = StelApp::getInstance().getSettings(); setFlagAtmosphere(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_atmosphere"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagFog(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_fog"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagLandscape(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } .... }</code> </pre> <br>  <b>PVS-Studio-Warnungen:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V792</a> Die Funktion 'toBool' rechts neben dem Operator '&amp;' wird unabh√§ngig vom Wert des linken Operanden aufgerufen.  Vielleicht ist es besser, '&amp;&amp;' zu verwenden.  LandscapeMgr.cpp 782 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V792</a> Die Funktion 'toBool' rechts neben dem Operator '&amp;' wird unabh√§ngig vom Wert des linken Operanden aufgerufen.  Vielleicht ist es besser, '&amp;&amp;' zu verwenden.  LandscapeMgr.cpp 783 </li></ul><br>  Der Analysator hat in den Argumenten f√ºr die <i>Funktionen</i> <i>setFlagAtmosphere</i> und <i>setFlagFog</i> einen verd√§chtigen Ausdruck <i>festgestellt</i> .  In der Tat: Auf beiden Seiten des Bitoperators <i>&amp; gibt</i> es Werte vom Typ <i>bool</i> .  Anstelle des Operators <i>&amp;</i> sollten Sie den Operator <i>&amp;&amp; verwenden</i> , und jetzt werde ich erkl√§ren, warum. <br><br>  Ja, das Ergebnis dieses Ausdrucks ist immer korrekt.  Bevor Sie das bitweise "und" verwenden, werden beide Operanden auf <i>int heraufgestuft</i> .  In C ++ ist eine solche Konvertierung <a href="">eindeutig</a> : false wird in 0 und true in 1 konvertiert. Daher ist das Ergebnis dieses Ausdrucks dasselbe, als ob der Operator <i>&amp;&amp;</i> verwendet w√ºrde. <br><br>  Aber es gibt eine Nuance.  Bei der Berechnung des Ergebnisses der <i>&amp;&amp; -Operation</i> wird die sogenannte "Lazy-Berechnung" verwendet.  Wenn der Wert des linken Operanden <i>falsch ist</i> , wird der rechte Wert nicht einmal berechnet, da das logische "und" in jedem Fall <i>false zur√ºckgibt</i> .  Dies spart Rechenressourcen und erm√∂glicht das Schreiben komplexerer Designs.  Sie k√∂nnen beispielsweise √ºberpr√ºfen, ob der Zeiger nicht null ist, und ihn in diesem Fall dereferenzieren, um eine zus√§tzliche √úberpr√ºfung durchzuf√ºhren.  Beispiel: <i>if (ptr &amp;&amp; ptr-&gt; foo ())</i> . <br><br>  Eine solche "verz√∂gerte Berechnung" wird nicht durchgef√ºhrt, wenn der bitweise Operator <i>&amp;</i> : Ausdr√ºcke <i>conf-&gt; value ("...", true) verwendet wird. ToBool ()</i> wird jedes Mal ausgewertet, unabh√§ngig vom Wert <i>pl-&gt; hasAtmosphere ()</i> . <br><br>  In seltenen F√§llen erfolgt dies absichtlich.  Wenn beispielsweise die Berechnung des richtigen Operanden ‚ÄûNebenwirkungen‚Äú hat, deren Ergebnis sp√§ter verwendet wird.  Es ist auch nicht sehr gut, dies zu tun, da dies das Verst√§ndnis des Codes und die Wartung des Codes erschwert.  Au√üerdem ist die Reihenfolge der Berechnung der Operanden <i>&amp;</i> nicht definiert, sodass in einigen F√§llen bei Verwendung solcher "Tricks" undefiniertes Verhalten auftreten kann. <br><br>  Wenn Sie Nebenwirkungen speichern m√ºssen, tun Sie dies in einer separaten Zeile und speichern Sie das Ergebnis in einer separaten Variablen.  Leute, die in Zukunft mit diesem Code arbeiten werden, werden Ihnen dankbar sein :) <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/301/5a6/971/3015a69710bc07f948b5233dac04fc87.png"></div><br>  Wir fahren mit dem n√§chsten Thema fort. <br><br><h2>  Falsche Speicherbehandlung </h2><br>  Beginnen wir das Thema dynamisches Ged√§chtnis mit diesem Fragment: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/************ Basic Edge Operations ****************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* __gl_meshMakeEdge creates one edge, * two vertices, and a loop (face). * The loop consists of the two new half-edges. */</span></span> GLUEShalfEdge* __gl_meshMakeEdge(GLUESmesh* mesh) { GLUESvertex* newVertex1 = allocVertex(); GLUESvertex* newVertex2 = allocVertex(); GLUESface* newFace = allocFace(); GLUEShalfEdge* e; <span class="hljs-comment"><span class="hljs-comment">/* if any one is null then all get freed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( newVertex1 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newVertex2 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newFace == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex1 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex1); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex2 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex2); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newFace != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newFace); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } e = MakeEdge(&amp;mesh-&gt;eHead); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } MakeVertex(newVertex1, e, &amp;mesh-&gt;vHead); MakeVertex(newVertex2, e-&gt;Sym, &amp;mesh-&gt;vHead); MakeFace(newFace, e, &amp;mesh-&gt;fHead); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e; }</code> </pre> <br>  <b>PVS-Studio-Warnungen:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> Die Funktion wurde beendet, ohne den Zeiger 'newVertex1' freizugeben.  Ein Speicherverlust ist m√∂glich.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> Die Funktion wurde beendet, ohne den Zeiger 'newVertex2' freizugeben.  Ein Speicherverlust ist m√∂glich.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V773</a> Die Funktion wurde beendet, ohne den Zeiger 'newFace' loszulassen.  Ein Speicherverlust ist m√∂glich.  mesh.c 312 </li></ul><br>  Die Funktion reserviert Speicher f√ºr mehrere Strukturen und √ºbergibt ihn an die Zeiger <i>newVertex1</i> , <i>newVertex2</i> (interessante Namen, richtig?) Und <i>newFace</i> .  Wenn sich herausstellt, dass einer von ihnen Null ist, wird der gesamte in der Funktion reservierte Speicher freigegeben, wonach der Steuerungsfluss die Funktion verl√§sst. <br><br>  Was passiert, wenn der Speicher f√ºr alle drei Strukturen korrekt zugewiesen ist und die Funktion <i>MakeEdge (&amp; mesh-&gt; eHead)</i> <i>NULL</i> zur√ºckgibt?  Der Kontrollfluss erreicht die zweite <i>R√ºckkehr</i> . <br><br>  Da die Zeiger <i>newVertex1</i> , <i>newVertex2</i> und <i>newFace</i> lokale Variablen sind, existieren sie nach dem Beenden der Funktion nicht mehr.  Aber die Freigabe der Erinnerung, die ihnen geh√∂rte, wird nicht stattfinden.  Es bleibt reserviert, aber wir haben keinen Zugriff mehr darauf. <br><br>  Solche Situationen werden als Speicherlecks bezeichnet.  Ein typisches Szenario mit einem solchen Fehler: Bei l√§ngerer Nutzung des Programms wird bis zu seiner Ersch√∂pfung immer mehr RAM verbraucht. <br><br>  Es ist zu beachten, dass in diesem Beispiel die dritte <i>R√ºckgabe</i> nicht fehlerhaft ist.  Die <i>Funktionen</i> <i>MakeVertex</i> und <i>MakeFace</i> √ºbertragen die Adressen des zugewiesenen Speichers auf andere Datenstrukturen und delegieren so die Verantwortung f√ºr dessen Freigabe. <br><br>  Der n√§chste Fehler liegt in der Methode, die 90 Zeilen dauert.  Der Einfachheit halber habe ich es reduziert und nur Problembereiche belassen. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AstroCalcDialog::drawAngularDistanceGraph() { .... QVector&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; xs, ys; .... }</code> </pre> <br>  Nur noch eine Zeile √ºbrig.  Lassen Sie mich einen Hinweis geben: Dies ist die einzige Erw√§hnung von <i>xs</i> und <i>ys</i> Objekten. <br><br>  <b>PVS-Studio-Warnungen:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das V808</a> -Objekt 'xs' vom Typ 'QVector' wurde erstellt, aber nicht verwendet.  AstroCalcDialog.cpp 5329 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das V808</a> -Objekt 'ys' vom Typ 'QVector' wurde erstellt, aber nicht verwendet.  AstroCalcDialog.cpp 5329 </li></ul><br>  Die Vektoren <i>xs</i> und <i>ys</i> werden erstellt, aber nirgendwo verwendet.  Es stellt sich heraus, dass jedes Mal, wenn Sie die <i>drawAngularDistanceGraph-</i> Methode verwenden, ein leerer Container zus√§tzlich erstellt und gel√∂scht wird.  Ich denke, diese Anzeige blieb nach dem Refactoring im Code.  Dies ist nat√ºrlich kein Fehler, aber Sie sollten den zus√§tzlichen Code entfernen. <br><br><h2>  Seltsame Abg√ºsse </h2><br>  Ein weiteres Beispiel nach einigem Formatieren sieht folgenderma√üen aus: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SatellitesDialog::updateSatelliteData() { .... <span class="hljs-comment"><span class="hljs-comment">// set default buttonColor = QColor(0.4, 0.4, 0.4); .... }</span></span></code> </pre> <br>  Um zu verstehen, was der Fehler ist, m√ºssen Sie sich die Prototypen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Konstruktoren der Qcolor-Klasse ansehen</a> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/84e/798/f7d84e79849bca96f7a27016aec0e9d3.png"></div><br>  <b>PVS-Studio-Warnungen:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V674</a> Das Literal '0.4' vom Typ 'double' wird beim Aufrufen der Funktion 'QColor' implizit in den Typ 'int' umgewandelt.  √úberpr√ºfen Sie das erste Argument.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V674</a> Das Literal '0.4' vom Typ 'double' wird beim Aufrufen der Funktion 'QColor' implizit in den Typ 'int' umgewandelt.  Untersuchen Sie das zweite Argument.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V674</a> Das Literal '0.4' vom Typ 'double' wird beim Aufrufen der Funktion 'QColor' implizit in den Typ 'int' umgewandelt.  Untersuchen Sie das dritte Argument.  SatellitesDialog.cpp 413 </li></ul><br>  Die <i>Qcolor-</i> Klasse <i>verf√ºgt</i> nicht √ºber Konstruktoren, die den <i>Doppeltyp</i> akzeptieren. <i>Daher</i> werden die Argumente im Beispiel implizit in <i>int</i> konvertiert.  Dadurch haben die Felder <i>r</i> , <i>g</i> , <i>b</i> des <i>buttonColor-</i> Objekts den Wert <i>0</i> . <br><br>  Wenn der Programmierer beabsichtigte, ein Objekt aus Werten vom Typ <i>double</i> zu erstellen, sollte er einen anderen Konstruktor verwenden. <br><br>  Sie k√∂nnen beispielsweise einen Konstruktor verwenden, der <i>Qrgb</i> akzeptiert, indem Sie <i>Folgendes</i> schreiben: <br><br><pre> <code class="cpp hljs">buttonColor = QColor(QColor::fromRgbF(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  Es h√§tte anders gemacht werden k√∂nnen.  Qt verwendet reelle Werte im Bereich [0.0, 1.0] oder ganzzahlige Werte im Bereich [0, 255], um RGB-Farben anzuzeigen. <br><br>  Daher k√∂nnte der Programmierer die Werte von real in integer √ºbersetzen, indem er wie folgt schreibt: <br><br><pre> <code class="cpp hljs">buttonColor = QColor((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  oder einfach <br><br><pre> <code class="cpp hljs">buttonColor = QColor(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>);</code> </pre> <br>  Bist du gelangweilt?  Keine Sorge, es liegen weitere interessante Fehler vor uns. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/aa0/297/f18aa02975f89e9e6cc7c661706fc608.png"></div><br>  <font color="#999999"><i>"Einhorn im Weltraum."</i></font>  <font color="#999999"><i>Blick aus dem Stellarium.</i></font> <br><br><h2>  Andere Fehler </h2><br>  Am Ende habe ich dir noch etwas Leckeres hinterlassen :) Lass uns zu einem von ihnen kommen. <br><br><pre> <code class="cpp hljs">HipsTile* HipsSurvey::getTile(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> order, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pix) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (order == orderMin &amp;&amp; !allsky.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * order)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (pix % nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = (pix / nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> s = allsky.width() / nbw; QImage image = allsky.copy(x, y, s, s); .... } .... }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V634</a> Die Priorit√§t der Operation '*' ist h√∂her als die der Operation '&lt;&lt;'.  Es ist m√∂glich, dass im Ausdruck Klammern verwendet werden.  StelHips.cpp 271 <br><br>  Konnten Sie den Fehler erkennen?  Betrachten Sie den Ausdruck <i>(12 * 1 &lt;&lt; (2 * Reihenfolge))</i> genauer.  Der Analysator erinnert daran, dass die Operation ' <i>*</i> ' eine h√∂here Priorit√§t hat als die Bitverschiebungsoperation ' <i>&lt;&lt;</i> '.  Es ist leicht zu erkennen, dass das Multiplizieren von <i>12</i> mit <i>1</i> sinnlos ist und die Klammern um die <i>2 * -Ordnung</i> nicht ben√∂tigt werden. <br><br><pre> <code class="cpp hljs"> ,    : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> * order));     &lt;i&gt;<span class="hljs-number"><span class="hljs-number">12</span></span> &lt;/i&gt;     .</code> </pre> <br>  Hinweis  Au√üerdem m√∂chte ich darauf hinweisen, dass das Ergebnis nicht definiert ist, wenn der Wert des rechten Operanden ' <i>&lt;&lt;</i> ' gr√∂√üer oder gleich der Anzahl der Bits des linken Operanden ist.  Da numerische Literale standardm√§√üig <i>int</i> sind und <i>32</i> Bit ben√∂tigen, sollte der Wert des <i>Ordnungsparameters</i> <i>15</i> nicht √ºberschreiten.  Andernfalls kann die Auswertung des Ausdrucks zu undefiniertem Verhalten f√ºhren. <br><br>  Wir fahren fort.  Die folgende Methode ist sehr verwirrend, aber ich bin sicher, dass ein erfahrener Leser die Fehlererkennung √ºbernehmen wird :) <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdBoth) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdNegative) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdPositive) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V779</a> Nicht erreichbarer Code erkannt.  M√∂glicherweise liegt ein Fehler vor.  qcustomplot.cpp 19512. <br><br>  Tatsache ist, dass alle, <i>wenn ... sonst</i> Filialen eine <i>Rendite haben</i> .  Daher erreicht der Kontrollfluss niemals die letzten beiden Zeilen. <br><br>  Im Gro√üen und Ganzen wird dieses Beispiel normal ausgef√ºhrt und funktioniert ordnungsgem√§√ü.  Das Vorhandensein von nicht erreichbarem Code allein ist jedoch ein Signal.  In diesem Fall weist dies auf die falsche Struktur der Methode hin, was die Lesbarkeit und Verst√§ndlichkeit des Codes erheblich erschwert. <br><br>  Dieses Codefragment sollte √ºberarbeitet werden, um eine sauberere Funktion am Ausgang zu erhalten.  Zum Beispiel so: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (inSignDomain) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdBoth: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdNegative: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdPositive: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  Der letzte in unserer Bewertung wird der Fehler sein, der mir am besten gefallen hat.  Der Fehlercode ist kurz und einfach: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Haben Sie etwas Verd√§chtiges bemerkt?  Nicht jeder kann :) <br><br>  <b>PVS-Studio Warnung:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V603</a> Das Objekt wurde erstellt, wird jedoch nicht verwendet.  Wenn Sie den Konstruktor aufrufen m√∂chten, sollte 'this-&gt; Plane :: Plane (....)' verwendet werden.  Plane.cpp 29 <br><br>  Der Programmierer hat erwartet, dass einige der Felder des Objekts im verschachtelten Konstruktor initialisiert werden, aber es stellte sich folgenderma√üen heraus: Wenn der <i>Ebenenkonstruktor (Vec3f &amp; v1, Vec3f &amp; v2, Vec3f &amp; v3)</i> aufgerufen wird, wird ein unbenanntes tempor√§res Objekt darin erstellt, das sofort gel√∂scht wird.  Infolgedessen bleibt ein Teil des Objekts nicht initialisiert. <br><br>  Damit der Code ordnungsgem√§√ü funktioniert, sollten Sie die praktische und sichere Funktion von C ++ 11 verwenden - den delegierenden Konstruktor: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f&amp; v1, Vec3f&amp; v2, Vec3f&amp; v3) : Plane(v1, v2, v3, SPolygon::CCW) { distance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; sDistance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre> <br>  Wenn Sie den Compiler jedoch f√ºr √§ltere Versionen der Sprache verwenden, k√∂nnen Sie folgenderma√üen schreiben: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Plane::Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Oder so: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Ich stelle fest, dass die letzten beiden Methoden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sehr gef√§hrlich sind</a> .  Daher sollten Sie sehr vorsichtig sein und gut verstehen, wie solche Methoden funktionieren. <br><br><h2>  Fazit </h2><br>  Welche Schlussfolgerungen k√∂nnen √ºber die Qualit√§t des Stellarium-Codes gezogen werden?  Ehrlich gesagt gab es nicht sehr viele Fehler.  Au√üerdem habe ich im gesamten Projekt keinen einzigen Fehler gefunden, bei dem der Code an undefiniertes Verhalten gebunden ist.  F√ºr das OpenSource-Projekt stellte sich heraus, dass die Qualit√§t des Codes auf einem hohen Niveau war, wof√ºr ich den Entwicklern den Hut abnehme.  Ihr seid gro√üartig!  Ich war erfreut und interessiert, Ihr Projekt zu √ºberpr√ºfen. <br><br>  Was ist mit dem Planetarium selbst - ich benutze es ziemlich oft.  Leider kann ich in einer Stadt selten einen klaren Nachthimmel genie√üen, und Stellarium erm√∂glicht es mir, √ºberall auf der Welt zu sein, ohne von der Couch aufzustehen.  Es ist wirklich bequem! <br><br>  Besonders gut gef√§llt mir der Modus ‚ÄûConstellation Art‚Äú.  Der Anblick der riesigen Figuren, die den ganzen Himmel in einem seltsamen Tanz bedecken, ist atemberaubend. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/613/3d5/107/6133d51079ac983aa11a017acd1945ee.png"></div><br>  <font color="#999999"><i>"Ein seltsamer Tanz."</i></font>  <font color="#999999"><i>Blick aus dem Stellarium.</i></font> <br><br>  Erdlinge neigen dazu, Fehler zu machen, und es ist nicht besch√§mend, dass diese Fehler in den Code gelangen.  Hierzu werden Code-Analyse-Tools wie PVS-Studio entwickelt.  Wenn Sie einer der Erdlinge sind - <strike>wie es,</strike> empfehle <strike>ich</strike> Ihnen, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">herunterzuladen und selbst auszuprobieren</a> . <br><br>  Ich hoffe, Sie waren daran interessiert, meinen Artikel zu lesen, und Sie haben etwas Neues und N√ºtzliches f√ºr sich selbst gelernt.  Und ich w√ºnsche den Entwicklern eine fr√ºhzeitige Korrektur der gefundenen Fehler. <br><br>  Abonnieren Sie unsere Kan√§le und bleiben Sie auf dem Laufenden, um Neuigkeiten aus der Programmwelt zu erhalten! <br><br><ul><li>  Vk: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@pvsstudio_rus</a> </li><li>  Telegramm: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@pvsstudio_rus</a> </li><li>  Instagram: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@pvsstudio_rus</a> </li><li>  Twitter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@pvsstudio_rus</a> </li><li>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@PVSStudioTool</a> </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br>  Wenn Sie diesen Artikel einem englischsprachigen Publikum zug√§nglich machen m√∂chten, verwenden Sie bitte den Link zur √úbersetzung: George Gribkov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wieder ins All: Wie das Einhorn das Stellarium besuchte</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de432954/">https://habr.com/ru/post/de432954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de432940/index.html">50 Schattierungen von Token</a></li>
<li><a href="../de432942/index.html">Corutin-Muster und Antimuster in Kotlin</a></li>
<li><a href="../de432944/index.html">Erzwungene PostgreSQL-Abfrageoptimierung</a></li>
<li><a href="../de432946/index.html">Einheit - Fallstricke der 2D-Spieleentwicklung</a></li>
<li><a href="../de432948/index.html">Intelligente Clouds, intelligente Unternehmen: Wie KI die Cloud-Computing-Branche ver√§ndert</a></li>
<li><a href="../de432956/index.html">Monster von Id: wie Doom erstellt wurde</a></li>
<li><a href="../de432958/index.html">Das neue Quantenparadoxon verdeutlicht, in welchem ‚Äã‚ÄãFall sich unsere Vorstellungen von der Realit√§t als falsch herausstellen</a></li>
<li><a href="../de432960/index.html">Warum Verbraucher keine Angst vor Identit√§tsdiebstahl haben</a></li>
<li><a href="../de432964/index.html">√úber Macht, entweder gut oder nichts: eine neue Gesetzesinitiative in der Russischen F√∂deration</a></li>
<li><a href="../de432966/index.html">Verschl√ºsselter Bootloader f√ºr STM32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>