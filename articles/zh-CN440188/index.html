<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¥ ğŸ‘ŠğŸ» ğŸ‘²ğŸ» è§¦æ‰‹å¯åŠï¼šæŒæ¡Ansibleè¿ç®—ç¬¦ä»¥ç®¡ç†Kubernetesä¸­çš„åº”ç”¨ç¨‹åº ğŸ§•ğŸ» ğŸ§˜ğŸ¾ ğŸš¶ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Ansible Galaxyä¸­å‘å¸ƒçš„è§’è‰²ä½œä¸ºç®¡ç†Kubernetesä¸­åº”ç”¨ç¨‹åºçš„æ“ä½œå‘˜ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ“ä½œå‘˜æ¥ç®€å•åœ°å®‰è£…åº”ç”¨ç¨‹åºå¹¶æ ¹æ®ç¯å¢ƒçµæ´»åœ°è°ƒæ•´å…¶è¡Œä¸ºã€‚ 



 æˆ‘ä»¬å°†ä½¿ç”¨Ansible Operatorå’Œk8sæ¨¡å—æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨Ansibleåˆ›å»ºKubernetesåº”ç”¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>è§¦æ‰‹å¯åŠï¼šæŒæ¡Ansibleè¿ç®—ç¬¦ä»¥ç®¡ç†Kubernetesä¸­çš„åº”ç”¨ç¨‹åº</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/440188/"> è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible Galaxyä¸­</a>å‘å¸ƒçš„è§’è‰²ä½œä¸ºç®¡ç†Kubernetesä¸­åº”ç”¨ç¨‹åºçš„æ“ä½œå‘˜ï¼Œå¹¶çœ‹çœ‹å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ“ä½œå‘˜æ¥ç®€å•åœ°å®‰è£…åº”ç”¨ç¨‹åºå¹¶æ ¹æ®ç¯å¢ƒçµæ´»åœ°è°ƒæ•´å…¶è¡Œä¸ºã€‚ <br><br><img src="https://habrastorage.org/webt/kk/7j/6q/kk7j6qx0eteemrqiug7iyohofli.jpeg" width="100%"><br><br> æˆ‘ä»¬å°†ä½¿ç”¨<a href="">Ansible Operator</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">k8sæ¨¡å—</a>æ¥å±•ç¤ºå¦‚ä½•ä½¿ç”¨Ansibleåˆ›å»ºKubernetesåº”ç”¨ç¨‹åºã€‚ <br><a name="habracut"></a><br>  Ansible Operatoræ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Operator SDKçš„</a>ä¸€éƒ¨åˆ†ï¼Œå¯è®©æ‚¨ä»¥Ansibleè§’è‰²å’Œå‰§æœ¬çš„è¯­è¨€åˆ¶å®šåº”ç”¨ç¨‹åºçš„æ“ä½œè§„å®šï¼ˆåº”å¦‚ä½•å®‰è£…å’Œç»´æŠ¤ï¼‰ã€‚ å½“åˆ›å»ºè¿™æ ·çš„è§’è‰²å’Œå‰§æœ¬æ—¶ï¼Œk8sæ¨¡å—åˆæ‰©å±•äº†åœ¨Kubernetesä¸­ç®¡ç†å¯¹è±¡çš„èƒ½åŠ›ã€‚ <br><br> åƒè¿™æ ·åˆ›å»ºä¸€ä¸ªè¿ç®—ç¬¦ã€‚ <br><br><pre><code class="plaintext hljs">FROM quay.io/operator-framework/ansible-operator RUN ansible-galaxy install djzager.hello_world_k8s RUN echo $'--- \n\ - version: v1alpha1\n\ group: examples.djzager.io\n\ kind: HelloWorld\n\ role: /opt/ansible/roles/djzager.hello_world_k8s' &gt; ${HOME}/watches.yaml</code> </pre> <br><h3> å¼€å§‹é”® </h3><br> é¦–å…ˆï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç®€è¦</a>ä»‹ç»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ä¸‹k8s Ansibleæ¨¡å—</a> ã€‚ å®ƒå‡ºç°åœ¨Ansible 2.6ä¸­ï¼Œå¹¶æ‰©å±•äº†ä½¿ç”¨Ansibleçš„Kuberneteså¯¹è±¡ä»¥åŠä»»ä½•Kuberneteså‘è¡Œç‰ˆï¼ˆåŒ…æ‹¬Red Hat OpenShiftï¼‰çš„å¯èƒ½æ€§ã€‚  Ansibleåšå®¢ä¸Šæœ‰ä¸€ç¯‡å…³äºè¯¥æ¨¡å—å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Red Hat OpenShiftåŠ¨æ€Pythonå®¢æˆ·ç«¯</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å•ç‹¬æ–‡ç« </a> ã€‚ æˆ‘ä»¬è®¤ä¸ºï¼Œä¸ä½¿ç”¨k8sæ¨¡å—é€šè¿‡Ansibleå¤„ç†Kuberneteså¯¹è±¡æ˜¯é”™è¯¯çš„ã€‚ æ“ä½œå‘˜æœºåˆ¶æœ€åˆæ˜¯ä¸ºäº†åœ¨Kubernetesä¸­è¿è¡Œåº”ç”¨ç¨‹åºè€Œåˆ›å»ºçš„ï¼Œè€ŒOperator SDKæä¾›äº†ç”¨äºç»„è£…ï¼Œæµ‹è¯•å’Œæ‰“åŒ…æ“ä½œå‘˜çš„å·¥å…·ã€‚ åè¿‡æ¥ï¼Œéœ€è¦ä½¿ç”¨Ansible Operatoræ‰èƒ½ä»¥Ansibleè¯­è¨€è®¾ç½®åº”ç”¨ç¨‹åºçš„æ“ä½œè§„åˆ™ã€‚ ç›¸åº”çš„å·¥ä½œæµçš„ç»„ç»‡æ–¹å¼éå¸¸ç®€å•ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬æ‰§è¡Œoperator-sdk new --type = Ansibleæ¥ä¸ºAnsibleè¿ç®—ç¬¦ç”Ÿæˆå¿…è¦çš„æ–‡ä»¶ï¼Œç„¶åç»˜åˆ¶Ansibleï¼Œæœ€åæˆ‘ä»¬è¿›è¡Œoperator-sdkæ„å»ºä»¥æ„å»ºå¯åœ¨Kubernetesä¸­å·¥ä½œçš„åº”ç”¨ç¨‹åºã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å·²ç»åœ¨Ansible Galaxyä¸­æ‹…ä»»è¿‡è§’è‰²ï¼Œè¯¥è§’è‰²å¯æ§åˆ¶Kubernetesä¸­çš„åº”ç”¨ç¨‹åºï¼Œäº‹æƒ…å°†ä¼šå˜å¾—æ›´åŠ å®¹æ˜“ã€‚ ä¸‹é¢æˆ‘ä»¬å°†æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ol><li> è®©æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªAnsibleè§’è‰²æ¥ç®¡ç†Kubernetesä¸­çš„Hello Worldåº”ç”¨ç¨‹åºï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬æ¼”ç¤ºk8s Ansibleæ¨¡å—çš„åŠŸèƒ½ã€‚ </li><li> æˆ‘ä»¬å°†åœ¨Ansible Galaxyä¸­å‘å¸ƒæ­¤è§’è‰²ã€‚ </li></ol><br> å› æ­¤ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨åœ¨Ansible Galaxyä¸­å‘å¸ƒçš„è§’è‰²ç»„è£…Ansible-operatorã€‚ ä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨Ansible Galaxyä¸­çš„è§’è‰²åˆ›å»ºæ“ä½œå‘˜ï¼Ÿ æœ‰ä¸¤ä¸ªåŸå› ï¼š <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸ºäº†ä¸é‡å¤</a> ã€‚ å¦‚æœæˆ‘ä»¬å·²ç»å¯¹Ansibleè§’è‰²è¿›è¡Œäº†ç¼–ç¨‹ä»¥ç®¡ç†Hello Worldåº”ç”¨ç¨‹åºå¹¶å°†å…¶å‘å¸ƒåœ¨Ansible Galaxyä¸­ï¼Œåˆ™åœ¨åˆ›å»ºAnsibleè¿ç®—ç¬¦æ—¶ä½¿ç”¨å®ƒæ˜¯åˆä¹é€»è¾‘çš„ã€‚ </li><li> ç”±äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">èŒè´£åˆ†å·¥</a> ã€‚ æˆ‘ä»¬å¸Œæœ›Hello World Ansibleè§’è‰²å¯ä»¥åœ¨Kubernetesä¸­ç®¡ç†åŒååº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å¸Œæœ›æ“ä½œï¼ˆæ“ä½œï¼‰é€»è¾‘ä¿ç•™åœ¨æ“ä½œå‘˜å†…éƒ¨ã€‚ åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæ“ä½œé€»è¾‘éå¸¸ç®€å•ï¼šæ¯æ¬¡åˆ›å»ºæˆ–ä¿®æ”¹è‡ªå®šä¹‰HelloWorldèµ„æºæ—¶ï¼Œå®ƒåªéœ€è°ƒç”¨djzager.hello_world_k8sè§’è‰²ã€‚ ä½†æ˜¯ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†æ¥</a>è¿™ç§åˆ†ç¦»å°†å˜å¾—æ›´åŠ é‡è¦ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†é€šè¿‡Ansibleè§’è‰²å‘Hello Worldåº”ç”¨ç¨‹åºæ·»åŠ éªŒè¯ï¼Œå¹¶ä¸”æˆ‘ä»¬å°†é€šè¿‡è¿ç®—ç¬¦é€»è¾‘å®ç°HelloWorldè‡ªå®šä¹‰èµ„æºçš„çŠ¶æ€æ§åˆ¶ã€‚ </li></ol><br><h3> æ‚¨å¥½Kubernetesï¼Œè®¤è¯†Ansible </h3><br><h4> æˆ‘ä»¬éœ€è¦ä»€ä¹ˆ </h4><br><ol><li>  Ansible-å¦‚æœæ‚¨å°šæœª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…</a> Ansibleï¼Œè¯·å‚é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…æŒ‡å—</a> ã€‚ </li><li>  OpenShiftçš„Pythonå®¢æˆ·ç«¯ï¼ˆå¯é€‰ï¼‰ã€‚ ä»…åœ¨æœ¬åœ°å¯åŠ¨æ—¶éœ€è¦ã€‚ å®‰è£…è¯´æ˜åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a> ã€‚ </li></ol><br> è®©æˆ‘ä»¬å¼€å§‹å§ã€‚ é¦–å…ˆï¼Œä½¿ç”¨ansible-galaxyåˆ›å»ºè§’è‰²éª¨æ¶ï¼š <br><br><pre> <code class="plaintext hljs"># I like clear names on projects. # In meta/main.yml I will make role_name: hello-world-k8s $ ansible-galaxy init ansible-role-hello-world-k8s</code> </pre><br> åˆ›å»ºæ–°çš„Ansibleè§’è‰²åï¼Œæˆ‘ä»¬å°†ç«‹å³è®¾ç½®æ‰€æœ‰é»˜è®¤å€¼ï¼Œä»¥åŒæ—¶è®°å½•å…¶æœ‰æ•ˆé…ç½®å‚æ•°ã€‚ æ­¤å¤–ï¼Œåœ¨è¿™æ–¹é¢ï¼Œæˆ‘ä»¬çš„Hello Worldç¤ºä¾‹å¹¶ä¸ç‰¹åˆ«å¤æ‚ã€‚ è¿™æ˜¯æˆ‘ä»¬çš„defaults / main.ymlæ–‡ä»¶çš„æ ·å­ï¼š <br><br><pre> <code class="plaintext hljs">--- # NOTE: meta.name(space) comes from CR metadata when run with Ansible Operator # deploy/crds has an example CR for reference name: "{{ meta.name | default('hello-world') }}" namespace: "{{ meta.namespace | default('hello-world') }}" image: docker.io/ansibleplaybookbundle/hello-world:latest # To uninstall from the cluster # state: absent state: present # The size of the hello-world deployment size: 1</code> </pre><br> è®¾ç½®é»˜è®¤å€¼åï¼Œæœ‰å¿…è¦ç¡®å®šè§’è‰²å°†è¦æ‰§è¡Œçš„æ“ä½œã€‚  Hello Worldåº”ç”¨ç¨‹åºå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ol><li> è·å–æœ‰å…³é›†ç¾¤ä¸­å¯ç”¨APIçš„ä¿¡æ¯ã€‚ </li><li> åˆ›å»ºå‡ ä¸ªæ¨¡æ¿ï¼Œå¹¶ç¡®ä¿å®ƒä»¬åœ¨ç¾¤é›†ä¸­å­˜åœ¨æˆ–ä¸å­˜åœ¨ã€‚ </li></ol><br> å› æ­¤ï¼Œæˆ‘ä»¬çš„ä»»åŠ¡/ main.ymlæ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="plaintext hljs">--- - name: "Get information about the cluster" set_fact: api_groups: "{{ lookup('k8s', cluster_info='api_groups') }}" - name: 'Set hello-world objects state={{ state }}' k8s: state: '{{ state }}' definition: "{{ lookup('template', item.name) | from_yaml }}" when: item.api_exists | default(True) loop: - name: deployment.yml.j2 - name: service.yml.j2 - name: route.yml.j2 api_exists: "{{ True if 'route.openshift.io' in api_groups else False }}"</code> </pre><br> åœ¨ç»§ç»­ä½¿ç”¨æ¨¡æ¿ä¹‹å‰ï¼Œè¯·æ³¨æ„ä»»åŠ¡æ–‡ä»¶ä¸­çš„ä»¥ä¸‹è¡Œï¼š <br><br><pre> <code class="plaintext hljs">api_exists: "{{ True if 'route.openshift.io' in api_groups else False }}"</code> </pre><br> ä½¿ç”¨set_factï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—é›†ç¾¤ä¸­æ‰€æœ‰å¯ç”¨APIçš„åˆ—è¡¨ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥æ ¹æ®APIæ˜¯å¦å­˜åœ¨ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸ºroute.openshift.ioï¼‰æœ‰é€‰æ‹©åœ°ç”Ÿæˆæ¨¡æ¿ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨OpenShiftçš„Kubernetesé›†ç¾¤ä¸­ï¼Œè·¯ç”±ä¸å¯ç”¨å¹¶ä¸”æˆ‘ä»¬ä¸éœ€è¦å®ƒä»¬ï¼Œå› æ­¤ä»…åœ¨é›†ç¾¤ä¸­å­˜åœ¨route.openshift.ioæ—¶æ‰ä½¿ç”¨Routeå¯¹è±¡ã€‚ <br><br> å¦‚æœç¾¤é›†å…·æœ‰apps.openshift.io APIï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æ ¹æ®æŸäº›APIçš„å¯ç”¨æ€§é€‰æ‹©æ€§åœ°ç®¡ç†ç¾¤é›†ä¸­çš„å¯¹è±¡ï¼Œè¿˜å¯ä»¥ä½¿ç”¨Jinja2æ¨¡æ¿åœ¨éƒ¨ç½²æ¨¡æ¿ä¸­ä½¿ç”¨OpenShift DeploymentConfigã€‚ è¿™æ˜¯æˆ‘ä»¬çš„æ¨¡æ¿/ deployment.yml.j2æ–‡ä»¶çš„æ ·å­ï¼š <br><br><pre> <code class="plaintext hljs">--- {% if 'apps.openshift.io' in api_groups %} apiVersion: apps.openshift.io/v1 kind: DeploymentConfig {% else %} apiVersion: apps/v1 kind: Deployment {% endif %} metadata: name: {{ name }} namespace: {{ namespace }} labels: app: {{ name }} service: {{ name }} spec: replicas: {{ size }} {% if 'apps.openshift.io' in api_groups %} selector: app: {{ name }} service: {{ name }} {% else %} selector: matchLabels: app: {{ name }} service: {{ name }} {% endif %} template: metadata: labels: app: {{ name }} service: {{ name }} spec: containers: - image: {{ image }} name: hello-world ports: - containerPort: 8080 protocol: TCP</code> </pre><br> æ–‡ä»¶æ¨¡æ¿/ service.yml.j2ï¼š <br><br><pre> <code class="plaintext hljs">--- apiVersion: v1 kind: Service metadata: name: {{ name }} namespace: {{ namespace }} labels: app: {{ name }} service: {{ name }} spec: ports: - name: web port: 8080 protocol: TCP targetPort: 8080 selector: app: {{ name }} service: {{ name }}</code> </pre><br> æœ€åï¼Œæ¨¡æ¿/ route.yml.j2æ–‡ä»¶ï¼š <br><br><pre> <code class="plaintext hljs">--- apiVersion: route.openshift.io/v1 kind: Route metadata: name: {{ name }} namespace: {{ namespace }} labels: app: {{ name }} service: {{ name }} spec: port: targetPort: web to: kind: Service name: {{ name }}</code> </pre><br> æˆ‘ä»¬çœç•¥äº†meta / main.ymlæ–‡ä»¶ï¼Œä½†å¯ä»¥åœ¨<a href="">æ­¤å¤„</a>æ‰¾åˆ°ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬å…·æœ‰åœ¨Kubernetesä¸­ç®¡ç†Hello Worldåº”ç”¨ç¨‹åºçš„Ansibleè§’è‰²ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨é›†ç¾¤ä¸­å¯ç”¨çš„APIã€‚ æ¢å¥è¯è¯´ï¼Œk8sæ¨¡å—å’ŒåŠ¨æ€å®¢æˆ·ç«¯ç®€åŒ–äº†Kubernetesä¸­å¯¹è±¡çš„å¤„ç†ã€‚ æˆ‘ä»¬å¸Œæœ›é€šè¿‡è¿™ä¸ªè§’è‰²çš„ä¾‹å­ï¼Œèƒ½å¤Ÿåœ¨ä¸Kubernetesåˆä½œæ—¶å±•ç¤ºAnsibleçš„æ½œåŠ›ã€‚ <br><br><h3> ä½ å¥½é“¶æ²³ï¼Œè®¤è¯†Kubernetes </h3><br>  Ansible Galaxyåœ¨è®¾ç½®æœåŠ¡å™¨å’Œç®¡ç†åº”ç”¨ç¨‹åºæ–¹é¢æœ‰å¾ˆå¤šè§’è‰²ï¼Œä½†æ˜¯ç®¡ç†Kubernetesåº”ç”¨ç¨‹åºçš„è§’è‰²å¹¶ä¸å¤šï¼Œå› æ­¤æˆ‘ä»¬å°†åšå‡ºä¸€ç‚¹è´¡çŒ®ã€‚ <br><br> åœ¨å°†è§’è‰²å‘å¸ƒåˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubå</a> ï¼Œå‰©ä¸‹çš„å°±æ˜¯ï¼š <br><br><ol><li> ç™»å½•Ansible Galaxyä»¥è®¿é—®æˆ‘ä»¬åœ¨GitHubä¸Šçš„å­˜å‚¨åº“ã€‚ </li><li> å¯¼å…¥æˆ‘ä»¬çš„è§’è‰²ã€‚ </li></ol><br> å°±æ˜¯è¿™æ ·ï¼Œç°åœ¨æˆ‘ä»¬çš„hello_world_k8sè§’è‰²å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„çš„</a> Ansible Galaxyä¸­å…¬å¼€ä½¿ç”¨ã€‚ <br><br><h3> æ‚¨å¥½Ansibleæ¥çº¿å‘˜ï¼Œè®¤è¯†é“¶æ²³ </h3><br> å¦‚æœæ‚¨ä»”ç»†ç ”ç©¶äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Šçš„Hello Worldé¡¹ç›®</a> ï¼Œæ‚¨å°†æ³¨æ„åˆ°æˆ‘ä»¬åœ¨å…¶ä¸­æ·»åŠ äº†åˆ›å»ºAnsible-operatoræ‰€éœ€çš„å‡ é¡¹å†…å®¹ï¼Œå³ï¼š <br><br><ol><li>  <a href="">ä¸€ä¸ªWatchesæ–‡ä»¶</a> ï¼Œå®ƒå°†Kubernetesçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ªå®šä¹‰èµ„æº</a>æ˜ å°„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ°</a> Ansibleè§’è‰²æˆ–å‰§æœ¬ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Dockerfile</a>æ¥æ„å»ºæˆ‘ä»¬çš„è¿ç®—ç¬¦ã€‚ </li><li> ä½¿ç”¨è¿è¡Œæˆ‘ä»¬çš„æ“ä½œå‘˜æ‰€éœ€çš„Kuberneteså¯¹è±¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éƒ¨ç½²ç›®å½•</a> ã€‚ </li></ol><br> å¦‚æœæ‚¨éœ€è¦äº†è§£æœ‰å…³å¦‚ä½•æ„å»ºè‡ªå·±çš„Ansibleè¯­å¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ä½¿ç”¨ã€Š <a href="">ç”¨æˆ·æŒ‡å—ã€‹</a> ã€‚ ä½†æ˜¯ç”±äºæˆ‘ä»¬æ‰¿è¯ºè¦ä½¿ç”¨Ansible Galaxyä¸­å‘å¸ƒçš„è§’è‰²æ¥æ„å»ºAnsibleè¿ç®—ç¬¦ï¼Œå› æ­¤æˆ‘ä»¬<b>çœŸæ­£</b>éœ€è¦çš„åªæ˜¯ä¸€ä¸ªDockerfileï¼š <br><br><pre> <code class="plaintext hljs">FROM quay.io/operator-framework/ansible-operator RUN ansible-galaxy install djzager.hello_world_k8s RUN echo $'--- \n\ - version: v1alpha1\n\ group: examples.djzager.io\n\ kind: HelloWorld\n\ role: /opt/ansible/roles/djzager.hello_world_k8s' &gt; ${HOME}/watches.yaml</code> </pre><br> ç°åœ¨æˆ‘ä»¬æ”¶é›†è¿ç®—ç¬¦ï¼š <br><br><pre> <code class="plaintext hljs">$ docker build -t hello-world-operator -f Dockerfile . Sending build context to Docker daemon 157.2 kB Step 1/3 : FROM quay.io/operator-framework/ansible-operator latest: Pulling from operator-framework/ansible-operator Digest: sha256:1156066a05fb1e1dd5d4286085518e5ce15acabfff10a8145eef8da088475db3 Status: Downloaded newer image for quay.io/water-hole/ansible-operator:latest ---&gt; 39cc1d19649d Step 2/3 : RUN ansible-galaxy install djzager.hello_world_k8s ---&gt; Running in 83ba8c21f233 - downloading role 'hello_world_k8s', owned by djzager - downloading role from https://github.com/djzager/ansible-role-hello-world-k8s/archive/master.tar.gz - extracting djzager.hello_world_k8s to /opt/ansible/roles/djzager.hello_world_k8s - djzager.hello_world_k8s (master) was installed successfully Removing intermediate container 83ba8c21f233 ---&gt; 2f303b45576c Step 3/3 : RUN echo $'--- \n- version: v1alpha1\n group: examples.djzager.io\n kind: HelloWorld\n role: /opt/ansible/roles/djzager.hello_world_k8s' &gt; ${HOME}/watches.yaml ---&gt; Running in cced495a9cb4 Removing intermediate container cced495a9cb4 ---&gt; 5827bc3c1ca3 Successfully built 5827bc3c1ca3 Successfully tagged hello-world-operator:latest</code> </pre><br> æ˜¾ç„¶ï¼Œè¦<b>ä½¿ç”¨</b>æ­¤è¿ç®—ç¬¦ï¼Œæ‚¨éœ€è¦æˆ‘ä»¬é¡¹ç›®ä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">deployç›®å½•</a>çš„å†…å®¹ï¼Œä»¥åˆ›å»ºæœåŠ¡å¸æˆ·ï¼Œè§’è‰²å’Œè§’è‰²ç»‘å®šï¼Œè‡ªå®šä¹‰èµ„æºå®šä¹‰ä»¥åŠéƒ¨ç½²è¿ç®—ç¬¦æœ¬èº«ã€‚ åœ¨éƒ¨ç½²æ“ä½œå‘˜ä¹‹åï¼Œæ‚¨å°†éœ€è¦åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰èµ„æºæ¥è·å–Hello Worldåº”ç”¨ç¨‹åºçš„å®ä¾‹ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: examples.djzager.io/v1alpha1 kind: HelloWorld metadata: name: example-helloworld namespace: default spec: size: 3</code> </pre><br><h3> æ“ä½œå‘˜èŒƒå›´ï¼šåç§°ç©ºé—´å’Œé›†ç¾¤ </h3><br> ç¨é«˜ä¸€ç‚¹ï¼Œæˆ‘ä»¬å·²ç»å»ºè®®æ¢ç´¢æˆ‘ä»¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">deployç›®å½•ï¼Œ</a>å¹¶åœ¨å…¶ä¸­æŸ¥æ‰¾å¯åŠ¨æ“ä½œå‘˜æ‰€éœ€çš„Kuberneteså¯¹è±¡ã€‚ ä½¿ç”¨éƒ¨ç½²æ“ä½œå‘˜æœ¬èº«çš„åç§°ç©ºé—´ç®¡ç†è‡ªå®šä¹‰èµ„æºæ—¶ï¼Œæœ‰ä¸‰ä»¶äº‹é™åˆ¶äº†æ“ä½œå‘˜çš„èŒƒå›´ï¼š <br><br><ol><li>  <a href="">operator.yaml</a>æ–‡ä»¶ä¸­çš„WATCH_NAMESPACEç¯å¢ƒå˜é‡ï¼Œå‘Šè¯‰æ“ä½œå‘˜åœ¨å“ªé‡Œå¯»æ‰¾è‡ªå®šä¹‰èµ„æº </li><li>  <a href="">è§’è‰²</a> </li><li>  <a href="">è§’è‰²ç»‘å®š</a> </li></ol><br> è¿™ä¸ªé™åˆ¶å¯¹äºè¿è¥å•†çš„å‘å±•å½“ç„¶æ˜¯æœ‰ç”¨çš„ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›é›†ç¾¤çš„æ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥è®¿é—®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œåˆ™éœ€è¦ç®¡ç†å‘˜çš„å¸®åŠ©ã€‚ æˆ‘å°†å¿…é¡»æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š <br><br><ol><li> åˆ›å»ºClusterRoleè€Œä¸æ˜¯Roleã€‚ </li><li> åœ¨å°†è¦éƒ¨ç½²è¯¥è¯­å¥çš„åç§°ç©ºé—´ä¸­åˆ›å»ºServiceAccountè¯­å¥ã€‚ </li><li> åˆ›å»ºä¸€ä¸ªClusterRoleBindingï¼Œå®ƒå°†ç‰¹å®šå‘½åç©ºé—´ä¸­çš„ServiceAccountä¸ClusterRoleå…³è”ã€‚ </li><li> ä½¿ç”¨æœªå®šä¹‰çš„WATCH_NAMESPACEç¯å¢ƒå˜é‡ï¼ˆå³â€œâ€ï¼‰å±•å¼€è¯¥è¯­å¥ã€‚ </li></ol><br> å¦‚æœå®Œæˆæ‰€æœ‰è¿™äº›æ“ä½œï¼Œé‚£ä¹ˆå…¶ä½™çš„ç¾¤é›†ç”¨æˆ·å°†èƒ½å¤Ÿéƒ¨ç½²Hello Worldåº”ç”¨ç¨‹åºçš„å®ä¾‹ã€‚ å¦‚æœæ‚¨å¯¹æ­¤ä¸»é¢˜æ„Ÿå…´è¶£ï¼Œå»ºè®®æ‚¨å­¦ä¹ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Operator Lifecycle Manager</a> ï¼ˆOperatoræ¡†æ¶çš„ä¸€éƒ¨åˆ†ï¼‰ã€‚ <br><br><h3> æ˜Ÿé™…è¿·èˆª </h3><br> æˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªAnsibleè§’è‰²æ¥æ§åˆ¶Kubernetesä¸­çš„åº”ç”¨ç¨‹åºï¼Œå¦‚ä½•åœ¨Ansible Galaxyä¸­å‘å¸ƒæ­¤è§’è‰²ä»¥åŠå¦‚ä½•åœ¨Ansibleè¿ç®—ç¬¦ä¸­ä½¿ç”¨å®ƒã€‚ æˆ‘ä»¬å¸Œæœ›æ‚¨ç°åœ¨ï¼š <br><br><ol><li> æ‚¨å°†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">k8s Ansibleæ¨¡å—</a> ã€‚ </li><li> å¼€å§‹åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ansible Galaxy</a>ä¸Šå‘å¸ƒç”¨äºç®¡ç†Kubernetesåº”ç”¨ç¨‹åºçš„è§’è‰²ã€‚ </li><li> å¯¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Operator SDK</a>æ„Ÿå…´è¶£ï¼Œå¹¶è®¢é˜…<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘ä»¬çš„Operator Frameworkæ–°é—»</a> ã€‚ </li></ol><br> æˆ‘ä»¬æ•…æ„å°†Hello Worldåº”ç”¨ç¨‹åºå˜å¾—éå¸¸ç®€å•ï¼Œä½†æ˜¯æœ‰äº›äº‹æƒ…å¯ä»¥ä½¿å®ƒå˜å¾—æ›´åŠ å¯é ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š <br><br><ol><li> ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Operator</a> SDK-åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ•…æ„æ²¡æœ‰è¿™æ ·åšï¼Œä»¥å¼ºè°ƒä»Ansibleè§’è‰²è½¬æ¢ä¸ºæ“ä½œå‘˜æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚ ä½†æ˜¯æœ€å¥½è¿˜æ˜¯å°†æ­¤è§’è‰²ä¸SDKé…åˆä½¿ç”¨ï¼ˆå³operator-sdk newï¼‰ï¼Œæ­¤å¤–ï¼Œæ‚¨å¯èƒ½éœ€è¦åœ¨ä¸‹ä¸€æ­¥ä¸­ä½¿ç”¨æ­¤è§’è‰²ã€‚ </li><li> éªŒè¯-åœ¨æˆ‘ä»¬å½“å‰çš„ç‰ˆæœ¬ä¸­ï¼Œç”¨æˆ·å¯ä»¥åˆ›å»ºå¤§å°ä¸ºabcçš„CRï¼Œè¿™å°†ä¸å¯é¿å…åœ°åœ¨éƒ¨ç½²é˜¶æ®µå¯¼è‡´é”™è¯¯ã€‚ å› æ­¤ï¼Œæœ€å¥½åœ¨è§„èŒƒé˜¶æ®µè€Œä¸æ˜¯åœ¨å·¥ä½œå¼€å§‹åå‘ç°é”™è¯¯ã€‚ </li><li> ç”Ÿå‘½å‘¨æœŸ-åœ¨æ›´å¤æ‚çš„ç¤ºä¾‹ä¸­ï¼Œå®ƒå¯èƒ½æ˜¯åŒä¸€ç‰ˆæœ¬çš„æ›´æ–°ã€‚ åœ¨åƒæˆ‘ä»¬è¿™æ ·çš„åœºæ™¯ä¸­ï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªç‰ˆæœ¬çš„Hello Worldåº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å·¥ä½œå®¹å™¨çš„æ˜ åƒä¸ç›¸åº”å®¹å™¨æ³¨å†Œè¡¨ä¸­çš„å¯ç”¨æ˜ åƒè¿›è¡Œæ¯”è¾ƒæ¥ç¡®å®šå·¥ä½œå®¹å™¨çš„æ˜ åƒæ˜¯å¦è¿‡æ—¶ï¼Œå¹¶åœ¨å¿…è¦æ—¶æ›´æ–°æ­£åœ¨è¿è¡Œçš„å®ä¾‹ã€‚ </li><li> æµ‹è¯•-åœ¨å¼€å‘å’Œæµ‹è¯•Ansibleè§’è‰²æ—¶ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†å­</a>éå¸¸æœ‰ç”¨ã€‚ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Operator Lifecycle Manager</a>æ˜¯ç”¨äºç®¡ç†æ“ä½œå‘˜çš„å·¥å…·åŒ…ã€‚ ä¸ä¹‹é›†æˆå°†æœ‰åŠ©äºå®‰è£…å’Œæ›´æ–°æˆ‘ä»¬çš„æ“ä½œå‘˜ã€‚ </li><li> çŠ¶æ€-æˆ‘ä»¬å¯ä»¥åœ¨Hello World CRDä¸­æ¿€æ´»çŠ¶æ€å­èµ„æºï¼Œå¹¶ä½¿ç”¨k8s_statusæ¨¡å—ï¼ˆè¿™æ˜¯Ansible Operatoræ˜ åƒçš„ä¸€éƒ¨åˆ†ï¼‰åœ¨è‡ªå®šä¹‰èµ„æºä¸­åŒ…å«çŠ¶æ€ä¿¡æ¯ã€‚ </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN440188/">https://habr.com/ru/post/zh-CN440188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN440176/index.html">2019å¹´ä¸ƒå¤§ç½‘ç»œå®‰å…¨è¶‹åŠ¿</a></li>
<li><a href="../zh-CN440178/index.html">åœ¨Pythonä¸­åˆ é™¤é€’å½’</a></li>
<li><a href="../zh-CN440180/index.html">Qï¼ƒç¼–ç¨‹ç«èµ›ï¼šMicrosoft Qï¼ƒç¼–ç ç«èµ›</a></li>
<li><a href="../zh-CN440182/index.html">IBM Watson Studio-åŸºäºäº‘çš„AIåº”ç”¨ç¨‹åºå¼€å‘å¹³å°</a></li>
<li><a href="../zh-CN440184/index.html">ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨8baseä¸­ä½¿ç”¨GraphQL</a></li>
<li><a href="../zh-CN440190/index.html">ç†Ÿæ‚‰æœ€ç®€å•çš„ç¥ç»ç½‘ç»œåŠå…¶åˆ†æ­¥å®æ–½</a></li>
<li><a href="../zh-CN440192/index.html">æˆ‘ä»¬å¦‚ä½•ä¸ºæˆ‘ä»¬åˆ¶ä½œä¼ä¸šç”µå°</a></li>
<li><a href="../zh-CN440196/index.html">å¿ƒçµä¸æ•°å­¦çš„ç§˜å¯†</a></li>
<li><a href="../zh-CN440198/index.html">é¢å‘ä¸“ä¸šäººå£«çš„æ–°å‹DWS 3Dæ‰“å°æœº</a></li>
<li><a href="../zh-CN440200/index.html">è®©æˆ‘ä»¬è°ˆè°ˆè®°å½•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>