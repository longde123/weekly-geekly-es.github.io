<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìê üßëüèΩ‚Äçü§ù‚ÄçüßëüèΩ üåº Wie ich einen Park-Tracker f√ºr Leute gemacht habe üßëüèª‚Äçü§ù‚Äçüßëüèª üë®üèª‚Äçüé® üéÖüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor kurzem habe ich wieder geklemmt. Ich lebe in Europa und hier verketten sie das Geld Ihres Autos, anstatt Geldstrafen f√ºr unsachgem√§√ües Parken und ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich einen Park-Tracker f√ºr Leute gemacht habe</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464451/">  Vor kurzem habe ich wieder geklemmt.  Ich lebe in Europa und hier verketten sie das Geld Ihres Autos, anstatt Geldstrafen f√ºr unsachgem√§√ües Parken und Abschleppwagen zu verh√§ngen.  Um rauszukommen, m√ºssen Sie einen Anruf t√§tigen, eine runde Summe bezahlen und darauf warten, dass der Mann mit den Schl√ºsseln die Kette anhebt.  Es ist lang, dem√ºtigend und manchmal (je nach Region) r√§uberisch teuer. <br><br>  An diesem Tag war ich √ºberall zu sp√§t.  Ich wartete darauf, dass der Arbeiter mit den Schl√ºsseln klingelte, und fragte mich, wie dumm ich wurde.  Ich rannte hinein, verlie√ü das Auto f√ºr eine halbe Stunde anstatt der maximal 20 Minuten - genau in der 21. Minute und wurde erwischt.  Leider war der gestreifte Van des Parkplatzes nicht weit entfernt und sie reagierten sofort.  Sie hatten mich aus verschiedenen Gr√ºnden schon einmal erwischt: Ich verga√ü, die bezahlte Frist lief ab, und manchmal konnte ich mein Auto einfach nicht im Labyrinth der Stra√üen finden. <br><br>  "Es muss f√ºr alles eine Anwendung geben", dachte ich und begann, in den App Store einzutauchen.  Nach einer Menge zweifelhafter Ergebnisse nahm mein Selbstvertrauen ab und ich beschloss zu kl√§ren: "Es muss f√ºr alles eine Android-Anwendung geben."  Dann fand er seinen Huavei und stieg in den Darm des Spielladens.  Von dort ergossen sich weitere Tr√ºmmer auf mich, und als ich in ungeschicktem Handwerk ertrank, spuckte ich aus.  Entweder sehe ich irgendwie falsch aus oder es gibt keinen bequemen und verst√§ndlichen Park-Tracker.  Die Schlussfolgerung ist einfach: Wenn wir nichts haben, machen wir es selbst. <br><br>  Vor dem Hintergrund sah ich bereits einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">langfristigen Bau</a> , der mir fast meine gesamte Freizeit nahm.  Ich beschloss, eine Pause einzulegen und in der Pause eine weitere Projektion zu sammeln.  Nachdem ich die gew√ºnschte Funktionalit√§t gesch√§tzt hatte, stellte ich mir einen Zeitraum von anderthalb Monaten vor. Mit Blick auf die Zukunft werde ich sagen, dass es im Prinzip noch schneller geworden ist.  Das Ergebnis war eine kompakte und saubere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anwendung</a> auf beiden Plattformen, sehr praktisch.  Jetzt benutze ich es selbst und schlage vor, dass Sie es versuchen. <br><br><img src="https://habrastorage.org/webt/2w/wl/zl/2wwlzlz-6vimwsq9dt2xmyv-bqk.png" alt="Bild" width="800"><br><a name="habracut"></a><br><h3>  Idee </h3><br>  Was m√∂chte ich von einem Park-Tracker?  Was vermisse ich immer, wenn ich eine Geldstrafe bekomme?  Nach dem Nachdenken formulierte ich die folgende Einf√ºhrung: <br><br><ol><li>  Einfach.  Idealerweise mit einem Knopfdruck.  Ein Minimum an ablenkenden Funktionen: keine Profile, Parkverlauf, Unterst√ºtzung f√ºr mehrere Autos gleichzeitig usw. </li><li>  Mit Benachrichtigungen.  Ich w√ºrde das Auto nicht vergessen, wenn mich die Bewerbung daran erinnern w√ºrde: Bruder, du hast dort √ºbrigens einen Parkplatz und es l√§uft bald ab. </li><li>  Betrachten Sie die Gehzeit.  Dies ist der einfachste Gedanke, den ich nirgendwo verk√∂rpert gesehen habe.  Ich muss nicht wissen, dass der Parkplatz in 5 Minuten abl√§uft, wenn ich eine halbe Stunde davon entfernt bin.  Ich muss daran erinnert werden, dass ich ein paar Minuten vor dem Ende zum Auto <b>komme</b> und gehe. </li><li>  Route und Navigation zum Parkplatz.  Navigation nat√ºrlich √ºber Google oder Apple Maps, aber die Route kann in Ihrer Anwendung angezeigt werden.  Dies ist hilfreich, wenn Sie das Auto in einem unbekannten Bereich stehen lassen, der Timer tickt und Sie im Kreis durch dieselben Stra√üen laufen. </li></ol><br>  Ich habe Flutter als technologische Basis gew√§hlt, da ich seit einiger Zeit damit arbeite und es f√ºr gut halte.  F√ºr Routen habe ich mich entschieden, die HERE-API auch nicht zum ersten Mal zu verwenden, sondern f√ºr die Karte - Mapbox.  Ich skizzierte mehrere Optionen f√ºr die Benutzeroberfl√§che, w√§hlte die minimalistischste aus und beteiligte mich an der Arbeit. <br><br><h3>  Entwicklung </h3><br>  √úber den Entwicklungsprozess selbst gibt es grunds√§tzlich nicht viel zu erz√§hlen.  Hier gibt es keinen Serverteil, den einfachsten Client, der im Wesentlichen aus einer gro√üen Ansicht in verschiedenen Zust√§nden besteht.  Auf der ersten Seite w√§hlen Sie entweder eine Voreinstellung aus - 1, 2, 4, 6 Stunden - oder verwenden den Schieberegler, um Ihre Parkdauer anzupassen.  Nachdem ich es live ausprobiert hatte, stellte ich fest, dass der Schieberegler unh√∂flich genug war, und f√ºgte die Schaltfl√§chen ‚Äû+‚Äú und ‚Äû-‚Äú hinzu.  Eine lustige und ziemlich offensichtliche Nuance war, dass die Zeit weitergeht, w√§hrend Sie sich entscheiden.  Sie m√ºssen diese Ansicht also in Echtzeit aktualisieren.  Klicken Sie nach Auswahl des Begriffs auf die einzige Schaltfl√§che unten. Die Standort- und Zeitdaten werden gespeichert und das Parken beginnt.  Es ist wichtig zu beachten, dass ich grunds√§tzlich alle Daten an Bord speichere, nichts wird auf einen Server √ºbertragen.  Das wird mir in Zukunft √ºbrigens Schwierigkeiten bereiten, aber dazu sp√§ter mehr. <br><br>  Die zweite Seite ist in der Tat der Park-Timer.  Ich habe hier eine Reihe von Optionen ausprobiert: Ich habe mit wild √ºberladenen Prototypen von Informationen begonnen, sie dann iterativ entfernt und bis an die Grenzen vereinfacht.  Ich wollte wirklich, dass der Parkstatus nicht trocken, sondern visuell angezeigt wird. Daher war das Hauptelement dieser Seite zusammen mit der Karte eine Donut-Tabelle.  Es zeigt die verstrichene Zeit, die Gehzeit und die verbleibende Zeit.  Wenn Sie sich nicht in der N√§he des Autos befinden und die Gehzeit ungleich Null ist, wird eine Navigationsstartschaltfl√§che angezeigt und auf der Karte wird eine ungef√§hre Route zum Parkplatz angezeigt.  Das ist in der Tat alles. <br><br>  Trotz der visuellen Einfachheit hat dieser Bildschirm meine Nerven ziemlich durcheinander gebracht.  Es versteht sich, dass w√§hrend des Parkens eine Reihe von Prozessen gleichzeitig ablaufen: <br><br><ul><li>  Die Zeit vergeht und der Timer l√§uft ab </li><li>  Sie bewegen sich und die Reisezeit √§ndert sich </li></ul><br>  All dies geschieht in Echtzeit und sollte sofort auf der Benutzeroberfl√§che angezeigt werden.  Die Karte sollte reibungslos neu erstellt werden, die Karte sollte sich bewegen und die Route neu zeichnen. Wenn die Gefahr einer Versp√§tung besteht oder das Parken abl√§uft, sollte auch die entsprechende Warnung angezeigt werden.  Au√üerdem: Wenn Sie die Anwendung schlie√üen und √∂ffnen, m√ºssen Sie dies alles korrekt wiederherstellen.  Und schlie√ülich das Be√§ngstigende: Alle Funktionen sollten im Hintergrund arbeiten k√∂nnen, da die Anwendung den gr√∂√üten Teil ihres Lebens im Hintergrund verbringen wird.  Solche Dinge. <br><br>  Ich werde die Implementierung nicht im Detail beschreiben, ich kann nur sagen, dass die Flatterarbeit mit den Staaten sehr w√ºrdig ist.  Wo sich in einem reinen Android ein √ºberladenes objektorientiertes Design herausstellen w√ºrde, stellte sich heraus, dass es einfach und elegant war.  Normale verst√§ndliche Zust√§nde, vern√ºnftige Bindung von Ansichten an Modelle - bei Aufgaben wie diesem leuchtet das Flattern.  Es war jedoch nicht ohne typische Pfosten: Beispielsweise hat die lokale Bibliothek zum Arbeiten mit Karten keinen animierten √úbergang zu neuen Koordinaten.  Ich musste in ihren Code einsteigen, einige private Methoden herausholen und meine Kr√ºcke hinzuf√ºgen.  Es ist m√∂glich, dass diese Funktionalit√§t bald hinzugef√ºgt wird, aber dies ist das ganze Flattern - seien Sie bei aller Attraktivit√§t auf solche Entdeckungen vorbereitet. <br><br>  Alles andere schien reibungslos zu funktionieren.  Eigentlich gab es nicht viel anderes: ein paar Dialoge und eine Intro-Seite, f√ºr die meine Freundin (sie war <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">K√ºnstlerin</a> ) nette Animationen zeichnete.  Schlie√ülich √ºbersetzte ich die gesamte Anwendung einschlie√ülich der Karte ins Russische.  Aber dann begann der Schmerz: Benachrichtigungen. <br><br><h3>  Benachrichtigungen </h3><br>  F√ºr mich war die M√∂glichkeit, intelligente Benachrichtigungen zu senden, der Schl√ºssel zur Anwendung - ohne sie gibt es nichts, wor√ºber man sich aufregen k√∂nnte.  Als ich jedoch anfing, an dieser Funktion zu arbeiten, stellte ich fest, dass ich auf meinen eigenen Fu√ü getreten war.  Es gab tats√§chlich zwei Probleme.  Das erste ist das Flattern, das nicht wei√ü, wie man mit Low-Level-API-Ger√§ten arbeitet: Sie m√ºssen eine Dichtung in Form eines Plug-Ins schreiben, das zwei native Codes und eine Abstraktion auf dem Pfeil enth√§lt.  Das zweite Problem ist meine grunds√§tzliche Position, dass alles an Bord durchgef√ºhrt werden sollte.  Wir fassen also zusammen, was ben√∂tigt wird.  Es ist notwendig, dass die Anwendung <b>im Hintergrund</b> : <br><br><ol><li>  St√§ndige √úberwachung Ihrer Geolokalisierung, </li><li>  √úberpr√ºft, wie viele Minuten zu Fu√ü zum Parkplatz </li><li>  Wird mit ablaufendem Timer √ºberpr√ºft </li><li>  Wenn das Risiko besteht, keine Zeit f√ºr die R√ºckkehr zu haben, wird ein Benachrichtigungsschuss erstellt </li></ol><br>  F√ºhlen Sie das Ausma√ü der Trag√∂die?  Es ist klar, dass es keine technische M√∂glichkeit gibt, dies zu tun, wenn die Anwendung vollst√§ndig beendet wird.  Angenommen, es wird einfach minimiert und der Bildschirm ist ausgeschaltet.  HIER gibt mir die API die Route und die Sch√§tzung der Gehzeit. Bedeutet dies, dass die Anwendung im Hintergrund Spam-Anfragen sendet?  Wie viel Code wird √ºberhaupt ausgef√ºhrt?  Wie gehen wir mit Ged√§chtnis und Energieverbrauch um? <br><br>  Ich setzte mich zum Nachdenken.  Begonnen mit einem kleinen: Technisch gesehen hatte Flutter in letzter Zeit die M√∂glichkeit, Code im Hintergrund auszuf√ºhren. Es wird als isolieren bezeichnet.  Wenn alles korrekt geschrieben ist, k√∂nnen Sie die Logik auf eine bestimmte Weise erstellen, sodass nicht alles vor dem Hintergrund ausgef√ºhrt wird, sondern bestimmte Funktionen.  In der Tat m√ºssen wir im minimierten Modus keine Schnittstellen zeichnen oder Zust√§nde aktualisieren - wir sind an der blo√üen Logik der Zeitberechnung interessiert, und diese Logik ist ziemlich kompakt und billig.  Gleichzeitig sollte es nicht wie in der Originalversion durch eine √Ñnderung der Geolokalisierung ausgel√∂st werden, sondern durch einen internen Timer.  Denn die Benachrichtigung sollte fliegen, auch wenn Sie sich nicht bewegen, sondern still sitzen. <br><br>  Nun, wir haben einen leichtgewichtigen Code geschrieben, der im Hintergrund ausgef√ºhrt werden kann und von einem Timer gesteuert wird.  Wie k√∂nnen wir es im Rahmen nativer Anwendungen ausl√∂sen und dort Geolokalisierungsdaten √ºbertragen?  Es stellte sich anders heraus. <br><br>  Die Logik von Android und iPhone in Bezug auf die Codeausf√ºhrung im Hintergrund ist radikal anders.  Bei einem iPhone fehlt es als solches: Der Hintergrundcode kann nur ein Systemereignis einer bestimmten Art ausl√∂sen, z. B. das Abspielen von Audio-Streaming oder, zum Gl√ºck f√ºr mich, das Aktualisieren des Standorts.  Fordern Sie dazu einfach Berechtigungen an und abonnieren Sie das Ereignis im nativen Teil des Flater-Plug-Ins.  Von dort aus rufen wir √ºber einen bestimmten Kommunikationskanal (MethodChannel) den R√ºckruf in einem Pfeil auf, √ºbergeben die Geodaten an ihn und beginnen den Hintergrund mit der Logik, die wir ben√∂tigen.  Sch√∂nheit <br><br>  Android funktioniert anders.  Technisch gesehen kann er Code im Hintergrund ausf√ºhren, ohne an Systemereignisse gebunden zu sein. Dazu m√ºssen Sie den Dienst beschreiben.  Es h√§ngt getrennt von der Anwendung, entweder vollst√§ndig im Hintergrund oder auf dem Untergrund (dort macht es sich durch eine angeh√§ngte Nachricht im Blind bemerkbar).  Es scheint, dass das Problem behoben wurde: Im nativen Teil des Plugins beschreiben wir einen Hintergrunddienst, der den Speicherort verfolgt und den Darth-Code abruft.  Es gibt jedoch eine Nuance.  Ab Android Version 8.0 hat sich die Einstellung zu solchen Diensten ge√§ndert: Wenn die Anwendung derzeit minimiert wird, werden ihre Hintergrunddienste h√∂llisch von der Achse abgeschnitten, um Energie zu sparen.  Und wenn Ihr Code beispielsweise eine Datensicherung durchf√ºhrt, ist es Ihnen im Grunde egal, zu welchem ‚Äã‚ÄãZeitpunkt die Achse ihn arbeiten l√§sst - Hauptsache, er funktioniert.  In meinem Fall m√ºssen wir den Ortswechsel jedoch fast in Echtzeit verfolgen, und das Timing ist hier entscheidend.  Daher besteht der einzige Ausweg darin, den Dienst fehlerfrei zu starten.  Wir beschreiben eine kleine Benachrichtigung im Vorhang, abonnieren den Ort und senden ihn √ºber den MethodChannel an den Dart.  Alles scheint zu funktionieren. <br><br>  √úbrigens, zur√ºck zu den Themen Speicher, Energieverbrauch und Anzahl der Anforderungen - der Code wird ausgef√ºhrt, wenn der Standort auf 50 Meter verschoben wird, oder per Timer.  Au√üerdem ist er selbst sehr leicht und die Anfragen gehen nicht durch mich, sondern gehen direkt zur HIER-API.  Ich selbst erhalte keine Daten und speichere sie nirgendwo.  Im Allgemeinen ist eine solche Implementierung hier sehr gut beschrieben, dies ist der Blog eines der Flatteringenieure - der Code ist auch dort beigef√ºgt.  Sein Beispiel ist etwas anders, aber der allgemeine Ansatz ist klar, deshalb empfehle ich, es zu lesen. <br><br><h3>  Ergebnis </h3><br>  Das ist in der Tat alles.  F√ºr einen Monat Freizeit habe ich eine Anwendung erhalten, die ein bestimmtes Problem perfekt l√∂st.  Ich hoffe, dieser Artikel wird f√ºr jemanden interessant sein und die Anwendung wird Sie vor Geldstrafen und Stress bewahren.  Sie k√∂nnen hier schauen und schimpfen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Android</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">iOS</a> . <br><br>  Vielen Dank f√ºr Ihre Aufmerksamkeit. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464451/">https://habr.com/ru/post/de464451/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464435/index.html">Wie man nicht in einem Meer von Technologie und Ans√§tzen ertrinkt: die Erfahrung von 50 Experten</a></li>
<li><a href="../de464437/index.html">Wie das Entwicklungsteam mehr verdienen kann, indem es Verkehrsseiten erstellt [Implementierungshandbuch]</a></li>
<li><a href="../de464443/index.html">Natas Web. Passage der CTF-Plattform zur Ausnutzung von Web-Schwachstellen. Teil 2</a></li>
<li><a href="../de464445/index.html">Warum es wirklich unm√∂glich ist, Vegetarier zu sein</a></li>
<li><a href="../de464447/index.html">Count Scoring de la Fer oder eine Studie zum Kredit-Scoring als Teil der Erweiterung des eigenen Horizonts. Teil 1</a></li>
<li><a href="../de464453/index.html">Huskies: entfernen, verlassen, ersetzen? Was?</a></li>
<li><a href="../de464457/index.html">22 Websites f√ºr einen Programmierer, der Ihnen hilft, Englisch zu sprechen</a></li>
<li><a href="../de464459/index.html">Vier Regeln f√ºr intuitive UX</a></li>
<li><a href="../de464463/index.html">iOS Responder Chain oder was sie beim Interview fragen</a></li>
<li><a href="../de464465/index.html">Wie und warum haben wir Preply nach Kubernetes migriert?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>