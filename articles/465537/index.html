<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµüèº ‚ùÑÔ∏è ü§∏üèΩ Yandex: una casa inteligente para adultos üë©üèæ‚Äçü§ù‚Äçüë®üèø üíí ‚ùÑÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, Yandex lanz√≥ su sistema de hogar inteligente. Se nos ofrece comprar dispositivos Wi-Fi econ√≥micos: un adaptador en una toma de corrient...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Yandex: una casa inteligente para adultos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465537/"><img src="https://habrastorage.org/webt/rs/l_/lm/rsl_lmpzna0pj3o9ahxzsawpsn0.png"><br><br>  Recientemente, Yandex lanz√≥ su sistema de hogar inteligente.  Se nos ofrece comprar dispositivos Wi-Fi econ√≥micos: un adaptador en una toma de corriente, una bombilla y un control remoto IR.  Es interesante que los desarrolladores de dispositivos "inteligentes" tengan la oportunidad de crear sus habilidades de "hogar inteligente", esto le permitir√° conectar dispositivos al sistema Yandex y administrar su voz a trav√©s de Alice.  Cada vez aparecen m√°s marcas nuevas en las listas de habilidades.  Alice entiende perfectamente el habla rusa, lo que la convierte en la l√≠der indiscutible entre los asistentes de voz en el mercado ruso. <br>  Sin embargo, no todo es tan sencillo ... <br><a name="habracut"></a><br>  Primer inconveniente: b√°sicamente, todos los sistemas propuestos est√°n "nublados".  A veces se pone en duda su fiabilidad, ya que su rendimiento depende directamente de la calidad de la conexi√≥n con los servidores del fabricante.  Y cuando apaga Internet, los dispositivos se convierten completamente en una "calabaza". <br><br>  Segundo menos: sistema de secuencias de comandos.  Una parte importante de una casa inteligente son los guiones.  Y aqu√≠ son muy primitivos: si "la frase es tal y tal", entonces habilite "el dispositivo es tal y tal".  Para mi casa inteligente, esto era muy poco. <br><br>  Los contras no terminan ah√≠, pero el resto probablemente est√© relacionado con la inmadurez del sistema.  El equipo de desarrollo de Yandex contin√∫a agregando activamente varias funciones y errores para editar, ¬°muchas gracias a ellos! <br><br>  Despu√©s de estudiar la documentaci√≥n, decid√≠ crear la habilidad Yandex UD y conectarle el controlador de casa inteligente.  Esto le permitir√° no depender de servidores en la nube, implementar scripts localmente en el controlador y al mismo tiempo controlar el sistema por voz a trav√©s de Alice.  Para esto, escrib√≠ el complemento "yandex2mqtt" en Node.js. <br><br><h4>  Poco de teor√≠a </h4><br>  - Alice, enciende la luz. <br>  Despu√©s de esta frase, ocurre la magia y la luz se enciende.  Pero, ¬øqu√© hay detr√°s de escena?  Veamos c√≥mo funciona todo. <br><br>  La estaci√≥n Yandex, despu√©s de escuchar un comando familiar, env√≠a datos al servidor Yandex, al que especificamos la direcci√≥n de nuestro controlador de antemano.  El servidor procesa la informaci√≥n y la redirige al controlador en forma de una solicitud posterior.  En el controlador, la API intermedia (en nuestro caso, este es el complemento yandex2mqtt) procesa la solicitud y la redirige al tema MQTT.  A continuaci√≥n, el script se procesa en el programa Node-Red. <br><br>  Node-Red decide qu√© hacer a continuaci√≥n.  Si el script lo proporciona, env√≠a un comando para encender la luz en el tema MQTT correspondiente.  El controlador wb-mqtt-serial responde enviando un comando Modbus al m√≥dulo de rel√©, que conmuta el rel√©.  Y finalmente, la luz se enciende!  S√≠, el camino no est√° cerca, pero algunas fracciones de un segundo pase para el usuario. <br><br>  Echemos un vistazo m√°s de cerca al complemento yandex2mqtt.  Lo primero que Yandex requiere para que la habilidad funcione es el servicio oAuth para agrupar cuentas en la aplicaci√≥n Yandex.  Despu√©s de que Yandex recibe el token de autorizaci√≥n del servicio oAuth, solicita una lista de dispositivos.  El complemento yandex2mqtt responde con una lista de dispositivos con todas las propiedades en formato json.  Luego aparecen en la lista de dispositivos disponibles para el control (en el llamado cu√°sar).  Ahora, si le dice a Alice que encienda alg√∫n dispositivo de la lista, Yandex enviar√° una solicitud de publicaci√≥n con los datos del dispositivo que desea encender al controlador.  En respuesta, el complemento confirma la inclusi√≥n y escribe el nuevo estado en el tema mqtt especificado en la configuraci√≥n del mismo complemento.  Si el dispositivo cambi√≥ su estado sin la participaci√≥n de Yandex, entonces el complemento, al ver los nuevos datos en el tema mqtt, lo enviar√° a Yandex cuando solicite el estado, lo que ahora est√° sucediendo solo si ingresa al dispositivo en el quasar.  En otros casos, Yandex no sondea los estados. <br>  Ahora hablar√© sobre algunas de las propiedades de los dispositivos UD Yandex. <br><br><h4>  Tipo de dispositivo </h4><br>  Para una visualizaci√≥n correcta en el "cu√°sar" y una definici√≥n m√°s precisa de los comandos de Alice, Yandex sugiere asignar diferentes tipos de dispositivos a los dispositivos.  Tipos totales 10: <br><br><ul><li>  <b>devices.types.light</b> : cualquier l√°mpara, l√°mpara de ara√±a, bombilla, etc. </li><li>  <b>devices.types.socket</b> - Outlet </li><li>  <b>devices.types.switch</b> - Interruptor </li><li>  <b>devices.types.thermostat</b> - Termostato </li><li>  <b>devices.types.thermostat.ac</b> - Aire acondicionado </li><li>  <b>devices.types.media_device</b> - Dispositivo de medios </li><li>  <b>devices.types.media_device.tv</b> - TV </li><li>  <b>devices.types.cooking</b> - Electrodom√©sticos de cocina </li><li>  <b>devices.types.cooking.kettle</b> - Creador </li><li>  <b>devices.types.other</b> : todo lo dem√°s que no se ajustaba a los p√°rrafos anteriores. </li></ul><br><h5>  Capacidad </h5><br>  Adem√°s, cada dispositivo debe tener al menos una <b>capacidad</b> . <br><br>  En total, Yandex UD tiene 5 tipos de habilidades.  Cada habilidad tiene una funci√≥n diferente <b>(instancia)</b> , y algunas habilidades tienen varias funciones, lo que agrega flexibilidad al configurar dispositivos. <br><br>  <b>Capacidades:</b> <br><br>  1. <b>devices.capabilities.on_off</b> - Enciende y apaga. <br><br>  instancia: <br><br><ul><li>  en </li></ul><br>  2. <b>devices.capabilities.color_setting</b> : gesti√≥n del color. <br><br>  instancia: <br><br><ul><li>  rgb </li><li>  hsv </li><li>  temperatura_k </li></ul><br>  3. <b>devices.capabilities.mode: modos de cambio.</b> <br><br>  instancia: <br><br><ul><li>  termostato </li><li>  fan_speed </li></ul><br>  4. <b>devices.capabilities.range - Control de rango.</b> <br><br>  instancia: <br><br><ul><li>  brillo </li><li>  temperatura </li><li>  volumen </li><li>  canal </li></ul><br>  5. <b>devices.capabilities.toggle - Silencio.</b> <br><br>  instancia: <br><br><ul><li>  mudo </li></ul><br><br>  Con la combinaci√≥n correcta de todas las propiedades del dispositivo, Alice comprende sin ning√∫n problema todos los comandos para administrar el Smart Home que se le han dado.  Aqu√≠, por supuesto, hay algunas dificultades para combinar habilidades.  La documentaci√≥n claramente no indica qu√© habilidades se pueden combinar y cu√°les no.  Pero el "m√©todo de empuje cient√≠fico" nos ayudar√° con esto. <br><br>  Entonces, por ejemplo, descubr√≠ que el aire acondicionado contiene cuatro habilidades: <br><br>  Tipo de dispositivo: <br><br>  <b>devices.types.thermostat.ac</b> <br><br>  Tipo de habilidad: <br><br>  <b>devices.capabilities.on_off</b> <br><br>  instancia: <br><br><ul><li>  en </li></ul><br>  <b>dispositivos.capacidades.rango</b> <br>  instancia: <br><br><ul><li>  temperatura </li></ul><br>  <b>dispositivos.capacidades.modo</b> <br>  instancia: <br><br><ul><li>  termostato </li></ul><br>  <b>dispositivos.capacidades.modo</b> <br>  instancia: <br><br><ul><li>  fan_speed </li></ul><br>  No describir√© las propiedades restantes, todo es bastante simple all√≠. <br><br>  Para que funcione, necesitas: <br><br><ul><li>  <b>Controlador</b> </li><li>  <b>Cualquier dominio</b> </li><li>  <b>Certificado SSL</b> </li><li>  <b>Node.js</b> </li><li>  <b>Yandex2mqtt plugin</b> </li><li>  <b>Corredor MQTT</b> </li><li>  <b>Rojo-nodo</b> </li></ul><br><h3>  Controlador </h3><br>  Mi apartamento "inteligente" est√° controlado por Wiren Board 6. Pero puede usar cualquier otro controlador Linux que extraiga Node.js y Node-Red.  Por ejemplo, Raspberry pi o PC. <br><br><h4>  Dominio </h4><br>  Por supuesto, es deseable tener una direcci√≥n IP blanca y comprar un dominio, pero esto no es necesario.  Puede usar DDNS, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.noip.com</a> . <br><br>  Aqu√≠ todo es simple: reg√≠strese, cree un nombre de host gratuito, ingrese su direcci√≥n IP.  Algunos enrutadores tienen una configuraci√≥n DDNS especial donde puede ingresar datos de noip.com.  El enrutador enviar√° autom√°ticamente una direcci√≥n IP cuando se cambie.  Si no existe tal configuraci√≥n en el enrutador, puede instalar el programa noip en el controlador y agregarlo a la ejecuci√≥n autom√°tica.  El programa har√° exactamente lo mismo que un enrutador con configuraciones DDNS especiales: actualice su direcci√≥n IP en la base de datos de noip.com <br><br>  Por lo tanto, tenemos una direcci√≥n est√°tica que redirige todas las solicitudes a nuestro controlador. <br><br><h4>  Puertos 443 y 80 </h4><br>  Ahora casi todos en casa tienen un enrutador.  Adem√°s de sus funciones obvias, tambi√©n es una barrera para la red local de los invitados no deseados del exterior.  Pero en ciertos casos, necesitamos acceso a la red interna desde el exterior.  Los fabricantes de enrutadores imaginaron esto y agregaron la funci√≥n NAT (traducci√≥n de direcciones de red). <br><br>  No describir√© el momento de configurar el enrutador, ya que es diferente para cada fabricante.  C√≥mo hacer esto, lea las instrucciones para su enrutador.  Palabras clave de Google: reenv√≠o de puertos, mapeo de puertos, NAT. <br><br>  Es necesario reenviar el puerto para acceder a yandex2mqtt (puede ser cualquiera, eleg√≠ 443) y el puerto 80 (solo es necesario para obtener un certificado SSL. Despu√©s de recibir el certificado, el puerto 80 puede cerrarse). <br><br><h4>  Certificado SSL </h4><br>  Inmediatamente ponga todos los puntos en "y": los certificados autofirmados no funcionar√°n. <br>  La mayor√≠a de los registradores de dominios (por ejemplo, reg.ru) otorgan a sus clientes certificados SSL gratuitos para el dominio principal (www.yourdomain.ru).  Si compr√≥ un dominio espec√≠ficamente para Alice, puede usar el certificado SSL proporcionado. <br><br>  Si no tiene su propio dominio, o tiene otro subdominio asignado para Alice (por ejemplo, alice.yourdomain.ru), entonces necesita obtener un certificado para este subdominio o para la direcci√≥n proporcionada por el servicio DDNS. <br><br>  Para hacer esto, propongo usar el servicio gratuito para obtener un certificado SSL de letsencrypt.org. <br><br>  Para obtener un certificado, debe instalar el programa certbot, ejecutar y especificar todos los datos que solicita.  Al mismo tiempo, el puerto 80 debe ser gratuito y accesible desde el exterior. Le aconsejo que estudie detenidamente las instrucciones de letsencrypt. <br><br><div class="spoiler">  <b class="spoiler_title">Instalar y configurar certbot</b> <div class="spoiler_text"><pre><code class="bash hljs">apt-get update apt-get install certbot</code> </pre> <br><br>  Detenga los servicios de vigilancia y nginx. <br><br><pre> <code class="bash hljs">service watchdog stop service nginx stop</code> </pre> <br>  Reenviamos el puerto 80 en el enrutador. <br><br>  Ejecute el programa certbot: <br><br><pre> <code class="bash hljs">certbot certonly --standalone</code> </pre> <br>  Despu√©s de comenzar, el programa har√° algunas preguntas simples. <br><br>  1. Su correo electr√≥nico  Simplemente ingrese la direcci√≥n y presione enter <br><br><img src="https://habrastorage.org/webt/mn/gf/si/mngfsiaatuo6txsrtc6wyyz4v_o.png"><br><br>  2. Se le solicita que lea los acuerdos de usuario.  Si est√° de acuerdo con todo, simplemente ingrese "A", que significa Acepto, es decir, estoy de acuerdo. <br><br><img src="https://habrastorage.org/webt/y8/zz/to/y8zztosybjouwmncxuawmbq-55c.png"><br><br>  3. El programa solicita permiso para enviar su direcci√≥n de correo electr√≥nico a los desarrolladores.  Ingrese N. <br><br><img src="https://habrastorage.org/webt/pn/y_/yw/pny_ywp5pjfj7gupd09m3hnbmg4.png"><br><br>  4. Ingrese su dominio para el cual desea recibir un certificado (puede ingresar el que recibimos en noip anteriormente).  Aqu√≠ doy un ejemplo de entrada err√≥nea.  El prefijo http: // no es obligatorio. <br><br><img src="https://habrastorage.org/webt/mt/bj/py/mtbjpyenb63jqv3gvtd_oyh9qze.png"><br><br>  Si hiciste todo correctamente, ver√°s lo siguiente: <br><br><img src="https://habrastorage.org/webt/ug/7c/kf/ug7ckfuvos8bkgfgzvaepqvu48s.png"><br><br>  Esto significa que el certificado se recibi√≥ con √©xito.  Recuerde la ruta al certificado y la clave, ser√° necesario al configurar el complemento yandex2mqtt.  Por seguridad, cierre el puerto 80 en la configuraci√≥n del enrutador, ya no ser√° √∫til. <br><br>  Activamos los servicios de vigilancia y nginx. <br><br><pre> <code class="bash hljs">service nginx start service watchdog start</code> </pre> <br>  El certificado de letsencrypt se emite por <b>3</b> meses.  <b>No te olvides de actualizar.</b> <br><br></div></div><br><h4>  Node.js y el complemento yandex2mqtt </h4><br><div class="spoiler">  <b class="spoiler_title">Instalaci√≥n</b> <div class="spoiler_text">  Configurar el repositorio de node.js <br><br><pre> <code class="bash hljs">curl -sL https://deb.nodesource.com/setup_10.x | bash -</code> </pre> <br>  A continuaci√≥n, instale o actualice todos los componentes necesarios. <br><br><pre> <code class="bash hljs">apt-get install -y nodejs git make g++ gcc build-essential</code> </pre> <br>  Despu√©s de una instalaci√≥n exitosa, copie el repositorio yandex2mqtt al controlador. <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/munrexio/yandex2mqtt.git /mnt/data/root/yandex2mqtt</code> </pre> <br>  Nosotros establecemos los derechos. <br><br><pre> <code class="bash hljs">chown -R root:root /mnt/data/root/yandex2mqtt</code> </pre> <br>  Vamos a la carpeta <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /mnt/data/root/yandex2mqtt</code> </pre> <br>  Comenzamos la instalaci√≥n. <br><br><pre> <code class="bash hljs">npm install</code> </pre> <br>  Instalaci√≥n completada. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Inicio autom√°tico</b> <div class="spoiler_text">  <b>Crear una unidad systemd:</b> <br><br>  Vaya a la carpeta <b>/ etc / systemd / system /</b> en el controlador y cree un archivo llamado <b>yandex2mqtt.service</b> .  Copie lo siguiente en √©l: <br><br><pre> <code class="bash hljs">[Unit] Description=yandex2mqtt After=network.target [Service] ExecStart=/usr/bin/npm start WorkingDirectory=/mnt/data/root/yandex2mqtt StandardOutput=inherit StandardError=inherit Restart=always User=root [Install] WantedBy=multi-user.target</code> </pre> <br>  Despu√©s de eso, guarde los cambios y cierre el archivo. <br><br>  Para habilitar la unidad, ingrese el comando en la consola: <br><br><pre> <code class="bash hljs">systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> yandex2mqtt.service</code> </pre> <br><br>  Ahora puede iniciar y detener el complemento con comandos <br><br><pre> <code class="bash hljs">service yandex2mqtt start service yandex2mqtt stop service yandex2mqtt restart</code> </pre> <br></div></div><br>  <b>Configuraci√≥n:</b> <br><br>  Todas las configuraciones de complementos necesarias se encuentran en el archivo <b>/mnt/data/root/yandex2mqtt/config.js</b> <br>  Edite este archivo de acuerdo con sus par√°metros. <br>  El certificado SSL debe ser <b>fullchain</b> . <br><br>  Despu√©s de la configuraci√≥n, ejecute yandex2mqtt con el comando: <br><br><pre> <code class="bash hljs">service yandex2mqtt start</code> </pre> <br>  Despu√©s de configurar e iniciar el puente, le aconsejo que verifique el certificado en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este sitio</a> . <br><br>  Simplemente ingrese su dominio que va a utilizar para acceder a Alice.  Para un funcionamiento correcto, el certificado debe pasar todos los controles.  De lo contrario, nada funcionar√°. <br><br><h4>  Habilidad Yandex UD </h4><br><div class="spoiler">  <b class="spoiler_title">Creaci√≥n de habilidades</b> <div class="spoiler_text">  1. Vaya a la p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dialogs.yandex.ru/developer</a> <br>  2. Inicie sesi√≥n con su cuenta. <br>  3. Haga clic en "crear di√°logo" <br>  4. Seleccione "Hogar inteligente" <br>  5. Ingrese los par√°metros requeridos: <br><br><ul><li>  <b>Nombre</b> : cualquier nombre. </li><li>  <b>URL de punto final</b> : una direcci√≥n del tipo <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">yourdomain / provider</a></b> , donde en lugar de <b>"yourdomain</b> " es la direcci√≥n de noip o su dominio para el que se recibe un certificado SSL. </li></ul><br><img src="https://habrastorage.org/webt/6w/sn/oc/6wsnoczljzsap2fdrldsgi47qr8.png" width="400"><br><br><ul><li>  <b>Privacidad</b> : seleccione <b>"No mostrar en el cat√°logo" (¬°obligatorio! De lo contrario, la habilidad no pasar√° la moderaci√≥n instant√°nea)</b> </li><li>  <b>Nombre y correo electr√≥nico del desarrollador</b> : indique sus detalles. </li><li>  <b>Descripci√≥n</b> : cualquier texto </li><li>  <b>Icono</b> : cualquier icono. </li></ul><br><img src="https://habrastorage.org/webt/70/7q/pv/707qpvhwz4bp8-g7anzd6yocavw.png" width="400"><br><br>  6. Paquete de cuenta: <br><br><img src="https://habrastorage.org/webt/z4/vg/ep/z4vgep4de2sngw6byx34eo5s5te.png" width="400"><br><br>  Haga clic en "agregar nuevo" <br><ul><li>  Los primeros dos puntos: <b>especifique los datos de config.js / clients</b> : </li></ul><br>  1. <b>El identificador de la aplicaci√≥n</b> es clientId <br><br>  2. <b>Secreto de la aplicaci√≥n</b> - clientSecret <br><br><ul><li>  <b>URL de autorizaci√≥n</b> : su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dominio / di√°logo / autorizar</a> </li><li>  <b>URL del token</b> : tu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dominio / oauth / token</a> </li><li>  <b>URL de actualizaci√≥n de token</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">yourdomain / oauth / token</a> </li></ul><br><img src="https://habrastorage.org/webt/im/pg/zi/impgzifephas4rycqhvyll0_7uq.png" width="400"><br><br>  7. Guardar la habilidad <br><br><img src="https://habrastorage.org/webt/fj/ud/xy/fjudxydpqb3mwv5ksihpr277j2u.png" width="400"><br><br>  8. Haga clic en "Moderaci√≥n" <br><br><img src="https://habrastorage.org/webt/a2/ah/ji/a2ahjiezupvml9wo3a1pboif3pc.png"><br><br>  9. Haga clic en "Publicar" <br><br><img src="https://habrastorage.org/webt/7a/jv/83/7ajv8394tns4icumhxj1qqp-eea.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Agregar dispositivos a Yandex UD.</b> <div class="spoiler_text">  1. Vaya a la aplicaci√≥n Yandex en el tel√©fono. <br><br><img src="https://habrastorage.org/webt/ki/fk/t6/kifkt6ims4epu1zm2hsa2z3bef0.jpeg" width="230"><br><br>  2. En el men√∫, seleccione Dispositivos / Smart Home <br><br><img src="https://habrastorage.org/webt/up/ec/ee/upeceeae_jjtrocticjinlinxmq.jpeg" width="230"><br><br>  3. Haga clic en "Agregar dispositivo" <br><br><img src="https://habrastorage.org/webt/-c/yn/k3/-cynk3sjwga2frnsung0wp8mtre.jpeg" width="230"><br><br>  4. Elige tu habilidad <br><br><img src="https://habrastorage.org/webt/ew/4h/jd/ew4hjdahl4eunc4kvygka1eftrs.jpeg" width="230"><br><br>  5. Haga clic en "Combinar cuentas" <br><br><img src="https://habrastorage.org/webt/ov/k7/hk/ovk7hkqe6oe0j7jvkw6eghcnycy.jpeg" width="230"><br><br>  6. Se abrir√° la p√°gina de autorizaci√≥n. <br><br>  <i>Ingrese nombre de usuario y contrase√±a (establecido en el archivo config.js en el bloque de usuarios)</i> <br><br><img src="https://habrastorage.org/webt/ly/lr/gw/lylrgwlzw5wcuy1c4wov6ez-2fm.jpeg" width="230"><br><br>  7. Haga clic en "Permitir". <br><br><img src="https://habrastorage.org/webt/y2/pu/tn/y2putnokvnlac9h4tuypa1sny9y.jpeg" width="230"><br><br>  8. Haga clic en "Actualizar lista de dispositivos" <br><br><img src="https://habrastorage.org/webt/cq/qd/gw/cqqdgwhp-zhmq5_ax3zbgohgrt4.jpeg" width="230"><br></div></div><br>  Ahora a Alice se le pueden dar comandos para administrar los dispositivos agregados.  Los equipos correspondientes llegar√°n a los temas indicados por mqtt. <br><br>  Queda por vincular algunas acciones a estos temas. <br><br><h4>  Rojo-nodo </h4><br>  Node-Red fue elegido para el sistema de automatizaci√≥n.  Esta es una gran herramienta de programaci√≥n visual.  El procedimiento de instalaci√≥n y configuraci√≥n se puede ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  El proceso de configuraci√≥n y automatizaci√≥n de un hogar inteligente generar√° un art√≠culo completo, o incluso dos.  Y ya hay muchos de esos art√≠culos.  En cambio, un peque√±o ejemplo del uso del complemento, c√≥mo activar la voz de la bombilla. <br><br>  Para mayor comodidad, creamos un dispositivo virtual en el controlador Wiren Board 6 en la interfaz web. <br>  En el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">motor de reglas wb-rules</a> necesitas ingresar <br><br><pre> <b><code class="javascript hljs">defineVirtualDevice(<span class="hljs-string"><span class="hljs-string">"yandex"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">"yandex controls"</span></span>, <span class="hljs-attr"><span class="hljs-attr">cells</span></span>: { <span class="hljs-attr"><span class="hljs-attr">light1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"switch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, } });</code></b> </pre> <b><br></b> <br><img src="https://habrastorage.org/webt/3t/mn/qh/3tmnqhsdi1vnkdd_wr4ucnsvusc.jpeg"><br><br>  <b>Escribiremos los</b> temas de MQTT de este dispositivo virtual en <b>config.js</b> para el tipo de habilidad "encendido" del dispositivo "Ligero": <br><br><pre> <code class="json hljs"> devices: [ //_______________   ______________// { name: '', room: '', type: 'devices.types.light', mqtt: [ { type: 'on', set: '/devices/yandex/controls/light1/on', //   stat: '/devices/yandex/controls/light1' //   }, ], capabilities: [ { type: 'devices.capabilities.on_off', retrievable: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, state: { instance: 'on', value: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }, ] }, //_______________   _______________// ]</code> </pre><br>  Ahora, con la frase "Alice, enciende / apaga la luz", el dispositivo virtual cambia. <br><br>  Vayamos a Node-Red, que se instal√≥ de acuerdo con las instrucciones. <br><br>  Para un trabajo conveniente con Wiren Board 6, tambi√©n puede usar el "nodo" adicional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">node-red-contrib-wirenboard</a> . <br><br>  El m√≥dulo de expansi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">WBE2R-R-ZIGBEE</a> est√° instalado en el controlador, lo que hizo posible conectarse a la l√°mpara inteligente IKeevskaya de la serie TRODFRY utilizando el protocolo ZigBee. <br><br>  Ahora depende de los peque√±os.  Lance algunos bloques en el espacio de trabajo Node-Red, con√©ctelos con "cadenas" y haga clic en Implementar. <br><br><img src="https://habrastorage.org/webt/ev/p8/zn/evp8zn84umdssgxcecq9rmosgm8.jpeg"><br><br>  La bombilla ikeevsky se conecta a trav√©s del complemento zigbee2mqtt, por lo tanto, en mqtt, el tema de la bombilla se debe enviar json para el control.  Para hacer esto, insertaremos una funci√≥n simple entre el dispositivo virtual WB y el tema de la bombilla mqtt. <br><br><img src="https://habrastorage.org/webt/y1/e6/9h/y1e69hfghaemcayotpvugppiqz8.jpeg"><br><br>  Haz clic en Implementar.  Lo comprobamos <br><br>  ¬°Alice, enciende la luz! <br><br>  Entonces, hoy aprendimos c√≥mo conectar a Alice a un sistema de automatizaci√≥n.  Quiz√°s en algunos casos es demasiado complicado, es m√°s f√°cil comprar una bombilla wi-fi normal, y eso es suficiente.  Pero si planea construir una casa verdaderamente inteligente para usted, entonces las formas simples no pueden hacerlo aqu√≠.  Pero valga la pena o no, todos decidir√°n por s√≠ mismos.  Gracias por su atencion! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/465537/">https://habr.com/ru/post/465537/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../465525/index.html">Informes m√≥viles sobre Oracle BI EE 12c: uno, dos, tres. Metodolog√≠a del curso CAD de Oracle BI EE 12c</a></li>
<li><a href="../465527/index.html">El largo viaje de RFC 4357 a RFC 8645 o c√≥mo administrar las claves de cifrado</a></li>
<li><a href="../465529/index.html">Suspensi√≥n sobre bloqueo</a></li>
<li><a href="../465531/index.html">Desempaquetar listas anidadas de profundidad indefinida</a></li>
<li><a href="../465535/index.html">Qui√©n implementa IPv6 y qu√© dificulta su desarrollo</a></li>
<li><a href="../465539/index.html">766 km - un nuevo r√©cord de alcance para LoRaWAN</a></li>
<li><a href="../465541/index.html">De la empresa a la peque√±a y mediana empresa: compartimos nuestra experiencia en la adaptaci√≥n de soluciones corporativas para peque√±as y medianas empresas con monetizaci√≥n utilizando el modelo SaaS</a></li>
<li><a href="../465545/index.html">En diferentes lados del estado: c√≥mo Facebook se fri√≥ en el Congreso de los Estados Unidos, mientras Telegram luch√≥ con el FSB</a></li>
<li><a href="../465547/index.html">Gu√≠a SQL: C√≥mo escribir mejor las consultas (Parte 1)</a></li>
<li><a href="../465551/index.html">Resumen de eventos de TI de septiembre (primera parte)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>