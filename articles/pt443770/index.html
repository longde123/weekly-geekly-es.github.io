<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüåæ üñï ‚úãüèø Design Orientado a Dom√≠nio: Objetos de Valor e N√∫cleo da Estrutura de Entidades na Pr√°tica üë®‚Äçüíº ü§æüèæ ü§≥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Em Habr√© e n√£o apenas uma quantidade decente de artigos foi escrita sobre o Domain Driven Design - tanto em geral sobre arquitetura, como com exemplos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Design Orientado a Dom√≠nio: Objetos de Valor e N√∫cleo da Estrutura de Entidades na Pr√°tica</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443770/">  Em Habr√© e n√£o apenas uma quantidade decente de artigos foi escrita sobre o Domain Driven Design - tanto em geral sobre arquitetura, como com exemplos em .Net.  Mas, ao mesmo tempo, uma parte t√£o importante dessa arquitetura como o Value Objects √© frequentemente mal mencionada. <br><br>  Neste artigo, tentarei descobrir as nuances da implementa√ß√£o de Value Objects no .Net Core usando o Entity Framework Core. <br><br>  Sob um gato, h√° muito c√≥digo. <br><a name="habracut"></a><br><h2>  Pouco de teoria </h2><br>  O n√∫cleo da arquitetura do Design Orientado a <b>Dom√≠nio</b> √© o <b>Dom√≠nio</b> - a √°rea de assunto na qual o software que est√° sendo desenvolvido √© aplicado.  Aqui est√° toda a l√≥gica comercial do aplicativo, que geralmente interage com v√°rios dados.  Os dados podem ser de dois tipos: <br><br><ul><li>  Objeto de entidade </li><li>  Objeto de valor (doravante - VO) </li></ul><br>  <b>Objeto de entidade</b> define uma entidade na l√≥gica de neg√≥cios e sempre possui um identificador pelo qual a entidade pode ser encontrada ou comparada com outra entidade.  Se duas entidades tiverem um identificador id√™ntico, essa √© a mesma entidade.  Quase sempre mude. <br>  <b>O objeto de valor</b> √© um tipo imut√°vel, cujo valor √© definido durante a cria√ß√£o e n√£o muda ao longo da vida √∫til do objeto.  N√£o possui um identificador.  Se dois VOs s√£o estruturalmente id√™nticos, eles s√£o equivalentes. <br><br>  A entidade pode conter outra entidade e VO.  VOs podem incluir outros VOs, mas n√£o a Entidade. <br><br>  Assim, a l√≥gica do dom√≠nio deve funcionar exclusivamente com Entidade e VO - isso garante sua consist√™ncia.  Tipos de dados b√°sicos, como string, int etc.  frequentemente eles n√£o podem atuar como um VO, porque podem simplesmente violar o estado do dom√≠nio - o que √© quase um desastre na estrutura do DDD. <br><br>  Um exemplo  Nos v√°rios manuais, a classe Person, que ficou doente de todo mundo, √© frequentemente mostrada assim: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  Simples e claro - identificador, nome e idade, onde voc√™ pode cometer um erro? <br><br>  Mas pode haver v√°rios erros aqui - por exemplo, do ponto de vista da l√≥gica de neg√≥cios, um nome √© obrigat√≥rio, n√£o pode ter tamanho zero ou mais de 100 caracteres e n√£o deve conter caracteres especiais, pontua√ß√£o, etc.  E a idade n√£o pode ser inferior a 10 ou mais de 120 anos. <br><br>  Do ponto de vista da linguagem de programa√ß√£o, 5 √© um n√∫mero inteiro completamente normal, semelhante a uma string vazia.  Mas o dom√≠nio j√° est√° em um estado incorreto. <br><br><h2>  Vamos seguir praticando </h2><br>  Neste ponto, sabemos que o VO deve ser imut√°vel e conter um valor v√°lido para a l√≥gica de neg√≥cios. <br><br>  A imunidade √© obtida ao inicializar a propriedade somente leitura ao criar o objeto. <br>  A valida√ß√£o do valor ocorre no construtor (cl√°usula Guard).  √â desej√°vel disponibilizar publicamente a verifica√ß√£o - para que outras camadas possam validar os dados recebidos do cliente (o mesmo navegador). <br><br>  Vamos criar um VO para Nome e Idade.  Al√©m disso, complicamos um pouco a tarefa - adicione um PersonalName combinando FirstName e LastName e aplique-o a Person. <br><br><div class="spoiler">  <b class="spoiler_title">Nome</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Regex ValidationRegex = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex( <span class="hljs-string"><span class="hljs-string">@"^[\p{L}\p{M}\p{N}]{1,100}\z"</span></span>, RegexOptions.Singleline | RegexOptions.Compiled); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Name</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsValid(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"Name is not valid"</span></span>); } Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !String.IsNullOrWhiteSpace(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) &amp;&amp; ValidationRegex.IsMatch(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Object obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Name other &amp;&amp; StringComparer.Ordinal.Equals(Value, other.Value); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Int32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StringComparer.Ordinal.GetHashCode(Value); } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Nome pessoal</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonalName</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonalName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PersonalName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Name firstName, Name lastName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (firstName == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(firstName)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastName == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(lastName)); } FirstName = firstName; LastName = lastName; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Name FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Name LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String FullName =&gt; <span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{FirstName}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{LastName}</span></span></span><span class="hljs-string">"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Object obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> PersonalName personalName &amp;&amp; EqualityComparer&lt;Name&gt;.Default.Equals(FirstName, personalName.FirstName) &amp;&amp; EqualityComparer&lt;Name&gt;.Default.Equals(LastName, personalName.LastName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Int32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HashCode.Combine(FirstName, LastName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FullName; } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Idade</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Age</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Age</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Int32 </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsValid(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"Age is not valid"</span></span>); } Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Int32 Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Int32 </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> &lt;= <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">120</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Boolean </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Object obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Age other &amp;&amp; Value == other.Value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Int32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetHashCode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Value.GetHashCode(); } }</code> </pre> <br></div></div><br>  E finalmente Pessoa: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Person</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonalName personalName, Age age</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (personalName == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(personalName)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (age == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(age)); } Id = Guid.NewGuid(); PersonalName= personalName; Age = age; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Guid Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PersonalName PersonalName{ <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Age Age { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br>  Portanto, n√£o podemos criar Pessoa sem um nome completo ou idade.  Al√©m disso, n√£o podemos criar um nome "errado" ou uma idade "errada".  Um bom programador certamente verificar√° os dados recebidos no controlador usando os m√©todos Name.IsValid ("John") e Age.IsValid (35) e, no caso de dados incorretos, informar√° o cliente sobre isso. <br><br>  Se fizermos uma regra em todos os lugares do modelo para usar apenas Entidade e VO, protegeremos a n√≥s mesmos de um grande n√∫mero de erros - dados incorretos simplesmente n√£o entrar√£o no modelo. <br><br><h2>  Persist√™ncia </h2><br>  Agora precisamos salvar nossos dados no data warehouse e obt√™-los mediante solicita√ß√£o.  Usaremos o Entity Framework Core como ORM e o data warehouse √© o MS SQL Server. <br><br>  O DDD define claramente: Persist√™ncia √© uma subesp√©cie da camada de infraestrutura porque oculta uma implementa√ß√£o espec√≠fica de acesso a dados. <br><br>  O dom√≠nio n√£o precisa saber nada sobre persist√™ncia, isso determina apenas as interfaces dos reposit√≥rios. <br><br>  E Persistence cont√©m implementa√ß√µes espec√≠ficas, configura√ß√µes de mapeamento, al√©m de um objeto UnitOfWork. <br><br>  H√° duas opini√µes sobre se vale a pena criar reposit√≥rios e Unidade de Trabalho. <br><br>  Por um lado - n√£o, n√£o √© necess√°rio, porque no Entity Framework Core tudo isso j√° est√° implementado.  Se tivermos uma arquitetura multin√≠vel no formato DAL -&gt; Business Logic -&gt; Presentation, que √© baseada no armazenamento de dados, por que n√£o usar diretamente os recursos do EF Core. <br><br>  Mas o dom√≠nio no DDD n√£o depende do armazenamento de dados e do ORM usado - essas s√£o todas as sutilezas da implementa√ß√£o que est√£o encapsuladas no Persistence e n√£o interessam a ningu√©m.  Se fornecermos o DbContext para outras camadas, divulgamos imediatamente os detalhes da implementa√ß√£o, vinculamos firmemente ao ORM selecionado e obtemos o DAL - como base de toda a l√≥gica de neg√≥cios, mas n√£o deve ser.  Grosso modo, o dom√≠nio n√£o deve notar uma altera√ß√£o no ORM e at√© mesmo a perda de persist√™ncia como uma camada. <br><br>  Portanto, a interface do reposit√≥rio de Pessoas, no dom√≠nio: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPersons</span></span> { <span class="hljs-function"><span class="hljs-function">Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Person person</span></span></span><span class="hljs-function">)</span></span>; Task&lt;IReadOnlyList&lt;Person&gt;&gt; GetList(); }</code> </pre> <br>  e sua implementa√ß√£o em Persist√™ncia: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">EfPersons</span></span> : <span class="hljs-title"><span class="hljs-title">IPersons</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> PersonsDemoContext _context; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EfPersons</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnitOfWork unitOfWork</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (unitOfWork == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(unitOfWork)); } _context = unitOfWork.Context; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Person person</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (person == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(person)); } <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _context.Persons.AddAsync(person); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;IReadOnlyList&lt;Person&gt;&gt; GetList() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _context.Persons.ToListAsync(); } }</code> </pre> <br>  Parece nada complicado, mas h√° um problema.  Pronto para uso O Entity Framework Core funciona apenas com tipos b√°sicos (string, int, DateTime etc.) e n√£o sabe nada sobre PersonalName e Age.  Vamos ensinar o EF Core a entender nossos objetos de valor. <br><br><h2>  Configura√ß√£o </h2><br>  A API Fluent √© mais adequada para configurar a Entidade no DDD.  Os atributos n√£o s√£o adequados, pois o dom√≠nio n√£o precisa saber nada sobre as nuances do mapeamento. <br><br>  Crie uma classe no Persistence com a configura√ß√£o b√°sica PersonConfiguration: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PersonConfiguration</span></span> : <span class="hljs-title"><span class="hljs-title">IEntityTypeConfiguration</span></span>&lt;<span class="hljs-title"><span class="hljs-title">Person</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">EntityTypeBuilder&lt;Person&gt; builder</span></span></span><span class="hljs-function">)</span></span> { builder.ToTable(<span class="hljs-string"><span class="hljs-string">"Persons"</span></span>); builder.HasKey(p =&gt; p.Id); builder.Property(p =&gt; p.Id).ValueGeneratedNever(); } }</code> </pre> <br>  e conecte-o ao DbContext: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnModelCreating</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelBuilder builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnModelCreating(builder); builder.ApplyConfiguration(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonConfiguration()); }</code> </pre> <br><h2>  Mapeamento </h2><br>  A se√ß√£o para a qual este material foi escrito. <br><br>  No momento, existem duas maneiras mais ou menos convenientes de mapear classes n√£o padr√£o para os tipos base - Convers√µes de Valor e Tipos de Propriedade. <br><br><h3>  Convers√µes de valor </h3><br>  Esse recurso apareceu no Entity Framework Core 2.1 e permite determinar a convers√£o entre os dois tipos de dados. <br><br>  Vamos escrever o conversor para Age (nesta se√ß√£o, todo o c√≥digo est√° em PersonConfiguration): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ageConverter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValueConverter&lt;Age, Int32&gt;( v =&gt; v.Value, v =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Age(v)); builder .Property(p =&gt; p.Age) .HasConversion(ageConverter) .HasColumnName(<span class="hljs-string"><span class="hljs-string">"Age"</span></span>) .HasColumnType(<span class="hljs-string"><span class="hljs-string">"int"</span></span>) .IsRequired();</code> </pre><br>  Sintaxe simples e concisa, mas n√£o sem falhas: <br><br><ol><li>  N√£o foi poss√≠vel converter nulo; </li><li>  N√£o √© poss√≠vel converter uma propriedade em v√°rias colunas em uma tabela e vice-versa; </li><li>  O EF Core n√£o pode converter uma express√£o LINQ com essa propriedade em uma consulta SQL. </li></ol><br>  Vou me debru√ßar sobre o √∫ltimo ponto em mais detalhes.  Adicione um m√©todo ao reposit√≥rio que retorne uma lista de Pessoa acima de uma determinada idade: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;IReadOnlyList&lt;Person&gt;&gt; GetOlderThan(Age age) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (age == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(age)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _context.Persons .Where(p =&gt; p.Age.Value &gt; age.Value) .ToListAsync(); }</code> </pre> <br>  H√° uma condi√ß√£o para a idade, mas o EF Core n√£o poder√° convert√™-lo em uma consulta SQL e, atingindo Where (), carregar√° toda a tabela na mem√≥ria do aplicativo e, somente ent√£o, usando o LINQ, atender√° √† condi√ß√£o p.Age.Value&gt; age.Value . <br><br>  Em geral, Convers√µes de Valor √© uma op√ß√£o de mapeamento simples e r√°pida, mas √© preciso lembrar sobre esse recurso do EF Core; caso contr√°rio, em algum momento, ao consultar tabelas grandes, a mem√≥ria pode acabar. <br><br><h3>  Tipos pr√≥prios </h3><br>  Os Tipos propriet√°rios apareceram no Entity Framework Core 2.0 e substitu√≠ram os Tipos complexos do Entity Framework regular. <br><br>  Vamos fazer a idade como tipo de propriedade: <br><br><pre> <code class="cs hljs">builder.OwnsOne(p =&gt; p.Age, a =&gt; { a.Property(u =&gt; u.Value).HasColumnName(<span class="hljs-string"><span class="hljs-string">"Age"</span></span>); a.Property(u =&gt; u.Value).HasColumnType(<span class="hljs-string"><span class="hljs-string">"int"</span></span>); a.Property(u =&gt; u.Value).IsRequired(); });</code> </pre> <br>  Nada mal.  E os tipos propriet√°rios n√£o t√™m algumas das desvantagens das convers√µes de valor, como os pontos 2 e 3. <br><br>  2. <u>√â poss√≠vel</u> converter uma propriedade em v√°rias colunas na tabela e vice-versa <br><br>  O que voc√™ precisa para o PersonalName, embora a sintaxe j√° esteja um pouco sobrecarregada: <br><br><pre> <code class="cs hljs">builder.OwnsOne(b =&gt; b.PersonalName, pn =&gt; { pn.OwnsOne(p =&gt; p.FirstName, fn =&gt; { fn.Property(x =&gt; x.Value).HasColumnName(<span class="hljs-string"><span class="hljs-string">"FirstName"</span></span>); fn.Property(x =&gt; x.Value).HasColumnType(<span class="hljs-string"><span class="hljs-string">"nvarchar(100)"</span></span>); fn.Property(x =&gt; x.Value).IsRequired(); }); pn.OwnsOne(p =&gt; p.LastName, ln =&gt; { ln.Property(x =&gt; x.Value).HasColumnName(<span class="hljs-string"><span class="hljs-string">"LastName"</span></span>); ln.Property(x =&gt; x.Value).HasColumnType(<span class="hljs-string"><span class="hljs-string">"nvarchar(100)"</span></span>); ln.Property(x =&gt; x.Value).IsRequired(); }); });</code> </pre> <br>  3. O EF Core <u>pode</u> converter uma express√£o LINQ com essa propriedade em uma consulta SQL. <br>  Adicione a classifica√ß√£o por Sobrenome e Nome ao carregar a lista: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> Task&lt;IReadOnlyList&lt;Person&gt;&gt; GetList() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _context.Persons .OrderBy(p =&gt; p.PersonalName.LastName.Value) .ThenBy(p =&gt; p.PersonalName.FirstName.Value) .ToListAsync(); }</code> </pre> <br>  Essa express√£o ser√° convertida corretamente em uma consulta SQL e a classifica√ß√£o ser√° realizada no lado do servidor SQL, e n√£o no aplicativo. <br><br>  Claro, tamb√©m existem desvantagens. <br><br><ol><li>  Problemas com nulo n√£o desapareceram; </li><li>  Os campos Tipos propriet√°rios n√£o podem ser somente leitura e devem ter um setter protegido ou privado. </li><li>  Tipos propriet√°rios s√£o implementados como Entidade regular, o que significa: <br><ul><li>  Eles t√™m um identificador (como uma propriedade de sombra, ou seja, n√£o aparece na classe de dom√≠nio); </li><li>  O EF Core rastreia todas as altera√ß√µes nos Tipos de propriedade, exatamente da mesma forma que na Entidade comum. </li></ul></li></ol><br>  Por um lado, isso n√£o √© exatamente o que objetos de valor deveriam ser.  Eles n√£o devem ter nenhum identificador.  Os VOs n√£o devem ser rastreados para altera√ß√µes - porque s√£o inicialmente imut√°veis, as propriedades da Entidade pai devem ser rastreadas, mas n√£o as propriedades do VO. <br><br>  Por outro lado, esses s√£o detalhes de implementa√ß√£o que podem ser omitidos, mas, novamente, n√£o esque√ßa.  O rastreamento de altera√ß√µes afeta o desempenho.  Se isso n√£o for percept√≠vel em amostras de uma √∫nica entidade (por exemplo, por ID) ou em pequenas listas, com uma sele√ß√£o de grandes listas de entidades "pesadas" (muitas propriedades de VO), a redu√ß√£o do desempenho ser√° muito percept√≠vel precisamente por causa do rastreamento. <br><br><h2>  Apresenta√ß√£o </h2><br>  N√≥s descobrimos como implementar objetos de valor em um dom√≠nio e reposit√≥rio.  √â hora de usar tudo.  Vamos criar duas p√°ginas simples - com a lista Pessoa e o formul√°rio para adicionar Pessoa. <br><br>  O c√≥digo do controlador sem os m√©todos de a√ß√£o tem a seguinte apar√™ncia: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HomeController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IPersons _persons; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> UnitOfWork _unitOfWork; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HomeController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IPersons persons, UnitOfWork unitOfWork</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (persons == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(persons)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (unitOfWork == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(unitOfWork)); } _persons = persons; _unitOfWork = unitOfWork; } <span class="hljs-comment"><span class="hljs-comment">// Actions private static PersonModel CreateModel(Person person) { return new PersonModel { FirstName = person.PersonalName.FirstName.Value, LastName = person.PersonalName.LastName.Value, Age = person.Age.Value }; } }</span></span></code> </pre> <br>  Adicione A√ß√£o para obter a lista de Pessoas: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpGet</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> persons = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _persons.GetList(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonsListModel { Persons = persons .Select(CreateModel) .ToArray() }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(result); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Ver</b> <div class="spoiler_text"><pre> <code class="xml hljs">@model PersonsListModel @{ ViewData["Title"] = "Persons List"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-center"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-4"</span></span></span><span class="hljs-tag">&gt;</span></span>Persons<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Last name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>First name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Age<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var p in Model.Persons) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@p.LastName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@p.FirstName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@p.Age<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  Nada complicado - carregamos a lista, criamos um objeto de transfer√™ncia de dados (PersonModel) para cada <br><br>  Pessoa e enviado para a Visualiza√ß√£o correspondente. <br><br><div class="spoiler">  <b class="spoiler_title">Resultado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-j/n0/qu/-jn0qugs50smvtry852ljdmedte.png"><br></div></div><br>  Muito mais interessante √© a adi√ß√£o de Person: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;IActionResult&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddPerson</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PersonModel model</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (model == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BadRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Name.IsValid(model.FirstName)) { ModelState.AddModelError(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(model.FirstName), <span class="hljs-string"><span class="hljs-string">"FirstName is invalid"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Name.IsValid(model.LastName)) { ModelState.AddModelError(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(model.LastName), <span class="hljs-string"><span class="hljs-string">"LastName is invalid"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Age.IsValid(model.Age)) { ModelState.AddModelError(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(model.Age), <span class="hljs-string"><span class="hljs-string">"Age is invalid"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ModelState.IsValid) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(model.FirstName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Name(model.LastName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> person = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Person( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonalName(firstName, lastName), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Age(model.Age)); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _persons.Add(person); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _unitOfWork.Commit(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> persons = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> _persons.GetList(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PersonsListModel { Persons = persons .Select(CreateModel) .ToArray() }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>, result); }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Ver</b> <div class="spoiler_text"><pre> <code class="xml hljs">@model PersonDemo.Models.PersonModel @{ ViewData["Title"] = "Add Person"; } <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-4"</span></span></span><span class="hljs-tag">&gt;</span></span>Add Person<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"row"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"col-md-4"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AddPerson"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-validation-summary</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ModelOnly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FirstName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"control-label"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FirstName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-validation-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FirstName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LastName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"control-label"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LastName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-validation-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LastName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Age"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"control-label"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Age"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">asp-validation-for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Age"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-danger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-group"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Create"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-primary"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @section Scripts { @{await Html.RenderPartialAsync("_ValidationScriptsPartial");} }</code> </pre> <br></div></div><br>  H√° uma valida√ß√£o obrigat√≥ria dos dados recebidos: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Name.IsValid(model.FirstName)) { ModelState.AddModelError(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(model.FirstName), <span class="hljs-string"><span class="hljs-string">"FirstName is invalid"</span></span>); }</code> </pre> <br>  Se isso n√£o for feito, ao criar um VO com um valor incorreto, uma ArgumentException ser√° lan√ßada (lembre-se da Cl√°usula Guard nos construtores de VO).  Com a verifica√ß√£o, √© muito mais f√°cil enviar uma mensagem ao usu√°rio de que um dos valores est√° incorreto. <br><br><div class="spoiler">  <b class="spoiler_title">Resultado</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ej/8m/kr/ej8mkr_4de2x23avg5mezwb6gzg.png"><br></div></div><br>  Aqui voc√™ precisa fazer uma pequena digress√£o - no Asp Net Core, h√° uma maneira regular de valida√ß√£o de dados - usando atributos.  Mas no DDD, esse m√©todo de valida√ß√£o n√£o est√° correto por v√°rios motivos: <br><br><ul><li>  Os recursos de atributo podem n√£o ser suficientes para a l√≥gica de valida√ß√£o; </li><li>  Qualquer l√≥gica comercial, incluindo regras para validar par√¢metros, √© configurada exclusivamente pelo dom√≠nio.  Ele tem um monop√≥lio sobre isso e todas as outras camadas devem considerar isso.  Os atributos podem ser usados, mas voc√™ n√£o deve confiar neles.  Se o atributo ignorar dados incorretos, obteremos novamente uma exce√ß√£o ao criar um VO. </li></ul><br>  Voltar para AddPerson ().  Ap√≥s a valida√ß√£o dos dados, PersonalName, Age e Person s√£o criados.  Em seguida, adicione o objeto ao reposit√≥rio e salve as altera√ß√µes (Confirmar).  √â muito importante que o Commit n√£o seja chamado no reposit√≥rio do EfPersons.  A tarefa do reposit√≥rio √© executar alguma a√ß√£o com os dados, n√£o mais.  A confirma√ß√£o √© feita apenas de fora, quando exatamente - o programador decide.  Caso contr√°rio, uma situa√ß√£o √© poss√≠vel quando ocorre um erro no meio de uma certa itera√ß√£o comercial - alguns dos dados s√£o salvos e outros n√£o.  Recebemos o dom√≠nio no estado "quebrado".  Se a confirma√ß√£o for conclu√≠da no final, se o erro ocorrer, a transa√ß√£o simplesmente reverter√°. <br><br><h2>  Conclus√£o </h2><br>  Dei exemplos da implementa√ß√£o de objetos de valor em geral e as nuances do mapeamento no Entity Framework Core.  Espero que o material seja √∫til para entender como aplicar os elementos do Design Orientado a Dom√≠nios na pr√°tica. <br><br>  C√≥digo-fonte do projeto Pessoas completasDemo - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> <br><br>  O material n√£o divulga o problema de interagir com objetos de valor opcionais (que podem ser nulos) - se PersonalName ou Age n√£o forem propriedades necess√°rias de Person.  Eu queria descrever isso neste artigo, mas ele j√° saiu um pouco sobrecarregado.  Se houver interesse nessa quest√£o - escreva nos coment√°rios, a continua√ß√£o ser√°. <br><br>  Para os f√£s de "belas arquiteturas" em geral e do Domain Driven Design em particular, recomendo o recurso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Enterprise Craftsmanship</a> . <br><br>  Existem muitos artigos √∫teis sobre a constru√ß√£o correta de arquitetura e exemplos de implementa√ß√£o no .Net.  Algumas id√©ias foram emprestadas, implementadas com sucesso em projetos de ‚Äúcombate‚Äù e parcialmente refletidas neste artigo. <br><br>  A documenta√ß√£o oficial para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tipos de propriedade</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Convers√µes de valor</a> tamb√©m <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foi</a> usada. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443770/">https://habr.com/ru/post/pt443770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443756/index.html">Design da classe: O que √© bom?</a></li>
<li><a href="../pt443758/index.html">Reconhecimento r√°pido do Doodle de desenho: Como fazer amigos R, C ++ e redes neurais</a></li>
<li><a href="../pt443764/index.html">O que o designer fumava: uma arma de fogo incomum</a></li>
<li><a href="../pt443766/index.html">Tentando a programa√ß√£o de contratos C ++ 20 agora</a></li>
<li><a href="../pt443768/index.html">Mon√≥lito para centenas de vers√µes de clientes: como escrevemos e suportamos testes</a></li>
<li><a href="../pt443772/index.html">Antiguidades: IBM ThinkPad T40, o primeiro sistema sem fio</a></li>
<li><a href="../pt443774/index.html">Como a neurobiologia interfere nas elei√ß√µes presidenciais nos EUA</a></li>
<li><a href="../pt443776/index.html">China introduz um sistema experimental de reconhecimento facial ao pagar metr√¥</a></li>
<li><a href="../pt443780/index.html">Projeto MCDM. Parte 1. Conceito</a></li>
<li><a href="../pt443782/index.html">Os desenvolvedores agora podem usar a API de rede da Valve para seus jogos Steam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>