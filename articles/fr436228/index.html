<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéñÔ∏è üî´ üç∂ D√©veloppement d'une √©quipe pour interroger les donn√©es de la base de donn√©es üßîüèæ üí™üèø üî≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Actuellement, je suis engag√© dans la mise en ≈ìuvre de l'interaction avec le fournisseur de services KYC. Comme d'habitude, rien de cosmique. Il vous s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement d'une √©quipe pour interroger les donn√©es de la base de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436228/"><p>  Actuellement, je suis engag√© dans la mise en ≈ìuvre de l'interaction avec le fournisseur de services KYC.  Comme d'habitude, rien de cosmique.  Il vous suffit de s√©lectionner dans votre base de donn√©es un ensemble assez important de copies de divers enregistrements, de les t√©l√©charger vers le fournisseur de services et de demander au fournisseur d'enregistrements de les v√©rifier. </p><br><p> L'√©tape initiale du traitement contient une douzaine d'op√©rations identiques avec l'envoi de demandes de r√©cup√©ration de donn√©es d'un utilisateur sp√©cifique √† partir de diverses tables de base de donn√©es.  On suppose que dans ce cas, une partie assez importante du code peut √™tre r√©utilis√©e comme abstraction de <code>Request</code> .  Je vais essayer de sugg√©rer comment cela pourrait √™tre utilis√©.  J'√©crirai le premier test: </p><a name="habracut"></a><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'Request'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Request = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./Request'</span></span>); it(<span class="hljs-string"><span class="hljs-string">'execute should return promise'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request(); request.execute().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) =&gt;</span></span> { expect(result).toBeNull(); }); }); });</code> </pre> <br><p>  √áa a l'air bien?  Peut-√™tre imparfait, mais √† premi√®re vue, il semble que <code>Request</code> soit essentiellement une <code></code> qui renvoie <code>Promise</code> avec le r√©sultat?  De cela, il est tout √† fait possible de commencer.  Je vais esquisser le code pour que le test puisse √™tre ex√©cut√©. </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){} execute(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { resolve(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); }); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Request;</code> </pre> <br><p>  <code>npm test</code> et observe le point vert du test termin√© dans la console. </p><br><p>  Alors.  J'ai une demande, et elle peut √™tre ex√©cut√©e.  En r√©alit√©, cependant, je devrai en quelque sorte informer ma demande du tableau dans lequel il devrait rechercher les donn√©es n√©cessaires et des crit√®res auxquels ces donn√©es devraient r√©pondre.  Je vais essayer d'√©crire un nouveau test: </p><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">'should configure request'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">tableName</span></span>: <span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } }; request.configure(options); expect(request.options).toEqual(options); });</code> </pre> <br><p>  Ok?  √Ä mon avis, tout √† fait.  √âtant donn√© que j'ai d√©j√† deux tests qui utilisent une instance de la variable de <code>request</code> , je vais initialiser cette variable dans une m√©thode sp√©ciale qui est ex√©cut√©e avant le d√©but de chaque test.  Ainsi, dans chaque test, j'aurai une nouvelle instance de l'objet de requ√™te: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> request = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request(); });</code> </pre> <br><p>  J'impl√©mente cette fonctionnalit√© dans la classe de demande, j'y ajoute une m√©thode qui enregistre les param√®tres dans la variable d'instance de classe, comme le montre le test. </p><br><pre> <code class="javascript hljs">configure(options){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options = options; }</code> </pre> <br><p>  Je lance les tests et maintenant je vois deux points verts.  Deux de mes tests ont r√©ussi.  Cependant.  Il est suppos√©, cependant, que mes requ√™tes seront adress√©es √† la base de donn√©es.  Maintenant, il vaut probablement la peine d'essayer de voir de quel c√¥t√© la demande recevra des informations sur la base de donn√©es.  Je vais revenir aux tests et √©crire du code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DbMock = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./DbMock'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> db = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; beforeEach(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbMock(); request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request(db); });</code> </pre> <br><p>  Il me semble qu'une telle version classique de l'initialisation via le constructeur satisfait pleinement mes exigences actuelles. </p><br><p>  Naturellement, je ne vais pas utiliser les tests unitaires pour utiliser l'interface avec la vraie base de donn√©es MySQL avec laquelle notre projet fonctionne.  Pourquoi?  Parce que: </p><br><ol><li>  Si, √† ma place, un de mes coll√®gues doit travailler sur cette partie du projet et effectuer des tests unitaires, alors avant de pouvoir faire quoi que ce soit, il devra consacrer du temps et des efforts √† installer et configurer sa propre instance du serveur MySQL. </li><li>  Le succ√®s des tests unitaires d√©pendra de l'exactitude du remplissage pr√©liminaire des donn√©es utilis√© par la base de donn√©es du serveur MySQL. </li><li>  Le temps d'ex√©cution des tests √† l'aide de la base de donn√©es MySQL sera consid√©rablement plus long. </li></ol><br><p>  D'accord.  Et pourquoi, par exemple, ne pas utiliser de base de donn√©es en m√©moire dans les tests unitaires?  Il fonctionnera rapidement et le processus de configuration et d'initialisation peut √™tre automatis√©.  C'est vrai, mais pour le moment je ne vois aucun avantage √† utiliser cet outil suppl√©mentaire.  Il me semble que mes besoins actuels sont plus rapides et moins chers (pas besoin de passer du temps √† √©tudier) en utilisant des classes et des m√©thodes de stubs et de <code></code> objets, qui ne feront que simuler le comportement d'interfaces cens√©es √™tre utilis√©es dans des conditions de combat. </p><br><p>  Au fait.  Au combat, je sugg√®re d'utiliser la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que</a> en conjonction avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">knex</a> .  Pourquoi?  Parce que suite √† la documentation sur l'installation, la configuration et l'utilisation de ces deux outils, j'ai r√©ussi √† cr√©er et ex√©cuter une requ√™te dans la base de donn√©es en quelques minutes. </p><br><p>  Qu'est-ce qui en d√©coule?  Il en r√©sulte que je devrais modifier le code de la classe <code>Request</code> pour que l'ex√©cution de la requ√™te corresponde aux interfaces export√©es par mes outils de combat.  Alors maintenant, le code devrait ressembler √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Request</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(db){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.db = db; } configure(options){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options = options; } execute(){ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> table = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.db.Model.extend({ <span class="hljs-attr"><span class="hljs-attr">tableName</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.tableName }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> table.where(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.options.query).fetch(); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Request;</code> </pre> <br><p>  Je vais ex√©cuter les tests et voir ce qui se passe.  Ouais.  <code>DbMock</code> s√ªr, je n'ai pas le module <code>DbMock</code> , donc la premi√®re chose que je fais est d'impl√©menter un stub pour lui: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbMock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){} } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = DbMock;</code> </pre> <br><p>  Je vais relancer les tests.  Et maintenant  La princesse <code>Jasmine</code> me dit <code>Jasmine</code> que mon <code>DbMock</code> pas la propri√©t√© <code>Model</code> .  Je vais essayer de trouver quelque chose: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbMock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Model = { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {} }; } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = DbMock;</code> </pre> <br><p>  Relancer les tests.  Maintenant, l'erreur est que dans mon test unitaire, j'ex√©cute la requ√™te sans d'abord d√©finir ses param√®tres √† l'aide de la m√©thode <code>configure</code> .  Je corrige ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> options = { <span class="hljs-attr"><span class="hljs-attr">tableName</span></span>: <span class="hljs-string"><span class="hljs-string">'users'</span></span>, <span class="hljs-attr"><span class="hljs-attr">query</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } }; it(<span class="hljs-string"><span class="hljs-string">'execute should return promise'</span></span>, () =&gt; { request.configure(options); request.execute().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) =&gt;</span></span> { expect(result).toBeNull(); }); });</code> </pre> <br><p>  Comme j'ai d√©j√† utilis√© une instance de la variable <code>options</code> dans deux tests, je l'ai plac√©e dans le code d'initialisation de la suite de tests enti√®re et r√©ex√©cute les tests. </p><br><p>  Comme pr√©vu, la m√©thode <code>extend</code> , les propri√©t√©s du <code>Model</code> , de la classe <code>DbMock</code> nous a renvoy√© <code>undefined</code> , donc, naturellement, notre requ√™te n'a aucun moyen d'appeler la m√©thode <code>where</code> . </p><br><p>  Je comprends d√©j√† que la propri√©t√© <code>Model</code> de la classe <code>DbMock</code> doit √™tre impl√©ment√©e en dehors de la classe <code>DbMock</code> - <code>DbMock</code> .  Tout d'abord, √©tant donn√© que l'impl√©mentation des <code></code> n√©cessaire pour que les tests existants s'ex√©cutent, il faudra trop d'√©tendues imbriqu√©es lors de l'initialisation de la propri√©t√© <code>Model</code> directement dans la classe <code>DbMock</code> .  Ce sera compl√®tement impossible √† lire et √† comprendre ... Et cela, cependant, ne m'emp√™chera pas de faire une telle tentative, car je veux m'assurer d'avoir encore la possibilit√© d'√©crire quelques lignes de code et de r√©ussir les tests. </p><br><p>  Alors.  Inspirez, expirez, les faibles de c≈ìur quittent la pi√®ce.  Compl√©ter l'impl√©mentation du constructeur <code>DbMock</code> .  Ta-daaaammmmm .... </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbMock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Model = { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">where</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">fetch</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { resolve(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); }); } }; } }; } }; } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = DbMock;</code> </pre> <br><p>  Tin!  Cependant, avec une main ferme, ex√©cutez les tests et assurez-vous que <code>Jasmine</code> nous montre √† nouveau les points verts.  Et cela signifie que nous sommes toujours sur la bonne voie, bien que quelque chose ait gonfl√© de mani√®re inappropri√©e. </p><br><p>  Et ensuite?  On peut voir √† l'≈ìil nu que la propri√©t√© <code>Model</code> d'une pseudo-base de donn√©es doit √™tre impl√©ment√©e comme quelque chose de compl√®tement s√©par√©.  Bien qu'inadapt√©, il n'est pas clair comment il devrait √™tre mis en ≈ìuvre. </p><br><p>  Mais je sais avec certitude que je vais stocker les enregistrements dans cette pseudo-base de donn√©es en ce moment dans les tableaux les plus ordinaires.  Et comme pour les tests existants, je n'ai besoin que de simuler la table des <code>users</code> , pour commencer je vais impl√©menter un tableau d'utilisateurs, avec un enregistrement.  Mais d'abord, je vais √©crire un test: </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'Users'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> users = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./Users'</span></span>); it(<span class="hljs-string"><span class="hljs-string">'should contain one user'</span></span>, () =&gt; { expect(<span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.isArray(users)).toBeTruthy(); expect(users.length).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = users[<span class="hljs-number"><span class="hljs-number">0</span></span>]; expect(user.Id).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expect(user.Name).toEqual(<span class="hljs-string"><span class="hljs-string">'Jack'</span></span>); }); });</code> </pre> <br><p>  Je lance des tests.  Je m'assure qu'ils ne passent pas, et j'impl√©mente mon simple container avec l'utilisateur: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Users = [ { <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">Name</span></span>: <span class="hljs-string"><span class="hljs-string">'Jack'</span></span> } ]; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = Users;</code> </pre> <br><p>  Maintenant, les tests sont effectu√©s, et il me semble que s√©mantiquement le <code>Model</code> , dans le package de la <code>bookshell</code> , est le fournisseur de l'interface pour acc√©der au contenu de la table dans la base de donn√©es.  Ce n'est pas pour rien que nous passons un objet avec un nom de table √† la m√©thode <code>extend</code> .  Pourquoi on l'appelle <code>extend</code> , et non par exemple <code>get</code> , je ne sais pas.  C'est peut-√™tre juste un manque de connaissances sur l'API de la <code>bookshell</code> . </p><br><p>  Eh bien, que Dieu le b√©nisse, pour l'instant j'ai une id√©e en t√™te sur le sujet du test suivant: </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'TableMock'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> container = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./Users'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Table = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./TableMock'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> users = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Table(container); it(<span class="hljs-string"><span class="hljs-string">'should return first item'</span></span>, () =&gt; { users.fetch({ <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }).then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) =&gt;</span></span> { expect(item.Id).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expect(item.Name).toEqual(<span class="hljs-string"><span class="hljs-string">'Jack'</span></span>); }); }); });</code> </pre> <br><p>  √âtant donn√© que pour le moment j'ai besoin d'une impl√©mentation qui simule uniquement la fonctionnalit√© d'un v√©ritable pilote de stockage, je nomme les classes en cons√©quence, en ajoutant le suffixe <code>Mock</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableMock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(container){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.container = container; } fetch() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { resolve(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.container[<span class="hljs-number"><span class="hljs-number">0</span></span>]); }); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = TableMock;</code> </pre> <br><p>  Mais le <code>fetch</code> pas la seule m√©thode que j'ai l'intention d'utiliser dans la version combat, alors j'ajoute un autre test: </p><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">'where-fetch chain should return first item'</span></span>, () =&gt; { users.where({ <span class="hljs-attr"><span class="hljs-attr">Id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }).fetch().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">)=&gt;</span></span> { expect(item.Id).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expect(item.Name).toEqual(<span class="hljs-string"><span class="hljs-string">'Jack'</span></span>); }); });</code> </pre> <br><p>  Le lancement dont, comme pr√©vu, affiche un message d'erreur pour moi.  Je compl√®te donc l'impl√©mentation de <code>TableMock</code> avec la m√©thode <code>where</code> : </p><br><pre> <code class="javascript hljs">where(){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br><p>  Maintenant, les tests sont en cours d'ex√©cution et vous pouvez passer √† la rubrique de l'impl√©mentation de la propri√©t√© <code>Model</code> dans la classe <code>DbMock</code> .  Comme je l'ai d√©j√† sugg√©r√©, ce sera un certain fournisseur d'instances d'objet de type <code>TableMock</code> : </p><br><pre> <code class="javascript hljs">describe(<span class="hljs-string"><span class="hljs-string">'TableMockMap'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TableMock = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./TableMock'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TableMockMap = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./TableMockMap'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableMockMap(); it(<span class="hljs-string"><span class="hljs-string">'extend should return existent TableMock'</span></span>, () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> users = map.extend({<span class="hljs-attr"><span class="hljs-attr">tableName</span></span>: <span class="hljs-string"><span class="hljs-string">'users'</span></span>}); expect(users <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> TableMock).toBeTruthy(); }); });</code> </pre> <br><p>  Pourquoi <code>TableMockMap</code> , car s√©mantiquement c'est tout.  Juste au lieu du nom de la m√©thode <code>get</code> , le nom de la m√©thode d' <code>extend</code> est utilis√©. </p><br><p>  Depuis que le test plante, nous faisons une impl√©mentation: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Users = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./Users'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TableMock = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./TableMock'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableMockMap</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Map</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(<span class="hljs-string"><span class="hljs-string">'users'</span></span>, Users); } extend(options){ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> container = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get(options.tableName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableMock(container); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = TableMockMap;</code> </pre> <br><p>  Ex√©cutez les tests et voyez six points verts dans la console.  La vie est belle. </p><br><p>  Il me semble en ce moment que vous pouvez d√©j√† vous d√©barrasser de la <code> </code> initialisation dans le constructeur de la classe <code>DbMock</code> , en utilisant le merveilleux <code>TableMockMap</code> .  Nous ne la repousserons pas, d'autant plus qu'il serait bien d'avoir d√©j√† du th√©.  La nouvelle impl√©mentation est d√©licieusement √©l√©gante: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TableMockMap = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./TableMockMap'</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DbMock</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TableMockMap(); } } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = DbMock;</code> </pre> <br><p>  Ex√©cutez les tests ... et oups!  Notre test le plus important tombe.  Mais c'est m√™me bien, car c'√©tait un talon de test et maintenant nous devons juste le corriger: </p><br><pre> <code class="javascript hljs">it(<span class="hljs-string"><span class="hljs-string">'execute should return promise'</span></span>, () =&gt; { request.configure(options); request.execute().then(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) =&gt;</span></span> { expect(result.Id).toEqual(<span class="hljs-number"><span class="hljs-number">1</span></span>); expect(result.Name).toEqual(<span class="hljs-string"><span class="hljs-string">'Jack'</span></span>); }); });</code> </pre> <br><p>  Les tests ont r√©ussi.  Et maintenant, vous pouvez faire une pause, puis revenir √† la finalisation du code de requ√™te r√©sultant, car il est encore tr√®s, tr√®s loin d'√™tre parfait, mais m√™me √† partir d'une interface simple √† utiliser, malgr√© le fait que les donn√©es l'utilisant proviennent de les bases peuvent d√©j√† √™tre re√ßues. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr436228/">https://habr.com/ru/post/fr436228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr436216/index.html">R√©f√©rentiels Spring JPA √† CUBA</a></li>
<li><a href="../fr436218/index.html">Marketing de contenu dans les m√©dias en ligne populaires: 5 erreurs de startups √† √©viter</a></li>
<li><a href="../fr436220/index.html">Comment fonctionne la notation dans l'industrie de l'autopartage. Partie 2. Identifiez un conducteur agressif en 5 secondes</a></li>
<li><a href="../fr436224/index.html">Nous √©crivons notre langage de programmation, partie 4: Repr√©sentation des structures et des classes, g√©n√©ration d'allocateurs</a></li>
<li><a href="../fr436226/index.html">Guide et aide-m√©moire pour Wireshark</a></li>
<li><a href="../fr436230/index.html">Comment prendre le contr√¥le de votre infrastructure r√©seau. Chapitre Trois S√©curit√© du r√©seau. Deuxi√®me partie</a></li>
<li><a href="../fr436232/index.html">Strat√©gie de t√©l√©pathie</a></li>
<li><a href="../fr436234/index.html">Analyseurs applicatifs Haskell</a></li>
<li><a href="../fr436236/index.html">Nous utilisons la science des donn√©es pour d√©terminer le cycle de vie d'un client</a></li>
<li><a href="../fr436238/index.html">Authentification dans Kubernetes avec GitHub OAuth et Dex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>