<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë≥ üë¥ üòë Creando un gancho de gato en Unity. Parte 1 üêà üêÑ üë¥üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los ganchos para gatos agregan mec√°nicas divertidas e interesantes al juego. Puedes usarlos para moverte por niveles, luchar en arenas y conseguir obj...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Creando un gancho de gato en Unity. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414887/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/a3e/e5d/348a3ee5d95a10273c8bc644e3dbc7d9.gif" alt="imagen"></div><br>  Los ganchos para gatos agregan mec√°nicas divertidas e interesantes al juego.  Puedes usarlos para moverte por niveles, luchar en arenas y conseguir objetos.  ¬°Pero a pesar de la aparente simplicidad, la f√≠sica del manejo de la cuerda y la creaci√≥n de un comportamiento realista puede ser un desaf√≠o! <br><br>  En la primera parte de este tutorial, implementamos nuestro propio sistema de gancho bidimensional y aprendemos lo siguiente: <br><br><ul><li>  Crea un sistema de punter√≠a. </li><li>  Use el renderizador de l√≠nea y la uni√≥n de distancia para crear la cuerda. </li><li>  Le ense√±aremos a la soga a envolver objetos del juego. </li><li>  Calcule el √°ngulo de giro de la cuerda y agregue fuerza en esa direcci√≥n. </li></ul><br><blockquote>  <em>Nota</em> : este tutorial est√° destinado a usuarios avanzados y experimentados, y no cubre temas como agregar componentes, crear nuevos scripts de GameObject y sintaxis de C #.  Si necesita mejorar sus habilidades de Unity, consulte nuestros tutoriales de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introducci√≥n a Unity</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Introducci√≥n a las secuencias de comandos de Unity</a> .  Dado que <em>DistanceJoint2D se</em> usa en este tutorial, tambi√©n debe consultar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Physics Joints en Unity 2D</a> , y solo luego volver a este tutorial. </blockquote><a name="habracut"></a><br><h2>  Llegar al trabajo </h2><br>  Descargue el <a href="">borrador</a> de este tutorial y luego √°bralo en el editor de Unity.  Se requiere la unidad 2017.1 o superior para la operaci√≥n. <br><br>  Abra la escena del <em>juego</em> desde la carpeta <em>Escenas</em> y vea d√≥nde comenzaremos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/973/819/22f/97381922f527deb0b338346d13083c13.png"></div><br>  Por ahora, tenemos un personaje jugador simple (babosa) y piedras colgando en el aire. <br><br>  Los componentes importantes de GameObject <em>Player</em> hasta ahora son el colisionador de c√°psulas y el cuerpo r√≠gido, que le permiten interactuar con objetos f√≠sicos en el nivel.  Adem√°s, se adjunta un gui√≥n de movimiento simple ( <em>PlayerMovement</em> ) al personaje, lo que le permite deslizarse por el suelo y realizar saltos simples. <br><br>  Presiona el bot√≥n <em>Reproducir</em> para iniciar el juego e intenta controlar al personaje.  <em>A</em> y <em>D lo</em> mueven hacia la izquierda / derecha, y cuando presiona la <em>barra espaciadora,</em> salta.  Trate de no resbalarse y caerse del precipicio, de lo contrario, ¬°morir√°! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69a/8b5/841/69a8b58415940671c3519ceccfcf6ed7.png"></div><br>  Ya tenemos los conceptos b√°sicos de administraci√≥n, pero el mayor problema ahora es la falta de ganchos para gatos. <br><br><h2>  Crear ganchos y cuerdas </h2><br>  Al principio, el sistema cat-hook parece bastante simple, pero para su implementaci√≥n de alta calidad es necesario tener en cuenta muchos aspectos.  Estos son algunos de los requisitos para la mec√°nica bidimensional de gancho de gato: <br><br><ul><li>  Renderizador de l√≠nea para mostrar la cuerda.  Cuando la cuerda se envuelve alrededor de los objetos, podemos agregar m√°s segmentos al renderizador de l√≠nea y colocar los v√©rtices en los puntos correspondientes a las roturas de la cuerda. </li><li>  DistanceJoint2D.  Se puede usar para unir el punto de anclaje actual del gancho de gato para que nuestra bala pueda balancearse.  Tambi√©n nos permite ajustar la distancia que se puede usar para alargar y reducir la cuerda. </li><li>  Child GameObject con RigidBody2D, que se puede mover seg√∫n la ubicaci√≥n actual del punto de anclaje del gancho.  En esencia, ser√° el punto de suspensi√≥n / anclaje de la cuerda. </li><li>  Raycast para lanzar un gancho y sujetarlo a objetos. </li></ul><br>  Seleccione el objeto <em>Player</em> en la Jerarqu√≠a y agregue un nuevo GameObject hijo llamado <em>RopeHingeAnchor</em> .  Este GameObject se usar√° para colocar el punto de suspensi√≥n / anclaje del gancho de gato. <br><br>  Agregue los componentes <em>SpriteRenderer</em> y <em>RigidBody2D</em> a <em>RopeHingeAnchor</em> . <br><br>  Para SpriteRenderer, configure la propiedad <em>Sprite</em> para usar el valor <em>UISprite</em> y cambie el <em>Orden en la Capa</em> a <em>2</em> .  Deshabilite el componente <em>desmarcando la casilla</em> junto a su nombre. <br><br>  Para el componente <em>RigidBody2D,</em> establezca la propiedad Tipo de cuerpo en <em>Cinem√°tica</em> .  Este punto ser√° movido no por el motor f√≠sico, sino por el c√≥digo. <br><br>  Seleccione la capa de <em>cuerda</em> y establezca los valores de escala X e Y del componente Transformar en <em>4</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e18/4aa/8e4/e184aa8e457a1e1d3928966b2ae3bca7.png"></div><br>  Seleccione <em>Player</em> nuevamente y conecte el nuevo componente <em>DistanceJoint2D</em> . <br><br>  Arrastre <em>RopeHingeAnchor</em> desde la Jerarqu√≠a a la propiedad <em>Cuerpo r√≠gido conectado</em> del componente <em>DistanceJoint2D</em> y desactive la <em>Configuraci√≥n autom√°tica de distancia</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e46/25b/b80/e4625bb804bb2ed2a0c5bee2aed0eade.gif"></div><br>  Cree un nuevo script C # llamado <em>RopeSystem</em> en la carpeta del proyecto <em>Scripts</em> y √°bralo en el editor de c√≥digo. <br><br>  Eliminar el m√©todo de <code>Update</code> . <br><br>  En la parte superior del script dentro de la <code>RopeSystem</code> clase <code>RopeSystem</code> agregue nuevas variables, el m√©todo <code>Awake()</code> y el nuevo m√©todo <code>Update</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 public GameObject ropeHingeAnchor; public DistanceJoint2D ropeJoint; public Transform crosshair; public SpriteRenderer crosshairSprite; public PlayerMovement playerMovement; private bool ropeAttached; private Vector2 playerPosition; private Rigidbody2D ropeHingeAnchorRb; private SpriteRenderer ropeHingeAnchorSprite; void Awake() { // 2 ropeJoint.enabled = false; playerPosition = transform.position; ropeHingeAnchorRb = ropeHingeAnchor.GetComponent&lt;Rigidbody2D&gt;(); ropeHingeAnchorSprite = ropeHingeAnchor.GetComponent&lt;SpriteRenderer&gt;(); } void Update() { // 3 var worldMousePosition = Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, Input.mousePosition.y, 0f)); var facingDirection = worldMousePosition - transform.position; var aimAngle = Mathf.Atan2(facingDirection.y, facingDirection.x); if (aimAngle &lt; 0f) { aimAngle = Mathf.PI * 2 + aimAngle; } // 4 var aimDirection = Quaternion.Euler(0, 0, aimAngle * Mathf.Rad2Deg) * Vector2.right; // 5 playerPosition = transform.position; // 6 if (!ropeAttached) { } else { } }</span></span></code> </pre> <br>  Analicemos cada parte en orden: <br><br><ol><li>  Usamos estas variables para rastrear los diversos componentes con los que interactuar√° el script RopeSystem. </li><li>  El m√©todo <code>Awake</code> comienza al comienzo del juego y deshabilita <code>ropeJoint</code> (el componente DistanceJoint2D).  Tambi√©n establece <code>playerPosition</code> en la posici√≥n actual del jugador. </li><li>  Esta es la parte m√°s importante del ciclo principal <code>Update()</code> .  Primero, obtenemos la posici√≥n del cursor del mouse en el mundo usando el <code>ScreenToWorldPoint</code> c√°mara <code>ScreenToWorldPoint</code> .  Luego calculamos la direcci√≥n de nuestra mirada restando la posici√≥n del jugador de la posici√≥n del mouse en el mundo.  Luego lo usamos para crear <code>aimAngle</code> , que es una representaci√≥n del √°ngulo de punter√≠a del cursor.  El valor almacena un valor positivo en la construcci√≥n if. </li><li>  <code>aimDirection</code> es un giro que resulta √∫til m√°s adelante.  Solo estamos interesados ‚Äã‚Äãen el valor Z, ya que estamos usando una c√°mara 2D, y este es el √∫nico sistema operativo correspondiente.  Pasamos <code>aimAngle * Mathf.Rad2Deg</code> , que convierte el √°ngulo en radianes en un √°ngulo en grados. </li><li>  La posici√≥n del jugador se controla mediante una variable conveniente que le permite no referirse constantemente a <code>transform.Position</code> . </li><li>  Finalmente, tenemos la construcci√≥n <code>if..else</code> , que usaremos pronto para determinar si la cuerda est√° unida al punto de anclaje. </li></ol><br>  Guarde el script y regrese al editor. <br><br>  Adjunte el componente <em>RopeSystem</em> al objeto Player y cuelgue los diversos componentes en los campos p√∫blicos que creamos en el script <em>RopeSystem</em> .  Arrastre <em>Player</em> , <em>Crosshair</em> y <em>RopeHingeAnchor</em> a los campos apropiados: <br><br><ul><li>  <em>Anclaje de bisagra de cuerda</em> : <em>Anclaje de bisagra</em> </li><li>  <em>Conjunto de cuerda</em> : jugador </li><li>  <em>Punto de mira</em> : punto de mira </li><li>  <em>Punto de mira Sprite</em> : Punto de mira </li><li>  <em>Movimiento del</em> jugador: jugador </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e97/9ca/d2e/e979cad2e2690cc65e9fe237a9f6c47a.gif"></div><br>  Ahora solo estamos haciendo todos estos c√°lculos complejos, pero hasta ahora no hay visualizaci√≥n que pueda mostrarlos en acci√≥n.  Pero no se preocupe, lo haremos pronto. <br><br>  Abra el script <em>RopeSystem</em> y agregue un nuevo m√©todo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCrosshairPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aimAngle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!crosshairSprite.enabled) { crosshairSprite.enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = transform.position.x + <span class="hljs-number"><span class="hljs-number">1f</span></span> * Mathf.Cos(aimAngle); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = transform.position.y + <span class="hljs-number"><span class="hljs-number">1f</span></span> * Mathf.Sin(aimAngle); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> crossHairPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(x, y, <span class="hljs-number"><span class="hljs-number">0</span></span>); crosshair.transform.position = crossHairPosition; }</code> </pre> <br>  Este m√©todo posiciona la vista seg√∫n el <code>aimAngle</code> transmitido (el valor flotante que calculamos en <code>Update()</code> ) para que gire alrededor del jugador con un radio de 1 unidad.  Tambi√©n incluimos un alcance de sprite en caso de que a√∫n no est√© hecho. <br><p>  En <code>Update()</code> cambiamos la construcci√≥n <code>!ropeAttached</code> para verificar <code>!ropeAttached</code> para que se vea as√≠: <br><br></p><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ropeAttached) { SetCrosshairPosition(aimAngle); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { crosshairSprite.enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Guarda el script y ejecuta el juego.  Ahora nuestra babosa deber√≠a poder apuntar con la vista. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/b1f/8ca/ffeb1f8ca53fbc0463aad677677fb837.gif"></div><br>  La siguiente pieza de l√≥gica que debe implementarse es un tiro de gancho de gato.  Ya hemos determinado la direcci√≥n del objetivo, por lo que necesitamos un m√©todo que lo reciba como par√°metro. <br><br>  Agregue las siguientes variables debajo de las variables en el script <em>RopeSystem</em> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LineRenderer ropeRenderer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LayerMask ropeLayerMask; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ropeMaxCastDistance = <span class="hljs-number"><span class="hljs-number">20f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Vector2&gt; ropePositions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Vector2&gt;();</code> </pre> <br>  <em>LineRenderer</em> contendr√° un enlace a un renderizador de l√≠nea que dibuja la cuerda.  <em>LayerMask le</em> permite personalizar las capas f√≠sicas con las que el gancho puede interactuar.  El valor <code>ropeMaxCastDistance</code> establece la distancia m√°xima que el "raycast" puede "disparar". <br><br>  Finalmente, la lista de posiciones de Vector2 se utilizar√° para rastrear los puntos de envoltura de la cuerda, que discutiremos m√°s adelante. <br><br>  Agregue los siguientes m√©todos nuevos: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 private void HandleInput(Vector2 aimDirection) { if (Input.GetMouseButton(0)) { // 2 if (ropeAttached) return; ropeRenderer.enabled = true; var hit = Physics2D.Raycast(playerPosition, aimDirection, ropeMaxCastDistance, ropeLayerMask); // 3 if (hit.collider != null) { ropeAttached = true; if (!ropePositions.Contains(hit.point)) { // 4 //    ,    -  . transform.GetComponent&lt;Rigidbody2D&gt;().AddForce(new Vector2(0f, 2f), ForceMode2D.Impulse); ropePositions.Add(hit.point); ropeJoint.distance = Vector2.Distance(playerPosition, hit.point); ropeJoint.enabled = true; ropeHingeAnchorSprite.enabled = true; } } // 5 else { ropeRenderer.enabled = false; ropeAttached = false; ropeJoint.enabled = false; } } if (Input.GetMouseButton(1)) { ResetRope(); } } // 6 private void ResetRope() { ropeJoint.enabled = false; ropeAttached = false; playerMovement.isSwinging = false; ropeRenderer.positionCount = 2; ropeRenderer.SetPosition(0, transform.position); ropeRenderer.SetPosition(1, transform.position); ropePositions.Clear(); ropeHingeAnchorSprite.enabled = false; }</span></span></code> </pre> <br>  Esto es lo que hace el c√≥digo anterior: <br><br><ol><li>  Se llama a HandleInput desde el bucle <code>Update()</code> y simplemente sondea la entrada de los botones izquierdo y derecho del mouse. </li><li>  Cuando se registra un clic izquierdo, se activa la l√≠nea de la cuerda y se dispara un rayo 2D desde la posici√≥n del jugador en la direcci√≥n de punter√≠a.  La distancia m√°xima se establece para que el gato de gancho no se pueda disparar a una distancia infinita, y se aplica una m√°scara para que sea posible seleccionar las capas de f√≠sica con las que los rayos pueden chocar. </li><li>  Si se detecta un impacto de emisi√≥n de rayos, entonces <code>ropeAttached</code> es <code>true</code> y se verifica una lista de las posiciones de los v√©rtices de la cuerda para asegurarse de que no haya ning√∫n punto all√≠. </li><li>  Si el cheque devuelve verdadero, entonces se agrega un peque√±o impulso de fuerza a la babosa para que rebote sobre el suelo, se <code>ropeJoint</code> (DistanceJoint2D), que se establece en la distancia igual a la distancia entre la babosa y el punto de impacto de la emisi√≥n de rayos.  Tambi√©n se incluye un sprite de punto de anclaje. </li><li>  Si raycast no golpea nada, entonces el renderizador de l√≠nea y ropeJoint est√°n deshabilitados, y el indicador <code>ropeAttached</code> es falso. </li><li>  Si se presiona el bot√≥n derecho del mouse, se <code>ResetRope()</code> m√©todo <code>ResetRope()</code> , que deshabilita y restablece todos los par√°metros relacionados con la cuerda / gancho a los valores que deber√≠an ser si no se usa el gancho. </li></ol><br>  En la parte inferior de nuestro m√©todo de <code>Update</code> , agregue una llamada al nuevo m√©todo <code>HandleInput()</code> y <code>aimDirection</code> valor <code>aimDirection</code> : <br><br><pre> <code class="cs hljs">HandleInput(aimDirection);</code> </pre> <br>  Guarde los cambios en <em>RopeSystem.cs</em> y regrese al editor. <br><br><h2>  Agregar una soga </h2><br>  Nuestra babosa no podr√° volar por el aire sin una cuerda, por lo que es hora de darle algo que sea una representaci√≥n visual de la cuerda y que tenga la capacidad de "girar" en las esquinas. <br><br>  El renderizador de l√≠neas es ideal para esto, ya que nos permite transferir el n√∫mero de puntos y su posici√≥n en el espacio del mundo. <br><br>  La idea aqu√≠ es que siempre almacenamos el primer v√©rtice de la cuerda (0) en la posici√≥n del jugador, y todos los dem√°s v√©rtices se colocan din√°micamente cuando la cuerda debe envolverse alrededor de algo, incluida la posici√≥n actual de la bisagra, que es el siguiente punto a lo largo de la cuerda. del jugador <br><br>  Seleccione <em>Player</em> y agregue el componente <em>LineRenderer</em> .  Establezca <em>Ancho</em> en <em>0.075</em> .  Expanda la lista <em>Materiales</em> y, como <em>Elemento 0,</em> seleccione el material Material de <em>cuerda</em> ubicado en la carpeta <em>Materiales</em> del proyecto.  Finalmente, para el Renderizador de l√≠nea, para el <em>Modo de textura,</em> seleccione <em>Distribuir por segmento</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c80/6aa/59f/c806aa59f875ac106babef5a8b57a6fc.png"></div><br>  Arrastre el componente Renderizador de l√≠nea al campo <em>Renderizador</em> de <em>cuerda del</em> componente <em>Sistema de cuerda</em> . <br><br>  Haga clic en la lista desplegable de <em>M√°scara de capa</em> de <em>cuerda</em> y seleccione como capas con las que pueden interactuar Raycast <em>Default, Rope y Pivot</em> .  Debido a esto, cuando se "dispara" una emisi√≥n de rayos, colisionar√° solo con estas capas, pero no con otros objetos, como un jugador. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9f/eab/2c3/f9feab2c30cc84b83c94d39ce74acdea.gif"></div><br>  Si comienzas el juego ahora, notar√°s un comportamiento extra√±o.  Cuando apuntamos a una piedra sobre la cabeza de la babosa y disparamos con un gancho, obtenemos un peque√±o salto hacia arriba, despu√©s de lo cual nuestro amigo comienza a comportarse de manera bastante aleatoria. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/815/abd/ae6/815abdae693911ed0ba56f14775e5488.gif"></div><br>  Todav√≠a no hemos establecido la distancia para la uni√≥n de distancia, adem√°s, los v√©rtices de la representaci√≥n de l√≠nea no est√°n configurados.  Por lo tanto, no vemos la cuerda, y dado que la junta de distancia est√° directamente por encima de la posici√≥n de la bala, el valor actual de la distancia de la junta de distancia la empuja hacia las piedras debajo de ella. <br><br>  Pero no se preocupe, ahora resolveremos este problema. <br><br>  En el script <em>RopeSystem.cs,</em> agregue un nuevo operador al comienzo de la clase: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq;</code> </pre> <br>  Esto nos permite usar consultas LINQ, que en nuestro caso simplemente nos permiten encontrar convenientemente el primer o el √∫ltimo elemento de la lista <code>ropePositions</code> . <br><br><blockquote>  <em>Nota</em> : Language-Integrated Query (LINQ) es el nombre de un conjunto de tecnolog√≠as basadas en la incorporaci√≥n de capacidades de consulta directamente en C #.  Puedes leer m√°s sobre esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </blockquote><br>  Agregue una nueva variable privada bool llamada <code>distanceSet</code> debajo de las otras variables: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> distanceSet;</code> </pre> <br>  Utilizaremos esta variable como una bandera para que el gui√≥n pueda reconocer que la distancia de la cuerda (para el punto entre el jugador y el punto de referencia actual donde est√° conectado el gancho de gato) est√° configurada correctamente. <br><br>  Ahora agregue un nuevo m√©todo que usaremos para establecer las posiciones de los v√©rtices de la cuerda para representar la l√≠nea y establecer la distancia de la articulaci√≥n de distancia en la lista almacenada de posiciones con cuerda ( <code>ropePositions</code> ): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateRopePositions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if (!ropeAttached) { return; } // 2 ropeRenderer.positionCount = ropePositions.Count + 1; // 3 for (var i = ropeRenderer.positionCount - 1; i &gt;= 0; i--) { if (i != ropeRenderer.positionCount - 1) // if not the Last point of line renderer { ropeRenderer.SetPosition(i, ropePositions[i]); // 4 if (i == ropePositions.Count - 1 || ropePositions.Count == 1) { var ropePosition = ropePositions[ropePositions.Count - 1]; if (ropePositions.Count == 1) { ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } else { ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } } // 5 else if (i - 1 == ropePositions.IndexOf(ropePositions.Last())) { var ropePosition = ropePositions.Last(); ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } } else { // 6 ropeRenderer.SetPosition(i, transform.position); } } }</span></span></code> </pre> <br>  Explique el c√≥digo que se muestra arriba: <br><br><ol><li>  Salga del m√©todo si la cuerda no est√° unida. </li><li>  Asignamos el valor de los puntos de renderizado de la l√≠nea de la cuerda al n√∫mero de posiciones almacenadas en las posiciones de la <code>ropePositions</code> , m√°s 1 m√°s (para la posici√≥n del jugador). </li><li>  Hacemos un bucle alrededor de la lista de <code>ropePositions</code> y <code>ropePositions</code> para cada posici√≥n (excepto la √∫ltima), asignamos la posici√≥n del v√©rtice del renderizador de l√≠nea al valor de la posici√≥n Vector2 almacenada por el √≠ndice de bucle en la lista de <code>ropePositions</code> . </li><li>  Asigne al punto de anclaje de la cuerda el segundo desde la posici√≥n final de la cuerda, en la que deber√≠a estar el punto de anclaje / bisagra actual, o si solo tenemos una posici√≥n de la cuerda, entonces convi√©rtalo en el punto de anclaje.  Entonces, establecemos la distancia <code>ropeJoint</code> igual a la distancia entre el jugador y la posici√≥n actual de la cuerda, que damos la <code>ropeJoint</code> en el bucle. </li><li>  La construcci√≥n if maneja el caso donde la posici√≥n actual de la cuerda en el bucle es la segunda desde el final;  es decir, el punto en el que la cuerda se conecta al objeto, es decir  bisagra / punto de anclaje actual. </li><li>  Este <code>else</code> bloque maneja la asignaci√≥n de la posici√≥n del √∫ltimo v√©rtice de la cuerda al valor de la posici√≥n actual del jugador. </li></ol><br>  Recuerde agregar la llamada <code>UpdateRopePositions()</code> al final de <code>Update()</code> <code>UpdateRopePositions()</code> : <br><br><pre> <code class="cs hljs">UpdateRopePositions();</code> </pre> <br>  Guarde los cambios en el script y vuelva a ejecutar el juego.  Haga un "peque√±o espacio" un peque√±o salto apuntando y disparando con un gancho a una piedra sobre el personaje.  Ahora puede disfrutar de los frutos de su trabajo: la babosa se balancea tranquilamente sobre las piedras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b94/f87/d7c/b94f87d7c533fdae336e3818f7cf3908.gif"></div><br>  Ahora puede ir a la ventana de escena, seleccionar Jugador, usar la herramienta de movimiento (por defecto, la tecla <em>W</em> ) para moverlo y ver c√≥mo los dos v√©rtices de la l√≠nea de la cuerda siguen la posici√≥n del gancho y la posici√≥n del jugador para dibujar la cuerda.  Despu√©s de liberar el reproductor, DistanceJoint2D calcula correctamente la distancia y la bala continuar√° balance√°ndose en la bisagra conectada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/66e/18c/5e166e18ca7ff821025a920b1eaf849a.gif"></div><br><h2>  Manejo de puntos de envoltura </h2><br>  Jugar con una babosa oscilante no es m√°s √∫til que una toalla repelente al agua, por lo que definitivamente debemos complementarlo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/3bd/43e/6e93bd43eb1ebff2241cb89af3b09f0a.png"></div><br>  La buena noticia es que el m√©todo recientemente agregado para procesar las posiciones de la cuerda se puede utilizar en el futuro.  Hasta ahora estamos usando solo dos posiciones de cuerda.  Uno est√° conectado a la posici√≥n del jugador, y el segundo a la posici√≥n actual del punto de anclaje del gancho cuando se le dispara. <br><br>  El √∫nico problema es que, si bien no rastreamos todas las posiciones potenciales de la cuerda, esto requiere un poco de trabajo. <br><br>  Para reconocer las posiciones en las piedras alrededor de las cuales debe envolverse la cuerda, agregando una nueva posici√≥n de v√©rtice al renderizador de l√≠nea, necesitamos un sistema que determine si el punto de v√©rtice del colisionador est√° entre la l√≠nea recta entre la posici√≥n actual de la bala y el punto de anclaje / bisagra actual de la cuerda. <br><br>  ¬°Parece que esto es un trabajo nuevo para el buen y viejo Raycast! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47a/52b/abe/47a52babe8fb16ef57a365b287dceb12.png"></div><br>  Primero, necesitamos crear un m√©todo que pueda encontrar el punto m√°s cercano en el colisionador basado en el punto de impacto de la emisi√≥n de rayos y los bordes del colisionador. <br><br>  Agregue un nuevo m√©todo al script <em>RopeSystem.cs</em> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 private Vector2 GetClosestColliderPointFromRaycastHit(RaycastHit2D hit, PolygonCollider2D polyCollider) { // 2 var distanceDictionary = polyCollider.points.ToDictionary&lt;Vector2, float, Vector2&gt;( position =&gt; Vector2.Distance(hit.point, polyCollider.transform.TransformPoint(position)), position =&gt; polyCollider.transform.TransformPoint(position)); // 3 var orderedDictionary = distanceDictionary.OrderBy(e =&gt; e.Key); return orderedDictionary.Any() ? orderedDictionary.First().Value : Vector2.zero; }</span></span></code> </pre><br>  Si no est√° familiarizado con las consultas LINQ, entonces este c√≥digo puede parecer una especie de magia C # complicada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e8/0d6/c88/9e80d6c88df7182190a87a8ca54dcb70.png"></div><br>  Si es as√≠, entonces no tengas miedo.  LINQ hace mucho trabajo por nosotros: <br><br><ol><li>  Este m√©todo toma dos par√°metros: el objeto <em>RaycastHit2D</em> y el <em>objeto PolygonCollider2D</em> .  Todas las piedras en el nivel tienen colisionadores PolygonCollider2D, por lo que si siempre usamos formas PolygonCollider2D, funcionar√° bien. </li><li>  ¬°Aqu√≠ es donde comienza la magia de consulta LINQ!  Aqu√≠ transformamos la colecci√≥n de puntos del colisionador poligonal en un diccionario de posiciones <em>Vector2</em> (el valor de cada elemento del diccionario es la posici√≥n misma), y a la clave de cada elemento se le asigna el valor de la distancia desde este punto al jugador de posici√≥n del jugador (valor flotante).  A veces sucede algo m√°s aqu√≠: la posici√≥n resultante se convierte en espacio mundial (de forma predeterminada, las posiciones de los v√©rtices del colisionador se almacenan en el espacio local, es decir, local en relaci√≥n con el objeto al que pertenece el colisionador, y necesitamos posiciones en el espacio mundial). </li><li>  El diccionario est√° ordenado por clave.  En otras palabras, por la distancia m√°s cercana a la posici√≥n actual del jugador.  ¬°Se devuelve la distancia m√°s cercana, es decir, cualquier punto devuelto por este m√©todo es el punto de colisi√≥n entre el jugador y el punto actual de la bisagra de la cuerda! </li></ol><br>  Volvamos al script <em>RopeSystem.cs</em> y agreguemos una nueva variable de campo privado en la parte superior: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;Vector2, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; wrapPointsLookup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Vector2, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;();</code> </pre> <br>  Lo usaremos para rastrear las posiciones alrededor de las cuales se puede enrollar la cuerda. <br><br>  Al final del m√©todo <code>Update()</code> , busque la construcci√≥n <code>else</code> que contiene <code>crosshairSprite.enabled = false;</code>  y agregue lo siguiente: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 if (ropePositions.Count &gt; 0) { // 2 var lastRopePoint = ropePositions.Last(); var playerToCurrentNextHit = Physics2D.Raycast(playerPosition, (lastRopePoint - playerPosition).normalized, Vector2.Distance(playerPosition, lastRopePoint) - 0.1f, ropeLayerMask); // 3 if (playerToCurrentNextHit) { var colliderWithVertices = playerToCurrentNextHit.collider as PolygonCollider2D; if (colliderWithVertices != null) { var closestPointToHit = GetClosestColliderPointFromRaycastHit(playerToCurrentNextHit, colliderWithVertices); // 4 if (wrapPointsLookup.ContainsKey(closestPointToHit)) { ResetRope(); return; } // 5 ropePositions.Add(closestPointToHit); wrapPointsLookup.Add(closestPointToHit, 0); distanceSet = false; } } }</span></span></code> </pre> <br>  Explica este fragmento de c√≥digo: <br><br><ol><li>  Si algunas posiciones se almacenan en la lista de <code>ropePositions</code> , entonces ... </li><li>  Disparamos desde la posici√≥n del jugador en la direcci√≥n del jugador que est√° mirando la √∫ltima posici√≥n de la cuerda de la lista, el punto de anclaje en el que se une el gancho de gato a la piedra, con una distancia de emisi√≥n de rayos igual a la distancia entre el jugador y la posici√≥n del punto de anclaje de la cuerda. </li><li>  Si Raycast choca con algo, entonces el colisionador de este objeto se <em>convierte de</em> forma segura en el tipo <em>PolygonCollider2D</em> .  Si bien es un verdadero PolygonCollider2D, la posici√≥n de v√©rtice m√°s cercana de este colisionador se devuelve utilizando el m√©todo que escribimos anteriormente como <em>Vector2</em> . </li><li>  Se comprueba mediante <code>wrapPointsLookup</code> para asegurarse de que la misma posici√≥n no se vuelva a comprobar.  Si est√° marcada, descartamos la cuerda y la cortamos, dejando caer al jugador. </li><li>  Luego, se <code>ropePositions</code> lista <code>ropePositions</code> : se agrega la posici√≥n alrededor de la cual la cuerda debe envolverse.  El diccionario <code>wrapPointsLookup</code> tambi√©n se actualiza.  Finalmente, el indicador <code>distanceSet</code> se restablece para que el m√©todo <code>UpdateRopePositions()</code> pueda redefinir la distancia de la cuerda con la nueva longitud de la cuerda y los segmentos. </li></ol><br>  En <code>ResetRope()</code> agregue la siguiente l√≠nea para que el diccionario <code>wrapPointsLookup</code> cada vez que un jugador desconecte una cuerda: <br><br><pre> <code class="cs hljs">wrapPointsLookup.Clear();</code> </pre> <br>  Guarda y lanza el juego.  Dispara el gancho de gato en la piedra sobre la babosa y usa la herramienta Mover en la ventana de escena para mover la babosa sobre varias repisas de piedra. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c62/999/f50/c62999f50094252b3850b8b4c54e2cdc.gif"></div><br>  ¬°As√≠ es como ense√±amos a la soga a envolver objetos! <br><br><h2>  A√±adir capacidad de balanceo </h2><br>  La babosa que cuelga de la cuerda es bastante est√°tica.  Para solucionar esto, podemos agregar la habilidad de balanceo. <br><br>  Para hacer esto, necesitamos obtener una posici√≥n perpendicular a la posici√≥n de balanceo hacia adelante (de lado), independientemente del √°ngulo en el que est√© mirando. <br><br>  Abra <em>PlayerMovement.cs</em> y agregue las siguientes dos variables p√∫blicas a la parte superior del script: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 ropeHook; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> swingForce = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br>  A la variable <code>ropeHook</code> se le asignar√° cualquier posici√≥n en la que el gancho de la cuerda se encuentre actualmente, y <code>swingForce</code> es el valor que usamos para agregar el movimiento de oscilaci√≥n. <br><br>  Reemplace el m√©todo <code>FixedUpdate()</code> uno nuevo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (horizontalInput &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span> || horizontalInput &gt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) { animator.SetFloat(<span class="hljs-string"><span class="hljs-string">"Speed"</span></span>, Mathf.Abs(horizontalInput)); playerSprite.flipX = horizontalInput &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isSwinging) { animator.SetBool(<span class="hljs-string"><span class="hljs-string">"IsSwinging"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1 -          var playerToHookDirection = (ropeHook - (Vector2)transform.position).normalized; // 2 -  ,     Vector2 perpendicularDirection; if (horizontalInput &lt; 0) { perpendicularDirection = new Vector2(-playerToHookDirection.y, playerToHookDirection.x); var leftPerpPos = (Vector2)transform.position - perpendicularDirection * -2f; Debug.DrawLine(transform.position, leftPerpPos, Color.green, 0f); } else { perpendicularDirection = new Vector2(playerToHookDirection.y, -playerToHookDirection.x); var rightPerpPos = (Vector2)transform.position + perpendicularDirection * 2f; Debug.DrawLine(transform.position, rightPerpPos, Color.green, 0f); } var force = perpendicularDirection * swingForce; rBody.AddForce(force, ForceMode2D.Force); } else { animator.SetBool("IsSwinging", false); if (groundCheck) { var groundForce = speed * 2f; rBody.AddForce(new Vector2((horizontalInput * groundForce - rBody.velocity.x) * groundForce, 0)); rBody.velocity = new Vector2(rBody.velocity.x, rBody.velocity.y); } } } else { animator.SetBool("IsSwinging", false); animator.SetFloat("Speed", 0f); } if (!isSwinging) { if (!groundCheck) return; isJumping = jumpInput &gt; 0f; if (isJumping) { rBody.velocity = new Vector2(rBody.velocity.x, jumpSpeed); } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los principales cambios aqu√≠ son que la bandera se verifica primero </font></font><code>isSwinging</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que las acciones se realicen solo cuando la babosa cuelga de la cuerda, y tambi√©n agregamos un perpendicular a la esquina de la babosa, indicando su punto de anclaje actual en la parte superior de la cuerda, pero perpendicular a la direcci√≥n de su oscilaci√≥n.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtenemos el vector de direcci√≥n normalizado del jugador al punto de conexi√≥n del gancho. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependiendo de si la bala se balancea hacia la izquierda o hacia la derecha, la direcci√≥n perpendicular se calcula usando </font></font><code>playerToHookDirection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Tambi√©n se ha agregado una llamada de extracci√≥n de depuraci√≥n para que pueda verla en el editor si lo desea.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RopeSystem.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font><font style="vertical-align: inherit;">agregue lo siguiente </font><font style="vertical-align: inherit;">en la parte superior del </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloque else</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dentro del </font></font><code>if(!ropeAttached)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo </font></font><code>Update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cs hljs">playerMovement.isSwinging = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; playerMovement.ropeHook = ropePositions.Last();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">el bloque if del</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mismo dise√±o, </font></font><code>if(!ropeAttached)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">agregue lo siguiente:</font></font><br><br><pre> <code class="cs hljs">playerMovement.isSwinging = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, informamos al script PlayerMovement que el jugador est√° balance√°ndose, y tambi√©n determinamos la √∫ltima posici√≥n (excepto la posici√≥n del jugador) de la cuerda, en otras palabras, el punto de anclaje de la cuerda. </font><font style="vertical-align: inherit;">Esto es necesario para calcular el √°ngulo perpendicular que acabamos de agregar al script PlayerMovement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto es lo que parece si enciende los artilugios en un juego en ejecuci√≥n y presiona A o D para girar hacia la izquierda / derecha:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5bd/6a5/4ed/5bd6a54ed3c8661e61b3bf765e50acfb.png"></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agregar descenso de cuerda </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si bien no tenemos la capacidad de subir y bajar la cuerda. </font><font style="vertical-align: inherit;">Aunque en la vida real, la babosa no pod√≠a levantarse y caer f√°cilmente a lo largo de la cuerda, pero este es un juego en el que puede pasar cualquier cosa, ¬øverdad? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la parte superior del script </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RopeSystem,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> agregue dos nuevas variables de campo:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> climbSpeed = <span class="hljs-number"><span class="hljs-number">3f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isColliding;</code> </pre> <br> <code>climbSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">establecer√° la velocidad a la cual la bala puede moverse hacia arriba y hacia abajo de la cuerda, y </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se usar√° como una bandera para determinar si la propiedad de uni√≥n de distancia de la cuerda de uni√≥n de distancia se puede aumentar o disminuir. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue este nuevo m√©todo:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleRopeLength</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if (Input.GetAxis("Vertical") &gt;= 1f &amp;&amp; ropeAttached &amp;&amp; !isColliding) { ropeJoint.distance -= Time.deltaTime * climbSpeed; } else if (Input.GetAxis("Vertical") &lt; 0f &amp;&amp; ropeAttached) { ropeJoint.distance += Time.deltaTime * climbSpeed; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este bloque </font></font><code>if..elseif</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lee la entrada a lo largo del eje vertical (arriba / abajo o W / S en el teclado) y, teniendo en cuenta las banderas, </font></font><code>ropeAttached iscColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aumenta o disminuye la distancia </font></font><code>ropeJoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, creando el efecto de alargar o acortar la cuerda. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enganchamos este m√©todo, agregando su llamada al final </font></font><code>Update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cs hljs">HandleRopeLength();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tambi√©n necesitamos una forma de establecer la bandera </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agregue los siguientes dos m√©todos al final del script:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerStay2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider2D colliderStay</span></span></span><span class="hljs-function">)</span></span> { isColliding = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerExit2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider2D colliderOnExit</span></span></span><span class="hljs-function">)</span></span> { isColliding = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estos dos m√©todos son m√©todos nativos de la clase base de los scripts MonoBehaviour. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si Collider actualmente toca otro objeto f√≠sico en el juego, el m√©todo se disparar√° constantemente </font></font><code>OnTriggerStay2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, asignando un </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font><font style="vertical-align: inherit;">a la bandera </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Esto significa que cuando la babosa toca la piedra, se le asigna un valor a la bandera isColliding </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El m√©todo se </font></font><code>OnTriggerExit2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">activa cuando un colisionador abandona el √°rea de otro colisionador, configurando la bandera en falso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recuerde: el m√©todo </font></font><code>OnTriggerStay2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede ser muy costoso desde el punto de vista computacional, as√≠ que √∫selo con cuidado.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬øA d√≥nde ir despu√©s? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Comienza el juego nuevamente y esta vez presiona las teclas de flecha o W / S para subir y bajar la cuerda. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/a3e/e5d/348a3ee5d95a10273c8bc644e3dbc7d9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El proyecto terminado de esta parte del tutorial se puede descargar </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Hemos recorrido un largo camino, desde la babosa que no se balancea hasta el molusco gaster√≥podo sin caparaz√≥n acrob√°tico! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Aprendiste a crear un sistema de punter√≠a que puede disparar un gancho de gato a cualquier objeto que tenga un colisionador, aferrarse a √©l y simult√°neamente balancearse sobre √©l, girando con una cuerda din√°mica alrededor de los bordes de los objetos! </font><font style="vertical-align: inherit;">Buen trabajo</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dd/bb5/29d/4ddbb529d88b62441d7b2d91424bf906.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, aqu√≠ falta una funci√≥n importante: la cuerda no puede "desenrollarse" cuando es necesario. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segunda parte del</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tutorial resolveremos este problema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero si est√°s dispuesto a arriesgarte, ¬øpor qu√© no intentas hacerlo t√∫ mismo? </font><font style="vertical-align: inherit;">Puedes usar un diccionario para esto </font></font><code>wrapPointsLookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414887/">https://habr.com/ru/post/es414887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414877/index.html">Una lente inusual para una c√°mara normal o c√≥mo dejar de pensar en el enfoque.</a></li>
<li><a href="../es414879/index.html">¬øPor qu√© 2 extrusoras en una impresora 3D?</a></li>
<li><a href="../es414881/index.html">Un poco de backstage VK</a></li>
<li><a href="../es414883/index.html">Los recuerdos sonaron de una nueva manera: la BBC actualiz√≥ el archivo de sonido del proyecto RemArc</a></li>
<li><a href="../es414885/index.html">Nos ocupamos de errores y "muletas" en el Registro Estatal Unificado de Entidades Legales - el registro estatal de entidades legales</a></li>
<li><a href="../es414889/index.html">Cuando las agencias digitales necesitan IaaS</a></li>
<li><a href="../es414891/index.html">H√°bitos del desarrollador</a></li>
<li><a href="../es414893/index.html">Viber, WhatsApp, Telegram, ¬øcu√°l es mejor?</a></li>
<li><a href="../es414895/index.html">Y para nosotros todo est√° "en posici√≥n vertical" - DBMS Vertica</a></li>
<li><a href="../es414897/index.html">Acceso a datos en aplicaciones multiusuario</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>