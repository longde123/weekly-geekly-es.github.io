<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµüèæ üëá üë®üèø‚Äçüî¨ Por que o Google precisava de um gr√°fico de conhecimento? üïâÔ∏è üë®üèæ‚Äçüè≠ ‚ú¥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando me apresento e digo o que nossa startup faz, o interlocutor imediatamente levanta a quest√£o: voc√™ trabalhou no Facebook antes ou o seu desenvol...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Por que o Google precisava de um gr√°fico de conhecimento?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440938/"><img src="https://habrastorage.org/webt/_b/5j/ed/_b5jedmpncy6tkfvqbhqc_jd6zi.png" align="left" width="280">  Quando me apresento e digo o que nossa startup faz, o interlocutor imediatamente levanta a quest√£o: voc√™ trabalhou no Facebook antes ou o seu desenvolvimento foi criado sob a influ√™ncia do Facebook?  Muitos est√£o cientes dos esfor√ßos do Facebook para manter seu gr√°fico social, porque a empresa publicou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√°rios</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos</a> sobre a infraestrutura deste gr√°fico, que foi cuidadosamente constru√≠da. <br><br>  O Google falou sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o gr√°fico de conhecimento dela</a> , mas nada sobre a infraestrutura interna.  No entanto, a empresa tamb√©m possui subsistemas especializados.  De fato, muita aten√ß√£o est√° sendo dada ao gr√°fico do conhecimento.  Pessoalmente, coloquei pelo menos duas das minhas promo√ß√µes neste cavalo - e comecei a trabalhar em um novo gr√°fico em 2010. <br><a name="habracut"></a><br>  <b>O Google precisava criar a infraestrutura</b> n√£o apenas para servir relacionamentos complexos no Gr√°fico de conhecimento, mas tamb√©m para oferecer suporte a todos os blocos tem√°ticos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OneBox</a> nos resultados de pesquisa que t√™m acesso a dados estruturados.  A infraestrutura √© necess√°ria para 1) contornar a qualidade dos fatos com 2) uma largura de banda alta o suficiente e 3) um atraso suficientemente baixo para conseguir obter uma boa parte das consultas de pesquisa na web.  Acontece que nenhum sistema ou banco de dados dispon√≠vel pode executar as tr√™s a√ß√µes. <br><br>  Agora, quando eu lhe disse por que a infraestrutura √© necess√°ria, no restante do artigo, falarei sobre minha experi√™ncia na constru√ß√£o de tais sistemas, inclusive para o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Knowledge Graph</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OneBox</a> . <br><br><h1>  Como eu sei disso? </h1><br>  Vou me apresentar brevemente.  Trabalhei no Google de 2006 a 2013.  Primeiro como estagi√°rio, depois como engenheiro de software na infraestrutura de pesquisa na web.  O Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">adquiriu a Metaweb</a> em 2010, e minha equipe acabou de lan√ßar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Caffeine</a> .  Eu queria fazer outra coisa - e comecei a trabalhar com os caras da Metaweb (em San Francisco), passando um tempo viajando entre San Francisco e Mountain View.  Eu queria descobrir como usar o gr√°fico de conhecimento para melhorar minha pesquisa na web. <br><br>  Existem projetos desse tipo no Google antes de mim.  Vale ressaltar que o projeto chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Squared foi</a> criado em um escrit√≥rio de Nova York e houve algumas conversas sobre cart√µes de conhecimento.  Houve esfor√ßos espor√°dicos de indiv√≠duos / equipes pequenas, mas naquela √©poca n√£o havia uma cadeia de equipes estabelecida, o que acabou me for√ßando a deixar o Google.  Mas voltaremos a isso mais tarde ... <br><br><h1>  Hist√≥ria da Metaweb </h1><br>  Como j√° mencionado, o Google adquiriu a Metaweb em 2010.  A Metaweb construiu um gr√°fico de conhecimento de alta qualidade usando v√°rios m√©todos, incluindo rastreamento e an√°lise da Wikipedia, bem como um sistema de edi√ß√£o no estilo wiki de crowdsourcing usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Freebase</a> .  Tudo isso funcionou com base no pr√≥prio banco de dados de gr√°ficos do Graphd - o daemon de gr√°ficos (agora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">publicado</a> no GitHub). <br><br>  O Graphd tinha algumas propriedades bastante t√≠picas.  Como daemon, funcionou em um servidor, armazenou todos os dados na mem√≥ria e pode emitir um site inteiro do Freebase.  Ap√≥s a compra, o Google definiu uma das tarefas para continuar trabalhando com o Freebase. <br><br>  <b>O Google construiu um imp√©rio com hardware padr√£o e software distribu√≠do.</b>  Um DBMS do servidor nunca seria capaz de exibir resultados de rastreamento, indexa√ß√£o e pesquisa.  Primeiro, criei o SSTable, depois o Bigtable, que √© dimensionado horizontalmente para centenas ou milhares de m√°quinas que compartilham petabytes de dados.  As m√°quinas s√£o alocadas pelo Borg (o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">K8</a> veio daqui), elas se comunicam via Stubby (o gRPC veio daqui) com a resolu√ß√£o de endere√ßos IP atrav√©s do servi√ßo de nomes Borg (BNC dentro do K8) e armazenam dados no Google File System ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GFS</a> , voc√™ pode dizer o Hadoop FS).  <i>Os processos podem morrer, as m√°quinas podem quebrar, mas o sistema como um todo √© indestrut√≠vel e continuar√° a zumbir.</i> <br><br>  Graphd entrou em tal ambiente.  A id√©ia de um banco de dados que serve um site inteiro em um servidor √© estranha ao Google (inclusive a mim).  Em particular, o Graphd precisava de 64 GB ou mais de mem√≥ria para rodar.  Se lhe parece que isso √© um pouco, lembre-se: este √© 2010.  A maioria dos servidores do Google est√° equipada com no m√°ximo 32 GB.  De fato, o Google teve que comprar m√°quinas especiais com RAM suficiente para servir o Graphd em sua forma atual. <br><br><h3>  Substitui√ß√£o Graphd </h3><br>  O brainstorming come√ßou sobre como mover os dados do Graphd ou reescrever o sistema para funcionar de maneira distribu√≠da.  Mas, veja bem, os gr√°ficos s√£o complicados.  Este n√£o √© um banco de dados de valores-chave para voc√™, onde voc√™ pode simplesmente pegar um dado, mov√™-lo para outro servidor e emiti-lo quando solicitar uma chave.  Os gr√°ficos executam jun√ß√µes e solu√ß√µes alternativas eficientes que exigem que o software funcione de uma maneira espec√≠fica. <br><br>  Uma id√©ia era usar um projeto chamado MindMeld (IIRC).  Supunha-se que a mem√≥ria de outro servidor estivesse dispon√≠vel muito mais rapidamente atrav√©s de equipamentos de rede.  Deveria ter sido mais r√°pido que os RPCs regulares, r√°pido o suficiente para pseudo-replicar o acesso direto √† mem√≥ria exigido pelo banco de dados na mem√≥ria.  Mas a ideia n√£o foi longe demais. <br><br>  Outra id√©ia que realmente se tornou um projeto foi criar um sistema de servi√ßo gr√°fico verdadeiramente distribu√≠do.  Algo que n√£o s√≥ pode substituir o Graphd for Freebase, mas tamb√©m realmente funciona na produ√ß√£o.  <b>Ela se chamava Dgraph - um gr√°fico distribu√≠do, invertido do Graphd (daemon-gr√°fico).</b> <br><br>  Se voc√™ estiver interessado, ent√£o sim.  Minha startup, Dgraph Labs, a empresa e o projeto de c√≥digo aberto Dgraph s√£o nomeados ap√≥s esse projeto no Google (nota: Dgraph √© uma marca comercial da Dgraph Labs; at√© onde eu sei, o Google n√£o libera projetos com nomes que correspondam aos internos). <br><br>  Em quase todo o restante do texto, quando menciono Dgraph, quero dizer o projeto interno do Google, e n√£o o projeto de c√≥digo aberto que criamos.  Mas mais sobre <i>isso</i> mais tarde. <br><br><h1>  A hist√≥ria da Cerebro: o mecanismo do conhecimento </h1><br>  <i>Criando inadvertidamente infraestrutura para gr√°ficos</i> <br><br>  Embora eu geralmente soubesse que o Dgraph estava tentando substituir o Graphd, meu objetivo era criar algo para melhorar a pesquisa na web.  Na Metaweb, conheci um engenheiro de pesquisa da DH que criou o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cubed</a> . <br><br>  Como mencionei, um grupo heterog√™neo de engenheiros da divis√£o de Nova York desenvolveu o Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Squared</a> .  Mas o sistema DH estava <i>muito</i> melhor.  Comecei a pensar em como implement√°-lo no Google.  O Google tinha pe√ßas de quebra-cabe√ßa que eu poderia usar facilmente. <br><br>  A primeira parte do quebra-cabe√ßa √© o mecanismo de busca.  Essa √© uma maneira de determinar com precis√£o quais palavras est√£o relacionadas entre si.  Por exemplo, quando voc√™ v√™ uma frase como [tom hanks movies], pode dizer que [tom] e [hanks] est√£o relacionados.  Da mesma forma, a partir de [san francisco weather], vemos uma conex√£o entre [san] e [francisco].  Essas s√£o coisas √≥bvias para as pessoas, mas n√£o t√£o √≥bvias para os carros. <br><br>  A segunda parte do quebra-cabe√ßa √© entender a gram√°tica.  Quando na consulta [livros de autores franceses], a m√°quina pode interpretar isso como [livros] de [autores franceses], ou seja, livros daqueles autores franceses.  Mas ela tamb√©m pode interpretar isso como [livros em franc√™s] de [autores], ou seja, livros em franc√™s por qualquer autor.  Usei o etiquetador POS ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Part-Of-Speech</a> ) da Universidade de Stanford para analisar melhor a gram√°tica e construir a √°rvore. <br><br>  A terceira parte do quebra-cabe√ßa √© entender as entidades.  [franc√™s] pode significar muito.  Pode ser um pa√≠s (regi√£o), nacionalidade (relacionada ao povo franc√™s), culin√°ria (relacionada √† comida) ou idioma.  Em seguida, apliquei outro sistema para obter uma lista de entidades √†s quais uma palavra ou frase pode corresponder. <br><br>  A quarta parte do quebra-cabe√ßa era entender o relacionamento entre entidades.  Quando se sabe como conectar palavras a frases, em que ordem as frases devem ser executadas, ou seja, sua gram√°tica e a quais entidades elas podem corresponder, √© necess√°rio encontrar o relacionamento entre essas entidades para criar interpreta√ß√µes de m√°quina.  Por exemplo, executamos a consulta [livros de autores franceses] e o POS diz que s√£o [livros] de [autores franceses].  Temos v√°rias entidades para [franc√™s] e v√°rias para [autores]: o algoritmo deve determinar como eles est√£o relacionados.  Por exemplo, eles podem ser relacionados por local de nascimento, ou seja, autores que nasceram na Fran√ßa (embora possam escrever em ingl√™s).  Ou podem ser autores que s√£o cidad√£os franceses.  Autores que sabem falar ou escrever franc√™s (mas podem n√£o estar relacionados √† Fran√ßa como pa√≠s) ou autores que simplesmente amam a culin√°ria francesa. <br><br><h1>  Sistema de gr√°fico de √≠ndice de pesquisa </h1><br>  Para determinar se h√° uma conex√£o entre os objetos e como eles est√£o conectados, voc√™ precisa de um sistema de gr√°ficos.  O Graphd nunca chegaria ao n√≠vel do Google, mas voc√™ poderia usar a pr√≥pria pesquisa.  Os dados do gr√°fico de conhecimento s√£o armazenados no formato triplos triplos, ou seja, cada fato √© representado por tr√™s partes: assunto (entidade), predicado (rela√ß√£o) e objeto (outra entidade).  As solicita√ß√µes s√£o como <code>[SP] ‚Üí [O]</code> ou <code>[PO] ‚Üí [S]</code> e, algumas vezes, <code>[SO] ‚Üí [P]</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29f/324/29b/29f32429b78e9fc1387deda24e3fc986.png"><br><br>  <b>Usei o √≠ndice de pesquisa do Google</b> , atribu√≠ um docid a cada triplo e constru√≠ tr√™s √≠ndices, um para S, P e O. Al√©m disso, o √≠ndice √© aninhado, ent√£o adicionei informa√ß√µes sobre o tipo de cada entidade (ou seja, ator, livro, pessoa e etc.) <br><br>  <i>Eu criei esse sistema, embora tenha visto um problema com a profundidade das jun√ß√µes (que √© explicada abaixo) e n√£o √© adequado para consultas complexas.</i>  <i>Na verdade, quando algu√©m da equipe da Metaweb me pediu para publicar um sistema para colegas, eu recusei.</i> <br><br>  Para determinar o relacionamento, voc√™ pode ver quantos resultados cada consulta fornece.  Por exemplo, quantos resultados [franc√™s] e [autor] d√£o?  Tomamos esses resultados e vemos como eles est√£o relacionados a [livros], etc. Assim, muitas interpreta√ß√µes de m√°quina da consulta apareceram.  Por exemplo, a consulta [tom hanks movies] gera uma variedade de interpreta√ß√µes, como [filmes dirigidos por tom hanks], [filmes estrelados por tom hanks], [filmes produzidos por tom hanks], mas rejeita automaticamente interpreta√ß√µes como [filmes chamados tom hanks]. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/50b/a4a/424/50ba4a424adfac5ada59b3c9ea29a82c.png"><br>  Cada interpreta√ß√£o gera uma lista de resultados - entidades v√°lidas no gr√°fico - e tamb√©m retorna seus tipos (presentes em anexos).  Isso provou ser uma fun√ß√£o extremamente poderosa, porque a compreens√£o do tipo de resultados abriu possibilidades como filtragem, classifica√ß√£o ou expans√£o adicional.  Voc√™ pode classificar os filmes com o ano de lan√ßamento, a dura√ß√£o do filme (curta, longa), o idioma, os pr√™mios recebidos etc. <br><br>  O projeto parecia t√£o inteligente que n√≥s (a DH tamb√©m estava parcialmente envolvida como especialista no gr√°fico do conhecimento) denominamos Cerebro, em homenagem ao dispositivo com o mesmo nome do filme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúX-Men‚Äù</a> . <br><br>  <b>O Cerebro frequentemente revelava fatos muito interessantes</b> que n√£o estavam originalmente na consulta de pesquisa.  Por exemplo, a pedido dos [presidentes dos EUA], a Cerebro perceber√° que os presidentes s√£o pessoas, e as pessoas t√™m crescimento.  Isso nos permite classificar os presidentes por crescimento e mostrar que Abraham Lincoln √© o mais alto presidente dos Estados Unidos.  Al√©m disso, as pessoas podem ser filtradas por nacionalidade.  Nesse caso, a Am√©rica e o Reino Unido aparecem na lista, porque os Estados Unidos tinham um presidente brit√¢nico, chamado George Washington.  (Aviso: os resultados s√£o baseados no estado do gr√°fico de conhecimento no momento do experimento; n√£o posso garantir sua exatid√£o). <br><br><h1>  Links azuis versus conhecimento </h1><br>  O Cerebro conseguiu realmente entender as solicita√ß√µes dos usu√°rios.  Tendo recebido dados para o gr√°fico inteiro, poder√≠amos gerar interpreta√ß√µes de m√°quina da consulta, gerar uma lista de resultados e entender muito desses resultados para um estudo mais aprofundado do gr√°fico.  Foi explicado acima: assim que o sistema entende que est√° lidando com filmes, pessoas ou livros, etc., certos filtros e tipos podem ser ativados.  Voc√™ pode at√© percorrer os n√≥s e mostrar informa√ß√µes relacionadas: de [presidentes dos EUA] a [escolas que frequentaram] ou [filhos que tiveram pai].  Aqui est√£o algumas outras perguntas que o pr√≥prio sistema gerou: [mulheres afro-americanas pol√≠ticas], [atores de bollywood casados ‚Äã‚Äãcom pol√≠ticos], [filhos de n√≥s presidentes], [filmes estrelados por tom hanks lan√ßados nos anos 90] <br><br>  A DH demonstrou essa oportunidade de passar de uma lista para outra em outro projeto chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Parallax</a> . <br><br>  O Cerebro mostrou um resultado muito impressionante, e o gerenciamento da Metaweb o apoiou.  Mesmo em termos de infraestrutura, ele se mostrou eficiente e funcional.  Eu chamei de <b>mecanismo de conhecimento</b> (como um mecanismo de pesquisa).  Mas no Google, ningu√©m abordou especificamente esse t√≥pico.  Ela era de pouco interesse para o meu gerente, eles me aconselharam a conversar com uma pessoa e depois com outra e, como resultado, tive a chance de demonstrar o sistema a um gerente de pesquisa muito alto. <br><br>  <b>A resposta n√£o era a que eu estava esperando</b> .  Para demonstrar os resultados do mecanismo de conhecimento de [livros de autores franceses], ele lan√ßou uma pesquisa no Google, mostrou dez linhas com links azuis e disse que o Google poderia fazer o mesmo.  Al√©m disso, eles n√£o querem receber tr√°fego de sites porque ficam com raiva. <br><br>  <i>Se voc√™ acha que ele est√° certo, pense sobre isso:</i> quando o Google faz uma pesquisa na Internet, ele realmente n√£o entende a solicita√ß√£o.  O sistema procura as palavras certas na posi√ß√£o correta, levando em considera√ß√£o o peso da p√°gina e assim por diante.  Este √© um sistema muito complexo, mas n√£o entende a consulta nem os resultados.  O pr√≥prio usu√°rio faz todo o trabalho: ler, analisar, extrair as informa√ß√µes necess√°rias dos resultados e pesquisas adicionais, adicionando uma lista completa de resultados, etc. <br><br>  Por exemplo, para [livros de autores franceses] uma pessoa primeiro tenta encontrar uma lista exaustiva, embora uma p√°gina com essa lista possa n√£o ser encontrada.  Em seguida, classifique esses livros por anos de publica√ß√£o ou filtre pelos editores e assim por diante - tudo isso exige que uma pessoa processe uma grande quantidade de informa√ß√µes, v√°rias pesquisas e processe os resultados.  O Cerebro √© capaz de reduzir esses esfor√ßos e tornar a intera√ß√£o do usu√°rio simples e sem falhas. <br><br>  Mas ent√£o n√£o havia um entendimento completo da import√¢ncia do gr√°fico de conhecimento.  O manual n√£o tinha certeza de sua utilidade ou de como relacion√°-lo √† pesquisa.  <b>Essa nova abordagem do conhecimento n√£o √© f√°cil para a organiza√ß√£o que alcan√ßou um sucesso t√£o significativo ao fornecer aos usu√°rios links para p√°ginas da web.</b> <br><br>  Ao longo do ano, lutei com um mal-entendido dos gerentes e, eventualmente, desisti.  Um gerente do escrit√≥rio de Xangai se virou para mim e entreguei o projeto a ele em junho de 2011.  Ele colocou uma equipe de 15 engenheiros.  Passei uma semana em Xangai, transmitindo aos engenheiros tudo o que eu criei e aprendi.  DH tamb√©m esteve envolvido nesse neg√≥cio e liderou a equipe por um longo tempo. <br><br><h1>  Problema de profundidade de jun√ß√£o </h1><br>  O sistema de gr√°ficos Cerebro teve um problema com a profundidade da uni√£o.  A jun√ß√£o √© realizada quando o resultado de uma consulta inicial √© necess√°rio para concluir uma consulta posterior.  Uma uni√£o t√≠pica inclui alguns <code>SELECT</code> , isto √©, um filtro em certos resultados de um conjunto de dados universal e, em seguida, esses resultados s√£o usados ‚Äã‚Äãpara filtrar por outra parte do conjunto de dados.  Vou explicar com um exemplo. <br><br>  Digamos que voc√™ queira conhecer [pessoas em SF que comem sushi].  Todas as pessoas recebem alguns dados, incluindo quem mora em qual cidade e que tipo de comida eles comem. <br><br>  A consulta acima √© uma associa√ß√£o de n√≠vel √∫nico.  Se o aplicativo acessar o banco de dados, ele far√° uma solicita√ß√£o para a primeira etapa.  Depois, fa√ßa algumas consultas (uma para cada resultado) para descobrir o que cada pessoa come, escolhendo apenas aqueles que comem sushi. <br><br>  O segundo passo sofre com o problema de fan-out.  Se o primeiro passo der um milh√£o de resultados (a popula√ß√£o de S√£o Francisco), o segundo passo deve ser dado a todos, solicitando seus h√°bitos alimentares e aplicando um filtro. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76a/f20/f9e/76af20f9e21b097fed9420f4174ab8ae.png"><br><br>  Os engenheiros de sistemas distribu√≠dos geralmente resolvem esse problema por <i>difus√£o</i> , ou seja, por distribui√ß√£o onipresente.  Eles acumulam os resultados correspondentes, fazendo uma solicita√ß√£o para cada servidor no cluster.  Isso fornece uma jun√ß√£o, mas causa problemas com a lat√™ncia da solicita√ß√£o. <br><br>  A transmiss√£o n√£o funciona bem em um sistema distribu√≠do.  Esse problema √© melhor explicado por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jeff Dean,</a> do Google, em seu discurso "Atingindo uma resposta r√°pida em grandes servi√ßos online" ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deos</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">slides</a> ).  O atraso total √© sempre maior que o atraso do componente mais lento.  <b>Um pequeno brilho nos computadores individuais causa atrasos, e a inclus√£o de muitos computadores na consulta aumenta drasticamente a probabilidade de atrasos.</b> <br><br><blockquote>  Considere um servidor com um atraso de mais de 1 ms em 50% dos casos e mais de 1 s em 1% dos casos.  Se a solicita√ß√£o for enviada para apenas um desses servidores, apenas 1% das respostas exceder√£o um segundo.  Mas se a solicita√ß√£o for enviada para centenas desses servidores, 63% das respostas exceder√£o um segundo. </blockquote><br>  Assim, a transmiss√£o de uma solicita√ß√£o aumenta muito o atraso.  Agora pense, e se voc√™ precisar de duas, tr√™s ou mais associa√ß√µes?  √â muito lento para ser executado em tempo real. <br><br>  O problema da implanta√ß√£o de ventiladores quando a transmiss√£o de solicita√ß√£o √© inerente √† maioria dos bancos de dados n√£o nativos de gr√°ficos, incluindo o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">gr√°fico Janus</a> , o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Twitter FlockDB</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Facebook TAO</a> . <br><br>  Associa√ß√µes distribu√≠das s√£o um problema complexo.  Os bancos de dados de gr√°ficos nativos permitem evitar esse problema, armazenando um conjunto de dados universal em um √∫nico servidor (banco de dados independente) e executando todas as jun√ß√µes sem acessar outros servidores.  Por exemplo, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Neo4j</a> faz isso. <br><br><h1>  Dgraph: uni√µes com profundidade arbitr√°ria </h1><br>  Ap√≥s concluir o trabalho no Cerebro e ter experi√™ncia na constru√ß√£o de um sistema de gerenciamento de gr√°ficos, participei do projeto Dgraph, tornando-me um dos tr√™s gerentes de projetos t√©cnicos.  Aplicamos conceitos inovadores que resolveram o problema da profundidade da uni√£o. <br><br>  Em particular, o Dgraph separa os dados do gr√°fico para que cada jun√ß√£o possa ser realizada completamente por uma m√°quina.  Retornando ao <code>subject-predicate-object</code> (SPO), cada inst√¢ncia Dgraph cont√©m todos os assuntos e objetos correspondentes a cada predicado nesta inst√¢ncia.  V√°rios predicados s√£o armazenados em uma inst√¢ncia, cada um sendo completamente armazenado. <br><br>  <b>Isso nos permitiu atender solicita√ß√µes com uma profundidade arbitr√°ria de associa√ß√µes</b> , eliminando o problema de implanta√ß√£o de ventiladores durante a transmiss√£o.  Por exemplo, a consulta [pessoas no SF que comem sushi] gerar√° no <i>m√°ximo duas chamadas de rede</i> no banco de dados, independentemente do tamanho do cluster.  O primeiro desafio encontrar√° todas as pessoas que moram em S√£o Francisco.  O segundo pedido enviar√° esta lista para cruzar com todas as pessoas que comem sushi.  Em seguida, voc√™ pode adicionar restri√ß√µes ou ramais adicionais, cada etapa ainda prev√™ n√£o mais que uma chamada de rede. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/428/283/668/428283668a3ede1b3a7f3b142b648888.png"><br>  Isso cria o problema de predicados muito grandes no mesmo servidor, mas pode ser resolvido dividindo-os ainda mais entre duas ou mais inst√¢ncias √† medida que o tamanho aumenta.  Na pior das hip√≥teses, um predicado ser√° dividido em todo o cluster.  Mas isso acontecer√° apenas em uma situa√ß√£o fant√°stica, quando todos os dados corresponderem a apenas um predicado.  Em outros casos, essa abordagem pode reduzir significativamente o atraso de solicita√ß√µes em sistemas reais. <br><br>  Sharding n√£o foi a √∫nica inova√ß√£o em Dgraph.  Todos os objetos receberam identificadores inteiros atribu√≠dos, eles foram classificados e salvos na forma de uma lista (lista de lan√ßamentos) para cruzar rapidamente essas listas posteriormente.  Isso permite que voc√™ filtre rapidamente durante a mesclagem, encontre links comuns etc. etc. As id√©ias dos mecanismos de pesquisa do Google tamb√©m s√£o √∫teis aqui. <br><br><h1>  Combinando todos os blocos OneBox atrav√©s do Plasma </h1><br>  <b>O dgraph do Google n√£o era um banco de dados</b> .  Este foi um dos subsistemas, que tamb√©m respondeu √†s atualiza√ß√µes.  Ent√£o ela precisava de indexa√ß√£o.  Eu tenho uma vasta experi√™ncia trabalhando com sistemas de indexa√ß√£o incremental em tempo real executando sob <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cafe√≠na</a> . <br><br>  Iniciei um projeto para unificar todo o OneBox nesse sistema de indexa√ß√£o de gr√°ficos, incluindo previs√£o do tempo, hor√°rios de voos, eventos e assim por diante.  Voc√™ pode n√£o conhecer o termo OneBox, mas definitivamente o viu - √© uma janela separada que aparece quando determinados tipos de consultas s√£o executados, nos quais o Google retorna informa√ß√µes mais ricas.  Para ver o OneBox em a√ß√£o, tente [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">clima em sf</a> ]. <br><br>  Anteriormente, cada OneBox trabalhava em um back-end aut√¥nomo e era suportado por diferentes grupos de desenvolvimento.  <b>Havia um rico conjunto de dados estruturados, mas as unidades OneBox n√£o trocavam dados entre si.</b>  Em primeiro lugar, back-end diferentes aumentaram os custos de m√£o-de-obra muitas vezes.  Em segundo lugar, a falta de compartilhamento de informa√ß√µes limitava a variedade de solicita√ß√µes √†s quais o Google poderia responder. <br><br>  Por exemplo, [eventos em SF] podem mostrar eventos e [clima em SF] pode mostrar o tempo.  Mas se [os eventos em SF] entendessem que estava chuvoso agora, voc√™ poderia filtrar ou classificar eventos por tipo ‚Äúdentro de casa‚Äù ou ‚Äúao ar livre‚Äù ( <i>talvez seja melhor ir ao cinema em vez de futebol sob chuva forte)</i> ) <br><br>  Com a ajuda da equipe da Metaweb, come√ßamos a converter todos esses dados para o formato SPO e index√°-los em um sistema.  Chamei-o de <b>Plasma, um mecanismo de indexa√ß√£o de gr√°ficos em tempo real</b> para servir o Dgraph. <br><br><h1>  Gerenciamento do Leapfrog </h1><br>  Como o Cerebro, o projeto Plasma recebeu poucos recursos, mas continuou a ganhar impulso.  No final, quando a ger√™ncia percebeu que os blocos OneBox eram inevitavelmente parte de nosso projeto, decidiu imediatamente colocar as <i>‚Äúpessoas certas‚Äù</i> para gerenciar o sistema gr√°fico.  No auge do jogo pol√≠tico, tr√™s l√≠deres foram substitu√≠dos, cada um deles com zero experi√™ncia em trabalhar com gr√°ficos. <br><br>  Durante esse salto do Dgraph, os gerentes de projeto da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Spanner</a> chamaram o Dgraph de <i>um</i> sistema <i>muito complexo</i> .  Para refer√™ncia, o Spanner √© um banco de dados SQL distribu√≠do mundialmente que precisa de seu pr√≥prio rel√≥gio GPS para garantir consist√™ncia global.  <i>A ironia disso ainda est√° soprando meu teto.</i> <br><br>  Dgraph foi cancelado, o plasma sobreviveu.  E, √† frente do projeto, eles colocaram uma nova equipe com um novo l√≠der, com uma hierarquia clara e se reportando ao CEO.  A nova equipe - com um entendimento insuficiente dos gr√°ficos e problemas relacionados - decidiu criar um subsistema de infraestrutura com base no √≠ndice de pesquisa do Google existente (como fiz no Cerebro).  Sugeri usar o sistema que j√° fiz para o Cerebro, mas ele foi rejeitado.  Modifiquei o Plasma para rastrear e expandir cada n√≥ de conhecimento em v√°rios n√≠veis, para que o sistema possa visualiz√°-lo como um documento da web.  Eles chamaram esse sistema de TS ( <i>abrevia√ß√£o</i> ). <br><br>  <b>Isso significava que o novo subsistema n√£o seria capaz de realizar associa√ß√µes profundas.</b>  Novamente, essa √© uma maldi√ß√£o que vejo em muitas empresas, porque os engenheiros come√ßam com a id√©ia errada de que "os gr√°ficos s√£o um problema simples que pode ser resolvido simplesmente construindo uma camada sobre outro sistema". <br><br>  Alguns meses depois, em maio de 2013, deixei o Google depois de trabalhar no Dgraph / Plasma por cerca de dois anos. <br><br><h1>  Posf√°cio </h1><br><ul><li>  Alguns anos depois, a se√ß√£o ‚ÄúInfraestrutura de pesquisa na Internet‚Äù foi renomeada para ‚ÄúInfraestrutura de pesquisa na Internet e gr√°fico de conhecimento‚Äù, e o l√≠der a quem uma vez mostrei √† Cerebro dirigiu a dire√ß√£o ‚ÄúGr√°fico de conhecimento‚Äù, informando sobre como eles pretendem substituir os sistemas simples. links de conhecimento azuis para responder √†s perguntas do usu√°rio diretamente o mais r√°pido poss√≠vel. <br></li><li>  Quando a equipe de Xangai que trabalhava na Cerebro estava perto de coloc√°-lo em produ√ß√£o, o projeto foi retirado deles e entregue √† divis√£o de Nova York.  No final, foi lan√ßado como Knowledge Strip.  Se voc√™ estiver procurando por [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">filmes de tom hanks</a> ], ver√° no topo.  Ele melhorou um pouco desde o primeiro lan√ßamento, mas ainda n√£o suporta o n√≠vel de filtragem e classifica√ß√£o estabelecido no Cerebro. <br></li><li>  Todos os tr√™s gerentes t√©cnicos que trabalharam no Dgraph (inclusive eu) acabaram saindo do Google.  At√© onde eu sei, o resto est√° trabalhando na Microsoft e no LinkedIn. <br></li><li>  Consegui receber duas promo√ß√µes no Google e deveria receber uma terceira quando sa√≠ da empresa como engenheiro de software s√™nior (Senior Software Engineer). <br></li><li>  A julgar por alguns rumores fragment√°rios, a vers√£o atual do TS est√° realmente muito pr√≥xima do design do sistema de gr√°ficos Cerebro, e cada sujeito, predicado e objeto tem um √≠ndice.  <b>Portanto, ela ainda sofre com o problema da profundidade da unifica√ß√£o.</b> <br></li><li>  Desde ent√£o, o plasma foi reescrito e renomeado, mas continua a funcionar como um sistema de indexa√ß√£o de gr√°ficos em tempo real para o TS.  Juntos, eles continuam postando e processando todos os dados estruturados no Google, incluindo o Gr√°fico de conhecimento. <br></li><li>  <b>A incapacidade do Google de fazer uni√µes profundas √© vis√≠vel em muitos lugares.</b>  Por exemplo, ainda n√£o vemos a troca de dados entre os blocos OneBox: [cidades com maior quantidade de chuva na √Åsia] n√£o fornece uma lista de cidades, embora todos os dados estejam na coluna de conhecimento (em vez disso, a p√°gina da web √© citada nos resultados da pesquisa);  [eventos em SF] n√£o podem ser filtrados pelo clima;  Os resultados [presidentes dos EUA] n√£o s√£o classificados, filtrados ou expandidos por outros fatos: seus filhos ou as escolas onde estudaram.  Acredito que essa foi uma das raz√µes para a descontinua√ß√£o do suporte do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Freebase</a> . </li></ul><br><h1>  Dgraph: Phoenix Bird </h1><br>  Dois anos depois de deixar o Google, decidi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">desenvolver o Dgraph</a> .  Em outras empresas, vejo a mesma indecis√£o em rela√ß√£o aos gr√°ficos que no Google.  Havia muitas solu√ß√µes inacabadas no espa√ßo gr√°fico, em particular, muitas solu√ß√µes personalizadas montadas √†s pressas sobre bancos de dados relacionais ou NoSQL, ou como um dos muitos recursos de bancos de dados de v√°rios modelos.  Se havia uma solu√ß√£o nativa, ela sofria de problemas de escalabilidade. <br><br>  Nada do que vi tinha uma hist√≥ria coerente com um design produtivo e escal√°vel.  <b>Criar um banco de dados de gr√°fico escal√°vel horizontalmente com jun√ß√µes de baixa lat√™ncia e profundidade arbitr√°ria √© uma tarefa extremamente dif√≠cil</b> , e eu queria ter certeza de que constru√≠mos o Dgraph corretamente. <br><br>  A equipe da Dgraph passou os √∫ltimos tr√™s anos n√£o apenas estudando minha pr√≥pria experi√™ncia, mas tamb√©m investindo muitos de seus esfor√ßos no design - criando um banco de dados de gr√°ficos que n√£o possui an√°logos no mercado.  Assim, as empresas t√™m a oportunidade de usar uma solu√ß√£o confi√°vel, escal√°vel e produtiva em vez de outra solu√ß√£o semi-acabada. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt440938/">https://habr.com/ru/post/pt440938/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt440922/index.html">Como o Level Flow funciona em Uncharted 4 e The Last Of Us</a></li>
<li><a href="../pt440924/index.html">Hist√≥ria do segundo lugar na Copa da AI russa 2018: CodeBall</a></li>
<li><a href="../pt440928/index.html">Determine sua idade biol√≥gica no perfil</a></li>
<li><a href="../pt440930/index.html">Realizei cem entrevistas, recusei-me a centenas de pessoas - e s√≥ ent√£o aprendi a entrevistar</a></li>
<li><a href="../pt440932/index.html">Um pouco sobre intelig√™ncia de neg√≥cios de TI</a></li>
<li><a href="../pt440940/index.html">Redux - revisando a l√≥gica e as a√ß√µes do redutor</a></li>
<li><a href="../pt440942/index.html">BYD anuncia crescimento de vendas de ve√≠culos el√©tricos plug√°veis</a></li>
<li><a href="../pt440944/index.html">Como escrever rapidamente um site ou aplicativo da Web e n√£o ser pego em colecionadores</a></li>
<li><a href="../pt440946/index.html">Rollup: voc√™ j√° pode criar aplicativos</a></li>
<li><a href="../pt440948/index.html">N√£o fique esperto com formul√°rios de login</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>