<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤴 📮 🛏️ Python中的DHCP + Mysql服务器 🔨 🚧 👨🏻‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="该项目的目的是： 



- 通过IPv4网络学习DHCP 
- 学习Python（仅是从零开始；） 
- 替换了原来的DB2DHCP服务器（我的叉子），在新的OS下组装起来越来越难。 是的，我不喜欢该二进制文件，无法“立即更改” 
- 获得可以使用订户的mac或一堆mac交换机+端口选择订户IP地...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Python中的DHCP + Mysql服务器</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445338/"><img src="https://habrastorage.org/webt/ju/n4/fb/jun4fbrj-eabxfgou112uxc5lac.png"><br><br> 该项目的目的是： <br><br><ul><li> 通过IPv4网络学习DHCP </li><li> 学习Python（仅是从零开始；） </li><li> 替换了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">原来的DB2DHCP</a>服务器（我的叉子），在新的OS下组装起来越来越难。 是的，我不喜欢该二进制文件，无法“立即更改” </li><li> 获得可以使用订户的mac或一堆mac交换机+端口选择订户IP地址的功能的DHCP服务器（选项82） </li><li> 写另一辆自行车（哦！这是我最喜欢的消遣） </li><li> 让Lyuli谈论他对Habrahabr的s眼（或最好邀请）；） </li></ul><br> 结果：它有效；）在FreeBSD和Ubuntu OS上测试。 从理论上讲，可以要求代码在任何操作系统下都可以工作，因为 代码中没有特定的绑定。 <br> 注意事项 还有很多。 <br><a name="habracut"></a><br> 链接到存储库，以使粉丝<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“动起来”</a> 。 <br><br> 安装，配置和使用“硬件研究”结果的过程要少得多，其次是有关DHCP协议的一些理论。 为了我自己。 对于这个故事；） <br><br><h1> 一点理论 </h1><br><h2> 什么是DHCP？ </h2><br> 这是一种网络协议，允许设备从DHCP服务器中找到其IP地址（以及其他参数，如网关，DNS等）。 数据包通过UDP交换。 请求网络参数时设备的一般操作原理如下： <br><br><ol><li> 设备（客户端）通过网络发出UDP广播请求（DHCPDISCOVER），请求为“嗯，有人，给我IP地址”。 通常（但并非总是），请求来自端口68（源），而目的地是端口67（目的地）。 一些设备还从端口67发送数据包。 在DHCPDISCOVER数据包内，包括客户端设备的MAC地址。 </li><li> 网络上所有（可能有多个）DHCP服务器的形式，是发送带有网络设置的DHCPDISCOVER DHCPOFFER语句的设备，它也通过网络广播该设备。 此数据包旨在提供给谁的标识将到达DHCPDISCOVER请求中较早提供的客户端的MAC地址。 </li><li> 客户端接收具有网络设置提议的数据包，选择最具吸引力的数据包（条件可能有所不同，例如，根据数据包传递的时间，中间路由的数量），并使DHCP服务器通过网络设置“正式请求” DHCPREQUEST。 在这种情况下，数据包将到达特定的DHCP服务器。 </li><li> 收到DHCPREQUEST的服务器发送DHCPACK数据包，在该数据包中它再次列出此客户端的网络设置 </li></ol><br><img src="https://habrastorage.org/webt/ki/vj/cn/kivjcno-qcqpx8jgqxra1rnspvi.png"><br><br> 此外，还有来自客户端的DHCPINFORM数据包，其目的是通知DHCP服务器“客户端处于活动状态”并使用发出的网络设置。 在此服务器的实现中，将忽略这些数据包。 <br><br><h2> 封包格式 </h2><br><br> 通常，以太网数据包帧如下所示： <br><br><img src="https://habrastorage.org/webt/x6/uj/n0/x6ujn0ood0nch96zosj6ldkjt4s.png"><br><br> 在我们的情况下，我们将仅考虑直接来自UDP数据包内容的数据，而不考虑OSI层协议标头，即DHCP结构： <br><br><h3>  DHCP发现 </h3><br> 因此，获取设备IP地址的过程始于DHCP客户端从端口68向255.255.255.255:67发送广播请求的事实。 在此程序包中，客户端包括其MAC地址以及希望从DHCP服务器接收的内容。 下表描述了包装的结构。 <br><br><div class="spoiler">  <b class="spoiler_title">DHCPDISCOVER数据包结构表</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left"> 包装位置 </td><td align="left"> 值名称 </td><td align="right"> 例子 </td><td align="center"> 投稿 </td><td align="center"> 字节数 </td><td align="left"> 解说 </td></tr><tr><td align="right">  1个 </td><td align="left"> 开机要求 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 消息类型。  1-从客户端到服务器的请求，2-从服务器到客户端的响应 </td></tr><tr><td align="right">  2 </td><td align="left"> 硬件类型 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 硬件地址的类型，在此协议中为1-MAC </td></tr><tr><td align="right">  3 </td><td align="left"> 硬件长度 </td><td align="right">  6 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 设备MAC地址长度 </td></tr><tr><td align="right">  4 </td><td align="left"> 啤酒花 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 中间路线数 </td></tr><tr><td align="right">  5 </td><td align="left"> 交易编号 </td><td align="right">  23：比照：de：1天 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 唯一交易标识符。 由客户端在请求操作开始时生成 </td></tr><tr><td align="right">  7 </td><td align="left"> 秒逝去 </td><td align="right">  0 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 从获取地址开始的时间（以秒为单位） </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp标志 </td><td align="right">  0 </td><td align="center"> 十六进制 </td><td align="right">  2 </td><td align="left"> 可以设置一些标志来指示协议参数 </td></tr><tr><td align="right">  11 </td><td align="left"> 客户端IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 客户端IP地址（如果有） </td></tr><tr><td align="right">  15 </td><td align="left"> 您的客户IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器建议的IP地址（如果有） </td></tr><tr><td align="right">  19 </td><td align="left"> 下一个服务器IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器IP地址（如果知道） </td></tr><tr><td align="right">  23 </td><td align="left"> 中继代理IP地址 </td><td align="right">  172.16.114.41 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 中继代理IP地址（例如，交换机） </td></tr><tr><td align="right">  27 </td><td align="left"> 客户端MAC地址 </td><td align="right">  14：d6：4d：a7：c9：55 </td><td align="center"> 十六进制 </td><td align="right">  6 </td><td align="left"> 数据包发送方（客户端）的MAC地址 </td></tr><tr><td align="right">  31 </td><td align="left"> 客户端硬件地址填充 </td><td align="right"></td><td align="center"> 十六进制 </td><td align="right">  10 </td><td align="left"> 预留的地方。 通常为零 </td></tr><tr><td align="right">  41 </td><td align="left"> 服务器主机名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  64 </td><td align="left">  DHCP服务器的名称。 通常不传送 </td></tr><tr><td align="right">  105 </td><td align="left"> 启动文件名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  128 </td><td align="left"> 启动期间无盘工作站使用的服务器上的文件名 </td></tr><tr><td align="right">  235 </td><td align="left"> 魔术饼干 </td><td align="right">  63：82：53：63 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left">  “魔术”数字，包括。 您可以确定此数据包属于DHCP协议 </td></tr><tr><td colspan="7" align="center">  DHCP选项。 可以按任何顺序进行 </td></tr><tr><td align="right">  236 </td><td align="left"> 选件编号 </td><td align="right">  53 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 选项53指定DHCP数据包的类型 <br><br>  1-DHCP发现 <br>  3-DHCP请求 <br>  2-DHCPOFFER <br>  5-DHCPACK <br>  8-DHCPINFORM </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  50 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 客户想要接收什么IP地址 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  172.16.134.61 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  55 </td><td align="center"></td><td align="right">  1个 </td><td rowspan="3" align="left"> 客户端请求的网络参数。 成分可能不同 <br><br>  01-网络掩码 <br>  03-网关 <br>  06-DNS <br>  oc-主机名 <br>  0f-网络域名 <br>  1c-广播请求的地址（广播） <br>  42-TFTP服务器名称 <br>  79-无类静态路由 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  8 </td><td align="center"></td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01：03：06：0c：0f：1c：42：79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  82 </td><td align="center"> 十二月 </td><td align="left"></td><td rowspan="3" align="left"> 选项82，其中转发器设备的MAC地址和一些其他值被传输。 <br><br> 最常见的是运行DHCP终端客户端的交换机端口，此选项“嵌入”了其他选项，第一个字节是“ suboption”的编号，第二个字节是其长度，然后是其值。 <br><br> 在这种情况下，在选项82中，子选项是嵌套的： <br> 代理电路ID = 00：04：00：01：00：04，其中最后两个字节是发出请求的DHCP客户端端口 <br><br> 代理远程ID = 00：06：c8：是：19：93：11：48-DHCP中继设备的MAC地址 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  18岁 </td><td align="center"> 十二月 </td><td align="left"></td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01:06 <br>  00：04：00：01：00：04 <br>  02:08 <br>  00：06：c8：是：19：93：11：48 </td><td align="center"> 十六进制 </td><td align="left"></td></tr><tr><td align="left"></td><td align="left"> 包装结束 </td><td align="right">  255 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td align="left">  255表示包装的结尾 </td></tr></tbody></table><br></div></div><br><h3>  DHCP优惠 </h3><br> 服务器一旦收到DHCPDISCOVER数据包，并且如果发现它可以向客户端提供所请求的内容，则对它形成响应-DHCPOFFER。 答案被发送到端口“从那里来”，广播，因为 目前，客户端还没有IP地址，因此，只有发送广播后，他才能接收数据包。 客户端通过该数据包内其地址处的MAC识别出该数据包是他的数据包，以及该客户在创建第一个数据包时生成的交易号。 <br><br><div class="spoiler">  <b class="spoiler_title">DHCPOFFER数据包结构表</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left"> 包装位置 </td><td align="left"> 价值名称（通用） </td><td align="right"> 例子 </td><td align="center"> 投稿 </td><td align="center"> 字节数 </td><td align="left"> 解说 </td></tr><tr><td align="right">  1个 </td><td align="left"> 开机要求 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 消息类型。  1-从客户端到服务器的请求，2-从服务器到客户端的响应 </td></tr><tr><td align="right">  2 </td><td align="left"> 硬件类型 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 硬件地址的类型，在此协议中为1-MAC </td></tr><tr><td align="right">  3 </td><td align="left"> 硬件长度 </td><td align="right">  6 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 设备MAC地址长度 </td></tr><tr><td align="right">  4 </td><td align="left"> 啤酒花 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 中间路线数 </td></tr><tr><td align="right">  5 </td><td align="left"> 交易编号 </td><td align="right">  23：比照：de：1天 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 唯一交易标识符。 由客户端在请求操作开始时生成 </td></tr><tr><td align="right">  7 </td><td align="left"> 秒逝去 </td><td align="right">  0 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 从获取地址开始的时间（以秒为单位） </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp标志 </td><td align="right">  0 </td><td align="center"> 十六进制 </td><td align="right">  2 </td><td align="left"> 可以将某些标志设置为协议参数的指示。 在这种情况下，0表示单播请求类型 </td></tr><tr><td align="right">  11 </td><td align="left"> 客户端IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 客户端IP地址（如果有） </td></tr><tr><td align="right">  15 </td><td align="left"> 您的客户IP地址 </td><td align="right">  172.16.134.61 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器建议的IP地址（如果有） </td></tr><tr><td align="right">  19 </td><td align="left"> 下一个服务器IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器IP地址（如果知道） </td></tr><tr><td align="right">  23 </td><td align="left"> 中继代理IP地址 </td><td align="right">  172.16.114.41 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 中继代理IP地址（例如，交换机） </td></tr><tr><td align="right">  27 </td><td align="left"> 客户端MAC地址 </td><td align="right">  14：d6：4d：a7：c9：55 </td><td align="center"> 十六进制 </td><td align="right">  6 </td><td align="left"> 数据包发送方（客户端）的MAC地址 </td></tr><tr><td align="right">  31 </td><td align="left"> 客户端硬件地址填充 </td><td align="right"></td><td align="center"> 十六进制 </td><td align="right">  10 </td><td align="left"> 预留的地方。 通常为零 </td></tr><tr><td align="right">  41 </td><td align="left"> 服务器主机名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  64 </td><td align="left">  DHCP服务器的名称。 通常不传送 </td></tr><tr><td align="right">  105 </td><td align="left"> 启动文件名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  128 </td><td align="left"> 启动期间无盘工作站使用的服务器上的文件名 </td></tr><tr><td align="right">  235 </td><td align="left"> 魔术饼干 </td><td align="right">  63：82：53：63 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left">  “魔术”数字，包括。 您可以确定此数据包属于DHCP协议 </td></tr><tr><td colspan="6" align="center">  DHCP选项。 可以按任何顺序进行 </td></tr><tr><td align="right">  236 </td><td align="left"> 选件编号 </td><td align="right">  53 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 选项53指定DHCP 2数据包的类型-DHCPOFFER </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  2 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 提供DHCP客户端网络掩码的选件 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  255.255.224.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  3 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 提供DHCP客户端默认网关的选件 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  172.16.12.1 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  6 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 向DHCP客户端提供DHCP的选项 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  8.8.8.8 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  51 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 发出的网络参数的生存时间（以秒为单位），之后DHCP客户端必须再次请求它们 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  86400 </td><td align="center"> 十二月 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  82 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 选项82，重复DHCPDISCOVER中的内容 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  18岁 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01：08：00：06：00 <br>  01：01：00：00：01 <br>  02：06：00：03：0f <br>  26：4天：ec </td><td align="center"> 十二月 </td><td align="right">  18岁 </td></tr><tr><td align="left"></td><td align="left"> 包装结束 </td><td align="right">  255 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td align="left">  255表示包装的结尾 </td></tr></tbody></table><br></div></div><br><h3>  DHCP请求 </h3><br> 客户端收到DHCPOFFER之后，它会形成一个包，其中包含对网络参数的请求，该请求不是发给网络中的所有DHCP服务器的，而是发给一个特定的服务器，它最喜欢“ DHCPOFFER”的提议。  “喜欢”的标准可以不同，并且取决于DHCP客户端的实现。 使用DHCP服务器的MAC地址指示请求的接收者。 另外，如果先前已收到服务器的IP地址，则客户端可以发送DHCPREQUEST数据包，而不必提前形成DHCPDISCOVER。 <br><br><div class="spoiler">  <b class="spoiler_title">DHCPREQUEST数据包结构表</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left"> 包装位置 </td><td align="left"> 价值名称（通用） </td><td align="right"> 例子 </td><td align="center"> 投稿 </td><td align="center"> 字节数 </td><td align="left"> 解说 </td></tr><tr><td align="right">  1个 </td><td align="left"> 开机要求 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 消息类型。  1-从客户端到服务器的请求，2-从服务器到客户端的响应 </td></tr><tr><td align="right">  2 </td><td align="left"> 硬件类型 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 硬件地址的类型，在此协议中为1-MAC </td></tr><tr><td align="right">  3 </td><td align="left"> 硬件长度 </td><td align="right">  6 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 设备MAC地址长度 </td></tr><tr><td align="right">  4 </td><td align="left"> 啤酒花 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 中间路线数 </td></tr><tr><td align="right">  5 </td><td align="left"> 交易编号 </td><td align="right">  23：比照：de：1天 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 唯一交易标识符。 由客户端在请求操作开始时生成 </td></tr><tr><td align="right">  7 </td><td align="left"> 秒逝去 </td><td align="right">  0 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 从获取地址开始的时间（以秒为单位） </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp标志 </td><td align="right">  8000 </td><td align="center"> 十六进制 </td><td align="right">  2 </td><td align="left"> 可以将某些标志设置为协议参数的指示。 在这种情况下，“广播” </td></tr><tr><td align="right">  11 </td><td align="left"> 客户端IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 客户端IP地址（如果有） </td></tr><tr><td align="right">  15 </td><td align="left"> 您的客户IP地址 </td><td align="right">  172.16.134.61 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器建议的IP地址（如果有） </td></tr><tr><td align="right">  19 </td><td align="left"> 下一个服务器IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器IP地址（如果知道） </td></tr><tr><td align="right">  23 </td><td align="left"> 中继代理IP地址 </td><td align="right">  172.16.114.41 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 中继代理IP地址（例如，交换机） </td></tr><tr><td align="right">  27 </td><td align="left"> 客户端MAC地址 </td><td align="right">  14：d6：4d：a7：c9：55 </td><td align="center"> 十六进制 </td><td align="right">  6 </td><td align="left"> 数据包发送方（客户端）的MAC地址 </td></tr><tr><td align="right">  31 </td><td align="left"> 客户端硬件地址填充 </td><td align="right"></td><td align="center"> 十六进制 </td><td align="right">  10 </td><td align="left"> 预留的地方。 通常为零 </td></tr><tr><td align="right">  41 </td><td align="left"> 服务器主机名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  64 </td><td align="left">  DHCP服务器的名称。 通常不传送 </td></tr><tr><td align="right">  105 </td><td align="left"> 启动文件名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  128 </td><td align="left"> 启动期间无盘工作站使用的服务器上的文件名 </td></tr><tr><td align="right">  235 </td><td align="left"> 魔术饼干 </td><td align="right">  63：82：53：63 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left">  “魔术”数字，包括。 您可以确定此数据包属于DHCP协议 </td></tr><tr><td colspan="6" align="center">  DHCP选项。 可以按任何顺序进行 </td></tr><tr><td align="right">  236 </td><td align="left"> 选件编号 </td><td align="right">  53 </td><td align="center"> 十二月 </td><td align="right">  3 </td><td rowspan="3" align="left"> 选项53指定DHCP 3数据包的类型-DHCPREQUEST </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  3 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  61 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 客户端ID：01（用于Ehernet）+客户端的MAC地址 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  7 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01：2c：ab：25：ff：72：a6 </td><td align="center"> 十六进制 </td><td align="right">  7 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  60 </td><td align="center"> 十二月 </td><td align="left"></td><td rowspan="3" align="left">  “供应商类别标识符”。 就我而言，报告了DHCP客户端的版本。 也许其他设备返回了其他内容。  Windows例如报告MSFT 5.0 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  11 </td><td align="center"> 十二月 </td><td align="left"></td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  udhcp 0.9.8 </td><td align="center"> 弦乐 </td><td align="left"></td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  55 </td><td align="center"></td><td align="right">  1个 </td><td rowspan="3" align="left"> 客户端请求的网络参数。 成分可能不同 <br><br>  01-网络掩码 <br>  03-网关 <br>  06-DNS <br>  oc-主机名 <br>  0f-网络域名 <br>  1c-广播请求的地址（广播） <br>  42-TFTP服务器名称 <br>  79-无类静态路由 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  8 </td><td align="center"></td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01：03：06：0c：0f：1c：42：79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  82 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 选项82，重复DHCPDISCOVER中的内容 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  18岁 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01：08：00：06：00 <br>  01：01：00：00：01 <br>  02：06：00：03：0f <br>  26：4天：ec </td><td align="center"> 十二月 </td><td align="right">  18岁 </td></tr><tr><td align="left"></td><td align="left"> 包装结束 </td><td align="right">  255 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td align="left">  255表示包装的结尾 </td></tr></tbody></table><br></div></div><br><h3>  DHCP确认 </h3><br> 为了确认DHCP服务器“是的，这是您的IP地址，我不会将其提供给其他任何人”这一事实的确认，从服务器到客户端都有DHCPACK格式的数据包。 它与其余发送广播的数据包相同。 虽然，在下面用Python实现的DHCP服务器的代码中，以防万一，我通过将数据包发送到特定的客户端IP（如果已知）来复制任何广播请求。 此外，DHCP服务器根本不在乎DHCPACK数据包是否已到达客户端。 如果客户端未收到DHCPACK，则过一会儿，它将重复DHCPREQUEST <br><br><div class="spoiler">  <b class="spoiler_title">DHCPACK数据包结构表</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left"> 包装位置 </td><td align="left"> 价值名称（通用） </td><td align="right"> 例子 </td><td align="center"> 投稿 </td><td align="center"> 字节数 </td><td align="left"> 解说 </td></tr><tr><td align="right">  1个 </td><td align="left"> 开机要求 </td><td align="right">  2 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 消息类型。  1-从客户端到服务器的请求，2-从服务器到客户端的响应 </td></tr><tr><td align="right">  2 </td><td align="left"> 硬件类型 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 硬件地址的类型，在此协议中为1-MAC </td></tr><tr><td align="right">  3 </td><td align="left"> 硬件长度 </td><td align="right">  6 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 设备MAC地址长度 </td></tr><tr><td align="right">  4 </td><td align="left"> 啤酒花 </td><td align="right">  1个 </td><td align="center"> 十六进制 </td><td align="right">  1个 </td><td align="left"> 中间路线数 </td></tr><tr><td align="right">  5 </td><td align="left"> 交易编号 </td><td align="right">  23：比照：de：1天 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 唯一交易标识符。 由客户端在请求操作开始时生成 </td></tr><tr><td align="right">  7 </td><td align="left"> 秒逝去 </td><td align="right">  0 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left"> 从获取地址开始的时间（以秒为单位） </td></tr><tr><td align="right">  9 </td><td align="left">  Bootp标志 </td><td align="right">  8000 </td><td align="center"> 十六进制 </td><td align="right">  2 </td><td align="left"> 可以将某些标志设置为协议参数的指示。 在这种情况下，“广播” </td></tr><tr><td align="right">  11 </td><td align="left"> 客户端IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 客户端IP地址（如果有） </td></tr><tr><td align="right">  15 </td><td align="left"> 您的客户IP地址 </td><td align="right">  172.16.134.61 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器建议的IP地址（如果有） </td></tr><tr><td align="right">  19 </td><td align="left"> 下一个服务器IP地址 </td><td align="right">  0.0.0.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 服务器IP地址（如果知道） </td></tr><tr><td align="right">  23 </td><td align="left"> 中继代理IP地址 </td><td align="right">  172.16.114.41 </td><td align="center"> 弦乐 </td><td align="right">  4 </td><td align="left"> 中继代理IP地址（例如，交换机） </td></tr><tr><td align="right">  27 </td><td align="left"> 客户端MAC地址 </td><td align="right">  14：d6：4d：a7：c9：55 </td><td align="center"> 十六进制 </td><td align="right">  6 </td><td align="left"> 数据包发送方（客户端）的MAC地址 </td></tr><tr><td align="right">  31 </td><td align="left"> 客户端硬件地址填充 </td><td align="right"></td><td align="center"> 十六进制 </td><td align="right">  10 </td><td align="left"> 预留的地方。 通常为零 </td></tr><tr><td align="right">  41 </td><td align="left"> 服务器主机名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  64 </td><td align="left">  DHCP服务器的名称。 通常不传送 </td></tr><tr><td align="right">  105 </td><td align="left"> 启动文件名 </td><td align="right"></td><td align="center"> 弦乐 </td><td align="right">  128 </td><td align="left"> 启动期间无盘工作站使用的服务器上的文件名 </td></tr><tr><td align="right">  235 </td><td align="left"> 魔术饼干 </td><td align="right">  63：82：53：63 </td><td align="center"> 十六进制 </td><td align="right">  4 </td><td align="left">  “魔术”数字，包括。 您可以确定此数据包属于DHCP协议 </td></tr><tr><td colspan="6" align="center">  DHCP选项。 可以按任何顺序进行 </td></tr><tr><td align="right">  236 </td><td align="left"> 选件编号 </td><td align="right">  53 </td><td align="center"> 十二月 </td><td align="right">  3 </td><td rowspan="3" align="left"> 选项53指定DHCP数据包类型5-DHCPACK </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  5 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  1个 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 提供DHCP客户端网络掩码的选件 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  255.255.224.0 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  3 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 提供DHCP客户端默认网关的选件 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  172.16.12.1 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  6 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 向DHCP客户端提供DHCP的选项 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  8.8.8.8 </td><td align="center"> 弦乐 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  51 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 发出的网络参数的生存时间（以秒为单位），之后DHCP客户端必须再次请求它们 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  4 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  86400 </td><td align="center"> 十二月 </td><td align="right">  4 </td></tr><tr><td align="left"></td><td align="left"> 选件编号 </td><td align="right">  82 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td rowspan="3" align="left"> 选项82，重复DHCPDISCOVER中的内容 </td></tr><tr><td align="left"></td><td align="left"> 选项长度 </td><td align="right">  18岁 </td><td align="center"> 十二月 </td><td align="right">  1个 </td></tr><tr><td align="left"></td><td align="left"> 期权价值 </td><td align="right">  01：08：00：06：00 <br>  01：01：00：00：01 <br>  02：06：00：03：0f <br>  26：4天：ec </td><td align="center"> 十二月 </td><td align="right">  18岁 </td></tr><tr><td align="left"></td><td align="left"> 包装结束 </td><td align="right">  255 </td><td align="center"> 十二月 </td><td align="right">  1个 </td><td align="left">  255表示包装的结尾 </td></tr></tbody></table><br></div></div><br><br><h1> 安装方式 </h1><br> 安装实际上包括安装作业所需的python模块。 假定已经安装和配置了MySQL。 <br><br><h2>  Freebsd </h2><br><pre>  pkg安装python3
 python3 -m确保
 pip3安装mysql连接器 </pre><br><h2> 的Ubuntu </h2><br><pre> 须藤apt-get install python3
须藤apt-get install pip3
 sudo pip3安装mysql连接器 </pre><br> 我们创建MySQL数据库，填写转储pydhcp.sql，配置配置文件。 <br><br><h1> 构型 </h1><br> 所有服务器设置均为xml文件格式。 参考文件： <br><br><pre>  &lt;？xml version =“ 1.0”？&gt;
 &lt;配置&gt;
     &lt;dhcpserver&gt;
	 &lt;host&gt; 0.0.0.0 &lt;/ host&gt;
         &lt;broadcast&gt; 255.255.255.255 &lt;/ broadcast&gt;
         &lt;DHCPServer&gt; 192.168.0.71 &lt;/ DHCPServer&gt;
	 &lt;LeaseTime&gt; 8600 &lt;/ LeaseTime&gt;
	 &lt;ThreadLimit&gt; 1 &lt;/ ThreadLimit&gt;
         &lt;defaultMask&gt; 255.255.255.0 &lt;/ defaultMask&gt;
         &lt;defaultRouter&gt; 192.168.0.1 &lt;/ defaultRouter&gt;
         &lt;defaultDNS&gt; 8.8.8.8 &lt;/ defaultDNS&gt;
     &lt;/ dhcpserver&gt;
     &lt;mysql&gt;
         &lt;host&gt;本地主机&lt;/ host&gt;
	 &lt;username&gt;测试&lt;/ username&gt;
	 &lt;password&gt;测试&lt;/ password&gt;
	 &lt;basename&gt; pydhcp &lt;/ basename&gt;
     &lt;/ mysql&gt;
     &lt;选项&gt;
        &lt;option&gt; option_82_hex：sw_port1：20:22 &lt;/ option&gt;       
        &lt;option&gt; option_82_hex：sw_port2：16:18 &lt;/ option&gt;       
        &lt;option&gt; option_82_hex：sw_mac：26：40 &lt;/ option&gt;
     &lt;/ options&gt;    
     &lt;查询&gt;
         &lt;offer_count&gt; 3 &lt;/ offer_count&gt;
	 &lt;offer_1&gt;从上位（mac）=上位（'{option_82_AgentRemoteId_hex}'）和上位（端口）=上位（'{option_82_AgentCircuitId_port_hex}'）的用户中选择ip，掩码，路由器和dns &lt;/ offer_1&gt;
         &lt;offer_2&gt;从上层（mac）=上层（'{sw_mac}'）和上层（端口）=上层（'{sw_port2}'）的用户中选择IP，掩码，路由器，dns &lt;/ offer_2&gt;
         &lt;offer_3&gt;从上位（mac）=上位（'{ClientMacAddress}'）的用户中选择IP，掩码，路由器，dns &lt;/ offer_3&gt;
	 &lt;history_sql&gt;插入到历史记录（id，dt，mac，ip，注释）值（null，now（），'{ClientMacAddress}'，'{RequestedIpAddress}'，'DHCPACK / INFORM'）&lt;/ history_sql&gt;
     &lt;/ query&gt;
 &lt;/ config&gt; </pre><br> 现在更详细地介绍标签： <br><br>  dhcpserver部分描述了启动服务器的基本设置，即： <br><ul><li> 主机-服务器在端口67上侦听的IP地址 </li><li> 广播-该IP是DHCPOFFER和DHCPACK的广播 </li><li>  DHCPServer-什么是DHCP服务器的IP </li><li> 颁发的IP地址的LeaseTime租赁时间 </li><li>  ThreadLimit-同时运行多少个线程来处理端口67上的传入UDP数据包。假定这将对高负载的项目有所帮助；） </li><li>  defaultMask，defaultRouter，defaultDNS-如果在数据库中找到IP，但默认未提供给订户，则为订户默认提供什么 </li></ul><br>  Mysql部分： <br><br> 主机，用户名，密码，基本名-一切都能说明一切。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHub上</a>发布的示例数据库结构 <br><br> 查询部分：本部分描述对OFFER / ACK的请求： <br><br><ul><li>  offer_count-请求的行数，返回的格式为ip，mask，router，dns </li><li>  offer_n是查询字符串。 如果退货为空，则执行以下报价请求 </li><li>  history_sql-例如，订户向“授权历史记录”的写入请求 </li></ul><br> 选项部分中的任何变量或DHCP协议中的选项都可以参与请求。 <br><br> 部分选项。 在这里，它已经变得更加有趣了。 在这里，我们可以创建变量，以便稍后在查询部分中使用。 <br><br> 例如： <br><br><pre><code class="plaintext hljs">option_82_hex:sw_port1:20:22</code> </pre> <br>  ，此行是将选项82的DHCP请求中出现的整行（十六进制格式）从20到22字节（包括20和22字节）的命令全部放入并放入新变量sw_port1（请求来自的交换机端口）中 <br><br><pre> <code class="plaintext hljs">option_82_hex:sw_mac:26:40</code> </pre> <br>  ，定义sw_mac变量，取26:40范围内的十六进制 <br><br> 通过使用-d开关启动服务器，可以查看可以在查询中使用的所有可能选项。 我们将看到类似以下日志的内容： <br><br><pre>  -DHCPINFORM数据包来自端口0025224ad764的67，b'\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a'，（'172.30.114.25'，68）
 {'ClientMacAddress'：'0025224ad764'，
  'ClientMacAddressByte'：b'\ x00％“ J \ xd7d”，
  'HType'：'以太网'，
  'HostName'：b'\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a'，
  'ReqListDNS'：是的，
  'ReqListDomainName'：是的，
  'ReqListPerfowmRouterDiscover'：是的，
  'ReqListRouter'：是的，
  'ReqListStaticRoute'：是的，
  'ReqListSubnetMask'：是的，
  'ReqListVendorSpecInfo'：43
  'RequestedIpAddress'：'0.0.0.0'，
  '供应商'：b'MSFT 5.0'，
  'chaddr'：'0025224ad764'，
  'ciaddr'：'172.30.128.13'，
  '标志'：b'\ x00 \ x00'，
  'giaddr'：'172.30.114.25'，
  'gpoz'：308，
  '海伦'：6，
  'hops'：1
  'htype'：'MAC'，
  'magic_cookie'：b'c \ x82Sc'，
  'op'：'DHCPINFORM'，
  'option12'：12，
  'option53'：53
  'option55'：55，
  'option60'：60，
  'option61'：61，
  'option82'：82，
  'option_82_byte'：b'\ x12 \ x01 \ x06 \ x00 \ x04 \ x00 \ x01 \ x00 \ x06 \ x02 \ x08 \ x00'
                    b'\ x06 \ x00 \ x1eX \ x9e \ xb2 \ xad'，
  'option_82_hex'：'12010600040001000602080006001e589eb2ad'，
  'option_82_len'：18，
  'option_82_str'：“ b'\\ x12 \\ x01 \\ x06 \\ x00 \\ x04 \\ x00 \\ x01 \\ x00 \\ x06 \\ x02 \\ x08 \\ x00 \\ x06 \\ x00 \ \ x1eX \\ x9e \\ xb2 \\ xad'“，
  “结果”：错误，
  '秒'：768，
  'siaddr'：'0.0.0.0'，
  'sw_mac'：'001e589eb2ad'，
  'sw_port1'：'06'，
  'xidbyte'：b'&lt;\ x89} \ x8c'，
  'xidhex'：'3c897d8c'，
  'yiaddr'：'0.0.0.0'} </pre><br> 因此，我们可以将任何变量包装在{}中，并将其用于SQL查询中。 <br><br> 让我们获取客户端接收IP地址的历史记录： <br><br><img src="https://habrastorage.org/webt/mc/le/bu/mclebuj5du2u4mjtlaf9-a2ibo0.png"><br><br><img src="https://habrastorage.org/webt/eo/1q/lt/eo1qltnt_1ewtf0uwkenwywme3m.png"><br><br><h1> 服务器启动 </h1><br>  ./pydhcpdb.py -d -c config.xml <br><br>  -d输出模式到DEBUG控制台 <br>  -c &lt;文件名&gt;配置文件 <br><br><h1> 汇报 </h1><br> 现在，更多有关在Python中实现服务器的信息。 这很痛苦。  Python是动态研究的。 很多时候都是这样的：“哇，我以某种方式做了什么。” 根本没有优化，之所以采用这种形式，主要是因为对python的开发经验很少。 我将在“代码”中介绍服务器实现的最有趣的时刻。 <br><br><h2>  XML配置文件解析器 </h2><br> 使用标准的Python模块xml.dom。 这似乎很简单，但是在实施过程中，使用此模块的网络上明显缺乏明智的文档和示例。 <br><br><pre> 树= minidom.parse（gconfig [“ config_file”]）
     mconfig = tree.getElementsByTagName（“ mysql”）
    对于mconfig中的elem：        
         gconfig [“ mysql_host”] = elem.getElementsByTagName（“主机”）[0] .firstChild.data      
         gconfig [“ mysql_username”] = elem.getElementsByTagName（“用户名”）[0] .firstChild.data      
         gconfig [“ mysql_password”] = elem.getElementsByTagName（“ password”）[0] .firstChild.data      
         gconfig [“ mysql_basename”] = elem.getElementsByTagName（“ basename”）[0] .firstChild.data      
     dconfig = tree.getElementsByTagName（“ dhcpserver”）
    对于dconfig中的elem：        
         gconfig [“ broadcast”] = elem.getElementsByTagName（“ broadcast”）[0] .firstChild.data      
         gconfig [“ dhcp_host”] = elem.getElementsByTagName（“主机”）[0] .firstChild.data      
         gconfig [“ dhcp_LeaseTime”] = elem.getElementsByTagName（“ LeaseTime”）[0] .firstChild.data      
         gconfig [“ dhcp_ThreadLimit”] = int（elem.getElementsByTagName（“ ThreadLimit”）[0] .firstChild.data）              
         gconfig [“ dhcp_Server”] = elem.getElementsByTagName（“ DHCPServer”）[0] .firstChild.data              
         gconfig [“ dhcp_defaultMask”] = elem.getElementsByTagName（“ defaultMask”）[0] .firstChild.data              
         gconfig [“ dhcp_defaultRouter”] = elem.getElementsByTagName（“ defaultRouter”）[0] .firstChild.data              
         gconfig [“ dhcp_defaultDNS”] = elem.getElementsByTagName（“ defaultDNS”）[0] .firstChild.data              
     qconfig = tree.getElementsByTagName（“查询”）
    对于qconfig中的elem：  
         gconfig [“ offer_count”] = elem.getElementsByTagName（“ offer_count”）[0] .firstChild.data                          
        对于范围内的num（int（gconfig [“ offer_count”]））：
             gconfig [“ offer _” + str（num + 1）] = elem.getElementsByTagName（“ offer _” + str（num + 1））[0] .firstChild.data      
         gconfig [“ history_sql”] = elem.getElementsByTagName（“ history_sql”）[0] .firstChild.data                          
    选项= tree.getElementsByTagName（“选项”）       
    对于选项中的元素：          
        节点= elem.getElementsByTagName（“选项”）
        对于节点中的选项：
             optionsMod.append（options.firstChild.data） </pre><br><h2> 多线程 </h2><br> 奇怪的是，Python中的多线程实现非常清晰，简单。 <br><br><pre>  def PacketWork（数据，地址）： 
 ...
 ＃对收到的包进行分析，并给出答案
 ...


而True：
     data，addr = udp_socket.recvfrom（1024）＃等待UDP数据包
     thread = threading.Thread（target = PacketWork，args =（data，addr，））。start（）＃-运行前面在后台使用参数定义的PacketWork函数
    而threading.active_count（）&gt; gconfig [“ dhcp_ThreadLimit”]：
        time.sleep（1）＃如果已运行的线程数大于设置中的线程数，请等待直到线程数减少 </pre><br><br><h2> 接收/发送DHCP数据包 </h2><br> 为了拦截通过网卡的UDP数据包，您需要“提升”套接字： <br><pre>  udp_socket = socket.socket（socket.AF_INET，socket.SOCK_DGRAM，socket.IPPROTO_UDP）
 udp_socket.bind（（gconfig [“ dhcp_host”]，67）） </pre><br> 标志是： <br><br><ul><li>  AF_INET-表示地址格式为IP：端口。 也许是AF_UNIX-地址由文件名给出。 </li><li>  SOCK_DGRAM-表示我们不接受“原始数据包”，而是已经通过防火墙，并且部分切断了数据包。 即 我们仅获得UDP数据包，而没有UDP数据包包装程序的“物理”组件。 如果使用SOCK_RAW标志，则仍然需要解析此“包装器”。 </li></ul><br> 发送数据包就像广播一样： <br><br><pre>  udp_socket.setsockopt（socket.SOL_SOCKET，socket.SO_BROADCAST，1）＃将套接字切换到广播模式
                     rz = udp_socket.sendto（packetack，（gconfig [“ broadcast”]，68） </pre><br>  ，然后到地址“软件包的来源”： <br><pre>  udp_socket.setsockopt（socket.SOL_SOCKET，socket.SO_REUSEADDR，1）＃将套接字切换为“许多侦听器”模式
                         rz = udp_socket.sendto（packetack，addr） </pre><br> 其中SOL_SOCKET表示设置选项的“协议级别”， <br><br>  SO_BROADCAST选项是“广播”头盔包 <br><br>  SO_REUSEADDR选项将套接字切换到多侦听器模式。 从理论上讲，在这种情况下是没有必要的，但是在我测试过的一台FreeBSD服务器上，如果没有该选项，代码将无法正常工作。 <br><br><h2>  DHCP报文解析 </h2><br> 这是我真正喜欢Python的地方。 事实证明，“框”使您可以轻松地处理字节码。 允许将其转换为十进制值，字符串和十六进制非常简单-即 我们实际上需要了解软件包的结构。 因此，例如，您可以获得十六进制的一个字节范围，而只有字节： <br><br><pre>  res [“ xidhex”] =数据[4：8] .hex（）
     res [“ xidbyte”] =数据[4：8] </pre><br>  ，将字节打包成一个结构： <br><br><pre>  res [“ flags”] =包（“ BB”，数据[10]，数据[11]） </pre><br> 从结构获取IP： <br><br><pre>  res [“ ciaddr”] = socket.inet_ntoa（pack（'BBBB'，data [12]，data [13]，data [14]，data [15]））; </pre><br><br> 反之亦然： <br><br><pre>  res = res + socket.inet_pton（socket.AF_INET，gconfig [“ dhcp_Server”]） </pre><br> 就这些;） </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN445338/">https://habr.com/ru/post/zh-CN445338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN445326/index.html">无情的自动化。 导演剪辑</a></li>
<li><a href="../zh-CN445328/index.html">重新思考儿童机器人</a></li>
<li><a href="../zh-CN445330/index.html">Java中的密码学。 签名班</a></li>
<li><a href="../zh-CN445334/index.html">我们有DevOps。 让我们解雇所有测试人员</a></li>
<li><a href="../zh-CN445336/index.html">FlexiRemap®与RAID</a></li>
<li><a href="../zh-CN445340/index.html">使用云分析仪提高网络安全性</a></li>
<li><a href="../zh-CN445344/index.html">OpenVox统一通信平台</a></li>
<li><a href="../zh-CN445346/index.html">如何编写错误的API</a></li>
<li><a href="../zh-CN445348/index.html">SNA Hackathon 2019：简化体系结构-简化功能</a></li>
<li><a href="../zh-CN445350/index.html">Sonata-SIP设置服务器</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>