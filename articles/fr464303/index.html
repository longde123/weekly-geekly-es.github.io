<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèª üõÄüèº ü§ö Donn√©es de s√©ries chronologiques dans un SGBD relationnel. Extensions TimescaleDB et PipelineDB pour PostgreSQL üåí üñïüèª üöµüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les donn√©es de s√©rie chronologique ou les s√©ries chronologiques sont des donn√©es qui changent au fil du temps. Les cotations de devises, la t√©l√©m√©trie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Donn√©es de s√©ries chronologiques dans un SGBD relationnel. Extensions TimescaleDB et PipelineDB pour PostgreSQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/464303/">  Les donn√©es de s√©rie chronologique ou les s√©ries chronologiques sont des donn√©es qui changent au fil du temps.  Les cotations de devises, la t√©l√©m√©trie des mouvements de transport, les statistiques d'acc√®s au serveur ou la charge CPU sont des donn√©es de s√©ries chronologiques.  Les stocker n√©cessite des outils sp√©cifiques - des bases de donn√©es temporelles.  Il existe des dizaines d'outils, par exemple InfluxDB ou ClickHouse.  Mais m√™me les meilleures solutions de stockage de s√©ries chronologiques pr√©sentent des inconv√©nients.  Tous les stockages de s√©ries chronologiques sont de bas niveau, adapt√©s uniquement aux donn√©es de s√©ries chronologiques, et l'ex√©cution et l'injection dans la pile actuelle sont co√ªteuses et douloureuses. <br><br><img src="https://habrastorage.org/webt/sx/9x/bz/sx9xbzv26lix6lh-frspdsopknw.jpeg"><br><br>  Mais, si vous avez une pile PostgreSQL, vous pouvez oublier InfluxDB et toutes les autres bases de donn√©es temporelles.  Installez deux extensions, TimescaleDB et PipelineDB, et stockez, traitez et analysez les donn√©es de s√©ries chronologiques directement dans l'√©cosyst√®me PostgreSQL.  Sans l'introduction de solutions tierces, sans les inconv√©nients des stockages temporels et sans les probl√®mes de leur ex√©cution.  Quelles sont ces extensions, quels sont leurs avantages et leurs capacit√©s, dira <b>Ivan Muratov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">binakot</a> )</b> - le chef du d√©partement de d√©veloppement de la "First Monitoring Company". <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3WkNp7mllv0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2>  Que sont les donn√©es de s√©ries chronologiques ou les s√©ries chronologiques? </h2><br><blockquote>  Ce sont des donn√©es sur le processus qui sont collect√©es √† diff√©rents moments de sa vie. </blockquote><br>  Par exemple, l'emplacement de la voiture: vitesse, coordonn√©es, direction ou utilisation des ressources sur le serveur avec des donn√©es sur la charge du processeur, la RAM utilis√©e et l'espace disque libre. <br><br>  Les s√©ries chronologiques ont plusieurs caract√©ristiques. <br><br><ul><li>  Dans une <b>sangle de fixation</b> .  Tout enregistrement de s√©rie chronologique poss√®de un champ avec un horodatage auquel la valeur a √©t√© enregistr√©e. <br></li><li>  <b>Les caract√©ristiques du processus, appel√©es niveaux de la s√©rie</b> : vitesse, coordonn√©es, donn√©es de charge. <br></li><li>  Presque toujours avec de telles donn√©es, elles fonctionnent <b>en mode ajout uniquement</b> .  Cela signifie que les nouvelles donn√©es ne remplacent pas les anciennes.  Seules les donn√©es obsol√®tes sont supprim√©es. <br></li><li>  <b>Les inscriptions ne sont pas consid√©r√©es s√©par√©ment les unes des autres</b> .  Les donn√©es ne sont utilis√©es que collectivement pour des fen√™tres temporelles, des intervalles ou des p√©riodes. <br></li></ul><br><h3>  Solutions de stockage populaires </h3><br>  Le graphique que j'ai pris de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">db-engines.com</a> montre la popularit√© de divers mod√®les de stockage au cours des deux derni√®res ann√©es. <br><br><img src="https://habrastorage.org/webt/w2/wf/_u/w2wf_uryfor_djey8enzmrskywo.jpeg"><br><br>  La premi√®re place est occup√©e par les stockages de s√©ries chronologiques, en second lieu - les bases de donn√©es graphiques, puis - les bases de donn√©es de valeurs-cl√©s et relationnelles.  La popularit√© des r√©f√©rentiels sp√©cialis√©s est associ√©e √† une croissance intensive de l'int√©gration des technologies de l'information: Big Data, r√©seaux sociaux, IoT, surveillance des infrastructures √† forte charge.  En plus des donn√©es commerciales utiles, m√™me les journaux et les mesures prennent une √©norme quantit√© de ressources. <br><br><h3>  Solutions de stockage populaires pour les donn√©es de s√©ries chronologiques </h3><br>  Le graphique montre des solutions sp√©cialis√©es pour stocker des donn√©es de s√©ries chronologiques.  L'√©chelle est logarithmique. <br><br><img src="https://habrastorage.org/webt/ny/bz/6_/nybz6_-_3ce7t0y7xre1oxkbks8.jpeg"><br><br>  Leader stable InfluxDB.  Tous ceux qui ont rencontr√© des donn√©es de s√©ries chronologiques ont entendu parler de ce produit.  Mais le graphique montre une multiplication par dix de TimescaleDB - une extension du SGBD relationnel se bat pour une place sous le soleil parmi les produits initialement d√©velopp√©s dans le cadre de la s√©rie chronologique. <br><br><blockquote>  PostgreSQL n'est pas seulement une bonne base de donn√©es, mais aussi une plate-forme extensible pour d√©velopper des solutions sp√©cialis√©es. </blockquote><br><h2>  Postgres, Postgis et TimescaleDB </h2><br>  La First Monitoring Company surveille le mouvement des v√©hicules √† l'aide de satellites.  Nous suivons 20 000 v√©hicules et stockons les donn√©es de mouvement pendant deux ans.  Au total, nous avons 10 To de donn√©es de t√©l√©m√©trie actuelles.  En moyenne, chaque v√©hicule envoie 5 enregistrements de t√©l√©m√©trie par minute en conduisant.  Les donn√©es sont envoy√©es via un √©quipement de navigation √† nos serveurs t√©l√©matiques.  Ils re√ßoivent 500 paquets de navigation par seconde. <br><br>  Il y a quelque temps, nous avons d√©cid√© de mettre √† niveau globalement l'infrastructure et de passer d'un monolithe √† des microservices.  Nous avons appel√© le nouveau syst√®me Waliot, et il est d√©j√† en production - 90% de tous les v√©hicules y sont transf√©r√©s. <br><br>  Beaucoup de choses ont chang√© dans l'infrastructure, mais le lien central est rest√© inchang√© - il s'agit de la base de donn√©es PostgreSQL.  Nous travaillons maintenant sur la version 10 et nous nous pr√©parons √† passer √† 11. En plus de PostgreSQL, en tant que stockage principal, dans la pile, nous utilisons PostGIS pour le calcul g√©ospatial et TimescaleDB pour stocker un large √©ventail de donn√©es de s√©ries chronologiques. <br><br><h3>  Pourquoi PostgreSQL? </h3><br>  Pourquoi essayons-nous d'utiliser une base de donn√©es relationnelle pour stocker des s√©ries chronologiques, plut√¥t que des solutions sp√©cialis√©es <s>ClickHouse</s> pour ce type de donn√©es?  Parce que dans le contexte de l'expertise accumul√©e et des impressions de travailler avec PostgreSQL, nous ne voulons pas utiliser une solution inconnue comme stockage principal. <br><br><blockquote>  Passer √† une nouvelle solution est un risque. </blockquote><br>  Il existe de nombreuses solutions sp√©cialis√©es pour le stockage et le traitement des donn√©es de s√©ries chronologiques.  La documentation n'est pas toujours suffisante et une large s√©lection de solutions n'est pas toujours bonne.  Il semble que les d√©veloppeurs de chaque nouveau produit souhaitent tout √©crire √† partir de z√©ro, car quelque chose n'√©tait pas agr√©able dans la solution pr√©c√©dente.  Pour comprendre ce qui n'aimait pas exactement, vous devez rechercher des informations, analyser et comparer.  Une grande vari√©t√© de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sommets</a> , de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">notes</a> et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comparaisons est</a> plut√¥t effrayant que motivant pour essayer quelque chose.  Vous devrez passer beaucoup de temps √† essayer toutes les solutions par vous-m√™me.  Nous ne pouvons pas nous permettre d'adapter une seule solution pendant plusieurs mois.  C'est une t√¢che difficile et le temps pass√© ne sera jamais payant.  Par cons√©quent, nous avons choisi des extensions pour PostgreSQL. <br><br>  Pendant la phase de d√©veloppement de l'infrastructure Waliot, nous avons consid√©r√© InfluxDB comme le principal r√©f√©rentiel de t√©l√©m√©trie.  Mais quand je suis tomb√© sur TimescaleDB et que j'ai effectu√© des tests, il n'y avait pas de questions sur le choix.  PostgreSQL avec l'extension TimescaleDB vous permet d'utiliser d'autres extensions dans le m√™me stockage PostGIS ou PipelineDB.  Nous n'avons pas besoin d'extraire des donn√©es, de les transformer, d'effectuer des analyses et de les transf√©rer sur le r√©seau.  Tout se trouve sur un serveur ou dans un syst√®me en cluster - les donn√©es n'ont pas besoin d'√™tre gliss√©es.  Tous les calculs sont effectu√©s au m√™me niveau. <br><br>  R√©cemment, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nikolay Samokhvalov</a> , l'auteur du compte postgresmen, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√© un lien</a> vers un article int√©ressant sur l'utilisation de SQL pour le streaming de donn√©es.  Cinq des six auteurs de l'article participent au d√©veloppement de divers produits Apache et travaillent avec le traitement en continu.  Par cons√©quent, l'article mentionne Apache Spark, Apache Flink, Apache Beam, Apache Calcite et KSQL de Confluent. <br><br>  Mais pas l'article lui-m√™me n'est int√©ressant, mais le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sujet sur Hacker News</a> , dans lequel il est discut√©.  L'auteur du sujet √©crit que, sur la base de l'article, il a impl√©ment√© presque toutes les id√©es bas√©es sur PostgreSQL 11. Il a utilis√© des extensions CitusDB pour la mise √† l'√©chelle horizontale et le partage, PipelineDB pour le calcul de flux et les vues mat√©rialis√©es, TimescaleDB pour le stockage des donn√©es de s√©ries chronologiques et la coupe.  Il utilise √©galement plusieurs wrappers de donn√©es √©trang√®res. <br><br><blockquote>  Un m√©lange fou de PostgreSQL et de ses extensions confirme une fois de plus que PostgreSQL n'est pas seulement un SGBD - c'est une plate-forme. </blockquote><br>  Et quand le stockage enfichable sera livr√© ... Ugh! <br><br>  Ironiquement, lors de la recherche des solutions, nous avons trouv√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Outflux</a> , le d√©veloppement de l'√©quipe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TimescaleDB</a> , qu'ils ont publi√© le 1er avril.  Que pensez-vous qu'elle fait?  Ceci est un utilitaire pour migrer d'InfluxDB vers TimescaleDB en une seule commande ... <br><br><h3>  Battage publicitaire Postgres! </h3><br>  Ne sous-estimez pas le pouvoir du battage m√©diatique!  Nous plaisantons souvent que ¬´le d√©veloppement est motiv√© par le battage m√©diatique¬ª, car il influe sur nos perceptions des composants de r√©glage et d'infrastructure.  Chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++,</a> nous discutons beaucoup de PostgreSQL, ClickHouse, Tarantool - ce sont des d√©veloppements hype.  Ne dites simplement pas que cela n'affecte pas vos pr√©f√©rences et le choix des solutions pour l'infrastructure ... Bien s√ªr, ce n'est pas le facteur principal, mais y a-t-il un effet? <br><br>  Je travaille avec PostgreSQL depuis 5 ans.  J'aime cette solution.  Il r√©sout presque toutes mes t√¢ches en un rien de temps.  Chaque fois que quelque chose tournait mal avec cette base, mes mains tordues √©taient √† bl√¢mer.  Par cons√©quent, le choix √©tait pr√©d√©termin√©. <br><br><h2>  TimescaleDB VS PipelineDB </h2><br>  Passons aux extensions TimescaleDB et PipelineDB.  Que disent leurs cr√©ateurs des extensions? <br><br>  <b>TimescaleDB est une base de donn√©es de s√©ries chronologiques</b> open source optimis√©e pour une insertion rapide et des requ√™tes complexes. <br><br>  <b>PipelineDB</b> est une extension hautes performances con√ßue pour ex√©cuter des requ√™tes SQL continues <b>pour les donn√©es de s√©ries chronologiques</b> . <br><br>  En plus de travailler avec des donn√©es de s√©ries chronologiques, ils ont une histoire similaire.  Timescale a √©t√© fond√©e en 2015 et Pipeline en 2013. Les premi√®res versions de travail sont apparues respectivement en 2017 et 2015.  Il a fallu deux ans aux √©quipes pour lib√©rer la fonctionnalit√© minimale.  Les versions de production des deux extensions ont eu lieu en octobre dernier avec une diff√©rence d'une semaine.  Apparemment, press√©s les uns apr√®s les autres. <br><br>  GitHub a un tas d'√©toiles et de fourchettes, qui, comme d'habitude, ne sont pas un seul commit.  C'est comme √ßa que l'Open Source fonctionne, il n'y a rien √† faire.  Mais il y a beaucoup d'√©toiles, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TimescaleDB a</a> plus que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PipelineDB</a> , et m√™me plus que PostgreSQL lui-m√™me. <br><br>  Les extensions semblent √™tre similaires, mais elles se positionnent diff√©remment. <br><br>  <b>TimescaleDB</b> pr√©tend avoir ins√©r√© des millions d'enregistrements par seconde et stock√© des centaines de milliards de lignes et des dizaines de t√©raoctets de donn√©es.  L'extension est plus rapide que InfluxDB, Cassandra, MongoDB ou vanilla PostgreSQL.  Prise en charge des outils de r√©plication et de sauvegarde en streaming.  TimescaleDB est une extension, pas un fork de PostgreSQL. <br><br>  <b>PipelineDB</b> stocke uniquement le r√©sultat des calculs de streaming, sans avoir besoin de stocker des donn√©es brutes pour leurs calculs.  L'extension est capable d'agr√©gation continue sur des flux de donn√©es en temps r√©el, se combinant avec des tables conventionnelles pour des calculs dans le contexte d'un domaine.  PipelineDB est une extension, pas une fourchette, mais au d√©part c'√©tait une fourchette. <br><br><h2>  Timescaledb </h2><br>  Maintenant en d√©tail sur les extensions.  Commen√ßons par TimescaleDB.  Je travaille avec lui depuis pr√®s de 2 ans.  Faites-le glisser en production avant la version finale.  Examinons des exemples d'application. <br><br>  <b>Stockage des m√©triques d'infrastructure</b> .  Nous avons des mesures de consommation des ressources du conteneur Docker, du temps de validation des mesures, de l'identifiant du conteneur et des champs de consommation des ressources, par exemple, de la m√©moire libre.  Nous devons afficher des statistiques pour tous les conteneurs avec une quantit√© moyenne de fen√™tres de m√©moire libres pendant 10 secondes.  La requ√™te que vous voyez r√©sout ce probl√®me et TimescaleDB peut √™tre utilis√© comme r√©f√©rentiel pour les m√©triques d'infrastructure. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> time_bucket(<span class="hljs-string"><span class="hljs-string">'10 seconds'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">period</span></span>, container_id, <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(free_mem) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> metrics <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> &lt; <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>() - <span class="hljs-built_in"><span class="hljs-built_in">interval</span></span> <span class="hljs-string"><span class="hljs-string">'10 minutes'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">period</span></span>, container_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">period</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>, container_id;</code> </pre> <br><pre> <code class="plaintext hljs">period | container_id | avg -----------------------+--------------+--- 2019-06-24 12:01:00+00 | 16 | 72202 2019-06-24 12:01:00+00 | 73 | 837725 2019-06-24 12:01:00+00 | 96 | 412237 2019-06-24 12:00:50+00 | 16 | 1173393 2019-06-24 12:00:50+00 | 73 | 90104 2019-06-24 12:00:50+00 | 96 | 784596</code> </pre> <br>  <b>Pour les calculs</b> .  Nous devons calculer le nombre de camions qui ont quitt√© Krasnodar et leur tonnage total par jour. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> time_bucket(<span class="hljs-string"><span class="hljs-string">'1 day'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">day</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> trucks_exiting, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(weight) / <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tonnage <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> vehicles <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> cities <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> cities.name = <span class="hljs-string"><span class="hljs-string">'Krasnodar'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ST_Within(last_location, ST_Polygon(cities.geom, <span class="hljs-number"><span class="hljs-number">4326</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> ST_Within(current_location, ST_Polygon(cities.geom, <span class="hljs-number"><span class="hljs-number">4326</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">day</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">day</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> <br>  Il utilise √©galement des fonctions de l'extension PostGIS pour calculer le transport qui a quitt√© la ville, plut√¥t que de simplement s'y d√©placer. <br><br>  <b>Surveillance du taux de change</b> .  Le troisi√®me exemple concerne les crypto-monnaies.  La demande vous permet d'afficher l'√©volution du prix d'Ethereum par rapport au Bitcoin et au dollar am√©ricain au cours des 2 derni√®res semaines par jour. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> time_bucket(<span class="hljs-string"><span class="hljs-string">'14 days'</span></span>, c.time) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">period</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">last</span></span>(c.closing_price, c.time) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> closing_price_btc, <span class="hljs-keyword"><span class="hljs-keyword">last</span></span>(c.closing_price, c.time) * <span class="hljs-keyword"><span class="hljs-keyword">last</span></span>(b.closing_price, c.time) filter (<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> b.currency_code = <span class="hljs-string"><span class="hljs-string">'USD'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> closing_price_usd <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> crypto_prices c <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> btc_prices b <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> time_bucket(<span class="hljs-string"><span class="hljs-string">'1 day'</span></span>, c.time) = time_bucket(<span class="hljs-string"><span class="hljs-string">'1 day'</span></span>, b.time) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> c.currency_code = <span class="hljs-string"><span class="hljs-string">'ETH'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">period</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">period</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre> <br>  C'est tout de m√™me clair et pratique pour nous SQL. <br><br><h3>  Qu'est-ce qui est si cool avec TimescaleDB? </h3><br>  Pourquoi ne pas utiliser les outils de partitionnement de table int√©gr√©s?  Et pourquoi s'emb√™ter √† casser des tables?  La r√©ponse √©vidente est la <b>vitesse d'insertion dans de telles bases de donn√©es</b> .  Le graphique montre les mesures r√©elles du taux d'insertion du nombre de lignes par seconde entre la table vanilla r√©guli√®re PostgreSQL 10 sans sectionnement et l'hypertable TimescaleDB. <br><br><img src="https://habrastorage.org/webt/gq/ln/xd/gqlnxdxeupbqkf_i-wdeihs0zlq.jpeg"><br><br>  Cette r√©f√©rence √©crit 1 milliard de lignes sur une machine, simulant un sc√©nario de collecte de m√©triques de l'infrastructure.  L'enregistrement contient le temps, l'identifiant du composant d'infrastructure et 10 mesures.  La r√©f√©rence a √©t√© ex√©cut√©e sur Azure VM avec 8 c≈ìurs et 28 gigaoctets de RAM, ainsi que des disques SSD r√©seau.  L'insertion a √©t√© effectu√©e par lots de 10 000 enregistrements. <br><br>  D'o√π vient cette d√©gradation des performances de PostgreSQL?  Parce que lorsque vous ins√©rez, vous devez √©galement mettre √† jour les index de table.  Quand ils ne rentrent pas dans le cache, nous commen√ßons √† charger des disques.  Le partitionnement r√©sout ce probl√®me si les index de la section dans laquelle nous ins√©rons les donn√©es sont plac√©s dans la RAM. <br><br>  Regardons le tableau suivant.  Cela compare le syst√®me de partitionnement d√©claratif int√©gr√© √† PostgreSQL 10 et l'hyper table TimescaleDB.  Sur l'axe horizontal, le nombre de sections. <br><br><img src="https://habrastorage.org/webt/kd/dz/xd/kddzxdttzspi9peoiriem7sipms.jpeg"><br><br>  Dans TimescaleDB, la d√©gradation est n√©gligeable avec l'augmentation des sections.  Les d√©veloppeurs d'extensions affirment qu'ils s'en sortent bien avec 10 000 sections dans une seule instance PostgreSQL. <br><br>  Dans PostgreSQL, l'impl√©mentation native se d√©grade consid√©rablement apr√®s 3000. En g√©n√©ral, le partitionnement d√©claratif dans PostgreSQL est un grand pas en avant, mais il ne fonctionne bien que pour les tables avec moins de charge.  Par exemple, pour les biens, les acheteurs et d'autres entit√©s de domaine qui n'entrent pas dans le syst√®me de mani√®re aussi intensive que les m√©triques. <br><br>  Dans les versions 11 et 12 de PostgreSQL, la prise en charge du partitionnement natif appara√Ætra et vous pouvez essayer d'ex√©cuter des tests comparatifs pour les donn√©es de s√©ries chronologiques avec de nouvelles versions.  Mais il me semble que TimescaleDB est encore mieux.  Tous les benchmarks de TimescaleDB peuvent √™tre trouv√©s sur leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> et essayer. <br><br><h3>  Caract√©ristiques cl√©s </h3><br>  J'esp√®re que vous avez d√©j√† un int√©r√™t pour l'extension.  Passons en revue les principales fonctionnalit√©s de TimescaleDB pour consolider ce sentiment. <br><br>  <b>Partitionnement √† travers des hypertables</b> .  TimescaleDB utilise le terme ¬´hypertable¬ª pour les tables auxquelles la fonction create_hypertable () a √©t√© appliqu√©e.  Apr√®s cela, la table deviendra le parent de toutes les sections h√©rit√©es - morceaux.  La table parent elle-m√™me ne contiendra aucune donn√©e, mais sera un point d'entr√©e pour toutes les requ√™tes et un mod√®le lors de la cr√©ation automatique de nouvelles sections.  Toutes les sections ne sont pas stock√©es dans le sch√©ma principal de vos donn√©es, mais dans un sch√©ma sp√©cial.  Ceci est pratique car nous ne voyons pas des milliers de ces sections dans le sch√©ma de donn√©es. <br><br>  <b>L'extension est int√©gr√©e dans le planificateur et l'ex√©cuteur de requ√™tes</b> .  Gr√¢ce √† des crochets sp√©ciaux dans PostgreSQL, TimescaleDB comprend quand il acc√®de √† un hypertable.  TimescaleDB analyse la requ√™te et redirige les requ√™tes uniquement vers les sections n√©cessaires en fonction des conditions sp√©cifi√©es dans l'appel SQL lui-m√™me.  Cela vous permet de parall√©liser le travail avec des sections lors de l'extraction d'une quantit√© importante de donn√©es. <br><br>  <b>L'extension n'impose pas de restrictions sur SQL</b> .  Vous pouvez utiliser librement les unions, les agr√©gats, les fonctions de fen√™tre, les CTE et les index suppl√©mentaires.  Si vous avez vu la liste des restrictions pour le syst√®me de partitionnement int√©gr√©, cela devrait vous plaire. <br><br>  <b>Fonctions suppl√©mentaires utiles</b> sp√©cifiques aux donn√©es de s√©ries chronologiques: <br><br><ul><li>  ¬´Time_bucket¬ª - ¬´date_trun¬ª d'une personne en bonne sant√©; <br></li><li>  histogrammes - remplir les intervalles manqu√©s en utilisant l'interpolation ou la derni√®re valeur connue; <br></li><li>  travailleur en arri√®re-plan - services qui vous permettent d'effectuer des op√©rations en arri√®re-plan: nettoyage d'anciennes sections, r√©organisation. <br></li></ul><br>  <b>TimescaleDB vous permet de rester dans le puissant √©cosyst√®me PostgreSQL</b> .  Cette extension ne casse pas PostgreSQL, donc toutes les solutions de haute disponibilit√©, les syst√®mes de sauvegarde, les outils de surveillance continueront de fonctionner.  TimescaleDB est ami avec Grafana, P√©riscope, Prom√©th√©e, Telegraf, Zabbix, Kubernetes, Kafka, Seeq, JackDB. <br><br>  <b>Grafana prend</b> d√©j√† en charge nativement <b>TimescaleDB</b> comme source de donn√©es.  Grafana comprend d√®s le d√©part que PostscreSQL a TimescaleDB.  Le g√©n√©rateur de requ√™tes de Grafana sur les tableaux de bord comprend des fonctions TimescaleDB suppl√©mentaires, telles que ¬´time_bucket¬ª, ¬´first¬ª, ¬´last¬ª.  Vous pouvez cr√©er des graphiques directement √† partir de la base de donn√©es relationnelle avec ces fonctions de s√©rie temporelle sans requ√™tes gigantesques. <br><br>  <b>Prometheus dispose d'</b> un adaptateur qui vous permet d'en fusionner les donn√©es et d'utiliser TimescaleDB comme un entrep√¥t de donn√©es fiable.  Utilisez un adaptateur pour ne pas stocker de donn√©es dans Prometheus pendant des ann√©es. <br><br>  Il existe √©galement un <b>plugin Telegraf</b> .  La solution vous permet de supprimer compl√®tement Prometheus.  Les donn√©es d'infrastructure sont imm√©diatement transf√©r√©es √† TimescaleDB et lues via Telegraf. <br><br><h3>  Licences et actualit√©s </h3><br>  Il n'y a pas si longtemps, la soci√©t√© est pass√©e √† un nouveau mod√®le de licence.  La plupart du code est sous licence Apache 2.0.  Une petite partie est gratuite, mais sous licence TSL. <br><br>  Il existe une version Enterprise avec une licence commerciale.  Ne vous inqui√©tez pas, pas tous les goodies de la version Enterprise.  Fondamentalement, il existe une automatisation telle que la suppression automatique des morceaux obsol√®tes, qui peut √™tre effectu√©e via un simple "cron" et des choses similaires. <br><br>  Maintenant, l'entreprise travaille activement sur une solution de cluster.  Peut-√™tre tombera-t-il dans la version Enterprise.  Il existe √©galement une version cloud pour les startups qui souhaitent r√©ussir √† p√©n√©trer le march√© avant que les investisseurs ne manquent d'argent. <br><br>  Des nouvelles: <br><br><ul><li>  un million de t√©l√©chargements au cours de la derni√®re ann√©e et demie; <br></li><li>  Investissement de 31 millions de dollars; <br></li><li>  Collaboration active avec MS Azure concernant les solutions IoT. <br></li></ul><br><h3>  Pour r√©sumer </h3><br><blockquote>  TimescaleDB est con√ßu pour stocker des donn√©es de s√©ries chronologiques.  Il s'agit d'un syst√®me de partitionnement puissant avec des restrictions minimales par rapport aux natifs de PostgreSQL. </blockquote><br>  Malheureusement, l'extension n'a pas encore de version multinode.  Si vous voulez un multima√Ætre ou un fragment, vous devez jouer, par exemple, avec CitusDB.  Si vous voulez une r√©plication logique, cela fera mal.  Mais √ßa fait toujours mal avec elle. <br><br><h2>  Pipelinedb </h2><br>  Parlons maintenant de la deuxi√®me extension.  Malheureusement, nous n'avons pas pu le tester correctement au combat.  Maintenant, il passe par l'√©tape d'adaptation dans notre syst√®me.  Certes, il y a un probl√®me dont je parlerai plus pr√®s de la fin. <br><br>  Comme dans le cas pr√©c√©dent, nous commen√ßons par de vrais exemples.  Il est plus facile de comprendre les avantages de l'extension et la motivation √† l'utiliser. <br><br>  <b>Collecte de statistiques</b> .  Imaginez que nous collections des statistiques sur les visites de notre site Web.  Nous avons besoin d'analyses des pages les plus populaires, du nombre d'utilisateurs uniques et d'une id√©e des retards de ressources.  Tout cela doit √™tre mis √† jour en temps r√©el.  Mais nous ne voulons pas toucher √† chaque fois la table de donn√©es et cr√©er une requ√™te, ni mettre √† jour la vue en haut de la table. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CONTINUOUS <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> total_count, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> cookie::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> uniques, <span class="hljs-keyword"><span class="hljs-keyword">percentile_cont</span></span>(<span class="hljs-number"><span class="hljs-number">0.99</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WITHIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> latency::<span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> p99_latency <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> page_views <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>;</code> </pre> <br><pre> <code class="plaintext hljs">url | total_count | uniques | p99_latency -----------+-------------+---------+------------ some/url/0 | 633 | 51 | 178 some/url/1 | 688 | 37 | 139 some/url/2 | 508 | 88 | 121 some/url/3 | 848 | 36 | 59 some/url/4 | 126 | 64 | 159</code> </pre> <br>  Le traitement en streaming et l'extension PipelineDB viennent √† la rescousse.  L'extension ajoute l'abstraction CONTINUES VIEW.  Dans la version russe, cela peut ressembler √† une ¬´pr√©sentation continue¬ª.  Cette vue est automatiquement mise √† jour lorsqu'elle est ins√©r√©e dans le tableau avec les enregistrements de visites, alors que sur la base de nouvelles donn√©es, sans lecture d√©j√† enregistr√©e √† l'avance. <br><br>  <b>Flux de donn√©es</b> .  PipelineDB ne se limite pas au nouveau type de vue.  Supposons que nous effectuions des tests A / B et collections des analyses en temps r√©el sur l'efficacit√© d'une nouvelle solution d'entreprise.  Mais nous ne voulons pas stocker les donn√©es sur les actions des utilisateurs eux-m√™mes.  Nous ne sommes int√©ress√©s que par le r√©sultat - quel groupe a le plus de conversion. <br><br>  Pour √©viter le stockage direct de donn√©es brutes pour le streaming informatique, nous avons besoin d'une telle abstraction que les <b>flux - flux de donn√©es</b> .  PipelineDB pr√©sente cette fonctionnalit√©.  Vous pouvez cr√©er des flux comme des tables r√©guli√®res.  Sous le capot, ce sera ¬´FOREIGN TABLE¬ª bas√© sur la file d'attente ZeroMQ, que l'extension utilise imperceptiblement de notre part.  Les donn√©es entrent dans la file d'attente interne ZeroMQ et d√©clenchent une mise √† jour de la vue continue. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> STREAM ab_event_stream ( <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, ab_group <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, event_type <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>), cookie <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">32</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> CONTINUOUS <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> ab_test_monitor <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, ab_group, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> WHENevent_type = <span class="hljs-string"><span class="hljs-string">'v'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> view_count, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> WHENevent_type = <span class="hljs-string"><span class="hljs-string">'c'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> conversion_count, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> cookie) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> uniques <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ab_event_stream <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, ab_group;</code> </pre> <br>  Ensuite, nous cr√©ons ¬´VUE CONTINUE¬ª √† partir des donn√©es d'un flux cr√©√© pr√©c√©demment.  Lorsque les donn√©es arrivent dans le flux, la vue est mise √† jour en fonction de ces donn√©es.  Apr√®s cela, les donn√©es seront simplement supprim√©es, ne seront enregistr√©es nulle part et n'occuperont pas d'espace disque.  Cela vous permet de cr√©er des analyses sur une quantit√© presque illimit√©e de donn√©es, de les charger dans le flux de donn√©es PipelineDB et de lire le r√©sultat du calcul √† partir d'une vue continue. <br><br>  <b>Stream computing</b>  Apr√®s avoir cr√©√© le flux de donn√©es et la vue continue, nous pouvons travailler avec le streaming informatique.  Cela ressemble √† ceci. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ab_event_stream (<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, ab_group, event_type, cookie) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">round</span></span>(random() * <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">round</span></span>(random() * <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ab_group, (<span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> WHENrandom() &gt; <span class="hljs-number"><span class="hljs-number">0.4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'v'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'c'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> event_type, <span class="hljs-keyword"><span class="hljs-keyword">md5</span></span>(random()::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> cookie <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ab_group, uniques <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ab_test_monitor; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ab_group, view_count * <span class="hljs-number"><span class="hljs-number">100</span></span> / (conversion_count + view_count) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> conversion_rate <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ab_test_monitor;</code> </pre> <br>  Le premier "SELECT" donne le groupe "ab" et le nombre de visiteurs uniques.  Le second - donne le rapport entre les groupes - conversion.  C'est tout le test A / B sur cinq appels SQL dans une base de donn√©es relationnelle. <br><br>  La vue est mise √† jour dynamiquement.  Vous ne pouvez pas attendre le traitement de l'ensemble du tableau de donn√©es, mais lire les r√©sultats interm√©diaires qui ont d√©j√† √©t√© trait√©s.  Les vues sont lues de la m√™me mani√®re que PostgreSQL standard.  Vous pouvez √©galement combiner une vue avec des tableaux ou m√™me d'autres vues.  Il n'y a aucune restriction. <br><br><h3>  Topologie </h3><br>  Kafka re√ßoit la t√©l√©m√©trie, le sujet dans Kafka envoie ces donn√©es √† PostgreSQL, et nous les agr√©gons davantage.  Par exemple, nous combinons avec une table ordinaire et redirige les donn√©es vers le flux.  De plus, il provoque la mise √† jour de la pr√©sentation continue correspondante, √† partir de laquelle les clients de la base de donn√©es peuvent d√©j√† lire les donn√©es finies. <br><br><img src="https://habrastorage.org/webt/0e/4p/zb/0e4pzbehsh35td5tdiillcaq82m.jpeg"><br><br>  <i>Un exemple de la topologie des composants PipelineDB √† l'int√©rieur de PostgreSQL.</i>  <i>Le circuit est emprunt√© √† une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sentation de</a> Derek Nelson.</i> <br><br>  En plus des flux et des vues, l'extension fournit √©galement une abstraction de ¬´transform¬ª - convertisseurs ou mutateurs.  Cette vue, mais visait √† convertir le flux de donn√©es entrant en une sortie modifi√©e.  √Ä l'aide de ces mutateurs, vous pouvez modifier la pr√©sentation des donn√©es ou les filtrer.  Du mutateur, tout tombe dans la vue CONTINUOUS VIEW.  Nous y faisons d√©j√† des demandes pour les entreprises.  Quiconque conna√Æt la programmation fonctionnelle doit comprendre l'id√©e. <br><br>  Dans PipelineDB, nous pouvons suspendre un d√©clencheur sur nos vues et effectuer des actions, par exemple, ¬´alerte¬ª.  Avec tous ces calculs, nous ne stockons jamais les donn√©es brutes nous-m√™mes, sur la base desquelles nous les calculons tous.  Ceux-ci peuvent √™tre des t√©raoctets, que nous t√©l√©chargeons s√©quentiellement sur un serveur avec un disque de cent gigaoctets.  Apr√®s tout, nous ne sommes int√©ress√©s que par le r√©sultat des calculs. <br><br><h3>  Caract√©ristiques cl√©s </h3><br>  L'extension PipelineDB est plus difficile √† apprendre que TimescaleDB.  Dans TimescaleDB, nous cr√©ons une table, lui disons qu'elle est hypertable et profitons de la vie en utilisant plusieurs fonctions suppl√©mentaires offertes par l'extension. <br><br>  <b>PipelineDB r√©sout le probl√®me du streaming informatique dans les bases de donn√©es relationnelles</b> .  La t√¢che de traitement en continu des donn√©es est plus compliqu√©e que le partitionnement en termes d'int√©gration et d'utilisation.  Cependant, tout le monde n'a pas d'√©normes donn√©es et des milliards de lignes.  Pourquoi compliquer l'infrastructure s'il y a PipelineDB?  L'extension fournit ses propres impl√©mentations de repr√©sentations, de flux, de convertisseurs et d'agr√©gats pour le traitement de flux.  Il est √©galement <b>int√©gr√© dans le planificateur de requ√™tes et l'ex√©cuteur de requ√™tes</b> permet d'impl√©menter le concept de stream computing dans une base de donn√©es relationnelle. <br><br>  Comme TimescaleDB, l'extension PipelineDB <b>n'impose pas de restrictions SQL dans PostgreSQL</b> .  Il existe plusieurs fonctionnalit√©s, par exemple, vous ne pouvez pas combiner deux flux, mais ce n'est pas n√©cessaire. <br><br>  <b>Prise en charge des structures de donn√©es probabilistes et des algorithmes</b> .  L'extension utilise le filtre Bloom pour SELECT DISTINCT, HyperLogLog pour COUNT (DISTINCT) et T-Digest pour percentile_count () directement dans SQL.  Cela am√©liore la productivit√©. <br><br>  <b>√âcosyst√®me</b>  L'extension vous permet de travailler avec les solutions de haute disponibilit√© habituelles, les outils de surveillance et tout ce qui est familier dans PostgreSQL. <br><br>  Compte tenu des sp√©cificit√©s de l'informatique en streaming, PipelineDB a des <b>int√©grations avec Apache Kafka</b> et avec Amazon Kinesis, un service d'analyse en temps r√©el.  Puisque PipelineDB n'est plus une fourchette, mais une extension, l'int√©gration avec le reste du zoo devrait √©galement √™tre pr√™te √† l'emploi.  Un must, mais nous ne vivons pas dans un monde id√©al, et tout m√©rite d'√™tre v√©rifi√©. <br><br><h3>  Licences et actualit√©s </h3><br>  Tout le code est sous licence Apache 2.0.  Il existe un abonnement payant au support de diff√©rentes galeries de tournage, ainsi qu'une version cluster avec une licence commerciale.  Bas√©e sur PipelineDB, la soci√©t√© fournit un service d'analyse Stride. <br><br>  Avant de commencer √† parler de l'extension, j'ai dit qu'il y avait un ¬´mais¬ª.  Il est temps de parler de lui.  Le 1er mai 2019, l'√©quipe PipelineDB a annonc√© qu'elle faisait d√©sormais partie de Confluent.  C'est l'entreprise qui d√©veloppe KSQL - un moteur de streaming de donn√©es dans Kafka avec la syntaxe SQL.  Maintenant, Victor Gamov, co-fondateur du podcast Debriefing, y travaille. <br><br>  Qu'est-ce qui en d√©coule?  PipelineDB a gel√© sur la version 1.0.0.  En plus de corriger les bogues critiques, rien n'est pr√©vu.  En raison de la prise de contr√¥le, nous nous attendons √† l'int√©gration d'Uber de Kafka avec PostgreSQL.  C'est peut-√™tre Confluent bas√© sur un stockage enfichable qui fera quelque chose de cool. <br><br>  Que faire  Acc√©dez √† TimescaleDB.  Dans la derni√®re version, ils ont fait leur ¬´VUE CONTINUE¬ª avec le blackjack.  Bien s√ªr, la fonctionnalit√© n'est plus aussi cool que dans PipelineDB, mais c'est une question de temps. <br><br><h3>  Pour r√©sumer </h3><br><blockquote>  PipelineDB est con√ßu pour un traitement de donn√©es en continu haute performance.  Il vous permet d'effectuer des calculs sur de grands ensembles de donn√©es sans avoir √† enregistrer les donn√©es elles-m√™mes. </blockquote><br>  Avec PipelineDB, lorsque nous envoyons un flux de donn√©es √† PostgreSQL dans un flux, nous les consid√©rons comme virtuels.  Nous ne sauvegardons pas les donn√©es, mais agr√©gons, calculons et √©liminons.  Vous pouvez cr√©er un serveur de 200 gigaoctets et √©liminer des t√©raoctets de donn√©es via des flux.  Nous obtiendrons le r√©sultat, mais les donn√©es elles-m√™mes seront supprim√©es. <br><br>  Si pour une raison quelconque, la "VUE CONTINUE" de TimescaleDB ne vous suffit pas, essayez PipelineDB.  Il s'agit d'un projet open source sous licence Apache.  Il n'ira nulle part, bien qu'il ne soit plus activement d√©velopp√©.  Mais les choses peuvent changer, Confluent n'a pas encore √©crit sur les plans d'expansion. <br><br><h2>  Utilisation de TimescaleDB et PipelineDB </h2><br>  Avec PostgreSQL et deux extensions, <b>nous pouvons stocker et traiter de grands tableaux de donn√©es de s√©ries chronologiques</b> .  Vous pouvez penser √† de nombreuses applications.  Regardons un exemple de mon domaine - la surveillance des v√©hicules. <br><br><img src="https://habrastorage.org/webt/mx/_k/ru/mx_krumolcfgrlfrraktizshhem.jpeg"><br><br>  L'√©quipement de navigation envoie en continu des enregistrements de t√©l√©m√©trie √† nos serveurs.  Ils analysent divers textes et protocoles binaires dans un format commun et envoient des donn√©es √† Kafka dans un sujet sp√©cial.  √Ä partir de l√†, ils passent par l'int√©gration avec PipelineDB dans le flux de donn√©es de t√©l√©m√©trie √† l'int√©rieur de PostgreSQL.  Ce flux met √† jour la vue de l'√©tat actuel des v√©hicules et l'analyse globale de la flotte, et sur la base du d√©clencheur provoque l'enregistrement des enregistrements de t√©l√©m√©trie dans l'hypertable TimescaleDB. <br><br>  Avec les extensions, nous avons trois avantages. <br><br><ul><li>  Analyses en temps r√©el. <br></li><li>  Stockage des donn√©es de s√©ries chronologiques. <br></li><li>  Diminution du volume de t√©l√©m√©trie stock√©e.  √Ä l'aide du mutateur PipelineDB, nous agr√©gons des donn√©es, par exemple, d'une minute, en calculant des valeurs moyennes. <br></li></ul><br>  Grafana prend en charge les fonctionnalit√©s de TimescaleDB.  Par cons√©quent, il est possible de cr√©er des graphiques en fonction des mesures commerciales directement √† partir de la bo√Æte, jusqu'aux pistes sur la carte par coordonn√©es.  Le d√©partement analytique sera ravi. <br><br>  Pour "toucher" tout vous-m√™me, regardez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la d√©mo sur GitHub</a> et ex√©cutez l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">image Docker</a> - √† l'int√©rieur de l'assembly des derniers PostgreSQL, TimescaleDB et PipelineDB. <br><br><h2>  Total </h2><br>  PostgreSQL vous permet de combiner diff√©rentes extensions, ainsi que d'ajouter vos propres types de donn√©es et fonctions pour r√©soudre des probl√®mes sp√©cifiques.  Dans notre cas, l'utilisation des extensions TimescaleDB et PostGIS couvre presque enti√®rement les besoins de stockage de donn√©es de s√©ries chronologiques et de calculs g√©ospatiaux.  Avec l'extension PipelineDB, nous pouvons effectuer des calculs continus pour diverses analyses et statistiques, et l'utilisation de colonnes JSONB nous permet de stocker des donn√©es faiblement structur√©es dans une base de donn√©es relationnelle.  Les solutions Open Source suffisent √† la t√™te - nous n'utilisons pas de solutions commerciales. <br><br>  Ces extensions n'imposent pratiquement pas de restrictions √† l'√©cosyst√®me autour de PostgreSQL, telles que les solutions de haute disponibilit√©, les syst√®mes de sauvegarde, les outils de surveillance et d'analyse des journaux.  Nous n'avons pas besoin de MongoDB s'il y a des colonnes JSONB, et nous n'avons pas besoin d'InfluxDB s'il y a TimescaleDB. <br><br><blockquote>  Vous aimez l'histoire d'Ivan et souhaitez partager quelque chose de similaire?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postulez</a> avant le 7 septembre chez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++</a> √† Moscou.  Le programme se remplit progressivement.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus des cas de base de donn√©es, il y aura des rapports sur l'architecture, l'optimisation et, bien s√ªr, les charges √©lev√©es. </font><font style="vertical-align: inherit;">Soumettez un rapport avant la date limite, nous vous attendons parmi les intervenants!</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464303/">https://habr.com/ru/post/fr464303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464289/index.html">Comment √©crire des packages Go</a></li>
<li><a href="../fr464291/index.html">Les 10 langages de programmation les plus influents des 50 derni√®res ann√©es et leurs cr√©ateurs</a></li>
<li><a href="../fr464293/index.html">Les crochets se remplacent-ils dans React Redux?</a></li>
<li><a href="../fr464295/index.html">Exemples d'utilisation de nouvelles fonctionnalit√©s JavaScript</a></li>
<li><a href="../fr464299/index.html">0, 0, 1, 0, 2, 0, 2, 2, 1, 6, 0, 5, 0, 2, 6, 5, 4, 0, 5, 3, 0, 3, 2, 9, 0, 4, 9, 3, 6, 14, 0, 6, 3, 5, 15, 0, 5, 3, 5 ...</a></li>
<li><a href="../fr464305/index.html">Petit, oui. D√©ballage du p√©tard microvirtuel</a></li>
<li><a href="../fr464307/index.html">Test d'int√©gration de microservices sur Scala</a></li>
<li><a href="../fr464309/index.html">Bouton d'appel bricolage. Raspberry Pi, MajorDoMo, Freeswitch et Linphonec</a></li>
<li><a href="../fr464315/index.html">Le film dans lequel il y avait de la terre. Recherche sur Yandex et bref historique de la recherche par sens</a></li>
<li><a href="../fr464317/index.html">Projet Konbanwa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>