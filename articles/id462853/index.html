<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¥Û†ÅßÛ†Å¢Û†Å∑Û†Å¨Û†Å≥Û†Åø üïµüèæ üöó Memperbarui statistik pada replika sekunder dari Grup yang Tersedia üòñ ‚ôÄÔ∏è üçü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kita semua menyukai dan menggunakan fitur-fitur menarik dari Grup Ketersediaan pada replika sekunder, seperti pemeriksaan integritas, cadangan, dll. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memperbarui statistik pada replika sekunder dari Grup yang Tersedia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462853/">  Kita semua menyukai dan menggunakan fitur-fitur menarik dari Grup Ketersediaan pada replika sekunder, seperti pemeriksaan integritas, cadangan, dll. <br><br>  Bahkan, ketidakmampuan untuk menyimpan informasi ini dalam database pada replika masih sakit kepala (dan pikirkan hal-hal seperti CDC untuk ketidaknyamanan yang lebih parah). <br><br>  Tapi berhentilah mengeluh, inilah ide utamanya: Microsoft terkasih, mari kita gunakan replika kami untuk memperbarui statistik ... well, dan lakukan lebih banyak lagi pada mereka. <br><br>
<h3>  Selalu ada * jalan, atau sesuatu seperti itu </h3><a name="habracut"></a><br>  <i>* hampir selalu</i> <br><br>  Mari kita daftar detail dasar yang diketahui dari solusi yang mungkin pada Enterprise Edition MS SQL Server: <br><br><ul><li>  kami dapat membuat replika dapat dibaca dan membaca data dari mereka (bukan berarti Anda selalu harus melakukan ini, tetapi jika Anda benar-benar tahu apa yang Anda lakukan ...); </li><li>  kita bisa menyalin objek kita ke Tempdb (ya, tabel multi-terabyte Anda mungkin tidak cocok untuk operasi semacam itu), atau ke database lain yang bisa ditulis; </li><li>  kita dapat menulis hasilnya ke folder bersama yang dapat diakses oleh kedua replika (biarkan itu menjadi file teks dalam file berbagi); </li><li>  kita dapat mengekspor statistik sebagai gumpalan dari SQL Server; </li><li>  kita dapat mengimpor gumpalan yang diunduh ke dalam statistik. </li></ul><br><h4>  Ayo lakukan </h4><br>  Saya memiliki tes AG pada sepasang mesin virtual dengan SQL Server 2017 (Anda dapat menggunakan versi apa pun) dan saya akan membuat tabel sederhana di mana saya ingin memperbarui statistik. <br><br>  Berikut ini adalah skrip untuk membuat tabel dan memasukkan sejuta baris ke dalamnya: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> dbo.SampleDataTable; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.SampleDataTable ( C1 <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, C2 <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_SampleDataTable PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (C1) ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.SampleDataTable <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (TABLOCK) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> t.RN, t.RN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1000000</span></span>) ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)) RN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects t1 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t2 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t3 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t4 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t5 ) t <span class="hljs-keyword"><span class="hljs-keyword">OPTION</span></span> (MAXDOP <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  Sekarang mari kita buat statistik ST_SampleDataTable_C2 untuk kolom c2 <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> ST_SampleDataTable_C2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.SampleDataTable(C2);</code> </pre> <br>  Dan kemudian saya akan memasukkan 1000 baris, yang akan sangat penting dan karena itu saya benar-benar perlu memperbarui statistik. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">set</span></span> nocount <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.SampleDataTable <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> (TABLOCK) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">10000000</span></span> + t.RN, <span class="hljs-number"><span class="hljs-number">999999999</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">1000</span></span>) ROW_NUMBER() <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)) RN <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> sys.objects t1 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t2 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t3 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t4 <span class="hljs-keyword"><span class="hljs-keyword">CROSS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> sys.objects t5 ) t <span class="hljs-keyword"><span class="hljs-keyword">OPTION</span></span> (MAXDOP <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br>  Sekarang saya memiliki 1000 entri di mana, di kolom C2, nilainya 999999999. Dan ini pasti berarti Masalah Kunci yang Meningkat dan saya benar-benar perlu memperbarui statistik ... pada replika sehingga saya tidak membebani server utama dengan perhitungan dan mencegahnya melayani pelanggan. <br><br>  Menggunakan perintah DBCC SHOW_STATISTICS tua yang baik, mari kita periksa statistik kami. <br><br><pre> <code class="sql hljs">DBCC SHOW_STATISTICS('dbo.SampleDataTable', 'ST_SampleDataTable_C2')</code> </pre> <br><img src="https://habrastorage.org/webt/gm/hx/xv/gmhxxvlklhhluczq_s43u1ejo_o.png"><br>  Semuanya sempurna di kerajaan kita dan statistik kita dalam urutan yang sempurna, meskipun hanya memperhitungkan 1 juta baris dan tidak ada ribuan garis yang berbahaya, yang, pada akhirnya, harus menjadi bagian dari statistik ini. <br><br>  Selain itu, kita dapat melihat aliran statistik menggunakan parameter STATS_STREAM dari perintah DBCC SHOW_STATISTICS: <br><br><pre> <code class="sql hljs">DBCC SHOW_STATISTICS('dbo.SampleDataTable', 'ST_SampleDataTable_C2') <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> STATS_STREAM;</code> </pre> <br><img src="https://habrastorage.org/webt/p8/rt/nc/p8rtncofa5dn602kl7bvexkst0m.png"><br><br>  Ini hanya rangkaian karakter yang telah ditulis blog selama bertahun-tahun, tetapi saya masih tidak yakin apakah ini fitur yang sepenuhnya didokumentasikan (meskipun tidak pernah menghentikan orang untuk menggunakannya). <br><br><h3>  Atas isyarat </h3><br>  Mari kita salin tabel kita pada replika ke tempdb (meskipun AG saya dalam mode sinkron, hal yang sama dapat dilakukan dalam asinkron, hanya data yang mungkin datang dengan sedikit penundaan). <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> TempDB; <span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> dbo.SampleDataTable; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.SampleDataTable ( C1 <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, C2 <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> PK_SampleDataTable PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (C1) ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.SampleDataTable <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> C1, C2 <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> AvGroupDb.dbo.SampleDataTable;</code> </pre> <br>  Sekarang kami siap untuk memperbarui statistik dengan pemindaian penuh di tempdb pada replika. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> TempDB; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> ST_SampleDataTable_C2 <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> dbo.SampleDataTable(C2) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> FULLSCAN;</code> </pre> <br>  ( <i>Catatan Penerjemah - Nico lupa membuat statistik, dan menggunakan sintaks yang salah dari operasi STATISTIK UPDATE, alih-alih UPDATE itu harus MENCIPTAKAN, yaitu statistik tidak diperbarui, tetapi dibuat</i> ) <br><br>  Kembali ke DBCC SHOW_STATISTICS dan lihat itu: <br><br><pre> <code class="sql hljs">DBCC SHOW_STATISTICS('dbo.SampleDataTable', 'ST_SampleDataTable_C2')</code> </pre> <br><img src="https://habrastorage.org/webt/pg/ai/n7/pgain7_73tket3lziu3h3fopk90.png"><br><br>  Itu terlihat sangat berbeda dari apa yang ada di server utama - hanya 3 baris versus 178, tetapi itu menggambarkan data dengan sempurna - kami memiliki sejuta baris unik dan 1000 baris dengan nilai kolom C2 yang sama - histogram sebagus mungkin . <br><br>  Mari kita lihat aliran statistik: <br><br><pre> <code class="sql hljs">DBCC SHOW_STATISTICS('dbo.SampleDataTable', 'ST_SampleDataTable_C2') <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> STATS_STREAM;</code> </pre> <br><img src="https://habrastorage.org/webt/04/0u/pz/040upzmtjoezg-ykcnvdvjzzicw.png"><br><br>  Anda tidak perlu menjadi jenius untuk melihat bahwa aliran terlihat sangat berbeda - kami melihat karakter 5689A0C6 dalam aliran yang diperbarui, sementara di aslinya, di antara semua nol ini kami melihat EDF10EB4. <br><br>  Mari kita berkonsentrasi pada mengekspor data ini ke file teks di suatu tempat di luar SQL Server dan melakukannya dengan bantuan perintah BCP yang luar biasa, yang mengharuskan CMDSHELL diaktifkan (catatan: Anda mungkin tidak menginginkan ini di server produksi Anda): <br><br><pre> <code class="sql hljs">EXEC xp_cmdshell 'BCP "DBCC SHOW_STATISTICS(''AvGroupDb.dbo.SampleDataTable'', ''ST_SampleDataTable_C2'') <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> STATS_STREAM<span class="hljs-string"><span class="hljs-string">" queryout \\SharedServer\Tempdb\stats.txt -c -T';</span></span></code> </pre> <br>  Dan inilah seberapa besar file stats.txt akan berada di bola kita: <br><br><img src="https://habrastorage.org/webt/io/3f/uz/io3fuz8igpsqphnccpgmf_ghxwq.png"><br><br>  Hanya beberapa kilobyte!  Mudah ditransmisikan, mudah dikelola. <br><br><h3>  Kembali ke server utama </h3><br>  Di server utama, kita perlu membuat tabel sementara yang akan menyimpan aliran statistik sebelum kita dapat memperbarui statistik dari itu di tabel SampleDataTable utama kita (dalam praktiknya, kita dapat memperluas tabel ini untuk banyak basis data, tabel, statistik). <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> dbo.TempStats( Stats_Stream VARBINARY(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">Rows</span></span> <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span>, DataPages <span class="hljs-built_in"><span class="hljs-built_in">BIGINT</span></span> );</code> </pre> <br>  Mari mengimpor data dari file teks kami ke tabel sementara kami yang baru dan lihat apa yang kami impor: <br><br><pre> <code class="sql hljs">BULK <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> dbo.TempStats <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">'\\SharedServer\Tempdb\stats.txt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.TempStats;</code> </pre> <br><img src="https://habrastorage.org/webt/nd/0h/rk/nd0hrkomoixkorwndcrijcxlzwu.png"><br><br>  Kita dapat melihat data yang sama dengan yang kita hitung pada replika, tetapi data ini sudah ada di server utama kita dan yang tersisa untuk kita lakukan adalah memperbarui statistik kita dari mereka dalam tabel.  Operasi ini dapat dilakukan dengan menggunakan operasi STATISTIK PEMBARUAN menggunakan parameter WITH STATS_STREAM = ... <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @script <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> @script = <span class="hljs-string"><span class="hljs-string">'UPDATE STATISTICS dbo.SampleDataTable(ST_SampleDataTable_C2) WITH STATS_STREAM = '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">CONVERT</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nvarchar</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>), [Stats_Stream],<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.TempStats PRINT @script; <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> sp_executesql @script;</code> </pre> <br>  Skrip ini membaca nilai yang diimpor di atas (ya, saya tahu - saya melakukan contoh ini untuk satu tabel dan tidak repot dengan beberapa statistik, tabel, database, dll.), Menghasilkan pernyataan STATISTIK PEMBARUAN, menampilkannya di layar dan, pada akhirnya, memenuhi itu. <br>  Inilah yang saya dapatkan di output: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> dbo.SampleDataTable(ST_SampleDataTable_C2) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> STATS_STREAM =</code> </pre> <br>  Menjalankan DBCC SHOW_STATISTICS di server utama memberi saya hasil yang saya harapkan - sama seperti apa yang kami lihat di replika.  Lingkaran ditutup. <br><pre> <code class="sql hljs">DBCC SHOW_STATISTICS('dbo.SampleDataTable', 'ST_SampleDataTable_C2');</code> </pre> <br>  Bagian yang sangat mengagumkan dari cerita ini adalah bahwa ukuran objek dengan statistik sangat kecil dan kita dapat mentransfernya ke server utama dengan sangat mudah / instan. <br><br><h3>  Skenario tidak begitu mendasar. </h3><br>  Jika Anda memiliki beberapa AG di antara replika yang sama, di mana satu replika adalah yang utama dalam satu AG dan yang lainnya adalah yang utama di yang kedua, maka Anda dapat memasukkan data BLOB ke dalam aliran data antara replika dan menambahkan database kecil dengan data yang dikirimkan. <br><br><img src="https://habrastorage.org/webt/ua/af/5r/uaaf5rbrsxkxfq1onfcydtzlgbm.png"><br><br>  Lihat gambarnya.  Jika kami memiliki dua AG (AG1 &amp; AG2) yang terletak di server yang berbeda dan kami memiliki tabel spesifik pada Server1 di AG1 yang ingin kami perbarui statistiknya, maka pada Server2 kami dapat menyalin tabel ini (sebut saja dbo.MyTable ) di tempdb, perbarui, dan menggunakan AG2 kirim objek dengan aliran statistik kembali ke Server1, di mana Anda hanya mengimpor statistik dari aliran ini ke statistik yang kami butuhkan. <br><br>  Ya, saya tahu, kedengarannya membingungkan, tetapi anggap saja sebagai saluran umpan balik di mana hasilnya dikirim, alih-alih menempatkannya di file bola. <br><br><h3>  Tempat untuk keraguan </h3><br>  Anda mungkin memiliki beberapa keberatan, misalnya: <br><br><ul><li>  mengapa saya harus melakukan ini pada replika jika saya dapat melakukannya dengan aman di server utama?  (well, idenya adalah untuk membongkar server utama) </li><li>  tetapi jangan kita, berpotensi, memuat replika (ya, tetapi jika itu menganggur, itu sebabnya kami ingin menggunakan kekuatannya) </li><li>  dan kita tidak bisa bertindak di server utama?  (tidak, kami baru saja membaca data dari replika dan mengirim kembali beberapa kilobyte, yang pada abad kami gigabyte dan terabyte terdengar seperti "shtoa?") ( <i>Catatan penerjemah - secara umum, hanya dalam kasus replika AG yang dapat dibaca, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kami dapat</a></i> ) </li><li>  Bagaimana jika di tengah proses server utama mulai memperbarui statistik sendiri?  (dalam hal ini, dapat mengganggu proses kedua, atau memulai kembali dengan data yang diperbarui). </li></ul><br><h3>  Saluran Umpan Balik AG </h3><br>  Ini adalah saluran dengan umpan balik dari replika ke server utama - setelah kami berjanji transaksi di AG sinkron, server utama akan menunggu konfirmasi dari replika - dan saya pikir saluran ini dapat digunakan untuk mengimplementasikan peningkatan ini.  Lihatlah foto yang diambil di sebuah pos oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Simon Su</a> . <br><br><img src="https://habrastorage.org/webt/hc/my/rk/hcmyrkc1okyfr1byzfvhxexwixy.png"><br><br>  Yang mewakili seluruh mekanisme saluran umpan balik yang ada.  Replika, menggunakan langkah 12 dan selanjutnya, mengkonfirmasi ke server utama bahwa informasi telah disimpan.  Saluran yang sama dapat digunakan untuk mengirim objek aliran statistik setelah menghitung ulang pada replika.  Tentu saja, kita tidak perlu menggunakan tempdb untuk tujuan ini, tetapi membuat objek dalam-memori di dalam database yang seharusnya tidak disimpan secara permanen (lihat tabel Hanya-OLema Skema OLTP Dalam Memori Anda, atau pikirkan tabel NOLOGGING di Oracle), dan harus dihapus pada akhir operasi - itu akan sangat keren. <br><br><h3>  Pikiran umum </h3><br>  Seharusnya tidak tergantung pada apakah replika sinkron atau tidak - sebagian besar statistik waktu tidak diperbarui setiap beberapa detik dan ini membawa kita ke bagian kedua dari ide - untuk membuat panggilan untuk memperbarui statistik di server utama dengan parameter seperti parameter <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATISTICS</span></span> dbo.MyAwesomeTable(HugeImportantStatOnC17) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> FULLSCAN, SECONDARY</code> </pre> <br>  di mana parameter SECONDARY menunjukkan di mana operasi akan dilakukan. <br>  Dan seperti halnya dengan cadangan, kita harus dapat menentukan replika yang disukai untuk melakukan STATISTIK PEMBARUAN (atau operasi lainnya di masa mendatang) dalam pengaturan. <br><br>  Saya yakin bahwa fitur ini akan mendorong banyak pengguna Edisi Perusahaan untuk bermigrasi ke versi baru SQL Server, yang akan memungkinkan mendistribusikan operasi berat antar replika. <br><br>  Adapun situasi saat ini, saya pasti melihat bagaimana Anda dapat mengotomatisasi solusi ini menggunakan Powershell. <br><br>  Microsoft, giliran Anda!  ;) <br><br>  Pilih fitur yang diusulkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  <i>Catatan Penerjemah: Setiap saran dan komentar tentang terjemahan dan gaya disambut, seperti biasa.</i> <i><br><br></i>  <i>Saya biasanya menyebut replika primer dalam terjemahan ‚Äúserver utama‚Äù, dan replika sekunder - hanya replika.</i>  <i>Mungkin ini tidak sepenuhnya benar, tetapi telingaku sakit kurang dari replika "primer" dan "sekunder" di msdn.</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id462853/">https://habr.com/ru/post/id462853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id462843/index.html">Keterbatasan game 8-bit dan rekreasi tepatnya di Unity</a></li>
<li><a href="../id462845/index.html">Pijat untuk otak Anda: bicara tentang ASMR</a></li>
<li><a href="../id462847/index.html">Webinar Hewlett Packard Enterprise pada Agustus-Oktober 2019</a></li>
<li><a href="../id462849/index.html">Sesuatu tentang inode</a></li>
<li><a href="../id462851/index.html">Kami membuat layanan cloud untuk mengelola persediaan (Angular + Firebase)</a></li>
<li><a href="../id462855/index.html">Pemrograman yang mudah: Papan Kanban untuk GitLab dalam satu hari kerja</a></li>
<li><a href="../id462859/index.html">Bagaimana perusahaan bus Eropa beroperasi di Rusia: bagaimana bus dan penumpang berbeda</a></li>
<li><a href="../id462863/index.html">21 Agustus menyiarkan Pertemuan Zabbix Moscow # 5</a></li>
<li><a href="../id462867/index.html">Memilih Skema Warna untuk Aplikasi Anda: Cara Membuatnya Sederhana?</a></li>
<li><a href="../id462869/index.html">Sistem Manajemen Proyek Agilean</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>