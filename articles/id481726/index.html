<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤üèº ü§¥üèø üèà Laravel Routing yang dilokalkan üëÇ ü§∞ ü§ú</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! 
 UPD 
 Pada sumber daya ini, relevansi artikel dapat berubah menjadi nol kali satu komentar . Tugas yang dijelaskan dalam artikel dapat d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Laravel Routing yang dilokalkan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481726/"><p><img src="https://habrastorage.org/webt/ri/a5/l4/ria5l4vqjfp7yxunyvblqh4ybdy.png" alt="KDPV"></p><br><p>  Halo, Habr! </p><br><blockquote>  <strong>UPD</strong> <br>  Pada sumber daya ini, relevansi artikel dapat berubah menjadi nol kali <a href="https://habr.com/ru/post/481726/">satu komentar</a> .  Tugas yang dijelaskan dalam artikel dapat diselesaikan dengan sedikit rasa sakit oleh <a href="https://packagist.org/packages/mcamara/laravel-localization" rel="nofollow">perpustakaan mcamara / laravel-lokalisasi</a> . <br>  Terima kasih atas tipnya <a href="https://habr.com/ru/users/dexplon/" class="user_link">DExploN</a> ! <br><br>  Kat mengangkat.  Dikalikan dengan nol adalah bagian bawah. </blockquote><a name="habracut"></a><br><p>  Saya ingin memberi tahu Anda tentang bagaimana dalam satu proyek ada masalah dengan perutean dan bagaimana kami menyelesaikannya. </p><br><p> Awalnya, proyek kami adalah situs yang paling umum.  Situs ini berkembang, audiens berkembang, dan kebutuhan muncul untuk mendukung multibahasa.  Proyek ini didasarkan pada kerangka Laravel dan tidak ada masalah dengan multibahasa (bahasa yang diinginkan ditarik dari sesi, atau yang standar diambil).  Kami menulis terjemahan, menentukan kunci terjemahan alih-alih frasa kode-keras, dan menggunakan fitur berikut untuk bekerja. </p><br><h2 id="problema">  Masalah </h2><br><p>  Pada titik tertentu, tim SEO menyadari bahwa pendekatan ini mengganggu peringkat situs.  Kemudian tim pengembangan menerima perintah untuk menambahkan subfolder bahasa ke URL, kecuali untuk bahasa default.  Rute kami mengambil bentuk berikut: </p><br><div class="scrollable-table"><table><thead><tr><th>  Halaman </th><th>  Rout ru (bahasa default) </th><th>  Rute en </th><th>  Rout fr </th></tr></thead><tbody><tr><td>  Tentang kami </td><td><code>/o-nas</code> </td> <td> <code>/en/about-us</code> </td> <td> <code>/fr/a-propos-de-nous</code> </td> </tr><tr><td>  Rincian kontak </td><td> <code>/kontakty</code> </td> <td> <code>/en/contacts</code> </td> <td> <code>/fr/coordonnees</code> </td> </tr><tr><td>  Berita </td><td> <code>/novosti</code> </td> <td> <code>/en/news</code> </td> <td> <code>/fr/les-nouvelles</code> </td> </tr></tbody></table></div><br><p>  Semuanya jatuh pada tempatnya dan kami mengatur lagi tentang fitur baru. <br>  Beberapa saat kemudian, ada kebutuhan untuk menggunakan aplikasi di beberapa domain.  Secara umum, situs-situs ini memiliki satu database, tetapi beberapa pengaturan dapat bervariasi tergantung pada domain. <br>  Beberapa situs mungkin multibahasa (apalagi, dengan serangkaian bahasa terbatas, dan tidak dengan semua yang didukung), beberapa - hanya satu bahasa. </p><br><p>  Diputuskan untuk memproses semua domain dengan satu aplikasi (nginx proksi semua domain ke satu hulu). </p><br><p>  Rangkaian bahasa yang didukung oleh situs tertentu dan bahasa default harus dikonfigurasikan di panel admin, yang merupakan akar dari versi yang diretas dari variabel config / env.  Menjadi jelas bahwa solusi saat ini tidak memuaskan Daftar Keinginan kami. </p><br><h2 id="reshenie">  Solusi </h2><br><blockquote>  Untuk menyederhanakan gambar dan menunjukkan solusinya, saya menggunakan proyek baru pada laravel versi 6.2 dan menolak untuk menggunakan database.  Dalam versi 5.x, perbedaannya kecil (tapi tentu saja saya tidak akan mengecatnya). <br><br>  Kode Proyek Tersedia di <a href="https://github.com/ddrv/habrapost481726-laravel-localized-routing" rel="nofollow">GitHub</a> </blockquote><p>  Pertama, kita perlu menentukan dalam konfigurasi aplikasi semua bahasa yang didukung. </p><br><div class="spoiler">  <b class="spoiler_title">config / app.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-comment"><span class="hljs-comment">// ... 'locale' =&gt; 'en', 'fallback_locale' =&gt; 'en', 'supported_locales' =&gt; [ 'en', 'ru', 'de', 'fr', ], // ... ];</span></span></code> </pre> </div></div><br><p>  Kami membutuhkan esensi dari situs <code>Site</code> dan layanan untuk menentukan pengaturan situs. </p><br><div class="spoiler">  <b class="spoiler_title">app / Entities / Site.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Entities</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Site</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $domain; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $defaultLanguage; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string[]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $supportedLanguages = []; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $domain  * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $defaultLanguage    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string[] $supportedLanguages    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $domain, string $defaultLanguage, array $supportedLanguages)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;domain = $domain; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;defaultLanguage = $defaultLanguage; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!in_array($defaultLanguage, $supportedLanguages)) { $supportedLanguages[] = $defaultLanguage; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;supportedLanguages = $supportedLanguages; } <span class="hljs-comment"><span class="hljs-comment">/** *    * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDomain</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;domain; } <span class="hljs-comment"><span class="hljs-comment">/** *       * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultLanguage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;defaultLanguage; } <span class="hljs-comment"><span class="hljs-comment">/** *      * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSupportedLanguages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;supportedLanguages; } <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $language * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLanguageSupported</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $language)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> in_array($language, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;supportedLanguages); } <span class="hljs-comment"><span class="hljs-comment">/** * ,      * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $language * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isLanguageDefault</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $language)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $language === <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;defaultLanguage; } }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">app / Kontrak / SiteDetector.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Entities</span></span>\<span class="hljs-title"><span class="hljs-title">Site</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpKernel</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">NotFoundHttpException</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SiteDetector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $host  * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Site   * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> NotFoundHttpException     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $host)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Site</span></span></span></span>; }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">app / Layanan / SiteDetector / FakeSiteDetector.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Services</span></span>\<span class="hljs-title"><span class="hljs-title">SiteDetector</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">SiteDetector</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Entities</span></span>\<span class="hljs-title"><span class="hljs-title">Site</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpKernel</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">NotFoundHttpException</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** *      . *       ,      . */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FakeSiteDetector</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SiteDetector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Site[]  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $sites; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $sites = [ <span class="hljs-string"><span class="hljs-string">'localhost'</span></span> =&gt; [ <span class="hljs-comment"><span class="hljs-comment">//   'default' =&gt; 'en', 'support' =&gt; ['ru', 'de', 'fr'], ], 'site-all.local' =&gt; [ //   'default' =&gt; 'en', 'support' =&gt; ['ru', 'de', 'fr'], ], 'site-ru.local' =&gt; [ //   'default' =&gt; 'ru', 'support' =&gt; [], ], 'site-en.local' =&gt; [ 'default' =&gt; 'en', //   'support' =&gt; [], ], 'site-de.local' =&gt; [ 'default' =&gt; 'de', //   'support' =&gt; [], ], 'site-fr.local' =&gt; [ 'default' =&gt; 'fr', //   'support' =&gt; [], ], 'site-eur.local' =&gt; [ //    'default' =&gt; 'de', 'support' =&gt; ['fr'], ], ]; foreach ($sites as $domain =&gt; $site) { $default = $site['default']; $support = array_merge([$default], $site['support']); $this-&gt;sites[$domain] = new Site($domain, $default, $support); } } public function detect(string $host): Site { $host = trim(mb_strtolower($host)); if (!array_key_exists($host, $this-&gt;sites)) { throw new NotFoundHttpException(); } return $this-&gt;sites[$host]; } }</span></span></code> </pre> </div></div><br><p>  Tambahkan layanan kami ke wadah </p><br><div class="spoiler">  <b class="spoiler_title">app / Penyedia / AppServiceProvider.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Providers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">SiteDetector</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Services</span></span>\<span class="hljs-title"><span class="hljs-title">SiteDetector</span></span>\<span class="hljs-title"><span class="hljs-title">FakeSiteDetector</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Support</span></span>\<span class="hljs-title"><span class="hljs-title">ServiceProvider</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppServiceProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... /** * Register any application services. * * @return void */ public function register() { // ... /* *  . */ $this-&gt;app-&gt;singleton(FakeSiteDetector::class, function () { return new FakeSiteDetector(); }); /* *   */ $this-&gt;app-&gt;bind(SiteDetector::class, FakeSiteDetector::class); // ... } // ... }</span></span></code> </pre></div></div><br><p>  Sekarang tentukan rute. </p><br><div class="spoiler">  <b class="spoiler_title">rute / web.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// ... Route::get('/', 'DemoController@home')-&gt;name('web.home'); Route::get('/--about--', 'DemoController@about')-&gt;name('web.about'); Route::get('/--contacts--', 'DemoController@contacts')-&gt;name('web.contacts'); Route::get('/--news--', 'DemoController@news')-&gt;name('web.news'); // ...</span></span></code> </pre></div></div><br><p>  Bagian dari rute yang akan dilokalkan dibingkai oleh minus ganda ( <code>--</code> ).  Ini adalah topeng untuk penggantian.  Sekarang konfigurasikan masker ini. </p><br><div class="spoiler">  <b class="spoiler_title">config / routes.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'web.about'</span></span> =&gt; [ <span class="hljs-comment"><span class="hljs-comment">//   'about' =&gt; [ //     'de' =&gt; 'uber-uns', //  =&gt;  'en' =&gt; 'about-us', 'fr' =&gt; 'a-propos-de-nous', 'ru' =&gt; 'o-nas', ], ], 'web.news' =&gt; [ 'news' =&gt; [ 'de' =&gt; 'nachrichten', 'en' =&gt; 'news', 'fr' =&gt; 'nouvelles', 'ru' =&gt; 'novosti', ], ], 'web.contacts' =&gt; [ 'contacts' =&gt; [ 'de' =&gt; 'kontakte', 'en' =&gt; 'contacts', 'fr' =&gt; 'contacts', 'ru' =&gt; 'kontakty', ], ], ];</span></span></code> </pre></div></div><br><p>  Untuk menampilkan komponen pemilihan bahasa, kita perlu mentransfer ke template hanya bahasa-bahasa yang didukung oleh situs.  Mari kita menulis middleware untuk ini ... </p><br><div class="spoiler">  <b class="spoiler_title">Http / Middleware / ViewData.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Middleware</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">SiteDetector</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Closure</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">View</span></span>\<span class="hljs-title"><span class="hljs-title">Factory</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ViewFactory</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">View</span></span>\<span class="hljs-title"><span class="hljs-title">View</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ViewFactory */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $view; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> SiteDetector */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $detector; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ViewFactory $view, SiteDetector $detector)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view = $view; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;detector = $detector; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request, Closure $next)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *   */</span></span> $site = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;detector-&gt;detect($request-&gt;getHost()); <span class="hljs-comment"><span class="hljs-comment">/* *        */</span></span> $languages = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($site-&gt;getSupportedLanguages() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $language) { $url = <span class="hljs-string"><span class="hljs-string">'/'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$site-&gt;isLanguageDefault($language)) { $url .= $language; } $languages[$language] = $url; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;composer([<span class="hljs-string"><span class="hljs-string">'components/languages'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View $view)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($languages)</span></span></span><span class="hljs-function"> </span></span>{ $view-&gt;with(<span class="hljs-string"><span class="hljs-string">'languages'</span></span>, $languages); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $next($request); } }</code> </pre></div></div><br><p>  Sekarang Anda perlu menyesuaikan router.  Sebaliknya, bukan router itu sendiri, tetapi kumpulan rute ... </p><br><div class="spoiler">  <b class="spoiler_title">app / Custom / Illuminate / Routing / RouteCollection.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">Route</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCollection</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseRouteCollection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Serializable</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteCollection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRouteCollection</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> array   . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $localized = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setConfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $config)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config = $config; } <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $language  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">localize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $language)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flushLocalizedRoutes(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name =&gt; $placeholders) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasNamedRoute($name) || <span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($placeholders)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> $route = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getByName($name); <span class="hljs-comment"><span class="hljs-comment">/* *  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;localized[$name] = $route; <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;removeRoute($route); <span class="hljs-comment"><span class="hljs-comment">/* *   */</span></span> $new = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $route; $uri = $new-&gt;uri(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($placeholders <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $placeholder =&gt; $paths) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!array_key_exists($language, $paths)) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } $value = $paths[$language]; $uri = str_replace(<span class="hljs-string"><span class="hljs-string">'--'</span></span> . $placeholder . <span class="hljs-string"><span class="hljs-string">'--'</span></span>, $value, $uri); } $new-&gt;setUri($uri); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add($new); } <span class="hljs-comment"><span class="hljs-comment">/* *   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;refreshNameLookups(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;refreshActionLookups(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeRoute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Route $route)</span></span></span><span class="hljs-function"> </span></span>{ $uri = $route-&gt;uri(); $domainAndUri = $route-&gt;getDomain().$uri; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($route-&gt;methods() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $method) { $key = $method.$domainAndUri; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists($key, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;allRoutes)) { <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;allRoutes[$key]); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists($uri, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routes[$method])) { <span class="hljs-keyword"><span class="hljs-keyword">unset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routes[$method][$uri]); } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">flushLocalizedRoutes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;localized <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $name =&gt; $route) { <span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> $old = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getByName($name); <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;removeRoute($old); <span class="hljs-comment"><span class="hljs-comment">/* *   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add($route); } } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">serialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serialize([ <span class="hljs-string"><span class="hljs-string">'routes'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routes, <span class="hljs-string"><span class="hljs-string">'allRoutes'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;allRoutes, <span class="hljs-string"><span class="hljs-string">'nameList'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;nameList, <span class="hljs-string"><span class="hljs-string">'actionList'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;actionList, ]); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@inheritDoc</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unserialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($serialized)</span></span></span><span class="hljs-function"> </span></span>{ $data = unserialize($serialized); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routes = $data[<span class="hljs-string"><span class="hljs-string">'routes'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;allRoutes = $data[<span class="hljs-string"><span class="hljs-string">'allRoutes'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;nameList = $data[<span class="hljs-string"><span class="hljs-string">'nameList'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;actionList = $data[<span class="hljs-string"><span class="hljs-string">'actionList'</span></span>]; } }</code> </pre></div></div><br><p>  ..., kelas utama aplikasi ... </p><br><div class="spoiler">  <b class="spoiler_title">app / Custom / Illuminate / Foundation / Application.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCollection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Exceptions</span></span>\<span class="hljs-title"><span class="hljs-title">UnsupportedLocaleException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>\<span class="hljs-title"><span class="hljs-title">Repository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseApplication</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">UrlGenerator</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseApplication</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $isLocaleEstablished = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $cachedRoutes = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($basePath = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($basePath); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLocale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($locale)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *       ,  . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLocale() === $locale &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isLocaleEstablished) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Repository $config */</span></span> $config = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'config'</span></span>); $urlGenerator = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'url'</span></span>); $defaultLocale = $config-&gt;get(<span class="hljs-string"><span class="hljs-string">'app.fallback_locale'</span></span>); $supportedLocales = $config-&gt;get(<span class="hljs-string"><span class="hljs-string">'app.supported_locales'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!in_array($locale, $supportedLocales)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnsupportedLocaleException(); } <span class="hljs-comment"><span class="hljs-comment">/* *         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($defaultLocale !== $locale &amp;&amp; $urlGenerator <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> UrlGenerator) { $request = $urlGenerator-&gt;getRequest(); $rootUrl = $request-&gt;getSchemeAndHttpHost() . <span class="hljs-string"><span class="hljs-string">'/'</span></span> . $locale; $urlGenerator-&gt;forceRootUrl($rootUrl); } <span class="hljs-comment"><span class="hljs-comment">/* *      */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::setLocale($locale); <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_key_exists($locale, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cachedRoutes)) { $fn = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cachedRoutes[$locale]; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'router'</span></span>)-&gt;setRoutes($fn()); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'router'</span></span>)-&gt;getRoutes()-&gt;localize($locale); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;isLocaleEstablished = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootstrapWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $bootstrappers)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::bootstrapWith($bootstrappers); <span class="hljs-comment"><span class="hljs-comment">/** *         *       * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> RouteCollection $routes */</span></span> $routes = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'router'</span></span>)-&gt;getRoutes(); $routes-&gt;setConfig(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'config'</span></span>)-&gt;get(<span class="hljs-string"><span class="hljs-string">'routes'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;routesAreCached()) { <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@noinspection</span></span></span><span class="hljs-comment"> PhpIncludeInspection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cachedRoutes = <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getCachedRoutesPath(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setLocale(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getLocale()); } }</code> </pre></div></div><br><p>  ... dan ganti kelas khusus kami. </p><br><div class="spoiler">  <b class="spoiler_title">bootstrap / app.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// $app = new Illuminate\Foundation\Application($_ENV['APP_BASE_PATH'] ?? dirname(__DIR__)); $app = new App\Custom\Illuminate\Foundation\Application($_ENV['APP_BASE_PATH'] ?? dirname(__DIR__)); $app-&gt;get('router')-&gt;setRoutes(new App\Custom\Illuminate\Routing\RouteCollection()); // ...</span></span></code> </pre> </div></div><br><p>  Langkah selanjutnya adalah menentukan bahasa dari bagian pertama dari alamat URL.  Untuk melakukan ini, sebelum mengirim, kami akan mendapatkan segmen pertamanya, memeriksa dukungan situs untuk bahasa seperti itu, dan mulai mengirim permintaan baru tanpa segmen ini.  Mari kita sedikit perbaiki <code>App\Http\Kernel</code> , dan pada saat yang sama tambahkan <code>App\Http\Middleware\ViewData</code> middleware kami <code>App\Http\Middleware\ViewData</code> ke grup <code>web</code> </p><br><div class="spoiler">  <b class="spoiler_title">app / Http / Kernel.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Http</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... use App\Contracts\SiteDetector; use App\Http\Middleware\ViewData; use Closure; use Illuminate\Foundation\Http\Kernel as HttpKernel; use Illuminate\Http\Request; // ... class Kernel extends HttpKernel { // ... /** * The application's route middleware groups. * * @var array */ protected $middlewareGroups = [ // ... 'web' =&gt; [ // ... ViewData::class, ], // ... ]; // ... /** * Get the route dispatcher callback. * * @return Closure */ protected function dispatchToRouter() { return function (Request $request) { /* *   */ /** @var SiteDetector $siteDetector */ $siteDetector = $this-&gt;app-&gt;get(SiteDetector::class); $site = $siteDetector-&gt;detect($request-&gt;getHost()); /* *     */ $segment = (string)$request-&gt;segment(1); /* *           ,    */ if ($segment &amp;&amp; $site-&gt;isLanguageSupported($segment)) { $language = $segment; } else { $language = $site-&gt;getDefaultLanguage(); } /* *      */ $this-&gt;app-&gt;get('config')-&gt;set('app.supported_locales', $site-&gt;getSupportedLanguages()); /* *      */ $this-&gt;app-&gt;get('config')-&gt;set('app.fallback_locale', $site-&gt;getDefaultLanguage()); /* *    */ $this-&gt;app-&gt;setLocale($language); /* *           */ if (!$site-&gt;isLanguageDefault($language)) { /* *      . */ $server = $request-&gt;server(); $server['REQUEST_URI'] = mb_substr($server['REQUEST_URI'], mb_strlen($language) + 1); $request = $request-&gt;duplicate( $request-&gt;query-&gt;all(), $request-&gt;all(), $request-&gt;attributes-&gt;all(), $request-&gt;cookies-&gt;all(), $request-&gt;files-&gt;all(), $server ); } /* *   */ $this-&gt;app-&gt;instance('request', $request); return $this-&gt;router-&gt;dispatch($request); }; } }</span></span></code> </pre></div></div><br><p>  Jika Anda tidak membuat cache rute, maka Anda sudah bisa bekerja.  Tetapi dalam pertempuran tanpa cache, idenya bukanlah yang terbaik.  Kami telah mengajarkan aplikasi kami untuk menerima rute dari cache, sekarang kami perlu mengajarkan cara menyimpannya dengan benar.  Kustomisasi <code>route:cache</code> perintah konsol <code>route:cache</code> </p><br><div class="spoiler">  <b class="spoiler_title">app / Custom / Illuminate / Foundation / Console / RouteCacheCommand.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCollection</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">CustomRouteCollection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">Route</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCollection</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCacheCommand</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseCommand</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteCacheCommand</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCommand</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Execute the console command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;call(<span class="hljs-string"><span class="hljs-string">'route:clear'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> $routes = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getFreshApplicationRoutes(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($routes) === <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;error(<span class="hljs-string"><span class="hljs-string">"Your application doesn't have any routes."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;files-&gt;put( <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;laravel-&gt;getCachedRoutesPath(), <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;buildRouteCacheFile($routes) ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;info(<span class="hljs-string"><span class="hljs-string">'Routes cached successfully!'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildRouteCacheFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RouteCollection $base)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *        . * *   - ,  - ,    Illuminate\Routing\RouteCollection */</span></span> $code = <span class="hljs-string"><span class="hljs-string">'&lt;?php'</span></span> . PHP_EOL . PHP_EOL; $code .= <span class="hljs-string"><span class="hljs-string">'return ['</span></span> . PHP_EOL; $stub = <span class="hljs-string"><span class="hljs-string">' \'{{key}}\' =&gt; function() {return unserialize(base64_decode(\'{{routes}}\'));},'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (config(<span class="hljs-string"><span class="hljs-string">'app.supported_locales'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $locale) { <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> CustomRouteCollection|Route[] $routes */</span></span> $routes = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $base; $routes-&gt;localize($locale); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($routes <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $route) { $route-&gt;prepareForSerialization(); } $line = str_replace(<span class="hljs-string"><span class="hljs-string">'{{routes}}'</span></span>, base64_encode(serialize($routes)), $stub); $line = str_replace(<span class="hljs-string"><span class="hljs-string">'{{key}}'</span></span>, $locale, $line); $code .= $line . PHP_EOL; } $code .= <span class="hljs-string"><span class="hljs-string">'];'</span></span> . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $code; } }</code> </pre></div></div><br><p>  Perintah <code>route:clear</code> hanya menghapus file cache, kami tidak akan menyentuhnya.  Tetapi perintah <code>route:list</code> sekarang tidak mengganggu opsi <code>locale</code> . </p><br><div class="spoiler">  <b class="spoiler_title">app / Custom / Illuminate / Foundation / Console / RouteListCommand.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">RouteListCommand</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseCommand</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">Input</span></span>\<span class="hljs-title"><span class="hljs-title">InputOption</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RouteListCommand</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCommand</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Execute the console command. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $locales = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;option(<span class="hljs-string"><span class="hljs-string">'locale'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($locales <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $locale) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($locale &amp;&amp; in_array($locale, config(<span class="hljs-string"><span class="hljs-string">'app.supported_locales'</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;output-&gt;title($locale); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;laravel-&gt;setLocale($locale); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;router = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;laravel-&gt;get(<span class="hljs-string"><span class="hljs-string">'router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::handle(); } } } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOptions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> $all = config(<span class="hljs-string"><span class="hljs-string">'app.supported_locales'</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* *     */</span></span> $result = <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::getOptions(); <span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> $result[] = [<span class="hljs-string"><span class="hljs-string">'locale'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, InputOption::VALUE_OPTIONAL | InputOption::VALUE_IS_ARRAY, <span class="hljs-string"><span class="hljs-string">'Locales'</span></span>, $all]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; } }</code> </pre></div></div><br><p>  Sekarang kita perlu menjalankan perintah ini.  Sekarang tim vendor akan bekerja.  Untuk mengganti implementasi perintah konsol, Anda harus menyertakan penyedia layanan dalam aplikasi yang mengimplementasikan <code>Illuminate\Contracts\Support\DeferrableProvider</code> .  Metode <code>provides()</code> harus mengembalikan array kunci kontainer yang sesuai dengan kelas-kelas perintah. </p><br><div class="spoiler">  <b class="spoiler_title">app / Penyedia / CommandsReplaceProvider.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Providers</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCacheCommand</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Custom</span></span>\<span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Console</span></span>\<span class="hljs-title"><span class="hljs-title">RouteListCommand</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">Foundation</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Contracts</span></span>\<span class="hljs-title"><span class="hljs-title">Support</span></span>\<span class="hljs-title"><span class="hljs-title">DeferrableProvider</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Illuminate</span></span>\<span class="hljs-title"><span class="hljs-title">Support</span></span>\<span class="hljs-title"><span class="hljs-title">ServiceProvider</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandsReplaceProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeferrableProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Register any application services. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;app-&gt;singleton(<span class="hljs-string"><span class="hljs-string">'command.route.cache'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Application $app)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouteCacheCommand($app-&gt;get(<span class="hljs-string"><span class="hljs-string">'files'</span></span>)); }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;app-&gt;singleton(<span class="hljs-string"><span class="hljs-string">'command.route.list'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Application $app)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouteListCommand($app-&gt;get(<span class="hljs-string"><span class="hljs-string">'router'</span></span>)); }); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;commands(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;provides()); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provides</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'command.route.cache'</span></span>, <span class="hljs-string"><span class="hljs-string">'command.route.list'</span></span>, ]; } }</code> </pre></div></div><br><p>  Dan tentu saja, kami menambahkan penyedia ke konfigurasi. </p><br><div class="spoiler">  <b class="spoiler_title">config / app.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-comment"><span class="hljs-comment">// ... 'providers' =&gt; [ App\Providers\CommandsReplaceProvider::class, ], // ... ];</span></span></code> </pre> </div></div><br><p>  Sekarang semuanya berfungsi! </p><br><pre> <code class="plaintext hljs">user@host laravel-localized-routing $ ./artisan route:list en == +--------+----------+----------+--------------+-------------------------+------------+ | Domain | Method | URI | Name | Action | Middleware | +--------+----------+----------+--------------+-------------------------+------------+ | | GET|HEAD | / | web.home | DemoController@home | web | | | GET|HEAD | about-us | web.about | DemoController@about | web | | | GET|HEAD | contacts | web.contacts | DemoController@contacts | web | | | GET|HEAD | news | web.news | DemoController@news | web | +--------+----------+----------+--------------+-------------------------+------------+ ru == +--------+----------+----------+--------------+-------------------------+------------+ | Domain | Method | URI | Name | Action | Middleware | +--------+----------+----------+--------------+-------------------------+------------+ | | GET|HEAD | / | web.home | DemoController@home | web | | | GET|HEAD | kontakty | web.contacts | DemoController@contacts | web | | | GET|HEAD | novosti | web.news | DemoController@news | web | | | GET|HEAD | o-nas | web.about | DemoController@about | web | +--------+----------+----------+--------------+-------------------------+------------+ de == +--------+----------+-------------+--------------+-------------------------+------------+ | Domain | Method | URI | Name | Action | Middleware | +--------+----------+-------------+--------------+-------------------------+------------+ | | GET|HEAD | / | web.home | DemoController@home | web | | | GET|HEAD | kontakte | web.contacts | DemoController@contacts | web | | | GET|HEAD | nachrichten | web.news | DemoController@news | web | | | GET|HEAD | uber-uns | web.about | DemoController@about | web | +--------+----------+-------------+--------------+-------------------------+------------+ fr == +--------+----------+------------------+--------------+-------------------------+------------+ | Domain | Method | URI | Name | Action | Middleware | +--------+----------+------------------+--------------+-------------------------+------------+ | | GET|HEAD | / | web.home | DemoController@home | web | | | GET|HEAD | a-propos-de-nous | web.about | DemoController@about | web | | | GET|HEAD | contacts | web.contacts | DemoController@contacts | web | | | GET|HEAD | nouvelles | web.news | DemoController@news | web | +--------+----------+------------------+--------------+-------------------------+------------+</code> </pre><br><p>  Itu saja.  Terima kasih atas perhatian anda! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481726/">https://habr.com/ru/post/id481726/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481708/index.html">Apakah PocketBook Sangat Bagus?</a></li>
<li><a href="../id481710/index.html">Singkatnya, membuat warna blockbuster seratus tahun</a></li>
<li><a href="../id481714/index.html">Mengapa video game dan permainan papan bukanlah indikator terbaik dari kemampuan AI (wawancara dengan pencipta Keras)</a></li>
<li><a href="../id481716/index.html">Pemrograman reaktif, apakah itu layak untuk menjatuhkan segalanya dan bergegas menuju mimpi</a></li>
<li><a href="../id481718/index.html">11 faktor dan peretasan kehidupan yang akan meningkatkan efektivitas Anda</a></li>
<li><a href="../id481728/index.html">Cungkil -> REPL untuk Ruby, yang sangat berharga</a></li>
<li><a href="../id481730/index.html">Dengarkan MPow T6 - headphone TWS hebat dengan kontrol yang praktis</a></li>
<li><a href="../id481734/index.html">Pengalaman dengan printer kartu, bagian 1</a></li>
<li><a href="../id481736/index.html">Apa yang membangun infrastruktur Wi-Fi 6?</a></li>
<li><a href="../id481738/index.html">Tugas Pemrograman - Cara yang Buruk untuk Mengevaluasi Kualifikasi Pengembang Senior</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>