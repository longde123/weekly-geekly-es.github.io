<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéÇ ‚è´ üßîüèΩ Arquitectura de m√∫ltiples m√≥dulos de Android. De la A a la Z üçä üôáüèª üëè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 

 No hace mucho tiempo, nos dimos cuenta de que una aplicaci√≥n m√≥vil no es solo un cliente ligero, sino una gran cantidad de l√≥gica muy...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arquitectura de m√∫ltiples m√≥dulos de Android. De la A a la Z</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/kaspersky/blog/422555/"> Hola a todos! <br><br>  No hace mucho tiempo, nos dimos cuenta de que una aplicaci√≥n m√≥vil no es solo un cliente ligero, sino una gran cantidad de l√≥gica muy diferente que debe racionalizarse.  Es por eso que nos inspiramos en las ideas de la arquitectura Clean, sentimos lo que es DI, aprendimos a usar Dagger 2, y ahora con los ojos cerrados podemos dividir cualquier caracter√≠stica en capas. <br><br>  Pero el mundo no se detiene, y con la soluci√≥n de viejos problemas surgen nuevos problemas.  Y el nombre de este nuevo problema es monomodularidad.  Por lo general, se entera de este problema cuando el tiempo de ensamblaje vuela al espacio.  As√≠ es exactamente cu√°ntos informes sobre la transici√≥n a la multimodularidad ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uno</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dos</a> ) comienzan. <br>  Pero por alguna raz√≥n, todos al mismo tiempo de alguna manera olvidan que la monomodularidad afecta fuertemente no solo el tiempo de montaje, sino tambi√©n su arquitectura.  Aqu√≠ contesta las preguntas.  ¬øQu√© tan grande es tu AppComponent?  ¬øVes peri√≥dicamente en el c√≥digo que la caracter√≠stica A por alguna raz√≥n extrae el repositorio de la caracter√≠stica B, aunque no deber√≠a parecer as√≠, bueno, o deber√≠a ser de alguna manera m√°s de alto nivel?  ¬øLas caracter√≠sticas tienen alg√∫n tipo de contrato?  ¬øY c√≥mo organizas la comunicaci√≥n entre caracter√≠sticas?  ¬øHay alguna regla? <br>  ¬øSientes que hemos resuelto el problema con las capas, es decir, verticalmente todo parece estar bien, pero horizontalmente algo va mal?  Y simplemente desglosar los paquetes y controlar la revisi√≥n no resuelve el problema. <br><br>  Y la pregunta de seguridad para los m√°s experimentados.  Cuando se mud√≥ a la multimodularidad, ¬øno tuvo que palear la mitad de la aplicaci√≥n, arrastrar siempre el c√≥digo de un m√≥dulo a otro y vivir un per√≠odo de tiempo decente con un proyecto no ensamblado? <br><br>  En mi art√≠culo quiero contarte c√≥mo llegu√© a la multimodularidad precisamente desde un punto de vista arquitect√≥nico.  Qu√© problemas me molestaron y c√≥mo intent√© resolverlos por etapas.  Y al final, encontrar√° un algoritmo para cambiar de monomodularidad a multimodularidad sin l√°grimas ni dolor. <br><a name="habracut"></a><br>  Respondiendo a la primera pregunta, qu√© tan grande es el AppComponent, puedo confesar: grande, realmente grande.  Y constantemente me atormentaba.  Como sucedio  En primer lugar, esto se debe a dicha organizaci√≥n DI.  Es con DI que comenzaremos. <br><br><h2>  Como hice DI antes </h2><br>  Creo que muchas personas han formado en sus cabezas algo como este diagrama de las dependencias de los componentes y los √°mbitos correspondientes: <br><img src="https://habrastorage.org/webt/f1/xm/so/f1xmsoakbmgcfys9rjuys_jmnvo.png"><br><br><h4>  Que tenemos aqui </h4><br>  <b>AppComponent</b> , que absorbi√≥ absolutamente todas las dependencias con √°mbitos <i>Singleton</i> .  Creo que casi todos tienen este componente. <br><br>  <b>FeatureComponents</b> .  Cada caracter√≠stica ten√≠a su propio alcance y era un subcomponente de <i>AppComponent</i> o una caracter√≠stica principal. <br>  Deteng√°monos un poco en las caracter√≠sticas.  En primer lugar, ¬øqu√© es una caracter√≠stica?  Lo intentar√© con mis propias palabras.  <b>Una caracter√≠stica</b> es un m√≥dulo de programa m√°ximo l√≥gicamente completo e independiente que resuelve un problema espec√≠fico del usuario, con dependencias externas claramente definidas, y que es relativamente f√°cil de usar nuevamente en otro programa.  Las caracter√≠sticas pueden ser grandes y peque√±as.  Las caracter√≠sticas pueden contener otras caracter√≠sticas.  Y tambi√©n pueden usar o ejecutar otras funciones a trav√©s de dependencias externas claramente definidas.  Si tomamos nuestra aplicaci√≥n (Kaspersky Internet Security para Android), entonces las caracter√≠sticas pueden considerarse antivirus, antirrobo, etc. <br><br>  <b>Componentes de pantalla</b> .  Un componente para una pantalla en particular, tambi√©n con su propio alcance y tambi√©n es un subcomponente del componente de funci√≥n correspondiente. <br><br><h4>  Ahora una lista de "por qu√©" </h4><br>  <b>¬øPor qu√© subcomponentes?</b> <br>  En las dependencias de componentes, no me gust√≥ el hecho de que un componente puede depender de varios componentes a la vez, lo que, en mi opini√≥n, podr√≠a conducir al caos de los componentes y sus dependencias.  Cuando tiene una relaci√≥n estricta de uno a muchos (un componente y sus subcomponentes), entonces es m√°s seguro y m√°s obvio.  Adem√°s, por defecto, todas las dependencias del padre est√°n disponibles para el subcomponente, lo que tambi√©n es m√°s conveniente. <br><br>  <b>¬øPor qu√© hay un alcance para cada caracter√≠stica?</b> <br>  Porque entonces proced√≠ de las consideraciones de que cada caracter√≠stica es alg√∫n tipo de su propio ciclo de vida, que no es el mismo que el de los dem√°s, por lo que es l√≥gico crear su propio alcance.  Hay un punto m√°s para muchas cosas mezquinas, que mencionar√© a continuaci√≥n. <br><br>  Como estamos hablando de Dagger 2 en el contexto de Clean, tambi√©n mencionar√© el momento en que se entregaron las dependencias.  Los presentadores, interactuadores, repositorios y otras clases auxiliares de dependencias se suministraron a trav√©s del constructor.  En las pruebas, sustituimos stubs o moki a trav√©s del constructor y probamos en silencio nuestra clase. <br>  El cierre del gr√°fico de dependencia generalmente ocurre en actividad, fragmentos, a veces receptores y servicios, en general, en los lugares ra√≠z desde los cuales el androide puede comenzar algo.  La situaci√≥n cl√°sica es cuando se crea una actividad para una caracter√≠stica, el componente de la caracter√≠stica comienza y vive en la actividad, y en la caracter√≠stica misma hay tres pantallas que se implementan en tres fragmentos. <br><br>  Entonces, todo parece ser l√≥gico.  Pero como siempre, la vida hace sus propios ajustes. <br><br><h2>  Problemas de la vida </h2><br><h3>  Tarea de ejemplo </h3><br>  Veamos un ejemplo simple de nuestra aplicaci√≥n.  Tenemos una funci√≥n de esc√°ner y una funci√≥n antirrobo.  Ambas caracter√≠sticas tienen un preciado bot√≥n Comprar.  Adem√°s, "Comprar" no es solo enviar una solicitud, sino tambi√©n mucha l√≥gica diferente relacionada con el proceso de compra.  Esto es puramente l√≥gica de negocios con algunos cuadros de di√°logo para la compra inmediata.  Es decir, hay una caracter√≠stica bastante diferente para s√≠ mismo: la compra.  Por lo tanto, en dos caracter√≠sticas necesitamos usar la tercera caracter√≠stica. <br>  Desde el punto de vista de la interfaz de usuario y la navegaci√≥n, tenemos la siguiente imagen.  Se inicia la pantalla principal, en la que dos botones: <br><img src="https://habrastorage.org/webt/ps/1o/qj/ps1oqjtlzdybdcj21pokcadin8u.png"><br><br>  Al hacer clic en estos botones, accedemos a la funci√≥n del esc√°ner o antirrobo. <br>  Considere la caracter√≠stica del esc√°ner: <br><img src="https://habrastorage.org/webt/p5/2g/yw/p52gywypiko82skvl0mn90hd5wq.png"><br><br>  Al hacer clic en "Iniciar escaneo antivirus" se realiza alg√∫n tipo de trabajo de escaneo, al hacer clic en "Comprarme" solo queremos comprar, es decir, sacamos la funci√≥n de Compras, pero con "Ayuda" llegamos a una pantalla simple con una ayuda. <br>  La caracter√≠stica de Anti-Theft se ve casi igual. <br><br><h3>  Posibles soluciones </h3><br>  ¬øC√≥mo implementamos este ejemplo en t√©rminos de DI?  Hay varias opciones <br><br><h4>  Primera opci√≥n </h4><br>  Seleccione una funci√≥n de compra como un <i><b>componente independiente</b></i> que depende solo del <i>AppComponent</i> . <br><img src="https://habrastorage.org/webt/ia/aq/t2/iaaqt2fi01u1lvjixbn9uspxgyi.png"><br><br>  Pero entonces nos enfrentamos con el problema: ¬øc√≥mo inyectar dependencias de dos gr√°ficos (componentes) diferentes en una clase a la vez?  Solo a trav√©s de muletas sucias, que, por supuesto, es tal cosa. <br><br><h4>  Segunda opci√≥n </h4><br>  Seleccionamos la funci√≥n de compra en el subcomponente, que depende del componente de la aplicaci√≥n.  Y los componentes del esc√°ner y antirrobo pueden convertirse en subcomponentes del componente de compra. <br><img src="https://habrastorage.org/webt/wh/sh/y3/whshy3v3buimdjy2sfo6w1de3ys.png"><br><br>  Pero, como comprender√°, puede haber muchas situaciones similares en las aplicaciones.  Y esto significa que la profundidad de las dependencias de los componentes puede ser realmente enorme y compleja.  Y dicho gr√°fico ser√° m√°s confuso que hacer que su aplicaci√≥n sea m√°s coherente y comprensible. <br><br><h4>  Tercera opci√≥n </h4><br>  Seleccionamos la funci√≥n de compra <b>no en un componente separado, sino en un m√≥dulo Dagger separado</b> .  Dos formas son posibles a√∫n m√°s. <br><br>  <b>Primera forma</b> <br>  <i>Agreguemos</i> las caracter√≠sticas de √°mbitos <i>Singleton</i> a todas las dependencias y conectemos al <i>AppComponent</i> . <br><img src="https://habrastorage.org/webt/gx/wb/3h/gxwb3hokdqdrrcypwykypnym0n8.png"><br><br>  La opci√≥n es popular, pero lleva a <i>AppComponent</i> hinchado.  Como resultado, se infla en tama√±o, contiene todas las clases de aplicaci√≥n, y todo el punto de usar Dagger se reduce a la entrega m√°s conveniente de dependencias a las clases, a trav√©s de campos o el constructor, y no a trav√©s de singletones.  En principio, esto es DI, pero echamos de menos los puntos arquitect√≥nicos, y resulta que todos saben de todos. <br>  En general, al comienzo de la ruta, si no sabe d√≥nde atribuir una clase a qu√© funci√≥n, es m√°s f√°cil hacerla global.  Esto es bastante com√∫n cuando trabajas con Legacy e intentas incorporar al menos alg√∫n tipo de arquitectura, adem√°s de que todav√≠a no conoces bien todo el c√≥digo.  Y all√≠, de hecho, los ojos se abren de par en par, y estas acciones est√°n justificadas.  El error es que cuando todo est√° m√°s o menos cerca, nadie quiere <i>abordar</i> este <i>AppComponent</i> . <br><br>  <b>Segunda forma</b> <br>  Esta es una reducci√≥n de todas las funciones a un solo alcance, por ejemplo, <i>PerFeature</i> . <br><img src="https://habrastorage.org/webt/pm/5u/og/pm5uogvwcybvetc4nrfekteyqy4.png"><br><br>  Luego, podemos conectar el m√≥dulo Dagger de Shopping a los componentes necesarios de forma f√°cil y sencilla. <br>  Parece conveniente  Pero arquitect√≥nicamente no resulta aislado.  Las caracter√≠sticas del esc√°ner y antirrobo saben absolutamente todo acerca de la funci√≥n de compra, todos sus despojos.  Sin darse cuenta, algo puede estar involucrado.  Es decir, la funci√≥n de compra no tiene una API clara, el l√≠mite entre las caracter√≠sticas es borroso, no hay un contrato claro.  Esto es malo  Bueno, en multi-modular, el gredloid ser√° dif√≠cil m√°s tarde. <br><br><h3>  Dolor arquitect√≥nico </h3><br>  Honestamente, durante mucho tiempo us√© la <b>tercera opci√≥n, la primera</b> .  Esta fue una medida necesaria cuando comenzamos a transferir gradualmente nuestro legado a los rieles normales.  Pero, como mencion√©, con este enfoque, sus caracter√≠sticas comienzan a mezclarse un poco.  Todos pueden saber sobre cada uno, sobre los detalles de la implementaci√≥n y esto para todos.  Y <i>AppComponent</i> hinchado <i>indica</i> claramente que hay que hacer algo. <br>  Por cierto, la <b>tercera opci√≥n</b> ayudar√≠a con la descarga de <i>AppComponent</i> <b>. La segunda forma</b> .  Pero el conocimiento de las implementaciones y las caracter√≠sticas de mezcla no ir√°n a ninguna parte.  Bueno, por supuesto, reutilizar funciones entre aplicaciones ser√≠a muy dif√≠cil. <br><br><h3>  Conclusiones intermedias. </h3><br>  Entonces, ¬øqu√© queremos al final?  ¬øQu√© problemas queremos resolver?  Vayamos directamente al grano, comenzando desde DI y pasando a la arquitectura: <br><br><ul><li>  Un conveniente mecanismo DI que le permite usar funciones dentro de otras funciones (en nuestro ejemplo, queremos usar la funci√≥n Compras dentro del esc√°ner y antirrobo), sin muletas ni dolor. </li><li>  El AppComponent m√°s delgado. </li><li>  Las caracter√≠sticas no deben tener en cuenta las implementaciones de otras caracter√≠sticas. </li><li>  Las funciones no deber√≠an ser accesibles de forma predeterminada para nadie, quiero tener alg√∫n tipo de mecanismo de control estricto. </li><li>  Es posible dar la funci√≥n a otra aplicaci√≥n con un n√∫mero m√≠nimo de gestos. </li><li>  Una transici√≥n l√≥gica a la multimodularidad y las mejores pr√°cticas para esta transici√≥n. </li></ul><br>  Habl√© espec√≠ficamente sobre la multimodularidad solo al final.  La alcanzaremos, no nos adelantaremos. <br><br><h2>  "Vivir de una nueva manera" </h2><br>  Ahora intentaremos implementar gradualmente la lista de deseos anterior. <br>  Vamos! <br><br><h3>  Mejoras DI </h3><br>  Comencemos con la misma DI. <br><br><h4>  Rechazo de una gran cantidad de alcances </h4><br>  Como escrib√≠ anteriormente, antes de mi enfoque era este: para cada caracter√≠stica, su propio alcance.  De hecho, no hay beneficios especiales de esto.  Solo obtenga una gran cantidad de √°mbitos y una cierta cantidad de dolor de cabeza. <br>  Esta cadena es suficiente: <i>Singleton</i> - <i>PerFeature</i> - <i>PerScreen</i> . <br><br><h4>  Abandono de subcomponentes en favor de las dependencias de los componentes. </h4><br>  Ya es un punto m√°s interesante.  Con los <i>subcomponentes,</i> parece tener una jerarqu√≠a m√°s estricta, pero al mismo tiempo tiene las manos atadas por completo y no hay forma de maniobrar de alguna manera.  Adem√°s, <i>AppComponent</i> conoce todas las caracter√≠sticas, y tambi√©n obtienes una gran clase <i>DaggerAppComponent</i> generada. <br>  Con las <i>dependencias de los componentes,</i> obtienes una ventaja genial.  En las dependencias de componentes, puede especificar <b>no componentes, sino interfaces limpias</b> (gracias a Denis y Volodya).  Gracias a esto, puede sustituir cualquier implementaci√≥n de interfaz que desee, Dagger se comer√° todo.  Incluso si el componente con el mismo alcance es esta implementaci√≥n: <br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span>( dependencies = FeatureDependencies.class, modules = FeatureModule.class ) <span class="hljs-meta"><span class="hljs-meta">@PerFeature</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeatureComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } public interface FeatureDependencies { SomeDependency someDependency(); } @Component( modules = AnotherFeatureModule.class ) @PerFeature public abstract class AnotherFeatureComponent implements FeatureDependencies { // ... }</span></span></code> </pre> <br><br><h3>  De mejoras DI a mejoras arquitect√≥nicas </h3><br>  Repitamos la definici√≥n de caracter√≠sticas.  <b>Una caracter√≠stica</b> es un m√≥dulo de programa l√≥gicamente completo e independiente m√°ximo que resuelve un problema espec√≠fico del usuario, con dependencias externas claramente definidas, y que es relativamente f√°cil de reutilizar en otro programa.  Una de las expresiones clave en la definici√≥n de una caracter√≠stica es "con dependencias externas claramente definidas".  Por lo tanto, describamos todo lo que queremos del mundo exterior para las caracter√≠sticas, lo describiremos en una interfaz especial. <br>  Aqu√≠, digamos, la interfaz de dependencia externa de la funci√≥n Compras: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PurchaseFeatureDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">HttpClientApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">httpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  O la interfaz de dependencia externa de la funci√≥n de esc√°ner: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerFeatureDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">DbClientApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dbClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">HttpClientApi </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">httpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">SomeUtils </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">someUtils</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//       PurchaseInteractor purchaseInteractor(); }</span></span></code> </pre><br>  Como ya se mencion√≥ en la secci√≥n sobre DI, cualquiera puede implementar las dependencias y, como quiera, estas son interfaces puras y nuestras funciones se liberan de este conocimiento adicional. <br><br>  Otro componente importante de una caracter√≠stica "pura" es la presencia de una API clara, por la cual el mundo exterior puede acceder a la caracter√≠stica. <br>  Estas son las caracter√≠sticas de la API de compras: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PurchaseFeatureApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">PurchaseInteractor </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">purchaseInteractor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  Es decir, el mundo exterior puede obtener un <i>PurchaseInteractor</i> e intentar realizar una compra a trav√©s de √©l.  En realidad, arriba vimos que el esc√°ner necesitaba un <i>PurchaseInteractor</i> para completar la compra. <br><br>  Y aqu√≠ est√°n las caracter√≠sticas de la API del esc√°ner: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerFeatureApi</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">ScannerStarter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scannerStarter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre><br>  E inmediatamente traigo la interfaz y la implementaci√≥n de <i>ScannerStarter</i> : <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerStarter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span></span>; } <span class="hljs-meta"><span class="hljs-meta">@PerFeature</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerStarterImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerStarter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ScannerStarterImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ Class&lt;?&gt; cls = ScannerActivity.class; Intent intent = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, cls); intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); context.startActivity(intent); } }</code> </pre><br>  Es m√°s interesante aqu√≠.  El hecho es que el esc√°ner y el antirrobo son caracter√≠sticas bastante cerradas y aisladas.  En mi ejemplo, estas funciones se lanzan en Actividades separadas, con su propia navegaci√≥n, etc. Es decir, es suficiente para que simplemente comencemos la Actividad aqu√≠.  La actividad muere: la funci√≥n muere.  Puede trabajar seg√∫n el principio de "Actividad √∫nica", y luego a trav√©s de las caracter√≠sticas de la API pasar, digamos, un FragmentManager y alguna devoluci√≥n de llamada a trav√©s de la cual la caracter√≠stica informa que se ha completado.  Hay muchas variaciones <br>  Tambi√©n podemos decir que tenemos el derecho de considerar caracter√≠sticas como Scanner y Anti-Theft como aplicaciones independientes.  A diferencia de la caracter√≠stica de la compra, que es una adici√≥n de caracter√≠sticas a algo y por s√≠ misma, de alguna manera no existe particularmente.  S√≠, es independiente, pero es un complemento l√≥gico para otras caracter√≠sticas. <br><br>  Como puede imaginar, debe haber alg√∫n punto que conecte las caracter√≠sticas, su implementaci√≥n y las caracter√≠sticas necesarias de la dependencia.  Este punto es el componente Daga. <br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de un componente de funci√≥n del esc√°ner:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(modules = { ScannerFeatureModule.class, ScreenNavigationModule.class <span class="hljs-comment"><span class="hljs-comment">// ScannerFeatureDependencies - api    }, dependencies = ScannerFeatureDependencies.class) @PerFeature // ScannerFeatureApi - api   public abstract class ScannerFeatureComponent implements ScannerFeatureApi { private static volatile ScannerFeatureComponent sScannerFeatureComponent; //   public static ScannerFeatureApi initAndGet( ScannerFeatureDependencies scannerFeatureDependencies) { if (sScannerFeatureComponent == null) { synchronized (ScannerFeatureComponent.class) { if (sScannerFeatureComponent == null) { sScannerFeatureComponent = DaggerScannerFeatureComponent.builder() .scannerFeatureDependencies(scannerFeatureDependencies) .build(); } } } return sScannerFeatureComponent; } //           public static ScannerFeatureComponent get() { if (sScannerFeatureComponent == null) { throw new RuntimeException( "You must call 'initAndGet(ScannerFeatureDependenciesComponent scannerFeatureDependenciesComponent)' method" ); } return sScannerFeatureComponent; } //    (   ) public void resetComponent() { sScannerFeatureComponent = null; } public abstract void inject(ScannerActivity scannerActivity); //         Moxy public abstract ScannerScreenComponent scannerScreenComponent(); }</span></span></code> </pre><br></div></div><br>  No creo nada nuevo para ti. <br><br><h3>  Transici√≥n a la multimodularidad </h3><br>  Entonces, usted y yo pudimos definir claramente los l√≠mites de la funci√≥n a trav√©s de la API de sus dependencias y la API externa.  Tambi√©n descubrimos c√≥mo ponerlo todo en Dagger.  Y ahora llegamos al siguiente paso l√≥gico e interesante: la divisi√≥n en m√≥dulos. <br>  Abra un caso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prueba de</a> inmediato, ser√° m√°s f√°cil. <br>  Veamos la imagen en general: <br><img src="https://habrastorage.org/webt/qq/uw/bg/qquwbgerknuk95cjefxfxqserxi.png"><br>  Y mire la estructura del paquete del ejemplo: <br><img src="https://habrastorage.org/webt/cs/_a/4a/cs_a4ap7km-ivyxwzk615blftby.png"><br>  Ahora hablemos con cuidado cada elemento. <br><br>  En primer lugar, vemos cuatro bloques grandes: <b>Aplicaci√≥n</b> , <b>API</b> , <b>Impl</b> y <b>Utils</b> .  En las <i>API</i> , <i>Impl</i> y <i>Utils,</i> puede observar que todos los m√≥dulos comienzan en <b>core-</b> o <b>feature-</b> .  Hablemos de ellos primero. <br><br><h4>  Separaci√≥n en n√∫cleo y caracter√≠stica </h4><br>  <i>Divido</i> todos los m√≥dulos en dos categor√≠as: <i>n√∫cleo</i> y <i>funci√≥n</i> . <br>  En <i>caracter√≠sticas</i> , como habr√°s adivinado, nuestras caracter√≠sticas.  En el <b>n√∫cleo, existen</b> cosas como utilidades, trabajar con una red, bases de datos, etc. Pero no hay interfaces de funciones all√≠.  Y el <i>n√∫cleo</i> no es un monolito.  Estoy a favor de dividir el <i>m√≥dulo central</i> en piezas l√≥gicas y no cargarlo con otras interfaces de funciones. <br>  En el nombre del m√≥dulo, primero escriba <i>core</i> o <i>caracter√≠stica</i> .  Adem√°s en el nombre del m√≥dulo hay un nombre l√≥gico ( <i>esc√°ner</i> , <i>red</i> , etc.). <br><br><h4>  Ahora unos cuatro bloques grandes: Aplicaci√≥n, API, Impl y Utils. </h4><br>  <b>API</b> <br>  Cada <i>caracter√≠stica</i> o <i>m√≥dulo principal se</i> divide en <i>API</i> e <i>Impl</i> .  La <i>API</i> contiene una API externa a trav√©s de la cual puede acceder a una funci√≥n o n√∫cleo.  Solo esto, y nada m√°s: <br><img src="https://habrastorage.org/webt/8_/gz/0c/8_gz0ckdfivle1avlexldnj_mdc.png"><br>  Adem√°s, el <i>m√≥dulo api</i> no sabe nada de nadie, es un m√≥dulo absolutamente aislado. <br><br>  <b>Utils</b> <br>  La √∫nica excepci√≥n a la regla anterior puede considerarse algunas cosas completamente utilitarias, que no tiene sentido dividir en API e implementaci√≥n. <br><br>  <b>Impl</b> <br>  Aqu√≠ tenemos una subdivisi√≥n en <i>core-impl</i> y <i>feature-impl</i> . <br>  Los m√≥dulos en <i>core-impl</i> tambi√©n <i>son</i> completamente independientes.  Su √∫nica dependencia es el <i>m√≥dulo api</i> .  Por ejemplo, eche un vistazo a <i>build.gradle del m√≥dulo</i> <i>core-db-impl</i> : <br><pre> <code class="hljs powershell">// bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> dependencies { implementation project(<span class="hljs-string"><span class="hljs-string">':core-db-api'</span></span>) // bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> }</code> </pre><br>  Ahora sobre <i>feature-impl</i> .  Ya existe la mayor parte de la l√≥gica de la aplicaci√≥n.  Los m√≥dulos del grupo de <i>caracter√≠sticas impl√≠citas</i> pueden conocer los m√≥dulos de la <i>API</i> o el grupo de <i>Utils</i> , pero ciertamente no saben nada sobre los otros m√≥dulos del grupo <i>Impl</i> . <br>  Como recordamos, todas las dependencias externas de la caracter√≠stica se acumulan en las dependencias externas.  Por ejemplo, para una funci√≥n de Escaneo, esta API tiene el siguiente aspecto: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerFeatureDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// core-db-api DbClientApi dbClient(); // core-network-api HttpClientApi httpClient(); // core-utils SomeUtils someUtils(); // feature-purchase-api PurchaseInteractor purchaseInteractor(); }</span></span></code> </pre><br>  En consecuencia, <i>build.gradle feature-scanner-impl</i> ser√° as√≠: <br><pre> <code class="hljs powershell">// bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> dependencies { implementation project(<span class="hljs-string"><span class="hljs-string">':core-utils'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-network-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-db-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-purchase-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-scanner-api'</span></span>) // bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> }</code> </pre><br>  Puede preguntar, ¬øpor qu√© la API de las dependencias externas no est√° en el m√≥dulo API?  El hecho es que este es un detalle de implementaci√≥n.  Es decir, es una implementaci√≥n particular que necesita algunas dependencias espec√≠ficas.  Para el esc√°ner de API de dependencia est√° aqu√≠: <br><img src="https://habrastorage.org/webt/8y/7o/fj/8y7ofjd9oxd344hzqua8xcqtdci.png"><br><br>  <b>Peque√±o retiro arquitect√≥nico</b> <br>  Analicemos todo lo anterior y comprendamos por nosotros mismos algunos puntos arquitect√≥nicos con respecto a la <i>caracter√≠stica -...- impl-modules</i> y sus dependencias en otros m√≥dulos. <br>  Conoc√≠ dos de los patrones de mapeo de dependencias m√°s populares para un m√≥dulo: <br><br><ul><li>  Un m√≥dulo puede saber sobre cualquiera.  No hay reglas  No hay nada que comentar. </li><li>  Los m√≥dulos solo saben sobre el <i>m√≥dulo central</i> .  Y en el <i>m√≥dulo central</i> todas las interfaces de todas las caracter√≠sticas est√°n concentradas.  Este enfoque no es muy atractivo para m√≠, ya que existe el riesgo de convertir el <i>n√∫cleo</i> en otro basurero.  Adem√°s, si queremos transferir nuestro m√≥dulo a otra aplicaci√≥n, necesitaremos copiar estas interfaces en otra aplicaci√≥n y tambi√©n colocarlo en el <i>n√∫cleo</i> .  El est√∫pido copiar y pegar de las interfaces en s√≠ mismo no es muy atractivo y reutilizable en el futuro, cuando las interfaces se pueden actualizar. </li></ul><br>  En nuestro ejemplo, defiendo el conocimiento de los m√≥dulos api y solo api (bueno, utils-groups).  Las caracter√≠sticas no saben nada sobre implementaciones. <br><br>  Pero resulta que las funciones pueden conocer otras funciones (a trav√©s de la API, por supuesto) y ejecutarlas.  ¬øPodr√≠a ser un desastre? <br>  Comentario justo  Es dif√≠cil elaborar algunas reglas s√∫per claras.  Debe haber una medida en todo.  Ya hemos tocado este tema un poco m√°s arriba, dividiendo las caracter√≠sticas en independientes (esc√°ner y antirrobo), completamente independientes y separadas, y caracter√≠sticas "en contexto", es decir, siempre se lanzan como parte de algo (compras) y generalmente implican l√≥gica de negocios sin ui  Es por eso que Scanner y Anti-Theft est√°n al tanto de las compras. <br>  Otro ejemplo.  Imagine que en Anti-Theft existe algo as√≠ como borrar datos, es decir, borrar absolutamente todos los datos del tel√©fono.  Hay mucha l√≥gica de negocios, ui, est√° completamente aislada.  Por lo tanto, es l√≥gico asignar datos de borrado como una caracter√≠stica separada.  Y luego el tenedor.  Si los datos de borrado siempre se inician solo desde Anti-Theft y siempre est√°n presentes en Anti-Theft, es l√≥gico que Anti-Theft conozca los datos de borrado y los ejecute por s√≠ mismo.  Y el m√≥dulo acumulativo, la aplicaci√≥n, solo sabr√≠a sobre Anti-Theft.  Pero si los datos de borrado pueden comenzar en otro lugar o no siempre est√°n presentes en Anti-Theft (es decir, pueden ser diferentes en diferentes aplicaciones), entonces es l√≥gico que Anti-theft no conozca esta caracter√≠stica y solo diga algo externo (a trav√©s del enrutador, a trav√©s de alguna devoluci√≥n de llamada, no importa) que el usuario haya presionado tal bot√≥n y qu√© lanzar debajo de √©l ya es asunto del consumidor de la funci√≥n Antirrobo (aplicaci√≥n espec√≠fica, aplicaci√≥n espec√≠fica). <br><br>  Tambi√©n hay una pregunta interesante sobre la transferencia de funciones a otra aplicaci√≥n.  Si, por ejemplo, queremos transferir el esc√°ner a otra aplicaci√≥n, tambi√©n debemos transferir adem√°s de los m√≥dulos <i>: feature-scanner-api</i> y <i>: feature-scanner-impl</i> y los m√≥dulos de los que depende el esc√°ner ( <i>: core-utils ,: core-network- api ,: core-db-api ,: feature-adquirir-api</i> ). <br>  Si pero!  En primer lugar, todos sus m√≥dulos api son completamente independientes y solo hay interfaces y modelos de datos.  Sin l√≥gica  Y estos m√≥dulos est√°n claramente separados l√≥gicamente, y <i>: core-utils</i> suele ser un m√≥dulo com√∫n para todas las aplicaciones. <br>  En segundo lugar, puede recopilar m√≥dulos de api en forma de aar y entregarlos a trav√©s de Maven a otra aplicaci√≥n, o puede conectarlos en forma de un subm√≥dulo de concierto.  Pero tendr√° versiones, habr√° control, habr√° integridad. <br>  Por lo tanto, la reutilizaci√≥n del m√≥dulo (m√°s precisamente, el m√≥dulo de implementaci√≥n) en otra aplicaci√≥n parece mucho m√°s simple, m√°s claro y m√°s seguro. <br><br><h4>  Solicitud </h4><br>  Parece que tenemos una imagen delgada y comprensible con caracter√≠sticas, m√≥dulos, sus dependencias y eso es todo.  Ahora llegamos a un cl√≠max: esta es una combinaci√≥n de api y sus implementaciones, sustituyendo todas las dependencias necesarias, etc., pero desde el punto de vista de los m√≥dulos de Gredloi.  El punto de conexi√≥n suele ser la propia <i>aplicaci√≥n</i> . <br>  Por cierto, en nuestro ejemplo, este punto sigue siendo <i>feature-scanner-example</i> .  El enfoque anterior le permite ejecutar cada una de sus funciones como una aplicaci√≥n separada, lo que ahorra mucho tiempo de compilaci√≥n durante el desarrollo activo.  Belleza! <br><br>  Para empezar, consideremos c√≥mo sucede todo a trav√©s de la <i>aplicaci√≥n</i> con el ejemplo del ya querido Scanner. <br><div class="spoiler">  <b class="spoiler_title">Recupere r√°pidamente la funci√≥n:</b> <div class="spoiler_text">  La API de dependencias externas de Sci es: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerFeatureDependencies</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// core-db-api DbClientApi dbClient(); // core-network-api HttpClientApi httpClient(); // core-utils SomeUtils someUtils(); // feature-purchase-api PurchaseInteractor purchaseInteractor(); }</span></span></code> </pre><br>  Por lo tanto <i>: feature-scanner-impl</i> depende de los siguientes m√≥dulos: <br><pre> <code class="hljs powershell">// bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> dependencies { implementation project(<span class="hljs-string"><span class="hljs-string">':core-utils'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-network-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-db-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-purchase-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-scanner-api'</span></span>) // bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> }</code> </pre><br></div></div><br>  En base a esto, podemos crear un componente Dagger que implemente una API de dependencias externas: <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(dependencies = { CoreUtilsApi.class, CoreNetworkApi.class, CoreDbApi.class, PurchaseFeatureApi.class }) <span class="hljs-meta"><span class="hljs-meta">@PerFeature</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerFeatureDependenciesComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScannerFeatureDependencies</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br>  <i>Coloqu√©</i> esta interfaz en <i>ScannerFeatureComponent</i> por conveniencia: <br><pre> <code class="hljs pgsql">@Component(modules = { ScannerFeatureModule.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, ScreenNavigationModule.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> }, dependencies = ScannerFeatureDependencies.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>) @PerFeature <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> abstract <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ScannerFeatureComponent implements ScannerFeatureApi { // bla-bla-bla @Component(dependencies = { CoreUtilsApi.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, CoreNetworkApi.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, CoreDbApi.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>, PurchaseFeatureApi.<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> }) @PerFeature interface ScannerFeatureDependenciesComponent extends ScannerFeatureDependencies { } }</code> </pre><br><br>  Ahora la aplicaci√≥n.  La aplicaci√≥n conoce todos los m√≥dulos que necesita ( <i>core-, feature-, api, impl</i> ): <br><pre> <code class="hljs powershell">// bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> dependencies { implementation project(<span class="hljs-string"><span class="hljs-string">':core-utils'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-db-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-db-impl'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-network-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':core-network-impl'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-scanner-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-scanner-impl'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-antitheft-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-antitheft-impl'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-purchase-api'</span></span>) implementation project(<span class="hljs-string"><span class="hljs-string">':feature-purchase-impl'</span></span>) // bla<span class="hljs-literal"><span class="hljs-literal">-bla</span></span><span class="hljs-literal"><span class="hljs-literal">-bla</span></span> }</code> </pre><br>  A continuaci√≥n, cree una clase auxiliar.  Por ejemplo, <i>FeatureProxyInjector</i> .  Ayudar√° a inicializar correctamente todos los componentes, y es a trav√©s de esta clase que pasaremos a las caracter√≠sticas.  Veamos c√≥mo se inicializa el componente de la funci√≥n del esc√°ner: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FeatureProxyInjector</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// another... public static ScannerFeatureApi getFeatureScanner() { return ScannerFeatureComponent.initAndGet( DaggerScannerFeatureComponent_ScannerFeatureDependenciesComponent.builder() .coreDbApi(CoreDbComponent.get()) .coreNetworkApi(CoreNetworkComponent.get()) .coreUtilsApi(CoreUtilsComponent.get()) .purchaseFeatureApi(featurePurchaseGet()) .build() ); } }</span></span></code> </pre><br>  Exteriormente, le damos la interfaz de caracter√≠sticas ( <i>ScannerFeatureApi</i> ), y en el interior simplemente inicializamos todo el gr√°fico de dependencia de implementaci√≥n (a trav√©s del <i>m√©todo ScannerFeatureComponent.initAndGet (...)</i> ). <br>  <i>DaggerPurchaseComponent_PurchaseFeatureDependenciesComponent</i> es la implementaci√≥n del <i>componente</i> <i>PurchaseFeatureDependenciesComponent</i> generado por Dagger, del que hablamos anteriormente, donde sustituimos la implementaci√≥n de api-m√≥dulos en el constructor. <br>  Eso es todo magia.  Ver el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo</a> nuevamente. <br><br>  Hablando de <i>ejemplo</i> .  Por <i>ejemplo,</i> tambi√©n debemos satisfacer todas las dependencias externas <i>: feature-scanner-impl</i> .  Pero como este es un ejemplo, podemos sustituir las clases ficticias. <br>  C√≥mo se ver√°: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     ScannerFeatureDependencies public class ScannerFeatureDependenciesFake implements ScannerFeatureDependencies { @Override public DbClientApi dbClient() { return new DbClientFake(); } @Override public HttpClientApi httpClient() { return new HttpClientFake(); } @Override public SomeUtils someUtils() { return CoreUtilsComponent.get().someUtils(); } @Override public PurchaseInteractor purchaseInteractor() { return new PurchaseInteractorFake(); } } //  -  Application-   public class ScannerExampleApplication extends Application { @Override public void onCreate() { super.onCreate(); ScannerFeatureComponent.initAndGet( // ,     =) new ScannerFeatureDependenciesFake() ); } }</span></span></code> </pre><br>  Y la funci√≥n del esc√°ner en s√≠, por <i>ejemplo, se</i> inicia a trav√©s del manifiesto, para no bloquear la actividad vac√≠a adicional: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.scanner_example"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ScannerExampleApplication"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:allowBackup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/app_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:roundIcon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_launcher_round"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:supportsRtl</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/AppTheme"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.example.scanner.presentation.view.ScannerActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">application</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">manifest</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h2>  Algoritmo de transici√≥n de monomodularidad a multimodularidad. </h2><br>  La vida es una cosa dura.  Y la realidad es que todos trabajamos con Legacy.  Si alguien ahora est√° aserrando un nuevo proyecto, donde puedes bendecir todo inmediatamente, entonces te envidio, hermano.  Pero este no es el caso conmigo, y ese tipo tambi√©n est√° equivocado =). <br><br>  ¬øC√≥mo traducir su aplicaci√≥n a varios m√≥dulos?  Escuch√© principalmente sobre dos opciones. <br>  El primero  Particionando la aplicaci√≥n aqu√≠ y ahora.  Es cierto que su proyecto no puede ser ensamblado por un mes o dos =). <br>  Segunda.  Intenta sacar las caracter√≠sticas gradualmente.  Pero al mismo tiempo, se extienden todo tipo de dependencias de estas caracter√≠sticas.  Y aqu√≠ comienza la diversi√≥n.  El c√≥digo de dependencia puede extraer otro c√≥digo, todo migra al <i>m√≥dulo com√∫n</i> , al <i>m√≥dulo central</i> y viceversa, y as√≠ sucesivamente.  Como resultado, extraer una caracter√≠stica puede implicar trabajar con otra buena mitad de la aplicaci√≥n.  Y nuevamente, al principio, su proyecto no reunir√° un per√≠odo de tiempo decente. <br><br>  Abogo por la transferencia gradual de la aplicaci√≥n a la multimodularidad, ya que en paralelo todav√≠a necesitamos ver nuevas caracter√≠sticas.  La idea clave es que <b>si su m√≥dulo necesita algunas de las dependencias, no debe arrastrar este c√≥digo inmediatamente a los m√≥dulos tambi√©n f√≠sicamente</b> .  Veamos el algoritmo de eliminaci√≥n de m√≥dulos usando el esc√°ner como ejemplo: <br><br><ul><li>  Cree funciones de API, col√≥quelo en un nuevo m√≥dulo de API.  Es decir, para crear completamente un m√≥dulo <i>: feature-scanner-api</i> con todas las interfaces. </li><li>  Crear <i>: caracter√≠stica-esc√°ner-impl</i> .  Transfiera f√≠sicamente todo el c√≥digo relacionado con la funci√≥n a este m√≥dulo.  De todo lo que depende su funci√≥n, el estudio lo resaltar√° de inmediato. </li><li>  Identificar dependencias de caracter√≠sticas externas.  Crea interfaces apropiadas.  Estas interfaces se dividen en api-m√≥dulos l√≥gicos.  Es decir, en nuestro ejemplo, cree los m√≥dulos <i>: core-utils ,: core-network-api ,: core-db-api ,: feature-adquirir-api</i> con las interfaces correspondientes. <br>  Le aconsejo que invierta inmediatamente en el nombre y el significado de los m√≥dulos.  Est√° claro que con el tiempo, las interfaces y los m√≥dulos se pueden mezclar un poco, colapsar, etc., esto es normal. </li><li>  Cree una API de dependencias externas ( <i>ScannerFeatureDependencies</i> ).  Dependiendo <i>: feature-scanner-impl</i> registra m√≥dulos api reci√©n creados. </li><li>  Como tenemos todo el legado en la <i>aplicaci√≥n</i> , esto es lo que hacemos.  En la <i>aplicaci√≥n,</i> conectamos todos los m√≥dulos creados para la funci√≥n (m√≥dulo de API de funciones, m√≥dulo de impl de funciones, m√≥dulos de API de dependencia externa de funciones). <br>  <b>Punto super importante</b> .  A continuaci√≥n, en la <i>aplicaci√≥n,</i> creamos implementaciones de todas las interfaces de dependencia de caracter√≠sticas necesarias (Scanner en nuestro ejemplo).  Estas implementaciones probablemente ser√°n solo representantes de las dependencias de la API para la implementaci√≥n actual de estas dependencias en el proyecto.  Al inicializar un componente de caracter√≠stica, sustituya los datos de implementaci√≥n. <br>  Dif√≠cil en palabras, ¬øquieres un ejemplo?  ¬°Entonces ya lo est√°!  De hecho, algo similar ya existe en feature-scanner-example.  Una vez m√°s, le dar√© un c√≥digo ligeramente adaptado: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     ScannerFeatureDependencies  app- public class ScannerFeatureDependenciesLegacy implements ScannerFeatureDependencies { @Override public DbClientApi dbClient() { return new DbClientLegacy(); } @Override public HttpClientApi httpClient() { // -  // ,      return NetworkFabric.createHttpClientLegacy(); } @Override public SomeUtils someUtils() { return new SomeUtils(); } @Override public PurchaseInteractor purchaseInteractor() { return new PurchaseInteractorLegacy(); } } //  -   ScannerFeatureComponent.initAndGet( new ScannerFeatureDependenciesLegacy() );</span></span></code> </pre><br>  Es decir, el mensaje principal aqu√≠ es este.  Deje que todo el c√≥digo externo necesario para la funci√≥n viva en la <i>aplicaci√≥n</i> , como lo hizo.  Y la caracter√≠stica en s√≠ ya funcionar√° de la manera normal, a trav√©s de api (es decir, dependencias de api y m√≥dulos de api).  En el futuro, la implementaci√≥n se mover√° gradualmente a los m√≥dulos.  Pero luego evitaremos un juego interminable arrastrando desde el m√≥dulo al m√≥dulo el c√≥digo externo necesario para la funci√≥n.  ¬°Podemos movernos en iteraciones claras! </li><li>  Ganancia </li></ul><br>  Aqu√≠ hay un algoritmo tan simple pero funcional que le permite avanzar hacia su objetivo paso a paso. <br><br><h3>  Consejos adicionales </h3><br>  <b>¬øQu√© tan grandes / peque√±as deber√≠an ser las caracter√≠sticas?</b> <br>  Todo depende del proyecto, etc.  Pero al comienzo de la transici√≥n a la multimodularidad, le aconsejo que se divida en piezas grandes.  Adem√°s, si es necesario, seleccionar√° m√°s m√≥dulos de estos m√≥dulos.  Pero no triturar.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No haga esto: una / varias clases = un m√≥dulo. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pureza del m√≥dulo de la aplicaci√≥n</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Al cambiar a la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n de</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> varios m√≥dulos </font><font style="vertical-align: inherit;">, tendremos bastante y, a partir de ah√≠, sus caracter√≠sticas resaltadas se contraer√°n. Es posible que durante el trabajo tenga que hacer cambios a este legado, para terminar algo all√≠, bueno, o simplemente tenga una versi√≥n, y no est√© a la altura de los cortes en los m√≥dulos. En este caso, desea que la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , y con todo el Legacy, conozca las caracter√≠sticas destacadas solo a trav√©s de la API, sin conocimiento de las implementaciones. Pero </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , de hecho, se combina </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">con API</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">impl-ins</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pero debido a que la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sabe todo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este caso, puede crear un m√≥dulo especial</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: adaptador</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que ser√° solo el punto de conexi√≥n de api e impl, y luego la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solo sabr√° sobre api. </font><font style="vertical-align: inherit;">Creo que la idea es clara. </font><font style="vertical-align: inherit;">Puedes ver un ejemplo en la rama </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clean_app</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Agregar√© que con Moxy, o m√°s bien MoxyReflector, hay algunos problemas al dividirme en m√≥dulos, por lo que tuve que crear otro m√≥dulo adicional </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: stub-moxy-java</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Una ligera pizca de magia, sin ella. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La √∫nica enmienda. </font><font style="vertical-align: inherit;">Esto funcionar√° solo cuando su caracter√≠stica y dependencias relacionadas ya est√©n transferidas f√≠sicamente a otros m√≥dulos. </font><font style="vertical-align: inherit;">Si realiz√≥ una funci√≥n, pero las dependencias a√∫n viven en la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aplicaci√≥n</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , como en el algoritmo anterior, entonces esto no funcionar√°.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ep√≠logo </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El art√≠culo result√≥ bastante grande. </font><font style="vertical-align: inherit;">Pero espero que realmente te ayude en la lucha contra la monomodularidad, entendiendo c√≥mo deber√≠a ser y c√≥mo hacer amigos con DI. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si est√° interesado en sumergirse en un problema con la velocidad de construcci√≥n, c√≥mo medir todo, le recomiendo informes de Denis Neklyudov y Zhenya Suvorov (Mobius 2018 Piter, los videos a√∫n no est√°n disponibles p√∫blicamente). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre Gradle </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vova Tagakov</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> demostr√≥ perfectamente la diferencia entre api e implementaci√≥n en </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">gradle</font></a><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si desea reducir la repetitiva de m√∫ltiples m√≥dulos, puede comenzar aqu√≠ con </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">este art√≠culo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estar√© encantado de comentarios, correcciones, as√≠ como me gusta! </font><font style="vertical-align: inherit;">Todo el c√≥digo limpio!</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es422555/">https://habr.com/ru/post/es422555/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es422545/index.html">Formas de sincronizar las pesta√±as del navegador</a></li>
<li><a href="../es422547/index.html">Para eliminar Spectre y Meltdown, es posible que deba crear un tipo de procesador completamente nuevo.</a></li>
<li><a href="../es422549/index.html">Corda: Kotlin</a></li>
<li><a href="../es422551/index.html">C√≥mo robar dinero de una tarjeta sin contacto y Apple Pay</a></li>
<li><a href="../es422553/index.html">La extensi√≥n oficial del navegador Mega roba datos de intercambio de archivos y criptomonedas</a></li>
<li><a href="../es422561/index.html">C√≥mo Yandex aplic√≥ la visi√≥n por computadora para mejorar la calidad de las transmisiones de video. Tecnolog√≠a DeepHD</a></li>
<li><a href="../es422565/index.html">Seminarios web de Skillbox Friday: todo para programadores y dise√±adores</a></li>
<li><a href="../es422569/index.html">Aplicaci√≥n de seguimiento horario</a></li>
<li><a href="../es422571/index.html">Paralelizaci√≥n de tareas con dependencias: ejemplo de .NET</a></li>
<li><a href="../es422573/index.html">La ingenier√≠a inversa de la representaci√≥n de The Witcher 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>