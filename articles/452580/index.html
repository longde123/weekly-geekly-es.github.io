<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèø üö∂üèº üë®üèø‚Äçüíª 20 proyectos, 20 idiomas, fecha l√≠mite ayer. Parte 3 üëÅ‚Äçüó® üëãüèæ üñºÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Art√≠culo final sobre la integraci√≥n de Serge + Smartcat . En este art√≠culo, le dir√© c√≥mo escalamos a Serge a toda la empresa, consideramos 4 integraci...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>20 proyectos, 20 idiomas, fecha l√≠mite ayer. Parte 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452580/"> Art√≠culo final sobre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">integraci√≥n de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Serge</a> + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Smartcat</a> .  En este art√≠culo, le dir√© c√≥mo escalamos a Serge a toda la empresa, consideramos 4 integraciones no est√°ndar y, como beneficio adicional, hablaremos de 2 caracter√≠sticas que pueden simplificar su vida. <br><br>  Art√≠culos anteriores: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">20 proyectos, 20 idiomas, fecha l√≠mite ayer</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">20 proyectos, 20 idiomas, fecha l√≠mite ayer.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 2</a> <br><a name="habracut"></a><br><h2>  Escalabilidad </h2><br>  En un art√≠culo anterior, habl√© sobre c√≥mo configurar Serge para un √∫nico repositorio.  En nuestra empresa, tenemos varias docenas de repositorios que necesitan traducciones, por lo que se asign√≥ un servidor separado para la localizaci√≥n.  La estructura y el entorno del archivo son completamente id√©nticos a los descritos en el art√≠culo anterior.  Cada repositorio usa su propia instancia de Serge.  Para no ejecutar comandos manualmente, cada instancia tiene una corona, que ejecuta sucesivamente los comandos de Serge: recibir nuevas l√≠neas del repositorio, recibir nuevas traducciones, analizar, enviar nuevas l√≠neas a Smartcat y enviar nuevas traducciones a Gitlab. <br><br><h2>  Opciones de integraci√≥n </h2><br><h3>  Dos conjuntos de idiomas en un repositorio. </h3><br>  Comencemos con el caso m√°s simple.  Imagine que su repositorio tiene varios conjuntos de archivos de recursos.  Por ejemplo, las cadenas de cliente y las API de aplicaci√≥n se almacenan en el mismo repositorio, pero en directorios diferentes.  El cliente se traduce a 20 idiomas, la API a 6. <br><br>  <b>Objetivo</b> : organizar un suministro independiente de traducciones en cada uno de los directorios. <br>  <b>Soluci√≥n</b> : <br><br><ol><li>  Configure 2 proyectos en Smartcat: en 6 idiomas y en 20. </li><li>  Configure 2 proyectos en el servidor de localizaci√≥n. </li><li>  En el primer proyecto, agregue la l√≠nea <i>our $ unmerged_branch_mask = '^ (translateAPI-)'</i> en el archivo <b>project1.cfg</b> <i>;</i>  <i># procesar ramas no fusionadas que coinciden con esta m√°scara</i> , donde " <i>translateAPI-</i> " es el prefijo del nombre de la rama.  El prefijo le indicar√° a Serge que esta rama necesita traducciones en el directorio API. </li><li>  En el archivo <b>project1.serge.tmpl</b> , especifique la ruta a los archivos de recursos en el directorio API en el par√°metro <i>source_dir</i> . </li><li>  Del mismo modo, para el segundo proyecto en el archivo <b>project2.cfg</b> agregue la l√≠nea <i>our $ unmerged_branch_mask = '^ (translateCLIENT-)';</i>  <i># procesar ramas no fusionadas que coinciden con esta m√°scara</i> , donde " <i>translateCLIENT</i> " es el prefijo para las ramas de este proyecto.  El prefijo le indicar√° a Serge que esta rama necesita traducciones en el directorio del Cliente. </li><li>  En el archivo <b>project2.serge.tmpl</b> , especifique la ruta a los archivos de recursos en el directorio CLIENTE en el par√°metro <i>source_dir</i> . </li></ol><br>  Tenga en cuenta que los prefijos deben ser √∫nicos entre todos los proyectos configurados para un repositorio. <br><br>  En total, tenemos 2 proyectos en Smartcat y 2 proyectos correspondientes en el servidor de localizaci√≥n.  Ambos proyectos miran el mismo repositorio en Gitlab, pero en diferentes directorios.  Serge, usando el prefijo de rama, entiende qu√© l√≠neas necesita enviar para traducir.  Para calcular la diferencia, se usa la misma rama de traducci√≥n base. <br><br><h3>  Swagger de localizaci√≥n </h3><br>  En nuestra empresa, todos los productos, incluida la documentaci√≥n, est√°n localizados.  Ahora estamos introduciendo la generaci√≥n autom√°tica de documentaci√≥n de swagger, y nos enfrentamos a la necesidad de localizarla. <br>  <b>Tarea</b> : localizar swagger con un m√≠nimo esfuerzo. <br><br>  <b>Soluci√≥n</b> : en el archivo <b>myproject.tmpl.serge</b> , agregue el objeto de <i>datos al</i> objeto <i>analizador</i> y enumere en √©l los campos cuyo valor debe extraerse y enviarse para su traducci√≥n: <br><br><pre><code class="bash hljs">parser { plugin parse_json data { path_matches \/(summary|description)$ } }</code> </pre> <br>  <b>Una tarea similar</b> : es necesario traducir textos de un archivo, pero no todos, sino solo los legales.  Otros textos son proporcionados por un equipo de marketing.  Para no complicar la estructura y no crear un archivo adicional para textos legales, las claves de todas las l√≠neas legales recibieron el prefijo "legal": <br><br><pre> <code class="bash hljs">parser { plugin parse_json data { path_matches ^\/legal\..* } }</code> </pre><br><h3>  Sutilezas de las traducciones legales </h3><br>  Otro caso interesante.  Tenemos un documento legal, cuyos t√©rminos var√≠an de un pa√≠s a otro.  Pero, sin embargo, esta es una aplicaci√≥n y los archivos de recursos est√°n en el mismo directorio. <br><br>  <b>Objetivo</b> : en el marco de un proyecto para traducir varios documentos, cada documento debe traducirse a un idioma espec√≠fico. <br><br>  <b>Lo que se ha hecho</b> : <br><br><ol><li>  Se cre√≥ un directorio apropiado para cada pa√≠s, dentro del cual se encontraba un archivo fuente en ingl√©s relevante para ese pa√≠s. </li><li>  La ruta de la variable <i>source_dir se</i> especifica en el directorio compartido con archivos de recursos. </li><li>  <i>Permitimos</i> la b√∫squeda de archivos de recursos en todos los <i>subdirectorios</i> : <i>source_process_subdirs YES</i> </li><li>  Agregamos un nuevo complemento a la lista de complementos llamados, que le permite enviar cada archivo de recursos espec√≠fico al idioma deseado.  Como gu√≠a, use el nombre del directorio donde se encuentra: </li></ol><br><pre> <code class="bash hljs">callback_plugins { :feature_branch { plugin feature_branch data { master_job job.base-translate } } :limit_languages { plugin limit_languages data { <span class="hljs-comment"><span class="hljs-comment"># all rules are processed top to bottom; each rule can add or remove languages # so the most priority rules are placed at the bottom if { # by default, don't localize file_matches . then { exclude_all_languages YES } } if { file_matches de-au\/ then { include_languages de-AT } } if { file_matches li-LI\/ then { include_languages li } } if { file_matches pt\/ then { include_languages pt-BR } } if { file_matches zh-Hans\/ then { include_languages zh-Hans } } # and so on.. } }</span></span></code> </pre><br><h3>  Localizaci√≥n al almacenar filas en la base de datos </h3><br>  Nuestro sistema tiene una parte del c√≥digo que almacena las traducciones en la base de datos y, por varias razones, no puede pasar a archivos de recursos en el repositorio.  Sin embargo, necesitamos poder entregar traducciones de forma r√°pida y autom√°tica. <br><br>  <b>Tarea</b> : Organice un proceso de localizaci√≥n continua si las filas no se almacenan en el repositorio, sino en la base de datos. <br><br>  <b>Soluci√≥n</b> : <br><br><ol><li>  Cree un repositorio, recopile y agrupe en √©l todas las l√≠neas de la base de datos de acuerdo con el principio que nos resulte conveniente (por el n√∫mero de idiomas de traducci√≥n o por productos). </li><li>  Crea un proyecto en Smartcat. </li><li>  Comience el ciclo est√°ndar de localizaci√≥n continua. </li><li>  Combinar ramas de traducci√≥n en la rama base-traducir. </li><li>  Por corona, verifique el valor hash de la √∫ltima confirmaci√≥n en base-translate.  Si el hash ha cambiado, es decir, se han generado nuevas traducciones, analice diff entre el hash anterior y el actual, y env√≠e filas nuevas / modificadas a la base de datos. </li></ol><br><h2>  Caracter√≠sticas de bonificaci√≥n </h2><br><h3>  Alertas </h3><br>  Las alertas b√°sicas de Smartcat no eran adecuadas para nosotros, ya que cada equipo desea recibir notificaciones solo sobre sus sucursales y solo sobre la disponibilidad completa de las traducciones en todos los archivos de recursos del producto. <br><br>  Se decidi√≥ aprovechar la disponibilidad de todas las traducciones en el repositorio y, si est√°n completamente listas, enviar notificaciones al mensajero corporativo, en nuestro caso, Google Chat. <br><br>  <b>Tarea</b> : organizar alertas en el repositorio, donde 8 equipos pueden comprometerse, duplicar todas las alertas en el canal del departamento de documentaci√≥n t√©cnica. <br><br>  <b>Soluci√≥n</b> : <br><br><ol><li>  Acuerde con cada equipo que el nombre de las sucursales debe contener el nombre del equipo.  Todav√≠a use el prefijo translate- para indicar ramas que necesitan traducci√≥n. </li><li>  Cree una canalizaci√≥n que se ejecute solo para ramas con el prefijo translate-. </li><li>  En la tuber√≠a, determine a qu√© comando pertenece la rama, verifique la presencia de l√≠neas con un valor vac√≠o y, si no hay ninguna, env√≠e notificaciones de preparaci√≥n al canal apropiado.  Como el c√≥digo es bastante voluminoso, lo puse en un script. </li></ol><br><h4>  Ci </h4><br><pre> <code class="bash hljs">check-translations: stage: check-translations image: node:8.14.0 tags: - devops script: - chmod +x ./notification.sh - ./notification.sh only: - base-translate - /^translate.*$/ when: always</code> </pre><br><h4>  Gui√≥n de alerta </h4><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash hangouts(){ curl -X POST --max-time 180 -H "Content-Type: application/json; charset=UTF-8" --data "{ \"cards\": [{\"header\": {\"title\": \"LOCALIZATION IS READY\",\"subtitle\": \"REPOSITORY NAME\",\"imageUrl\": \"https://avatanplus.com/files/resources/mid/5775880ee27f8155a31b7a50.png\"},\"sections\": [{\"widgets\": [{\"keyValue\": {\"topLabel\": \"Translation is finished in the branch\",\"content\": \"$1\"}}]},{\"widgets\": [{\"buttons\": [{\"textButton\": {\"text\": \"SEE COMMIT\",\"onClick\": {\"openLink\": {\"url\": \"https://gitlab.loc/common/publisher-client/commit/$2\"}}}}]}]}]}]}" "$3" || true } cd app/translations if echo "$CI_COMMIT_REF_NAME" | grep "commandname1"; then grep -rl '\:\s\"\"' *.json &gt;&gt; result.file if [ -s network.file ]; then echo "Translations are not ready"; cat result.file else hangouts $CI_COMMIT_REF_NAME $CI_COMMIT_SHA $HANGOUTS_NOTIFICATIONS_COMMAND_NAME_1 hangouts $CI_COMMIT_REF_NAME $CI_COMMIT_SHA $HANGOUTS_NOTIFICATIONS_DOC fi fi if echo "$CI_COMMIT_REF_NAME" | grep "commandname2"; then grep -rl '\:\s\"\"' *.json &gt;&gt; result.file if [ -s result.file ]; then echo "Translations are not ready"; cat result.file else hangouts $CI_COMMIT_REF_NAME $CI_COMMIT_SHA $HANGOUTS_NOTIFICATIONS_COMMAND_NAME_2 hangouts $CI_COMMIT_REF_NAME $CI_COMMIT_SHA $HANGOUTS_NOTIFICATIONS_DOC fi fi ... if echo "$CI_COMMIT_REF_NAME" | grep "commandname8"; then grep -rl '\:\s\"\"' *.json &gt;&gt; result.file if [ -s result.file ]; then echo "Translations are not ready"; cat result.file else hangouts $CI_COMMIT_REF_NAME $CI_COMMIT_SHA $HANGOUTS_NOTIFICATIONS_COMMAND_NAME_8 hangouts $CI_COMMIT_REF_NAME $CI_COMMIT_SHA $HANGOUTS_NOTIFICATIONS_DOC fi fi</span></span></code> </pre><br><h3>  Asignaciones de traductor a trav√©s de Smartcat API </h3><br><img src="https://habrastorage.org/webt/to/a5/ix/toa5ixiw7yebxjc5v7ejuyqskmy.jpeg"><br><br>  As√≠ es como se ve nuestro gerente de localizaci√≥n cuando llega el momento de asignar todas las ramas para la traducci√≥n. <br><br>  En promedio, tenemos m√°s de 10 sucursales en nuestro trabajo todos los d√≠as.  En Smartcat, cada par de idiomas es un documento separado, y los traductores deben asignarse a cada documento.  Manualmente  Imag√≠nese: 40-60 citas todos los d√≠as.  Para simplificar este proceso, hicimos una cita a trav√©s de la API y tambi√©n la pusimos en marcha.  Este trabajo se inicia con el bot√≥n.  Una pregunta razonable: ¬øpor qu√© no hacer asignaciones autom√°ticas al enviar transferencias, y no hacer una llamada al m√©todo en el complemento Smartcat, y no en la tuber√≠a? <br><br>  Hay varias razones para esta decisi√≥n: <br><br><ol><li>  El factor humano.  A pesar de que construimos procesos y tratamos de adherirnos a ellos, las l√≠neas no le√≠das o las l√≠neas sin contexto entran regularmente en Smartcat.  La asignaci√≥n autom√°tica en este caso significar√≠a gastos adicionales para nosotros, ya que algunas l√≠neas se enviar√≠an para traducci√≥n dos veces: antes y despu√©s de la edici√≥n. </li><li>  Distribuci√≥n de roles.  Los proyectos son configurados y gestionados a nivel del servidor de localizaci√≥n por el ingeniero de localizaci√≥n o el escritor t√©cnico del proyecto.  Las citas y la comunicaci√≥n con los traductores son manejadas por el gerente de localizaci√≥n.  Por lo tanto, las tareas deben ser manejables, transparentes y accesibles a trav√©s de la GUI. </li></ol><br>  Soluci√≥n: cuando el gerente de localizaci√≥n considera que las l√≠neas en esta rama est√°n listas para la traducci√≥n, presiona un bot√≥n en Gitlab.  El equipo completo de traductores est√° asignado a esta rama.  La tarea la toma el traductor que respondi√≥ primero. <br><br><h4>  Ci </h4><br><pre> <code class="bash hljs">assignee: stage: assignee image: node:8.14.0 tags: - devops script: - chmod +x ./assignee.sh - ./assignee.sh only: - base-translate - /^translate.*$/ - assignee when: manual</code> </pre><br><h4>  Script de asignaci√≥n </h4><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash if echo "$CI_COMMIT_REF_NAME" | grep "translate-"; then node -pe "JSON.parse(process.argv[1]).documents.forEach(function(elem){ if(elem.name.indexOf(\"$CI_COMMIT_REF_NAME\") !== -1) { console.log(elem.id) } });" "$(curl -XGET -H "Authorization: Basic $SMARTCAT_API_KEY" -H "Content-type: application/json" "https://smartcat.ai/api/integration/v1/project/$SMARTCAT_PROJECT_ID")" &gt;&gt; documents fi sed '$d' documents &gt; documents.list while read LINE; do bash -c "curl -XPOST -H 'Authorization: Basic $SMARTCAT_API_KEY' -H "Content-type:application/json" -d '{"documentIds":[\""$LINE"\"],"stageNumber": 1}' 'https://smartcat.ai/api/integration/v1/document/assignFromMyTeam'";done &lt; documents.list</span></span></code> </pre><br>  Esto concluye mi serie de art√≠culos sobre integraci√≥n y configuraci√≥n de localizaciones continuas.  Estar√© encantado de responder cualquiera de sus preguntas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/452580/">https://habr.com/ru/post/452580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452566/index.html">Node.js para principiantes: los fundamentos de trabajar con archivos</a></li>
<li><a href="../452568/index.html">Un an√°lisis detallado de las nuevas caracter√≠sticas de React 16+, parte 1: informaci√≥n general</a></li>
<li><a href="../452570/index.html">Linux Install Fest - vista lateral</a></li>
<li><a href="../452572/index.html">EFORTH para MK-161: estructuras de datos</a></li>
<li><a href="../452576/index.html">Acerca de los introvertidos en TI</a></li>
<li><a href="../452584/index.html">Conceptos err√≥neos de los programadores sobre el tiempo Unix</a></li>
<li><a href="../452586/index.html">C√≥mo comenzar a programar en Adobe Illustrator. Primera parte</a></li>
<li><a href="../452590/index.html">El estadounidense cre√≥ un aula m√≥vil para ense√±ar a los ni√±os en escuelas de impresi√≥n 3D de bajo presupuesto, el proyecto ya ha recolectado m√°s de 100,000</a></li>
<li><a href="../452592/index.html">Parte 0. Requiere un elfo para trabajar en Matrix. La reubicaci√≥n es posible</a></li>
<li><a href="../452596/index.html">Se tomaron 735,000 direcciones IPv4 de un estafador y se devolvieron al registro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>