<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÜ ü§±üèª üëßüèª Ich bin es leid, Zahlungen √ºber WebView zu akzeptieren. Was kann ich tun? üßëüèΩ‚Äçü§ù‚Äçüßëüèº ü¶Ü üìè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich gehe mit dem Zug ins B√ºro - ich muss durch eine Station fahren, und ich werde fast da sein. 

 Jeden Morgen kaufe ich Bahntickets in der App und l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ich bin es leid, Zahlungen √ºber WebView zu akzeptieren. Was kann ich tun?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/416871/">  Ich gehe mit dem Zug ins B√ºro - ich muss durch eine Station fahren, und ich werde fast da sein. <br><br>  Jeden Morgen kaufe ich Bahntickets in der App und leide.  Dort ist es billiger, aber der Preisunterschied zahlt sich nicht f√ºr meine Schmerzen aus, wenn ich diese drei Minuten Stress durchmache.  Ohne auch nur die Ladezeit jedes der f√ºnf Bildschirme der Anwendung zu erw√§hnen, kann man nur sagen, dass WebView mit einer gespeicherten Karte bankiert wird, der Code per SMS w√§hrend des Laufs eingegeben wird und unerwartete Fehlfunktionen auftreten. <br><br>  Dies ist, wenn Sie in einem Zug fahren und sie sagen "Etwas ist schief gelaufen" und schreiben Geld ab, aber sie geben kein Ticket.  Eine R√ºckkehr kommt genau dort an, aber der Zug ist bereits abgefahren.  Dies geschieht mehrmals im Monat, unabh√§ngig von der Qualit√§t des Internets.  Es besteht keine Notwendigkeit, √ºber Aktien zu sprechen. <br><br><img src="https://habrastorage.org/webt/vk/cl/oz/vkclozwcg4inlgcwqn7equxs_hi.png"><br><br>  In diesem Moment denken Sie - vielleicht gibt es einen einfacheren Weg?  Nun, √ºberhaupt keine Webansicht zu haben, sch√∂n und einheimisch.  Und ja, so gibt es.  Details unter dem Schnitt. <br><a name="habracut"></a><br>  <b>tl; dr</b> Wir haben eine Schnittstelle f√ºr die Annahme von Zahlungen √ºber Apple Pay, Google Pay, die Sberbank Mobile Bank und Yandex.Money in iOS und Android erstellt.  Nein, Sie m√ºssen keine Zahlungsformulare zeichnen.  Ja, es ist auch in Open Source. <br><br>  Im Allgemeinen gibt es ungef√§hr zwei Szenarien f√ºr das Akzeptieren von Zahlungen in mobilen Anwendungen. <br><br>  Der erste ist √ºber ein WebView mit einer Zahlungsseite.  So k√∂nnen Sie Zahlungen √ºber eine Brieftasche, eine Bankkarte, ein Mobiltelefon oder etwas anderes akzeptieren.  Das Problem ist, dass WebView keinen Zugriff auf Browser-Cookies hat. Dies bedeutet, dass es f√ºr einige Zahlungsmethoden keine Berechtigung hat, sodass Sie nicht bezahlen k√∂nnen. <br><br>  Im zweiten Szenario leitet der H√§ndler die Kartendaten √ºber sein Backend weiter. Dazu m√ºssen Sie PCI DSS einhalten, das teuer, lang und schwierig ist. <br><br><h2>  Mobiles SDK </h2><br>  Das mobile SDK von Yandex.Kassi ist eine Bibliothek f√ºr iOS und Android, die wir erstellt haben, um das Leben von H√§ndlern, Anwendungsentwicklern und denen, die sich um ihre Benutzer k√ºmmern, zu vereinfachen.  Tats√§chlich ist das mobile SDK ein Tool zum Tokenisieren von Bankkarten und anderen Zahlungsinstrumenten.  Tokenisierung ist der Datenaustausch, der f√ºr die Zahlung einer eindeutigen Kennung - eines Tokens - erforderlich ist. <br><br>  Im Fr√ºhjahr haben wir die erste Version des SDK herausgebracht - es gab eine Zahlung per Karte und √ºber die Yandex.Money-Brieftasche.  Jetzt ist alles noch besser - in der Juli-Version wurden Google Pay, Apple Pay und Zahlungen √ºber Sberbank mit Best√§tigung per SMS hinzugef√ºgt. <br><br><h2>  √úber die Vorteile </h2><br><img src="https://habrastorage.org/webt/1v/pt/9y/1vpt9yly6mhhzyl8ncqv374pbki.gif" align="left">  Der Hauptvorteil ist, dass der K√§ufer alles bezahlt, aber f√ºr einen H√§ndler sieht es aus wie ein Token, das anstelle von Zahlungsdaten bearbeitet werden kann. <br><br>  Es ist noch nicht erforderlich, die Zertifizierung f√ºr die PCI-DSS-Konformit√§t zu bestehen. Die Kartendaten werden in unserem Umkreis verarbeitet.  Jedes Jahr durchlaufen wir eine Zertifizierung, halten alle Regeln der Aufsichtsbeh√∂rden ein und beseitigen die Gesch√§fte, die mit der Kasse verbunden sind.  So ist es m√∂glich. <br><br>  Mit dem SDK sind Zahlungen in Android und iOS den Benutzern vertraut, und jetzt m√ºssen sie den Anwendungskontext zum Zeitpunkt der Zahlung nicht mehr verlassen.  Diejenigen, die mit einer elektronischen Geldb√∂rse bezahlen, m√ºssen sich ebenfalls nicht anmelden. Wenn der Benutzer bei der Money-Anwendung angemeldet ist, m√ºssen Sie nur das Konto ausw√§hlen, das Sie √ºber Yandex.Passport ben√∂tigen. <br><br><h2>  Wie fange ich zu Hause an? </h2><br>  Wenn eine vollst√§ndige Verallgemeinerung erforderlich ist, m√ºssen zwei Dinge getan werden: <br><br><ul><li>  Integrieren Sie die Zahlungs-API Yandex.Cash - f√ºr den Empfang von Zahlungen; </li><li>  Connect Mobile SDK - f√ºr Tokenisierung und native Schnittstelle. </li></ul><br>  Um Apple Pay hinzuzuf√ºgen, reicht es aus, die Akzeptanz von Bankkartenzahlungen zu aktivieren und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schl√ºssel</a> im Apple-Entwicklerkonto auszugeben. <br><br>  Google Pay ist etwas anders.  Bedarf: <br><br><ol><li>  Bereiten Sie einen Testbuild der APK vor. </li><li>  F√ºllen Sie die Integrations-Checkliste aus - best√§tigen Sie, dass Ihre Anwendung nicht die Welt erobern wird, und einige weitere Dinge. </li><li>  F√ºllen Sie die Baugruppe zur √úberpr√ºfung in Google Pay aus. </li></ol><br>  Google √ºberpr√ºft alles und erlaubt (oder erlaubt nicht), die Anwendung auf Google Play zu ver√∂ffentlichen. <br><br>  Das mobile SDK ist in die Clientanwendung eingebettet, sodass native Zahlungen damit funktionieren.  Das funktioniert so: Die Kartendetails werden direkt an unseren PCI-DSS-Perimeter gesendet, ohne in das Backend des Gesch√§fts zu fallen.  Wir pr√ºfen, verarbeiten und senden einen Zahlungstoken mit einer Lebensdauer von 30 Minuten an den H√§ndler zur√ºck - er kann einmal verwendet werden. <br><br><img src="https://habrastorage.org/webt/i_/ys/q7/i_ysq7ohb0g2qmlcpstlkjduzzu.png"><br>  <i>Interaktionsschema von Benutzer, H√§ndler, mobilem SDK und API Ya.Kassa</i> <br><br>  Unter Beteiligung von SDK besteht die Zahlung aus drei Phasen: <br><br><ol><li>  Einleitung der Zahlung und Erhalt eines Tokens.  Die Anwendung initiiert eine Zahlung √ºber das SDK und erh√§lt am Ausgang ein Zahlungstoken. </li><li>  Erstellen Sie eine Zahlung.  Das Token geht an den Server, der die Zahlung √ºber die API initiiert. </li><li>  Zahlungsstatus anfordern.  Dies ist notwendig, um das richtige Fenster mit Erfolg oder Fehlern zu zeichnen. </li></ol><br><h4>  Warum ist das gut? </h4><br><ol><li>  Die Architektur ist in verschiedenen Zahlungsszenarien homogen. </li><li>  Sie m√ºssen nicht mit einer Kreditkarte im Backend des Gesch√§fts arbeiten. </li></ol><br><h2>  √úber Entwicklung und Test </h2><br>  In der iOS-Version verwenden wir VIPER und Microservices. <br><br>  Das Tokenisierungsmodul ist der Eckpfeiler des mobilen SDK. Es steuert den Prozess so, dass der H√§ndler nur das Token f√ºr die Yandex.Kassi-API-Ausgabe sieht, unabh√§ngig davon, was der Benutzer bezahlt hat.  Ein anderes Tokenisierungsmodul entscheidet, welches Fenster dem Benutzer jetzt angezeigt wird, und sendet POST-Anforderungen an den Server.  Wir haben unseren Wrapper f√ºr die API f√ºr die Arbeit mit HTTP / HTTPS-Anforderungen an YandexMoneyCoreApi geschrieben - dies hat das Leben einfacher gemacht. <br><br>  Services sind Speicher und Objekte, die mit der Yandex.Kassi-Client-API arbeiten. <br>  Ihr Code erwies sich als sauber und pr√§gnant, ohne eine gro√üe Anzahl von Zweigen und fr√ºhen Exits, da die Entwicklungsabteilung die gesamte Architektur im Voraus durchdenken konnte.  Die SDK-Dienste verf√ºgen √ºber eine konzentrierte Menge an funktionaler Programmierung - hier haben wir ihre F√§higkeiten vollst√§ndig offenbart.  Wo wir mit Functor, Monad, Applicative Functor arbeiten mussten, half uns gew√∂hnliches Versprechen. <br><br><pre><code class="hljs pgsql">let <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = PaymentOptions.<span class="hljs-keyword"><span class="hljs-keyword">Method</span></span>(oauthToken: clientApplicationKey, passportAuthorization: passportToken, gatewayId: gatewayId, amount: amount, currency: currency) let paymentOptions = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(apiMethod: <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>).responseApi() let allItems = getItems &lt;^&gt; paymentOptions let items = paymentMethodHandler.filterPaymentMethods &lt;^&gt; allItems let itemsWithEmptyError = items .recover(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>(), mapError) .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(makeErrors) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> itemsWithEmptyError</code> </pre> <br>  Die einzige Schwierigkeit trat bei VIPER auf - wir f√ºgten neue Zahlungsarten hinzu und stellten fest, dass das zentrale Modul schnell w√§chst.  Als es ungef√§hr 1000 Zeilen gab, beschlossen wir, etwas damit zu tun und die Architektur zu √ºberarbeiten. <br><br>  Die Idee eines zentralen Moduls f√ºr den Prozess hat uns gefallen und wir haben beschlossen, es zu verlassen.  In anderen Projekten verwenden wir eine deterministische endliche Zustandsmaschine, um den Prozess zu beschreiben, aber hier w√ºrde sie die Probleme nicht l√∂sen, da die Implementierung vieler Dinge im selben Modul verbleiben w√ºrde.  Daher haben wir uns entschlossen, das ‚ÄûStrategie‚Äú -Muster anzuwenden, um die Prozesse jedes Zahlungsinstruments zu isolieren.  Nachdem der Benutzer eine Zahlungsmethode ausgew√§hlt hat, erstellen wir eine Strategie f√ºr die Zahlungsmethode, die die √úbergangskarte steuert und entscheidet, welcher Prozess befolgt wird. <br><br><h3>  Demo-Anwendung </h3><br><img src="https://habrastorage.org/webt/jq/dd/go/jqddgovdbutq7q1gijnex5do6ho.gif" align="left">  Wir haben es geschafft. <br><br>  Alles begann damit, dass die Testabteilung etwas zum Testen des mobilen SDK ben√∂tigte.  Ohne eine Testanwendung konnten die Jungs nicht √ºberpr√ºfen, wie das SDK funktioniert, und unter den Testern gab es keine Entwickler f√ºr beide Plattformen. <br><br>  Dabei stellte sich heraus, dass eine Demo-Anwendung neben Testaufgaben auch eine gute M√∂glichkeit ist, unseren Partnern zu zeigen, was ein mobiles SDK ist.  Jeder, der nicht wei√ü, wie man in Swift oder Kotlin programmiert (sprich: jede Person), kann sehen, wie das SDK funktioniert.  Aus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://itms-services//%3Faction%3Ddownload-manifest%26url%3D">diesem Grund haben</a> wir die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Demo-Anwendung auf Google Play</a> und die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=http://itms-services//%3Faction%3Ddownload-manifest%26url%3D">iOS-Version auf die Yandex.Cash-Website hochgeladen.</a> <br><br>  Es stellte sich heraus, dass Sie sehen k√∂nnen, wie verschiedene Zahlungsmethoden funktionieren, mit den Einstellungen spielen oder sie jemandem zeigen k√∂nnen, der f√ºr die Auswahl eines Zahlungsaggregators verantwortlich ist.  Sei nicht sch√ºchtern. <br><br><h2>  Open Source </h2><br>  Einige Monate nach dem Start haben wir die Bibliothek sehr unangenehm verteilt - einen Link zur Site freigegeben oder Dateien per E-Mail gesendet.  Gute Jungs tun das nicht - sie ver√∂ffentlichen alles auf GitHub unter der MIT-Lizenz.  Also haben wir genau das getan. <br><br>  Zus√§tzlich zur Magie der Tokenisierung k√∂nnen H√§ndler Farben anpassen, Logos √§ndern oder andere √Ñnderungen an der Bibliothek vornehmen.  Und um es sehr bequem zu machen, haben wir ein mobiles SDK in CocoaPods f√ºr iOS-Entwickler und in Maven f√ºr Android-Leute ver√∂ffentlicht. <br><br>  Wenn Sie bereits Zahlungen √ºber die Kasse akzeptieren, dies aber jetzt noch besser und produktiver tun m√∂chten, verbinden Sie das mobile SDK.  Wenn Sie gerade ein Gesch√§ft er√∂ffnen, schlie√üen Sie die Kasse an.  Uns geht es gut. <br><br><h2>  N√ºtzliche Links </h2><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bibliothek f√ºr mobile Anwendungen</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SDK-Dokumentation</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SDK f√ºr iOS</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Android</a> auf GitHub. <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Maven</a> <br><br>  Das ist alles  Stellen Sie Fragen in den Kommentaren! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de416871/">https://habr.com/ru/post/de416871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de416857/index.html">Wir bauen Tempel - im Code und im Leben. Meine Erfahrung bei der Entwicklung meiner zweiten Android-Anwendung</a></li>
<li><a href="../de416859/index.html">Treffen Sie alle auf einmal React Boilerplate von Maximilian Stoiber v3.6.0</a></li>
<li><a href="../de416863/index.html">Eine neue Art, Aussteller vorzustellen</a></li>
<li><a href="../de416865/index.html">Retro-Design f√ºr die erste tragbare Konsole aus dem fernen 1979</a></li>
<li><a href="../de416867/index.html">Forscher haben ein Ger√§t f√ºr lokale Angriffe auf SCADA-Systeme entwickelt</a></li>
<li><a href="../de416877/index.html">Management der Druckinfrastruktur</a></li>
<li><a href="../de416879/index.html">Agiles B√ºro: Wo k√∂nnen Tausende Entwickler gehostet werden?</a></li>
<li><a href="../de416881/index.html">Einf√ºhrung in intelligente Vertr√§ge. Ihr Potenzial und ihre tats√§chlichen Grenzen</a></li>
<li><a href="../de416883/index.html">Wie ich mein Postcrossing geschrieben habe</a></li>
<li><a href="../de416885/index.html">Der Fitnessdienst gab erneut alle Erscheinungen von Regierungen, Milit√§r- und Sonderdiensten auf</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>