<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêû üèúÔ∏è üë©üèª‚Äçüéì Splunk a trav√©s de los ojos de un novato: c√≥mo hicimos un sistema de inventario de almacenamiento ‚ùï üí™üèæ üö£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recientemente, un cliente nos solicit√≥ implementar un sistema de contabilidad de capacidad de disco. La tarea consist√≠a en combinar informaci√≥n de m√°s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Splunk a trav√©s de los ojos de un novato: c√≥mo hicimos un sistema de inventario de almacenamiento</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/431208/"><img src="https://habrastorage.org/getpro/habr/post_images/d3c/c4f/709/d3cc4f70901c0d843b762341460437d1.png"><br><br>  Recientemente, un cliente nos solicit√≥ implementar un sistema de contabilidad de capacidad de disco.  La tarea consist√≠a en combinar informaci√≥n de m√°s de setenta matrices de discos de diferentes proveedores, desde conmutadores SAN y hosts VMware ESX.  Luego, los datos deb√≠an ser sistematizados, analizados y mostrados en un tablero de mandos y varios informes, por ejemplo, sobre el volumen libre y ocupado de espacio en disco en todas las matrices tomadas por separado. <br><br>  Decidimos implementar el proyecto utilizando el sistema de an√°lisis operativo: Splunk. <br><a name="habracut"></a><br><h2>  ¬øPor qu√© derramar? </h2><br>  Splunk es poderoso para visualizar los datos que recopila.  Le permite crear informes interactivos (paneles) actualizados en tiempo real.  Mostramos informaci√≥n sobre el espacio total en disco en ellos, mostramos de inmediato todas las matrices con la capacidad de ordenar por diferentes filtros, por ejemplo, por capacidad.  Al hacer clic en la matriz, inmediatamente obtenemos informaci√≥n sobre todas las conexiones.  En un panel separado, puede ingresar el nombre de la m√°quina virtual y ver en qu√© host ESX vive, de qu√© matrices recibe datos y otros par√°metros. <br><br>  En mi opini√≥n, hasta ahora Splunk no tiene an√°logos que funcionen con cualquier sistema de almacenamiento fuera de la caja.  Hace unos a√±os, apareci√≥ el CommandCentral pagado, pero no tiene la flexibilidad necesaria, no sabe c√≥mo generar informes arbitrarios (en las primeras versiones de los informes no hab√≠a ninguno) y con una visualizaci√≥n poco convincente.  En general, esta no es una herramienta para el inventario, sino para monitorear y controlar el estado de los sistemas.  Para cumplir con la tarea establecida por el cliente, tendr√≠a que ser refinada durante mucho tiempo y costosa. <br><br>  Al mismo tiempo, Splunk tiene impresionantes capacidades de visualizaci√≥n de informaci√≥n: los gr√°ficos se pueden organizar libremente entre ellos, controlar el estado de todos los sistemas en un modo de ventana √∫nica y, por lo tanto, simplificar su mantenimiento.  Para todo lo dem√°s, para nuestra tarea utilizamos la versi√≥n gratuita. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/266/ee4/c78/266ee4c78b67d3bd6fa4dd887359a818.png"><br><br><h2>  Que hiciste </h2><br>  Hasta este momento, nuestro equipo no ten√≠a experiencia con Splunk.  Afortunadamente, el sistema result√≥ ser amigable e intuitivo, y las soluciones a problemas emergentes se encontraron f√°cilmente con ayuda regular o en un motor de b√∫squeda. <br><br>  Splunk ha creado una serie de herramientas que necesitamos.  Por ejemplo, el sistema le permite combinar datos de diferentes fuentes para cualquier campo a trav√©s de las llamadas b√∫squedas (directorios).  Entonces, en una tabla, los hosts ESX se mostraban como IP, en otra, como nombres DNS.  Al principio, quer√≠amos crear una b√∫squeda casera y usar la utilidad nslookup para seleccionar registros DNS y recopilar tablas, pero result√≥ que Splunk tiene un directorio que compara DNS sobre IP y viceversa.  Esta b√∫squeda incorporada no tiene que configurarse, extrae datos sobre los servidores DNS de la configuraci√≥n del sistema, y ‚Äã‚Äãno importa si es Windows o Linux, y los datos en los registros DNS siempre est√°n actualizados. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/539/784/163/539784163408c3d1fb664d273651354c.png"><br><br>  Uno de los escenarios interesantes implementados con Splunk es el control de cambios (RFC) en el sistema.  Por ejemplo, un administrador de RFC recibe una solicitud de un ingeniero para dar servicio a uno de los conmutadores SAN.  Ingresa el nombre del conmutador en Splunk y ve qu√© almacenamientos est√°n conectados a √©l y qu√© servidores reciben datos de estos almacenamientos.  Al mismo tiempo, el gerente ve el plan de trabajo que escribi√≥ el ingeniero y puede evaluar c√≥mo deshabilitar este interruptor durante el mantenimiento afectar√° el rendimiento de los arreglos y los servidores. <br><br>  Configuramos la carga diaria de informaci√≥n sobre la conexi√≥n de todos los conmutadores y matrices a Splunk.  El cliente est√° satisfecho con esta tasa de actualizaci√≥n.  √âl ya ten√≠a una herramienta de monitoreo Stor2RRD, pero no sabe c√≥mo combinar datos de diferentes fuentes y visualizarlos.  Por lo tanto, configuramos el sistema de adquisici√≥n de datos en Splunk de la siguiente manera: <br><br><ol><li>  Recibimos informaci√≥n sobre almacenamientos de Stor2RRD; </li><li>  De los conmutadores recibimos informaci√≥n sobre SAN; </li><li>  A trav√©s de vCenter usando scripts de PowerCLI, recopilamos datos de los hosts ESX. </li></ol><br>  Los datos recibidos se llevan autom√°ticamente a un solo formulario, se procesan y se muestran en forma de los informes necesarios. <br><br><h2>  ¬øCon qu√© tuviste que pelear? </h2><br>  Splunk es un sistema poderoso, pero hay tareas que no se pueden resolver de inmediato, y para resolver algunos problemas, necesitamos un conocimiento profundo de VMware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a05/37c/6f6/a0537c6f60f84c056cf45f56b1f4907d.png"><br><br>  Por ejemplo, un cliente utiliza discos RDM asignados directamente y almacenes de datos virtuales virtuales para m√°quinas virtuales.  Estos dos tipos de unidades deben manejarse de manera diferente.  Al principio, resolvimos el problema por nuestra cuenta, pero luego nos enfrentamos a una situaci√≥n en la que la m√°quina virtual recibi√≥ tanto discos RAW como discos virtuales.  Result√≥ que recib√≠amos el campo Path incorrecto en el informe de vCenter y el enlace incorrecto a la matriz de discos RAW.  El esquema funciona con almacenes de datos ordinarios, pero no funciona con discos RAW.  Para ellos, debe usar la propiedad de disco RAW Disk ID, que contiene el atributo de disco.  Tuve que recurrir a expertos de VMware que rehicieron el script para que calcule la matriz correcta a trav√©s de la ID de disco RAW. <br><br>  Adem√°s, no aprendimos de inmediato c√≥mo trabajar de manera √≥ptima con los scripts de PowerCLI, luego los algoritmos tuvieron que desarrollarse m√°s.  Inicialmente, ¬°los scripts procesaron datos de varios miles de m√°quinas virtuales durante un tiempo de hasta tres horas!  Despu√©s del refinamiento, la duraci√≥n de los guiones se redujo a cuarenta minutos. <br><br><h2>  Cual es el resultado? </h2><br>  Al no tener experiencia con Splunk, implementamos r√°pidamente un sistema para la contabilidad de las capacidades de los discos, que recibe informaci√≥n de numerosas fuentes, la consolida y proporciona una amplia gama de gr√°ficos convenientes e intuitivos.  Si no ha tenido que elegir o crear dicho sistema antes, Splunk es un buen candidato para este rol.  Funciona r√°pidamente, se configura de manera f√°cil y flexible y no requiere ning√∫n conocimiento especializado para resolver la gran mayor√≠a de las tareas. <br><br>  <i>Vladislav Semenov, Jefe del Grupo de Arquitectura de Sistemas, Centro de Dise√±o de Complejos de Computaci√≥n, Jet Infosystems</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es431208/">https://habr.com/ru/post/es431208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es431196/index.html">C√≥mo Yandex.Taxi predice el tiempo de entrega del autom√≥vil utilizando el aprendizaje autom√°tico</a></li>
<li><a href="../es431198/index.html">C√≥mo funciona el despachador</a></li>
<li><a href="../es431200/index.html">Godot: sobre el tema del uso regular de analizadores de c√≥digo est√°tico</a></li>
<li><a href="../es431202/index.html">Debian y Devuan unen fuerzas para sysvinit</a></li>
<li><a href="../es431204/index.html">Puerta trasera en una de las dependencias de la biblioteca EventStream</a></li>
<li><a href="../es431210/index.html">Second Mitap Write the Docs Mosc√∫. House Techwriters: No olvides que existimos</a></li>
<li><a href="../es431212/index.html">Paginaci√≥n de almacenamiento en cach√© en Android</a></li>
<li><a href="../es431216/index.html">Revisi√≥n del tel√©fono Snom D345 IP</a></li>
<li><a href="../es431218/index.html">C√≥mo hice un juego de c√≥mics de Lovecraft</a></li>
<li><a href="../es431220/index.html">La mirada de un bi√≥logo a las ra√≠ces de nuestro envejecimiento.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>