<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õàÔ∏è üê† üë®üèª‚Äç‚öñÔ∏è Erste Schritte mit Microservices in Spring Boot üë©üèª üôÉ ü¶Ö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 In diesem Artikel werden die grundlegenden Komponenten zum Erstellen von RESTful-Microservices mithilfe der Consul-Serviceregistr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Erste Schritte mit Microservices in Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/413567/">  Hallo allerseits! <br><br>  In diesem Artikel werden die grundlegenden Komponenten zum Erstellen von RESTful-Microservices mithilfe der Consul-Serviceregistrierung, Spring Boot f√ºr alle Ger√ºste, Abh√§ngigkeitsinjektion, Maven f√ºr die Montage sowie Spring REST und die Java RESTful Jersey / JaxRS-API demonstriert. <br><br>  Die Hauptvorteile von Microservices: <br><br><ul><li>  Microservices helfen dabei, Ihren Code zu lockern </li></ul><br><ul><li>  Mit Microservices k√∂nnen verschiedene Teams mithilfe unabh√§ngiger Technologien an kleinen Komponenten arbeiten und so eine sicherere und h√§ufigere Bereitstellung erm√∂glichen. Spring Boot unterst√ºtzt verschiedene Implementierungen zum Erstellen einer REST-API </li></ul><br><ul><li>  Die Ermittlung und der Aufruf von Diensten h√§ngen nicht von der Dienstplattform ab </li></ul><br><ul><li>  Swagger erstellt eine robuste API-Dokumentation und eine Aufrufschnittstelle </li></ul><br>  Wenn Sie Microservices noch nicht nutzen, haben Sie es nicht erfolgreich geschafft, in die Phase der fr√ºhen Follower auf der Technologie-Wahrnehmungskurve einzusteigen, und es ist wahrscheinlich genau der richtige Zeitpunkt, um zu beginnen. <br><br><img src="https://habrastorage.org/webt/o_/ze/uu/o_zeuux9s9xpxbxjvitgdmiqox4.png"><a name="habracut"></a><br><br>  In den letzten zwei Jahrzehnten ist das Unternehmen in unserem SDLC-Prozess sehr flexibel geworden, aber unsere Anwendungen bleiben in der Regel immer noch monolithisch, und riesige Jars unterst√ºtzen alle verschiedenen APIs und Versionen auf dem Markt.  Gegenw√§rtig besteht jedoch der Wunsch nach schlankeren DevOps-Prozessen, und die Funktionalit√§t wird ‚Äûserverlos‚Äú.  Das Refactoring auf Microservices kann die Verstrickung von Code und Ressourcen verringern, Assemblys verkleinern, Releases sicherer machen und APIs stabiler machen. <br><br>  In diesem Artikel erstellen wir eine einfache Anwendung zur Verwaltung des B√∂rsenportfolios, mit der Kunden ihr Aktienportfolio bewerten k√∂nnen (B√∂rsenticker und Werte).  Der Portfolio-Mikroservice ruft das Portfolio des Kunden ab, sendet es an den Preis-Mikroservice, um die neuesten Preise anzuwenden, und gibt dann das vollst√§ndig bewertete und subtotalisierte Portfolio zur√ºck, um dies durch einen Restaufruf zu demonstrieren. <br><br><img src="https://habrastorage.org/webt/qe/ea/aw/qeeaawb8mapjtsibfyw3nro_ue8.png"><br><br>  Bevor wir mit der Erstellung unserer Microservices beginnen, bereiten wir unsere Umgebung vor, indem wir Consul einrichten. <br><br><h3>  Konsul herunterladen </h3><br>  Wir werden den Hashicorp-Konsul verwenden, um Dienste zu ermitteln. Gehen Sie also zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.consul.io/downloads.html</a> und laden Sie Consul f√ºr Windows, Linux, Mac usw. herunter.  Dadurch erhalten Sie eine ausf√ºhrbare Datei, die Sie Ihrem Pfad hinzuf√ºgen m√ºssen. <br><br><h3>  Konsul starten </h3><br>  Starten Sie Consul an der Eingabeaufforderung im Entwicklungsmodus: <br><br><pre><code class="bash hljs">consul agent -dev</code> </pre> <br>  Um zu √ºberpr√ºfen, ob es ausgef√ºhrt wird, rufen Sie Ihren Browser auf und greifen Sie auf die Konsulschnittstelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 8500 zu</a> .  Wenn alles gut geht, muss der Konsul melden, dass er gesund und munter ist.  Durch Klicken auf den Konsulendienst (links) erhalten Sie zus√§tzliche Informationen (rechts). <br><br><img src="https://habrastorage.org/webt/9p/4m/2t/9p4m2taqogtv6ahb3dnpmvvt2oc.png"><br><br>  Wenn im Moment Probleme auftreten, stellen Sie sicher, dass Sie Consul zum Ausf√ºhrungspfad hinzuf√ºgen und die Ports 8500 und 8600 verf√ºgbar sind. <br><br><h3>  Erstellen Sie eine SpringBoot-Anwendung </h3><br>  Wir werden den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spring Initializr verwenden</a> , der in die meisten IDEs integriert ist, um unsere SpringBoot-Anwendungen zu erstellen.  Die folgenden Screenshots verwenden IntelliJ IDEA. <br><br>  W√§hlen Sie "Datei / Neues Projekt", um eine neue Projektvorlage zu √∂ffnen, und dann "Spring Initializr". <br><br><img src="https://habrastorage.org/webt/xb/j5/3t/xbj53tf_bfr5dauohwqmv9gkdmm.png"><br><br>  Im Allgemeinen k√∂nnen Sie Ger√ºste ohne IDE konfigurieren, indem Sie ein Online-Formular √ºber die SpringBoot Initializr-Webseite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">start.spring.io ausf√ºllen</a> , auf der eine Zip-Datei f√ºr Ihr leeres Projekt erstellt wird, die zum Download bereitsteht. <br><br>  Klicken Sie auf "Weiter" und geben Sie die Projektmetadaten ein.  Verwenden Sie die folgende Konfiguration: <br><br><img src="https://habrastorage.org/webt/l0/_p/zk/l0_pzkpsppbplfrusj7suogqmyk.png"><br><br>  Klicken Sie auf "Weiter", um die Abh√§ngigkeiten auszuw√§hlen, und geben Sie bei der Suche nach Abh√§ngigkeiten "Jersey" und "Consul Discovery" ein.  F√ºgen Sie diese Abh√§ngigkeiten hinzu: <br><br><img src="https://habrastorage.org/webt/jt/t8/l8/jtt8l89pauvzyu_oo_riav_na4e.png"><br><br>  Klicken Sie auf "Weiter", um den Namen des Projekts und seinen Standort anzugeben.  Behalten Sie den Standardnamen "Portfolio" bei und geben Sie den bevorzugten Speicherort des Projekts an. Klicken Sie dann auf "Fertig stellen", um das Projekt zu erstellen und zu √∂ffnen: <br><br><img src="https://habrastorage.org/webt/un/xl/gh/unxlgh-ufplppxqhuyfyfdoug5g.png"><br><br>  Wir k√∂nnen die generierten application.properties verwenden, aber SpringBoot erkennt auch das YAML-Format, das etwas einfacher zu visualisieren ist. Benennen Sie es daher in application.yml um. <br><br>  Wir nennen den Microservice ‚ÄûPortfolio-Service‚Äú.  Wir k√∂nnen einen Port angeben oder Port 0 verwenden, damit die Anwendung einen verf√ºgbaren Port verwendet.  In unserem Fall verwenden wir 57116. Wenn Sie diesen Dienst als Docker-Container hosten, k√∂nnen Sie ihn jedem von Ihnen ausgew√§hlten Port zuordnen.  Benennen Sie die Anwendung und geben Sie unseren Port an, indem Sie unserer application.yml Folgendes hinzuf√ºgen: <br><br><pre> <code class="bash hljs">spring: application: name: portfolio-service server: port: 57116</code> </pre><br>  F√ºgen Sie unserer SpringBoot-Anwendungsklasse Anmerkungen hinzu, um unseren Service verf√ºgbar zu machen.  √ñffnen Sie die PortfolioApplication-Anwendung und f√ºgen Sie √ºber der Klassendeklaration @EnableDiscoveryClient hinzu. <br><br>  Best√§tigen Sie die Importe.  Die Klasse sollte folgenderma√üen aussehen: <br><br><pre> <code class="bash hljs">package com.restms.demo.portfolio; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; . . . @SpringBootApplication @EnableDiscoveryClient public class PortfolioApplication { public static void main(String[] args) { SpringApplication.run(PortfolioApplication.class, args); } }</code> </pre><br>  (Um zu demonstrieren, wie Microservices aus unabh√§ngigen Plattformen bestehen k√∂nnen, werden wir Jersey f√ºr diesen Service und Spring REST f√ºr den n√§chsten verwenden.) <br>  Um den RESTful-Webdienst auf Jersey zu konfigurieren, m√ºssen Sie die ResourceConfig-Konfigurationsklasse angeben.  F√ºgen Sie die JerseyConfig-Klasse hinzu (zur Demonstration speichern wir sie im selben Paket wie unsere Anwendungsklasse).  Es sollte so aussehen, plus das richtige Paket und Import: <br><br><pre> <code class="bash hljs">@Configuration @ApplicationPath(<span class="hljs-string"><span class="hljs-string">"portfolios"</span></span>) public class JerseyConfig extends ResourceConfig { public <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JerseyConfig</span></span></span></span>() { register(PortfolioImpl.class); } }</code> </pre><br>  Beachten Sie, dass es von ResourceConfig erbt, um es als Jersey-Konfigurationsklasse zu kennzeichnen.  Das Attribut @ApplicationPath ("Portfolios") definiert den Kontext des Aufrufs. Dies bedeutet, dass Aufrufe mit dem Pfadelement "Portfolioios" beginnen m√ºssen.  (Wenn Sie es weglassen, ist der Standardkontext "/"). <br><br>  Die PortfolioImpl-Klasse bedient zwei Anforderungen: Portfolios / Kunde / {Kunden-ID} gibt alle Portfolios zur√ºck und Portfolios / Kunde / {Kunden-ID} / Portfolio / {Portfolio-ID} gibt ein Portfolio zur√ºck.  Ein Portfolio besteht aus einer Reihe von Tickern und der Anzahl der von diesem Ticker gehaltenen Aktien.  (Zur Demonstration gibt es drei Clients mit den Kennungen 0, 1 und 2, von denen jeder drei Portfolios mit den Kennungen 0, 1 und 2 hat.) <br><br>  Ihre IDE fordert Sie auf, PortfolioImpl zu erstellen.  Mach es jetzt.  F√ºgen Sie es zur Demonstration demselben Paket hinzu.  Geben Sie den folgenden Code ein und best√§tigen Sie alle Importe: <br><br><pre> <code class="bash hljs">@Component @Path(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) public class PortfolioImpl implements InitializingBean { private Object[][][][] clientPortfolios; @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) // a portfolio consists of an array of arrays, each containing an array of // stock ticker and associated shares public Object[][][] getPortfolios(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> clientPortfolios[customerId]; } @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) public Object[][] getPortfolio(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId, @PathParam(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) int portfolioId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> getPortfolios(customerId)[portfolioId]; } @Override public void afterPropertiesSet() throws Exception { Object[][][][] clientPortfolios = { { // 3 customers, 3 portfolios each {new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 10201}, new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 20400}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 38892}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"KO"</span></span>, 12449}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 23454}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 45344}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"WMT"</span></span>, 39583}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 95867}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 384756}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 38475}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MCD"</span></span>, 12395}, new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 91234}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"VZ"</span></span>, 22342}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 385432}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 23432}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 18343}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 45673}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AAPL"</span></span>, 23456}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 34543}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 55322}, new Object[]{<span class="hljs-string"><span class="hljs-string">"NKE"</span></span>, 45642}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"CVX"</span></span>, 44332}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 12453}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JNJ"</span></span>, 45433}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 32346}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 46532}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 45663}}, } }; this.clientPortfolios = clientPortfolios; } }</code> </pre><br>  Die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Komponentenanmerkung</a> bezeichnet dies als Klasse der Spring-Komponente und macht sie als Endpunkt verf√ºgbar.  Pfadanmerkungen zur Klassendeklaration geben an, dass auf die Klasse √ºber das Pfadelement "/" zugegriffen wird. Zwei unterst√ºtzte API-Aufrufe sind √ºber Portfolios / Kunde / {Kunden-ID} und Portfolios / Kunde / {Kunden-ID} / Portfolio / {Portfolio- verf√ºgbar. id}, wie wir aus den Anmerkungen der Methode sehen.  Beachten Sie, dass der Pfad ("/") die Standardeinstellung ist, wir ihn jedoch als Referenz belassen.  Methoden werden √ºber @GETannotation als HTTP GET bezeichnet.  Unsere Methode wurde entwickelt, um ein Array zur√ºckzugeben, und mit Anmerkungen versehen, um Json zur√ºckzugeben, sodass ein Json-Array zur√ºckgegeben wird.  Beachten Sie, wie Pfadparameteranmerkungen in der Methodensignatur verwendet werden, um die angezeigten Parameter aus den angezeigten Abfragen zu extrahieren. <br><br>  (F√ºr unsere Demo geben wir fest codierte Werte zur√ºck. In der Praxis fragt die Implementierung nat√ºrlich die Datenbank oder einen anderen Dienst oder eine andere Datenquelle anstelle des feststehenden Codes ab.) <br>  Erstellen Sie nun ein Projekt und f√ºhren Sie es aus.  Wenn Sie IntelliJ verwenden, wird eine ausf√ºhrbare Standarddatei erstellt. Klicken Sie einfach auf den gr√ºnen Pfeil "Ausf√ºhren".  Sie k√∂nnen auch verwenden <br><br><pre> <code class="bash hljs">mvn spring-boot:run</code> </pre> <br>  Oder Sie k√∂nnen die Maven-Installation durchf√ºhren und die Anwendung mit Java-Jar ausf√ºhren, wobei Sie auf das generierte JAR im Zielverzeichnis verweisen: <br><br><pre> <code class="bash hljs">java -jar target\portfolio-0.0.1-SNAPSHOT.jar</code> </pre> <br>  Jetzt sollte dieser Dienst in Consul angezeigt werden. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kehren</a> wir also zu unserem Browser zur√ºck und laden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 8500 / ui / # / dc1 / services herunter</a> (oder aktualisieren Sie ihn, wenn Sie bereits dort sind). <br><br><img src="https://habrastorage.org/webt/bs/ab/2v/bsab2vs-dswpzy7nmpevmtphdma.png"><br><br>  Hmm, wir sehen unseren Service dort, aber er wird als fehlgeschlagen angezeigt.  Dies liegt daran, dass Consul von unserem Service ein ‚Äûgesundes‚Äú Herzschlagsignal erwartet. <br>  Um Heartbeat-Signale zu generieren, k√∂nnen wir dem POM unserer Anwendung eine Abh√§ngigkeit vom <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spring Actuator-</a> Dienst hinzuf√ºgen. <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt;</code> </pre><br>  W√§hrend wir in Pom sind, beachten Sie, dass es einen Versionskonflikt mit Jersey zwischen dem Consul-Starter und dem Jersey-Starter gibt.  Um dies auszugleichen, bezeichnen Sie den Jersey-Starter als erste Sucht. <br><br>  Ihr Pom sollte jetzt die folgenden Abh√§ngigkeiten enthalten: <br><br><pre> <code class="bash hljs">&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;</code> </pre><br>  Durch den Neustart von Consul zeigt der Portfolio-Service ein zufriedenes an: <br><br><img src="https://habrastorage.org/webt/uf/oq/qr/ufoqqrtcnxnlwazqy-ozrp1lceo.png"><br><br>  Jetzt gibt es im Portfolio-Service zwei √úbertragungsknoten: Einer davon ist die Implementierung des Portfolio-Service und der andere ist der Herzschlag. <br><br>  Lassen Sie uns den zugewiesenen Port √ºberpr√ºfen.  Sie k√∂nnen das in der Ausgabe der Anwendung sehen: <br><br><pre> <code class="bash hljs">INFO 19792 --- [ main] sbcetTomcatEmbeddedServletContainer : Tomcat started on port(s): 57116 (http)</code> </pre> <br>  Sie k√∂nnen den Port auch direkt in der Consul-Benutzeroberfl√§che anzeigen.  Klicken Sie auf "Kundenservice" und w√§hlen Sie dann den Link "Service 'Kundenservice' Check Link", der den Service-Port anzeigt, in diesem Fall 57116. <br><br><img src="https://habrastorage.org/webt/s_/up/ce/s_upceczzu0xupqioariurhawz8.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wenn Sie http: // localhost: 57116 / portfolios / customer / 1 / Portfolio / 2</a> anfordern, wird das JSON-Array [["IBM", 18343], ["DIS", 45673], ["AAPL", 23456]] angezeigt. <br><br>  Unser erster Microservice ist ge√∂ffnet! <br><br><h3>  Preisservice </h3><br>  Als N√§chstes erstellen wir unseren Preisservice, diesmal mit Spring RestController anstelle von Jersey. <br><br>  Der Preisservice akzeptiert die Kunden- und Portfolio-ID als Parameter und verwendet RestTemplate, um Portfolio-Services anzufordern, Ticker und Aktien zu erhalten und aktuelle Preise zur√ºckzugeben.  (Ich muss Ihnen nicht sagen, dass diese Werte gef√§lschte Nachrichten sind, verwenden Sie sie also nicht, um Handelsentscheidungen zu treffen!) <br><br>  Erstellen Sie ein neues Projekt mit den folgenden Informationen: <br><br><img src="https://habrastorage.org/webt/gz/sy/sm/gzsysm7_cgynyxucuhgrcfoxhbs.png"><br><br>  W√§hlen Sie dieses Mal die Abh√§ngigkeiten Web, Consul Discovery und Actuator aus: <br><br><img src="https://habrastorage.org/webt/1l/ke/ov/1lkeovxzix2pxqwmodb2efdw-zu.png"><br><br>  Behalten Sie den Standardnamen des Projekts "Pricing" bei und erstellen Sie ein Projekt im Verzeichnis Ihrer Wahl. <br><br>  Dieses Mal verwenden wir application.properties anstelle von application.yml. <br>  Legen Sie den Namen und den Port in application.properties wie folgt fest: <br><br><pre> <code class="bash hljs">spring.application.name=pricing server.port=57216</code> </pre> <br>  Kommentieren Sie die Preisanwendung mit @EnableDiscoveryClient.  Die Klasse sollte so aussehen, plus Paket und Import. <br><br><pre> <code class="bash hljs">@SpringBootApplication @EnableDiscoveryClient public class PricingApplication { public static void main(String[] args) { SpringApplication.run(PricingApplication.class, args); } }</code> </pre><br>  Dann erstellen wir die PricingEndpoint-Klasse.  Hier werde ich ein detaillierteres Beispiel geben, da es einige wichtige Funktionen demonstriert, einschlie√ülich der Serviceerkennung (Suche nach Portfolio-Service) und der Verwendung von RestTemplate f√ºr die Abfrage: <br><br><pre> <code class="bash hljs">@RestController @RequestMapping(<span class="hljs-string"><span class="hljs-string">"/pricing"</span></span>) public class PricingEndpoint implements InitializingBean { @Autowired DiscoveryClient client; Map&lt;String, Double&gt; pricingMap = new HashMap&lt;&gt;(); RestTemplate restTemplate = new RestTemplate(); @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio( @PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId) { List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream() .findFirst() .orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>)); String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId); // query <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the portfolios, returned as an array of List // of size 2, containing a ticker and a position (<span class="hljs-comment"><span class="hljs-comment"># of shares) Object[] portfolio = restTemplate.getForObject(url, Object[].class); // Look up the share prices, and return a list of Strings, formatted as // ticker, shares, price, total List&lt;String&gt; collect = Arrays.stream(portfolio).map(position -&gt; { String ticker = ((List&lt;String&gt;) position).get(0); int shares = ((List&lt;Integer&gt;) position).get(1); double price = getPrice(ticker); double total = shares * price; return String.format("%s %d %f %f", ticker, shares, price, total); }).collect(Collectors.toList()); return collect; } private double getPrice(String ticker) { return pricingMap.get(ticker); } @Override public void afterPropertiesSet() throws Exception { pricingMap.put("MMM",201.81); pricingMap.put("AXP",85.11); pricingMap.put("AAPL",161.04); pricingMap.put("BA",236.32); pricingMap.put("CAT",118.02); pricingMap.put("CVX",111.31); pricingMap.put("CSCO",31.7); pricingMap.put("KO",46.00); pricingMap.put("DIS",101.92); pricingMap.put("XOM",78.7); pricingMap.put("GE",24.9); pricingMap.put("GS",217.62); pricingMap.put("HD",155.82); pricingMap.put("IBM",144.29); pricingMap.put("INTC",35.66); pricingMap.put("JNJ",130.8); pricingMap.put("JPM",89.75); pricingMap.put("MCD",159.81); pricingMap.put("MRK",63.89); pricingMap.put("MSFT",73.65); pricingMap.put("NKE",52.78); pricingMap.put("PFE",33.92); pricingMap.put("PG",92.79); pricingMap.put("TRV",117.00); pricingMap.put("UTX",110.12); pricingMap.put("UNH",198.00); pricingMap.put("VZ",47.05); pricingMap.put("V",103.34); pricingMap.put("WMT", 80.05); } }</span></span></code> </pre><br>  Um einen Portfolio-Service zu finden, ben√∂tigen wir Zugriff auf DiscoveryClient.  Mit der @ Autowired-Annotation von Spring ist dies leicht zu erreichen. <br><br><pre> <code class="bash hljs">@Autowired DiscoveryClient client;</code> </pre><br>  Diese DiscoveryClient-Instanz wird dann verwendet, um im Aufruf nach dem Dienst zu suchen: <br><br><pre> <code class="bash hljs">List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream().findFirst().orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>));</code> </pre><br>  Nachdem der Service gefunden wurde, k√∂nnen wir ihn verwenden, um unsere Anfrage zu erf√ºllen, die wir gem√§√ü dem in unserem Portfolio-Service erstellten API-Aufruf erstellen. <br><br><pre> <code class="bash hljs">String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId);</code> </pre><br>  Schlie√ülich verwenden wir RestTemplate, um unsere GET-Anforderung auszuf√ºhren. <br><br><pre> <code class="bash hljs">Object[] portfolio = restTemplate.getForObject(url, Object[].class);</code> </pre> <br>  Beachten Sie, dass f√ºr Rest-Controller (sowie f√ºr Spring MVC Request Controller) Pfadvariablen mithilfe der Annotation "Pfadvariable" abgerufen werden, im Gegensatz zu Jersey, das, wie wir gesehen haben, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Path</a> Param verwendet. <br><br>  Damit ist unsere Preisgestaltung mit Spring RestController abgeschlossen. <br><br><h3>  Die Dokumentation </h3><br>  Wir haben all diese Probleme gel√∂st, um unsere Microservices zu erstellen, aber sie werden nicht genug Nutzen bringen, wenn wir der Welt kein Wissen dar√ºber geben, wie man sie verwendet. <br><br>  Zu diesem Zweck verwenden wir das praktische und benutzerfreundliche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Swagger-</a> Tool, das nicht nur unsere API-Aufrufe dokumentiert, sondern auch einen praktischen Webclient zum Aufrufen bereitstellt. <br><br>  Lassen Sie uns zuerst Swagger in unserem Pom angeben: <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt;</code> </pre><br>  Dann m√ºssen wir Swagger mitteilen, welche unserer Klassen wir dokumentieren m√∂chten.  Lassen Sie uns die neue SwaggerConfig-Klasse vorstellen, die die Swagger-Spezifikation enth√§lt. <br><br><pre> <code class="bash hljs">@Configuration @EnableSwagger2 public class SwaggerConfig { @Bean public Docket <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> new Docket(DocumentationType.SWAGGER_2) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.regex(<span class="hljs-string"><span class="hljs-string">"/pricing.*"</span></span>)) .build(); } }</code> </pre><br>  Mal sehen, was diese Klasse macht.  Zuerst haben wir dies als Swagger-Konfiguration mit der Annotation @ EnableSwagger2 bezeichnet. <br><br>  Dann haben wir eine Docket-Komponente erstellt, die Swagger mitteilt, welche APIs angezeigt werden sollen.  Im obigen Beispiel haben wir Swagger angewiesen, jeden Pfad zu demonstrieren, der mit "/ price" beginnt.  Eine Alternative w√§re, Klassen f√ºr die Dokumentation und nicht f√ºr Pfade anzugeben: <br><br><pre> <code class="bash hljs">.apis(RequestHandlerSelectors.basePackage(<span class="hljs-string"><span class="hljs-string">"com.restms.demo"</span></span>)) .paths(PathSelectors.any())</code> </pre><br>  Starten Sie den Preis-Microservice neu und rufen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie</a> im Browser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http: // localhost: 57216 / swagger-ui.html auf</a> <br><br><img src="https://habrastorage.org/webt/8x/0k/gk/8x0kgk8hxs_dpijzolsmxk8rdva.png"><br><br>  Klicken Sie auf Vorg√§nge auflisten, um die Vorg√§nge im Detail anzuzeigen. <br>  Klicken Sie auf Vorg√§nge erweitern, um eine Anforderung basierend auf dem Formular zu erstellen.  Stellen Sie einige Parameter ein und klicken Sie auf "Probieren Sie es aus!"  und warte auf die Antwort: <br><br><img src="https://habrastorage.org/webt/rf/0_/iu/rf0_ius_kz3fljd74-aaqhzwsia.png"><br><br>  Sie k√∂nnen viel mehr Farben hinzuf√ºgen, indem Sie Ihren Methoden Swagger-Anmerkungen hinzuf√ºgen. <br>  Dekorieren Sie beispielsweise die vorhandene PricingImpl.getPricedPortfolio-Methode mithilfe der Annotation @ApiOperation, wie unten gezeigt: <br><br><pre> <code class="bash hljs">@ApiOperation(value = <span class="hljs-string"><span class="hljs-string">"Retrieves a fully priced portfolio"</span></span>, notes = <span class="hljs-string"><span class="hljs-string">"Retrieves fully priced portfolio given customer id and portfolio id"</span></span>) @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio(@PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId)</code> </pre> <br>  Laden Sie swagger-ui neu und aktualisieren Sie es, um die neue aktualisierte Dokumentation anzuzeigen: <br><br><img src="https://habrastorage.org/webt/1z/vy/bj/1zvybjvfyh6zmjxd7gahn5_tlyi.png"><br><br>  Und das ist noch nicht alles, was Sie mit Swagger tun k√∂nnen. Lesen Sie also die Dokumentation. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Yuri Dvorzhetsky</a> , Dozent in unserem Kurs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">"Developer on the Spring Framework",</a> wird Ihnen mehr √ºber Spring Boot erz√§hlen: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zgd9SfSxO0Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><i>Originalartikel</i></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de413567/">https://habr.com/ru/post/de413567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de413557/index.html">NewSQL: SQL geht nirgendwo hin</a></li>
<li><a href="../de413559/index.html">Web-Verschlechterung oder wie man das Web f√ºr Menschen lesbar macht</a></li>
<li><a href="../de413561/index.html">Geschwindigkeit des kompilierten Linq Expression Tree</a></li>
<li><a href="../de413563/index.html">4 M√∂glichkeiten, ein Paket in Go zu importieren</a></li>
<li><a href="../de413565/index.html">Kubernetes Hack-Analyse - Hintert√ºr √ºber Kubelet</a></li>
<li><a href="../de413569/index.html">Demontage Fabrik 18650 Lithium-Ionen-Batterien</a></li>
<li><a href="../de413571/index.html">Problem Nr. 25: IT-Schulung - aktuelle Probleme und Herausforderungen f√ºhrender Unternehmen</a></li>
<li><a href="../de413575/index.html">BricsCAD Shape - Kostenloses 3D-CAD von Bricsys</a></li>
<li><a href="../de413577/index.html">[Ank√ºndigung] Hubs f√ºr den Wettbewerb auf CodinGame.com in sieben St√§dten Russlands</a></li>
<li><a href="../de413579/index.html">Wir werden ein Wort zur Code-Zerlegung sagen: Kontext-Programmierung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>