<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òÉÔ∏è üëô üçö Gu√≠a: Actualizaci√≥n de interfaces con miembros predeterminados en C # 8.0 üéø üå®Ô∏è üåº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comenzando con C # 8.0 en .NET Core 3.0, al crear un miembro de una interfaz, puede determinar su implementaci√≥n. El escenario m√°s com√∫n es agregar mi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gu√≠a: Actualizaci√≥n de interfaces con miembros predeterminados en C # 8.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/microsoft/blog/456232/">  Comenzando con C # 8.0 en .NET Core 3.0, al crear un miembro de una interfaz, puede determinar su implementaci√≥n.  El escenario m√°s com√∫n es agregar miembros de forma segura a una interfaz ya lanzada y utilizada por innumerables clientes. <br><br><p>  En esta gu√≠a aprender√° c√≥mo: </p><br><ul><li>  Es seguro extender las interfaces agregando m√©todos con implementaciones. </li><li>  Cree implementaciones parametrizadas para una mayor flexibilidad. </li><li>  Obtenga el derecho de implementar implementaciones m√°s espec√≠ficas con la posibilidad de control manual. </li></ul><br><img src="https://habrastorage.org/webt/ol/gr/ie/olgriec_2o-qik7jkltm_pxyo34.jpeg"><a name="habracut"></a><br><br><h2>  Por donde empezar </h2><br><p>  Primero debe configurar la m√°quina para que funcione con .NET Core, incluido el compilador de la vista previa de C # 8.0.  Dicho compilador est√° disponible a partir de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Visual Studio 2019</a> o con el nuevo <a href="">SDK de vista previa de .NET Core 3.0</a> .  Los miembros de interfaz predeterminados est√°n disponibles a partir de .NET Core 3.0 (Vista previa 4). </p><br><h2>  Resumen del escenario </h2><br><p>  Este tutorial comienza con la primera versi√≥n de la biblioteca de relaciones con el cliente.  Puede obtener la aplicaci√≥n de inicio en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio en GitHub</a> .  La compa√±√≠a que cre√≥ esta biblioteca asumi√≥ que los clientes con aplicaciones existentes las adaptar√≠an a esta biblioteca.  A los usuarios se les presentaron las definiciones m√≠nimas de interfaz para la implementaci√≥n: </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">ICustomer</span></span> { IEnumerable&lt;IOrder&gt; PreviousOrders { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } DateTime DateJoined { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } DateTime? LastOrder { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IDictionary&lt;DateTime, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; Reminders { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><p>  Tambi√©n se defini√≥ una segunda interfaz que muestra el orden: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IOrder</span></span> { DateTime Purchased { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> Cost { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><p>  Basado en estas interfaces, el equipo puede construir una biblioteca para que sus usuarios creen la mejor experiencia para los clientes.  El objetivo del equipo era aumentar el nivel de interacci√≥n con los clientes existentes y desarrollar relaciones con los nuevos. </p><br><p>  Es hora de actualizar la biblioteca para la pr√≥xima versi√≥n.  Una de las caracter√≠sticas m√°s populares es la adici√≥n de descuentos a clientes leales que hacen una gran cantidad de pedidos.  Este nuevo descuento individual se aplica cada vez que un cliente realiza un pedido. Con cada implementaci√≥n de ICustomer, se pueden establecer diferentes reglas para un descuento por fidelidad. <br></p><p>  La forma m√°s conveniente de agregar esta funci√≥n es expandir la interfaz de <code>ICustomer</code> con cualquier descuento.  Esta propuesta ha causado preocupaci√≥n entre los desarrolladores experimentados.  ‚Äú¬°Las interfaces son inmutables despu√©s del lanzamiento!  ¬°Este es un cambio cr√≠tico! ‚Äù  En C # 8.0, se han agregado implementaciones de interfaz predeterminadas para actualizar interfaces.  Los autores de la biblioteca pueden agregar nuevos miembros e implementarlos de manera predeterminada </p><br><p>  La implementaci√≥n predeterminada de las interfaces permite a los desarrolladores actualizar la interfaz, al tiempo que permite que otros desarrolladores anulen esta implementaci√≥n.  Los usuarios de la biblioteca pueden aceptar la implementaci√≥n predeterminada como un cambio no cr√≠tico. </p><br><h2>  Actualizaci√≥n utilizando miembros de interfaz predeterminados </h2><br><p>  El equipo estuvo de acuerdo con la implementaci√≥n predeterminada m√°s probable: un descuento en la lealtad del cliente. </p><br><p>  La actualizaci√≥n debe ser funcional para establecer dos propiedades: el n√∫mero de pedidos necesarios para recibir un descuento y el porcentaje del descuento.  Esto lo convierte en un script ideal para miembros de interfaz predeterminados.  Puede agregar un m√©todo a la interfaz ICustomer y proporcionar su implementaci√≥n m√°s probable.  Todas las implementaciones existentes y nuevas pueden implementarse de manera predeterminada o tener su propia configuraci√≥n. </p><br><p>  Primero agregue un nuevo m√©todo a la implementaci√≥n: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  1: public decimal ComputeLoyaltyDiscount() { DateTime TwoYearsAgo = DateTime.Now.AddYears(-2); if ((DateJoined &lt; TwoYearsAgo) &amp;&amp; (PreviousOrders.Count() &gt; 10)) { return 0.10m; } return 0; }</span></span></code> </pre> <br><p>  El autor de la biblioteca escribi√≥ la primera prueba para verificar la implementaci√≥n: </p><br><pre> <code class="cs hljs">SampleCustomer c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleCustomer(<span class="hljs-string"><span class="hljs-string">"customer one"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2010</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>)) { Reminders = { { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2010</span></span>, <span class="hljs-number"><span class="hljs-number">08</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-string"><span class="hljs-string">"childs's birthday"</span></span> }, { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">1012</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-string"><span class="hljs-string">"anniversary"</span></span> } } }; SampleOrder o = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleOrder(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2012</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-number"><span class="hljs-number">5</span></span>m); c.AddOrder(o); o = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SampleOrder(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">2103</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>), <span class="hljs-number"><span class="hljs-number">25</span></span>m); c.AddOrder(o); <span class="hljs-comment"><span class="hljs-comment">//  : ICustomer theCustomer = c; Console.WriteLine($"Current discount: {theCustomer.ComputeLoyaltyDiscount()}");</span></span></code> </pre> <br><p>  Presta atenci√≥n a la siguiente parte de la prueba: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  : ICustomer theCustomer = c; Console.WriteLine($"Current discount: {theCustomer.ComputeLoyaltyDiscount()}");</span></span></code> </pre> <br><p>  Esta parte, desde <code>SampleCustomer</code> hasta <code>ICustomer</code> es importante.  La clase <code>SampleCustomer</code> no <code>SampleCustomer</code> proporcionar una implementaci√≥n para <code>ComputeLoyaltyDiscount</code> ;  Esto lo proporciona la interfaz <code>ICustomer</code> .  Sin embargo, la clase <code>SampleCustomer</code> no hereda miembros de sus interfaces.  Esta regla no ha cambiado.  Para llamar a cualquier m√©todo implementado en una interfaz, la variable debe ser un tipo de interfaz, en este ejemplo <code>ICustomer</code> . </p><br><h2>  Parametrizaci√≥n </h2><br><p>  Este es un buen comienzo.  Pero la implementaci√≥n predeterminada es demasiado limitada.  Muchos consumidores de este sistema pueden elegir diferentes umbrales para el n√∫mero de compras, diferentes duraciones de membres√≠a o diferentes descuentos en porcentaje. Puede mejorar el proceso de actualizaci√≥n para m√°s clientes al proporcionar una forma de establecer estos par√°metros.  Agreguemos un m√©todo est√°tico que establece estos tres par√°metros que controlan la implementaci√≥n predeterminada: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  2: public static void SetLoyaltyThresholds( TimeSpan ago, int minimumOrders = 10, decimal percentageDiscount = 0.10m) { length = ago; orderCount = minimumOrders; discountPercent = percentageDiscount; } private static TimeSpan length = new TimeSpan(365 * 2, 0,0,0); // two years private static int orderCount = 10; private static decimal discountPercent = 0.10m; public decimal ComputeLoyaltyDiscount() { DateTime start = DateTime.Now - length; if ((DateJoined &lt; start) &amp;&amp; (PreviousOrders.Count() &gt; orderCount)) { return discountPercent; } return 0; }</span></span></code> </pre> <br><p>  Este peque√±o fragmento de c√≥digo muestra muchas caracter√≠sticas nuevas del lenguaje.  Las interfaces ahora pueden incluir miembros est√°ticos, incluidos campos y m√©todos.  Tambi√©n se incluyen varios modificadores de acceso.  Los campos adicionales son privados y el nuevo m√©todo es p√∫blico.  Cualquiera de los modificadores est√° permitido para los miembros de la interfaz. </p><br><p>  Las aplicaciones que usan la f√≥rmula general para calcular los descuentos de lealtad, pero con diferentes par√°metros, no deber√≠an proporcionar una implementaci√≥n personalizada;  pueden establecer argumentos por el m√©todo est√°tico.  Por ejemplo, el siguiente c√≥digo establece la "apreciaci√≥n del cliente", que recompensa a cualquier cliente con una membres√≠a de m√°s de un mes: </p><br><pre> <code class="cs hljs">ICustomer.SetLoyaltyThresholds(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeSpan(<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0.25</span></span>m); Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"Current discount: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{theCustomer.ComputeLoyaltyDiscount()}</span></span></span><span class="hljs-string">"</span></span>);</code> </pre> <br><h2>  Ampl√≠e la implementaci√≥n predeterminada </h2><br><p>  El c√≥digo que agreg√≥ anteriormente proporcion√≥ una implementaci√≥n conveniente para aquellos escenarios en los que los usuarios desean algo como la implementaci√≥n predeterminada o proporcionan un conjunto de reglas no relacionadas.  Para la versi√≥n final, reorganicemos un poco el c√≥digo para incluir escenarios en los que los usuarios quieran confiar en la implementaci√≥n predeterminada. </p><br><p>  Considere una startup que quiera atraer nuevos clientes.  Ofrecen un descuento del 50% en el primer pedido de un nuevo cliente.  Los clientes existentes reciben un descuento est√°ndar.  El autor de la biblioteca necesita mover la implementaci√≥n predeterminada al m√©todo <code>protected static</code> para que cualquier clase que implemente esta interfaz pueda reutilizar el c√≥digo en su implementaci√≥n.  La implementaci√≥n predeterminada de un miembro de la interfaz tambi√©n llama a este m√©todo gen√©rico: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeLoyaltyDiscount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; DefaultLoyaltyDiscount(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DefaultLoyaltyDiscount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ICustomer c</span></span></span><span class="hljs-function">)</span></span> { DateTime start = DateTime.Now - length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((c.DateJoined &lt; start) &amp;&amp; (c.PreviousOrders.Count() &gt; orderCount)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> discountPercent; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  En la implementaci√≥n de la clase que implementa esta interfaz, puede llamar manualmente al m√©todo auxiliar est√°tico y extender esta l√≥gica para proporcionar un descuento al "nuevo cliente": </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">decimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeLoyaltyDiscount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PreviousOrders.Any() == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0.50</span></span>m; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ICustomer.DefaultLoyaltyDiscount(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); }</code> </pre> <br><p>  Puede ver todo el c√≥digo terminado en nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">repositorio en GitHub</a> . </p><br><p>  Estas nuevas caracter√≠sticas significan que las interfaces se pueden actualizar de forma segura si existe una implementaci√≥n predeterminada aceptable para los nuevos miembros.  Dise√±e interfaces cuidadosamente para expresar ideas funcionales individuales que puedan ser implementadas por varias clases.  Esto facilita la actualizaci√≥n de estas definiciones de interfaz cuando se encuentran nuevos requisitos para la misma idea funcional. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/456232/">https://habr.com/ru/post/456232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456220/index.html">Generalizaci√≥n del problema de Brokar</a></li>
<li><a href="../456222/index.html">La ingenier√≠a gen√©tica de embriones humanos ser√° segura y efectiva en dos a√±os.</a></li>
<li><a href="../456224/index.html">Anuncio de .NET Core 3.0 Preview 6</a></li>
<li><a href="../456226/index.html">Predicci√≥n de resultados de f√∫tbol</a></li>
<li><a href="../456230/index.html">Iobroker b√∫squeda de misiones en juegos de realidad</a></li>
<li><a href="../456234/index.html">¬øPor qu√© Cisco no compra Splunk o habla sobre c√≥mo funciona la plataforma Cisco para la caza de amenazas?</a></li>
<li><a href="../456236/index.html">Peter - Insider Dev Tour: Conferencia Insider para desarrolladores de Microsoft</a></li>
<li><a href="../456238/index.html">Tutorial: Actualizar interfaces con miembros de interfaz predeterminados en C # 8.0</a></li>
<li><a href="../456240/index.html">Desarrollo de chatbot (laravel + botman)</a></li>
<li><a href="../456242/index.html">Un poco m√°s sobre la multitarea en microcontroladores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>