<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüë©‚Äçüëß ü¶ä üê∫ Transa√ß√µes e mecanismos para seu controle üö¥üèª üåì üíáüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Transa√ß√µes 
 Uma transa√ß√£o √© uma sequ√™ncia de opera√ß√µes em dados que t√™m um come√ßo e um fim. 
 Uma transa√ß√£o √© uma opera√ß√£o sequencial de leitura e gr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Transa√ß√µes e mecanismos para seu controle</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446662/"><h2>  Transa√ß√µes </h2><br><h4>  Uma transa√ß√£o √© uma sequ√™ncia de opera√ß√µes em dados que t√™m um come√ßo e um fim. </h4><br>  Uma transa√ß√£o √© uma opera√ß√£o sequencial de leitura e grava√ß√£o.  O final de uma transa√ß√£o pode ser salvar altera√ß√µes (confirmar, confirmar) ou cancelar altera√ß√µes (revers√£o, revers√£o).  Em rela√ß√£o ao banco de dados, uma transa√ß√£o √© uma s√©rie de consultas, que s√£o tratadas como uma √∫nica consulta. <br><br><h4>  As transa√ß√µes devem satisfazer as propriedades ACID </h4><br>  Atomicidade.  Uma transa√ß√£o √© totalmente executada ou n√£o √© executada. <br><br>  Coer√™ncia.  No final da transa√ß√£o, as restri√ß√µes impostas aos dados (por exemplo, restri√ß√µes no banco de dados) n√£o devem ser violadas.  A consist√™ncia implica que o sistema ser√° transferido de um estado correto para outro correto. <br><br>  Isolamento.  As transa√ß√µes executadas simultaneamente n√£o devem se afetar, por exemplo, alterar dados usados ‚Äã‚Äãpor outra transa√ß√£o.  O resultado de transa√ß√µes paralelas deve ser como se as transa√ß√µes fossem executadas seq√ºencialmente. <br><br>  Sustentabilidade.  Uma vez confirmadas, as altera√ß√µes n√£o devem ser perdidas. <br><a name="habracut"></a><br><h2>  Log de transa√ß√£o </h2><br><h4>  O log armazena as altera√ß√µes feitas pelas transa√ß√µes, garante atomicidade e estabilidade dos dados em caso de falha do sistema </h4><br>  O log cont√©m os valores que os dados tinham antes e depois da altera√ß√£o pela transa√ß√£o.  A estrat√©gia de log write-ahead exige que voc√™ adicione ao log um registro dos valores anteriores antes do in√≠cio e sobre os valores finais ap√≥s a conclus√£o da transa√ß√£o.  No caso de uma parada repentina do sistema, o banco de dados l√™ o log na ordem inversa e descarta as altera√ß√µes feitas pelas transa√ß√µes.  Ap√≥s encontrar uma transa√ß√£o interrompida, o banco de dados a executa e faz altera√ß√µes sobre ela no log.  Estando no estado no momento da falha, o banco de dados l√™ o log na ordem direta e retorna as altera√ß√µes feitas pelas transa√ß√µes.  Assim, a estabilidade das transa√ß√µes que j√° foram confirmadas e a atomicidade da transa√ß√£o interrompida s√£o preservadas. <br><br>  Simplesmente reexecutar transa√ß√µes erradas n√£o √© suficiente para recuperar. <br><br>  <i>Um exemplo</i>  <i>O usu√°rio tem US $ 500 na conta e decide retir√°-los por meio de um caixa eletr√¥nico.</i>  <i>Duas transa√ß√µes s√£o realizadas.</i>  <i>O primeiro l√™ o valor do saldo e, se houver fundos suficientes no saldo, ele d√° dinheiro ao usu√°rio.</i>  <i>O segundo subtrai a quantia necess√°ria do saldo.</i>  <i>Suponha que um sistema trava e a primeira opera√ß√£o falha e a segunda falha.</i>  <i>Nesse caso, n√£o podemos reemitir dinheiro para o usu√°rio sem retornar o sistema ao seu estado original com um saldo positivo.</i> <br><br><h2>  N√≠veis de isolamento </h2><br><h4>  Leitura confirmada </h4><br>  O problema com uma leitura suja √© que uma transa√ß√£o pode ler o resultado intermedi√°rio de outra transa√ß√£o. <br><br>  <i>Um exemplo</i>  <i>O valor inicial do saldo √© $ 0.</i>  <i>T1 adiciona US $ 50 ao saldo.</i>  <i>T2 l√™ o valor do saldo (US $ 50).</i>  <i>T1 cancela as altera√ß√µes e termina.</i>  <i>T2 continua a execu√ß√£o com dados de saldo incorretos.</i> <br><br>  A solu√ß√£o √© Read Committed, que pro√≠be a leitura de dados modificados por uma transa√ß√£o.  Se a transa√ß√£o A alterou algum conjunto de dados, a transa√ß√£o B, ao acessar esses dados, √© for√ßada a aguardar a transa√ß√£o A. <br><br><h4>  Leitura Repet√≠vel </h4><br>  O problema de altera√ß√µes perdidas (atualiza√ß√µes perdidas).  T1 salva altera√ß√µes sobre altera√ß√µes em T2. <br><br>  <i>Um exemplo</i>  <i>O valor inicial do saldo √© $ 0 e duas transa√ß√µes reabastecem o saldo simultaneamente.</i>  <i>T1 e T2 leem um saldo de US $ 0.</i>  <i>Em seguida, o T2 adiciona US $ 200 a US $ 0 e salva o resultado.</i>  <i>T1 adiciona US $ 100 a US $ 0 e salva o resultado.</i>  <i>O resultado total √© $ 100 em vez de $ 300.</i> <br><br>  Problema de leitura irrepet√≠vel.  A leitura repetida dos mesmos dados retorna valores diferentes. <br><br>  <i>Um exemplo</i>  <i>T1 l√™ um valor de saldo de $ 0.</i>  <i>Em seguida, T2 adiciona US $ 50 ao saldo e termina.</i>  <i>T1 l√™ os dados novamente e detecta uma discrep√¢ncia com o resultado anterior.</i> <br><br>  Leitura repetida garante que a leitura repetida retorne o mesmo resultado.  Os dados lidos por uma transa√ß√£o s√£o proibidos de serem alterados em outras at√© que a transa√ß√£o seja conclu√≠da.  Se a transa√ß√£o A leu algum conjunto de dados, a transa√ß√£o B, ao acessar esses dados, √© for√ßada a aguardar a transa√ß√£o A. <br><br><h4>  Leitura em ordem (serializ√°vel) </h4><br>  Leituras fantasmas  Duas consultas que selecionam dados por alguma condi√ß√£o retornam valores diferentes. <br><br>  <i>Um exemplo</i>  <i>T1 solicita o n√∫mero de todos os usu√°rios cujo saldo √© maior que $ 0, mas menor que $ 100.</i>  <i>T2 subtrai US $ 1 de um usu√°rio com um saldo de US $ 101.</i>  <i>T1 re-executa a solicita√ß√£o.</i> <br><br>  Leitura ordenada (serializ√°vel).  As transa√ß√µes s√£o realizadas como completamente sequenciais.  √â proibido atualizar e adicionar registros sujeitos √†s condi√ß√µes da solicita√ß√£o.  Se a transa√ß√£o A solicitar dados da tabela inteira, a tabela inteira ser√° congelada pelo restante das transa√ß√µes at√© a transa√ß√£o A. <br><br><h2>  Programador </h2><br><h4>  Define a ordem em que as opera√ß√µes devem ser executadas em transa√ß√µes paralelas </h4><br>  Fornece um n√≠vel especificado de isolamento.  Se o resultado das opera√ß√µes n√£o depender de sua ordem, essas opera√ß√µes ser√£o comut√°veis ‚Äã‚Äã(permut√°veis).  Os comandos s√£o lidos e opera√ß√µes em dados diferentes.  As opera√ß√µes de leitura e grava√ß√£o e grava√ß√£o e grava√ß√£o n√£o s√£o comutativas.  A tarefa do planejador √© alternar opera√ß√µes executadas por transa√ß√µes paralelas, para que o resultado da execu√ß√£o seja equivalente √† execu√ß√£o seq√ºencial de transa√ß√µes. <br><br><h2>  Mecanismos de Controle de Concorr√™ncia </h2><br><h4>  Otimista com base na detec√ß√£o e resolu√ß√£o de conflitos, pessimista com base na preven√ß√£o de conflitos </h4><br>  Com uma abordagem otimista, v√°rios usu√°rios t√™m √† disposi√ß√£o c√≥pias dos dados.  O primeiro que concluiu a edi√ß√£o salva as altera√ß√µes, o restante deve mesclar as altera√ß√µes.  Um algoritmo otimista permite que um conflito ocorra, mas o sistema deve se recuperar do conflito. <br><br>  Com uma abordagem pessimista, o primeiro usu√°rio a capturar dados impede que outros recebam dados.  Se os conflitos s√£o raros, √© aconselh√°vel escolher uma estrat√©gia otimista, pois fornece um n√≠vel mais alto de paralelismo. <br><br><h2>  Travamento </h2><br><h4>  Se uma transa√ß√£o tiver bloqueado os dados, o restante da transa√ß√£o dever√° acessar os dados ao acess√°-los. </h4><br>  Um bloco pode ser sobreposto a um banco de dados, tabela, linha ou atributo.  O bloqueio compartilhado (bloqueio compartilhado) pode ser imposto aos mesmos dados por v√°rias transa√ß√µes, permite a leitura de todas as transa√ß√µes (incluindo a imposta), pro√≠be altera√ß√µes e captura exclusiva.  O bloqueio exclusivo pode ser imposto por apenas uma transa√ß√£o, permite qualquer a√ß√£o da transa√ß√£o imposta, pro√≠be qualquer a√ß√£o pelo restante. <br><br><h4>  Um impasse √© uma situa√ß√£o em que as transa√ß√µes est√£o no modo de espera, com dura√ß√£o indefinida </h4><br>  <i>Um exemplo</i>  <i>A primeira transa√ß√£o est√° aguardando a libera√ß√£o dos dados capturados pelo segundo, enquanto a segunda est√° aguardando a libera√ß√£o dos dados capturados pelo primeiro.</i> <br><br><h4>  Uma solu√ß√£o otimista para o problema de conflito permite que um conflito ocorra, mas depois restaura o sistema revertendo uma das transa√ß√µes envolvidas no conflito. </h4><br>  Com uma certa frequ√™ncia, √© realizada uma busca por deadlocks.  Um dos m√©todos de detec√ß√£o √© a tempo, ou seja, considerar que ocorreu um conflito se a transa√ß√£o demorar muito.  Quando um impasse √© encontrado, uma das transa√ß√µes √© revertida, o que permite que outras transa√ß√µes envolvidas no impasse sejam conclu√≠das.  A escolha da v√≠tima pode basear-se no valor das transa√ß√µes ou na sua antiguidade (esquemas de espera e morte e espera por feridas). <br><br>  A cada transa√ß√£o <b>T √©</b> atribu√≠do um <b>TS</b> com registro de data e hora que cont√©m a hora de in√≠cio da transa√ß√£o. <br><br>  Wait-Die <br><br>  <u>Se <b>TS (Ti)</b> &lt; <b>TS (Tj)</b> , o <b>Ti</b> espera, caso contr√°rio, o <b>Ti</b> reverte e inicia novamente com o mesmo carimbo de hora.</u> <br><br>  Se uma transa√ß√£o jovem capturou um recurso e uma mais antiga est√° solicitando o mesmo recurso, √© permitido esperar uma transa√ß√£o mais antiga.  Se uma transa√ß√£o mais antiga capturou um recurso, uma transa√ß√£o jovem solicitando esse recurso ser√° revertida. <br><br>  Espere ferida. <br><br>  <u>Se <b>TS (Ti)</b> &lt; <b>TS (Tj)</b> , ent√£o <b>Tj</b> reverte e inicia novamente com o mesmo carimbo de hora, caso contr√°rio, <b>Ti</b> espera.</u> <br><br>  Se uma transa√ß√£o mais jovem capturou um recurso e uma transa√ß√£o mais antiga est√° solicitando o mesmo recurso, a transa√ß√£o jovem ser√° revertida.  Se uma transa√ß√£o mais antiga capturou o recurso, uma transa√ß√£o mais nova que solicita esse recurso pode esperar.  A sele√ß√£o da v√≠tima com base na antiguidade impede conflitos, mas reverte as transa√ß√µes que n√£o est√£o em um estado de bloqueio.  O problema √© que as transa√ß√µes podem ser revertidas muitas vezes porque  Uma transa√ß√£o mais antiga pode reter um recurso por um longo tempo. <br><br><h4>  Uma solu√ß√£o pessimista para o problema de deadlocks n√£o permite que a transa√ß√£o inicie a execu√ß√£o se houver risco de deadlock </h4><br>  Para detectar conflitos, um gr√°fico √© constru√≠do (um gr√°fico de espera, espera por gr√°fico), cujos v√©rtices s√£o transa√ß√µes e as arestas s√£o direcionadas a partir de transa√ß√µes que aguardam a libera√ß√£o de dados para a transa√ß√£o que capturou esses dados.  Acredita-se que ocorreu um conflito se o gr√°fico estiver em loop.  Construir um gr√°fico de espera, especialmente em bancos de dados distribu√≠dos, √© um procedimento caro. <br><br><h4>  Bloqueio de duas fases - impedindo conflitos, capturando todos os recursos utilizados pela transa√ß√£o no in√≠cio da transa√ß√£o e liberando-os no final </h4><br>  Todas as opera√ß√µes de bloqueio devem preceder o primeiro desbloqueio.  Possui duas fases - a fase de crescimento, na qual ocorre a captura das garras e a fase de encolhimento, na qual ocorre a libera√ß√£o das garras.  Se for imposs√≠vel capturar um dos recursos, a transa√ß√£o come√ßar√° novamente.  √â poss√≠vel que uma transa√ß√£o n√£o possa capturar os recursos necess√°rios, por exemplo, se v√°rias transa√ß√µes competem pelos mesmos recursos. <br><br><h4>  A confirma√ß√£o em duas fases garante que a confirma√ß√£o seja executada em todas as r√©plicas do banco de dados </h4><br>  Cada banco de dados contribui com informa√ß√µes sobre os dados que ser√£o alterados para o log e correspondem ao coordenador OK (fase de vota√ß√£o).  Depois que todos responderam bem, o coordenador envia um sinal obrigando todos a se comprometerem.  Ap√≥s confirmar o servidor, eles respondem bem, se pelo menos um n√£o respondeu, ent√£o o coordenador envia um sinal para cancelar as altera√ß√µes em todos os servidores (fase de conclus√£o). <br><br><h2>  M√©todo de carimbo de data e hora </h2><br><h4>  Uma transa√ß√£o mais antiga reverte ao tentar acessar os dados envolvidos em uma transa√ß√£o mais nova </h4><br>  Cada transa√ß√£o recebe um carimbo de data / hora <b>TS</b> correspondente ao hor√°rio de in√≠cio da execu√ß√£o.  Se <b>Ti for</b> mais antigo que <b>Tj</b> , ent√£o <b>TS (Ti)</b> &lt; <b>TS (Tj)</b> . <br><br>  Quando uma transa√ß√£o √© revertida, √© atribu√≠do um novo carimbo de data / hora.  Cada objeto de dados <b>Q</b> envolvido na transa√ß√£o √© marcado com dois r√≥tulos.  <b>W-TS (Q)</b> √© o registro de data e hora da transa√ß√£o mais jovem que foi gravada com √™xito em <b>Q.</b>  <b>R-TS (Q)</b> √© o registro de data e hora da transa√ß√£o mais jovem que concluiu um registro de leitura sobre <b>Q.</b> <br><br>  Quando a transa√ß√£o <b>T</b> solicita a leitura de dados <b>Q</b> , duas op√ß√µes s√£o poss√≠veis. <br><br>  <u>Se <b>TS (T)</b> &lt; <b>W-TS (Q)</b> , ou seja, os dados foram atualizados por uma transa√ß√£o mais nova, a transa√ß√£o <b>T</b> reverte.</u> <br><br>  <u>Se <b>TS (T)</b> &gt; = <b>W-TS (Q)</b> , a leitura √© realizada e <b>R-TS (Q)</b> se torna <b>MAX (R-TS (Q), TS (T))</b> .</u> <br><br>  Quando a transa√ß√£o <b>T</b> solicita uma altera√ß√£o nos dados <b>Q</b> , duas op√ß√µes s√£o poss√≠veis. <br><br>  <u>Se <b>TS (T)</b> &lt; <b>R-TS (Q)</b> , ou seja, os dados j√° tiverem sido lidos por uma transa√ß√£o mais nova e se uma altera√ß√£o for feita, surgir√° um conflito.</u>  <u>A transa√ß√£o <b>T</b> reverte.</u> <br><br>  <u>Se <b>TS (T)</b> &lt; <b>W-TS (Q)</b> , ou seja, a transa√ß√£o tentar substituir o valor mais recente, a transa√ß√£o T reverte.</u>  <u>Noutros casos, a altera√ß√£o √© realizada e <b>W-TS (Q)</b> torna-se igual a <b>TS (T)</b> .</u> <br><br>  N√£o √© necess√°ria nenhuma constru√ß√£o cara de gr√°fico caro.  As transa√ß√µes mais antigas dependem das mais recentes; portanto, n√£o h√° loops na coluna de espera.  N√£o h√° impasses, porque as transa√ß√µes n√£o esperam, mas s√£o revertidas imediatamente.  Recompensas em cascata s√£o poss√≠veis.  Se o <b>Ti</b> retrocedeu e <b>Tj</b> leu os dados que o <b>Ti</b> alterou, o <b>Tj</b> tamb√©m deve retroceder.  Se, ao mesmo tempo, Tj j√° tiver sido comunicado, haver√° uma viola√ß√£o do princ√≠pio da estabilidade. <br><br>  Uma solu√ß√£o para revers√µes em cascata.  Uma transa√ß√£o executa todas as opera√ß√µes de grava√ß√£o no final, e as transa√ß√µes restantes devem aguardar a conclus√£o desta opera√ß√£o.  As transa√ß√µes est√£o aguardando uma confirma√ß√£o antes da leitura. <br><br><h4>  Regra de grava√ß√£o Thomas - uma varia√ß√£o do m√©todo de carimbo de data e hora em que os dados atualizados por uma transa√ß√£o mais nova n√£o podem ser substitu√≠dos por uma mais antiga </h4><br>  A transa√ß√£o <b>T</b> solicita uma altera√ß√£o nos dados <b>Q.</b>  Se <b>TS (T)</b> &lt; <b>W-TS (Q)</b> , ou seja, a transa√ß√£o est√° tentando substituir um valor mais recente, a transa√ß√£o T n√£o √© revertida como no m√©todo de carimbo de data / hora. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt446662/">https://habr.com/ru/post/pt446662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt446650/index.html">Quanto custam os testadores e em que dependem seus sal√°rios? Criando um retrato de um especialista em controle de qualidade bem-sucedido</a></li>
<li><a href="../pt446654/index.html">Como salvamos a revis√£o de c√≥digo</a></li>
<li><a href="../pt446656/index.html">Codifica√ß√£o de fala de 1600 bits / s com vocoder neural LPCNet</a></li>
<li><a href="../pt446658/index.html">Entrevista com Andrei Stankevich sobre programa√ß√£o esportiva</a></li>
<li><a href="../pt446660/index.html">IA, aluno e grande pr√™mio: como fazer o aprendizado de m√°quina na 8¬™ s√©rie</a></li>
<li><a href="../pt446664/index.html">O SAP Forum 2019 est√° a apenas 2 semanas! O que vai estar a√≠?</a></li>
<li><a href="../pt446666/index.html">Aproveite ao m√°ximo as calculadoras gr√°ficas: jogos na TI-83</a></li>
<li><a href="../pt446674/index.html">Modelamos o algoritmo MUSIC para determinar a dire√ß√£o de chegada de uma onda eletromagn√©tica</a></li>
<li><a href="../pt446676/index.html">Criando teclas ausentes para o teclado de borracha Commodore 116</a></li>
<li><a href="../pt446678/index.html">Live Battle: finais do Porto ICPC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>