<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüíº ü•å üë∂üèΩ Criando um jogo de l√≥gica para uma plataforma de jogos üèπ üë¶ üëçüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√°. 

 Quero compartilhar minha hist√≥ria de familiaridade com a plataforma de jogos Gameduino 3, bem como um pouco sobre como programar o jogo l√≥gico...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um jogo de l√≥gica para uma plataforma de jogos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423577/">  Ol√°. <br><br>  Quero compartilhar minha hist√≥ria de familiaridade com a plataforma de jogos Gameduino 3, bem como um pouco sobre como programar o jogo l√≥gico mais simples para esta plataforma, usado em conjunto com o Arduino Uno. <br><br>  O que √© o Gameduino 3?  O Gameduino 3 √© uma placa de expans√£o que permite transformar o Arduino em um console de jogos port√°til moderno (tamanho significativo).  Para minha surpresa, n√£o consegui encontrar nenhuma informa√ß√£o detalhada nesta placa no hub.  Gostaria de preencher essa lacuna, principalmente porque o conselho, na minha opini√£o, merece aten√ß√£o. <br><br><h3>  Um pouco de hist√≥ria </h3><br>  O autor do projeto chamado Gameduino √© James Bowman, que em 2011 criou a primeira vers√£o do conselho.  Em seguida, foi posicionado como um m√≥dulo VGA para o Arduino.  O conselho chamava-se Gameduino e era baseado na fam√≠lia de FPGAs l√≥gicos program√°veis ‚Äã‚ÄãXilinx Spartan-3A.  Conectores para conectar um monitor VGA e alto-falantes est√©reo foram instalados na placa. <img src="https://habrastorage.org/webt/as/6q/1-/as6q1-hlbbmoyubblbcs6hehog0.jpeg" alt="imagem"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Recursos do Gameduino (1):</b> <div class="spoiler_text"><ul><li>  Sa√≠da de v√≠deo VGA com resolu√ß√£o de 400x300 pixels, 512 cores; </li><li>  toda a gama de cores √© processada em FPGA com precis√£o de 15 bits; </li></ul><br>  gr√°ficos de fundo: <br><br><ul><li>  √°rea de gr√°ficos de fundo simb√≥licos de 512x512 pixels; </li><li>  256 caracteres, cada um com uma paleta de 4 cores independente; </li><li>  implementou o efeito de agrupar seq√º√™ncias de texto com suaviza√ß√£o de pixel; </li></ul><br>  gr√°ficos de primeiro plano: <br><br><ul><li>  Cada sprite tem uma resolu√ß√£o de 16x16 pixels; </li><li>  cada sprite pode ter uma paleta de 256, 16 ou 4 cores; </li><li>  suporte para algoritmos de rota√ß√£o em quatro dire√ß√µes e rota√ß√£o horizontal; </li><li>  96 sprites por linha raster, 1536 elementos de textura por linha raster; </li><li>  mecanismo para detectar poss√≠veis interse√ß√µes de sprites; </li></ul><br>  sa√≠da de √°udio: <br><br><ul><li>  Sintetizador de frequ√™ncia de canal duplo de 12 bits; </li><li>  Polifonia de 64 vozes na faixa de frequ√™ncias de 10 - 8000 Hz. </li></ul><br>  A imagem √© exibida na tela de um monitor VGA padr√£o com uma resolu√ß√£o de 400x300 pixels, <br>  a compatibilidade com qualquer monitor VGA padr√£o com uma resolu√ß√£o de 800x600 pixels √© mantida. <br></div></div><br>  Em 2013, foi lan√ßada a segunda vers√£o da placa - Gameduino 2, na qual, ao contr√°rio da vers√£o anterior, j√° havia uma tela sens√≠vel ao toque resistiva de 4,3 polegadas com resolu√ß√£o de 480x272, um aceler√¥metro de 3 eixos, um slot de cart√£o de mem√≥ria microSD e uma sa√≠da de √°udio para fones de ouvido. <br><br><img src="https://habrastorage.org/webt/rv/e-/vg/rve-vggbftjqtpadk4ftr7xtfq4.jpeg" alt="imagem"><br><br>  O ‚Äúcora√ß√£o‚Äù da placa era o controlador gr√°fico EVE (Embedded Video Engine - em russo pode ser traduzido como ‚Äúm√≥dulo de v√≠deo incorporado‚Äù) FT800, que possui poderosas capacidades de computa√ß√£o, combinando v√°rias fun√ß√µes ao mesmo tempo: forma√ß√£o da imagem e sua sa√≠da para a tela da tela TFT, processamento de tela de toque, gera√ß√£o de som. <br><br><div class="spoiler">  <b class="spoiler_title">Diagrama funcional do controlador gr√°fico FT800</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lj/7_/dd/lj7_ddvshsrqz9f1mhfs_xhzvja.jpeg" alt="imagem"><br><br>  Os seguintes blocos funcionais est√£o inclu√≠dos na estrutura do microcircuito: controlador gr√°fico, controlador de √°udio, controlador de painel de toque resistivo.  O chip FT800 foi projetado para controlar monitores com uma resolu√ß√£o de at√© 512 x 512 pixels.  O FT800 tamb√©m suporta LCD WQVGA (480 x 272) e QVGA (320 x 240).  O EVE (Embedded Video Engine) FT800 √© uma solu√ß√£o pronta para criar uma interface gr√°fica do usu√°rio.  O microcircuito gera sinais de controle de exibi√ß√£o, possui fun√ß√µes gr√°ficas incorporadas para exibir pontos, linhas, imagens bitmap, bot√µes de volume, textos, etc. </div></div><br><br><div class="spoiler">  <b class="spoiler_title">Estrutura do sistema baseada no controlador gr√°fico FT800</b> <div class="spoiler_text">  A forma√ß√£o da imagem √© baseada em um conjunto de comandos (lista de exibi√ß√£o), que √© transmitido pelo microcontrolador de controle para o FT800 via interface I2C ou SPI (no Gameduino 2, a comunica√ß√£o entre o Arduino e o FT800 √© realizada via interface SPI).  Os recursos do FT800 aliviam significativamente o controlador host do sistema. <br><br><img src="https://habrastorage.org/webt/br/2b/2u/br2b2ueemryzlv-qxkor6whrft4.jpeg" alt="imagem"><br><br>  Por exemplo, para exibir v√°rios bot√µes, basta transferir um comando para o controlador gr√°fico (quatro palavras de 32 bits), e o FT800 formar√° independentemente a imagem desses bot√µes na tela do visor TFT.  O conjunto de comandos do controlador gr√°fico FTDI inclui mais de 50 fun√ß√µes que podem ser usadas para exibir v√°rias imagens na tela com v√°rios efeitos. <br><br>  Manual detalhado de programa√ß√£o do controlador e exemplos de trabalho com v√°rios ambientes de design podem ser encontrados nas Notas de Aplica√ß√£o no site da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">FTDI</a> . <br><br>  Em russo, h√° uma boa descri√ß√£o da funcionalidade, princ√≠pios gerais e exemplos de trabalho. <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Recursos do Gameduino 2:</b> <div class="spoiler_text"><ul><li>  resolu√ß√£o de tela de 480x272 pixels em cores de 24 bits; </li><li>  um conjunto de comandos no estilo do OpenGL; </li><li>  at√© 2000 sprites de qualquer tamanho; </li><li>  256 KB de mem√≥ria de v√≠deo; </li><li>  rota√ß√£o e escalonamento suaves de sprites com filtragem bilinear; </li><li>  c√≠rculo suave e padr√£o linear no hardware - suaviza√ß√£o 16x; </li><li>  Decodifica√ß√£o de hardware JPEG; </li><li>  Renderiza√ß√£o embutida de gradientes, texto, mostradores e bot√µes. </li></ul><br>  O som √© emitido atrav√©s de um fone de ouvido refor√ßado. <br>  O sistema suporta a sele√ß√£o de amostras e ferramentas integradas. <br><br>  A ROM do controlador j√° est√° conectada: <br><br><ul><li>  fontes de alta qualidade (6 tamanhos); </li><li>  amostras de 8 instrumentos musicais tocados por uma nota MIDI; </li><li>  amostras de 10 sons de percuss√£o. </li></ul><br>  E, √© claro, voc√™ pode carregar suas pr√≥prias fontes e sons em 256 Kbytes de RAM. <br><br>  O uso da plataforma Arduino n√£o √© um pr√©-requisito: a placa Gameduino 2 pode ser conectada a qualquer microcontrolador ou placa de microcontrolador com uma interface SPI. </div></div><br>  Em 2017, foi lan√ßada a terceira vers√£o da placa - Gameduino 3, que parece quase id√™ntica √† Gameduino 2. Em vez do FT800, √© usado o novo controlador gr√°fico FT810, que tem compatibilidade com o software anterior com o FT800 (ou seja, todo o c√≥digo do Gameduino2 funciona no Gameduino3). mas, ao mesmo tempo, possui recursos de computa√ß√£o 4 vezes maiores, como decodifica√ß√£o JPEG de hardware mais r√°pida, decodifica√ß√£o de v√≠deo, at√© 1 MB de RAM, etc. <br><br><div class="spoiler">  <b class="spoiler_title">Caracter√≠sticas Gameduino 3:</b> <div class="spoiler_text"><ul><li>  decodificador de v√≠deo para v√≠deo em tela cheia a 30 fps; </li><li>  1 megabyte de RAM interna; </li><li>  conectores para cart√µes microSD e sa√≠da de √°udio; </li><li>  Painel LCD de alto contraste de 4,3 ‚Äù480x272 com tela de toque resistiva; </li><li>  suporte para mapas criados usando o editor Tiled Map; </li><li>  Fa√ßa o download da imagem PNG do microSD; </li><li>  decodifica√ß√£o JPEG acelerada; </li><li>  comuta√ß√£o retrato / paisagem de hardware; </li><li>  suporte para Arduino, ESP8266 e Teensy 3.2; </li><li>  Ferramentas online para preparar gr√°ficos, √°udio, fonte e v√≠deo; </li></ul><br></div></div><br>  James Bowman publicou uma biblioteca para seu projeto com muitos exemplos que funcionam imediatamente.  A biblioteca atual que eu consegui encontrar est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de Programa√ß√£o</a> (em ingl√™s), onde tudo √© descrito em detalhes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Muitas informa√ß√µes √∫teis sobre</a> a instala√ß√£o de um IDE, etc., etc. <br><br><h3>  Programa√ß√£o </h3><br>  De alguma forma, vagando pelas extens√µes do <s>Teatro Bolshoi na</s> Internet, deparei-me com um projeto interessante para o Arduino - o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">jogo l√≥gico ‚ÄúColumns‚Äù</a> , escrito sob o habitual display colorido chin√™s de 128x160 pixels.  Queria repetir esse jogo, mas, no meu tabuleiro, vou cham√°-lo de FT810 (com o nome da GPU), que j√° estava em minhas m√£os.  Eu j√° consegui estudar o manual de programa√ß√£o e exemplos da biblioteca, ent√£o minhas m√£os ‚Äúco√ßaram‚Äù com o desejo de escrever algo pr√≥prio.  Que eu comecei imediatamente. <br><br>  A primeira coisa que tive que fazer foi exibir o texto na tela. <br><br>  Gra√ßas √† presen√ßa de fontes internas, a sa√≠da de texto para a tela √© bastante f√°cil.  Aqui est√° um esbo√ßo demo da biblioteca (com meus coment√°rios): <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo helloworld.ino</b> <div class="spoiler_text"><pre><code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000  GD.begin(0); //  ,   . } void loop() { GD.ClearColorRGB(0x103000); //    . GD.Clear(); //   (   ) GD.cmd_text( //  ,  GD.w / 2, //     2 GD.h / 2, //     2 31, //   OPT_CENTER, // ,         . </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello world"</span></span></span><span class="hljs-meta">); //   GD.swap(); //         (   ). }</span></span></code> </pre>  Como resultado, chegamos aqui um texto t√£o bonito: <br><img src="https://habrastorage.org/webt/em/jq/xi/emjqxiynb2wjckhowwkvltpta9c.png" alt="imagem"><br></div></div><br>  Em seguida, foi necess√°rio desenhar formas geom√©tricas, por exemplo: linhas. <br>  Para desenhar linhas, voc√™ deve usar Begin (LINES) ou Begin (LINE_STRIP). <br>  LINES une cada par de v√©rtices, enquanto LINE_STRIP une todos os v√©rtices. <br><br>  Vou dar o seguinte esbo√ßo demo da biblioteca (com meus coment√°rios): <br><br><div class="spoiler">  <b class="spoiler_title">Sketch lines.ino</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000 . GD.begin(); //  ,   . } static void zigzag(int x) { GD.Vertex2ii(x - 10, 10); //     GD.Vertex2ii(x + 10, 60); //     () GD.Vertex2ii(x - 10, 110); GD.Vertex2ii(x + 10, 160); GD.Vertex2ii(x - 10, 210); GD.Vertex2ii(x + 10, 260); //     () } void loop() { GD.Clear(); //   (    - 0000000) GD.Begin(LINES); //     zigzag(140); //   zigzag   -   GD.Begin(LINE_STRIP); //     zigzag(240); GD.LineWidth(16 * 10); //        1/16 , .. 1/16 * 16 * 10 = 10  GD.Begin(LINE_STRIP); zigzag(340); GD.swap(); //         (   ). }</span></span></code> </pre> <br>  Linhas na tela: <br><br><img src="https://habrastorage.org/webt/zr/bp/_w/zrbp_ws6saudfdakxpv8tf2tvwc.png" alt="imagem"></div></div><br>  Do desenho de linha, vamos para o desenho de ret√¢ngulos. <br><br>  Para desenhar ret√¢ngulos, use Begin (RECTS) e defina os cantos opostos do ret√¢ngulo.  A ordem dos dois √¢ngulos n√£o importa.  Os ret√¢ngulos s√£o desenhados com cantos arredondados, usando a largura da linha atual como o raio do canto.  Os cantos arredondados estendem-se al√©m das bordas do ret√¢ngulo, aumentando o raio do √¢ngulo, levando a um aumento no n√∫mero de pixels.  Este exemplo desenha um ret√¢ngulo 420 √ó 20 tr√™s vezes com raio de canto crescente. <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo rectangles.ino</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000 . GD.begin(); //  ,   . } void loop() { GD.Clear(); //   (    - 0000000) GD.Begin(RECTS); //     GD.Vertex2ii(30, 30); //       GD.Vertex2ii(450, 50); //       GD.LineWidth(16 * 10); //         1/16 , .. 1/16 * 16 * 10 = 10  GD.Vertex2ii(30, 120); //       GD.Vertex2ii(450, 140); //       GD.LineWidth(16 * 20); //         1/16 , .. 1/16 * 16 * 20 = 20  GD.Vertex2ii(30, 220); //       GD.Vertex2ii(450, 230); //       GD.swap(); //         (   ) }</span></span></code> </pre> <br>  Resultado: <br><img src="https://habrastorage.org/webt/vg/qi/mc/vgqimcuhwc-jsiwqizewxsxlgf8.png" alt="imagem"><br></div></div><br>  Vamos desenhar um c√≠rculo - a base dos futuros bot√µes de toque.  Vamos voltar ao primeiro exemplo com texto e adicionar algumas linhas ao loop (). <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo com desenho de c√≠rculos coloridos</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000  GD.begin(0); //  ,   . } void loop() { GD.ClearColorRGB(0x103000); //    . GD.Clear(); //   (   ) GD.cmd_text( //  ,  GD.w / 2, //     2 GD.h / 2, //     2 31, //   OPT_CENTER, // ,          </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello world"</span></span></span><span class="hljs-meta">); //   GD.PointSize(16 * 30); //    ()    1/16 , .. 1/16 * 16 * 30 = 30  GD.Begin(POINTS); //     () GD.ColorRGB(0xff8000); //   orange GD.Vertex2ii(220, 100); //   ()   220,100 GD.ColorRGB(0x0080ff); //   teal GD.Vertex2ii(260, 170); //   ()   260,170 GD.swap(); //         (   ) }</span></span></code> </pre> <br>  Resultado: <br><br><img src="https://habrastorage.org/webt/gw/rz/ja/gwrzjak3bp7sqsywwd89rwj0-5w.png"><br></div></div><br>  Para trabalhar com os bot√µes de toque, √© necess√°rio organizar o processamento de cliques na tela de toque.  Isso √© feito da seguinte maneira.  Vou explicar brevemente o princ√≠pio.  Cada pixel (ponto) na tela tem uma cor.  Ele tamb√©m possui um valor de tag invis√≠vel, que pode ser atribu√≠do a um ponto (ou a um objeto inteiro, como linha, c√≠rculo, ret√¢ngulo, etc.) e usado para detectar toques nesse objeto.  O esbo√ßo a seguir mostra um exemplo de configura√ß√£o do valor da tag para c√≠rculos coloridos como 100 e 101. <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo da tela de toque</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> void setup() { Serial.begin(1000000); //   ,    1000000  GD.begin(0); //  ,   . } void loop() { GD.ClearColorRGB(0x103000); //    . GD.Clear(); //   (   ) GD.cmd_text( //  ,  GD.w / 2, //     2 GD.h / 2, //     2 31, //   OPT_CENTER, // ,          </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Hello world"</span></span></span><span class="hljs-meta">); //   GD.PointSize(16 * 30); //    ()    1/16 , .. 1/16 * 16 * 30 = 30  GD.Begin(POINTS); //     () GD.ColorRGB(0xff8000); //   orange GD.Tag(100); //       () GD.Vertex2ii(220, 100); //   ()   220,100 GD.ColorRGB(0x0080ff); //   teal GD.Tag(101); //       () GD.Vertex2ii(260, 170); //   ()   260,170 GD.swap(); //         (   ) GD.get_inputs(); //     if(GD.inputs.tag &gt; 0) //      Serial.println(GD.inputs.tag); //       ‚Äú‚Äù  }</span></span></code> </pre> <br>  Agora, quando o sistema detecta um toque em qualquer c√≠rculo, ele relata o c√≥digo do sensor, neste caso 100 ou 101. Quando voc√™ clica em objetos (c√≠rculos coloridos) na tela na janela da porta serial, os valores das tags correspondentes aos objetos pressionados ser√£o exibidos: <br><br><img src="https://habrastorage.org/webt/lh/q3/u_/lhq3u_jn8obrrcjy_kwke8m6gdw.png"><br></div></div><br>  Dei exemplos de opera√ß√µes b√°sicas, usando as quais j√° era poss√≠vel prosseguir com seguran√ßa para a cria√ß√£o do jogo.  Obviamente, o jogo n√£o foi criado do zero, mas a base era um c√≥digo de trabalho pronto que foi adaptado (preservando os gr√°ficos); portanto, a vers√£o original do jogo era muito semelhante √† original. <br><br>  A primeira vers√£o do jogo: <br><br><img src="https://habrastorage.org/webt/3f/no/xg/3fnoxgf8auqkkotrp1lgtjqk6kq.jpeg"><br><br>  Depois de jogar por v√°rios dias, eu queria mudar alguma coisa no design, por exemplo, para adicionar outro, incomum, em vez de um fundo branco.  E ent√£o me lembrei de um exemplo da biblioteca, no qual o c√©u estrelado brilhava ao fundo: <br><br><div class="spoiler">  <b class="spoiler_title">Esbo√ßo do slot slotgag.ino</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;EEPROM.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SPI.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;GD2.h&gt;</span></span></span><span class="hljs-meta"> #include </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"slotgag_assets.h"</span></span></span><span class="hljs-meta"> //      void setup() { Serial.begin(1000000); GD.begin(); LOAD_ASSETS(); //     } void loop() { GD.Clear(); //   ( ,     ) GD.ColorMask(1, 1, 1, 0); //        R, G, B,   GD.Begin(BITMAPS); //      GD.BitmapHandle(BACKGROUND_HANDLE); //   - GD.BitmapSize(NEAREST, REPEAT, REPEAT, 480, 272); //        GD.Vertex2ii(0, 0, BACKGROUND_HANDLE); //      0,0 GD.ColorMask(1, 1, 1, 1); GD.ColorRGB(0xa0a0a0); GD.Vertex2ii(240 - GAMEDUINO_WIDTH / 2, 136 - GAMEDUINO_HEIGHT / 2, GAMEDUINO_HANDLE); static int x = 0; GD.LineWidth(20 * 16); GD.BlendFunc(DST_ALPHA, ONE); GD.Begin(LINES); GD.Vertex2ii(x, 0); GD.Vertex2ii(x + 100, 272); x = (x + 20) % 480; //' }a GD.swap(); }</span></span></code> </pre> <br>  Ver: <br><br><img src="https://habrastorage.org/webt/x-/es/y4/x-esy4aropwlyqh0bvl75jf1qpg.png"><br><br>  Para n√£o me aprofundar na selva, n√£o comentei o c√≥digo inteiro, mas comentei apenas as linhas de c√≥digo necess√°rias que copiei no meu esbo√ßo de trabalho. </div></div><br>  Para adicionar uma imagem do c√©u estrelado como pano de fundo, tive que fazer o seguinte: primeiro, mude a cor preta das linhas e do texto para branco (para que fiquem vis√≠veis em um fundo preto), escreva o arquivo slotgag.gd2 no cart√£o micro SD, que armazena a imagem, adicione slotgag_assets.h √† pasta do projeto e adicione as 8 linhas de c√≥digo necess√°rias ao esbo√ßo. <br><br>  Como resultado, o jogo adquiriu este formul√°rio: <br><br><img src="https://habrastorage.org/webt/2t/hh/qo/2thhqo_apc-nidsqbcuudt98bwe.jpeg"><br><br>  E, claro, que tipo de jogo √© sem design de som?  Resta adicionar efeitos sonoros, principalmente porque s√£o apresentados em boa qualidade e variedade. <br><br>  Gameduino 2/3 possui dois sistemas de som.  O primeiro - um sintetizador - pode gerar um conjunto de sons fixos e notas musicais.  Um sintetizador √© √∫til para adicionar som rapidamente a um projeto, mas como o conjunto de sons √© fixo, ele n√£o √© muito flex√≠vel.  O segundo √© a reprodu√ß√£o da amostra.  Reproduz o som amostrado da mem√≥ria principal em v√°rios formatos.  Esse sistema √© muito mais flex√≠vel, mas voc√™ precisar√° preparar e carregar amostras na RAM. <br><br>  Eu usei um sintetizador de som fixo.  O sintetizador fornece v√°rios sons curtos de "percuss√£o", principalmente para uso em interfaces de usu√°rio.  Para reproduzir um som, voc√™ deve chamar GD.play () com um identificador de som.  Lista completa de sons dispon√≠veis: <br><br>  Clique em <br>  INTERRUPTOR <br>  Cowbell <br>  NOTCH <br>  Hihat <br>  Kickdrum <br>  Pop <br>  Clack <br>  CHACK <br><br><h3>  Sum√°rio </h3><br>  O resultado foi um esbo√ßo: <br><br><div class="spoiler">  <b class="spoiler_title">Sketch Columns.ino</b> <div class="spoiler_text"><pre> <code class="hljs lua">#include &lt;SPI.h&gt; #include &lt;GD2.h&gt; #include &lt;avr/eeprom.h&gt; #include <span class="hljs-string"><span class="hljs-string">"slotgag_assets.h"</span></span> #define TAG_BUTTON_LEFT <span class="hljs-number"><span class="hljs-number">201</span></span> #define TAG_BUTTON_RIGHT <span class="hljs-number"><span class="hljs-number">202</span></span> #define TAG_BUTTON_ROT <span class="hljs-number"><span class="hljs-number">203</span></span> #define TAG_BUTTON_DROP <span class="hljs-number"><span class="hljs-number">204</span></span> #define X_BUTTON_LEFT <span class="hljs-number"><span class="hljs-number">50</span></span> #define Y_BUTTON_LEFT <span class="hljs-number"><span class="hljs-number">222</span></span> #define X_BUTTON_RIGHT <span class="hljs-number"><span class="hljs-number">430</span></span> #define Y_BUTTON_RIGHT <span class="hljs-number"><span class="hljs-number">222</span></span> #define X_BUTTON_ROT <span class="hljs-number"><span class="hljs-number">430</span></span> #define Y_BUTTON_ROT <span class="hljs-number"><span class="hljs-number">50</span></span> #define X_BUTTON_DROP <span class="hljs-number"><span class="hljs-number">50</span></span> #define Y_BUTTON_DROP <span class="hljs-number"><span class="hljs-number">50</span></span> // Color definitions #define BLACK <span class="hljs-number"><span class="hljs-number">0x000000</span></span> #define RED <span class="hljs-number"><span class="hljs-number">0xFF0000</span></span> #define GREEN <span class="hljs-number"><span class="hljs-number">0x00FF00</span></span> #define BLUE <span class="hljs-number"><span class="hljs-number">0x0000FF</span></span> #define YELLOW <span class="hljs-number"><span class="hljs-number">0xFFFF00</span></span> #define MAGENTA <span class="hljs-number"><span class="hljs-number">0xFF00FF</span></span> #define CYAN <span class="hljs-number"><span class="hljs-number">0x00FFFF</span></span> #define WHITE <span class="hljs-number"><span class="hljs-number">0xFFFFFF</span></span> #define DISPLAY_MAX_X <span class="hljs-number"><span class="hljs-number">480</span></span> #define DISPLAY_MAX_Y <span class="hljs-number"><span class="hljs-number">272</span></span> #define MaxX <span class="hljs-number"><span class="hljs-number">8</span></span> #define MaxY <span class="hljs-number"><span class="hljs-number">17</span></span> #define SmeX <span class="hljs-number"><span class="hljs-number">3</span></span> #define SmeY <span class="hljs-number"><span class="hljs-number">3</span></span> #define razmer <span class="hljs-number"><span class="hljs-number">18</span></span> #define NumCol <span class="hljs-number"><span class="hljs-number">6</span></span> #define MaxLevel <span class="hljs-number"><span class="hljs-number">8</span></span> #define NextLevel <span class="hljs-number"><span class="hljs-number">80</span></span> #define DISP_LEFT ((DISPLAY_MAX_X - MaxX*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>) #define DISP_RIGHT ((DISPLAY_MAX_X + MaxX*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) #define DISP_TOP ((DISPLAY_MAX_Y - (MaxY<span class="hljs-number"><span class="hljs-number">-4</span></span>)*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>) #define DISP_BOT ((DISPLAY_MAX_Y + (MaxY<span class="hljs-number"><span class="hljs-number">-4</span></span>)*razmer)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) uint8_t MasSt[MaxX][MaxY], MasTmp[MaxX][MaxY], fignext[<span class="hljs-number"><span class="hljs-number">3</span></span>]; uint8_t Level=<span class="hljs-number"><span class="hljs-number">1</span></span>, dx, dy, tr, flfirst=<span class="hljs-number"><span class="hljs-number">1</span></span>; uint32_t MasCol[]={WHITE, BLACK, RED, BLUE, GREEN, YELLOW, MAGENTA, CYAN}; unsigned long Counter, Score=<span class="hljs-number"><span class="hljs-number">0</span></span>, TScore=<span class="hljs-number"><span class="hljs-number">0</span></span>, Record=<span class="hljs-number"><span class="hljs-number">0</span></span>, myrecord; uint16_t tempspeed = <span class="hljs-number"><span class="hljs-number">1000</span></span>; bool fl, Demo=<span class="hljs-literal"><span class="hljs-literal">true</span></span>, Arbeiten=<span class="hljs-literal"><span class="hljs-literal">false</span></span>, FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; int8_t x,y; int8_t mmm [<span class="hljs-number"><span class="hljs-number">4</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]={{<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>},{<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">-1</span></span>},{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>},{<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}}; uint16_t MasSpeed[MaxLevel]={<span class="hljs-number"><span class="hljs-number">500</span></span>,<span class="hljs-number"><span class="hljs-number">450</span></span>,<span class="hljs-number"><span class="hljs-number">400</span></span>,<span class="hljs-number"><span class="hljs-number">350</span></span>,<span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">250</span></span>,<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>}; uint8_t state_game = <span class="hljs-number"><span class="hljs-number">0</span></span>; unsigned long time_count; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> prevkey; uint32_t btn_color = <span class="hljs-number"><span class="hljs-number">0xff0000</span></span>; /****************************************************************************************************************/ void setup(void) { Serial.begin(<span class="hljs-number"><span class="hljs-number">1000000</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"Columns"</span></span>); GD.begin(); LOAD_ASSETS(); GD.BitmapHandle(BACKGROUND_HANDLE); GD.BitmapSize(NEAREST, REPEAT, REPEAT, <span class="hljs-number"><span class="hljs-number">480</span></span>, <span class="hljs-number"><span class="hljs-number">272</span></span>); randomSeed(analogRead(<span class="hljs-number"><span class="hljs-number">5</span></span>)); myrecord = eeprom_read_byte((unsigned <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *)<span class="hljs-number"><span class="hljs-number">1</span></span>); time_count = millis() + <span class="hljs-number"><span class="hljs-number">1000</span></span>; } static struct { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> t, note; } pacman[] = { { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span> }, { <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">72</span></span> }, { <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">84</span></span> }, { <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span> }, { <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">84</span></span> }, { <span class="hljs-number"><span class="hljs-number">25</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span> }, { <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">71</span></span> }, { <span class="hljs-number"><span class="hljs-number">34</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">38</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">41</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">48</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span> }, { <span class="hljs-number"><span class="hljs-number">49</span></span>, <span class="hljs-number"><span class="hljs-number">76</span></span> }, { <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span> }, { <span class="hljs-number"><span class="hljs-number">52</span></span>, <span class="hljs-number"><span class="hljs-number">77</span></span> }, { <span class="hljs-number"><span class="hljs-number">53</span></span>, <span class="hljs-number"><span class="hljs-number">78</span></span> }, { <span class="hljs-number"><span class="hljs-number">54</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">56</span></span>, <span class="hljs-number"><span class="hljs-number">79</span></span> }, { <span class="hljs-number"><span class="hljs-number">57</span></span>, <span class="hljs-number"><span class="hljs-number">80</span></span> }, { <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">81</span></span> }, { <span class="hljs-number"><span class="hljs-number">60</span></span>, <span class="hljs-number"><span class="hljs-number">83</span></span> }, { <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span> } }; //================================================== void loop(void) { GD.get_inputs(); <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> key = GD.inputs.tag; int8_t VAL = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevkey == <span class="hljs-number"><span class="hljs-number">0x00</span></span>) { switch (key) { case TAG_BUTTON_LEFT: VAL = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case TAG_BUTTON_RIGHT: VAL = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case TAG_BUTTON_ROT: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FlZ) { GD.play(HIHAT); <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> aa=MasSt[x][y]; MasSt[x][y]=MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>]; MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>]=MasSt[x][y+<span class="hljs-number"><span class="hljs-number">1</span></span>]; MasSt[x][y+<span class="hljs-number"><span class="hljs-number">1</span></span>]=aa; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case TAG_BUTTON_DROP: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!FlZ) { tempspeed=<span class="hljs-number"><span class="hljs-number">50</span></span>; GD.play(NOTCH); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GD.play(CLICK); Demo=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; NewGame(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } prevkey = key; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VAL!=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; fig_shift(VAL) &amp;&amp; !FlZ) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { MasSt[x+VAL][y+i]=MasSt[x][y+i]; MasSt[x][y+i]=<span class="hljs-number"><span class="hljs-number">0</span></span>; } x=x+VAL; } ProcGame(); ViewStacan(); GD.swap(); } //================================================== // redraw one square void ViewQuad(<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i,<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j,<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mycolor) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; uint16_t wy=DISP_TOP + SmeY+(j<span class="hljs-number"><span class="hljs-number">-3</span></span>)*razmer-j; uint16_t wx=DISP_LEFT + SmeX+i*razmer-i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mycolor!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.Vertex2ii(wx,wy); GD.Vertex2ii(wx + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>,wy); GD.Vertex2ii(wx + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>,wy + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(wx,wy + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(wx,wy); GD.Begin(RECTS); GD.ColorRGB(MasCol[mycolor]); GD.Vertex2ii(wx+<span class="hljs-number"><span class="hljs-number">1</span></span>, wy+<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(wx+<span class="hljs-number"><span class="hljs-number">1</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>, wy+<span class="hljs-number"><span class="hljs-number">1</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { } } //================================================== void ViewStacan(void) { <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> myStr2[<span class="hljs-number"><span class="hljs-number">5</span></span>]; // Draw background fone GD.Clear(); GD.ColorMask(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); GD.Begin(BITMAPS); GD.BitmapHandle(BACKGROUND_HANDLE); GD.BitmapSize(NEAREST, REPEAT, REPEAT, <span class="hljs-number"><span class="hljs-number">480</span></span>, <span class="hljs-number"><span class="hljs-number">272</span></span>); GD.Vertex2ii(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, BACKGROUND_HANDLE); // Print text GD.ColorRGB(WHITE); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"LEVEL"</span></span>); GD.cmd_text(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"NEXT"</span></span>); GD.cmd_text(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"SCORE"</span></span>); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"TOP"</span></span>); // Print digit Score GD.ColorRGB(RED); sprintf(myStr2,<span class="hljs-string"><span class="hljs-string">"%05d"</span></span>,Score ); GD.cmd_text(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, myStr2); // Print digit Top sprintf(myStr2,<span class="hljs-string"><span class="hljs-string">"%05d"</span></span>,myrecord ); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">130</span></span>, <span class="hljs-number"><span class="hljs-number">27</span></span>, OPT_CENTER, myStr2); // Print digit Level sprintf(myStr2,<span class="hljs-string"><span class="hljs-string">"%02d"</span></span>,Level ); GD.cmd_text(DISP_LEFT - <span class="hljs-number"><span class="hljs-number">30</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, OPT_CENTER, myStr2); // Draw color squares <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) ViewQuad(i,j,MasSt[i][j]); // Draw Next Figure <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span> + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii + razmer<span class="hljs-number"><span class="hljs-number">-1</span></span>); GD.Vertex2ii(DISP_RIGHT + <span class="hljs-number"><span class="hljs-number">15</span></span>, DISP_TOP + <span class="hljs-number"><span class="hljs-number">20</span></span> + razmer*ii); GD.Begin(RECTS); GD.ColorRGB(MasCol[fignext[i]]); GD.Vertex2ii(DISP_RIGHT+<span class="hljs-number"><span class="hljs-number">15</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_TOP+<span class="hljs-number"><span class="hljs-number">20</span></span>+razmer*i-i+<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_RIGHT+<span class="hljs-number"><span class="hljs-number">15</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>+razmer<span class="hljs-number"><span class="hljs-number">-2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>, DISP_TOP+<span class="hljs-number"><span class="hljs-number">20</span></span>+razmer*i-i+<span class="hljs-number"><span class="hljs-number">1</span></span>+razmer<span class="hljs-number"><span class="hljs-number">-2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); } // Draw <span class="hljs-string"><span class="hljs-string">"stacan"</span></span> GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_TOP); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_BOT); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span> + razmer*MaxX+<span class="hljs-number"><span class="hljs-number">5</span></span>-MaxX - <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_BOT); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">1</span></span> + razmer*MaxX+<span class="hljs-number"><span class="hljs-number">5</span></span>-MaxX - <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_TOP); // Draw <span class="hljs-number"><span class="hljs-number">9</span></span> vertical <span class="hljs-built_in"><span class="hljs-built_in">lines</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">9</span></span>; i++) { GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">1</span></span>); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span> + razmer*ii, DISP_TOP); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span> + razmer*ii, DISP_BOT - <span class="hljs-number"><span class="hljs-number">2</span></span>); } // Draw <span class="hljs-number"><span class="hljs-number">1</span></span> horizontal line GD.ColorRGB(WHITE); GD.Begin(LINE_STRIP); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span>, DISP_BOT - <span class="hljs-number"><span class="hljs-number">2</span></span>); GD.Vertex2ii(DISP_LEFT + <span class="hljs-number"><span class="hljs-number">3</span></span> + razmer*MaxX-MaxX - <span class="hljs-number"><span class="hljs-number">1</span></span>, DISP_BOT - <span class="hljs-number"><span class="hljs-number">2</span></span>); // Draw <span class="hljs-string"><span class="hljs-string">"Game Over"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Demo &amp;&amp; !Arbeiten) { GD.Begin(RECTS); GD.ColorRGB(WHITE); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">60</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">60</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.ColorRGB(BLACK); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">58</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">38</span></span>); GD.Vertex2ii((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">58</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">38</span></span>); GD.ColorRGB(RED); GD.cmd_text((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"GAME"</span></span>); GD.cmd_text((DISP_LEFT + DISP_RIGHT)/<span class="hljs-number"><span class="hljs-number">2</span></span>, (DISP_TOP + DISP_BOT)/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, OPT_CENTER, <span class="hljs-string"><span class="hljs-string">"OVER"</span></span>); } // Draw Buttons GD.Begin(POINTS); GD.PointSize(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">50</span></span>); // Set size of buttons (<span class="hljs-number"><span class="hljs-number">50</span></span> pix) GD.ColorRGB(btn_color); // Set fone color of buttons GD.Tag(TAG_BUTTON_LEFT); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_LEFT GD.Vertex2ii( X_BUTTON_LEFT, Y_BUTTON_LEFT); // Place BUTTON1 GD.Tag(TAG_BUTTON_RIGHT); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_RIGHT GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT); // Place BUTTON2 GD.Tag(TAG_BUTTON_ROT); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_ROT GD.Vertex2ii( X_BUTTON_ROT, Y_BUTTON_ROT); // Place BUTTON3 GD.Tag(TAG_BUTTON_DROP); // Set TAG <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> BUTTON_DROP GD.Vertex2ii(X_BUTTON_DROP, Y_BUTTON_DROP); // Place BUTTON4 // Draw figures <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> buttons circles GD.Tag(<span class="hljs-number"><span class="hljs-number">255</span></span>); GD.ColorRGB(<span class="hljs-number"><span class="hljs-number">0xffff00</span></span>); GD.LineWidth(<span class="hljs-number"><span class="hljs-number">16</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>); GD.Begin(LINE_STRIP); GD.Vertex2ii(X_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_LEFT); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_LEFT, Y_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_LEFT + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_LEFT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Begin(LINE_STRIP); GD.Vertex2ii(X_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_RIGHT); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT, Y_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_RIGHT + <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Vertex2ii(X_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_RIGHT - <span class="hljs-number"><span class="hljs-number">20</span></span>); GD.Begin(LINE_STRIP); GD.Vertex2ii(X_BUTTON_ROT - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_ROT); GD.Vertex2ii(X_BUTTON_ROT, Y_BUTTON_ROT - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_ROT + <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_ROT); GD.Vertex2ii(X_BUTTON_ROT, Y_BUTTON_ROT + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_ROT - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_ROT); GD.Begin(LINE_STRIP); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten) { GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>); GD.Vertex2ii(X_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>); GD.Vertex2ii(X_BUTTON_DROP, Y_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">30</span></span>); GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">30</span></span>, Y_BUTTON_DROP); GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>, Y_BUTTON_DROP + <span class="hljs-number"><span class="hljs-number">40</span></span>); GD.Vertex2ii(X_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">10</span></span>, Y_BUTTON_DROP - <span class="hljs-number"><span class="hljs-number">40</span></span>); } } //================================================== void ClearMas(<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> MasStx[MaxX][MaxY]) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) MasStx[i][j]=<span class="hljs-number"><span class="hljs-number">0</span></span>; } //================================================== void Sosed(int i,int j,int dx,int dy, <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mode) { int nx=i+dx; int ny=j+dy; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nx&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; ny&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; nx&lt;MaxX &amp;&amp; ny&lt;MaxY &amp;&amp; MasSt[nx][ny]==MasSt[i][j]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode==<span class="hljs-number"><span class="hljs-number">1</span></span>) MasTmp[i][j]++; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode==<span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; (MasTmp[nx][ny]&gt;<span class="hljs-number"><span class="hljs-number">1</span></span> || MasTmp[i][j]&gt;<span class="hljs-number"><span class="hljs-number">2</span></span> )) { MasTmp[nx][ny]=<span class="hljs-number"><span class="hljs-number">3</span></span>; MasTmp[i][j]=<span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mode==<span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; MasTmp[nx][ny]==<span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]!=<span class="hljs-number"><span class="hljs-number">3</span></span>) { MasTmp[i][j]=<span class="hljs-number"><span class="hljs-number">3</span></span>; fl=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } } } //================================================== void Sos(int i,int j, <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mode) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> k=<span class="hljs-number"><span class="hljs-number">0</span></span>;k&lt;<span class="hljs-number"><span class="hljs-number">4</span></span>;k++) Sosed(i,j,mmm[k][<span class="hljs-number"><span class="hljs-number">0</span></span>],mmm[k][<span class="hljs-number"><span class="hljs-number">1</span></span>],mode); } //================================================== // <span class="hljs-built_in"><span class="hljs-built_in">create</span></span> <span class="hljs-built_in"><span class="hljs-built_in">next</span></span> figure void GetNext(void) { x=<span class="hljs-number"><span class="hljs-number">3</span></span>; y=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Demo) MasSt[x][i]=fignext[i]; fignext[i]=<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(NumCol)+<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Demo) { Counter++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Counter==NextLevel) { Counter=<span class="hljs-number"><span class="hljs-number">0</span></span>; Level++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Level&gt;MaxLevel) Level=MaxLevel; } tempspeed=MasSpeed[Level<span class="hljs-number"><span class="hljs-number">-1</span></span>]; } } //================================================== // <span class="hljs-built_in"><span class="hljs-built_in">find</span></span> onecolor elements bool FindFull(void) { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i,j,k; bool res; res=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> k=<span class="hljs-number"><span class="hljs-number">2</span></span>;k&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>;k++) { // by every color ClearMas(MasTmp); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasSt[i][j]==k) Sos(i,j,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) Sos(i,j,<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { fl=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) Sos(i,j,<span class="hljs-number"><span class="hljs-number">3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (fl); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasTmp[i][j]==<span class="hljs-number"><span class="hljs-number">3</span></span>) { MasSt[i][j]=<span class="hljs-number"><span class="hljs-number">1</span></span>; TScore++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(res); } //================================================ // move figure down bool fig_drop(int dy) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dy&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; !FlZ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span> || MasSt[x+dx][y+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>) { gameover(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (y+dy+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>&gt;MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span> || MasSt[x+dx][y+dy+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>]&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { GD.play(COWBELL); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;i++) MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>-i+dy]=MasSt[x][y+<span class="hljs-number"><span class="hljs-number">2</span></span>-i]; MasSt[x][y]=<span class="hljs-number"><span class="hljs-number">0</span></span>; y=y+dy; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } //================================================ // move figure left/right (shift) bool fig_shift(int dx) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x+dx&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> || x+dx&gt;MaxX<span class="hljs-number"><span class="hljs-number">-1</span></span>) { GD.play(COWBELL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dx!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (MasSt[x+dx][y+dy+<span class="hljs-number"><span class="hljs-number">2</span></span>]==<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (x+dx+dx&lt;<span class="hljs-number"><span class="hljs-number">0</span></span> || x+dx+dx&gt;MaxX<span class="hljs-number"><span class="hljs-number">-1</span></span>) GD.play(COWBELL); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> GD.play(CHACK); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { GD.play(COWBELL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } //================================================== // State-machine void ProcGame(void) { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i,j,k; bool res = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (time_count &lt; millis()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten) time_count = millis() + tempspeed; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> time_count = millis() + <span class="hljs-number"><span class="hljs-number">1000</span></span>; switch (state_game) { // Demo case <span class="hljs-number"><span class="hljs-number">0</span></span>: Score=<span class="hljs-number"><span class="hljs-number">0</span></span>; GetNext(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> j=<span class="hljs-number"><span class="hljs-number">3</span></span>;j&lt;MaxY;j++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) MasSt[i][j]=<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(<span class="hljs-number"><span class="hljs-number">6</span></span>)+<span class="hljs-number"><span class="hljs-number">2</span></span>; state_game = <span class="hljs-number"><span class="hljs-number">1</span></span>; TScore=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">1</span></span>: FindFull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { FlZ=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; time_count = millis() + <span class="hljs-number"><span class="hljs-number">500</span></span>; } state_game = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;MaxY;j++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-j]==<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k=<span class="hljs-number"><span class="hljs-number">0</span></span>;k&lt;MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-j;k++) MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-kj] = MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-kj]; res=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>) Score=Score+TScore+(TScore<span class="hljs-number"><span class="hljs-number">-8</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Score=Score+TScore; state_game = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { state_game = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; // Arbeiten case <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fig_drop(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { tempspeed=MasSpeed[Level<span class="hljs-number"><span class="hljs-number">-1</span></span>]; TScore=<span class="hljs-number"><span class="hljs-number">0</span></span>; FindFull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { GD.play(KICKDRUM); FlZ=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; state_game = <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; GetNext(); } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;MaxY;j++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>;i&lt;MaxX;i++) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-j]==<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (k=<span class="hljs-number"><span class="hljs-number">0</span></span>;k&lt;MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-j;k++) MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-1</span></span>-kj] = MasSt[i][MaxY<span class="hljs-number"><span class="hljs-number">-2</span></span>-kj]; res=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TScore&gt;<span class="hljs-number"><span class="hljs-number">7</span></span>) Score=Score+TScore+(TScore<span class="hljs-number"><span class="hljs-number">-8</span></span>)*<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Score=Score+TScore; state_game = <span class="hljs-number"><span class="hljs-number">5</span></span>; FlZ=<span class="hljs-literal"><span class="hljs-literal">true</span></span>; GD.play(CLACK); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { state_game = <span class="hljs-number"><span class="hljs-number">3</span></span>; FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; time_count = millis() + <span class="hljs-number"><span class="hljs-number">100</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; case <span class="hljs-number"><span class="hljs-number">5</span></span>: state_game = <span class="hljs-number"><span class="hljs-number">3</span></span>; FlZ=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; default: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } //================================================ // start new game void NewGame() { Score = <span class="hljs-number"><span class="hljs-number">0</span></span>; FlZ = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; ClearMas(MasSt); Arbeiten = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; GetNext(); Counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; Level = <span class="hljs-number"><span class="hljs-number">1</span></span>; tempspeed = MasSpeed[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Record = myrecord; state_game = <span class="hljs-number"><span class="hljs-number">3</span></span>; } //================================================ // draw <span class="hljs-string"><span class="hljs-string">"GAME OVER"</span></span> void gameover() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arbeiten==<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { GD.play(SWITCH); Arbeiten=<span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Score&gt;myrecord) { myrecord=Score; eeprom_write_byte((unsigned <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *) <span class="hljs-number"><span class="hljs-number">1</span></span>, myrecord); } } }</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">slotgag_assets.h</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOAD_ASSETS() GD.safeload(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"slotgag.gd2"</span></span></span><span class="hljs-meta">); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_HANDLE 0 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_WIDTH 256 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_HEIGHT 256 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BACKGROUND_CELLS 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_HANDLE 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_WIDTH 395 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_HEIGHT 113 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GAMEDUINO_CELLS 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ASSETS_END 220342UL static const shape_t BACKGROUND_SHAPE = {0, 256, 256, 0}; static const shape_t GAMEDUINO_SHAPE = {1, 395, 113, 0};</span></span></code> </pre></div></div><br>  Acredito que conclu√≠ a tarefa de criar meu primeiro esbo√ßo de trabalho para este quadro.  Espero que pelo menos uma pessoa tenha interesse em ler minha hist√≥ria.  Cr√≠ticas e coment√°rios s√£o bem-vindos.  Os planos n√£o param, seguem em frente e, √© claro, compartilham experi√™ncia, conhecimento. <br><br>  Para demonstrar o funcionamento do quadro, eu publico um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo</a> com som (Cuidado! Som alto!). <br>  Obrigado pela aten√ß√£o. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423577/">https://habr.com/ru/post/pt423577/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423567/index.html">Mais uma vez sobre intelig√™ncia artificial</a></li>
<li><a href="../pt423569/index.html">Definimos de forma simples e precisa o idioma das mensagens</a></li>
<li><a href="../pt423571/index.html">Todo o tipo de coisas no MetaPost</a></li>
<li><a href="../pt423573/index.html">Sincronicidade √© um mito</a></li>
<li><a href="../pt423575/index.html">Padr√µes de projeto em microeletr√¥nica: onde existem realmente 7 nan√¥metros na tecnologia de 7 nm?</a></li>
<li><a href="../pt423579/index.html">Servi√ßos em nuvem para WebGL? N√£o obrigado</a></li>
<li><a href="../pt423583/index.html">Obtendo acidentes atrav√©s do NotificationIRP no OSS</a></li>
<li><a href="../pt423585/index.html">Ao vivo: CI / CD no iOS e Android</a></li>
<li><a href="../pt423587/index.html">Construindo cluster InnoDB a partir do mysql 5.7 no centos 7</a></li>
<li><a href="../pt423589/index.html">Como escolhemos o TTS, por exemplo, sons no dicion√°rio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>