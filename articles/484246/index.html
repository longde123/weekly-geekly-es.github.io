<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤üèø üë≤üèø üë©üèª Monitoreo de sistemas distribuidos - Experiencia de Google (traducci√≥n del cap√≠tulo del libro de Google SRE) üë©üèª‚Äçüî¨ üíï üà¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="SRE (Ingenier√≠a de confiabilidad del sitio): un enfoque para garantizar la disponibilidad de proyectos web. Se considera un marco para DevOps y explic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoreo de sistemas distribuidos - Experiencia de Google (traducci√≥n del cap√≠tulo del libro de Google SRE)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484246/"><img src="https://habrastorage.org/webt/rj/u4/8s/rju48s3gqxozu32f2esipgkpc6c.png"><br><br>  SRE (Ingenier√≠a de confiabilidad del sitio): un enfoque para garantizar la disponibilidad de proyectos web.  Se considera un marco para DevOps y explica c√≥mo tener √©xito en la aplicaci√≥n de las pr√°cticas de DevOps.  Este art√≠culo es una traducci√≥n del <a href="https://landing.google.com/sre/book/chapters/monitoring-distributed-systems.html">Cap√≠tulo 6 Monitoreo de sistemas distribuidos</a> del libro de <a href="https://landing.google.com/sre/book.html">Ingenier√≠a de confiabilidad</a> del <a href="https://landing.google.com/sre/book.html">sitio</a> de Google.  Prepar√© esta traducci√≥n yo mismo y confi√© en mi propia experiencia para comprender los procesos de monitoreo.  En el canal de telegramas <a href="https://t.me/monitorim_it/28">@monitorim_it</a> y el <a href="https://medium.com/%40antonkasimov/%25D1%2586%25D0%25B5%25D0%25BB%25D0%25B8-%25D1%2583%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BD%25D1%258F-%25D0%25BE%25D0%25B1%25D1%2581%25D0%25BB%25D1%2583%25D0%25B6%25D0%25B8%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F-%25D0%25BE%25D0%25BF%25D1%258B%25D1%2582-google-630008918e9f%3Fsource%3Dfriends_link%255E_%255Eamp%255E_%255Esk%3D0b7f6ab888298580001b027434c53c56">blog en el Medio,</a> tambi√©n publiqu√© un enlace a la traducci√≥n del cuarto cap√≠tulo del mismo libro sobre los objetivos del nivel de servicio. <br><br>  Traducci√≥n por cat.  Que tengas una buena lectura! <br><a name="habracut"></a><br>  Los equipos de Google SRE tienen los principios b√°sicos y las mejores pr√°cticas para crear sistemas exitosos de monitoreo y notificaci√≥n.  Este cap√≠tulo proporciona recomendaciones sobre los problemas que puede encontrar un visitante de la p√°gina web y c√≥mo resolver los problemas que dificultan la visualizaci√≥n de las p√°ginas web. <br><br><h1>  Definiciones </h1><br>  No se utiliza un vocabulario √∫nico para discutir temas relacionados con el monitoreo.  Incluso en Google, los t√©rminos a continuaci√≥n no se usan com√∫nmente, pero enumeraremos las interpretaciones m√°s comunes. <br><br><h3>  Monitoreo </h3><br>  Recopilaci√≥n, procesamiento, agregaci√≥n y visualizaci√≥n de datos cuantitativos en tiempo real sobre el sistema: la cantidad de solicitudes y tipos de solicitudes, la cantidad de errores y tipos de errores, el tiempo de procesamiento de solicitudes y el tiempo de actividad del servidor. <br><br><h3>  Monitoreo de caja blanca </h3><br>  Monitoreo basado en m√©tricas mostradas por componentes internos del sistema, incluidos registros, m√©tricas de perfiles de la m√°quina virtual Java o manejador HTTP que generan estad√≠sticas internas. <br><br><h3>  Monitoreo de caja negra </h3><br>  Probar el comportamiento de la aplicaci√≥n desde el punto de vista del usuario. <br><br><h3>  Tablero (tableros) </h3><br>  Una interfaz (generalmente la web) que proporciona una visi√≥n general de los indicadores clave de salud para los servicios.  El panel de control puede tener filtros, la capacidad de seleccionar indicadores para mostrar, etc. La interfaz se crea para identificar los indicadores m√°s importantes para los usuarios.  La informaci√≥n para el personal de soporte t√©cnico tambi√©n se puede mostrar en el tablero: cola de solicitudes, lista de errores de alta prioridad, ingeniero asignado para un √°rea de responsabilidad determinada. <br><br><h3>  Alerta (aviso) </h3><br>  Notificaciones dise√±adas para ser recibidas por una persona por correo electr√≥nico o de otra manera, que pueden iniciarse como resultado de errores o un aumento en la cola de solicitudes.  Las notificaciones se clasifican en: tickets, alertas por correo electr√≥nico y mensajes de mensajer√≠a. <br><br><h3>  Causa ra√≠z </h3><br>  Un defecto de software o factor humano que no deber√≠a volver a ocurrir cuando se elimina.  El problema puede tener varias razones principales: automatizaci√≥n insuficiente de los procesos, defecto de software, estudio insuficiente de la l√≥gica de la aplicaci√≥n.  Cada uno de estos factores puede ser la causa ra√≠z, y cada uno de ellos debe ser eliminado. <br><br><h3>  Nodo y m√°quina </h3><br>  T√©rminos intercambiables para denotar una sola instancia de una aplicaci√≥n en ejecuci√≥n en un servidor f√≠sico, m√°quina virtual o contenedor.  Puede haber varios servicios en una m√°quina.  Los servicios pueden ser: <br><br><ul><li>  relacionados entre s√≠: por ejemplo, un servidor de cach√© y un servidor web; </li><li>  servicios no relacionados en un solo hardware: por ejemplo, un repositorio de c√≥digo y un asistente para un sistema de configuraci√≥n, como <a href="https://puppetlabs.com/puppet/puppet-open-source">Puppet</a> o <a href="https://www.chef.io/chef/">Chef</a> . </li></ul><br><h3>  Empujar </h3><br>  Cualquier cambio en la configuraci√≥n del software. <br><br><h1>  Por qu√© se necesita monitoreo </h1><br>  Hay varias razones por las cuales las aplicaciones deben ser monitoreadas: <br><br><h3>  An√°lisis de tendencia larga </h3><br>  ¬øQu√© tan grande es la base de datos y qu√© tan r√°pido est√° creciendo?  ¬øC√≥mo est√° cambiando el n√∫mero diario de usuarios? <br><br><h3>  Comparaci√≥n de rendimiento </h3><br>  ¬øLas consultas de Acme Bucket of Bytes 2.72 son m√°s r√°pidas que Ajax DB 3.14?  ¬øCu√°nto mejor se almacenan en cach√© las solicitudes despu√©s de la aparici√≥n de un nodo adicional?  ¬øEl sitio se ha vuelto m√°s lento en comparaci√≥n con la semana pasada? <br><br><h3>  Alertas (notificaciones) </h3><br>  Algo est√° roto y alguien necesita arreglarlo.  O algo se romper√° pronto y alguien deber√≠a comprobarlo pronto. <br><br><h3>  Crear paneles </h3><br>  Los paneles deben responder preguntas b√°sicas e incluir algunas de las <a href="https://landing.google.com/sre/sre-book/chapters/monitoring-distributed-systems/">"4 se√±ales de oro"</a> : latencia, tr√°fico, errores y carga (saturaci√≥n). <br><br><h3>  Realizaci√≥n de un an√°lisis retrospectivo (depuraci√≥n) </h3><br>  El retraso en el procesamiento de la solicitud ha aumentado, ¬øy qu√© m√°s sucedi√≥ al mismo tiempo? <br>  Los sistemas de monitoreo son √∫tiles como fuente de datos para los sistemas de inteligencia de negocios y para simplificar el an√°lisis de incidentes de seguridad.  Dado que este libro se enfoca en √°reas de ingenier√≠a en las cuales los SRE tienen experiencia, no discutiremos las t√©cnicas de monitoreo aqu√≠. <br><br>  El monitoreo y las alertas le permiten al sistema saber cu√°ndo se ha roto o est√° a punto de romperse.  Cuando el sistema no puede recuperarse autom√°ticamente, queremos que la persona analice la alerta, determine si el problema es relevante, solucione y determine su causa ra√≠z.  Si no audita los componentes del sistema, nunca recibir√° una alerta simplemente porque "algo parece un poco extra√±o". <br><br>  La carga de alertas humanas es un uso bastante costoso del tiempo de los empleados.  Si un empleado est√° trabajando, una alerta interrumpe el flujo de trabajo.  Si el empleado est√° en casa, la notificaci√≥n interrumpe el tiempo personal y, posiblemente, el sue√±o.  Cuando las alertas ocurren con demasiada frecuencia, los empleados escanean, retrasan o ignoran r√°pidamente las alertas entrantes.  De vez en cuando, ignoran la alerta real, que est√° enmascarada por los eventos de ruido.  Las interrupciones del servicio pueden durar mucho tiempo, porque los eventos de ruido interfieren con el diagn√≥stico r√°pido y la resoluci√≥n de problemas.  Los sistemas de advertencia eficientes tienen una buena relaci√≥n se√±al / ruido. <br><br><h1>  Definir expectativas razonables de un sistema de monitoreo </h1><br>  Configurar el monitoreo de una aplicaci√≥n compleja es en s√≠ mismo una tarea de ingenier√≠a dif√≠cil.  Incluso con una importante infraestructura de herramientas para recopilar, mostrar y alertar, el equipo de Google SRE con 10-12 miembros generalmente incluye una o dos personas cuyo objetivo principal es crear y mantener sistemas de monitoreo.  Este n√∫mero ha disminuido con el tiempo a medida que generalizamos y centralizamos la infraestructura de monitoreo, pero cada equipo de SRE generalmente tiene al menos un personal de monitoreo.  Debo decir que, aunque es bastante interesante observar los paneles del sistema de monitoreo, los equipos de SRE evitan cuidadosamente situaciones que requieren que alguien mire la pantalla para monitorear los problemas. <br><br>  En general, Google cambi√≥ a sistemas de monitoreo simples y r√°pidos con herramientas √≥ptimas para el an√°lisis post-factum.  Evitamos sistemas "m√°gicos" que intentan predecir umbrales o detectar autom√°ticamente la causa ra√≠z.  Los sensores que detectan contenido inapropiado en las solicitudes del usuario final son los √∫nicos contraejemplos;  Mientras estos sensores sigan siendo simples, pueden identificar r√°pidamente las causas de anomal√≠as graves.  Otros formatos para usar datos de monitoreo, como la planificaci√≥n de capacidad o el pron√≥stico del tr√°fico, son m√°s desafiantes.  La observaci√≥n realizada durante mucho tiempo (meses o a√±os) con una baja tasa de muestreo (horas o d√≠as) revelar√° una tendencia a largo plazo. <br><br>  El equipo de Google SRE ha trabajado con √©xito variable con jerarqu√≠as de dependencia complejas.  Raramente usamos reglas como "si descubro que la base de datos ha comenzado a funcionar lentamente, recibo una notificaci√≥n sobre la desaceleraci√≥n de la base de datos, de lo contrario, recibo una alerta sobre un sitio que funciona lentamente".  Las reglas basadas en la dependencia generalmente se aplican a partes invariables de nuestro sistema, como un sistema para filtrar el tr√°fico de usuarios a un centro de datos.  Por ejemplo, "si el filtrado de tr√°fico al centro de datos est√° configurado, no me avise sobre los retrasos en el procesamiento de las solicitudes de los usuarios"; esta es una regla general para las notificaciones del centro de datos.  Pocos equipos en Google admiten jerarqu√≠as de dependencia complejas porque nuestra infraestructura tiene una tasa constante de refactorizaci√≥n continua. <br><br>  Algunas de las ideas descritas en este cap√≠tulo siguen siendo relevantes: siempre existe la oportunidad de pasar m√°s r√°pido de un s√≠ntoma a una causa ra√≠z, especialmente en sistemas que cambian constantemente.  Por lo tanto, aunque este cap√≠tulo describe algunos objetivos para los sistemas de monitoreo y las formas de lograr estos objetivos, es importante que los sistemas de monitoreo sean simples y comprensibles para todos en el equipo. <br><br>  Del mismo modo, para mantener un bajo nivel de ruido y un alto nivel de se√±al, los enfoques para monitorear objetos para los que se realizan alertas deben ser muy simples y confiables.  Las reglas que generan advertencias para las personas deben ser f√°ciles de entender y presentar un problema claro. <br><br><h1>  S√≠ntomas vs. Causas </h1><br>  Su sistema de monitoreo debe responder dos preguntas: "qu√© se rompi√≥" y "por qu√© se rompi√≥". <br>  "Lo que est√° roto" habla del s√≠ntoma y "por qu√© est√° roto" de la causa.  La siguiente tabla muestra ejemplos de tales paquetes. <br><div class="scrollable-table"><table><tbody><tr><td align="center">  <b>S√≠ntoma</b> </td><td align="center">  <b>Raz√≥n</b> </td></tr><tr><td>  Obteniendo el error HTTP 500 o 404 </td><td>  Los servidores de bases de datos rechazan las conexiones </td></tr><tr><td>  Respuestas lentas del servidor </td><td>  Alta utilizaci√≥n de la CPU o da√±o del cable Ethernet </td></tr><tr><td>  Los usuarios ant√°rticos no reciben gifs de gatos </td><td>  Su CDN odia a los cient√≠ficos y los gatos, por lo que algunas direcciones IP est√°n en la lista negra </td></tr><tr><td>  El contenido privado est√° disponible en todas partes </td><td>  La implementaci√≥n de una nueva versi√≥n de software hizo que el firewall olvidara todas las ACL y dejara a todos seguidos </td></tr></tbody></table></div><br>  "Qu√©" y "por qu√©" son algunos de los bloques de construcci√≥n m√°s importantes para crear un buen sistema de monitoreo con se√±al m√°xima y ruido m√≠nimo. <br><br><h3>  Caja negra vs caja blanca </h3><br>  Combinamos un amplio monitoreo de caja blanca con un modesto monitoreo de caja negra para m√©tricas cr√≠ticas.  La forma m√°s f√°cil de comparar la caja negra con la caja blanca es que la caja negra est√° orientada a los s√≠ntomas y es un monitoreo reactivo m√°s que proactivo: "el sistema no est√° funcionando en este momento".  El cuadro blanco depende de las capacidades de verificaci√≥n interna del sistema: registros de eventos o servidores web.  Por lo tanto, el cuadro blanco le permite detectar problemas futuros, mal funcionamiento que parecen una retransmisi√≥n de una solicitud, etc. <br><br>  Tenga en cuenta que en un sistema multicapa, un s√≠ntoma en el √°rea de responsabilidad de un ingeniero es un s√≠ntoma en el √°rea de responsabilidad de otro ingeniero.  Por ejemplo, el rendimiento de la base de datos ha disminuido.  Las lecturas lentas de la base de datos son un s√≠ntoma de las SRE en las bases de datos que las detectan.  Sin embargo, para el SRE front-end, que observa un sitio web lento, la raz√≥n de la misma lectura lenta de la base de datos es el funcionamiento lento de la base de datos.  Por lo tanto, el monitoreo de recuadro blanco a veces se enfoca en los s√≠ntomas y, a veces, en razones, dependiendo de cu√°n extenso sea. <br><br>  Al recopilar telemetr√≠a, se requiere monitoreo de caja blanca para la depuraci√≥n.  Si los servidores web responden lentamente a las consultas de la base de datos, debe saber qu√© tan r√°pido interact√∫a el servidor web con la base de datos y qu√© tan r√°pido responde.  De lo contrario, no puede distinguir un servidor de base de datos lento de un problema de red entre el servidor web y la base de datos. <br><br>  El monitoreo de recuadro negro tiene una ventaja clave al enviar alertas: inicia una notificaci√≥n al destinatario cuando el problema ya ha provocado s√≠ntomas reales.  Por otro lado, para un problema de caja negra que a√∫n no ha surgido, pero es inminente, el monitoreo es in√∫til. <br><br><h1>  Cuatro se√±ales de oro </h1><br>  Las cuatro se√±ales doradas de monitoreo son latencia, tr√°fico, errores y saturaci√≥n.  Si solo puede medir cuatro m√©tricas en un sistema de usuario, conc√©ntrese en estas cuatro. <br><br><h3>  Retraso </h3><br>  El tiempo requerido para procesar la solicitud.  Es importante distinguir entre la demora de solicitudes exitosas y no exitosas.  Por ejemplo, un error HTTP 500 causado por una p√©rdida de conexi√≥n a una base de datos u otro backend puede diagnosticarse muy r√°pidamente, sin embargo, un error HTTP 500 puede indicar una solicitud fallida.  Identificar el efecto del error 500 en el retraso general puede llevar a conclusiones err√≥neas.  Por otro lado, ¬°un error lento es incluso un error r√°pido!  Por lo tanto, es importante rastrear el retraso con un error, y no solo filtrar los errores. <br><br><h3>  Tr√°fico </h3><br>  El n√∫mero de solicitudes a su sistema se mide en m√©tricas de sistema de alto nivel.  Para un servicio web, esta dimensi√≥n generalmente representa el n√∫mero de solicitudes HTTP por segundo, separadas por la naturaleza de la solicitud (por ejemplo, contenido est√°tico o din√°mico).  Para un sistema de transmisi√≥n de audio, esta medici√≥n puede concentrarse en la velocidad de E / S de la red o en la cantidad de sesiones simult√°neas.  Para un sistema de almacenamiento de valor clave, dicha medici√≥n puede ser transacciones o resultados de b√∫squeda por segundo. <br><br><h3>  Errores </h3><br>  Esta es la frecuencia de solicitudes fallidas que son expl√≠citamente (por ejemplo, HTTP 500), impl√≠citamente (por ejemplo, HTTP 200, pero en combinaci√≥n con el contenido incorrecto), o una pol√≠tica (por ejemplo, "Si registr√≥ la respuesta en un segundo, cualquier segundo es un error").  Si los c√≥digos de respuesta del protocolo HTTP son insuficientes para expresar todas las condiciones de falla, se pueden requerir protocolos secundarios (internos) para detectar fallas parciales.  El monitoreo de todas estas solicitudes err√≥neas puede no ser informativo, mientras que las pruebas de sistema de extremo a extremo lo ayudar√°n a descubrir que est√° procesando el contenido incorrecto. <br><br><h3>  Saturaci√≥n </h3><br>  La m√©trica muestra cu√°nto se utiliza su servicio.  Esta es una medida de monitoreo del sistema que identifica los recursos m√°s limitados (por ejemplo, en un sistema con memoria limitada, muestra memoria, en un sistema con limitaciones de E / S, se muestra el n√∫mero de E / S).  Tenga en cuenta que muchos sistemas degradan el rendimiento antes de alcanzar el 100% de utilizaci√≥n, por lo que es importante tener un prop√≥sito de uso. <br><br>  En sistemas complejos, la saturaci√≥n se puede complementar midiendo la carga de un nivel superior: ¬øpuede su servicio manejar adecuadamente el tr√°fico dual, procesar solo un 10% m√°s de tr√°fico o procesar incluso menos tr√°fico del que lo hace actualmente?  Para servicios simples que no tienen par√°metros que cambien la complejidad de la solicitud (por ejemplo, "No me d√© nada" o "Necesito un n√∫mero entero √∫nico y mon√≥tono") que rara vez cambian su configuraci√≥n, el valor est√°tico de la prueba de carga puede ser adecuado. discutido en el p√°rrafo anterior, la mayor√≠a de los servicios deber√≠an usar se√±ales indirectas, como la utilizaci√≥n de la CPU o el ancho de banda de la red, que tienen un l√≠mite superior conocido.  El aumento de la latencia es a menudo un indicador primario de saturaci√≥n.  Medir el tiempo de respuesta del percentil 99 en una ventana peque√±a (por ejemplo, un minuto) puede dar una se√±al de saturaci√≥n muy temprana. <br><br>  Finalmente, la saturaci√≥n tambi√©n se asocia con predicciones de saturaci√≥n inminente, por ejemplo: "Parece que su base de datos llenar√° su disco duro en 4 horas". <br><br>  Si mide las cuatro se√±ales doradas y cuando surge un problema con una de las m√©tricas (o, en el caso de saturaci√≥n, casi un problema), notifique a la persona, su servicio ser√° m√°s o menos monitoreado. <br><br><h1>  Ansiedad por la cola (o instrumentaci√≥n y rendimiento) </h1><br>  Al crear un sistema de monitoreo desde cero, es tentador desarrollar un sistema basado en valores promedio: latencia promedio, utilizaci√≥n promedio de CPU de nodos u ocupaci√≥n promedio de la base de datos.  El peligro de los dos √∫ltimos ejemplos es obvio: los procesadores y las bases de datos se eliminan de una manera muy impredecible.  Lo mismo ocurre con el retraso.  Si ejecuta un servicio web con un retraso promedio de 100 ms a 1000 solicitudes por segundo, el 1% de las solicitudes puede demorar 5 segundos.  Si los usuarios dependen de varios de estos servicios web, el percentil 99 de un servidor puede convertirse f√°cilmente en el tiempo medio de respuesta de la interfaz. <br><br>  La forma m√°s sencilla de distinguir entre un promedio lento y una "cola" de consultas muy lenta es recopilar las dimensiones de consulta expresadas en estad√≠sticas (una herramienta adecuada para mostrar histogramas) en lugar de retrasos reales: cu√°ntas solicitudes fueron atendidas por el servicio, que tom√≥ entre 0 ms y 10 ms, entre 10 ms y 30 ms, entre 30 ms y 100 ms, entre 100 ms y 300 ms, etc. Expandir los bordes del histograma de manera aproximadamente exponencial (con un coeficiente aproximado de 3) es a menudo una forma simple de visualizar la distribuci√≥n de consultas. <br><br><h1>  Elecci√≥n del nivel de detalle adecuado para mediciones </h1><br>  Se deben medir diferentes elementos del sistema con diversos grados de detalle.  Por ejemplo: <br><br><ul><li>  El monitoreo de la utilizaci√≥n de la carga de la CPU en un intervalo de tiempo espec√≠fico no mostrar√° valores at√≠picos a largo plazo que den como resultado altas latencias. </li><li>  Por otro lado, para un servicio web que se enfoca en no m√°s de 9 horas de tiempo de inactividad por a√±o (99.9% del tiempo de actividad anual), la verificaci√≥n de una respuesta HTTP de 200 m√°s de una o dos veces por minuto probablemente ser√° innecesariamente frecuente. </li><li>  Del mismo modo, probablemente no sea necesario verificar el espacio libre en el disco duro para obtener una disponibilidad del 99.9% m√°s de una vez cada 1-2 minutos. </li></ul><br>  Tenga cuidado de c√≥mo estructura la granularidad de las dimensiones.  La frecuencia de recopilar la carga de la CPU una vez por segundo puede proporcionar datos interesantes, pero tales mediciones frecuentes pueden ser muy caras de recopilar, almacenar y analizar.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si el objetivo de monitoreo requiere una granularidad alta y no requiere una velocidad de reacci√≥n alta, puede reducir estos costos configurando la recopilaci√≥n de m√©tricas en el servidor y luego configurando un sistema externo para recopilar y agregar estas m√©tricas. </font><font style="vertical-align: inherit;">Usted podr√≠a:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mida la utilizaci√≥n de la CPU cada segundo. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Recorte los detalles al 5%. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Agregue m√©tricas cada minuto. </font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta estrategia permitir√° recopilar datos con gran granularidad sin experimentar altos costos de an√°lisis y almacenamiento. </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tan simple como sea posible, pero no m√°s f√°cil </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La imposici√≥n de requisitos diferentes entre s√≠ puede conducir a un sistema de monitoreo muy complejo. </font><font style="vertical-align: inherit;">Por ejemplo, su sistema puede tener los siguientes elementos complicados:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alertas seg√∫n diferentes valores de umbral para el retraso en el procesamiento de solicitudes, en diferentes percentiles, para todo tipo de indicadores diferentes. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Escribir c√≥digo adicional para detectar e identificar posibles causas. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cree paneles relacionados para cada una de las posibles causas de problemas. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las fuentes de complicaciones potenciales nunca terminan. </font><font style="vertical-align: inherit;">Como todos los sistemas de software, el monitoreo puede volverse tan complicado que se vuelve fr√°gil y dif√≠cil de cambiar y mantener. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por lo tanto, dise√±e su sistema de monitoreo para simplificarlo tanto como sea posible. </font><font style="vertical-align: inherit;">Al elegir qu√© rastrear, recuerde lo siguiente:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las reglas que con mayor frecuencia capturan incidentes reales deben ser tan simples, predecibles y confiables como sea posible. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las configuraciones para la recopilaci√≥n de datos, la agregaci√≥n y las alertas que rara vez se realizan (por ejemplo, menos de una vez por trimestre para algunos comandos SRE) deben eliminarse. </font></font></li><li> ,  ,     -      - ,    . </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En Google, la recopilaci√≥n b√°sica y la agregaci√≥n de indicadores, combinados con alertas y paneles, funcionan bien como un sistema relativamente aut√≥nomo (de hecho, el sistema de monitoreo de Google est√° dividido en varios subsistemas, pero generalmente las personas conocen todos los aspectos de estos subsistemas). Puede ser tentador combinar el monitoreo con otros m√©todos de verificaci√≥n de sistemas complejos: perfiles detallados del sistema, depuraci√≥n de procesos, seguimiento de detalles sobre excepciones o fallas, pruebas de carga, recopilaci√≥n y an√°lisis de registros o verificaci√≥n de tr√°fico. Si bien la mayor√≠a de estas cosas tienen caracter√≠sticas comunes con el monitoreo b√°sico, mezclarlas juntas generar√° demasiados resultados en la creaci√≥n de un sistema complejo y fr√°gil. Al igual que con muchos otros aspectos del desarrollo de software, el soporte para varios sistemas es claro, simple,los puntos de integraci√≥n acoplados libremente son una mejor estrategia (por ejemplo, usar una API web para recuperar datos de resumen en un formato que puede permanecer constante durante un largo per√≠odo de tiempo).</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vinculaci√≥n de principios juntos </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Los principios discutidos en este cap√≠tulo pueden integrarse en una filosof√≠a de monitoreo y alerta respaldada y respetada por los equipos de Google SRE. </font><font style="vertical-align: inherit;">Es deseable adherirse a esta filosof√≠a de monitoreo; es un buen punto de partida para crear o revisar una metodolog√≠a de alerta y puede ayudar a formular las preguntas correctas al servicio operativo, independientemente del tama√±o de su organizaci√≥n o la complejidad del servicio o sistema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al crear reglas de monitoreo y alerta haciendo las siguientes preguntas, puede evitar falsos positivos y alertas innecesarias:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ¬øEsta regla detecta un estado indetectable del sistema que es urgente, que requiere acci√≥n e inevitablemente afecta al usuario? </font></font></li><li>      , ,   ?               ? </li><li>    ,     ?   ,      , , -       ,     ? </li><li>          ?           ?     ?          ? </li><li>        ,      ? </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Estas preguntas reflejan la filosof√≠a fundamental de las alertas y los sistemas de alerta: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada vez que llega una alerta, debo responder con urgencia. </font><font style="vertical-align: inherit;">Puedo reaccionar con urgencia varias veces al d√≠a antes de cansarme.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cada alerta debe ser relevante. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cada respuesta a una alerta debe requerir intervenci√≥n humana. </font><font style="vertical-align: inherit;">Si la alerta se puede procesar autom√°ticamente, no deber√≠a aparecer.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las alertas deben ser sobre un nuevo problema o evento que no exist√≠a antes. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este enfoque borra ciertas diferencias: si la notificaci√≥n cumple las cuatro condiciones anteriores, no importa si la notificaci√≥n se env√≠a desde el sistema de monitoreo de White-box o Black-Box. </font><font style="vertical-align: inherit;">Este enfoque tambi√©n refuerza ciertas diferencias: es mejor gastar mucho m√°s esfuerzo en identificar los s√≠ntomas que en las causas; </font><font style="vertical-align: inherit;">Cuando se trata de razones, solo debe preocuparse por las razones inevitables.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Monitoreo a largo plazo </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En los entornos productivos actuales, los sistemas de monitoreo siguen un sistema productivo en constante evoluci√≥n con una arquitectura de software cambiante, caracter√≠sticas de carga y rendimiento objetivo. Las alertas que actualmente son dif√≠ciles de automatizar pueden convertirse en una ocurrencia frecuente, tal vez incluso digna de resolverse. En este punto, alguien deber√≠a encontrar y eliminar las causas profundas del problema; Si dicho permiso no es posible, la respuesta a la notificaci√≥n requiere una automatizaci√≥n completa.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es importante que las decisiones de monitoreo se tomen con objetivos a largo plazo en mente. </font><font style="vertical-align: inherit;">Cada advertencia que se realiza hoy distrae a una persona de mejorar el sistema ma√±ana, por lo que a menudo hay una disminuci√≥n en la disponibilidad o productividad de un sistema productivo en el momento necesario para mejorar el sistema de monitoreo a largo plazo. </font><font style="vertical-align: inherit;">Veamos dos ejemplos que ilustran este fen√≥meno.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bigtable SRE: Historial de alertas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La infraestructura interna de Google generalmente se proporciona y mide en t√©rminos de nivel de servicio (SLO). Hace muchos a√±os, el servicio de SLO de Bigtable se basaba en el rendimiento promedio de una transacci√≥n sint√©tica que simulaba un cliente en funcionamiento. Debido a problemas en Bigtable y en niveles m√°s bajos de la pila de almacenamiento de datos, el rendimiento promedio se debi√≥ a la cola "grande": el peor 5% de las solicitudes fueron a menudo mucho m√°s lentas que el resto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se enviaron notificaciones por correo electr√≥nico a medida que se acercaban al umbral de SLO, y se enviaron alertas al mensajero cuando se excedi√≥ el SLO. Ambos tipos de alertas se enviaron con la frecuencia suficiente, consumiendo cantidades inaceptables de tiempo de ingenier√≠a: el equipo pas√≥ una cantidad considerable de tiempo analizando alertas para encontrar algunas que fueran realmente relevantes. A menudo pasamos por alto un problema que realmente afectaba a los usuarios, porque solo algunas de las alertas eran espec√≠ficamente para este problema. Muchas de las alertas no fueron urgentes debido a problemas comprensibles en la infraestructura y funcionaron de manera est√°ndar, o no se procesaron en absoluto.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para remediar la situaci√≥n, el equipo adopt√≥ un enfoque triple: mientras hac√≠a grandes esfuerzos para mejorar el rendimiento de Bigtable, establecimos temporalmente el percentil 75 como nuestro objetivo de SLO para retrasar la respuesta a la solicitud. </font><font style="vertical-align: inherit;">Tambi√©n desactivamos las alertas por correo electr√≥nico, ya que hab√≠a tantas que era imposible dedicar tiempo a diagnosticarlas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta estrategia nos permiti√≥ tomar un descanso para comenzar a solucionar problemas a largo plazo en Bigtable y niveles inferiores de la pila de almacenamiento de datos, en lugar de solucionar constantemente problemas t√°cticos. </font><font style="vertical-align: inherit;">Los ingenieros realmente podr√≠an hacer el trabajo cuando no los atacaban constantemente las alertas. </font><font style="vertical-align: inherit;">Finalmente, la demora temporal en el procesamiento de notificaciones nos permiti√≥ mejorar la calidad del servicio.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gmail: respuestas predecibles y algor√≠tmicas de personas </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Al principio, Gmail se cre√≥ sobre un sistema de control de procesos Workqueue modificado, que se cre√≥ para procesar fragmentos de √≠ndice de b√∫squeda por lotes. Workqueue se adapt√≥ a procesos de larga duraci√≥n y posteriormente se aplic√≥ a Gmail, pero algunos errores en el c√≥digo opaco del planificador resultaron ser muy dif√≠ciles de curar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En ese momento, el monitoreo de Gmail estaba estructurado de tal manera que se activaban alertas cuando se cancelaban tareas individuales usando Workqueue. Este enfoque no era ideal, porque incluso en ese momento Gmail realiz√≥ miles de tareas, cada una de las cuales se proporcion√≥ a fracciones de un porcentaje de nuestros usuarios. Nos aseguramos de que los usuarios de Gmail tuvieran una buena interfaz de usuario, pero resolver tantas alertas era inalcanzable.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para resolver este problema, Gmail SRE cre√≥ una herramienta que ayud√≥ a depurar el programador lo mejor posible para minimizar el impacto en los usuarios. El equipo tuvo varias discusiones sobre si era necesario automatizar todo el ciclo desde la detecci√≥n de un problema hasta su resoluci√≥n hasta que se encontrara una soluci√≥n a largo plazo, pero algunos de ellos estaban preocupados de que tal soluci√≥n retrasar√≠a la correcci√≥n real del problema.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta tensi√≥n era com√∫n en el equipo y a menudo reflejaba una falta de confianza en la autodisciplina: mientras que algunos miembros del equipo quieren dar tiempo para una soluci√≥n correcta, otros temen que la soluci√≥n final se olvide y la soluci√≥n temporal dure para siempre. Este problema merece atenci√≥n, ya que es demasiado f√°cil solucionar problemas temporalmente, en lugar de tener que solucionar la situaci√≥n de manera continua. Los gerentes y el personal t√©cnico desempe√±an un papel clave en la implementaci√≥n de soluciones a largo plazo, apoyando y priorizando soluciones potencialmente a largo plazo, incluso cuando el "dolor" inicial disminuye.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Las alertas peri√≥dicas peri√≥dicas y las respuestas algoritmizadas deber√≠an ser una se√±al de alerta. </font><font style="vertical-align: inherit;">La falta de voluntad de su equipo para automatizar tales alertas significa que el equipo carece de la confianza de que pueden confiar en los algoritmos. </font><font style="vertical-align: inherit;">Este es un problema grave que debe abordarse.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A la larga </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un tema com√∫n vincula los ejemplos de Bigtable y Gmail: la competencia entre la disponibilidad a corto y largo plazo. </font><font style="vertical-align: inherit;">A menudo, un gran esfuerzo puede ayudar a un sistema fr√°gil a lograr una alta disponibilidad, pero este camino suele ser de corta duraci√≥n, cargado de agotamiento del equipo y dependencia de un peque√±o n√∫mero de miembros de este equipo tan heroico.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Una disminuci√≥n controlada de la disponibilidad a corto plazo suele ser una tarea dolorosa pero estrat√©gicamente importante para la estabilidad a largo plazo del sistema. Es importante no considerar cada alerta de forma aislada, sino considerar si el nivel general de alertas conduce a un sistema saludable y accesible con un equipo viable y un pron√≥stico favorable. Analizamos las estad√≠sticas de la frecuencia de las alertas (generalmente expresadas como incidentes de turno, cuando un incidente puede consistir en varios incidentes relacionados) en informes trimestrales con la administraci√≥n, lo que permite a los tomadores de decisiones representar constantemente la carga en el sistema de alerta y el estado general del equipo.</font></font><br><br><h1>  Conclusi√≥n </h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El camino hacia un monitoreo y alertas saludables es simple y directo. Se enfoca en los s√≠ntomas del problema para el cual se emiten alertas, y monitorear la causa sirve como una ayuda para solucionar problemas. La supervisi√≥n de los s√≠ntomas es m√°s f√°cil cuanto m√°s alto est√© en la pila que controla, aunque la supervisi√≥n de la carga y el rendimiento de la base de datos debe realizarse directamente en ella. Las notificaciones por correo electr√≥nico tienen beneficios muy limitados y tienden a convertirse f√°cilmente en ruido; en su lugar, debe usar un panel que supervise todos los problemas actuales que se env√≠an por correo electr√≥nico. El tablero tambi√©n se puede combinar con un registro de eventos para analizar correlaciones hist√≥ricas.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A la larga, es necesario lograr una alternancia exitosa de alertas sobre s√≠ntomas y problemas reales inevitables, adaptar los objetivos para garantizar que el monitoreo respalde el diagn√≥stico r√°pido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gracias por leer la traducci√≥n hasta el final. </font><font style="vertical-align: inherit;">Suscr√≠base a mi canal de telegramas sobre el monitoreo de </font></font><a href="https://t.me/monitorim_it"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@monitorim_it</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y el </font></font><a href="https://medium.com/%40antonkasimov"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blog en el medio</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a href="https://habr.com/ru/post/484246/">https://habr.com/ru/post/484246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484224/index.html">Bitwise LSD Sort (clasificaci√≥n de radix)</a></li>
<li><a href="../484236/index.html">Fantasmas en las nubes: detalles de hackear muchas compa√±√≠as</a></li>
<li><a href="../484238/index.html">El aprendizaje autom√°tico se enfrent√≥ a un problema matem√°tico no resuelto</a></li>
<li><a href="../484240/index.html">Convi√©rtete en un orador en Positive Hack Days 10. Comienza la convocatoria de ponencias</a></li>
<li><a href="../484244/index.html">Paul Graham sobre Java y los lenguajes de programaci√≥n Hacker (2001)</a></li>
<li><a href="../484248/index.html">Paul Graham: una prueba de adicci√≥n (The Island Test, 2006)</a></li>
<li><a href="../484250/index.html">Paul Graham: sobre neutralidad pol√≠tica e independencia del pensamiento (los dos tipos de moderado)</a></li>
<li><a href="../484252/index.html">Antig√ºedades: 20 a√±os de tecnolog√≠a inform√°tica en publicaciones medi√°ticas</a></li>
<li><a href="../484254/index.html">C√≥mo: infograf√≠as o infograf√≠as?</a></li>
<li><a href="../484270/index.html">Vamos a resolver algo de dinero</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>