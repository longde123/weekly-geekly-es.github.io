<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕌 🧑🏾‍🤝‍🧑🏾 👩‍👩‍👧 Delegierung einer Reverse-Subnetzzone von weniger als / 24 in BIND. Wie funktioniert es? 🖕🏿 😍 👩🏼‍🏫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einmal stand ich vor der Aufgabe, einem der Kunden das Recht zu geben, die PTR-Datensätze des ihm zugewiesenen Subnetzes zu bearbeiten / 28. Ich habe ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Delegierung einer Reverse-Subnetzzone von weniger als / 24 in BIND. Wie funktioniert es?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451890/">  Einmal stand ich vor der Aufgabe, einem der Kunden das Recht zu geben, die PTR-Datensätze des ihm zugewiesenen Subnetzes zu bearbeiten / 28.  Ich habe keine Automatisierung zum Bearbeiten der BIND-Einstellungen von außen.  Also habe ich beschlossen, den anderen Weg zu gehen - ein Stück der PTR / 24-Subnetzzone an den Client zu delegieren. <br><br>  Es scheint - was könnte einfacher sein?  Wir schreiben das Subnetz einfach richtig vor und leiten es an das gewünschte NS weiter, wie es mit der Subdomain gemacht wird.  Aber nein.  Es ist nicht so einfach (obwohl es in Wirklichkeit im Allgemeinen primitiv ist, aber die Intuition hilft nicht), deshalb schreibe ich diesen Artikel. <br><br>  Wer es selbst herausfinden will, kann den <a href="">RFC</a> lesen <br>  Wer eine fertige Lösung will, ist herzlich willkommen bei cat. <br><a name="habracut"></a><br>  Um diejenigen, die die Copy-Paste-Methode lieben, nicht zu verzögern, werde ich zuerst den praktischen Teil und danach den theoretischen Teil veröffentlichen. <br><br>  <b>1. Üben.</b>  <b>Delegierungszone / 28</b> <br><br>  Nehmen wir an, wir haben ein Subnetz von <b>7.8.9.0/24</b> .  Wir müssen das Subnetz <b>7.8.9.240/28</b> an den <b>DNS-</b> Client <b>7.8.7.8</b> ( <b>ns1.client.domain</b> ) <b>delegieren</b> . <br><br>  Auf dem DNS des Anbieters müssen Sie eine Datei finden, die die umgekehrte Zone dieses Subnetzes beschreibt.  Sei es <b>9.8.7.in-addr.arpa</b> . <br>  Beiträge von 240 bis 255 werden gegebenenfalls kommentiert.  Schreiben Sie am Ende der Datei Folgendes: <br><br><pre><code class="plaintext hljs">255-240 IN NS 7.8.7.8 $GENERATE 240-255 $ CNAME $.255-240</code> </pre> <br>  Vergessen Sie nicht, die seriellen Zonen zu erhöhen und dies zu tun <br><br><pre> <code class="plaintext hljs">rndc reload</code> </pre> <br>  Damit ist der Provider-Teil beendet.  Wir übergeben an Kunden DNS. <br><br>  Erstellen Sie zunächst die Datei <b>/etc/bind/master/255-240.9.8.7.in-addr.arpa mit dem</b> folgenden Inhalt: <br><br><pre> <code class="plaintext hljs">$ORIGIN 255-240.9.8.7.in-addr.arpa. $TTL 1W @ 1D IN SOA ns1.client.domain. root.client.domain. ( 2008152607 ; serial 3H ; refresh 15M ; retry 1W ; expiry 1D ) ; minimum @ IN NS ns1.client.domain. @ IN NS ns2.client.domain. 241 IN PTR test.client.domain. 242 IN PTR test2.client.domain. 245 IN PTR test5.client.domain.</code> </pre><br>  <b>Fügen</b> Sie in der Datei <b>named.conf</b> die Beschreibung unserer neuen Datei hinzu: <br><br><pre> <code class="plaintext hljs">zone "255-240.9.8.7.in-addr.arpa." IN { type master; file "master/255-240.9.8.7.in-addr.arpa"; };</code> </pre> <br>  B Starten Sie den Bindevorgang neu. <br><br><pre> <code class="plaintext hljs">/etc/init.d/named restart</code> </pre> <br>  Das ist alles.  Jetzt können Sie überprüfen. <br><br><pre> <code class="plaintext hljs">#&gt; host 7.8.9.245 245.9.8.7.in-addr.arpa is an alias for 245.255-240.9.8.7.in-addr.arpa. 245.255-240.9.8.7.in-addr.arpa domain name pointer test5.client.domain.</code> </pre> <br>  Bitte beachten Sie, dass nicht nur der PTR-Datensatz angegeben wird, sondern auch CNAME.  Es sollte so sein.  Wenn Sie sich fragen, warum, dann begrüßen Sie das nächste Kapitel. <br><br>  <b>2. Theorie.</b>  <b>Wie funktioniert es</b> <br><br>  Es ist schwierig, eine Black Box zu konfigurieren und zu debuggen.  Viel einfacher, wenn Sie verstehen, was im Inneren passiert. <br><br>  Wenn wir eine Subdomain in der Domain- <b>Domain</b> delegieren, schreiben wir ungefähr Folgendes: <br><br><pre> <code class="plaintext hljs">client.domain. NS ns1.client.domain. ns1.client.domain. A 7.8.7.8</code> </pre> <br>  Wir sagen allen, die fragen, dass wir nicht für diese Website verantwortlich sind, und wir sagen, wer dafür verantwortlich ist.  Alle Anfragen an <b>client.domain werden</b> an 7.8.7.8 umgeleitet.  Bei der Überprüfung sehen wir das folgende Bild (lassen Sie weg, was der Client dort hat. Es spielt keine Rolle): <br><br><pre> <code class="plaintext hljs"># host test.client.domain test.client.domain has address 7.8.9.241</code> </pre> <br>  Das heißt,  Wir wurden informiert, dass es einen solchen A-Datensatz und dessen IP 7.8.9.241 gibt.  Keine unnötigen Informationen. <br><br>  <b>Aber wie geht das auch mit einem Subnetz?</b> <br><br>  Weil  Da unser DNS-Server in RIPE registriert ist, wird bei der Anforderung einer PTR-IP-Adresse von unserem Netzwerk die erste Anforderung weiterhin an uns gesendet.  Die Logik ist dieselbe wie bei Domänen.  Aber wie soll man das Subnetz in die Zonendatei eingeben? <br><br>  Wir versuchen es so einzugeben: <br><br><pre> <code class="plaintext hljs">255-240 IN NS 7.8.7.8</code> </pre> <br>  Und ... ein Wunder ist nicht geschehen.  Wir erhalten keine Weiterleitung von Anfragen.  Die Sache ist, dass bind überhaupt nicht weiß, dass diese Einträge in der Reverse Zone-Datei IP-Adressen sind und noch mehr, so dass sie den Bereichseintrag nicht verstehen.  Für ihn ist dies nur eine symbolische Subdomain.  Das heißt,  Für die Bindung gibt es keinen Unterschied zwischen " <b>255-240</b> " und " <b>unserem Superclient</b> ".  Und die Anfrage für die Anfrage, dorthin zu gehen, wo sie sein sollte, sollte die Adresse in der Anfrage folgendermaßen aussehen: <b>241.255-240.9.8.7.in-addr.arpa</b> .  Oder so, wenn wir eine Zeichen-Subdomain verwenden: <b>241.oursuperclient.9.8.7.in-addr.arpa</b> .  Dies unterscheidet sich von den üblichen: <b>241.9.8.7.in-addr.arpa</b> . <br><br>  Hände eine solche Anfrage wird problematisch sein.  Und wenn es klappt, ist immer noch nicht klar, wie man es im wirklichen Leben anwendet.  Schließlich antwortet uns auf Anfrage von <b>7.8.9.241 immer</b> noch der DNS des Anbieters und nicht der Client. <br><br>  Und hier kommt <b>CNAME</b> ins Spiel. <br><br>  Auf der Anbieterseite müssen Sie einen Alias ​​für alle IP-Adressen des Subnetzes in einem Format erstellen, das die Anforderung an den Client-DNS weiterleitet. <br><br><pre> <code class="plaintext hljs">255-240 IN NS ns1.client.domain. 241 IN CNAME 241.255-240 242 IN CNAME 242.255-240  ..</code> </pre><br>  Dies ist für fleißige =). <br><br>  Und für die Faulen ist das Design unten besser geeignet: <br><br><pre> <code class="plaintext hljs">255-240 IN NS ns1.client.domain. $GENERATE 240-255 $ CNAME $.255-240</code> </pre> <br>  Jetzt wird die Informationsanfrage unter <b>7.1.9.241</b> von <b>241.9.8.7.in-addr.arpa</b> auf dem <b>DNS</b> -Server des Anbieters in <b>241.255-240.9.8.7.in-addr.arpa</b> konvertiert und an den DNS-Client weitergeleitet. <br><br>  Der Client muss solche Anforderungen bearbeiten.  Dementsprechend erstellen wir eine Zone von <b>255-240.9.8.7.in-addr.arpa</b> .  Darin können wir grundsätzlich Reverse-Datensätze für jede IP des gesamten / 24-Subnetzes veröffentlichen, aber wir werden nur nach denen gefragt, die der Anbieter an uns weiterleitet, sodass Sie nicht herumspielen können =). <br>  Zur Veranschaulichung werde ich ein Beispiel für den Inhalt der Reverse-Zone-Datei auf der Clientseite geben: <br><br><pre> <code class="plaintext hljs">$ORIGIN 255-240.9.8.7.in-addr.arpa. $TTL 1W @ 1D IN SOA ns1.client.domain. root.client.domain. ( 2008152607 ; serial 3H ; refresh 15M ; retry 1W ; expiry 1D ) ; minimum @ IN NS ns1.client.domain. @ IN NS ns2.client.domain. 241 IN PTR test.client.domain. 242 IN PTR test2.client.domain. 245 IN PTR test5.client.domain.</code> </pre><br>  Hier erhalten wir aufgrund der Tatsache, dass wir CNAME seitens des Anbieters verwenden, zwei Datensätze als Antwort auf eine Anforderung von Daten nach IP-Adresse und nicht einen. <br><br><pre> <code class="plaintext hljs">#&gt; host 7.8.9.245 245.9.8.7.in-addr.arpa is an alias for 245.255-240.9.8.7.in-addr.arpa. 245.255-240.9.8.7.in-addr.arpa domain name pointer test5.client.domain.</code> </pre> <br>  <i><b>Vergessen Sie nicht, die ACL korrekt zu konfigurieren.</b></i>  <i><b>Weil es keinen Sinn macht, eine PTR-Zone für sich zu nehmen und niemandem von außen zu antworten =).</b></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de451890/">https://habr.com/ru/post/de451890/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de451876/index.html">Rechenzentrum Frankfurt: Rechenzentrum Telehouse</a></li>
<li><a href="../de451878/index.html">Live-Streaming von Stereovideos auf VR-Brillen (Oculus Go)</a></li>
<li><a href="../de451880/index.html">DevPRO'19: Blick vom Wrike-Stand</a></li>
<li><a href="../de451884/index.html">Sieben Jahre als Entwickler gearbeitet: Welche Lektionen habe ich gelernt?</a></li>
<li><a href="../de451886/index.html">Verwenden diskreter Mathematik beim Testen</a></li>
<li><a href="../de451894/index.html">Ein kurzer und übersichtlicher Überblick über die Compiler-Architektur</a></li>
<li><a href="../de451896/index.html">Eine "unzerbrechliche" eyeDisk ist durch einen Iris-Scan geschützt, überträgt jedoch ein Passwort im Klartext</a></li>
<li><a href="../de451898/index.html">Innovation auf Russisch</a></li>
<li><a href="../de451900/index.html">Erster Beitrag zur Browser-API von Facebook</a></li>
<li><a href="../de451902/index.html">Microsoft Azure Developer Camp Russland</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>