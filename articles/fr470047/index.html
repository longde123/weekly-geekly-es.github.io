<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ωüèø üôÖüèª üî´ J'ai regard√© en arri√®re pour voir si elle avait regard√© en arri√®re - 2 ou dans mon propre centre de donn√©es via AWS üíÖüèΩ üôÄ ü§§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous publions tous les services situ√©s dans l'hyperviseur domestique via le service EC2 Amazon Web Services via une instance gratuite pour Amazon Linu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>J'ai regard√© en arri√®re pour voir si elle avait regard√© en arri√®re - 2 ou dans mon propre centre de donn√©es via AWS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470047/"><img src="https://habrastorage.org/webt/hb/3k/nj/hb3knjstg1kmyhx0g_bzk-r5jiu.jpeg" alt="image"><br><br>  Nous publions tous les services situ√©s dans l'hyperviseur domestique via le service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EC2 Amazon Web Services</a> via une instance gratuite pour Amazon Linux AMI 2018 en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libreswan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xl2tpd</a> et avec un peu de distorsion ... <br><a name="habracut"></a><br>  Les administrateurs syst√®me d'une entreprise traditionnelle (non informatique) ayant de l'exp√©rience, g√©n√©ralement apr√®s un certain temps, ont leur propre batterie de serveurs de virtualisation √† la maison pour tester le tas de solutions sur le terrain.  Cela peut √™tre une imitation banale d'un r√©seau de succursales r√©parties, le test d'une infrastructure int√©gr√©e de haute disponibilit√©, le d√©ploiement de nouvelles versions de certaines solutions, etc. <br><br>  √Ä l'ext√©rieur, il peut passer d'un simple ordinateur domestique √† m√©moire de pompage avec un hyperviseur int√©gr√© et un NAS de qualit√© grand public comme stockage iSCSI (ou m√™me comme une simple machine virtuelle sur le m√™me PC) √† des serveurs √† montage en rack de petite taille √† part enti√®re achet√©s pour des unit√©s de commande moins ch√®res. avec un pedigree des centres de donn√©es occidentaux, avec la m√™me BU tsiska pour la connectivit√© r√©seau et coinc√© dans le Fibre Channel m√™me, achet√© dans le NAS du march√© secondaire, mais d√©j√† une classe affaires. <br><br>  Bien s√ªr, √† l'√®re de l'engouement pour les nuages, toute l'infrastructure peut facilement √™tre d√©ploy√©e dans des centres de donn√©es cloud, mais ce n'est toujours pas toujours possible, principalement en raison du co√ªt.  Peu importe si les tests n√©cessitent plusieurs machines virtuelles l√©g√®res √† partir des plans disponibles, mais qu'en cas de service, vous devez tordre plusieurs dizaines voire des centaines de ¬´machines virtuelles¬ª distinctes avec une grande vari√©t√© de services, et vous voulez √©galement avoir une archive afin de pouvoir l'avoir √† tout moment il y avait un √©chantillon qui s'est tordu dans les configurations / param√®tres il y a un an.  Ou il est n√©cessaire de transf√©rer tous les pi√®ges avec la m√™me synchronisation entre ADDS et ADFS avant de transf√©rer certains des services commerciaux existants vers le m√™me MS Azure. <br><br>  Le principal probl√®me dans ce cas est la publication (transfert) de toute cette infrastructure vers l'ext√©rieur, afin que vous puissiez vous entra√Æner √† connecter des utilisateurs de l'ext√©rieur √† votre "site serveur" domestique ou √† vos propres services "cloud", ou √† l'int√©gration avec des services tiers, etc. <br><br>  C'est bien si la connexion domestique est con√ßue pour un tarif professionnel, dans ce cas il n'y a pas de probl√®me avec les demandes entrantes, et l'adresse IP est presque toujours "blanche", statique. <br><br>  Mais que faire lorsque le prestataire ¬´domicile¬ª habituel est pr√©sent sur le lieu de r√©sidence, qui en plus ne peut fournir qu'une adresse du r√©seau Priv√©.  Ou donnera-t-il une adresse blanche, mais coupe-t-il traditionnellement tous les entrants de la plage de ports privil√©gi√©s (&lt;1024)?  Ou vous √™tes un pauvre √©tudiant ringard et ne pouvez tout simplement pas vous permettre un tarif mensuel con√ßu pour les personnes morales.  Ou devez-vous souvent changer de lieu de r√©sidence, en faisant glisser les ¬´effets personnels¬ª de votre serveur virtuel vers la bosse?  Un cas sp√©cial est √©galement pertinent pour ceux qui vivent en dehors de la CEI, lorsque le fournisseur fournit de force son propre √©quipement pour se connecter √† Internet et que vous ne pouvez tout simplement pas physiquement configurer la redirection des ports dont vous avez besoin vers la ferme virtuelle domestique √† l'ext√©rieur. <br><br>  Une solution consiste √† utiliser l'un des services VPN tiers.  Malheureusement, peu d'entre eux autorisent les connexions entrantes par rapport au tunnel, le plus souvent c'est un service payant s√©par√©.  Dans ce cas √©galement, le choix des adresses IP externes sera tr√®s limit√© si vous souhaitez tester la situation avec la pr√©sence d'une adresse IP externe dans un pays particulier, en outre, en r√®gle g√©n√©rale, il n'y a aucune garantie qu'en m√™me temps, un certain nombre d'autres clients de services VPN ne s'accrochent pas √† cette adresse , ou il restera statique pendant longtemps, ce qui est important pour la configuration des enregistrements de sous-domaine de service dans DNS. <br><br>  Il est √©galement int√©ressant (√† mon humble avis), bien que quelques m√©thodes perverties, soient de d√©ployer votre propre routeur ¬´virtuel¬ª sur une plate-forme de cloud externe avec la possibilit√© de configurer un tunnel VPN de la ferme d'hyperviseur domestique vers cette machine virtuelle dans le cloud, avec les connexions entrantes n√©cessaires transmises √† partir de l'interface r√©seau externe services de cloud to home hypervisor.  Et id√©alement, pour ne rien payer pour le tout. <br><br>  Ayant r√©cemment perdu mon emploi, et avec lui l'acc√®s √† une ferme de test d'entreprise chaleureuse et confortable, mais en retour, j'ai re√ßu beaucoup de temps libre pour mettre √† jour mes comp√©tences, j'ai d√©cid√© de donner aux services de mon hyperviseur √† domicile la possibilit√© de voir les connexions client entrantes. <br><br>  L'auteur de ces lignes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"aime toutes sortes de perversions d'infrastructure"</a> , donc en tant que routeur virtuel, nous utiliserons l'instance gratuite Amazon Web Services (AWS) EC2 t2.micro pour Linux, qui au lieu d'AWS: VPC (en th√©orie) donnera un peu plus de flexibilit√© dans le d√©bogage et les fonctionnalit√©s , et la topologie de cette perversion VPN est pr√©sent√©e ci-dessous: <br><br><img src="https://habrastorage.org/webt/xs/o5/_k/xso5_kg5gwlm9ozy9pj7udiqxuc.png" alt="image"><br><br>  Que voyons-nous ici? <br><br>  Il existe une machine virtuelle (instance) gratuite (750 heures de travail par mois pendant l'ann√©e), sous Linux, d√©ploy√©e dans AWS: EC2.  Les appels entrants de certains utilisateurs de vos services √† domicile tombent sur l'adresse IPv4 blanche externe d'Elastic IP, puis via les r√®gles entrantes (entrantes) dans les ¬´groupes de s√©curit√©¬ª, les ports dont nous avons besoin sont mapp√©s vers l'interface r√©seau de l'instance, puis les paquets de ces demandes via iptables passent par le tunnel IPSec pour une machine virtuelle pour Windows 2016, o√π, √† l'aide du routage, RRAS acc√®de au service souhait√© dans la batterie de serveurs virtuelle domestique.  Nous accordons une attention particuli√®re √† la pr√©sence de trois NAT √† la fois: un dans AWS Linux, un sur le routeur ¬´r√©seau de bureau¬ª et un autre, implicite, sur le routeur domestique. <br><br>  Dans ce (mon) cas, une machine virtuelle sous Windows Server 2016 joue le r√¥le d'un routeur pour simuler un r√©seau de bureau et sa plate-forme de serveur, MS WAP y est d√©ploy√© en conjonction avec une machine distincte avec MS ADFS et autres, donc il n'y a aucun probl√®me √† la remplacer par un autre OS m√™me une pi√®ce maison au go√ªt.  Avec Windows RRAS, en passant, les choses se compliquent en cours de route, tout au long du chemin, j'ai d√ª faire face √† divers moments d√©sagr√©ables (dont ci-dessous), donc si vous choisissez de ne pas aimer MS Windows Server en tant que routeur, alors avec un autre syst√®me d'exploitation, cela peut √™tre plus facile. <br><br>  Nous allons d'abord cr√©er un compte AWS si vous n'en avez toujours pas.  Il n'y a aucun probl√®me avec la cr√©ation du compte lui-m√™me, il vous suffit d'indiquer les d√©tails de votre carte plastique, √† partir de laquelle 1 USD sera d√©bit√© (puis retourn√©) comme ch√®que. <br><br>  Seuls deux points doivent √™tre mentionn√©s ici: <br><br><ol><li>  Assurez-vous d'acc√©der √† AWS: IAM (gestion des identit√©s et des acc√®s) et activez MFA (authentification multifacteur) pour votre nouveau compte, ou mieux encore, comme le recommande AWS - cr√©ez √©galement un compte distinct avec MFA et continuez √† travailler en limitant les droits correspondants. elle.  Sinon, vous risquez de vous retrouver dans une situation d√©sagr√©able lorsqu'un cheval de Troie vole les informations d'identification AWS de votre PC et, par exemple, quelqu'un mine le mien √† vos frais sur des plans d'instance haute performance co√ªteux ... </li><li>  Pour des raisons pratiques, il est recommand√© de configurer une alerte budg√©taire.  Cela se fait dans les param√®tres du compte, l'√©l√©ment de menu correspondant est appel√© ¬´Tableau de bord de facturation et de gestion des co√ªts¬ª.  Dans le panneau qui s'ouvre, s√©lectionnez l'√©l√©ment ¬´Budgets¬ª √† gauche et configurez le budget mensuel pr√©vu √† votre go√ªt √† l'aide de l'assistant int√©gr√©.  N'oubliez pas d'y mettre en place une alerte: en cas de d√©passement du montant sp√©cifi√©, vous recevrez imm√©diatement un message.  Cela est utile si vous n'avez jamais travaill√© avec AWS auparavant et que vous avez peur d'obtenir accidentellement une somme ronde au cours de vos exp√©riences. </li></ol><br>  Ensuite, nous avons besoin d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS: EC2</a> . <br><br>  L'une des √©tapes les plus importantes consiste √† s√©lectionner la r√©gion AWS (essentiellement un centre de donn√©es) dans laquelle nous voulons d√©ployer notre machine virtuelle.  Le placement affectera directement l'emplacement g√©ographique de votre ¬´routeur virtuel¬ª, et donc le retard du r√©seau lorsque vous travaillez avec lui.  Ceci est important car  AWS ne fournit pas de migration en direct entre les r√©gions (le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service de migration de serveur AWS</a> int√©gr√© ne peut migrer que quelque chose vers le cloud AWS lui-m√™me) et en cas d'erreur de placement, il est plus facile de recr√©er une nouvelle instance √† l'emplacement souhait√©.  Sinon, vous devrez supprimer l'image de l'instance (Image, EC2 int√©gr√©) dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS: S3</a> (service de stockage) et √† partir de l√†, tirer cette image dans l'instance EC2 dans la nouvelle r√©gion.  Dans mon cas, la r√©gion de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Francfort a</a> √©t√© initialement s√©lectionn√©e: <br><br><img src="https://habrastorage.org/webt/8c/2s/yh/8c2syhsrly1luamcwjsvbmlnbtg.png" alt="image"><br><br>  Nous cr√©ons une nouvelle instance, s√©lectionnez l'option <b>"Free tier only"</b> √† gauche, ce qui limitera la liste d'images propos√©e aux seules images gratuites.  J'ai choisi <b>"Amazon Linux AMI 2018"</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus</a> sur les distributions Linux dans AWS), car  sur "Amazon Linux 2 AMI" xl2tpd ne fonctionne pas correctement en raison de la nature du noyau assembl√© par Amazon. <br><br>  Vous pouvez choisir n'importe quelle autre image Linux que vous connaissez dans la liste fournie.  Vous pouvez √©galement aller plus loin dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS Marketplace</a> et y chercher des images alternatives, lisez attentivement les commentaires sur le co√ªt: l'image elle-m√™me et les ressources informatiques peuvent √™tre gratuites, mais vous devrez payer un suppl√©ment pour l'espace disque, etc. <br><br>  Nous s√©lectionnons le type propos√© <b>¬´t2.micro¬ª</b> , il fournit 1 vCPU, 1 Go de m√©moire, 8-30 Go (SSD / magn√©tique) d'espace disque et 750 heures de travail gratuitement chaque mois pendant un an.  Assez pour notre ¬´routeur virtuel¬ª.  Il convient de noter que l'espace disque et le temps de travail sont consacr√©s √† toutes les instances, donc en cas de difficult√©s financi√®res, vous n'avez pas besoin de les cr√©er / ex√©cuter plus que vous ne pouvez vous le permettre, sauf gratuitement. <br><br>  Cliquez dans l'assistant ¬´Suivant ...¬ª, √† la 3e √©tape, nous laissons toutes les valeurs par d√©faut, √† la 4e, nous sommes d'accord avec les 8 gigaoctets de disque SSD par d√©faut propos√©s et l'instance commence avec le bouton Review and Launch: <br><br><img src="https://habrastorage.org/webt/ta/dv/of/tadvofw_fyn1iozzpgvxiwaswla.png"><br><br>  Apr√®s cela, nous aurons une fen√™tre avec un message sur la cr√©ation d'une nouvelle paire de cl√©s pour se connecter √† la n√¥tre via SSH et une proposition pour nommer cette paire et t√©l√©charger la cl√© priv√©e au format * .pem.  Nous en aurons vraiment besoin √† l'avenir, il est donc conseill√© de le conserver imm√©diatement en lieu s√ªr.  Si ce fichier est perdu, vous perdrez la possibilit√© de vous connecter √† distance aux instances l'utilisant.  Dans EC2, il n'y a aucun moyen de le r√©g√©n√©rer √† nouveau pour une instance existante, le seul moyen est de connecter le disque d'instance √† une autre instance qui a acc√®s et √† la modification de cl√© ult√©rieure. <br><br>  Apr√®s un certain temps, l'instance sera lanc√©e, elle aura une adresse IPv4 interne (priv√©e) et externe (publique), ainsi que deux noms DNS correspondants. <br>  Configurez imm√©diatement les groupes de s√©curit√© pour assurer le flux de trafic pour les services dont vous avez besoin: <br><br><img src="https://habrastorage.org/webt/ex/rh/7y/exrh7yxlnlqsb36u5pdqifxrdb8.png"><br><br>  Nous aurons besoin des ports entrants ouverts 500, 1701, 4500 UDP et 4500 TCP pour organiser le tunnel VPN IPSec L2TP, HTTP et HTTPS pour publier les services de la ferme de la maison, l'acc√®s externe √† l'instance via SSH a √©t√© cr√©√© automatiquement lors de la cr√©ation de l'instance, car  EC2 ne contient essentiellement aucun acc√®s int√©gr√© √† la console de la machine virtuelle via son interface Web.  Il n'y a que la possibilit√© de visualiser l'√©cran: <br><br><img src="https://habrastorage.org/webt/zr/g4/uw/zrg4uw5t3_nihfjq8qaipfwxfkw.png"><br><br>  Il est conseill√© de configurer l'acc√®s via VPN et SSH uniquement √† partir de votre adresse IP domestique.  L'ordre des r√®gles dans les groupes de s√©curit√© n'a pas d'importance. <br><br>  √âtant donn√© que nous utiliserons plusieurs documentations NAT, AWS recommande de d√©sactiver la <b>¬´v√©rification de la source / destination du r√©seau¬ª</b> dans ce cas: <br><br><img src="https://habrastorage.org/webt/oa/6m/mg/oa6mmgeh6dyzg6sjxzdj0lkzbne.png"><br><br>  √âtant donn√© que nous utiliserons le tunneling IPSec et non le transport, ce param√®tre n'a pas beaucoup de sens pour nous, mais juste au cas o√π, il est pr√©f√©rable de le d√©sactiver. <br><br>  Connectez-vous via SSH √† notre instance.  Si vous utilisez un client graphique SSH, par exemple, PuTTY, pour vous connecter, l'aide int√©gr√©e sur la connexion, appel√©e par RMB sur l'instance -&gt; Connect, vous aidera: <br><br><img src="https://habrastorage.org/webt/dc/tm/s1/dctms1dbkmpble2n5vojwkdq3py.png"><br><br>  Amazon Linux conserve un pedigree de RHEL et CentOS, donc le gestionnaire de packages yum est utilis√©. <br><br>  Toutes les op√©rations d√©crites ci-dessous doivent √™tre effectu√©es avec une √©l√©vation de privil√®ges, nous les pr√©c√©dons donc avec sudo ou travaillons simplement en tant que root. <br><br>  Premi√®re mise √† jour: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum update</span></span></code> </pre> <br>  En tant que logiciel pour organiser un serveur VPN, nous utiliserons une combinaison de libreswan et xl2tpd. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LibreSwan</a> (fork d'OpenSwan et un analogue de strongSwan) est une impl√©mentation populaire de VPN IPSec et IKE (Internet Key Exchange).  Il peut contourner correctement diff√©rents types de NAT et leurs combinaisons, ce qui est particuli√®rement important lors de l'organisation du tunneling IPSec. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xl2tpd est</a> √©galement largement utilis√©, son principal avantage est la capacit√© int√©gr√©e d'authentifier et de transmettre les param√®tres de connexion client via ppp lors de la connexion (par exemple, adresses IP, param√®tres de route par d√©faut, serveurs DNS, etc.), ce qui √©limine la n√©cessit√© d'un d√©ploiement DHCP et Radius suppl√©mentaire pour notre t√¢ches simples. <br><br>  √âtant donn√© que xl2tpd n'est pas dans les r√©f√©rentiels Amazon Linux standard, nous devons activer EPEL (Extra Packages for Enterprise Linux): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum-config-manager --enable epel</span></span></code> </pre> <br><h3>  Installez les packages n√©cessaires: </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install libreswan xl2tpd -y</span></span></code> </pre> <br><h3>  Activer le routage au niveau du noyau: </h3><br>  dans le fichier <b>/etc/sysctl.conf on</b> √©crit: <br><br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 1 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.lo.accept_redirects = 0 net.ipv4.conf.lo.secure_redirects = 0 net.ipv4.conf.lo.send_redirects = 0 net.ipv4.conf.eth0.accept_redirects = 0 net.ipv4.conf.eth0.secure_redirects = 0 net.ipv4.conf.eth0.send_redirects = 0 net.ipv4.conf.all.rp_filter = 0 net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.eth0.rp_filter = 0</code> </pre><br>  D√©sactivez <b>rp_filter</b> dans la session en cours pour ne pas red√©marrer: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># for f in /proc/sys/net/ipv4/conf/*/rp_filter ; do # echo 0 &gt; $f # done</span></span></code> </pre><br>  Nous appliquons les param√®tres et v√©rifions la disponibilit√© du routage: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sysctl -p /etc/sysctl.conf # cat /proc/sys/net/ipv4/ip_forward</span></span></code> </pre><br>  Nous devons assurer la transmission des paquets entrants (par rapport √† l'interface publique de l'instance) des ports des services requis vers notre futur tunnel IPSec.  Pour cela, il faut non seulement d√©-NAT ces paquets, mais aussi faire du masquage sur l'interface <b>ppp0</b> . <br>  Nous utiliserons pour cela les fonctionnalit√©s <b>iptables</b> int√©gr√©es, qui dans le cas d'Amazon Linux sont initialement configur√©es pour autoriser compl√®tement tout trafic dans n'importe quelle direction: <br><br>  faire DNAT des ports requis: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 80 -j DNAT --to-destination 10.100.0.2:80 # iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 443 -j DNAT --to-destination 10.100.0.2:443</span></span></code> </pre> <br>  transmettre tous les paquets qui sont arriv√©s √† ces ports √† l'adresse de la porte Windows: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 80 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT # iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span></span></code> </pre> <br>  faire du masquage pour ces packages: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></span></code> </pre><br>  Il est conseill√© de conserver les r√®gles iptables afin qu'elles se resserrent automatiquement au red√©marrage de l'instance: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># service iptables save</span></span></code> </pre> <br>  Dans ce cas, nous utilisons le DNAT (Destination NAT) du port TCP requis √† partir de l'interface r√©seau eth0 de l'instance en direction de l'adresse IPv4 10.100.0.2, qui est l'adresse sur l'interface ppp du service RRAS de notre porte Windows dans l'hyperviseur domestique. <br><br>  Le point suivant est tr√®s important: puisque les services √† l'int√©rieur de l'hyperviseur doivent pouvoir r√©pondre aux demandes re√ßues de l'instance AWS, il est n√©cessaire de fournir un masquage (remplacement de l'adresse de l'exp√©diteur) sur l'interface <b>ppp0</b> de l'instance avant d'envoyer le paquet, sinon la r√©ponse ira dans une direction compl√®tement diff√©rente: de la porte Windows dans l'hyperviseur apr√®s le tunnel IPSec directement vers le routeur par d√©faut (routeur domestique), √† ‚Äã‚Äãla suite de quoi, bien s√ªr, il sera supprim√© du c√¥t√© client du service, comme s'il provenait d'une ressource non sollicit√©e.  Si le masquage est utilis√© dans l'en-t√™te du paquet √† l'entr√©e du tunnel vpn, l'adresse de l'exp√©diteur passera de l'adresse quelque part sur Internet √† l'adresse <b>ppp0 de l'</b> interface de l'instance AWS: EC2, c'est-√†-dire  dans mon cas √† 10.100.0.1 <br><br>  Au lieu d'utiliser iptables pour d'autres distributions Linux ou syst√®mes * NIX, vous pouvez recommander le bon vieux rinetd, o√π tout cela se fait g√©n√©ralement sur une seule ligne dans sa configuration <b>rinetd.conf</b> : <br><br><pre> <code class="bash hljs">&lt;ip <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;port <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;ip destination&gt; &lt;port destination&gt;</code> </pre> <br>  La seule chose qui devra √™tre activ√©e dans ce cas dans le noyau est la possibilit√© de routage / trafic NAT. <br><br><h3>  Il est temps de cuisiner libreswan. </h3><br>  Le fichier <b>/etc/ipsec.conf</b> contient des instructions pour t√©l√©charger tous les fichiers .conf depuis /etc/ipsec.d/, par cons√©quent, nous cr√©ons un nouveau fichier de configuration dans le r√©pertoire /etc/ipsec.d/aws_vpn.conf et nous y ajoutons: <br><br><pre> <code class="bash hljs">config setup <span class="hljs-comment"><span class="hljs-comment">#       # plutostderrlog=/var/log/pluto.log # logfile=/var/log/pluto.log # plutodebug = all #  NAT-T -   NAT- nat_traversal=yes oe=off protostack=netkey nhelpers=0 interfaces=%defaultroute conn aws_vpn type=tunnel auto=start forceencaps=yes pfs=no fragmentation=yes authby=secret left=%defaultroute #   &lt;‚Ä¶&gt;      Elastic IP leftid=&lt;‚Ä¶&gt; #   &lt;‚Ä¶&gt;     (172...) leftsubnet=&lt;‚Ä¶&gt;/32 leftnexthop=%defaultroute leftprotoport=17/1701 rightprotoport=17/%any right=%any rightsubnetwithin=0.0.0.0/0 rightsubnet=vhost:%priv</span></span></code> </pre><br>  Pour plus de simplicit√©, nous utiliserons l'authentification IPSec bas√©e sur une cl√© partag√©e (PSK), et non sur des certificats, nous devons donc la sp√©cifier explicitement.  Le fichier <b>/etc/ipsec.secrets</b> contient des instructions pour t√©l√©charger tous les fichiers .secrets de <b>/etc/ipsec.d/</b> , l√† nous cr√©ons un nouveau fichier <b>/etc/ipsec.d/aws_vpn.secrets</b> et <b>sp√©cifions</b> le PSK dans le format: <br><br><pre> <code class="bash hljs">&lt;     172...&gt; %any : PSK <span class="hljs-string"><span class="hljs-string">"&lt; PSK&gt;"</span></span></code> </pre> <br>  A titre d'exemple: <br><br><pre> <code class="bash hljs">172.31.20.120 %any : PSK <span class="hljs-string"><span class="hljs-string">"Pa$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$w0rd</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  √âtant donn√© que la connexion ppp sera utilis√©e √† l'int√©rieur du tunnel IPSec et qu'il existe sa propre authentification, nous la configurons √©galement: <br>  Nous entrons le nom d'utilisateur et le mot de passe dans le fichier <b>/ etc / ppp / chap-secrets</b> au format: <br><br><pre> <code class="bash hljs">&lt;user&gt; * &lt;password&gt; *</code> </pre> <br>  A titre d'exemple: <br><br><pre> <code class="bash hljs">aws_user * Pa$<span class="hljs-variable"><span class="hljs-variable">$w0rd</span></span> *</code> </pre> <br>  Lors de la connexion au client ppp, il est possible de passer un certain nombre d'options pour configurer l'interface r√©seau et la table de routage de sa part. <br><br>  Dans le fichier <b>/etc/ppp/options.xl2tpd</b> , d√©finissez ces options: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  xl2tpd  ip   ipcp-accept-local ipcp-accept-remote #    defaultroute   Windows-    nodefaultroute noccp auth #   RRAS  Windows-  mschap-v2   require-mschap-v2 #   MTU  MRU mtu 1410 mru 1410 lock</span></span></code> </pre><br>  Parce que  nous n'avons pas besoin de transmettre les adresses DNS, victoires, etc. au client.  choses - toutes les autres options doivent √™tre comment√©es. <br><br>  Ici, vous avez besoin d'une explication de la configuration. <br><br>  Le comportement standard pour les connexions VPN consiste √† installer une nouvelle route par d√©faut dans la table client, ce qui force tout le trafic de celle-ci vers Internet √† ¬´passer¬ª par le serveur VPN.  Dans notre cas, c'est faux, car  l'objectif de la porte Windows est de fournir un acc√®s simul√© √† Internet du r√©seau de bureaux virtuels derri√®re lui dans l'hyperviseur et de publier les ressources des services internes vers l'ext√©rieur via AWS: EC2, il est donc irrationnel de diriger tout le trafic via l'instance vers AWS: EC2.  C'est pourquoi vous devez emp√™cher une connexion VPN dans RRAS de modifier l'itin√©raire par d√©faut (vers un routeur domestique). <br><br>  Il est √©galement important de choisir les valeurs MTU et MRU correctes: nous utilisons le tunneling IPSec et une taille de charge utile trop grande peut ne pas correspondre √† la limite d'encapsulation, ce qui entra√Ænera une fragmentation et tr√®s probablement une erreur.  S'il appara√Æt, essayez tout d'abord de r√©duire ces valeurs, par exemple, √† 1280. Les valeurs indiqu√©es dans la configuration donn√©e sont compatibles avec le client VPN Windows. <br><br><h3>  Reste √† configurer xl2tpd </h3><br>  Nous configurons tout ce qui est n√©cessaire dans le fichier de configuration xl2tpd <b>/etc/xl2tpd/xl2tpd.conf</b> : <br><br><pre> <code class="bash hljs">[global] port=1701 ipsec saref = yes ; ,      ;debug tunnel = yes ;debug avp = yes ;debug network = yes ;debug state = yes ;debug tunnel = yes [lns default] name = AWSvpnServer ;       ppp ip range = 10.100.0.2-10.100.0.2 ;    ppp0 AWS:EC2  <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ip = 10.100.0.1 require authentication = yes require chap = yes refuse pap = yes pppoptfile = /etc/ppp/options.xl2tpd length bit = yes</code> </pre><br><h3>  Nous v√©rifions tout ce que nous avons fait </h3><br>  Nous essayons d'ex√©cuter les deux services et v√©rifions les configurations: <br><br><pre> <code class="bash hljs">service ipsec start service xl2tpd start ipsec verify</code> </pre><br>  Les services sont peut-√™tre d√©j√† en cours d'ex√©cution, auquel cas ils sont simplement red√©marr√©s. <br><br>  Si tout va bien, la sortie de ipsec verify devrait √™tre similaire √† la capture d'√©cran: <br><br><img src="https://habrastorage.org/webt/o1/rv/br/o1rvbrchcizb6jn9qewgrj_hrn4.png"><br><br>  Vous pouvez d√©boguer xl2tpd de mani√®re interactive en l'ex√©cutant avec le commutateur -D et en le suspendant dans une ¬´fen√™tre¬ª distincte du terminal SSH √† l'aide de l'utilitaire <b>screen</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># xl2tpd -D</span></span></code> </pre> <br>  Dans ce cas, le processus xl2tpd ne passera pas en arri√®re-plan, mais affichera toutes ses activit√©s sur l'√©cran du terminal. <br><br>  En cas de probl√®me, vous devez d√©commenter les options de d√©bogage dans les configurations (voir les commentaires) et consulter le contenu des journaux syst√®me et du fichier <b>/var/log/pluto.log</b> .  Il convient √©galement de pr√™ter attention au contenu de l' <b>option virtual_private / virtual-private</b> dans le fichier <b>/etc/ipsec.conf</b> , il r√©pertorie tous les r√©seaux priv√©s disponibles pour l'√©change de donn√©es via IPSec.  Si, pour une raison quelconque, vous avez votre propre adressage, par exemple, vous utilisez votre propre pool d'adresses IPv4 blanches, vous devez apporter des modifications √† ce param√®tre. <br><br><h3>  Passons √† la derni√®re √©tape - configurer le service RRAS dans la porte Windows et v√©rifier la publication des services √† partir d'Internet </h3><br>  Il est suppos√© que votre hyperviseur domestique dispose d'une machine virtuelle ex√©cutant Windows 2012R2 ou plus r√©cente, d√©ploy√©e en mode graphique (bureau), et il y a deux adaptateurs r√©seau dans cette machine virtuelle: l'un "regarde" dans le r√©seau domestique et a un routeur domestique comme route par d√©faut et l'autre dans un r√©seau de ¬´bureaux¬ª local virtuel, dans lequel des services sont publi√©s √† l'ext√©rieur.  Un domaine Windows est facultatif, √† moins bien s√ªr que les services eux-m√™mes ne l'exigent. <br><br>  Nous installons tous les r√¥les n√©cessaires √† l'aide du Gestionnaire de serveur ou √† l'aide de l'applet de commande PowerShell <b>Install-WindowsFeature</b> : <br><br><img src="https://habrastorage.org/webt/lv/vw/ul/lvvwull1qus2dpgplvaxfvjv_gq.png"><img src="https://habrastorage.org/webt/pc/ag/80/pcag80h9dc8jq6gtim8jbdoeseq.png"><br><br>  Ici, je d√©montre l'installation de r√¥les via des graphiques, car il sera alors beaucoup plus pratique d'appeler l'assistant de configuration √† partir du Gestionnaire de serveur et de configurer le service RRAS lui-m√™me dans le calendrier, ce qui nous plaira avec la bonne vieille interface de l'√©poque de Windows Server 2003: <br><br><img src="https://habrastorage.org/webt/ai/rx/hz/airxhzrmjcbvyopop4rt_rcu4ga.png"><br><br>  Cliquez sur RMB sur votre serveur, s√©lectionnez <b>¬´Configurer et activer le routage et l'acc√®s distant¬ª</b> , puis configurez manuellement: <br><br><img src="https://habrastorage.org/webt/na/gj/bc/nagjbch0d6jxmyjzgywhnqqe17s.png"><br><br>  N'h√©sitez pas √† s√©lectionner tous les choucas, √† terminer l'assistant et √† d√©marrer le service: <br><br><img src="https://habrastorage.org/webt/ku/ir/sq/kuirsqjvnmskwfjrikybcl2kacu.png"><br><br>  Tout d'abord, lib√©rons notre r√©seau local virtuel √† l'ext√©rieur.  Nous allons √† IPv4-&gt; NAT et cr√©ons une nouvelle interface, comme l'interface existante sur laquelle NAT sera impl√©ment√©, s√©lectionnez l'interface externe (qui regarde sur Internet, ou plut√¥t dans votre r√©seau domestique), marquez-la comme publique et activez NAT dessus: <br><br><img src="https://habrastorage.org/webt/gk/zh/lx/gkzhlxjyvjsgkhdnfvaqyhcn3xo.png"><img src="https://habrastorage.org/webt/kw/wx/xw/kwwxxw5u1gtezu2moo-3beokuli.png"><br><br>  Nous v√©rifions comment le trafic du LAN virtuel sort par notre portail.  Nous n'avons pas encore besoin de configurer le pare-feu Windows. <br><br>  Si tout va bien, nous allons enfin cr√©er ce pour quoi nous nous battions, une connexion VPN √† notre instance AWS et v√©rifier la publication de nos services.  Nous allons dans le composant logiciel enfichable RRAS √† <b>¬´Interfaces r√©seau¬ª</b> et cr√©ons une nouvelle interface de num√©rotation √† la demande avec un nom arbitraire: <br><br><img src="https://habrastorage.org/webt/-v/04/yx/-v04yxa-najhry2evwovvtydsby.png"><br><br>  S√©lectionnez imm√©diatement la connexion L2TP, afin que notre nouvelle interface n'essaie pas automatiquement de d√©terminer le type de VPN et, par cons√©quent, qu'elle se connecte plus rapidement: <br><br><img src="https://habrastorage.org/webt/jg/mw/xb/jgmwxbg1nzbih2grilgopxrlfv8.png"><br><br>  Plus loin dans l'assistant, nous indiquons l'adresse publique de notre cloud (dans mon cas, Elastic IP).  Dans les √©tapes suivantes, laissez tout tel quel, car  nous n'avons pas besoin d'une connexion de site √† site: <br><br><img src="https://habrastorage.org/webt/fa/fn/p7/fafnp7fmggqxnbmosjcpdkx1wck.png"><img src="https://habrastorage.org/webt/d1/zc/wm/d1zcwmsgomejupu7if4ynp2rqjk.png"><br><br>  Sp√©cifiez le compte utilisateur sous lequel nous avons configur√© la connexion ppp (dans le fichier <b>/ etc / ppp / chap-secrets</b> ).  Aucun nom de domaine n'est requis: <br><br><img src="https://habrastorage.org/webt/zc/to/ei/zctoei91of_eyji6fncqhgvcii4.png"><br><br>  L'assistant cr√©e une nouvelle connexion.  Reste maintenant √† le configurer.  Nous allons ajuster le d√©lai d'inactivit√© (Idle-time), supprimer le CHAP obsol√®te au profit de MS-CHAPv2 uniquement, sp√©cifier la cl√© PSK dans les ¬´Propri√©t√©s avanc√©es¬ª (celle qui a √©t√© d√©finie pour xl2tpd dans le fichier /etc/ipsec.d/aws_vpn. secrets) et supprimez IPv6: <br><br><img src="https://habrastorage.org/webt/a0/qf/tf/a0qftfatglil4qkjv-hyn5hzvlc.png"><img src="https://habrastorage.org/webt/ax/hy/hu/axhyhuwgchr9z2vhmel17jjbx1s.png"><img src="https://habrastorage.org/webt/vq/xl/qz/vqxlqzejzpi3rs0i9x0r5ol9fkg.png"><img src="https://habrastorage.org/webt/km/ro/um/kmroumh0brc2_yq3przzb-a7jm8.png"><br><br>  Apr√®s avoir cr√©√© une nouvelle interface, vous devez √©galement entrer dans les propri√©t√©s du service RRAS lui-m√™me, activer votre strat√©gie IPSec pour L2TP et sp√©cifier votre PSK.  Il leur est demand√© de red√©marrer le service RRAS. <br><br><img src="https://habrastorage.org/webt/h8/0w/zk/h80wzkz1pfymizhrqruvwrgj9di.png"><br><br>  Il semblerait que tout peut √™tre soulev√© en toute s√©curit√© une nouvelle interface et profiter du travail.  Mais non.  √âtant donn√© que nous avons utilis√© NAT du c√¥t√© de l'instance AWS: EC2, le client VPN Windows ne pourra pas se connecter √† un tel n≈ìud Nat-Traversal.  Cela est vrai √† la fois pour les versions client (jusqu'√† la derni√®re au moment de la r√©daction de cet article de la version Windows 10) et pour les serveurs. <br><br>  Heureusement, il existe une solution officielle √† ce probl√®me sous la forme de modifications dans le registre des param√®tres du service de strat√©gie IPSec suivies d'un red√©marrage: <br><br>  √Ä <br>  <b>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ PolicyAgent</b> <br>  cr√©er une cl√© DWORD (32 bits) <br>  <b>SupposonsUDPEncapsulationContextOnSendRule = 2</b> <br>  et red√©marrez notre Windows Gate. <br><br>  Le service RRAS est malheureusement c√©l√®bre pour son caract√®re capricieux dans la configuration et le fonctionnement, et m√™me apr√®s un red√©marrage, il effectue un d√©marrage diff√©r√©.  Vous pouvez donc vous pr√©cipiter apr√®s un red√©marrage. <br>  Si tout est fait correctement, la connexion fonctionnera dans les 5 √† 10 secondes. <br><br>  Reste √† faire la publication des ressources n√©cessaires sur le portail Windows lui-m√™me. <br><br>  Pour le test nous travaillerons sur la publication du serveur web.  Tout d'abord, consultez notre tunnel IPSec et les r√®gles iptables. <br><br>  Avec des mains tremblantes, nous v√©rifions √† partir d'un PC arbitraire connect√© √† Internet: <br><br><img src="https://habrastorage.org/webt/ho/yg/c-/hoygc-blrya-dt30hytsmdruezg.png"><img src="https://habrastorage.org/webt/8v/yc/q7/8vycq7c2bsc6dqjcc3t7qzcacje.png"><br><br>  Wow, √ßa marche ... <br><br>  Lors de l'installation des r√¥les n√©cessaires, le MS IIS ¬´natif¬ª a √©t√© install√© de force, mais nous le voulons encore plus facilement.  Pour cela, sur une plateforme Windows, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>HFS</b></a> (HTTP File Server) est bien adapt√© - il est gratuit, ne n√©cessite pas d'installation, donne une page sp√©cifique et un en-t√™te HTTP, peut fonctionner sur un port arbitraire (par d√©faut c'est 8080, donc dans notre cas il faudra reconfigurer en 80), et √©crit √©galement imm√©diatement dans sa console d'o√π provient la connexion, ce qui est tr√®s pratique pour d√©boguer la publication de nombreuses ressources Web sur la plate-forme Windows.  Pour l'utiliser, vous devez d'abord arr√™ter le site MS IIS afin de d√©lier le serveur int√©gr√© du port requis.  √âtant donn√© que nous ne voulons pas installer la console de gestion MS IIS (en fait, la console MS IIS 6 sera pr√©sente pour des raisons de compatibilit√©, mais IIS 7+ ne peut pas √™tre contr√¥l√© via elle), nous le ferons via PowerShell: <br><br><pre> <code class="bash hljs">Stop-WebSite -Name <span class="hljs-string"><span class="hljs-string">"Default Web Site"</span></span></code> </pre> <br>  ou simplement via l'utilitaire de gestion iisreset: <br><br><pre> <code class="bash hljs">iisreset /stop</code> </pre> <br>  Apr√®s cela, vous devez autoriser le trafic entrant vers le port 80 dans le pare-feu Windows int√©gr√©. <br>  Nous d√©marrons HFS et v√©rifions: <br><br><img src="https://habrastorage.org/webt/ti/u2/bc/tiu2bcpm3ynhzteryfe9njxvfq4.png"><br><br>  Tout est super.  Nous avons r√©alis√© que de n'importe o√π sur Internet, vous pouvez voir le serveur Web qui vit dans notre maison comme une machine virtuelle dans un hyperviseur arbitraire. <br><br>  La touche finale: nous apprenons √† RRAS √† transmettre toutes ces demandes de l'ext√©rieur vers le r√©seau du bureau virtuel, o√π, selon la l√©gende, nous avons un autre serveur Web. <br><br>  Pour ce faire, nous allons √† nouveau dans le composant logiciel enfichable de gestion RRAS dans IPv4-&gt; NAT et RMB sur notre interface VPN, o√π nous s√©lectionnons l'onglet <b>¬´Services et ports¬ª</b> , le marquons dans la liste des serveurs Web et sp√©cifions le serveur Web dans le r√©seau virtuel interne dont nous voulons publier les ressources. internet: <br><br><img src="https://habrastorage.org/webt/d7/bq/jv/d7bqjv0ir3a2l8w4vzxpdax8nra.png"><br><br>  Cliquez sur OK et ... tout est pr√™t.  Nous v√©rifions - tout devrait bien fonctionner. <br><br>  D'une mani√®re si simple, vous pouvez publier rapidement presque tous les services et ressources, des sites, des serveurs de messagerie √† certaines int√©grations complexes.  Naturellement, pour la plupart d'entre eux, vous aurez besoin d'avoir votre propre domaine DNS avec la possibilit√© de cr√©er des sous-domaines et de modifier les enregistrements n√©cessaires.  Il est √©galement conseill√© d'utiliser des certificats SSL pour publier des ressources Web, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gr√¢ce √† LetsEncrypt</a> et √† des services similaires compatibles ACME, tout cela peut √™tre fait enti√®rement gratuitement et avec une mise √† jour automatique. <br><br>  Lorsque vous red√©marrez l'instance, l'adresse IPv4 publique ne change pas - uniquement lorsqu'elle est arr√™t√©e, mais il est toujours recommand√© d'utiliser une adresse IPv4 statique dans AWS: EC2.  Statique dans le sens o√π lorsque vous d√©sactivez votre instance, elle lui reste affect√©e et ne tombe pas dans le pool libre g√©n√©ral.  Bien s√ªr, cela est n√©cessaire pour ne pas s'emb√™ter √† chaque fois avec la reconfiguration des enregistrements DNS dans les domaines, et personne n'a annul√© TTL avec mise en cache.  Cela co√ªte beaucoup d'argent et s'appelle, comme d√©j√† mentionn√© ci-dessus, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Elastic IP</a> . <br><br><h3>  Automatisation primitive des processus </h3><br>  Enfin, je veux mentionner une autre grande fonctionnalit√© d'AWS: EC2 - configuration rapide de l'instance d√©ployable.  Il existe de nombreuses options de d√©ploiement rapide dans AWS: EC2, jusqu'√† des services sp√©ciaux (et plut√¥t complexes, mais tr√®s puissants), mais il y a la plus simple: √† l'√©tape 3 de l'assistant de cr√©ation d'une nouvelle instance en bas se trouve le champ <b>"Donn√©es utilisateur"</b> .  Vous pouvez y placer un script en bash ou m√™me PowerShell (dans le cas d'une instance pour Windows), et ce script sera ex√©cut√© automatiquement imm√©diatement apr√®s la cr√©ation de l'instance. <br>  C'est-√†-dire  vous pouvez l√©g√®rement modifier toutes les commandes et configurations ci-dessus pour cr√©er votre propre script bash et l'utiliser pour augmenter rapidement un tel routeur AWS: EC2 virtuel.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur cette fonctionnalit√©</a> . <br><br>  Merci d'avoir pris le temps de lire cet article. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470047/">https://habr.com/ru/post/fr470047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470033/index.html">F # 2: Environnement FSI</a></li>
<li><a href="../fr470035/index.html">G√©n√©rateur d√©lirant: cr√©ez des textes dans n'importe quelle langue √† l'aide d'un r√©seau de neurones</a></li>
<li><a href="../fr470037/index.html">F # 3: Formatage du texte</a></li>
<li><a href="../fr470043/index.html">La science derri√®re comment notre cerveau fonctionne le mieux et comment la technologie et notre environnement peuvent aider</a></li>
<li><a href="../fr470045/index.html">Visual Studio pour Mac: principales fonctionnalit√©s du nouvel √©diteur</a></li>
<li><a href="../fr470049/index.html">Pr√©sentation de la gestion des packages NuGet au niveau de la solution dans Visual Studio pour Mac</a></li>
<li><a href="../fr470051/index.html">Neurosciences: quand notre cerveau fonctionne le mieux et comment la technologie peut l'aider</a></li>
<li><a href="../fr470055/index.html">Pr√©sentation de la gestion des packages NuGet au niveau de la solution dans Visual Studio pour Mac</a></li>
<li><a href="../fr470057/index.html">Visual Studio pour Mac: 5 nouvelles fonctionnalit√©s int√©ressantes</a></li>
<li><a href="../fr470061/index.html">Comment √©crire moins de code et avoir plus de sens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>