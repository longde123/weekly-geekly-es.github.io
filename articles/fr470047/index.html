<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤽🏿 🙅🏻 🔫 J'ai regardé en arrière pour voir si elle avait regardé en arrière - 2 ou dans mon propre centre de données via AWS 💅🏽 🙀 🤤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous publions tous les services situés dans l'hyperviseur domestique via le service EC2 Amazon Web Services via une instance gratuite pour Amazon Linu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>J'ai regardé en arrière pour voir si elle avait regardé en arrière - 2 ou dans mon propre centre de données via AWS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470047/"><img src="https://habrastorage.org/webt/hb/3k/nj/hb3knjstg1kmyhx0g_bzk-r5jiu.jpeg" alt="image"><br><br>  Nous publions tous les services situés dans l'hyperviseur domestique via le service <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">EC2 Amazon Web Services</a> via une instance gratuite pour Amazon Linux AMI 2018 en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">libreswan</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xl2tpd</a> et avec un peu de distorsion ... <br><a name="habracut"></a><br>  Les administrateurs système d'une entreprise traditionnelle (non informatique) ayant de l'expérience, généralement après un certain temps, ont leur propre batterie de serveurs de virtualisation à la maison pour tester le tas de solutions sur le terrain.  Cela peut être une imitation banale d'un réseau de succursales réparties, le test d'une infrastructure intégrée de haute disponibilité, le déploiement de nouvelles versions de certaines solutions, etc. <br><br>  À l'extérieur, il peut passer d'un simple ordinateur domestique à mémoire de pompage avec un hyperviseur intégré et un NAS de qualité grand public comme stockage iSCSI (ou même comme une simple machine virtuelle sur le même PC) à des serveurs à montage en rack de petite taille à part entière achetés pour des unités de commande moins chères. avec un pedigree des centres de données occidentaux, avec la même BU tsiska pour la connectivité réseau et coincé dans le Fibre Channel même, acheté dans le NAS du marché secondaire, mais déjà une classe affaires. <br><br>  Bien sûr, à l'ère de l'engouement pour les nuages, toute l'infrastructure peut facilement être déployée dans des centres de données cloud, mais ce n'est toujours pas toujours possible, principalement en raison du coût.  Peu importe si les tests nécessitent plusieurs machines virtuelles légères à partir des plans disponibles, mais qu'en cas de service, vous devez tordre plusieurs dizaines voire des centaines de «machines virtuelles» distinctes avec une grande variété de services, et vous voulez également avoir une archive afin de pouvoir l'avoir à tout moment il y avait un échantillon qui s'est tordu dans les configurations / paramètres il y a un an.  Ou il est nécessaire de transférer tous les pièges avec la même synchronisation entre ADDS et ADFS avant de transférer certains des services commerciaux existants vers le même MS Azure. <br><br>  Le principal problème dans ce cas est la publication (transfert) de toute cette infrastructure vers l'extérieur, afin que vous puissiez vous entraîner à connecter des utilisateurs de l'extérieur à votre "site serveur" domestique ou à vos propres services "cloud", ou à l'intégration avec des services tiers, etc. <br><br>  C'est bien si la connexion domestique est conçue pour un tarif professionnel, dans ce cas il n'y a pas de problème avec les demandes entrantes, et l'adresse IP est presque toujours "blanche", statique. <br><br>  Mais que faire lorsque le prestataire «domicile» habituel est présent sur le lieu de résidence, qui en plus ne peut fournir qu'une adresse du réseau Privé.  Ou donnera-t-il une adresse blanche, mais coupe-t-il traditionnellement tous les entrants de la plage de ports privilégiés (&lt;1024)?  Ou vous êtes un pauvre étudiant ringard et ne pouvez tout simplement pas vous permettre un tarif mensuel conçu pour les personnes morales.  Ou devez-vous souvent changer de lieu de résidence, en faisant glisser les «effets personnels» de votre serveur virtuel vers la bosse?  Un cas spécial est également pertinent pour ceux qui vivent en dehors de la CEI, lorsque le fournisseur fournit de force son propre équipement pour se connecter à Internet et que vous ne pouvez tout simplement pas physiquement configurer la redirection des ports dont vous avez besoin vers la ferme virtuelle domestique à l'extérieur. <br><br>  Une solution consiste à utiliser l'un des services VPN tiers.  Malheureusement, peu d'entre eux autorisent les connexions entrantes par rapport au tunnel, le plus souvent c'est un service payant séparé.  Dans ce cas également, le choix des adresses IP externes sera très limité si vous souhaitez tester la situation avec la présence d'une adresse IP externe dans un pays particulier, en outre, en règle générale, il n'y a aucune garantie qu'en même temps, un certain nombre d'autres clients de services VPN ne s'accrochent pas à cette adresse , ou il restera statique pendant longtemps, ce qui est important pour la configuration des enregistrements de sous-domaine de service dans DNS. <br><br>  Il est également intéressant (à mon humble avis), bien que quelques méthodes perverties, soient de déployer votre propre routeur «virtuel» sur une plate-forme de cloud externe avec la possibilité de configurer un tunnel VPN de la ferme d'hyperviseur domestique vers cette machine virtuelle dans le cloud, avec les connexions entrantes nécessaires transmises à partir de l'interface réseau externe services de cloud to home hypervisor.  Et idéalement, pour ne rien payer pour le tout. <br><br>  Ayant récemment perdu mon emploi, et avec lui l'accès à une ferme de test d'entreprise chaleureuse et confortable, mais en retour, j'ai reçu beaucoup de temps libre pour mettre à jour mes compétences, j'ai décidé de donner aux services de mon hyperviseur à domicile la possibilité de voir les connexions client entrantes. <br><br>  L'auteur de ces lignes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"aime toutes sortes de perversions d'infrastructure"</a> , donc en tant que routeur virtuel, nous utiliserons l'instance gratuite Amazon Web Services (AWS) EC2 t2.micro pour Linux, qui au lieu d'AWS: VPC (en théorie) donnera un peu plus de flexibilité dans le débogage et les fonctionnalités , et la topologie de cette perversion VPN est présentée ci-dessous: <br><br><img src="https://habrastorage.org/webt/xs/o5/_k/xso5_kg5gwlm9ozy9pj7udiqxuc.png" alt="image"><br><br>  Que voyons-nous ici? <br><br>  Il existe une machine virtuelle (instance) gratuite (750 heures de travail par mois pendant l'année), sous Linux, déployée dans AWS: EC2.  Les appels entrants de certains utilisateurs de vos services à domicile tombent sur l'adresse IPv4 blanche externe d'Elastic IP, puis via les règles entrantes (entrantes) dans les «groupes de sécurité», les ports dont nous avons besoin sont mappés vers l'interface réseau de l'instance, puis les paquets de ces demandes via iptables passent par le tunnel IPSec pour une machine virtuelle pour Windows 2016, où, à l'aide du routage, RRAS accède au service souhaité dans la batterie de serveurs virtuelle domestique.  Nous accordons une attention particulière à la présence de trois NAT à la fois: un dans AWS Linux, un sur le routeur «réseau de bureau» et un autre, implicite, sur le routeur domestique. <br><br>  Dans ce (mon) cas, une machine virtuelle sous Windows Server 2016 joue le rôle d'un routeur pour simuler un réseau de bureau et sa plate-forme de serveur, MS WAP y est déployé en conjonction avec une machine distincte avec MS ADFS et autres, donc il n'y a aucun problème à la remplacer par un autre OS même une pièce maison au goût.  Avec Windows RRAS, en passant, les choses se compliquent en cours de route, tout au long du chemin, j'ai dû faire face à divers moments désagréables (dont ci-dessous), donc si vous choisissez de ne pas aimer MS Windows Server en tant que routeur, alors avec un autre système d'exploitation, cela peut être plus facile. <br><br>  Nous allons d'abord créer un compte AWS si vous n'en avez toujours pas.  Il n'y a aucun problème avec la création du compte lui-même, il vous suffit d'indiquer les détails de votre carte plastique, à partir de laquelle 1 USD sera débité (puis retourné) comme chèque. <br><br>  Seuls deux points doivent être mentionnés ici: <br><br><ol><li>  Assurez-vous d'accéder à AWS: IAM (gestion des identités et des accès) et activez MFA (authentification multifacteur) pour votre nouveau compte, ou mieux encore, comme le recommande AWS - créez également un compte distinct avec MFA et continuez à travailler en limitant les droits correspondants. elle.  Sinon, vous risquez de vous retrouver dans une situation désagréable lorsqu'un cheval de Troie vole les informations d'identification AWS de votre PC et, par exemple, quelqu'un mine le mien à vos frais sur des plans d'instance haute performance coûteux ... </li><li>  Pour des raisons pratiques, il est recommandé de configurer une alerte budgétaire.  Cela se fait dans les paramètres du compte, l'élément de menu correspondant est appelé «Tableau de bord de facturation et de gestion des coûts».  Dans le panneau qui s'ouvre, sélectionnez l'élément «Budgets» à gauche et configurez le budget mensuel prévu à votre goût à l'aide de l'assistant intégré.  N'oubliez pas d'y mettre en place une alerte: en cas de dépassement du montant spécifié, vous recevrez immédiatement un message.  Cela est utile si vous n'avez jamais travaillé avec AWS auparavant et que vous avez peur d'obtenir accidentellement une somme ronde au cours de vos expériences. </li></ol><br>  Ensuite, nous avons besoin d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS: EC2</a> . <br><br>  L'une des étapes les plus importantes consiste à sélectionner la région AWS (essentiellement un centre de données) dans laquelle nous voulons déployer notre machine virtuelle.  Le placement affectera directement l'emplacement géographique de votre «routeur virtuel», et donc le retard du réseau lorsque vous travaillez avec lui.  Ceci est important car  AWS ne fournit pas de migration en direct entre les régions (le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service de migration de serveur AWS</a> intégré ne peut migrer que quelque chose vers le cloud AWS lui-même) et en cas d'erreur de placement, il est plus facile de recréer une nouvelle instance à l'emplacement souhaité.  Sinon, vous devrez supprimer l'image de l'instance (Image, EC2 intégré) dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS: S3</a> (service de stockage) et à partir de là, tirer cette image dans l'instance EC2 dans la nouvelle région.  Dans mon cas, la région de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Francfort a</a> été initialement sélectionnée: <br><br><img src="https://habrastorage.org/webt/8c/2s/yh/8c2syhsrly1luamcwjsvbmlnbtg.png" alt="image"><br><br>  Nous créons une nouvelle instance, sélectionnez l'option <b>"Free tier only"</b> à gauche, ce qui limitera la liste d'images proposée aux seules images gratuites.  J'ai choisi <b>"Amazon Linux AMI 2018"</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus</a> sur les distributions Linux dans AWS), car  sur "Amazon Linux 2 AMI" xl2tpd ne fonctionne pas correctement en raison de la nature du noyau assemblé par Amazon. <br><br>  Vous pouvez choisir n'importe quelle autre image Linux que vous connaissez dans la liste fournie.  Vous pouvez également aller plus loin dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS Marketplace</a> et y chercher des images alternatives, lisez attentivement les commentaires sur le coût: l'image elle-même et les ressources informatiques peuvent être gratuites, mais vous devrez payer un supplément pour l'espace disque, etc. <br><br>  Nous sélectionnons le type proposé <b>«t2.micro»</b> , il fournit 1 vCPU, 1 Go de mémoire, 8-30 Go (SSD / magnétique) d'espace disque et 750 heures de travail gratuitement chaque mois pendant un an.  Assez pour notre «routeur virtuel».  Il convient de noter que l'espace disque et le temps de travail sont consacrés à toutes les instances, donc en cas de difficultés financières, vous n'avez pas besoin de les créer / exécuter plus que vous ne pouvez vous le permettre, sauf gratuitement. <br><br>  Cliquez dans l'assistant «Suivant ...», à la 3e étape, nous laissons toutes les valeurs par défaut, à la 4e, nous sommes d'accord avec les 8 gigaoctets de disque SSD par défaut proposés et l'instance commence avec le bouton Review and Launch: <br><br><img src="https://habrastorage.org/webt/ta/dv/of/tadvofw_fyn1iozzpgvxiwaswla.png"><br><br>  Après cela, nous aurons une fenêtre avec un message sur la création d'une nouvelle paire de clés pour se connecter à la nôtre via SSH et une proposition pour nommer cette paire et télécharger la clé privée au format * .pem.  Nous en aurons vraiment besoin à l'avenir, il est donc conseillé de le conserver immédiatement en lieu sûr.  Si ce fichier est perdu, vous perdrez la possibilité de vous connecter à distance aux instances l'utilisant.  Dans EC2, il n'y a aucun moyen de le régénérer à nouveau pour une instance existante, le seul moyen est de connecter le disque d'instance à une autre instance qui a accès et à la modification de clé ultérieure. <br><br>  Après un certain temps, l'instance sera lancée, elle aura une adresse IPv4 interne (privée) et externe (publique), ainsi que deux noms DNS correspondants. <br>  Configurez immédiatement les groupes de sécurité pour assurer le flux de trafic pour les services dont vous avez besoin: <br><br><img src="https://habrastorage.org/webt/ex/rh/7y/exrh7yxlnlqsb36u5pdqifxrdb8.png"><br><br>  Nous aurons besoin des ports entrants ouverts 500, 1701, 4500 UDP et 4500 TCP pour organiser le tunnel VPN IPSec L2TP, HTTP et HTTPS pour publier les services de la ferme de la maison, l'accès externe à l'instance via SSH a été créé automatiquement lors de la création de l'instance, car  EC2 ne contient essentiellement aucun accès intégré à la console de la machine virtuelle via son interface Web.  Il n'y a que la possibilité de visualiser l'écran: <br><br><img src="https://habrastorage.org/webt/zr/g4/uw/zrg4uw5t3_nihfjq8qaipfwxfkw.png"><br><br>  Il est conseillé de configurer l'accès via VPN et SSH uniquement à partir de votre adresse IP domestique.  L'ordre des règles dans les groupes de sécurité n'a pas d'importance. <br><br>  Étant donné que nous utiliserons plusieurs documentations NAT, AWS recommande de désactiver la <b>«vérification de la source / destination du réseau»</b> dans ce cas: <br><br><img src="https://habrastorage.org/webt/oa/6m/mg/oa6mmgeh6dyzg6sjxzdj0lkzbne.png"><br><br>  Étant donné que nous utiliserons le tunneling IPSec et non le transport, ce paramètre n'a pas beaucoup de sens pour nous, mais juste au cas où, il est préférable de le désactiver. <br><br>  Connectez-vous via SSH à notre instance.  Si vous utilisez un client graphique SSH, par exemple, PuTTY, pour vous connecter, l'aide intégrée sur la connexion, appelée par RMB sur l'instance -&gt; Connect, vous aidera: <br><br><img src="https://habrastorage.org/webt/dc/tm/s1/dctms1dbkmpble2n5vojwkdq3py.png"><br><br>  Amazon Linux conserve un pedigree de RHEL et CentOS, donc le gestionnaire de packages yum est utilisé. <br><br>  Toutes les opérations décrites ci-dessous doivent être effectuées avec une élévation de privilèges, nous les précédons donc avec sudo ou travaillons simplement en tant que root. <br><br>  Première mise à jour: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum update</span></span></code> </pre> <br>  En tant que logiciel pour organiser un serveur VPN, nous utiliserons une combinaison de libreswan et xl2tpd. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LibreSwan</a> (fork d'OpenSwan et un analogue de strongSwan) est une implémentation populaire de VPN IPSec et IKE (Internet Key Exchange).  Il peut contourner correctement différents types de NAT et leurs combinaisons, ce qui est particulièrement important lors de l'organisation du tunneling IPSec. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">xl2tpd est</a> également largement utilisé, son principal avantage est la capacité intégrée d'authentifier et de transmettre les paramètres de connexion client via ppp lors de la connexion (par exemple, adresses IP, paramètres de route par défaut, serveurs DNS, etc.), ce qui élimine la nécessité d'un déploiement DHCP et Radius supplémentaire pour notre tâches simples. <br><br>  Étant donné que xl2tpd n'est pas dans les référentiels Amazon Linux standard, nous devons activer EPEL (Extra Packages for Enterprise Linux): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum-config-manager --enable epel</span></span></code> </pre> <br><h3>  Installez les packages nécessaires: </h3><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum install libreswan xl2tpd -y</span></span></code> </pre> <br><h3>  Activer le routage au niveau du noyau: </h3><br>  dans le fichier <b>/etc/sysctl.conf on</b> écrit: <br><br><pre> <code class="bash hljs">net.ipv4.ip_forward = 1 net.ipv4.conf.all.accept_redirects = 0 net.ipv4.conf.all.secure_redirects = 1 net.ipv4.conf.all.send_redirects = 0 net.ipv4.conf.default.accept_redirects = 0 net.ipv4.conf.default.secure_redirects = 0 net.ipv4.conf.default.send_redirects = 0 net.ipv4.conf.lo.accept_redirects = 0 net.ipv4.conf.lo.secure_redirects = 0 net.ipv4.conf.lo.send_redirects = 0 net.ipv4.conf.eth0.accept_redirects = 0 net.ipv4.conf.eth0.secure_redirects = 0 net.ipv4.conf.eth0.send_redirects = 0 net.ipv4.conf.all.rp_filter = 0 net.ipv4.conf.default.rp_filter = 0 net.ipv4.conf.eth0.rp_filter = 0</code> </pre><br>  Désactivez <b>rp_filter</b> dans la session en cours pour ne pas redémarrer: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># for f in /proc/sys/net/ipv4/conf/*/rp_filter ; do # echo 0 &gt; $f # done</span></span></code> </pre><br>  Nous appliquons les paramètres et vérifions la disponibilité du routage: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sysctl -p /etc/sysctl.conf # cat /proc/sys/net/ipv4/ip_forward</span></span></code> </pre><br>  Nous devons assurer la transmission des paquets entrants (par rapport à l'interface publique de l'instance) des ports des services requis vers notre futur tunnel IPSec.  Pour cela, il faut non seulement dé-NAT ces paquets, mais aussi faire du masquage sur l'interface <b>ppp0</b> . <br>  Nous utiliserons pour cela les fonctionnalités <b>iptables</b> intégrées, qui dans le cas d'Amazon Linux sont initialement configurées pour autoriser complètement tout trafic dans n'importe quelle direction: <br><br>  faire DNAT des ports requis: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 80 -j DNAT --to-destination 10.100.0.2:80 # iptables -t nat -A PREROUTING -p tcp -i eth0 --dport 443 -j DNAT --to-destination 10.100.0.2:443</span></span></code> </pre> <br>  transmettre tous les paquets qui sont arrivés à ces ports à l'adresse de la porte Windows: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 80 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT # iptables -A FORWARD -p tcp -d 10.100.0.2 --dport 443 -m state --state NEW,ESTABLISHED,RELATED -j ACCEPT</span></span></code> </pre> <br>  faire du masquage pour ces packages: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE</span></span></code> </pre><br>  Il est conseillé de conserver les règles iptables afin qu'elles se resserrent automatiquement au redémarrage de l'instance: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># service iptables save</span></span></code> </pre> <br>  Dans ce cas, nous utilisons le DNAT (Destination NAT) du port TCP requis à partir de l'interface réseau eth0 de l'instance en direction de l'adresse IPv4 10.100.0.2, qui est l'adresse sur l'interface ppp du service RRAS de notre porte Windows dans l'hyperviseur domestique. <br><br>  Le point suivant est très important: puisque les services à l'intérieur de l'hyperviseur doivent pouvoir répondre aux demandes reçues de l'instance AWS, il est nécessaire de fournir un masquage (remplacement de l'adresse de l'expéditeur) sur l'interface <b>ppp0</b> de l'instance avant d'envoyer le paquet, sinon la réponse ira dans une direction complètement différente: de la porte Windows dans l'hyperviseur après le tunnel IPSec directement vers le routeur par défaut (routeur domestique), à ​​la suite de quoi, bien sûr, il sera supprimé du côté client du service, comme s'il provenait d'une ressource non sollicitée.  Si le masquage est utilisé dans l'en-tête du paquet à l'entrée du tunnel vpn, l'adresse de l'expéditeur passera de l'adresse quelque part sur Internet à l'adresse <b>ppp0 de l'</b> interface de l'instance AWS: EC2, c'est-à-dire  dans mon cas à 10.100.0.1 <br><br>  Au lieu d'utiliser iptables pour d'autres distributions Linux ou systèmes * NIX, vous pouvez recommander le bon vieux rinetd, où tout cela se fait généralement sur une seule ligne dans sa configuration <b>rinetd.conf</b> : <br><br><pre> <code class="bash hljs">&lt;ip <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;port <span class="hljs-built_in"><span class="hljs-built_in">source</span></span>&gt; &lt;ip destination&gt; &lt;port destination&gt;</code> </pre> <br>  La seule chose qui devra être activée dans ce cas dans le noyau est la possibilité de routage / trafic NAT. <br><br><h3>  Il est temps de cuisiner libreswan. </h3><br>  Le fichier <b>/etc/ipsec.conf</b> contient des instructions pour télécharger tous les fichiers .conf depuis /etc/ipsec.d/, par conséquent, nous créons un nouveau fichier de configuration dans le répertoire /etc/ipsec.d/aws_vpn.conf et nous y ajoutons: <br><br><pre> <code class="bash hljs">config setup <span class="hljs-comment"><span class="hljs-comment">#       # plutostderrlog=/var/log/pluto.log # logfile=/var/log/pluto.log # plutodebug = all #  NAT-T -   NAT- nat_traversal=yes oe=off protostack=netkey nhelpers=0 interfaces=%defaultroute conn aws_vpn type=tunnel auto=start forceencaps=yes pfs=no fragmentation=yes authby=secret left=%defaultroute #   &lt;…&gt;      Elastic IP leftid=&lt;…&gt; #   &lt;…&gt;     (172...) leftsubnet=&lt;…&gt;/32 leftnexthop=%defaultroute leftprotoport=17/1701 rightprotoport=17/%any right=%any rightsubnetwithin=0.0.0.0/0 rightsubnet=vhost:%priv</span></span></code> </pre><br>  Pour plus de simplicité, nous utiliserons l'authentification IPSec basée sur une clé partagée (PSK), et non sur des certificats, nous devons donc la spécifier explicitement.  Le fichier <b>/etc/ipsec.secrets</b> contient des instructions pour télécharger tous les fichiers .secrets de <b>/etc/ipsec.d/</b> , là nous créons un nouveau fichier <b>/etc/ipsec.d/aws_vpn.secrets</b> et <b>spécifions</b> le PSK dans le format: <br><br><pre> <code class="bash hljs">&lt;     172...&gt; %any : PSK <span class="hljs-string"><span class="hljs-string">"&lt; PSK&gt;"</span></span></code> </pre> <br>  A titre d'exemple: <br><br><pre> <code class="bash hljs">172.31.20.120 %any : PSK <span class="hljs-string"><span class="hljs-string">"Pa$</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$w0rd</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Étant donné que la connexion ppp sera utilisée à l'intérieur du tunnel IPSec et qu'il existe sa propre authentification, nous la configurons également: <br>  Nous entrons le nom d'utilisateur et le mot de passe dans le fichier <b>/ etc / ppp / chap-secrets</b> au format: <br><br><pre> <code class="bash hljs">&lt;user&gt; * &lt;password&gt; *</code> </pre> <br>  A titre d'exemple: <br><br><pre> <code class="bash hljs">aws_user * Pa$<span class="hljs-variable"><span class="hljs-variable">$w0rd</span></span> *</code> </pre> <br>  Lors de la connexion au client ppp, il est possible de passer un certain nombre d'options pour configurer l'interface réseau et la table de routage de sa part. <br><br>  Dans le fichier <b>/etc/ppp/options.xl2tpd</b> , définissez ces options: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  xl2tpd  ip   ipcp-accept-local ipcp-accept-remote #    defaultroute   Windows-    nodefaultroute noccp auth #   RRAS  Windows-  mschap-v2   require-mschap-v2 #   MTU  MRU mtu 1410 mru 1410 lock</span></span></code> </pre><br>  Parce que  nous n'avons pas besoin de transmettre les adresses DNS, victoires, etc. au client.  choses - toutes les autres options doivent être commentées. <br><br>  Ici, vous avez besoin d'une explication de la configuration. <br><br>  Le comportement standard pour les connexions VPN consiste à installer une nouvelle route par défaut dans la table client, ce qui force tout le trafic de celle-ci vers Internet à «passer» par le serveur VPN.  Dans notre cas, c'est faux, car  l'objectif de la porte Windows est de fournir un accès simulé à Internet du réseau de bureaux virtuels derrière lui dans l'hyperviseur et de publier les ressources des services internes vers l'extérieur via AWS: EC2, il est donc irrationnel de diriger tout le trafic via l'instance vers AWS: EC2.  C'est pourquoi vous devez empêcher une connexion VPN dans RRAS de modifier l'itinéraire par défaut (vers un routeur domestique). <br><br>  Il est également important de choisir les valeurs MTU et MRU correctes: nous utilisons le tunneling IPSec et une taille de charge utile trop grande peut ne pas correspondre à la limite d'encapsulation, ce qui entraînera une fragmentation et très probablement une erreur.  S'il apparaît, essayez tout d'abord de réduire ces valeurs, par exemple, à 1280. Les valeurs indiquées dans la configuration donnée sont compatibles avec le client VPN Windows. <br><br><h3>  Reste à configurer xl2tpd </h3><br>  Nous configurons tout ce qui est nécessaire dans le fichier de configuration xl2tpd <b>/etc/xl2tpd/xl2tpd.conf</b> : <br><br><pre> <code class="bash hljs">[global] port=1701 ipsec saref = yes ; ,      ;debug tunnel = yes ;debug avp = yes ;debug network = yes ;debug state = yes ;debug tunnel = yes [lns default] name = AWSvpnServer ;       ppp ip range = 10.100.0.2-10.100.0.2 ;    ppp0 AWS:EC2  <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> ip = 10.100.0.1 require authentication = yes require chap = yes refuse pap = yes pppoptfile = /etc/ppp/options.xl2tpd length bit = yes</code> </pre><br><h3>  Nous vérifions tout ce que nous avons fait </h3><br>  Nous essayons d'exécuter les deux services et vérifions les configurations: <br><br><pre> <code class="bash hljs">service ipsec start service xl2tpd start ipsec verify</code> </pre><br>  Les services sont peut-être déjà en cours d'exécution, auquel cas ils sont simplement redémarrés. <br><br>  Si tout va bien, la sortie de ipsec verify devrait être similaire à la capture d'écran: <br><br><img src="https://habrastorage.org/webt/o1/rv/br/o1rvbrchcizb6jn9qewgrj_hrn4.png"><br><br>  Vous pouvez déboguer xl2tpd de manière interactive en l'exécutant avec le commutateur -D et en le suspendant dans une «fenêtre» distincte du terminal SSH à l'aide de l'utilitaire <b>screen</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># xl2tpd -D</span></span></code> </pre> <br>  Dans ce cas, le processus xl2tpd ne passera pas en arrière-plan, mais affichera toutes ses activités sur l'écran du terminal. <br><br>  En cas de problème, vous devez décommenter les options de débogage dans les configurations (voir les commentaires) et consulter le contenu des journaux système et du fichier <b>/var/log/pluto.log</b> .  Il convient également de prêter attention au contenu de l' <b>option virtual_private / virtual-private</b> dans le fichier <b>/etc/ipsec.conf</b> , il répertorie tous les réseaux privés disponibles pour l'échange de données via IPSec.  Si, pour une raison quelconque, vous avez votre propre adressage, par exemple, vous utilisez votre propre pool d'adresses IPv4 blanches, vous devez apporter des modifications à ce paramètre. <br><br><h3>  Passons à la dernière étape - configurer le service RRAS dans la porte Windows et vérifier la publication des services à partir d'Internet </h3><br>  Il est supposé que votre hyperviseur domestique dispose d'une machine virtuelle exécutant Windows 2012R2 ou plus récente, déployée en mode graphique (bureau), et il y a deux adaptateurs réseau dans cette machine virtuelle: l'un "regarde" dans le réseau domestique et a un routeur domestique comme route par défaut et l'autre dans un réseau de «bureaux» local virtuel, dans lequel des services sont publiés à l'extérieur.  Un domaine Windows est facultatif, à moins bien sûr que les services eux-mêmes ne l'exigent. <br><br>  Nous installons tous les rôles nécessaires à l'aide du Gestionnaire de serveur ou à l'aide de l'applet de commande PowerShell <b>Install-WindowsFeature</b> : <br><br><img src="https://habrastorage.org/webt/lv/vw/ul/lvvwull1qus2dpgplvaxfvjv_gq.png"><img src="https://habrastorage.org/webt/pc/ag/80/pcag80h9dc8jq6gtim8jbdoeseq.png"><br><br>  Ici, je démontre l'installation de rôles via des graphiques, car il sera alors beaucoup plus pratique d'appeler l'assistant de configuration à partir du Gestionnaire de serveur et de configurer le service RRAS lui-même dans le calendrier, ce qui nous plaira avec la bonne vieille interface de l'époque de Windows Server 2003: <br><br><img src="https://habrastorage.org/webt/ai/rx/hz/airxhzrmjcbvyopop4rt_rcu4ga.png"><br><br>  Cliquez sur RMB sur votre serveur, sélectionnez <b>«Configurer et activer le routage et l'accès distant»</b> , puis configurez manuellement: <br><br><img src="https://habrastorage.org/webt/na/gj/bc/nagjbch0d6jxmyjzgywhnqqe17s.png"><br><br>  N'hésitez pas à sélectionner tous les choucas, à terminer l'assistant et à démarrer le service: <br><br><img src="https://habrastorage.org/webt/ku/ir/sq/kuirsqjvnmskwfjrikybcl2kacu.png"><br><br>  Tout d'abord, libérons notre réseau local virtuel à l'extérieur.  Nous allons à IPv4-&gt; NAT et créons une nouvelle interface, comme l'interface existante sur laquelle NAT sera implémenté, sélectionnez l'interface externe (qui regarde sur Internet, ou plutôt dans votre réseau domestique), marquez-la comme publique et activez NAT dessus: <br><br><img src="https://habrastorage.org/webt/gk/zh/lx/gkzhlxjyvjsgkhdnfvaqyhcn3xo.png"><img src="https://habrastorage.org/webt/kw/wx/xw/kwwxxw5u1gtezu2moo-3beokuli.png"><br><br>  Nous vérifions comment le trafic du LAN virtuel sort par notre portail.  Nous n'avons pas encore besoin de configurer le pare-feu Windows. <br><br>  Si tout va bien, nous allons enfin créer ce pour quoi nous nous battions, une connexion VPN à notre instance AWS et vérifier la publication de nos services.  Nous allons dans le composant logiciel enfichable RRAS à <b>«Interfaces réseau»</b> et créons une nouvelle interface de numérotation à la demande avec un nom arbitraire: <br><br><img src="https://habrastorage.org/webt/-v/04/yx/-v04yxa-najhry2evwovvtydsby.png"><br><br>  Sélectionnez immédiatement la connexion L2TP, afin que notre nouvelle interface n'essaie pas automatiquement de déterminer le type de VPN et, par conséquent, qu'elle se connecte plus rapidement: <br><br><img src="https://habrastorage.org/webt/jg/mw/xb/jgmwxbg1nzbih2grilgopxrlfv8.png"><br><br>  Plus loin dans l'assistant, nous indiquons l'adresse publique de notre cloud (dans mon cas, Elastic IP).  Dans les étapes suivantes, laissez tout tel quel, car  nous n'avons pas besoin d'une connexion de site à site: <br><br><img src="https://habrastorage.org/webt/fa/fn/p7/fafnp7fmggqxnbmosjcpdkx1wck.png"><img src="https://habrastorage.org/webt/d1/zc/wm/d1zcwmsgomejupu7if4ynp2rqjk.png"><br><br>  Spécifiez le compte utilisateur sous lequel nous avons configuré la connexion ppp (dans le fichier <b>/ etc / ppp / chap-secrets</b> ).  Aucun nom de domaine n'est requis: <br><br><img src="https://habrastorage.org/webt/zc/to/ei/zctoei91of_eyji6fncqhgvcii4.png"><br><br>  L'assistant crée une nouvelle connexion.  Reste maintenant à le configurer.  Nous allons ajuster le délai d'inactivité (Idle-time), supprimer le CHAP obsolète au profit de MS-CHAPv2 uniquement, spécifier la clé PSK dans les «Propriétés avancées» (celle qui a été définie pour xl2tpd dans le fichier /etc/ipsec.d/aws_vpn. secrets) et supprimez IPv6: <br><br><img src="https://habrastorage.org/webt/a0/qf/tf/a0qftfatglil4qkjv-hyn5hzvlc.png"><img src="https://habrastorage.org/webt/ax/hy/hu/axhyhuwgchr9z2vhmel17jjbx1s.png"><img src="https://habrastorage.org/webt/vq/xl/qz/vqxlqzejzpi3rs0i9x0r5ol9fkg.png"><img src="https://habrastorage.org/webt/km/ro/um/kmroumh0brc2_yq3przzb-a7jm8.png"><br><br>  Après avoir créé une nouvelle interface, vous devez également entrer dans les propriétés du service RRAS lui-même, activer votre stratégie IPSec pour L2TP et spécifier votre PSK.  Il leur est demandé de redémarrer le service RRAS. <br><br><img src="https://habrastorage.org/webt/h8/0w/zk/h80wzkz1pfymizhrqruvwrgj9di.png"><br><br>  Il semblerait que tout peut être soulevé en toute sécurité une nouvelle interface et profiter du travail.  Mais non.  Étant donné que nous avons utilisé NAT du côté de l'instance AWS: EC2, le client VPN Windows ne pourra pas se connecter à un tel nœud Nat-Traversal.  Cela est vrai à la fois pour les versions client (jusqu'à la dernière au moment de la rédaction de cet article de la version Windows 10) et pour les serveurs. <br><br>  Heureusement, il existe une solution officielle à ce problème sous la forme de modifications dans le registre des paramètres du service de stratégie IPSec suivies d'un redémarrage: <br><br>  À <br>  <b>HKEY_LOCAL_MACHINE \ SYSTEM \ CurrentControlSet \ Services \ PolicyAgent</b> <br>  créer une clé DWORD (32 bits) <br>  <b>SupposonsUDPEncapsulationContextOnSendRule = 2</b> <br>  et redémarrez notre Windows Gate. <br><br>  Le service RRAS est malheureusement célèbre pour son caractère capricieux dans la configuration et le fonctionnement, et même après un redémarrage, il effectue un démarrage différé.  Vous pouvez donc vous précipiter après un redémarrage. <br>  Si tout est fait correctement, la connexion fonctionnera dans les 5 à 10 secondes. <br><br>  Reste à faire la publication des ressources nécessaires sur le portail Windows lui-même. <br><br>  Pour le test nous travaillerons sur la publication du serveur web.  Tout d'abord, consultez notre tunnel IPSec et les règles iptables. <br><br>  Avec des mains tremblantes, nous vérifions à partir d'un PC arbitraire connecté à Internet: <br><br><img src="https://habrastorage.org/webt/ho/yg/c-/hoygc-blrya-dt30hytsmdruezg.png"><img src="https://habrastorage.org/webt/8v/yc/q7/8vycq7c2bsc6dqjcc3t7qzcacje.png"><br><br>  Wow, ça marche ... <br><br>  Lors de l'installation des rôles nécessaires, le MS IIS «natif» a été installé de force, mais nous le voulons encore plus facilement.  Pour cela, sur une plateforme Windows, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>HFS</b></a> (HTTP File Server) est bien adapté - il est gratuit, ne nécessite pas d'installation, donne une page spécifique et un en-tête HTTP, peut fonctionner sur un port arbitraire (par défaut c'est 8080, donc dans notre cas il faudra reconfigurer en 80), et écrit également immédiatement dans sa console d'où provient la connexion, ce qui est très pratique pour déboguer la publication de nombreuses ressources Web sur la plate-forme Windows.  Pour l'utiliser, vous devez d'abord arrêter le site MS IIS afin de délier le serveur intégré du port requis.  Étant donné que nous ne voulons pas installer la console de gestion MS IIS (en fait, la console MS IIS 6 sera présente pour des raisons de compatibilité, mais IIS 7+ ne peut pas être contrôlé via elle), nous le ferons via PowerShell: <br><br><pre> <code class="bash hljs">Stop-WebSite -Name <span class="hljs-string"><span class="hljs-string">"Default Web Site"</span></span></code> </pre> <br>  ou simplement via l'utilitaire de gestion iisreset: <br><br><pre> <code class="bash hljs">iisreset /stop</code> </pre> <br>  Après cela, vous devez autoriser le trafic entrant vers le port 80 dans le pare-feu Windows intégré. <br>  Nous démarrons HFS et vérifions: <br><br><img src="https://habrastorage.org/webt/ti/u2/bc/tiu2bcpm3ynhzteryfe9njxvfq4.png"><br><br>  Tout est super.  Nous avons réalisé que de n'importe où sur Internet, vous pouvez voir le serveur Web qui vit dans notre maison comme une machine virtuelle dans un hyperviseur arbitraire. <br><br>  La touche finale: nous apprenons à RRAS à transmettre toutes ces demandes de l'extérieur vers le réseau du bureau virtuel, où, selon la légende, nous avons un autre serveur Web. <br><br>  Pour ce faire, nous allons à nouveau dans le composant logiciel enfichable de gestion RRAS dans IPv4-&gt; NAT et RMB sur notre interface VPN, où nous sélectionnons l'onglet <b>«Services et ports»</b> , le marquons dans la liste des serveurs Web et spécifions le serveur Web dans le réseau virtuel interne dont nous voulons publier les ressources. internet: <br><br><img src="https://habrastorage.org/webt/d7/bq/jv/d7bqjv0ir3a2l8w4vzxpdax8nra.png"><br><br>  Cliquez sur OK et ... tout est prêt.  Nous vérifions - tout devrait bien fonctionner. <br><br>  D'une manière si simple, vous pouvez publier rapidement presque tous les services et ressources, des sites, des serveurs de messagerie à certaines intégrations complexes.  Naturellement, pour la plupart d'entre eux, vous aurez besoin d'avoir votre propre domaine DNS avec la possibilité de créer des sous-domaines et de modifier les enregistrements nécessaires.  Il est également conseillé d'utiliser des certificats SSL pour publier des ressources Web, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">grâce à LetsEncrypt</a> et à des services similaires compatibles ACME, tout cela peut être fait entièrement gratuitement et avec une mise à jour automatique. <br><br>  Lorsque vous redémarrez l'instance, l'adresse IPv4 publique ne change pas - uniquement lorsqu'elle est arrêtée, mais il est toujours recommandé d'utiliser une adresse IPv4 statique dans AWS: EC2.  Statique dans le sens où lorsque vous désactivez votre instance, elle lui reste affectée et ne tombe pas dans le pool libre général.  Bien sûr, cela est nécessaire pour ne pas s'embêter à chaque fois avec la reconfiguration des enregistrements DNS dans les domaines, et personne n'a annulé TTL avec mise en cache.  Cela coûte beaucoup d'argent et s'appelle, comme déjà mentionné ci-dessus, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Elastic IP</a> . <br><br><h3>  Automatisation primitive des processus </h3><br>  Enfin, je veux mentionner une autre grande fonctionnalité d'AWS: EC2 - configuration rapide de l'instance déployable.  Il existe de nombreuses options de déploiement rapide dans AWS: EC2, jusqu'à des services spéciaux (et plutôt complexes, mais très puissants), mais il y a la plus simple: à l'étape 3 de l'assistant de création d'une nouvelle instance en bas se trouve le champ <b>"Données utilisateur"</b> .  Vous pouvez y placer un script en bash ou même PowerShell (dans le cas d'une instance pour Windows), et ce script sera exécuté automatiquement immédiatement après la création de l'instance. <br>  C'est-à-dire  vous pouvez légèrement modifier toutes les commandes et configurations ci-dessus pour créer votre propre script bash et l'utiliser pour augmenter rapidement un tel routeur AWS: EC2 virtuel.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En savoir plus sur cette fonctionnalité</a> . <br><br>  Merci d'avoir pris le temps de lire cet article. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470047/">https://habr.com/ru/post/fr470047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470033/index.html">F # 2: Environnement FSI</a></li>
<li><a href="../fr470035/index.html">Générateur délirant: créez des textes dans n'importe quelle langue à l'aide d'un réseau de neurones</a></li>
<li><a href="../fr470037/index.html">F # 3: Formatage du texte</a></li>
<li><a href="../fr470043/index.html">La science derrière comment notre cerveau fonctionne le mieux et comment la technologie et notre environnement peuvent aider</a></li>
<li><a href="../fr470045/index.html">Visual Studio pour Mac: principales fonctionnalités du nouvel éditeur</a></li>
<li><a href="../fr470049/index.html">Présentation de la gestion des packages NuGet au niveau de la solution dans Visual Studio pour Mac</a></li>
<li><a href="../fr470051/index.html">Neurosciences: quand notre cerveau fonctionne le mieux et comment la technologie peut l'aider</a></li>
<li><a href="../fr470055/index.html">Présentation de la gestion des packages NuGet au niveau de la solution dans Visual Studio pour Mac</a></li>
<li><a href="../fr470057/index.html">Visual Studio pour Mac: 5 nouvelles fonctionnalités intéressantes</a></li>
<li><a href="../fr470061/index.html">Comment écrire moins de code et avoir plus de sens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>