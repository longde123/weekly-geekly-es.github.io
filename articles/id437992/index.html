<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤›ğŸ» â™Šï¸ ğŸ––ğŸ¿ Layanan microser. Versi dalam Integrasi dan Penerapan Sistem Berkelanjutan Studi Kasus CI / CD Menggunakan TFS ğŸ’ ğŸ…ğŸ½ ğŸ§’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Masalah 
 Untuk proyek-proyek besar dan kompleks secara teknis, di mana, sebagai suatu peraturan, banyak tim terdistribusi bekerja secara bersamaan, a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Layanan microser. Versi dalam Integrasi dan Penerapan Sistem Berkelanjutan Studi Kasus CI / CD Menggunakan TFS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437992/"><h4>  Masalah </h4><br>  Untuk proyek-proyek besar dan kompleks secara teknis, di mana, sebagai suatu peraturan, banyak tim terdistribusi bekerja secara bersamaan, ada masalah yang terkenal dari perangkat lunak versi sedang dikembangkan, yang diselesaikan oleh perusahaan yang berbeda secara berbeda. <a name="habracut"></a><br><br>  Saat ini, sejumlah klien dan mitra kami mengirimkan rilis terbaru (CI / CD) ke Production secara manual dengan menginstal versi terbaru / terkini dari perangkat lunak mereka, setelah sebelumnya mengujinya dengan seluruh lingkungan.  Misalnya, dengan memasok aplikasi iOS, Android, dll. Jika kita berbicara tentang perangkat lunak klien, atau dengan memperbarui gambar buruh pelabuhan di lingkungan buruh pelabuhan jika kita berbicara tentang backend.  Untuk proyek besar dan penting di mana keputusan untuk merilis versi baru dalam Produksi setiap kali dibuat oleh Manajer Proyek, keputusan seperti itu dibenarkan dan tidak terlalu mahal, terutama jika rilis tidak sering dirilis.  Namun, untuk lingkungan pengembangan pengujian (lingkungan Dev / Stage), penggunaan alat "manual" mengarah pada kompleksitas proyek, kemungkinan gangguan tayangan kepada Pelanggan, dan sebagainya.  Mungkin ada banyak alasan untuk ini, termasuk ketidakkonsistenan dalam versi berbagai wadah pada perangkat lunak middleware atau tidak adanya riwayat terperinci tentang rilis. <br><br>  Kami harus memastikan ini secara pribadi dan mengalami banyak kesulitan pada proyek besar, di mana 6-8 versi baru perangkat lunak di backend dan 2-3 versi perangkat lunak di frontend dalam sistem CI dirilis setiap hari, di mana para insinyur pengujian tidak dapat secara objektif mengatasi beban dan selalu ada kekurangan pemahaman tentang versi perangkat lunak pada frontend / backend yang dianggap stabil saat ini. <br><br><h4>  Pengalaman kami </h4><br>  Perusahaan kami menggunakan berbagai sistem CI / CD dalam pekerjaannya, pilihan yang sering ditentukan oleh persyaratan Pelanggan.  Misalnya, spesialis kami sering menemukan sistem CI / CD seperti Jenkins, TeamCity, Travis CI, Circle CI, Gitlab CI, Atlassian Bamboo, di mana kadang-kadang kami bekerja sepenuhnya pada infrastruktur pelanggan.  Dengan demikian, dengan pendekatan ini, masalah dengan solusi versi sepenuhnya ada pada Pelanggan. <br><br>  Ketika mengembangkan solusi untuk pelanggan, ketika kami memiliki kesempatan untuk melakukan ini pada infrastruktur kami sendiri, kami menggunakan TFS versi 2018 sebagai dasar untuk sistem Continuous Integration / Continuous Delivery. Ini memungkinkan kami untuk menyelesaikan tugas utama menciptakan siklus pengembangan perangkat lunak yang lengkap, yaitu: <br><br><ul><li>  Pernyataan tugas (Masalah, Bug, Tugas) berdasarkan pendekatan pengembangan perangkat lunak yang digunakan dalam proyek saat ini; </li><li>  Penyimpanan kode sumber proyek; </li><li>  Penyebaran infrastruktur build-agent untuk majelis untuk OS yang berbeda (Windows, Linux, MacOS); </li><li>  Merakit proyek dalam mode "manual" dan CI; </li><li>  Penempatan proyek dalam mode "manual" dan CD; </li><li>  Proyek pengujian; </li><li>  Pembentukan data mengenai waktu yang dihabiskan oleh karyawan pada proyek dan sejumlah fungsi tambahan yang kami terapkan menggunakan TFS Extensions dari desain kami sendiri dan dengan menambahkan statika ke WIT (dalam formulir ini, TFS menggantikan Redmine perusahaan kami dan menyederhanakan pengumpulan statistik, laporan, dll., Dalam konteks proyek) ) </li></ul><br>  Dalam hal ini, akan logis untuk memberikan solusi untuk masalah versi ke TFS, menyelesaikan fungsionalitas TFS untuk tugas-tugas kami dan keinginan Pelanggan.  Akibatnya, tugas membangun sistem versi untuk proyek arsitektur layanan mikro diselesaikan oleh alat TFS dengan menyesuaikan berbagai skrip pembuatan dan mengatur lingkungan uji / rilis. <br><br><h4>  Solusinya: menggunakan TFS dan alat pihak ketiga </h4><br>  Jadi, kita membutuhkan sistem versi untuk proyek arsitektur microservice untuk mengatur lingkungan pengujian dan rilis. <br><br>  Sebagai data awal kami memiliki: <br><br><ul><li>  Orkestrasi - kami menggunakan gerombolan buruh pelabuhan terutama untuk mengurangi penggunaan alat pihak ketiga lainnya.  Pada saat yang sama, ada konverter untuk mengonversi konfigurasi - misalnya, utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kompose</a> , yang akan memungkinkan Anda untuk menggunakan Kubernetes jika perlu. </li><li>  Build agents - VM berdasarkan pada server Linux. </li><li>  Sumber repositori - Git berbasis TFS. </li><li>  Penyimpanan gambar - register buruh pelabuhan di VM. </li></ul><br><h4>  Untuk pertanyaan tentang nama build </h4><br><ul><li>  Adalah logis untuk menggunakan standar penamaan yang ada, misalnya, seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spesifikasi Versi Semantik</a> . </li><li>  Kami mengikuti nama ini ketika memulai proses pembuatan versi rilis secara manual, karena jika tidak, Anda tidak akan bisa mendapatkan nama yang benar secara otomatis (kecuali Anda memasukkannya ke dalam kode secara manual, yang lagi-lagi hanya memiliki sedikit kaitan dengan ideologi CI). </li><li>  Dalam mode CI untuk versi perangkat lunak "debug" kami menggunakan nama-nama berikut pada proyek yang berbeda: <br><br><ol><li>  Ekstensi TFS bawaan </li><li>  Penomoran berdasarkan tanggal saat ini dan nomor build pada hari itu; </li><li>  Jumlah komit yang memulai pembangunan. </li></ol></li></ul><br>  Solusi spesifik, misalnya, dapat dilihat berdasarkan contoh layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kalkulator</a> , dibuat dalam Javascript, dan beberapa proyek yang tersedia untuk umum. <br><br><h4>  Algoritma keputusan </h4><br>  <b>1.</b> Di TFS2018, buat proyek yang disebut SibEDGE Semver dan impor repositori ke repositori lokal <br><br><img src="https://habrastorage.org/webt/3n/9l/xi/3n9lxiufbqej7sscqofb3el3q58.jpeg" alt="gambar"><br>  <i>Gambar 1 - proyek SibEDGE Semver di repositori di TFS 2018</i> <br><br>  <b>2.</b> Buat file Dockerfile dengan deskripsi assembly node.js untuk kebutuhan kita ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> ). <br><br><pre><code class="plaintext hljs">FROM node:7 WORKDIR /usr/src/app COPY package.json app.js LICENSE /usr/src/app/ COPY lib /usr/src/app/lib/ LABEL license MIT COPY tests tests ENV NODE_ENV dev RUN npm config set strict-ssl false RUN npm update &amp;&amp; \ npm install -g mocha CMD ["mocha", "tests/test.js", "--reporter", "spec"]</code> </pre> <br><h4>  Script 1 - Dockerfile untuk membangun bangunan </h4><br>  <b>3.</b> Di bangku tes (dengan docker terpasang), tempat kami berencana untuk menyebarkan lingkungan kami, buat gugus segerombolan.  Dalam kasus kami, ini akan terdiri dari satu server. <br><br><pre> <code class="plaintext hljs">$ docker swarm init</code> </pre> <br>  <b>4.</b> Buat file-yml dengan deskripsi layanan microser untuk kebutuhan kita ( <a href="">tautan</a> ). <br>  Perhatikan bahwa <code>vm-docker-registry.development.com:5000</code> adalah repositori internal untuk proyek ini, yang kami persiapkan sebelumnya.  Agar tempat pengujian dapat menggunakan repositori ini, perlu mendaftarkan sertifikat ssl pada dudukan di /etc/docker/certs.d/ &lt;repositori name&gt; /ca.crt folder <br><br><pre> <code class="plaintext hljs">version: '3.6' services: #--- # Portainer for manage Docker #--- portainer: image: portainer/portainer:1.15.3 command: --templates http://templates/templates.json -d /data -H unix:///var/run/docker.sock networks: - semver-network ports: - 9000:9000 volumes: - /var/run/docker.sock:/var/run/docker.sock #--- #----Service Calculator Test# #--- semver-calc: image: vm-docker-registry.development.com:5000/calculator:latest networks: - semver-network #--- #----Pminder - Nginx# #--- nginx: image: nginx:1.9.6 depends_on: - mysql ports: - "8888:80" - "6443:443" networks: - semver-network # #----------------------------- # START NoSQL - Redis. #--- redis: image: redis:4.0 networks: - semver-network ports: - "8379:6379" # # END NoSQL - Redis. #--- #----Pminder - DB# #--- mysql: image: mysql:5.7 ports: - "3306:3306" environment: MYSQL_ROOT_PASSWORD: 'ODdsX0xcN5A9a6q' MYSQL_DATABASE: 'semver' MYSQL_USER: 'user' MYSQL_PASSWORD: 'uXcgTQS8XUm1RzR' networks: - semver-network #--- #----PhpMyAdmin # #--- phpmyadmin: image: phpmyadmin/phpmyadmin depends_on: - mysql environment: PMA_HOST: 'mysql' PMA_USER: 'user' PMA_PASSWORD: 'uXcgTQS8XUm1RzR' ports: - "8500:80" - "8600:9000" networks: - semver-network #--- networks: semver-network:</code> </pre><br><h4>  Script 2 adalah isi dari file semver.yml, yang merupakan file proyek docker-compose. </h4><br>  <b>5.</b> Buat deskripsi build di TFS2018 (Build Definition). <br><br>  <b>6.</b> Tindakan pertama dari skrip kami adalah membangun gambar kontainer buruh pelabuhan: <br><br><img src="https://habrastorage.org/webt/ot/u2/hc/otu2hcqbokm6jsqq2xvrgdyo7ma.jpeg" alt="gambar"><br>  <i>Gambar 2 - Membangun gambar untuk bangunan kami di TFS 2018</i> <br><br>  <b>7.</b> Kirim gambar wadah buruh pelabuhan yang dibuat pada mesin build ke repositori internal untuk proyek ini: <br><br><img src="https://habrastorage.org/webt/c5/z0/-i/c5z0-irkolgl5vtvd_ljjmp4hte.jpeg" alt="gambar"><br>  <i>Gambar 3 - Menyimpan buruh pelabuhan-gambar untuk perakitan kami di repositori TFS 2018</i> <br><br>  <b>8.</b> Untuk seluruh lingkungan di bangku tes dalam file deskripsi layanan microsoft, ubah nama gambar ke yang baru: <br><br><img src="https://habrastorage.org/webt/va/vs/-z/vavs-zlakgyiujowaaclrddgzd4.jpeg" alt="gambar"><br>  <i>Gambar 4 - Mengganti nama gambar dalam skrip build untuk build kami di TFS 2018</i> <br><br>  <b>9.</b> Di bangku tes, salin gambar wadah buruh pelabuhan yang dibuat dari repositori internal dan perbarui layanan di kerumunan buruh pelabuhan: <br><br><img src="https://habrastorage.org/webt/rc/gl/vq/rcglvqmsxim1iedm2ieq25_i_pq.jpeg" alt="gambar"><br>  <i>Gambar 5 - Menyebarkan container docker dengan skrip build untuk build kami dari gambar di TFS 2018</i> <br><br>  Akibatnya, ketika kami keluar ke repositori TFS, kami memiliki file yml dengan versi rilis gambar buruh pelabuhan, yang pada gilirannya memiliki nama rilis untuk seluruh proyek. <br><br>  <b>10.</b> Mari kita pergi ke bangku tes dan memeriksa pekerjaan layanan dan memastikan bahwa layanan Kalkulator telah diperbarui dan menggunakan versi baru perakitan. <br><br><pre> <code class="plaintext hljs">$ docker service ls</code> </pre> <br><br><img src="https://habrastorage.org/webt/mj/tq/kh/mjtqkhpjmndkwu-gnac7rc_jteo.jpeg" alt="gambar"><br>  <i>Gambar 6 - Memperbarui layanan Kalkulator dan memeriksa versinya saat ini di bangku tes kami</i> <br><br>  Dengan demikian, dalam penyimpanan gambar registri docker kami, kami memiliki serangkaian gambar dari berbagai versi layanan microser (dalam kasus khusus ini, versi hanya satu layanan microser diubah).  Dengan meluncurkan proses penyebaran terpisah (melalui skrip yang mengubah file deskripsi yml), kapan saja Anda bisa mendapatkan lingkungan yang Anda butuhkan untuk pengujian di bangku tes dan mentransfer konfigurasi ini ke divisi QA.  Setelah pengujian (regresi, memuat dll.) Kami mendapatkan informasi bahwa layanan microser dari versi tertentu bekerja secara stabil di bangku tes dengan versi rilis layanan microser lainnya dari versi ini dan itu, dan keputusan akhir telah dibuat tentang apa yang dapat atau tidak diperbarui dudukan rilis ke versi baru. <br><br><h4>  Ringkasan - apa yang Anda dapatkan di pintu keluar </h4><br>  Berkat penerapan versi dalam proyek-proyek dengan arsitektur microservice, hasil berikut tercapai: <br><br><ul><li>  jumlah kekacauan dalam versi telah menurun; </li><li>  kecepatan penyebaran lingkungan baru dalam proyek telah meningkat; </li><li>  kualitas majelis telah meningkat dan tingkat kesalahan di dalamnya telah menurun; </li><li>  peningkatan transparansi pengembangan untuk Manajer Proyek dan Pelanggan; </li><li>  interaksi antar departemen telah meningkat; </li><li>  Ada arahan baru dalam karya DevOps. </li></ul><br>  <b>PS</b> Terima kasih kepada kolega saya Kirill B. untuk membantu saya menulis artikel ini. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id437992/">https://habr.com/ru/post/id437992/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id437982/index.html">Serangan enkripsi baru Shade menargetkan pengguna bisnis Rusia</a></li>
<li><a href="../id437984/index.html">Threading di Node.js: module worker_threads</a></li>
<li><a href="../id437986/index.html">Mengapa TypeScript adalah jantung dari setiap aplikasi web PayPal baru?</a></li>
<li><a href="../id437988/index.html">React Tutorial, Bagian 12: Workshop, Aplikasi TODO Tahap 3</a></li>
<li><a href="../id437990/index.html">Bereaksi Tutorial Bagian 13: Komponen Berbasis Kelas</a></li>
<li><a href="../id437994/index.html">Pemerah susu otomatis dan rumah kaca otomatis: cara kerja pertanian teknologi tinggi kecil</a></li>
<li><a href="../id437996/index.html">SITIS CTF: bagaimana seal membantu CTF menang</a></li>
<li><a href="../id437998/index.html">Filsuf makan "modern" di C ++ melalui aktor dan CSP</a></li>
<li><a href="../id438000/index.html">Keberhasilan dan kegagalan dalam membuat proyek Anda (startup)</a></li>
<li><a href="../id438002/index.html">Konfigurasikan proxy terbalik untuk Nextcloud dan ONLYOFFICE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>