<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>☝🏿 🏂🏾 🤟🏿 具有I2C总线的Arduino操作员面板（HMI） ⛓️ 🌅 ⛹🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="作为使用某些与arduino兼容的设备（最后是关于它的部分）的一部分，我需要一个带有按钮的屏幕来控制和显示当前信息。 也就是说，需要操作员面板，它也是HMI。 

 决定独立制作HMI，并使用“方形” i2c总线作为接口。 



 如果您对此类设备的开发和编程过程感兴趣，欢迎联系cat。 

 特...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>具有I2C总线的Arduino操作员面板（HMI）</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401587/"> 作为使用某些与arduino兼容的设备（最后是关于它的部分）的一部分，我需要一个带有按钮的屏幕来控制和显示当前信息。 也就是说，需要操作员面板，它也是HMI。 <br><br> 决定独立制作HMI，并使用“方形” i2c总线作为接口。 <br><br><img src="https://habrastorage.org/files/3e6/4e6/24e/3e64e624ed5741d9a37eea535359c671.jpg"><br><br> 如果您对此类设备的开发和编程过程感兴趣，欢迎联系cat。 <br><a name="habracut"></a><br> 特点 <br><br><ul><li> 显示1602，单色16x2字符 </li><li>  5个按钮：向上，向下，取消，输入，编辑 </li><li>  I2c接口 </li><li>  DB9F连接器 </li><li> 尺寸155x90x44毫米 </li></ul><br> 有明显的问题： <br><br><div class="spoiler">  <b class="spoiler_title">为什么不买现成的盾牌呢？</b> <div class="spoiler_text"> 当然，也可以用显示屏和键盘从同一中文购买现成的盾牌，例如： <br><img src="https://habrastorage.org/files/c7b/06a/03d/c7b06a03dff44d12bf25dddc779b2a82.jpg"><br> 您可以在此屏蔽层上焊接2条FC-113围巾，其功能与我的屏蔽层相同：带i2c键盘的显示器。 套装的价格从$ 4。 <br><br> 但是在此板上，按钮的尺寸不适合我，但我希望大型按钮能够安装多色盖。 我不想使用普通的DB9F连接器将Arduino连接到HMI，但是有必要制作一个连接板。 在这种情况下，制作一两个板有什么区别？ 此外，我已经有几台1602显示器库存，因此我只需要花费1.02美元就可以在Aliexpress上购买FC-113（0.55美元）和PCF8574P端口扩展器（0.47美元）。 <br><br> 好吧，最重要的是，如果您要处理的是Arduino，那么为他独立制造屏蔽罩是理所当然的，对吗？ <br></div></div><br><div class="spoiler">  <b class="spoiler_title">为什么使用i2c总线，直接连接按钮是否更容易？</b> <div class="spoiler_text"> 在我工作的工业控制系统领域，HMI使用数字数据传输接口RS-232，RS-485，CAN等与设备进行通信。 因此，对于我而言，我自己的HMI <i>都</i>可以在数据接口（在本例中为i2c）上工作，这是合乎逻辑的。 <br><br> 如果我制造了一种显示器可以在方形总线上工作的设备，并且按钮直接进入了Arduino的输入，那会让我感到非常不满意。 正如我将要呈现的这张图片：一条单独的电线从面板伸出到接口，分开的电线接到输入，brrrr ... <br><br> 此外，直接进入Arduino输入的按钮板与具有i2c接口的按钮板之间的区别仅在于PCF8574P芯片（0.47美元），一个电容器和两个电阻器。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">为什么按钮排列成这样而不是其他？</b> <div class="spoiler_text"> 从左到右的按钮具有以下功能：上，下，取消，输入，编辑。 <br> 将“编辑”按钮从其他按钮移开一点，以强调其功能-更改逻辑参数的值（打开/关闭），或在数字参数的情况下切换到编辑模式。 <br><br> 尽管键盘上的芯片最多可以连接8个部件，但总共有5个按钮。 <br> 使用四个按钮就足够了，并且功能不会受到影响-“输入”和“编辑”可以组合在一个按钮中。 但是，我只是感到遗憾，端口扩展器微电路的8条支路中有一半没有参与。 <br> 如果我决定在一行中显示多个参数，则另一个单独的“编辑”按钮可能很有用。 然后，使用此按钮可以在参数之间切换，以指示需要更改的参数。 这就是流行的中文HMI OP320中“ SET”按钮的工作方式。 <br><br> 如果前两个按钮是向上和向下的意思，那么为什么不将它们垂直放置，例如在上面的中国盾牌中那样呢？ <br><br> 就我个人而言，将所有按钮都水平放置会更方便，然后在操作过程中手指只能在一个平面上移动。 <br></div></div><br><h4>  <b>铁</b> </h4><br><img src="https://habrastorage.org/files/fdf/110/dee/fdf110deea844523baaf7fed5e5d7f67.jpg"><br><br><img src="https://habrastorage.org/files/d2e/39d/084/d2e39d0848924a5b9d2d3e1e8952462c.jpg"><br><br>  1.带有DB9F连接器的自制底板。 因此，当我们为Arduino的端口和显示扩展器使用+ 5V电源时，我在板上放置了0.1 A保险丝 <br><br>  2.众所周知，众所周知的1602显示器带有FC-113焊接板，可将显示器连接到i2c总线。 <br><br>  3.带有PCF8574P芯片的自制键盘板，它将读取按钮的状态并通过i2c总线进行传输。 顺便说一句，FC-113“显示”板也基于PCF8574芯片，仅具有T索引，即 平面，而不是DIP，例如PCF8574P。 <br><br> 我在按钮上放了12h12mm的方形按钮；可以在上面戴上彩色的大号帽。 <br><br><div class="spoiler">  <b class="spoiler_title">自制电路板的照片和方案</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d9a/41d/043/d9a41d0435244acc995795055522501c.jpg"><br><br><img src="https://habrastorage.org/files/a8a/faa/a15/a8afaaa15f16482a8eac22c8a99f5db2.jpg"><br><br><img src="https://habrastorage.org/files/693/76e/475/69376e475bc4455da8658553b0edbd1c.jpg"><br></div></div><br> 值得一提的是PCF8574P芯片，我以此为基础制作了键盘板。 <br>  PCF8574P是i2c端口扩展器。 共有8个端口，每个端口都可以配置为输入或输出。 对于该芯片，不需要这样的捆扎（例如，请记住max232），以防万一我放了一个电容器来供电。 <br><br>  PCF8574P芯片的地址使用地址引脚A0，A1，A2进行设置，这些地址引脚通过10kΩ电阻拉至地面或电源。 <br><br> 在键盘板上，我将PCF8574P的所有地址腿都放在了地上，因此该地址被硬编码为0x20，并且您无法更改。 <br><br> 正如我已经写过的，我选择DB9F作为HMI的连接器。  Arduino从+5 V，GND，SDA，SCL接收信号。 <br><br><img src="https://habrastorage.org/files/b9b/46d/b11/b9b46db117ea4418acc54be7f35db069.jpg"><br><br> 通过Arduino i2c和HMI进行通信的导线长1.4 m，工作时无毛刺。 <br><br> 我在Sprint Layout 6中绘制了木板，并使用LUT方法将其转移到了Textolite上，并在过氧化物和柠檬酸溶液中对其进行蚀刻。 <br><br><div class="spoiler">  <b class="spoiler_title">关于腌制的一些知识</b> <div class="spoiler_text"> 在铝箔玻璃纤维上蚀刻柠檬酸板有很多方法。 <br><br> 我配制了这种溶液：100毫升3％的过氧化氢，50克柠檬酸，3茶匙盐。 他用水将锅中的过氧化物罐加热到约70度。 <br><br> 根据过氧化物蚀刻的建议，我们将电路板浸入溶液中，使图案朝下。 <br> 几十秒后，一个风暴开始。 释放出大量蒸汽，不建议吸入。 大概吧 <br><br><img src="https://habrastorage.org/files/54a/f92/248/54af9224862547c1a6e41f57d73c0794.jpg"><br><br> 然后该过程消退。 翻转板。 <br><br><img src="https://habrastorage.org/files/e84/801/c1a/e84801c1a7bc43e998f586b8241b202a.jpg"><br><br> 做完了 <br><br><img src="https://habrastorage.org/files/101/9ec/44e/1019ec44edc945559d4f6b02514077c5.jpg"><br></div></div><br> 该盒子是由4毫米有机玻璃的朋友用激光切割机制成的。 <br><br><div class="spoiler">  <b class="spoiler_title">关于兵团的抒情离题</b> <div class="spoiler_text"> 买完箱子还是自己做？ 经过一番思考，我决定自己做。 我在销售中看到的那些由于价格或美学原因而不适合我，或者在DIN导轨上也不适合我。 <br><br> 最初，尸体想从胶合板上切下。 但是后来我想起了我有一个很好的朋友，并且令我高兴的是一家体育颁奖公司的董事。 他在那里拥有各种机器，包括激光切割机。 <br><br> 他寻求帮助，一个朋友没有拒绝，用激光切割了几分钟后，零件被拒绝了。 <br><br> 借此机会，我要说谢谢，科里亚！ 否则，我将不得不整天切割和研磨胶合板，其结果将不会如此出色。 </div></div><br><h4>  <b>程式设计</b> </h4><br> 从Arduino的角度来看，此HMI由在i2c总线上工作的2个设备组成：地址为0x27的显示器（LCD）和地址为0x20的键盘。 因此，Arduino将分别与键盘和LCD配合使用。 <br><br> 通过专用库“ LiquidCrystal_I2C.h”进行LCD的操作，必须将其安装在Aduino IDE中。 <br><br> 键盘的操作通过标准的Wire.h库完成，该库最初在Aduino IDE中可用。 <br><br> 我们将HMI连接到Ardiuno。 <br><br><img src="https://habrastorage.org/files/cd7/c58/0c1/cd7c580c192e4cac95a2eda6d5cd8756.jpg"><br><br>  1.首先，检查Arduino是否看到我们的HMI。 为此，将程序加载到其中，该程序将扫描i2c总线上的设备。 <br><br><div class="spoiler">  <b class="spoiler_title">草图1，I2C总线扫描</b> <div class="spoiler_text"><pre><code class="hljs pgsql">//i2c_scaner #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; String stringOne; <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!<span class="hljs-type"><span class="hljs-type">Serial</span></span>); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { byte error, address; <span class="hljs-type"><span class="hljs-type">int</span></span> nDevices; <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("Scanning..."); nDevices = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(address = <span class="hljs-number"><span class="hljs-number">1</span></span>; address &lt; <span class="hljs-number"><span class="hljs-number">127</span></span>; address++ ) { Wire.beginTransmission(address); error = Wire.endTransmission(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error == <span class="hljs-number"><span class="hljs-number">0</span></span>) { String stringOne = String(address, HEX); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0x"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(stringOne); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print(" - "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="0F") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Motor Driver'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="1E") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'HMC5883 3-Axis Digital Compass'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5C") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BH1750FVI digital Light Sensor' OR 'Touch Sensor" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="5D") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'Touch Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="20") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter' "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="21") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="22") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="23") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'BH1750FVI digital Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="24") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="25") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="26") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="27") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'PCF8574 8-Bit I/O Expander' OR 'LCM1602 LCD Adapter '"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="39") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'TSL2561 Ambient Light Sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="40") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor'" ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="48") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="49") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit' OR 'SPI-to-UART'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="4B") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADS1115 Module 16-Bit'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="50") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'AT24C32 EEPROM'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="53") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'ADXL345 Input 3-Axis Digital Accelerometer'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="68") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'DS3231 real-time clock' OR 'MPU-9250 Nine axis sensor module'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="7A") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="76") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="77") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'BMP180 barometric pressure sensor' OR 'BMP280 barometric pressure sensor'"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(stringOne=="78") <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("'LCD OLED 128x64'" ); nDevices++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error==<span class="hljs-number"><span class="hljs-number">4</span></span>) { <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("Unknow error at address 0x"); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (address&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.print("0"); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println(address,HEX); } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nDevices == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("No I2C devices found\n"); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">Serial</span></span>.println("done\n"); delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>); }</code> </pre> <br></div></div><br> 在执行此程序期间，Arduino将i2c总线的扫描结果写入串行端口。 要查看此数据，请转到Arduino IDE工具-&gt;端口监视器。 <br><br><img src="https://habrastorage.org/files/cb1/fe9/19c/cb1fe919c65f484bb7d431cae64e87ec.jpg"><br><br> 我们看到i2c总线上的Arduino识别了两个地址为0x20和0x27的设备，分别是键盘和LCD。 <br><br>  2.现在，让我们看看键盘的工作原理。 创建一个程序，该程序将轮询按钮的状态并将其显示在LCD上。 <br><br><div class="spoiler">  <b class="spoiler_title">草图2，显示按钮的状态</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     i2c LCD    FC-113,  0x27      PCF8574P,  0x20 */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;Wire.h&gt; #define led <span class="hljs-number"><span class="hljs-number">13</span></span> #define ADDR_KBRD <span class="hljs-number"><span class="hljs-number">0x20</span></span> #define ADDR_LCD <span class="hljs-number"><span class="hljs-number">0x27</span></span> byte dio_in; <span class="hljs-type"><span class="hljs-type">bool</span></span> b; <span class="hljs-type"><span class="hljs-type">bool</span></span> key[<span class="hljs-number"><span class="hljs-number">5</span></span>]; LiquidCrystal_I2C lcd(ADDR_LCD,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(led, OUTPUT); // lcd.init(); lcd.backlight();//    // Wire.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(); Wire.beginTransmission(ADDR_KBRD); Wire.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(B11111111); //   PCF8574P     Wire.endTransmission(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { Wire.requestFrom(ADDR_KBRD,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!Wire.available()); byte dio_in = Wire.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>(); //   PCF8574P() //      byte mask=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>;i++) { key[i]=!(dio_in &amp; mask); mask=mask&lt;&lt;<span class="hljs-number"><span class="hljs-number">1</span></span>; } b=!b; digitalWrite(led, b); //    //    LCD lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(key[<span class="hljs-number"><span class="hljs-number">0</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">1</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">2</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">3</span></span>])+" "+ String(key[<span class="hljs-number"><span class="hljs-number">4</span></span>])+" "); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>); }</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/450/92f/cf3/45092fcf30ff4986bacf1bf3891ff58e.jpg"><br><br> 键盘正在工作。 <br><br>  3.最后，您可以继续进行所有操作；在Arduino中创建一个多级菜单。 通过菜单，我们不仅可以观看信息，还可以控制Arduino本人的输出。 <br><br><img src="https://habrastorage.org/files/570/c95/a3b/570c95a3b830423e827c7ac3b68605bf.jpg"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/xBZAx9ewLq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br> 在nete中，有很多有关在C ++中创建多级菜单的信息，但是对于Arduino，我什至看到了一些库。 但是我决定在程序中自己编写菜单。 首先，项目中剩余的图书馆越少越安静。 其次，这很简单。 <br><br> 我得到了树形菜单的另一种变化。 该菜单允许您同时在每一行中显示静态文本和变量值。 例如，您可以显示参数的名称及其值。 <br><br> 为了在屏幕上显示变量，我应用了标记的原理-以某种方式在文本中设计了文本标签，而不是在屏幕上显示文本时显示值。 <br><br> 可以通过按“编辑”按钮来更改参数。 此外，每个参数的标签指示它是否可用于编辑或只读。 如果当前参数是只读的，则在行的开头，指针将为“ *”；如果启用了编辑，则指针将变为“ +”。 <br><br><div class="spoiler">  <b class="spoiler_title">草图3，多层菜单</b> <div class="spoiler_text"><pre> <code class="hljs markdown">/<span class="hljs-bullet"><span class="hljs-bullet">*  ,    LCD   i2c LCD    FC-113,  0x27      PCF8574P,  0x20 *</span></span>/ #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">LiquidCrystal_I2C.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Wire.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> #define led 13 //    ;  ,  ,     #define ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD 0x20 #define ADDR_</span></span>LCD 0x27 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2 2 #define PORT_</span></span>D3 3 #define PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4 4 #define POINT_</span></span>ON<span class="hljs-emphasis"><span class="hljs-emphasis">_ROOT_</span></span>MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM 0 // 0/1= /   (*  +)     byte dio_</span></span>in; bool b; byte i; //bool ,      bool BoolVal[<span class="hljs-string"><span class="hljs-string">9</span></span>]={0,0,0, 0,0,0, 0,0,0}; #define ValSvet1 BoolVal[<span class="hljs-string"><span class="hljs-string">0</span></span>] #define ValSvet2 BoolVal[<span class="hljs-string"><span class="hljs-string">1</span></span>] #define ValSvet3 BoolVal[<span class="hljs-string"><span class="hljs-string">2</span></span>] #define ValRozetka1 BoolVal[<span class="hljs-string"><span class="hljs-string">3</span></span>] #define ValRozetka2 BoolVal[<span class="hljs-string"><span class="hljs-string">4</span></span>] #define ValRozetka3 BoolVal[<span class="hljs-string"><span class="hljs-string">5</span></span>] #define ValClapan1 BoolVal[<span class="hljs-string"><span class="hljs-string">6</span></span>] #define ValClapan2 BoolVal[<span class="hljs-string"><span class="hljs-string">7</span></span>] #define ValClapan3 BoolVal[<span class="hljs-string"><span class="hljs-string">8</span></span>] // struct STRUCT<span class="hljs-emphasis"><span class="hljs-emphasis">_KEY{ bool StateCur; //   bool StateOld; //     bool Imp; //   (  0  1) }; // STRUCT_</span></span>KEY Key[<span class="hljs-string"><span class="hljs-string">5</span></span>]={0,0,0, 0,0,0, 0,0,0, 0,0,0, 0,0,0 }; //--- /<span class="hljs-emphasis"><span class="hljs-emphasis">*   *</span></span>  , : <span class="hljs-bullet"><span class="hljs-bullet">* '#A1' bool ,  *</span></span> '#'-   bool, <span class="hljs-bullet"><span class="hljs-bullet">* 'A'- (HEX)    BoolVal, *</span></span> '1'-    <span class="hljs-bullet"><span class="hljs-bullet">*   ,       *</span></span>/ String StrNull=" "; //  String StrRoot1="COMP-MAN.INFO"; String StrRoot2="PLC-BLOG.COM.UA"; String StrSvet= ""; // String StrSvet1=" 1 #01"; String StrSvet2=" 2 #10"; String StrSvet3=" 3 #21"; String StrRozetka=""; // String StrRozetka1=" 1 #30"; String StrRozetka2=" 2 #40"; String StrRozetka3=" 3 #50"; String StrClapan=""; // String StrClapan1=" 1 #60"; // String StrClapan2=" 2 #70"; String StrClapan3=" 3 #80"; struct MENU<span class="hljs-emphasis"><span class="hljs-emphasis">_ITEM // (),   2        { byte KeyUp; //№  ,     "" byte KeyDwn; //№  ,     "" byte KeyCancel; //№  ,     ""(cancel) byte KeyEnter; //№  ,     ""(enter) byte KeyEdit; // "edit",  String *pstr1; //    () String *pstr2; //    () }; // MENU_</span></span>ITEM Menu[<span class="hljs-string"></span><span class="hljs-string"></span>]={0,0,0,1,0, &amp;StrRoot1,&amp;StrRoot2, //0   1,8,0,2,0, &amp;StrSvet,&amp;StrRozetka, //1  2,3,1,2,0, &amp;StrSvet1,&amp;StrSvet2, //2 2,4,1,3,0, &amp;StrSvet2,&amp;StrSvet3, //3 3,4,1,4,0, &amp;StrSvet3,&amp;StrNull, //4 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //5  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //6 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //7 1,15,0,9,0, &amp;StrRozetka,&amp;StrClapan, //8  9,10,8,9,0, &amp;StrRozetka1, &amp;StrRozetka2, //9 9,11,8,10,0, &amp;StrRozetka2, &amp;StrRozetka3, //10 10,11,8,11,0, &amp;StrRozetka3, &amp;StrNull, //11 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //12  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //13 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //14 8,15,0,16,0, &amp;StrClapan, &amp;StrNull, //15  16,17,15,0,0, &amp;StrClapan1,&amp;StrClapan2, //16 16,18,15,0,0, &amp;StrClapan2,&amp;StrClapan3, //17 17,18,15,0,0, &amp;StrClapan3,&amp;StrNull, //18 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //19  0,0,0,0,0, &amp;StrNull,&amp;StrNull, //20 0,0,0,0,0, &amp;StrNull,&amp;StrNull, //21 }; byte PosMenu=0; //  LiquidCrystal<span class="hljs-emphasis"><span class="hljs-emphasis">_I2C lcd(ADDR_</span></span>LCD,16,2); //   //   void ReadKey(byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in) { //      byte mask=1; for(i=0; i&lt;5; i++) { Key[i].StateCur=!(dio_</span></span>in &amp; mask); mask=mask<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">!Key[i].StateOld</span></span></span></span><span class="xml"><span class="hljs-tag"> &amp; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateCur</span></span></span></span><span class="xml"><span class="hljs-tag">; //   (  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.StateOld</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">Key[i].StateCur;</span></span></span></span><span class="xml"><span class="hljs-tag"> } } /* *  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">UTF-8</span></span></span></span><span class="xml"><span class="hljs-tag">   ( )   </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">LCD</span></span></span></span><span class="xml"><span class="hljs-tag"> *       */ </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span><span class="xml"><span class="hljs-tag">]= </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">144</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x41</span></span></span></span><span class="xml"><span class="hljs-tag">, // </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">145</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">146</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x42</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">147</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">148</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">149</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x45</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">129</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">150</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa3</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">151</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">152</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa5</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">153</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa6</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">154</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4b</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">155</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa7</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">156</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4d</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">157</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x48</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">158</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x4f</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">159</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa8</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">160</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x50</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">161</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x43</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">162</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x54</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">163</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xa9</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">164</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaa</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">165</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0x58</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">166</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe1</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">167</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xab</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">168</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xac</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">169</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xe2</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">170</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xad</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">171</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xae</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">172</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xc4</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">173</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xaf</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">174</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb0</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">175</span></span></span></span><span class="xml"><span class="hljs-tag">, </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0xb1</span></span></span></span><span class="xml"><span class="hljs-tag"> // }; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">RusStrLCD</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrIn</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">String</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.length();</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">byte</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">l</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">128</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(b1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">else</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208)</span></span></span></span><span class="xml"><span class="hljs-tag"> //==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">208,</span></span></span></span><span class="xml"><span class="hljs-tag">     </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">2-</span></span></span></span><span class="xml"><span class="hljs-tag">  </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span></span><span class="xml"><span class="hljs-tag">  { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">b1</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrIn.charAt(i+1);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">33</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">MasRus</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">y</span></span></span></span><span class="xml"><span class="hljs-tag">][</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span><span class="xml"><span class="hljs-tag">]==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">b1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">StrOut+char(MasRus[y][1]);</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">break</span></span></span></span><span class="xml"><span class="hljs-tag">; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++; } } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">StrOut</span></span></span></span><span class="xml"><span class="hljs-tag">; } //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---------------------------</span></span></span></span><span class="xml"><span class="hljs-tag"> //</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ASCII</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">HEX</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">---</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> dec byte StrHexToByte(char val) { byte dec=0; switch (val) { case '0': dec=0; break; case '1': dec=1; break; case '2': dec=2; break; case '3': dec=3; break; case '4': dec=4; break; case '5': dec=5; break; case '6': dec=6; break; case '7': dec=7; break; case '8': dec=8; break; case '9': dec=9; break; case 'A': dec=10; break; case 'B': dec=11; break; case 'C': dec=12; break; case 'D': dec=13; break; case 'E': dec=14; break; case 'F': dec=15; break; default: dec=0; break; } return dec; } //     void WriteLCD(byte num) { String str[]={"<span class="hljs-emphasis"><span class="hljs-emphasis">*"+*</span></span>Menu[num].pstr1,<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[num].pstr2}; if (num==0 &amp;&amp; POINT_ON_ROOT_MENU_ITEM==0) //     ? str[0].setCharAt(0,' '); // ,   //     byte NumVal; byte l; for(byte y=0; y&lt;2; y++) { l=str[y].length(); for(i=0; i&lt;l; i++) { if (str[y].charAt(i)=='#') //# bool,  off/ON { if(StrHexToByte(str[y].charAt(i+2))==1 &amp;&amp; y==0) //  ? str[y].setCharAt(0,'+'); NumVal=StrHexToByte(str[y].charAt(i+1)); str[y]=str[y].substring(0,i)+String(NumVal) ; if(BoolVal[NumVal]==0) str[y]=str[y].substring(0,i)+"off" ; if(BoolVal[NumVal]==1) str[y]=str[y].substring(0,i)+"ON" ; } if (str[y].charAt(i)=='$') //$ int,     ,      { ; } if (str[y].charAt(i)=='~') //~ ,     ,      { ; } } } //--- lcd.clear(); lcd.setCursor(0, 0); lcd.print(str[0]); lcd.setCursor(1, 1); lcd.print(str[1]); } //,       byte GoMenu(byte key) { byte PosMenuNew=PosMenu; switch (key) { case 0: PosMenuNew=Menu[PosMenu].KeyUp; break; case 1: PosMenuNew=Menu[PosMenu].KeyDwn; break; case 2: PosMenuNew=Menu[PosMenu].KeyCancel; break; case 3: PosMenuNew=Menu[PosMenu].KeyEnter; break; case 4: ; break; default: break; } return PosMenuNew; } //    "Edit" void Edit(byte posmenu) { byte NumVal; bool *</span></span>pval; String str=<span class="hljs-emphasis"><span class="hljs-emphasis">*Menu[posmenu].pstr1; byte l=str.length(); for(i=0; i&lt;l; i++) if (str.charAt(i)=='#') //#- bool,  off/ON { if(StrHexToByte(str.charAt(i+2))==1) //  ? { pval= &amp;(BoolVal[StrHexToByte(str.charAt(i+1))]); // ,    .   *</span></span>pval=!(*pval); //     } } } //     void ValToPort() { digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D2,ValSvet1); digitalWrite(PORT_</span></span>D3,ValSvet2); digitalWrite(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D4,ValSvet3); } void setup() { pinMode(led, OUTPUT); //     pinMode(PORT_</span></span>D2, OUTPUT); pinMode(PORT<span class="hljs-emphasis"><span class="hljs-emphasis">_D3, OUTPUT); pinMode(PORT_</span></span>D4, OUTPUT); //    LCD StrSvet=RusStrLCD(StrSvet); StrSvet1=RusStrLCD(StrSvet1); StrSvet2=RusStrLCD(StrSvet2); StrSvet3=RusStrLCD(StrSvet3); StrRozetka=RusStrLCD(StrRozetka); StrRozetka1=RusStrLCD(StrRozetka1); StrRozetka2=RusStrLCD(StrRozetka2); StrRozetka3=RusStrLCD(StrRozetka3); StrClapan=RusStrLCD(StrClapan); StrClapan1=RusStrLCD(StrClapan1); StrClapan2=RusStrLCD(StrClapan2); StrClapan3=RusStrLCD(StrClapan3); // lcd.init(); lcd.backlight();//    WriteLCD(PosMenu); Wire.begin(); Wire.beginTransmission(ADDR<span class="hljs-emphasis"><span class="hljs-emphasis">_KBRD); Wire.write(B11111111); //   PCF8574P     Wire.endTransmission(); } void loop() { Wire.requestFrom(ADDR_</span></span>KBRD,1); while (!Wire.available()); byte dio<span class="hljs-emphasis"><span class="hljs-emphasis">_in = Wire.read(); //   PCF8574P() ReadKey(dio_</span></span>in); //   //,    ;  ,      int KeyImp=-1; for (i=0; i<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">5;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">++) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag">(</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">1)</span></span></span></span><span class="xml"><span class="hljs-tag"> { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">i;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Key</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">]</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">.Imp</span></span></span></span><span class="xml"><span class="hljs-tag">==</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">if</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">KeyImp</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>-1) //  ? { if (KeyImp==4) // "Edit" Edit(PosMenu); PosMenu=GoMenu((KeyImp)); WriteLCD(PosMenu); } b=!b; digitalWrite(led, b); //    ValToPort(); //  delay(50); }</code> </pre><br></div></div><br><h4>  <b>LCD 1602和语言问题</b> </h4><br> 另外，有必要提出俄罗斯化问题。 <br><br> 在某些LCD 1602的字符生成器中，没有俄文字母，而是用日文krakozyabry代替了。 无法刷新字符发生器。 因此，您将不得不在屏幕上用拉丁字母写单词，或者在程序中自己编写俄语字母，因为  LCD 1602能够在RAM RAM中创建并存储您自己的字符。 但是，在后一种情况下，您一次只能在屏幕上显示八个“自制”字符。 <br><br><div class="spoiler">  <b class="spoiler_title">字符表LCD 1602</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/91b/eed/92f/91beed92f6f0487f922c3f9834ae9a8f.png"><br><br><img src="https://habrastorage.org/files/ecf/799/4a5/ecf7994a50584faba9805df1550d6157.png"><br></div></div><br> 原则上，可以在液晶显示屏上用英语写俄语单词。 在那里，即使是久负盛名的法国公司施耐德电气公司（甚至在革命之前就曾向沙皇出售榴弹炮的公司）都无法将俄国人引入其著名的Zelio可编程继电器。 但这并不能阻止他们在独联体的广阔区域中积极交易。 此外，还引入了运河，西班牙文和葡萄牙文。 <br><br> 在我们的许多工厂中，这些Zelio用诸如“ NASOS 1 VKL”之类的短语与员工进行沟通。 <br><br> 当不清楚特定的LCD中是否有俄语字母时，您需要在屏幕上显示其字符发生器的所有字符。 如果有西里尔字母，则从位置160开始。 <br><br><div class="spoiler">  <b class="spoiler_title">草图4，显示LCD 1602字符生成器表中的所有字符</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*   LCD     * LCD    i2c */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;LiquidCrystal_I2C.h&gt; LiquidCrystal_I2C lcd(<span class="hljs-number"><span class="hljs-number">0x27</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>); //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { // put your setup code here, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> run once: lcd.init(); lcd.clear(); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-type"><span class="hljs-type">int</span></span> i,y; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">16</span></span>; i++) { lcd.clear(); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); lcd.print(String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>)+" - "+String(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+<span class="hljs-number"><span class="hljs-number">15</span></span>)); lcd.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>;y&lt;<span class="hljs-number"><span class="hljs-number">16</span></span>;y++) lcd.print(<span class="hljs-type"><span class="hljs-type">char</span></span>(i*<span class="hljs-number"><span class="hljs-number">16</span></span>+y)); delay(<span class="hljs-number"><span class="hljs-number">3000</span></span>); } } }</code> </pre><br></div></div><br> 但是，即使您的LCD 1602生锈了，显示俄语单词也不是那么简单。 至少在i2c总线上使用LCD时，请使用LiquidCrystal_I2C.h库。 <br><br> 例如，如果仅使用指令lcd.print（“ Hello !!!”）输出俄语文本，则代替“ Hello !!!” 屏幕上会出现一些垃圾。 <br><br> 这是因为Arduino IDE将俄语字母转换为两字节的UTF-8代码，而在LCD中，所有字符均为单字节。 <br><br> 顺便说一句，当将俄语文本从Arduino传输到Arduino IDE端口监视器时，也会观察到相同的问题。  Arduino将UTF-8双字节编码的俄语字母发送到串行端口，而Arduino IDE端口监视器尝试以单字节Windows-1251编码（cp1251）读取它们。 尽管cp1251也是8位的，但与LCD 1602编码一样，它也不匹配。 <br><br> 您可以通过字符代码形成俄语文本。 例如，Russified LCD上的“ LCD display”行将显示为： <br><br><pre> <code class="hljs swift">lcd.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\243K \343\270c\276\273e\271"</span></span>);</code> </pre> <br> 但是我不喜欢这种方法。 <br><br> 为了在Russified LCD 1602上正确显示俄语文本，为Arduino发明了几个库。 但是在阅读评论后，我发现许多人抱怨使用它们时出现了故障。 <br><br> 因此，我自己在多级菜单程序中编写了一个简单的函数，用于将UTF-8转换为LCD代码。 没错，我只用大写的俄语字母做过，非常适合我。 <br><br><div class="spoiler">  <b class="spoiler_title">用于将UTF-8大写俄语字母转换为单字节LCD 1602代码的功能</b> <div class="spoiler_text"><pre> <code class="hljs powershell">/* *  UTF<span class="hljs-literal"><span class="hljs-literal">-8</span></span>   ( )   LCD *       */ byte MasRus[<span class="hljs-number"><span class="hljs-number">33</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>]= { <span class="hljs-number"><span class="hljs-number">144</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x41, // <span class="hljs-number"><span class="hljs-number">145</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa0, <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x42, <span class="hljs-number"><span class="hljs-number">147</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa1, <span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe0, <span class="hljs-number"><span class="hljs-number">149</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x45, <span class="hljs-number"><span class="hljs-number">129</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa2, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa3, <span class="hljs-number"><span class="hljs-number">151</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa4, <span class="hljs-number"><span class="hljs-number">152</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa5, <span class="hljs-number"><span class="hljs-number">153</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa6, <span class="hljs-number"><span class="hljs-number">154</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4b, <span class="hljs-number"><span class="hljs-number">155</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa7, <span class="hljs-number"><span class="hljs-number">156</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4d, <span class="hljs-number"><span class="hljs-number">157</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x48, <span class="hljs-number"><span class="hljs-number">158</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x4f, <span class="hljs-number"><span class="hljs-number">159</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa8, <span class="hljs-number"><span class="hljs-number">160</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x50, <span class="hljs-number"><span class="hljs-number">161</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x43, <span class="hljs-number"><span class="hljs-number">162</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x54, <span class="hljs-number"><span class="hljs-number">163</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xa9, <span class="hljs-number"><span class="hljs-number">164</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xaa, <span class="hljs-number"><span class="hljs-number">165</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>x58, <span class="hljs-number"><span class="hljs-number">166</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe1, <span class="hljs-number"><span class="hljs-number">167</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xab, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xac, <span class="hljs-number"><span class="hljs-number">169</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xe2, <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xad, <span class="hljs-number"><span class="hljs-number">171</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xae, <span class="hljs-number"><span class="hljs-number">172</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xc4, <span class="hljs-number"><span class="hljs-number">173</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xaf, <span class="hljs-number"><span class="hljs-number">174</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xb0, <span class="hljs-number"><span class="hljs-number">175</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>xb1 // }; String RusStrLCD(String StrIn) { String StrOut=<span class="hljs-string"><span class="hljs-string">""</span></span>; byte b1; byte y; byte l=StrIn.length(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(byte i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;l; i++) { b1=StrIn.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1&lt;<span class="hljs-number"><span class="hljs-number">128</span></span>) StrOut=StrOut+char(b1); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b1==<span class="hljs-number"><span class="hljs-number">208</span></span>) //==<span class="hljs-number"><span class="hljs-number">208</span></span>,     <span class="hljs-number"><span class="hljs-number">2</span></span>-  .  { b1=StrIn.charAt(i+<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(y=<span class="hljs-number"><span class="hljs-number">0</span></span>; y&lt;<span class="hljs-number"><span class="hljs-number">33</span></span>; y++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(MasRus[<span class="hljs-type"><span class="hljs-type">y</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]==b1) { StrOut=StrOut+char(MasRus[<span class="hljs-type"><span class="hljs-type">y</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } i++; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StrOut; }</code> </pre><br></div></div><br> 带有i2c总线的自制HMI就这些了。 <br><br> 哦，是的，在本文的开头，我写道我不是在为Arduino做HMI，而是为与Arduino兼容的设备做HMI。 这是关于<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CONTROLLINO MAXI的</a> ，这是从Arduino IDE（以及许多其他产品）编程的。 <br><br><img src="https://habrastorage.org/files/e62/97f/16b/e6297f16bfa84a449fe1d34f629ed061.jpg"><br><br>  CONTROLLINO MAXI实际上是Arduino +一堆屏蔽板，所有组件均设计为工业PLC。 但是下次呢。 <br><br>  <b>参考文献</b> <br><br>  → <a href="">存档</a>包含lay6格式的图表，草图和印刷电路板 <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Arduino兼容的PLC CONTROLLINO</a> ，这项工作启发了HMI i2c的创建 <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PCF8574端口扩展器</a>并将其连接到Arduino <br>  →用于通过i2c总线进行LCD 1602操作的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">FC-113板</a>及其与Arduino的连接 <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">多层树菜单</a> ，用C创建的一般原理 <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">编码UTF-8</a> <br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">编码Windows-1251</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN401587/">https://habr.com/ru/post/zh-CN401587/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN401567/index.html">Chrome Sandbox侵犯了三项专利，Google将支付专利费</a></li>
<li><a href="../zh-CN401569/index.html">CES 2017十大小玩意让我们印象深刻</a></li>
<li><a href="../zh-CN401573/index.html">自由职业者。 四个成功案例：离开办公室，生活旋转</a></li>
<li><a href="../zh-CN401577/index.html">Ryzen处理器的非官方基准和价格</a></li>
<li><a href="../zh-CN401583/index.html">为什么我有害？ 因为我没有SSD！ 将固态驱动器放在旧计算机上是否有意义？</a></li>
<li><a href="../zh-CN401591/index.html">什么是行星？</a></li>
<li><a href="../zh-CN401593/index.html">汽车文摘：维修，保险和新技术</a></li>
<li><a href="../zh-CN401595/index.html">物理学家学会了在磁场下拧紧螺丝</a></li>
<li><a href="../zh-CN401597/index.html">公司实行工作场所监视方法</a></li>
<li><a href="../zh-CN401599/index.html">如何找到自己喜欢的专业工作</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>