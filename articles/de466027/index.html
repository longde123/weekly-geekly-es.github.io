<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👵🏿 👩🏻‍✈️ 🐝 Das Buch "Der Weg von Python. Schwarzer Gürtel für Entwicklung, Skalierung, Test und Bereitstellung “ 🎹 👨🏼‍🎓 💨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo habrozhiteli! Mit dem Python-Pfad können Sie Ihre beruflichen Fähigkeiten verbessern und so viel wie möglich über die Funktionen der beliebteste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Das Buch "Der Weg von Python. Schwarzer Gürtel für Entwicklung, Skalierung, Test und Bereitstellung “</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/466027/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/kq/of/aw/kqofawsaidazmnefdopvktmtxei.jpeg" align="left" alt="Bild"></a>  Hallo habrozhiteli!  Mit dem Python-Pfad können Sie Ihre beruflichen Fähigkeiten verbessern und so viel wie möglich über die Funktionen der beliebtesten Programmiersprache lernen.  Sie lernen, wie Sie effektiven Code schreiben, die besten Programme in kürzester Zeit erstellen und häufige Fehler vermeiden.  Es ist an der Zeit, sich mit Multithreading-Computing und Memoisierung vertraut zu machen, sich von Experten auf dem Gebiet des API- und Datenbankdesigns beraten zu lassen und in Python nachzuschauen, um Ihr Verständnis der Sprache zu erweitern.  Sie müssen ein Projekt starten, mit Versionen arbeiten, automatische Tests organisieren und einen Programmierstil für eine bestimmte Aufgabe auswählen.  Anschließend studieren Sie effektive Funktionsdeklarationen, wählen geeignete Datenstrukturen und Bibliotheken aus, erstellen störungsfreie Programme, Pakete und optimieren Programme auf Bytecode-Ebene. <br><a name="habracut"></a><br><h3>  Auszug.  Tests parallel ausführen </h3><br>  Das Ausführen von Testsuiten kann zeitaufwändig sein.  Dies tritt häufig bei großen Projekten auf, wenn die Fertigstellung einer Testsuite Minuten dauert.  Standardmäßig führt pytest die Tests nacheinander in einer bestimmten Reihenfolge durch. <br><br>  Da die meisten Computer über Multi-Core-Prozessoren verfügen, können Sie die Tests beschleunigen, um sie auf mehreren Kernen auszuführen. <br><br>  Zu diesem Zweck verfügt pytest über ein pytest-xdist-Plugin, das mit pip installiert werden kann.  Dieses Plugin erweitert die pytest-Befehlszeile um das Argument ––numprocesses (abgekürzt –n), das die Anzahl der als Argument verwendeten Kerne verwendet.  Durch Ausführen von pytest –n 4 wird die Testsuite in vier parallelen Prozessen ausgeführt, wobei ein Gleichgewicht zwischen der Last der verfügbaren Kerne aufrechterhalten wird. <br><br>  Aufgrund der Tatsache, dass die Anzahl der Kerne variieren kann, akzeptiert das Plugin auch das Schlüsselwort auto als Wert.  In diesem Fall wird die Anzahl der verfügbaren Kerne automatisch zurückgegeben. <br><br><h3>  Erstellen von Objekten, die in Tests mit Fixtures verwendet werden </h3><br>  Bei Komponententests ist es häufig erforderlich, vor und nach dem Ausführen des Tests eine Reihe von Standardvorgängen auszuführen. Diese Anweisungen betreffen bestimmte Komponenten.  Beispielsweise benötigen Sie möglicherweise ein Objekt, das den Status der Anwendungskonfiguration ausdrückt. Es muss vor jedem Test initialisiert und nach der Ausführung auf seine ursprünglichen Werte zurückgesetzt werden.  Wenn der Test von einer temporären Datei abhängt, muss diese Datei vor dem Test erstellt und danach gelöscht werden.  Solche Komponenten werden als <i>Vorrichtungen bezeichnet</i> .  Sie werden vor dem Testen installiert und verschwinden nach ihrer Ausführung. <br><br>  In pytest werden Vorrichtungen als einfache Funktionen deklariert.  Die Fixture-Funktion muss das gewünschte Objekt zurückgeben, damit dieses Objekt beim Testen verwendet werden kann. <br><br>  Hier ist ein Beispiel für eine einfache Vorrichtung: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> &lt;some database connection&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre> <br>  Das Datenbank-Fixture wird automatisch von jedem Test verwendet, dessen Liste das Datenbankargument enthält.  Die Funktion test_insert () empfängt das Ergebnis der Funktion database () als erstes Argument und verwendet dieses Ergebnis nach eigenem Ermessen.  Bei dieser Verwendung von Fixtures müssen Sie den Datenbankinitialisierungscode nicht mehrmals wiederholen. <br><br>  Ein weiteres gemeinsames Merkmal des Codetests ist die Möglichkeit, überflüssiges Material nach dem Fixture-Vorgang zu entfernen.  Schließen Sie beispielsweise die Datenbankverbindung.  Durch die Implementierung des Geräts als Generator werden Funktionen zum Reinigen verifizierter Objekte hinzugefügt (Listing 6.5). <br><br><blockquote><h4>  Listing 6.5.  Ein verifiziertes Objekt löschen </h4><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> db = &lt;some database connection&gt; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> db db.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre> </blockquote>  Da wir das Yield-Schlüsselwort verwendet und einen Generator aus der Datenbank erstellt haben, wird der Code nach der Yield-Anweisung erst am Ende des Tests ausgeführt.  Dieser Code schließt die Datenbankverbindung am Ende des Tests. <br><br>  Das Schließen der Datenbankverbindung für jeden Test kann zu ungerechtfertigter Verschwendung von Rechenleistung führen, da andere Tests eine bereits offene Verbindung verwenden können.  In diesem Fall können Sie das Argument scope an den Fixture Decorator übergeben und dessen Umfang angeben: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture(scope=<span class="hljs-string"><span class="hljs-string">"module"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> db = &lt;some database connection&gt; <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> db db.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-number"><span class="hljs-number">123</span></span>)</code> </pre> <br>  Durch Angabe des Parameters scope = "module" haben Sie das Gerät einmal für das gesamte Modul initialisiert. Jetzt ist eine offene Datenbankverbindung für alle Testfunktionen verfügbar, die es anfordern. <br><br>  Sie können vor oder nach dem Test allgemeinen Code ausführen und Fixtures als automatisch mit dem Schlüsselwort autouse verwendet definieren, anstatt sie als Argument für jede Testfunktion anzugeben.  Durch die Konkretisierung der Funktion pytest.fixture () mit dem Argument True, dem Schlüsselwort autouse, wird sichergestellt, dass Fixtures jedes Mal aufgerufen werden, bevor der Test in dem Modul oder der Klasse ausgeführt wird, in der er deklariert ist. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture(autouse=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">change_user_env</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> curuser = os.environ.get(<span class="hljs-string"><span class="hljs-string">"USER"</span></span>) os.environ[<span class="hljs-string"><span class="hljs-string">"USER"</span></span>] = <span class="hljs-string"><span class="hljs-string">"foobar"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> os.environ[<span class="hljs-string"><span class="hljs-string">"USER"</span></span>] = curuser <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_user</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> os.getenv(<span class="hljs-string"><span class="hljs-string">"USER"</span></span>) == <span class="hljs-string"><span class="hljs-string">"foobar"</span></span>&lt;/source     .  ,    :     ,      ,       . &lt;h3&gt;  &lt;/h3&gt;           ,    ,   ,         .          Gnocchi,    . Gnocchi      &lt;i&gt;storage API&lt;/i&gt;.    Python          .       ,      API   .        ,      (    storage API),  ,       .   ,   &lt;i&gt; &lt;/i&gt;,     ,        .  <span class="hljs-number"><span class="hljs-number">6.6</span></span>          ,    :    mysql,   —  postgresql. &lt;blockquote&gt;&lt;h4&gt; <span class="hljs-number"><span class="hljs-number">6.6</span></span>.      &lt;/h4&gt; &lt;source lang=<span class="hljs-string"><span class="hljs-string">"python"</span></span>&gt;<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> myapp @pytest.fixture(params=[<span class="hljs-string"><span class="hljs-string">"mysql"</span></span>, <span class="hljs-string"><span class="hljs-string">"postgresql"</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> d = myapp.driver(request.param) d.start() <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> d d.stop() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(database)</span></span></span><span class="hljs-function">:</span></span> database.insert(<span class="hljs-string"><span class="hljs-string">"somedata"</span></span>)</code> </pre>  Das Treiber-Fixture erhält zwei verschiedene Werte als Parameter - die Namen der Datenbanktreiber, die von der Anwendung unterstützt werden.  test_insert wird zweimal ausgeführt: einmal für die MySQL-Datenbank und einmal für die PostgreSQL-Datenbank.  Dies macht es einfach, denselben Test mit unterschiedlichen Szenarien erneut durchzuführen, ohne neue Codezeilen hinzuzufügen. <br><br><h3>  Verwaltete Tests mit Dummy-Objekten </h3><br>  Dummy-Objekte (oder Stubs, Scheinobjekte) sind Objekte, die das Verhalten realer Anwendungsobjekte nachahmen, sich jedoch in einem speziellen, kontrollierten Zustand befinden.  Sie sind am nützlichsten beim Erstellen von Umgebungen, in denen die Bedingungen für den Test ausführlich beschrieben werden.  Sie können alle Objekte außer dem getesteten durch Dummy-Objekte ersetzen und isolieren sowie eine Umgebung für Codetests erstellen. <br><br>  Ein Anwendungsfall ist das Erstellen eines HTTP-Clients.  Es ist fast unmöglich (oder vielmehr unglaublich schwierig), einen HTTP-Server zu erstellen, auf dem Sie alle Situationen und Szenarien für jeden möglichen Wert ausführen können.  HTTP-Clients sind besonders schwer auf Fehlerszenarien zu testen. <br><br>  Die Standardbibliothek verfügt über einen Mock-Befehl zum Erstellen eines Dummy-Objekts.  Ab Python 3.3 wurde mock in die Bibliothek unittest.mock integriert.  Daher können Sie das folgende Codefragment verwenden, um die Abwärtskompatibilität zwischen Python 3.3 und früheren Versionen zu gewährleisten: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ImportError: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock</code> </pre> <br>  Die Scheinbibliothek ist sehr einfach zu bedienen.  Jedes für das mock.Mock-Objekt verfügbare Attribut wird zur Laufzeit dynamisch erstellt.  Jedem Attribut kann ein beliebiger Wert zugewiesen werden.  In Listing 6.7 wird mock verwendet, um ein Dummy-Objekt für das Dummy-Attribut zu erstellen. <br><blockquote><h4>  Listing 6.7.  Zugriff auf das Attribut mock.Mock </h4><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() &gt;&gt;&gt; m.some_attribute = <span class="hljs-string"><span class="hljs-string">"hello world"</span></span> &gt;&gt;&gt; m.some_attribute <span class="hljs-string"><span class="hljs-string">"hello world"</span></span></code> </pre> </blockquote>  Sie können auch dynamisch eine Methode für ein veränderbares Objekt erstellen, wie in Listing 6.8, wo Sie eine Dummy-Methode erstellen, die immer 42 zurückgibt und alles, was Sie wollen, als Argument verwendet. <br><blockquote><h4>  Listing 6.8.  Erstellen einer Methode für das mock.Mock-Dummy-Objekt </h4><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() &gt;&gt;&gt; m.some_method.return_value = <span class="hljs-number"><span class="hljs-number">42</span></span> &gt;&gt;&gt; m.some_method() <span class="hljs-number"><span class="hljs-number">42</span></span> &gt;&gt;&gt; m.some_method(<span class="hljs-string"><span class="hljs-string">"with"</span></span>, <span class="hljs-string"><span class="hljs-string">"arguments"</span></span>) <span class="hljs-number"><span class="hljs-number">42</span></span></code> </pre> </blockquote>  Nur ein paar Zeilen, und das mock.Mock-Objekt verfügt jetzt über eine some_method () -Methode, die 42 zurückgibt. Es wird jede Art von Argument verwendet, während keine Überprüfung des Arguments erfolgt. <br><br>  Dynamisch generierte Methoden können auch (absichtliche) Nebenwirkungen haben.  Um nicht nur Boilerplate-Methoden zu sein, die einen Wert zurückgeben, können sie definiert werden, um nützlichen Code auszuführen. <br><br>  Listing 6.9 erstellt eine Dummy-Methode, die einen Nebeneffekt hat - sie zeigt die Zeichenfolge „Hallo Welt“ an. <br><blockquote><h4>  Listing 6.9.  Erstellen einer Methode für ein mock.Mock-Objekt mit Nebeneffekt </h4><br><pre> <code class="python hljs"> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... print(<span class="hljs-string"><span class="hljs-string">"hello world!"</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">43</span></span> ... ❶ &gt;&gt;&gt; m.some_method.side_effect = print_hello &gt;&gt;&gt; m.some_method() hello world! <span class="hljs-number"><span class="hljs-number">43</span></span> ❷ &gt;&gt;&gt; m.some_method.call_count <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> </blockquote>  Wir haben dem Attribut some_method ❶ eine ganze Funktion zugewiesen.  Technisch gesehen können Sie so ein komplexeres Szenario in den Test implementieren, da Sie den für den Test erforderlichen Code in das Dummy-Objekt aufnehmen können.  Als Nächstes müssen Sie dieses Objekt an die Funktion übergeben, die es erwartet. <br><br>  Mit dem Attribut ❷ call_count können Sie auf einfache Weise überprüfen, wie oft eine Methode aufgerufen wurde. <br><br>  Die Scheinbibliothek verwendet das Muster "Aktionsprüfung": Dies bedeutet, dass Sie nach dem Testen sicherstellen müssen, dass die durch Dummies ersetzten Aktionen korrekt ausgeführt wurden.  Listing 6.10 wendet die assert () -Methode auf Dummy-Objekte an, um diese Überprüfungen durchzuführen. <br><blockquote><h4>  Listing 6.10.  Methoden zur Anrufüberprüfung </h4><br><pre> <code class="python hljs"> &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; m = mock.Mock() ❶ &gt;&gt;&gt; m.some_method(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>) &lt;Mock name=<span class="hljs-string"><span class="hljs-string">'mock.some_method()'</span></span> id=<span class="hljs-string"><span class="hljs-string">'26144272'</span></span>&gt; ❷ &gt;&gt;&gt; m.some_method.assert_called_once_with(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>) &gt;&gt;&gt; m.some_method.assert_called_once_with(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, ❸mock.ANY) &gt;&gt;&gt; m.some_method.assert_called_once_with(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'baz'</span></span>) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.7/dist-packages/mock.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">846</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assert_cal led_once_with <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.assert_called_with(*args, **kwargs) File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python2.7/dist-packages/mock.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">835</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> assert_cal led_with <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> AssertionError(msg) AssertionError: Expected call: some_method(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'baz'</span></span>) Actual call: some_method(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>, <span class="hljs-string"><span class="hljs-string">'bar'</span></span>)</code> </pre> </blockquote>  Wir haben Methoden mit foo- und bar-Argumenten als Tests erstellt, indem wir die ❶-Methode aufgerufen haben.  Eine einfache Möglichkeit, Aufrufe von Dummy-Objekten zu testen, besteht darin, assert_called () -Methoden zu verwenden, z. B. assert_called_once_with () ❷.  Für diese Methoden müssen Sie die Werte übergeben, die beim Aufruf der Dummy-Methode erwartet werden.  Wenn sich die übergebenen Werte von den verwendeten unterscheiden, löst mock eine AssertionError-Ausnahme aus.  Wenn Sie nicht wissen, welche Argumente übergeben werden können, verwenden Sie mock.ANY als Wert von ❸;  Es ersetzt alle Argumente, die an die Dummy-Methode übergeben wurden. <br><br>  Die Scheinbibliothek kann auch verwendet werden, um eine Funktion, Methode oder ein Objekt aus einem externen Modul zu ersetzen.  In Listing 6.11 haben wir die Funktion os.unlink () durch unsere eigene Dummy-Funktion ersetzt. <br><blockquote><h4>  Listing 6.11.  Mock.patch verwenden </h4><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os &gt;&gt;&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fake_os_unlink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> IOError(<span class="hljs-string"><span class="hljs-string">"Testing!"</span></span>) ... &gt;&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> mock.patch(<span class="hljs-string"><span class="hljs-string">'os.unlink'</span></span>, fake_os_unlink): ... os.unlink(<span class="hljs-string"><span class="hljs-string">'foobar'</span></span>) ... Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fake_os_unlink IOError: Testing!</code> </pre> </blockquote>  Bei Verwendung als Kontextmanager ersetzt mock.patch () die Zielfunktion durch die von uns ausgewählte.  Dies ist erforderlich, damit der im Kontext ausgeführte Code die korrigierte Methode verwendet.  Mit der Methode mock.patch () können Sie einen beliebigen Teil des externen Codes ändern und ihn dazu zwingen, sich so zu verhalten, dass alle Bedingungen für die Anwendung getestet werden (Listing 6.12). <br><blockquote><h4>  Listing 6.12.  Verwenden von mock.patch () zum Testen vieler Verhaltensweisen </h4><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WhereIsPythonError</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> ❶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_python_still_a_programming_language</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: r = requests.get(<span class="hljs-string"><span class="hljs-string">"http://python.org"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> IOError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Python is a programming language'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r.content <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> WhereIsPythonError(<span class="hljs-string"><span class="hljs-string">"Something bad happened"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_fake_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(status_code, content)</span></span></span><span class="hljs-function">:</span></span> m = mock.Mock() m.status_code = status_code m.content = content <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fake_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fake_get <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raise_get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(url)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> IOError(<span class="hljs-string"><span class="hljs-string">"Unable to fetch url %s"</span></span> % url) ❷ @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, get_fake_get( <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'Python is a programming language for sure'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_python_is</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> is_python_still_a_programming_language() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, get_fake_get( <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'Python is no more a programming language'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_python_is_not</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> is_python_still_a_programming_language() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, get_fake_get(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">'Whatever'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_bad_status_code</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(WhereIsPythonError): is_python_still_a_programming_language() @mock.patch(<span class="hljs-string"><span class="hljs-string">'requests.get'</span></span>, raise_get) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_ioerror</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(WhereIsPythonError): is_python_still_a_programming_language()</code> </pre> </blockquote><br><br>  Listing 6.12 implementiert einen Testfall, der nach allen Instanzen von <i>Python</i> sucht. Es <i>handelt sich um eine Programmiersprachenzeichenfolge</i> auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">python.org</a> ❶.  Es gibt keine Option, bei der der Test keine bestimmte Zeile auf der ausgewählten Webseite findet.  Um ein negatives Ergebnis zu erhalten, müssen Sie die Seite ändern, dies ist jedoch nicht möglich.  Mit Hilfe von mock können Sie jedoch zum Trick gehen und das Verhalten der Anforderung so ändern, dass eine Dummy-Antwort mit einer fiktiven Seite zurückgegeben wird, die keine bestimmte Zeichenfolge enthält.  Auf diese Weise können Sie ein negatives Szenario testen, in dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">python.org</a> keine bestimmte Zeichenfolge enthält, und sicherstellen, dass das Programm einen solchen Fall korrekt behandelt. <br><br>  In diesem Beispiel wird die Version mock.patch ()  decorator verwendet.  Das Verhalten des Dummy-Objekts ändert sich nicht und es war einfacher, ein Beispiel im Kontext einer Testfunktion zu setzen. <br><br>  Die Verwendung eines Dummy-Objekts hilft bei der Simulation eines Problems: Der Server gibt einen 404-Fehler, einen E / A-Fehler oder einen Netzwerkverzögerungsfehler zurück.  Wir können sicherstellen, dass der Code die richtigen Werte zurückgibt oder jeweils die richtige Ausnahme auslöst, was das erwartete Verhalten des Codes garantiert. <br><br><h3>  Identifizieren Sie nicht getesteten Code mit Abdeckung </h3><br>  Eine großartige Ergänzung zum Unit-Test ist das Coverage-Tool. [Die Code-Coverage ist ein Maß für das Testen.  Zeigt den Prozentsatz des Quellcodes des Programms an, der während des Testprozesses ausgeführt wurde <i>.</i>  ], die nicht getestete Codeteile findet.  Es verwendet Tools zur Codeanalyse und -verfolgung, um die ausgeführten Zeilen zu identifizieren.  Beim Unit-Test kann festgestellt werden, welche Teile des Codes wiederverwendet und welche überhaupt nicht verwendet wurden.  Das Erstellen von Tests ist erforderlich, und die Möglichkeit, herauszufinden, welchen Teil des Codes Sie vergessen haben, mit Tests zu behandeln, macht diesen Prozess angenehmer. <br><br>  Installieren Sie das Abdeckungsmodul über Pip, um es über Ihre Shell verwenden zu können. <br><br><blockquote><h4>  HINWEIS </h4><br>  Der Befehl kann auch als Python-Coverage bezeichnet werden, wenn das Modul über das Installationsprogramm Ihres Betriebssystems installiert wird.  Ein Beispiel hierfür ist das Debian-Betriebssystem. </blockquote><br><br>  Die Offline-Verwendung der Abdeckung ist ziemlich einfach.  Es werden die Teile des Programms angezeigt, die niemals gestartet werden und zu einem "Eigengewicht" werden - ein Code, den Sie nicht entfernen können, ohne die Funktionalität des Programms zu ändern.  Alle Testwerkzeuge, die weiter oben in diesem Kapitel erläutert wurden, sind in die Abdeckung integriert. <br><br>  Wenn Sie pytest verwenden, installieren Sie das Plugin pytest-cov über pip install pytest-pycov und fügen Sie einige Schalter hinzu, um eine detaillierte Ausgabe des nicht getesteten Codes zu generieren (Listing 6.13). <br><blockquote><h4>  Listing 6.13.  Mit Pytest und Abdeckung </h4><br><pre> <code class="python hljs">$ pytest --cov=gnocchiclient gnocchiclient/tests/unit ---------- coverage: platform darwin, python <span class="hljs-number"><span class="hljs-number">3.6</span></span><span class="hljs-number"><span class="hljs-number">.4</span></span>-final<span class="hljs-number"><span class="hljs-number">-0</span></span> ----------- Name Stmts Miss Branch BrPart Cover --------------------------- gnocchiclient/__init__.py <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span>% gnocchiclient/auth.py <span class="hljs-number"><span class="hljs-number">51</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span>% gnocchiclient/benchmark.py <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% --snip-- --------------------------- TOTAL <span class="hljs-number"><span class="hljs-number">2040</span></span> <span class="hljs-number"><span class="hljs-number">1868</span></span> <span class="hljs-number"><span class="hljs-number">424</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>% === passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">5.00</span></span> seconds ===</code> </pre> </blockquote>  Die Option --cov aktiviert die Ausgabe des Abdeckungsberichts am Ende des Tests.  Sie müssen den Paketnamen als Argument übergeben, damit das Plugin den Bericht ordnungsgemäß filtert.  Die Ausgabe enthält Codezeilen, die nicht ausgeführt wurden, dh sie wurden nicht getestet.  Sie müssen lediglich den Editor öffnen und einen Test für diesen Code schreiben. <br><br>  Das Abdeckungsmodul ist noch besser - es ermöglicht Ihnen, klare Berichte im HTML-Format zu erstellen.  Fügen Sie einfach -–cov-report-html hinzu, und HTML-Seiten werden im Verzeichnis <i>htmlcov angezeigt,</i> von dem aus Sie den Befehl ausführen.  Auf jeder Seite wird angezeigt, welche Teile des Quellcodes ausgeführt wurden oder nicht. <br><br>  Wenn Sie noch weiter gehen möchten, verwenden Sie –-cover-fail-under-COVER_MIN_PERCENTAGE. Dies führt dazu, dass die Testsuite fehlschlägt, wenn sie nicht den Mindestprozentsatz an Code abdeckt.  Obwohl ein großer Prozentsatz der Abdeckung ein gutes Ziel ist und Testwerkzeuge nützlich sind, um Informationen über den Status der Testabdeckung zu erhalten, ist der Prozentsatz an sich nicht sehr informativ.  Abbildung 6.1 zeigt einen beispielhaften Abdeckungsbericht mit einer prozentualen Abdeckung. <br><br>  Zum Beispiel ist es ein würdiges Ziel, den Code zu 100% mit Tests zu bedecken. Dies bedeutet jedoch nicht unbedingt, dass der Code vollständig getestet wurde.  Dieser Wert zeigt nur an, dass alle Codezeilen im Programm erfüllt sind, zeigt jedoch nicht an, dass alle Bedingungen getestet wurden. <br><br>  Es lohnt sich, Abdeckungsinformationen zu verwenden, um die Testsuite zu erweitern und sie für Code zu erstellen, der nicht ausgeführt wird.  Dies vereinfacht die Projektunterstützung und verbessert die allgemeine Codequalität. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/d_/af/vl/d_afvlajlx_9ctds7yfu7ef_2ds.png" alt="Bild"></div><br><br><h3>  Über den Autor </h3><br>  <i>Julien Danju</i> hackt seit ungefähr zwanzig Jahren Freeware und entwickelt seit fast zwölf Jahren Python-Programme.  Derzeit leitet er das Designteam für die OpenStack-basierte verteilte Cloud-Plattform, die die größte vorhandene Python-Open-Source-Datenbank mit etwa zweieinhalb Millionen Codezeilen besitzt.  Vor der Entwicklung von Cloud-Diensten erstellte Julien den Fenstermanager und trug zur Entwicklung vieler Projekte bei, darunter Debian und GNU Emacs. <br><br><h3>  Über Science Editor </h3><br>  <i>Mike Driscoll</i> programmiert seit über einem Jahrzehnt in Python.  Lange schrieb er über Python in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">The Mouse vs.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Der Python</a> .  Autor mehrerer Python-Bücher: Python 101, Python-Interviews und ReportLab: PDF-Verarbeitung mit Python.  Sie finden Mike auf Twitter und auf GitHub: @driscollis. <br><br>  »Weitere Informationen zum Buch finden Sie auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Website des Herausgebers</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Inhalt</a> <br>  » <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Auszug</a> <br><br>  25% Rabatt auf Gutschein für Händler - <b>Python</b> <br><br>  Nach Bezahlung der Papierversion des Buches wird ein elektronisches Buch per E-Mail verschickt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de466027/">https://habr.com/ru/post/de466027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de466001/index.html">"Mobile" Feng Shui, oder wir schlafen richtig (Kaffee, Kakerlaken und Intoleranz bei Habré)</a></li>
<li><a href="../de466015/index.html">Ein bisschen mehr über Trigonometrie beim Rechnen</a></li>
<li><a href="../de466017/index.html">Livy - das fehlende Glied in der Hadoop Spark Airflow Python-Kette</a></li>
<li><a href="../de466019/index.html">ABBYY Mobile Web Capture: Hochwertige Fotos von Dokumenten direkt im Browser Ihres Smartphones</a></li>
<li><a href="../de466021/index.html">Wie ich Yandex.Alice beigebracht habe, über Sexspielzeug zu sprechen</a></li>
<li><a href="../de466029/index.html">Wie man einen Quantencomputer in einen perfekten Zufallszahlengenerator verwandelt</a></li>
<li><a href="../de466031/index.html">DeepMinds epische Mission, das komplexeste wissenschaftliche Problem zu lösen</a></li>
<li><a href="../de466033/index.html">Wie man ein Team in die Suche nach Ideen einbezieht und viel mehr als nur Ideen bekommt</a></li>
<li><a href="../de466039/index.html">PHP-Bibliotheken für den E-Commerce: Arbeiten mit ATOL und Payture, Parsen von GS1-Codes und anderen Aufgaben</a></li>
<li><a href="../de466041/index.html">Das erste Offline-Event des Facebook Developer Circle: Moskauer Community - Launch Event</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>