<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüé® üï∏Ô∏è üë§ Vivado: modo Picasso üë∂üèø üßô üé∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anotaci√≥n 


 Locura Todas las edades Sumiso 


 Al dise√±ar cualquier m√≥dulo en FPGA, a veces viene a la mente la idea de un uso no bastante est√°ndar ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vivado: modo Picasso</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477974/"><h2 id="annotaciya">  Anotaci√≥n </h2><br><p>  <em>Locura Todas las edades Sumiso</em> </p><br><p>  Al dise√±ar cualquier m√≥dulo en FPGA, a veces viene a la mente la idea de un uso no bastante est√°ndar del entorno de dise√±o en s√≠ y las herramientas que proporciona para el dise√±o.  En este breve art√≠culo, veremos c√≥mo, con la ayuda de la herramienta de gesti√≥n ambiental implementada en Tcl, podemos literalmente dibujar fotograf√≠as, pinturas, retratos y memesics en el FPGA. </p><br><p>  Una "ruta de dise√±o" tan inusual se implement√≥ hace un a√±o y medio, pero solo ahora surgi√≥ la idea de organizarla en forma de una nota, en la que hay poca pr√°ctica en el uso de scripts Tcl para administrar el entorno de dise√±o, en este caso Vivado.  Sin embargo, con modificaciones menores, todo se puede adaptar f√°cilmente a otros entornos de desarrollo, por ejemplo, Quartus II. </p><br><p><img src="https://habrastorage.org/webt/32/h7/xr/32h7xruuubk_cai37jn18jgf8ca.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Introduccion </h2><br><p>  Por supuesto, la idea no vino a la mente de la nada.  Su aparici√≥n fue promovida por mi empleo en proyectos de procesamiento de im√°genes y gesti√≥n de secuencias de video en FPGA.  A todos les sucede que cuando se sientan ante una soluci√≥n a un problema, cada herej√≠a viene a la mente por qu√© no funciona o funciona exactamente como deber√≠a, pero no como esperamos. </p><br><p>  Al resolver el problema, tuve que recurrir a una de las herramientas del entorno de Vivado, a saber, colorear los componentes y m√≥dulos correspondientes en el proyecto despu√©s de la colocaci√≥n, el rastreo y el an√°lisis en gr√°ficos de tiempo infinitos. </p><br><p>  Como resultado, pint√© varios bloques l√≥gicos configurables de CLB en varios colores, y me di cuenta: estos son los p√≠xeles de la imagen, as√≠ que puedo tratar de dibujar qu√© hilo es la imagen, haciendo coincidir cada p√≠xel con su propio CLB de color ... bueno, comenz√≥ </p><br><h2 id="chem-nam-pomozhet-tcl">  ¬øC√≥mo nos ayudar√° Tcl? </h2><br><p>  Supongamos que tenemos una peque√±a imagen de tama√±o 100x100 p√≠xeles.  Ahora suponga que para colorear el CLB, necesitamos hacer dos cosas: seleccionar el CLB y seleccionar el color.  En la imagen de 100x100 tenemos 10,000 p√≠xeles y hacer ese color manualmente es bastante tedioso, especialmente porque las acciones son las mismas y repetitivas.  Por lo tanto, pintar manualmente cada CLB no es una opci√≥n y debe usar Tcl y scripts.  ¬øPero por d√≥nde empezar? </p><br><p>  Lo primero que se me ocurri√≥ fue encontrar el equipo adecuado responsable de asignar el color al elemento seleccionado.  Afortunadamente, al realizar acciones manualmente, Vivado muestra los comandos Tcl apropiados en la consola, y parece que el problema de b√∫squeda debe resolverse lo m√°s r√°pido posible.  Sin embargo, no estaba all√≠.  Vivado simplemente ignora la salida del comando para resaltar los elementos seleccionados, y la √∫nica opci√≥n para encontrar el comando, y estaba absolutamente seguro de que deber√≠a ser, es sumergirse de lleno en la gu√≠a Tcl disponible en Vivado, que tiene casi 2000 p√°ginas [1]. </p><br><p>  No se desespere, la palabra clave "resaltar" encontr√≥ r√°pidamente el comando correspondiente, que se llama resaltar_objetos.  Este comando resalta los objetos especificados o seleccionados en un color espec√≠fico, especificado usando opciones.  Las opciones para el comando highlight_objects son las siguientes: </p><br><p>  - <em>color_index</em> - (opcional) el valor v√°lido del argumento de la opci√≥n debe ser un n√∫mero del 1 al 20. El color en el que se pintar√° el objeto seleccionado est√° determinado por su n√∫mero de serie de la paleta de colores predefinida, que se puede encontrar en Colores ‚Üí Resaltar en la secci√≥n de men√∫ Herramientas ‚Üí Configuraci√≥n . <br>  - <em>rgb</em> - (opcional) establece el color del objeto seleccionado en formato RGB <br>  - <em>color</em> : (opcional) resalta el objeto seleccionado en uno de los siguientes colores: rojo, verde, azul, magenta, amarillo, cian y naranja </p><br><p>  Las opciones restantes del comando se relacionan con la configuraci√≥n del sistema del comando en s√≠ y no nos ser√°n √∫tiles.  Sin embargo, cuando use el comando highlight_objects, tenga en cuenta que dos o m√°s opciones de coloraci√≥n no se pueden aplicar al mismo tiempo. <br>  Obviamente, una opci√≥n que establece un color arbitrario en formato RGB es adecuada para nuestra tarea: la opci√≥n <em>rgb</em> </p><br><p>  Ahora no ser√≠a malo obtener los valores de p√≠xeles de la imagen, pero no pude encontrar la imagen que se presentar√≠a en formato de mapa de bits.  Al abrir cada archivo con un editor de texto, no fue posible encontrar l√≠neas con un valor de p√≠xel.  Por supuesto, no escrib√≠ un programa para convertir im√°genes a formato de mapa de bits, sino que simplemente sub√≠ a Internet para buscar una soluci√≥n preparada.  No fue demasiado largo para buscar.  Al final result√≥ que, la tarea de convertir una imagen a un formato de mapa de bits (es decir, cuando vemos los valores de p√≠xeles de una imagen sin comprimir) es bastante relevante (probablemente, dicha tarea se asigna a los estudiantes programadores como tarea para el trabajo de laboratorio).  Una b√∫squeda corta result√≥ en github, desde donde se descarg√≥ el programa Image2Bitmap [2]. </p><br><p>  El programa requiere una entrada de imagen y genera los valores de p√≠xel en forma de matriz C con valores de p√≠xel hexadecimales en formato RGB565.  Este formato dice que la codificaci√≥n de color para el componente rojo usa 5 bits, verde 6 bits y azul 5 bits.  Esto result√≥ ser suficiente para el trabajo.  Ahora todo lo que se requiere es asignar los valores obtenidos directamente a las secciones pintadas (corte). </p><br><h2 id="vybor-plis">  Selecci√≥n de FPGA </h2><br><p>  Cuanto m√°s grande es el FPGA, m√°s recursos l√≥gicos contiene, lo que significa que el "campo para la creatividad" en s√≠ mismo es m√°s grande y la imagen ser√° m√°s clara.  Cabe se√±alar de inmediato que "decorar" es un proceso bastante largo y puede tomar una cantidad de tiempo decente, dependiendo del tama√±o de la imagen.  Para las pruebas, vale la pena elegir un FPGA con una peque√±a cantidad de recursos.  Por ejemplo, la familia Spartan-7.  Despu√©s de la prueba, puede cambiar el FPGA a m√°s "gordo", por ejemplo, de la familia Ultrascale +. </p><br><ol><li><p>  Iniciamos Vivado y creamos el proyecto. </p><br></li><li><p>  Seleccionamos el cristal xc7s6cpga196-2, en el que dibujaremos la imagen de prueba <br><br><img src="https://habrastorage.org/webt/vk/zj/do/vkzjdo6hklo098bevkxuz7qvjhu.png"></p><br></li><li><p>  Para mostrar el dibujo, necesitamos abrir la imagen del cristal en s√≠, sin embargo, esto se puede hacer despu√©s de la etapa de s√≠ntesis o elaborar.  En Vivado, para esto necesitamos crear un m√≥dulo ficticio en cualquier idioma. <br><br><img src="https://habrastorage.org/webt/nb/ss/7k/nbss7kzptxr8ify9ot4ctpijx8u.png"></p><br></li><li><p>  Agregue un script al proyecto Tcl. <br>  a.  Para hacer esto, cree un archivo con la extensi√≥n ".tcl" en la carpeta con el proyecto, por ejemplo, "fpga_painter.tcl" <br><br><img src="https://habrastorage.org/webt/x9/k8/is/x9k8ismf9abat7cjtkl6kqto-lg.png"></p><br><p>  b.  Vaya a Vivado y agregue este archivo al proyecto. <br><br><img src="https://habrastorage.org/webt/zs/we/gd/zswegdciaq_qyj-8x56ar2wfzom.png"></p><br><p>  c.  Despu√©s de actualizar la jerarqu√≠a del proyecto, deje el archivo inactivo. <br><br><img src="https://habrastorage.org/webt/ut/h6/-p/uth6-puy3u6amils-egmrxs8cqo.png"></p><br></li><li><p>  Despu√©s de crear el m√≥dulo, aparecer√° en la ventana de la jerarqu√≠a del proyecto y el bot√≥n Abrir dise√±o elaborado estar√° disponible para nosotros.  Emp√∫jalo. <br><br><img src="https://habrastorage.org/webt/g8/cy/mk/g8cymkxi_hdpdwm32k7mld50t_s.png"></p><br></li><li><p>  Despu√©s de abrir Dise√±o elaborado, vaya a Ventana ‚Üí Dispositivo.  Aparecer√° una pantalla del campo de nuestro FPGA. <br><br><img src="https://habrastorage.org/webt/sz/_n/cd/sz_ncdlckd-5rqbvicyshqmulxu.png"></p><br></li><li><p>  La preparaci√≥n ha terminado, comenzamos a escribir un gui√≥n. </p><br></li></ol><br><h2 id="opredelenie-parametrov-i-procedur">  Definici√≥n de par√°metros y procedimientos. </h2><br><h3 id="testovoe-izobrazhenie">  Imagen de prueba </h3><br><p>  Primero, depuremos el algoritmo / c√≥digo como tal en una imagen peque√±a, digamos 5x3, y luego ejec√∫telo "al m√°ximo". </p><br><ol><li><p>  Abra Paint, limite el campo de imagen a 5x3 p√≠xeles (puede tomar cualquier color).  Guarde el archivo como "5x3.png" <br><br><img src="https://habrastorage.org/webt/nh/vg/l6/nhvgl6sub5ywa74hvrn-p5xq8hm.png"></p><br></li><li><p>  Abra el programa Image2Bitmap y convierta nuestra imagen en una matriz RGB565. <br><br><img src="https://habrastorage.org/webt/aq/vb/u9/aqvbu9m6zhzrjakwux_1clytapk.png"></p><br></li><li><p>  Despu√©s de la conversi√≥n, el programa nos dar√° una matriz de 15 p√≠xeles. </p><br></li></ol><br><pre><code class="plaintext hljs">*uint16_t image = { 0xf800, 0x07e0, 0x001f, 0x8410, 0x8010, 0xfbe4, 0xff80, 0x2589, 0x051d, 0x3a59, 0xa254, 0xbbca, 0xfd79, 0xef36, 0x9edd, };*</code> </pre> <br><h3 id="podgotovka-dannyh">  Preparaci√≥n de datos </h3><br><p>  Antes de continuar con el procesamiento de p√≠xeles, transformamos los datos generados por Image2Bitmap en una lista simple en la que se escriben los valores de p√≠xeles hexadecimales.  Copiaremos los datos del programa y los guardaremos en el archivo pic_array.dat, que debe ubicarse en la carpeta del proyecto. </p><br><p><img src="https://habrastorage.org/webt/1b/xm/dj/1bxmdjjzyzhrqxqchlngx8qmpiu.png"></p><br><p>  Al iniciar el script creado, tenemos que procesar el archivo "pic_array.dat".  Vale la pena se√±alar que el n√∫mero de elementos en la l√≠nea devuelta por Image2Bitmap no coincide con el n√∫mero de p√≠xeles en la l√≠nea de la imagen convertida, por esta raz√≥n crearemos una lista separada de "p√≠xeles". </p><br><p><img src="https://habrastorage.org/webt/rj/xl/pc/rjxlpcpleobp3ekmfwp4z_sofe0.png"></p><br><p>  Al leer un archivo, debe ignorar la primera l√≠nea "uint16_t image = {" y la √∫ltima "};".  Para omitir la primera l√≠nea al leer un archivo, simplemente coloque la l√≠nea de lectura antes del ciclo de lectura del archivo completo. </p><br><p><img src="https://habrastorage.org/webt/p0/j0/cl/p0j0clka4-dt-ggaskumsj5zkd8.png"></p><br><p>  Despu√©s de leer el archivo completo, veremos que la √∫ltima l√≠nea del archivo "};" se ha convertido en un elemento de la lista, que simplemente se elimina. </p><br><p><img src="https://habrastorage.org/webt/zm/sc/ao/zmscaotma7373mbpnknpxh4xn5m.png"></p><br><p>  Esto completa la formaci√≥n de la lista con valores de p√≠xeles hexadecimales.  Ahora comencemos a procesarlos. </p><br><h3 id="opredelenie-razmera-izobrazheniya">  Tama√±o de imagen </h3><br><p>  Una vez m√°s, eche un vistazo al campo FPGA y la imagen.  El campo FPGA se divide en secciones (SLICE), que tienen las coordenadas horizontales correspondientes "X" y vertical "Y".  Por ejemplo, SLICE_X6Y36. </p><br><p><img src="https://habrastorage.org/webt/hm/iz/du/hmizdutpp0x-mieimj5ma07rgnk.png"></p><br><p>  La imagen, a su vez, tiene p√≠xeles, tambi√©n con coordenadas horizontales y verticales.  Al superponer la imagen en el FPGA, debemos combinar el p√≠xel superior izquierdo con la secci√≥n superior izquierda del FPGA.  En este caso, el cristal seleccionado tiene una secci√≥n superior con la coordenada X0Y49. </p><br><p><img src="https://habrastorage.org/webt/0h/ip/b-/0hipb-wldjghc-p2xs5-uafdtxe.png"></p><br><p>  El tama√±o de la imagen estar√° determinado por el n√∫mero de secciones en el FPGA horizontal y verticalmente.  Para el cristal seleccionado, la coordenada horizontal de las secciones var√≠a de X0 a X131, y la coordenada vertical de Y49 a Y0.  Se deduce que, en teor√≠a, podemos dibujar una imagen de tama√±o 132x50 en el cristal seleccionado. </p><br><h3 id="nachalnye-parametry">  Par√°metros iniciales </h3><br><p>  Para resumir: los par√°metros iniciales de nuestro script ser√°n: </p><br><ol><li><p>  X posici√≥n inicial de la secci√≥n: nombre de variable start_x <br><br><img src="https://habrastorage.org/webt/l8/qr/gh/l8qrghklltffibctylxjcczbwqk.png"></p><br></li><li><p>  Posici√≥n de inicio de secci√≥n en el eje y: nombre de variable start_y <br><br><img src="https://habrastorage.org/webt/yf/23/kf/yf23kfl9uxrt5zekli3n16zpzew.png"></p><br></li><li><p>  Ancho de imagen (para la imagen de prueba es 5): variable w <br><br><img src="https://habrastorage.org/webt/cs/oi/un/csoiunryjazlcstfmab_g3ee9r0.png"></p><br></li><li><p>  Altura de la imagen (para la imagen de prueba es 3): variable h <br><br><img src="https://habrastorage.org/webt/oz/d2/09/ozd209wjyznbgt2uvcb7fvrhd2c.png"></p><br></li></ol><br><h3 id="korrektirovka-cveta-piksela">  Ajuste de color de p√≠xel </h3><br><p>  Image2Bitmap proporciona una matriz de p√≠xeles en formato RGB565 como un n√∫mero de 16 bits escrito en formato hexadecimal.  Deber√≠amos: </p><br><ol><li><p>  Convierte el valor de p√≠xel a formato binario.  Esto se puede hacer usando el procedimiento hex2bin, que se puede encontrar en [3] <br><br><img src="https://habrastorage.org/webt/fv/su/mt/fvsumtam5vrnkkm0uucn5vx4brc.png"></p><br></li><li><p>  Haga coincidir los bits con los componentes de color correspondientes: <br>  ‚Ä¢ El componente rojo de R [15:11] <br><br><img src="https://habrastorage.org/webt/tj/mh/2k/tjmh2k-ihvuroxwduqm6_ugqmxi.png"></p><br><p>  ‚Ä¢ Componente verde G [10: 5] <br><br><img src="https://habrastorage.org/webt/y6/g0/yd/y6g0ydaosk3gkzzlylaenkh_oxm.png"></p><br><p>  ‚Ä¢ Componente azul B [4: 0] <br><br><img src="https://habrastorage.org/webt/3i/97/vh/3i97vhrm4ivfevdr-xqwjzi9bzg.png"></p><br></li></ol><br><p>  <em>Explicaci√≥n: el orden cambia debido al hecho de que el procedimiento hex2bin devuelve una cadena en la que la numeraci√≥n de los elementos comienza con 0, es decir, el 15¬∫ bit corresponde al 0¬∫ elemento de la cadena y el 0¬∫ bit corresponde al 15¬∫ elemento de la cadena</em> </p><br><ol><li><p>  Convierta el valor del componente de color de binario a decimal.  Esto se puede hacer usando el procedimiento bin2dec, que se puede encontrar [3]: <br><br><img src="https://habrastorage.org/webt/hc/1n/em/hc1nemkiw4byzq2yc-vka0gckmq.png"><br><br><img src="https://habrastorage.org/webt/hi/td/uy/hitduy-sypn4d7bv7kidwic2g2m.png"></p><br></li><li><p>  Convierta valores de p√≠xeles de RGB565 a formato RGB888, para una visualizaci√≥n de imagen m√°s fluida.  Esto se hace usando dos listas, que se pueden encontrar en [4].  C√≥mo funciona <br>  ‚Ä¢ La resoluci√≥n de los componentes de color R y B es de 5 bits.  Tomando el valor decimal del componente, lo comparamos con la posici√≥n del n√∫mero escrito en la lista t5, y el valor del componente cambia al valor en la tabla <br><br><img src="https://habrastorage.org/webt/lk/vw/_a/lkvw_abrbpyeylfdoggm5pbpxns.png"><br><br><img src="https://habrastorage.org/webt/ao/mw/tv/aomwtv2q6hz9bg-_lmszmig7euq.png"><br><br><img src="https://habrastorage.org/webt/uy/qh/16/uyqh16vi-qkh9vpfrzcovq-zugs.png"></p><br><p>  ‚Ä¢ De manera similar para el componente G y la tabla t6 <br><br><img src="https://habrastorage.org/webt/ti/is/lh/tiislhhogy2om7xxhvj_676dm5s.png"><br><br><img src="https://habrastorage.org/webt/pa/bh/3d/pabh3dqnk_3sk3sn6zt5big0t0e.png"></p><br></li></ol><br><h3 id="opredelenie-nalichiya-sekcii">  Disponibilidad de secci√≥n </h3><br><p>  Dentro de algunos FPGA hay recursos especiales o vac√≠os que pueden interrumpir la numeraci√≥n secuencial de las coordenadas de secci√≥n.  Por ejemplo, en la figura siguiente puede ver que la numeraci√≥n de la secci√≥n est√° interrumpida (cristal xc7s50) <br><br><img src="https://habrastorage.org/webt/uq/er/yq/uqeryqyfckyqezufafrp-vrxbgi.png"></p><br><p>  Por esta raz√≥n, antes de te√±ir, primero verificamos la existencia de la secci√≥n.  Si existe, luego pinta, si no existe, pasa al siguiente p√≠xel <br><br><img src="https://habrastorage.org/webt/zx/a8/lt/zxa8lt_n0pb6o7s3ztrfozkuu2k.png"></p><br><h3 id="okrashivanie-sekcii">  Secci√≥n de tinci√≥n </h3><br><p>  Color de secci√≥n definido, secci√≥n marcada.  Ahora el color debe asignarse a las secciones con el comando highlight_objects: <br><br><img src="https://habrastorage.org/webt/5i/fv/lp/5ifvlpcm5e70ur9sg7mufhmh4e0.png"></p><br><h3 id="vektor-dvuhmernyy-massiv">  Vector ‚Üí Matriz bidimensional </h3><br><p>  Al principio, convertimos los datos de la imagen en una lista de p√≠xeles, que almacena un escaneo progresivo de la imagen.  Para organizar la imagen, presentamos dos variables, x e y, que corresponder√°n a la posici√≥n de los p√≠xeles en la imagen.  Al leer secuencialmente los elementos de la lista de p√≠xeles, formaremos una imagen utilizando dos bucles for: uno por el n√∫mero de l√≠neas, el segundo por la posici√≥n del p√≠xel en la l√≠nea <br><br><img src="https://habrastorage.org/webt/fk/pu/wa/fkpuwau81hpppxfxkgvvzuvdtr0.png"><br><br><img src="https://habrastorage.org/webt/hf/bj/jh/hfbjjhugkpxwqd2zdtrn0seyzse.png"></p><br><h3 id="polnyy-listing-skripta">  Listado completo de guiones </h3><br><div class="spoiler">  <b class="spoiler_title">Listado de fpga_painter.tcl</b> <div class="spoiler_text"><pre> <code class="vhdl hljs">#https://tcl.tk/ #http://www.tune-it.ru/web/il/home/-/blogs/-rgb888-&lt;-&gt;-rgb565----- #https://github.com/FoxExe/Image2Bitmap/releases/tag/<span class="hljs-number"><span class="hljs-number">0.5</span></span> #        set start_x <span class="hljs-number"><span class="hljs-number">0</span></span>; # set start_y <span class="hljs-number"><span class="hljs-number">49</span></span>; # set w <span class="hljs-number"><span class="hljs-number">5</span></span>; #  (   ) set h <span class="hljs-number"><span class="hljs-number">3</span></span>; #  ( ) proc hex2bin hex { set t [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">0010</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">0011</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">0100</span></span> \ <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0101</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">0110</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">0111</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">1001</span></span> \ a <span class="hljs-number"><span class="hljs-number">1010</span></span> b <span class="hljs-number"><span class="hljs-number">1011</span></span> c <span class="hljs-number"><span class="hljs-number">1100</span></span> d <span class="hljs-number"><span class="hljs-number">1101</span></span> e <span class="hljs-number"><span class="hljs-number">1110</span></span> f <span class="hljs-number"><span class="hljs-number">1111</span></span> \ A <span class="hljs-number"><span class="hljs-number">1010</span></span> B <span class="hljs-number"><span class="hljs-number">1011</span></span> C <span class="hljs-number"><span class="hljs-number">1100</span></span> D <span class="hljs-number"><span class="hljs-number">1101</span></span> E <span class="hljs-number"><span class="hljs-number">1110</span></span> F <span class="hljs-number"><span class="hljs-number">1111</span></span>] regsub {^<span class="hljs-number"><span class="hljs-number">0</span></span>[xX]} $hex {} hex <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">map</span></span> -nocase $t $hex] } proc bin2dec bin { #returns <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> equivalent <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> $bin set res <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$bin == <span class="hljs-number"><span class="hljs-number">0</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } elseif {[<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> match -* $bin]} { set sign - set bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $bin[set bin {}] <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set sign {} } foreach i [split $bin {}] { set res [expr {$res*<span class="hljs-number"><span class="hljs-number">2</span></span>+$i}] } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sign$res } ############### #RGB565 -&gt; RGB888 using tables set t5 [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-number"><span class="hljs-number">33</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">58</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">74</span></span> <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">90</span></span> <span class="hljs-number"><span class="hljs-number">99</span></span> <span class="hljs-number"><span class="hljs-number">107</span></span> <span class="hljs-number"><span class="hljs-number">115</span></span> <span class="hljs-number"><span class="hljs-number">123</span></span> <span class="hljs-number"><span class="hljs-number">132</span></span>\ <span class="hljs-number"><span class="hljs-number">140</span></span> <span class="hljs-number"><span class="hljs-number">148</span></span> <span class="hljs-number"><span class="hljs-number">156</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> <span class="hljs-number"><span class="hljs-number">173</span></span> <span class="hljs-number"><span class="hljs-number">181</span></span> <span class="hljs-number"><span class="hljs-number">189</span></span> <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-number"><span class="hljs-number">214</span></span> <span class="hljs-number"><span class="hljs-number">222</span></span> <span class="hljs-number"><span class="hljs-number">230</span></span> <span class="hljs-number"><span class="hljs-number">239</span></span> <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>] set t6 [list <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">45</span></span> <span class="hljs-number"><span class="hljs-number">49</span></span> <span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">61</span></span> <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">69</span></span>\ <span class="hljs-number"><span class="hljs-number">73</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> <span class="hljs-number"><span class="hljs-number">85</span></span> <span class="hljs-number"><span class="hljs-number">89</span></span> <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">97</span></span> <span class="hljs-number"><span class="hljs-number">101</span></span> <span class="hljs-number"><span class="hljs-number">105</span></span> <span class="hljs-number"><span class="hljs-number">109</span></span> <span class="hljs-number"><span class="hljs-number">113</span></span> <span class="hljs-number"><span class="hljs-number">117</span></span> <span class="hljs-number"><span class="hljs-number">121</span></span> <span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-number"><span class="hljs-number">130</span></span> <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-number"><span class="hljs-number">138</span></span>\ <span class="hljs-number"><span class="hljs-number">142</span></span> <span class="hljs-number"><span class="hljs-number">146</span></span> <span class="hljs-number"><span class="hljs-number">150</span></span> <span class="hljs-number"><span class="hljs-number">154</span></span> <span class="hljs-number"><span class="hljs-number">158</span></span> <span class="hljs-number"><span class="hljs-number">162</span></span> <span class="hljs-number"><span class="hljs-number">166</span></span> <span class="hljs-number"><span class="hljs-number">170</span></span> <span class="hljs-number"><span class="hljs-number">174</span></span> <span class="hljs-number"><span class="hljs-number">178</span></span> <span class="hljs-number"><span class="hljs-number">182</span></span> <span class="hljs-number"><span class="hljs-number">186</span></span> <span class="hljs-number"><span class="hljs-number">190</span></span> <span class="hljs-number"><span class="hljs-number">194</span></span> <span class="hljs-number"><span class="hljs-number">198</span></span>\ <span class="hljs-number"><span class="hljs-number">202</span></span> <span class="hljs-number"><span class="hljs-number">206</span></span> <span class="hljs-number"><span class="hljs-number">210</span></span> <span class="hljs-number"><span class="hljs-number">215</span></span> <span class="hljs-number"><span class="hljs-number">219</span></span> <span class="hljs-number"><span class="hljs-number">223</span></span> <span class="hljs-number"><span class="hljs-number">227</span></span> <span class="hljs-number"><span class="hljs-number">231</span></span> <span class="hljs-number"><span class="hljs-number">235</span></span> <span class="hljs-number"><span class="hljs-number">239</span></span> <span class="hljs-number"><span class="hljs-number">243</span></span> <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-number"><span class="hljs-number">251</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>] ############### #  .         set script_path [get_property DIRECTORY [get_projects *]] cd $script_path #       set fId [<span class="hljs-keyword"><span class="hljs-keyword">open</span></span> {pic_array.dat} r] # ,       set pixels [list ] #    .    gets $fId <span class="hljs-literal"><span class="hljs-literal">line</span></span> #  .     . <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $fId <span class="hljs-literal"><span class="hljs-literal">line</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>} { set pixels [concat $pixels $<span class="hljs-literal"><span class="hljs-literal">line</span></span>] } #   pixels   <span class="hljs-string"><span class="hljs-string">"};"</span></span>,    Image2Bitmap set pixels [lrange $pixels <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>] #    pixels set pix_num <span class="hljs-number"><span class="hljs-number">0</span></span>; #      <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {set y <span class="hljs-number"><span class="hljs-number">0</span></span>} { $y &lt; $h } {incr y} { #    ( ) set Y [expr {$start_y - $y}] #    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> {set x <span class="hljs-number"><span class="hljs-number">0</span></span>} { $x &lt; $w } {incr x } { set pix_val [lindex $pixels $pix_num]; incr pix_num #   binary  set pix_bin [hex2bin $pix_val] ; #     set R_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>] #    set R_dec [ bin2dec $R_bin ] #       t5 set R [lindex $t5 $R_dec] #       set G_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>] set G [lindex $t6 [ bin2dec $G_bin ]] set B_bin [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $pix_bin <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>] set B [lindex $t5 [ bin2dec $B_bin ] ] #    set X [expr {$start_x + $x}] #,      set cond [get_sites <span class="hljs-string"><span class="hljs-string">"SLICE_X${X}Y${Y}"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$cond ne <span class="hljs-string"><span class="hljs-string">""</span></span>} { #  highlight_objects [get_sites <span class="hljs-string"><span class="hljs-string">"SLICE_X${X}Y${Y}"</span></span>] -rgb <span class="hljs-string"><span class="hljs-string">"$R $G $B"</span></span> } puts <span class="hljs-string"><span class="hljs-string">"X = $XY = $Y; $R $G $B"</span></span> } } close $fId puts <span class="hljs-string"><span class="hljs-string">"Complete::Check FPGA field::Window-&gt;Device"</span></span></code> </pre> </div></div><br><h2 id="testirovanie">  Prueba </h2><br><ol><li><p>  Para comenzar a probar, aseg√∫rese de que el campo FPGA est√© disponible para usted, es decir  Una de las etapas de dise√±o es abierta: elaborada, s√≠ntesis o implementada.  Para mostrar el campo FPGA, seleccione Ventana ‚Üí Dispositivo <br><br><img src="https://habrastorage.org/webt/sz/_n/cd/sz_ncdlckd-5rqbvicyshqmulxu.png"></p><br></li><li><p>  Abra el archivo pic_array.dat y copie los datos de Image2Bitmap en el archivo.  Guardar archivo <br><br><img src="https://habrastorage.org/webt/gf/bo/qk/gfboqkmege_xbatauuqznugutls.png"></p><br></li><li><p>  Abramos el gui√≥n.  Establezca la coordenada de los p√≠xeles superiores izquierdo 0 y 49, el tama√±o de la imagen de prueba es de 5 por 3 y ejecute el script.  Para hacer esto, haga clic derecho en el campo de secuencia de comandos y seleccione Ejecutar. <br><br><img src="https://habrastorage.org/webt/z6/ku/xk/z6kuxks3efxqgcg6w-ml18pwaic.png"></p><br></li><li><p>  Vaya a la consola Tcl y aseg√∫rese de que el script se haya ejecutado. <br><br><img src="https://habrastorage.org/webt/km/of/qr/kmofqrtlejamixfiwexviemy4ay.png"></p><br></li><li><p>  Vaya a la pesta√±a Dispositivo y aseg√∫rese de que las celdas est√©n coloreadas en el color apropiado. <br><br><img src="https://habrastorage.org/webt/xv/ba/nf/xvbanfmjcmx9lqxxofnq04wxwf0.png"></p><br></li><li><p>  Ahora podemos tomar cualquier imagen, convertirla al tama√±o deseado y completar el campo FPGA.  A continuaci√≥n hay algunos ejemplos. </p><br></li></ol><br><p>  <em>PD: la asignaci√≥n de color personalizada reemplaza la configuraci√≥n de color predeterminada de Vivado</em> <br><br><img src="https://habrastorage.org/webt/oz/hx/f4/ozhxf4slhbnycmhqmpfxbsb7fby.png"></p><br><h2 id="spisok-literatury">  Referencias </h2><br><ol><li>  UG835.  Gu√≠a de referencia de TclCommand de Vivado Design Suite </li><li>  <a href="">https://github.com/FoxExe/Image2Bitmap/releases/tag/0.5</a> </li><li>  <a href="https://tcl.tk/">https://tcl.tk</a> </li><li>  <a href="http://www.tune-it.ru/web/il/home/-/blogs/%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5-rgb888">http://www.tune-it.ru/web/il/home/-/blogs/conversion-rgb888</a> - &lt;-&gt; -rgb565-and-protection-mushrooms-from-fading </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/477974/">https://habr.com/ru/post/477974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../477956/index.html">JavaScript en 3D: una introducci√≥n a Three.js</a></li>
<li><a href="../477958/index.html">Las 10 principales tendencias del nuevo informe de tendencias de delincuencia de alta tecnolog√≠a 2019/2020 Group-IB</a></li>
<li><a href="../477964/index.html">Dos meses desde la idea hasta la primera venta: experiencia del equipo Genesis</a></li>
<li><a href="../477966/index.html">HolyJS 2019 Mosc√∫ a trav√©s de los ojos del participante</a></li>
<li><a href="../477968/index.html">Caer en una madriguera de conejo: una historia sobre un error de reinicio de barniz - Parte 1</a></li>
<li><a href="../477976/index.html">Visualizaci√≥n y an√°lisis de la estructura comunitaria mediante gr√°ficos.</a></li>
<li><a href="../478472/index.html">Biblioteca de kernel de Linux: kernel de Linux en formato so o dll</a></li>
<li><a href="../478474/index.html">El hermano Pablo Escobar tambi√©n lanz√≥ un tel√©fono inteligente flexible</a></li>
<li><a href="../478480/index.html">Inteligencia artificial, ITSM y, en general, ¬ød√≥nde est√° LEAN?</a></li>
<li><a href="../478482/index.html">El desarrollador abri√≥ una barra para desarrolladores y anfitriones de reuniones all√≠ en Angular, dise√±o, PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>