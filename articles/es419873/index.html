<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ôçÔ∏è üâê üë©üèæ‚Äçüöí Probar solo a trav√©s de m√©todos p√∫blicos es malo üëâüèº üìÅ ‚ú≥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En programaci√≥n y en TDD, en particular, hay buenos principios a los que es √∫til adherirse: DRY y pruebas a trav√©s de m√©todos p√∫blicos. Repetidamente ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Probar solo a trav√©s de m√©todos p√∫blicos es malo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419873/">  En programaci√≥n y en TDD, en particular, hay buenos principios a los que es √∫til adherirse: DRY y pruebas a trav√©s de m√©todos p√∫blicos.  Repetidamente demostraron su val√≠a en la pr√°ctica, pero en proyectos con un gran c√≥digo heredado pueden tener un "lado oscuro".  Por ejemplo, puede escribir c√≥digo guiado por estos principios, y luego encontrarse desarmando pruebas que cubren un mont√≥n de m√°s de 20 abstracciones con una configuraci√≥n que es incomparablemente m√°s grande que la l√≥gica probada.  Este "lado oscuro" asusta a las personas e inhibe el uso de TDD en proyectos.  Bajo el corte, analizo por qu√© las pruebas a trav√©s de m√©todos p√∫blicos son malas y c√≥mo reducir los problemas que surgen debido a este principio. <a name="habracut"></a><br><br><div class="spoiler">  <b class="spoiler_title">Descargo de responsabilidad</b> <div class="spoiler_text"> Inmediatamente quiero disipar la posible impresi√≥n.  Es posible que algunos ni siquiera sientan los inconvenientes que se discutir√°n, debido, por ejemplo, al tama√±o de sus proyectos.  Adem√°s, estas deficiencias, en mi opini√≥n, son parte de la deuda t√©cnica y tienen las mismas caracter√≠sticas: el problema crecer√° si no se le presta atenci√≥n.  Por lo tanto, es necesario decidir seg√∫n la situaci√≥n. <br></div></div><br>  La idea que subyace al principio suena bien: debe probar el comportamiento, no la implementaci√≥n.  Esto significa que solo necesita probar la interfaz de clase.  En la pr√°ctica, este no es siempre el caso.  Para presentar la esencia del problema, imagine que tiene un m√©todo que calcula el costo de los trabajadores que trabajan en turnos.  Esta es una tarea no trivial cuando se trata de turnos de trabajo, ya que  tienen propinas, bonos, fines de semana, feriados, reglas corporativas, etc., etc. Este m√©todo realiza internamente muchas operaciones y utiliza otros servicios que le brindan informaci√≥n sobre feriados, propinas, etc.  al escribir una prueba unitaria para ello, es necesario crear una configuraci√≥n para todos los servicios utilizados, si el c√≥digo probado se encuentra en alg√∫n lugar al final del m√©todo.  Al mismo tiempo, el c√≥digo probado solo puede usar parcialmente o no usar servicios configurables.  Y ya hay algunas pruebas unitarias escritas de esta manera. <br><br><h2>  Menos 1: sobreconfiguraci√≥n de prueba de unidad </h2><br>  Ahora desea agregar una reacci√≥n a una nueva caracter√≠stica que tiene una l√≥gica no trivial y tambi√©n se usa en alg√∫n lugar al final del m√©todo.  La naturaleza del indicador es tal que forma parte de la l√≥gica del servicio y, al mismo tiempo, no forma parte de la interfaz del servicio.  En el caso anterior, este c√≥digo solo es relevante para este m√©todo p√∫blico, y generalmente puede inscribirse dentro del m√©todo anterior. <br><br>  Si el proyecto adopt√≥ la regla para probar todo solo a trav√©s de m√©todos p√∫blicos, lo m√°s probable es que el desarrollador simplemente copie alguna prueba unitaria existente y la ajuste un poco.  En la nueva prueba, todav√≠a habr√° una configuraci√≥n de todos los servicios para ejecutar el m√©todo.  Por un lado, cumplimos con el principio, pero, por otro lado, obtuvimos una prueba unitaria con sobreconfiguraci√≥n.  En el futuro, si algo se rompe o requiere un cambio de configuraci√≥n, tendr√° que hacer el trabajo de mono para ajustar las pruebas.  Es tedioso, largo y no brinda alegr√≠a ni beneficio aparente para el cliente.  Parece que estamos siguiendo el principio correcto, pero estamos en la misma situaci√≥n de la que quer√≠amos escapar, neg√°ndonos a probar m√©todos privados. <br><br><h2>  Menos 2: cobertura incompleta </h2><br>  Adem√°s, puede intervenir un factor humano como la pereza.  Por ejemplo, un m√©todo privado con l√≥gica de bandera no trivial puede verse en este ejemplo. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HasShifts</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DateTime date, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tolerance, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> clockIn, Shift[] shifts, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] locationIds</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isInLimit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DateTime date1, DateTime date2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit</span></span></span><span class="hljs-function">)</span></span> =&gt; Math.Abs(date2.Subtract(date1).TotalMinutes) &lt;= limit; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> shiftsOfLocations = shifts.Where(x =&gt; locationIds.Contains(x.LocationId)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clockIn ? shiftsOfLocations.Any(x =&gt; isInLimit(date, x.StartDate, tolerance)) : shiftsOfLocations.Any(x =&gt; isInLimit(date, x.EndDate, tolerance)); }</code> </pre> <br>  Este m√©todo requiere 10 controles para cubrir todos los casos, 8 de los cuales son significativos. <br><br><div class="spoiler">  <b class="spoiler_title">Decodificando 8 casos importantes</b> <div class="spoiler_text"><ul><li>  shiftsOfLocations - 2 valores - si o no </li><li>  clockIn - 2 valores - verdadero o falso </li><li>  tolerancia - 2 significados diferentes </li></ul><br>  Total: 2 x 2 x 2 = 8 <br></div></div><br>  Al escribir pruebas unitarias para probar esta l√≥gica, un desarrollador tendr√° que escribir al menos 8 pruebas unitarias grandes.  Me encontr√© con casos en los que la configuraci√≥n de prueba de la unidad ocupaba m√°s de 50 l√≠neas de c√≥digo, con 4 l√≠neas de una llamada directa.  Es decir  solo alrededor del 10% del c√≥digo lleva una carga √∫til.  En este caso, la tentaci√≥n es excelente para reducir la cantidad de trabajo al escribir menos pruebas unitarias.  Como resultado, de 8, por ejemplo, solo quedan dos pruebas unitarias, para cada valor clockIn.  Esta situaci√≥n lleva al hecho de que, una vez m√°s, es tedioso y largo escribir todas las pruebas necesarias, creando la configuraci√≥n (Ctrl + C, V funciona, sin ella), o el m√©todo solo queda parcialmente cubierto.  Cada opci√≥n tiene sus consecuencias desagradables. <br><br><h2>  Posibles soluciones </h2><br>  Adem√°s del principio "comportamiento de prueba", todav√≠a hay OCP (principio abierto / cerrado).  Al aplicarlo correctamente, puede olvidar lo que son las "pruebas fr√°giles", probando el comportamiento interno del m√≥dulo.  Si necesita un nuevo comportamiento del m√≥dulo, escribir√° nuevas pruebas unitarias para la nueva clase sucesora en la que se cambiar√° el comportamiento que necesita.  Entonces no tendr√° que perder tiempo en volver a verificar y actualizar las pruebas existentes.  En este caso, este m√©todo puede declararse como interno o protegido interno, y probarse agregando InternalsVisibleTo al ensamblaje.  En este caso, su interfaz IClass no sufrir√°, y las pruebas ser√°n las m√°s lac√≥nicas, no sujetas a cambios frecuentes. <br><br>  Otra alternativa ser√≠a declarar una clase auxiliar adicional en la que nuestro m√©todo se pueda extraer declar√°ndolo como p√∫blico.  Entonces se observar√° el principio y la prueba ser√° concisa.  En mi opini√≥n, este enfoque no siempre vale la pena.  Por ejemplo, algunos pueden decidir incluir incluso un m√©todo en una clase, lo que lleva a la creaci√≥n de un grupo de clases con un m√©todo.  El otro extremo puede ser volcar tales m√©todos en una clase auxiliar, que se convierte en una clase auxiliar de Dios.  Pero esta opci√≥n con un ayudante puede ser la √∫nica si el ensamblaje de trabajo est√° firmado con un nombre seguro y, por alguna raz√≥n, no puede firmar el ensamblaje de prueba.  InternalsVisibleTo funcionar√° cuando ambos conjuntos est√©n firmados o no a la vez. <br><br><h2>  Resumen </h2><br>  Y al final, debido a una combinaci√≥n de tales problemas, la idea de TDD y pruebas unitarias sufre, porque  nadie tiene el deseo de escribir pruebas volum√©tricas y apoyarlas.  Me alegrar√° ver ejemplos de c√≥mo la estricta adherencia a este principio condujo a problemas y redujo la motivaci√≥n para escribir pruebas del equipo de desarrollo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es419873/">https://habr.com/ru/post/es419873/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es419863/index.html">Concurso semanal para desarrolladores de OpenGift</a></li>
<li><a href="../es419865/index.html">C√≥mo escribir accidentalmente una GUI web para Haproxy</a></li>
<li><a href="../es419867/index.html">Seis mitos m√°s sobre la cadena de bloques, ¬ød√≥nde se seguir√° aplicando?</a></li>
<li><a href="../es419869/index.html">La revoluci√≥n de la IA no ser√° hecha por droides, sino por tostadoras</a></li>
<li><a href="../es419871/index.html">C√≥mo Google est√° tratando de desarrollar un motor de b√∫squeda censurado para China</a></li>
<li><a href="../es419875/index.html">Una vez m√°s sobre retrasos en el c√≥digo fuente del proyecto FPGA o una simple pregunta para una entrevista para un trabajo de desarrollador FPGA</a></li>
<li><a href="../es419877/index.html">C√≥mo inventamos nuevamente la "casa inteligente"</a></li>
<li><a href="../es419879/index.html">PWA es f√°cil. Hola joomla</a></li>
<li><a href="../es419883/index.html">Obtenga la diferencia entre archivos binarios usando vcdiff</a></li>
<li><a href="../es419885/index.html">Traducci√≥n del libro de Andrew Un, Pasi√≥n por el aprendizaje autom√°tico, cap√≠tulos 15-19</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>