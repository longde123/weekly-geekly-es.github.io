<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï§ üíÖüèº üë©üèΩ‚Äçü§ù‚Äçüë®üèº Tireur de r√©seau de navigateur sur Node.js üë®‚Äç‚öñÔ∏è üóÇÔ∏è üë®üèæ‚Äçüîß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le d√©veloppement de jeux multijoueurs est compliqu√© pour de nombreuses raisons: leur h√©bergement peut √™tre co√ªteux, la structure n'est pas √©vidente et...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tireur de r√©seau de navigateur sur Node.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418411/"> Le d√©veloppement de jeux multijoueurs est compliqu√© pour de nombreuses raisons: leur h√©bergement peut √™tre co√ªteux, la structure n'est pas √©vidente et la mise en ≈ìuvre est difficile.  Dans ce tutoriel, je vais essayer de vous aider √† surmonter la derni√®re barri√®re. <br><br>  Cet article est destin√© aux d√©veloppeurs qui peuvent cr√©er des jeux et qui connaissent JavaScript, mais qui n'ont jamais √©crit de jeux en ligne multijoueurs auparavant.  Apr√®s avoir termin√© ce didacticiel, vous ma√Ætriserez l'impl√©mentation des composants r√©seau de base dans votre jeu et pourrez le d√©velopper en quelque chose de plus!  Voici ce que nous allons cr√©er: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e9a/220/340/e9a22034098ab10a84721a48615a1476.png"></div><br>  Vous pouvez jouer le jeu termin√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> !  Lorsque vous appuyez sur les touches W ou "haut", le vaisseau s'approche du curseur, lorsque vous cliquez sur la souris, il tire.  <em>(Si personne n'est en ligne, pour v√©rifier le fonctionnement du multijoueur, ouvrez deux fen√™tres de navigateur sur un ordinateur ou l'une d'entre elles sur le t√©l√©phone).</em>  Si vous souhaitez ex√©cuter le jeu localement, le code source complet est disponible sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external">GitHub</a> . <br><a name="habracut"></a><br>  Lors de la cr√©ation du jeu, j'ai utilis√© les ressources graphiques du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external">Kenney's Pirate Pack</a> et du framework de jeu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external">Phaser</a> .  Dans ce didacticiel, vous √™tes affect√© au r√¥le de programmeur r√©seau.  Le point de d√©part sera une version mono-utilisateur enti√®rement fonctionnelle du jeu, et notre t√¢che sera d'√©crire un serveur sur Node.js en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Socket.io</a> pour la partie r√©seau.  Afin de ne pas surcharger le tutoriel, je vais me concentrer sur les parties li√©es au multijoueur et ignorer les concepts li√©s √† Phaser et Node.js. <br><br>  Vous n'avez pas besoin de configurer quoi que ce soit localement, car nous allons cr√©er ce jeu compl√®tement dans le navigateur sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Glitch.com</a> !  Glitch est un outil g√©nial pour cr√©er des applications Web, y compris des backends, des bases de donn√©es, etc.  Il est id√©al pour le prototypage, la formation et la collaboration, et je serai tr√®s heureux de vous pr√©senter ses capacit√©s dans ce tutoriel. <br><br>  Commen√ßons. <br><br><h2>  1. Pr√©paration </h2><br>  J'ai post√© l'√©bauche du projet sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external">Glitch.com</a> . <br><br>  Conseils d'interface: vous pouvez lancer l'aper√ßu de l'application en cliquant sur le bouton <strong>Afficher</strong> (en haut √† gauche). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac2/8b6/4dd/ac28b64dd9c37370872ad6a913b10078.png"></div><br>  La barre lat√©rale verticale √† gauche contient tous les fichiers d'application.  Pour √©diter cette application, vous devez cr√©er son ¬´remix¬ª.  Nous allons donc en cr√©er une copie dans notre compte (ou ¬´fork¬ª en jargon git).  Cliquez sur le bouton <strong>Remixer ce</strong> bouton. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f71/88f/6e4/f7188f6e4b66e9b9801d04c7891d42dd.png"></div><br>  √Ä ce stade, vous modifiez l'application sous un compte anonyme.  Pour enregistrer votre travail, vous pouvez vous connecter (en haut √† droite). <br><br>  Maintenant, avant de continuer, il est important que vous vous familiarisiez avec le jeu dans lequel nous ajouterons un mode multijoueur.  Jetez un ≈ìil √† <strong>index.html</strong> .  Il a trois fonctions importantes que vous devez conna√Ætre: <code>preload</code> (ligne 99), <code>create</code> (ligne 115) et <code>GameLoop</code> (ligne 142), ainsi que l'objet joueur (ligne 35). <br><br>  Si vous pr√©f√©rez apprendre en vous entra√Ænant, assurez-vous de comprendre le travail du jeu en effectuant les t√¢ches suivantes: <br><br><ul><li>  Augmentez la taille du monde <em>(ligne 29)</em> - <em>notez qu'il existe une taille du monde distincte pour le monde du jeu et une taille de fen√™tre pour le canevas de page lui-m√™me</em> . </li><li>  Permet d'avancer √† l'aide de ¬´l'espace¬ª <em>(ligne 53).</em> </li><li>  Modifiez le type de navire du joueur <em>(ligne 129).</em> </li><li>  Ralentissez le mouvement des obus <em>(ligne 155).</em> </li></ul><br><h3>  Installez Socket.io </h3><br>  Socket.io est une biblioth√®que pour g√©rer les communications en temps r√©el √† l'int√©rieur d'un navigateur √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">WebSockets</a> (au lieu d'utiliser des protocoles comme UDP, qui sont utilis√©s pour cr√©er des jeux multijoueurs classiques).  De plus, la biblioth√®que dispose de moyens redondants pour garantir son fonctionnement, m√™me lorsque les WebSockets ne sont pas pris en charge.  Autrement dit, elle s'occupe des protocoles de messagerie et permet l'utilisation d'un syst√®me de messagerie bas√© sur les √©v√©nements. <br><br>  La premi√®re chose que nous devons faire est d'installer le module Socket.io.  Dans Glitch, cela peut √™tre fait en acc√©dant au fichier <strong>package.json</strong> , puis en entrant le module requis dans les d√©pendances, ou en cliquant sur <strong>Ajouter un package</strong> et en entrant ¬´socket.io¬ª. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d94/41f/005/d9441f0059e23044aa69f6f8750c81bb.png"></div><br>  C'est le bon moment pour g√©rer les journaux du serveur.  Cliquez sur le bouton <strong>Journaux</strong> √† gauche pour ouvrir le journal du serveur.  Vous devriez voir qu'il installe Socket.io avec toutes ses d√©pendances.  C'est l√† que vous devez rechercher toutes les erreurs et la sortie du code serveur. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7db/6e1/58c/7db6e158c6e48d0d91f70344eaf51af7.png"></div><br>  Passons maintenant √† <strong>server.js</strong> .  C'est l√† que se trouve notre code serveur.  Jusqu'√† pr√©sent, il n'y a que du code standard pour servir notre HTML.  Ajoutez une ligne en haut du fichier pour activer Socket.io: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> io = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>)(http); <span class="hljs-comment"><span class="hljs-comment">//     http</span></span></code> </pre> <br>  Maintenant, nous devons √©galement activer Socket.io dans le client, revenons donc √† <strong>index.html</strong> et ajoutons les lignes suivantes √† l'int√©rieur de la <code>&lt;head&gt;</code> : <br><br><pre> <code class="javascript hljs">&lt;!--    Socket.io --&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/socket.io/socket.io.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  <em>Remarque: Socket.io traite automatiquement le chargement de la biblioth√®que cliente le long de ce chemin, donc cette ligne fonctionne m√™me s'il n'y a pas de r√©pertoire /socket.io/ dans vos dossiers.</em> <br><br>  Maintenant, Socket.io est inclus dans le projet et pr√™t √† d√©marrer! <br><br><h2>  2. Reconnaissance et ponte des joueurs </h2><br>  Notre premi√®re vraie √©tape sera d'accepter les connexions sur le serveur et de cr√©er de nouveaux joueurs dans le client. <br><br><h3>  Accepter les connexions au serveur </h3><br>  Ajoutez ce code au bas de <strong>server.js</strong> : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  Socket.io    io.on('connection', function(socket){ console.log("New client has connected with id:",socket.id); })</span></span></code> </pre> <br>  Nous demandons donc √† Socket.io d'√©couter tous <code>connection</code> √©v√©nements de <code>connection</code> qui se produisent automatiquement lorsqu'un client se connecte.  La biblioth√®que cr√©e un nouvel objet <code>socket</code> pour chaque client, o√π <code>socket.id</code> est l'identificateur unique de ce client. <br><br>  Pour v√©rifier que cela fonctionne, revenez au client ( <strong>index.html</strong> ) et ajoutez cette ligne quelque part dans la fonction de <strong>cr√©ation</strong> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> socket = io(); <span class="hljs-comment"><span class="hljs-comment">//    'connection'  </span></span></code> </pre> <br>  Si vous d√©marrez le jeu et regardez le journal du serveur (cliquez sur le bouton <strong>Journaux</strong> ), vous verrez que le serveur a enregistr√© cet √©v√©nement de connexion! <br><br>  Maintenant, lors de la connexion d'un nouveau joueur, nous attendons de lui qu'il nous donne des informations sur son √©tat.  Dans notre cas, nous devons conna√Ætre au moins <strong>x</strong> , <strong>y</strong> et l' <strong>angle</strong> afin de le cr√©er correctement au bon point. <br><br>  L'√©v√©nement de <code>connection</code> √©tait un √©v√©nement en ligne d√©clench√© par Socket.io.  Nous pouvons √©couter tous les √©v√©nements d√©finis ind√©pendamment.  Je nommerai mon <code>new-player</code> √©v√©nement, et je m'attendrai √† ce que le client l'envoie d√®s qu'il se connecte avec des informations sur sa position.  Cela ressemblera √† ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  Socket.io    io.on('connection', function(socket){ console.log("New client has connected with id:",socket.id); socket.on('new-player',function(state_data){ //   new-player    console.log("New player has state:",state_data); }) })</span></span></code> </pre> <br>  Si vous ex√©cutez ce code, jusqu'√† ce que vous voyiez quoi que ce soit dans le journal du serveur, car nous n'avons pas encore dit au client de g√©n√©rer cet √©v√©nement de <code>new-player</code> .  Mais supposons un instant que nous l'avons d√©j√† fait et continuons √† travailler sur le serveur.  Que devrait-il se passer apr√®s avoir obtenu l'emplacement d'un nouveau joueur se joignant? <br><br>  Nous pouvons envoyer un message √† tous les <em>autres</em> joueurs connect√©s afin qu'ils sachent qu'un nouveau joueur est apparu.  Socket.io a une fonction pratique pour cela: <br><br><pre> <code class="javascript hljs">socket.broadcast.emit(<span class="hljs-string"><span class="hljs-string">'create-player'</span></span>,state_data);</code> </pre> <br>  Lorsque <code>socket.emit</code> appel√© <code>socket.emit</code> message est simplement transmis √† ce client unique.  Lorsque <code>socket.broadcast.emit</code> est appel√© <code>socket.broadcast.emit</code> il est envoy√© √† chaque client connect√© au serveur, sauf sur le socket duquel cette fonction a √©t√© appel√©e. <br><br>  La fonction <code>io.emit</code> envoie un message √† chaque client connect√© au serveur sans aucune exception.  Dans notre sch√©ma, nous n'en avons pas besoin, car si nous recevons un message du serveur nous demandant de cr√©er notre propre vaisseau, nous obtiendrons un double du sprite, car nous avons d√©j√† cr√©√© notre propre vaisseau au d√©but du jeu.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Voici une astuce pratique</a> sur les diff√©rents types de fonctionnalit√©s de messagerie que nous utiliserons dans ce didacticiel. <br><br>  Le code du serveur devrait maintenant ressembler √† ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  Socket.io    io.on('connection', function(socket){ console.log("New client has connected with id:",socket.id); socket.on('new-player',function(state_data){ //   new-player    console.log("New player has state:",state_data); socket.broadcast.emit('create-player',state_data); }) })</span></span></code> </pre> <br>  Autrement dit, chaque fois qu'un joueur se connecte, nous nous attendons √† ce qu'il nous envoie un message avec des informations sur sa position, et nous envoyons ces donn√©es √† tous les autres joueurs afin qu'ils puissent cr√©er son sprite. <br><br><h3>  G√©n√©ration de clients </h3><br>  Maintenant, pour terminer ce cycle, nous devons effectuer deux actions dans le client: <br><br><ol><li>  G√©n√©rez un message avec les donn√©es de notre emplacement apr√®s la connexion. </li><li>  √âcoutez les √©v√©nements de <code>create-player</code> et cr√©ez un joueur √† ce stade. </li></ol><br>  Pour effectuer la premi√®re action apr√®s avoir cr√©√© un joueur dans la fonction de <strong>cr√©ation</strong> (approximativement √† la ligne 135), nous pouvons g√©n√©rer un message contenant les donn√©es de localisation que nous devons envoyer: <br><br><pre> <code class="javascript hljs">socket.emit(<span class="hljs-string"><span class="hljs-string">'new-player'</span></span>,{<span class="hljs-attr"><span class="hljs-attr">x</span></span>:player.sprite.x,<span class="hljs-attr"><span class="hljs-attr">y</span></span>:player.sprite.y,<span class="hljs-attr"><span class="hljs-attr">angle</span></span>:player.sprite.rotation})</code> </pre> <br>  Nous n'avons pas √† nous soucier de la s√©rialisation des donn√©es envoy√©es.  Vous pouvez les transf√©rer dans n'importe quel type d'objet, et Socket.io le traitera pour nous. <br><br>  Avant de continuer, <em>testez le code</em> .  Nous devrions voir un message similaire dans les journaux du serveur: <br><br><pre> <code class="javascript hljs">New player has state: { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">728.8180247836519</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">261.9979387913289</span></span>, <span class="hljs-attr"><span class="hljs-attr">angle</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }</code> </pre> <br>  Nous savons maintenant que notre serveur re√ßoit une notification sur la connexion d'un nouveau lecteur et lit correctement les donn√©es sur son emplacement! <br><br>  Ensuite, nous voulons √©couter les demandes de cr√©ation d'un nouveau lecteur.  Nous pouvons placer ce code imm√©diatement apr√®s avoir g√©n√©r√© le message, il devrait ressembler √† ceci: <br><br><pre> <code class="javascript hljs">socket.on(<span class="hljs-string"><span class="hljs-string">'create-player'</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// CreateShip -      ,     CreateShip(1,state.x,state.y,state.angle) })</span></span></code> </pre> <br>  Testez maintenant <em>le code</em> .  Ouvrez deux fen√™tres avec le jeu et assurez-vous que cela fonctionne. <br><br>  Vous devriez voir qu'apr√®s avoir ouvert deux clients, le premier client a cr√©√© deux navires et le second n'en a qu'un. <br><br><blockquote>  T√¢che: pouvez-vous comprendre pourquoi cela s'est produit?  Ou comment pouvez-vous r√©soudre ce probl√®me?  Suivez pas √† pas la logique client / serveur que nous avons √©crite et essayez de la d√©boguer. </blockquote><br>  J'esp√®re que vous avez essay√© de le d√©couvrir par vous-m√™me!  Voici ce qui se passe: lorsque le premier joueur se connecte, le serveur envoie un √©v√©nement <code>create-player</code> √† tous les autres joueurs, mais aucun joueur ne peut encore le recevoir.  Apr√®s avoir connect√© le deuxi√®me joueur, le serveur envoie √† nouveau ses messages, et le premier joueur le re√ßoit et cr√©e correctement le sprite, tandis que le deuxi√®me joueur a rat√© le message du premier joueur. <br><br>  Autrement dit, le probl√®me est que le deuxi√®me joueur se connecte au jeu plus tard et qu'il a besoin de conna√Ætre l'√©tat du jeu.  Nous devons informer tous les nouveaux joueurs connect√©s que les joueurs existent d√©j√† (ainsi que d'autres √©v√©nements qui ont eu lieu dans le monde) afin qu'ils puissent s'orienter.  Avant de passer √† la r√©solution de ce probl√®me, j'ai un bref avertissement. <br><br><h3>  Avertissement de synchronisation de l'√©tat du jeu </h3><br>  Il existe deux approches pour impl√©menter la synchronisation de tous les joueurs.  La premi√®re consiste √† envoyer un minimum d'informations sur les changements survenus sur le r√©seau.  Autrement dit, chaque fois qu'un nouveau joueur est connect√©, nous n'enverrons √† tous les autres joueurs que des informations sur ce nouveau joueur (et enverrons une liste de tous les autres joueurs du monde √† ce nouveau joueur), et apr√®s la d√©connexion, nous informerons tous les joueurs que ce joueur particulier s'est d√©connect√©. <br><br>  La deuxi√®me approche consiste √† transmettre l'√©tat du jeu dans son int√©gralit√©.  Dans ce cas, chaque fois que vous vous connectez ou vous d√©connectez, nous envoyons √† chacun une liste compl√®te de tous les joueurs. <br><br>  La premi√®re approche est meilleure en ce qu'elle minimise la quantit√© d'informations transmises sur le r√©seau, mais elle peut √™tre tr√®s difficile √† mettre en ≈ìuvre et il est probable que les joueurs ne soient pas synchronis√©s.  La seconde garantit que les joueurs sont toujours synchronis√©s, mais chaque message devra envoyer plus de donn√©es. <br><br>  Dans notre cas, au lieu d'essayer d'envoyer des messages lorsqu'un joueur est connect√© pour le cr√©er et lorsqu'il est d√©connect√© pour le supprimer, ainsi que lors d'un d√©placement pour mettre √† jour sa position, nous pouvons combiner tout cela en un seul √©v√©nement de <code>update</code> commun.  Cet √©v√©nement de mise √† jour enverra toujours les positions de chaque joueur √† tous les clients.  C'est ce que le serveur doit faire.  La t√¢che du client est de maintenir la conformit√© du monde avec l'√©tat re√ßu. <br><br>  Pour mettre en ≈ìuvre un tel sch√©ma, je ferai ce qui suit: <br><br><ol><li>  Je garderai un dictionnaire des joueurs, dont la cl√© sera leur identifiant, et la valeur sera les donn√©es sur leur emplacement. </li><li>  Ajoutez un lecteur √† ce dictionnaire lorsqu'il est connect√© et envoyez un √©v√©nement de mise √† jour. </li><li>  Supprimez le lecteur de ce dictionnaire lorsqu'il est √©teint et envoyez un √©v√©nement de mise √† jour. </li></ol><br>  Vous pouvez essayer d'impl√©menter ce syst√®me vous-m√™me, car ces √©tapes sont assez simples ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external">mon conseil sur les fonctionnalit√©s</a> peut √™tre utile ici).  Voici √† quoi pourrait ressembler l'impl√©mentation compl√®te: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  Socket.io    // 1 -      / var players = {}; io.on('connection', function(socket){ console.log("New client has connected with id:",socket.id); socket.on('new-player',function(state_data){ //   new-player    console.log("New player has state:",state_data); // 2 -      players[socket.id] = state_data; //    io.emit('update-players',players); }) socket.on('disconnect',function(){ // 3-       delete players[socket.id]; //    }) })</span></span></code> </pre> <br>  Le c√¥t√© client est un peu plus compliqu√©.  D'une part, nous ne devrions plus nous pr√©occuper que de l'√©v√©nement <code>update-players</code> , mais d'autre part, nous devrions envisager de cr√©er de nouveaux navires si le serveur envoie plus de navires que nous ne le pensons, ou de les supprimer s'il y en a trop. <br><br>  Voici comment je g√®re cet √©v√©nement dans le client: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     // : -         other_players = {} socket.on('update-players',function(players_data){ var players_found = {}; //        for(var id in players_data){ //      if(other_players[id] == undefined &amp;&amp; id != socket.id){ // ,      var data = players_data[id]; var p = CreateShip(1,data.x,data.y,data.angle); other_players[id] = p; console.log("Created new player at (" + data.x + ", " + data.y + ")"); } players_found[id] = true; //     if(id != socket.id){ other_players[id].x = players_data[id].x; //  ,    ,      other_players[id].y = players_data[id].y; other_players[id].rotation = players_data[id].angle; } } //       for(var id in other_players){ if(!players_found[id]){ other_players[id].destroy(); delete other_players[id]; } } })</span></span></code> </pre> <br>  C√¥t√© client, je stocke les vaisseaux dans le dictionnaire <code>other_players</code> , que je viens de d√©finir en haut du script (il n'est pas affich√© ici).  √âtant donn√© que le serveur envoie les donn√©es des joueurs √† tous les joueurs, je dois ajouter une v√©rification afin que le client ne cr√©e pas de sprite suppl√©mentaire pour lui-m√™me.  (Si vous avez des probl√®mes avec la structuration, alors voici le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external">code complet</a> qui devrait √™tre dans index.html pour le moment). <br><br>  Testez maintenant <em>le code</em> .  Vous devriez pouvoir cr√©er plusieurs clients et voir le nombre correct de navires cr√©√©s dans les bonnes positions! <br><br><h2>  3. Synchronisation des positions des navires </h2><br>  Ici commence une partie tr√®s int√©ressante.  Nous voulons synchroniser les positions des navires sur tous les clients.  Cela r√©v√©lera la simplicit√© de la structure que nous avons cr√©√©e en ce moment.  Nous avons d√©j√† un √©v√©nement de mise √† jour qui peut synchroniser les emplacements de tous les navires.  Il nous suffit de faire ce qui suit: <br><br><ol><li>  Forcer le client √† g√©n√©rer un message chaque fois qu'il se d√©place vers une nouvelle position. </li><li>  Apprenez au serveur √† √©couter ce message de d√©placement et √† mettre √† jour l'√©l√©ment de donn√©es du joueur dans le dictionnaire des <code>players</code> . </li><li>  G√©n√©rez un √©v√©nement de mise √† jour pour tous les clients. </li></ol><br>  Et cela devrait suffire!  C'est maintenant √† votre tour d'essayer de l'impl√©menter vous-m√™me. <br><br>  Si vous √™tes compl√®tement confus et que vous avez besoin d'un indice, regardez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">projet termin√©</a> . <br><br><h3>  Remarque sur la minimisation des donn√©es transmises sur le r√©seau </h3><br>  Le moyen le plus simple de le mettre en ≈ìuvre est de mettre √† jour les positions de tous les joueurs √† chaque fois qu'un √©v√©nement de mouvement est re√ßu d' <em>un</em> joueur.  C'est formidable si les joueurs obtiennent toujours les derni√®res informations imm√©diatement apr√®s leur apparition, mais le nombre de messages transmis sur le r√©seau peut facilement atteindre des centaines par image.  Imaginez que vous avez 10 joueurs, chacun envoyant un message de mouvement dans chaque image.  Le serveur doit les renvoyer aux 10 joueurs.  C'est d√©j√† 100 messages par trame! <br><br>  Il serait pr√©f√©rable de le faire: attendez que le serveur re√ßoive tous les messages de tous les joueurs, puis envoyez √† tous les joueurs une grande mise √† jour contenant toutes les informations.  Ainsi, nous r√©duirons le nombre de messages transmis au nombre d'utilisateurs pr√©sents dans le jeu (au lieu du carr√© de ce nombre).  Le probl√®me ici est que tous les utilisateurs conna√Ætront le m√™me retard que le lecteur avec la connexion la plus lente. <br><br>  Une autre solution consiste √† envoyer les mises √† jour du serveur √† une fr√©quence constante, quel que soit le nombre de messages re√ßus du lecteur.  Une norme courante consiste √† mettre √† jour le serveur environ 30 fois par seconde. <br><br>  Cependant, lors du choix de la structure de votre serveur, vous devez √©valuer le nombre de messages transmis dans chaque trame aux premiers stades du d√©veloppement du jeu. <br><br><h2>  4. Synchronisation du shell </h2><br>  Nous avons presque fini!  La derni√®re partie s√©rieuse est la synchronisation sur un r√©seau de coques.  Nous pouvons l'impl√©menter de la m√™me mani√®re que les joueurs synchronis√©s: <br><br><ul><li>  Chaque client envoie les positions de tous ses coques dans chaque trame. </li><li>  Le serveur les redirige vers chaque joueur. </li></ul><br>  Mais il y a un probl√®me. <br><br><h3>  Protection contre la triche </h3><br>  Si vous redirigez tout ce que le client envoie en tant que vraies positions des obus, le joueur peut facilement tricher en modifiant son client et en vous transmettant de fausses donn√©es, par exemple, des obus se t√©l√©portant aux positions des navires.  Vous pouvez facilement le v√©rifier vous-m√™me en t√©l√©chargeant la page Web, en modifiant le code en JavaScript et en l'ouvrant √† nouveau.  Et c'est un probl√®me non seulement pour les jeux par navigateur.  Dans le cas g√©n√©ral, nous ne pouvons jamais faire confiance aux donn√©es provenant de l'utilisateur. <br><br>  Pour r√©soudre partiellement ce probl√®me, nous allons essayer d'utiliser un autre sch√©ma: <br><br><ul><li>  Le client g√©n√®re un message sur la coquille de tir avec sa position et sa direction. </li><li>  Le serveur simule le mouvement des obus. </li><li>  Le serveur met √† jour les donn√©es de chaque client, en passant la position de tous les shells. </li><li>  Les clients rendent les obus dans les positions re√ßues du serveur. </li></ul><br>  Ainsi, le client est responsable de la position du projectile, mais pas de sa vitesse et non de son mouvement ult√©rieur.  Le client peut changer la position des obus pour lui-m√™me, mais cela ne changera pas ce que les autres clients voient. <br><br>  Pour impl√©menter un tel sch√©ma, nous ajouterons la g√©n√©ration de message lors du d√©clenchement.  Je ne cr√©erai plus le sprite lui-m√™me, car son existence et son emplacement seront enti√®rement d√©termin√©s par le serveur.  Maintenant, notre nouveau projectile tir√© dans <strong>index.html</strong> ressemblera √† ceci: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   if(game.input.activePointer.leftButton.isDown &amp;&amp; !this.shot){ var speed_x = Math.cos(this.sprite.rotation + Math.PI/2) * 20; var speed_y = Math.sin(this.sprite.rotation + Math.PI/2) * 20; /*    ,       ,       var bullet = {}; bullet.speed_x = speed_x; bullet.speed_y = speed_y; bullet.sprite = game.add.sprite(this.sprite.x + bullet.speed_x,this.sprite.y + bullet.speed_y,'bullet'); bullet_array.push(bullet); */ this.shot = true; //  ,     socket.emit('shoot-bullet',{x:this.sprite.x,y:this.sprite.y,angle:this.sprite.rotation,speed_x:speed_x,speed_y:speed_y}) }</span></span></code> </pre> <br>  De plus, nous pouvons maintenant commenter le fragment de code entier en mettant √† jour les shells dans le client: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*     ,         //   for(var i=0;i&lt;bullet_array.length;i++){ var bullet = bullet_array[i]; bullet.sprite.x += bullet.speed_x; bullet.sprite.y += bullet.speed_y; //  ,       if(bullet.sprite.x &lt; -10 || bullet.sprite.x &gt; WORLD_SIZE.w || bullet.sprite.y &lt; -10 || bullet.sprite.y &gt; WORLD_SIZE.h){ bullet.sprite.destroy(); bullet_array.splice(i,1); i--; } } */</span></span></code> </pre> <br>  Enfin, nous devons obliger le client √† √©couter les mises √† jour du shell.  J'ai d√©cid√© de l'impl√©menter de la m√™me mani√®re qu'avec les joueurs, c'est-√†-dire que le serveur envoie simplement un tableau de toutes les positions de shell dans un √©v√©nement appel√© <code>bullets-update</code> , et le client cr√©e ou d√©truit des shells pour maintenir la synchronisation.  Voici √† quoi √ßa ressemble: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     socket.on('bullets-update',function(server_bullet_array){ //     ,   for(var i=0;i&lt;server_bullet_array.length;i++){ if(bullet_array[i] == undefined){ bullet_array[i] = game.add.sprite(server_bullet_array[i].x,server_bullet_array[i].y,'bullet'); } else { //      ! bullet_array[i].x = server_bullet_array[i].x; bullet_array[i].y = server_bullet_array[i].y; } } //    ,   for(var i=server_bullet_array.length;i&lt;bullet_array.length;i++){ bullet_array[i].destroy(); bullet_array.splice(i,1); i--; } })</span></span></code> </pre> <br>   ,     .   ,    ,          ,      ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="external"> </a> . <br><br>   server.js      .       ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bullet_array = []; <span class="hljs-comment"><span class="hljs-comment">//        </span></span></code> </pre> <br>      : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   shoot-bullet        socket.on('shoot-bullet',function(data){ if(players[socket.id] == undefined) return; var new_bullet = data; data.owner_id = socket.id; //    id  bullet_array.push(new_bullet); });</span></span></code> </pre> <br>     60   : <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   60       function ServerGameLoop(){ for(var i=0;i&lt;bullet_array.length;i++){ var bullet = bullet_array[i]; bullet.x += bullet.speed_x; bullet.y += bullet.speed_y; // ,       if(bullet.x &lt; -10 || bullet.x &gt; 1000 || bullet.y &lt; -10 || bullet.y &gt; 1000){ bullet_array.splice(i,1); i--; } } } setInterval(ServerGameLoop, 16);</span></span></code> </pre> <br>    ‚Äî     -    (     for): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,    ,    io.emit("bullets-update",bullet_array);</span></span></code> </pre> <br>      !    ,    ,       . ,      ,     ,      . ,      ,   ,        ,     ,   ,    . <br><br><h2> 5.    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit de la derni√®re m√©canique de base que nous impl√©mentons. </font><font style="vertical-align: inherit;">J'esp√®re que vous √™tes d√©j√† habitu√© √† la proc√©dure de planification de votre impl√©mentation, en compl√©tant tout d'abord l'impl√©mentation client, puis en passant au serveur (ou vice versa). </font><font style="vertical-align: inherit;">Cette m√©thode est beaucoup moins sujette aux erreurs que de sauter lorsqu'elle est impl√©ment√©e d'avant en arri√®re. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La v√©rification des collisions est un m√©canisme de jeu crucial, nous voulons donc qu'il soit prot√©g√© contre la tricherie. </font><font style="vertical-align: inherit;">Nous l'impl√©mentons sur le serveur de la m√™me mani√®re que nous l'avons fait avec les shells. </font><font style="vertical-align: inherit;">Nous avons besoin des √©l√©ments suivants:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> V√©rifiez si le projectile est suffisamment proche de n'importe quel joueur sur le serveur. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> G√©n√©rez un √©v√©nement pour tous les clients lorsqu'un projectile frappe un joueur. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Apprenez au client √† √©couter l'√©v√©nement √† succ√®s et √† faire clignoter le navire lorsqu'il est touch√©. </font></font></li></ul><br>      .       ,    -  0: <br><br><pre> <code class="javascript hljs">player.sprite.alpha = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br>         (    ).      ,      -      - : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> other_players){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(other_players[id].alpha &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>){ other_players[id].alpha += (<span class="hljs-number"><span class="hljs-number">1</span></span> - other_players[id].alpha) * <span class="hljs-number"><span class="hljs-number">0.16</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { other_players[id].alpha = <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br>        ,        (          ). <br><br> ,                   ,    ,      .      ,    . <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Lissage de mouvement </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous avez termin√© toutes les √©tapes jusqu'√† ce point, je peux vous f√©liciter. </font><font style="vertical-align: inherit;">Vous venez de cr√©er un jeu multijoueur fonctionnel! </font><font style="vertical-align: inherit;">Envoyez le lien √† un ami et voyez comment la magie du multijoueur en ligne peut rassembler les joueurs! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le jeu est enti√®rement fonctionnel, mais notre travail ne s'arr√™te pas l√†. </font><font style="vertical-align: inherit;">Il y a quelques probl√®mes qui peuvent affecter n√©gativement le gameplay, et nous devons y faire face:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Si tout le monde n'a pas une connexion rapide, alors le mouvement des autres joueurs semble tr√®s nerveux. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les obus semblent lents, car ils ne sont pas tir√©s imm√©diatement. </font><font style="vertical-align: inherit;">Avant d'appara√Ætre sur l'√©cran du client, ils attendent un message de retour du serveur.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous pouvons r√©soudre le premier probl√®me en interpolant nos donn√©es de position du navire dans le client. Par cons√©quent, si nous ne recevons pas les mises √† jour assez rapidement, nous pouvons d√©placer facilement le navire √† l'endroit o√π il devrait √™tre, et pas seulement le t√©l√©porter l√†-bas. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les coques n√©cessitent une solution plus complexe. Nous voulons que le serveur traite les obus pour se prot√©ger contre la tricherie, mais nous avons √©galement besoin d'une r√©action instantan√©e: un tir et un projectile volant. La meilleure solution est une approche hybride. Le serveur et le client peuvent simuler des shells, et le serveur enverra toujours des mises √† jour des positions des shells. S'ils ne sont pas synchronis√©s, nous supposons que le serveur a raison et red√©finissons la position du projectile dans le client. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous n'impl√©menterons pas ce syst√®me shell dans ce tutoriel, mais il est agr√©able de savoir que cette m√©thode existe.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'interpolation simple des positions des navires est tr√®s simple. </font><font style="vertical-align: inherit;">Au lieu de d√©finir une position directement dans l'√©v√©nement de mise √† jour, o√π nous recevons d'abord de nouvelles donn√©es de position, nous enregistrons simplement la position cible:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     if(id != socket.id){ other_players[id].target_x = players_data[id].x; //  ,    ,     other_players[id].target_y = players_data[id].y; other_players[id].target_rotation = players_data[id].angle; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ensuite, dans la fonction de mise √† jour (√©galement c√¥t√© client), nous bouclons tous les autres joueurs et les poussons vers leur objectif: </font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     ,      for(var id in other_players){ var p = other_players[id]; if(p.target_x != undefined){ px += (p.target_x - px) * 0.16; py += (p.target_y - py) * 0.16; //  ,    /  var angle = p.target_rotation; var dir = (angle - p.rotation) / (Math.PI * 2); dir -= Math.round(dir); dir = dir * Math.PI * 2; p.rotation += dir * 0.16; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ainsi, le serveur nous envoie des mises √† jour 30 fois par seconde, mais nous pouvons toujours jouer √† 60 fps et le jeu semble toujours aussi fluide! </font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons examin√© de nombreuses questions. R√©pertorions-les: nous avons appris √† transf√©rer des messages entre le client et le serveur, √† synchroniser l'√©tat du jeu, √† le diffuser du serveur √† tous les joueurs. C'est le moyen le plus simple de mettre en ≈ìuvre un jeu en ligne multijoueur. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons √©galement appris √† prot√©ger le jeu contre la triche, √† simuler ses parties importantes sur le serveur et √† informer les clients des r√©sultats. Moins vous faites confiance au client, plus le jeu sera s√ªr.</font></font><br><br> ,  ,        .   ‚Äî        (        ).         ‚Äî        .         ,         , , ,      . <br><br>       ‚Äî  ,      .        ,     ,   ,       .            .         .         . <br><br>        Glitch,             (Advanced Options)    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c62/d6b/dba/c62d6bdba51311a7a0d8976c37dbe6fb.png"></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418411/">https://habr.com/ru/post/fr418411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418399/index.html">Sur la vague de Selectel FM</a></li>
<li><a href="../fr418401/index.html">Comment je ne suis pas devenu toi: un message d'amour pour les administrateurs syst√®me</a></li>
<li><a href="../fr418403/index.html">Exemple de programmation d'acc√©l√©rateur FPGA</a></li>
<li><a href="../fr418405/index.html">Le principe de la pyramide invers√©e en analytique. Nous construisons un tableau de bord compr√©hensible</a></li>
<li><a href="../fr418407/index.html">L'extraction de cloud Hashflare a ferm√©. L'argent ne revient pas</a></li>
<li><a href="../fr418415/index.html">Telegram a pr√©sent√© son propre service de passeport pour la v√©rification et l'autorisation des utilisateurs</a></li>
<li><a href="../fr418417/index.html">Apollo: 9 mois - vol normal</a></li>
<li><a href="../fr418419/index.html">Comment Dodo Pizza r√©sout les probl√®mes commerciaux √† l'aide de l'apprentissage automatique</a></li>
<li><a href="../fr418423/index.html">Maison intelligente: une nouvelle dimension de confort et la recherche de l'excellence. Premi√®re partie</a></li>
<li><a href="../fr418427/index.html">Indexation mobile d'abord. Comment et pourquoi le graphique des liens va-t-il changer?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>