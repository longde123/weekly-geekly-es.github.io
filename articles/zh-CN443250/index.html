<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â˜•ï¸ ğŸ‘º â˜ğŸ» OpenJDKçš„è‡ªåˆ¶åƒåœ¾æ”¶é›†å™¨ ğŸ›¤ï¸ ğŸ’¹ ğŸ‘¨ğŸ¿â€ğŸš’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿™æ˜¯Alexey Shipilevçš„æ–‡ç« â€œè‡ªå·±åŠ¨æ‰‹ï¼ˆOpenJDKï¼‰åƒåœ¾æ”¶é›†å™¨â€çš„ç¿»è¯‘ï¼Œè¯¥æ–‡æœ¬ç»ä½œè€…åŒæ„å‘è¡¨ã€‚ æŠ¥å‘ŠPMä¸­çš„ä»»ä½•é”™åˆ«å­—å’Œå…¶ä»–é”™è¯¯-æˆ‘ä»¬å°†ä¿®å¤å®ƒä»¬ã€‚ 

 åœ¨è¿è¡Œæ—¶åˆ›å»ºæŸäº›ä¸œè¥¿çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»ƒä¹ ã€‚ è‡³å°‘æ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„åˆ›å»ºï¼ è¦æ„å»ºä¸€ä¸ªå¯é ï¼Œé«˜æ€§èƒ½ï¼Œæ•…éšœå®‰å…¨çš„è¿è¡Œæ—¶å­ç³»ç»Ÿï¼Œå…¶è¡Œä¸ºå¯ä»¥...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OpenJDKçš„è‡ªåˆ¶åƒåœ¾æ”¶é›†å™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/443250/"><blockquote> è¿™æ˜¯Alexey Shipilevçš„æ–‡ç« <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œè‡ªå·±åŠ¨æ‰‹ï¼ˆOpenJDKï¼‰åƒåœ¾æ”¶é›†å™¨â€</a>çš„ç¿»è¯‘ï¼Œè¯¥æ–‡æœ¬ç»ä½œè€…åŒæ„å‘è¡¨ã€‚ æŠ¥å‘ŠPMä¸­çš„ä»»ä½•é”™åˆ«å­—å’Œå…¶ä»–é”™è¯¯-æˆ‘ä»¬å°†ä¿®å¤å®ƒä»¬ã€‚ </blockquote><p> åœ¨è¿è¡Œæ—¶åˆ›å»ºæŸäº›ä¸œè¥¿çš„è¿‡ç¨‹æ˜¯ä¸€ä¸ªæœ‰è¶£çš„ç»ƒä¹ ã€‚ è‡³å°‘æ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬çš„åˆ›å»ºï¼ è¦æ„å»ºä¸€ä¸ªå¯é ï¼Œé«˜æ€§èƒ½ï¼Œæ•…éšœå®‰å…¨çš„è¿è¡Œæ—¶å­ç³»ç»Ÿï¼Œå…¶è¡Œä¸ºå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œè§‚å¯Ÿå’Œè°ƒè¯•ï¼Œè¿™æ˜¯éå¸¸éå¸¸å›°éš¾çš„ä»»åŠ¡ã€‚ </p><br><p> ä»è¡¨é¢ä¸Šçœ‹ï¼Œåˆ¶ä½œä¸€ä¸ªç®€å•çš„åƒåœ¾æ”¶é›†å™¨éå¸¸ç®€å•ï¼Œç°åœ¨æˆ‘æƒ³åœ¨æœ¬æ–‡ä¸­åšåˆ°è¿™ä¸€ç‚¹ã€‚ ä½¿ç”¨æ­¤ä¿®è¡¥ç¨‹åºçš„æ—©æœŸç‰ˆæœ¬ï¼ŒRoman Kennkeåœ¨FOSDEM 2019ä¸Šè¿›è¡Œäº†åä¸º<a href="">â€œåœ¨20åˆ†é’Ÿå†…ç¼–å†™GCâ€</a>çš„æ¼”è®²å’Œæ¼”ç¤ºã€‚ å°½ç®¡åœ¨é‚£é‡Œå®ç°çš„ä»£ç å±•ç¤ºäº†å¾ˆå¤šä¸œè¥¿ï¼Œå¹¶ä¸”å¾—åˆ°äº†å¾ˆå¤šè¯„è®ºï¼Œä½†æ˜¯ä»ç„¶éœ€è¦å¯¹æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…æœ‰ä¸€ä¸ªå¾ˆå¥½çš„é«˜çº§æè¿°-è¿™å°±æ˜¯æœ¬æ–‡çš„æ ·å­ã€‚ </p><br><p> å¯¹åƒåœ¾æ”¶é›†å™¨çš„å·¥ä½œæœ‰ä¸€ä¸ªåŸºæœ¬çš„äº†è§£å°†æå¤§åœ°å¸®åŠ©ç†è§£è¿™é‡Œå†™çš„å†…å®¹ã€‚ æœ¬æ–‡å°†åœ¨HotSpotçš„ç‰¹å®šå®ç°ä¸­ä½¿ç”¨ç»†èŠ‚å’Œæ€æƒ³ï¼Œä½†æ­¤å¤„ä¸ä¼šæä¾›æœ‰å…³GCè®¾è®¡çš„å…¥é—¨è¯¾ç¨‹ã€‚ é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GCæ‰‹å†Œ</a>å¹¶é˜…è¯»æœ‰å…³GCåŸºæœ¬çŸ¥è¯†çš„ç¬¬ä¸€ç« ï¼Œç”šè‡³æ›´å¿«åœ°å¼€å§‹é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wikipedia</a> ã€‚ </p><br><p><img src="https://habrastorage.org/webt/4v/1i/4y/4v1i4yrxpcef-vvvkknzfuhmt-w.jpeg"></p><a name="habracut"></a><br><h1 id="soderzhanie"> ç›®å½•å†…å®¹ </h1><br><div class="spoiler">  <b class="spoiler_title">éšè—æ–‡å­—</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1. GCç”±ä»€ä¹ˆç»„æˆ</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.1ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Epsilon gc</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.1.1ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…å­˜åˆ†é…</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.1.2ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å£å’</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.1.3ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç›‘æ§è¿æ¥</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.2ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Rantimeå’ŒGC</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.2.1ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ¹å…ƒç´ </a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.2.2ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯¹è±¡æŠ“å–</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.2.3ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ’é‡</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">1.2.4ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ‡è®°æ•°æ®</a> </li></ul></li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">2.æ€»ä½“è§„åˆ’</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3. GCæ ¸å¿ƒçš„å®æ–½</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.1ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åºè¨€</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.2ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰“æ ‡</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.3ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¡ç®—æ–°åœ°å€</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.4ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¿®æ­£æŒ‡é’ˆ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.5ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æˆ‘ä»¬ç§»åŠ¨ç‰©ä½“</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">3.6ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»“è¯­</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.å°†GCè¿æ¥åˆ°VM</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.1ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ ¹éå†</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.2ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰å…¨ç‚¹å’Œåˆ¶æ­¢ä¸–ç•Œ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">4.3ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å†…å­˜åˆ†é…é”™è¯¯</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">5.ç»„è£…</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">6.æµ‹è¯•</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">7.è¡¨ç°</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">8.æ¥ä¸‹æ¥å‘¢ï¼Ÿ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">9.ç»“è®º</a> </li></ul></div></div><br><a name="1"></a><br><h1 id="1-iz-chego-sostoit-gc">  1. GCç”±ä»€ä¹ˆç»„æˆ </h1><br><p> æ—¢ç„¶å·²ç»ç¼–å†™äº†è®¸å¤šä¸åŒçš„GCï¼Œå°±å¯ä»¥è½»æ¾åˆ¶ä½œè‡ªå·±çš„GC-å¯ä»¥ä½¿ç”¨ï¼ˆé‡æ–°ï¼‰ä½¿ç”¨è®¸å¤šå·²ç»ç¼–å†™çš„å…ƒç´ ï¼Œå°†å¯¹å®ç°ç»†èŠ‚çš„æŸäº›æ‹…å¿§è½¬ç§»åˆ°ç»è¿‡éªŒè¯çš„ä»£ç ä¸Šã€‚ </p><br><a name="11"></a><br><h2 id="11-epsilon-gc">  1.1ã€‚  Epsilon gc </h2><br><p> OpenJDK 11å¼•å…¥äº†æ–°çš„JEP 318ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ Epsilonï¼šæ— æ“ä½œåƒåœ¾æ”¶é›†å™¨ï¼ˆå®éªŒæ€§ï¼‰</a> ã€‚ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€</a> å®ƒçš„ä»»åŠ¡æ˜¯ä¸ºä¸éœ€è¦ç”šè‡³ç¦æ­¢é‡Šæ”¾å†…å­˜çš„æƒ…å†µæä¾›æœ€å°çš„å®ç°ã€‚  JEPæ›´è¯¦ç»†åœ°è®¨è®ºäº†ä¸ºä»€ä¹ˆå®ƒå¯èƒ½æœ‰ç”¨ã€‚ </p><br><p> ä»å®ç°çš„è§’åº¦æ¥çœ‹ï¼Œâ€œåƒåœ¾æ”¶é›†å™¨â€æ˜¯ä¸ªååå­—ï¼Œä½¿ç”¨æœ¯è¯­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œè‡ªåŠ¨å†…å­˜ç®¡ç†å™¨â€</a>æ¥è´Ÿè´£åˆ†é…å’Œé‡Šæ”¾å†…å­˜ä¼šæ›´æ­£ç¡®ã€‚  Epsilon GCä»…å®ç°â€œåˆ†é…â€ï¼Œè€Œæ ¹æœ¬ä¸å¤„ç†â€œå‘å¸ƒâ€ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Epsilon GCå¹¶ä»å¤´å¼€å§‹å®æ–½â€œå‘å¸ƒâ€ç®—æ³•ã€‚ </p><br><a name="111"></a><br><h3 id="111-vydelenie-pamyati">  1.1.1ã€‚ å†…å­˜åˆ†é… </h3><br><p>  Epsilon GCçš„æœ€å‘è¾¾éƒ¨åˆ†<a href="">è´Ÿè´£åˆ†é…å†…å­˜</a> ã€‚ å®ƒä¸ºå¤–éƒ¨è¯·æ±‚æä¾›æœåŠ¡ï¼Œä»¥åˆ†é…ä»»æ„å¤§å°çš„å†…å­˜å¹¶åˆ›å»ºæ‰€éœ€å¤§å°çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å†²åŒºï¼ˆTLABï¼‰</a> ã€‚ ç”±äºæ²¡æœ‰å¯ç”¨å†…å­˜ï¼Œè€Œä¸”æ²¡æœ‰äººå°†è¿”å›ä¸¢å¤±çš„å­—èŠ‚ï¼Œå› æ­¤å®ç°æœ¬èº«è¯•å›¾ä¸å¯¹TLABè¿›è¡Œè¿‡å¤šæ‰©å±•ã€‚ </p><br><a name="112"></a><br><h3 id="112-barery">  1.1.2ã€‚ å£å’ </h3><br><p> ä¸€äº›åƒåœ¾æ”¶é›†å™¨éœ€è¦ä¸åº”ç”¨ç¨‹åºäº¤äº’ä»¥ç»´æŠ¤GCä¸å˜æ€§ï¼Œä»è€Œåœ¨å°è¯•è®¿é—®å †æ—¶è¿«ä½¿è¿è¡Œæ—¶å’Œåº”ç”¨ç¨‹åºåˆ›å»ºæ‰€è°“çš„<em>éšœç¢</em> ã€‚ å¯¹äºæ‰€æœ‰å¤šçº¿ç¨‹æ”¶é›†å™¨ä»¥åŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¸å¤šä¸–ä»£ç›¸ä¼ çš„æ”¶é›†å™¨è€Œè¨€ï¼Œ</a>éƒ½æ˜¯å¦‚æ­¤ã€‚ </p><br><p>  Epsilonä¸éœ€è¦éšœç¢ï¼Œä½†æ˜¯è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨ä»ç„¶æƒ³<em>çŸ¥é“</em>éšœç¢æ— æµäºäº‹ã€‚ æ¯æ¬¡åˆ°å¤„å¤„ç†éƒ½ä¼šå¾ˆç´¯ã€‚ å¹¸è¿çš„æ˜¯ï¼Œä»OpenJDK 11å¼€å§‹ï¼Œæœ‰ä¸€ä¸ªæ–°çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JEP-304ï¼šâ€œåƒåœ¾æ”¶é›†æ¥å£â€</a> ï¼Œå®ƒä½¿æ’å…¥éšœç¢å˜å¾—éå¸¸å®¹æ˜“ã€‚ ç‰¹åˆ«æ˜¯ï¼Œ <a href="">Epsilonä¸­</a>çš„<a href="">éšœç¢é›†ä¸ºç©º</a> ï¼Œå¹¶ä¸”æ‰€æœ‰çç¢çš„å·¥ä½œï¼ˆä¿å­˜ï¼ŒåŠ è½½ï¼ŒCASï¼Œæ•°ç»„å¤åˆ¶ï¼‰éƒ½å¯ä»¥å§”æ´¾ç»™ç°æœ‰è¶…ç±»ä¸­çš„çç¢éšœç¢çš„å®ç°ã€‚ å¦‚æœæ‚¨è¦åˆ¶ä½œä¹Ÿä¸éœ€è¦éšœç¢çš„GCï¼Œåˆ™å¯ä»¥ç®€å•åœ°é‡ç”¨Epsilonä¸­çš„ä»£ç ã€‚ </p><br><a name="113"></a><br><h3 id="113-podklyuchenie-k-monitoringu">  1.1.3ã€‚ ç›‘æ§è¿æ¥ </h3><br><p>  GCå®ç°çš„æœ€åä¸€ä¸ªä¹å‘³çš„éƒ¨åˆ†æ˜¯æŒ‚é’©åˆ°JVMå†…éƒ¨çš„ä¸€ç³»åˆ—ç›‘è§†æœºåˆ¶ï¼šMX-binï¼Œè¯Šæ–­å‘½ä»¤ç­‰åº”è¯¥èµ·ä½œç”¨ã€‚  Epsilon <a href="">å·²ç»</a>ä¸ºæ‚¨<a href="">å®Œæˆäº†</a>æ‰€æœ‰è¿™ä¸€åˆ‡ã€‚ </p><br><a name="12"></a><br><h2 id="12-rantaym-i-gc">  1.2ã€‚  Rantimeå’ŒGC </h2><br><a name="121"></a><br><h3 id="121-kornevye-elementy">  1.2.1ã€‚ æ ¹å…ƒç´  </h3><br><p> é€šå¸¸ï¼Œåƒåœ¾æ”¶é›†å™¨éœ€è¦çŸ¥é“Javaè¿è¡Œæ—¶ä¸­ç¡®åˆ‡å…·æœ‰å †å¼•ç”¨çš„å†…å®¹ã€‚ è¿™äº›æ ¹å…ƒç´ ï¼ˆç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GCæ ¹</a> ï¼‰å¯ä»¥æ˜¯æµå †æ ˆå’Œå±€éƒ¨å˜é‡ï¼ˆåŒ…æ‹¬åœ¨JITç¼–è¯‘çš„ä»£ç ä¸­å‘ç°çš„é‚£äº›ï¼ï¼‰ï¼Œæœ¬æœºç±»å’Œç±»åŠ è½½å™¨ï¼ŒJNIä¸­çš„å¼•ç”¨ç­‰æ’æ§½ã€‚ å°è¯•è¯†åˆ«è¿™äº›å…ƒç´ å¯èƒ½éå¸¸å¤æ‚ä¸”ä¹å‘³ã€‚ ä½†æ˜¯åœ¨Hotspotä¸­ï¼Œå®ƒä»¬éƒ½ä½¿ç”¨é€‚å½“çš„VMå­ç³»ç»Ÿè¿›è¡Œè·Ÿè¸ªï¼Œå› æ­¤æ‚¨å¯ä»¥ç®€å•åœ°äº†è§£ç°æœ‰GCå®æ–½å¦‚ä½•ä¸å®ƒä»¬ä¸€èµ·ä½¿ç”¨ã€‚ åœ¨æœ¬æ–‡çš„è¿›ä¸€æ­¥éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å®ƒã€‚ </p><br><a name="122"></a><br><h3 id="122-obhod-obektov">  1.2.2ã€‚ å¯¹è±¡æŠ“å– </h3><br><p>åƒåœ¾æ”¶é›†å™¨åº”ç»•è¿‡Javaå¯¹è±¡ä¸­çš„å‡ºç«™é“¾æ¥ã€‚ è¯¥æ“ä½œéšå¤„å¯è§ï¼Œå› æ­¤è¿è¡Œæ—¶çš„å…¬å…±éƒ¨åˆ†æä¾›äº†ç°æˆçš„è§£å†³æ–¹æ³•ï¼›æ‚¨æ— éœ€è‡ªå·±ç¼–å†™ä»»ä½•å†…å®¹ã€‚ ä¸‹é¢å°†æœ‰ä¸€ä¸ªå…·æœ‰ç‰¹å®šå®ç°çš„éƒ¨åˆ†ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­æ‰¾åˆ°ä¾‹å¦‚<code>objâ†’oop_iterate</code>è°ƒç”¨ã€‚ </p><br><a name="123"></a><br><h3 id="123-peremescheniya">  1.2.3ã€‚ æ’é‡ </h3><br><p> ç§»åŠ¨åƒåœ¾æ”¶é›†å™¨éœ€è¦åœ¨æŸå¤„å†™ä¸‹ç§»åŠ¨å¯¹è±¡çš„æ–°åœ°å€ã€‚ æ‚¨å¯ä»¥åœ¨å‡ ä¸ªåœ°æ–¹å†™å…¥æ­¤<em>è½¬å‘æ•°æ®</em> ã€‚ </p><br><ol><li> æ‚¨å¯ä»¥<a href="">åœ¨å¯¹è±¡æœ¬èº«</a> ï¼ˆä¸²è¡Œï¼Œå¹¶è¡Œç­‰ï¼‰ä¸­é‡ç”¨<a href="">â€œæ ‡è®°è¯â€</a> ã€‚ åœ¨ä¸–ç•Œåœæ­¢ä¹‹åï¼Œå¯¹å¯¹è±¡çš„æ‰€æœ‰è®¿é—®éƒ½å°†å—åˆ°æ§åˆ¶ï¼Œå¹¶ç¡®ä¿æ²¡æœ‰Javaçº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°æˆ‘ä»¬å†³å®šåœ¨æ ‡è®°è¯ä¸­è¾“å…¥çš„ä¸´æ—¶æ•°æ®ã€‚ æ‚¨å¯ä»¥é‡å¤ä½¿ç”¨å®ƒæ¥å­˜å‚¨è½¬å‘æ•°æ®ã€‚ </li><li> æ‚¨å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå•ç‹¬çš„æœ¬æœºç§»åŠ¨è¡¨ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ZGC</a> ï¼ŒC4ç­‰ï¼‰ã€‚ è¿™å°†GCä¸è¿è¡Œæ—¶ä»¥åŠåº”ç”¨ç¨‹åºçš„å…¶ä½™éƒ¨åˆ†å®Œå…¨éš”ç¦»å¼€æ¥ï¼Œå› ä¸ºåªæœ‰GCçŸ¥é“è¿™ç§è¡¨çš„å­˜åœ¨ã€‚ ç«äº‰æ€§æ±‡ç¼–ç¨‹åºé€šå¸¸åªä½¿ç”¨è¿™ç§æ–¹æ¡ˆ-ä»–ä»¬ä¸æƒ³é­å—å¾ˆå¤šä¸å¿…è¦çš„é—®é¢˜ã€‚ </li><li> æ‚¨å¯ä»¥å‘å¯¹è±¡æ·»åŠ å¦ä¸€ä¸ªå•è¯ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Shenandoah</a>ç­‰ï¼‰ã€‚ å…ˆå‰ä¸¤ç§æ–¹æ³•çš„è¿™ç§ç»“åˆä¸ä»…ä½¿è¿è¡Œæ—¶å’Œåº”ç”¨ç¨‹åºå¯ä»¥æ¯«æ— é—®é¢˜åœ°ä¸ç°æœ‰æ ‡å¤´ä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸”è¿˜ä¿å­˜äº†è½¬å‘æ•°æ®ã€‚ </li></ol><br><a name="124"></a><br><h3 id="124-markernye-dannye">  1.2.4ã€‚ æ ‡è®°æ•°æ® </h3><br><p> åƒåœ¾æ”¶é›†å™¨éœ€è¦åœ¨æŸå¤„å†™å…¥<em>æ ‡è®°æ•°æ®</em> ã€‚ åŒæ ·ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¿å­˜å®ƒä»¬ï¼š </p><br><ol><li> æ‚¨å¯ä»¥åœ¨å¯¹è±¡æœ¬èº«ï¼ˆä¸²è¡Œï¼Œå¹¶è¡Œç­‰ï¼‰ä¸­é‡ç”¨æ ‡è®°è¯ã€‚ åŒæ ·ï¼Œåœ¨ä¸–ç•Œåœæ­¢æ¨¡å¼ä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ ‡è®°è¯ä¸­çš„ä½å¯¹æ ‡ç­¾çš„äº‹å®è¿›è¡Œç¼–ç ã€‚ æ­¤å¤–ï¼Œå¦‚æœæ‚¨éœ€è¦éå†æ‰€æœ‰æ´»åŠ¨å¯¹è±¡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†é€ä¸ªå¯¹è±¡åœ°å¤„ç†å †-ç”±äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å †æ˜¯å¯è§£æçš„</a> ï¼Œå› æ­¤è¿™æ˜¯å¯èƒ½çš„ã€‚ </li><li> æ‚¨å¯ä»¥ç»´æŠ¤å•ç‹¬çš„ç»“æ„æ¥å­˜å‚¨æ ‡è®°æ•°æ®ï¼ˆG1ï¼ŒShenandoahç­‰ï¼‰ã€‚ é€šå¸¸ä½¿ç”¨<a href="">å•ç‹¬çš„ä½å›¾</a>å®Œæˆæ­¤æ“ä½œï¼Œè¯¥<a href="">ä½å›¾</a>å°†å †çš„æ¯Nä¸ªå­—èŠ‚æ˜ å°„åˆ°å¡çš„1ä½ã€‚ é€šå¸¸ï¼ŒJavaå¯¹è±¡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æŒ‰8ä¸ªå­—èŠ‚å¯¹é½</a> ï¼Œå› æ­¤å¡å°†å †ä¸­çš„æ¯64ä½æ˜ å°„åˆ°å¡çš„1ä½ï¼Œåœ¨æœ¬æœºå†…å­˜ä¸­å å †å¤§å°çš„1/64ã€‚ åœ¨æ‰«æå †ä¸­æ˜¯å¦å­˜åœ¨æ´»åŠ¨å¯¹è±¡ï¼ˆå°¤å…¶æ˜¯ç¨€ç–å¯¹è±¡ï¼‰æ—¶ï¼Œè¿™äº›å¼€é”€ä¼šå¾—åˆ°å¾ˆå¥½çš„å›æŠ¥ï¼šç»•è¿‡æ˜ å°„é€šå¸¸æ¯”ç»•è¿‡æ­£åœ¨é€å¯¹è±¡åˆ†è§£çš„å †å¿«å¾—å¤šã€‚ </li><li> å°†æ ‡ç­¾ç¼–ç æˆé“¾æ¥æœ¬èº«ï¼ˆZGCï¼ŒC4å’Œå…¶ä»–ï¼‰ã€‚ è¿™éœ€è¦ä¸åº”ç”¨ç¨‹åºåè°ƒï¼Œç„¶åæ‚¨éœ€è¦ä»é“¾æ¥ä¸­åˆ é™¤æ‰€æœ‰è¿™äº›æ ‡ç­¾ï¼Œæˆ–è€…æ‰§è¡Œä¸€äº›å…¶ä»–æŠ€å·§æ¥ä¿æŒæ­£ç¡®æ€§ã€‚ æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦GCçš„éšœç¢æˆ–å…¶ä»–å·¥ä½œã€‚ </li></ol><br><a name="2"></a><br><h1 id="2-obschiy-plan">  2.æ€»ä½“è§„åˆ’ </h1><br><p> æœ€æœ‰å¯èƒ½åœ¨Epsilonä¸Šæœ€å®¹æ˜“å®ç°çš„æ˜¯LISP2æ ·å¼çš„Mark-Compactã€‚ è¯¥GCçš„åŸºæœ¬æ€æƒ³<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨ç»´åŸºç™¾ç§‘</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GCæ‰‹å†Œ</a> ï¼ˆç¬¬3.2ç« ï¼‰ä¸­éƒ½æœ‰æè¿°ã€‚ è¯¥ç®—æ³•çš„è‰å›¾å°†åœ¨ä¸‹é¢çš„å®ç°éƒ¨åˆ†ä¸­ï¼Œä½†æˆ‘å¼ºçƒˆå»ºè®®æ‚¨é˜…è¯»ä¸€ç‚¹Wikipediaæˆ–GCæ‰‹å†Œï¼Œä»¥äº†è§£æˆ‘ä»¬å°†è¦åšä»€ä¹ˆã€‚ </p><br><p> è®¨è®ºä¸­çš„ç®—æ³•æ˜¯<em>ç§»åŠ¨</em> GCï¼šç§»åŠ¨å¯¹è±¡ä»¥æ•°ç»„çš„å½¢å¼ç§»åŠ¨åˆ°å †çš„æœ€å¼€å§‹ã€‚ å®ƒæœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š </p><br><ul><li> å®ƒç»´æŠ¤å†…å­˜åˆ†é…çš„é¡ºåºã€‚ å¦‚æœå¯¹æ‚¨æ¥è¯´å¾ˆé‡è¦ï¼Œé‚£ä¹ˆè¿™å¯¹äºæ§åˆ¶å†…å­˜ä¸­çš„å¸ƒå±€éå¸¸æœ‰ç”¨ï¼ˆæ§åˆ¶æ€ªèƒï¼Œè¿™æ˜¯æ‚¨çš„æ—¶é—´ï¼ï¼‰ã€‚ ç¼ºç‚¹æ˜¯æ‚¨ä¸ä¼šä»¥è¿™ç§æ–¹å¼è·å¾—<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ªåŠ¨é“¾æ¥çš„ä½ç½®ä¿¡æ¯</a> ã€‚ </li><li> å®ƒçš„å¤æ‚åº¦æ˜¯å¯¹è±¡æ•°çš„Oï¼ˆNï¼‰ã€‚ ä½†æ˜¯ï¼Œçº¿æ€§åº¦æ˜¯æœ‰ä»£ä»·çš„ï¼šæ¯ä¸ªæ„å»ºå‘¨æœŸéƒ½éœ€è¦GCç»•è¿‡4æ¬¡ã€‚ </li><li> å®ƒä¸éœ€è¦å †ä¸Šçš„å¯ç”¨å†…å­˜ï¼ æ— éœ€åœ¨å †ä¸Šä¿ç•™å†…å­˜æ¥æ’¤ç¦»æ´»åŠ¨å¯¹è±¡ï¼Œå› æ­¤æ‚¨ç”šè‡³å¯ä»¥ä½¿ç”¨è¢«99ï¼…ï¼ˆ9ï¼‰ï¼…æº¢å‡ºçš„å †ã€‚ å¦‚æœæˆ‘ä»¬é‡‡ç”¨å…¶ä»–ç®€å•æ”¶é›†å™¨çš„æƒ³æ³•ï¼Œä¾‹å¦‚ä½¿ç”¨åŠç©ºé—´çš„æ¸…é™¤å™¨ï¼ˆåŠç©ºé—´çš„æ¸…é™¤å™¨ï¼‰ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸ç¨å¾®é‡å†™å †çš„è¡¨ç¤ºå¹¶ä¿ç•™ä¸€äº›ç©ºé—´ç”¨äºç–æ•£ï¼Œä½†è¿™è¶…å‡ºäº†æœ¬ç»ƒä¹ çš„èŒƒå›´ã€‚ </li><li> å¦‚æœæ‚¨å¯¹æ­¤é—®é¢˜è¿›è¡Œä¸€äº›å·¥ä½œï¼Œåˆ™åœ¨GCå¤„äºä¸æ´»åŠ¨çŠ¶æ€æ—¶ï¼Œå¯ä»¥å®ç°é›¶å†…å­˜å’Œæ—¶é—´æ¶ˆè€—ã€‚ å®ƒä»¥ä»»æ„çŠ¶æ€åœ¨å†…å­˜ä¸Šå¯åŠ¨ï¼Œç„¶ååœæ­¢ï¼Œä»è€Œæå¤§åœ°å‹ç¼©äº†å†…å­˜ã€‚ è¿™éå¸¸é€‚åˆEpsilonçš„å·¥ä½œæ–¹å¼ï¼šä»…åœ¨æœ€åä¸€ä¸ªå¯¹è±¡ä¹‹åä¸€ç›´çªå‡ºæ˜¾ç¤ºã€‚ è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç¼ºç‚¹ï¼šå †å¼€å§‹æ—¶ä¸€äº›æ­»å¯¹è±¡å¯¼è‡´å¤§é‡ç§»åŠ¨ã€‚ </li><li> å®ƒåªæ˜¯ä¸éœ€è¦æ–°çš„éšœç¢ï¼Œæ‚¨å¯ä»¥<code>EpsilonBarrierSet</code>åŸæ ·é‡ç”¨<code>EpsilonBarrierSet</code> ã€‚ </li></ul><br><p> ä¸ºç®€å•èµ·è§ï¼ŒGCå®ç°å°†ä½¿ç”¨ä¸–ç•Œçš„å¥ç‚¹ï¼ˆstop-the-worldï¼ŒSTWï¼‰ï¼Œå®ƒå°†æ²¡æœ‰ä»£æ•°æˆ–å¤šçº¿ç¨‹ã€‚ å¯¹äºè¿™ç§æƒ…å†µï¼Œä½¿ç”¨ä½å›¾å­˜å‚¨æ ‡è®°å¹¶é‡ç”¨æ ‡è®°è¯å­˜å‚¨è¿åŠ¨æ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ã€‚ </p><br><a name="3"></a><br><h1 id="3-realizaciya-yadra-gc">  3. GCæ ¸å¿ƒçš„å®æ–½ </h1><br><p> å¯¹äºä¸€ä¸ªæ— çŸ¥çš„äººæ¥è¯´ï¼Œé˜…è¯»å’Œç†è§£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•´ä¸ªå®ç°</a>å¯èƒ½å¤ªå¤æ‚äº†ã€‚ åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†é€æ­¥äº†è§£å®ƒã€‚ </p><br><a name="31"></a><br><h2 id="31-prolog">  3.1ã€‚ åºè¨€ </h2><br><p> åƒåœ¾æ”¶é›†å™¨é€šå¸¸éœ€è¦åšå‡ ä»¶äº‹ä¸ºæ”¶é›†åšå‡†å¤‡ã€‚ é˜…è¯»è¯„è®ºï¼Œä»–ä»¬åº”è¯¥ä¸ºè‡ªå·±è¯´è¯ï¼š </p><br><pre> <code class="cpp hljs">{ GCTraceTime(Info, gc) time(<span class="hljs-string"><span class="hljs-string">"Step 0: Prologue"</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      .      //   :   ,   ,  // Â«Â»   ,      //   ,     . if (!os::commit_memory((char*)_bitmap_region.start(), _bitmap_region.byte_size(), false)) { log_warning(gc)("Could not commit native memory for marking bitmap, GC failed"); return; } //        ,  , //       TLAB-. ensure_parsability(true); //      ,    GC. CodeCache::gc_prologue(); BiasedLocking::preserve_marks(); //        . //       . DerivedPointerTable::clear(); }</span></span></code> </pre> <br><p> ç”±äºæˆ‘ä»¬ä½¿ç”¨ä½å›¾æ¥è·Ÿè¸ªå¯¹è±¡çš„å¯åŠæ€§ï¼Œå› æ­¤éœ€è¦åœ¨ä½¿ç”¨å‰æ¸…é™¤å®ƒã€‚ æˆ–è€…åœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œç”±äºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯åœ¨å¼€å§‹GCå‘¨æœŸä¹‹å‰æ°¸è¿œä¸è¦æ±‚èµ„æºï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»æå‰<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†ä½å›¾æäº¤åˆ°å†…å­˜</a> ã€‚ è‡³å°‘åœ¨Linuxä¸Šï¼Œè¿™æä¾›äº†è®¸å¤šæœ‰è¶£çš„ä¼˜ç‚¹ï¼Œåœ¨Linuxä¸Šï¼Œå¤§å¤šæ•°ä½å›¾å°†æŒ‡å‘é¡µé¢0ï¼Œå°¤å…¶æ˜¯å¯¹äºç¨€ç–å †ã€‚ </p><br><p> çº¿ç¨‹åº”é‡Šæ”¾å…¶TLABï¼Œå¹¶åœ¨æ„å»ºå®Œæˆåå‘GCç´¢è¦æ–°çš„TLABã€‚ </p><br><blockquote> ä¸è¦æ··æ·†TLABå’Œ<code>java.lang.ThreadLocal</code> ã€‚ ä»GCçš„è§’åº¦æ¥çœ‹ï¼ŒThreadLocalæ˜¯æ™®é€šå¯¹è±¡ï¼Œé™¤éJavaä»£ç ä¸­å¦æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¦åˆ™å®ƒä»¬ä¸ä¼šç”±GCç¼–è¯‘ã€‚ </blockquote><p> è¿è¡Œæ—¶çš„æŸäº›éƒ¨åˆ†ï¼Œå°¤å…¶æ˜¯é‚£äº›æŒæœ‰Javaå †é“¾æ¥çš„éƒ¨åˆ†ï¼Œåœ¨åƒåœ¾å›æ”¶æœŸé—´ä¼šä¸­æ–­ï¼Œå› æ­¤æ‚¨éœ€è¦ç‰¹åˆ«è­¦å‘Šå®ƒä»¬ï¼ŒGCå³å°†å¼€å§‹å·¥ä½œã€‚ è¿™å°†å…è®¸å„ä¸ªå­ç³»ç»Ÿåœ¨GCè¿›è¡Œç§»åŠ¨ä¹‹å‰å‡†å¤‡å¹¶ä¿å­˜å…¶éƒ¨åˆ†çŠ¶æ€ã€‚ </p><br><a name="32"></a><br><h2 id="32-markirovka">  3.2ã€‚ æ‰“æ ‡ </h2><br><p> å½“å‡ ä¹æ‰€æœ‰äº‹æƒ…éƒ½å·²ç»ä¸ºæˆ‘ä»¬å®Œæˆæ—¶ï¼Œåœ¨åœæ­¢æ¨¡å¼ä¸‹è¿›è¡Œæ ‡è®°å˜å¾—éå¸¸ç®€å•ã€‚ æ ‡è®°æ˜¯éå¸¸æ ‡å‡†çš„ï¼Œå¹¶ä¸”åœ¨è®¸å¤šå®ç°ä¸­ï¼Œå¾ˆå¯èƒ½GCæ˜¯ç¬¬ä¸€æ­¥ã€‚ </p><br><pre> <code class="cpp hljs">{ GCTraceTime(Info, gc) time(<span class="hljs-string"><span class="hljs-string">"Step 1: Mark"</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    ,     .  //   ,  ,    //      . EpsilonMarkStack stack; EpsilonScanOopClosure cl(&amp;stack, &amp;_bitmap); //      . process_roots(&amp;cl); stat_reachable_roots = stack.size(); //    ,    . //    ,   , //      . while (!stack.is_empty()) { oop obj = stack.pop(); obj-&gt;oop_iterate(&amp;cl); stat_reachable_heap++; } //       . DerivedPointerTable::set_active(false); }</span></span></code> </pre> <br><p> è¿™ä¸ä»»ä½•å…¶ä»–å›¾å½¢å®Œå…¨ç›¸åŒï¼šæ‚¨å¯ä»¥é€šè¿‡åˆå§‹ä¸€ç»„å¯åˆ°è¾¾çš„é¡¶ç‚¹å¼€å§‹éå†ï¼Œæ²¿ç€è¾“å‡ºçš„è¾¹æ²¿èµ°å¹¶è®°å½•æ‰€æœ‰å·²è®¿é—®çš„é¡¶ç‚¹ã€‚ éå†ç»§ç»­ç›´åˆ°æ‰€æœ‰æœªè®¿é—®çš„å³°ç»“æŸã€‚ åœ¨GCä¸­ï¼Œâ€œé¡¶ç‚¹â€æ˜¯å¯¹è±¡ï¼Œâ€œè¾¹ç¼˜â€æ˜¯å®ƒä»¬ä¹‹é—´çš„é“¾æ¥ã€‚ </p><br><p> ä»æŠ€æœ¯ä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥é€’å½’åœ°éå†å¯¹è±¡å›¾ï¼Œä½†è¿™å¯¹äºç›´å¾„å¾ˆå¤§çš„ä»»æ„å›¾æ¥è¯´æ˜¯ä¸ªåä¸»æ„ã€‚ æƒ³è±¡ä¸€ä¸‹ä¸€ä¸ªåäº¿ä¸ªå³°çš„é“¾æ¥åˆ—è¡¨ï¼ å› æ­¤ï¼Œä¸ºäº†é™åˆ¶é€’å½’çš„æ·±åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨æ ‡è®°å †æ ˆæ¥è®°å½•æ£€æµ‹åˆ°çš„å¯¹è±¡ã€‚ </p><br><p> å¯è®¿é—®å¯¹è±¡çš„åˆå§‹é›†åˆæ˜¯GCæ ¹ã€‚ ç°åœ¨ï¼Œä¸è¦å†è®¨è®º<code>process_roots</code>ä»€ä¹ˆäº†ï¼Œä»¥åå†ä»‹ç»ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬åªè¯´å®ƒç»•è¿‡äº†VMç«¯æ‰€æœ‰å¯è®¿é—®çš„é“¾æ¥ã€‚ </p><br><p> å¸¦æœ‰æ ‡è®°çš„ä½å›¾æ—¢å¯ä»¥ç”¨ä½œè®°å½•<em>æ ‡è®°æ³¢å‰</em>çš„å·¥å…·ï¼ˆå·²ç»è®¿é—®è¿‡è®¸å¤šå¯¹è±¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ç”¨ä½œæœ€ç»ˆå­˜å‚¨æ‰€æœ‰å¯åˆ°è¾¾å¯¹è±¡çš„é›†åˆï¼ˆä½œä¸ºæ‰€éœ€ç»“æœçš„å­˜å‚¨åº“ï¼‰ã€‚ å®é™…çš„å·¥ä½œå‘ç”Ÿåœ¨<code>EpsilonScanOopClosure</code> ï¼Œå®ƒåº”ç”¨äºæ‰€æœ‰æœ‰è¶£çš„å¯¹è±¡ï¼Œå¹¶åœ¨æ‰€é€‰å¯¹è±¡çš„æ‰€æœ‰é“¾æ¥ä¸Šè¿›è¡Œè¿­ä»£ã€‚ </p><br><blockquote> çœ‹ï¼ŒJavaçŸ¥é“åœ¨æµè¡Œä¹‹å‰å¦‚ä½•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³é—­ï¼ˆå…³é—­ï¼‰</a> ï¼ </blockquote><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EpsilonScanOopClosure</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BasicOopIterateClosure { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: EpsilonMarkStack* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _stack; MarkBitMap* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _bitmap; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do_oop_work</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-comment"><span class="hljs-comment">// p -     ,   oop,   //      ,  : T o = RawAccess&lt;&gt;::oop_load(p); if (!CompressedOops::is_null(o)) { oop obj = CompressedOops::decode_not_null(o); //  . ,   .  , //        . //    +, //       . if (!_bitmap-&gt;is_marked(obj)) { _bitmap-&gt;mark((HeapWord*)obj); _stack-&gt;push(obj); } } } };</span></span></code> </pre> <br><p> å®Œæˆæ­¤æ­¥éª¤åï¼Œ <code>_bitmap</code>åŒ…å«æŒ‡ç¤ºæ´»åŠ¨å¯¹è±¡ä½ç½®çš„ä½ã€‚ å› æ­¤ï¼Œå¯ä»¥ç»•å¼€æ‰€æœ‰æ´»åŠ¨å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//           . //   ,    ( )  ,  //       1/64  . void EpsilonHeap::walk_bitmap(ObjectClosure* cl) { HeapWord* limit = _space-&gt;top(); HeapWord* addr = _bitmap.get_next_marked_addr(_space-&gt;bottom(), limit); while (addr &lt; limit) { oop obj = oop(addr); assert(_bitmap.is_marked(obj), "sanity"); cl-&gt;do_object(obj); addr += 1; if (addr &lt; limit) { addr = _bitmap.get_next_marked_addr(addr, limit); } } }</span></span></code> </pre> <br><a name="33"></a><br><h2 id="33-vychislyaem-novye-adresa">  3.3ã€‚ è®¡ç®—æ–°åœ°å€ </h2><br><p> è¿™ä¹Ÿæ˜¯ä¸€ä¸ªç›¸å½“ç®€å•çš„æ­¥éª¤ï¼Œå®ƒå®Œå…¨å®ç°äº†ç®—æ³•æ‰€è¯´çš„å†…å®¹ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ab3/406/5e6/ab34065e6397d39413057358b45247a3.jpg"></p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    forwarding data (,    ) //   .        . //          . PreservedMarks preserved_marks; //     GC. HeapWord* new_top; { GCTraceTime(Info, gc) time("Step 2: Calculate new locations", NULL); //    ,        //    . ,  - . EpsilonCalcNewLocationObjectClosure cl(_space-&gt;bottom(), &amp;preserved_marks); walk_bitmap(&amp;cl); //         . //       ,    //      ,      "" //  . new_top = cl.compact_point(); stat_preserved_marks = preserved_marks.size(); }</span></span></code> </pre> <br><p> å”¯ä¸€å¼•èµ·æ‚¨æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å†³å®šå°†æ–°åœ°å€å­˜å‚¨åœ¨Javaå¯¹è±¡çš„æ ‡è®°è¯ä¸­ï¼Œå¹¶ä¸”è¯¥è¯å·²ç»è¢«ä¸€äº›é‡è¦çš„ä¸œè¥¿å ç”¨ï¼Œä¾‹å¦‚ï¼Œæœ‰å…³é”çš„ä¿¡æ¯ã€‚ å¹¸è¿çš„æ˜¯ï¼Œè¿™ç§éå¹³å‡¡çš„æ ‡è®°è¯éå¸¸å°‘è§ï¼Œå¦‚æœæœ‰å¿…è¦ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å®ƒä»¬åˆ†å¼€å­˜å‚¨ï¼šè¿™å°±æ˜¯<code>PreservedMarks</code>ç”¨é€”ã€‚ </p><br><p> çœŸæ­£çš„ç®—æ³•å·¥ä½œç”±<code>EpsilonCalcNewLocationObjectClosure</code>å®Œæˆï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EpsilonCalcNewLocationObjectClosure</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ObjectClosure { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: HeapWord* _compact_point; PreservedMarks* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _preserved_marks; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: EpsilonCalcNewLocationObjectClosure(HeapWord* start, PreservedMarks* pm) : _compact_point(start), _preserved_marks(pm) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_object</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(oop obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    :    . //        (      , //    ),      , //     . if ((HeapWord*)obj != _compact_point) { markOop mark = obj-&gt;mark_raw(); if (mark-&gt;must_be_preserved(obj)) { _preserved_marks-&gt;push(obj, mark); } obj-&gt;forward_to(oop(_compact_point)); } _compact_point += obj-&gt;size(); } HeapWord* compact_point() { return _compact_point; } };</span></span></code> </pre> <br><p>  <code>forward_to</code>æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒå°†â€œç§»åŠ¨åœ°å€â€å­˜å‚¨åœ¨å¯¹è±¡çš„æ ‡è®°è¯ä¸­ã€‚ åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­å°†éœ€è¦è¿™æ ·åšã€‚ </p><br><a name="34"></a><br><h2 id="34-ispravlyaem-ukazateli">  3.4ã€‚ ä¿®æ­£æŒ‡é’ˆ </h2><br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦å†æ¬¡éå†å †ï¼Œå¹¶æ ¹æ®ä»¥ä¸‹ç®—æ³•ç”¨æ–°åœ°å€é‡å†™æ‰€æœ‰é“¾æ¥ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/25f/c82/1dc/25fc821dc95d2f9d50fe40653eb845ff.jpg"></p><br><pre> <code class="cpp hljs">{ GCTraceTime(Info, gc) time(<span class="hljs-string"><span class="hljs-string">"Step 3: Adjust pointers"</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     _   _,     // Â« Â».      forwarding data, //    .      . EpsilonAdjustPointersObjectClosure cl; walk_bitmap(&amp;cl); //     ,      VM,  //     :      . EpsilonAdjustPointersOopClosure cli; process_roots(&amp;cli); //   ,      , //     . preserved_marks.adjust_during_full_gc(); }</span></span></code> </pre> <br><p> æœ‰ä¸¤ç§å¯¹ç§»ä½å¯¹è±¡çš„å¼•ç”¨ï¼šä»å †æœ¬èº«ä¸Šçš„å¯¹è±¡æˆ–ä»GCæ ¹å‘å‡ºçš„å¼•ç”¨ã€‚ æ‚¨éœ€è¦æ›´æ–°ä¸¤ä¸ªé“¾æ¥ç±»ã€‚ ä¸€äº›ä¿å­˜çš„æ ‡ç­¾è¿˜å­˜å‚¨äº†å¯¹å¯¹è±¡çš„å¼•ç”¨ï¼Œå› æ­¤æ‚¨éœ€è¦è¦æ±‚å®ƒä»¬è¿›è¡Œæ›´æ–°ã€‚  <code>PreservedMarks</code>çŸ¥é“å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œï¼Œå› ä¸ºå®ƒå¸Œæœ›åœ¨å¯¹è±¡çš„æ ‡è®°å­—è¯ä¸­å°†â€œè½¬å‘æ•°æ®â€ä¿å­˜åœ¨æˆ‘ä»¬ä¿å­˜è¯¥æ•°æ®çš„ä½ç½®ã€‚ </p><br><p> é—­åŒ…åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šæœ‰äº›å°é—­å¯¹è±¡å¹¶ç»•è¿‡å®ƒä»¬çš„å†…å®¹ï¼Œå¦ä¸€äº›åˆ™æ›´æ–°è¿™äº›åœ°å€ã€‚ æ‚¨å¯ä»¥åœ¨æ­¤å¤„è¿›è¡Œä¸€äº›å°çš„æ€§èƒ½ä¼˜åŒ–ï¼šå¦‚æœå¯¹è±¡ä¸ç§»åŠ¨ï¼Œåˆ™å¯ä»¥å°†å‡ æ¡è®°å½•ä¿å­˜ä¸ºä¸€å †ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EpsilonAdjustPointersOopClosure</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> BasicOopIterateClosure { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do_oop_work</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class">) {</span></span> <span class="hljs-comment"><span class="hljs-comment">// p -     ,   oop. //        ,  : T o = RawAccess&lt;&gt;::oop_load(p); if (!CompressedOops::is_null(o)) { oop obj = CompressedOops::decode_not_null(o); //         . //  ,    . if (obj-&gt;is_forwarded()) { oop fwd = obj-&gt;forwardee(); assert(fwd != NULL, "just checking"); RawAccess&lt;&gt;::oop_store(p, fwd); } } } }; class EpsilonAdjustPointersObjectClosure : public ObjectClosure { private: EpsilonAdjustPointersOopClosure _cl; public: void do_object(oop obj) { //    ,    : obj-&gt;oop_iterate(&amp;_cl); } };</span></span></code> </pre> <br><p> å®Œæˆæ­¤æ­¥éª¤åï¼Œæˆ‘ä»¬å®è´¨ä¸Šç ´åäº†å †ï¼šé“¾æ¥æŒ‡å‘å¯¹è±¡å°šæœªä½äºçš„â€œé”™è¯¯â€åœ°å€ã€‚ è®©æˆ‘ä»¬ä¿®å¤å®ƒï¼ </p><br><a name="35"></a><br><h2 id="35-dvigaem-obekty">  3.5ã€‚ æˆ‘ä»¬ç§»åŠ¨ç‰©ä½“ </h2><br><p> æ ¹æ®ç®—æ³•å°†å¯¹è±¡ç§»åŠ¨åˆ°æ–°åœ°å€çš„æ—¶é—´ï¼š </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/01c/5b8/db8/01c5b8db85781c82b89bbed730c8aecc.jpg"></p><br><p> å†æ¬¡<code>EpsilonMoveObjectsObjectClosure</code>å †ï¼Œå¹¶å°†<code>EpsilonMoveObjectsObjectClosure</code>é—­åŒ…åº”ç”¨äºæ‰€æœ‰æ´»åŠ¨å¯¹è±¡ï¼š </p><br><pre> <code class="cpp hljs">{ GCTraceTime(Info, gc) time(<span class="hljs-string"><span class="hljs-string">"Step 4: Move objects"</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">//       . //          . EpsilonMoveObjectsObjectClosure cl; walk_bitmap(&amp;cl); stat_moved = cl.moved(); //         ,   // Â«Â»      . _space-&gt;set_top(new_top); }</span></span></code> </pre> <br><p> ä¹‹åï¼Œæ‚¨å¯ä»¥ç«‹å³æ‹–åŠ¨å‹ç¼©ç‚¹å †çš„å †ï¼Œä»è€Œæœ‰å¯èƒ½åœ¨åƒåœ¾å›æ”¶å‘¨æœŸç»“æŸåç«‹å³ä»è¯¥ä½ç½®ç›´æ¥åˆ†é…å†…å­˜ã€‚ </p><br><p> è¯·æ³¨æ„ï¼Œåœ¨ç§»ä½ç¨‹åºé›†ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¦†ç›–ç°æœ‰å¯¹è±¡çš„å†…å®¹ï¼Œä½†æ˜¯ç”±äºæ‰«ææ–¹å‘ç›¸åŒï¼Œå› æ­¤å·²è¦†ç›–çš„å¯¹è±¡å·²ç»å¤åˆ¶åˆ°æ­£ç¡®çš„ä½ç½®ã€‚ </p><br><blockquote> åŒä¸€è®¾æ–½çš„æ—§ä½ç½®å’Œæ–°ä½ç½®å¯èƒ½ç›¸äº¤ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå°†ä¸€ä¸ª100å­—èŠ‚çš„å¯¹è±¡ç§»åŠ¨8ä¸ªå­—èŠ‚ã€‚ å¤åˆ¶è¿‡ç¨‹åº”è‡ªè¡Œè§£å†³ï¼Œå¹¶ä¸”ç›¸äº¤çš„å†…å®¹åº”æ­£ç¡®å¤åˆ¶ï¼Œè¯·æ³¨æ„<code>Copy::aligned_*conjoint*_words</code> ã€‚ </blockquote><p> é—­åŒ…æœ¬èº«åªä¼šå°†ç§»åŠ¨çš„å¯¹è±¡ç§»åŠ¨åˆ°æ–°åœ°å€ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EpsilonMoveObjectsObjectClosure</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ObjectClosure { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_object</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(oop obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     ,  .   - , //   -  mark word, //      forwarding data. if (obj-&gt;is_forwarded()) { oop fwd = obj-&gt;forwardee(); assert(fwd != NULL, "just checking"); Copy::aligned_conjoint_words((HeapWord*)obj, (HeapWord*)fwd, obj-&gt;size()); fwd-&gt;init_mark_raw(); } } };</span></span></code> </pre> <br><a name="36"></a><br><h2 id="36-epilog">  3.6ã€‚ ç»“è¯­ </h2><br><p> åƒåœ¾æ”¶é›†å®Œæˆï¼Œå †å†æ¬¡å‡ ä¹ä¸€è‡´ï¼Œå‰©ä¸‹æœ€åçš„ä¿®é¥°ï¼š </p><br><pre> <code class="cpp hljs">{ GCTraceTime(Info, gc) time(<span class="hljs-string"><span class="hljs-string">"Step 5: Epilogue"</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . preserved_marks.restore(); //   ,    . DerivedPointerTable::update_pointers(); BiasedLocking::restore_marks(); CodeCache::gc_epilogue(); JvmtiExport::gc_epilogue(); //     . if (!os::uncommit_memory((char*)_bitmap_region.start(), _bitmap_region.byte_size())) { log_warning(gc)("Could not uncommit native memory for marking bitmap"); } //    ,  . //        . if (EpsilonUncommit) { _virtual_space.shrink_by((_space-&gt;end() - new_top) * HeapWordSize); _space-&gt;set_end((HeapWord*)_virtual_space.high()); } }</span></span></code> </pre> <br><p> æˆ‘ä»¬é€šçŸ¥å…¶ä½™çš„è¿è¡Œæ—¶ï¼Œä»–ä»¬åº”è¯¥å¼€å§‹ç»„è£…åç¨‹åºã€‚ æˆ‘ä»¬æ¢å¤äº†å…ˆå‰ä¿å­˜çš„ç‰¹æ®Šæ ‡è®°è¯ã€‚ å‘Šåˆ«å»æˆ‘ä»¬çš„æ ‡è®°å¡-ä¸å†éœ€è¦ã€‚ </p><br><p> è€Œä¸”ï¼Œå¦‚æœæ‚¨ç¡®å®æ„¿æ„ï¼Œå¯ä»¥å°†åˆ†é…çš„å†…å­˜å‡å°‘åˆ°æ–°çš„å¤§å°ï¼Œä»è€Œå°†å†…å­˜è¿”å›ç»™æ“ä½œç³»ç»Ÿï¼ </p><br><a name="4"></a><br><h1 id="4-podklyuchaem-gc-k-vm">  4.å°†GCè¿æ¥åˆ°VM </h1><br><a name="41"></a><br><h2 id="41-obhod-kornevyh-elementov">  4.1ã€‚ æ ¹éå† </h2><br><p> è®°ä½ï¼Œæ‚¨éœ€è¦ç»•è¿‡VMçš„ç‰¹æ®Šï¼Œå¯è®¿é—®çš„é“¾æ¥å—ï¼Ÿ æ‚¨å¯ä»¥è¦æ±‚æ¯ä¸ªç‰¹æ®Šçš„VMå­ç³»ç»Ÿç»•è¿‡å…¶ä»–Javaå¯¹è±¡éšè—çš„é“¾æ¥ã€‚ å½“å‰çƒ­ç‚¹ä¸­æ­¤ç±»æ ¹å…ƒç´ çš„è¯¦å°½åˆ—è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> EpsilonHeap::do_roots(OopClosure* cl) { <span class="hljs-comment"><span class="hljs-comment">//   ,        1 . StrongRootsScope scope(1); //         . CLDToOopClosure clds(cl, ClassLoaderData::_claim_none); MarkingCodeBlobClosure blobs(cl, CodeBlobToOopClosure::FixRelocations); //      . //        . { MutexLockerEx lock(CodeCache_lock, Mutex::_no_safepoint_check_flag); CodeCache::blobs_do(&amp;blobs); } { MutexLockerEx lock(ClassLoaderDataGraph_lock); ClassLoaderDataGraph::cld_do(&amp;clds); } Universe::oops_do(cl); Management::oops_do(cl); JvmtiExport::oops_do(cl); JNIHandles::oops_do(cl); WeakProcessor::oops_do(cl); ObjectSynchronizer::oops_do(cl); SystemDictionary::oops_do(cl); Threads::possibly_parallel_oops_do(false, cl, &amp;blobs); }</span></span></code> </pre> <br><p>  ,        .    GC    . </p><br><a name="42"></a><br><h2 id="42-seyfpointy-i-ostanovka-mira">  4.2ã€‚     </h2><br><p>   GC     ,   VM      .  Hotspot     <code>VM_Operation</code> ,     GC    VM-  : </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// VM_operation,      class VM_EpsilonCollect: public VM_Operation { private: const GCCause::Cause _cause; EpsilonHeap* const _heap; static size_t _last_used; public: VM_EpsilonCollect(GCCause::Cause cause) : VM_Operation(), _cause(cause), _heap(EpsilonHeap::heap()) {}; VM_Operation::VMOp_Type type() const { return VMOp_EpsilonCollect; } const char* name() const { return "Epsilon Collection"; } virtual bool doit_prologue() { //     ,     . //         GC, //          . //   ,         //  .     , //       1%, ,  , //     . Heap_lock-&gt;lock(); size_t used = _heap-&gt;used(); size_t capacity = _heap-&gt;capacity(); size_t allocated = used &gt; _last_used ? used - _last_used : 0; if (_cause != GCCause::_allocation_failure || allocated &gt; capacity / 100) { return true; } else { Heap_lock-&gt;unlock(); return false; } } virtual void doit() { _heap-&gt;entry_collect(_cause); } virtual void doit_epilogue() { _last_used = _heap-&gt;used(); Heap_lock-&gt;unlock(); } }; size_t VM_EpsilonCollect::_last_used = 0; void EpsilonHeap::vmentry_collect(GCCause::Cause cause) { VM_EpsilonCollect vmop(cause); VMThread::execute(&amp;vmop); }</span></span></code> </pre> <br><p>       ,       GC â€”    ,     . </p><br><a name="43"></a><br><h2 id="43-oshibki-vydeleniya-pamyati">  4.3ã€‚    </h2><br><p> ,     GC  ,   ,  GC    ,     .   ,      <code>allocate_work</code>     ,   GC     : </p><br><pre> <code class="cpp hljs">HeapWord* EpsilonHeap::allocate_or_collect_work(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size) { HeapWord* res = allocate_work(size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; EpsilonSlidingGC) { vmentry_collect(GCCause::_allocation_failure); res = allocate_work(size); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre> <br><p>   ! </p><br><a name="5"></a><br><h1 id="5-sborka"> 5.  </h1><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> </a>        OpenJDK. </p><br><pre> <code class="bash hljs">$ hg <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://hg.openjdk.java.net/jdk/jdk/ jdk-jdk $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> jdk-jdk $ curl https://shipilev.net/jvm/diy-gc/webrev/jdk-jdk-epsilon.changeset | patch -p1</code> </pre> <br><p>     OpenJDK  : </p><br><pre> <code class="bash hljs">$ ./configure --with-debug-level=fastdebug $ make images</code> </pre> <br><p>    : </p><br><pre> <code class="bash hljs">$ build/linux-x86_64-server-fastdebug/images/jdk/bin/java -XX:+UnlockExperimentalVMOptions -XX:+UseEpsilonGC -XX:+EpsilonSlidingGC -version openjdk version <span class="hljs-string"><span class="hljs-string">"13-internal"</span></span> 2019-09-17 OpenJDK Runtime Environment (build 13-internal+0-adhoc.shade.jdk-jdk-epsilon) OpenJDK 64-Bit Server VM (build 13-internal+0-adhoc.shade.jdk-jdk-epsilon, mixed mode, sharing</code> </pre> <br><a name="6"></a><br><h1 id="6-testirovanie"> 6.  </h1><br><p>  ,    GC  ?    : </p><br><ol><li> .  .   Hotspot    ,   JVM   <em>fastdebug</em>        ,        GC. </li><li>  .        ,          . ,        ( )   ,          . </li><li> æµ‹è¯•ã€‚    ,  ,   ,   .     -   ,        . </li></ol><br><p> ,    ,       : </p><br><pre> <code class="plaintext hljs">$ CONF=linux-x86_64-server-fastdebug make images run-test TEST=gc/epsilon/ Building targets 'images run-test' in configuration 'linux-x86_64-server-fastdebug' Test selection 'gc/epsilon/', will run: * jtreg:test/hotspot/jtreg/gc/epsilon Running test 'jtreg:test/hotspot/jtreg/gc/epsilon' Passed: gc/epsilon/TestAlwaysPretouch.java Passed: gc/epsilon/TestAlignment.java Passed: gc/epsilon/TestElasticTLAB.java Passed: gc/epsilon/TestEpsilonEnabled.java Passed: gc/epsilon/TestHelloWorld.java Passed: gc/epsilon/TestLogTrace.java Passed: gc/epsilon/TestDieDefault.java Passed: gc/epsilon/TestDieWithOnError.java Passed: gc/epsilon/TestMemoryPools.java Passed: gc/epsilon/TestMaxTLAB.java Passed: gc/epsilon/TestPrintHeapSteps.java Passed: gc/epsilon/TestArraycopyCheckcast.java Passed: gc/epsilon/TestClasses.java Passed: gc/epsilon/TestUpdateCountersSteps.java Passed: gc/epsilon/TestDieWithHeapDump.java Passed: gc/epsilon/TestByteArrays.java Passed: gc/epsilon/TestManyThreads.java Passed: gc/epsilon/TestRefArrays.java Passed: gc/epsilon/TestObjects.java Passed: gc/epsilon/TestElasticTLABDecay.java Passed: gc/epsilon/TestSlidingGC.java Test results: passed: 21 TEST SUCCESS</code> </pre> <br><p> ?       <em>fastdebug</em>    .  ?    - . </p><br><a name="7"></a><br><h1 id="7-proizvoditelnost"> 7.  </h1><br><p> -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">spring-petclinic</a> ,  Apache Bench     GC!        ,  ,     GC . </p><br><p>    : <code>-Xlog:gc -XX:+UnlockExperimentalVMOptions -XX:+UseEpsilonGC -XX:+EpsilonSlidingGC</code> : </p><br><p> : </p><br><pre> <code class="plaintext hljs">Heap: 20480M reserved, 20480M (100.00%) committed, 19497M (95.20%) used GC(2) Step 0: Prologue 2.085ms GC(2) Step 1: Mark 51.005ms GC(2) Step 2: Calculate new locations 71.207ms GC(2) Step 3: Adjust pointers 49.671ms GC(2) Step 4: Move objects 22.839ms GC(2) Step 5: Epilogue 1.008ms GC(2) GC Stats: 70561 (8.63%) reachable from roots, 746676 (91.37%) reachable from heap, 91055 (11.14%) moved, 2237 (0.27%) markwords preserved GC(2) Heap: 20480M reserved, 20480M (100.00%) committed, 37056K (0.18%) used GC(2) Lisp2-style Mark-Compact (Allocation Failure) 20479M-&gt;36M(20480M) 197.940ms</code> </pre> <br><p> 200 ?        GC!   ,         .   ,          ,   :         (      â€”  ,    ).       - (                ). </p><br><p>  , GC          . ,   <code>-Xlog:gc -XX:+UseSerialGC</code> â€”  ,  ,  : </p><br><pre> <code class="plaintext hljs">GC(46) Pause Young (Allocation Failure) 575M-&gt;39M(1943M) 2.603ms GC(47) Pause Young (Allocation Failure) 575M-&gt;39M(1943M) 2.606ms GC(48) Pause Young (Allocation Failure) 575M-&gt;39M(1943M) 2.747ms GC(49) Pause Young (Allocation Failure) 575M-&gt;39M(1943M) 2.578ms</code> </pre> <br><p> , 2 .  ,        ,   GC   .      <code>-Xlog:gc -XX:+UseSerialGC</code> ,       ,      : </p><br><pre> <code class="plaintext hljs">GC(3) Pause Full (Allocation Failure) 16385M-&gt;34M(18432M) 1969.694ms GC(4) Pause Full (Allocation Failure) 16385M-&gt;34M(18432M) 2261.405ms GC(5) Pause Full (Allocation Failure) 16385M-&gt;34M(18432M) 2327.577ms GC(6) Pause Full (Allocation Failure) 16385M-&gt;34M(18432M) 2328.976ms</code> </pre> <br><p>     ,    .    . </p><br><a name="8"></a><br><h1 id="8-chto-dalshe"> 8.  ? </h1><br><p>     .       ,    GC  OpenJDK â€”  ,    ,          . </p><br><p>   : </p><br><ol><li><p>    .     ,   // .      .     ,       ,    Â« Â»       ,        ,   . <br></p><blockquote>    GC, <code>java.lang.ref.Reference.referent</code> â€”     Java-,  ,   ,     -  .       <code>FinalReference</code> ,    . </blockquote>         <code>ReferenceProcessor</code>     /  /     . <br></li><li><p>        VM.              VM,   ,   ,       .       <em></em>  <em></em>  .  ,    <em></em>  ,  ,     -  <em></em>   ,    . </p><br></li><li><p>  .      â€”    ,    GC,          .  ,    ,      ,       . <br></p><blockquote>    mark-compact GC   Full GC fallbacks  Shenandoah (  OpenJDK 8)  G1 (  OpenJDK 10,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JEP 307: Â«Parallel Full GC for G1Â»</a> ). </blockquote><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> .  ,        Â«Â»     ,     , ,  -     .           .   ,          . </p><br></li><li><p>        .     ,  ,     ,           .   ,     Â«Â» â€”    Â«Â»        Â«Â» ,      . </p><br></li><li><p>  -   GC Handbook     . </p><br></li></ol><br><a name="9"></a><br><h1 id="9-vyvody"> 9.  </h1><br><p>       ?   GC â€”  , ,  ,        GC. </p><br><p>         ,    -  GC   . ,     ,            GC (, Serial GC  Parallel GC),         . </p><br><blockquote> åˆ†é’Ÿçš„å¹¿å‘Šã€‚  , 5-6  2019,  JPoint â€”    Java-.           â€” OpenJDK, GraalVM, Kotlin  .        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">  </a> . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN443250/">https://habr.com/ru/post/zh-CN443250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN443240/index.html">äº†è§£Qå­¦ä¹ ï¼Œâ€œèµ°åœ¨å²©çŸ³ä¸Šâ€çš„é—®é¢˜</a></li>
<li><a href="../zh-CN443242/index.html">Quarkusæ˜¯è¶…éŸ³é€ŸäºšåŸå­Javaã€‚ æ¡†æ¶çš„ç®€è¦æ¦‚è¿°</a></li>
<li><a href="../zh-CN443244/index.html">æ±‡æŠ¥ä»»åŠ¡ã€‚ Beanpoisk_1</a></li>
<li><a href="../zh-CN443246/index.html">åœ¨å¼€å‘å•†å‡ºå”®å¹¶å…³é—­é¡¹ç›®åï¼Œæˆ‘ä»¬å¦‚ä½•é‡å¡‘Askozia IP PBX</a></li>
<li><a href="../zh-CN443248/index.html">PRPå’ŒHSRçš„æ— ç¼ä¿ç•™åè®®</a></li>
<li><a href="../zh-CN443252/index.html">å¸¦å†…å­˜çš„æ¨¡å—åŒ–èš‚èšæœºå™¨äºº</a></li>
<li><a href="../zh-CN443254/index.html">æµ·å«ä¸€æ˜¯æœ€è‡´å‘½çš„ç—…æ¯’</a></li>
<li><a href="../zh-CN443256/index.html">PowerShellï¼Œæˆ‘çš„ç»éªŒè½¬å‚¨</a></li>
<li><a href="../zh-CN443258/index.html">Gotify-ä¸€ä¸ªç”¨äºå‘é€é€šçŸ¥å¹¶å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨çš„å¼€æºé¡¹ç›®</a></li>
<li><a href="../zh-CN443260/index.html">è¿ç§»åˆ°Zimbraï¼Œè€Œä¸ä¼šå†’ç€ä½¿ç”¨é€šç”¨åŸŸåè¿›è¡Œä¸šåŠ¡çš„é£é™©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>