<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♦️ 💜 ⛹🏼 Gatsby.js en détail 🤙🏿 🐌 🌂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comme vous le savez, vous ne pouvez pas aller loin sur certains passe-plats seuls, vous devez donc approfondir toutes les technologies pour apprendre ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gatsby.js en détail</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442298/"><p><img src="https://habrastorage.org/webt/05/2c/ll/052cllvfmcuw_rru5rhjwhxxqem.jpeg"></p><br><p>  Comme vous le savez, vous ne pouvez pas aller loin sur certains passe-plats seuls, vous devez donc approfondir toutes les technologies pour apprendre à écrire quelque chose de valable.  Cet article traite des détails de <strong>Gatsby.js</strong> , dont la connaissance vous permettra de créer et de maintenir des sites Web et des blogs complexes. </p><a name="habracut"></a><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article précédent</a> sur la création et la publication d'un blog personnel à l'aide de JAM-stack </blockquote><p>  Sujets abordés ci-dessous: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structure et routage des pages</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Composants, modèles et leur interaction</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Travailler avec des données</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plugins</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Style d'application</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Optimisation SEO avec react-casque</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration PWA</a> </li></ul><br><h2 id="podgotovka">  La préparation </h2><br><div class="spoiler">  <b class="spoiler_title">Installer Gatsby sur PC</b> <div class="spoiler_text"><pre><code class="bash hljs">yarn global add gatsby-cli</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Clonage d'un projet minimal</b> <div class="spoiler_text"><pre> <code class="bash hljs"> npx gatsby new gatsby-tutorial https://github.com/gatsbyjs/gatsby-starter-hello-world <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> gatsby-tutorial</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Initialisation du référentiel</b> <div class="spoiler_text"><pre> <code class="bash hljs"> git init git add . git commit -m <span class="hljs-string"><span class="hljs-string">"init commit"</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Bilan de santé</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> yarn start</code> </pre> <br><p>  S'il n'y a pas d'erreurs dans la console et dans le navigateur le long du chemin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8000, vous</a> voyez "Bonjour tout le monde!"  cela signifie que tout fonctionne correctement.  Vous pouvez essayer de modifier le contenu du fichier <em>/src/pages/index.js</em> pour vérifier le rechargement à chaud. </p></div></div><br><h2 id="struktura-stranic-i-routing">  Structure et routage des pages </h2><br><p>  Pour créer une page dans Gatsby, placez simplement le nouveau fichier dans le dossier <em>/ src / pages</em> et il sera compilé dans une page HTML séparée.  <strong>Il est important de noter que le chemin d'accès à cette page correspondra au chemin réel avec le nom</strong> .  Par exemple, ajoutez quelques pages supplémentaires: </p><br><pre> <code class="plaintext hljs">src └── pages ├── about.js ├── index.js └── tutorial ├── part-four.js ├── part-one.js ├── part-three.js ├── part-two.js └── part-zero.js</code> </pre><br><p>  Le contenu n'est pas encore important, donc n'importe quel texte peut être utilisé pour distinguer les pages. </p><br><pre> <code class="plaintext hljs">import React from "react"; export default () =&gt; &lt;div&gt;Welcome to tutorial/part-one&lt;/div&gt;;</code> </pre> <br><p>  Vérifiez dans le navigateur: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8000 / tutorial / part-one</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8000 / about</a> </li></ul><br><p>  De cette façon, lors de la structuration des fichiers, vous pouvez immédiatement résoudre les problèmes de routage. </p><br><blockquote>  Il existe également une <strong>API createPage</strong> spéciale avec laquelle vous pouvez contrôler de manière plus flexible les chemins et les noms des pages, mais pour y travailler, nous avons besoin de comprendre comment les données fonctionnent dans Gatsby, nous allons donc l'examiner un peu plus loin dans l'article. </blockquote><p>  Combinez les pages créées à l'aide des liens, pour cela, nous utilisons le composant <code>&lt;Link /&gt;</code> du package Gatsby, qui a été créé spécifiquement pour la navigation interne.  Pour tous les liens externes, utilisez la balise <code>&lt;a&gt;</code> régulière. </p><br><p>  <em>/src/pages/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link } from "gatsby"; export default () =&gt; ( &lt;div&gt; &lt;ul&gt; &lt;li&gt; &lt;Link to="/about"&gt;about&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-zero"&gt;Part #0&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-one"&gt;Part #1&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-two"&gt;Part #2&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-three"&gt;Part #3&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-four"&gt;Part #4&lt;/Link&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; );</code> </pre> <br><blockquote>  <code>&lt;Link&gt;</code> sous le capot a un mécanisme très délicat pour optimiser le chargement des pages et est donc utilisé à la place de <code>&lt;a&gt;</code> pour naviguer sur le site.  Plus de détails peuvent être trouvés <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </blockquote><p><img src="https://habrastorage.org/webt/no/ev/fj/noevfjkjdbel6tonxughcn6mkfq.gif" alt="navigation"></p><br><p>  Des pages sont créées, des liens sont ajoutés, il s'avère que la navigation est terminée. </p><br><h2 id="komponenty-shablony-i-ih-vzaimodeystvie">  Composants, modèles et leur interaction </h2><br><p>  Comme vous le savez, dans tout projet, il y a toujours des éléments répétitifs, pour les sites Web, c'est un en-tête, un pied de page, une barre de navigation.  De plus, les pages, quel que soit leur contenu, sont construites selon une certaine structure, et comme <strong>Gatsby</strong> est un compilateur pour <strong>React</strong> , la même approche de composant est utilisée pour résoudre ces problèmes. </p><br><p>  Créez les composants pour l'en-tête et le panneau de navigation: </p><br><p>  <em>/src/components/header.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link } from "gatsby"; /** *         *  ,     React-. *      ,    *  " ".     *    ""  GraphQL  gatsby- */ import logoSrc from "../images/logo.png"; export default () =&gt; ( &lt;header&gt; &lt;Link to="/"&gt; &lt;img src={logoSrc} alt="logo" width="60px" height="60px" /&gt; &lt;/Link&gt; That is header &lt;/header&gt; );</code> </pre> <br><p>  <em>/src/components/sidebar.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link } from "gatsby"; export default () =&gt; ( &lt;div&gt; &lt;ul&gt; &lt;li&gt; &lt;Link to="/about"&gt;about&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-zero"&gt;Part #0&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-one"&gt;Part #1&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-two"&gt;Part #2&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-three"&gt;Part #3&lt;/Link&gt; &lt;/li&gt; &lt;li&gt; &lt;Link to="/tutorial/part-four"&gt;Part #4&lt;/Link&gt; &lt;/li&gt; &lt;/ul&gt; &lt;/div&gt; );</code> </pre> <br><p>  et ajoutez-les à <em>/src/pages/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import Header from "../components/header"; import Sidebar from "../components/sidebar"; export default () =&gt; ( &lt;div&gt; &lt;Header /&gt; &lt;Sidebar /&gt; &lt;h1&gt;Index page&lt;/h1&gt; &lt;/div&gt; );</code> </pre> <br><p>  Nous vérifions: </p><br><p><img src="https://habrastorage.org/webt/bg/l6/jn/bgl6jndogi4j0qzvm9q0jvsiglk.jpeg" alt="index_page"></p><br><p>  Tout fonctionne, mais nous devons importer l'en-tête et la barre latérale sur chaque page séparément, ce qui n'est pas très pratique, et pour résoudre ce problème, il suffit de créer un composant de mise en page et d'envelopper chaque page avec. </p><br><blockquote>  Disposition Gatsby == réagir conteneur <br>  <em>oui, ce n'est pas une égalité stricte, parce que c'est "presque" la même chose</em> </blockquote><p>  <em>/src/components/layout.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import Header from "./header"; import Sidebar from "./sidebar"; export default ({ children }) =&gt; ( &lt;&gt; &lt;Header /&gt; &lt;div style={{ margin: `0 auto`, maxWidth: 650, backgroundColor: `#eeeeee` }} &gt; &lt;Sidebar /&gt; {children} &lt;/div&gt; &lt;/&gt; );</code> </pre> <br><p>  <em>/src/pages/index.js</em> (et toutes les autres pages) </p><br><pre> <code class="plaintext hljs">import React from "react"; import Layout from "../components/layout"; export default () =&gt; ( &lt;Layout&gt; &lt;h1&gt;Index page&lt;/h1&gt; &lt;/Layout&gt; );</code> </pre> <br><p>  Terminé, regardez le navigateur: </p><br><p><img src="https://habrastorage.org/webt/9p/9v/wo/9p9vwogkf2px--00mtzbgz2ke64.gif" alt="mise en page"></p><br><blockquote>  Pourquoi le projet contient-il tous les noms de fichiers avec une lettre minuscule?  Pour commencer, déterminons que l’espace de noms pour <strong>React</strong> vient du fait que "chaque fichier est une classe, et la classe est toujours en majuscule".  Dans <strong>Gatsby, les</strong> fichiers contiennent toujours des classes, mais il y a un «mais» - «chaque fichier est une page potentielle, et son nom est l'URL de cette page».  La communauté est arrivée à la conclusion que les liens comme <code>http://domain.com/User/Settings</code> ne sont pas <em>comme-il-faut</em> et ont approuvé le cas de kebab pour les noms de fichiers. </blockquote><br><div class="spoiler">  <b class="spoiler_title">Structure des fichiers</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> src ├── components │ ├── header.js │ ├── layout.js │ └── sidebar.js ├── images │ └── logo.png └── pages ├── about.js ├── index.js └── tutorial ├── part-eight.js ├── part-five.js ├── part-four.js ├── part-one.js ├── part-seven.js ├── part-six.js ├── part-three.js ├── part-two.js └── part-zero.js</code> </pre> </div></div><br><h2 id="rabota-s-dannymi">  Travailler avec des données </h2><br><p>  Maintenant que la structure du site est prête, vous pouvez procéder au remplissage du contenu.  L'approche classique du "hardcode" ne convenait pas aux créateurs de la pile JAM, ainsi qu'au "rendu du contenu à partir des requêtes AJAX" et ils ont donc suggéré de remplir les sites avec du contenu au moment de la compilation.  Dans le cas de <strong>Gatsby</strong> , <strong>GraphQL</strong> est responsable de cela, ce qui vous permet de travailler facilement avec des flux de données provenant de toutes les sources. </p><br><blockquote>  Il est impossible de parler de GraphQL en bref, il est donc conseillé de l'étudier vous-même ou d'attendre mon prochain article.  Vous pouvez en savoir plus sur l'utilisation de GraphQL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </blockquote><p>  Pour travailler avec <strong>GraphQL</strong> , à partir de la deuxième version, le paquet <code>gatsby</code> a un composant <code>gatsby</code> qui peut être utilisé à la fois sur les pages et dans des composants simples, et c'est sa principale différence par rapport à sa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">requête de page</a> précédente.  Jusqu'à présent, notre site n'est connecté à aucune source de données, alors essayons d'afficher les métadonnées de la page, par exemple, puis passons à des choses plus complexes. </p><br><p>  Pour créer une <code>query</code> vous devez ouvrir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http: // localhost: 8000 / ___ graphql</a> , et utiliser la barre latérale avec la documentation pour trouver les données disponibles sur le site, et n'oubliez pas la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">saisie semi</a> -automatique. </p><br><p><img src="https://habrastorage.org/webt/qw/im/yd/qwimydi9eummj2mlkdpuzxdlg_0.gif" alt="graphql"></p><br><p>  <em>/src/components/sidebar.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; export default () =&gt; ( &lt;StaticQuery query={graphql` { allSitePage { edges { node { id path } } } } `} render={({ allSitePage: { edges } }) =&gt; ( &lt;ul&gt; {edges.map(({ node: { id, path } }) =&gt; ( &lt;li key={id}&gt; &lt;Link to={path}&gt;{id}&lt;/Link&gt; &lt;/li&gt; ))} &lt;/ul&gt; )} /&gt; );</code> </pre> <br><p>  Maintenant, à l'aide de la <code>query</code> nous obtenons des données sur les pages que nous rendons dans le panneau de navigation, et nous n'avons pas à nous soucier du fait que le lien ne correspondra pas au nom, car toutes les données sont collectées automatiquement. </p><br><p><img src="https://habrastorage.org/webt/nc/pk/6l/ncpk6l8hirx9guim5am6ikgpfvo.jpeg" alt="queried_navigation_panel"></p><br><p>  En fait, ce sont toutes les données qui peuvent être sur notre site sans utiliser de plug-ins tiers et sans le bon vieux "hardcode", nous passons donc en douceur au sujet suivant de notre article - les plugins. </p><br><h2 id="plaginy">  Plugins </h2><br><p>  À la base, Gatsby est un compilateur avec un tas de goodies, qui sont des plugins.  En les utilisant, vous pouvez personnaliser le traitement de certains fichiers, types de données et différents formats. </p><br><p>  Créez le fichier <em>/gatsby-config.js</em> au niveau racine de l'application.  qui est responsable de la configuration du compilateur dans son ensemble, et essayez de configurer le premier plugin pour travailler avec des fichiers: </p><br><p>  Installation du plugin: </p><br><pre> <code class="bash hljs">yarn add gatsby-source-filesystem</code> </pre> <br><p>  Configuration dans le fichier <em>/gatsby-config.js:</em> </p><br><pre> <code class="plaintext hljs">module.exports = { plugins: [ { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/`, } } ], }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Plus de détails sur le fichier ci-dessus</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> /** * gatsby-config.js     *     JS *     */ module.exports = { /** *  'plugins'  pipeline  * ,      */ plugins: [ /** *        , *         */ `gatsby-example-plugin`, { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/`, } } ], }</code> </pre> </div></div><br><p>  Rappelez-vous que nous avons parlé de la «bonne» importation d'images dans <strong>Gatsby</strong> ? </p><br><p>  <em>/src/components/header.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; export default () =&gt; ( &lt;StaticQuery query={graphql` { allFile(filter: { name: { eq: "logo" } }) { edges { node { publicURL } } } } `} render={({ allFile: { edges: [ { node: { publicURL } } ] } }) =&gt; ( &lt;header&gt; &lt;Link to="/"&gt; &lt;img src={publicURL} alt="logo" width="60px" height="60px" /&gt; &lt;/Link&gt; That is header &lt;/header&gt; )} /&gt; );</code> </pre> <br><p>  Rien n'a changé sur le site, mais maintenant l'image est substituée à l'aide de GraphQL, au lieu d'une simple importation de webpack.  À première vue, il peut sembler que les conceptions sont trop complexes et qu'il s'agissait de gestes inutiles, mais ne nous précipitons pas vers des conclusions, car la chose est dans les mêmes plugins.  Par exemple, si nous décidions de publier des milliers de photos sur le site, dans tous les cas, nous devions penser à optimiser le chargement de tout le contenu, et afin de ne pas construire notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">processus</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chargement paresseux à</a> partir de zéro, nous ajouterions simplement un plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gatsby-image</a> qui optimiserait le chargement de tous images importées à l'aide d'une <code>query</code> . </p><br><p>  Installer des plugins pour le style: </p><br><pre> <code class="bash hljs">yarn add gatsby-plugin-typography react-typography typography typography-theme-noriega node-sass gatsby-plugin-sass gatsby-plugin-styled-components styled-components babel-plugin-styled-components</code> </pre> <br><p>  <em>gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">module.exports = { plugins: [ { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/` } }, // add style plugins below `gatsby-plugin-typography`, `gatsby-plugin-sass`, `gatsby-plugin-styled-components` ] };</code> </pre> <br><blockquote>  Sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel,</a> vous pouvez trouver un plugin pour tous les goûts. </blockquote><br><h2 id="stilizaciya-prilozheniya">  Style d'application </h2><br><p>  Commençons à styliser l'application en utilisant différentes approches.  Dans l'étape précédente, nous avons déjà installé des plugins pour travailler avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SASS</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">styled-components</a> et la bibliothèque <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">typography.js</a> , alors qu'il est important de noter que css.modules sont pris en charge dès la sortie de la boîte. </p><br><p>  Commençons par les styles globaux qui, comme d'autres choses liées à l'ensemble du site, doivent être configurés dans le fichier <em>/gatsby-browser.js</em> : </p><br><pre> <code class="plaintext hljs">import "./src/styles/global.scss";</code> </pre> <br><blockquote>  En savoir plus sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gatsby-browser.js</a> </blockquote><p>  <em>/src/styles/global.scss</em> </p><br><pre> <code class="plaintext hljs">body { background-color: lavenderblush; }</code> </pre> <br><p>  Pour diverses raisons, les tendances de ces dernières années penchent vers l'approche "CSS in JS", il ne faut donc pas abuser des styles globaux et il vaut mieux se limiter à indiquer la police et les classes réutilisées.  Ce projet particulier prévoit d'utiliser <strong>Typography.js</strong> à ces fins, donc les styles globaux resteront vides. </p><br><p>  Vous avez peut-être remarqué des changements dans l'apparence du site après avoir ajouté <code>gatsby-plugin-typography</code> à la configuration - c'est parce que son préréglage par défaut a été appliqué, et maintenant nous allons le configurer pour nous-mêmes. </p><br><p>  <em>/src/utils/typography.js</em> </p><br><pre> <code class="plaintext hljs">import Typography from "typography"; import theme from "typography-theme-noriega"; const typography = new Typography(theme); export default typography;</code> </pre> <br><blockquote>  Vous pouvez sélectionner n'importe quel autre préréglage dans la <a href="">liste</a> ou créer le vôtre à l'aide de l'API du package ( <a href="">exemple de la</a> configuration du site officiel de Gatsby) </blockquote><p>  <em>/gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">module.exports = { plugins: [ { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/` } }, { resolve: `gatsby-plugin-typography`, options: { pathToConfigModule: `src/utils/typography` } }, `gatsby-plugin-sass`, `gatsby-plugin-styled-components` ] };</code> </pre> <br><p>  Et selon le préréglage sélectionné, le style global du site sera modifié.  Décidez quelle approche pour définir des styles globaux pour vous-même, c'est une question de préférences personnelles et de différences d'un point de vue technique, mais nous passons au style des composants en utilisant des composants de <strong>style</strong> : </p><br><p>  Ajouter un fichier avec des variables globales <em>/src/utils/vars.js</em> </p><br><pre> <code class="plaintext hljs">export const colors = { main: `#663399`, second: `#fbfafc`, main50: `rgba(102, 51, 153, 0.5)`, second50: `rgba(251, 250, 252, 0.5)`, textMain: `#000000`, textSecond: `#ffffff`, textBody: `#222222` };</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">/src/components/header.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; import styled from "styled-components"; import { colors } from "../utils/vars"; const Header = styled.header` width: 100%; height: 3em; display: flex; justify-content: space-between; align-items: center; background-color: ${colors.main}; color: ${colors.textSecond}; padding: 0.5em; `; const Logo = styled.img` border-radius: 50%; height: 100%; `; const logoLink = `height: 100%;`; export default () =&gt; ( &lt;StaticQuery query={graphql` { allFile(filter: { name: { eq: "logo" } }) { edges { node { publicURL } } } } `} render={({ allFile: { edges: [ { node: { publicURL } } ] } }) =&gt; ( &lt;Header&gt; That is header &lt;Link to="/" css={logoLink}&gt; &lt;Logo src={publicURL} alt="logo" /&gt; &lt;/Link&gt; &lt;/Header&gt; )} /&gt; );</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">/src/components/sidebar.js</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react" import { Link, StaticQuery, graphql } from "gatsby" import styled from "styled-components" import { colors } from "../utils/vars" const Sidebar = styled.section` position: fixed; left: 0; width: 20%; height: 100%; display: flex; flex-direction: column; justify-content: center; background-color: ${colors.second}; color: ${colors.textMain}; ` const navItem = ` display: flex; align-items: center; margin: 0 1em 0 2em; padding: 0.5em 0; border-bottom: 0.05em solid ${colors.mainHalf}; postion: relative; color: ${colors.textBody}; text-decoration: none; &amp;:before { content: ''; transition: 0.5s; width: 0.5em; height: 0.5em; position: absolute; left: 0.8em; border-radius: 50%; display: block; background-color: ${colors.main}; transform: scale(0); } &amp;:last-child { border-bottom: none; } &amp;:hover { &amp;:before { transform: scale(1); } } ` export default () =&gt; ( &lt;StaticQuery query={graphql` { allSitePage { edges { node { id, path } } } } `} render={({ allSitePage: { edges } }) =&gt; ( &lt;Sidebar&gt; { edges.map(({ node: { id, path } }) =&gt; ( &lt;Link to={path} key={id} css={navItem} &gt;{id}&lt;/Link&gt; )) } &lt;/Sidebar&gt; )} /&gt; )</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/qf/1w/i6/qf1wi6f95fjjjx794g8qvujbksw.gif" alt="stylé"></p><br><p>  Les éléments déjà existants sont stylisés et il est temps d'associer du contenu à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Contentful</a> , de connecter le plugin margin et de générer des pages à l'aide de l' <strong>API createPages</strong> . </p><br><blockquote>  En savoir plus sur la façon de lier Gatsby et Contentful dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent.</a> </blockquote><br><div class="spoiler">  <b class="spoiler_title">Structure de mes données avec Contentful</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> [ { "id": "title", "type": "Symbol" }, { "id": "content", "type": "Text", }, { "id": "link", "type": "Symbol", }, { "id": "orderNumber", "type": "Integer", } ]</code> </pre> </div></div><br><p>  Installation du package: </p><br><pre> <code class="bash hljs">yarn add dotenv gatsby-source-contentful gatsby-transformer-remark</code> </pre> <br><p>  <em>/gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">if (process.env.NODE_ENV === "development") { require("dotenv").config(); } module.exports = { plugins: [ `gatsby-transformer-remark`, { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/`, } }, { resolve: `gatsby-plugin-typography`, options: { pathToConfigModule: `src/utils/typography`, }, }, { resolve: `gatsby-source-contentful`, options: { spaceId: process.env.CONTENTFUL_SPACE_ID, accessToken: process.env.CONTENTFUL_ACCESS_TOKEN, }, }, `gatsby-plugin-sass`, `gatsby-plugin-styled-components`, ], }</code> </pre> <br><p>  Supprimez le dossier <em>/ src / pages</em> avec tous les fichiers à l'intérieur et créez un nouveau fichier pour gérer les nœuds dans Gatsby: </p><br><p>  <em>/gatsby-node.js</em> </p><br><pre> <code class="plaintext hljs">const path = require(`path`); /** *  ,      *       */ exports.createPages = ({ graphql, actions }) =&gt; { /** *        *        *    */ const { createPage } = actions; return graphql(` { allContentfulArticle { edges { node { title link content { childMarkdownRemark { html } } } } } } `).then(({ data: { allContentfulArticle: { edges } } }) =&gt; { /** *       *  createPage()    *      */ edges.forEach(({ node }) =&gt; { createPage({ path: node.link, component: path.resolve(`./src/templates/index.js`), context: { slug: node.link } }); }); }); };</code> </pre> <br><blockquote>  En savoir plus sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gatsby-node.js</a> </blockquote><p>  Créez un fichier modèle qui servira de base aux pages générées <br>  <em>/src/templates/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { graphql } from "gatsby"; import Layout from "../components/layout"; export default ({ data: { allContentfulArticle: { edges: [ { node: { content: { childMarkdownRemark: { html } } } } ] } } }) =&gt; { return ( &lt;Layout&gt; &lt;div dangerouslySetInnerHTML={{ __html: html }} /&gt; &lt;/Layout&gt; ); }; export const query = graphql` query($slug: String!) { allContentfulArticle(filter: { link: { eq: $slug } }) { edges { node { title link content { childMarkdownRemark { html } } } } } } `;</code> </pre> <br><blockquote>  Pourquoi le <code>&lt;StaticQuery /&gt;</code> n'est-il pas utilisé ici?  Le fait est qu'il ne prend pas en charge les variables pour construire une requête, mais nous devons utiliser la variable <code>$slug</code> à partir du contexte de la page. </blockquote><br><div class="spoiler">  <b class="spoiler_title">Mise à jour de la logique dans la barre de navigation</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react"; import { Link, StaticQuery, graphql } from "gatsby"; import styled from "styled-components"; import { colors } from "../utils/vars"; const Sidebar = styled.section` position: fixed; left: 0; width: 20%; height: 100%; display: flex; flex-direction: column; justify-content: center; background-color: ${colors.second}; color: ${colors.textMain}; `; const navItem = ` display: flex; align-items: center; margin: 0 1em 0 2em; padding: 0.5em 0; border-bottom: 0.05em solid ${colors.main50}; postion: relative; color: ${colors.textBody}; text-decoration: none; &amp;:before { content: ''; transition: 0.5s; width: 0.5em; height: 0.5em; position: absolute; left: 0.8em; border-radius: 50%; display: block; background-color: ${colors.main}; transform: scale(0); } &amp;:last-child { border-bottom: none; } &amp;:hover { &amp;:before { transform: scale(1); } } `; export default () =&gt; ( &lt;StaticQuery query={graphql` { allContentfulArticle(sort: { order: ASC, fields: orderNumber }) { edges { node { title link orderNumber } } } } `} render={({ allContentfulArticle: { edges } }) =&gt; ( &lt;Sidebar&gt; {edges.map(({ node: { title, link, orderNumber } }) =&gt; ( &lt;Link to={link} key={link} css={navItem}&gt; {orderNumber}. {title} &lt;/Link&gt; ))} &lt;/Sidebar&gt; )} /&gt; );</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/fn/bc/fs/fnbcfsl-qbdzkh1murfclmr7itk.gif" alt="les données"></p><br><h2 id="seo-optimizaciya">  Optimisation SEO </h2><br><p>  Sur le plan technique, le site peut être considéré comme prêt, alors travaillons avec ses métadonnées.  Pour ce faire, nous avons besoin des plugins suivants: </p><br><pre> <code class="bash hljs">yarn add gatsby-plugin-react-helmet react-helmet</code> </pre> <br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">react-casque</a> génère <code>&lt;head&gt;...&lt;/head&gt;</code> pour les pages HTML et en conjonction avec le rendu Gatsby est un outil puissant et pratique pour travailler avec le référencement. </blockquote><p>  <em>/src/templates/index.js</em> </p><br><pre> <code class="plaintext hljs">import React from "react"; import { graphql } from "gatsby"; import { Helmet } from "react-helmet"; import Layout from "../components/layout"; export default ({ data: { allContentfulArticle: { edges: [ { node: { title, content: { childMarkdownRemark: { html } } } } ] } } }) =&gt; { return ( &lt;Layout&gt; &lt;Helmet&gt; &lt;meta charSet="utf-8" /&gt; &lt;title&gt;{title}&lt;/title&gt; &lt;/Helmet&gt; &lt;div dangerouslySetInnerHTML={{ __html: html }} /&gt; &lt;/Layout&gt; ); }; export const query = graphql` query($slug: String!) { allContentfulArticle(filter: { link: { eq: $slug } }) { edges { node { title link content { childMarkdownRemark { html } } } } } } `;</code> </pre> <br><p>  Désormais, le <code>title</code> site correspondra toujours au titre de l'article, ce qui affectera considérablement la publication du site dans les résultats de recherche spécifiquement pour ce numéro.  Ici, vous pouvez facilement ajouter <code>&lt;meta name="description" content=" "&gt;</code> avec une description de chaque article séparément, permettant ainsi à l'utilisateur de comprendre de quoi parle l'article sur la page de recherche, en général, toutes les fonctionnalités de référencement sont désormais disponibles et gérables un seul endroit. </p><br><p><img src="https://habrastorage.org/webt/_7/l2/ht/_7l2hthmllnqdgycorxhaz2v_mw.png" alt="seo"></p><br><h2 id="nastroyka-pwa">  Configuration PWA </h2><br><p>  <strong>Gatsby est</strong> conçu pour offrir des performances de première classe hors de la boîte.  Il prend en charge les problèmes de séparation et de minimisation du code, ainsi que l'optimisation sous forme de préchargement en arrière-plan, de traitement d'image, etc., afin que le site que vous créez ait des performances élevées sans aucune configuration manuelle.  Ces performances sont un élément important de la prise en charge d'une approche d'application Web progressive. </p><br><p>  Mais en plus de tout ce qui précède, il existe trois critères de base pour un site qui le définissent comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PWA</a> : </p><br><ul><li>  Protocole https </li><li>  présence de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manifest.json</a> </li><li>  accès hors ligne au site en raison <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des travailleurs de service</a> </li></ul><br><p>  Le premier point ne peut pas être résolu par Gatsby, car le <em>domaine</em> , l' <em>hébergement</em> et le <em>protocole</em> sont des problèmes de déploiement, et pas du tout de développement, mais je peux recommander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Netlify</a> , qui résout le problème https par défaut. </p><br><p>  Nous passons aux éléments restants, pour cela nous allons installer deux plugins: </p><br><pre> <code class="bash hljs">yarn add gatsby-plugin-manifest gatsby-plugin-offline</code> </pre> <br><p>  et configurez-les <em>/src/gatsby-config.js</em> </p><br><pre> <code class="plaintext hljs">if (process.env.NODE_ENV === "development") { require("dotenv").config(); } module.exports = { plugins: [ { resolve: `gatsby-plugin-manifest`, options: { name: `GatsbyJS translated tutorial`, short_name: `GatsbyJS tutorial`, start_url: `/`, background_color: `#f7f0eb`, theme_color: `#a2466c`, display: `standalone`, icon: `public/favicon.ico`, include_favicon: true } }, `gatsby-plugin-offline`, `gatsby-transformer-remark`, { resolve: `gatsby-source-filesystem`, options: { name: `images`, path: `${__dirname}/src/images/` } }, { resolve: `gatsby-plugin-typography`, options: { pathToConfigModule: `src/utils/typography` } }, { resolve: `gatsby-source-contentful`, options: { spaceId: process.env.CONTENTFUL_SPACE_ID, accessToken: process.env.CONTENTFUL_ACCESS_TOKEN } }, `gatsby-plugin-sass`, `gatsby-plugin-styled-components`, `gatsby-plugin-react-helmet` ] };</code> </pre> <br><p>  Vous pouvez personnaliser votre manifeste à l'aide de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> , ainsi que personnaliser la stratégie des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">techniciens de</a> service en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">remplaçant les paramètres du plugin</a> . </p><br><p>  Vous ne remarquerez aucun changement dans le mode de développement, mais le site répond déjà aux dernières exigences du monde Web, et lorsqu'il sera hébergé sur https: // domaine, il ne sera pas égal. </p><br><h2 id="vyvod">  Conclusion </h2><br><p>  Il y a quelques années, lorsque j'ai rencontré pour la première fois des problèmes pour mettre l'application React sur Internet, la prendre en charge et mettre à jour le contenu, je ne pouvais pas imaginer qu'il existait déjà une approche JAM-stack sur le marché qui simplifie tous ces processus, et maintenant je ne serai pas surpris. simplicité.  Gatsby résout la plupart des problèmes qui affectent les performances du site juste «prêts à l'emploi», et si vous comprenez un peu plus les subtilités de sa personnalisation selon vos besoins, vous pouvez obtenir des indicateurs à 100% pour tous les éléments de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lighthouse</a> , ce qui affecte considérablement la livraison du site dans les moteurs de recherche (par au moins sur Google). </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Référentiel avec projet</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr442298/">https://habr.com/ru/post/fr442298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr442286/index.html">Les ophtalmologistes russes ont parlé de la vision bionique. La nouvelle application mobile démontre le travail du cyber</a></li>
<li><a href="../fr442288/index.html">Rayonnement: sources</a></li>
<li><a href="../fr442290/index.html">Création de ST-Link V2.1 à partir du chinois ST-Link V2</a></li>
<li><a href="../fr442292/index.html">Stage Sberseasons: Python, UX / UI, Data et bien plus encore pour les étudiants</a></li>
<li><a href="../fr442294/index.html">Ce qu'Oleg Artamonov a légèrement tort</a></li>
<li><a href="../fr442300/index.html">Je regarde et j'écoute où je veux. Intégration de Chromecast dans une application Android</a></li>
<li><a href="../fr442304/index.html">Smartphones pliants: qu'en est-il des applications?</a></li>
<li><a href="../fr442306/index.html">Comment vendre un git dans un autre git</a></li>
<li><a href="../fr442310/index.html">Micrologiciel Sonoff Basic via Raspberry Pi</a></li>
<li><a href="../fr442312/index.html">DoT pour la distribution RPZ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>