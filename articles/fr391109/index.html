<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🎨 🐹 👨🏿‍🔬 Histoire de l'ingénierie inverse d'un bracelet de fitness chinois 👨🏿‍🔬 🧕🏾 🧛🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Achetez un bracelet chinois, soyez déçu par le logiciel officiel, écrivez le vôtre!
 
 
 
 
 Cette histoire attend sa publication depuis plus de six m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Histoire de l'ingénierie inverse d'un bracelet de fitness chinois</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/391109/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Achetez un bracelet chinois, soyez déçu par le logiciel officiel, écrivez le vôtre!</font></font><br>
<br>
<img src="https://habrastorage.org/files/a19/e52/519/a19e525192024d25973173562f432455.png"><br>
<a name="habracut"></a><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette histoire attend sa publication depuis plus de six mois, pendant ce temps, beaucoup de choses ont changé, le firmware et les logiciels ont été mis à jour et beaucoup de mes développements sont déjà devenus obsolètes.</font></font></i><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Préface</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le travail actif d'un grand nombre d'entreprises dans le domaine de la technologie portable et des montres intelligentes n'a pas laissé la paix à mon âme. J'ai vu un grand potentiel dans les appareils portables avec un écran. Non, je ne parle pas de compter les pas et d'autres choses de fitness, ils sont certainement cool, mais si loin du banal «Félicitations! Vous avez marché 4 km, fait 20 km + de pas! » et de beaux graphiques de progrès et de régression, ils n’ont rien trouvé de spécial. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais le fait que je puisse recevoir des notifications directement sur l'écran de mon poignet est pratique. Si je peux également interagir avec lui ou quelque chose à proximité en appuyant sur les boutons 1-2-3 - c'est encore plus cool.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une fois de plus, labourant les étendues d'aliexpress, je suis tombé sur un bracelet de fitness iWown i5. </font><font style="vertical-align: inherit;">Il a immédiatement attiré mon attention à un prix incroyablement bas (à l'époque environ 800r avec la livraison gratuite) et la présence d'un écran OLED. </font><font style="vertical-align: inherit;">Après avoir lu attentivement la description du vendeur et les avis clients, j'ai décidé de commander ce miracle. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Spécifications déclarées (description de la traduction d'aliexpress):</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Affichage: OLED</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Batterie: Li-Polymer</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chargement: chargement USB standard</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Autonomie en veille: plus de 72 heures</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dimensions: 69,1 * 15,8 * 11,2 mm</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Poids: 18g</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Matériel: bracelet ABS, fermoir en acier</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Résistance à l'eau: IP55</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Température de fonctionnement: -20 ° C ~ + 45 ° C</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Température de fonctionnement du support flash: -40 ° C ~ + 45 ° C</font></font></li>
</ul><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capacités:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Moniteur de sport: tout le temps enregistre les pas et les mouvements, la distance parcourue et les calories brûlées, tous les chiffres sont calculés en tenant compte de votre poids et de votre taille.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Surveillance de la qualité du sommeil: pendant que vous dormez, le tracker enregistre les phases du sommeil, déterminant le sommeil profond et rapide, 8 groupes d'alarmes silencieuses vous permettent de vous réveiller sans déranger les autres membres de la famille</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Synchronisation sans fil Bluetooth 4.0 à faible puissance</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Prise en charge de la synchronisation PC via USB</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protection IP55: protège l'appareil sous de fortes pluies, mais pas plus</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
et d'autres avantages "farfelus" dans le style du marketing chinois </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'ai été très intéressé par l'opportunité de suivre un rêve et de me réveiller dans la bonne phase. </font><font style="vertical-align: inherit;">Beaucoup de mes amis ont acheté des trackers de fitness bon marché précisément à cause de cette fonction et étaient satisfaits de mi band et autres. </font><font style="vertical-align: inherit;">Il me manquait toujours un écran, mais ici, c'est tout-en-un. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans mon travail, je dois souvent développer des applications simples pour Android, j'ai décidé que si je n'ai pas assez de fonctionnalités de mon application native, j'écrirai la mienne.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le colis est arrivé assez rapidement et je me suis immédiatement précipité pour étudier un magnifique bracelet. Après une heure de jeu avec l'application Zeroner, qui selon les instructions doit être installée sur mon appareil Android, j'ai réalisé que la fonctionnalité est plutôt pauvre et triste. Zeroner, comme tous les autres fabricants, se concentre sur le comptage des étapes et des calories, affiche de beaux graphiques, dispose d'une fonction de recherche par téléphone (j'en parlerai plus tard), peut vous avertir d'un appel entrant, de l'arrivée d'un message sur Facebook et WhatsApp, et envoie des notifications à partir de l'une des applications sélectionnées , qui sera considérée comme une application SMS.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La vibration du bracelet est très controversée, ils écrivent sur les forums qu'il est plutôt faible, certains disent que c'est normal. </font><font style="vertical-align: inherit;">Pour moi, cela aurait pu être plus fort. </font><font style="vertical-align: inherit;">Le bracelet réagit au geste «Regarder la montre», si vous regardez le bracelet comme une montre, en levant la main et en vous pliant au coude, l'écran s'allumera automatiquement et affichera l'heure ou la notification manquée. </font></font><br>
<br>
<img src="https://habrastorage.org/files/5ec/f12/b95/5ecf12b954c74a6eab31c27f747daf51.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, sans hésitation, j'ai décidé d'écrire mon application, avec notifications, vibration et synchronisation. </font><font style="vertical-align: inherit;">Je vais courir, il a fallu 4 jours de congé et plusieurs longues soirées ...</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aux entreprises</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné qu'avec Bluetooth, je ne suis pas un orteil bleu, j'ai décidé d'essayer d'intercepter les données échangées entre le téléphone et le bracelet avec un imbécile. Pour ce faire, je suis monté dans l'onglet pour les développeurs et j'ai activé la case à cocher </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Activer le journal de diffusion Bluetooth HCI"</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Après avoir activé cette option, le vidage complet de la communication de l'androïde avec tous les appareils Bluetooth est ajouté au fichier </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sdcard/Android/data/btsnoop_hci.log</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (le chemin peut changer pour différents appareils, le nom du fichier semble être toujours le même). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir téléchargé WireShark, j'ai commencé à étudier les journaux de communication avec le bracelet et j'ai vu quelque chose de similaire à cela: </font></font><br>
<br>
<img src="https://habrastorage.org/files/bcc/e1e/5e9/bcce1e5e907549e1993177833e2c9b9c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
après avoir passé près de deux heures, à étudier les journaux, à mener des addictions, des protocoles Google sur Internet, j'ai réalisé qu'un tel chemin n'était pas pour moi.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Étant donné que mon téléphone a néanmoins interprété le bracelet comme un appareil BLE normal et l'a montré dans la section des appareils connectés, j'ai décidé d'utiliser des exemples de travail avec BLE à partir du SDK Android. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir cloné le référentiel </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/googlesamples/android-BluetoothLeGatt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mis Android Studio sur le nombril avec les sources, construit et lancé l'application. ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lien vers la description du SDK Android avec Bluetooth LE</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré que dans les images du github: </font></font><br>
<img src="https://habrastorage.org/files/109/0e2/723/1090e27231624e4eb554b3faf5445f3e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir exécuté le scan, l'application n'a pas vu l'appareil. Il s'est avéré que l'application native se connectant au bracelet ne permettait pas à BLE de trouver l'appareil. Tout a été décidé par la simple suppression de Zeroner, il était possible de se déconnecter simplement, mais il était plus fiable de le démolir complètement.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et donc, Bluetooth LE est une technologie qui s'appuie sur des appareils à faible consommation d'énergie, est utilisée dans les nouveaux capteurs, balises et de nombreux autres appareils. La base de cette technologie est le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">profil d'attribut générique (GATT)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est un profil Bluetooth qui vous permet d'échanger de petites données, des </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">«attributs»</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Je n'écrirai pas sur le fonctionnement de tout cela pendant longtemps. Sur Internet et sur Internet, il y a beaucoup d'informations sur lesquelles j'ai dû chercher des solutions. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'espérais que toutes les données dont j'avais besoin étaient stockées dans les caractéristiques et les descripteurs du bracelet, et je pourrais recevoir et enregistrer des données sans aucun problème. J'avais tort ... L' </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
application de test BLE ne m'a montré que 4 services: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000180f-0000-1000-8000-00805f9b34fb</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00001800-0000-1000-8000-00805f9b34fb </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
0000ff20-0000-1000-8000-00805f9b34fb </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00001801-0000-1000-8000-00805f9b34fb </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
elles avaient très peu de caractéristiques, celles qui lisaient retournées nulles ou nulles, et écrire était inutile. Mais j'ai été encouragé d'avoir pu me connecter et obtenir au moins quelques données. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, j’ai décidé qu’il n’était pas possible d’agir à l’aveugle et j'ai décidé de disséquer l’application Zeroner. Après avoir accumulé quelques décompilateurs APK en ligne sur Internet, je les ai alimentés zeroner.apk et obtenu 2 archives zip sur la sortie. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La première était une version JADX, et la seconde contenait le résultat d'apktool. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fouillant dans le code source, j'ai été horrifié par le code chinois</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bien que dans mon travail, je le rencontre souvent sous la forme de backends pour des sites et des services, mais il ne cesse de m'étonner par sa tortuosité et son ingéniosité, mais de toute façon, c'est terriblement difficile à lire)</font></font></i><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Après de nombreuses recherches, j'ai finalement trébuché sur le fichier </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WristBandDevice.java</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui se trouvait sur le chemin com.kunekt / bluetooth. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans cette classe, tout le travail avec l'appareil se cachait, mais encore une fois, une embuscade m'attendait. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme il s'est avéré plus tard, dans le firmware précédent du bracelet, plus de services étaient utilisés dans les caractéristiques (comme je m'y attendais précédemment), mais plus tard, les développeurs n'en ont laissé que 2, un pour la lecture, le second pour l'écriture. Toutes les commandes sont transmises dans un seul paquet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ce n'était pas si facile de comprendre à quoi le paquet devrait ressembler, j'ai décidé de déterminer clairement ce que je voulais du bracelet en premier lieu, afin de pouvoir commencer à tracer les appels de fonction. </font><font style="vertical-align: inherit;">Et je voulais afficher des messages personnalisés sur le bracelet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sans hésitation, j'ai grimpé dans </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com.kunekt / receiver / CallReceiver.java</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , car les appels entrants étaient affichés de manière très stable et même avec des caractères russes, j'ai décidé que c'était un bon début, étant donné que j'avais déjà rencontré un événement d'appel entrant dans Android, l'idée de comment cela pourrait fonctionner a déjà été. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En ouvrant le dossier, j'ai vu ceci:</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un gros morceau de code chinois</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
        Log.e(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TAG, <span class="hljs-string"><span class="hljs-string">"+++ ON RECEIVE +++"</span></span>);
        <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (((TelephonyManager) context.getSystemService(<span class="hljs-string"><span class="hljs-string">"phone"</span></span>)).getCallState()) {
            <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> C08571.POSITION_OPEN <span class="hljs-comment"><span class="hljs-comment">/*0*/</span></span>:
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ZeronerApplication.newAPI) {<font></font>
                    BackgroundThreadManager.getInstance().addTask(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteOneDataTask(context, WristBandDevice.getInstance(context).setPhoneStatue()));<font></font>
                }<font></font>
            <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BitmapCacheManagementTask.MESSAGE_INIT_DISK_CACHE <span class="hljs-comment"><span class="hljs-comment">/*1*/</span></span>:<font></font>
                incomingNumber = intent.getStringExtra(<span class="hljs-string"><span class="hljs-string">"incoming_number"</span></span>);<font></font>
                Contact contact = getContact(context, incomingNumber);<font></font>
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!WristBandDevice.getInstance(context).isConnected() || !ZeronerApplication.phoneAlert) {
                    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
                }<font></font>
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ZeronerApplication.newAPI) {
                    <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fMdeviceInfo = jsonToFMdeviceInfo(UserConfig.getInstance(context).getDevicesInfo());
                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fMdeviceInfo.getModel().indexOf(<span class="hljs-string"><span class="hljs-string">"5+"</span></span>) != -<span class="hljs-number"><span class="hljs-number">1</span></span>) {
                        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UserConfig.getInstance(context).getFont_lib() == <span class="hljs-number"><span class="hljs-number">1</span></span> || UserConfig.getInstance(context).getFont_lib() == <span class="hljs-number"><span class="hljs-number">2</span></span> || UserConfig.getInstance(context).getSysFont().equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"en"</span></span>) || UserConfig.getInstance(context).getSysFont().equalsIgnoreCase(<span class="hljs-string"><span class="hljs-string">"es"</span></span>)) {
                            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                                WristBandDevice.getInstance(context).writeWristBandFontLibrary(context, <span class="hljs-number"><span class="hljs-number">1</span></span>, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>));<font></font>
                            } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &lt;= <span class="hljs-number"><span class="hljs-number">6</span></span> || contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                                WristBandDevice.getInstance(context).writeWristBandFontLibrary(context, <span class="hljs-number"><span class="hljs-number">1</span></span>, contact.getDisplayName());<font></font>
                            } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                                WristBandDevice.getInstance(context).writeWristBandFontLibrary(context, <span class="hljs-number"><span class="hljs-number">1</span></span>, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, contact.getDisplayName().length()));<font></font>
                            }<font></font>
                        } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                            WristBandDevice.getInstance(context).writeWristBandPhoneAlertNew(context, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>));<font></font>
                        } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &lt;= <span class="hljs-number"><span class="hljs-number">6</span></span> || contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                            WristBandDevice.getInstance(context).writeWristBandPhoneAlertNew(context, contact.getDisplayName());<font></font>
                        } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                            WristBandDevice.getInstance(context).writeWristBandPhoneAlertNew(context, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, contact.getDisplayName().length()));<font></font>
                        }<font></font>
                    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                        WristBandDevice.getInstance(context).writeWristBandPhoneAlertNew(context, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>));<font></font>
                    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &lt;= <span class="hljs-number"><span class="hljs-number">6</span></span> || contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                        WristBandDevice.getInstance(context).writeWristBandPhoneAlertNew(context, contact.getDisplayName());<font></font>
                    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                        WristBandDevice.getInstance(context).writeWristBandPhoneAlertNew(context, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, contact.getDisplayName().length()));<font></font>
                    }<font></font>
                } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                    WristBandDevice.getInstance(context).writeWristBandPhoneAlert(context, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>));<font></font>
                } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (contact.getDisplayName().length() &lt;= <span class="hljs-number"><span class="hljs-number">6</span></span> || contact.getDisplayName().length() &gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) {<font></font>
                    WristBandDevice.getInstance(context).writeWristBandPhoneAlert(context, contact.getDisplayName());<font></font>
                } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                    WristBandDevice.getInstance(context).writeWristBandPhoneAlert(context, contact.getDisplayName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, contact.getDisplayName().length()));<font></font>
                }<font></font>
            <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BitmapCacheManagementTask.MESSAGE_FLUSH <span class="hljs-comment"><span class="hljs-comment">/*2*/</span></span>:
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ZeronerApplication.newAPI) {<font></font>
                    BackgroundThreadManager.getInstance().addTask(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteOneDataTask(context, WristBandDevice.getInstance(context).setPhoneStatue()));<font></font>
                }<font></font>
            <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>:<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ici, nous voyons clairement qu'il existe 2 variantes de l'API et les noms qu'elles portent sont newAPI très logiques et le second, respectivement, oldAPI. Dans toute cette abondance de conditions, je ne m'intéressais qu'à une seule ligne répétitive: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WristBandDevice.getInstance (context) .writeWristBandPhoneAlertNew (context, contact.getDisplayName .....)</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
C'était ce que je cherchais. Pour l'avenir, je dirai que iWown a également des modèles i5 + et i6, ils ont un écran plus grand et en conséquence plus de caractères sont placés, pour cela toutes ces vérifications sont nécessaires. ce n'est pas clair pourquoi ils n'ont pas écrit une classe ou quelque chose comme ça, peut-être que ce sont des farces de décompilation, mais ce code est répété à de nombreux endroits. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Passant à la définition de cette fonction, j'ai vu ceci:</font></font><br>
<br>
<pre><code class="java hljs">    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeWristBandPhoneAlertNew</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, String displayName)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
        writeAlertNew(context, displayName, <span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeWristBandSmsAlertNew</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, String displayName)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
        writeAlertNew(context, displayName, <span class="hljs-number"><span class="hljs-number">2</span></span>);<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Génial, il utilise la même fonction pour envoyer du texte, juste avec des paramètres différents. </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes les fonctions avec le mot Nouveau sont juste notre option, car comme il s'est avéré ci-dessus, j'ai une nouvelle API. </font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En passant volontiers à la définition de la fonction </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">writeAlertNew</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , j'ai vu ce qui suit:</font></font><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeAlertNew</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, String displayName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
        ArrayList&lt;Byte&gt; datas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList();<font></font>
        datas.add(Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) type));
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; displayName.length()) {
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (displayName.charAt(i) &lt; <span class="hljs-string"><span class="hljs-string">'@'</span></span> || (displayName.charAt(i) &lt; <span class="hljs-string"><span class="hljs-string">'\u0080'</span></span> &amp;&amp; displayName.charAt(i) &gt; <span class="hljs-string"><span class="hljs-string">'`'</span></span>)) {
                <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> e = displayName.charAt(i);<font></font>
                datas.add(Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>));
                <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> valueOf : PebbleBitmap.fromString(context, String.valueOf(e), <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).data) {<font></font>
                    datas.add(Byte.valueOf(valueOf));<font></font>
                }<font></font>
            } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {
                <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c = displayName.charAt(i);<font></font>
                datas.add(Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>));
                <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> valueOf2 : PebbleBitmap.fromString(context, String.valueOf(c), <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).data) {<font></font>
                    datas.add(Byte.valueOf(valueOf2));<font></font>
                }<font></font>
            }<font></font>
            i++;<font></font>
        }<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] data = writeWristBandDataByte(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, form_Header(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), datas);
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.length; i += <span class="hljs-number"><span class="hljs-number">20</span></span>) {
            <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] writeData;
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i + <span class="hljs-number"><span class="hljs-number">20</span></span> &gt; data.length) {<font></font>
                writeData = Arrays.copyOfRange(data, i, data.length);<font></font>
            } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                writeData = Arrays.copyOfRange(data, i, i + <span class="hljs-number"><span class="hljs-number">20</span></span>);<font></font>
            }<font></font>
            NewAgreementBackgroundThreadManager.getInstance().addTask(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WriteOneDataTask(context, writeData));<font></font>
        }<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il était clair que quelques fonctions utilisées ici me séparent du profit. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
writeWristBandDataByte - forme un package avec un message pour le bracelet, il est intéressant de noter qu'il existe une fonction spéciale </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">form_Header (3, 1)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , qui forme l'en-tête du package, par laquelle le bracelet comprend ce qu'ils en veulent. </font><font style="vertical-align: inherit;">3 est le numéro du groupe d'équipe et 1 est l'équipe elle-même</font></font><br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">form_Header</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> grp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cmd)</span></span></span><span class="hljs-function"> </span></span>{
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) (((((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) grp) &amp; <span class="hljs-number"><span class="hljs-number">15</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | (((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) cmd) &amp; <span class="hljs-number"><span class="hljs-number">15</span></span>));<font></font>
    }<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La fonction est simple, copiée dans mon projet sans modifications. </font><font style="vertical-align: inherit;">Vient ensuite </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NewAgreementBackgroundThreadManager.getInstance (). AddTask (new WriteOneDataTask (context, writeData)); </font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comme il s'est avéré, rien d'inhabituel, l'application crée un flux dans lequel la file d'attente des paquets à envoyer est constamment vérifiée, si un paquet apparaît dans la file d'attente, le flux écrit dans la caractéristique de périphérique donnée, s'il y a plus d'un paquet, il les envoie avec un retard de 240 millisecondes. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vient ensuite le plus incompréhensible: </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PebbleBitmap.fromString (context, String.valueOf (e), 8, 1) .data) La raison</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
pour laquelle la classe est appelée de cette façon n'est pas claire, car cet appareil n'a rien à voir avec Pebble. </font><font style="vertical-align: inherit;">En ouvrant la source du cours, j'ai vu ce qui suit:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Source de classe PebbleBitmap</font></font></b><div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PebbleBitmap</span></span></span><span class="hljs-class"> </span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> f1285D;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] data;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnsignedInteger flags;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> height;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> offset;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> UnsignedInteger rowLengthBytes;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> width;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> f1286x;
    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> f1287y;<font></font>
<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> {<font></font>
        f1285D = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PebbleBitmap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UnsignedInteger _rowLengthBytes, UnsignedInteger _flags, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _width, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _height, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] _data)</span></span></span><span class="hljs-function"> </span></span>{
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.offset = <span class="hljs-number"><span class="hljs-number">0</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.index = <span class="hljs-number"><span class="hljs-number">0</span></span>;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rowLengthBytes = _rowLengthBytes;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.flags = _flags;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f1286x = _x;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f1287y = _y;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width = _width;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.height = _height;
        <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = _data;<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> PebbleBitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, String text, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> w, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
        TextPaint textPaint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextPaint();<font></font>
        textPaint.setAntiAlias(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);<font></font>
        textPaint.setTextSize(<span class="hljs-number"><span class="hljs-number">16.5f</span></span>);
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (w == <span class="hljs-number"><span class="hljs-number">32</span></span>) {<font></font>
            textPaint.setTextAlign(Align.CENTER);<font></font>
        }<font></font>
        textPaint.setTypeface(ZeronerApplication.unifont);<font></font>
        StaticLayout sl = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StaticLayout(text, textPaint, w, Alignment.ALIGN_NORMAL, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.49f</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h = sl.getHeight();
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (h &gt; l * <span class="hljs-number"><span class="hljs-number">16</span></span>) {<font></font>
            h = l * <span class="hljs-number"><span class="hljs-number">16</span></span>;<font></font>
        }<font></font>
        Bitmap newBitmap = Bitmap.createBitmap(w, h, Config.ARGB_8888);<font></font>
        sl.draw(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Canvas(newBitmap));
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fromAndroidBitmap(newBitmap);<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> PebbleBitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromAndroidBitmap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bitmap bitmap)</span></span></span><span class="hljs-function"> </span></span>{
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width = bitmap.getWidth();
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> height = bitmap.getHeight();
        <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rowLengthBytes = width / <span class="hljs-number"><span class="hljs-number">8</span></span>;<font></font>
        ByteBuffer data = ByteBuffer.allocate(rowLengthBytes * height);<font></font>
        data.order(ByteOrder.LITTLE_ENDIAN);<font></font>
        StringBuffer stringBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(StatConstants.MTA_COOPERATION_TAG);
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; height; y++) {
            <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] pixels = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[width];<font></font>
            bitmap.getPixels(pixels, <span class="hljs-number"><span class="hljs-number">0</span></span>, width * <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, y, width, <span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
            stringBuffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuffer(StatConstants.MTA_COOPERATION_TAG);
            <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; width; x++) {
                <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pixels[x] == <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
                    stringBuffer.append(Constants.VIA_RESULT_SUCCESS);<font></font>
                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f1285D) {<font></font>
                        stringBuffer.append(<span class="hljs-string"><span class="hljs-string">"-"</span></span>);<font></font>
                    }<font></font>
                } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
                    stringBuffer.append(Constants.VIA_TO_TYPE_QQ_GROUP);<font></font>
                    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f1285D) {<font></font>
                        stringBuffer.append(<span class="hljs-string"><span class="hljs-string">"#"</span></span>);<font></font>
                    }<font></font>
                }<font></font>
            }<font></font>
            <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span>; k &lt; rowLengthBytes * <span class="hljs-number"><span class="hljs-number">8</span></span>; k += <span class="hljs-number"><span class="hljs-number">8</span></span>) {<font></font>
                ByteBuffer byteBuffer = data;<font></font>
                byteBuffer.put(Byte.valueOf((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BigInteger(stringBuffer.substring(k, k + <span class="hljs-number"><span class="hljs-number">8</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>).intValue()).byteValue());<font></font>
            }<font></font>
            <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f1285D) {<font></font>
                stringBuffer.append(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>);<font></font>
            }<font></font>
            Log.i(<span class="hljs-string"><span class="hljs-string">"info"</span></span>, stringBuffer.toString());<font></font>
        }<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f1285D) {<font></font>
            System.out.println(stringBuffer.toString());<font></font>
        }<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(bitmap == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || bitmap.isRecycled())) {<font></font>
            bitmap.recycle();<font></font>
        }<font></font>
        System.gc();<font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PebbleBitmap(UnsignedInteger.fromIntBits(rowLengthBytes), UnsignedInteger.fromIntBits(DfuSettingsConstants.SETTINGS_DEFAULT_MBR_SIZE), (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) width, (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) height, data.array());<font></font>
    }<font></font>
<font></font>
    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> PebbleBitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromPng</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InputStream paramInputStream)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{
        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fromAndroidBitmap(BitmapFactory.decodeStream(paramInputStream));<font></font>
    }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après une longue réflexion, je suis arrivé à la conclusion que </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fromString</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> crée une image avec une lettre en utilisant une certaine police (qui est intégrée dans l'application), puis convertit les pixels en 0 ou 1 en fonction du remplissage, de sorte que la lettre </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ressemblera à ceci: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00011100 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01100011 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01100011 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
01100011 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
00011100 </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sans entrer dans les détails, j'ai tout copié dans mon projet en utilisant l'exemple BLE GATT de Google. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et ... Oh, un miracle !!! Le bracelet a vibré! Mais le message n'est pas apparu, une ligne vide et une icône d'appel entrant.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il s'est avéré qu'un tas de vérifications de taille ne sont pas occasionnelles, le bracelet ignore bêtement les messages trop longs et les messages dont la longueur est de 11 caractères, bien que 12 s'affichent normalement. </font><font style="vertical-align: inherit;">Quelques heures de danse autour de ces fonctions ont finalement donné des résultats, j'ai appris à afficher le texte russe et anglais, et en même temps, j'ai appris qu'il y a plusieurs modes de fonctionnement dans le groupe de messages:</font></font><br>
<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Appel entrant. </font><font style="vertical-align: inherit;">Le combiné s'affiche, le nom de l'appelant et le bracelet vibrent</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Message </font><font style="vertical-align: inherit;">L'icône de texte et d'enveloppe s'affiche. </font><font style="vertical-align: inherit;">Quand il vibre 2 fois</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuageux. </font><font style="vertical-align: inherit;">Identique à 2, mais au lieu de l'enveloppe, l'icône du nuage</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'erreur. </font><font style="vertical-align: inherit;">Identique à 2, que seule une icône avec un point d'exclamation.</font></font></li>
</ol><br>
<br>
<img src="https://habrastorage.org/files/972/497/5cb/9724975cb18144cc8654da86f1cc290a.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir appris à ma demande à m'envoyer des notifications à partir de différentes applications, WhatsApp, vk, viber, télégramme et autres, j'ai décidé qu'il était temps d'apprendre au bracelet à répondre aux appels entrants et, enfin, à utiliser un seul bouton pour réinitialiser les appels entrants. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je ne décrirai pas ce processus, le message s’est avéré gonflé, je dirai simplement qu’il n’était pas difficile de répondre aux messages entrants, mais que l’utilisation du bouton ne l’était pas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tous les messages entrants du bracelet, Zeroner intercepté dans une classe spéciale. </font><font style="vertical-align: inherit;">le paquet entrant avait l'en-tête du groupe de commandes et le numéro de commande, après un long débogage et des tests, j'ai repéré les groupes utilisés, puis j'ai trouvé une description dans le code Zeroner.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Groupes et équipes de bracelets</font></font></b><div class="spoiler_text"><code>// HEADER GROUPS //<br>
DEVICE = 0<br>
CONFIG = 1<br>
DATALOG = 2<br>
MSG = 3<br>
PHONE_MSG = 4<br>
<br>
// CONFIG = 1 ///<br>
CMD_ID_CONFIG_GET_AC = 5<br>
CMD_ID_CONFIG_GET_BLE = 3<br>
CMD_ID_CONFIG_GET_HW_OPTION = 9<br>
CMD_ID_CONFIG_GET_NMA = 7<br>
CMD_ID_CONFIG_GET_TIME = 1<br>
<br>
CMD_ID_CONFIG_SET_AC = 4<br>
CMD_ID_CONFIG_SET_BLE = 2<br>
CMD_ID_CONFIG_SET_HW_OPTION = 8<br>
CMD_ID_CONFIG_SET_NMA = 6<br>
CMD_ID_CONFIG_SET_TIME = 0<br>
<br>
// DATALOG = 2 //<br>
CMD_ID_DATALOG_CLEAR_ALL = 2<br>
CMD_ID_DATALOG_GET_BODY_PARAM = 1<br>
CMD_ID_DATALOG_SET_BODY_PARAM = 0<br>
<br>
CMD_ID_DATALOG_GET_CUR_DAY_DATA = 7<br>
<br>
CMD_ID_DATALOG_START_GET_DAY_DATA = 3<br>
CMD_ID_DATALOG_START_GET_MINUTE_DATA = 5<br>
CMD_ID_DATALOG_STOP_GET_DAY_DATA = 4<br>
CMD_ID_DATALOG_STOP_GET_MINUTE_DATA = 6<br>
<br>
// DEVICE = 0 //<br>
CMD_ID_DEVICE_GET_BATTERY = 1<br>
CMD_ID_DEVICE_GET_INFORMATION = 0<br>
CMD_ID_DEVICE_RESE = 2<br>
CMD_ID_DEVICE_UPDATE = 3<br>
<br>
// MSG = 3 //<br>
CMD_ID_MSG_DOWNLOAD = 1<br>
CMD_ID_MSG_MULTI_DOWNLOAD_CONTINUE = 3<br>
CMD_ID_MSG_MULTI_DOWNLOAD_END = 4<br>
CMD_ID_MSG_MULTI_DOWNLOAD_START = 2<br>
CMD_ID_MSG_UPLOAD = 0<br>
<br>
// PHONE_MSG = 4 //<br>
CMD_ID_PHONE_ALERT = 1<br>
CMD_ID_PHONE_PRESSKEY = 0<br>
</code><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Grâce à cela, j'ai pu réaliser un travail à part entière avec le bracelet. </font><font style="vertical-align: inherit;">Je peux recevoir des données sur les étapes, sur le sommeil. </font><font style="vertical-align: inherit;">Je peux gérer les paramètres, définir des alarmes. </font><font style="vertical-align: inherit;">J'ai réussi à obtenir la désignation d'octet du package à partir des classes qui stockent les données dans la base de données, je les ai toutes implémentées à la maison.</font></font><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En fin de compte</font></font></h5><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après un peu de réflexion, j'ai décidé que tout cela pourrait être utile non seulement pour moi et j'ai écrit une nouvelle application qui contient toutes les données et fonctions nécessaires pour travailler avec le bracelet, ainsi que met en œuvre une interface simple pour envoyer des notifications depuis n'importe quelle application au bracelet. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WiliX iWown for Geek</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depuis lors, beaucoup de temps s'est écoulé, et beaucoup après la mise à jour vers Android 6, l'application a cessé de fonctionner. </font><font style="vertical-align: inherit;">Il ne fonctionne pas non plus de manière stable avec le firmware des bracelets de la 2ème version. </font><font style="vertical-align: inherit;">Mais j'espère trouver du temps pour la révision. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le code source est publié sur </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vous pouvez bifurquer et vous amuser comme vous le souhaitez. </font><font style="vertical-align: inherit;">Toutes les demandes d'extraction après examen seront acceptées et après que les tests seront immédiatement téléchargés sur Google Play. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
À l'heure actuelle, l'application peut:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Afficher les notifications de n'importe quelle application</font></font></li>
<li>  </li>
<li>     </li>
<li>       BT</li>
<li>  </li>
<li>    </li>
</ul><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Une connexion à Google Fit a été mise en place pour enregistrer les données de formation, mais, comme je n'ai pas choisi le SDK pour Fit, j'ai fouillé un tas de liens et de forums, mais je ne comprenais toujours pas comment faire l'ajustement des données à partir d'appareils personnalisés. Il n'est pas clair alors pourquoi cette fonction est même là. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si quelqu'un a travaillé avec Google Fit et sait comment l'amener à utiliser les données d'un capteur personnalisé pour afficher des graphiques, dites-le-moi dans les commentaires ou écrivez-moi, les utilisateurs et je serai très reconnaissant! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
C'était aussi une idée de connecter le bracelet à Sleep as Adnroid. En fait, pour surveiller le sommeil, un bracelet a été acheté. Mais, il s'est avéré que iWown ne peut renvoyer que la durée des phases de sommeil. Autrement dit, les données déjà calculées de l'accéléromètre.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et Sleep as Android nécessite des données nues de l'accéléromètre, et avec une fréquence souhaitée de 10 secondes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En général, le résultat. </font><font style="vertical-align: inherit;">J'invite les développeurs et les propriétaires à soutenir le projet avec leur code, leurs conseils et tout. </font><font style="vertical-align: inherit;">Laissez pull-requist, émettez sur Github. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'application s'est avérée très populaire à l'étranger, les étrangers m'écrivent souvent pour me demander d'ajouter / corriger / traduire quelque chose. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soit dit en passant, iWown i5 possède plusieurs clones, avec un firmware similaire: </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vidonn X5 </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Harper BFB-301 </font></font></b><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excelvan i5</font></font></b><br>
<br>
<h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les références</font></font></h5><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google Play - iWown pour Geek </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repository sur GitHub </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discussion sur w3bsit3-dns.com</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
PS À partir de la 5e version, une catégorie supplémentaire est apparue dans les androïdes dans le rideau, qui n'apparaît pas sur l'écran de verrouillage. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quelqu'un peut-il me dire comment transférer ma notification dans cette catégorie? </font><font style="vertical-align: inherit;">Je vous remercie!</font></font><br>
<br>
<img src="https://habrastorage.org/files/18c/723/b95/18c723b95ca441a0a34c8d76a9748308.png"></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr391109/">https://habr.com/ru/post/fr391109/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr391099/index.html">Émuler divers appareils avec Pi Zero - comment faire?</a></li>
<li><a href="../fr391101/index.html">Son # 29 - Podcast sur l'audio et l'écosystème sonore</a></li>
<li><a href="../fr391103/index.html">Sera planté non seulement pour les likes et les commentaires, mais aussi pour les emoji</a></li>
<li><a href="../fr391105/index.html">Réflexions à voix haute. Quatre vaut mieux qu'un ... Ou le concept d'un quadricoptère de transport</a></li>
<li><a href="../fr391107/index.html">Mode Ballmer Peak ou Super ONE</a></li>
<li><a href="../fr391111/index.html">Les ingénieurs du MIT ont créé les panneaux solaires les plus légers</a></li>
<li><a href="../fr391113/index.html">Jouer: site p2p pour les torrents qui ne peuvent pas être fermés</a></li>
<li><a href="../fr391117/index.html">Batman: Nolan Universe</a></li>
<li><a href="../fr391121/index.html">Mozilla prévoit de mettre à jour la conception de addons.mozilla.org (AMO)</a></li>
<li><a href="../fr391123/index.html">À propos du nouveau brevet de Boeing «Impression 3D de formes libres à l'aide de pièces en lévitation»</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>