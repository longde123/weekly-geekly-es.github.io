<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåª üëé ü§∑üèø Complejidad Cascada y Arquitectura bajo demanda üë©üèΩ‚Äçüç≥ ‚õîÔ∏è üöù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cuando se habla de "c√≥digo malo", la gente casi con toda seguridad se refiere a "c√≥digo complejo" entre otros problemas populares. Lo que pasa con la ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Complejidad Cascada y Arquitectura bajo demanda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472876/"><p><img src="https://habrastorage.org/webt/g9/_9/wk/g9_9wkgu4h6i8xyelaq9p5nwmjy.png" alt="Logotipo"></p><br><p>  Cuando se habla de "c√≥digo malo", la gente casi con toda seguridad se refiere a "c√≥digo complejo" entre otros problemas populares.  Lo que pasa con la complejidad es que sale de la nada.  Un d√≠a comienzas tu proyecto bastante simple, el otro d√≠a lo encuentras en ruinas.  Y nadie sabe c√≥mo y cu√°ndo sucedi√≥. </p><br><p>  Pero, esto finalmente sucede por una raz√≥n.  La complejidad del c√≥digo ingresa a su base de c√≥digo de dos maneras posibles: con grandes fragmentos y adiciones incrementales.  Y la gente es mala para revisarlos y encontrarlos a ambos. </p><a name="habracut"></a><br><p>  Cuando entra una gran porci√≥n de c√≥digo, el revisor tendr√° el desaf√≠o de encontrar la ubicaci√≥n exacta donde el c√≥digo es complejo y qu√© hacer al respecto.  Luego, la revisi√≥n tendr√° que demostrar el punto: por qu√© este c√≥digo es complejo en primer lugar.  Y otros desarrolladores pueden estar en desacuerdo.  ¬°Todos conocemos este tipo de revisiones de c√≥digo! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/198/8ff/e0e/1988ffe0e3d5dc3b29b4743630b52e06.png" alt="N√∫mero de l√≠neas para revisi√≥n y relaci√≥n de comentarios"></p><br><p> La segunda forma de complejidad de ingresar a su c√≥digo es la adici√≥n incremental: cuando env√≠a una o dos l√≠neas a la funci√≥n existente.  Y es extremadamente dif√≠cil notar que su funci√≥n estaba bien hace un commit, pero ahora es demasiado compleja.  Se necesita una buena porci√≥n de concentraci√≥n, habilidad de revisi√≥n y buenas pr√°cticas de navegaci√≥n de c√≥digo para detectarlo.  La mayor√≠a de las personas (¬°como yo!) Carecen de estas habilidades y permiten que la complejidad ingrese a la base de c√≥digo regularmente. </p><br><p>  Entonces, ¬øqu√© se puede hacer para evitar que su c√≥digo se vuelva complejo?  ¬°Necesitamos usar la automatizaci√≥n!  Profundicemos en la complejidad del c√≥digo y las formas de encontrarlo y finalmente resolverlo. </p><br><p>  En este art√≠culo, lo guiar√© a trav√©s de lugares donde vive la complejidad y c√≥mo combatirla all√≠.  Luego discutiremos c√≥mo el c√≥digo simple y la automatizaci√≥n bien escritos permiten una oportunidad de estilos de desarrollo de "Refactorizaci√≥n continua" y "Arquitectura bajo demanda". </p><br><h2 id="complexity-explained">  Complejidad explicada </h2><br><p>  Uno puede preguntarse: ¬øqu√© es exactamente la "complejidad del c√≥digo"?  Y aunque suena familiar, existen obst√°culos ocultos para comprender la ubicaci√≥n exacta de la complejidad.  Comencemos con las partes m√°s primitivas y luego pasemos a entidades de nivel superior. </p><br><p>  ¬øRecuerdas que este art√≠culo se llama "Cascada de Complejidad"?  Le mostrar√© c√≥mo la complejidad de las primitivas m√°s simples se desborda en las abstracciones m√°s altas. </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>wemake-python-styleguide</code></a> <code>python</code> como el idioma principal para mis ejemplos y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>wemake-python-styleguide</code></a> como la herramienta principal para encontrar las violaciones en mi c√≥digo e ilustrar mi punto. </p><br><h3 id="expressions">  Expresiones </h3><br><p>  Todo su c√≥digo consiste en expresiones simples como <code>a + 1</code> e <code>print(x)</code> .  Si bien las expresiones en s√≠ mismas son simples, pueden desbordar su c√≥digo con complejidad de forma imperceptible en alg√∫n momento.  Ejemplo: imagine que tiene un diccionario que representa alg√∫n modelo de <code>User</code> y lo usa as√≠: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format_username</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user)</span></span></span><span class="hljs-function"> -&gt; str:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user[<span class="hljs-string"><span class="hljs-string">'email'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>][:<span class="hljs-number"><span class="hljs-number">12</span></span>] + <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'@'</span></span> + user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]</code> </pre> <br><p>  Parece bastante simple, ¬øno?  De hecho, contiene dos problemas de complejidad basados ‚Äã‚Äãen expresiones.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>overuses 'username'</code></a> y usa el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">n√∫mero m√°gico</a> <code>12</code> (¬øpor qu√© usamos este n√∫mero en primer lugar, por qu√© no <code>13</code> o <code>10</code> ?).  Es dif√≠cil encontrar este tipo de cosas solo.  As√≠ es como se ver√≠a la mejor versi√≥n: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#: That's how many chars fit in the preview box. LENGTH_LIMIT: Final = 12 def format_username(user) -&gt; str: username = user['username'] if not username: return user['email'] elif len(username) &gt; LENGTH_LIMIT: # See? It is now documented return username[:LENGTH_LIMIT] + '...' return '@' + username</span></span></code> </pre> <br><p>  Hay diferentes problemas con la expresi√≥n tambi√©n.  Tambi√©n podemos tener <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">expresiones sobreutilizadas</a> : cuando usa el atributo <code>some_object.some_attr</code> todas partes en lugar de crear una nueva variable local.  Tambi√©n podemos tener <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">condiciones l√≥gicas demasiado complejas</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acceso a puntos demasiado profundo</a> . </p><br><p>  <strong>Soluci√≥n</strong> : cree nuevas variables, argumentos o constantes.  Cree y use nuevas funciones o m√©todos de utilidad si es necesario. </p><br><h3 id="lines">  L√≠neas </h3><br><p>  Las expresiones forman l√≠neas de c√≥digo (por favor, no confunda las l√≠neas con las declaraciones: una sola declaraci√≥n puede tomar varias l√≠neas y varias declaraciones pueden ubicarse en una sola l√≠nea). </p><br><p>  La primera y la m√©trica de complejidad m√°s obvia para una l√≠nea es su longitud.  S√≠, lo escuchaste correctamente.  Es por eso que nosotros (los programadores) preferimos apegarnos a la regla de <code>80</code> caracteres por l√≠nea y no porque se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">haya usado previamente</a> en los teletipos.  √öltimamente hay muchos rumores al respecto, que dicen que no tiene sentido usar <code>80</code> caracteres para su c√≥digo en 2k19.  Pero, eso obviamente no es cierto. </p><br><p>  La idea es simple.  Puede tener el doble de l√≥gica en una l√≠nea con <code>160</code> caracteres que en l√≠nea con solo <code>80</code> caracteres.  Es por eso que este l√≠mite debe establecerse y aplicarse.  Recuerde, esta <em>no</em> es <em>una elecci√≥n estil√≠stica</em> .  ¬°Es una m√©trica de complejidad! </p><br><p>  La segunda m√©trica de complejidad de la l√≠nea principal es menos conocida y menos utilizada.  Se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complejidad de Jones</a> .  La idea detr√°s de esto es simple: contamos los nodos de c√≥digo (o <code>ast</code> ) en una sola l√≠nea para obtener su complejidad.  Echemos un vistazo al ejemplo.  Estas dos l√≠neas son fundamentalmente diferentes en t√©rminos de complejidad pero tienen exactamente el mismo ancho en caracteres: </p><br><pre> <code class="python hljs">print(first_long_name_with_meaning, second_very_long_name_with_meaning, third) print(first * <span class="hljs-number"><span class="hljs-number">5</span></span> + math.pi * <span class="hljs-number"><span class="hljs-number">2</span></span>, matrix.trans(*matrix), display.show(matrix, <span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre> <br><p>  Vamos a contar los nodos en el primero: una llamada, tres nombres.  Cuatro nodos totalmente.  El segundo tiene veinti√∫n nodos <code>ast</code> .  Bueno, la diferencia es clara.  Es por eso que utilizamos la m√©trica de Complejidad de Jones para permitir la primera l√≠nea larga y no permitir la segunda en funci√≥n de una complejidad interna, no solo en longitud cruda. </p><br><p>  ¬øQu√© hacer con l√≠neas con un puntaje alto de complejidad de Jones? </p><br><p>  <strong>Soluci√≥n</strong> : div√≠dalos en varias l√≠neas o cree nuevas variables intermedias, funciones de utilidad, nuevas clases, etc. </p><br><pre> <code class="python hljs">print( first * <span class="hljs-number"><span class="hljs-number">5</span></span> + math.pi * <span class="hljs-number"><span class="hljs-number">2</span></span>, matrix.trans(*matrix), display.show(matrix, <span class="hljs-number"><span class="hljs-number">2</span></span>), )</code> </pre> <br><p>  ¬°Ahora es mucho m√°s legible! </p><br><h3 id="structures">  Estructuras </h3><br><p>  El siguiente paso es analizar las estructuras del lenguaje como <code>if</code> , <code>for</code> , <code>with</code> , etc. que se forman a partir de l√≠neas y expresiones.  Tengo que decir que este punto es muy espec√≠fico del idioma.  Mostrar√© varias reglas de esta categor√≠a usando <code>python</code> tambi√©n. </p><br><p>  Comenzaremos con <code>if</code> .  ¬øQu√© puede ser m√°s f√°cil que un viejo <code>if</code> ?  En realidad, <code>if</code> comienza a complicarse muy r√°pido.  Aqu√≠ hay un ejemplo de c√≥mo se puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>reimplement switch</code></a> <code>if</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(some, int): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, float): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, complex): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, str): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, bytes): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, list): ...</code> </pre> <br><p>  ¬øCu√°l es el problema con este c√≥digo?  Bueno, imagine que tenemos decenas de tipos de datos que deber√≠an cubrirse, incluidos los de aduanas que a√∫n no conocemos.  Entonces, este c√≥digo complejo es un indicador de que estamos eligiendo un patr√≥n incorrecto aqu√≠.  Necesitamos refactorizar nuestro c√≥digo para solucionar este problema.  Por ejemplo, uno puede usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>typeclass</code> es</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>singledispatch</code></a> .  Ellos hacen el mismo trabajo, pero son mejores. </p><br><p>  <code>python</code> nunca se detiene para divertirnos.  Por ejemplo, puede escribir <code>with</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un n√∫mero arbitrario de casos</a> , que es demasiado complejo mentalmente y confuso: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> first(), second(), third(), fourth(): ...</code> </pre> <br><p>  Tambi√©n puede escribir comprensiones con cualquier n√∫mero de expresiones <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>if</code></a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>for</code></a> , lo que puede conducir a un c√≥digo complejo e ilegible: </p><br><pre> <code class="python hljs">[ (x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x_coords <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> y_coords <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> z_coords <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> y &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> z &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x + y &lt;= z <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x + z &lt;= y <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> y + z &lt;= x ]</code> </pre> <br><p>  Comp√°relo con la versi√≥n simple y legible: </p><br><pre> <code class="python hljs">[ (x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x, y, x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> itertools.product(x_coords, y_coords, z_coords) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> valid_coordinates(x, y, z) ]</code> </pre> <br><p>  Tambi√©n puede incluir accidentalmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>multiple statements inside a try</code></a> caso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>multiple statements inside a try</code></a> , lo cual no es seguro porque puede generar y manejar una excepci√≥n en un lugar esperado: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: user = fetch_user() <span class="hljs-comment"><span class="hljs-comment"># Can also fail, but don't expect that log.save_user_operation(user.email) # Can fail, and we know it except MyCustomException as exc: ...</span></span></code> </pre> <br><p>  Y eso ni siquiera es el 10% de los casos que pueden y saldr√°n mal con su c√≥digo de <code>python</code> .  Hay muchos, muchos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s casos extremos</a> que deber√≠an ser rastreados y analizados. </p><br><p>  <strong>Soluci√≥n</strong> : la √∫nica soluci√≥n posible es utilizar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una buena interfaz</a> para el idioma que elija.  Y refactorice los lugares complejos que resalta este linter.  De lo contrario, tendr√° que reinventar la rueda y establecer pol√≠ticas personalizadas para los mismos problemas. </p><br><h3 id="functions">  Las funciones </h3><br><p>  Expresiones, declaraciones y estructuras forman funciones.  La complejidad de estas entidades fluye hacia funciones.  Y ah√≠ es donde las cosas comienzan a ponerse intrigantes.  Porque las funciones tienen literalmente docenas de m√©tricas de complejidad: tanto buenas como malas. </p><br><p>  Comenzaremos con los m√°s conocidos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la complejidad ciclom√°tica</a> y la longitud de la funci√≥n medida en l√≠neas de c√≥digo.  La complejidad ciclom√°tica indica cu√°ntas vueltas puede tomar su flujo de ejecuci√≥n: es casi igual al n√∫mero de pruebas unitarias que se requieren para cubrir completamente el c√≥digo fuente.  Es una buena m√©trica porque respeta la sem√°ntica y ayuda al desarrollador a realizar la refactorizaci√≥n.  Por otro lado, la longitud de una funci√≥n es una mala m√©trica.  No es compatible con la m√©trica de complejidad de Jones explicada anteriormente, ya que ya sabemos: varias l√≠neas son m√°s f√°ciles de leer que una l√≠nea grande con todo dentro.  Nos concentraremos solo en las buenas m√©tricas e ignoraremos las malas. </p><br><p>  Seg√∫n mi experiencia, se deben contar varias m√©tricas de complejidad √∫tiles en lugar de la longitud de la funci√≥n regular: </p><br><ul><li>  N√∫mero de decoradores de funciones;  m√°s bajo es mejor </li><li>  N√∫mero de argumentos;  m√°s bajo es mejor </li><li>  N√∫mero de anotaciones  m√°s alto es mejor </li><li>  N√∫mero de variables locales;  m√°s bajo es mejor </li><li>  N√∫mero de devoluciones, rendimientos, espera;  m√°s bajo es mejor </li><li>  N√∫mero de declaraciones y expresiones;  m√°s bajo es mejor </li></ul><br><p>  La combinaci√≥n de todas estas comprobaciones realmente le permite escribir funciones simples (todas las reglas tambi√©n se aplican a los m√©todos). </p><br><p>  Cuando intente hacer algunas cosas desagradables con su funci√≥n, seguramente romper√° al menos una m√©trica.  Y esto decepcionar√° a nuestro linter y arruinar√° tu construcci√≥n.  Como resultado, su funci√≥n se guardar√°. </p><br><p>  <strong>Soluci√≥n</strong> : cuando una funci√≥n es demasiado compleja, la √∫nica soluci√≥n que tiene es dividir esta funci√≥n en varias. </p><br><h3 id="classes">  Clases </h3><br><p>  El siguiente nivel de abstracci√≥n despu√©s de las funciones son las clases.  Y como ya adivin√≥, son a√∫n m√°s complejos y fluidos que las funciones.  Porque las clases pueden contener m√∫ltiples funciones en su interior (que se llaman m√©todo) y tienen otras caracter√≠sticas √∫nicas como herencia y mixins, atributos de nivel de clase y decoradores de nivel de clase.  Entonces, tenemos que verificar todos los m√©todos como funciones y el cuerpo de la clase en s√≠. </p><br><p>  Para las clases tenemos que medir las siguientes m√©tricas: </p><br><ul><li>  N√∫mero de decoradores de nivel de clase;  m√°s bajo es mejor </li><li>  N√∫mero de clases base;  m√°s bajo es mejor </li><li>  N√∫mero de atributos p√∫blicos a nivel de clase;  m√°s bajo es mejor </li><li>  N√∫mero de atributos p√∫blicos a nivel de instancia;  m√°s bajo es mejor </li><li>  N√∫mero de m√©todos;  m√°s bajo es mejor </li></ul><br><p>  Cuando cualquiera de estos es demasiado complicado, ¬°tenemos que hacer sonar la alarma y fallar la construcci√≥n! </p><br><p>  <strong>Soluci√≥n</strong> : ¬°refactorice su clase reprobada!  Divida una clase compleja existente en varias simples o cree nuevas funciones de utilidad y use la composici√≥n. </p><br><p>  Menci√≥n notable: tambi√©n se puede rastrear la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cohesi√≥n</a> y las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√©tricas de</a> acoplamiento para validar la complejidad de su dise√±o OOP. </p><br><h3 id="modules">  M√≥dulos </h3><br><p>  Los m√≥dulos contienen m√∫ltiples declaraciones, funciones y clases.  Y como ya habr√° mencionado, generalmente recomendamos dividir las funciones y clases en otras nuevas.  Es por eso que debemos tener en cuenta la complejidad del m√≥dulo: literalmente, fluye hacia los m√≥dulos desde clases y funciones. </p><br><p>  Para analizar la complejidad del m√≥dulo tenemos que verificar: </p><br><ul><li>  El n√∫mero de importaciones y nombres importados;  m√°s bajo es mejor </li><li>  El n√∫mero de clases y funciones;  m√°s bajo es mejor </li><li>  La complejidad promedio de funciones y clases dentro;  m√°s bajo es mejor </li></ul><br><p>  ¬øQu√© hacemos en el caso de un m√≥dulo complejo? </p><br><p>  <strong>Soluci√≥n</strong> : s√≠, lo entendiste bien.  Dividimos un m√≥dulo en varios. </p><br><h3 id="packages">  Paquetes </h3><br><p>  Los paquetes contienen m√∫ltiples m√≥dulos.  Por suerte, eso es todo lo que hacen. </p><br><p>  Entonces, el n√∫mero de m√≥dulos en un paquete pronto puede comenzar a ser demasiado grande, por lo que terminar√° con demasiados.  Y es la √∫nica complejidad que se puede encontrar con los paquetes. </p><br><p>  <strong>Soluci√≥n</strong> : debe dividir los paquetes en subpaquetes y paquetes de diferentes niveles. </p><br><h2 id="complexity-waterfall-effect">  Complejidad efecto cascada </h2><br><p>  Ahora hemos cubierto casi todos los tipos posibles de abstracciones en su base de c√≥digo.  ¬øQu√© hemos aprendido de esto?  La conclusi√≥n principal, por ahora, es que la mayor√≠a de los problemas se pueden resolver con la complejidad de expulsi√≥n al mismo nivel de abstracci√≥n o superior. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9b6/8ad/453/9b68ad45340cdf61f51a8deb2c07930d.png" alt="Cascada de complejidad"></p><br><p>  Esto nos lleva a la idea m√°s importante de este art√≠culo: no permita que su c√≥digo se desborde con la complejidad.  Dar√© varios ejemplos de c√≥mo suele suceder. </p><br><p>  Imagine que est√° implementando una nueva caracter√≠stica.  Y ese es el √∫nico cambio que haces: </p><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">+++ if user.is_active and user.has_sub() and sub.is_due(tz.now() + delta): --- if user.is_active and user.has_sub():</span></span></code> </pre> <br><p>  Se ve bien, pasar√≠a este c√≥digo en revisi√≥n.  Y no pasar√≠a nada malo.  Pero, lo que me falta es que la complejidad desbord√≥ esta l√≠nea.  Eso es lo que <code>wemake-python-styleguide</code> : </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c87/b9e/0e5/c87b9e0e584a8cd01235e0ae7695a6c0.png" alt="wemake-python-styleguide-output"></p><br><p>  Ok, ahora tenemos que resolver esta complejidad.  Hagamos una nueva variable: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid: ... ... ...</code> </pre> <br><p>  Ahora, la complejidad de la l√≠nea est√° resuelta.  Pero espera un minuto.  ¬øQu√© pasa si nuestra funci√≥n tiene demasiadas variables ahora?  Porque hemos creado una nueva variable sin verificar primero su n√∫mero dentro de la funci√≥n.  En este caso, tendremos que dividir este m√©todo en varios de esta manera: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._has_paid_sub(user, sub, delta): ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_has_paid_sub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user, sub, delta)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid ...</code> </pre> <br><p>  Ahora hemos terminado!  Derecho?  No, porque ahora tenemos que verificar la complejidad de la clase de <code>Product</code> .  Imag√≠nese que ahora tiene demasiados m√©todos ya que hemos creado uno nuevo <code>_has_paid_sub</code> . </p><br><p>  Ok, ejecutamos nuestro linter para verificar la complejidad nuevamente.  Y resulta que nuestra clase de <code>Product</code> es realmente demasiado compleja en este momento.  Nuestras acciones?  ¬°Lo dividimos en varias clases! </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Policy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SubcsriptionPolicy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Policy)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._has_paid_sub(user, sub, delta): ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_has_paid_sub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user, sub, delta)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> _purchasing_policy: Policy ... ...</code> </pre> <br><p>  ¬°Por favor dime que es la √∫ltima iteraci√≥n!  Bueno, lo siento, pero ahora tenemos que verificar la complejidad del m√≥dulo.  ¬øY adivina qu√©?  Ahora tenemos demasiados miembros del m√≥dulo.  ¬°Entonces, tenemos que dividir los m√≥dulos en m√≥dulos separados!  Luego verificamos la complejidad del paquete.  Y posiblemente tambi√©n lo divida en varios subpaquetes. </p><br><p>  ¬øLo has visto?  Debido a las reglas de complejidad bien definidas, nuestra modificaci√≥n de una sola l√≠nea result√≥ ser una gran sesi√≥n de refactorizaci√≥n con varios m√≥dulos y clases nuevos.  Y no hemos tomado una sola decisi√≥n nosotros mismos: todos nuestros objetivos de refactorizaci√≥n fueron impulsados ‚Äã‚Äãpor la complejidad interna y el linter que lo revela. </p><br><p>  Eso es lo que yo llamo un proceso de "Refactorizaci√≥n continua".  Est√°s obligado a hacer la refactorizaci√≥n.  Siempre. </p><br><p>  Este proceso tambi√©n tiene una consecuencia interesante.  Le permite tener "Arquitectura bajo demanda".  D√©jame explicarte.  Con la filosof√≠a de "Arquitectura bajo demanda" siempre comienza con algo peque√±o.  Por ejemplo, con un solo archivo <code>logic/domains/user.py</code> .  Y comienzas a poner todo lo relacionado con el <code>User</code> all√≠.  Porque en este momento probablemente no sabes c√≥mo se ver√° tu arquitectura.  Y no te importa.  Solo tienes como tres funciones. </p><br><p>  Algunas personas caen en la trampa de la arquitectura frente a la complejidad del c√≥digo.  Pueden complicar demasiado su arquitectura desde el principio con las capas completas de repositorio / servicio / dominio.  O pueden complicar demasiado el c√≥digo fuente sin una separaci√≥n clara.  Lucha y vive as√≠ durante a√±os (¬°si podr√°n vivir durante a√±os con el c√≥digo como este!). </p><br><p>  El concepto "Arquitectura bajo demanda" resuelve estos problemas.  Empiezas poco a poco, cuando llega el momento: divides y refactorizas cosas: </p><br><ol><li>  Comienzas con <code>logic/domains/user.py</code> y pones todo ah√≠ </li><li>  M√°s tarde creas <code>logic/domains/user/repository.py</code> cuando tienes suficientes cosas relacionadas con la base de datos </li><li>  Luego lo divide en <code>logic/domains/user/repository/queries.py</code> y <code>logic/domains/user/repository/commands.py</code> cuando la complejidad le indica que lo haga. </li><li>  Luego creas <code>logic/domains/user/services.py</code> con cosas relacionadas con <code>http</code> </li><li>  Luego crea un nuevo m√≥dulo llamado <code>logic/domains/order.py</code> </li><li>  Y as√≠ sucesivamente </li></ol><br><p>  Eso es todo  Es una herramienta perfecta para equilibrar su arquitectura y la complejidad del c√≥digo.  Y obtenga tanta arquitectura como realmente necesite en este momento. </p><br><h2 id="conclusion">  Conclusi√≥n </h2><br><p>  Good linter hace mucho m√°s que encontrar comas faltantes y malas citas.  Good linter le permite confiar en √©l con las decisiones de arquitectura y ayudarlo con el proceso de refactorizaci√≥n. </p><br><p>  Por ejemplo, <code>wemake-python-styleguide</code> podr√≠a ayudarlo con la complejidad del c√≥digo fuente de <code>python</code> , le permite: </p><br><ul><li>  Lucha con √©xito contra la complejidad en todos los niveles. </li><li>  Aplicar la enorme cantidad de est√°ndares de nombres, mejores pr√°cticas y comprobaciones de coherencia </li><li>  Int√©grelo f√°cilmente en una base de c√≥digo heredada con la ayuda de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">opci√≥n <code>diff</code></a> o la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>flakehell</code></a> , de modo que las viejas infracciones ser√°n perdonadas, pero no se permitir√°n nuevas. </li><li>  Habil√≠telo en su [CI] (), incluso como una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acci√≥n de Github</a> </li></ul><br><p>  No permita que la complejidad desborde su c√≥digo, ¬° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">use un buen linter</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/472876/">https://habr.com/ru/post/472876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../472858/index.html">Python y clientes HTTP r√°pidos</a></li>
<li><a href="../472860/index.html">Invalidaci√≥n de cach√© en cascada. Parte 1</a></li>
<li><a href="../472864/index.html">Punto de control: optimizaci√≥n de CPU y RAM</a></li>
<li><a href="../472866/index.html">Talism√°n para comunicaci√≥n estable</a></li>
<li><a href="../472870/index.html">Por qu√© Agile se detiene sin transformar la arquitectura y las herramientas de desarrollo - presentaci√≥n de la conferencia</a></li>
<li><a href="../472884/index.html">C√≥mo colapsan los estereotipos de un desarrollador novato al comienzo del juego</a></li>
<li><a href="../472886/index.html">¬øC√≥mo implementar un analizador est√°tico en el desarrollo para que todos est√©n contentos?</a></li>
<li><a href="../472892/index.html">Por qu√© los antivirus tradicionales no son adecuados para las nubes p√∫blicas. Y que hacer</a></li>
<li><a href="../472894/index.html">DartUP 2019: conferencia Dart and Flutter en San Petersburgo el 23 de noviembre</a></li>
<li><a href="../472896/index.html">Helic√≥ptero desde una impresora: por primera vez, los cient√≠ficos "imprimieron" una caja de gran tama√±o de un motor de helic√≥ptero</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>