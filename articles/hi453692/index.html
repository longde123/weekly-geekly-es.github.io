<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯРШ ЁЯСиЁЯП┐тАНЁЯОУ ЁЯСитАНЁЯПн рд╢реБрд░реБрдЖрддреА рдХреЗ рд▓рд┐рдП 3 рдбреА рдЧреЗрдо рд╢реЗрдбреНрд╕: рдкреНрд░рднрд╛рд╡ ЁЯО╝ ЁЯР▒ тЮХ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[ рдкрд╣рд▓рд╛ рднрд╛рдЧ ] 

 рдореВрд▓ рдмрд╛рддреЗрдВ рд╕реЗ рдирд┐рдкрдЯрд╛, рд▓реЗрдЦ рдХреЗ рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рд╡рд╕реНрддреБ рд░реВрдкрд░реЗрдЦрд╛, рдЦрд┐рд▓, SSAO, рдХрд▓рдВрдХ, рдХреНрд╖реЗрддреНрд░ рдХреА рдЧрд╣рд░рд╛рдИ, рдкрд┐рдХреНрд╕реЗрд▓рдХрд░рдг, рдФрд░ рдЕрдиреНрдп рдЬреИрд╕реЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдд...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╢реБрд░реБрдЖрддреА рдХреЗ рд▓рд┐рдП 3 рдбреА рдЧреЗрдо рд╢реЗрдбреНрд╕: рдкреНрд░рднрд╛рд╡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453692/">  [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд╣рд▓рд╛ рднрд╛рдЧ</a> ] <br><br>  рдореВрд▓ рдмрд╛рддреЗрдВ рд╕реЗ рдирд┐рдкрдЯрд╛, рд▓реЗрдЦ рдХреЗ рдЗрд╕ рднрд╛рдЧ рдореЗрдВ рд╣рдо рд╡рд╕реНрддреБ рд░реВрдкрд░реЗрдЦрд╛, рдЦрд┐рд▓, SSAO, рдХрд▓рдВрдХ, рдХреНрд╖реЗрддреНрд░ рдХреА рдЧрд╣рд░рд╛рдИ, рдкрд┐рдХреНрд╕реЗрд▓рдХрд░рдг, рдФрд░ рдЕрдиреНрдп рдЬреИрд╕реЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВред <br><br><h2>  рд░реВрдкрд░реЗрдЦрд╛ </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b8/96f/9b2/3b896f9b246e1695fa908b4bdc145480.gif"></div><br>  рджреГрд╢реНрдп рдХреА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдЖрдХреГрддрд┐ рдмрдирд╛рдирд╛ рдЦреЗрд▓ рдХреЛ рдПрдХ рдЕрдиреЛрдЦрд╛ рд░реВрдк рджреЗрддрд╛ рд╣реИ рдЬреЛ рдХреЙрдорд┐рдХреНрд╕ рдпрд╛ рдХрд╛рд░реНрдЯреВрди рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред <br><br><h3>  рдбрд┐рдлреНрдпреВрдЬрд╝ рдордЯреАрд░рд┐рдпрд▓ </h3><br>  рд╕рдореЛрдЪреНрдЪ рд╢реЗрдбрд░ рдХреЛ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдкрд╣рдЪрд╛рдирдиреЗ рдФрд░ рд░рдВрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдирдкреБрдЯ рдмрдирд╛рд╡рдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреА рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП рдЙрдореНрдореАрджрд╡рд╛рд░реЛрдВ рдХреЛ рд╕рд╛рдордЧреНрд░реА рд╕реЗ рд░рдВрдЧ рдлреИрд▓рд╛рдирд╛, рдлреИрд▓рд╛рдирд╛ рдмрдирд╛рд╡рдЯ рд╕реЗ рд░рдВрдЧ, рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдпрд╛ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢реЗ рд╕реЗ рд░рдВрдЧ рднреА рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre><code class="cpp hljs">uniform <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> vec4 diffuse ; } p3d_Material; out vec4 fragColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ vec3 diffuseColor = p3d_Material.diffuse.rgb; fragColor = vec4(diffuseColor, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  рдпрд╣ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдЯреБрдХрдбрд╝рд╛ shader рд╣реИ рдЬреЛ рдПрдХ рдЬреНрдпрд╛рдорд┐рддрд┐ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдлреИрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рд░рдВрдЧ рдХреЛ рдПрдХ рдлреНрд░реЗрдо рдмрдлрд░ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред  рдлреНрд░реЗрдо рдмрдлрд░ рд╕реЗ рдпрд╣ рдлреИрд▓рд╛рдирд╛ рд░рдВрдЧ рдмрдирд╛рд╡рдЯ рдкрде shader рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рдмрдирд╛рд╡рдЯ рд╣реЛрдЧреАред <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f0b/abd/05c/f0babd05caf7104156c15929995c9279.gif"></div><br>  рдпрд╣ рдлреНрд░реЗрдо рдмрдлрд░ рд╕реЗ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдлреИрд▓рд╛рдиреЗ рд╡рд╛рд▓реЗ рд░рдВрдЧ рдХреА рдмрдирд╛рд╡рдЯ рд╣реИ, рдЬреЛ рдЙрди рд░рдВрдЧреЛрдВ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╣рдо рдмреНрд▓реЗрдВрдбрд░ рдореЗрдВ рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВред  рд╕рдореЛрдЪреНрдЪ рд╢реЗрдбрд░ рджреГрд╢реНрдп рдореЗрдВ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдкрд╣рдЪрд╛рдиреЗрдВрдЧреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд░рдВрдЧ рджреЗрдВрдЧреЗред <br><br>  рдпрд╣ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдлреИрд▓рд╛рдирд╛ рд░рдВрдЧ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ рдпрджрд┐ рджреГрд╢реНрдп рдХреЗ рдХреБрдЫ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЕрдкрдирд╛ рдлреИрд▓рд╛рдирд╛ рд░рдВрдЧ рдирд╣реАрдВ рд╣реИред <br><br><h3>  рдХрд┐рдирд╛рд░реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/33a/a0d/57a/33aa0d57aeba90366ddd95865ea0d6c6.gif"></div><br>  рдХрд┐рдирд╛рд░реЗ рдмрдирд╛рдирд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GIMP</a> рдореЗрдВ рдПрдЬ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рдлрд┐рд▓реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред <br><br>  рдЗрд╕ рдЫрд╛рдпрд╛рдВрдХрди рддрдХрдиреАрдХ рдХреЗ рд▓рд┐рдП рд╕рднреА рдЧрдгрдирд╛ рдПрдХ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдореЗрдВ рдХреА рдЬрд╛рддреА рд╣реИред  рд╡рд░реНрдЯреЗрдХреНрд╕ рд╢реЗрдбрд░ рдХреЗ рд▓рд┐рдП рдХрдВрдЯреНрд░реЛрд▓реНрд╕ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реНрдХреНрд░реАрди рдХреЛ рдлрд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рдЖрдпрддрд╛рдХрд╛рд░ рдЬрд╛рд▓ рдХреЗ рдЪрд╛рд░ рдХреЛрдиреЗ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╣реИред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ... uniform sampler2D materialDiffuseTexture; // ... vec2 texSize = textureSize(materialDiffuseTexture, 0).xy; vec2 texCoord = gl_FragCoord.xy; // ...</span></span></code> </pre> <br>  рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдХрд┐ рдЖрдк рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдкрд╣рдЪрд╛рдирдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ, рдЖрдкрдХреЛ рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рд╣рдо рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред  рдЪреВрдВрдХрд┐ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдПрдХ рд╕реНрдХреНрд░реАрди рдЖрдХрд╛рд░ рд╣реЛрддрд╛ рд╣реИ, рд╣рдо рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЧрдгрдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЯреБрдХрдбрд╝реЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдФрд░ рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдЬрд╛рдирддреЗ рд╣реБрдПред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... int separation = 1; // ...</span></span></code> </pre> <br>  рдЕрдкрдиреЗ рд╕реНрд╡рд╛рдж рдХреЗ рдЕрдиреБрд░реВрдк <code>separation</code> рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдкреГрдердХреНрдХрд░рдг, рдХрд┐рдирд╛рд░реЛрдВ рдпрд╛ рд░реЗрдЦрд╛рдУрдВ рдХреЛ рдореЛрдЯрд╛ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float threshold = 0; // ... vec4 mx = vec4(0); vec4 mn = vec4(1); int x = -1; int y = -1; for (int i = 0; i &lt; 9; ++i) { vec4 color = texture ( materialDiffuseTexture , (texCoord + (vec2(x, y) * separation)) / texSize ); mx = max(color, mx); mn = min(color, mn); x += 1; if (x &gt;= 2) { x = -1; y += 1; } } float alpha = ((mx.r + mx.g + mx.b) / 3) - ((mn.r + mn.g + mn.b) / 3); if (alpha &gt; threshold) { alpha = 1; } // ...</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42f/d24/e56/42fd24e5682700e1e7cd5186bebc33af.gif"></div><br>  рдПрдЬ рд░рд┐рдХрдЧреНрдирд┐рд╢рди рддрдХрдиреАрдХ рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдХреЗ рд░рдВрдЧреЛрдВ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХреЛ рдвреВрдВрдврддреА рд╣реИред  рд╡рд░реНрддрдорд╛рди рдЯреБрдХрдбрд╝реЗ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░рддреЗ рд╣реБрдП, рдпрд╣ рдиреМ рдирдореВрдиреЛрдВ рдореЗрдВ рд╕реЗ рд╕рдмрд╕реЗ рдЪрдордХреАрд▓реЗ рдФрд░ рдЧрд╣рд░реЗ рд░рдВрдЧреЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП 3x3 рдЯреБрдХрдбрд╝реЗ рдЦрд┐рдбрд╝рдХреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдлрд┐рд░ рд╡рд╣ рдПрдХ рд░рдВрдЧ рдХреА рдЪрдордХ рд╕реЗ рджреВрд╕рд░реЗ рдХреА рдЪрдордХ рдХреЛ рдШрдЯрд╛рддреА рд╣реИ, рдЕрдкрдирд╛ рдЕрдВрддрд░ рдкрд╛рддреА рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec3 lineRgb = vec3(0.012, 0.014, 0.022); // ... vec4 lineColor = vec4(lineRgb, alpha); // ... fragColor = lineColor; // ...</span></span></code> </pre> <br>  рдЗрд╕ рдЕрдВрддрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдЙрдЯрдкреБрдЯ рд░рдВрдЧ рдХреЗ рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдХреЛрдИ рдЕрдВрддрд░ рдирд╣реАрдВ рд╣реИ, рддреЛ рдХрд┐рдирд╛рд░реЗ рдпрд╛ рд░реЗрдЦрд╛ рдирд╣реАрдВ рдЦреАрдВрдЪреА рдЬрд╛рддреА рд╣реИред  рдпрджрд┐ рдХреЛрдИ рдЕрдВрддрд░ рд╣реИ, рддреЛ рдмрдврд╝рдд рддреИрдпрд╛рд░ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float threshold = 0; // ... if (alpha &gt; threshold) { alpha = 1; } // ...</span></span></code> </pre> <br>  рдереНрд░реЗрд╢реЛрд▓реНрдб рдорд╛рди рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  рдЕрдм рдпрд╣ рд╢реВрдиреНрдп рд╣реИред  рдХреЛрдИ рднреА рдиреЙрдирдЬрд╝реЛрд░реЛ рд╡реИрд▓реНрдпреВ рдПрдХ рдмрдврд╝рдд рдмрди рдЬрд╛рддреА рд╣реИ;  рдпрд╣ рдЫреЛрдЯреЗ рдЕрдВрддрд░ рдХреЗ рд╕рд╛рде рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реИред  рд╢реЛрд░ рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдЖрдорддреМрд░ рдкрд░ рдХреЗрд╡рд▓ рдмрдбрд╝реЗ рдЕрдВрддрд░ рдХреЗ рд▓рд┐рдП рд░реВрдкрд░реЗрдЦрд╛ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред <br><br><h3>  рд╕реНрд░реЛрдд рдХреЛрдб </h3><br><ul><li>  <a href="">main.cxx</a> </li><li>  <a href="">base.vert</a> </li><li>  <a href="">basic.vert</a> </li><li>  <a href="">рд╕рд╛рдордЧреНрд░реА diffuse.frag</a> </li><li>  <a href="">outline.frag</a> </li></ul><br><h2>  рдХреЛрд╣рд░рд╛ </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5af/02c/e52/5af02ce52f813b27461f79e5dca5fe20.gif"></div><br>  рдХреЛрд╣рд░рд╛ (рдпрд╛ рдзреБрдВрдз, рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕реЗ рдмреНрд▓реЗрдВрдбрд░ рдореЗрдВ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рджреГрд╢реНрдп рдореЗрдВ рд╡рд╛рдпреБрдордВрдбрд▓реАрдп рдзреБрдВрдз рдЬреЛрдбрд╝рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд░рд╣рд╕реНрдпрдордп рдирд░рдо рдЙрднрд░реЗ рд╣реБрдП рднрд╛рдЧреЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рд╣реЛрддрд╛ рд╣реИред  рдХреБрдЫ рдЬреНрдпрд╛рдорд┐рддрд┐ рдЕрдЪрд╛рдирдХ рдХреИрдорд░рд╛ рджреГрд╢реНрдпрддрд╛ рдХреЗ рдкрд┐рд░рд╛рдорд┐рдб рдореЗрдВ рдЧрд┐рд░рдиреЗ рдкрд░ рдЙрднрд░реЗ рд╣реБрдП рднрд╛рдЧ рджрд┐рдЦрд╛рдИ рджреЗрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ... uniform struct p3d_FogParameters { vec4 color ; float start ; float end ; } p3d_Fog; // ...</span></span></code> </pre> <br>  рдкрд╛рдВрдбрд╛ 3 рдбреА рдореЗрдВ рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдХреЛрд╣рд░реЗ рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдк рдЙрдиреНрд╣реЗрдВ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдЕрдкрдиреА рдЫрд╛рдпрд╛ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float fogIntensity = clamp ( ( p3d_Fog.end - vertexPosition.y) / ( p3d_Fog.end - p3d_Fog.start) , 0 , 1 ); fogIntensity = 1 - fogIntensity; // ...</span></span></code> </pre> <br>  рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдХреИрдорд░реЗ рд╕реЗ рджреВрд░ рдЬрд╛рдиреЗ рдкрд░ рдХреЛрд╣рд░реЗ рдХреА рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд░реЗрдЦреАрдп рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдЖрдк рдШрд╛рддреАрдп рдореЙрдбрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХреЛрд╣рд░реЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╛ рд╢реБрд░реБрдЖрдд рдореЗрдВ рдХреЛрд╣рд░реЗ рдХреА рдЪрдордХ рд╢реВрдиреНрдп рд╣реЛрддреА рд╣реИред  рдЬрдм рд╢реАрд░реНрд╖ рд╕реНрдерд┐рддрд┐ рдХреЛрд╣рд░реЗ рдХреЗ рдЕрдВрдд рддрдХ <code>fogIntensity</code> , рддреЛ <code>fogIntensity</code> рдПрдХрддрд╛ рдХреЗ <code>fogIntensity</code> рдкрд╣реБрдВрдЪрддреА рд╣реИред  рдХреЛрд╣рд░реЗ рдХреЗ рдЦрддреНрдо рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╕рднреА <code>fogIntensity</code> , рдКрдкрд░ рд╕реЗ 1 рддрдХ рд╕реАрдорд┐рдд рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... fragColor = mix ( outputColor , p3d_Fog.color , fogIntensity ); // ...</span></span></code> </pre> <br>  рдХреЛрд╣рд░реЗ рдХреА рдЪрдордХ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╣рдо рдЖрдЙрдЯрдкреБрдЯ рд░рдВрдЧ рдХреЗ рд╕рд╛рде рдХреЛрд╣рд░реЗ рдХреЗ рд░рдВрдЧ рдХреЛ рдорд┐рд▓рд╛рддреЗ рд╣реИрдВред  рдЬреИрд╕реЗ-рдЬреИрд╕реЗ <code>fogIntensity</code> рдПрдХрддрд╛ рдХреЗ <code>fogIntensity</code> рдЖрддреА рд╣реИ, рдХрдо рдФрд░ рдХрдо <code>outputColor</code> -рд░рдВрдЧ рдФрд░ рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдХреЛрд╣рд░реЗ рдХрд╛ рд░рдВрдЧ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред  рдЬрдм <code>fogIntensity</code> рдПрдХрддрд╛ рддрдХ рдкрд╣реБрдВрдЪрддреА рд╣реИ, рддреЛ рдХреЗрд╡рд▓ рдХреЛрд╣рд░реЗ рдХрд╛ рд░рдВрдЧ рдмрдирд╛ рд░рд╣реЗрдЧрд╛ред <br><br><h3>  рдХреЛрд╣рд░реЗ рдкрд░ рдХреЛрд╣рд░реЗ </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1f/ee8/d49/e1fee8d490abe10ecb798df618f183f7.gif"></div><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ... uniform sampler2D positionTexture; // ... vec4 position = texture(positionTexture, texCoord / texSize); float fogIntensity = clamp ( ( p3d_Fog.end - position.y) / ( p3d_Fog.end - p3d_Fog.start) , 0 , 1 ); fogIntensity = 1 - fogIntensity; vec4 lineWithFogColor = mix ( lineColor , p3d_Fog.color , fogIntensity ); fragColor = vec4(lineWithFogColor.rgb, alpha); // ...</span></span></code> </pre> <br>  рдж рдкреИрде рд╢реИрдбрд░ рдЕрдзрд┐рдХ рд╕рдордЧреНрд░ рдЪрд┐рддреНрд░ рдХреЗ рд▓рд┐рдП рдХрд┐рдирд╛рд░реЛрдВ рдХреЗ рд░рдВрдЧреЛрдВ рдкрд░ рдХреЛрд╣рд░реЗ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рд╡рд╣ рдРрд╕рд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХреЛрд╣рд░реЗ рдХреА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЛрд╣рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЕрд╕реНрдкрд╖реНрдЯ рд╣реЛ рдЬрд╛рдПрдЧреА, рдЬреЛ рдЕрдЬреАрдм рд▓рдЧреЗрдЧрд╛ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡рд╣ рдЕрднреА рднреА рдорд┐рд▓ рдХреЗ рд╕рд╛рде рдЪрд░рдг рдХреЗ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рд╕рдмрд╕реЗ рдмрд╛рд╣рд░реА рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рдЖрдХреГрддрд┐ рдмрдирд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рдирд╛рд░реЛрдВ рдХреЛ рдЬреНрдпрд╛рдорд┐рддрд┐ рд╕реЗ рдкрд░реЗ рдЬрд╛рдирд╛ рд╣реИ - рдЬрд╣рд╛рдВ рдХреЛрдИ рд╢реАрд░реНрд╖ рд╕реНрдерд╛рди рдирд╣реАрдВ рд╣реИрдВред <br><br>  <code>positionTexture</code> рдПрдХ рдлреНрд░реЗрдо рдмрдлрд░ рдЯреЗрдХреНрд╕рдЪрд░ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╡реНрдпреВ рд╕реНрдкреЗрд╕ рдХреЗ рд╡рд░реНрдЯрд┐рдХрд▓ рдХреЗ рдкреЛрдЬрд┐рд╢рди рд╣реЛрддреЗ рд╣реИрдВред  рдЬрдм рд╣рдо SSAO shader рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдВрдЧреЗ, рддреЛ рдЖрдк рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдиреЗрдВрдЧреЗред <br><br><h3>  рд╕реНрд░реЛрдд рдХреЛрдб </h3><br><ul><li>  <a href="">main.cxx</a> </li><li>  <a href="">base.vert</a> </li><li>  <a href="">basic.vert</a> </li><li>  <a href="">base.frag</a> </li><li>  <a href="">outline.frag</a> </li></ul><br><h2>  рдлреВрд▓ </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/31d/744/f35/31d744f35168ac87f609474998802b12.gif"></div><br>  рджреГрд╢реНрдп рдореЗрдВ рдЦрд┐рд▓рдиреЗ рд╕реЗ рдкреНрд░рдХрд╛рд╢ рдореЙрдбрд▓ рдХрд╛ рдПрдХ рдареЛрд╕ рднреНрд░рдо рдкреИрджрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдкреНрд░рдХрд╛рд╢ рдЙрддреНрд╕рд░реНрдЬрдХ рд╡рд╕реНрддреБрдПрдВ рдЕрдзрд┐рдХ рдареЛрд╕ рд╣реЛ рдЬрд╛рддреА рд╣реИрдВ, рдФрд░ рдкреНрд░рдХрд╛рд╢ рдкреНрд░рддрд┐рдмрд┐рдВрдм рдЕрддрд┐рд░рд┐рдХреНрдд рдЪрдордХ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">//... float separation = 3; int samples = 15; float threshold = 0.5; float amount = 1; // ...</span></span></code> </pre> <br>  рдЖрдк рдЗрди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЛ рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдкреГрдердХреНрдХрд░рдг рдзрдмреНрдмрд╛ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред  рдирдореВрдиреЗ рдзреБрдВрдзрд▓рд╛ рдХреА рддрд╛рдХрдд рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдереНрд░реЗрд╕рд╣реЛрд▓реНрдб рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдкреНрд░рднрд╛рд╡ рд╕реЗ рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдФрд░ рдХреНрдпрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рд░рд╛рд╢рд┐ рдмреНрд▓реВрдо рдЖрдЙрдЯрдкреБрдЯ рдХреА рдорд╛рддреНрд░рд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреА рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... int size = samples; int size2 = size * size; int x = 0; int y = 0; // ... float value = 0; vec4 result = vec4(0); vec4 color = vec4(0); // ... for (int i = 0; i &lt; size2; ++i) { // ... } // ...</span></span></code> </pre> <br>  рдпрд╣ рддрдХрдиреАрдХ рд╡рд░реНрддрдорд╛рди рдЯреБрдХрдбрд╝реЗ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдХреЗрдВрджреНрд░рд┐рдд <code>samples</code> рдкрд░ рдПрдХ рдЦрд┐рдбрд╝рдХреА рдХреЗ рдЖрдХрд╛рд░ рдХреЗ <code>samples</code> рдкрд╛рд╕ рдХрд░рдХреЗ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИред  рдпрд╣ рдкрде рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдЦрд┐рдбрд╝рдХреА рдХреА рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... color = texture ( bloomTexture , ( gl_FragCoord.xy + vec2(x * separation, y * separation) ) / texSize ); value = ((0.3 * color.r) + (0.59 * color.g) + (0.11 * color.b)); if (value &lt; threshold) { color = vec4(0); } result += color; // ...</span></span></code> </pre> <br>  рдпрд╣ рдХреЛрдб рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рд╕реЗ рд░рдВрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдореЗрдВ рд▓рд╛рд▓, рд╣рд░реЗ рдФрд░ рдиреАрд▓реЗ рд░рдВрдЧ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдПрдХ рдореВрд▓реНрдп рдореЗрдВ рдмрджрд▓ рджреЗрддрд╛ рд╣реИред  рдпрджрд┐ рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдореЗрдВ рдореВрд▓реНрдп рдереНрд░реЗрд╢реЛрд▓реНрдб рд╕реЗ рдХрдо рд╣реИ, рддреЛ рдпрд╣ рдЗрд╕ рд░рдВрдЧ рдХреЛ рддреНрдпрд╛рдЧ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдпрд╣ рдХрд╛рд▓рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдЦрд┐рдбрд╝рдХреА рдХреЗ рднреАрддрд░ рд╕рднреА рдирдореВрдиреЛрдВ рд╕реЗ рдЧреБрдЬрд░рддреЗ рд╣реБрдП, рдпрд╣ <code>result</code> рдореЗрдВ рдЙрдирдХреЗ рд╕рднреА рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЬрдорд╛ рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... result = result / size2; // ...</span></span></code> </pre> <br>  рдирдореВрдиреЛрдВ рдХреЗ рд╕рдВрдЧреНрд░рд╣ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╡рд╣ рд▓рд┐рдП рдЧрдП рдирдореВрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рд░рдВрдЧ рдХреЗ рдирдореВрдиреЛрдВ рдХреЗ рдпреЛрдЧ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╕реНрд╡рдпрдВ рдФрд░ рдЙрд╕рдХреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЗ рдмреАрдЪ рдХрд╛ рд░рдВрдЧ рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЯреБрдХрдбрд╝реЗ рдХреЗ рд▓рд┐рдП рдРрд╕рд╛ рдХрд░рдиреЗ рд╕реЗ, рд╣рдореЗрдВ рдПрдХ рдзреБрдВрдзрд▓реА рдЫрд╡рд┐ рдорд┐рд▓рддреА рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреЗ рдзрдмреНрдмреЗ рдХреЛ рдмреЙрдХреНрд╕ рдмреНрд▓рд░ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f90/16f/ea4/f9016fea492bc7b136ef6437a683c937.gif"></div><br>  рдпрд╣рд╛рдБ рдЖрдк рдмреНрд▓реВрдо рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рджреЗрдЦрддреЗ рд╣реИрдВред <br><br><h3>  рд╕реНрд░реЛрдд рдХреЛрдб </h3><br><ul><li>  <a href="">main.cxx</a> </li><li>  <a href="">basic.vert</a> </li><li>  <a href="">bloom.frag</a> </li></ul><br><h2>  рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕ рдПрдВрдмрд┐рдПрдВрдЯ рдЗрдВрдХреНрд▓реВрдЬрди (SSAO) </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f93/5ab/5bf/f935ab5bf4794caae3be90b611ad771c.gif"></div><br>  SSAO рдЙрди рдкреНрд░рднрд╛рд╡реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдЬрд╛рдирддреЗ рдирд╣реАрдВ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЬреИрд╕реЗ рд╣реА рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк рдЙрдирдХреЗ рдмрд┐рдирд╛ рдирд╣реАрдВ рд░рд╣ рд╕рдХрддреЗ рд╣реИрдВред  рд╡рд╣ рдПрдХ рдФрд╕рдд рджрд░реНрдЬреЗ рдХреЗ рджреГрд╢реНрдп рдХреЛ рдПрдХ рдЕрджреНрднреБрдд рдореЗрдВ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ!  рд╕реНрдерд┐рд░ рджреГрд╢реНрдпреЛрдВ рдореЗрдВ, рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдмреЗрдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХ рдЧрддрд┐рд╢реАрд▓ рджреГрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рд╢реЗрдбрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  SSAO рдЕрдзрд┐рдХ рдкрд░рд┐рд╖реНрдХреГрдд рдЫрд╛рдпрд╛рдВрдХрди рддрдХрдиреАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд▓реЗрдВрдЧреЗ, рддреЛ рдЖрдк рдПрдХ рдорд╛рд╕реНрдЯрд░ рд╢реЗрдбрд░ рдмрди рдЬрд╛рдПрдВрдЧреЗред <br><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╢реАрд░реНрд╖рдХ рдореЗрдВ "рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕" рд╢рдмреНрдж рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕рд╣реА рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдХреНрд░реАрди рд╕реНрдкреЗрд╕ рдореЗрдВ рд╕рднреА рдЧрдгрдирд╛ рдирд╣реАрдВ рдХреА рдЬрд╛рддреА рд╣реИрдВред <br><br><h3>  рдЖрд╡рдХ рдбреЗрдЯрд╛ </h3><br>  SSAO shader рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЗрдирдкреБрдЯ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред <br><br><ul><li>  рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдореЗрдВ рд╢реАрд░реНрд╖ рдкрджреЛрдВ рдХреЗ рдХреНрд╖реЗрддреНрд░ред </li><li>  рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдореЗрдВ рдХреЛрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╛рдорд╛рдиреНрдп рд╡реИрдХреНрдЯрд░ред </li><li>  рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди рдореЗрдВ рдирдореВрдирд╛ рд╡реИрдХреНрдЯрд░ред </li><li>  рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди рдореЗрдВ рд╢реЛрд░ рд╡реИрдХреНрдЯрд░ред </li><li>  рдХреИрдорд░рд╛ рд▓реЗрдВрд╕ рдкрд░ рдкреНрд░рдХреНрд╖реЗрдкрдг рдореИрдЯреНрд░рд┐рдХреНрд╕ред </li></ul><br><h3>  рд╕реНрдерд┐рддрд┐ </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d2/f36/d42/2d2f36d425c2596288d8982158687354.png"></div><br>  рдлреНрд░реЗрдо рдмрдлрд░ рдмрдирд╛рд╡рдЯ рдореЗрдВ рд╢реАрд░реНрд╖ рдкрджреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИред  рд╣рдо рдЙрдиреНрд╣реЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рдХреИрдорд░рд╛ рдбреЗрдкреНрде рдмрдлрд░</a> рд╕реЗ рд░реАрдХреНрд░рд┐рдПрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдореИрдВ рд╢реБрд░реБрдЖрддреА рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЧрд╛рдЗрдб рд▓рд┐рдЦ рд░рд╣рд╛ рд╣реВрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЗрд╕ рдЕрдиреБрдХреВрд▓рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рддреБрд░рдВрдд рд╡реНрдпрд╛рдкрд╛рд░ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЙрддрд░реЗрдВрдЧреЗред  рдЕрдкрдиреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ, рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs">PT(Texture) depthTexture = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Texture(<span class="hljs-string"><span class="hljs-string">"depthTexture"</span></span>); depthTexture-&gt;set_format(Texture::Format::F_depth_component32); PT(GraphicsOutput) depthBuffer = graphicsOutput-&gt;make_texture_buffer(<span class="hljs-string"><span class="hljs-string">"depthBuffer"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, depthTexture); depthBuffer-&gt;set_clear_color(LVecBase4f(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); NodePath depthCameraNP = window-&gt;make_camera(); DCAST(Camera, depthCameraNP.node())-&gt;set_lens(window-&gt;get_camera(<span class="hljs-number"><span class="hljs-number">0</span></span>)-&gt;get_lens()); PT(DisplayRegion) depthBufferRegion = depthBuffer-&gt;make_display_region(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); depthBufferRegion-&gt;set_camera(depthCameraNP);</code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЧрд╣рд░рд╛рдИ рдмрдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдпрд╣рд╛рдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдЖрдк рдЗрд╕реЗ рдкрд╛рдВрдбрд╛ 3 рдбреА рдореЗрдВ рдХреИрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs">in vec4 vertexPosition; out vec4 fragColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ fragColor = vertexPosition; }</code> </pre> <br>  рдпрд╣рд╛рдБ рдПрдХ рдмрдлрд░ рдмрдлрд░ рдмрдирд╛рд╡рдЯ рдореЗрдВ рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдореЗрдВ рд╢реАрд░реНрд╖ рдкрджреЛрдВ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг shader рд╣реИред  рдПрдХ рдЕрдзрд┐рдХ рдХрдард┐рди рдХрд╛рд░реНрдп рдлреНрд░реЗрдо рдмрдлрд░ рдХреА рдмрдирд╛рд╡рдЯ рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рд╣реИ рддрд╛рдХрд┐ рдЗрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдЯреБрдХрдбрд╝реЗ рд╡реЗрдХреНрдЯрд░ рдХреЗ рдШрдЯрдХ рдЕрдВрддрд░рд╛рд▓ <code>[0, 1]</code> рддрдХ рд╕реАрдорд┐рдд рди рд╣реЛрдВ, рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдЙрдЪреНрдЪ рд╕рдЯреАрдХрддрд╛ (рдкрд░реНрдпрд╛рдкреНрдд рд░реВрдк рд╕реЗ рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдмрд┐рдЯреНрд╕) рд╣реЛред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдкреНрд░рдХреНрд╖реЗрдкрд┐рдд рд╢реАрд░реНрд╖ рд╕реНрдерд╛рди рд╕реНрдерд┐рддрд┐ <code>&lt;-139.444444566, 0.00000034343, 2.5&gt;</code> , рддреЛ рдЖрдк рдЗрд╕реЗ рдмрдирд╛рд╡рдЯ рдХреЗ рд░реВрдк рдореЗрдВ <code>&lt;0.0, 0.0, 1.0&gt;</code> рдирд╣реАрдВ рдмрдЪрд╛ рд╕рдХрддреЗред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... FrameBufferProperties fbp = FrameBufferProperties::get_default(); // ... fbp.set_rgba_bits(32, 32, 32, 32); fbp.set_rgb_color(true); fbp.set_float_color(true); // ...</span></span></code> </pre> <br>  рдпрд╣рд╛рдБ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЛрдб рд╣реИ рдЬреЛ рд╡рд░реНрдЯреЗрдХреНрд╕ рдкреЛрдЬреАрд╢рди рдХреЛ рд╕рдВрдЪрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдлреНрд░реЗрдо рдмрдлрд░ рдмрдирд╛рд╡рдЯ рддреИрдпрд╛рд░ рдХрд░рддрд╛ рд╣реИред  рдЙрд╕реЗ рд▓рд╛рд▓, рд╣рд░реЗ, рдиреАрд▓реЗ рдФрд░ рдЕрд▓реНрдлрд╛ рдХреЗ рд▓рд┐рдП 32 рдмрд┐рдЯреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд╣ рдЕрдВрддрд░рд╛рд▓ рджреНрд╡рд╛рд░рд╛ рдорд╛рдиреЛрдВ рдХреЗ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░ рджреЗрддрд╛ рд╣реИ <code>[0, 1]</code> ред  <code>set_rgba_bits(32, 32, 32, 32)</code> рд▓рд┐рдП рдХреЙрд▓ рдмрд┐рдЯ рд╡реЙрд▓реНрдпреВрдо рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> glTexImage2D ( GL_TEXTURE_2D , <span class="hljs-number"><span class="hljs-number">0</span></span> , GL_RGB32F , <span class="hljs-number"><span class="hljs-number">1200</span></span> , <span class="hljs-number"><span class="hljs-number">900</span></span> , <span class="hljs-number"><span class="hljs-number">0</span></span> , GL_RGB , GL_FLOAT , <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> );</code> </pre> <br>  рдпрд╣рд╛рдБ OpenGL рдкрд░ рдПрдХ рд╕рдорд╛рди рдХреЙрд▓ рд╣реИред  <code>GL_RGB32F</code> рдмрд┐рдЯреНрд╕ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рддрд╛ рд╣реИред <br><br><blockquote>  рдпрджрд┐ рд░рдВрдЧреАрди рдмрдлрд░ рдореЗрдВ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдЕрд▓реНрдкрд╡рд┐рд░рд╛рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд╕рдореАрдХрд░рдгреЛрдВ рдХреЗ рдЕрдВрддрд┐рдо рдФрд░ рдЕрдВрддрд┐рдо рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдорд┐рд╢реНрд░рдг рд╕реВрдЪрдХрд╛рдВрдХреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдорд┐рд╢реНрд░рд┐рдд рд╕рдореАрдХрд░рдг рдХреА рдЧрдгрдирд╛ [0, 1] рдпрд╛ [тИТ1, 1] рддрдХ рд╕реАрдорд┐рдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рд░рдВрдЧреАрди рдмрдлрд╝рд░реНрд╕ рдХреЗ рд▓рд┐рдП рд╣реЛрддреА рд╣реИред  рдпрджрд┐ рд░рдВрдЧ рдмрдлрд░ рдореЗрдВ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдмрд┐рдВрджреБ рд╣реИ, рддреЛ рдкреНрд░рддрд┐рдмрдВрдз рдирд╣реАрдВ рдорд┐рд▓рд╛ рд╣реИред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">рд╕реНрд░реЛрдд</a> </blockquote><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17b/2d0/2ad/17b2d02ad53c411dc251d90fdc16fdf3.png"></div><br>  рдпрд╣рд╛рдБ рдЖрдк рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рджреЗрдЦрддреЗ рд╣реИрдВ;  y рдЕрдХреНрд╖ рдКрдкрд░ рд╣реИред <br><br>  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ PAND3D рдПрдХ рдЕрдХреНрд╖ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реБрдП z рдЕрдХреНрд╖ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ OpenGL рдореЗрдВ y рдЕрдХреНрд╖ рдКрдкрд░ рджрд┐рдЦрддрд╛ рд╣реИред  рдкреИрдВрдбрд░ 3 рдбреА рдореЗрдВ рдкреЛрдЬрд┐рд╢рди shader рдЙрд░реНрдзреНрд╡ z рдХреЗ рд╕рд╛рде рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ <br>  <code>gl-coordinate-system default</code> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h3>  normals </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c4/064/9c5/0c40649c525edd7bcf3c829d6e948789.gif"></div><br>  SSAO shader рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдирдореВрдиреЛрдВ рдХреЗ рд╕рд╣реА рдЕрднрд┐рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдХреЛрдиреЗ рдХреЗ рдорд╛рдирджрдВрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдирдореВрдирд╛ рдХреЛрдб рдЧреЛрд▓рд╛рд░реНрдз рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдХрдИ рдирдореВрдиреЗ рд╡рд╛рд▓реЗ рд╡реИрдХреНрдЯрд░ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдк рдЧреЛрд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдорд╛рдирджрдВрдбреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs">in vec3 vertexNormal; out vec4 fragColor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ vec3 normal = normalize(vertexNormal); fragColor = vec4(normal, <span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> <br>  рд╕реНрдерд┐рддрд┐ shader рдХреА рддрд░рд╣, рд╕рд╛рдорд╛рдиреНрдп shader рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИред  рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рдорд╛рдирджрдВрдбреЛрдВ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛рдж рд░рдЦреЗрдВ рдФрд░ рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рд╡реЗ рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдореЗрдВ рд╣реИрдВред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/57b/a82/f00/57ba82f003b0ab9c2aafa7c9affa28bb.gif"></div><br>  рдХреЛрдиреЗ рдХреЗ рдорд╛рдирджрдВрдб рдпрд╣рд╛рдВ рджрд┐рдЦрд╛рдП рдЧрдП рд╣реИрдВ;  y рдЕрдХреНрд╖ рдКрдкрд░ рд╣реИред <br><br>  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдкрд╛рдВрдбрд╛ 3 рдбреА z рдЕрдХреНрд╖ рдХреЛ рдЙрд░реНрдзреНрд╡рд╛рдзрд░ рд╡реЗрдХреНрдЯрд░, рдФрд░ рдУрдкрдирдЬреАрдПрд▓ рдХреЛ y рдЕрдХреНрд╖ рдорд╛рдирддрд╛ рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп shader z рдЕрдХреНрд╖ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рдиреЗ рдХреЗ рд╕рд╛рде рдХреЛрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ <code>gl-coordinate-system default</code> 3D рдореЗрдВ рдЧреНрд▓ <code>gl-coordinate-system default</code> рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h3>  рдирдореВрдиреЗ </h3><br>  рдХрд┐рд╕реА рднреА рдЯреБрдХрдбрд╝реЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛ рдореВрд▓реНрдп рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЖрд╕-рдкрд╛рд╕ рдХреЗ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдирд╛ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... for (int i = 0; i &lt; numberOfSamples; ++i) { LVecBase3f sample = LVecBase3f ( randomFloats(generator) * 2.0 - 1.0 , randomFloats(generator) * 2.0 - 1.0 , randomFloats(generator) ).normalized(); float rand = randomFloats(generator); sample[0] *= rand; sample[1] *= rand; sample[2] *= rand; float scale = (float) i / (float) numberOfSamples; scale = lerp(0.1, 1.0, scale * scale); sample[0] *= scale; sample[1] *= scale; sample[2] *= scale; ssaoSamples.push_back(sample); } // ...</span></span></code> </pre> <br>  рдирдореВрдирд╛ рдХреЛрдб рдПрдХ рдЧреЛрд▓рд╛рд░реНрдз рдореЗрдВ рд╡рд┐рддрд░рд┐рдд 64 рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирдореВрдиреЗ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИред  рдпреЗ <code>ssaoSamples</code> SSAO shader рдХреЛ рдкрд╛рд╕ рдХрд░ рджрд┐рдП рдЬрд╛рдПрдВрдЧреЗред <br><br><pre> <code class="cpp hljs"> LVecBase3f sample = LVecBase3f ( randomFloats(generator) * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">1.0</span></span> , randomFloats(generator) * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">1.0</span></span> , randomFloats(generator) * <span class="hljs-number"><span class="hljs-number">2.0</span></span> - <span class="hljs-number"><span class="hljs-number">1.0</span></span> ).normalized();</code> </pre> <br>  рдпрджрд┐ рдЖрдк рдЕрдкрдиреЗ рдирдореВрдиреЛрдВ рдХреЛ рдПрдХ рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рд╡рд┐рддрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдШрдЯрдХ z рдХреЗ рдЕрдВрддрд░рд╛рд▓ рдХреЛ рдмрджрд▓ рджреЗрдВ рддрд╛рдХрд┐ рдпрд╣ рд╢реВрдиреНрдп рд╕реЗ рдПрдХ рдореЗрдВ рдмрджрд▓ рдЬрд╛рдПред <br><br><h3>  рд╢реЛрд░ </h3><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... for (int i = 0; i &lt; 16; ++i) { LVecBase3f noise = LVecBase3f ( randomFloats(generator) * 2.0 - 1.0 , randomFloats(generator) * 2.0 - 1.0 , 0.0 ); ssaoNoise.push_back(noise); } // ...</span></span></code> </pre> <br>  рдирдореВрдирд╛ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рдХрд╡рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╢реЛрд░ рд╡реИрдХреНрдЯрд░ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдпреЗ рд╢реЛрд░ рд╡реИрдХреНрдЯрд░ рд╕рддрд╣ рдХреЗ рд╢реАрд░реНрд╖ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рдирдореВрдиреЛрдВ рдХреЛ рдШреБрдорд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><h3>  рдкрд░рд┐рд╡реЗрд╢ рд░реЛрдбрд╝рд╛ </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d35/c1d/bb4/d35c1dbb4e0e9dfeedc3bd4285f26004.gif"></div><br>  SSAO рдЯреБрдХрдбрд╝реЗ рдХреЗ рдЪрд╛рд░реЛрдВ рдУрд░ рджреЗрдЦрдиреЗ рдХреЗ рд╕реНрдерд╛рди рдХрд╛ рдирдореВрдирд╛ рд▓реЗрдХрд░ рдЕрдкрдирд╛ рдХрд╛рд░реНрдп рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИред  рд╕рддрд╣ рдХреЗ рдиреАрдЪреЗ рдЕрдзрд┐рдХ рдирдореВрдиреЗ, рдЯреБрдХрдбрд╝реЗ рдХрд╛ рд░рдВрдЧ рдЧрд╣рд░рд╛ рд╣реЛрддрд╛ рд╣реИред  рдпреЗ рдирдореВрдиреЗ рдЯреБрдХрдбрд╝реЗ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рджрд┐рд╢рд╛ рдореЗрдВ рдХрд╢реЗрд░реБрдХ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рдирдореВрдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдлреНрд░реЗрдо рдмрдлрд░ рд╕реНрдерд┐рддрд┐ рдХреА рдмрдирд╛рд╡рдЯ рдореЗрдВ рд╕реНрдерд┐рддрд┐ рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд▓реМрдЯреЗ рд╕реНрдерд┐рддрд┐ рдХреА рддреБрд▓рдирд╛ рдирдореВрдиреЗ рдХреЗ рд╕рд╛рде рдХреА рдЬрд╛рддреА рд╣реИред  рдпрджрд┐ рдирдореВрдирд╛ рд╕реНрдерд┐рддрд┐ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдХреИрдорд░реЗ рд╕реЗ рджреВрд░ рд╣реИ, рддреЛ рдЯреБрдХрдбрд╝реЗ рдХреА рдУрд░ рдирдореВрдирд╛ рдврдВрдХрд╛ рд╣реБрдЖ рд╣реИред <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cb7/b9a/f1d/cb7b9af1d4dc613f337da5a253ef5a8c.gif"></div><br>  рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рд╕рддрд╣ рдХреЗ рдКрдкрд░ рд╕реНрдерд╛рди рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ рдЬреЛ рд░реЛрдбрд╝рд╛ рдХреЗ рд▓рд┐рдП рдирдореВрдирд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float radius = 1.1; float bias = 0.026; float lowerRange = -2; float upperRange = 2; // ...</span></span></code> </pre> <br>  рдХреБрдЫ рдЕрдиреНрдп рддрдХрдиреАрдХреЛрдВ рдХреА рддрд░рд╣, SSAO shader рдореЗрдВ рдХрдИ рдирд┐рдпрдВрддреНрд░рдг рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рд╛рдВрдЫрд┐рдд рдЙрдкрд╕реНрдерд┐рддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдкреВрд░реНрд╡рд╛рдЧреНрд░рд╣ рдирдореВрдирд╛ рд╕реЗ рдХреИрдорд░реЗ рдХреА рджреВрд░реА рдкрд░ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рджрд╛рдЧ рд╕реЗ рдирд┐рдкрдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рддреНрд░рд┐рдЬреНрдпрд╛ рдирдореВрдирд╛ рд╕реНрдерд╛рди рдХреЗ рдХрд╡рд░реЗрдЬ рдХреНрд╖реЗрддреНрд░ рдХреЛ рдмрдврд╝рд╛рддрд╛ рдпрд╛ рдШрдЯрд╛рддрд╛ рд╣реИред  рд▓реЛрдЕрд░рд░реЗрдВрдЬ рдФрд░ рдЕрдкрд░рд░реЗрдВрдЬ рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЪреБрдиреЗ рдЧрдП рдХрд┐рд╕реА рднреА рдорд╛рди рдХреЗ рд▓рд┐рдП рдХрд╛рд░рдХ рдореАрдЯреНрд░рд┐рдХ рдХреА рдорд╛рдирдХ рд╕реАрдорд╛ рдХреЛ <code>[0, 1]</code> рд╕реЗ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВред  рд╕реАрдорд╛ рдмрдврд╝рд╛рдХрд░, рдЖрдк рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 position = texture(positionTexture, texCoord); vec3 normal = texture(normalTexture, texCoord).xyz; int noiseX = int(gl_FragCoord.x - 0.5) % 4; int noiseY = int(gl_FragCoord.y - 0.5) % 4; vec3 random = noise[noiseX + (noiseY * 4)]; // ...</span></span></code> </pre> <br>  рд╣рдо рдЖрдЧреЗ рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рд╕реНрдерд┐рддрд┐, рд╕рд╛рдорд╛рдиреНрдп рдФрд░ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╡реЗрдХреНрдЯрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред  рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдХреЛрдб рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, 16 рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╡реИрдХреНрдЯрд░ рдмрдирд╛рдП рдЧрдП рдереЗред  рд╡рд░реНрддрдорд╛рди рдЯреБрдХрдбрд╝реЛрдВ рдХреА рд╕реНрдХреНрд░реАрди рд╕реНрдерд┐рддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╡реЗрдХреНрдЯрд░ рдХрд╛ рдЪрдпрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec3 tangent = normalize(random - normal * dot(random, normal)); vec3 binormal = cross(normal, tangent); mat3 tbn = mat3(tangent, binormal, normal); // ...</span></span></code> </pre> <br>  рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╡реЗрдХреНрдЯрд░ рдФрд░ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡реЗрдХреНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛, рдЕрд╕рд╛рдорд╛рдиреНрдп рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдХреЗ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рддреЗ рд╣реИрдВред  рд╣рдореЗрдВ рдирдореВрдирд╛ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╕реНрдкрд░реНрд╢рд░реЗрдЦрд╛ рд╕реНрдерд╛рди рд╕реЗ рд╕рд░реНрд╡реЗрдХреНрд╖рдг рд╕реНрдерд╛рди рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float occlusion = NUM_SAMPLES; for (int i = 0; i &lt; NUM_SAMPLES; ++i) { // ... } // ...</span></span></code> </pre> <br>  рдПрдХ рдореИрдЯреНрд░рд┐рдХреНрд╕ рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж, рд╢реЗрдбрд░ рд▓реВрдк рдХреЗ рд╕рднреА рдирдореВрдиреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓реВрдк рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдмрд┐рдирд╛ рдХрд┐рд╕реА рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдШрдЯрд╛рдПред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec3 sample = tbn * samples[i]; sample = position.xyz + sample * radius; // ...</span></span></code> </pre> <br>  рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдирдореВрдирд╛ рдХреЛ рд╢реАрд░реНрд╖ / рдЦрдВрдб рд╕реНрдерд┐рддрд┐ рдХреЗ рдмрдЧрд▓ рдореЗрдВ рд░рдЦреЗрдВ рдФрд░ рдЗрд╕реЗ рддреНрд░рд┐рдЬреНрдпрд╛ рджреНрд╡рд╛рд░рд╛ рд╕реНрдХреЗрд▓ рдХрд░реЗрдВред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 offset = vec4(sample, 1.0); offset = lensProjection * offset; offset.xyz /= offset.w; offset.xyz = offset.xyz * 0.5 + 0.5; // ...</span></span></code> </pre> <br>  рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдореЗрдВ рдирдореВрдиреЗ рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рд╣рдо рдЗрд╕реЗ рджреЗрдЦрдиреЗ рдХреЗ рд╕реНрдерд╛рди рд╕реЗ рдХрддрд░рди рд╕реНрдерд╛рди рддрдХ рдФрд░ рдлрд┐рд░ рдпреВрд╡реА рд╕реНрдерд╛рди рдореЗрдВ рдмрджрд▓ рджреЗрддреЗ рд╣реИрдВред <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">-1</span></span> * <span class="hljs-number"><span class="hljs-number">0.5</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> * <span class="hljs-number"><span class="hljs-number">0.5</span></span> + <span class="hljs-number"><span class="hljs-number">0.5</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  рдпрд╣ рдордд рднреВрд▓реЛ рдХрд┐ рдХрддрд░рди рд╕реНрдерд╛рди рдХреЗ рдШрдЯрдХ рд╢реВрдиреНрдп рд╕реЗ рдПрдХ рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣реИрдВ, рдФрд░ рдпреВрд╡реА рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╢реВрдиреНрдп рд╕реЗ рдПрдХ рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣реИрдВред  рдХреНрд▓рд┐рдкрд┐рдВрдЧ рд╕реНрдкреЗрд╕ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ UV рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ рдПрдХ рд╕реЗрдХрдВрдб рд╕реЗ рдЧреБрдгрд╛ рдХрд░реЗрдВ рдФрд░ рдПрдХ рд╕реЗрдХрдВрдб рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 offsetPosition = texture(positionTexture, offset.xy); float occluded = 0; if (sample.y + bias &lt;= offsetPosition.y) { occluded = 0; } else { occluded = 1; } // ...</span></span></code> </pre> <br>  2 рдбреА рд╕реНрдерд┐рддрд┐ рдмрдирд╛рд╡рдЯ рдкрд░ 3 рдбреА рдирдореВрдирд╛ рдкреЗрд╢ рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдпреВрд╡реА рдСрдлрд╕реЗрдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, рд╣рдо рдЗрд╕реА рд╕реНрдерд┐рддрд┐ рд╡реЗрдХреНрдЯрд░ рдХреЛ рдвреВрдВрдврддреЗ рд╣реИрдВред  рдпрд╣ рд╣рдореЗрдВ рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рд╕реЗ рдХрддрд░рди рд╡рд╛рд▓реА рдЬрдЧрд╣ рдХреЛ UV рдЕрдВрддрд░рд┐рдХреНрд╖ рдореЗрдВ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рд╡рд╛рдкрд╕ рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдкрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИред  рд╢реЗрдбрд░ рдЗрд╕ рд▓реВрдк рдХреЛ рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд▓рд╛рддрд╛ рд╣реИ рдХрд┐ рдирдореВрдирд╛ рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдирдореВрдирд╛ рдХреЗ рдкреАрдЫреЗ рдХреЛрдИ рдЬреНрдпрд╛рдорд┐рддрд┐ рд╣реИ, рдпрд╛ рдирдореВрдирд╛ рдХреЗ рд╕рд╛рдордиреЗред  рдпрджрд┐ рдирдореВрдирд╛ рдХреБрдЫ рдЬреНрдпрд╛рдорд┐рддрд┐ рдореЗрдВ рдпрд╛ рдЙрд╕рдХреЗ рд╕рд╛рдордиреЗ рд╕реНрдерд┐рдд рд╣реИ, рддреЛ рдпрд╣ рдирдореВрдирд╛ рдХреЗрд╡рд▓ рдУрд╡рд░рд▓реИрдк рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдирдореВрдирд╛ рдХреБрдЫ рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреЗ рдкреАрдЫреЗ рд╣реИ, рддреЛ рдпрд╣ рдирдореВрдирд╛ рдУрд╡рд░рд▓реИрдк рдХрд┐рдП рдЧрдП рдЯреБрдХрдбрд╝реЗ рдХреЗ рд╕рд╛рдкреЗрдХреНрд╖ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float intensity = smoothstep ( 0.0 , 1.0 , radius / abs(position.y - offsetPosition.y) ); occluded *= intensity; occlusion -= occluded; // ...</span></span></code> </pre> <br>  рдЕрдм рдЗрд╕ рд╕реИрдВрдкрд▓ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╡рдЬрд╝рди рддреНрд░рд┐рдЬреНрдпрд╛ рдХреЗ рдЕрдВрджрд░ рдпрд╛ рдЙрд╕рдХреЗ рдмрд╛рд╣рд░ рдХреИрд╕реЗ рдбрд╛рд▓реЗрдВред  рдлрд┐рд░, рдЗрд╕ рдирдореВрдиреЗ рдХреЛ рд░реЛрдбрд╝рд╛ рдореАрдЯреНрд░рд┐рдХ рд╕реЗ рдШрдЯрд╛рдПрдВ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдорд╛рди рд▓реЗрддрд╛ рд╣реИ рдХрд┐ рд╕рднреА рдирдореВрдиреЛрдВ рдХреЛ рд▓реВрдк рд╕реЗ рдкрд╣рд▓реЗ рдУрд╡рд░рд▓реИрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... occlusion /= NUM_SAMPLES; // ... fragColor = vec4(vec3(occlusion), position.a); // ...</span></span></code> </pre> <br>  рдЕрдВрддрд░рд╛рд▓ <code>[0, NUM_SAMPLES]</code> рд╕реЗ рдЕрдВрддрд░рд╛рд▓ рдХреЛ <code>[0, 1]</code> рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирдореВрдиреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдУрд╡рд░рд▓реИрдк рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░реЗрдВред  рд╢реВрдиреНрдп рдХрд╛ рдорддрд▓рдм рдкреВрд░реНрдг рд░реЛрдбрд╝рд╛ рд╣реИ, рдЗрдХрд╛рдЗрдпреЛрдВ рдХрд╛ рдЕрд░реНрде рд╣реИ рдХреЛрдИ рд░реЛрдбрд╝рд╛ рдирд╣реАрдВред  рдЕрдм рд╡рд┐рдЦрдВрдбрди рдореАрдЯреНрд░рд┐рдХ рдХреЛ рдЦрдВрдб рд░рдВрдЧ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВ, рдФрд░ рдпрд╣ рдмрд╛рдд рд╣реИред <br><br>  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрджрд╛рд╣рд░рдг рдХреЛрдб рдореЗрдВ, рдЕрд▓реНрдлрд╛ рдЪреИрдирд▓ рдХреЛ рдУрд╡рд░рд▓реИрдкрд┐рдВрдЧ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдлреНрд░реЗрдо рдмрдлрд░ рд╕реЗ рд╕реНрдерд┐рддрд┐ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЕрд▓реНрдлрд╛ рдорд╛рди рд╕реМрдВрдкрд╛ рдЧрдпрд╛ рд╣реИред <br><br><h3>  рдзреБрдВрдзрд▓рд╛ (рдзреБрдВрдзрд▓рд╛) </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b1/566/2a7/5b15662a7c46db6b8102fe9eabae17c9.gif"></div><br>  SSAO рдлреНрд░реЗрдо рдмрдлрд░ рдХреА рдмрдирд╛рд╡рдЯ рдереЛрдбрд╝рд╛ рд╢реЛрд░ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕реЗ рдЪреМрд░рд╕рд╛рдИ рдХреЗ рд▓рд┐рдП рдзреБрдВрдзрд▓рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... for (int i = 0; i &lt; size2; ++i) { x = size - xCount; y = yCount - size; result += texture ( ssaoTexture , texCoord + vec2(x * parameters.x, y * parameters.x) ).rgb; xCount -= 1; if (xCount &lt; countMin) { xCount = countMax; yCount -= 1; } } result = result / size2; // ...</span></span></code> </pre> <br>  SSAO рдмреНрд▓рд░ рд╢реЗрдбрд░ рдПрдХ рдирд┐рдпрдорд┐рдд рдмреЙрдХреНрд╕ рдмреНрд▓рд░ рд╣реИред  рдмреНрд▓реВрдорд░ рд╢реИрдбрд░ рдХреА рддрд░рд╣, рдпрд╣ рдЖрдиреЗ рд╡рд╛рд▓реА рдмрдирд╛рд╡рдЯ рдкрд░ рдПрдХ рдЦрд┐рдбрд╝рдХреА рдЦреАрдВрдЪрддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЕрдкрдиреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде рдФрд╕рдд рдХрд░рддрд╛ рд╣реИред <br><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреИрд░рд╛рдореАрдЯрд░ред X рдПрдХ рдЕрд▓рдЧ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИред <br><br><h3>  рдкрд░рд┐рд╡реЗрд╢ рдХрд╛ рд░рдВрдЧ </h3><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec2 ssaoBlurTexSize = textureSize(ssaoBlurTexture, 0).xy; vec2 ssaoBlurTexCoord = gl_FragCoord.xy / ssaoBlurTexSize; float ssao = texture(ssaoBlurTexture, ssaoBlurTexCoord).r; vec4 ambient = p3d_Material.ambient * p3d_LightModel.ambient * diffuseTex * ssao; // ...</span></span></code> </pre> <br>  SSAO рдХреЗ рд▓рд┐рдП рдЕрдВрддрд┐рдо рдЪреБрдиреМрддреА рдлрд┐рд░ рд╕реЗ рдкреНрд░рдХрд╛рд╢ рдЧрдгрдирд╛ рдореЗрдВ рд╣реИред  рдпрд╣рд╛рдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдмрдирд╛рд╡рдЯ SSAO рдмрдирд╛рд╡рдЯ рдмрдлрд░ рдореЗрдВ рдХреИрд╕реЗ рд░реЛрдбрд╝рд╛ рдкрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкрд░рд┐рд╡реЗрд╢ рдкреНрд░рдХрд╛рд╢ рдХреА рдЧрдгрдирд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред <br><br><h3>  рд╕реНрд░реЛрдд рдХреЛрдб </h3><br><ul><li>  <a href="">main.cxx</a> </li><li>  <a href="">base.vert</a> </li><li>  <a href="">basic.vert</a> </li><li>  <a href="">position.frag</a> </li><li>  <a href="">normal.frag</a> </li><li>  <a href="">ssao.frag</a> </li><li>  <a href="">blur.frag</a> </li></ul><br><h2>  рдХреНрд╖реЗрддреНрд░ рдХреА рдЧрд╣рд░рд╛рдИ </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6ef/eb0/10f/6efeb010f4623ff49b928d72550f7985.gif"></div><br>  рдлрд╝реАрд▓реНрдб рдХреА рдЧрд╣рд░рд╛рдИ рднреА рдПрдХ рдРрд╕рд╛ рдкреНрд░рднрд╛рд╡ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд░ рдЖрдк рдЗрд╕рдХреЗ рдмрд┐рдирд╛ рдирд╣реАрдВ рд░рд╣ рд╕рдХрддреЗред  рдХрд▓рд╛рддреНрдордХ рджреГрд╖реНрдЯрд┐ рд╕реЗ, рдЖрдк рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рджрд░реНрд╢рдХ рдХрд╛ рдзреНрдпрд╛рди рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖ рд╡рд╕реНрддреБ рдХреА рдУрд░ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рдореЗрдВ, рдереЛрдбрд╝реЗ рдкреНрд░рдпрд╛рд╕ рдХреА рдХреАрдордд рдкрд░ рдХреНрд╖реЗрддреНрд░ рдХреА рдЧрд╣рд░рд╛рдИ рдпрдерд╛рд░реНрдерд╡рд╛рдж рдХрд╛ рдПрдХ рдмрдбрд╝рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдЬреЛрдбрд╝рддреА рд╣реИред <br><br><h3>  рдзреНрдпрд╛рди рдореЗрдВ </h3><br>  рдкрд╣рд▓рд╛ рдЪрд░рдг рджреГрд╢реНрдп рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдлреЛрдХрд╕ рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд░ рд░рд╣рд╛ рд╣реИред  рдЗрд╕реЗ рдлреНрд░реЗрдо рдмрдлрд░ рдЯреЗрдХреНрд╕рдЪрд░ рдкрд░ рд░реЗрдВрдбрд░ рдХрд░реЗрдВред  рдпрд╣ рдлрд╝реАрд▓реНрдб рдмрдлрд░ рдХреА рдЧрд╣рд░рд╛рдИ рдХреЗ рд▓рд┐рдП рдЗрдирдкреБрдЯ рдорд╛рдиреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реЛрдЧрд╛ред <br><br><h3>  рдзреНрдпрд╛рди рд╕реЗ рдмрд╛рд╣рд░ </h3><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 result = vec4(0); for (int i = 0; i &lt; size2; ++i) { x = size - xCount; y = yCount - size; result += texture ( blurTexture , texCoord + vec2(x * parameters.x, y * parameters.x) ); xCount -= 1; if (xCount &lt; countMin) { xCount = countMax; yCount -= 1; } } result = result / size2; // ...</span></span></code> </pre> <br>  рджреВрд╕рд░рд╛ рдЪрд░рдг рджреГрд╢реНрдп рдХреЛ рдзреБрдВрдзрд▓рд╛ рдХрд░рдирд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдлреЛрдХрд╕ рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛред  рдмреНрд▓реВрдо рдФрд░ SSAO рдХреЗ рд╕рд╛рде, рдЖрдк рдмреЙрдХреНрд╕ рдмреНрд▓рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ defocused рджреГрд╢реНрдп рдХреЛ рдлреНрд░реЗрдо рдмрдлрд░ рдмрдирд╛рд╡рдЯ рдкрд░ рд░реЗрдВрдбрд░ рдХрд░реЗрдВред  рдпрд╣ рдлрд╝реАрд▓реНрдб рдЫрд╛рдпрд╛рджрд╛рд░ рдХреА рдЧрд╣рд░рд╛рдИ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрд░ рдЗрдирдкреБрдЯ рдорд╛рди рд╣реЛрдЧрд╛ред <br><br>  рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкреИрд░рд╛рдореАрдЯрд░ред X рдПрдХ рдЕрд▓рдЧ рдкреИрд░рд╛рдореАрдЯрд░ рд╣реИред <br><br><h3>  рдорд┐рд╢реНрд░рдг </h3><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d68/067/83a/d6806783a567c4708d8f13dcb0763f7c.gif"></div><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float focalLengthSharpness = 100; float blurRate = 6; // ...</span></span></code> </pre> <br>  рдЖрдк рдЕрдкрдиреЗ рд╕реНрд╡рд╛рдж рдХреЗ рд▓рд┐рдП рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <code>focalLengthSharpness</code> рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ рджреГрд╢реНрдп рдлреЛрдХрд▓ рд▓рдВрдмрд╛рдИ рдореЗрдВ defocused рд╣реЛрдЧрд╛ред  <code>focalLengthSharpness</code> рдЫреЛрдЯреА <code>focalLengthSharpness</code> , <code>focalLengthSharpness</code> рд╣реА рдЬреНрдпрд╛рджрд╛ <code>focalLengthSharpness</code> рд╕реАрди рдлреЛрдХрд▓ рд▓реЗрдВрде рдкрд░ рд╣реЛрдВрдЧреЗред  рдзреБрдВрдзрд▓рд╛ рд╣реЛ рдЬрд╛рдирд╛ рдлреЛрдХрд▓ рд▓рдВрдмрд╛рдИ рд╕реЗ рджреВрд░ рдЬрд╛рдиреЗ рдкрд░ рджреГрд╢реНрдп рдХреЛ рдзреБрдВрдзрд▓рд╛ рдХрд░рдиреЗ рдХреА рдЧрддрд┐ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред  <code>blurRate</code> рдЬрд┐рддрдирд╛ рдЫреЛрдЯрд╛ рд╣реЛрдЧрд╛, рдлреЛрдХрд╕ рдмрд┐рдВрджреБ рд╕реЗ рджреВрд░ рдЬрд╛рддреЗ рд╕рдордп рджреГрд╢реНрдп рдЙрддрдирд╛ рд╣реА рдзреБрдВрдзрд▓рд╛ рд╣реЛрдЧрд╛ред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 focusColor = texture(focusTexture, texCoord); vec4 outOfFocusColor = texture(outOfFocusTexture, texCoord); // ...</span></span></code> </pre> <br>  рд╣рдореЗрдВ рдлрд╝реЛрдХрд╕ рдореЗрдВ рдФрд░ рдбрд┐рдлреЛрдХрд╕ рдХреА рдЧрдИ рдЫрд╡рд┐ рдореЗрдВ рд░рдВрдЧреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 position = texture(positionTexture, texCoord); // ...</span></span></code> </pre> <br>  рд╣рдореЗрдВ рджреЗрдЦрдиреЗ рдХреА рдЬрдЧрд╣ рдореЗрдВ рд╢реАрд░реНрд╖ рдХреА рд╕реНрдерд┐рддрд┐ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред  рдЖрдк рдЙрд╕ рдлреНрд░реЗрдо рдмрдлрд╝рд░ рд╕реЗ рд╕реНрдерд┐рддрд┐ рдХреА рдмрдирд╛рд╡рдЯ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд╛рдЧреВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ SSAO рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float blur = clamp ( pow ( blurRate , abs(position.y - focalLength.x) ) / focalLengthSharpness , 0 , 1 ); // ... fragColor = mix(focusColor, outOfFocusColor, blur); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдФрд░ рдпрд╣рд╛рдВ рднреНрд░рдо рдХреА рд╕реНрдерд┐рддрд┐ рдкреИрджрд╛ рд╣реЛрддреА рд╣реИред </font><font style="vertical-align: inherit;">рдПрдХ рдХреЗ рдХрд░реАрдм </font></font><code>blur</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, рдЬрд┐рддрдирд╛ рдЕрдзрд┐рдХ рдпрд╣ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ </font></font><code>outOfFocusColor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╢реВрдиреНрдп рдХреЗ рдореВрд▓реНрдп рдХрд╛ </font></font><code>blur</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдзреНрдпрд╛рди рдореЗрдВ рд╣реИред </font></font><code>blur &gt;= 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рдХреЗ </font><font style="vertical-align: inherit;">рд╕рд╛рде </font><font style="vertical-align: inherit;">рдкреВрд░реА рддрд░рд╣ рд╕реЗ defocused рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрд░реЛрдд рдХреЛрдб </font></font></h3><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cxx</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.vert</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">blur.frag</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЧрд╣рд░рд╛рдИ рдХреЗ- field.frag</font></font></a> </li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> posterization </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/078/84d/f1807884d79c5c73915ce9adf6ead5cb.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рддреНрд░рдг, рдпрд╛ рд░рдВрдЧ рдХрд╛ рдирдореВрдирд╛рдХрд░рдг, рдПрдХ рдЫрд╡рд┐ рдореЗрдВ рдЕрджреНрд╡рд┐рддреАрдп рд░рдВрдЧреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдк рдЧреЗрдо рдХреЛ рдХреЙрдорд┐рдХ рдпрд╛ рд░реЗрдЯреНрд░реЛ рд▓реБрдХ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╢реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рдПрдХ рд░реВрдкрд░реЗрдЦрд╛ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдПрдХ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдХрд╛рд░реНрдЯреВрди рд╢реИрд▓реА рдорд┐рд▓рддреА рд╣реИред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float levels = 8; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЬрд┐рддрдирд╛ рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛, рдЙрддрдиреЗ рд╣реА рдЕрдзрд┐рдХ рдлреВрд▓ рдмрдиреЗ рд░рд╣реЗрдВрдЧреЗред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec4 texColor = texture(posterizeTexture, texCoord); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реЗ рд░рдВрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec3 grey = vec3((texColor.r + texColor.g + texColor.b) / 3.0); vec3 grey1 = grey; grey = floor(grey * levels) / levels; texColor.rgb += (grey - grey1); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореИрдВрдиреЗ рдЗрд╕ рддрд░рд╣ рдХреА рдкрджрд╛рд╡рдирддрд┐ рдирд╣реАрдВ рджреЗрдЦреА рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреА рдЬрд╛рдБрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдпрд╣ рдкрд╛рд░рдВрдкрд░рд┐рдХ рддрд░реАрдХреЛрдВ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдЕрдзрд┐рдХ рд╕реБрдВрджрд░ рдкрд░рд┐рдгрд╛рдо рдмрдирд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рд░рдВрдЧ рдкреИрд▓реЗрдЯ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкрд╣рд▓реЗ рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдореЗрдВ рд░рдВрдЧ рдХреЛ рдПрдХ рдореВрд▓реНрдп рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">рд╣рдо рд░рдВрдЧ рдХреЛ рдПрдХ рд╕реНрддрд░ рдкрд░ рдмрд╛рдВрдзрдХрд░ рдЕрд▓рдЧ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рд╣рдо рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдореЗрдВ рд╡рд┐рдЪреНрдЫреЗрджрд┐рдд рдореВрд▓реНрдп рдФрд░ рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдореЗрдВ рдЧреИрд░-рд╡рд┐рд╡реЗрдХреА рдореВрд▓реНрдп рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЗрд╕ рдЕрдВрддрд░ рдХреЛ рдЗрдирдкреБрдЯ рд░рдВрдЧ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЕрдВрддрд░ рд╡рд╣ рд░рд╛рд╢рд┐ рд╣реИ рдЬрд┐рд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЧреНрд░реЗрд╕реНрдХреЗрд▓ рдореЗрдВ рдПрдХ рд╡рд┐рд╡реЗрдХрдкреВрд░реНрдг рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рдВрдЧ рдХреЛ рдмрдврд╝рд╛рдирд╛ / рдШрдЯрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... fragColor = texColor; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреБрдХрдбрд╝рд╛ рдХреЗ рд░рдВрдЧ рдХреЛ рдЗрдирдкреБрдЯ рд░рдВрдЧ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реЗрд▓ рд╢реЗрдбрд┐рдВрдЧ </font></font></h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d1/f9c/133/2d1f9c1333960c0299388fc51323a8b3.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЪрд┐рддреНрд░рд╛рдВрдХрди рдЪрд┐рддреНрд░ рдХреЛ рд╕реАрдПрд▓ рд╢реЗрдбрд┐рдВрдЧ рдХреА рддрд░рд╣ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕реЗрд▓ рд╢реЗрдбрд┐рдВрдЧ рд╡рд┐рд╕рд░рд┐рдд рдлреИрд▓рд╛рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИ рдФрд░ рд░рдВрдЧреЛрдВ рдХреЛ рдЕрд╕рддрдд рд░рдВрдЧреЛрдВ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рд╣рдо рд╕рд╛рдорд╛рдиреНрдп рдирдХреНрд╢реЗ рдХреЗ рдмрд╛рд░реАрдХ рд╡рд┐рд╡рд░рдг рдФрд░ рдЫреЛрдЯреЗ рдореВрд▓реНрдп рдХреЗ рдмрд┐рдирд╛ рдХреЗрд╡рд▓ рдареЛрд╕ рдлреИрд▓ рд░рдВрдЧреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ </font></font><code>levels</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрд░реЛрдд рдХреЛрдб </font></font></h3><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cxx</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.vert</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">posterize.frag</font></font></a> </li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд┐рдХреНрд╕реЗрд▓реЗрд╢рди </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/396/0b9/9bc/3960b99bc2f1fa900c40a1c9f32169bc.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХ 3 рдбреА рдЧреЗрдо рдХрд╛ рдкрд┐рдХреНрд╕реЗрд▓рдХрд░рдг рдЗрд╕реЗ рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рд░реВрдк рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдпрд╛ рдпрд╣ рдЖрдкрдХреЛ рд╕рдордп рдмрдЪрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╕рднреА рдкрд┐рдХреНрд╕реЗрд▓ рдХрд▓рд╛ рдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд▓реЗ рдЬрд╛рдПрдЧрд╛ред </font><font style="vertical-align: inherit;">рд╕рд╣реА рд░реЗрдЯреНрд░реЛ рд▓реБрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдкреЛрд╢реНрдЪрд░рд╛рдЗрдЬреЗрд╢рди рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдПрдВред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... int pixelSize = 5; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрдк рдкрд┐рдХреНрд╕реЗрд▓ рдЖрдХрд╛рд░ рдХреЛ рд╕реНрд╡рдпрдВ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрд╣ рдЬрд┐рддрдирд╛ рдмрдбрд╝рд╛ рд╣реЛрдЧрд╛, рдЫрд╡рд┐ рдЙрддрдиреА рд╣реА рдХрдард┐рди рд╣реЛрдЧреАред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/413/818/aee/413818aee5509763cc383f800b837cfb.gif"></div><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float x = int(gl_FragCoord.x) % pixelSize; float y = int(gl_FragCoord.y) % pixelSize; x = floor(pixelSize / 2.0) - x; y = floor(pixelSize / 2.0) - y; x = gl_FragCoord.x + x; y = gl_FragCoord.y + y; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣ рддрдХрдиреАрдХ рдкреНрд░рддреНрдпреЗрдХ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЕрдкрдиреЗ рдирд┐рдХрдЯрддрдо рдЧреИрд░-рдЕрддрд┐рд╡реНрдпрд╛рдкреА рдкрд┐рдХреНрд╕реЗрд▓-рдЖрдХрд╛рд░ рдХреА рдЦрд┐рдбрд╝рдХреА рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рд╕рдВрд▓рдЧреНрди рдХрд░рддреА рд╣реИред </font><font style="vertical-align: inherit;">рдпреЗ рд╡рд┐рдВрдбреЛ рдЗрдирдХрдорд┐рдВрдЧ рдЯреЗрдХреНрд╕рдЪрд░ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд╣реЛрддреА рд╣реИрдВред </font><font style="vertical-align: inherit;">рдЦрд┐рдбрд╝рдХреА рдХреЗ рдХреЗрдВрджреНрд░ рдореЗрдВ рдЯреБрдХрдбрд╝реЗ рдЙрдирдХреА рдЦрд┐рдбрд╝рдХреА рдореЗрдВ рдЕрдиреНрдп рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рд░рдВрдЧ рдХрд╛ рдирд┐рд░реНрдзрд╛рд░рдг рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... fragColor = texture(pixelizeTexture, vec2(x, y) / texSize); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡рд╛рдВрдЫрд┐рдд рдЯреБрдХрдбрд╝реЗ рдХреЗ рд╕рдордиреНрд╡рдп рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдиреЗ рд╡рд╛рд▓реЗ рдмрдирд╛рд╡рдЯ рд╕реЗ рдЙрд╕рдХрд╛ рд░рдВрдЧ рд▓реЗрдВ рдФрд░ рдЗрд╕реЗ рдЯреБрдХрдбрд╝реЗ рдХреЗ рд░рдВрдЧ рдореЗрдВ рдЕрд╕рд╛рдЗрди рдХрд░реЗрдВред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрд░реЛрдд рдХреЛрдб </font></font></h3><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cxx</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.vert</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pixelize.frag</font></font></a> </li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкреИрдирд╛ </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b52/674/617/b52674617a0733ee1fe0d525b0053750.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреИрдирд╛рдкрди рдкреНрд░рднрд╛рд╡ (рдкреИрдирд╛рдкрди) рдЫрд╡рд┐ рдХреЗ рдХрд┐рдирд╛рд░реЛрдВ рдкрд░ рд╡рд┐рдкрд░реАрддрддрд╛ рдХреЛ рдмрдврд╝рд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрд╣ рдмрд╣реБрдд рдХрд╛рдо рдЖрддрд╛ рд╣реИ рдЬрдм рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдмрд╣реБрдд рдирд░рдо рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float amount = 0.8; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореВрд▓реНрдп рдмрджрд▓рдХрд░, рд╣рдо рдкрд░рд┐рдгрд╛рдо рдХреЗ рддреЗрдЬ рдХреЗ рдкрд░рд┐рдорд╛рдг рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдорд╛рди рд╢реВрдиреНрдп рд╣реИ, рддреЛ рдЫрд╡рд┐ рдирд╣реАрдВ рдмрджрд▓реЗрдЧреАред </font><font style="vertical-align: inherit;">рдирдХрд╛рд░рд╛рддреНрдордХ рдореВрд▓реНрдпреЛрдВ рдХреЗ рд╕рд╛рде, рдЫрд╡рд┐ рдЕрдЬреАрдм рд▓рдЧрдиреЗ рд▓рдЧрддреА рд╣реИред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float neighbor = amount * -1; float center = amount * 4 + 1; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЖрд╕рдиреНрди рдЕрдВрд╢реЛрдВ рдХреЛ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>amount * -1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рд╡рд░реНрддрдорд╛рди рдЯреБрдХрдбрд╝рд╛ рджреНрд╡рд╛рд░рд╛ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ </font></font><code>amount * 4 + 1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec3 color = texture(sharpenTexture, vec2(gl_FragCoord.x + 0, gl_FragCoord.y + 1) / texSize).rgb * neighbor + texture(sharpenTexture, vec2(gl_FragCoord.x - 1, gl_FragCoord.y + 0) / texSize).rgb * neighbor + texture(sharpenTexture, vec2(gl_FragCoord.x + 0, gl_FragCoord.y + 0) / texSize).rgb * center + texture(sharpenTexture, vec2(gl_FragCoord.x + 1, gl_FragCoord.y + 0) / texSize).rgb * neighbor + texture(sharpenTexture, vec2(gl_FragCoord.x + 0, gl_FragCoord.y - 1) / texSize).rgb * neighbor ; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрдбрд╝реЛрд╕реА рдЯреБрдХрдбрд╝реЗ рдКрдкрд░, рдиреАрдЪреЗ, рдмрд╛рдПрдБ рдФрд░ рджрд╛рдПрдБ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдФрд░ рд╡рд░реНрддрдорд╛рди рдЯреБрдХрдбрд╝реЗ рдХреЛ рдЙрдирдХреЗ рдореВрд▓реНрдпреЛрдВ рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдкрд░рд┐рдгрд╛рдо рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... fragColor = vec4(color, texture(sharpenTexture, texCoord).a); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╣ рд░рд╛рд╢рд┐ рдЯреБрдХрдбрд╝реЗ рдХрд╛ рдЕрдВрддрд┐рдо рд░рдВрдЧ рд╣реИред </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрд░реЛрдд рдХреЛрдб </font></font></h3><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cxx</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.vert</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sharpen.frag</font></font></a> </li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдлрд┐рд▓реНрдо рдХрд╛ рджрд╛рдирд╛ </font></font></h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f3/16e/232/2f316e232598d07fa8114f8db32c12a7.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓реНрдо рдХрд╛ рджрд╛рдирд╛ (рдЫреЛрдЯреА рдЦреБрд░рд╛рдХ рдореЗрдВ, рдФрд░ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдирд╣реАрдВ) рдпрдерд╛рд░реНрдерд╡рд╛рдж рдХреЛ рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕ рдкреНрд░рднрд╛рд╡ рдХреЛ рд╣рдЯрд╛рдиреЗ рддрдХ рдЕрджреГрд╢реНрдп рд╣реИред </font><font style="vertical-align: inherit;">рдЖрдорддреМрд░ рдкрд░ рдпреЗ рдРрд╕реА рдЦрд╛рдорд┐рдпрд╛рдВ рд╣реИрдВ рдЬреЛ рдбрд┐рдЬрд┐рдЯрд▓ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдЫрд╡рд┐ рдХреЛ рдФрд░ рдЕрдзрд┐рдХ рдЖрд╢реНрд╡рд╕реНрдд рдХрд░рддреА рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдлрд┐рд▓реНрдо рдЕрдирд╛рдЬ рдЖрдорддреМрд░ рдкрд░ рдЕрдВрддрд┐рдо рдкреНрд░рднрд╛рд╡ рд╣реИ рдЬреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдлреНрд░реЗрдо рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореВрд▓реНрдп </font></font></h3><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... float amount = 0.1; // ...</span></span></code> </pre> <br> <code>amount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓реНрдо рдЕрдирд╛рдЬ рдХреА рджреГрд╢реНрдпрддрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЙрдЪреНрдЪ рдореВрд▓реНрдп, рддрд╕реНрд╡реАрд░ рдореЗрдВ рдЕрдзрд┐рдХ "рдмрд░реНрдл"ред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЪрдордХ </font></font></h3><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// ... uniform float osg_FrameTime; //... float toRadians = 3.14 / 180; //... float randomIntensity = fract ( 10000 * sin ( ( gl_FragCoord.x + gl_FragCoord.y * osg_FrameTime ) * toRadians ) ); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдХреЛрдб рдХрд╛ рдпрд╣ рдЯреБрдХрдбрд╝рд╛ рдореВрд▓реНрдп рдХреЛ рд╕рдорд╛рдпреЛрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЪрдордХ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИред </font></font><br><br><pre> <code class="cpp hljs">Time Since F1 = <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span> <span class="hljs-number"><span class="hljs-number">09</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> Frame Number = F1 F3 F4 F5 F6 osg_FrameTime = <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">08</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╛рдВрдбрд╛ 3 рдбреА </font></font><code>osg_FrameTime</code> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореВрд▓реНрдп </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдПрдХ рдлреНрд░реЗрдо рдЯрд╛рдЗрдо рдПрдХ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИ рдХрд┐ рдкрд╣рд▓реЗ рдлреНрд░реЗрдо рдХреЗ рдмрд╛рдж рдХрд┐рддрдиреЗ рд╕реЗрдХрдВрдб рдмреАрдд рдЪреБрдХреЗ рд╣реИрдВред </font><font style="vertical-align: inherit;">рдирдореВрдирд╛ рдХреЛрдб рдлрд┐рд▓реНрдо рдХреЗ рджрд╛рдиреЗ рдХреЛ рдЪреЗрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬреЛ </font></font><code>osg_FrameTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдлреНрд░реЗрдо рдореЗрдВ рдЕрд▓рдЧ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... ( gl_FragCoord.x + gl_FragCoord.y * 8009 // Large number here. // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдерд┐рд░ рдЕрдирд╛рдЬ рдХреЗ рд▓рд┐рдП, рдлрд┐рд▓реНрдореЛрдВ рдХреЛ </font></font><code>osg_FrameTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмрдбрд╝реА рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ </font><font style="vertical-align: inherit;">рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреИрдЯрд░реНрди рджреЗрдЦрдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рд╡рд┐рднрд┐рдиреНрди рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЛ рдЖрдЬрд╝рдорд╛ рд╕рдХрддреЗ рд╣реИрдВред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/358/2bd/6d2/3582bd6d2d67eb5ac1fdcdf8d52800e6.gif"></div><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... * sin ( ( gl_FragCoord.x + gl_FragCoord.y * someNumber // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓реНрдо рдЕрдирд╛рдЬ рдХреЗ рдЕрдВрдХ, рдпрд╛ рд╕реНрдкреЙрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рджреЛрдиреЛрдВ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ, рдФрд░ x, рдФрд░ y рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдпрджрд┐ рдЖрдк x рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреЗрд╡рд▓ рдКрд░реНрдзреНрд╡рд╛рдзрд░ рд░реЗрдЦрд╛рдПрдБ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЬрд╛рдПрдВрдЧреА, рдпрджрд┐ рдЖрдк y рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдХреЗрд╡рд▓ рдХреНрд╖реИрддрд┐рдЬ рд░реЗрдЦрд╛рдПрдБ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдВрдЧреАред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛрдб рдореЗрдВ, рд╡рд┐рдХрд░реНрдг рд╕рдорд░реВрдкрддрд╛ рдХреЛ рдирд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рдордиреНрд╡рдп рджреВрд╕рд░реЗ рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c0/ad6/d5a/4c0ad6d5ada5d533b6dc31bbfa7aa0fc.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдмреЗрд╢рдХ, рдЖрдк рд╕рдордиреНрд╡рдп рдЧреБрдгрдХ рд╕реЗ рдЫреБрдЯрдХрд╛рд░рд╛ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╕реНрд╡реАрдХрд╛рд░реНрдп рдмрд╛рд░рд┐рд╢ рдкреНрд░рднрд╛рд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╡рд░реНрд╖рд╛ рдкреНрд░рднрд╛рд╡ рдХреЛ рдЪреЗрддрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдЙрдЯрдкреБрдЯ </font></font><code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ </font><font style="vertical-align: inherit;">рдЧреБрдгрд╛ рдХрд░реЗрдВ </font></font><code>osg_FrameTime</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдПрдХреНрд╕ рдФрд░ рд╡рд╛рдИ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдмрд╛рд░рд┐рд╢ рдХреА рджрд┐рд╢рд╛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордиреНрд╡рдп рдХрд░рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдиреАрдЪреЗ рдХреА рдУрд░ рдмреМрдЫрд╛рд░ рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ x рд╕рдордиреНрд╡рдп рдЫреЛрдбрд╝реЗрдВред</font></font><br><br><pre> <code class="cpp hljs">input = (gl_FragCoord.x + gl_FragCoord.y * osg_FrameTime) * toRadians frame(<span class="hljs-number"><span class="hljs-number">10000</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(input)) = fract(<span class="hljs-number"><span class="hljs-number">10000</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">6.977777777777778</span></span>)) = fract(<span class="hljs-number"><span class="hljs-number">10000</span></span> * <span class="hljs-number"><span class="hljs-number">0.6400723818964882</span></span>) =</code> </pre> <br> <code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╣реИрд╢ рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдлреНрд░реИрдЧрдореЗрдВрдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдЖрдЙрдЯрдкреБрдЯ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рд╣реИрд╢ рдХрд┐рдП рдЧрдП рд╣реИрдВ </font></font><code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рд▓рд┐рдП рдзрдиреНрдпрд╡рд╛рдж, рдПрдХ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╕рдВрдкрддреНрддрд┐ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ - рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ (рдмрдбрд╝реЗ рдпрд╛ рдЫреЛрдЯреЗ) рдЬреЛ рднреА рд╣реЛ, рдЖрдЙрдЯрдкреБрдЯ рдЕрдВрддрд░рд╛рд▓ рдорд╛рдЗрдирд╕ рдПрдХ рд╕реЗ рдПрдХ рддрдХ рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣реЛрдЧрд╛ред</font></font><br><br><pre> <code class="cpp hljs">fract(<span class="hljs-number"><span class="hljs-number">10000</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">6.977777777777778</span></span>)) = fract(<span class="hljs-number"><span class="hljs-number">10000</span></span> * <span class="hljs-number"><span class="hljs-number">0.6400723818964882</span></span>) = fract(<span class="hljs-number"><span class="hljs-number">6400.723818964882</span></span>) = <span class="hljs-number"><span class="hljs-number">0.723818964882</span></span></code> </pre> <br> <code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рде </font></font><code>fract</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдореЗрдВ рдПрдХ рдЫрджреНрдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛ рдЬрдирд░реЗрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><pre> <code class="cpp hljs">&gt;&gt;&gt; [<span class="hljs-built_in"><span class="hljs-built_in">floor</span></span>(fract(<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(x * toRadians)) * <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span><span class="hljs-function"> x in </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">] [0, 0, 1, 2, 2, 3, 4, 4, 5, 6] &gt;&gt;&gt; [</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">floor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fract(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10000</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">sin</span></span></span></span><span class="hljs-function"><span class="hljs-params">(x * toRadians)) * </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span><span class="hljs-function"> x in </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">] [0, 4, 8, 0, 2, 1, 7, 0, 0, 5]</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреА рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рджреЗрдЦреЗрдВ, рдФрд░ рдлрд┐рд░ рджреВрд╕рд░реА рдкрд░ред </font><font style="vertical-align: inherit;">рдкреНрд░рддреНрдпреЗрдХ рдкрдВрдХреНрддрд┐ рдирд┐рдпрддрд╛рддреНрдордХ рд╣реИ, рд▓реЗрдХрд┐рди рдкреИрдЯрд░реНрди рджреВрд╕рд░реЗ рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рджреВрд╕рд░реЗ рдореЗрдВ рдХрдо рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рддрдереНрдп рдХреЗ рдмрд╛рд╡рдЬреВрдж рдХрд┐ рдЖрдЙрдЯрдкреБрдЯ </font></font><code>fract(10000 * sin(...))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдирд┐рд░реНрдзрд╛рд░рдХ рд╣реИ, рдкреИрдЯрд░реНрди рдХреЛ рдмрд╣реБрдд рдХрдордЬреЛрд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b88/6e7/f0f/b886e7f0feda6760c5fc87df6680680f.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдВ рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ рдХрд╛рд░рдХ </font></font><code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓реЗ 1, рдлрд┐рд░ 10, рдлрд┐рд░ 100 рдФрд░ рдлрд┐рд░ 1000 рд╣реИред </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЬреИрд╕рд╛ рдХрд┐ рдЖрдЙрдЯрдкреБрдЯ рдорд╛рдиреЛрдВ рдХреЗ рдЧреБрдгрдХ рдореЗрдВ рд╡реГрджреНрдзрд┐ рд╣реЛрддреА рд╣реИ, </font></font><code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреИрдЯрд░реНрди рдХрдо рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </font><font style="vertical-align: inherit;">рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ, рдХреЛрдб </font></font><code>sin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдХреЛ 10,000 рд╕реЗ рдЧреБрдгрд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЦреБрд╢рдмреВ рдХрд╛ рд░рдВрдЧ </font></font></h3><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... vec2 texSize = textureSize(filmGrainTexture, 0).xy; vec2 texCoord = gl_FragCoord.xy / texSize; vec4 color = texture(filmGrainTexture, texCoord); // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЯреБрдХрдбрд╝реЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ UV-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдмрджрд▓реЗрдВред </font><font style="vertical-align: inherit;">рдЗрди рдпреВрд╡реА-рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рд╡рд░реНрддрдорд╛рди рдЯреБрдХрдбрд╝реЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рд╡рдЯ рдХреЗ рд░рдВрдЧ рдХреА рддрд▓рд╛рд╢ рдХрд░рддреЗ рд╣реИрдВред</font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... amount *= randomIntensity; color.rgb += amount; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдореВрд▓реНрдп рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЪрдордХ рдореЗрдВ рдмрджрд▓реЗрдВ рдФрд░ рдЗрд╕реЗ рд░рдВрдЧ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред </font></font><br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// ... fragColor = color; // ...</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЯреБрдХрдбрд╝реЗ рдХрд╛ рд░рдВрдЧ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ, рдФрд░ рдпрд╣ рдмрд╛рдд рд╣реИ </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╕реНрд░реЛрдд рдХреЛрдб </font></font></h3><br><ul><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main.cxx</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">basic.vert</font></font></a> </li><li> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдлрд┐рд▓реНрдо grain.frag</font></font></a> </li></ul><br><h2>  рдзрдиреНрдпрд╡рд╛рдж </h2><br><ul><li>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" rel="nofollow">Kiwi Soda Font</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi453692/">https://habr.com/ru/post/hi453692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi453676/index.html">рд▓рд┐рдирдХреНрд╕ рдореЗрдВ SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рдВрдбреЛрдЬ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдирд╛</a></li>
<li><a href="../hi453678/index.html">рдкрд╛рдиреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдзреНрд╡рдирд┐ рджреНрд╡рд╛рд░рд╛ рдкреБрди: рдкреНрд░рд╕рд╛рд░рдг рдпрд╛ рд╡реАрдбрд┐рдпреЛ рдкреНрд░рд╕рд╛рд░рдг рдХреИрд╕реЗ рджреЗрдЦреЗрдВ - 2</a></li>
<li><a href="../hi453682/index.html">Redd рдореЗрдВ рд╕реНрдерд╛рдкрд┐рдд FPGAs рдХреЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рд╕рд░рд▓ "рдлрд░реНрдорд╡реЗрдпрд░" рдХрд╛ рд╡рд┐рдХрд╛рд╕ред рднрд╛рдЧ 2. рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛрдб</a></li>
<li><a href="../hi453686/index.html">рд╕реБрд░рдХреНрд╖рд╛ рд╕рдкреНрддрд╛рд╣ 22: рдЦрддрд░реЗ рдХреЗ рдЖрдБрдХрдбрд╝реЗ, рдмреИрдВрдХрд┐рдВрдЧ рдЯреНрд░реЛрдЬрди рдФрд░ рд▓реЛрдХрдкреНрд░рд┐рдп рдХрд╛рд░рдирд╛рдореЗ</a></li>
<li><a href="../hi453688/index.html">рдЬрд╛рд╡рд╛ рди рдХреЗрд╡рд▓ рдЦреВрдиреА рдЙрджреНрдпрдо рд╣реИ, рдмрд▓реНрдХрд┐ рддреЗрдЬреА рд╕реЗ рд╡рд┐рд▓рдВрдмрддрд╛-рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рднреА рд╣реИ</a></li>
<li><a href="../hi453694/index.html">рд▓рд┐рдирдХреНрд╕ рдореЗрдВ SSH рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд┐рдВрдбреЛрдЬ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВ</a></li>
<li><a href="../hi453696/index.html">рдХреЛрдгреАрдп рджреЛ-рддрд░рдлрд╝рд╛ рдмрдВрдзрди, рдереЛрдбрд╝реА рдФрд░ рд╕рдордЭ</a></li>
<li><a href="../hi453698/index.html">рдХреНрд╡рд╛рдВрдЯрдо рд╕реВрдЪрдирд╛ рдХреНрд╡рд╛рдВрдЯрдо рдЪреЗрддрдирд╛ рдореЗрдВ</a></li>
<li><a href="../hi453700/index.html">рдПрд╕рдбреАрдПрд▓ 2 рдкрд░ рд╕рдмрдХ: рдкрд╛рда 1 - рд╣реИрд▓реЛ, рдПрд╕рдбреАрдПрд▓ 2</a></li>
<li><a href="../hi453706/index.html">рдореИрдВрдиреЗ Google рдХреНрд▓рд╛рдЙрдб рдкреНрд░реЛрдлреЗрд╢рдирд▓ рдбреЗрдЯрд╛ рдЗрдВрдЬреАрдирд┐рдпрд░ рд╕рд░реНрдЯрд┐рдлрд┐рдХреЗрд╢рди рдкрд░реАрдХреНрд╖рд╛ рдХреИрд╕реЗ рдЙрддреНрддреАрд░реНрдг рдХреА</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>