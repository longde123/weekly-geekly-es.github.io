<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíù ‚Ü™Ô∏è üõèÔ∏è Visualizaci√≥n del n√∫mero de victorias para los equipos de la NBA utilizando gr√°ficos de barras animados en R üïû üëéüèª ‚úçÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Primero, alguna informaci√≥n de fondo. Mi nombre es Vladislav y conoc√≠ a R en agosto del a√±o pasado. Decid√≠ aprender un lenguaje de programaci√≥n debido...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Visualizaci√≥n del n√∫mero de victorias para los equipos de la NBA utilizando gr√°ficos de barras animados en R</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458904/"><p>  Primero, alguna informaci√≥n de fondo.  Mi nombre es Vladislav y conoc√≠ a R en agosto del a√±o pasado.  Decid√≠ aprender un lenguaje de programaci√≥n debido a una naturaleza aplicada.  Desde peque√±o, me gustaba mantener estad√≠sticas deportivas.  Con la edad, este pasatiempo se transform√≥ en un deseo de analizar de alguna manera estas cifras y, bas√°ndose en el an√°lisis de datos, dar, si es posible, pensamientos inteligentes.  El problema es que en los √∫ltimos a√±os, los deportes han sido barridos por una ola de datos, docenas de compa√±√≠as compiten entre s√≠, tratando de calcular, describir y empujar a la neurona cualquier acci√≥n de un jugador de f√∫tbol, ‚Äã‚Äãjugador de baloncesto, jugador de b√©isbol en la cancha.  Y Excel no es categ√≥ricamente adecuado para el an√°lisis.  Entonces decid√≠ estudiar R para que el an√°lisis m√°s simple no tomara medio d√≠a.  Ya en el curso del estudio, se agreg√≥ un inter√©s en la programaci√≥n como tal, pero esta ya es la letra. </p><a name="habracut"></a><br><p>  Quiero notar de inmediato que gran parte de lo que escribir√© en el futuro <del>  ya he estado en los simpsons </del>  estaba en Habr en el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Creamos histogramas animados usando R.</a> Este art√≠culo, a su vez, es una traducci√≥n del art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear gr√°ficos de barras animadas de tendencias usando R</a> de Medium.  Por lo tanto, para diferir de alguna manera de los art√≠culos anteriores, tratar√© de describir m√°s completamente lo que estoy haciendo, as√≠ como aquellos momentos que no est√°n en el art√≠culo original.  Por ejemplo, para llenar las columnas, utilic√© los colores de los comandos de la NBA, no la paleta <code>ggplot2</code> est√°ndar, sino que en el procesamiento de datos del paquete <code>data.table</code> , no <code>dplyr</code> .  He hecho todo este trabajo como una funci√≥n, as√≠ que ahora es suficiente simplemente escribir el nombre del equipo y los a√±os para los que necesita contar el n√∫mero de victorias. </p><br><h2 id="dannye">  Datos </h2><br><p>  Para elaborar el calendario, utilic√© datos sobre el n√∫mero de victorias para cada uno de los 30 equipos de la NBA en las √∫ltimas 15 temporadas.  Se recopilaron de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">stats.nba.com</a> utilizando la extensi√≥n <strong>NBA Data Retriever</strong> , que, mediante el uso de la API NBA, produce archivos csv con las estad√≠sticas necesarias.  Aqu√≠ est√°n los detalles completos de mi proyecto <a href="">en Github</a> . </p><br><h2 id="ispolzuemye-biblioteki">  Bibliotecas utilizadas </h2><br><pre> <code class="plaintext hljs">library(data.table) library(tidyverse) library(gganimate)</code> </pre> <br><p>  Para el procesamiento de datos, uso <code>data.table</code> (simplemente porque conoc√≠ este paquete antes).  Tambi√©n descargo un conjunto de paquetes <code>tidyverse</code> , y no un <code>ggplot2</code> separado para no preocuparme, si durante el an√°lisis aparece alguna idea que requiere la carga adicional de un paquete de este conjunto.  En este caso particular, se puede prescindir de <code>ggplot2</code> , otros paquetes de conjuntos no est√°n involucrados.  Bueno, <code>gganimate</code> pone en movimiento los gr√°ficos. </p><br><h2 id="rabota-s-dannymi">  Trabajar con datos </h2><br><p>  Primero debes poner los datos en orden.  B√°sicamente, para construir gr√°ficos, necesitamos 2 de 79 columnas de una tabla con datos sin procesar.  Puede seleccionar las columnas necesarias primero, puede reemplazar algunos valores primero.  Fui por el segundo camino. </p><br><p>  La tabla en <code>data.table</code> tiene la forma <code>dt[i, j, by]</code> , donde by es "responsable" de la agrupaci√≥n de elementos.  Agrupar√© por la columna TeamName.  Y hay un inconveniente.  Esta columna muestra los nombres de los equipos: Lakers, Celtics, Heat, etc.  Pero durante el per√≠odo bajo revisi√≥n (de la temporada 2004/05) varios equipos cambiaron sus nombres: los New Orleans Hornets se convirtieron en New Orleans Pelicans, Charlotte Bobcats devolvi√≥ el nombre hist√≥rico Charlotte Hornets, y Seattle Supersonics se convirti√≥ en Oklahoma City Thunder.  Esto puede causar confusi√≥n.  Las siguientes conversiones ayudan a evitar esto: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table[TeamCity == "New Orleans" &amp; TeamName == "Hornets", TeamName := "Pelicans"][ TeamCity == "New Orleans/Oklahoma City" &amp; TeamName == "Hornets", TeamName := "Pelicans"][ TeamName == "Bobcats", TeamName := "Hornets"][ TeamName == "SuperSonics", TeamName := "Thunder"]</code> </pre> <br><p>  Para este per√≠odo de tiempo, los cambios son m√≠nimos, pero si lo expande, ser√° muy dif√≠cil agruparlos por TeamName y deber√° usar una columna m√°s confiable.  En estos datos, este es TeamID. </p><br><p>  Para comenzar, nos deshacemos de la informaci√≥n "extra", dejando solo las columnas que necesitamos para trabajar: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[ , .(TeamName, WINS)]</code> </pre> <br><p>  En <code>data.table</code> la construcci√≥n. () Reemplaza la funci√≥n de <code>list</code> .  Una opci√≥n m√°s "cl√°sica" para seleccionar columnas es <code>table1 &lt;- table1[, c("TeamName", "WINS")]</code> .  Despu√©s de eso, la tabla toma la siguiente forma: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre del equipo </th><th>  Gana </th></tr></thead><tbody><tr><td>  Soles </td><td>  62 </td></tr><tr><td>  Calor </td><td>  59 </td></tr><tr><td>  Espuelas </td><td>  59 </td></tr><tr><td>  Pistones </td><td>  54 </td></tr></tbody></table></div><br><p>  Para la animaci√≥n de cada temporada por separado, esto es suficiente, pero para calcular el n√∫mero total de victorias para un per√≠odo seleccionado, debe calcular el total acumulado de victorias. </p><br><p> <code>table1 &lt;- table1[, CumWins := cumsum(WINS), by = "TeamName"]</code> </p> <br><p>  Usando la funci√≥n <code>cumsum</code> obtenemos los n√∫meros que necesitamos.  Usar: = en lugar de = le permite agregar una nueva columna a la tabla; no la sobrescribo con la misma columna CumWins.  <code>by = "TeamName"</code> agrupa los datos por el nombre del equipo y la cantidad acumulada se <code>by = "TeamName"</code> para cada uno de los 30 equipos por separado. </p><br><p>  A continuaci√≥n, agrego una columna con el a√±o en que comenz√≥ cada temporada.  La temporada de la NBA se extiende de octubre a mayo, por lo que se divide en dos a√±os calendario.  En la designaci√≥n de la temporada, el a√±o de su inicio, es decir  Temporada: 2018 en la tabla es la temporada 2018/19 en realidad. </p><br><p>  La tabla original tiene estos datos.  La columna SeasonID muestra una figura en forma de 2 (el a√±o en que comenz√≥ la temporada), por ejemplo, 22004. Puede eliminar los dos primeros utilizando el paquete <code>stringr</code> o las funciones b√°sicas de R, pero fui un poco diferente.  Result√≥ que primero uso esta columna para indicar las estaciones requeridas, luego elimino y creo una columna con fechas nuevamente.  Acciones extra </p><br><p>  Lo hice de la siguiente manera: </p><br><p> <code>table1 &lt;- table1[,year := rep(seq(2004, 2018), each = length(unique(table1$TeamName)))]</code> </p> <br><p>  Tuve la suerte de que durante el per√≠odo de tiempo seleccionado el n√∫mero de equipos en la NBA no cambi√≥, as√≠ que solo repet√≠ los n√∫meros de 2004 a 2018 30 veces.  Nuevamente, si pasas a la historia, este m√©todo ser√° inconveniente debido al hecho de que el n√∫mero de equipos en cada temporada ser√° diferente, por lo que es preferible usar la opci√≥n para borrar la columna SeasonID. </p><br><p>  Luego agregue la columna cumrank. </p><br><p> <code>table1 &lt;- table1[, cumrank := frank(-CumWins, ties.method = "random"), by = "year"]</code> </p> <br><p>  Representa la clasificaci√≥n de los equipos en cada temporada por el n√∫mero de victorias y se utilizar√° como los valores del eje X. <code>frank</code> un an√°logo de <code>data.table</code> m√°s <code>data.table</code> del <code>rank</code> base, menos significa clasificaci√≥n en orden descendente (esto tambi√©n se puede hacer usando el argumento <code>decreasing = TRUE</code> . en qu√© orden ir√°n los equipos con el mismo n√∫mero de victorias, por <code>ties.method = "random"</code> tanto <code>ties.method = "random"</code> . Bueno, todo esto se agrupa en un a√±o. </p><br><p>  Y la √∫ltima conversi√≥n de la tabla est√° agregando la columna <code>value_rel</code> . </p><br><p> <code>table1 &lt;- table1[, value_rel := CumWins/CumWins[cumrank==1], by = "year"]</code> </p> <br><p>  Esta columna considera la relaci√≥n entre el n√∫mero de victorias de cada equipo y el indicador m√°s alto del a√±o.  Para el mejor equipo, este indicador es 1, para el resto es menor, dependiendo del √©xito de la temporada. </p><br><p>  Despu√©s de todas las adiciones, la tabla tiene la siguiente forma: </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre del equipo </th><th>  Gana </th><th>  Cumwins </th><th>  a√±o </th><th>  cumrank </th><th>  valor_rel </th></tr></thead><tbody><tr><td>  Espuelas </td><td>  59 </td><td>  59 </td><td>  2004 </td><td>  3 </td><td>  0.9516129 </td></tr><tr><td>  Espuelas </td><td>  63 </td><td>  122 </td><td>  2005 </td><td>  1 </td><td>  1.0000000 </td></tr><tr><td>  Espuelas </td><td>  58 </td><td>  180 </td><td>  2006 </td><td>  2 </td><td>  0.9729730 </td></tr><tr><td>  Espuelas </td><td>  56 </td><td>  236 </td><td>  2007 </td><td>  1 </td><td>  1.0000000 </td></tr></tbody></table></div><br><p>  Solo se presenta un equipo en la tabla para ilustrar la acumulabilidad.  Todas estas acciones se realizan, como en el cambio de nombre, con una cascada de corchetes </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[ ,.(TeamName, WINS)][ , CumWins := cumsum(WINS), by = "TeamName"][ ,year := rep(seq(2004, 2018), each = length(unique(table1$TeamName)))][ , cumrank := frank(-CumWins, ties.method = "random"), by = "year"][ , value_rel := CumWins/CumWins[cumrank==1], by = "year"]</code> </pre> <br><h2 id="izmenenie-zalivki-stolbcov-so-standartnoy-na-cveta-komand">  Cambie el relleno de las columnas del est√°ndar a los colores de los equipos. </h2><br><p>  Puede proceder inmediatamente a la construcci√≥n de gr√°ficos, pero hay, como me parece, un punto importante: el color de las columnas en el gr√°fico.  Puede dejar la paleta <code>ggplot2</code> est√°ndar, pero esta es una mala opci√≥n.  En primer lugar, me parece que es fea.  Y en segundo lugar, hace que sea dif√≠cil encontrar un equipo en la lista.  Para los fan√°ticos de la NBA, cada equipo est√° asociado con un color espec√≠fico: Boston es verde, Chicago es rojo, Sacramento es p√∫rpura, etc.  Por lo tanto, usar el color del comando en las columnas de relleno ayuda a identificarlo m√°s r√°pido, a pesar de la abundancia de azul y rojo. </p><br><p>  Para hacer esto, cree una tabla <code>table_color</code> con el nombre del comando y su color principal.  Colores tomados de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">teamcolorcodes.com</a> . </p><br><div class="scrollable-table"><table><thead><tr><th>  Nombre del equipo </th><th>  TEAM_color </th></tr></thead><tbody><tr><td>  Halcones </td><td>  # E03A3E </td></tr><tr><td>  Celtas </td><td>  # 007A33 </td></tr><tr><td>  Redes </td><td>  # 000000 </td></tr></tbody></table></div><br><p>  Con la tabla de colores, debe hacer una manipulaci√≥n m√°s.  Porque  Cuando se utilizan factores de trazado, el orden de los equipos cambia.  El primero en la lista ser√° Philadelphia 76, como √∫nico propietario del nombre "digital", y luego de acuerdo con el alfabeto.  Por lo tanto, debemos organizar los colores en el mismo orden y luego extraer el vector que los contiene de la tabla.  Lo hice de la siguiente manera: </p><br><pre> <code class="plaintext hljs"> table_color &lt;- table_color[order(TeamName)] cols &lt;- table_color[, "TEAM_color"]</code> </pre> <br><h2 id="postroenie-grafika">  Trazado </h2><br><p>  Realmente construimos un solo cuadro, que contiene los 450 indicadores de victorias (15 temporadas * 30 equipos), y luego lo "dividimos" por la variable necesaria (en nuestro caso, por a√±os) usando las funciones del paquete <code>gganimate</code> . </p><br><pre> <code class="plaintext hljs">gg &lt;- ggplot(table1, aes(cumrank, group = TeamName, fill = as.factor(TeamName), color = as.factor(TeamName))) + geom_tile(aes(y = CumWins/2, height = CumWins, width = 0.7), color = NA, alpha = 0.8)</code> </pre> <br><p>  Primero, creamos un gr√°fico usando la funci√≥n <code>ggplot</code> .  En el argumento <code>aes</code> , especifique c√≥mo se mostrar√°n las variables de la tabla en el gr√°fico.  Los agrupamos por TeamName, el <code>fill</code> y el <code>color</code> ser√°n responsables del color de las columnas. </p><br><p>  Las columnas verdaderas lo llaman no es del todo cierto.  Usando <code>geom_tile</code> "dividimos" los datos en el gr√°fico en rect√°ngulos.  Aqu√≠ hay un ejemplo de un gr√°fico de este tipo: <br><img src="https://habrastorage.org/getpro/habr/post_images/210/405/916/2104059165b8000275951025c2020b5b.jpg"><br>  Se puede ver c√≥mo el gr√°fico se "divide" en cuadrados (se obtienen de rect√°ngulos usando la capa <code>coord_equal()</code> ), tres en cada columna.  Pero gracias al <code>width</code> argumento menor que uno, nuestro mosaico toma la forma de columnas. </p><br><pre> <code class="plaintext hljs"> geom_text(aes(y = 0, label = paste(TeamName, " ")), vjust = 0.2, hjust = 1, size = 6) + geom_text(aes(y = CumWins, label = paste0(" ",round(CumWins))), hjust = 0, size = 7) + coord_flip(clip = "off", expand = FALSE) + scale_fill_manual(values = cols) + scale_color_manual(values = cols) + scale_y_continuous(labels = scales::comma) + scale_x_reverse() + guides(color = FALSE, fill = FALSE) +</code> </pre> <br><p>  Luego, agrego dos firmas usando <code>geom_text</code> : el nombre del equipo y el n√∫mero de victorias.  <code>coord_flip</code> intercambia los ejes, <code>scale_fill_manual</code> y <code>scale_color_manual</code> cambian el color de las columnas, <code>scale_x_reverse</code> "expande" el eje X. Observe que tomamos los colores del vector <code>cols</code> creado previamente. </p><br><p>  La capa de <code>theme</code> especifica opciones para ajustar la visualizaci√≥n del gr√°fico.  Aqu√≠ se indica c√≥mo deben mostrarse los encabezados y las etiquetas de los ejes (de ninguna manera lo que <code>element_blank</code> nos dice en el lado derecho de la igualdad).  Eliminamos la leyenda, el fondo, el marco, las l√≠neas de cuadr√≠cula a lo largo del eje Y. <code>plot.title</code> argumentos <code>plot.title</code> , <code>plot.subtitle</code> , <code>plot.caption</code> , establecemos las opciones de visualizaci√≥n para el t√≠tulo, subt√≠tulo y firma del gr√°fico.  Para obtener m√°s detalles sobre el significado de todos los par√°metros, consulte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gglot2</a> </p><br><pre> <code class="plaintext hljs">theme(axis.line=element_blank(), axis.text.x=element_blank(), axis.text.y=element_blank(), axis.ticks=element_blank(), axis.title.x=element_blank(), axis.title.y=element_blank(), legend.position="none", panel.background=element_blank(), panel.border=element_blank(), panel.grid.major=element_blank(), panel.grid.minor=element_blank(), panel.grid.major.x = element_line( size=.1, color="grey" ), panel.grid.minor.x = element_line( size=.1, color="grey" ), plot.title=element_text(size=25, hjust=0.5, face="bold", colour="black", vjust=-1), plot.subtitle = element_text(size = 15), plot.caption =element_text(size=15, hjust=0.5, color="black"), plot.background=element_blank(), plot.margin = margin(2,2, 2, 4, "cm"))</code> </pre> <br><h2 id="sozdanie-animacii">  Crear animaci√≥n </h2><br><p>  No me detendr√© en usar la funci√≥n <code>transition_states</code> , esta parte es id√©ntica a mi publicaci√≥n anterior en Habr√©.  En cuanto a los <code>labs</code> crea el t√≠tulo, los subt√≠tulos y la firma del gr√°fico.  El uso de <code>{closest_state}</code> permite mostrar cada a√±o espec√≠fico en el gr√°fico, cuyas columnas estamos viendo actualmente. </p><br><pre> <code class="plaintext hljs"> anim &lt;- gg + transition_states(year, transition_length = 4, state_length = 1) + view_follow(fixed_x = TRUE) + labs(title = "Cumulative Wins by teams in seasons", subtitle = "Season: {closest_state}", caption = "Telegram: @NBAatlantic, Twitter: @vshufiskiy\n Data sourse: stats.nba.com")</code> </pre> <br><h2 id="funkciya-nba_cumulative_wins-dlya-sozdaniya-grafikov">  Funci√≥n <code>nba_cumulative_wins</code> para crear gr√°ficos. </h2><br><p>  Las funciones de escritura simplifican y aceleran el proceso de obtenci√≥n del resultado si necesita usar el c√≥digo m√°s de una vez.  Por lo general, una funci√≥n en R tiene la siguiente forma: </p><br><pre> <code class="plaintext hljs">_ &lt;- function( ) { _ }</code> </pre> <br><p>  Primero debe comprender qu√© par√°metros desea cambiar utilizando la funci√≥n, sus argumentos depender√°n de esto.  El primer argumento es el nombre de la tabla de datos que se est√° ingresando.  Esto le permite cambiarle el nombre si surge ese deseo, sin cambiar nada en la funci√≥n misma.  Tambi√©n quiero que se muestre cualquier n√∫mero de comandos en el gr√°fico: de uno (que no tiene sentido) a 30 (simplemente ya no existe).  Tambi√©n quiero poder considerar cualquier per√≠odo de tiempo dentro de esos 15 a√±os para los cuales tengo datos.  Todo esto se implementa en esta forma de funci√≥n: </p><br><pre> <code class="plaintext hljs">nba_cumulative_wins &lt;- function(table, elements, first_season, last_season){ ... }</code> </pre> <br><p>  donde <code>table</code> es el nombre de la tabla con los datos de entrada, <br>  <code>elements</code> : los nombres de los equipos que deben mostrarse en el gr√°fico <br>  <code>first_season</code> : la primera temporada que se mostrar√° en el gr√°fico <br>  <code>last_season</code> : la √∫ltima temporada que se mostrar√° en el gr√°fico. </p><br><p>  Si el argumento se usa con mucha frecuencia con un valor espec√≠fico, puede configurarlo de manera predeterminada.  Entonces, si se omite entre los argumentos de la funci√≥n, este valor ser√° sustituido.  Por ejemplo, si te registras </p><br><p> <code>nba_cumulative_wins &lt;- function(table, elements, first_season, last_season = 2018)</code> </p> <br><p>  entonces los horarios se construir√°n hasta la temporada 2018/19, a menos que se indique lo contrario. </p><br><h2 id="rabota-s-argumentami-elements-first_season-last_season">  Trabajando con <code>elements</code> argumentos, <code>first_season</code> , <code>last_season</code> </h2><br><p>  Usando el argumento de <code>elements</code> , podemos especificar el nombre de los equipos que queremos ver en el gr√°fico.  Esto es muy conveniente cuando hay 2 o 3 de estos equipos, pero si queremos mostrar toda la liga tendremos que escribir <code>elements = c()</code> y el nombre de los 30 equipos entre par√©ntesis. </p><br><p>  As√≠ que decid√≠ "dividir" los valores de entrada para el argumento de los <code>elements</code> en varios grupos. <br>  La funci√≥n <code>nba_cumulative_wins</code> puede crear gr√°ficos para equipos individuales, divisiones, conferencias o la NBA en su conjunto.  Para esto, utilic√© la siguiente construcci√≥n: </p><br><pre> <code class="plaintext hljs"> select_teams &lt;- unique(table1$TeamName) select_div &lt;- unique(table1$Division) select_conf &lt;- unique(table1$Conference) select_nba &lt;- "NBA" table1 &lt;- if(elements %in% select_teams){ table1[TeamName %in% elements] } else if (elements %in% select_div){ table1[Division %in% elements] } else if(elements %in% select_conf){ table1[Conference %in% elements] } else if(elements == "NBA"){ table1 } else { NULL }</code> </pre> <br><p>  <code>select_</code> vectores simb√≥licos <code>select_</code> contienen los nombres de los 30 equipos, 6 divisiones, 2 conferencias y la NBA, y la funci√≥n <code>unique</code> deja solo un nombre √∫nico, en lugar de 15 (por el n√∫mero de a√±os en los datos). </p><br><p>  Luego, utilizando la <code>if...else</code> , se verifica que el argumento de los <code>elements</code> ingresados ‚Äã‚Äãpertenece a una de las clases ( <code>%in%</code> usa para determinar si el elemento pertenece al vector), y la tabla de datos se modifica en consecuencia.  Ahora, si quiero ver los resultados de los equipos que juegan en la Divisi√≥n Suroeste </p><br><p> <code>elements = c("Mavericks", "Spurs", "Rockets", "Grillies", "Pelicans")</code> </p> <br><p>  solo entra </p><br><p>  <code>elements = "Southwest"</code> , que es mucho m√°s r√°pido y m√°s conveniente. </p><br><p>  Debido a la posibilidad de elegir estaciones, el trabajo con fechas tambi√©n cambia.  Al principio, se agrega la l√≠nea: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[SeasonID &gt;= as.numeric(paste(2, first_season, sep = "")) &amp; SeasonID &lt;= as.numeric(paste(2, last_season, sep = ""))]</code> </pre> <br><p>  As√≠ que dejo en la tabla solo aquellas filas que caen en nuestro intervalo de tiempo elegido.  El c√≥digo para crear la columna del <code>year</code> tambi√©n cambia.  Ahora se ve as√≠: </p><br><pre> <code class="plaintext hljs">table1 &lt;- table1[ ,year := rep(seq(first_season, last_season), each = length(unique(table1$TeamName)))]</code> </pre> <br><p>  En relaci√≥n con la agrupaci√≥n de elementos, el procedimiento para obtener los colores deseados es complicado.  El hecho es que en la tabla <code>table_color</code> solo los nombres de los comandos.  Por lo tanto, necesitamos "desplegar" nuestras contracciones.  Para hacer esto, use la construcci√≥n <code>if...else</code> vez. </p><br><pre> <code class="plaintext hljs"> elements1 &lt;- if (elements == "NBA"){ c("Hawks", "Celtics", "Nets", "Hornets", "Bulls", "Cavaliers", "Mavericks", "Nuggets", "Pistons", "Warriors", "Rockets", "Pacers", "Clippers", "Lakers", "Grizzlies", "Heat", "Bucks", "Timberwolves", "Pelicans", "Knicks", "Thunder", "Magic", "76ers", "Suns", "Trail Blazers","Kings", "Spurs", "Raptors", "Jazz", "Wizards") } else if (elements == "West") { c("Mavericks","Nuggets", "Warriors", "Rockets", "Clippers", "Lakers", "Grizzlies","Timberwolves", "Pelicans", "Thunder", "Suns", "Trail Blazers","Kings", "Spurs", "Jazz") } else if (elements == "East") { c("Hawks", "Celtics", "Nets", "Hornets", "Bulls", "Cavaliers","Pistons", "Pacers", "Heat", "Bucks", "Knicks", "Magic", "76ers", "Raptors", "Wizards") } else if (elements == "Pacific") { c("Warriors", "Clippers", "Lakers", "Suns", "Kings") } else if (elements == "Southeast") { c("Magic", "Hornets", "Heat", "Hawks", "Wizards") } else if (elements == "Southwest") { c("Mavericks", "Grizzlies", "Pelicans", "Rockets", "Spurs") } else if (elements == "Central") { c("Bucks", "Pacers", "Pistons", "Bulls", "Cavaliers") } else if (elements == "Atlantic") { c("Knicks", "Nets", "Celtics", "Raptors", "76ers") } else if (elements == "Northwest") { c("Nuggets", "Trail Blazers", "Jazz", "Thunder", "Suns") } else { elements }</code> </pre> <br><p>  Luego, cree una tabla con los nombres de los comandos que necesitamos, conecte esta tabla a <code>table_color</code> usando la funci√≥n <code>dplyr</code> paquete <code>dplyr</code> .  <code>inner_join</code> incluye solo casos que coinciden en ambas tablas. </p><br><pre> <code class="plaintext hljs"> table_elements1 &lt;- data.table(TeamName = elements1) table_color &lt;- table_color[order(TeamName)] inner_table_color &lt;- inner_join(table_color, table_elements1) cols &lt;- inner_table_color[, "TEAM_color"]</code> </pre> <br><p>  La funci√≥n cambia la ortograf√≠a del t√≠tulo y los subt√≠tulos.  Asumen este aspecto: </p><br><pre> <code class="plaintext hljs">anim &lt;- gg + transition_states(year, transition_length = 4, state_length = 1) + view_follow(fixed_x = TRUE) + labs(title = paste("Cumulative Wins by teams in seasons", first_season, "-", last_season, sep = " "), subtitle = paste(if (elements %in% select_div ){ paste(elements, "Division", sep = " ") } else if (elements %in% select_conf ){ paste("Conference", elements, sep = " ") }, "Season: {closest_state}", sep = " "), caption = "Telegram: @NBAatlantic, Twitter: @vshufiskiy\nData sourse: stats.nba.com")</code> </pre> <br><h2 id="rendering">  Renderizado </h2><br><p>  Adem√°s, todo esto se visualiza. </p><br><pre> <code class="plaintext hljs">animate(anim, nframes = (last_season - first_season + 1) * (length(unique(table1$TeamName)) + 20), fps = 20, width = 1200, height = 1000, renderer = gifski_renderer(paste(elements[1], "cumwins.gif", sep = "_")))</code> </pre> <br><p>  Seleccion√© el n√∫mero en <code>nframes</code> emp√≠ricamente, de modo que dependiendo del n√∫mero de comandos seleccionados, la velocidad aumenta / disminuye. </p><br><h2 id="grafik">  Graph </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e15/803/11d/e1580311d19d5f814b201c32237a3ed5.gif"></p><br><p>  Espero que mi publicaci√≥n sea interesante.  C√≥digo del proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Github</a> . </p><br><p>  Si est√° interesado en el componente deportivo de estas visualizaciones, puede visitar mi blog en sports.ru "A ambos lados del Atl√°ntico" </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458904/">https://habr.com/ru/post/458904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458892/index.html">Sugerencias para vulnerabilidades y protecci√≥n de modelos de aprendizaje autom√°tico</a></li>
<li><a href="../458894/index.html">Las personas t√≠picas y las redes en las que viven.</a></li>
<li><a href="../458896/index.html">JavaScript funcional: ¬øqu√© son las funciones de orden superior y por qu√© son necesarias?</a></li>
<li><a href="../458900/index.html">Cartuchos de consola como m√≥dems</a></li>
<li><a href="../458902/index.html">5 errores comunes de Python para principiantes</a></li>
<li><a href="../458906/index.html">[Ekaterimburgo, anuncio] Flutteron - un taller sobre desarrollo en Flutter</a></li>
<li><a href="../458908/index.html">Escaneo de documentos a trav√©s de la red</a></li>
<li><a href="../458910/index.html">Benchmarking PostgreSQL con grandes p√°ginas de Linux</a></li>
<li><a href="../458912/index.html">Migrar a Zimbra con imapsync</a></li>
<li><a href="../458914/index.html">Qu√© (no) necesitas saber para crear juegos en Unity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>