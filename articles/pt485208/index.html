<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèΩ ‚óºÔ∏è üë≤üèΩ Cria√ß√£o de infraestrutura de TI tolerante a falhas. Parte 2. Instalando e configurando o cluster oVirt 4.3 üëÑ üôèüèæ üë©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo √© uma continua√ß√£o do anterior - ‚Äú Criando uma infraestrutura de TI tolerante a falhas. Parte 1 - preparando a implanta√ß√£o do cluster oVirt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cria√ß√£o de infraestrutura de TI tolerante a falhas. Parte 2. Instalando e configurando o cluster oVirt 4.3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lenvendo/blog/485208/"><p>  Este artigo √© uma continua√ß√£o do anterior - ‚Äú <a href="https://habr.com/ru/company/lenvendo/blog/483980/">Criando uma infraestrutura de TI tolerante a falhas.</a>  <a href="https://habr.com/ru/company/lenvendo/blog/483980/">Parte 1 - preparando a implanta√ß√£o do cluster oVirt 4.3</a> . ‚Äù </p><br><p>  Ele considerar√° o processo de instala√ß√£o e configura√ß√£o b√°sica do cluster oVirt 4.3, para hospedar m√°quinas virtuais altamente acess√≠veis, levando em considera√ß√£o o fato de que todas as etapas preliminares para preparar a infraestrutura j√° foram conclu√≠das. </p><a name="habracut"></a><br><h2 id="vvodnaya-chast">  1. Introdu√ß√£o </h2><br><p>  O objetivo principal do artigo n√£o √© fornecer instru√ß√µes passo a passo do formul√°rio ‚Äú <strong>Pr√≥ximo</strong> -&gt; <strong>Sim</strong> -&gt; <strong>Concluir</strong> ‚Äù, mas mostrar alguns recursos ao instal√°-lo e configur√°-lo.  O processo de implanta√ß√£o do cluster nem sempre pode coincidir com o descrito nele, devido √†s peculiaridades da infraestrutura e do ambiente, mas os princ√≠pios gerais ser√£o os mesmos. </p><br><p>  Do ponto de vista subjetivo, o <a href="https://www.ovirt.org/">oVirt 4.3</a> √© semelhante em funcionalidade ao VMware vSphere vers√£o 5.x, mas √© claro com seus pr√≥prios recursos de configura√ß√£o e opera√ß√£o. </p><br><p>  Para aqueles que est√£o interessados, todas as diferen√ßas entre o RHEV (tamb√©m conhecido como oVirt) e o VMware vSphere podem ser encontradas na Internet, por exemplo <a href="https://www.redhat.com/cms/managed-files/vi-virtualization-vmware-competitive-review-f10106jm-201803_0_0.pdf">aqui</a> , mas ainda observarei algumas de suas diferen√ßas ou semelhan√ßas, conforme o artigo segue. </p><br><p>  Separadamente, gostaria de comparar um pouco de trabalho com redes para m√°quinas virtuais.  O OVirt implementa um princ√≠pio semelhante de gerenciamento de rede para m√°quinas virtuais (a seguir denominado VM), como no VMware vSphere: </p><br><ul><li>  usando a ponte padr√£o do Linux (no VMware - <em>Standard vSwitch</em> ) em execu√ß√£o nos hosts de virtualiza√ß√£o; </li><li>  O uso do Open vSwitch (OVS) (no VMware, <em>Distributed vSwitch</em> ) √© um comutador virtual distribu√≠do que consiste em dois componentes principais: um servidor OVN central e controladores OVN em hosts gerenciados. </li></ul><br><p> Deve-se observar que, devido √† simplicidade da implementa√ß√£o, o artigo descrever√° a configura√ß√£o de rede no oVirt for VMs usando a ponte padr√£o do Linux, que √© a op√ß√£o padr√£o ao usar o hypervisor KVM. </p><br><p>  Nesse sentido, existem v√°rias regras b√°sicas para trabalhar com uma rede em um cluster que s√£o melhores para n√£o violar: </p><br><ul><li>  Todas as configura√ß√µes de rede nos hosts devem ser id√™nticas antes de adicion√°-las ao oVirt, exceto os endere√ßos IP. </li><li>  Depois que o host √© controlado pelo oVirt, √© altamente desencorajado alterar algo nas configura√ß√µes de rede com as m√£os, sem total confian√ßa em suas a√ß√µes, pois o agente oVirt simplesmente reverte-as para as anteriores, ap√≥s reiniciar o host ou o agente. </li><li>  A adi√ß√£o de uma nova rede para a VM, assim como o trabalho com ela, deve ser feita somente no console de gerenciamento oVirt. </li></ul><br><p>  Outro <u>ponto importante</u> - para um ambiente muito cr√≠tico (muito sens√≠vel √† perda de dinheiro), ainda seria recomend√°vel usar suporte pago e usar o <a href="https://access.redhat.com/products/red-hat-virtualization">Red Hat Virtualization 4.3</a> .  Durante a opera√ß√£o do cluster oVirt, pode haver alguns pontos nos quais √© aconselh√°vel obter ajuda qualificada o mais r√°pido poss√≠vel, em vez de lidar com eles voc√™ mesmo. </p><br><p>  E, finalmente, <u>recomenda-se que,</u> antes de implantar o cluster oVirt, se familiarize com a <a href="https://www.ovirt.org/documentation/">documenta√ß√£o oficial</a> para conhecer pelo menos conceitos e defini√ß√µes b√°sicas; caso contr√°rio, ser√° um pouco dif√≠cil ler o artigo. </p><br><p>  Os seguintes documentos s√£o b√°sicos para entender o artigo e os princ√≠pios de opera√ß√£o do cluster oVirt: </p><br><ul><li>  <a href="https://www.ovirt.org/documentation/install-guide/Installation_Guide/">Guia de instala√ß√£o do oVirt</a> </li><li>  <a href="https://www.ovirt.org/documentation/self-hosted/Self-Hosted_Engine_Guide/">Guia do mecanismo auto-hospedado oVirt</a> </li><li>  <a href="https://www.ovirt.org/documentation/admin-guide/administration-guide/">Guia de administra√ß√£o do oVirt</a> <a href="https://www.ovirt.org/documentation/admin-guide/administration-guide/"><br></a> </li></ul><br><p>  O volume n√£o √© muito grande; em uma ou duas horas √© bem poss√≠vel dominar os princ√≠pios b√°sicos e, para f√£s de detalhes, √© recomend√°vel ler a <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/">documenta√ß√£o</a> do <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/">produto para o Red Hat Virtualization 4.3</a> - RHEV e oVirt s√£o essencialmente a mesma coisa. </p><br><p>  Portanto, se todas as configura√ß√µes b√°sicas dos hosts, comutadores e armazenamento forem conclu√≠das, prosseguiremos diretamente para a implanta√ß√£o do oVirt. </p><br><h2 id="chast-2-ustanovka-i-nastroyka-klastera-ovirt-43">  Parte 2. Instalando e configurando o cluster oVirt 4.3 </h2><br><p>  Para facilitar a orienta√ß√£o, listarei as se√ß√µes principais deste artigo, que devem ser executadas por sua vez: </p><br><ol><li>  Instalando o servidor de gerenciamento oVirt </li><li>  Cria√ß√£o de um novo data center </li><li>  Crie um novo cluster </li><li>  Instalando hosts adicionais em um ambiente auto-hospedado </li><li>  Criar √°rea de armazenamento ou dom√≠nios de armazenamento </li><li>  Criar e configurar redes para m√°quinas virtuais </li><li>  Criando uma imagem de instala√ß√£o para implantar uma m√°quina virtual </li><li>  Criando uma m√°quina virtual </li></ol><br><h3 id="ustanovka-upravlyayuschego-servera-ovirt">  Instalando o servidor de gerenciamento oVirt </h3><br><p>  <strong>O servidor de gerenciamento oVirt</strong> √© o elemento mais importante na infraestrutura oVirt, na forma de uma m√°quina virtual, host ou dispositivo virtual que gerencia toda a infraestrutura oVirt. </p><br><p>  Seus an√°logos pr√≥ximos do mundo da virtualiza√ß√£o: </p><br><ul><li>  VMware vSphere - vCenter Server </li><li>  Microsoft Hyper-V - Gerenciador de m√°quinas virtuais do System Center (VMM). </li></ul><br><p>  Para instalar o servidor de gerenciamento oVirt, temos duas op√ß√µes: </p><br><p>  <u>Op√ß√£o 1</u> <br>  Implantando um servidor como uma VM ou host especializado. </p><br><p>  Essa op√ß√£o funciona bem, mas desde que essa VM funcione independentemente do cluster, ou seja,  n√£o est√° sendo executado em nenhum host do cluster como uma m√°quina virtual comum executando o KVM. </p><br><p>  Por que voc√™ n√£o pode implantar uma VM nos hosts de cluster? </p><br><p>  No come√ßo do processo de implanta√ß√£o do servidor de gerenciamento oVirt, temos um dilema: voc√™ precisa instalar a VM de gerenciamento, mas o cluster em si ainda n√£o √©, e, portanto, o que voc√™ pode criar imediatamente?  √â certo instalar o KVM no n√≥ do cluster futuro, criar uma m√°quina virtual nele, por exemplo, com o CentOS OS e implantar o mecanismo oVirt nele.  Isso geralmente pode ser feito por raz√µes de controle completo sobre essa VM, mas essa √© uma inten√ß√£o err√¥nea, pois nesse caso, no futuro, haver√° 100% de problemas com essa VM de controle: </p><br><ul><li>  n√£o pode ser migrado no console oVirt entre os hosts (n√≥s) do cluster; </li><li>  ao migrar usando as ferramentas KVM por <em>meio da migra√ß√£o virsh</em> , essa VM ficar√° inacess√≠vel ao gerenciamento no console oVirt. </li><li>  os hosts de cluster n√£o podem ser trazidos para o <strong>modo de Manuten√ß√£o</strong> se voc√™ migrar esta VM de host para host usando a <em>migra√ß√£o virsh</em> . </li></ul><br><p>  Fa√ßa tudo de acordo com as regras - use o oVirt ou um host separado ou uma VM independente em execu√ß√£o para o servidor de gerenciamento, ou fa√ßa o que est√° escrito na segunda vers√£o. </p><br><p>  <u>Op√ß√£o 2</u> <br>  Instalar o oVirt Engine Appliance no host de cluster que ele gerencia. </p><br><p>  √â essa op√ß√£o que ser√° considerada abaixo, como mais correta e adequada em nosso caso. <br>  Os requisitos para uma VM desse tipo est√£o descritos abaixo, apenas acrescentarei que √© recomend√°vel ter pelo menos dois hosts na infraestrutura na qual a VM de gerenciamento pode ser executada para torn√°-la tolerante a falhas.  Aqui, gostaria de acrescentar que, como j√° escrevi nos coment√°rios do artigo anterior, n√£o consegui <em>dividir</em> o <em>c√©rebro</em> no cluster oVirt a partir de dois hosts, com a capacidade de executar a VM do mecanismo hospedado neles. </p><br><h4 id="ustanovka-ovirt-engine-appliance-na-pervyy-host-klastera">  Instale o oVirt Engine Appliance no primeiro host de cluster </h4><br><p>  Link para a documenta√ß√£o oficial - <a href="https://www.ovirt.org/documentation/self-hosted/Self-Hosted_Engine_Guide/">oVirt Self-Hosted Engine Guide</a> , cap√≠tulo ‚Äú <a href="https://www.ovirt.org/documentation/self-hosted/chap-Deploying_Self-Hosted_Engine.html">Implantando o mecanismo auto-hospedado usando a linha de comando</a> ‚Äù </p><br><p>  O documento indica os pr√©-requisitos que devem ser atendidos antes da implanta√ß√£o da VM do mecanismo hospedado, bem como o processo de instala√ß√£o √© descrito em detalhes; portanto, repeti-la literalmente n√£o faz muito sentido; portanto, focamos em alguns detalhes importantes. </p><br><ul><li>  Antes de iniciar todas as etapas, certifique-se de ativar o suporte √† virtualiza√ß√£o nas configura√ß√µes do BIOS no host. </li><li>  Instale o pacote do instalador do mecanismo hospedado no host: </li></ul><br><pre><code class="plaintext hljs">yum -y install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm yum -y install epel-release yum install screen ovirt-hosted-engine-setup</code> </pre> <br><ul><li>  Iniciamos o procedimento para implantar o oVirt Hosted Engine na tela do host (voc√™ pode sair atrav√©s do Ctrl-A + D, fech√°-lo atrav√©s do Ctrl-D): </li></ul><br><pre> <code class="plaintext hljs">screen hosted-engine --deploy</code> </pre> <br><p>  Se desejar, voc√™ pode iniciar a instala√ß√£o com um arquivo de resposta preparado: </p><br><pre> <code class="plaintext hljs">hosted-engine --deploy --config-append=/var/lib/ovirt-hosted-engine-setup/answers/answers-ohe.conf</code> </pre> <br><ul><li>  Durante a implanta√ß√£o do mecanismo hospedado, especifique todos os par√¢metros necess√°rios: </li></ul><br><pre> <code class="plaintext hljs">-   -  vCPU  vRAM ( 4 vCPU  16 ) -  -    hosted engine  ‚Äì    FC -  LUN   hosted engine -       hosted engine ‚Äì     Local (  PostgreSQL    )  . .</code> </pre> <br><ul><li>  Para instalar uma VM altamente acess√≠vel com um mecanismo hospedado, criamos um n√∫mero de LUN especial de 4 e 150 GB de tamanho no sistema de armazenamento, que foi apresentado aos hosts do cluster - consulte o <a href="https://habr.com/ru/company/lenvendo/blog/483980/">artigo anterior</a> . </li></ul><br><p>  Anteriormente, tamb√©m verificamos sua visibilidade nos hosts: </p><br><pre> <code class="plaintext hljs">multipath -ll ‚Ä¶ 3600a098000e4b4b3000003c95d171065 dm-3 DELL , MD38xxf size=150G features='3 queue_if_no_path pg_init_retries 50' hwhandler='1 rdac' wp=rw |-+- policy='service-time 0' prio=14 status=active | `- 15:0:0:4 sdc 8:32 active ready running `-+- policy='service-time 0' prio=9 status=enabled `- 18:0:0:4 sdj 8:144 active ready running</code> </pre> <br><ul><li>  O processo de implanta√ß√£o do mecanismo hospedado em si n√£o apresenta nada de complicado; no final, devemos obter algo assim: </li></ul><br><pre> <code class="plaintext hljs">[ INFO ] Generating answer file '/var/lib/ovirt-hosted-engine-setup/answers/answers-20191129131846.conf' [ INFO ] Generating answer file '/etc/ovirt-hosted-engine/answers.conf' [ INFO ] Stage: Pre-termination [ INFO ] Stage: Termination [ INFO ] Hosted Engine successfully deployed</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Verificando a disponibilidade dos servi√ßos oVirt no host:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/qv/kd/c8/qvkdc8tkfhqkxar1v13jxt4ozxs.png"></p></div></div><br><p>  Se tudo foi feito corretamente, depois que a instala√ß√£o estiver conclu√≠da, acesse <em><a href="https://ovirt_hostname/ovirt-engine">https: // ovirt_hostname / ovirt-engine</a></em> no computador do administrador usando um navegador da web e clique em [ <strong>Portal de Administra√ß√£o</strong> ]. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de tela ‚ÄúPortal de Administra√ß√£o‚Äù</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/m7/sq/xp/m7sqxpd7qkl3dugl4oj7_5bga5g.png"></p></div></div><br><p>  Depois de inserir o login e a senha (definidos durante a instala√ß√£o) na janela como na captura de tela, chegamos ao painel de controle do Open Virtualization Manager, no qual voc√™ pode executar todas as a√ß√µes com a infraestrutura virtual: </p><br><ol><li>  adicionar data center </li><li>  adicionar e configurar um cluster </li><li>  adicionar hosts e gerenci√°-los </li><li>  adicionar √°reas de armazenamento ou dom√≠nios de armazenamento para discos de m√°quinas virtuais </li><li>  adicionar e configurar redes para m√°quinas virtuais </li><li>  adicione m√°quinas virtuais, imagens de instala√ß√£o, modelos de VM e gerencie-os </li></ol><br><p><img src="https://habrastorage.org/webt/4r/t_/qg/4rt_qg6irvl-mf6bsorclnmr36e.png"></p><br><p>  Todas essas a√ß√µes ser√£o consideradas posteriormente, algo em uma c√©lula grande, algo em mais detalhes e com nuances. <br>  Mas, primeiro, eu recomendaria a leitura deste complemento, que provavelmente muitos podem ser √∫teis. </p><br><p>  <strong>Adi√ß√£o</strong> </p><br><p>  <strong>1)</strong> Em princ√≠pio, se houver tal necessidade, nada o impede de pr√©-instalar o hypervisor KVM nos n√≥s do cluster usando os pacotes <strong><em>libvirt</em></strong> e <strong><em>qemu-kvm</em></strong> (ou <strong><em>qemu-kvm-ev</em></strong> ) da vers√£o desejada, embora, ao implantar o n√≥ do cluster oVirt, ele possa fa√ßa voc√™ mesmo. </p><br><p>  Mas se <strong><em>libvirt</em></strong> e <strong><em>qemu-kvm</em></strong> n√£o foram instalados com a vers√£o mais recente, √© poss√≠vel obter esse erro durante a implanta√ß√£o do mecanismo hospedado: </p><br><pre> <code class="plaintext hljs">error: unsupported configuration: unknown CPU feature: md-clear</code> </pre> <br><p>  I.e.  voc√™ deve ter <a href="https://centos.pkgs.org/7/centos-updates-x86_64/libvirt-4.5.0-10.el7_6.12.x86_64.rpm.html">uma vers√£o atualizada do</a> <strong><em>libvirt</em></strong> com prote√ß√£o <a href="https://wiki.ubuntu.com/SecurityTeam/KnowledgeBase/MDS">MDS</a> que suporte esta pol√≠tica: </p><br><pre> <code class="plaintext hljs">&lt;feature policy='require' name='md-clear'/&gt;</code> </pre> <br><p>  Instale a libvirt v.4.5.0-10.el7_6.12, com suporte ao md-clear: </p><br><pre> <code class="plaintext hljs">yum-config-manager --disable mirror.centos.org_centos-7_7_virt_x86_64_libvirt-latest_ yum install centos-release-qemu-ev yum update yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer libguestfs libguestfs-tools dejavu-lgc-sans-fonts virt-top libvirt libvirt-python libvirt-client systemctl enable libvirtd systemctl restart libvirtd &amp;&amp; systemctl status libvirtd</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Verifique o suporte ao md-clear:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">virsh domcapabilities kvm | grep require &lt;feature policy='require' name='ss'/&gt; &lt;feature policy='require' name='hypervisor'/&gt; &lt;feature policy='require' name='tsc_adjust'/&gt; &lt;feature policy='require' name='clflushopt'/&gt; &lt;feature policy='require' name='pku'/&gt; &lt;feature policy='require' name='md-clear'/&gt; &lt;feature policy='require' name='stibp'/&gt; &lt;feature policy='require' name='ssbd'/&gt; &lt;feature policy='require' name='invtsc'/&gt;</code> </pre> </div></div><br><p>  Depois disso, voc√™ pode continuar a instalar o mecanismo hospedado. </p><br><p>  <strong>2)</strong> No oVirt 4.3, a presen√ßa e o uso do firewall <strong>firewalld</strong> s√£o um pr√©-requisito. </p><br><div class="spoiler">  <b class="spoiler_title">Se durante a implanta√ß√£o da VM para o mecanismo hospedado, recebermos o seguinte erro:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">[ ERROR ] fatal: [localhost]: FAILED! =&gt; {"changed": false, "msg": "firewalld is required to be enabled and active in order to correctly deploy hosted-engine. Please check, fix accordingly and re-deploy.\n"} [ ERROR ] Failed to execute stage 'Closing up': Failed executing ansible-playbook [https://bugzilla.redhat.com/show_bug.cgi?id=1608467</code> </pre> </div></div><br><p>  Ent√£o voc√™ precisa desativar outro firewall (se usado), instalar e executar o <strong>firewalld</strong> : </p><br><pre> <code class="plaintext hljs">yum install firewalld systemctl enable firewalld systemctl start firewalld firewall-cmd --state firewall-cmd --get-default-zone firewall-cmd --get-active-zones firewall-cmd --get-zones</code> </pre> <br><p>  Posteriormente, ao instalar o agente ovirt em um novo host para o cluster, ele configurar√° as portas necess√°rias no <strong>firewalld</strong> automaticamente. </p><br><p>  <strong>3)</strong> Reinicializando um host com uma VM em execu√ß√£o nele com um mecanismo hospedado. </p><br><p>  Como sempre, <a href="https://www.ovirt.org/documentation/self-hosted/chap-Maintenance_and_Upgrading_Resources.html">refer√™ncia 1</a> e <a href="https://www.ovirt.org/documentation/self-hosted/chap-Troubleshooting.html">refer√™ncia 2</a> aos documentos de orienta√ß√£o. </p><br><p>  Todo o gerenciamento do mecanismo hospedado da VM √© feito SOMENTE usando o comando host <strong>-engine</strong> no host em que trabalha, voc√™ precisa esquecer o <strong>virsh</strong> , al√©m do fato de poder se conectar a essa VM via SSH e executar o <strong>comando shutdown</strong> . </p><br><div class="spoiler">  <b class="spoiler_title">O procedimento para colocar a VM no modo de servi√ßo:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">hosted-engine --set-maintenance --mode=global hosted-engine --vm-status !! Cluster is in GLOBAL MAINTENANCE mode !! --== Host host1.test.local (id: 1) status ==-- conf_on_shared_storage : True Status up-to-date : True Hostname : host1.test.local Host ID : 1 Engine status : {"health": "good", "vm": "up", "detail": "Up"} Score : 3400 stopped : False Local maintenance : False crc32 : dee1a774 local_conf_timestamp : 1821 Host timestamp : 1821 Extra metadata (valid at timestamp): metadata_parse_version=1 metadata_feature_version=1 timestamp=1821 (Sat Nov 29 14:25:19 2019) host-id=1 score=3400 vm_conf_refresh_time=1821 (Sat Nov 29 14:25:19 2019) conf_on_shared_storage=True maintenance=False state=GlobalMaintenance stopped=False hosted-engine --vm-shutdown</code> </pre> </div></div><br><p>  Reinicializamos o host com o agente do mecanismo hospedado e fazemos o que precisamos com ele. </p><br><p>  Ap√≥s a reinicializa√ß√£o, verifique o status da VM com o mecanismo hospedado: </p><br><pre> <code class="plaintext hljs">hosted-engine --vm-status</code> </pre> <br><p>  Se nossa VM com mecanismo hospedado n√£o iniciar e se houver erros semelhantes no log de servi√ßo: </p><br><div class="spoiler">  <b class="spoiler_title">Erro no log de servi√ßo:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">journalctl -u ovirt-ha-agent ... Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.hosted_engine.HostedEngine ERROR Failed to start necessary monitors Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.agent.Agent ERROR Traceback (most recent call last):#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/agent.py", line 131, in _run_agent#012 return action(he)#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/agent.py", line 55, in action_proper#012 return he.start_monitoring()#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/hosted_engine.py", line 413, in start_monitoring#012 self._initialize_broker()#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/agent/hosted_engine.py", line 537, in _initialize_broker#012 m.get('options', {}))#012 File "/usr/lib/python2.7/site-packages/ovirt_hosted_engine_ha/lib/brokerlink.py", line 86, in start_monitor#012 ).format(t=type, o=options, e=e)#012RequestError: brokerlink - failed to start monitor via ovirt-ha-broker: [Errno 2] No such file or directory, [monitor: 'ping', options: {'addr': '172.20.32.32'}] Jun 29 14:34:44 host1 journal: ovirt-ha-agent ovirt_hosted_engine_ha.agent.agent.Agent ERROR Trying to restart agent</code> </pre> </div></div><br><p>  Em seguida, conectamos o armazenamento e reiniciamos o agente: </p><br><pre> <code class="plaintext hljs">hosted-engine --connect-storage systemctl restart ovirt-ha-agent systemctl status ovirt-ha-agent hosted-engine --vm-start hosted-engine --vm-status</code> </pre> <br><p>  Depois de iniciar a VM com o mecanismo hospedado, a removemos do modo de manuten√ß√£o: </p><br><div class="spoiler">  <b class="spoiler_title">Procedimento para remover uma VM do modo de manuten√ß√£o:</b> <div class="spoiler_text"><br><pre> <code class="plaintext hljs">hosted-engine --check-liveliness hosted-engine --set-maintenance --mode=none hosted-engine --vm-status --== Host host1.test.local (id: 1) status ==-- conf_on_shared_storage : True Status up-to-date : True Hostname : host1.test.local Host ID : 1 Engine status : {"health": "good", "vm": "up", "detail": "Up"} Score : 3400 stopped : False Local maintenance : False crc32 : 6d1eb25f local_conf_timestamp : 6222296 Host timestamp : 6222296 Extra metadata (valid at timestamp): metadata_parse_version=1 metadata_feature_version=1 timestamp=6222296 (Fri Jan 17 11:40:43 2020) host-id=1 score=3400 vm_conf_refresh_time=6222296 (Fri Jan 17 11:40:43 2020) conf_on_shared_storage=True maintenance=False state=EngineUp stopped=False</code> </pre> </div></div><br><p>  <strong>4)</strong> Removendo o mecanismo hospedado e tudo relacionado a ele. </p><br><p>  √Äs vezes, pode ser necess√°rio remover corretamente um mecanismo hospedado instalado anteriormente - um <a href="https://www.ovirt.org/documentation/self-hosted/chap-Troubleshooting.html">link</a> para um documento de orienta√ß√£o. </p><br><p>  Basta executar o comando no host: </p><br><pre> <code class="plaintext hljs">/usr/sbin/ovirt-hosted-engine-cleanup</code> </pre> <br><p>  Em seguida, exclua pacotes desnecess√°rios, fazendo backup de algumas configura√ß√µes antes disso, se necess√°rio: </p><br><pre> <code class="plaintext hljs">yum autoremove ovirt* qemu* virt* libvirt* libguestfs</code> </pre> <br><h4 id="sozdanie-novogo-datacentra">  Cria√ß√£o de um novo data center </h4><br><p>  Documenta√ß√£o de refer√™ncia - oVirt Administration Guide.  <a href="https://www.ovirt.org/documentation/admin-guide/chap-Data_Centers.html">Cap√≠tulo 4: Data Centers</a> </p><br><p>  Primeiro, definimos o que √© um <strong>data center</strong> (cito a partir da ajuda) - essa √© uma entidade l√≥gica que define um conjunto de recursos usados ‚Äã‚Äãem um ambiente espec√≠fico. </p><br><p>  Um datacenter √© um tipo de cont√™iner que consiste em: </p><br><ul><li>  recursos l√≥gicos na forma de clusters e hosts </li><li>  agrupar recursos de rede na forma de redes l√≥gicas e adaptadores f√≠sicos em hosts, </li><li>  recursos de armazenamento (para discos, modelos, imagens de VM) na forma de √°reas de armazenamento (dom√≠nios de armazenamento). </li></ul><br><p>  Um datacenter pode incluir v√°rios clusters que consistem em v√°rios hosts com m√°quinas virtuais em execu√ß√£o, al√©m de ter v√°rias √°reas de armazenamento associadas a ele. <br>  Pode haver v√°rios data centers, eles trabalham independentemente um do outro.  O Ovirt possui uma separa√ß√£o de poderes por fun√ß√£o, e voc√™ pode configurar as permiss√µes pessoalmente, tanto no n√≠vel do data center quanto em seus elementos l√≥gicos individuais. </p><br><p>  O data center, ou data centers, se houver v√°rios, √© gerenciado a partir de um √∫nico console ou portal administrativo. </p><br><p>  Para criar um datacenter, acesse o portal administrativo e crie um novo datacenter: <br>  <strong>Computa√ß√£o</strong> &gt;&gt; <strong>Data Centers</strong> &gt;&gt; <strong>Novo</strong> </p><br><p>  Como usamos o armazenamento compartilhado no sistema de armazenamento, o tipo de armazenamento deve ser compartilhado: </p><br><div class="spoiler">  <b class="spoiler_title">Captura de tela com o assistente do centro de dados</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/bf/eg/id/bfegid-tcvqsfjjxa1oqzop_9iw.png"></p></div></div><br><p>  Ao instalar uma m√°quina virtual com mecanismo hospedado, por padr√£o, √© criado um datacenter - <strong>Datacenter1</strong> e, se necess√°rio, voc√™ pode alterar o Tipo de Armazenamento para outro. </p><br><p>  Criar um datacenter √© uma tarefa simples, sem nuances complicadas, e todas as a√ß√µes adicionais com ele s√£o descritas na documenta√ß√£o.  Observarei apenas que hosts √∫nicos que possuem apenas armazenamento local (disco) para a VM n√£o podem entrar no datacenter com Tipo de Armazenamento - Compartilhado (voc√™ n√£o pode adicion√°-los) e, para eles, √© necess√°rio criar um datacenter separado, ou seja,  cada host individual com armazenamento local precisa de seu pr√≥prio data center separado. </p><br><h4 id="sozdanie-novogo-klastera">  Crie um novo cluster </h4><br><p>  Link da documenta√ß√£o - Guia de administra√ß√£o do oVirt.  <a href="https://www.ovirt.org/documentation/admin-guide/chap-Clusters.html">Cap√≠tulo 5: Clusters</a> </p><br><p>  Sem detalhes desnecess√°rios, um <strong>cluster</strong> √© um agrupamento l√≥gico de hosts que possuem uma √°rea de armazenamento comum (na forma de unidades compartilhadas em um sistema de armazenamento, como no nosso caso).  Tamb√©m √© desej√°vel que os hosts no cluster sejam id√™nticos em hardware e tenham o mesmo tipo de processador (Intel ou AMD).  √â melhor que os servidores no cluster sejam completamente iguais. </p><br><p>  O cluster faz parte do data center (com um tipo espec√≠fico de armazenamento - <em>Local</em> ou <em>Compartilhado</em> ) e todos os hosts devem necessariamente pertencer a um cluster, dependendo se eles t√™m um armazenamento comum ou n√£o. </p><br><p>  Ao instalar uma m√°quina virtual com mecanismo hospedado no host, por padr√£o, √© criado um <strong>datacenter</strong> - <strong>Datacenter1</strong> , junto com um cluster - <strong>Cluster1</strong> , e no futuro voc√™ pode configurar seus par√¢metros, ativar op√ß√µes adicionais, adicionar hosts a ele etc. </p><br><p>  Como de costume, para obter detalhes sobre todas as configura√ß√µes do cluster, √© recomend√°vel consultar a documenta√ß√£o oficial.  De alguns recursos da configura√ß√£o de cluster, acrescentarei apenas que, ao cri√°-lo, basta configurar apenas os par√¢metros b√°sicos na guia <strong><em>Geral</em></strong> . </p><br><p>  Vou observar os par√¢metros mais importantes: </p><br><ul><li>  <em>Tipo de processador</em> - √© selecionado com base em quais processadores est√£o instalados nos hosts do cluster, de qual fabricante eles s√£o e qual processador nos hosts √© o mais antigo, de modo que, dependendo disso, todas as instru√ß√µes de processador dispon√≠veis no cluster sejam usadas. </li><li>  <em>Tipo de switch</em> - em nosso cluster, usamos apenas a ponte Linux, por isso a selecionamos. </li><li>  <em>Tipo de firewall</em> - tudo fica claro aqui, √© o firewalld, que deve ser ativado e configurado nos hosts. </li></ul><br><div class="spoiler">  <b class="spoiler_title">Captura de tela com par√¢metros de cluster</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/os/vn/qy/osvnqyj3srg8vjpflkdy9l4e84e.png"></p></div></div><br><h4 id="ustanovka-dopolnitelnyh-hostov-v-self-hosted-okruzhenii">  Instalando hosts adicionais em um ambiente auto-hospedado </h4><br><p>  <a href="https://www.ovirt.org/documentation/self-hosted/chap-Installing_Additional_Hosts_to_a_Self-Hosted_Environment.html">Link</a> para a documenta√ß√£o. </p><br><p>  Hosts adicionais para o ambiente Auto-hospedado s√£o adicionados da mesma maneira que um host comum, com o ponto adicional para implantar uma VM com um mecanismo hospedado sendo cumprido - <strong><em>Escolha a a√ß√£o de implanta√ß√£o do mecanismo hospedado</em></strong> &gt;&gt; <strong><em>Implantar</em></strong> .  Como o LUN da VM com o mecanismo hospedado tamb√©m deve ser apresentado ao host adicional, isso significa que esse host pode ser usado, se necess√°rio, para hospedar a VM com o mecanismo hospedado. <br>  Para toler√¢ncia a falhas, √© altamente recomend√°vel que haja pelo menos dois hosts nos quais uma VM de mecanismo hospedada possa ser hospedada. </p><br><p>  No host adicional, desative iptables (se ativado), ative o firewalld </p><br><pre> <code class="plaintext hljs">systemctl stop iptables systemctl disable iptables systemctl enable firewalld systemctl start firewalld</code> </pre> <br><p>  Instale a vers√£o necess√°ria do KVM (se necess√°rio): </p><br><pre> <code class="plaintext hljs">yum-config-manager --disable mirror.centos.org_centos-7_7_virt_x86_64_libvirt-latest_ yum install centos-release-qemu-ev yum update yum install qemu-kvm qemu-img virt-manager libvirt libvirt-python libvirt-client virt-install virt-viewer libguestfs libguestfs-tools dejavu-lgc-sans-fonts virt-top libvirt libvirt-python libvirt-client systemctl enable libvirtd systemctl restart libvirtd &amp;&amp; systemctl status libvirtd virsh domcapabilities kvm | grep md-clear</code> </pre> <br><p>  Instale os reposit√≥rios necess√°rios e o instalador do mecanismo hospedado: </p><br><pre> <code class="plaintext hljs">yum -y install http://resources.ovirt.org/pub/yum-repo/ovirt-release43.rpm yum -y install epel-release yum update yum install screen ovirt-hosted-engine-setup</code> </pre> <br><p>  Em seguida, acesse o <strong><em>console</em></strong> do <strong><em>Open Virtualization Manager</em></strong> , adicione um novo host e fa√ßa tudo passo a passo, conforme est√° escrito na <a href="https://www.ovirt.org/documentation/self-hosted/chap-Installing_Additional_Hosts_to_a_Self-Hosted_Environment.html">documenta√ß√£o</a> . </p><br><p>  Como resultado, ap√≥s adicionar um host adicional, devemos obter aproximadamente uma imagem no console administrativo, como na captura de tela. </p><br><div class="spoiler">  <b class="spoiler_title">Captura de tela do portal administrativo - hosts</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wh/hr/nc/whhrnchajorr5ogqxinvecjdxi0.png"></p></div></div><br><p>  O host no qual a VM do mecanismo hospedado est√° atualmente ativa possui uma coroa de ouro e a inscri√ß√£o ‚Äú <em>Executando a VM do Hosted Engine</em> ‚Äù, o host no qual essa VM pode ser executada, se necess√°rio, √© a inscri√ß√£o ‚Äú <em>Pode executar a VM do Hosted Engine</em> ‚Äù. </p><br><p>  No caso de uma falha do host na qual " <em>Executando a VM do Hosted Engine</em> ", ela ser√° reiniciada automaticamente no segundo host.  Al√©m disso, essa VM pode ser migrada do host ativo para o backup, para manuten√ß√£o. </p><br><p>  <u>Configurar gerenciamento de energia / cercas em hosts oVirt</u> </p><br><p>  Links para documenta√ß√£o: </p><br><ul><li>  Red Hat Virtualization 4.3 -&gt; Refer√™ncia t√©cnica -&gt; <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/technical_reference/chap-power_management">Cap√≠tulo 4. Gerenciamento de energia</a> </li><li>  Guia de administra√ß√£o do oVirt -&gt; <a href="https://www.ovirt.org/documentation/admin-guide/chap-Hosts.html">Cap√≠tulo 7: Hosts</a> </li></ul><br><p>  Embora possa parecer que a adi√ß√£o e a configura√ß√£o do host foram conclu√≠das, isso n√£o √© totalmente verdade. <br>  Para opera√ß√£o normal dos hosts e identifica√ß√£o / elimina√ß√£o de falhas com qualquer um deles, a configura√ß√£o Gerenciamento de energia / cercas √© necess√°ria. </p><br><p>  <strong>Esgrima</strong> , ou gabinete, √© o processo de excluir temporariamente um host com falha ou com falha de um cluster, durante o qual os servi√ßos oVirt nele ou no pr√≥prio host s√£o reiniciados. </p><br><p>  Todos os detalhes sobre as defini√ß√µes e par√¢metros do gerenciamento de energia / cercas s√£o fornecidos, como de costume na documenta√ß√£o, darei apenas um exemplo de como configurar esse par√¢metro importante quando aplicado aos servidores Dell R640 com iDRAC 9. </p><br><ol><li>  Entramos no portal administrativo, clique em <strong>Computar</strong> &gt;&gt; <strong>Hosts,</strong> selecione o host. </li><li>  Clique em <strong>Edit</strong> . </li><li>  Clique na guia <strong>Gerenciamento de energia</strong> . </li><li>  Marque a caixa ao lado da op√ß√£o <strong>Ativar gerenciamento de energia</strong> . </li><li>  <em>Marcamos</em> a caixa ao lado da op√ß√£o de <em>integra√ß√£o</em> do <em>Kdump</em> para que o host n√£o entre no modo de esgrima ao escrever um despejo de <em>mem√≥ria do</em> kernel. </li></ol><br><div class="spoiler">  <b class="spoiler_title">Nota</b> <div class="spoiler_text"><p>  Ap√≥s ativar a integra√ß√£o do Kdump em um host j√° em execu√ß√£o, ele deve ser reinstalado de acordo com o procedimento no Guia de Administra√ß√£o do oVirt -&gt; <a href="https://www.ovirt.org/documentation/admin-guide/chap-Hosts.html">Cap√≠tulo 7: Hosts</a> -&gt; Reinstalando hosts. </p></div></div><br><ol><li>  Opcionalmente, voc√™ pode marcar a <em>caixa de</em> sele√ß√£o <em>Desativar controle de pol√≠tica do gerenciamento de energia</em> se n√£o quisermos que o gerenciamento de energia do host seja controlado pela Pol√≠tica de agendamento do cluster. </li><li>  Clique no bot√£o ( <em>+</em> ) para adicionar um novo dispositivo de gerenciamento de energia; a janela para editar as propriedades do agente ser√° aberta. <br>  Para o iDRAC9, preencha os campos: <br><ul><li>  <em>Endere√ßo</em> - endere√ßo iDRAC9 </li><li>  <em>Nome de usu√°rio / senha</em> - respectivamente login e senha para entrar no iDRAC9 </li><li>  <em>Tipo</em> - drac5 </li><li>  marque <em>Secure</em> </li><li>  adicione as seguintes op√ß√µes: <em>cmd_prompt =&gt;, login_timeout = 30</em> </li></ul></li></ol><br><div class="spoiler">  <b class="spoiler_title">Captura de tela com par√¢metros "Gerenciamento de energia" nas propriedades do host</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/kz/be/ky/kzbekyoxr6cromqq0epltd2cjbo.png"></p></div></div><br><h4 id="sozdanie-oblasti-hraneniya-ili-storage-domains">  Criar √°rea de armazenamento ou dom√≠nios de armazenamento </h4><br><p>  Link da documenta√ß√£o - Guia de administra√ß√£o do oVirt, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Cap√≠tulo 8: Armazenamento</a> . </p><br><p>  <strong>Um dom√≠nio de armazenamento</strong> , ou √°rea de armazenamento, √© um local centralizado para armazenar discos de m√°quina virtual, imagens de instala√ß√£o, modelos e instant√¢neos. </p><br><p>  As √°reas de armazenamento podem ser conectadas a um data center usando v√°rios protocolos, cluster e sistemas de arquivos de rede. </p><br><p>  OVirt possui tr√™s tipos de √°rea de armazenamento: </p><br><ul><li>  <strong>Data Domain</strong> - para armazenar todos os dados associados a m√°quinas virtuais (discos, modelos).  O Data Domain n√£o pode ser compartilhado entre diferentes datacenters. </li><li>  <strong>Dom√≠nio ISO</strong> (tipo de √°rea de armazenamento obsoleta) - para armazenar imagens de instala√ß√£o do SO.  O dom√≠nio ISO pode ser compartilhado entre diferentes datacenters. </li><li>  <strong>Exportar Dom√≠nio</strong> (tipo obsoleto de √°rea de armazenamento) - para armazenamento tempor√°rio de imagens movidas entre datacenters. </li></ul><br><p>  Em nosso caso espec√≠fico, um dom√≠nio de armazenamento do tipo Data Domain usa FCP (protocolo Fibre Channel) para conectar-se a LUNs no sistema de armazenamento. </p><br><p>  Do ponto de vista do oVirt, ao usar sistemas de armazenamento (FC ou iSCSI), cada disco virtual, instant√¢neo ou modelo √© um disco l√≥gico. <br>  Os dispositivos de bloco s√£o montados em uma √∫nica unidade (nos hosts do cluster) usando o Grupo de Volume e, em seguida, divididos usando o LVM em volumes l√≥gicos usados ‚Äã‚Äãcomo discos virtuais para VMs. </p><br><p>  Todos esses grupos e muitos volumes LVM podem ser vistos no host do cluster usando os comandos <strong>vgs</strong> e <strong>lvs</strong> .  Naturalmente, todas as a√ß√µes com esses discos devem ser realizadas apenas no console oVirt, exceto em casos especiais. </p><br><p>  Os discos virtuais para VMs podem ser de dois tipos - QCOW2 ou RAW.  Os discos podem ser <em>finos</em> ou <em>grossos</em> .  Os instant√¢neos s√£o sempre criados como <em>thin</em> . </p><br><p>  A maneira de gerenciar dom√≠nios de armazenamento ou √°reas de armazenamento acessadas via FC √© bastante l√≥gica - para cada disco virtual de uma VM, h√° um volume l√≥gico separado que pode ser gravado em apenas um host.  No caso de conex√µes via FC, o oVirt usa algo como LVM em cluster. </p><br><p>  M√°quinas virtuais localizadas na mesma √°rea de armazenamento podem ser migradas entre hosts pertencentes ao mesmo cluster. </p><br><p>  Como voc√™ pode ver na descri√ß√£o, o cluster no oVirt, como o cluster no VMware vSphere ou no Hyper-V, basicamente significa a mesma coisa - esse √© um agrupamento l√≥gico de hosts, preferencialmente id√™nticos no hardware, e com um armazenamento comum para discos de m√°quinas virtuais. </p><br><p>  Prosseguimos diretamente na cria√ß√£o de uma √°rea de armazenamento de dados (discos VM), pois sem ela o data center n√£o ser√° inicializado. <br>  Deixe-me lembr√°-lo de que todos os LUNs apresentados aos hosts do cluster no armazenamento devem estar vis√≠veis para eles usando o comando " <strong>multipath -ll</strong> ". </p><br><p>  De acordo com a <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">documenta√ß√£o</a> , acesse o portal, acesse <strong><em>Armazenamento</em></strong> &gt;&gt; <strong><em>Dom√≠nios</em></strong> -&gt; <strong><em>Novo Dom√≠nio</em></strong> e siga as instru√ß√µes da se√ß√£o "Adicionando armazenamento FCP". </p><br><p>  Ap√≥s iniciar o assistente, preencha os campos obrigat√≥rios: </p><br><ul><li>  <em>Nome</em> - defina o nome do cluster </li><li>  <em>Fun√ß√£o de Dom√≠nio</em> - Dados </li><li>  <em>Tipo de armazenamento</em> - Fibre Channel </li><li>  <em>Host a usar</em> - selecione o host em que o LUN necess√°rio est√° dispon√≠vel. </li></ul><br><p>  Na lista de LUNs, selecionamos o que precisamos, clique em <em>Adicionar</em> e depois em <em>OK</em> .  Se necess√°rio, voc√™ pode ajustar par√¢metros adicionais da √°rea de armazenamento clicando em <em>Par√¢metros avan√ßados</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Captura de tela do assistente de suplemento "Dom√≠nio de armazenamento"</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/tk/tz/gq/tktzgqwyqioqf45ere-qi2ll6bc.png"></p></div></div><br><p>  De acordo com os resultados do assistente, devemos obter uma nova √°rea de armazenamento e nosso data center deve entrar no status <strong>UP</strong> ou inicializar: </p><br><div class="spoiler">  <b class="spoiler_title">Capturas de tela do data center e √°reas de armazenamento nele:</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/dj/4j/zm/dj4jzmtuzoyu4ustvkcaqxgywoo.png"></p><br><p><img src="https://habrastorage.org/webt/5l/tn/gd/5ltngdb3ipqfrfkkvktqriegwzq.png"></p></div></div><br><h4 id="sozdanie-i-nastroyka-setey-dlya-virtualnyh-mashin">  Criar e configurar redes para m√°quinas virtuais </h4><br><p>  Link da documenta√ß√£o - Guia de administra√ß√£o do oVirt, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Logical_Networks.html">cap√≠tulo 6: Redes l√≥gicas</a> </p><br><p>  Redes ou redes s√£o usadas para agrupar redes l√≥gicas usadas na infraestrutura virtual oVirt. </p><br><p>  Interfaces l√≥gicas, como a ponte Linux, s√£o usadas para interagir com um adaptador de rede em uma m√°quina virtual, com um adaptador f√≠sico no host. </p><br><p>  Para agrupar e dividir o tr√°fego entre redes, as VLANs s√£o configuradas nos comutadores. </p><br><p>         oVirt,     ,   VLAN  ,        ,        . </p><br><p>                <a href="https://habr.com/ru/company/lenvendo/blog/483980/"> </a> ‚Äì    <strong>bond1</strong> ,           oVirt. </p><br><p>     hosted-engine,      ,           ‚Äì <strong>ovritmgmt</strong> ,      . </p><br><p>        <strong>ovritmgmt</strong>   ,    ,      oVirt. </p><br><div class="spoiler"> <b class="spoiler_title">   ovritmgmt</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/li/ym/4o/liym4ottpmognydqgsc7mi3lvfi.png"></p></div></div><br><p>        ,      <strong><em>Network</em></strong> &gt;&gt; <strong><em>Networks</em></strong> &gt;&gt; <strong><em>New</em></strong> ,    <strong><em>General</em></strong>      VLAN,      ¬´ <em>VM Network</em> ¬ª,          . </p><br><div class="spoiler"> <b class="spoiler_title">    VLAN32</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/gx/3x/nd/gx3xndfoeo-cniaf-cjlnjcefq4.png"></p></div></div><br><p>   <strong><em>Cluster</em></strong> ,       <strong>Cluster1</strong> . </p><br><p>     <strong><em>Compute</em></strong> &gt;&gt; <strong><em>Hosts</em></strong> ,      ,   <strong><em>Network interfaces</em></strong> ,    <em>Setup host networks</em> ,       . </p><br><div class="spoiler"> <b class="spoiler_title">  ¬´Setup host networks¬ª</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/l8/87/me/l887meiynekpssdplkxid4_11yo.png"></p></div></div><br><p>  oVirt         ‚Äì  VLAN  BRIDGE. </p><br><div class="spoiler"> <b class="spoiler_title">       :</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">cat ifcfg-bond1 # Generated by VDSM version 4.30.17.1 DEVICE=bond1 BONDING_OPTS='mode=1 miimon=100' MACADDR=00:50:56:82:57:52 ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no cat ifcfg-bond1.432 # Generated by VDSM version 4.30.17.1 DEVICE=bond1.432 VLAN=yes BRIDGE=ovirtvm-vlan432 ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no cat ifcfg-ovirtvm-vlan432 # Generated by VDSM version 4.30.17.1 DEVICE=ovirtvm-vlan432 TYPE=Bridge DELAY=0 STP=off ONBOOT=yes MTU=1500 DEFROUTE=no NM_CONTROLLED=no IPV6INIT=no</code> </pre> </div></div><br><p>   ,     <u> </u>      <strong>ifcfg-bond1.432</strong>  <strong>ifcfg-ovirtvm-vlan432</strong> . </p><br><p>            c hosted engine,      . </p><br><h4 id="sozdanie-ustanovochnogo-obraza-dlya-razvyortyvaniya-virtualnoy-mashiny">        </h4><br><p>    ‚Äî oVirt Administration Guide, <a href="https://www.ovirt.org/documentation/admin-guide/chap-Storage.html">Chapter 8: Storage</a> ,  Uploading Images to a Data Storage Domain. </p><br><p>    ,     ,       ,    , , <a href="https://cobbler.github.io/">Cobbler</a>    . </p><br><p>      ,        oVirt. ,     ISO Domain,     oVirt    ,         Storage domain   . </p><br><p>      <strong>Storage</strong> &gt;&gt; <strong>Disks</strong> &gt;&gt; <strong>Upload</strong> &gt;&gt; <strong>Start</strong> <br>       ISO ,     ,    " <em>Test connection</em> ". </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/mf/f6/mq/mff6mqownqd8xt9zhyesnobmt2y.png"></p></div></div><br><div class="spoiler"> <b class="spoiler_title">    :</b> <div class="spoiler_text"><p> <code>Unable to upload image to disk d6d8fd10-c1e0-4f2d-af15-90f8e636dadc due to a network error. Ensure that ovirt-imageio-proxy service is installed and configured and that ovirt-engine's CA certificate is registered as a trusted CA in the browser. The certificate can be fetched from https://ovirt.test.local/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA`</code> </p> </div></div><br><p>     oVirt  ¬´ <strong>  </strong> ¬ª (Trusted Root CA)    ,    . </p><br><p>     Trusted Root CA,   " <em>Test connection</em> ",  : </p><br><pre> <code class="plaintext hljs">Connection to ovirt-imageio-proxy was successful.</code> </pre> <br><p>     ,      ISO  Storage Domain. </p><br><p>  ,    Storage Domain   Data,         ,      Storage Domain  hosted engine,      . </p><br><div class="spoiler"> <b class="spoiler_title">   ISO  Storage Domain  hosted engine</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/1c/eg/vl/1cegvlrj_jio2lyrw8bzwwxqik0.png"></p></div></div><br><h4 id="sozdanie-virtualnoy-mashiny">    </h4><br><p>   : <br> oVirt Virtual Machine Management Guide ‚Äì&gt; <a href="https://www.ovirt.org/documentation/vmm-guide/chap-Installing_Linux_Virtual_Machines.html">Chapter 2: Installing Linux Virtual Machines <br> Console Clients Resources</a> </p><br><p>    oVirt    ,       .    ,       ,       ‚Äì        .       ‚Äì      -   ,   . </p><br><p>      CentOS 7,       . </p><br><p>    ,   <strong>Compute</strong> &gt;&gt; <strong>Virtual Machines</strong> ,     .     ,   <em></em> .   ,   . </p><br><p>   ,       ,   ,   ,      : </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/b-/ax/5r/b-ax5rq6w4tfzjp26f0x_oassb8.png"></p><br><p><img src="https://habrastorage.org/webt/zf/og/yc/zfogycv0ghsys-pjj6xl4f6uj64.png"></p><br><p><img src="https://habrastorage.org/webt/da/k9/9s/dak99sg1l7ktd-_kujmswznaveq.png"></p><br><p><img src="https://habrastorage.org/webt/ej/ra/rr/ejrarrisp1wubzm2-cdsawkq0kq.png"></p><br><p><img src="https://habrastorage.org/webt/ka/gi/mv/kagimvvhxi2bei9i-n6gp-ozbse.png"></p></div></div><br><p>     ,  ,        . <br>          : </p><br><div class="spoiler"> <b class="spoiler_title">        </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ph/lz/vv/phlzvvb-isibuzvomxhg-ligxtm.png"></p></div></div><br><p>     ,        . </p><br><div class="spoiler"> <b class="spoiler_title">  ,  ¬´Console¬ª</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ay/w8/7h/ayw87h-2eubjlamhixkkap2j2ag.png"></p></div></div><br><p>       , , <a href="https://virt-manager.org/">Virtual Machine Viewer</a> . </p><br><p>         ,       : </p><br><p><img src="https://habrastorage.org/webt/wu/yj/nm/wuyjnmj_wk_qm_hmzffxkrji0dw.png"></p><br><p>     ,   oVirt guest agent: </p><br><pre> <code class="plaintext hljs">yum -y install epel-release yum install -y ovirt-guest-agent-common systemctl enable ovirt-guest-agent.service &amp;&amp; systemctl restart ovirt-guest-agent.service systemctl status ovirt-guest-agent.service</code> </pre> <br><p>  ,    ,    , ..     ,    , oVirt      .           ,   . </p><br><h4 id="zaklyuchenie">  Conclus√£o </h4><br><p> ,     ,  oVirt ‚Äì       ,       ‚Äî      ,    ,    . </p><br><p> -          ,           ,   - ,  ..          ,     , -         .   ‚Äì   ,     ,             . </p><br><p>     ,           : ,  ,  ,     . </p><br><p>           ,       ‚Äî     VyOS      (  ,           oVirt). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485208/">https://habr.com/ru/post/pt485208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485198/index.html">Outra maneira de medir o desempenho dos m√©todos de aplicativo .NET</a></li>
<li><a href="../pt485200/index.html">Confus√£o no in√≠cio: post-mortem na velocidade de lan√ßamento de um aplicativo iOS</a></li>
<li><a href="../pt485202/index.html">Sistema de Supress√£o</a></li>
<li><a href="../pt485204/index.html">Retornar ao topo: por que a capitaliza√ß√£o da Amazon em breve exceder√° US $ 1 trilh√£o</a></li>
<li><a href="../pt485206/index.html">Como o Typecript me decepcionou e vale a pena?</a></li>
<li><a href="../pt485210/index.html">Atirador de zumbis simples no Unity</a></li>
<li><a href="../pt485214/index.html">CLRium # 7: Pr√°tico. Semin√°rio, trabalhos de casa com verifica√ß√£o, orienta√ß√£o</a></li>
<li><a href="../pt485218/index.html">Reservando constantes e ganchos Git em C #</a></li>
<li><a href="../pt485220/index.html">A evolu√ß√£o do Web Application Firewall: dos firewalls aos sistemas de seguran√ßa baseados em nuvem de aprendizado de m√°quina</a></li>
<li><a href="../pt485222/index.html">Como trabalhar com l√≠deres de opini√£o na China? Cinco dicas pr√°ticas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>