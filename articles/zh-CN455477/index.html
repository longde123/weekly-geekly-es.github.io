<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒµ âœï¸ ğŸ‘¨â€ğŸ­ å°†å¯¹è±¡å•ä¾‹æ”¾ç½®åœ¨ROMå’Œé™æ€å˜é‡ä¸­ï¼ˆä»¥Cortex M4å¾®æ§åˆ¶å™¨ä¸ºä¾‹çš„C ++ï¼‰ ğŸ‘¨ğŸ¼â€âœˆï¸ ğŸ’†ğŸ¼ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ å°†å¸¸é‡å­˜å‚¨åœ¨CortexMå¾®æ§åˆ¶å™¨ä¸Šçš„å“ªé‡Œï¼ˆä»¥C ++ IARç¼–è¯‘å™¨ä¸ºä¾‹ï¼‰ ï¼Œè®¨è®ºäº†å¦‚ä½•å°†å¸¸é‡å¯¹è±¡æ”¾ç½®åœ¨ROMä¸­çš„é—®é¢˜ã€‚ ç°åœ¨ï¼Œæˆ‘æƒ³å‘Šè¯‰æ‚¨å¦‚ä½•ä½¿ç”¨å­¤ç«‹ç”Ÿæˆå™¨æ¨¡å¼åœ¨ROMä¸­åˆ›å»ºå¯¹è±¡ã€‚ 


 å¼•è¨€ 
 å…³äºSingletonï¼ˆä»¥ä¸‹ç®€ç§°Singletonï¼‰çš„æ­£é¢å’Œåé¢ï¼Œå·²ç»æœ‰å¾ˆå¤šè‘—ä½œã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å°†å¯¹è±¡å•ä¾‹æ”¾ç½®åœ¨ROMå’Œé™æ€å˜é‡ä¸­ï¼ˆä»¥Cortex M4å¾®æ§åˆ¶å™¨ä¸ºä¾‹çš„C ++ï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455477/"><img src="https://habrastorage.org/webt/4e/6g/sw/4e6gswsjjz0liihmy5ptbivomuu.jpeg" alt="å›¾ç‰‡"><br><br> åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†å¸¸é‡å­˜å‚¨åœ¨CortexMå¾®æ§åˆ¶å™¨ä¸Šçš„å“ªé‡Œï¼ˆä»¥C ++ IARç¼–è¯‘å™¨ä¸ºä¾‹ï¼‰</a> ï¼Œè®¨è®ºäº†å¦‚ä½•å°†å¸¸é‡å¯¹è±¡æ”¾ç½®åœ¨ROMä¸­çš„é—®é¢˜ã€‚ ç°åœ¨ï¼Œæˆ‘æƒ³å‘Šè¯‰æ‚¨å¦‚ä½•ä½¿ç”¨å­¤ç«‹ç”Ÿæˆå™¨æ¨¡å¼åœ¨ROMä¸­åˆ›å»ºå¯¹è±¡ã€‚ <br><a name="habracut"></a><br><br><h3> å¼•è¨€ </h3><br> å…³äºSingletonï¼ˆä»¥ä¸‹ç®€ç§°Singletonï¼‰çš„æ­£é¢å’Œåé¢ï¼Œå·²ç»æœ‰å¾ˆå¤šè‘—ä½œã€‚ å°½ç®¡æœ‰ç¼ºç‚¹ï¼Œä½†å®ƒå…·æœ‰è®¸å¤šæœ‰ç”¨çš„å±æ€§ï¼Œå°¤å…¶æ˜¯åœ¨å¾®æ§åˆ¶å™¨å›ºä»¶çš„ä¸Šä¸‹æ–‡ä¸­ã€‚ <br><br> é¦–å…ˆï¼Œå¯¹äºå¯é çš„å¾®æ§åˆ¶å™¨è½¯ä»¶ï¼Œä¸å»ºè®®åŠ¨æ€åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤æ— éœ€åˆ é™¤å®ƒä»¬ã€‚ é€šå¸¸ï¼Œå¯¹è±¡ä»…åˆ›å»ºä¸€æ¬¡å³å¯ä½¿ç”¨ï¼Œä»è®¾å¤‡å¯åŠ¨åˆ°å…³é—­ä¸€ç›´å­˜åœ¨ã€‚ è¿™æ ·çš„å¯¹è±¡ç”šè‡³å¯èƒ½æ˜¯ä¸€ä¸ªè¿æ¥æœ‰LEDçš„ç«¯å£åˆ†æ”¯ï¼Œå®ƒåªåˆ›å»ºäº†ä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºè¿è¡Œæ—¶è‚¯å®šä¸ä¼šèµ°åˆ°ä»»ä½•åœ°æ–¹ï¼Œæ˜¾ç„¶å¯ä»¥æ˜¯Singletonã€‚ åº”å½“åˆ›å»ºæ­¤ç±»å¯¹è±¡ï¼Œå¹¶ä¸”å¯èƒ½æ˜¯Singletonã€‚ <br><br>  Singletonè¿˜å¯ä»¥å‘æ‚¨ä¿è¯ï¼Œæè¿°ç«¯å£æ”¯è·¯çš„åŒä¸€å¯¹è±¡å¦‚æœåœ¨å¤šä¸ªåœ°æ–¹çªç„¶ä½¿ç”¨ï¼Œå°†ä¸ä¼šè¢«åˆ›å»ºä¸¤æ¬¡ã€‚ <br><br> æˆ‘è®¤ä¸ºï¼ŒSingletonçš„å¦ä¸€ä¸ªæ˜¾ç€ç‰¹æ€§æ˜¯å®ƒçš„æ˜“ç”¨æ€§ã€‚ ä¾‹å¦‚ï¼Œä¸ä¸­æ–­å¤„ç†ç¨‹åºçš„æƒ…å†µä¸€æ ·ï¼Œæœ¬æ–‡ç»“å°¾å¤„çš„ç¤ºä¾‹ã€‚ ä½†ç›®å‰ï¼Œæˆ‘ä»¬å°†ä¸Singletonè‡ªå·±æ‰“äº¤é“ã€‚ <br><br><h3> å•ä¾‹åœ¨RAMä¸­åˆ›å»ºå¯¹è±¡ </h3><br> æ€»çš„æ¥è¯´ï¼Œå·²ç»æœ‰å¾ˆå¤šå…³äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Singletonï¼ˆLonerï¼‰æˆ–é™æ€ç±»çš„æ–‡ç« ã€‚</a> æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‰ä¸ªå•èº«æ¨¡å¼æ—¶ä»£</a> ã€‚ å› æ­¤ï¼Œæˆ‘å°†ä¸å…³æ³¨Singletonæ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯æè¿°å…¶å®ç°çš„æ‰€æœ‰è®¸å¤šé€‰æ‹©ã€‚ ç›¸åï¼Œæˆ‘å°†é‡ç‚¹ä»‹ç»å¯åœ¨å›ºä»¶ä¸­ä½¿ç”¨çš„ä¸¤ä¸ªé€‰é¡¹ã€‚ <br> é¦–å…ˆï¼Œæˆ‘å°†é˜æ˜å¾®æ§åˆ¶å™¨å›ºä»¶ä¸é€šå¸¸çš„å›ºä»¶ä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠä¸ºä»€ä¹ˆè¯¥è½¯ä»¶çš„æŸäº›å•ä¾‹å®ç°è¦æ¯”å…¶ä»–å®ç°â€œæ›´å¥½â€ã€‚ æœ‰äº›æ ‡å‡†æ¥è‡ªå¯¹å›ºä»¶çš„è¦æ±‚ï¼Œæœ‰äº›ä»…æ¥è‡ªæˆ‘çš„ç»éªŒï¼š <br><br><ul><li> åœ¨å›ºä»¶ä¸­ï¼Œä¸å»ºè®®åŠ¨æ€åˆ›å»ºå¯¹è±¡ </li><li> é€šå¸¸åœ¨å›ºä»¶ä¸­ï¼Œå¯¹è±¡æ˜¯é™æ€åˆ›å»ºçš„ï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šè¢«ç ´åã€‚ </li><li> å¥½å§ï¼Œå¦‚æœåœ¨ç¼–è¯‘é˜¶æ®µçŸ¥é“å¯¹è±¡çš„ä½ç½® </li></ul><br> åŸºäºè¿™äº›å‡è®¾ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä»¬è€ƒè™‘äº†å…·æœ‰é™æ€åˆ›å»ºå¯¹è±¡çš„ä¸¤ä¸ªç‰ˆæœ¬çš„Singletonï¼Œä¹Ÿè®¸æœ€è‘—åå’Œæœ€å¸¸è§çš„æ˜¯Meyers Singletonï¼Œå°½ç®¡C ++æ ‡å‡†åº”è¯¥æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æ˜¯å›ºä»¶çš„ç¼–è¯‘å™¨ä½¿å®ƒåƒè¿™æ ·ï¼ˆä¾‹å¦‚IARï¼‰ï¼Œä»…åœ¨å¯ç”¨ç‰¹æ®Šé€‰é¡¹æ—¶ï¼š <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> T &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T instance ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance ; } Singleton() = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; Singleton(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; } ;</code> </pre> <br> å®ƒä½¿ç”¨å»¶è¿Ÿåˆå§‹åŒ–ï¼Œå³ å¯¹è±¡çš„åˆå§‹åŒ–ä»…åœ¨ç¬¬ä¸€æ¬¡<code>GetInstance()</code>æ—¶å‘ç”Ÿï¼›å°†å…¶è§†ä¸ºåŠ¨æ€åˆå§‹åŒ–ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   Timer1      auto&amp; objRef = Singleton&lt;Timer1&gt;::GetInstance(); //  ,      auto&amp; objRef1 = Singleton&lt;Timer1&gt;::GetInstance(); return 0; }</span></span></code> </pre> <br> è€ŒSingletonæ— éœ€å»¶è¿Ÿåˆå§‹åŒ–ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> T &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance ; } Singleton() = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; Singleton(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T instance ; <span class="hljs-comment"><span class="hljs-comment">//      } ;</span></span></code> </pre> <br> ä¸¤ä¸ªSingletonéƒ½åœ¨RAMä¸­åˆ›å»ºå¯¹è±¡ï¼ŒåŒºåˆ«åœ¨äºç¬¬äºŒä¸ªåœ¨ç¨‹åºå¯åŠ¨åç«‹å³è¿›è¡Œåˆå§‹åŒ–ï¼Œç¬¬ä¸€ä¸ªåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è¿›è¡Œäº†åˆå§‹åŒ–ã€‚ <br><br> å¦‚ä½•åœ¨ç°å®ç”Ÿæ´»ä¸­ä½¿ç”¨å®ƒä»¬ã€‚ æ ¹æ®æ—§çš„ä¼ ç»Ÿï¼Œæˆ‘å°†å°è¯•ä»¥LEDä¸ºä¾‹æ¥è¯´æ˜è¿™ä¸€ç‚¹ã€‚ å› æ­¤ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç±»<code>Led1</code>çš„å¯¹è±¡ï¼Œå®ƒå®é™…ä¸Šåªæ˜¯ç±»<code>Pin&lt;PortA, 5&gt;</code>çš„åˆ«åï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortA = Port&lt;GpioaBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led1 = Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GreenLed = Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; Led1 myLed ; <span class="hljs-comment"><span class="hljs-comment">//        RAM constexpr GreenLed greenLed ; //        ROM int main() { static GreenLed myGreenLed ; //     RAM Led1 led1; //     myGreenLed.Toggle(); led1.Toggle() ; }</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">ä»¥é˜²ä¸‡ä¸€ï¼ŒPortå’ŒPinç±»çœ‹èµ·æ¥åƒè¿™æ ·</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> OdrAddrShift = <span class="hljs-number"><span class="hljs-number">20U</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> addr&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Port</span></span></span><span class="hljs-class"> {</span></span> __<span class="hljs-function"><span class="hljs-function">forceinline </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Toggle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bit)</span></span></span><span class="hljs-function"> </span></span>{ *<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>*&gt;(addr ) ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit) ; } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pinNum&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pin</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">// Singleton   ,     friend class Singleton&lt;Pin&gt; ; public: __forceinline inline void Toggle() const { T::Toggle(pinNum) ; } //  = const Pin &amp; operator=(const Pin &amp;) = delete ; private: // ,      constexpr Pin() {} ; //  ,      //   ,      constexpr Pin(const Pin &amp;) = default ; } ;</span></span></code> </pre> <br></div></div><br> åœ¨è¯¥ç¤ºä¾‹ä¸­ï¼Œæˆ‘åœ¨RAMå’ŒROMä¸­åˆ›å»ºäº†å¤šè¾¾4ä¸ªç›¸åŒç±»å‹çš„ä¸åŒå¯¹è±¡ï¼Œå®ƒä»¬å®é™…ä¸Šä¸ç«¯å£Açš„ç›¸åŒè¾“å‡ºä¸€èµ·ä½¿ç”¨ã€‚åœ¨è¿™é‡Œä¸æ˜¯å¾ˆå¥½ï¼š <br> å¥½å§ï¼Œç¬¬ä¸€ä»¶äº‹æ˜¯æˆ‘æ˜¾ç„¶å¿˜è®°äº†<code>GreenLed</code>å’Œ<code>GreenLed</code>æ˜¯ç›¸åŒçš„ç±»å‹ï¼Œå¹¶åˆ›å»ºäº†å‡ ä¸ªç›¸åŒçš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡åœ¨ä¸åŒçš„â€‹â€‹åœ°å€å¤„å ç”¨äº†ç©ºé—´ã€‚ å®é™…ä¸Šï¼Œæˆ‘ä»€è‡³å¿˜è®°äº†æˆ‘å·²ç»åˆ›å»ºäº†<code>GreenLed</code>å’Œ<code>GreenLed</code>å…¨å±€å¯¹è±¡ï¼Œå¹¶ä¸”è¿˜åœ¨æœ¬åœ°åˆ›å»ºäº†å®ƒä»¬ã€‚ <br><br> å…¶æ¬¡ï¼Œä¸€èˆ¬ä¸æ¬¢è¿å£°æ˜å…¨å±€å¯¹è±¡ï¼Œ <br><br><div class="spoiler">  <b class="spoiler_title">æ›´å¥½åœ°è¿›è¡Œç¼–è¯‘å™¨ä¼˜åŒ–çš„ç¼–ç¨‹å‡†åˆ™</b> <div class="spoiler_text">  <i>æ¨¡å—å±€éƒ¨å˜é‡ï¼ˆå£°æ˜ä¸ºé™æ€çš„å˜é‡ï¼‰ä¼˜å…ˆäº</i> <i><br></i>  <i>å…¨å±€å˜é‡ï¼ˆéé™æ€ï¼‰ã€‚</i>  <i>è¿˜åº”é¿å…è·å–ç»å¸¸è®¿é—®çš„é™æ€å˜é‡çš„åœ°å€ã€‚</i> <i><br></i> </div></div><br> å’Œå±€éƒ¨å¯¹è±¡ä»…åœ¨mainï¼ˆï¼‰å‡½æ•°çš„èŒƒå›´å†…å¯ç”¨ã€‚ <br><br> å› æ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨Singletoné‡å†™æ­¤ç¤ºä¾‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> PortA = Port&lt;GpioaBaseAddr&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Led1 = Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> GreenLed = Pin&lt;PortA, <span class="hljs-number"><span class="hljs-number">5</span></span>&gt; ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        GreenLed //   GreenLed&amp; myGreenLed = Singleton&lt;GreenLed&gt;::GetInstance(); //            Led1&amp; led1 = Singleton&lt;Led1&gt;::GetInstance(); myGreenLed.Toggle() ; led1.Toggle() ; //  , Singleton&lt;Led1&gt;::GetInstance().Toggle() }</span></span></code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ— è®ºæˆ‘å¿˜è®°ä»€ä¹ˆï¼Œæˆ‘çš„é“¾æ¥å°†å§‹ç»ˆæŒ‡å‘åŒä¸€å¯¹è±¡ã€‚ è€Œä¸”æˆ‘å¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•ä½ç½®ï¼Œä»¥ä»»ä½•æ–¹æ³•ï¼ˆåŒ…æ‹¬ä¾‹å¦‚åœ¨ä¸­æ–­å¤„ç†ç¨‹åºçš„é™æ€æ–¹æ³•ä¸­ï¼‰è·å¾—æ­¤é“¾æ¥ï¼Œä½†ç¨åä¼šä»‹ç»æ›´å¤šã€‚ å…¬å¹³åœ°è¯´ï¼Œæˆ‘å¿…é¡»è¯´ä»£ç ä»€ä¹ˆä¹Ÿä¸åšï¼Œå¹¶ä¸”ç¨‹åºé€»è¾‘ä¸­çš„é”™è¯¯æ²¡æœ‰æ¶ˆå¤±ã€‚ å¥½å§ï¼Œè®©æˆ‘ä»¬æ‰¾å‡ºç”±Singletonåˆ›å»ºçš„é™æ€å¯¹è±¡é€šå¸¸ä½äºä½•å¤„ä»¥åŠå¦‚ä½•å®šä½ä»¥åŠå¦‚ä½•å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Ÿ <br><br><h3> é™æ€ç‰©ä½“ </h3><br> åœ¨å‘ç°ä¹‹å‰ï¼Œæœ€å¥½å…ˆäº†è§£ä»€ä¹ˆæ˜¯é™æ€å¯¹è±¡ã€‚ <br><br> å¦‚æœä½¿ç”¨staticå…³é”®å­—å£°æ˜ç±»æˆå‘˜ï¼Œåˆ™æ„å‘³ç€ç±»æˆå‘˜æ ¹æœ¬ä¸ä¸ç±»å®ä¾‹ç›¸å…³è”ï¼Œå®ƒä»¬æ˜¯è‡ªå˜é‡ï¼Œæ‚¨å¯ä»¥åœ¨ä¸åˆ›å»ºç±»å¯¹è±¡çš„æƒ…å†µä¸‹è®¿é—®æ­¤ç±»å­—æ®µã€‚ ä»å‡ºç”Ÿåˆ°å‘è¡Œè¯¥ç¨‹åºï¼Œéƒ½æ²¡æœ‰å¨èƒåˆ°ä»–ä»¬çš„ç”Ÿå‘½ã€‚ <br><br> å½“åœ¨å¯¹è±¡å£°æ˜ä¸­ä½¿ç”¨æ—¶ï¼Œé™æ€è¯´æ˜ç¬¦ä»…ç¡®å®šå¯¹è±¡çš„ç”Ÿå­˜æœŸã€‚ ç²—ç•¥åœ°è¯´ï¼Œæ­¤ç±»å¯¹è±¡çš„å†…å­˜åœ¨ç¨‹åºå¯åŠ¨æ—¶åˆ†é…ï¼Œå¹¶åœ¨ç¨‹åºç»“æŸæ—¶é‡Šæ”¾ï¼›å¯åŠ¨æ—¶ï¼Œä¹Ÿä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚ å¼‚å¸¸åªæ˜¯å±€éƒ¨é™æ€å¯¹è±¡ï¼Œå°½ç®¡å®ƒä»¬ä»…åœ¨ç¨‹åºç»“æŸæ—¶â€œæ­»â€ï¼Œä½†å®é™…ä¸Šæ˜¯â€œå‡ºç”Ÿçš„â€ï¼Œæˆ–è€…è¯´ï¼Œæ˜¯åœ¨å®ƒä»¬ç¬¬ä¸€æ¬¡é€šè¿‡å£°æ˜æ—¶è¢«åˆå§‹åŒ–çš„ã€‚ <br><br><blockquote> åœ¨ç¬¬ä¸€æ¬¡é€šè¿‡å…¶å£°æ˜æ—¶ï¼Œé¦–æ¬¡æ‰§è¡Œå¸¦æœ‰é™æ€å­˜å‚¨çš„å±€éƒ¨å˜é‡çš„åŠ¨æ€åˆå§‹åŒ–ã€‚ è¿™æ ·çš„å˜é‡åœ¨å®Œæˆå…¶åˆå§‹åŒ–åè¢«è§†ä¸ºå·²åˆå§‹åŒ–ã€‚ å¦‚æœä¸€ä¸ªçº¿ç¨‹åœ¨å¦ä¸€ä¸ªçº¿ç¨‹åˆå§‹åŒ–æ—¶é€šè¿‡å˜é‡å£°æ˜ï¼Œåˆ™å®ƒå¿…é¡»ç­‰å¾…åˆå§‹åŒ–å®Œæˆã€‚ </blockquote><br> åœ¨ä»¥ä¸‹è°ƒç”¨ä¸­ï¼Œä¸ä¼šå‘ç”Ÿåˆå§‹åŒ–ã€‚ ä»¥ä¸Šæ‰€æœ‰å†…å®¹éƒ½å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªçŸ­è¯­ï¼Œ <u>åªæœ‰é™æ€å¯¹è±¡çš„ä¸€ä¸ªâ€‹â€‹å®ä¾‹å¯ä»¥å­˜åœ¨ã€‚</u> <br><br> è¿™ç§å›°éš¾å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šåœ¨å›ºä»¶ä¸­ä½¿ç”¨å±€éƒ¨é™æ€å˜é‡å’Œå¯¹è±¡å°†å¯¼è‡´é¢å¤–çš„å¼€é”€ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test1</span></span></span><span class="hljs-class">{</span></span> Test1(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value): j(value) {} <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j; } ; <span class="hljs-function"><span class="hljs-function">Test1 &amp;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Test1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">10</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> test; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; ++i) { foo().j ++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br> åœ¨è¿™é‡Œï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨<code>foo()</code>å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨å¿…é¡»æ£€æŸ¥æœ¬åœ°é™æ€å¯¹è±¡<code>test1</code>æ˜¯å¦å°šæœªåˆå§‹åŒ–ï¼Œå¹¶è°ƒç”¨<code>Test1(10)</code>å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œåœ¨ç¬¬äºŒ<code>Test1(10)</code>åç»­éå†ä¸­ï¼Œå¿…é¡»ç¡®ä¿è¯¥å¯¹è±¡å·²è¢«åˆå§‹åŒ–å¹¶è·³è¿‡æ­¤æ­¥éª¤ã€‚ç›´æ¥<code>return test</code> ã€‚ <br><br> ä¸ºæ­¤ï¼Œç¼–è¯‘å™¨åªéœ€<code>foo()::static guard for test 0x00100004 0x1 Data Lc main.o</code>æ·»åŠ ä¸€ä¸ªé™„åŠ ä¿æŠ¤æ ‡å¿—<code>foo()::static guard for test 0x00100004 0x1 Data Lc main.o</code>ç„¶åæ’å…¥éªŒè¯ä»£ç ã€‚ åœ¨é™æ€å˜é‡çš„ç¬¬ä¸€ä¸ªå£°æ˜ä¸­ï¼Œæœªè®¾ç½®æ­¤ä¿æŠ¤æ ‡å¿—ï¼Œå› æ­¤å¿…é¡»é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°æ¥åˆå§‹åŒ–è¯¥å¯¹è±¡;åœ¨ä¸‹ä¸€éä¸­ï¼Œæ­¤æ ‡å¿—å·²ç»è®¾ç½®ï¼Œå› æ­¤ä¸å†éœ€è¦åˆå§‹åŒ–å¹¶ä¸”è·³è¿‡æ„é€ å‡½æ•°è°ƒç”¨ã€‚ æ­¤å¤–ï¼Œæ­¤æ£€æŸ¥å°†åœ¨forå¾ªç¯ä¸­è¿ç»­æ‰§è¡Œã€‚ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/gb/aq/r1/gbaqr1fpbmihpghun28epsnvoou.png"></a> <br><br> è€Œä¸”ï¼Œå¦‚æœå¯ç”¨äº†å¯ä»¥ä¿è¯åœ¨å¤šçº¿ç¨‹åº”ç”¨ç¨‹åºä¸­è¿›è¡Œåˆå§‹åŒ–çš„é€‰é¡¹ï¼Œåˆ™å°†æœ‰æ›´å¤šçš„ä»£ç ...ï¼ˆè¯·å‚è§æ©™è‰²åº•åˆ’çº¿æ‰€ç¤ºçš„åœ¨åˆå§‹åŒ–æœŸé—´æ•è·å’Œé‡Šæ”¾èµ„æºçš„è°ƒç”¨ï¼‰ <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/webt/rq/5y/ko/rq5ykodk6pngj1esrz8bgx5-79u.png" alt="å›¾ç‰‡"></a> <br><br> å› æ­¤ï¼Œåœ¨å›ºä»¶ä¸­ä½¿ç”¨é™æ€å˜é‡æˆ–å¯¹è±¡çš„ä»·æ ¼å¢åŠ äº†RAMå¤§å°å’Œä»£ç å¤§å°ã€‚ åœ¨å¼€å‘æ—¶è¦ç‰¢è®°å’Œè€ƒè™‘è¿™ä¸€äº‹å®å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚ <br><br> å¦ä¸€ä¸ªç¼ºç‚¹æ˜¯ä¿æŠ¤æ ‡å¿—ä¸é™æ€å˜é‡ä¸€èµ·è¯ç”Ÿï¼Œå®ƒçš„ç”Ÿå­˜æœŸç­‰äºé™æ€å¯¹è±¡çš„ç”Ÿå­˜æœŸï¼Œå®ƒæ˜¯ç”±ç¼–è¯‘å™¨æœ¬èº«åˆ›å»ºçš„ï¼Œå¹¶ä¸”åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ— æ³•è®¿é—®å®ƒã€‚ å³ å¦‚æœç”±äºæŸç§åŸå› çªç„¶ <br><br><div class="spoiler">  <b class="spoiler_title">çœ‹åˆ°éšæœºå´©æºƒ</b> <div class="spoiler_text"> éšæœºè¯¯å·®çš„åŸå› æ˜¯ï¼šï¼ˆ1ï¼‰è¡°å˜è¿‡ç¨‹äº§ç”Ÿçš„alphaç²’å­ï¼›ï¼ˆ2ï¼‰ä¸­å­ï¼›ï¼ˆ3ï¼‰å¤–éƒ¨ç”µç£è¾å°„æºï¼›ï¼ˆ4ï¼‰å†…éƒ¨ä¸²æ‰°ã€‚ <br></div></div><br> å¦‚æœæ ‡å¿—ä»1å˜ä¸º0ï¼Œåˆ™å°†å†æ¬¡è°ƒç”¨åˆå§‹å€¼åˆå§‹åŒ–ã€‚ è¿™ä¸å¥½ï¼Œè¿˜å¿…é¡»ç‰¢è®°ã€‚ æ€»ç»“é™æ€å˜é‡ï¼š <br><blockquote> å¯¹äºä»»ä½•é™æ€å¯¹è±¡ï¼ˆæ— è®ºæ˜¯å±€éƒ¨å˜é‡è¿˜æ˜¯ç±»å±æ€§ï¼‰ï¼Œå†…å­˜éƒ½ä¼šåˆ†é…ä¸€æ¬¡ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æ›´æ”¹ã€‚ <br><br> å±€éƒ¨é™æ€å˜é‡åœ¨ç¬¬ä¸€æ¬¡é€šè¿‡å˜é‡å£°æ˜æ—¶è¿›è¡Œåˆå§‹åŒ–ã€‚ <br><br> é™æ€ç±»å±æ€§ä»¥åŠé™æ€å…¨å±€å˜é‡åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨åç«‹å³åˆå§‹åŒ–ã€‚ æ­¤å¤–ï¼Œæ­¤é¡ºåºæœªå®šä¹‰ </blockquote> ç°åœ¨å›åˆ°è¾›æ ¼å°”é¡¿ã€‚ <br><br><h3>  ROMä¸­çš„å•ä¾‹æ”¾ç½®å¯¹è±¡ </h3><br> ä»ä»¥ä¸Šæ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œå¯¹äºæˆ‘ä»¬æ¥è¯´ï¼ŒSingleton Mayerså¯èƒ½å…·æœ‰ä»¥ä¸‹ç¼ºç‚¹ï¼šé¢å¤–çš„RAMå’ŒROMæˆæœ¬ï¼Œä¸å—æ§åˆ¶çš„å®‰å…¨æ ‡å¿—ä»¥åŠç”±äºåŠ¨æ€åˆå§‹åŒ–è€Œæ— æ³•åœ¨ROMä¸­æ”¾ç½®å¯¹è±¡ã€‚ <br><br> ä½†æ˜¯ä»–æœ‰ä¸€ä¸ªå¥‡å¦™çš„ä¼˜ç‚¹ï¼šæ‚¨å¯ä»¥æ§åˆ¶å¯¹è±¡çš„åˆå§‹åŒ–æ—¶é—´ã€‚ åªæœ‰å¼€å‘äººå‘˜è‡ªå·±åœ¨éœ€è¦<code>GetInstance()</code>ç¬¬ä¸€æ¬¡è°ƒç”¨<code>GetInstance()</code> ã€‚ <br><br> è¦æ‘†è„±å‰ä¸‰ä¸ªç¼ºç‚¹ï¼Œä½¿ç”¨å®ƒå°±è¶³å¤Ÿäº† <br><br><div class="spoiler">  <b class="spoiler_title">å•ä¾‹ï¼Œæ— éœ€å»¶è¿Ÿåˆå§‹åŒ–</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enable</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Singleton(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; Singleton&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; Singleton() = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> T&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T instance ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Enable</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class">&lt;T,Enable&gt;:</span></span>:instance ;</code> </pre><br></div></div><br> å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰å¦ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ— æ³•æ§åˆ¶<code>instance</code>å¯¹è±¡çš„åˆå§‹åŒ–æ—¶é—´ï¼Œæˆ‘ä»¬å¿…é¡»ä»¥æŸç§æ–¹å¼æä¾›éå¸¸é€æ˜çš„åˆå§‹åŒ–ã€‚ ä½†è¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç°åœ¨ä¸å†èµ˜è¿°ã€‚ <br><br> å¯ä»¥é‡åšæ­¤Singletonï¼Œä»¥ä¾¿åœ¨ç¼–è¯‘æ—¶å¯¹è±¡çš„åˆå§‹åŒ–æ˜¯å®Œå…¨é™æ€çš„ï¼Œå¹¶ä¸”ä½¿ç”¨<code>static constexpr T instance</code>è€Œä¸æ˜¯<code>static T instance</code>åœ¨ROMä¸­åˆ›å»º<code>T</code>å¯¹è±¡çš„<code>static T instance</code> ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">constexpr</span></span></span><span class="hljs-function"> T &amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance ; } Singleton() = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; Singleton(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Singleton&lt;T&gt; &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-comment"><span class="hljs-comment">// constexpr  constexpr   //           T static constexpr T instance{T()}; } ; template&lt;typename T&gt; constexpr T Singleton&lt;T&gt;::instance ;</span></span></code> </pre><br> åœ¨è¿™é‡Œï¼Œå¯¹è±¡çš„åˆ›å»ºå’Œåˆå§‹åŒ–å°†åœ¨ç¼–è¯‘é˜¶æ®µç”±ç¼–è¯‘å™¨æ‰§è¡Œï¼Œå¹¶ä¸”è¯¥å¯¹è±¡å°†å±äº.readonlyæ®µã€‚ çš„ç¡®ï¼Œç±»æœ¬èº«å¿…é¡»æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼š <br><blockquote><ul><li> æ­¤ç±»çš„å¯¹è±¡çš„åˆå§‹åŒ–å¿…é¡»æ˜¯é™æ€çš„ã€‚  ï¼ˆæ„é€ å‡½æ•°å¿…é¡»æ˜¯constexprï¼‰ </li><li> è¯¥ç±»å¿…é¡»å…·æœ‰constexprå¤åˆ¶æ„é€ å‡½æ•° </li><li> ç±»å¯¹è±¡çš„ç±»æ–¹æ³•ä¸åº”æ›´æ”¹ç±»å¯¹è±¡çš„æ•°æ®ï¼ˆæ‰€æœ‰constæ–¹æ³•ï¼‰ </li></ul></blockquote><br> ä¾‹å¦‚ï¼Œæ­¤é€‰é¡¹å¾ˆæœ‰å¯èƒ½ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">friend</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class">&lt;A&gt;;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> A &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> A &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> test2.Get(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Set</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ test.SetB(v); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: B&amp; test; <span class="hljs-comment"><span class="hljs-comment">//    RAM const C&amp; test2; //    ROM //      constexpr A(const A &amp;) = default ; //     RAM  ROM,  Singleton constexpr A() : test(Singleton&lt;B&gt;::GetInstance()), test2(Singleton&lt;C&gt;::GetInstance()) { } }; int main() { //      ROM auto&amp; myObject = Singleton&lt;A&gt;::GetInstance() ; //           myObject.Set(myObject.Get()) ; cout&lt;&lt;"Singleton&lt;A&gt; - address: "&lt;&lt; &amp;myObject &lt;&lt;std::endl; }</span></span></code> </pre><br> å¤ªå¥½äº†ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Singletonåœ¨ROMä¸­åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯å¦‚æœæŸäº›å¯¹è±¡åº”è¯¥åœ¨RAMä¸­æ€ä¹ˆåŠï¼Ÿ æ˜¾ç„¶ï¼Œæ‚¨éœ€è¦ä»¥æŸç§æ–¹å¼ä¿ç•™Singletonçš„ä¸¤ä¸ªä¸“ä¸šåŒ–ï¼Œä¸€ä¸ªä¸“é—¨ç”¨äºRAMå¯¹è±¡ï¼Œå¦ä¸€ä¸ªä¸“é—¨ç”¨äºROMä¸­çš„å¯¹è±¡ã€‚ æ‚¨å¯ä»¥é€šè¿‡è¾“å…¥ï¼ˆä¾‹å¦‚ï¼‰åº”æ”¾ç½®åœ¨ROMåŸºç±»ä¸­çš„æ‰€æœ‰å¯¹è±¡æ¥æ‰§è¡Œæ­¤æ“ä½œï¼š <br><br><div class="spoiler">  <b class="spoiler_title">Singletonåœ¨ROMå’ŒRAMä¸­åˆ›å»ºå¯¹è±¡çš„ä¸“ä¸šåŒ–</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,     ROM class RomObject{}; //  ROM  template&lt;typename T&gt; class Singleton&lt;T, typename std::enable_if_t&lt;std::is_base_of&lt;RomObject, T&gt;::value&gt;&gt; { public: Singleton(const Singleton&amp;) = delete; Singleton&amp; operator = (const Singleton&amp;) = delete; Singleton() = delete; static constexpr const T&amp; GetInstance() { return instance; } private: static constexpr T instance{T()}; }; template&lt;typename T&gt; constexpr T Singleton&lt;T, typename std::enable_if_t&lt;std::is_base_of&lt;RomObject, T&gt;::value&gt;&gt;::instance ; //  RAM  template&lt;typename T, class Enable = void&gt; class Singleton { public: Singleton(const Singleton&amp;) = delete; Singleton&amp; operator = (const Singleton&amp;) = delete; Singleton() = delete; constexpr static T&amp; GetInstance() { return instance; } private: static T instance ; }; template&lt;typename T, class Enable&gt; T Singleton&lt;T,Enable&gt;::instance ;</span></span></code> </pre><br></div></div><br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥è¿™æ ·ä½¿ç”¨å®ƒä»¬ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      RAM,   SetB()    (j) class B { friend class Singleton&lt;B&gt;; public: const B &amp; operator=(const B &amp;) = delete ; void SetB(int value) { j = value ; } private: // ,        B(const B &amp;) = default ; B() = default; int j = 0; } //      ROM class A: public RomObject{ friend class Singleton&lt;A&gt;; public: const A &amp; operator=(const A &amp;) = delete ; int Get() const { return test2.Get(); } //     B,    void Set(int v) const { test.SetB(v); } private: B&amp; test; //    RAM const C&amp; test2; //    ROM //        A(const A &amp;) = default ; //     RAM  ROM,  Singleton constexpr A() : test(Singleton&lt;B&gt;::GetInstance()), test2(Singleton&lt;C&gt;::GetInstance()) { } }; int main() { //      ROM auto&amp; romObject = Singleton&lt;A&gt;::GetInstance() ; //    B  RAM auto&amp; ramObject = Singleton&lt;B&gt;::GetInstance() ; //           ramObject.SetB(romObject.Get()) ; cout&lt;&lt;"Singleton&lt;A&gt; - address: "&lt;&lt; &amp;romObject &lt;&lt;std::endl; cout&lt;&lt;"Singleton&lt;B&gt; - address: "&lt;&lt; &amp;ramObject &lt;&lt;std::endl; }</span></span></code> </pre> <br> æ‚¨å¦‚ä½•åœ¨ç°å®ç”Ÿæ´»ä¸­ä½¿ç”¨æ­¤ç±»Singletonã€‚ <br><br><h3> å•ä¾‹ç¤ºä¾‹ </h3><br> æˆ‘å°†åœ¨å®šæ—¶å™¨å’ŒLEDçš„æ“ä½œç¤ºä¾‹ä¸­å°è¯•æ˜¾ç¤ºè¿™ä¸€ç‚¹ã€‚ ä»»åŠ¡å¾ˆç®€å•ï¼Œä½¿è®¡æ—¶å™¨ä¸Šçš„LEDé—ªçƒã€‚ å¯ä»¥è®¾ç½®è®¡æ—¶å™¨ã€‚ <br><br> å·¥ä½œåŸç†å¦‚ä¸‹ï¼Œå½“è°ƒç”¨ä¸­æ–­æ—¶ï¼Œå°†è°ƒç”¨è®¡æ—¶å™¨çš„<code>OnInterrupt()</code>æ–¹æ³•ï¼Œåè€…åˆå°†é€šè¿‡ç”¨æˆ·æ¥å£è°ƒç”¨LEDåˆ‡æ¢æ–¹æ³•ã€‚ <br><br> æ˜¾ç„¶ï¼ŒLEDå¯¹è±¡å¿…é¡»ä½äºROMä¸­ï¼Œå› ä¸ºæ²¡æœ‰å¿…è¦åœ¨RAMä¸­åˆ›å»ºå¯¹è±¡ï¼Œå› æ­¤ç”šè‡³æ²¡æœ‰æ•°æ®ã€‚ åŸåˆ™ä¸Šï¼Œæˆ‘å·²ç»åœ¨ä¸Šé¢è¿›è¡Œäº†æè¿°ï¼Œå› æ­¤åªéœ€å°†<code>RomObject</code>ç»§æ‰¿<code>RomObject</code>æ·»åŠ <code>RomObject</code> ï¼Œåˆ¶ä½œconstexpræ„é€ å‡½æ•°ï¼Œè¿˜ç»§æ‰¿ç”¨äºå¤„ç†è®¡æ—¶å™¨äº‹ä»¶çš„æ¥å£ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">LEDç‰©ä½“</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      class ITimerSubscriber { public: virtual void OnTimeOut() const = 0; } ; template &lt;typename T, std::uint8_t pinNum&gt; class Pin: public RomOject, public ITimerSubscriber { // Singleton   ,     friend class Singleton&lt;Pin&gt; ; public: __forceinline inline void Toggle() const { T::Toggle(pinNum) ; } //       __forceinline inline void OnTimeOut() const override { Toggle() ; } //  = const Pin &amp; operator=(const Pin &amp;) = delete ; private: // ,      constexpr Pin() = default ; Pin(const Pin &amp;) = default ; } ;</span></span></code> </pre> </div></div><br> ä½†æ˜¯ï¼Œæˆ‘å°†é€šè¿‡ä¸€äº›è¿å•å°†Timerä¸“é—¨ç”¨äºRAMï¼Œå°†å­˜å‚¨æŒ‡å‘<code>TIM_TypeDef</code>ç»“æ„çš„é“¾æ¥ï¼Œä¸€ä¸ªå¥ç‚¹å’Œä¸€ä¸ªè®¢æˆ·çš„é“¾æ¥ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­é…ç½®Timerï¼ˆå°½ç®¡å¯ä»¥å°†Timerä¹Ÿæ”¾å…¥ROMï¼‰ï¼š <br><br><div class="spoiler">  <b class="spoiler_title">ä¸Šè¯¾è®¡æ—¶å™¨</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Timer &amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Timer &amp;) = <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPeriod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> value)</span></span></span><span class="hljs-function"> </span></span>{ period = value ; timer.PSC = TimerClockSpeed / <span class="hljs-number"><span class="hljs-number">1000U</span></span> - <span class="hljs-number"><span class="hljs-number">1U</span></span> ; timer.ARR = value ; } <span class="hljs-comment"><span class="hljs-comment">//      __forceinline inline void OnInterrupt() { if ((timer.SR &amp; TIM_SR_UIF) &amp;&amp; (timer.DIER &amp; TIM_DIER_UIE)) { //   ,     OnTimeOut //       Toggle() subscriber-&gt;OnTimeOut() ; timer.SR &amp;=~ TIM_SR_UIF ; } } //    TimeOut  ,   ITimerSubscriber,   __forceinline inline void Subscribe(const ITimerSubscriber&amp; obj) { subscriber = &amp;obj ; } inline void Start() { timer.CR1 |= TIM_CR1_URS ; timer.DIER |= TIM_DIER_UIE ; SetPeriod(period) ; timer.CR1 &amp;=~TIM_CR1_OPM ; timer.EGR |= TIM_EGR_UG ; timer.CR1 |= TIM_CR1_CEN ; } protected: // ,         explicit Timer(TIM_TypeDef&amp; tim): timer{tim} {}; const ITimerSubscriber * subscriber = nullptr ; TIM_TypeDef&amp; timer ; std::uint16_t period = 1000; } ;</span></span></code> </pre> <br></div></div><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       class BlinkTimer: public Timer { friend class Singleton&lt;BlinkTimer&gt; ; public: const BlinkTimer &amp; operator=(const BlinkTimer &amp;) = delete ; private: BlinkTimer(const BlinkTimer &amp;) = default ; inline BlinkTimer(): Timer{*TIM2} { } } ; int main() { BlinkTimer &amp; blinker = Singleton&lt;BlinkTimer&gt;::GetInstance() ; using Led1 = Pin&lt;PortA, 5&gt; ; // Led1,   ROM,      blinker.Subscribe(Singleton&lt;Led1&gt;::GetInstance()) ; blinker.Start() ; }</span></span></code> </pre><br> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œç±»<code>BlinkTimer</code>çš„å¯¹è±¡ä½äºRAMä¸­ï¼Œè€Œç±»<code>BlinkTimer</code>çš„å¯¹è±¡ä½äºROMä¸­ã€‚ ä»£ç ä¸­æ²¡æœ‰å¤šä½™çš„å…¨å±€å¯¹è±¡ã€‚ åœ¨éœ€è¦ç±»å®ä¾‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬åªéœ€ä¸ºè¯¥ç±»è°ƒç”¨<code>GetInstance()</code> <br><br> ä»ç„¶éœ€è¦åœ¨ä¸­æ–­å‘é‡è¡¨ä¸­æ·»åŠ ä¸­æ–­å¤„ç†ç¨‹åºã€‚ åœ¨è¿™é‡Œï¼Œä½¿ç”¨Singletonéå¸¸æ–¹ä¾¿ã€‚ åœ¨è´Ÿè´£å¤„ç†ä¸­æ–­çš„ç±»çš„é™æ€æ–¹æ³•ä¸­ï¼Œå¯ä»¥è°ƒç”¨åŒ…è£…åœ¨Singletonä¸­çš„å¯¹è±¡çš„æ–¹æ³•ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __iar_program_start(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InterruptHandler</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DummyHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) {} } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Timer2Handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   BlinkTimer Singleton&lt;BlinkTimer&gt;::GetInstance().OnInterrupt(); } }; using tIntFunct = void(*)(); using tIntVectItem = union {tIntFunct __fun; void * __ptr;}; #pragma segment = "CSTACK" #pragma location = ".intvec" const tIntVectItem __vector_table[] = { { .__ptr = __sfe( "CSTACK" ) }, //    __iar_program_start, //      InterruptHandler::DummyHandler, InterruptHandler::DummyHandler, InterruptHandler::DummyHandler, InterruptHandler::DummyHandler, InterruptHandler::DummyHandler, 0, 0, 0, 0, InterruptHandler::DummyHandler, InterruptHandler::DummyHandler, 0, InterruptHandler::DummyHandler, InterruptHandler::DummyHandler, //External Interrupts InterruptHandler::DummyHandler, //Window Watchdog InterruptHandler::DummyHandler, //PVD through EXTI Line detect/EXTI16 .... InterruptHandler::Timer2Handler, //      BlinkTimer InterruptHandler::DummyHandler, //TIM3 ... InterruptHandler::DummyHandler, //SPI 5 global interrupt }; extern "C" void __cmain(void) ; extern "C" __weak void __iar_init_core(void) ; extern "C" __weak void __iar_init_vfp(void) ; #pragma required = __vector_table void __iar_program_start(void) { __iar_init_core() ; __iar_init_vfp() ; __cmain() ; }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">æœ‰å…³è¡¨æœ¬èº«çš„ä¸€äº›çŸ¥è¯†ï¼Œå®ƒå¦‚ä½•å·¥ä½œï¼š</b> <div class="spoiler_text"> ä¸Šç”µåæˆ–å¤ä½åï¼Œå¤ä½ç«‹å³ä¸­æ–­ï¼Œ <i>ç¼–å·ä¸º-8</i> ï¼Œåœ¨è¯¥è¡¨ä¸­ä¸ºé›¶å…ƒç´ ï¼Œæ ¹æ®å¤ä½ä¿¡å·ï¼Œç¨‹åºåˆ‡æ¢åˆ°é›¶å…ƒç´ å‘é‡ï¼Œé¦–å…ˆåˆå§‹åŒ–å †æ ˆé¡¶éƒ¨çš„æŒ‡é’ˆã€‚ è¯¥åœ°å€å–è‡ªæ‚¨åœ¨é“¾æ¥å™¨è®¾ç½®ä¸­é…ç½®çš„STACKæ®µçš„ä½ç½®ã€‚ æŒ‡é’ˆåˆå§‹åŒ–ä¹‹åï¼Œç«‹å³è¿›å…¥ç¨‹åºå…¥å£ç‚¹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½äº<code>__iar_program_start</code>å‡½æ•°çš„åœ°å€ã€‚ æ¥ä¸‹æ¥ï¼Œåˆå§‹åŒ–ä»£ç ä»¥åˆå§‹åŒ–å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå¹¶ä½¿ç”¨æµ®ç‚¹åˆå§‹åŒ–åå¤„ç†å™¨ï¼ˆå¦‚æœè®¾ç½®ä¸­åŒ…å«äº†æµ®ç‚¹ï¼‰ï¼Œä¾æ­¤ç±»æ¨ã€‚ å¦‚æœå‘ç”Ÿä¸­æ–­ï¼Œåˆ™ä¸­æ–­æ§åˆ¶å™¨é€šè¿‡è¡¨ä¸­çš„ä¸­æ–­å·è½¬åˆ°ä¸­æ–­å¤„ç†ç¨‹åºçš„åœ°å€ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯<code>InterruptHandler::Timer2Handler</code> ï¼Œå®ƒé€šè¿‡Singletonè°ƒç”¨äº†æˆ‘ä»¬çš„é—ªçƒè®¡æ—¶å™¨çš„<code>OnInterrupt()</code>æ–¹æ³•ï¼Œè€Œè¯¥æ–¹æ³•åˆ<code>OnTimeOut()</code>ç«¯å£æ”¯è·¯çš„<code>OnTimeOut()</code>æ–¹æ³•ã€‚ <br></div></div><br> å…¶å®ä»…æ­¤è€Œå·²ï¼Œæ‚¨å¯ä»¥è¿è¡Œè¯¥ç¨‹åºã€‚  IAR 8.40çš„ä¸€ä¸ªæœ‰æ•ˆç¤ºä¾‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°±åœ¨è¿™é‡Œ</a> ã€‚ <br> åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ‰¾åˆ°</a>å¯¹ROMå’ŒRAMä¸­çš„å¯¹è±¡ä½¿ç”¨Singletonçš„æ›´è¯¦ç»†çš„ç¤ºä¾‹ã€‚ <br><br> æ–‡æ¡£é“¾æ¥ï¼š <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GOST R mek61508-7â€”2012</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">EWARMçš„C / C ++å¼€å‘æŒ‡å—</a> </li></ul><br>  PSåœ¨æ–‡ç« å¼€å¤´çš„å›¾ç‰‡ä¸­ï¼Œéƒ½ä¸€æ ·ï¼ŒSingletonä¸æ˜¯ROMï¼Œè€Œæ˜¯WHISKEYã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN455477/">https://habr.com/ru/post/zh-CN455477/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN455467/index.html">å¦‚æœæ‚¨ä¸æ˜¯åœ¨ç¼–å†™ç¨‹åºï¼Œè¯·ä¸è¦ä½¿ç”¨ç¼–ç¨‹è¯­è¨€</a></li>
<li><a href="../zh-CN455469/index.html">æˆä¸ºä¸€ä¸ªå®Œæ•´çš„å †æ ˆè€Œä¸æ˜¯</a></li>
<li><a href="../zh-CN455471/index.html">ç»“åˆä½¿ç”¨Google Analyticsï¼ˆåˆ†æï¼‰å’ŒRï¼ˆMichal Brysï¼‰</a></li>
<li><a href="../zh-CN455473/index.html">TypeScriptä¸­çš„æ³›å‹ï¼šèšåœ¨ä¸€èµ·</a></li>
<li><a href="../zh-CN455475/index.html">é£Ÿå“è®¾è®¡æ–‡æ‘˜ï¼Œ2019å¹´5æœˆ</a></li>
<li><a href="../zh-CN455479/index.html">æˆ‘ä»¬å¦‚ä½•å®ç°ä»Jetpackå¯¼èˆªåˆ°æˆ˜æ–—åº”ç”¨çš„å¯¼èˆªã€‚ Yandexé£Ÿå“æŠ¥å‘Š</a></li>
<li><a href="../zh-CN455481/index.html">å…³äºé‡ç”Ÿç‹©çŒçš„ä¸‰ä¸ªæ•…äº‹</a></li>
<li><a href="../zh-CN455483/index.html">è‰¾è¾¾ï¼ˆAi-Daï¼‰è‰ºæœ¯å®¶ï¼šäººå½¢æœºå™¨äººä¸ºå…¶é¦–æ¬¡ä¸ªå±•åšå‡†å¤‡</a></li>
<li><a href="../zh-CN455485/index.html">Check Pointè„šæœ¬-ç›´æ¥ä»Smart Consoleæ‰§è¡Œè„šæœ¬</a></li>
<li><a href="../zh-CN455487/index.html">åŸ¹è®­Cisco 200-125 CCNA v3.0ã€‚ ç¬¬10å¤©ã€‚äº¤æ¢æœºç«¯å£æ“ä½œæ¨¡å¼</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>