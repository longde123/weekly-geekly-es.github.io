<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👴🏾 🐑 🚶🏼 Keamanan Helm 🧜 💴 🚴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Inti dari cerita tentang pengelola paket paling populer untuk Kubernetes dapat diwakili dengan bantuan emoji: 



- kotaknya adalah Helm (ini adalah y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Keamanan Helm</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/462665/">  Inti dari cerita tentang pengelola paket paling populer untuk Kubernetes dapat diwakili dengan bantuan emoji: <br><br><ul><li>  kotaknya adalah Helm (ini adalah yang paling cocok yang ada di rilis terbaru Emoji); </li><li>  kunci - keamanan; </li><li>  manusia adalah solusi untuk masalah tersebut. </li></ul><br><img src="https://habrastorage.org/webt/7f/e6/f2/7fe6f2dsslbuogltyajqyhcm3x4.jpeg"><br><br>  Faktanya, semuanya akan sedikit lebih rumit, dan ceritanya penuh dengan rincian teknis tentang <b>cara membuat Helm aman</b> . <br><br><ul><li>  Secara singkat, apa itu Helm jika Anda tidak tahu atau lupa.  Masalah apa yang dipecahkan dan di mana letaknya di ekosistem. </li><li>  Pertimbangkan arsitektur Helm.  Tidak ada satu percakapan tentang keamanan dan bagaimana membuat alat atau solusi lebih aman dapat dilakukan tanpa memahami arsitektur komponen. </li><li>  Mari kita bahas komponen Helm. </li><li>  Masalah paling membara adalah masa depan - versi baru dari Helm 3. </li></ul><br>  Segala sesuatu dalam artikel ini berkaitan dengan Helm 2. Versi ini sekarang dalam produksi dan kemungkinan besar Anda yang menggunakannya sekarang, dan di sanalah ada risiko keamanan. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_8zNTJ1_R5I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <strong>Tentang pembicara:</strong> Alexander Khayorov ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">allexx</a> ) telah berkembang selama 10 tahun, membantu meningkatkan konten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Moscow Python Conf ++,</a> dan bergabung dengan komite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Helm Summit</a> .  Saat ini bekerja di Chainstack dalam posisi pemimpin pengembangan - ini adalah hibrida antara manajer pengembangan dan orang yang bertanggung jawab atas pengiriman rilis final.  Artinya, terletak di situs permusuhan, di mana semuanya terjadi dari penciptaan produk hingga operasinya. <br><br>  Chainstack adalah startup kecil yang tumbuh aktif, yang tugasnya adalah untuk memberikan pelanggan kesempatan untuk melupakan infrastruktur dan kesulitan mengoperasikan aplikasi terdesentralisasi, tim pengembangan berlokasi di Singapura.  Jangan meminta Chainstack untuk menjual atau membeli cryptocurrency, tetapi tawarkan untuk berbicara tentang kerangka kerja blockchain perusahaan, dan mereka akan dengan senang hati menjawab Anda. <br><br><h2>  Helm </h2><br>  Ini adalah manajer paket (grafik) untuk Kubernetes.  Cara paling intuitif dan serbaguna untuk membawa aplikasi ke kluster Kubernetes. <br><br><img src="https://habrastorage.org/webt/0h/4j/np/0h4jnpvzc7hlncvlzprx9hfkz9s.jpeg"><br><br>  Ini, tentu saja, adalah tentang pendekatan yang lebih struktural dan industri daripada membuat manifestasi YAML Anda sendiri dan menulis utilitas kecil. <br><br><blockquote>  Helm adalah yang terbaik yang tersedia dan populer saat ini. </blockquote><br>  Mengapa helm?  Terutama karena didukung oleh CNCF.  Cloud Native - organisasi besar, adalah perusahaan induk untuk proyek Kubernetes, dll, Fluentd dan lainnya. <br><br>  Fakta penting lainnya, Helm adalah proyek yang sangat populer.  Ketika pada Januari 2019 saya hanya berencana untuk berbicara tentang cara membuat Helm aman, proyek ini memiliki seribu bintang di GitHub.  Pada Mei ada 12 ribu dari mereka. <br><br>  Banyak orang tertarik pada Helm, oleh karena itu, bahkan jika Anda masih tidak menggunakannya, Anda akan membutuhkan pengetahuan tentang keamanannya.  <strong>Keamanan itu penting.</strong> <br><br>  Tim inti Helm didukung oleh Microsoft Azure, dan oleh karena itu ini adalah proyek yang cukup stabil tidak seperti yang lain.  Rilis Helm 3 Alpha 2 pada pertengahan Juli menunjukkan bahwa cukup banyak orang yang mengerjakan proyek ini, dan mereka memiliki keinginan dan kekuatan untuk mengembangkan dan meningkatkan Helm. <br><br><img src="https://habrastorage.org/webt/c8/m1/ex/c8m1exaajnjbhme9yh_gjqw_y00.jpeg"><br><br>  Helm memecahkan beberapa masalah manajemen aplikasi root di Kubernetes. <br><br><ul><li>  Kemasan aplikasi.  Bahkan aplikasi seperti "Hello, World" di WordPress sudah terdiri dari beberapa layanan, dan saya ingin mengemasnya bersama. </li><li>  Pengelolaan kompleksitas yang muncul dengan pengelolaan aplikasi ini. </li><li>  Siklus hidup yang tidak berakhir setelah instalasi atau penyebaran aplikasi.  Itu terus hidup, perlu diperbarui, dan Helm membantu dalam hal ini dan berusaha untuk membawa langkah-langkah dan kebijakan yang tepat untuk ini. </li></ul><br>  <strong>Pengemasan</strong> diatur dengan cara yang dapat dimengerti: ada metadata sesuai sepenuhnya dengan pekerjaan manajer paket reguler untuk Linux, Windows atau MacOS.  Yaitu, repositori, tergantung pada berbagai paket, meta-informasi untuk aplikasi, pengaturan, fitur konfigurasi, pengindeksan informasi, dll. Semua Helm ini memungkinkan Anda untuk mendapatkan dan menggunakan untuk aplikasi. <br><br>  <strong>Manajemen kompleksitas</strong> .  Jika Anda memiliki banyak aplikasi serupa, maka Anda perlu parameterisasi.  Templat mengikuti dari ini, tetapi agar tidak muncul dengan cara Anda sendiri membuat templat, Anda dapat menggunakan apa yang ditawarkan Helm di luar kotak. <br><br>  <strong>Manajemen siklus hidup aplikasi</strong> - menurut pendapat saya, ini adalah masalah yang paling menarik dan belum terselesaikan.  Inilah sebabnya saya datang ke Helm tepat waktu.  Kami perlu memantau siklus hidup aplikasi, kami ingin mentransfer CI / CD dan siklus aplikasi ke paradigma ini. <br><br>  Helm memungkinkan Anda untuk: <br><br><ul><li>  mengelola penyebaran, memperkenalkan konsep konfigurasi dan revisi; </li><li>  berhasil mengembalikan; </li><li>  gunakan kait untuk acara yang berbeda; </li><li>  Tambahkan cek aplikasi tambahan dan tanggapi hasilnya. </li></ul><br>  Selain itu <strong>, Helm memiliki "baterai"</strong> - sejumlah besar hal lezat yang dapat dimasukkan dalam bentuk plug-in, menyederhanakan hidup Anda.  Plugin dapat ditulis secara independen, mereka cukup terisolasi dan tidak memerlukan arsitektur yang ramping.  Jika Anda ingin mengimplementasikan sesuatu, saya sarankan melakukannya sebagai plugin, dan kemudian dimungkinkan untuk memasukkannya ke dalam upstream. <br><br>  Helm didasarkan pada tiga konsep utama: <br><br><ul><li>  <strong>Repo Bagan</strong> - deskripsi dan berbagai parameterisasi yang mungkin untuk manifes Anda. </li><li>  <strong>Konfigurasi - yaitu</strong> , nilai-nilai yang akan diterapkan (teks, nilai numerik, dll.). </li><li>  <strong>Rilis</strong> menyatukan dua komponen teratas, dan bersama-sama mereka berubah menjadi Rilis.  Rilis dapat versi, sehingga mencapai organisasi siklus hidup: kecil pada saat instalasi dan besar pada saat upgrade, downgrade atau rollback. </li></ul><br><h2>  Arsitektur Helm </h2><br>  Diagram secara konseptual mencerminkan arsitektur Helm tingkat tinggi. <br><br><img src="https://habrastorage.org/webt/ih/dk/fs/ihdkfsbvonqupbrs-tvbmspdnpm.jpeg"><br><br>  Biarkan saya mengingatkan Anda bahwa Helm adalah sesuatu yang terhubung dengan Kubernetes.  Karena itu, kita tidak bisa melakukannya tanpa Kubernetes-cluster (persegi panjang).  Komponen kubus-apiserver ada di wisaya.  Tanpa Helm, kami memiliki Kubeconfig.  Helm membawa satu biner kecil, sehingga bisa dikatakan, utilitas Helm CLI, yang diinstal pada komputer, laptop, mainframe - untuk apa pun. <br><br>  Tetapi ini tidak cukup.  Helm memiliki komponen server Tiller.  Ia mewakili kepentingan Helm di dalam sebuah cluster, itu adalah aplikasi yang sama dalam sebuah cluster Kubernetes, seperti yang lainnya. <br><br>  Komponen berikutnya dari Grafik Repo adalah repositori grafik.  Ada repositori resmi, dan mungkin ada repositori pribadi perusahaan atau proyek. <br><br><h3>  Interaksi </h3><br>  Mari kita lihat bagaimana komponen arsitektur berinteraksi ketika kita ingin menginstal aplikasi menggunakan Helm. <br><br><ul><li> Kami mengatakan <code>Helm install</code> , pergi ke repositori (Grafik Repo) dan dapatkan grafik Helm. </li></ul><br><ul><li>  Helm Utility (Helm CLI) berinteraksi dengan Kubeconfig untuk mencari tahu cluster mana yang harus dihubungi. </li><li>  Setelah menerima informasi ini, utilitas beralih ke Tiller, yang ada di cluster kami, sudah sebagai aplikasi. </li><li>  Tiller beralih ke Kube-apiserver untuk melakukan tindakan di Kubernetes, untuk membuat beberapa objek (layanan, pod, replika, rahasia, dll.). </li></ul><br>  Lebih lanjut, kami akan memperumit skema untuk melihat vektor serangan yang dapat digunakan oleh seluruh arsitektur Helm secara keseluruhan.  Dan kemudian kita akan mencoba melindunginya. <br><br><h3>  Serang Vektor </h3><br>  Titik lemah potensial pertama adalah <strong>API</strong> <strong>pengguna</strong> <strong>istimewa</strong> .  Sebagai bagian dari skema, ini adalah peretas yang telah mendapatkan akses admin ke Helm CLI. <br><br>  <strong>Pengguna API yang tidak memiliki hak pribadi</strong> juga bisa berbahaya jika berada di suatu tempat di dekatnya.  Pengguna seperti itu akan memiliki konteks yang berbeda, misalnya, ia dapat diperbaiki di satu namespace cluster di pengaturan Kubeconfig. <br><br>  Vektor serangan yang paling menarik mungkin adalah proses yang terletak di dalam cluster di suatu tempat dekat Tiller dan dapat mengaksesnya.  Ini bisa berupa server web atau microservice yang melihat lingkungan jaringan cluster. <br><br>  Opsi serangan yang eksotis namun populer, dikaitkan dengan Chart Repo.  Bagan yang dibuat oleh penulis yang tidak bermoral mungkin mengandung sumber daya yang tidak aman, dan Anda akan mengeksekusinya, dengan keyakinan.  Atau dapat mengganti grafik yang Anda unduh dari repositori resmi, dan, misalnya, membuat sumber daya dalam bentuk kebijakan dan meningkatkan akses Anda. <br><br><img src="https://habrastorage.org/webt/jv/mc/86/jvmc86oowz_haxtc6jwb3gac9me.jpeg"><br><br>  Mari kita coba melawan serangan dari keempat sisi ini dan mencari tahu di mana ada masalah dalam arsitektur Helm, dan di mana, mungkin, mereka tidak. <br><br>  Mari memperbesar skema, menambahkan lebih banyak elemen, tetapi simpan semua komponen dasar. <br><br><img src="https://habrastorage.org/webt/j3/1d/ci/j31dciie_cbem-dvnilww29iksc.jpeg"><br><br>  Helm CLI berkomunikasi dengan Chart Repo, berinteraksi dengan Kubeconfig, pekerjaan ditransfer ke cluster di komponen Tiller. <br><br>  Anakan diwakili oleh dua objek: <br><br><ul><li>  Tiller-deploy svc, yang memaparkan layanan tertentu; </li><li>  Pod Tiller-deploy (pada diagram dalam satu salinan dalam satu replika), yang menjalankan seluruh beban yang mengakses cluster. </li></ul><br>  Untuk interaksi, berbagai protokol dan skema digunakan.  Dari sudut pandang keamanan, kami paling tertarik pada: <br><br><ul><li>  Mekanisme dimana Helm CLI mengakses grafik repo: protokol apa, apakah ada otentikasi dan apa yang dapat dilakukan tentang hal itu. </li><li>  Protokol yang digunakan Helm CLI, menggunakan kubectl, berkomunikasi dengan Tiller.  Ini adalah server RPC yang diinstal di dalam cluster. </li><li>  Tiller sendiri tersedia untuk layanan microser yang ada di cluster dan berinteraksi dengan Kube-apiserver. </li></ul><br><img src="https://habrastorage.org/webt/qm/49/cw/qm49cwtid16t8lz5lrn7ngzjahi.jpeg"><br><br>  Kami akan membahas semua petunjuk ini secara berurutan. <br><br><h2>  RBAC </h2><br><blockquote>  Tidak ada gunanya berbicara tentang keamanan Helm atau layanan lain di dalam kluster jika RBAC tidak diaktifkan. </blockquote><br>  Tampaknya ini bukan rekomendasi baru sendiri, tetapi saya yakin bahwa sejauh ini banyak yang belum memasukkan RBAC bahkan dalam produksi, karena ini banyak rewel dan Anda perlu mengkonfigurasi banyak hal.  Namun demikian, saya mendesak ini untuk dilakukan. <br><br><img src="https://habrastorage.org/webt/h-/6q/j6/h-6qj6oj9otudmbpt_qdx3rzfcs.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://rbac.dev/</a> adalah situs pengacara untuk RBAC.  Itu mengumpulkan sejumlah besar bahan menarik yang akan membantu mengatur RBAC, menunjukkan mengapa itu baik dan bagaimana hidup dengannya secara prinsip dalam produksi. <br><br>  Saya akan mencoba menjelaskan cara kerja Tiller dan RBAC.  Tiller bekerja di dalam sebuah cluster di bawah akun layanan tertentu.  Biasanya, jika RBAC tidak dikonfigurasi, ini akan menjadi superuser.  Dalam konfigurasi dasar, Tiller akan menjadi admin.  Itulah sebabnya sering dikatakan bahwa Anakan adalah terowongan SSH ke kluster Anda.  Ini sebenarnya masalahnya, sehingga Anda dapat menggunakan akun layanan khusus yang terpisah alih-alih Akun Layanan Default pada diagram di atas. <br><br>  Ketika Anda menginisialisasi Helm, instal terlebih dahulu di server, Anda dapat mengatur akun layanan menggunakan <code>--service-account</code> .  Ini akan memungkinkan Anda untuk menggunakan pengguna dengan seperangkat hak minimum yang diperlukan.  Benar, Anda harus membuat "karangan bunga" seperti itu: Peran dan RoleBinding. <br><br><img src="https://habrastorage.org/webt/wh/rv/-6/whrv-6tklftmsb0_fw3h0uumk5g.jpeg"><br><br>  Sayangnya, Helm tidak akan melakukan ini untuk Anda.  Anda atau administrator kluster Kubernetes Anda perlu menyiapkan satu set Peran, Peran untuk akun layanan terlebih dahulu untuk mentransfer Helm. <br><br>  Pertanyaannya adalah - apa perbedaan antara Peran dan ClusterRole?  Perbedaannya adalah bahwa ClusterRole berlaku untuk semua ruang nama, tidak seperti Peran reguler dan RoleBinding, yang hanya berfungsi untuk ruang nama khusus.  Anda dapat mengonfigurasi kebijakan untuk seluruh cluster dan semua ruang nama, serta dipersonalisasi untuk setiap ruang nama secara terpisah. <br><br>  Perlu disebutkan bahwa RBAC memecahkan masalah besar lainnya.  Banyak yang mengeluh bahwa Helm, sayangnya, bukan multitenancy (tidak mendukung multi-tenancy).  Jika beberapa tim mengkonsumsi sebuah cluster dan menggunakan Helm, pada prinsipnya tidak mungkin untuk mengkonfigurasi kebijakan dan untuk membedakan akses mereka dalam cluster ini, karena ada beberapa akun layanan di mana Helm bekerja, dan itu menciptakan semua sumber daya dalam cluster dari bawahnya, yang terkadang sangat tidak nyaman.  Ini benar - sebagai biner itu sendiri, sebagai suatu proses, <strong>Helm Tiller tidak memiliki petunjuk tentang multitenancy</strong> . <br><br>  Namun, ada cara yang bagus untuk menjalankan Tiller dalam sebuah cluster beberapa kali.  Tidak ada masalah dengan ini, Anakan dapat dijalankan di setiap namespace.  Dengan demikian, Anda dapat menggunakan RBAC, Kubeconfig sebagai konteks, dan membatasi akses ke Helm khusus. <br><br>  Ini akan terlihat sebagai berikut. <br><br><img src="https://habrastorage.org/webt/rr/hh/kv/rrhhkvmholhz5monyp3o7vxc9nk.jpeg"><br><br>  Misalnya, ada dua Kubeconfig dengan konteks untuk tim yang berbeda (dua namespace): Tim X untuk tim pengembangan dan admin cluster.  Cluster admin memiliki anakan lebar sendiri, yang terletak di namespace sistem Kube, masing-masing akun layanan canggih.  Dan namespace terpisah untuk tim pengembangan, mereka akan dapat menggunakan layanan mereka dalam namespace khusus. <br><br>  Ini adalah pendekatan yang berhasil, Tiller tidak terlalu rakus sehingga bisa sangat mempengaruhi anggaran Anda.  Ini adalah salah satu perbaikan cepat. <br><br><blockquote>  Jangan ragu untuk mengonfigurasikan Tiller secara terpisah dan memberikan Kubeconfig konteks untuk tim, untuk pengembang tertentu atau untuk lingkungan: Pengembang, Pementasan, Produksi (diragukan bahwa semuanya akan berada di cluster yang sama, namun, hal itu dapat dilakukan). </blockquote><br>  Melanjutkan kisah kami, beralih dari RBAC dan berbicara tentang ConfigMaps. <br><br><h3>  Configmaps </h3><br>  Helm menggunakan ConfigMaps sebagai gudang data.  Ketika kita berbicara tentang arsitektur, tidak ada database di mana informasi tentang rilis, konfigurasi, kembalikan, dll disimpan. Untuk ini, ConfigMaps digunakan. <br><br>  Masalah utama dengan ConfigMaps diketahui - mereka pada prinsipnya tidak aman, tidak <strong>mungkin untuk menyimpan data sensitif</strong> di dalamnya.  Kami berbicara tentang segala sesuatu yang tidak boleh melampaui layanan, misalnya, kata sandi.  Cara paling asli untuk Helm sekarang adalah beralih dari menggunakan ConfigMaps ke rahasia. <br><br>  Ini dilakukan dengan sangat sederhana.  Tetapkan ulang pengaturan Tiller dan tentukan bahwa penyimpanan akan menjadi rahasia.  Kemudian untuk setiap penyebaran Anda tidak akan menerima ConfigMap, tetapi sebuah rahasia. <br><br><img src="https://habrastorage.org/webt/da/a2/e-/daa2e-a00de_nuo_crbeqtaz6qu.jpeg"><br><br>  Anda mungkin berpendapat bahwa rahasia itu sendiri adalah konsep yang aneh, dan itu tidak terlalu aman.  Namun, perlu dipahami bahwa para pengembang Kubernet melakukan ini.  Mulai dari versi 1.10, mis.  cukup lama, ada kemungkinan, setidaknya di awan publik, untuk menghubungkan penyimpanan yang benar untuk menyimpan rahasia.  Sekarang tim bekerja lebih baik dalam membagikan akses ke rahasia, pengiriman individu atau entitas lainnya. <br><br><blockquote>  Storage Helm lebih baik diterjemahkan menjadi rahasia, dan mereka, pada gilirannya, aman terpusat. </blockquote><br>  Tentu saja, akan tetap ada <strong>batas untuk penyimpanan data sebesar 1 MB</strong> .  Helm di sini menggunakan etcd sebagai repositori didistribusikan untuk ConfigMaps.  Dan di sana mereka mengira itu adalah potongan data yang cocok untuk replikasi, dll.  Ada diskusi yang menarik tentang Reddit tentang ini, saya sarankan mencari bahan bacaan yang menyenangkan ini untuk akhir pekan atau membaca perasan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h3>  Bagan repo </h3><br>  Grafik adalah yang paling rentan secara sosial dan dapat menjadi sumber "Manusia di tengah", terutama jika Anda menggunakan solusi stok.  Pertama-tama, kita berbicara tentang repositori yang diekspos melalui HTTP. <br><br><blockquote>  Tentunya, Anda perlu mengekspos Helm Repo melalui HTTPS - ini adalah pilihan terbaik dan tidak mahal. </blockquote><br>  Perhatikan <strong>mekanisme tanda tangan grafik</strong> .  Teknologi ini sederhana untuk dipermalukan.  Ini adalah hal yang sama yang Anda gunakan pada GitHub, mesin PGP biasa dengan kunci publik dan pribadi.  Atur dan pastikan, memiliki kunci yang diperlukan dan menandatangani semuanya, ini benar-benar bagan Anda. <br><br>  Selain itu, <strong>klien Helm mendukung TLS</strong> (bukan dalam arti HTTP dari sisi server, tetapi TLS bersama).  Anda dapat menggunakan kunci server dan klien untuk berkomunikasi.  Terus terang, saya tidak menggunakan mekanisme seperti itu karena tidak suka untuk sertifikat bersama.  Pada prinsipnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">chartmuseum</a> - alat utama paparan Helm Repo untuk Helm 2 - juga mendukung auth dasar.  Anda dapat menggunakan auth dasar jika lebih nyaman dan lebih tenang. <br><br>  Ada juga <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin helm-gcs</a> yang memungkinkan Anda meng-host Repos Chart di Google Cloud Storage.  Ini cukup nyaman, berfungsi dengan baik dan cukup aman, karena semua mekanisme yang dijelaskan digunakan. <br><br><img src="https://habrastorage.org/webt/zo/e9/io/zoe9iooiuwjc6ccwy3lcghxlsyo.jpeg"><br><br>  Jika Anda mengaktifkan HTTPS atau TLS, gunakan mTLS, hubungkan autentikasi dasar untuk mengurangi risiko lebih lanjut, Anda akan mendapatkan saluran komunikasi aman Helm CLI dan Chart Repo. <br><br><h3>  API gRPC </h3><br>  Langkah selanjutnya sangat bertanggung jawab - untuk mengamankan Tiller, yang ada di cluster dan, di satu sisi, server, di sisi lain, mengakses komponen lain dan mencoba memperkenalkan diri sebagai seseorang. <br><br>  Seperti yang saya katakan, Tiller adalah layanan yang mengekspos gRPC, klien Helm datang ke sana melalui gRPC.  Secara default, tentu saja, TLS tidak aktif.  Mengapa ini dilakukan adalah pertanyaan yang bisa diperdebatkan, menurut saya untuk menyederhanakan pengaturan di awal. <br><br><blockquote>  Untuk produksi dan bahkan untuk pementasan, saya sarankan mengaktifkan TLS pada gRPC. </blockquote><br>  Menurut pendapat saya, tidak seperti mTLS untuk grafik, ini sesuai di sini dan dilakukan dengan sangat sederhana - menghasilkan infrastruktur PQI, membuat sertifikat, meluncurkan Tiller, mentransfer sertifikat selama inisialisasi.  Setelah itu, Anda dapat menjalankan semua perintah Helm, yang tampaknya merupakan sertifikat dan kunci pribadi yang dihasilkan. <br><br><img src="https://habrastorage.org/webt/tg/rp/lt/tgrpltlna0hqfdviwfffe4is9ym.jpeg"><br><br>  Dengan demikian, Anda akan melindungi diri dari semua permintaan untuk Anakan dari luar cluster. <br><br>  Jadi, kami mengamankan saluran koneksi ke Tiller, sudah membahas RBAC dan menyesuaikan hak apiserver Kubernetes, mengurangi domain yang dapat digunakan untuk berinteraksi. <br><br><h2>  Helm yang Dilindungi </h2><br>  Mari kita lihat diagram terakhir.  Ini adalah arsitektur yang sama dengan panah yang sama. <br><br><img src="https://habrastorage.org/webt/4h/j2/_7/4hj2_7hltplw1nsfktdw11dly4i.jpeg"><br><br>  Semua koneksi sekarang dapat dicat dengan aman dalam warna hijau: <br><br><ul><li>  untuk Chart Repo kami menggunakan TLS atau mTLS dan auth dasar; </li><li>  mTLS untuk Tiller, dan terpapar sebagai layanan gRPC dengan TLS, kami menggunakan sertifikat; </li><li>  cluster menggunakan akun layanan khusus dengan Peran dan RoleBinding. </li></ul><br>  Kami telah mengamankan cluster, tetapi seseorang yang pintar mengatakan: <br><br><blockquote>  "Hanya ada satu solusi yang benar-benar aman - komputer dimatikan, yang ada di dalam kotak beton dan dijaga oleh tentara." </blockquote><br>  Ada berbagai cara untuk memanipulasi data dan menemukan vektor serangan baru.  Namun, saya yakin bahwa rekomendasi ini akan memungkinkan penerapan standar keselamatan industri dasar. <br><br><h2>  Bonus </h2><br>  Bagian ini tidak terkait langsung dengan keamanan, tetapi juga bermanfaat.  Saya akan menunjukkan kepada Anda beberapa hal menarik yang sedikit orang ketahui.  Misalnya, cara mencari grafik - resmi dan tidak resmi. <br><br>  Repositori <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/helm/charts</a> sekarang memiliki sekitar 300 grafik dan dua aliran: stabil dan inkubator.  Kontributor tahu betapa sulitnya untuk beralih dari inkubator ke kandang, dan betapa mudahnya terbang keluar dari kandang.  Namun, ini bukan alat terbaik untuk mencari bagan untuk Prometheus dan semua yang Anda suka karena satu alasan sederhana bukanlah portal tempat yang nyaman untuk mencari paket. <br><br>  Tetapi ada layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">hub.helm.sh</a> yang dengannya jauh lebih nyaman untuk menemukan grafik.  Yang paling penting, ada lebih banyak repositori eksternal dan hampir 800 karakter tersedia.  Plus, Anda dapat menghubungkan repositori Anda jika karena alasan tertentu Anda tidak ingin mengirim grafik Anda ke stabil. <br><br>  Coba hub.helm.sh dan mari kita kembangkan bersama.  Layanan ini berada di bawah proyek Helm, dan Anda bahkan dapat berkontribusi dalam UI-nya jika Anda adalah vendor front-end dan hanya ingin meningkatkan tampilannya. <br><br>  Saya juga ingin menarik perhatian Anda pada <strong>integrasi API Broker Layanan Terbuka</strong> .  Kedengarannya rumit dan tidak bisa dipahami, tetapi ini memecahkan masalah yang dihadapi semua orang.  Saya akan jelaskan dengan contoh sederhana. <br><br><img src="https://habrastorage.org/webt/sv/ry/gq/svrygqjzgdcxc_sf5rrrdc2b70g.jpeg"><br><br>  Ada Kubernetes-cluster di mana kami ingin menjalankan aplikasi klasik - WordPress.  Sebagai aturan, sebuah database diperlukan untuk fungsionalitas penuh.  Ada banyak solusi berbeda, misalnya, Anda dapat memulai layanan statefull Anda.  Ini sangat tidak nyaman, tetapi banyak yang melakukannya. <br><br>  Yang lain, seperti kami di Chainstack, menggunakan database yang dikelola, seperti MySQL atau PostgreSQL, untuk server.  Oleh karena itu, basis data kami terletak di suatu tempat di awan. <br><br>  Tetapi muncul masalah: Anda perlu menghubungkan layanan kami dengan database, membuat database rasa, lulus kredensial dan entah bagaimana mengelolanya.  Semua ini biasanya dilakukan secara manual oleh administrator sistem atau pengembang.  Dan tidak ada masalah ketika ada beberapa aplikasi.  Ketika ada banyak, Anda perlu kombinasi.  Ada semacam gabungan - ini adalah Broker Layanan.  Ini memungkinkan Anda untuk menggunakan plug-in khusus ke cloud cluster publik dan memesan sumber daya dari penyedia melalui Broker, seolah-olah itu adalah API.  Anda dapat menggunakan alat Kubernetes asli untuk ini. <br><br>  Ini sangat sederhana.  Anda dapat meminta, misalnya, MySQL yang Dikelola di Azure dengan tingkat dasar (ini dapat dikustomisasi).  Menggunakan Azure API, basis akan dibuat dan disiapkan untuk digunakan.  Anda tidak perlu mengganggu ini, plugin bertanggung jawab untuk ini.  Misalnya, OSBA (plugin Azure) akan mengembalikan kredensial ke layanan, meneruskannya ke Helm.  Anda dapat menggunakan WordPress dengan MySQL yang keruh, tidak berurusan dengan database yang dikelola sama sekali, dan jangan khawatir tentang layanan statefull di dalamnya. <br><br><blockquote>  Kita dapat mengatakan bahwa Helm bertindak sebagai lem, yang di satu sisi memungkinkan Anda untuk menyebarkan layanan, dan di sisi lain, ia menghabiskan sumber daya penyedia cloud. </blockquote><br>  Anda dapat menulis plugin sendiri dan menggunakan seluruh cerita di tempat ini.  Maka Anda hanya memiliki plugin Anda sendiri untuk penyedia Cloud perusahaan.  Saya menyarankan Anda untuk mencoba pendekatan ini, terutama jika Anda memiliki skala besar dan Anda ingin cepat menggunakan dev, staging atau seluruh infrastruktur untuk fitur.  Ini akan membuat hidup Anda lebih mudah untuk operasi atau DevOps Anda. <br><br>  Temuan lain yang telah saya sebutkan adalah <strong>plugin helm-gcs</strong> , yang memungkinkan Anda untuk menggunakan Google-bucket (penyimpanan objek) untuk menyimpan grafik Helm. <br><br><img src="https://habrastorage.org/webt/gp/id/ln/gpidlnzmqfrnh4kswxi9obliphk.jpeg"><br><br>  Hanya dibutuhkan empat perintah untuk mulai menggunakannya: <br><br><ol><li>  instal plugin; </li><li>  memulai itu; </li><li>  setel path ke bucket, yang terletak di gcp; </li><li>  menerbitkan bagan dengan cara standar. </li></ol><br>  Keindahannya adalah bahwa metode gcp asli untuk otorisasi akan digunakan.  Anda dapat menggunakan akun layanan, akun pengembang - apa pun.  Sangat nyaman dan tidak ada biaya untuk beroperasi.  Jika Anda, seperti saya, menganjurkan filosofi opsless, maka ini akan sangat nyaman, terutama untuk tim kecil. <br><br><h2>  Alternatif </h2><br>  Helm bukan satu-satunya solusi manajemen layanan.  Ada banyak pertanyaan kepadanya, yang mungkin mengapa versi ketiga muncul begitu cepat.  Tentu ada alternatifnya. <br><br>  Ini dapat berupa solusi khusus, misalnya, Ksonnet atau Metaparticle.  Anda dapat menggunakan alat manajemen infrastruktur klasik Anda (Ansible, Terraform, Chef, dll.) Untuk tujuan yang sama yang saya bicarakan. <br><br>  Akhirnya, ada solusi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Operator Framework</a> , yang popularitasnya semakin meningkat. <br><br><blockquote>  Kerangka Operator adalah alternatif Helm utama yang harus Anda perhatikan. </blockquote><br>  Ini lebih asli untuk CNCF dan Kubernetes, <strong>tetapi ambang entri jauh lebih tinggi</strong> , Anda perlu memprogram lebih banyak dan menggambarkan manifes kurang. <br><br>  Ada berbagai addons, seperti Draft, Scaffold.  Mereka sangat menyederhanakan kehidupan, misalnya, pengembang menyederhanakan siklus pengiriman dan peluncuran Helm untuk menyebarkan lingkungan pengujian.  Saya akan menyebut mereka sebagai perpanjangan peluang. <br><br>  Berikut ini adalah grafik visual dari mana yang berada. <br><br><img src="https://habrastorage.org/webt/x8/jl/f3/x8jlf3pejoqjp5b-lj9y2l9r6q0.jpeg"><br><br>  Pada sumbu x, tingkat kendali pribadi Anda atas apa yang terjadi, pada sumbu y, tingkat keaslian Kubernetes.  Helm versi 2 ada di suatu tempat di tengah.  Dalam versi 3, ini bukan kolosal, tetapi kontrol dan tingkat keaslian ditingkatkan.  Solusi tingkat Ksonnet masih lebih rendah daripada Helm 2. Namun, mereka patut dilihat untuk mengetahui apa lagi yang ada di dunia ini.  Tentu saja, manajer konfigurasi Anda akan berada di bawah kendali Anda, tetapi sama sekali bukan asli Kubernetes. <br><br>  Kerangka Operator benar-benar asli untuk Kubernetes dan memungkinkan Anda untuk mengelolanya jauh lebih elegan dan cermat (tapi ingat tentang tingkat entri).  Sebaliknya, ini cocok untuk aplikasi khusus dan menciptakan manajemen untuk itu, daripada pemanen massal untuk mengemas sejumlah besar aplikasi menggunakan Helm. <br><br>  Extender hanya meningkatkan kontrol sedikit, melengkapi alur kerja atau memotong sudut pipa CI / CD. <br><br><h2>  Masa depan Helm </h2><br>  Berita baiknya adalah bahwa Helm 3 muncul. Versi alpha dari Helm 3.0.0-alpha.2 telah dirilis, Anda dapat mencoba.  Ini cukup stabil, tetapi fungsi masih terbatas. <br><br>  Mengapa Anda membutuhkan Helm 3?  Pertama-tama, ini adalah kisah <strong>hilangnya Tiller</strong> , sebagai komponen.  Ini, seperti yang sudah Anda pahami, adalah langkah besar ke depan, karena semuanya disederhanakan dari sudut pandang keamanan arsitektur. <br><br>  Ketika Helm 2 dibuat, yang selama Kubernetes 1.8 atau bahkan sebelumnya, banyak konsep yang belum matang.  Misalnya, konsep CRD sedang diterapkan secara aktif, dan Helm akan <strong>menggunakan CRD</strong> untuk menyimpan struktur.  Ini akan mungkin untuk hanya menggunakan klien dan tidak menjaga sisi server.  Dengan demikian, gunakan perintah Kubernet asli untuk bekerja dengan struktur dan sumber daya.  Ini adalah langkah besar ke depan. <br><br>  <strong>Dukungan untuk repositori OCI asli</strong> (Open Container Initiative) akan muncul.  Ini adalah inisiatif besar, dan Helm menarik terutama untuk memposting grafiknya.  Sampai pada titik di mana, misalnya, Docker Hub mendukung banyak standar OCI.  Saya tidak heran, tetapi mungkin penyedia repositori Docker klasik akan mulai memberi Anda kesempatan untuk menempatkan grafik Helm mereka untuk Anda. <br><br>  Kisah kontroversial bagi saya adalah <strong>dukungan Lua</strong> sebagai mesin templating untuk menulis skrip.  Saya bukan penggemar berat Lua, tetapi ini akan menjadi fitur yang sepenuhnya opsional.  Saya memeriksanya 3 kali - menggunakan Lua tidak perlu.  Karena itu, siapa pun yang ingin dapat menggunakan Lua, seseorang yang suka Go, bergabunglah dengan kamp besar kami dan gunakan go-tmpl untuk ini. <br><br>  ,      —  <strong>     </strong> .      int  string,        .  JSONS-,       values. <br><br>     <strong>event-driven model</strong> .    .    Helm 3,  ,         ,    ,   ,         . <br><br> Helm 3  ,     ,     Helm 2,    Kubernetes   . , Helm    Kubernetes        Kubernetes. <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berita baik lainnya adalah bahwa di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevOpsConf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alexander Khayorov akan memberi tahu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda apakah wadah bisa aman? </font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ingat, sebuah konferensi tentang integrasi pengembangan, pengujian dan proses operasi akan diadakan di Moskow </font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pada 30 September dan 1 Oktober</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Hingga 20 Agustus, Anda masih dapat </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mengirimkan laporan</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan berbicara tentang pengalaman Anda dalam menyelesaikan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salah satu dari banyak</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tugas pendekatan DevOps. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ikuti pos pemeriksaan konferensi dan berita di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buletin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">saluran telegram</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id462665/">https://habr.com/ru/post/id462665/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id462655/index.html">Ketikkan kode Anda akhirnya</a></li>
<li><a href="../id462657/index.html">Ulasan & Tes Pengisi Daya SkyRC B6 Nano</a></li>
<li><a href="../id462659/index.html">Memulai dengan Analisis Statis PVS-Studio untuk Pengembangan C ++ di Linux</a></li>
<li><a href="../id462661/index.html">Berkenalan dengan analisa statis PVS-Studio saat mengembangkan program C ++ di Linux</a></li>
<li><a href="../id462663/index.html">Berenang, menari (!) Dan goyang: kegiatan apa yang benar-benar diinginkan</a></li>
<li><a href="../id462667/index.html">Panduan Galaxy DevOpsConf 2019</a></li>
<li><a href="../id462671/index.html">Infrastruktur perusahaan sebagai produk</a></li>
<li><a href="../id462673/index.html">Batu, gunting, kertas, wawancara kerja, Spock</a></li>
<li><a href="../id462675/index.html">Kekecewaan Informasi</a></li>
<li><a href="../id462677/index.html">Vepp - server baru dan panel kontrol situs dari ISPsystem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>