<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèæ üó∫Ô∏è üë∞üèº SwayWM - UnixPorn vous-m√™me üöµüèΩ üíû ü§ôüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. Dans cet article, je d√©crirai mon exp√©rience dans la configuration et l'utilisation de sway, un gestionnaire de fen√™tres de mosa√Øque p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SwayWM - UnixPorn vous-m√™me</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484378/"><p>  Bonjour √† tous.  Dans cet article, je d√©crirai mon exp√©rience dans la configuration et l'utilisation de sway, un gestionnaire de fen√™tres de mosa√Øque pour Linux. <a name="habracut"></a></p><br><h1 id="chto-eto-takoe-i-zachem-ono-nuzhno">  Qu'est-ce que c'est et pourquoi est-il n√©cessaire? </h1><br><p>  Officiellement, sway est un gestionnaire de fen√™tres en mosa√Øque, un remplacement transparent pour i3wm, travaillant au sommet de Wayland. </p><br><blockquote>  Weiland, alias W√∂lund, etc.  - Un personnage de la mythologie du vieil allemand et du vieux norrois, un livre sur lequel a √©t√© √©crit √† un moment donn√© par la folkloriste anglaise Jessie Weston.  Maintenant tu sais. </blockquote><p>  Cependant, √† mon avis, la caract√©ristique principale de Sway est qu'il s'agit d'un constructeur, avec tous les avantages et les inconv√©nients de cette approche.  Si vous aimez Vim (la similitude est aggrav√©e par l'orientation sur l'utilisation du clavier), Archlinux et des projets similaires, alors je vous conseille de regarder de plus pr√®s le balancement.  Mon opinion personnelle est qu'une fois que vous passez un peu plus de temps √† le configurer, vous obtiendrez un environnement tr√®s stable et pratique pour vous personnellement, dans lequel rien d'inattendu ne se produira. </p><br><p>  Si les inconv√©nients de Sway et Wayland (comme le manque de prise en charge des pilotes priv√©s de NVidia et la n√©cessit√© de rechercher des analogues pour de nombreux programmes familiers) vous semblent fatals, je vous conseille de faire attention au x3 i3wm.  Les parties constructeurs y seront compl√®tement diff√©rentes, vous devrez installer xinit, configurer divers .Xauthority, il est possible de g√©rer les d√©chirures, mais la logique g√©n√©rale du syst√®me est exactement la m√™me. </p><br><h1 id="ustanovka">  L'installation </h1><br><p> Sway est probablement dans les r√©f√©rentiels de votre distribution.  Cependant, si vous souhaitez installer une version plus r√©cente, c'est tr√®s simple.  La page du projet <a href="https://github.com/swaywm/sway">github</a> a une liste limit√©e de ses d√©pendances.  Installez-les, <code>wlroots</code> le r√©f√©rentiel, <code>wlroots</code> dans le dossier des <code>subprojects</code> - <code>subprojects</code> : </p><br><pre> <code class="plaintext hljs">hub clone swaywm/sway hub clone swaywm/wlroots sway/subprojects/wlroots</code> </pre><br><p>  (ici j'utilise un <a href="https://github.com/github/hub">hub</a> . Un outil non standard mais tr√®s pratique).  Apr√®s cela, vous pouvez configurer et cr√©er: </p><br><pre> <code class="plaintext hljs">meson setup ./sway-build ./sway --buildtype=minsize ninja -C ./sway-build doas ninja -C ./sway-build install</code> </pre> <br><blockquote>  doas est un remplacement sudo l√©ger des d√©veloppeurs OpenBSD.  Linux utilise g√©n√©ralement sa fourchette d' <a href="https://github.com/Duncaen/OpenDoas">OpenDoas.</a> </blockquote><br><h1 id="zapusk">  Lancement </h1><br><p>  Si vous souhaitez ex√©cuter sway √† partir de la ligne de commande sans utiliser de gestionnaires tels que SDDM, la seule bonne fa√ßon de le faire est </p><br><pre> <code class="plaintext hljs">$ exec sway</code> </pre> <br><p>  Si vous ex√©cutez sway sans <code>exec</code> , verrouillez l'√©cran avec swaylock et sway se bloque, vous serez renvoy√© √† la ligne de commande.  La serrure sera inutile. </p><br><blockquote>  Remarque pour les fans de systemd: sway ne n√©cessite ni systemd-logind ni elogind.  Certes, dans ce cas, vous devrez d√©finir le bit suid ou configurer les capacit√©s.  Voir le <a href="https://github.com/swaywm/sway/wiki/Running-Sway-without-systemd">wiki</a> . </blockquote><br><h2 id="peremennye-okruzheniya">  Variables d'environnement </h2><br><p>  Il y a plusieurs endroits o√π je les prescris. </p><br><p>  Script shell √† <code>~/.local/bin/sway</code> - pour les variables sp√©cifiques √† sway.  Par exemple, je veux que les applications Qt ne montrent pas le paysage et utilisent le th√®me de <code>qt5ct</code> : </p><br><pre> <code class="plaintext hljs">#!/bin/bash QT_QPA_PLATFORMTHEME=qt5ct \ QT_WAYLAND_DISABLE_WINDOWDECORATION=1 \ /usr/bin/sway</code> </pre> <br><p>  <code>~/.pam_environment</code> - pour les variables que je veux rendre imm√©diatement disponibles dans la session utilisateur systemd.  Un exemple: </p><br><pre> <code class="plaintext hljs">SSH_AUTH_SOCK DEFAULT="${XDG_RUNTIME_DIR}/gnupg/S.gpg-agent.ssh"</code> </pre> <br><p>  Cependant, modifiez ce fichier avec prudence, surtout si vous utilisez d'autres environnements.  Par exemple, KDE Plasma ne l' <code>pam_env</code> pas beaucoup s'il y d√©tecte <code>$WAYLAND_DISPLAY</code> (ironiquement, le module <code>pam_env</code> ce fichier a √©t√© cr√©√© il y a N ans principalement pour d√©finir la variable <code>$DISPLAY</code> ). </p><br><p>  <code>~/.bashrc</code> - pour tous les autres cas. </p><br><h1 id="nastroyka-sway">  Configuration du balancement </h1><br><h2 id="vvod">  Entrer </h2><br><p>  Tout est assez simple dans mon syst√®me: nous installons des dispositions russes et anglaises et basculons entre elles par <code>Alt+Shift</code> .  Dans la configuration de balancement, cela ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">input * { xkb_layout us,ru xkb_options grp:alt_shift_toggle }</code> </pre> <br><p>  Sway utilise la biblioth√®que <code>libinput</code> pour l'entr√©e, la m√™me que KDE et Gnome.  Nous avons donc plusieurs de ses options disponibles.  Param√®tres du pav√© tactile, d√©filement naturel, acc√©l√©ration du pointeur de la souris, etc.  etc.  La liste des options peut √™tre consult√©e dans <code>man sway-input</code> , et la liste des p√©riph√©riques d'entr√©e dans la sortie de la commande </p><br><pre> <code class="plaintext hljs">swaymsg -t get_inputs</code> </pre> <br><p>  Cependant, je voudrais attirer l'attention sur une opportunit√© int√©ressante.  Si vous quittez un environnement X, vous pouvez simplement transf√©rer les param√®tres de votre clavier √† partir de l√†.  Ex√©cutez la commande dans cet environnement </p><br><pre> <code class="plaintext hljs">$ xkbcomp $DISPLAY /path/to/keymap.xkb</code> </pre> <br><p>  et dans le registre de configuration de balancement </p><br><pre> <code class="plaintext hljs">input * { xkb_file /path/to/keymap.xkb }</code> </pre> <br><h2 id="hotkei">  Raccourcis clavier </h2><br><p>  Les raccourcis clavier, comme tout le reste dans sway, sont d√©finis dans la configuration.  Il existe 3 commandes pour les d√©finir: </p><br><ol><li>  <code>bindswitch</code> .  Il est effectu√© lors de l'ouverture / fermeture du couvercle de l'ordinateur portable, du passage en mode tablette, etc. </li><li>  <code>bindcode</code> .  Il est ex√©cut√© lorsqu'une touche avec le code sp√©cifi√© est enfonc√©e.  Cela ne d√©pend pas de la disposition actuelle, particuli√®rement utile pour les touches multim√©dia. </li><li>  <code>bindsym</code> .  Le caract√®re actuellement entr√© d√©pend de la disposition.  Cependant, si vous ajoutez le param√®tre <code>--to-code</code> , ce caract√®re sera implicitement converti en code correspondant pour la premi√®re mise en page √† partir de <code>xkb_layout</code> (voir les param√®tres d'entr√©e). </li></ol><br><p>  Par exemple, un tel raccourci va battre la fen√™tre actuelle quelle que soit la disposition: </p><br><pre> <code class="plaintext hljs">bindsym --to-code $mod+Shift+q kill</code> </pre> <br><p>  Vous pouvez en savoir plus sur ces param√®tres dans mana: <code>man 5 sway</code> . </p><br><p>  Pour d√©terminer facilement ce qui a √©t√© press√©, l'auteur de sway a √©crit un <a href="https://git.sr.ht/~sircmpwn/wshowkeys">enregistreur de frappe</a> sp√©cial (il a besoin des droits root pour fonctionner, donc il n'y a pas besoin de se soucier de la s√©curit√©). </p><br><h2 id="vyvod">  Conclusion </h2><br><p>  Une liste des p√©riph√©riques de sortie disponibles peut √™tre obtenue avec la commande </p><br><pre> <code class="plaintext hljs">swaymsg -t get_outputs</code> </pre> <br><p>  Dans la configuration de chacun d'eux, vous pouvez d√©finir le mode vid√©o, la mise √† l'√©chelle (y compris fractionnaire), l'image, la rotation, etc.  La configuration la plus simple ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">output HDMI-A-1 mode 1920x1080@60Hz output * bg /path/to/wallpaper.jpg fill</code> </pre> <br><p>  Une liste compl√®te des options peut √™tre trouv√©e dans le mana de <code>man sway-output</code> l' <code>man sway-output</code> . <br>  Il existe √©galement un programme <a href="https://github.com/emersion/wlr-randr">wlr-randr</a> dans lequel tout cela peut √™tre d√©fini √† partir de la ligne de commande (c'est-√†-dire qu'il s'agit d'un analogue de XRandr pour Wayland). </p><br><h2 id="swaybar">  Swaybar </h2><br><p>  Swaybar - un panneau sur lequel les informations d'√©tat sont affich√©es.  Date, heure, barre d'√©tat syst√®me, etc.  etc.  Habituellement, les fans d'i3 et de sway passent le plus de temps √† configurer ce panneau particulier (ou les panneaux, il peut y en avoir plusieurs).  Personnellement, j'en ai assez, proche de la configuration minimale: </p><br><pre> <code class="plaintext hljs">bar { position top colors { statusline #ffffff background #282828E6 inactive_workspace #282936BF #282936BF #5c5c5c } font Hack 11 status_command i3blocks }</code> </pre> <br><p>  Il existe de nombreuses options pour ajuster la position, les couleurs, les polices, le bac, etc.  Vous pouvez les <code>man 5 sway-bar</code> dans mana - <code>man 5 sway-bar</code> . </p><br><p>  Swaybar s'engage √† lire et √† analyser json au format i3bar, g√©n√©r√© par <code>status_command</code> .  Il existe de nombreux programmes qui peuvent √™tre utilis√©s ici.  <a href="https://i3wm.org/i3status/">i3status</a> , <a href="https://github.com/Alexays/Waybar">waybar</a> , <a href="https://github.com/greshake/i3status-rust">i3status-rs</a> et de nombreux autres projets.  Personnellement, je pr√©f√®re les <a href="https://github.com/vivien/i3blocks">i3blocks en</a> raison de la simplicit√© de la configuration et de la facilit√© d'ajout de blocs personnalis√©s. </p><br><h1 id="nastroyka-prikladnyh-programm">  Configuration de l'application </h1><br><h2 id="uvedomleniya">  Notifications </h2><br><p>  Cela peut √™tre <a href="https://github.com/emersion/mako">fait par le</a> d√©mon <a href="https://github.com/emersion/mako">mako</a> (tr√®s probablement il y en a dans votre distribution).  L√†, vous pouvez √©galement r√©gler les couleurs, etc., mais tout cela est facultatif.  Il suffit de l'ex√©cuter et cela fonctionnera. </p><br><p>  Mako impl√©mente la sp√©cification XDG Desktop Notifications bas√©e sur dbus.  Il est pris en charge par de nombreux programmes, notamment Chromium, Firefox et Telegram. </p><br><h2 id="emulyator-terminala">  √âmulateur de terminal </h2><br><p>  Dans des environnements comme KDE, Plasma utilise g√©n√©ralement des √©mulateurs int√©gr√©s qui affichent des menus, des onglets et de nombreux autres √©l√©ments de conception.  Mais pourquoi tout cela est-il en jeu?  Je pr√©f√®re <a href="https://github.com/alacritty/alacritty">Alacritty</a> - tr√®s rapide gr√¢ce √† l'utilisation de l'√©mulateur GPU, d'ailleurs √©crit en Rust.  J'ai ajout√© de tels raccourcis clavier √† la section key_bindings de sa configuration ( <code>~/.config/alacritty/alacritty.yml</code> ): </p><br><pre> <code class="plaintext hljs">- { key: T, mods: Control|Shift, action: SpawnNewInstance }</code> </pre> <br><p>  ouvrir une nouvelle fen√™tre avec le r√©pertoire courant.  Un excellent remplacement pour les onglets et le balancement se chargera de la mise en page. </p><br><pre> <code class="plaintext hljs">- { key: Up, mods: Control|Shift, action: ScrollLineUp, mode: ~Alt } - { key: Down, mods: Control|Shift, action: ScrollLineDown, mode: ~Alt }</code> </pre> <br><p>  faites d√©filer vers le haut / bas une ligne. </p><br><p>  On √©crit dans la config sway </p><br><pre> <code class="plaintext hljs">set $term alacritty bindsym $mod+Return exec $term</code> </pre> <br><p>  Alacritty ne prend pas en charge les ligatures, car elles affectent la vitesse de rendu.  Si vous en avez encore besoin, faites attention √† <a href="https://sw.kovidgoyal.net/kitty/">Kitty</a> - cet √©mulateur est √©galement tr√®s rapide, et il y a juste une quantit√© effrayante de fonctionnalit√©s et de param√®tres sous le capot. </p><br><h2 id="zapusk-prilozheniy">  Lancer des applications </h2><br><p>  Les applications dans sway sont g√©n√©ralement lanc√©es √† l'aide du menu de raccourcis.  Dans la configuration, ils √©crivent quelque chose comme </p><br><pre> <code class="plaintext hljs">set $menu ... bindsym --to-code $mod+d exec $menu</code> </pre> <br><p>  Il existe de nombreux programmes pour afficher le menu.  Certains, comme <a href="https://tools.suckless.org/dmenu/">dmenu</a> ou <a href="https://github.com/davatorium/rofi">rofi</a> , ont besoin de XWayland.  Parmi ceux qui travaillent sous Wayland, nous pouvons distinguer <a href="https://github.com/Cloudef/bemenu">bemenu</a> et m√™me krunner (ce qui appara√Æt dans KDE par <code>Alt+F2</code> . Oui, c'est un programme ind√©pendant). </p><br><p>  Cependant, je pr√©f√®re une solution plus universelle, √† savoir <a href="https://github.com/Biont/sway-launcher-desktop">sway-launcher-desktop</a> .  Malgr√© son nom, il ne d√©pend pas de Sway et n'est g√©n√©ralement pas un programme GUI, mais un petit script shell fonctionnant dans la console.  Ce script forme un menu √† partir de programmes dans <code>$PATH</code> , de fichiers de bureau install√©s (conform√©ment √† la sp√©cification XDG Desktop Entry) et √©ventuellement de sources suppl√©mentaires (configur√©es dans la configuration).  Le merveilleux utilitaire <code>fzf</code> est utilis√© pour afficher et rechercher le menu - faites attention √† lui. </p><br><p>  Ainsi, pour afficher le menu, nous devons ouvrir une fen√™tre de terminal avec ce programme.  Avec alacritty, cela se fait comme ceci: </p><br><pre> <code class="plaintext hljs">set $menu exec alacritty -e sway-launcher-desktop bindsym --to-code $mod+d exec $menu</code> </pre> <br><p>  Vous pouvez vouloir faire flotter cette fen√™tre par d√©faut.  Dans i3 et sway, ces r√®gles sont configur√©es dans la configuration √† l'aide de la directive <code>for_window</code> .  Pour mapper la r√®gle √† la fen√™tre <code>sway-launcher-desktop</code> , il faut lui assigner une classe unique, pour moi, c'est juste <code>Launcher</code> .  Gardez √† l'esprit qu'en raison de l'utilisation de Wayland, les crit√®res √©num√©r√©s dans le <a href="https://i3wm.org/docs/userguide.html">manuel i3</a> ne conviennent pas au balancement.  Les bons peuvent √™tre trouv√©s dans <code>man 5 sway</code> , section <code>CRITERIA</code> .  Dans ce cas, <code>app_id</code> est tout √† fait appropri√©, et la configuration finale ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">set $menu exec alacritty --class Launcher -e sway-launcher-desktop for_window [app_id="Launcher"] floating enable, border pixel 10, sticky enable bindsym --to-code $mod+d exec $menu</code> </pre> <br><h2 id="avtozapusk-prilozheniy">  D√©marrage automatique des applications </h2><br><p>  En principe, pour d√©marrer automatiquement un programme, vous pouvez simplement √©crire </p><br><pre> <code class="plaintext hljs">exec /path/to/program</code> </pre> <br><p>  dans la configuration sway, ou m√™me cr√©er une unit√© systemd personnalis√©e.  Cependant, dans cet article, j'utiliserai la sp√©cification XDG Autostart adopt√©e par KDE et Gnome. </p><br><p>  La sp√©cification consiste √† ex√©cuter des fichiers de bureau situ√©s dans les r√©pertoires <code>/etc/xdg/autostart</code> et <code>~/.config/autostart</code> .  En r√®gle g√©n√©rale, ces fichiers sont fournis dans des packages avec des programmes, mais ils sont faciles √† cr√©er vous-m√™me. </p><br><p>  C'est l√† que l'essence modulaire du balancement se manifeste.  Sway lui-m√™me ne sait rien du d√©marrage automatique XDG, ni de l'entr√©e de bureau XDG.  De plus, ses d√©veloppeurs n'aiment pas ces sp√©cifications et toutes les sp√©cifications similaires.  Cependant, l'utilitaire de console <a href="https://github.com/jceb/dex">dex</a> est capable de les g√©rer (tr√®s probablement, il se trouve dans le r√©f√©rentiel de votre distribution). </p><br><p>  Pour v√©rifier ce qui sera en ex√©cution automatique, tapez la commande </p><br><pre> <code class="plaintext hljs">$ dex -ade Sway</code> </pre> <br><p>  <code>a</code> signifie autostart, <code>d</code> - "dry run", <code>-e Sway</code> d√©finit le nom de l'environnement (il peut √™tre n'importe lequel) et est utilis√© pour le filtrage. </p><br><p>  Tr√®s probablement, la liste r√©sultante ne vous conviendra pas.  Par exemple, j'ai obtenu <code>kgpg</code> .  Nous proc√©dons comme suit: copiez le fichier de bureau correspondant depuis <code>/etc/xdg/autostart</code> vers <code>~/.config/autostart</code> , ajoutez-y la ligne </p><br><pre> <code class="plaintext hljs">NotShowIn=Sway</code> </pre> <br><p>  et v√©rifiez √† nouveau l'ex√©cution automatique.  De nombreux programmes (en particulier ceux √©crits en Electron) peuvent ne pas fonctionner sous Wayland.  Nous faisons de m√™me avec eux.  Nous copions le fichier de bureau et y changeons la ligne de lancement.  C'√©tait: </p><br><pre> <code class="plaintext hljs">Exec=/usr/bin/skypeforlinux</code> </pre> <br><p>  est devenu: </p><br><pre> <code class="plaintext hljs">Exec=env GDK_BACKEND=x11 /usr/bin/skypeforlinux</code> </pre> <br><p>  la m√™me technique peut √™tre appliqu√©e √† sway-launcher-desktop √† partir du paragraphe pr√©c√©dent.  Lorsque tous les probl√®mes sont r√©solus, ajoutez la ligne √† la configuration sway </p><br><pre> <code class="plaintext hljs">exec dex -ae Sway</code> </pre> <br><p>  Ou vous pouvez faire le contraire: copiez les fichiers de bureau souhait√©s dans un r√©pertoire non standard et d√©finissez le dex dessus avec la commande </p><br><pre> <code class="plaintext hljs">exec dex -as /path/to/your/dir</code> </pre> <br><h2 id="skrinshoty">  Captures d'√©cran </h2><br><p>  Deux des cercueils nous aideront avec cela.  <a href="https://github.com/emersion/slurp">slurp</a> vous permet de s√©lectionner une zone rectangulaire arbitraire sur l'√©cran, et <a href="https://github.com/emersion/grim">sinistre en</a> fait une capture d'√©cran.  Dans ma configuration, cela ressemble √† ceci: </p><br><pre> <code class="plaintext hljs">bindsym Print exec grim ~/Pictures/screen-"$(date +%s)".png bindsym $mod+Print exec grim -g "$(slurp)" ~/Pictures/screen-"$(date +%s)".png</code> </pre> <br><p>  <code>$mod+PrintScreen</code> - capture d'√©cran d'une zone arbitraire, <code>PrintScreen</code> - capture d'√©cran de tout l'√©cran. </p><br><h2 id="skrinkasty">  Screencasts </h2><br><p>  Si vous avez besoin d'√©crire un screencast dans un fichier ou de le diffuser sur un flux RTMP (par exemple, sur Twitch), <a href="https://github.com/ammen99/wf-recorder">wf-recorder vous</a> y aidera (prend √©galement en charge slurp). </p><br><p>  Si vous souhaitez utiliser OBS Studio, il existe le plugin <a href="https://hg.sr.ht/~scoopta/wlrobs">wlrobs</a> pour cela. </p><br><p>  Cependant, la solution la plus universelle prise en charge d'une part dans KDE et Gnome, et d'autre part, en particulier dans les navigateurs Chrome et Firefox, est d'utiliser Pipewire et la sp√©cification XDG Desktop Portal.  Pour balancer, il y a la couche n√©cessaire <a href="https://github.com/emersion/xdg-desktop-portal-wlr">xdg-desktop-portal-wlr</a> , bien que je n'aie pas v√©rifi√© ses performances. </p><br><h2 id="nochnoy-rezhim">  Mode nuit </h2><br><p>  Le mode nuit consiste √† remplacer les couleurs du moniteur par des couleurs plus chaudes dans le noir.  Les scientifiques doutent de l'utilit√© de cela, et les d√©veloppeurs de Wayland ont d√©cid√© que la normalisation du protocole de correction gamma √©tait inutile pour des raisons techniques. </p><br><p>  N√©anmoins, j'aime cette fonctionnalit√©, et elle est √©galement pr√©sente.  Pour le mode nuit, nous avons besoin de cette <a href="https://github.com/minus7/redshift">fourchette de redshift</a> avec prise en charge du protocole sp√©cifique √† Sway. </p><br><p>  Nous l'installons de quelque mani√®re que ce soit, dans la <code>~/.config/redshift/redshift.conf</code> , s√©lectionnez le protocole souhait√© et sp√©cifiez la longitude et la latitude. </p><br><pre> <code class="plaintext hljs">[redshift] location-provider=manual adjustment-method=wayland [manual] lat=xx.xx lon=yy.yy</code> </pre> <br><h2 id="blokirovka-i-otklyuchenie-ekrana">  Verrouiller et √©teindre l'√©cran </h2><br><p>  Deux d'un autre cercueil viennent √† la rescousse ici.  <code>swayidle</code> ex√©cute les commandes donn√©es dans le d√©lai d'expiration s'il n'y a pas d'activit√© (ou vice versa, son apparence), et <code>swaylock</code> verrouille l'√©cran et n√©cessite un mot de passe.  Vous pouvez d√©sactiver l'√©cran (ou tous les √©crans, s'il y en a plusieurs) </p><br><pre> <code class="plaintext hljs">swaymsg "output * dpms off"</code> </pre> <br><p>  Voici √† quoi ressemblera le d√©mon, bloquant l'√©cran apr√®s 300 secondes d'inactivit√© et le d√©sactivant apr√®s 600: </p><br><pre> <code class="plaintext hljs">swayidle -w \ timeout 300 'swaylock -f -c 000000' \ timeout 600 'swaymsg "output * dpms off"' \ resume 'swaymsg "output * dpms on"' \ before-sleep 'swaylock -f -c 000000'</code> </pre> <br><p>  Ex√©cutez-le en aucune fa√ßon. </p><br><h2 id="i3blocks">  i3blocks </h2><br><p>  Blocs pr√™ts √† l'emploi avec calendrier, r√©seau, √©tat du disque, etc.  etc.  peut √™tre emprunt√© au <a href="https://github.com/vivien/i3blocks-contrib">r√©f√©rentiel i3blocks-contrib</a> .  Dans i3blocks, ils sont ajout√©s dans la configuration √† <code>~/.config/i3blocks/config</code> .  Par exemple, un bloc avec des mises √† jour toutes les 5 secondes par jour de la semaine, date et heure: </p><br><pre> <code class="plaintext hljs">[time] command=date +"%a %d/%m %H:%M" interval=5</code> </pre> <br><p>  Mais c'√©tait un exemple trop simple.  En fait, les passionn√©s d'i3 et de sway ont un Saint Graal: afficher la barre de titre de la fen√™tre actuelle dans la barre sup√©rieure.  Voyons comment y parvenir. </p><br><p>  Tout d'abord, nous commen√ßons √† lire <code>man sway-ipc</code> et constatons que vous pouvez vous y abonner.  Le requis a le code <code>0x80000003. WINDOW</code>  <code>0x80000003. WINDOW</code> et renvoie les objets json de cette structure: </p><br><pre> <code class="plaintext hljs">{ "change" : "focus | title | ...", "container": { focused: true | false, name: "...", ... } }</code> </pre> <br><p>  En effet, soit la fen√™tre elle-m√™me peut changer son titre ( <code>change == title</code> ), soit on peut d√©placer le focus vers une autre fen√™tre ( <code>change == focus</code> ).  Cependant, la fen√™tre peut changer le titre et √™tre floue.  Pour filtrer ces √©v√©nements, nous devons v√©rifier la propri√©t√© <code>container.focused</code> . </p><br><p>  Vous pouvez d√©crire toute cette logique en Python ou Go, mais il existe une meilleure fa√ßon.  <code>swaymsg</code> facilite l'abonnement aux √©v√©nements souhait√©s et leur sortie vers stdout: </p><br><pre> <code class="plaintext hljs">$ swaymsg -m -t SUBSCRIBE "['window']"</code> </pre> <br><p>  et nous traiterons le json r√©sultant en <code>jq</code> .  Sans entrer dans les subtilit√©s de la syntaxe de requ√™te de ce merveilleux utilitaire, voici le r√©sultat: </p><br><pre> <code class="bash hljs">$ query=<span class="hljs-string"><span class="hljs-string">'select(.change == "focus" or (.change == "title" and .container.focused)) | .container.name'</span></span> $ swaymsg -m -t SUBSCRIBE <span class="hljs-string"><span class="hljs-string">"['window']"</span></span> | jq --unbuffered -r <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$query</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><p>  Un script √† deux lignes sur le bash, et plus de code!  L'indicateur <code>--unbuffered</code> n√©cessaire, sinon i3blocks ne recevra pas de nouvelles lignes imm√©diatement, mais uniquement lorsque le tampon sera effac√©. </p><br><p>  Enfin, ajoutez le bloc suivant √† la configuration i3blocks: </p><br><pre> <code class="plaintext hljs">[active_window] command=/path/to/our/script.sh interval=persist</code> </pre> <br><p>  Devoirs: apprenez √† Grim √† prendre une capture d'√©cran de la fen√™tre actuelle.  Ils disent que de telles choses sont impossibles √† Wayland, mais les hommes en doutent. </p><br><p>  Devoirs 2: apprenez √† i3blocks √† afficher la disposition actuelle du clavier sous forme d'indicateur.  Il y a quelques blocs dans i3blocks-contrib, mais ils affichent du texte au lieu d'un indicateur et ne fonctionnent pas dans Wayland. </p><br><h2 id="prochie-programmy">  Autres programmes </h2><br><p>  <a href="https://github.com/bugaevc/wl-clipboard">wl-clipboard</a> vous permet de travailler avec le presse-papiers depuis le terminal, c'est-√†-dire qu'il remplace xclip et xsel.  Il est particuli√®rement utile pour les utilisateurs de vim, dans lesquels le copier / coller commence √† utiliser <code>"+y</code> / <code>"+p</code> (installez simplement ce paquet, aucune configuration suppl√©mentaire n'est requise). </p><br><p>  <a href="https://github.com/ReimuNotMoe/ydotool">ydotool</a> - remplacement de xdotool. </p><br><p>  <a href="https://gitlab.freedesktop.org/mstoeckl/waypipe/">waypipe</a> - proxy pour la transparence du r√©seau.  Pour √™tre honn√™te, je ne me souviens pas de la derni√®re fois que quelqu'un a pos√© une question relative √† cette fonctionnalit√© sur des forums sp√©cialis√©s.  Peut-√™tre qu'ils ne l'utilisent pas du tout?  Certainement pas. </p><br><p>  KDE Connect  Ajoutez le fichier <code>org.kde.kdeconnect.nonplasma.desktop</code> √† l' <code>org.kde.kdeconnect.nonplasma.desktop</code> (voir les sections pr√©c√©dentes), installez KDE Connect sur votre smartphone et configurez leur connexion - et vous pouvez contr√¥ler la lecture de musique et de vid√©o depuis votre smartphone dans un navigateur avec le plug <a href="https://addons.mozilla.org/ru/firefox/addon/plasma-integration/">-</a> in d' <a href="https://addons.mozilla.org/ru/firefox/addon/plasma-integration/">int√©gration plasma</a> , dans vlc , en cantate, en mpv avec <a href="https://github.com/hoyon/mpv-mpris">le plugin mpv-mpris</a> , et aussi recevoir des notifications en mako.  Mon respect pour le projet KDE pour le d√©veloppement de programmes non clou√©s √† leur √©cosyst√®me. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Vous pouvez √©crire sur la configuration de tout cela (en particulier le panneau i3blocks) √† l'infini, mais il vaut mieux s'arr√™ter ici.  Voici ce que j'ai obtenu: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/s9/qy/q0/s9qyq0rrpk9rzv4bamj1qsooceq.png"></a> </p><br><p>  Allez aussi sur le subreddit <a href="https://www.reddit.com/r/unixporn/">/ r / unixporn</a> et admirez ce que les gens font.  (Cependant, 95% de tout ce qui y est pr√©sent√© est magnifique, mais ne convient absolument pas au travail quotidien :)). </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484378/">https://habr.com/ru/post/fr484378/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484368/index.html">Comment j'ai fait un moteur de recherche pour Telegram</a></li>
<li><a href="../fr484370/index.html">Slurm SRE - apprenez √† assurer le bonheur des utilisateurs</a></li>
<li><a href="../fr484372/index.html">Maison intelligente avec Xiaomi sur l'exemple d'un sauna</a></li>
<li><a href="../fr484374/index.html">Voyage au centre ... image docker. Ou comment t√©l√©charger une image du registre sans docker</a></li>
<li><a href="../fr484376/index.html">Samsung Moscow Center for Artificial Intelligence in stories des employ√©s</a></li>
<li><a href="../fr484380/index.html">D√©m√©nagement - le si√®cle dernier! Alternatives √† std :: move dans ¬´C ++ of the Future¬ª</a></li>
<li><a href="../fr484382/index.html">Algorithme de Bellman-Ford</a></li>
<li><a href="../fr484386/index.html">Meetup AWS_Ru √† Raiffeisenbank</a></li>
<li><a href="../fr484388/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../fr484390/index.html">Glean Insights sur les 18 meilleurs cadres Java √† utiliser en 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>