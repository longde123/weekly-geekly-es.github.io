<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍱 ⛽️ 💶 Controle de ar condicionado Haier baseado em ESP8266 🙋🏿 🤴🏼 🔐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na continuação dos artigos sobre a construção de uma “casa inteligente” ... o 
 
 
 
 ar condicionado da série Haier Lightera tem em seu quadro um mód...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Controle de ar condicionado Haier baseado em ESP8266</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/395533/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na continuação dos </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">artigos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sobre a construção de uma “casa inteligente” ... o </font></font><br>
<br>
<img src="https://habrastorage.org/files/280/6dd/316/2806dd31655941f38656dcdf60dfe906.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ar condicionado da série Haier Lightera tem em seu quadro um módulo WiFi para controlá-lo através de um aplicativo no telefone que funciona através de um serviço em nuvem chinês desconhecido. Para modelos mais antigos, o módulo era uma opção e foi adquirido separadamente; ele é conectado à placa de controle na unidade interna. Em novos modelos, o conector está embaixo de uma guarnição decorativa e, na série Lightera, o módulo já está instalado. Portanto, esta unidade é aplicável a muitos condicionadores de ar da marca Haier.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar o ar condicionado através do módulo WiFi nativo, é necessário fazer o download do aplicativo no seu smartphone / tablet, registrar-se nele, conectar seu smartphone / tablet ao roteador via Wi-Fi. Ligue o ar condicionado no modo de resfriamento em 30 graus com a velocidade mínima do ventilador, verifique se a rede Haier-uAC apareceu e inicie o programa para pesquisar dispositivos e redes. O programa encontra o seu ar condicionado e as redes disponíveis. Você registra sua rede selecionando-a na lista e continua registrando seu modelo de equipamento (ar condicionado). Na minha rede doméstica, o servidor DHCP está desativado no roteador e, para conectar-se à minha rede Wi-Fi no dispositivo conectado, é necessário criar uma nova conexão e registrar-se além do SSID (já que está oculto) e a senha também é um endereço IP estático.É por esse motivo que não pude adicionar meu ar condicionado ao aplicativo, pois, ao adicionar um ar condicionado, ele solicita que eu selecione apenas o ponto de acesso e a senha do WiFi. O aplicativo envia os dados inseridos para o módulo WiFi do ar condicionado e, usando esses dados, ele tenta se conectar ao seu ponto de acesso, esperando receber um endereço IP, mas meu roteador quebra todas as suas esperanças.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aparência do módulo WiFi nativo.</font></font><br>
<br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/fba/97a/5fc/fba97a5fcabe4aea8d7ebba7b4f8ff93.jpg" alt="Aparência do módulo WiFi Haier nativo"></div></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para o teste, eu ainda o conectei através de outro roteador. </font><font style="vertical-align: inherit;">O gerenciamento por meio do aplicativo funciona, mas não há como controlar o ar condicionado sem o aplicativo, por meio do qual o serviço em nuvem não é claro, não há conta pessoal. </font><font style="vertical-align: inherit;">Como resultado, a Haier, como muitos fabricantes de equipamentos, criou seu próprio hardware com sua aplicação, sem a possibilidade de integração com outros sistemas de automação (sem módulos e equipamentos especiais). </font><font style="vertical-align: inherit;">No final, eu decidi fazer meu módulo WiFi com todas as características de um personagem bem conhecido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A base foi tomada ESP8266 12F, que funcionará diretamente com meu servidor usando o protocolo MQTT. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O IOBroker está</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> instalado no servidor </font><font style="vertical-align: inherit;">, que também atua como um servidor MQTT.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Faltava entender o protocolo de troca com o próprio ar condicionado. </font><font style="vertical-align: inherit;">Tendo estudado os circuitos do módulo nativo e da unidade de controle dos modelos anteriores, ficou claro que o módulo WiFi se comunica com o ar condicionado através de um UART regular com níveis TTL. </font><font style="vertical-align: inherit;">Depois de conectar o adaptador UART / USB em paralelo à linha RX / TX e controlar o ar condicionado do aplicativo e do controle remoto, li todos os dados. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foto placa-mãe placa-mãe.</font></font><br>
<br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/9c7/284/74a/9c728474ac914855a7af1e30a8b95b27.jpg" alt="Placa do módulo WiFi nativo da Haier"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 A placa mostra um conversor de 3,3 V DC / DC e conversores de nível lógico. </font><font style="vertical-align: inherit;">A tela não começou a filmar, o que é desconhecido sob ela.</font></font><br>
<br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/415/2ec/a23/4152eca238784c5482da059d7846c0a6.jpg" alt="Placa do módulo WiFi nativo da Haier"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esta é a minha primeira experiência com a reversão de protocolo, mas, na minha opinião, o protocolo acabou sendo muito simples. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A taxa de câmbio é 9600/8-N-1. </font><font style="vertical-align: inherit;">O módulo WiFi envia uma solicitação a cada 13 segundos (13 bytes), para a qual o ar condicionado emite um pacote (37 bytes) com todos os dados. </font><font style="vertical-align: inherit;">Sob o spoiler, uma lista de bytes que acabou sendo desvendada.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protocolo de troca</font></font></b><div class="spoiler_text">1 — FF c <br>
2 — FF c <br>
3 — 22<br>
4 — 00<br>
5 — 00<br>
6 — 00<br>
7 — 00<br>
8 — 00<br>
9 — 01<br>
10 — 01 —  , 02 —  <br>
11 — 4D —  , 6D —  <br>
12 — 5F —  <br>
13 — 00<br>
14 — 1A — 26 , 1B — 27,  <br>
15 — 00<br>
16 — 00<br>
17 — 00<br>
18 — 00 —  , 7F- <br>
19 — 00<br>
20 — 00<br>
21 — 00<br>
22 — 00<br>
23 — 00<br>
24 — 00 — smart, 01 — cool, 02 — heat, 03 — , 04 — DRY, <br>
25 — 00<br>
26 — 00 — max, 01 — mid, 02 — min, 03 — auto — FanSpeed<br>
27 — 00<br>
28 — 00 — ., 01 —     . 02 — / . 03 —  <br>
29 — 00 —    , 80  . <br>
30 — 00 — power off, x1 — power on, (1x ) — ? x9 — QUIET<br>
31 — 00<br>
32 — 00 — fresh off, 01 — fresh on<br>
33 — 00<br>
34 — 00<br>
35 — 00<br>
36 — 00 — 16 , 01 — 17 0E — 30 .  <br>
37 —  .       .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipas curtas</font></font></b><div class="spoiler_text">FF FF 0A 00 00 00 00 00 01 01 4D 02 5B <br>
FF FF 0A 00 00 00 00 00 01 01 4D 03 5C <br>
FF FF 0A 00 00 00 00 00 01 03 00 00 0E  <br>
FF FF 0A 00 00 00 00 00 01 01 4D 01 5A  <br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, para definir a temperatura, é necessário enviar: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
FF FF 22 00 00 00 00 00 01 01 4D 5F 00 00 00 00 00 00 00 00 00 00 00 00 01 00 02 00 00 00 01 00 00 00 00 00 00 04 04 D8 - definido para 20 graus. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nós desenhamos o diagrama de circuito. </font><font style="vertical-align: inherit;">O circuito é alimentado por 5 volts do ar condicionado e, como a tensão de alimentação do ESP8266 é de 3,3 volts, existe um estabilizador linear LM1117 (AMS1117) para a tensão de saída correspondente. </font><font style="vertical-align: inherit;">Os conversores de nível lógico são montados nos elementos R1, Q1, R3 e R2, R3, pois o RXD TXD do módulo ESP8266 não é tolerante a 5 V. Para programar o ESP, os contatos U2 U3 devem ser fechados juntos. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Diagrama de circuito</font></font><br>
<a href=""><div style="text-align:center;"><img src="https://habrastorage.org/files/db8/446/88b/db844688b6cc4090baa37009173340c8.jpg" alt="Esquema"></div><br>
</a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Criamos uma placa de circuito impresso. </font><font style="vertical-align: inherit;">O layout da placa é feito para instalação na caixa a partir do módulo WiFi nativo.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/899/bb3/d26/899bb3d26431439db346242ab24b2dc7.jpg" width="400" alt="Placa de circuito"></div><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/5a5/330/caa/5a5330caae44425ea1dd2a4d58aebf98.jpg" width="400" alt="Placa de circuito"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na foto abaixo, a placa de teste.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/5dd/195/0ab/5dd1950ab3d344e5b1b1e962decf0e49.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O código é escrito em um ambiente Arduino. </font><font style="vertical-align: inherit;">A versão atual está disponível no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">código</font></font></b><div class="spoiler_text"><pre><code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#include &lt;ESP8266WiFi.h&gt;</span></span>
<span class="hljs-meta"><span class="hljs-meta">#include &lt;PubSubClient.h&gt;</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ssid = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* password = <span class="hljs-string"><span class="hljs-string">"..."</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* mqtt_server = <span class="hljs-string"><span class="hljs-string">"xx.xx.xx.xx"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// MQTT</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">IPAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ip</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xx,xx,xx,x</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">//IP </span></span>
<span class="hljs-function"><span class="hljs-function">IPAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gateway</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xx,xx,xx,xx</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span></span>
<span class="hljs-function"><span class="hljs-function">IPAddress </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subnet</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">xx,xx,xx,xx</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-comment"><span class="hljs-comment">// </span></span><font></font>
<font></font>
WiFiClient espClient;<font></font>
<span class="hljs-function"><span class="hljs-function">PubSubClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">client</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">espClient</span></span></span><span class="hljs-function">)</span></span>;<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ID_CONNECT "myhome-Conditioner"</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED     12</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LEN_B   37</span></span><font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_CUR_TMP   13  // </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_CMD       17  // 00- 7F- ???</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_MODE      23  //04 - DRY, 01 - cool, 02 - heat, 00 - smart 03 - </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_FAN_SPD   25  // 02 - min, 01 - mid, 00 - max, 03 - auto</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_SWING     27  //01 -     . 00 - . 02 - / . 03 -  </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_LOCK_REM  28  //80  . 00 -  </span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_POWER     29  //on/off 01 - on, 00 - off (10, 11)-??? 09 - QUIET</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_FRESH     31  //fresh 00 - off, 01 - on</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> B_SET_TMP   35  // </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fresh;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> power;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> swing;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lock_rem;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cur_tmp;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> set_tmp;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fan_spd;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Mode;
<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> prev = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> inCheck = <span class="hljs-number"><span class="hljs-number">0</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> qstn[] = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-comment"><span class="hljs-comment">//byte start[] = {255,255};</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> data[<span class="hljs-number"><span class="hljs-number">37</span></span>] = {}; <span class="hljs-comment"><span class="hljs-comment">// </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>[]   = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">91</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> off[]  = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">77</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">92</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span>[] = {<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>};  <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-comment"><span class="hljs-comment">//byte buf[10];</span></span><font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup_wifi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {<font></font>
  delay(<span class="hljs-number"><span class="hljs-number">10</span></span>);<font></font>
  WiFi.begin(ssid, password);<font></font>
  WiFi.config(ip, gateway, subnet);<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (WiFi.status() != WL_CONNECTED) {<font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
    digitalWrite(LED, !digitalRead(LED));<font></font>
  }<font></font>
  digitalWrite(LED, HIGH);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reconnect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {<font></font>
  digitalWrite(LED, !digitalRead(LED));<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!client.connected()) {
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client.connect(ID_CONNECT)) {<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/connection"</span></span>, <span class="hljs-string"><span class="hljs-string">"true"</span></span>);<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>);<font></font>
      client.subscribe(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/#"</span></span>);<font></font>
      digitalWrite(LED, HIGH);<font></font>
    } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
      delay(<span class="hljs-number"><span class="hljs-number">5000</span></span>);<font></font>
    }<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InsertData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data[], size_t size</span></span></span><span class="hljs-function">)</span></span>{<font></font>
    set_tmp = data[B_SET_TMP]+<span class="hljs-number"><span class="hljs-number">16</span></span>;<font></font>
    cur_tmp = data[B_CUR_TMP];<font></font>
    Mode = data[B_MODE];<font></font>
    fan_spd = data[B_FAN_SPD];<font></font>
    swing = data[B_SWING];<font></font>
    power = data[B_POWER];<font></font>
    lock_rem = data[B_LOCK_REM];<font></font>
    fresh = data[B_FRESH];<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fresh == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fresh"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fresh == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fresh"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock_rem == <span class="hljs-number"><span class="hljs-number">0x80</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Lock_Remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"true"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lock_rem == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Lock_Remote"</span></span>, <span class="hljs-string"><span class="hljs-string">"false"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x01</span></span> || power == <span class="hljs-number"><span class="hljs-number">0x11</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x00</span></span> || power == <span class="hljs-number"><span class="hljs-number">0x10</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x09</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>, <span class="hljs-string"><span class="hljs-string">"quiet"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (power == <span class="hljs-number"><span class="hljs-number">0x11</span></span> || power == <span class="hljs-number"><span class="hljs-number">0x10</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Compressor"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>);<font></font>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
    client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Compressor"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"off"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"ud"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x02</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"lr"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swing == <span class="hljs-number"><span class="hljs-number">0x03</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>, <span class="hljs-string"><span class="hljs-string">"all"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">  </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"max"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"mid"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x02</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"min"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fan_spd == <span class="hljs-number"><span class="hljs-number">0x03</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>, <span class="hljs-string"><span class="hljs-string">"auto"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> b[<span class="hljs-number"><span class="hljs-number">5</span></span>]; <font></font>
  String char_set_tmp = String(set_tmp);<font></font>
  char_set_tmp.toCharArray(b,<span class="hljs-number"><span class="hljs-number">5</span></span>);<font></font>
  client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Set_Temp"</span></span>, b);
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span><font></font>
  String char_cur_tmp = String(cur_tmp);<font></font>
  char_cur_tmp.toCharArray(b,<span class="hljs-number"><span class="hljs-number">5</span></span>);<font></font>
  client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Current_Temp"</span></span>, b);
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x00</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"smart"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x01</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"cool"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x02</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"heat"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x03</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"vent"</span></span>);<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mode == <span class="hljs-number"><span class="hljs-number">0x04</span></span>){<font></font>
      client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>, <span class="hljs-string"><span class="hljs-string">"dry"</span></span>);<font></font>
  }<font></font>
  <font></font>
  String raw_str;<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> raw[<span class="hljs-number"><span class="hljs-number">75</span></span>];
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">37</span></span>; i++){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[i] &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>){<font></font>
       raw_str += <span class="hljs-string"><span class="hljs-string">"0"</span></span>;<font></font>
       raw_str += String(data[i], HEX);<font></font>
     } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
      raw_str += String(data[i], HEX);<font></font>
     }    <font></font>
  }<font></font>
  raw_str.toUpperCase();<font></font>
  raw_str.toCharArray(raw,<span class="hljs-number"><span class="hljs-number">75</span></span>);<font></font>
  client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>, raw);<font></font>
  <font></font>
<span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">byte</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCRC</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req[], size_t size</span></span></span><span class="hljs-function">)</span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> crc = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; size; i++){<font></font>
      crc += req[i];<font></font>
  }<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crc;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> req[], size_t size</span></span></span><span class="hljs-function">)</span></span>{
  <span class="hljs-comment"><span class="hljs-comment">//Serial.write(start, 2);</span></span>
  Serial.write(req, size - <span class="hljs-number"><span class="hljs-number">1</span></span>);<font></font>
  Serial.write(getCRC(req, size<span class="hljs-number"><span class="hljs-number">-1</span></span>));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">inline unsigned </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toHex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch </span></span></span><span class="hljs-function">)</span></span>{
   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( ( ch &gt;= <span class="hljs-string"><span class="hljs-string">'A'</span></span> ) ? ( ch - <span class="hljs-string"><span class="hljs-string">'A'</span></span> + <span class="hljs-number"><span class="hljs-number">0xA</span></span> ) : ( ch - <span class="hljs-string"><span class="hljs-string">'0'</span></span> ) ) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* topic, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">* payload, unsigned </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length</span></span></span><span class="hljs-function">)</span></span> {<font></font>
  payload[length] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>;<font></font>
  String strTopic = String(topic);<font></font>
  String strPayload = String((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)payload);
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Set_Temp"</span></span>){<font></font>
    set_tmp = strPayload.toInt()<span class="hljs-number"><span class="hljs-number">-16</span></span>;
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (set_tmp &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; set_tmp &lt;= <span class="hljs-number"><span class="hljs-number">30</span></span>){<font></font>
      data[B_SET_TMP] = set_tmp;      <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Mode"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"smart"</span></span>){<font></font>
      data[B_MODE] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"cool"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"heat"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"vent"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">3</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"dry"</span></span>){<font></font>
        data[B_MODE] = <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">/</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Fan_Speed"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"max"</span></span>){<font></font>
      data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"mid"</span></span>){<font></font>
        data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"min"</span></span>){<font></font>
        data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"auto"</span></span>){<font></font>
        data[B_FAN_SPD] = <span class="hljs-number"><span class="hljs-number">3</span></span>; <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Swing"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"off"</span></span>){<font></font>
      data[B_SWING] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"ud"</span></span>){<font></font>
        data[B_SWING] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"lr"</span></span>){<font></font>
        data[B_SWING] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"all"</span></span>){<font></font>
        data[B_SWING] = <span class="hljs-number"><span class="hljs-number">3</span></span>; <font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Lock_Remote"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"true"</span></span>){<font></font>
      data[B_LOCK_REM] = <span class="hljs-number"><span class="hljs-number">80</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"false"</span></span>){<font></font>
        data[B_LOCK_REM] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/Power"</span></span>){
     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"off"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"false"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"0"</span></span>){<font></font>
      SendData(off, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(off)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>));
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"on"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"true"</span></span> || strPayload == <span class="hljs-string"><span class="hljs-string">"1"</span></span>){<font></font>
      SendData(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>));
      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strPayload == <span class="hljs-string"><span class="hljs-string">"quiet"</span></span>){<font></font>
        data[B_POWER] = <span class="hljs-number"><span class="hljs-number">9</span></span>;<font></font>
    }<font></font>
  }<font></font>
  <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">//</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strTopic == <span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>){
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf[<span class="hljs-number"><span class="hljs-number">75</span></span>];
    <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> hexbyte[<span class="hljs-number"><span class="hljs-number">3</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>};<font></font>
    strPayload.toCharArray(buf, <span class="hljs-number"><span class="hljs-number">75</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> octets[<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf) / <span class="hljs-number"><span class="hljs-number">2</span></span>] ;
    <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">76</span></span>; i += <span class="hljs-number"><span class="hljs-number">2</span></span>){<font></font>
      hexbyte[<span class="hljs-number"><span class="hljs-number">0</span></span>] = buf[i] ;<font></font>
      hexbyte[<span class="hljs-number"><span class="hljs-number">1</span></span>] = buf[i+<span class="hljs-number"><span class="hljs-number">1</span></span>] ;<font></font>
      data[i/<span class="hljs-number"><span class="hljs-number">2</span></span>] = (toHex(hexbyte[<span class="hljs-number"><span class="hljs-number">0</span></span>]) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | toHex(hexbyte[<span class="hljs-number"><span class="hljs-number">1</span></span>]);<font></font>
    }<font></font>
    Serial.write(data, <span class="hljs-number"><span class="hljs-number">37</span></span>);<font></font>
    client.publish(<span class="hljs-string"><span class="hljs-string">"myhome/Conditioner/RAW"</span></span>, buf);<font></font>
  }<font></font>
  <font></font>
  data[B_CMD] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  data[<span class="hljs-number"><span class="hljs-number">9</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
  data[<span class="hljs-number"><span class="hljs-number">10</span></span>] = <span class="hljs-number"><span class="hljs-number">77</span></span>;<font></font>
  data[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">95</span></span>;<font></font>
  SendData(data, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(data)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>));<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {<font></font>
  pinMode(LED, OUTPUT);<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  setup_wifi();<font></font>
  client.setServer(mqtt_server, <span class="hljs-number"><span class="hljs-number">1883</span></span>);<font></font>
  client.setCallback(callback);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Serial.available() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){<font></font>
    Serial.readBytes(data, <span class="hljs-number"><span class="hljs-number">37</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(Serial.available()){<font></font>
      delay(<span class="hljs-number"><span class="hljs-number">2</span></span>);<font></font>
      Serial.read();<font></font>
    }<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[<span class="hljs-number"><span class="hljs-number">36</span></span>] != inCheck){<font></font>
      inCheck = data[<span class="hljs-number"><span class="hljs-number">36</span></span>];<font></font>
      InsertData(data, <span class="hljs-number"><span class="hljs-number">37</span></span>);<font></font>
    }<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!client.connected()){<font></font>
    reconnect();<font></font>
  }<font></font>
  client.loop();<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> now = millis();
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (now - prev &gt; <span class="hljs-number"><span class="hljs-number">5000</span></span>) {<font></font>
    prev = now;<font></font>
    SendData(qstn, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(qstn)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// </span></span><font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Depois de piscar o ESP8266, colocamos o módulo no ar condicionado. </font><font style="vertical-align: inherit;">Os tópicos são criados automaticamente no servidor MQTT:</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/559/d53/096/559d53096cd3452890825dc485aa1d79.png" alt="Placa de circuito"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Painel de controle do ar condicionado em uma página da web.</font></font><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/e4b/3f0/2e7/e4b3f02e748e4e62b917610f015dbde4.png" alt="Placa de circuito"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Além de gerenciar a partir de uma página da web, o gerenciamento de comandos de voz é organizado, bem como por meio do driver </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Telegram para IOBroker. </font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A um custo, o novo módulo custa cerca de 200 rublos.</font></font><br>
<br>
<a name="anc1"></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A primeira parte - casa inteligente, o começo. </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte Dois - Contador de Visitantes do Banheiro</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt395533/">https://habr.com/ru/post/pt395533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt395523/index.html">O laboratório da Universidade de Stuttgart imprimiu várias lentes com o diâmetro de um cabelo humano</a></li>
<li><a href="../pt395525/index.html">AI derrotou homem em simulação de combate aéreo</a></li>
<li><a href="../pt395527/index.html">Cientistas russos criaram um sistema magnetotrombolítico que decompõe coágulos sanguíneos milhares de vezes mais eficazes que análogos</a></li>
<li><a href="../pt395529/index.html">Kits de educação sobre robótica Robô com Intel Inside</a></li>
<li><a href="../pt395531/index.html">Uma Breve História da Engenharia de Hoverboard: 5 Projetos Mais Famosos</a></li>
<li><a href="../pt395535/index.html">Qual dos graduados vive bem?</a></li>
<li><a href="../pt395537/index.html">Marque</a></li>
<li><a href="../pt395539/index.html">Fabricamos cerveja usando o módulo MP8036multi</a></li>
<li><a href="../pt395541/index.html">Um traje espacial para pousar na Europa e na Lua - o que deveria ser? Entrevista com o designer final de design de fronteira final</a></li>
<li><a href="../pt395543/index.html">Rússia cria uma base aberta de objetos próximos à Terra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>