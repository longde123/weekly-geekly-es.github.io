<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêâ üë∑ üóÑÔ∏è Integraci√≥n continua en Unity: c√≥mo reducir el tiempo de montaje y ahorrar recursos + l√≠nea de pago como regalo üë®üèª‚Äçüöí üöí üññüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos, estoy en contacto con Alexander Panov, un experto t√©cnico de Pixonic. En la empresa, soy responsable de las soluciones entre proyectos y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Integraci√≥n continua en Unity: c√≥mo reducir el tiempo de montaje y ahorrar recursos + l√≠nea de pago como regalo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/484172/"><img src="https://habrastorage.org/webt/gu/jv/tz/gujvtzrponhszxkg1z_lmobwdt8.png"><br><br>  Hola a todos, estoy en contacto con Alexander Panov, un experto t√©cnico de Pixonic.  En la empresa, soy responsable de las soluciones entre proyectos y los perif√©ricos cercanos al proyecto, y hoy quiero compartir mi experiencia y las mejores pr√°cticas. <br><br>  Las plataformas de desarrollo e integraci√≥n continuos, o CI / CD, ahora se utilizan en todas partes en aquellas industrias donde los procesos t√©cnicos iterativos y que funcionan bien desempe√±an un papel decisivo.  En este art√≠culo, hablaremos sobre CI / CD para implementar nuestros proyectos de Unity para el desarrollo de juegos m√≥viles: qu√© problemas encontramos, c√≥mo logramos resolverlos, qu√© mejoras logramos y c√≥mo se registran nuestras construcciones de ensamblaje de tuber√≠as. <br><br>  Acepte de inmediato que usamos TeamCity de <a href="https://habr.com/ru/company/JetBrains/">JetBrains</a> como servidor CI, GitHub como repositorio de repositorios Git y Nexus para almacenar artefactos de ensamblaje. <br><a name="habracut"></a><br>  Entonces, enfrentamos los siguientes problemas: <br><br><ul><li>  <i>Falta de un est√°ndar com√∫n para crear ensamblados:</i> casi todos los desarrolladores ten√≠an acceso al servidor TeamCity, como resultado de lo cual los scripts de ensamblaje se escribieron en diferentes lenguajes de programaci√≥n (BASH, PowerShell, Python), y la l√≥gica a menudo se duplicaba; </li><li>  <i>Flota d√©bil:</i> debido al hecho de que necesitamos construir compilaciones para iOS, tuvimos que usar una flota de autos de Mac mini.  Y dado que en Unity casi todo el ensamblaje tiene lugar en un hilo, los ensamblajes en paralelo en una m√°quina resultaron ser problem√°ticos; </li><li>  <i>Un poco de eficiencia operativa depurada:</i> debido a la baja productividad de nuestro soporte t√©cnico, los ensamblajes tardaron mucho tiempo; </li><li>  <i>Grandes colas en espera de montaje</i> con un n√∫mero suficiente de agentes de TeamCity; </li><li>  <i>Un grupo de agentes separado para cada proyecto:</i> debido a los diferentes entornos instalados en los dispositivos, as√≠ como a los archivos de configuraci√≥n en conflicto entre proyectos (archivos de configuraci√≥n del servidor de cach√©, etc.), fue imposible organizar un grupo com√∫n. </li></ul><br><h2>  ¬øQu√© hiciste como resultado? </h2><br><ul><li>  <b>Repositorio para scripts de ensamblaje</b> </li></ul><br>  En primer lugar, creamos un √∫nico repositorio de scripts para ensamblados en Python.  El lanzamiento se realiza en el entorno de administraci√≥n del entorno virtual de Pipenv con bibliotecas de terceros en su servidor para una actualizaci√≥n r√°pida y control de versiones de las bibliotecas requeridas.  Por lo tanto, proporcionamos un √∫nico punto de entrada para los ensamblajes de todos los proyectos existentes.  Reescribimos todos los scripts en Python, unificamos las configuraciones, llevamos a un est√°ndar com√∫n, eliminamos duplicados del c√≥digo. <br><br><ul><li>  <b>Nueva flota de autos</b> </li></ul><br>  Era necesario reducir el tiempo de montaje, posiblemente reduciendo el n√∫mero de dispositivos utilizados. <br><br>  Inicialmente, ten√≠amos una granja de 13 computadoras Mac mini, pero esta soluci√≥n est√° lejos de ser √≥ptima: debido a la peculiaridad de los ensamblajes en Unity, aproximadamente el 80% del tiempo de ensamblaje se realizar√° en un solo hilo.  Agregue a esto una cantidad s√≥lida de acceso de escritura al disco duro y obtenemos que una Mac mini apenas puede hacer frente a 1-2 ensamblajes simult√°neos. <br><br>  El resultado es la necesidad de revisar el hardware. <br><br>  Durante la b√∫squeda y comparaci√≥n de alternativas para los ensamblajes de Unity, notamos que las computadoras basadas en AMD Ryzen, debido a su rendimiento, permiten ensamblar hasta 8-12 ensamblajes simult√°neamente sin una p√©rdida significativa de rendimiento, y por lo tanto, se decidi√≥ comprar cuatro dispositivos con seis SSD e instalar Dos agentes por disco duro. <br><br>  Una comparaci√≥n de c√≥mo fue y qu√© se convirti√≥ se da en la tabla. <br><br><img src="https://habrastorage.org/webt/zt/u2/sf/ztu2sfkhfk_xhz3v2tke-upw8eu.png"><br><br>  Tiempo de construcci√≥n promedio: <br><br><img src="https://habrastorage.org/webt/x5/x0/5t/x5x05txnepni2gtkygvorspm_le.png"><br><br>  Adem√°s, organizamos la priorizaci√≥n de la selecci√≥n de agentes de TeamCity para reducir el tiempo que la asamblea pas√≥ en la cola.  Anteriormente, cada uno de nuestros proyectos ten√≠a su propio grupo de agentes, y debido a la naturaleza multiplataforma de los juegos, el entorno dependiente del proyecto no permit√≠a crear un grupo com√∫n.  Ahora, despu√©s de la reorganizaci√≥n del sistema, dejamos una serie de agentes asignados a los proyectos, que se utilizan para ensamblajes autom√°ticos, pero pudimos agregar varios agentes comunes para todos los proyectos: se incluyen en el trabajo cuando todos los agentes asociados con el proyecto deseado est√°n ocupados. <br><br><ul><li>  <b>BuildPipeline Library para Unity</b> </li></ul><br>  Comenzaron una peque√±a biblioteca para Unity, que hace posible establecer compilaciones de compilaci√≥n en una ventana del editor de Unity separada, y tambi√©n tiene la capacidad de ejecutar compilaciones de compilaci√≥n en modo de modo por lotes.  Desde la funcionalidad de la biblioteca principal: le permite agregar y eliminar definiciones antes del ensamblaje, deshabilitar bibliotecas de terceros o archivos espec√≠ficos, agregar pasos personalizados de procesamiento previo y posterior, todos sus ajustes se almacenan en archivos de configuraci√≥n, tambi√©n existe la posibilidad de su herencia. <br><br><img src="https://habrastorage.org/webt/87/qc/kv/87qckvdpssyfxuexcy7dirr9zw0.png"><br>  <i>La ventana define en la biblioteca BuildPipeline</i> <br><br><h2>  Nuestra tuber√≠a actual CI / CD </h2><br>  <b>Montaje PullRequest.</b>  Para cada confirmaci√≥n: <br><br><ol><li>  lanzar Unity para verificar errores de compilaci√≥n, definir actualizaciones y generar soluciones; </li><li>  ejecutar pruebas; </li><li>  lanzamiento de un analizador est√°tico: con su ayuda, se realiza un an√°lisis incremental en los archivos afectados por el PullRequest actual; </li><li>  Un mensaje sobre el resultado de la verificaci√≥n, que se guarda en GitHub. </li></ol><br>  <b>Pasos de compilaci√≥n del proyecto Unity:</b> <br><br>  1. Instalar Pipenv y ejecutar scripts para compilar en Python: actualizar e instalar bibliotecas de Python de terceros desde nuestro servidor (proxy del repositorio <a href="https://pypi.org/">pypi.org</a> ) y luego ejecutar el script de compilaci√≥n. <br><br>  2. Preparaci√≥n preliminar para el montaje de la Unidad: <br><br><ul><li>  eliminar la carpeta de la biblioteca, paquetes, activos selectivos (por m√°scara y / o archivos espec√≠ficos), eliminar soluciones (archivos .sln), si es necesario; </li><li>  Generando un archivo de informaci√≥n de ensamblaje: nombre de sucursal, n√∫mero de ensamblaje, etc.  - para su uso posterior en la compilaci√≥n para depuraci√≥n y prueba; </li><li>  configurar un servidor de cach√© Unity para un proyecto.  Cada proyecto tiene el suyo.  Cada desarrollador tambi√©n tiene un servidor de cach√© configurado para un llenado m√°s r√°pido: cuando un desarrollador agrega un nuevo activo, aparecer√° autom√°ticamente en el servidor de cach√© y en el servidor de compilaci√≥n, por lo que la importaci√≥n de activos es mucho m√°s r√°pida. </li></ul><br>  3. Ejecutando Unity para verificar si hay errores de compilaci√≥n, la actualizaci√≥n define y genera soluciones. <br><br>  4. Ejecute pruebas y salga de ellas si hay errores, si es necesario. <br><br>  5. Lanzamiento de Unity BuildPipeline con la configuraci√≥n necesaria y par√°metros de proyecto adicionales. <br><br>  6. Para compilaciones de Android / iOS: inicie Gradle / Xcode: <br><br><ul><li>  Gradle - GradleWrapper; </li><li>  Xcode: archiva el XcodeProject obtenido despu√©s de Unity y c√≥pialo en Mac mini.  Instale y actualice por separado todos los certificados necesarios y los archivos de perfil de aprovisionamiento.  Ejecute los comandos Limpiar, Archivar, Exportar. </li><li>  En la etapa de exportaci√≥n, es posible separar la firma de la compilaci√≥n, el desarrollador y la AppStore.  Dependiendo de lo que recolectemos, seleccione el plist deseado o cada uno a su vez.  En la salida, obtenemos dos archivos: Developer y Release: para la instalaci√≥n en dispositivos de prueba y para cargarlos en la AppStore, respectivamente. </li></ul><br>  7. Verter compilaciones recopiladas y archivos relacionados (registros, resultados de pruebas, .obb, manifiesto para instalar aplicaciones iOS, archivos dsym, etc.) en el almacenamiento de artefactos, para ensamblados independientes: cargar la compilaci√≥n recopilada en el almacenamiento de archivos. <br><br>  8. Generando una p√°gina con un c√≥digo QR para instalar la compilaci√≥n, agregando enlaces desde el repositorio e informaci√≥n de construcci√≥n a la base de datos para seguir trabajando con la aplicaci√≥n PixLauncher. Hablaremos de ello m√°s adelante. <br><br>  9. Mensaje a Slack sobre el resultado del ensamblaje: al que lo lanz√≥, as√≠ como a los canales necesarios. <br><br><img src="https://habrastorage.org/webt/dd/uu/ap/dduuapzv8vkhqbirksspxw8eqra.png"><br>  <i>Tales mensajes llegan a Slack</i> <br><br><h2>  Pasos adicionales </h2><br>  Como paso final del plan, las compilaciones recopiladas se distribuyen a los dispositivos para realizar m√°s pruebas y cargarlas en la tienda. <br><br>  Para instalar compilaciones en dispositivos, escribimos una peque√±a aplicaci√≥n para Android e iOS: PixLauncher.  Lo instalamos en cada dispositivo donde existe la posibilidad de elegir una compilaci√≥n de TeamCity.  Para mayor comodidad, puede establecer filtros en √©l; por ejemplo, agregar una configuraci√≥n a sus favoritos y luego realizar acciones con un solo clic.  En el caso de las compilaciones para Android, si es necesario, el archivo en resoluci√≥n .obb se descarga autom√°ticamente. <br><br>  Adem√°s, organizamos la capacidad de instalar la compilaci√≥n mediante notificaciones push: agregamos un complemento autoescrito al servidor TeamCity, que le permite seleccionar las direcciones MAC de los dispositivos conectados a la red local en la p√°gina de compilaci√≥n.  Luego, se env√≠a una notificaci√≥n push a estos dispositivos con un enlace a la instalaci√≥n, de esta forma ahora se realiza con un solo clic. <br><br>  Por lo tanto, la aplicaci√≥n permiti√≥ acelerar la b√∫squeda de la compilaci√≥n de control de calidad deseada por el departamento y la instalaci√≥n en dispositivos para su posterior verificaci√≥n. <br><br><img src="https://habrastorage.org/webt/8t/nm/_b/8tnm_bbygilukr-n5krvxb1yq_c.png"><br>  <i>Apariencia de la aplicaci√≥n PixLauncher para iOS</i> <br><br><h2>  Finalmente, subir compilaciones a las tiendas </h2><br>  Despu√©s de todas las acciones realizadas, la necesidad de un llenado garantizado de la compilaci√≥n y la metainformaci√≥n sobre la solicitud a las partes se forma naturalmente. <br><br>  Inicialmente, los problemas surgieron principalmente con la AppStore: <br><br><ul><li>  completar la puerta se realiza solo desde un dispositivo MacOS; </li><li>  Debe cargar videos, capturas de pantalla y descripciones de aplicaciones en m√°s de 25 idiomas. </li></ul><br>  Esto condujo a grandes p√©rdidas de tiempo para el llenado y bloqueos en la descarga de archivos al panel de administraci√≥n.  Por lo tanto, pensamos en la automatizaci√≥n de procesos. <br><br>  Como resultado, tenemos lo siguiente: <br><br><ol><li>  En Google Disk, tenemos una tableta con una descripci√≥n de la aplicaci√≥n en todos los idiomas; </li><li>  Los videos y las capturas de pantalla de la aplicaci√≥n est√°n organizados en carpetas con un cierto nombre; </li><li>  En Teamcity, para seleccionar una compilaci√≥n ya ensamblada, hicieron que una configuraci√≥n dependiera de la compilaci√≥n de lanzamiento; </li><li>  A trav√©s de la API de GooglePlay y iTMSTransporter para Apple, complete las compilaciones y la metainformaci√≥n sobre la aplicaci√≥n en la tienda para todos los idiomas necesarios.  En caso de problemas (por ejemplo, con una red), hacemos varios intentos y enviamos un mensaje a Slack con el texto de error. </li></ol><br><img src="https://habrastorage.org/webt/lf/qu/un/lfquunvooflyh40dlkshhvmhg2m.png"><br>  <i>As√≠ es como se carga la compilaci√≥n en la AppStore</i> <br><br><h2>  Como resultado, algunos n√∫meros </h2><br><ul><li>  Ahora tenemos alrededor de 400 ensamblajes y hasta 60 instalaciones de compilaciones en dispositivos por d√≠a; </li><li>  Hay 57 configuraciones de compilaci√≥n diferentes en TeamCity; </li><li>  Utilizamos 22 agentes de TeamCity, mientras que es posible expandirse sin una p√©rdida significativa en el rendimiento a 48 agentes; </li><li>  Existe la posibilidad de expansi√≥n horizontal de la flota. </li></ul></div></div><p>Source: <a href="https://habr.com/ru/post/484172/">https://habr.com/ru/post/484172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484160/index.html">Elusivo talento: Rusia pierde a los mejores profesionales de TI</a></li>
<li><a href="../484164/index.html">La historia de los libros y el futuro de las bibliotecas.</a></li>
<li><a href="../484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../484168/index.html">Escribimos nuestra estrategia para el desplazamiento virtual desde Angular CDK</a></li>
<li><a href="../484170/index.html">Actualizar punto de control de R77.30 a 80.20</a></li>
<li><a href="../484174/index.html">Castle bebe en condiciones "extremas" o c√≥mo participamos en el espect√°culo "DOZOR"</a></li>
<li><a href="../484176/index.html">Implementaci√≥n de la plantilla de estado en Unity</a></li>
<li><a href="../484178/index.html">Conmutador Ethernet inteligente para el planeta Tierra</a></li>
<li><a href="../484180/index.html">PBX virtual Rostelecom: qu√© y c√≥mo se puede hacer a trav√©s de la API</a></li>
<li><a href="../484182/index.html">Xenobots: nanorobots vivos de c√©lulas de rana</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>