<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë™ üìç üßìüèª Convite perigoso ou Como funciona a carga de combate de um email de phishing üêÅ üå•Ô∏è ü¶é</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recentemente, os especialistas do PT ESC descobriram um documento no formato do Publisher chamado ‚ÄúInvitation Invitation 29-30-30 2018.pub‚Äù (1edd5b6a0...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Convite perigoso ou Como funciona a carga de combate de um email de phishing</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/432172/"><img src="https://habrastorage.org/webt/hh/mj/f1/hhmjf18rranoihy6liikn8gvlq0.jpeg"><br><br>  Recentemente, os especialistas do PT ESC descobriram um documento no formato do Publisher chamado ‚ÄúInvitation Invitation 29-30-30 2018.pub‚Äù (1edd5b6a02ec82cec381c1a1ec74a67e).  Neste artigo, mostraremos como um documento de apar√™ncia comum se transforma em um Trojan, permitindo que um invasor capture uma imagem de webcams, grave som por comando ou quando uma janela do Skype for detectada, execute scripts do PowerShell, fa√ßa capturas de tela, copie arquivos de dispositivos de m√≠dia. <a name="habracut"></a><br><br>  Portanto, quando voc√™ abre o documento, uma janela √© exibida com um stub de documento borrado e uma solicita√ß√£o para incluir o script do Microsoft Publisher. <br><br><img src="https://habrastorage.org/webt/6z/gx/0e/6zgx0evgnzve3k9tdrjtlkqhvhe.png"><br><br>  Depois que o usu√°rio o ativa, o script incorporado no documento √© executado em JavaScript.  √â assim: <br><br><img src="https://habrastorage.org/webt/wt/ig/pt/wtigptknnjdcp4noozibkmcisci.png"><br><br>  O resultado do script ser√° a decodifica√ß√£o de dois arquivos, PDF e EXE, do Base64.  Ambos os arquivos ser√£o gravados em C: \ Usu√°rios \ {Nome de usu√°rio} \ AppData \ Roaming \ DBFUpdate.  Assim, os dois arquivos ser√£o executados e o usu√°rio ver√° um esbo√ßo na tela do documento: <br><br><img src="https://habrastorage.org/webt/oc/az/v_/ocazv_kws7t4hvkhq4r5jpqw6xi.png"><br><br><h2>  Treasure Hunter RAT </h2><br>  Os invasores usam um RAT com v√°rios m√≥dulos com um grande conjunto de fun√ß√µes que fornece acesso total √† m√°quina infectada. <br><br>  Recursos de c√≥digo: <br><br><ol><li>  Inteiramente escrito em C ++ com um grande n√∫mero de constru√ß√µes STL usadas internamente. </li><li>  Aplica√ß√£o da biblioteca de refor√ßo, em particular JSON e Archive. </li><li>  Fun√ß√µes de depura√ß√£o (mais na se√ß√£o stager). </li></ol><br><h2>  Trojan principal </h2><br>  O cavalo de Troia principal √© fixado na m√°quina da v√≠tima e √© uma plataforma na qual os m√≥dulos maliciosos s√£o carregados do C2. <br><br>  Primeiro, o stager inicializa o diret√≥rio de trabalho, que posteriormente armazenar√° as informa√ß√µes coletadas pelos m√≥dulos, utilit√°rios necess√°rios para o funcionamento dos m√≥dulos etc. <br><br><img src="https://habrastorage.org/webt/_h/qg/ba/_hqgbarp_rsej6ubiv1v8zuy32c.png"><br><br>  Abaixo est√° a inicializa√ß√£o dos caminhos para criar o diret√≥rio de trabalho: <br><br><img src="https://habrastorage.org/webt/78/tg/ot/78tgotzxv4jl_vrucszwktoaef4.png"><br><br>  Ap√≥s a cria√ß√£o dos diret√≥rios necess√°rios, o principal Trojan coleta informa√ß√µes sobre a m√°quina infectada e as envia ao servidor de controle. <br><br>  Troyan est√° interessado em tais dados: <br><br><ul><li>  identificador da vers√£o do sistema operacional no qual o principal Trojan est√° sendo executado; </li><li>  O idioma da interface padr√£o </li><li>  O n√∫mero da vers√£o principal do SO do Service Pack; </li><li>  nome do computador e identificador da m√°quina (para obter detalhes sobre como obter um identificador da m√°quina, consulte a se√ß√£o sobre o protocolo de rede). </li></ul><br>  √â assim que as informa√ß√µes sobre a m√°quina infectada s√£o coletadas: <br><br><img src="https://habrastorage.org/webt/0n/rn/xn/0nrnxnxdov8bp85g6dmlwzzvwzs.png"><br><br>  Em seguida, o principal Trojan √© corrigido na m√°quina infectada atrav√©s da modifica√ß√£o do valor no registro em HKCU \ Environment \ UserInitMprLogonScript.  Este √© o nome do arquivo execut√°vel que foi alocado durante a inicializa√ß√£o do diret√≥rio de trabalho; nesse caso, √© igual a ‚ÄúDCTHOST.exe‚Äù.  Esse m√©todo √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descrito no blog Hexacorn</a> e tamb√©m foi usado pelo APT28 e pelo grupo Cobalt em seu ComDLLDroper. <br><br><img src="https://habrastorage.org/webt/j3/tl/0g/j3tl0gm0n3zb3vzxfpps_abdgq0.png"><br><br>  E a √∫ltima etapa na inicializa√ß√£o do Trojan principal √© copiar o arquivo execut√°vel do local atual para o diret√≥rio ativo com o mesmo nome que foi selecionado quando o diret√≥rio ativo foi inicializado. <br><br>  Depois que o trojan principal √© inicializado, √© realizada a prepara√ß√£o para o recebimento de comandos.  O m√≥dulo Core √© adicionado √† lista de m√≥dulos em execu√ß√£o, que √© o principal cavalo de Troia.  Em seguida, um comando √© iniciado a partir do m√≥dulo Core com o identificador 0. N√£o h√° implementa√ß√£o desse comando no m√≥dulo principal; em vez disso, √© apenas um stub.  O construtor do objeto do m√≥dulo Core √© apresentado abaixo. <br><br><img src="https://habrastorage.org/webt/mi/hy/us/mihyuspzzqd5fwesqr1em7jyiqu.png"><br><br>  No final, dois threads iniciam.  Um dos threads inicia um timer, que √© ativado por padr√£o a cada segundo e tenta solicitar um comando do C2. <br><br><img src="https://habrastorage.org/webt/o9/53/um/o953um8yermaycyqre2jugxbzly.png"><br><br>  O segundo fluxo carrega bibliotecas adicionais e m√≥dulos padr√£o.  Bibliotecas, como m√≥dulos, t√™m um identificador, mas, diferentemente dos m√≥dulos, os identificadores de biblioteca s√£o negativos, come√ßam em -1, crescem em dire√ß√£o a n√∫meros mais baixos.  Abaixo est√° uma lista de bibliotecas baixadas do C2. <br><br><img src="https://habrastorage.org/webt/8n/bl/pj/8nblpjayad6etstkkqxvwtaplts.png"><br><br><h2>  Recursos de depura√ß√£o do principal Trojan </h2><br>  No in√≠cio de seu trabalho, imediatamente ap√≥s a inicializa√ß√£o, o cavalo de Troia principal define um manipulador de exce√ß√µes atrav√©s do SetUnhandledExceptionFilter, que cont√©m funcionalidades interessantes.  Quando ocorrem exce√ß√µes, elas caem no manipulador, que grava o minidump do aplicativo, al√©m de salvar informa√ß√µes sobre a exce√ß√£o.  Ent√£o ele se reinicia.  Na tela - criando um minidump: <br><br><img src="https://habrastorage.org/webt/1w/sw/3j/1wsw3jy1hd8wpgcvfw0yliwt_yy.png"><br><br><h2>  Protocolo de rede </h2><br>  A troca entre software e C2 ocorre usando um protocolo bin√°rio auto-escrito.  Cada mensagem √© descrita usando o BinPackage (nome retirado do RTTI).  Cada BinPackage √© essencialmente um inv√≥lucro sobre std :: vector, que armazena o conjunto PackageRecord (o nome √© inventado).  PackageRecord √© a unidade m√≠nima para armazenar dados. <br><br><pre><code class="bash hljs">struct PackageRecord { _DWORD dataId; _DWORD datatype; _DWORD szData; char[] data; };</code> </pre> <br>  Mais sobre os campos dessa estrutura: <br><br><ul><li>  <b>dataId</b> - indica o tipo de registro.  A entrada √© um identificador de m√≥dulo, identificador de comando ou carga √∫til. </li><li>  <b>szData</b> - o tamanho dos dados armazenados no registro. </li><li>  <b>tipo de dados</b> √© um tipo de dados. </li></ul><br>  No total, foi registrado o uso de tr√™s tipos de dados: <br><ul><li>  Um valor "0" significa que os dados armazenados no registro devem ser interpretados como um DWORD. </li><li>  O valor "1" - os dados armazenados no registro devem ser interpretados como uma sequ√™ncia ASCIIZ. </li><li>  O valor "2" - os dados armazenados no registro devem ser interpretados como dados criptografados / buffer bruto. </li></ul><br><br>  Ao enviar o BinPackage para o servidor de controle, o identificador da m√°quina √© adicionado a ele.  O identificador √© o GUID da se√ß√£o da qual todos os caracteres especiais s√£o cortados.  Na figura - obtendo o identificador da m√°quina: <br><br><img src="https://habrastorage.org/webt/iw/kn/le/iwknleyhgrfk7tfu2fxiggdx_7w.png"><br><br>  Antes do envio, todos os registros armazenados no BinPackage s√£o coletados seq√ºencialmente em um √∫nico buffer e s√£o criptografados.  Para criptografia, a biblioteca <a href="">WinAES</a> √© <a href="">usada</a> , especificamente AES-128-CBC. <br><br>  Usando o Windows CryptoAPI, duas matrizes pseudo-aleat√≥rias de 16 bytes s√£o geradas.  Um para IV, outro para a chave.  A criptografia √© realizada e os dados criptografados s√£o adicionados novamente ao BinPackage, que cont√©m o pacote criptografado e consiste em tr√™s entradas: <br><br><ul><li>  registro com o ID 0x777 - cont√©m a chave usada para criptografia; </li><li>  registro com o ID 0x555 - cont√©m o IV usado para criptografia; </li><li>  registro com ID 0x999 - cont√©m dados criptografados (em geral, um registro com esse ID indica uma carga √∫til e √© usado n√£o apenas para armazenar dados criptografados). </li></ul><br>  Ap√≥s o final do processo de criptografia, o BinPackage gerado √© novamente coletado em um √∫nico buffer e enviado via solicita√ß√£o HTTP POST ao servidor de gerenciamento 151.80.237.222. <br><br><img src="https://habrastorage.org/webt/zj/8b/dd/zj8bdd1d7hlb1ozmxarkmmkf60q.png"><br><br>  Abaixo est√° um exemplo de um pacote contendo informa√ß√µes da m√°quina: <br><br><img src="https://habrastorage.org/webt/ma/gu/du/magudufvut9bwna3qk9g8atebju.png"><br><br>  E este √© um exemplo de um pacote criptografado com informa√ß√µes do sistema: <br><br><img src="https://habrastorage.org/webt/tv/rm/0s/tvrm0sniivu5dxahli4lfnsnfwa.png"><br><br><h2>  M√≥dulos </h2><br>  Cada m√≥dulo, com exce√ß√£o do Core, √© carregado no servidor de controle.  Todos os m√≥dulos podem ser divididos em duas categorias - m√≥dulos carregados automaticamente e m√≥dulos carregados mediante solicita√ß√£o do servidor de controle. <br><br>  Um exemplo de um pacote solicitando um m√≥dulo: <br><br><img src="https://habrastorage.org/webt/zw/_o/mw/zw_omw8mqjoa74a0gouuylkgnk8.png"><br><br>  Resposta √† solicita√ß√£o do m√≥dulo: <br><br><img src="https://habrastorage.org/webt/9u/2g/qc/9u2gqcvb1mhw4kuky3fl6f1zljq.png"><br><br>  Cada m√≥dulo possui uma interface simples composta por tr√™s fun√ß√µes: chamada ao carregar o m√≥dulo Init, chamada ap√≥s a conclus√£o do fini e uma fun√ß√£o que altera a configura√ß√£o do m√≥dulo.  Cada m√≥dulo tamb√©m possui uma exporta√ß√£o denominada GetModule, que cria um objeto que representa esse m√≥dulo e o retorna ao cavalo de Troia principal.  Todos os m√≥dulos que descobrimos s√£o lan√ßados na mem√≥ria usando carregamento reflexivo. <br><br><img src="https://habrastorage.org/webt/p7/rz/qk/p7rzqkvwrfbybtduak7hfttchgy.png"><br><br>  Al√©m disso, os nomes dos m√≥dulos s√£o fornecidos na forma em que est√£o presentes no RTTI como nomes de classe. <br><br><h2>  M√≥dulo CCore </h2><br>  Este m√≥dulo representa a funcionalidade b√°sica e √© constru√≠do diretamente no cavalo de Troia principal.  Seu construtor pode ser visto na tabela abaixo: <br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="6">  0 0 </td><td>  0 0 </td><td>  Basicamente, um trojan em vez de um comando √© um esbo√ßo, e seu objetivo exato n√£o p√¥de ser estabelecido </td></tr><tr><td>  1 </td><td>  Modificar a configura√ß√£o do m√≥dulo </td></tr><tr><td>  2 </td><td>  Solicitar informa√ß√µes do computador </td></tr><tr><td>  3 </td><td>  Fa√ßa o download do utilit√°rio no servidor de controle </td></tr><tr><td>  4 </td><td>  Solicitar a listagem de um diret√≥rio contendo utilit√°rios </td></tr><tr><td>  5 </td><td>  Fa√ßa o download do m√≥dulo e execute-o </td></tr></tbody></table><br><h2>  M√≥dulo CShell </h2><br>  Este m√≥dulo fornece um shell remoto para uma m√°quina infectada.  Quando o m√≥dulo √© inicializado, √© criado o processo cmd.exe, ao qual est√£o conectados dois pipes: um para entrada padr√£o e outro para sa√≠da padr√£o, atrav√©s do qual os comandos s√£o recebidos e transmitidos do servidor de controle e vice-versa.  Tamb√©m neste momento, um encadeamento √© iniciado, que pega automaticamente toda a sa√≠da e a envia ao servidor de controle.  A figura mostra a inicializa√ß√£o do m√≥dulo CShell. <br><br><img src="https://habrastorage.org/webt/73/g3/6v/73g36vgr-tbimku5nrr-x1r8l1u.png"><br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="4">  2 </td><td>  0 0 </td><td>  Enviar comando para shell </td></tr><tr><td>  1 </td><td>  Imprima o arquivo.  Um arquivo √© lido, o caminho para o qual √© transmitido do servidor de controle e o conte√∫do desse arquivo √© carregado no servidor de controle </td></tr><tr><td>  2 </td><td>  Obtenha uma lista de todos os discos existentes no sistema.  Os dados s√£o enviados para o servidor de controle no formato JSON </td></tr><tr><td>  3 </td><td>  Fa√ßa o download do arquivo no servidor de controle.  O caminho onde salvar o arquivo e os dados s√£o recebidos do servidor de controle </td></tr></tbody></table><br><h2>  M√≥dulo CFileSystemBrowser </h2><br>  Este √© um m√≥dulo passivo, que, mediante solicita√ß√£o, permite que voc√™ receba informa√ß√µes sobre a estrutura do sistema de arquivos.  √â assim que ocorre a inicializa√ß√£o do m√≥dulo CFileSystemBrowser: <br><br><img src="https://habrastorage.org/webt/sm/as/pn/smaspn0xpx9jmukbwfsupllke88.png"><br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="4">  3 </td><td>  0 0 </td><td>  Obtenha uma lista de todos os discos existentes no sistema.  Os dados s√£o enviados para C2 no formato JSON </td></tr><tr><td>  1 </td><td>  Obter lista de diret√≥rios.  A listagem √© gerada no formato JSON </td></tr><tr><td>  2 </td><td>  Imprima o arquivo.  Um arquivo √© lido, o caminho para o qual √© transferido do C2 e o conte√∫do desse arquivo √© carregado para o C2 </td></tr><tr><td>  3 </td><td>  Excluir arquivo  O caminho para o arquivo √© transferido do C2 </td></tr></tbody></table><br><h2>  M√≥dulo CScreenShot </h2><br>  Este m√≥dulo permite tirar capturas de tela ou capturar imagens de uma webcam.  Isso pode ser feito a pedido e com um per√≠odo espec√≠fico no temporizador. <br><img src="https://habrastorage.org/webt/nw/km/qg/nwkmqgynrgbuywc05kwjrvkq1ye.png"><br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="4">  4 </td><td>  0 0 </td><td>  Tire uma captura de tela e envie para o servidor de controle </td></tr><tr><td>  1 </td><td>  Execute um cron√¥metro, ap√≥s o qual uma captura de tela √© tirada da tela da m√°quina.  As capturas de tela resultantes s√£o empacotadas no BinPackage e salvas na pasta logs.  Os nomes dos arquivos s√£o gerados usando a API GetTempFileName com o prefixo "MS_". </td></tr><tr><td>  2 </td><td>  Obtenha v√≠deos de dispositivos dispon√≠veis em uma m√°quina infectada </td></tr><tr><td>  3 </td><td>  Capture um quadro da webcam e envie-o para o servidor de controle </td></tr></tbody></table><br><h2>  M√≥dulo CSender </h2><br>  Este m√≥dulo n√£o est√° ativado inicialmente.  Ele carrega o conte√∫do da pasta de logs no servidor de controle.  √â ativado quando chega uma solicita√ß√£o para alterar a configura√ß√£o, que cont√©m o per√≠odo de verifica√ß√£o. <br><br><img src="https://habrastorage.org/webt/wd/64/0e/wd640e65m5umn66eyqrg1vuwolu.png"><br><br><h2>  M√≥dulo CKeylogger </h2><br>  Este m√≥dulo tamb√©m n√£o est√° ativado inicialmente.  √â ativado quando chega uma solicita√ß√£o de altera√ß√£o na configura√ß√£o que cont√©m o tamanho do buffer no qual o log est√° armazenado.  A intercepta√ß√£o de entrada √© realizada atrav√©s da entrada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bruta</a> .  Al√©m disso, o keylogger monitora a janela na qual o usu√°rio faz uma entrada e registra seu t√≠tulo. <br><br><img src="https://habrastorage.org/webt/wu/ek/r6/wuekr6dftcwhuubqmce3h5n49vg.png"><br><br><h2>  M√≥dulo CDictaphone </h2><br>  Este m√≥dulo grava o som por comando ou mediante a detec√ß√£o de uma janela do Skype.  Quando iniciado, ele inicia um encadeamento que lista todas as janelas e suas janelas filho no sistema e procura a janela entre as classes cujo nome de classe √© TLiveConversation ou TCallMonitorControl.  Se uma janela desse tipo foi encontrada, a grava√ß√£o inicia.  Abaixo est√° a inicializa√ß√£o do m√≥dulo CDictaphone: <br><br><img src="https://habrastorage.org/webt/y7/kq/e0/y7kqe0xqb1lytearyqn--ojslpu.png"><br><br>  E janela de pesquisa do Skype <br><br><img src="https://habrastorage.org/webt/6j/49/br/6j49brec889qzpw8hqqd0mjo-5g.png"><br><br>  A grava√ß√£o √© feita atrav√©s do MCI enviando comandos especiais.  √â assim que o ciclo de grava√ß√£o do m√≥dulo CDictaphone se parece: <br><br><img src="https://habrastorage.org/webt/nh/ef/zk/nhefzkr0smgjs0xpnabh9oglqzy.png"><br><br>  Ap√≥s fechar a janela ou receber um comando para concluir a grava√ß√£o, os dados recebidos s√£o salvos em uma pasta tempor√°ria e, em seguida, codificados pelo codificador MP3 coxo (√© considerado um utilit√°rio e j√° deve estar carregado, n√£o foi poss√≠vel obt√™-lo no servidor de controle).  O arquivo codificado √© salvo na pasta logs.  Gerar um nome de pasta √© semelhante a gerar nomes para capturas de tela. <br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="3">  7 </td><td>  0 0 </td><td>  Comece a gravar e termine ap√≥s 15 minutos </td></tr><tr><td>  1 </td><td>  Parar a grava√ß√£o </td></tr><tr><td>  2 </td><td>  Verificar status: est√° gravando em andamento </td></tr></tbody></table><br><h2>  M√≥dulo CProcessesManager </h2><br>  Este √© um m√≥dulo passivo, capaz de retornar uma lista de processos mediante solicita√ß√£o ou finaliza√ß√£o pelo PID passado a ele. <br><br><img src="https://habrastorage.org/webt/us/if/sf/usifsfffgu9i_sfbbus6xc5_ch4.png"><br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="2">  8 </td><td>  0 0 </td><td>  Retorna uma lista de processos: seus nomes, PID e o nome do usu√°rio que possui o processo. </td></tr><tr><td>  1 </td><td>  Conclus√£o do processo PID </td></tr></tbody></table><br><h2>  M√≥dulo CDownloader </h2><br>  O m√≥dulo foi projetado para fazer upload de arquivos grandes no servidor de controle.  Realiza a transmiss√£o de dados por partes, cujo tamanho √© estabelecido por sua configura√ß√£o.  O m√≥dulo l√™ dados de um arquivo, o caminho para o qual recebe do servidor de controle e empacota peda√ßos no BinPackage.  Para cada BinPackage que cont√©m o peda√ßo, uma entrada com o identificador 0x888 √© adicionada, incluindo o caminho para o arquivo.  Depois de passar cada peda√ßo, o sono √© realizado por 5 segundos. <br><img src="https://habrastorage.org/webt/ch/-1/wj/ch-1wjtsdqiwbglodlmf25cp3om.png"><br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td rowspan="3">  9 </td><td>  0 0 </td><td>  Stub, falha ao definir o valor exato </td></tr><tr><td>  1 </td><td>  Realiza a transfer√™ncia de uma grande quantidade de dados (0x500000 bytes), ap√≥s o que mede o tempo gasto na transfer√™ncia e envia esse valor para C2 </td></tr><tr><td>  2 </td><td>  Baixar um arquivo de uma m√°quina </td></tr></tbody></table><br><h2>  M√≥dulo CPS </h2><br>  Este m√≥dulo permite executar scripts do PowerShell. <br><br><img src="https://habrastorage.org/webt/ua/nn/vn/uannvn5wtvk7p2jnfaz6exur2ia.png"><br><table><tbody><tr><th width="100">  ID do m√≥dulo </th><th width="100">  ID da equipe </th><th>  Descri√ß√£o do produto </th></tr><tr><td>  10 </td><td>  0 0 </td><td>  Recebe um script do PowerShell do C2 e o executa </td></tr></tbody></table><br><h2>  M√≥dulo CDeviceMonitor </h2><br>  Um m√≥dulo passivo que monitora os dispositivos de m√≠dia conectados e copia os arquivos deles.  Ele usa mensagens de transmiss√£o WM_DEVICECHANGE para detectar a conectividade do dispositivo.  Ap√≥s conectar o dispositivo ao servidor de controle, s√£o enviadas informa√ß√µes sobre quando o dispositivo foi conectado, seu r√≥tulo de volume e o caminho para o dispositivo.  O c√≥digo usado para obter o caminho para o dispositivo √© muito semelhante a isso.  Todos os arquivos s√£o copiados para a pasta logs.  Os nomes s√£o gerados da mesma maneira que para capturas de tela.  O arquivo fsIndex.dat √© criado separadamente, no qual o dicion√°rio serializado com boost :: archive est√° localizado.  Este dicion√°rio armazena os caminhos originais para os arquivos que foram copiados e seus hashes MD5.  Abaixo est√° o recebimento do DevicePath: <br><br><img src="https://habrastorage.org/webt/3y/k0/ap/3yk0apdk8elf3rhhjqnsako0zne.png"><br><br>  Como ep√≠logo, v√°rias recomenda√ß√µes: <br><br><ul><li>  N√£o √© necess√°rio abrir anexos em cartas de destinat√°rios desconhecidos, muito menos incluir um script do Microsoft Publisher. </li><li>  N√£o √© menos perigoso clicar nos links nas cartas de remetentes desconhecidos.  O site para onde voc√™ vai pode hospedar malware que ser√° baixado automaticamente para o seu PC. </li><li>  Voc√™ deve atualizar regularmente o software, especialmente o Microsoft Windows e o Microsoft Office, que fechar√£o o acesso a uma ampla variedade de malware. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt432172/">https://habr.com/ru/post/pt432172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432160/index.html">V√≠deo do Android Kolesa Mobile: sobre desenvolvimento modular, interface do usu√°rio orientada por back-end e integra√ß√£o cont√≠nua</a></li>
<li><a href="../pt432162/index.html">‚ÄúTentamos contar hist√≥rias da vida real‚Äù: sobre o programa Heisenbug 2018 em Moscou</a></li>
<li><a href="../pt432166/index.html">Apache NiFi: o que √© e uma breve vis√£o geral dos recursos</a></li>
<li><a href="../pt432168/index.html">Autoridades chinesas coletam informa√ß√µes de ve√≠culos el√©tricos de cidad√£os do pa√≠s</a></li>
<li><a href="../pt432170/index.html">Transporte um data center em 14.400 segundos</a></li>
<li><a href="../pt432174/index.html">Como desenvolver um produto de software com compet√™ncia e efic√°cia</a></li>
<li><a href="../pt432176/index.html">Como dobramos a velocidade de trabalhar com o Float em Mono</a></li>
<li><a href="../pt432178/index.html">... e uma garantia para os projetores - aumentar</a></li>
<li><a href="../pt432180/index.html">Como impulsionar sua carreira atrav√©s do GitHub</a></li>
<li><a href="../pt432182/index.html">Recolhemos correio sem sms e registo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>