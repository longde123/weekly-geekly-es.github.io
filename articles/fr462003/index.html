<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèæ üßëüèº‚Äçü§ù‚Äçüßëüèº üêõ Comment j'ai post√© PWA sur Svelte sur Google Play üë®üèº‚Äçüî¨ üòè ü§£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="J'aime la musique m√©tal de diff√©rentes directions. Pour suivre les nouveaux produits, j'ai fait un analyseur qui recherche de nouveaux albums et les m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment j'ai post√© PWA sur Svelte sur Google Play</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462003/"><p>  J'aime la musique m√©tal de diff√©rentes directions.  Pour suivre les nouveaux produits, j'ai fait un analyseur qui recherche de nouveaux albums et les met dans la base de donn√©es.  Pendant l'existence de l'application, je n'ai presque pas touch√© l'analyseur, bien qu'il soit loin d'√™tre id√©al, mais le front-end a √©t√© refait plusieurs fois. </p><br><img src="https://habrastorage.org/webt/mr/a8/mm/mra8mmaxfr4odearjgnfbtisbu0.png" alt="metalz.web.app"><br><p>  Under the cat est une histoire sur la fa√ßon dont j'ai copi√© l'application de react-native vers Svelte et l'ai publi√©e sur Google Play. </p><a name="habracut"></a><br><h2 id="sozdanie-prilozheniya">  Cr√©ation d'application </h2><br><p>  La premi√®re version de Metalz a √©t√© √©crite dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">react</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mobx-state-tree</a> .  Ensuite, j'ai voulu mettre l'application sur Google Play et tout refaire sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">react-native en</a> utilisant le mod√®le d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">expo</a> .  Lorsque Google, au risque de suppression, a exig√© une version 64 bits, j'ai tout r√©√©crit sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Svelte</a> .  √Ä titre de comparaison, le build on react pesait ~ 300 Ko, le build sur Svelte ~ 90 Ko.  Je n'ai effectu√© aucune optimisation d'assemblage, seulement des mod√®les standard. </p><br><h2 id="dobavlenie-reklamy">  Ad Ad </h2><br><p> Dans l'application react-native, j'ai utilis√© des publicit√©s ad-mob, mais elle ne prend pas en charge la plate-forme Web.  J'ai d√©cid√© de connecter AdSence, mais je n'ai pas r√©ussi la mod√©ration.  Le refus a indiqu√© qu'il n'y avait pas de contenu sur mon site et des recommandations ont √©t√© donn√©es pour la r√©daction d'articles de qualit√©.  Et moi, pour ainsi dire, je n'ai pas d'articles, donc l'appel a √©galement √©chou√©.  J'ai d√ª changer de fournisseur de publicit√©.  Le choix s'est port√© sur le r√©seau publicitaire Yandex.  J'ai fait le composant Svelte, dans le module dont le compteur de bloc d'annonces est sorti.  C'est une pour toutes les instances du composant, vous pouvez donc utiliser cette option dans des rubans √† d√©filement infini. </p><br><div class="spoiler">  <b class="spoiler_title">Ad.svelte</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"module"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">let</span></span></span><span class="javascript"> id = </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">import</span></span></span><span class="javascript"> { onMount } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">from</span></span></span><span class="javascript"> </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"svelte"</span></span></span><span class="javascript">; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">const</span></span></span><span class="javascript"> internalId = id; onMount(</span><span class="hljs-function"><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="javascript"><span class="hljs-function"> =&gt;</span></span></span><span class="javascript"> { id += </span><span class="hljs-number"><span class="javascript"><span class="hljs-number">1</span></span></span><span class="javascript">; (</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">w, d, n, s, t</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ w[n] = w[n] || []; w[n].push(</span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ Ya.Context.AdvManager.render({ </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">blockId</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"RA--1"</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">renderTo</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">`yandex_rtb_R-A--</span></span><span class="hljs-subst"><span class="javascript"><span class="hljs-string"><span class="hljs-subst">${internalId}</span></span></span></span><span class="javascript"><span class="hljs-string">`</span></span></span><span class="javascript">, </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">async</span></span></span><span class="javascript">: </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript"> }); }); t = d.getElementsByTagName(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"script"</span></span></span><span class="javascript">)[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">]; s = d.createElement(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"script"</span></span></span><span class="javascript">); s.type = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"text/javascript"</span></span></span><span class="javascript">; s.src = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"//an.yandex.ru/system/context.js"</span></span></span><span class="javascript">; s.async = </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">; t.parentNode.insertBefore(s, t); })(</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">, </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.document, </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"yandexContextAsyncCallbacks"</span></span></span><span class="javascript">); }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">{</span></span></span><span class="hljs-tag">`</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">yandex_rtb_R-A-</span></span></span><span class="hljs-tag"></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span><span class="hljs-tag">${</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">internalId</span></span></span><span class="hljs-tag">}`} /&gt;</span></span></code> </pre> </div></div><br><h2 id="dobavlenie-funkcionala-pwa">  Ajout de fonctionnalit√©s PWA </h2><br><p>  Apr√®s la r√©daction de la demande, j'avais une question sur l'assembl√©e.  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">svelte-template</a> ne peut pas ajouter de hachage √† un bundle.  Je n'ai pas install√© le collecteur, mais j'ai imm√©diatement pris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sapper</a> .  Hors de la bo√Æte, j'ai obtenu un assemblage de bundle avec un hachage, SSR, PWA et routage.  Vous pouvez en lire plus dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . </p><br><h2 id="sborka-apk">  Build apk </h2><br><p>  La construction de l'application s'est av√©r√©e assez simple.  J'ai utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette instruction</a> . <br>  N'oubliez pas de remplacer les ic√¥nes par les v√¥tres, cela n'est pas mentionn√© dans le tutoriel. <br>  La taille de l'apk avec PWA √† l'int√©rieur s'est av√©r√©e ~ 1,3 Mo.  Le paquet natif r√©actif pesait ~ 16,4 Mo.  Je n'ai effectu√© aucune optimisation d'assemblage. </p><br><h2 id="publikaciya-v-google-play">  Publier sur Google Play </h2><br><p>  Apr√®s avoir envoy√© la demande de v√©rification, ma publication a √©t√© refus√©e pour violation des conditions. </p><br><blockquote>  √âtat de l'application MetalZ - Nouvelles versions de musique en m√©tal (com.az67128.metalz): suspension de Google Play en raison d'une violation des r√®gles <br><br>  Lors de l'examen, nous avons constat√© que votre application enfreignait les <strong>r√®gles relatives</strong> aux <strong>Webviews et</strong> aux <strong>spams d'affiliation</strong> .  Nous n'autorisons pas les applications dont le but principal est de g√©n√©rer du trafic d'affiliation vers un site Web ou de fournir une vue Web d'un site Web sans l'autorisation du propri√©taire ou de l'administrateur du site Web. </blockquote><p>  Ensuite, j'ai d√©pos√© un appel, o√π j'ai indiqu√© que la proc√©dure de confirmation TWA avait √©t√© effectu√©e, j'ai joint l'√©cran du G√©n√©rateur et testeur de liste de relev√©s et un lien vers le fichier assetlinks.json. <br>  L'application a √©t√© d√©verrouill√©e apr√®s quelques jours.  Ce faisant, j'ai re√ßu des conseils du support: </p><br><blockquote>  √Ä l'avenir, si vous avez la preuve de l'autorisation d'utiliser la propri√©t√© intellectuelle d'un tiers, vous pouvez la soumettre √† l'avance √† notre √©quipe en utilisant ce formulaire.  Le lien se trouve √©galement sur la page de votre fiche Play Store dans la section Description compl√®te. </blockquote><p>  Par cons√©quent, si vous pr√©voyez de publier PWA et que vous souhaitez √©viter les probl√®mes, envoyez √† l'avance une preuve de propri√©t√© du domaine. </p><br><p>  Si vous pr√©voyez de faire de la publicit√© dans votre application, la publication pourrait vous √™tre refus√©e en l'absence d'une politique d'utilisation.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le g√©n√©rateur de politique de confidentialit√© de l'application</a> m'a aid√©. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  La publication d'une application PWA sur Google Play a √©t√© plus facile que ce √† quoi je m'attendais.  Des pros, j'ai eu: </p><br><ul><li>  Application l√©g√®re; </li><li>  Une base de code; </li><li>  Mises √† jour sans Google Play. </li></ul><br><p>  Le code source de l'application Svelte peut √™tre consult√© dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gitlab'e</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr462003/">https://habr.com/ru/post/fr462003/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461989/index.html">D√©veloppement d'une interface de jeu pour diff√©rentes proportions d'√©crans</a></li>
<li><a href="../fr461993/index.html">Comment devenir une √©picerie d'un ¬´designer r√©gulier¬ª</a></li>
<li><a href="../fr461995/index.html">Comment utiliser les proxys r√©sidents pour le marketing et la promotion de sites Web</a></li>
<li><a href="../fr461997/index.html">Optimisation des performances des requ√™tes dans PostgreSQL</a></li>
<li><a href="../fr461999/index.html">Une autre version de l'environnement de d√©veloppement WordPress (docker, wp-cli)</a></li>
<li><a href="../fr462005/index.html">Caract√©ristiques de Google PageSpeed: am√©lioration de l'√©valuation du site et du classement de recherche</a></li>
<li><a href="../fr462007/index.html">D√©veloppement de scripts Python robustes</a></li>
<li><a href="../fr462009/index.html">Tendances de programmation: √† quoi s'attendre en 2020?</a></li>
<li><a href="../fr462011/index.html">G√©oservices Web. Aper√ßu des solutions modernes</a></li>
<li><a href="../fr462013/index.html">Historique des probl√®mes de migration du stockage Docker (racine Docker)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>