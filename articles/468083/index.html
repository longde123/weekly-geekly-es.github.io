<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöõ üëØ ‚õπÔ∏è Android Camera2 API desde el hervidor de agua üôãüèº üë©üèΩ‚Äçü§ù‚Äçüë®üèæ üë©üèª‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No hace mucho tiempo, estaba ocupado con mi m√°quina rob√≥tica, tratando de ponerle un tel√©fono inteligente ANDROID. Mi, es decir, su tarea, era hacer q...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android Camera2 API desde el hervidor de agua</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468083/"><img src="https://habrastorage.org/webt/kk/8_/gf/kk8_gf5d1vt1kyxcb_vkbjqwpnk.jpeg"><br><br>  No hace mucho tiempo, estaba ocupado con mi m√°quina rob√≥tica, tratando de ponerle un tel√©fono inteligente ANDROID.  Mi, es decir, su tarea, era hacer que el carro evolucionara progresivamente.  Para que ella, por as√≠ decirlo, pudiera sentir el mundo con sus sensores, mirarlo con su ojo (c√°mara), escuchar con un micr√≥fono y maldecir por el altavoz.  Los recursos AVR, por supuesto, no fueron suficientes para esto, por lo que el microcontrolador que estaba en el carrito se movi√≥ a un nivel inferior, en alg√∫n lugar de la m√©dula espinal para controlar motores y varios reflejos no condicionados. <br><br>  Pero algo extra√±o, cuando comenc√© a escribir una aplicaci√≥n para un tel√©fono inteligente, un ESTUDIO IDE ANDROID malo comenz√≥ a tachar constantemente mi c√≥digo y llamarlo obsoleto. <br><br>  c√°mara = <s>c√°mara.</s>  abierto (); <br><br>  Especialmente, como puedes ver, en aquellas partes donde intent√© trabajar con la c√°mara.  Fue muy decepcionante porque le√≠ en Internet y aprend√≠ muchas lecciones sobre trabajar con Android y c√°mara <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> e incluso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Nada fue tachado all√≠.  Y se llamaba la API de la c√°mara.  Todo all√≠ era simple y l√≥gico.  Pero Google tercamente me empuj√≥ hacia alg√∫n tipo de <a href="">API Camera2</a> . <br><br>  Mir√© all√≠ y simplemente me met√≠ en problemas con la cantidad de diferentes devoluciones de llamada, constructores, controladores y loopers para cada l√≠nea del c√≥digo de demostraci√≥n.  Era completamente incomprensible qu√© manera de abordar esto si eres un aficionado com√∫n, no un desarrollador de Android.  Adem√°s, hay incluso algunos art√≠culos sobre la API de Camera2 en la red hoy en d√≠a, aunque esta actualizaci√≥n parece ser como hace cuatro a√±os.  Pero todo lo que encontr√© fue un art√≠culo en Hacker en 2016, una publicaci√≥n en tres partes de hermanos ucranianos del mismo a√±o, una publicaci√≥n doble sobre Habr√© en 2017 y un art√≠culo Understanding Camera2 del meg√°fono japon√©s Tomoaki Imai.  Y esto tambi√©n me refiero a cierta informaci√≥n estructurada y formalizada, y no fragmentos de c√≥digo como "ver c√≥mo puedo" y hojas en el estilo "mira el c√≥digo pliz, nada funciona para m√≠" dispersos en Internet. <br><br>  Y ahora, si todav√≠a te preguntas por qu√© necesitaba cortar mi publicaci√≥n sobre este tema <br>  ya en 2019, luego bienvenidos a cat. <br><a name="habracut"></a><br>  En realidad, me gust√≥ el art√≠culo del Hacker porque me dio al menos una visi√≥n general de por qu√© demonios se introdujo el nuevo paradigma de trabajar con la c√°mara.  Tambi√©n qued√≥ claro por qu√© se necesitaban algunos m√©todos nuevos que no estaban en la API anterior.  Pero escribir un programa de trabajo para este art√≠culo fue completamente imposible, porque los autores, al parecer, como verdaderos hackers, citaron solo los nombres de los m√©todos, bueno, tal vez todav√≠a haya un par de l√≠neas de c√≥digo adicional.  Pero esto categ√≥ricamente no fue suficiente para m√≠. <br><br>  La publicaci√≥n sobre Habr√© fue buena, no discuto, e incluso entend√≠ los primeros p√°rrafos, pero ese era el punto, porque el autor de la publicaci√≥n derrot√≥ a la c√°mara usando RxJava2, lo que autom√°ticamente me excluy√≥ de la cantidad de lectores adicionales.  Normalmente tratar√≠a con OOP, pero aqu√≠ hay alg√∫n tipo de programaci√≥n reactiva. <br><br>  El art√≠culo japon√©s era a√∫n mejor, incluso si no escrib√≠a en su idioma nativo.  Pero tampoco conozco a Kotlin, aunque, por supuesto, me alegr√© por los desarrolladores nacionales y apreci√© la brevedad de su sintaxis, en contraste con el vermicelli JAVA que estaba en la p√°gina de desarrolladores de Google (por cierto, con esta p√°gina, tambi√©n estaba claro para m√≠ que claramente no mucho). <br><br>  El √∫ltimo art√≠culo que me trajo beneficios pr√°cticos fue un post de tres partes de la fraternal Ucrania.  Incluso lanc√© algo all√≠ y vi algo all√≠.  Pero desafortunadamente, en la tercera parte, el autor del art√≠culo estaba muy cansado y tambi√©n comenz√≥ a emitir c√≥digo en fragmentos que no cuadraban con mi conjunto de trabajo.  Adem√°s, al final, el autor estaba completamente molesto, porque obtuvo la imagen de la paleta de colores incorrecta que estaba contando. <br><br><img src="https://habrastorage.org/webt/de/zn/rn/deznrnniikuzh8w4k1fdmxxbikq.jpeg"><br><br>  Digamos que esto se debe a que la versi√≥n de Lollipop es 5.0 y hay un error.  Necesita actualizar a Lollipop 5.1 y luego todo estar√° bien.  Pero de alguna manera todav√≠a no.  Y tambi√©n los ucranianos da√±inos se aferraron al art√≠culo de JAVA SCRIPT, y al copiar el c√≥digo se verti√≥ una gran cantidad de basura en el texto del programa.  Chicos, bueno, no pueden hacer eso ... Tuve que instalar un complemento especial en Firefox. <br><br>  Por lo tanto, tuve que levantar el estandarte ca√≠do y terminar el trabajo hasta el final, lo que, por supuesto, requiri√≥ un esfuerzo mental tit√°nico.  Y dado que de alguna manera fue una pena estar satisfecho con solo darme cuenta de que se obtuvo un resultado de trabajo, quer√≠a compartirlo con teteras aficionados.  Adem√°s, esto est√° lejos del final de la historia.  Todav√≠a necesito aprender c√≥mo transferir video en vivo desde la c√°mara de Android a la computadora (el robot rob√≥tico debe desarrollarse, esta es la ley de la evoluci√≥n) y no en pedazos, como lo cegu√©, sino sin problemas.  Y existen tales obst√°culos de Mont Blanc en forma de c√≥decs de medios y otras cosas que simplemente son de hojalata. <br><br>  Pero, por otro lado, todo puede terminar en completa decepci√≥n.  Y no porque no puedan escalar el Mont Blanc. <br><br><div class="spoiler">  <b class="spoiler_title">Y porque ahora los fabricantes de tel√©fonos inteligentes est√°n desarrollando enfoques completamente nuevos para la fabricaci√≥n de c√°maras.</b> <div class="spoiler_text">  <i>Hace un mes, se filtr√≥ un rumor sobre los tel√©fonos inteligentes Nokia con cinco c√°maras principales.</i>  <i>¬øC√≥mo relacionarse con esto?</i>  <i>¬øUn rumor interesante y prometedor u otra cosa extra√±a?</i>  <i>No importa cu√°n √∫nico pueda parecer ese dise√±o, Nokia ciertamente no podr√° convertirse en pionero en la introducci√≥n de una cantidad inusual de lentes y sensores en dispositivos compactos.</i>  <i>La c√°mara Light L16 ya estaba equipada con 16 lentes en 2015, y la compa√±√≠a, obviamente, tiene un nuevo prototipo en funcionamiento.</i>  <i>Arriba puede ver c√≥mo podr√≠a verse potencialmente.</i> <i><br><br></i>  <i>Despu√©s de que apareciera la c√°mara triple en el Huawei P20 Pro, la transici√≥n a un tel√©fono inteligente con cinco c√°maras ya no suena tan c√≥mica como podr√≠a haber sido hace un par de a√±os.</i>  <i>Sin embargo, la pregunta principal sigue siendo: ¬øcu√°l es el punto?</i> <i><br></i>  <i>¬øQu√© hacer con tantas lentes?</i> <i><br><br></i>  <i>Lo primero que viene a la mente es la variedad de tipos de sensores de c√°mara disponibles en el mercado moderno de tel√©fonos inteligentes y la capacidad de agregar m√°s.</i>  <i>¬øPor qu√© elegir entre gran angular, telefoto, retrato con bokeh o monocromo, si puede obtener todo esto en un solo dispositivo?</i> <i><br><br></i>  <i>Siendo te√≥ricamente posible, tal dise√±o ser√≠a bastante inc√≥modo de usar.</i>  <i>El software tendr√° que cambiar entre modos autom√°ticamente u ofrecer un conjunto complejo de opciones para el usuario.</i>  <i>Adem√°s, el desarrollo de dicho dise√±o ser√≠a muy costoso por todas las dudosas ventajas de tal soluci√≥n.</i>  <i>Cada c√°mara funcionar√≠a en su mayor parte de forma independiente, y era poco probable que los compradores usaran una gran cantidad de modos.</i>  <i>Y no est√° claro cu√°nto estar√≠an dispuestos a pagar por dicha funcionalidad.</i>  <i>Por lo tanto, las c√°maras con m√∫ltiples m√≥dulos deber√≠an poder hacer m√°s para atraer al usuario.</i> <i><br><br></i>  <i>Huawei P20 Pro ya ofrece su versi√≥n de c√≥mo varios m√≥dulos de c√°mara pueden trabajar juntos para dar un resultado interesante.</i>  <i>Estamos hablando de tecnolog√≠as de Huawei, como el Monocromo y el Zoom H√≠brido.</i>  <i>El primero mejora el rango din√°mico de cuadros est√°ndar combinando datos RGB regulares con un sensor fotosensible en blanco y negro.</i>  <i>Y Zoom h√≠brido promete a√∫n m√°s: combina datos de m√∫ltiples c√°maras para aumentar la resoluci√≥n de la imagen para un mejor zoom.</i>  <i>Como resultado, en el P20 Pro 8 MP, el sensor de teleobjetivo le permite disparar con una resoluci√≥n de 10 MP con zoom de 3x y 5x.</i> <i><br></i>  <i>Mayor resoluci√≥n - M√°s flexibilidad</i> <i><br><br></i>  <i>La primera c√°mara Light L16 funcion√≥ de manera similar, utilizando espejos de periscopio para ajustar los m√≥dulos de la c√°mara en un cuerpo compacto.</i>  <i>La c√°mara tom√≥ datos de varios m√≥dulos a 28, 70 y 150 mm, dependiendo del nivel de zoom.</i>  <i>El resultado fue una gran toma de 52 MP tomada desde 10 √°ngulos ligeramente diferentes disponibles en niveles de aumento de hasta 5x.</i>  <i>El concepto del nuevo modelo, desarrollado para tel√©fonos inteligentes, funciona con 5-9 lentes.</i>  <i>Tal m√≥dulo de c√°mara es capaz de tomar grandes fotograf√≠as de 64 megap√≠xeles.</i> <i><br><br></i>  <i>Esta idea de disparos m√∫ltiples tambi√©n agrega beneficios al disparar con poca luz y en HDR con m√∫ltiples aperturas.</i>  <i>El efecto de alta calidad de la profundidad del marco tambi√©n est√° disponible debido a la emulaci√≥n de software simult√°nea y al uso de varias distancias focales.</i> <i><br><br></i>  <i>Light L16 trajo decepci√≥n, pero la idea en s√≠ era prometedora.</i>  <i>Y la pr√≥xima generaci√≥n con √©xito puede ser algo que valga la pena.</i>  <i>La compa√±√≠a afirma que se anunciar√° un tel√©fono inteligente a finales de a√±o, donde se instalar√° su √∫ltima soluci√≥n con m√∫ltiples lentes.</i> <i><br><br></i>  <i>La misma idea se remonta a la experiencia de Nokia en la implementaci√≥n de m√∫ltiples c√°maras, dada la vieja historia de invertir en Pelican Imaging en 2013.</i>  <i>A diferencia de Light, el sensor aqu√≠ es mucho m√°s peque√±o.</i>  <i>Y aun as√≠, la tecnolog√≠a promete ventajas muy similares, incluido el cambio de enfoque del software, la medici√≥n de profundidad y el aumento del tama√±o de la imagen final.</i>  <i>Desafortunadamente, Tessera compr√≥ la compa√±√≠a en 2016, pero la idea en s√≠ misma podr√≠a no haber abandonado las mentes de los ingenieros de Nokia.</i> <i><br><br></i>  <i>Zeiss, el actual socio de fotograf√≠a de Nokia, tiene una patente para el zoom conmutable, pero no hemos escuchado nada de ellos sobre el dise√±o de lentes m√∫ltiples.</i>  <i>Quiz√°s el otro socio de Nokia, FIH Mobile, parece m√°s prometedor.</i>  <i>Esta compa√±√≠a es propiedad de Foxconn, lanza tel√©fonos Nokia y tambi√©n invirti√≥ en Light en 2015, otorg√°ndole una licencia para usar la tecnolog√≠a.</i> <i><br><br></i>  <i>Y si crees que la fuga de Nokia y el prototipo de Light tienen algo en com√∫n, no es casualidad.</i>  <i>Conecta a las dos compa√±√≠as de Foxconn.</i>  <i>Entonces, ¬øel tel√©fono inteligente Nokia ser√° el primero en usar la tecnolog√≠a de Light?</i> <i><br></i>  <i>Entonces, ¬øes este el futuro?</i> <i><br><br></i>  <i>La resoluci√≥n ultra alta no es un concepto nuevo. En 2014, Oppo Find 7 utiliz√≥ un principio similar, y el Zoom H√≠brido de Huawei permiti√≥ que la tecnolog√≠a funcionara con m√∫ltiples c√°maras.</i>  <i>Hist√≥ricamente, el principal problema de la tecnolog√≠a han sido los requisitos de alto rendimiento, la calidad del algoritmo y el consumo de energ√≠a.</i>  <i>Pero del lado de los tel√©fonos inteligentes modernos, procesadores de procesamiento de se√±ales m√°s potentes, chips DSP eficientes en energ√≠a e incluso capacidades mejoradas de redes neuronales, lo que gradualmente reduce la importancia del problema.</i> <i><br><br></i>  <i>Los altos detalles, las capacidades de zoom √≥ptico y un efecto bokeh personalizado encabezan la lista de requisitos de la c√°mara para un tel√©fono inteligente moderno, y la tecnolog√≠a de m√∫ltiples c√°maras puede ayudar a lograr esto.</i>  <i>En lugar de realizar diferentes funciones con c√°maras separadas, el futuro de la fotograf√≠a m√≥vil es combinar varias c√°maras para proporcionar capacidades m√°s avanzadas y flexibles.</i> <i><br><br></i>  <i>Todav√≠a hay preguntas sobre la tecnolog√≠a Light, especialmente sobre el pegado de im√°genes con diferentes distancias focales.</i>  <i>Solo podemos esperar: veremos qu√© cambiar√° para mejor en la segunda generaci√≥n de tecnolog√≠a.</i> <br></div></div><br><img src="https://habrastorage.org/webt/ln/qn/nu/lnqnnu7rqgiqupxpqtveattncmw.jpeg"><br><br>  No ser√° f√°cil configurar tal ensamblaje desde c√°maras con asas en el programa.  Tal vez el c√≠rculo se cerrar√° y, para tomar una foto, nuevamente tendremos que escribir una intenci√≥n expl√≠cita, con el contenido, como "c√°mara, tome la foto usted mismo como pueda, pero hermosamente, y devu√©lvamela en mi actividad". <br><br>  Pero por ahora, aunque todav√≠a nos queda un poco.  Por lo tanto, procedemos de inmediato. <br><br>  <b>¬øPor qu√© necesitaba todo este google?</b> <br><br>  Parece que todo es multiproceso seguro y adecuado (y tambi√©n es posible hacer todo tipo de efectos y filtros directamente).  Ahora, si en Java vainilla, si es necesario, necesita empujar mutexes, sincronizaciones y sem√°foros de manera competente en todas partes, entonces aqu√≠ Google se hace cargo de casi todo.  Solo necesita registrar devoluciones de llamada en el texto del programa, que se llamar√° si es necesario.  Es decir, por ejemplo, env√≠a una solicitud para encender la c√°mara: <br><br><pre><code class="java hljs">mCameraManager.openCamera()</code> </pre> <br>  Pero este no es un equipo, es una solicitud.  No puede comenzar a trabajar de inmediato con la c√°mara.  En primer lugar, necesita tiempo para encenderse, y en segundo lugar, el androide tiene muchas cosas importantes que hacer, y su deseo se pone en una fila bastante grande.  Pero luego no tenemos que esperar a que la c√°mara se abra en un bucle en el hilo principal y cuelgue toda la aplicaci√≥n (a√∫n recordamos qu√© se puede hacer en la transmisi√≥n de la interfaz de usuario y qu√© no).  Por lo tanto, enviamos nuestro deseo y mientras nos ocupamos de nuestro negocio, abrimos las vistas, escribimos "hola mundo", configuramos controladores de botones y similares. <br><br>  Mientras tanto, despu√©s de unas decenas y cientos de milisegundos, el sistema operativo finalmente llega a las manos de la c√°mara y lo inicializa.  Y tan pronto como la c√°mara est√© lista, se activa la misma devoluci√≥n de llamada (a menos, por supuesto, que la haya registrado por adelantado) <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraDevice.StateCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera)</span></span></span><span class="hljs-function"> </span></span>{ mCameraDevice = camera; createCameraPreviewSession(); ‚Ä¶.. }</code> </pre><br>  Es decir, la c√°mara ahora est√° abierta y puede hacer algo all√≠: mostrar la imagen de la c√°mara en la vista, reenviarla a√∫n m√°s para guardarla, etc. <br><br>  Como resultado, todo el trabajo con la c√°mara, de hecho, se reduce a prescribir todo tipo de devoluciones de llamada.  Pero en su noble deseo, los desarrolladores de Google fueron un poco demasiado lejos y, como se√±al√≥ correctamente el camarada japon√©s: <br><blockquote>  Una de las razones por las que Camera2 est√° perplejo es la cantidad de devoluciones de llamada que debe usar para tomar una foto. </blockquote><br>  Pero esto no es suficiente.  El esquema completo de la c√°mara tiene este aspecto incre√≠ble. <br><br><img src="https://habrastorage.org/webt/ko/kb/ju/kokbjuymle88yzzedcutreymxks.jpeg"><br><br>  Pero afortunadamente, para empezar, se puede reducir a una imagen mucho m√°s atractiva. <br><br><img src="https://habrastorage.org/webt/h4/zh/fs/h4zhfsjakuuzgsnil1sfjo44vla.png"><br><br>  Aunque todo est√° en ingl√©s all√≠, pero como dicen, est√° claro sin palabras.  Para empezar, tenemos suficiente de este dise√±o.  Abra la c√°mara, muestre la imagen en la pantalla del tel√©fono inteligente, tome una foto y tan pronto como est√© lista (devoluciones de llamada), el oyente de este evento trabajar√° y escribir√° la imagen en un archivo. <br><br>  <b>Comenzando a crear c√≥digo</b> <br><br>  Crearemos un nuevo proyecto en el IDE de Android Studio, seleccionaremos la versi√≥n m√≠nima del SDK 22 para evitar im√°genes verdes y pediremos la Actividad vac√≠a (o mejor a√∫n, tome la versi√≥n 23, de lo contrario pueden ocurrir problemas con los permisos).  Suficiente para empezar.  Incluso los permisos en el manifiesto no necesitan hacerse todav√≠a. <br><br>  Comenzamos creando una instancia de la clase CameraManager.  Este es un administrador de servicios del sistema que le permite encontrar c√°maras disponibles, obtener las caracter√≠sticas que necesita para trabajar y establecer configuraciones de disparo para las c√°maras. <br><br>  Y veremos las siguientes caracter√≠sticas: <br><br>  identificador de c√°mara (0, 1, 2 ....) <br>  direcci√≥n donde se dirige la c√°mara (hacia adelante, hacia atr√°s) <br>  resoluci√≥n de la c√°mara <br><br>  Primero, obtenemos la lista de c√°maras en forma de un conjunto de cadenas, y luego imprimimos las caracter√≠sticas requeridas en un bucle y las escribimos en el registro. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.ImageFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCharacteristics; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.params.StreamConfigurationMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Size; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; String[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      myCameras = new String[mCameraManager.getCameraIdList().length]; //     for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); // e   CameraCharacteristics cc = mCameraManager.getCameraCharacteristics(cameraID); //    ,    StreamConfigurationMap configurationMap = cc.get(CameraCharacteristics.SCALER_STREAM_CONFIGURATION_MAP); //      int Faceing = cc.get(CameraCharacteristics.LENS_FACING); if (Faceing == CameraCharacteristics.LENS_FACING_FRONT) { Log.i(LOG_TAG,"Camera with ID: "+cameraID + " is FRONT CAMERA "); } if (Faceing == CameraCharacteristics.LENS_FACING_BACK) { Log.i(LOG_TAG,"Camera with: ID "+cameraID + " is BACK CAMERA "); } //        jpeg Size[] sizesJPEG = configurationMap.getOutputSizes(ImageFormat.JPEG); if (sizesJPEG != null) { for (Size item:sizesJPEG) { Log.i(LOG_TAG, "w:"+item.getWidth()+" h:"+item.getHeight()); } } else { Log.i(LOG_TAG, "camera don`t support JPEG"); } } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">El registro obtendr√° algo como esto:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.489</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: cameraID: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.504</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: Camera with: ID <span class="hljs-number"><span class="hljs-number">0</span></span> is BACK CAMERA <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">2250</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">3840</span></span> h:<span class="hljs-number"><span class="hljs-number">2160</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1944</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1940</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2048</span></span> h:<span class="hljs-number"><span class="hljs-number">1536</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1920</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1600</span></span> h:<span class="hljs-number"><span class="hljs-number">1200</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">960</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">768</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">800</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">720</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">640</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">360</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">352</span></span> h:<span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">320</span></span> h:<span class="hljs-number"><span class="hljs-number">240</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.506</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">240</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.507</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">176</span></span> h:<span class="hljs-number"><span class="hljs-number">144</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.507</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">144</span></span> h:<span class="hljs-number"><span class="hljs-number">176</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.507</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: cameraID: <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.514</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: Camera with ID: <span class="hljs-number"><span class="hljs-number">1</span></span> is FRONT CAMERA <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.515</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4224</span></span> h:<span class="hljs-number"><span class="hljs-number">3136</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.515</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4224</span></span> h:<span class="hljs-number"><span class="hljs-number">2376</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4160</span></span> h:<span class="hljs-number"><span class="hljs-number">3120</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4160</span></span> h:<span class="hljs-number"><span class="hljs-number">2340</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">3000</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">4000</span></span> h:<span class="hljs-number"><span class="hljs-number">2250</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">3840</span></span> h:<span class="hljs-number"><span class="hljs-number">2160</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1944</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2592</span></span> h:<span class="hljs-number"><span class="hljs-number">1940</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">2048</span></span> h:<span class="hljs-number"><span class="hljs-number">1536</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1920</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1600</span></span> h:<span class="hljs-number"><span class="hljs-number">1200</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">1080</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1440</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">960</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">768</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">720</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">1280</span></span> h:<span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">800</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">720</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">640</span></span> h:<span class="hljs-number"><span class="hljs-number">480</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">640</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">360</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">480</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">352</span></span> h:<span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">320</span></span> h:<span class="hljs-number"><span class="hljs-number">240</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">240</span></span> h:<span class="hljs-number"><span class="hljs-number">320</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">176</span></span> h:<span class="hljs-number"><span class="hljs-number">144</span></span> <span class="hljs-number"><span class="hljs-number">2019</span></span>-<span class="hljs-number"><span class="hljs-number">09</span></span>-<span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">56</span></span>:<span class="hljs-number"><span class="hljs-number">31.516</span></span> <span class="hljs-number"><span class="hljs-number">11130</span></span>-<span class="hljs-number"><span class="hljs-number">11130</span></span>/? I/myLogs: w:<span class="hljs-number"><span class="hljs-number">144</span></span> h:<span class="hljs-number"><span class="hljs-number">176</span></span></code> </pre><br></div></div><br>  Nosotros, en principio, realmente no necesitamos esta informaci√≥n, cualquier tetera incluso de la API anterior ya sabe que las c√°maras tienen identificadores de cero y m√°s all√°, que no sorprender√° a nadie con una resoluci√≥n de 1920 por 1080, y a√∫n m√°s con el formato JPEG.  De hecho, estos datos ya son necesarios para una aplicaci√≥n "adulta" lista para la producci√≥n y que, en base a esto, har√° los men√∫s de elecci√≥n para el usuario, etc.  En nuestro caso m√°s simple, en general, todo est√° claro.  Pero como todos los art√≠culos comienzan con esto, entonces comenzaremos. <br><br>  Despu√©s de asegurarnos de que la c√°mara frontal tenga el n√∫mero de identificaci√≥n "1" y la parte trasera "0" (por alguna raz√≥n est√°n especificadas en el formato de Cadena), y tambi√©n que la resoluci√≥n de 1920 x 1080 y guardar el archivo JPG est√©n disponibles, continuaremos el ataque. <br><br>  <b>Obtenemos los permisos necesarios</b> <br><br>  Inicialmente, debemos preocuparnos por una serie de permisos.  Para hacer esto, deber√° escribir lo siguiente en el manifiesto: <br><br><pre> <code class="java hljs"> &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.CAMERA"</span></span> /&gt; &lt;uses-permission android:name=<span class="hljs-string"><span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span></span> /&gt;</code> </pre><br>  El primero es comprensible para la c√°mara, el segundo es para escribir im√°genes en un archivo (y esto no es una tarjeta de memoria externa, como podr√≠a parecer por el significado de la palabra EXTERNO, sino una memoria de tel√©fono inteligente bastante nativa) <br><br>  Pero Android tambi√©n se preocupa por nosotros, por lo tanto, a partir de la versi√≥n Lollipop, los permisos especificados en el manifiesto ya no ser√°n suficientes.  Ahora se requiere que los usuarios aprueben su consentimiento para abrir la c√°mara y escribir datos en la memoria. <br><br>  Para hacer esto, en el caso m√°s simple, debe agregar esto: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ‚Ä¶‚Ä¶... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE}, <span class="hljs-number"><span class="hljs-number">1</span></span>); } ‚Ä¶..</code> </pre><br>  ¬øPor qu√© en lo m√°s simple?  Porque no es necesario hacer tales cosas en una transmisi√≥n de IU.  En primer lugar, el hilo se cuelga mientras el usuario asoma la pantalla con sus dedos torpes y, en segundo lugar, si tiene la c√°mara a√∫n m√°s inicializada, la aplicaci√≥n generalmente puede fallar.  En este caso de demostraci√≥n, todo est√° bien, pero generalmente se prescribe para usar el tipo de devoluci√≥n de llamada deseado para este caso: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRequestPermissionsResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> requestCode, String[] permissions, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] grantResults)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requestCode == MY_REQUEST_CODE_FOR_CAMERA) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (grantResults[<span class="hljs-number"><span class="hljs-number">0</span></span>] == PackageManager.PERMISSION_GRANTED) { startCameraActivity(); <span class="hljs-comment"><span class="hljs-comment">//     (  ) } } }</span></span></code> </pre><br>  Aunque anteriormente no sab√≠a todo esto, inici√© la actividad deseada a trav√©s de AsyncTask, e incluso antes esculp√≠ un nuevo hilo, como en Java. <br><br>  <b>Cocinando la camara</b> <br><br>  Por conveniencia, eliminaremos todo lo relacionado con las c√°maras en una clase separada por consejo de personas inteligentes y crearemos la clase CameraService.  All√≠ colocaremos la inicializaci√≥n de las c√°maras y luego anotaremos todas las devoluciones de llamada necesarias. <br><br><pre> <code class="java hljs">‚Ä¶.. CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ‚Ä¶.. } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String mCameraID; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraDevice mCameraDevice = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraCaptureSession mCaptureSession; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CameraService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraManager cameraManager, String cameraID)</span></span></span><span class="hljs-function"> </span></span>{ mCameraManager = cameraManager; mCameraID = cameraID; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isOpen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mCameraDevice == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openCamera</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (CameraAccessException e) { Log.i(LOG_TAG,e.getMessage()); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closeCamera</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mCameraDevice != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { mCameraDevice.close(); mCameraDevice = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } }</code> </pre><br>  En el hilo principal, cree una instancia de mCameraManager y √∫sela para completar la matriz de objetos myCameras.  En este caso, solo hay dos: la c√°mara frontal y la c√°mara autofoto. <br><br><pre> <code class="java hljs"> mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager,cameraID); } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); }</span></span></code> </pre><br>  En el m√©todo p√∫blico void openCamera (), puede ver la l√≠nea: <br><br><pre> <code class="java hljs"> mCameraManager.openCamera(mCameraID,mCameraCallback,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  es a partir de aqu√≠ que la ruta conduce a la primera devoluci√≥n de llamada del <b>estado de la</b> c√°mara del <b>CameraDevice.</b>  <b>StateCallback.</b>  Nos dir√° si la c√°mara est√° abierta, cerrada o tal vez no haya nada all√≠ y dar√° un error.  Lo escribiremos en los m√©todos de la clase CameraService. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraDevice.StateCallback mCameraCallback = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraDevice.StateCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOpened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera)</span></span></span><span class="hljs-function"> </span></span>{ mCameraDevice = camera; Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"Open camera with id:"</span></span>+mCameraDevice.getId()); createCameraPreviewSession(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDisconnected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera)</span></span></span><span class="hljs-function"> </span></span>{ mCameraDevice.close(); Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"disconnect camera with id:"</span></span>+mCameraDevice.getId()); mCameraDevice = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CameraDevice camera, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> error)</span></span></span><span class="hljs-function"> </span></span>{ Log.i(LOG_TAG, <span class="hljs-string"><span class="hljs-string">"error! camera id:"</span></span>+camera.getId()+<span class="hljs-string"><span class="hljs-string">" error:"</span></span>+error); } };</code> </pre><br>  En consecuencia, si la c√°mara est√° disponible para funcionar (el m√©todo public void onOpened (CameraDevice camera) {} ha funcionado), entonces escribimos nuestras acciones adicionales all√≠, por ejemplo, llamando al m√©todo createCameraPreviewSession ().  Ayudar√° a traernos la imagen de la c√°mara a la vista y trabajar con ella a√∫n m√°s. <br><br>  <b>CreateCameraPreviewSession</b> <br><br>  Aqu√≠ estamos tratando de mostrar una imagen (flujo de datos) en la textura mImageView, que ya est√° definida en el dise√±o.  Incluso puede determinar con qu√© resoluci√≥n en los p√≠xeles. <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SurfaceTexture texture = mImageView.getSurfaceTexture(); <span class="hljs-comment"><span class="hljs-comment">// texture.setDefaultBufferSize(1920,1080); Surface surface = new Surface(texture); try { final CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mCaptureSession = session; try { mCaptureSession.setRepeatingRequest(builder.build(),null,null); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { }}, null ); } catch (CameraAccessException e) { e.printStackTrace(); } }</span></span></code> </pre><br>  Y cuando esta misma sesi√≥n est√° lista, se llama la devoluci√≥n de llamada antes mencionada y comenzamos con la expresi√≥n de los buscadores de Google: "mostrar la vista previa de la c√°mara".  Aqu√≠, aquellos que lo deseen pueden ajustar la configuraci√≥n de enfoque autom√°tico y flash, pero por ahora nos las arreglaremos con la configuraci√≥n predeterminada. <br><br>  <b>Crea un dise√±o</b> <br><br>  Ahora necesitamos, por as√≠ decirlo, dibujar los colores en el lienzo y crear una imagen brillante al estilo de <div class="spoiler">  <b class="spoiler_title">"Tres botones de pantalla y una vista".</b> <div class="spoiler_text"><pre> <code class="java hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span> xmlns:app=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span> xmlns:tools=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/tools"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> tools:context=<span class="hljs-string"><span class="hljs-string">".MainActivity"</span></span>&gt; &lt;TextureView android:id=<span class="hljs-string"><span class="hljs-string">"@+id/textureView"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"356dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"410dp"</span></span> android:layout_marginTop=<span class="hljs-string"><span class="hljs-string">"32dp"</span></span> app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintHorizontal_bias=<span class="hljs-string"><span class="hljs-string">"0.49"</span></span> app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintTop_toTopOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> /&gt; &lt;LinearLayout android:layout_width=<span class="hljs-string"><span class="hljs-string">"292dp"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"145dp"</span></span> android:layout_marginStart=<span class="hljs-string"><span class="hljs-string">"16dp"</span></span> android:orientation=<span class="hljs-string"><span class="hljs-string">"vertical"</span></span> app:layout_constraintBottom_toBottomOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintEnd_toEndOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintStart_toStartOf=<span class="hljs-string"><span class="hljs-string">"parent"</span></span> app:layout_constraintTop_toBottomOf=<span class="hljs-string"><span class="hljs-string">"@+id/textureView"</span></span> app:layout_constraintVertical_bias=<span class="hljs-string"><span class="hljs-string">"0.537"</span></span>&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button4"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button5"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;Button android:id=<span class="hljs-string"><span class="hljs-string">"@+id/button6"</span></span> android:layout_width=<span class="hljs-string"><span class="hljs-string">"match_parent"</span></span> android:layout_height=<span class="hljs-string"><span class="hljs-string">"wrap_content"</span></span> android:text=<span class="hljs-string"><span class="hljs-string">" "</span></span> /&gt; &lt;/LinearLayout&gt; &lt;/androidx.constr</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/lr/nb/31/lrnb31_wiadanevvo9e_o79jfky.png"><br>  El proceso es bastante trivial y cualquiera puede darse la vuelta aqu√≠ como quiera.  Pero escribir los nombres de los botones directamente en el dise√±o tambi√©n es de mala educaci√≥n y, por lo tanto, en las versiones de trabajo no es necesario hacerlo. <br><br>  En consecuencia, en la Actividad en s√≠, creamos oyentes, es decir, oyentes para botones y vistas. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonToMakeShot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); ‚Ä¶‚Ä¶... mButtonOpenCamera1 = findViewById(R.id.button1); mButtonOpenCamera2 = findViewById(R.id.button2); mButtonToMakeShot =findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].closeCamera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].closeCamera(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera(); } } }); mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    } }); ‚Ä¶‚Ä¶..</span></span></code> </pre><br>  Las asignaciones de botones son claras a partir de los nombres, dejaremos el tercer bot√≥n para la imagen futura. <br><br>  Y si ahora re√∫nes todas las piezas de c√≥digo, entonces <br><br><div class="spoiler">  <b class="spoiler_title">obt√©n lo siguiente:</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.SurfaceTexture; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCaptureSession; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraDevice; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CaptureRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Surface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.TextureView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonToMakeShot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Log.d(LOG_TAG, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE},<span class="hljs-number"><span class="hljs-number">1</span></span>); } mButtonOpenCamera1 = findViewById(R.id.button1); mButtonOpenCamera2 = findViewById(R.id.button2); mButtonToMakeShot =findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) {myCameras[CAMERA2].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) {myCameras[CAMERA1].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera(); } } }); mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// if (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto(); // if (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto(); } }); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); try{ //      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager,cameraID); } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } public class CameraService { private String mCameraID; private CameraDevice mCameraDevice = null; private CameraCaptureSession mCaptureSession; public CameraService(CameraManager cameraManager, String cameraID) { mCameraManager = cameraManager; mCameraID = cameraID; } private CameraDevice.StateCallback mCameraCallback = new CameraDevice.StateCallback() { @Override public void onOpened(CameraDevice camera) { mCameraDevice = camera; Log.i(LOG_TAG, "Open camera with id:"+mCameraDevice.getId()); createCameraPreviewSession(); } @Override public void onDisconnected(CameraDevice camera) { mCameraDevice.close(); Log.i(LOG_TAG, "disconnect camera with id:"+mCameraDevice.getId()); mCameraDevice = null; } @Override public void onError(CameraDevice camera, int error) { Log.i(LOG_TAG, "error! camera id:"+camera.getId()+" error:"+error); } }; private void createCameraPreviewSession() { SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(1920,1080); Surface surface = new Surface(texture); try { final CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mCaptureSession = session; try { mCaptureSession.setRepeatingRequest(builder.build(),null,null); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { }}, null ); } catch (CameraAccessException e) { e.printStackTrace(); } } public boolean isOpen() { if (mCameraDevice == null) { return false; } else { return true; } } public void openCamera() { try { if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID,mCameraCallback,null); } } catch (CameraAccessException e) { Log.i(LOG_TAG,e.getMessage()); } } public void closeCamera() { if (mCameraDevice != null) { mCameraDevice.close(); mCameraDevice = null; } } } @Override public void onPause() { if(myCameras[CAMERA1].isOpen()){myCameras[CAMERA1].closeCamera();} if(myCameras[CAMERA2].isOpen()){myCameras[CAMERA2].closeCamera();} super.onPause(); } }</span></span></code> </pre><br></div></div><br>  ¬°Cargamos, comenzamos, trabajamos! <br><br>  En general, si esto no es suficiente para usted, el proceso de disparo en s√≠ puede ser muy diversificado.  Nuestro japon√©s Tomoaki muestra y explica c√≥mo, trayendo un hermoso diagrama. <br><br><img src="https://habrastorage.org/webt/kq/ac/qv/kqacqvz6ctvbapmm3bzg-f1hcy8.png"><br><br>  Primero, la c√°mara necesita enfocar.  Esto generalmente no causa problemas, pero a veces requiere varios intentos, que tambi√©n se implementan a trav√©s de una devoluci√≥n de llamada. <br><br><pre> <code class="java hljs">CameraCaptureSession.StateCallback().</code> </pre><br>  Luego la c√°mara ingresa al modo de previsualizaci√≥n PRECAPTURE.  En esta etapa, la c√°mara calcula la exposici√≥n, el balance de blancos y la apertura (sol√≠a saber qu√© era en la infancia, pero ahora este conocimiento se pierde).  A veces, una devoluci√≥n de llamada puede devolver una solicitud CONTROL_AE_STATE_FLASH_REQUIRED, lo que significa "ser√≠a bueno encender el flash".  Por cierto, se puede activar autom√°ticamente: setAutoFlash (mPreviewRequestBuilder). <br><br>  Cuando se definen todos los par√°metros necesarios para disparar, la devoluci√≥n de llamada devuelve el estado CONTROL_AE_STATE_CONVERGED que nos indica que la c√°mara est√° lista para tomar una foto. <br><br>  En la p√°gina googloid, todo esto ya est√° en los ejemplos, y si tienes la paciencia para atravesar estos campos minados y cercas de alambre, entonces el honor es para ti. <br><br>  <b>Tome una foto y gu√°rdela en un archivo</b> <br><br>  Aqu√≠ es exactamente donde comenc√© a tener problemas. ,   -   ( ,  )      . ,    .    CamerCaptureSession       Surface,          ImageReader. <br><br>   ,    ImageReader    .          OnImageAvailableListener.  ,      ImageSaver          ,   ImageSaver    Runnable. <br><br>    ,        ImageReader,   CameraCaptureSession.StateCallback()         .        Android     .   (   )           createCameraPreviewSession(),         . <br><br>     : <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ SurfaceTexture texture = mImageView.getSurfaceTexture(); Surface surface = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Surface(texture); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraCaptureSession.StateCallback() ‚Ä¶‚Ä¶.</code> </pre><br>    : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageReader mImageReader; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCameraPreviewSession</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mImageReader = ImageReader.newInstance(<span class="hljs-number"><span class="hljs-number">1920</span></span>,<span class="hljs-number"><span class="hljs-number">1080</span></span>,ImageFormat.JPEG,<span class="hljs-number"><span class="hljs-number">1</span></span>); mImageReader.setOnImageAvailableListener(mOnImageAvailableListener, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); SurfaceTexture texture = mImageView.getSurfaceTexture(); Surface surface = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Surface(texture); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface, mImageReader.getSurface()), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CameraCaptureSession.StateCallback() ‚Ä¶‚Ä¶</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La diferencia, aparte de la definici√≥n de instancia de ImageReader en la parte superior, es casi dif√≠cil de alcanzar. </font><font style="vertical-align: inherit;">Reci√©n agregado a la superficie, mImageReader.getSurface () separado por comas y listo. </font><font style="vertical-align: inherit;">Pero hasta que lo consigas ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desde ese momento las cosas se volvieron m√°s divertidas y podr√≠as usar el tercer bot√≥n de pantalla "Tomar una foto". </font><font style="vertical-align: inherit;">Cuando se presiona, se llama al m√©todo makePhoto () (bueno, qui√©n habr√≠a pensado):</font></font><br><br><pre> <code class="java hljs"> mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto(); } }); ‚Ä¶‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makePhoto</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This is the CaptureRequest.Builder that we use to take a picture. final CaptureRequest.Builder captureBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE); captureBuilder.addTarget(mImageReader.getSurface()); CameraCaptureSession.CaptureCallback CaptureCallback = new CameraCaptureSession.CaptureCallback() { @Override public void onCaptureCompleted(@NonNull CameraCaptureSession session, @NonNull CaptureRequest request, @NonNull TotalCaptureResult result) { } }; mCaptureSession.stopRepeating(); mCaptureSession.abortCaptures(); mCaptureSession.capture(captureBuilder.build(), CaptureCallback, null); } catch (CameraAccessException e) { e.printStackTrace(); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> E inmediatamente despu√©s escribimos el oyente OnImageAvailableListener: </font></font><br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ImageReader.OnImageAvailableListener mOnImageAvailableListener = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageReader.OnImageAvailableListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onImageAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ImageReader reader)</span></span></span><span class="hljs-function"> </span></span>{ { Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>,<span class="hljs-string"><span class="hljs-string">"   "</span></span>, Toast.LENGTH_SHORT).show();} } };</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si bien no est√° haciendo nada, simplemente se√±ala con un brindis que dicen que todo est√° en orden, puede guardar la imagen en un archivo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y para esto necesitamos el archivo en s√≠:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CameraService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> File mFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), <span class="hljs-string"><span class="hljs-string">"test1.jpg"</span></span>);;</code> </pre><br>      ImageSaver,         ,      . <br><br>       Runnable.       MainActivity: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageSaver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Runnable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> File mFile; ImageSaver(Image image, File file) { mImage = image; mFile = file; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ByteBuffer buffer = mImage.getPlanes()[<span class="hljs-number"><span class="hljs-number">0</span></span>].getBuffer(); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[buffer.remaining()]; buffer.get(bytes); FileOutputStream output = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileOutputStream(mFile); output.write(bytes); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { mImage.close(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">null</span></span> != output) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { output.close(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (IOException e) { e.printStackTrace(); } } } } }</code> </pre><br>    ,    OnImageAvailableListener : <br><br><pre> <code class="java hljs">mBackgroundHandler.post(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageSaver(reader.acquireNextImage(), mFile));</code> </pre><br> <b>WAIT! OH, SHIT!!</b> <br><br>    mBackgroundHandler???       . <br><br>       ‚Äî       ?  ,      BackgroundHandler   BackgroundThread,                .            Activity : <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerThread mBackgroundThread; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Handler mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerThread(<span class="hljs-string"><span class="hljs-string">"CameraBackground"</span></span>); mBackgroundThread.start(); mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(mBackgroundThread.getLooper()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread.quitSafely(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mBackgroundThread.join(); mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } }</code> </pre><br>  ,       BackgroundThread   : <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause(); stopBackgroundThread(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); startBackgroundThread(); }</code> </pre><br>    mBackgroundHandler,        ,   handler   ,  ,    null. <br><br>  ,           ,      .         .           onPause()  onResume(). -   . <br><br>        .      .  ,     . <br><br><img src="https://habrastorage.org/webt/ax/lu/rq/axlurqxeo1_oba674iz9uos8hp0.jpeg"><br><br>   -   ,        . <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.example.camera; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.NonNull; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.annotation.RequiresApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.appcompat.app.AppCompatActivity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> androidx.core.content.ContextCompat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.Manifest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.pm.PackageManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.ImageFormat; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.SurfaceTexture; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraAccessException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraCaptureSession; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraDevice; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CameraManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.CaptureRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.hardware.camera2.TotalCaptureResult; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.Image; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.media.ImageReader; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Environment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Handler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.HandlerThread; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.Surface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.TextureView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Button; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.FileOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.IOException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.nio.ByteBuffer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Arrays; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String LOG_TAG = <span class="hljs-string"><span class="hljs-string">"myLogs"</span></span>; CameraService[] myCameras = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CameraManager mCameraManager = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CAMERA2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera1 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonOpenCamera2 = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Button mButtonToMakeShot = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TextureView mImageView = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> HandlerThread mBackgroundThread; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Handler mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HandlerThread(<span class="hljs-string"><span class="hljs-string">"CameraBackground"</span></span>); mBackgroundThread.start(); mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Handler(mBackgroundThread.getLooper()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopBackgroundThread</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mBackgroundThread.quitSafely(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { mBackgroundThread.join(); mBackgroundThread = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; mBackgroundHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException e) { e.printStackTrace(); } } <span class="hljs-meta"><span class="hljs-meta">@RequiresApi</span></span>(api = Build.VERSION_CODES.M) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); Log.d(LOG_TAG, <span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (checkSelfPermission(Manifest.permission.CAMERA) != PackageManager.PERMISSION_GRANTED || (ContextCompat.checkSelfPermission(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) ) { requestPermissions(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{Manifest.permission.CAMERA,Manifest.permission.WRITE_EXTERNAL_STORAGE},<span class="hljs-number"><span class="hljs-number">1</span></span>); } mButtonOpenCamera1 = findViewById(R.id.button1); mButtonOpenCamera2 = findViewById(R.id.button2); mButtonToMakeShot =findViewById(R.id.button3); mImageView = findViewById(R.id.textureView); mButtonOpenCamera1.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) {myCameras[CAMERA2].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].openCamera(); } } }); mButtonOpenCamera2.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) {myCameras[CAMERA1].closeCamera();} <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2] != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].openCamera(); } } }); mButtonToMakeShot.setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA1].isOpen()) myCameras[CAMERA1].makePhoto(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (myCameras[CAMERA2].isOpen()) myCameras[CAMERA2].makePhoto(); } }); mCameraManager = (CameraManager) getSystemService(Context.CAMERA_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      myCameras = new CameraService[mCameraManager.getCameraIdList().length]; for (String cameraID : mCameraManager.getCameraIdList()) { Log.i(LOG_TAG, "cameraID: "+cameraID); int id = Integer.parseInt(cameraID); //     myCameras[id] = new CameraService(mCameraManager,cameraID); } } catch(CameraAccessException e){ Log.e(LOG_TAG, e.getMessage()); e.printStackTrace(); } } public class CameraService { private File mFile = new File(Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DCIM), "test1.jpg");; private String mCameraID; private CameraDevice mCameraDevice = null; private CameraCaptureSession mCaptureSession; private ImageReader mImageReader; public CameraService(CameraManager cameraManager, String cameraID) { mCameraManager = cameraManager; mCameraID = cameraID; } public void makePhoto (){ try { // This is the CaptureRequest.Builder that we use to take a picture. final CaptureRequest.Builder captureBuilder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE); captureBuilder.addTarget(mImageReader.getSurface()); CameraCaptureSession.CaptureCallback CaptureCallback = new CameraCaptureSession.CaptureCallback() { @Override public void onCaptureCompleted(@NonNull CameraCaptureSession session, @NonNull CaptureRequest request, @NonNull TotalCaptureResult result) { } }; mCaptureSession.stopRepeating(); mCaptureSession.abortCaptures(); mCaptureSession.capture(captureBuilder.build(), CaptureCallback, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } private final ImageReader.OnImageAvailableListener mOnImageAvailableListener = new ImageReader.OnImageAvailableListener() { @Override public void onImageAvailable(ImageReader reader) { mBackgroundHandler.post(new ImageSaver(reader.acquireNextImage(), mFile)); } }; private CameraDevice.StateCallback mCameraCallback = new CameraDevice.StateCallback() { @Override public void onOpened(CameraDevice camera) { mCameraDevice = camera; Log.i(LOG_TAG, "Open camera with id:"+mCameraDevice.getId()); createCameraPreviewSession(); } @Override public void onDisconnected(CameraDevice camera) { mCameraDevice.close(); Log.i(LOG_TAG, "disconnect camera with id:"+mCameraDevice.getId()); mCameraDevice = null; } @Override public void onError(CameraDevice camera, int error) { Log.i(LOG_TAG, "error! camera id:"+camera.getId()+" error:"+error); } }; private void createCameraPreviewSession() { mImageReader = ImageReader.newInstance(1920,1080, ImageFormat.JPEG,1); mImageReader.setOnImageAvailableListener(mOnImageAvailableListener, null); SurfaceTexture texture = mImageView.getSurfaceTexture(); texture.setDefaultBufferSize(1920,1080); Surface surface = new Surface(texture); try { final CaptureRequest.Builder builder = mCameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW); builder.addTarget(surface); mCameraDevice.createCaptureSession(Arrays.asList(surface,mImageReader.getSurface()), new CameraCaptureSession.StateCallback() { @Override public void onConfigured(CameraCaptureSession session) { mCaptureSession = session; try { mCaptureSession.setRepeatingRequest(builder.build(),null,mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } @Override public void onConfigureFailed(CameraCaptureSession session) { }}, mBackgroundHandler); } catch (CameraAccessException e) { e.printStackTrace(); } } public boolean isOpen() { if (mCameraDevice == null) { return false; } else { return true; } } public void openCamera() { try { if (checkSelfPermission(Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) { mCameraManager.openCamera(mCameraID,mCameraCallback,mBackgroundHandler); } } catch (CameraAccessException e) { Log.i(LOG_TAG,e.getMessage()); } } public void closeCamera() { if (mCameraDevice != null) { mCameraDevice.close(); mCameraDevice = null; } } } @Override public void onPause() { if(myCameras[CAMERA1].isOpen()){myCameras[CAMERA1].closeCamera();} if(myCameras[CAMERA2].isOpen()){myCameras[CAMERA2].closeCamera();} stopBackgroundThread(); super.onPause(); } @Override public void onResume() { super.onResume(); startBackgroundThread(); } private static class ImageSaver implements Runnable { /** * The JPEG image */ private final Image mImage; /** * The file we save the image into. */ private final File mFile; ImageSaver(Image image, File file) { mImage = image; mFile = file; } @Override public void run() { ByteBuffer buffer = mImage.getPlanes()[0].getBuffer(); byte[] bytes = new byte[buffer.remaining()]; buffer.get(bytes); FileOutputStream output = null; try { output = new FileOutputStream(mFile); output.write(bytes); } catch (IOException e) { e.printStackTrace(); } finally { mImage.close(); if (null != output) { try { output.close(); } catch (IOException e) { e.printStackTrace(); } } } } } }</span></span></code> </pre><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468083/">https://habr.com/ru/post/468083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468071/index.html">Eduard Medvedev, CTO de Tungsten Labs: "Hemos crecido hasta el punto en que la tecnolog√≠a puede causar da√±os masivos"</a></li>
<li><a href="../468073/index.html">Andrei Terekhov: "Puedes decir todo lo que quieras que el estadounidense es mejor, pero nuestro auto nunca se descompone"</a></li>
<li><a href="../468075/index.html">El uso de redes neuronales siamesas en la b√∫squeda</a></li>
<li><a href="../468077/index.html">Realice pruebas de manera adulta. An√°lisis espectral</a></li>
<li><a href="../468081/index.html">"Datos an√≥nimos" o lo que se planea en 152-FZ</a></li>
<li><a href="../468085/index.html">El libro "Safe DevOps. Operaci√≥n eficiente del sistema</a></li>
<li><a href="../468087/index.html">M√©todo de divisi√≥n biseccional en pruebas</a></li>
<li><a href="../468089/index.html">Redefinici√≥n basada en la edici√≥n: ¬øes posible en la producci√≥n?</a></li>
<li><a href="../468091/index.html">El proyecto de ley sobre la creaci√≥n de una base de datos √∫nica con los datos de los ciudadanos adoptados en la Duma del Estado en la primera lectura</a></li>
<li><a href="../468093/index.html">Nitratos en productos: tiendas suizas vs tiendas rusas vs caba√±a de verano</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>