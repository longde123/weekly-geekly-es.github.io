<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ωüèø üßëüèº‚Äçü§ù‚Äçüßëüèª ‚òùüèø Y de nuevo al espacio: c√≥mo visit√≥ el unicornio Stellarium üòÇ üë®üèΩ‚Äçüç≥ üöó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante todo el per√≠odo de su existencia, las personas han hecho un gran esfuerzo para estudiar casi toda el √°rea del cielo estrellado. Hasta la fecha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Y de nuevo al espacio: c√≥mo visit√≥ el unicornio Stellarium</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/432954/">  Durante todo el per√≠odo de su existencia, las personas han hecho un gran esfuerzo para estudiar casi toda el √°rea del cielo estrellado.  Hasta la fecha, hemos examinado cientos de miles de asteroides, cometas, nebulosas y estrellas, galaxias y planetas.  Para ver toda esta belleza usted mismo, no es necesario salir de la casa y comprar un telescopio.  Puede instalar Stellarium, un planetario virtual en su computadora, y mirar el cielo nocturno, acostado c√≥modamente en el sof√° ... ¬øPero es c√≥modo?  Para encontrar la respuesta a esta pregunta, revisaremos Stellarium en busca de errores en el c√≥digo de la computadora. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b8/c8b/129/4b8c8b12983537442bfea4700cadca97.png"></div><br><a name="habracut"></a><br><h2>  Un poco sobre el proyecto ... </h2><br>  Como se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">describe</a> en el sitio web de Wikipedia, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Stellarium</a> es un planetario virtual de c√≥digo abierto disponible para Linux, Mac OS X, Microsoft Windows, Symbian, Android e iOS, as√≠ como MeeGo.  El programa utiliza tecnolog√≠as OpenGL y Qt para crear un cielo realista en tiempo real.  Con Stellarium, puede ver lo que puede ver con un telescopio mediano e incluso grande.  El programa tambi√©n proporciona observaciones de eclipses solares y el movimiento de los cometas. <br><br>  Stellarium fue creado por el programador franc√©s Fabian Chereau, quien lanz√≥ el proyecto en el verano de 2001.  Otros desarrolladores destacados incluyen Robert Spearman, Johannes Gadzhozik, Matthew Gates, Timothy Reeves, Bogdan Marinov y Johan Meeris, quien es responsable de la obra de arte. <br><br><h2>  ... y sobre el analizador </h2><br>  El an√°lisis del proyecto se realiz√≥ utilizando el analizador de c√≥digo est√°tico PVS-Studio.  Esta es una herramienta para detectar errores y vulnerabilidades potenciales en el c√≥digo fuente de programas escritos en C, C ++ y C # (¬°pronto en Java!).  Se ejecuta en Windows, Linux y macOS.  Est√° dise√±ado para aquellos que necesitan mejorar la calidad de su c√≥digo. <br><br>  El an√°lisis fue bastante simple.  Primero, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descargu√©</a> el proyecto Stellarium de GitHub y luego instal√© todos los paquetes necesarios para el ensamblaje.  Como el proyecto se cre√≥ con Qt Creator, utilic√© el sistema de seguimiento del lanzamiento del compilador, que est√° integrado en la versi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">independiente</a> del analizador.  All√≠ puede ver el informe de an√°lisis terminado. <br><br>  Los nuevos lectores y usuarios de <b><i>Stellarium</i></b> pueden haberse preguntado: ¬øpor qu√© aparece el unicornio en el t√≠tulo del art√≠culo y c√≥mo se relaciona con el an√°lisis de c√≥digo?  Respondo: soy uno de los desarrolladores de PVS-Studio, y el unicornio es nuestra mascota traviesa favorita.  As√≠ que arriba! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bfc/8f2/aab/bfc8f2aaba0bf61f3b40d4d0765dd027.png"></div><br>  Espero que gracias a este art√≠culo, los lectores aprendan algo nuevo por s√≠ mismos y los desarrolladores de Stellarium puedan eliminar algunos errores y mejorar la calidad del c√≥digo. <br><br>  T√≥mate un caf√© con un croissant de aire y ponte c√≥modo, porque vamos a la parte m√°s interesante: ¬°una descripci√≥n general de los resultados del an√°lisis y el an√°lisis de errores! <br><br><h2>  Condiciones sospechosas </h2><br>  Para un mayor placer de lectura, sugiero que no mire directamente la advertencia del analizador, sino que intente aqu√≠ y m√°s lejos para encontrar errores usted mismo. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> QZipReaderPrivate::scanFiles() { .... <span class="hljs-comment"><span class="hljs-comment">// find EndOfDirectory header int i = 0; int start_of_directory = -1; EndOfDirectory eod; while (start_of_directory == -1) { const int pos = device-&gt;size() - int(sizeof(EndOfDirectory)) - i; if (pos &lt; 0 || i &gt; 65535) { qWarning() &lt;&lt; "QZip: EndOfDirectory not found"; return; } device-&gt;seek(pos); device-&gt;read((char *)&amp;eod, sizeof(EndOfDirectory)); if (readUInt(eod.signature) == 0x06054b50) break; ++i; } .... }</span></span></code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Advertencia de</a> <b>PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V654</a> La condici√≥n 'start_of_directory == - 1' del bucle siempre es verdadera.  qzip.cpp 617 <br><br>  ¬øPuedes encontrar un error?  Si es as√≠, alabado sea. <br><br>  El error radica en la condici√≥n del <i>bucle while</i> .  Siempre es cierto, ya que la variable <i>start_of_directory</i> no cambia en el cuerpo del bucle.  Lo m√°s probable es que el ciclo no sea eterno, ya que contiene <i>retorno</i> y <i>descanso</i> , pero ese c√≥digo parece extra√±o. <br><br>  Me parece que en el c√≥digo se olvidaron de hacer la asignaci√≥n <i>start_of_directory = pos</i> en el lugar donde se verifica la firma.  Entonces la declaraci√≥n de <i>ruptura</i> es quiz√°s superflua.  En este caso, el c√≥digo se puede reescribir as√≠: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> start_of_directory = <span class="hljs-number"><span class="hljs-number">-1</span></span>; EndOfDirectory eod; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (start_of_directory == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = device-&gt;size() - <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)) - i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pos &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || i &gt; <span class="hljs-number"><span class="hljs-number">65535</span></span>) { qWarning() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"QZip: EndOfDirectory not found"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } device-&gt;seek(pos); device-&gt;read((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)&amp;eod, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(EndOfDirectory)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readUInt(eod.signature) == <span class="hljs-number"><span class="hljs-number">0x06054b50</span></span>) start_of_directory = pos; ++i; }</code> </pre> <br>  Sin embargo, no estoy seguro de c√≥mo deber√≠a ser el c√≥digo as√≠.  Es mejor que los desarrolladores del proyecto analicen esta parte del programa y realicen los cambios necesarios. <br><br>  Otra condici√≥n extra√±a: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StelProjectorCylinder</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> StelProjector { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>: .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intersectViewportDiscontinuityInternal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vec3d&amp; capN, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> capD)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap3</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">,</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">SphericalCap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capN, capD)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cap.intersects(cap1) &amp;&amp; cap.intersects(cap2) &amp;&amp; cap.intersects(cap2); } };</code> </pre> <br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V501</a> Hay <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">subexpresiones</a> id√©nticas 'cap.intersects (cap2)' a la izquierda y a la derecha del operador '&amp;&amp;'.  StelProjectorClasses.hpp 175 <br><br>  Como probablemente ya haya adivinado, el error radica en la √∫ltima l√≠nea de la funci√≥n: el programador cometi√≥ un error tipogr√°fico y al final result√≥ que la funci√≥n devuelve el resultado independientemente del valor de <i>cap3</i> . <br><br>  Este tipo de error es extremadamente com√∫n: en casi todos los proyectos probados, hemos encontrado errores tipogr√°ficos relacionados con los nombres del formulario <i>nombre1</i> y <i>nombre2</i> y similares.  T√≠picamente, tales errores est√°n relacionados con copiar y pegar. <br><br>  Esta instancia de c√≥digo es un excelente ejemplo de otro patr√≥n de error com√∫n, para el cual incluso realizamos un mini estudio por separado.  Mi colega Andrei Karpov lo llam√≥ el " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">efecto de √∫ltima l√≠nea</a> ".  Si no est√° familiarizado con este material, le sugiero que abra una pesta√±a en el navegador para leer m√°s tarde, pero por ahora, continuemos. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> BottomStelBar::updateText(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> updatePos) { .... updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (location-&gt;text() != newLocation || updatePos) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fov-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fps-&gt;text() != str) { updatePos = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (updatePos) { .... } }</code> </pre> <br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V560</a> Una parte de la expresi√≥n condicional siempre es verdadera: updatePos.  StelGuiItems.cpp 732 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La</a> expresi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V547</a> 'updatePos' siempre es verdadera.  StelGuiItems.cpp 831 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El</a> par√°metro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V763</a> 'updatePos' siempre se reescribe en el cuerpo de la funci√≥n antes de usarse.  StelGuiItems.cpp 690 </li></ul><br>  El valor del par√°metro <i>updatePos</i> siempre se sobrescribe antes de usarse, es decir,  la funci√≥n funcionar√° igual, independientemente del valor que se le pase. <br><br>  Se ve raro, ¬øno?  En todos los lugares donde est√° <i>involucrado el</i> par√°metro <i>updatePos</i> , es <i>cierto</i> .  Esto significa que las condiciones <i>if (location-&gt; text ()! = NewLocation || updatePos)</i> y <i>if (updatePos)</i> siempre ser√°n verdaderas. <br><br>  Otro fragmento: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> LandscapeMgr::onTargetLocationChanged(StelLocation loc) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pl &amp;&amp; flagEnvironmentAutoEnabling) { QSettings* conf = StelApp::getInstance().getSettings(); setFlagAtmosphere(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_atmosphere"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagFog(pl-&gt;hasAtmosphere() &amp; conf-&gt;value(<span class="hljs-string"><span class="hljs-string">"landscape/flag_fog"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>).toBool()); setFlagLandscape(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); } .... }</code> </pre> <br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V792</a> Se llamar√° a la funci√≥n 'toBool' ubicada a la derecha del operador '&amp;' independientemente del valor del operando izquierdo.  Quiz√°s, es mejor usar '&amp;&amp;'.  LandscapeMgr.cpp 782 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V792</a> Se llamar√° a la funci√≥n 'toBool' ubicada a la derecha del operador '&amp;' independientemente del valor del operando izquierdo.  Quiz√°s, es mejor usar '&amp;&amp;'.  LandscapeMgr.cpp 783 </li></ul><br>  El analizador detect√≥ una expresi√≥n sospechosa en los argumentos de las <i>funciones</i> <i>setFlagAtmosphere</i> y <i>setFlagFog</i> .  De hecho: en ambos lados del operador de bits <i>y hay</i> valores de tipo <i>bool</i> .  En lugar del operador <i>&amp;</i> , debe usar el operador <i>&amp;&amp;</i> , y ahora explicar√© por qu√©. <br><br>  S√≠, el resultado de esta expresi√≥n siempre ser√° correcto.  Antes de utilizar el bit a bit "y", ambos operandos ser√°n promovidos a <i>int</i> .  En C ++, dicha conversi√≥n es <a href="">inequ√≠voca</a> : falso se convierte a 0 y verdadero se convierte a 1. Por lo tanto, el resultado de esta expresi√≥n ser√° el mismo que si se utilizara el operador <i>&amp;&amp;</i> . <br><br>  Pero hay un matiz.  Al calcular el resultado de la operaci√≥n <i>&amp;&amp;</i> , se utiliza el llamado "c√°lculo diferido".  Si el valor del operando izquierdo es <i>falso</i> , entonces el valor derecho ni siquiera se calcula, porque el "y" l√≥gico en cualquier caso devolver√° <i>falso</i> .  Esto se hace para ahorrar recursos inform√°ticos y le permite escribir dise√±os m√°s complejos.  Por ejemplo, puede verificar que el puntero no sea nulo y, de ser as√≠, desreferenciarlo para realizar una verificaci√≥n adicional.  Ejemplo: <i>if (ptr &amp;&amp; ptr-&gt; foo ())</i> . <br><br>  Este "c√°lculo <i>diferido</i> " no se realiza cuando se utiliza el operador bit a bit <i>&amp;</i> : expresiones <i>conf-&gt; value ("...", true) .toBool ()</i> se evaluar√° cada vez, independientemente del valor <i>pl-&gt; hasAtmosphere ()</i> . <br><br>  En casos raros, esto se hace a prop√≥sito.  Por ejemplo, si calcular el operando correcto tiene "efectos secundarios", el resultado se utilizar√° m√°s adelante.  Tampoco es muy bueno hacerlo, porque complica la comprensi√≥n del c√≥digo y complica el mantenimiento del mismo.  Adem√°s, el orden de c√°lculo de los operandos <i>&amp;</i> no <i>est√°</i> definido, por lo que en algunos casos de usar tales "trucos" puede obtener un comportamiento indefinido. <br><br>  Si necesita guardar efectos secundarios, h√°galo en una l√≠nea separada y guarde el resultado en una variable separada.  Las personas que trabajar√°n con este c√≥digo en el futuro te lo agradecer√°n :) <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/301/5a6/971/3015a69710bc07f948b5233dac04fc87.png"></div><br>  Pasamos al siguiente tema. <br><br><h2>  Manejo incorrecto de la memoria </h2><br>  Comencemos el tema de la memoria din√°mica con este fragmento: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/************ Basic Edge Operations ****************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* __gl_meshMakeEdge creates one edge, * two vertices, and a loop (face). * The loop consists of the two new half-edges. */</span></span> GLUEShalfEdge* __gl_meshMakeEdge(GLUESmesh* mesh) { GLUESvertex* newVertex1 = allocVertex(); GLUESvertex* newVertex2 = allocVertex(); GLUESface* newFace = allocFace(); GLUEShalfEdge* e; <span class="hljs-comment"><span class="hljs-comment">/* if any one is null then all get freed */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( newVertex1 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newVertex2 == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> || newFace == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex1 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex1); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newVertex2 != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newVertex2); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newFace != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { memFree(newFace); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } e = MakeEdge(&amp;mesh-&gt;eHead); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } MakeVertex(newVertex1, e, &amp;mesh-&gt;vHead); MakeVertex(newVertex2, e-&gt;Sym, &amp;mesh-&gt;vHead); MakeFace(newFace, e, &amp;mesh-&gt;fHead); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e; }</code> </pre> <br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V773</a> Se sali√≥ de la funci√≥n sin liberar el puntero 'newVertex1'.  Una p√©rdida de memoria es posible.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V773</a> Se sali√≥ de la funci√≥n sin liberar el puntero 'newVertex2'.  Una p√©rdida de memoria es posible.  mesh.c 312 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V773</a> La funci√≥n se sali√≥ sin liberar el puntero 'newFace'.  Una p√©rdida de memoria es posible.  mesh.c 312 </li></ul><br>  La funci√≥n asigna memoria para varias estructuras y la pasa a los punteros <i>newVertex1</i> , <i>newVertex2</i> (nombres interesantes, ¬øverdad?) Y <i>newFace</i> .  Si uno de ellos resulta ser cero, entonces toda la memoria reservada dentro de la funci√≥n se libera, despu√©s de lo cual el flujo de control abandona la funci√≥n. <br><br>  ¬øQu√© sucede si la memoria para las tres estructuras se asigna correctamente y la funci√≥n <i>MakeEdge (&amp; mesh-&gt; eHead)</i> devuelve <i>NULL</i> ?  El flujo de control alcanzar√° el segundo <i>retorno</i> . <br><br>  Dado que los punteros <i>newVertex1</i> , <i>newVertex2</i> y <i>newFace</i> son variables locales, dejar√°n de existir despu√©s de salir de la funci√≥n.  Pero la liberaci√≥n de la memoria que les pertenec√≠a no suceder√°.  Permanecer√° reservado, pero ya no tendremos acceso a √©l. <br><br>  Tales situaciones se llaman p√©rdidas de memoria.  Un escenario t√≠pico con tal error: con el uso prolongado del programa, comienza a consumir m√°s y m√°s RAM, hasta su agotamiento. <br><br>  Cabe se√±alar que en este ejemplo, el tercer <i>retorno</i> no <i>es</i> err√≥neo.  Las <i>funciones</i> <i>MakeVertex</i> y <i>MakeFace</i> transfieren las direcciones de la memoria asignada a otras estructuras de datos, delegando as√≠ la responsabilidad de su lanzamiento. <br><br>  El siguiente defecto est√° en el m√©todo, que toma 90 l√≠neas.  Por conveniencia, lo reduje, dejando solo √°reas problem√°ticas. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AstroCalcDialog::drawAngularDistanceGraph() { .... QVector&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt; xs, ys; .... }</code> </pre> <br>  Solo queda una l√≠nea.  D√©jame darte una pista: esta es la √∫nica menci√≥n de los objetos <i>xs</i> e <i>ys</i> . <br><br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se cre√≥</a> el objeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V808</a> 'xs' del tipo 'QVector' pero no se utiliz√≥.  AstroCalcDialog.cpp 5329 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se cre√≥</a> el objeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V808</a> 'ys' del tipo 'QVector' pero no se utiliz√≥.  AstroCalcDialog.cpp 5329 </li></ul><br>  Los vectores <i>xs</i> e <i>ys</i> se crean, pero no se usan en ninguna parte.  Resulta que cada vez que usa el m√©todo <i>drawAngularDistanceGraph</i> , se <i>produce</i> una creaci√≥n y eliminaci√≥n adicional de un contenedor vac√≠o.  Creo que este anuncio permaneci√≥ en el c√≥digo despu√©s de refactorizar.  Esto, por supuesto, no es un error, pero debe eliminar el c√≥digo adicional. <br><br><h2>  Moldes de tipo extra√±o </h2><br>  Otro ejemplo despu√©s de un poco de formato se ve as√≠: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SatellitesDialog::updateSatelliteData() { .... <span class="hljs-comment"><span class="hljs-comment">// set default buttonColor = QColor(0.4, 0.4, 0.4); .... }</span></span></code> </pre> <br>  Para entender cu√°l es el error, deber√° observar los prototipos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de los constructores de la clase Qcolor</a> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7d/84e/798/f7d84e79849bca96f7a27016aec0e9d3.png"></div><br>  <b>Advertencias de PVS-Studio:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V674</a> El literal '0.4' del tipo 'doble' se est√° convirtiendo impl√≠citamente al tipo 'int' mientras se llama a la funci√≥n 'QColor'.  Inspecciona el primer argumento.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V674</a> El literal '0.4' del tipo 'doble' se est√° convirtiendo impl√≠citamente al tipo 'int' mientras se llama a la funci√≥n 'QColor'.  Inspeccione el segundo argumento.  SatellitesDialog.cpp 413 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V674</a> El literal '0.4' del tipo 'doble' se est√° convirtiendo impl√≠citamente al tipo 'int' mientras se llama a la funci√≥n 'QColor'.  Inspeccione el tercer argumento.  SatellitesDialog.cpp 413 </li></ul><br>  La clase <i>Qcolor</i> no tiene constructores que acepten el tipo <i>doble</i> , por lo que los argumentos del ejemplo se convertir√°n impl√≠citamente a <i>int</i> .  Esto hace que los campos <i>r</i> , <i>g</i> , <i>b</i> del objeto <i>buttonColor</i> tengan un valor de <i>0</i> . <br><br>  Si el programador pretend√≠a crear un objeto a partir de valores de tipo <i>double</i> , deber√≠a usar un constructor diferente. <br><br>  Por ejemplo, podr√≠a usar un constructor que acepte <i>Qrgb</i> escribiendo: <br><br><pre> <code class="cpp hljs">buttonColor = QColor(QColor::fromRgbF(<span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  Podr√≠a haberse hecho de manera diferente.  Qt utiliza valores reales en el rango [0.0, 1.0] o valores enteros en el rango [0, 255] para indicar colores RGB. <br><br>  Por lo tanto, el programador podr√≠a traducir los valores de real a entero escribiendo as√≠: <br><br><pre> <code class="cpp hljs">buttonColor = QColor((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">255</span></span> * <span class="hljs-number"><span class="hljs-number">0.4</span></span>));</code> </pre> <br>  o solo <br><br><pre> <code class="cpp hljs">buttonColor = QColor(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">102</span></span>);</code> </pre> <br>  Estas aburrido  No se preocupe: hay m√°s errores interesantes por delante. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f18/aa0/297/f18aa02975f89e9e6cc7c661706fc608.png"></div><br>  <font color="#999999"><i>"Unicornio en el espacio".</i></font>  <font color="#999999"><i>Vista desde el Stellarium.</i></font> <br><br><h2>  Otros errores </h2><br>  Al final, te dej√© un poco m√°s delicioso :) Vamos a ir a uno de ellos. <br><br><pre> <code class="cpp hljs">HipsTile* HipsSurvey::getTile(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> order, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pix) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (order == orderMin &amp;&amp; !allsky.isNull()) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">2</span></span> * order)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = (pix % nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = (pix / nbw) * allsky.width() / nbw; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> s = allsky.width() / nbw; QImage image = allsky.copy(x, y, s, s); .... } .... }</code> </pre> <br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V634</a> La prioridad de la operaci√≥n '*' es mayor que la de la operaci√≥n '&lt;&lt;'.  Es posible que se utilicen par√©ntesis en la expresi√≥n.  StelHips.cpp 271 <br><br>  Bueno, ¬øpudiste detectar el error?  Considere la expresi√≥n <i>(12 * 1 &lt;&lt; (orden 2 *)) con</i> m√°s detalle.  El analizador recuerda que la operaci√≥n ' <i>*</i> ' tiene una prioridad m√°s alta que la operaci√≥n de cambio de bit ' <i>&lt;&lt;</i> '.  Es f√°cil ver que multiplicar <i>12</i> por <i>1 no tiene</i> sentido, y los corchetes alrededor del <i>orden 2 *</i> no <i>son</i> necesarios. <br><br><pre> <code class="cpp hljs"> ,    : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nbw = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span> * order));     &lt;i&gt;<span class="hljs-number"><span class="hljs-number">12</span></span> &lt;/i&gt;     .</code> </pre> <br>  Nota  Adem√°s, quiero se√±alar que si el valor del operando derecho ' <i>&lt;&lt;</i> ' es mayor o igual que el n√∫mero de bits del operando izquierdo, entonces el resultado no est√° definido.  Dado que los literales num√©ricos son <i>int</i> por defecto, que toma <i>32</i> bits, el valor del par√°metro de <i>orden</i> no debe exceder <i>15</i> .  De lo contrario, la evaluaci√≥n de la expresi√≥n puede dar lugar a un comportamiento indefinido. <br><br>  Continuamos  El siguiente m√©todo es muy confuso, pero estoy seguro de que un lector sofisticado manejar√° la detecci√≥n de errores :) <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdBoth) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdNegative) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inSignDomain == sdPositive) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V779</a> C√≥digo inalcanzable detectado.  Es posible que haya un error presente.  qcustomplot.cpp 19512. <br><br>  El hecho es que todo <i>si ... de lo contrario las</i> ramas tienen un <i>retorno</i> .  Por lo tanto, el flujo de control nunca alcanza las dos √∫ltimas l√≠neas. <br><br>  En general, este ejemplo se ejecutar√° normalmente y funcionar√° correctamente.  Pero la presencia de un c√≥digo inalcanzable solo es una se√±al.  En este caso, indica la estructura incorrecta del m√©todo, lo que complica en gran medida la legibilidad y la comprensi√≥n del c√≥digo. <br><br>  Este fragmento de c√≥digo debe ser refactorizado, obteniendo una funci√≥n m√°s ordenada en la salida.  Por ejemplo, as√≠: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* inherits documentation from base class */</span></span> QCPRange QCPStatisticalBox:: getKeyRange(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&amp; foundRange, SignDomain inSignDomain) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { foundRange = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (inSignDomain) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdBoth: { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdNegative: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> sdPositive: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey - mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mKey &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(mKey, mKey + mWidth * <span class="hljs-number"><span class="hljs-number">0.5</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } foundRange = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> QCPRange(); }</code> </pre> <br>  El √∫ltimo en nuestra revisi√≥n ser√° el error que m√°s me gust√≥.  El c√≥digo de punto de problema es corto y simple: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  ¬øHas notado algo sospechoso?  No todos pueden :) <br><br>  <b>Advertencia de PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">V603</a> El objeto fue creado pero no se est√° utilizando.  Si desea llamar al constructor, debe usar 'this-&gt; Plane :: Plane (....)'.  Plane.cpp 29 <br><br>  El programador esperaba que algunos de los campos del objeto se inicializaran dentro del constructor anidado, pero result√≥ de esta manera: cuando se <i>llama al</i> constructor <i>Plane (Vec3f &amp; v1, Vec3f &amp; v2, Vec3f &amp; v3)</i> , se crea un objeto temporal sin nombre que se elimina de inmediato.  Como resultado, una parte del objeto permanece sin inicializar. <br><br>  Para que el c√≥digo funcione correctamente, debe usar la caracter√≠stica conveniente y segura de C ++ 11: el constructor delegante: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f&amp; v1, Vec3f&amp; v2, Vec3f&amp; v3) : Plane(v1, v2, v3, SPolygon::CCW) { distance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; sDistance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre> <br>  Pero si usa el compilador para versiones anteriores del lenguaje, puede escribir as√≠: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;Plane::Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  M√°s o menos: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Observo que los dos √∫ltimos m√©todos son <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muy peligrosos</a> .  Por lo tanto, debe tener mucho cuidado y comprender bien c√≥mo funcionan dichos m√©todos. <br><br><h2>  Conclusi√≥n </h2><br>  ¬øQu√© conclusiones se pueden hacer sobre la calidad del c√≥digo Stellarium?  Honestamente, no hubo muchos errores.  Adem√°s, en todo el proyecto, no encontr√© un solo error en el que el c√≥digo est√© vinculado a un comportamiento indefinido.  Para el proyecto de c√≥digo abierto, la calidad del c√≥digo result√≥ ser de alto nivel, por lo que me quito el sombrero ante los desarrolladores.  ¬°Ustedes son geniales!  Me complaci√≥ e interes√≥ revisar su proyecto. <br><br>  ¬øQu√© pasa con el planetario mismo? Lo uso con bastante frecuencia.  Desafortunadamente, viviendo en la ciudad, rara vez puedo disfrutar de un cielo nocturno despejado, y Stellarium me permite estar en cualquier parte del mundo sin levantarme del sof√°.  ¬°Es realmente c√≥modo! <br><br>  Me gusta especialmente el modo "Constellation art".  La vista de las enormes figuras que cubren todo el cielo en un extra√±o baile es impresionante. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/613/3d5/107/6133d51079ac983aa11a017acd1945ee.png"></div><br>  <font color="#999999"><i>"Un baile extra√±o".</i></font>  <font color="#999999"><i>Vista desde el Stellarium.</i></font> <br><br>  Los terr√≠colas tienden a cometer errores, y no hay nada vergonzoso en el hecho de que estos errores se filtren en el c√≥digo.  Para esto, se desarrollan herramientas de an√°lisis de c√≥digo, como PVS-Studio.  Si eres uno de los terr√≠colas <strike>, me gusta, te</strike> sugiero que lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descargues y lo pruebes t√∫ mismo</a> . <br><br>  Espero que haya estado interesado en leer mi art√≠culo y haya aprendido algo nuevo y √∫til para usted.  Y les deseo a los desarrolladores una correcci√≥n temprana de los errores encontrados. <br><br>  ¬°Suscr√≠bete a nuestros canales y mantente atento a las noticias del mundo de la programaci√≥n! <br><br><ul><li>  Vk: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@pvsstudio_rus</a> </li><li>  Telegrama: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@pvsstudio_rus</a> </li><li>  Instagram: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@pvsstudio_rus</a> </li><li>  Twitter: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@pvsstudio_rus</a> </li><li>  YouTube: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@PVSStudioTool</a> </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br>  Si desea compartir este art√≠culo con una audiencia de habla inglesa, utilice el enlace a la traducci√≥n: George Gribkov.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hacia el espacio de nuevo: c√≥mo el unicornio visit√≥ Stellarium</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es432954/">https://habr.com/ru/post/es432954/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es432940/index.html">50 tonos de ficha</a></li>
<li><a href="../es432942/index.html">Patrones de corutina y antipatrones en Kotlin</a></li>
<li><a href="../es432944/index.html">Optimizaci√≥n forzada de consultas PostgreSQL</a></li>
<li><a href="../es432946/index.html">Unidad: trampas del desarrollo de juegos en 2D</a></li>
<li><a href="../es432948/index.html">Nubes inteligentes, empresas inteligentes: c√≥mo la IA transforma la industria de la computaci√≥n en la nube</a></li>
<li><a href="../es432956/index.html">Monstruos de Id: c√≥mo se cre√≥ Doom</a></li>
<li><a href="../es432958/index.html">La nueva paradoja cu√°ntica aclara en qu√© caso nuestras ideas sobre la realidad resultan ser err√≥neas.</a></li>
<li><a href="../es432960/index.html">Por qu√© los consumidores no temen el robo de identidad</a></li>
<li><a href="../es432964/index.html">Sobre el poder, bueno o nada: una nueva iniciativa legislativa en la Federaci√≥n de Rusia</a></li>
<li><a href="../es432966/index.html">Gestor de arranque cifrado para STM32</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>