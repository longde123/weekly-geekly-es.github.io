<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛂 📅 ◼️ Iptables und Filterung des Verkehrs von den armen und faulen Andersdenkenden 👸 🚴 🎠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Relevanz der Sperrung von Besuchen für verbotene Ressourcen betrifft jeden Administrator, dem offiziell die Nichteinhaltung der Gesetze oder Anord...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Iptables und Filterung des Verkehrs von den armen und faulen Andersdenkenden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471402/">  Die Relevanz der Sperrung von Besuchen für verbotene Ressourcen betrifft jeden Administrator, dem offiziell die Nichteinhaltung der Gesetze oder Anordnungen der zuständigen Behörden angezeigt wird. <br><br><img src="https://habrastorage.org/webt/9e/uq/ev/9euqevswnrg1zv6jaq_0nwcdnzu.png"><br><br>  Warum das Rad neu erfinden, wenn es spezielle Programme und Distributionen für unsere Aufgaben gibt, zum Beispiel: Zeroshell, pfSense, ClearOS. <br><br>  Eine weitere Frage wurde von den Behörden gestellt: Verfügt das verwendete Produkt über ein Sicherheitszertifikat unseres Staates? <br><a name="habracut"></a><br>  Wir hatten Erfahrung mit folgenden Distributionen: <br><br><ul><li>  Zeroshell - die Entwickler haben sogar eine Lizenz für 2 Jahre vorgelegt, aber es stellte sich heraus, dass die Verteilung des Interesses für uns unlogisch war, um eine kritische Funktion für uns zu erfüllen. </li><li>  pfSense - Respekt und Ehre, gleichzeitig langweilig, sich an die Befehlszeile der FreeBSD-Firewall zu gewöhnen, ist für uns nicht bequem genug (ich denke, es ist Gewohnheitssache, aber es war nicht so). </li><li>  ClearOS - es stellte sich heraus, dass unsere Hardware sehr langsam war, wir konnten keine ernsthaften Tests durchführen und warum so schwere Schnittstellen? </li><li>  Ideco SELECTA.  Es gibt ein separates Gespräch über das Aydeko-Produkt, ein interessantes Produkt, aber aus politischen Gründen ist es nicht für uns, aber ich möchte sie auch über die Lizenz für dasselbe Linux, Roundcube usw. "beißen".  Warum haben sie das Problem, dass sie, nachdem sie die Benutzeroberfläche in <b>Python</b> „gekürzt“ und Superuser-Rechte ausgewählt haben, ein fertiges Produkt verkaufen können, das aus entwickelten und verbesserten Modulen der Internet-Community besteht, die unter der GPL usw. vertrieben werden? </li></ul><br>  Ich verstehe, dass jetzt negative Schreie in meine Richtung strömen, mit Anforderungen, um meine subjektiven Gefühle im Detail zu untermauern, aber ich möchte sagen, dass dieser Netzwerkknoten auch ein Balancer des Verkehrs zu 4 externen Kanälen zum Internet ist und jeder Kanal seine eigenen Eigenschaften hat.  Ein weiterer Eckpfeiler war die Notwendigkeit, an einer von mehreren Netzwerkschnittstellen in unterschiedlichen Adressräumen zu arbeiten, und ich bin <b>bereit</b> zuzugeben, dass ich <b>nicht bereit</b> bin, VLANs überall dort zu verwenden, wo ich sie <b>benötige</b> .  Im Einsatz sind Geräte wie TP-Link TL-R480T + - sie verhalten sich im Allgemeinen nicht perfekt, mit ihren eigenen Nuancen.  Es stellte sich heraus, dass die Konfiguration dieses Teils unter Linux dank des Off-Site- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">IP-Balancing von</a> Ubuntu verantwortlich ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">: Wir kombinieren mehrere Internetkanäle zu einem</a> .  Darüber hinaus kann jeder der Kanäle jederzeit "fallen" sowie steigen.  Wenn Sie an einem Skript interessiert sind, das im Moment funktioniert (und das eine separate Veröffentlichung wert ist), schreiben Sie in die Kommentare. <br><br>  Die fragliche Lösung erhebt keinen Anspruch auf Einzigartigkeit, aber ich möchte eine Frage stellen: „Warum passt sich das Unternehmen an fragwürdige Produkte von Drittanbietern mit schwerwiegenden Hardwareanforderungen an, wenn eine Alternative in Betracht gezogen werden kann?“ <br><br>  Wenn es in Russland eine Liste von Roskomnadzor in der Ukraine gibt - einen Anhang zur Entscheidung des Nationalen Sicherheitsrates (z. B. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> ), dann schlafen die Führer auch nicht auf dem Boden.  Zum Beispiel erhielten wir nach Ansicht des Managements eine Liste verbotener Standorte, die die Arbeitsproduktivität am Arbeitsplatz verschlechtern. <br><br>  Wenn Sie mit Kollegen in anderen Unternehmen kommunizieren, in denen standardmäßig alle Websites verboten sind, und nur auf Anfrage mit Erlaubnis des Chefs auf eine bestimmte Website zugreifen können, respektvoll lächeln, nachdenken und „ein Problem rauchen“, wurde klar, dass das Leben immer noch gut ist und wir hat Ihre Suche gestartet. <br><br>  Als wir die Möglichkeit hatten, nicht nur analytisch zu sehen, was „Hausfrauenbücher“ über Verkehrsfilterung schreiben, sondern auch zu sehen, was auf den Kanälen verschiedener Anbieter passiert, haben wir die folgenden Rezepte bemerkt (alle Screenshots sind etwas beschnitten, bitte verstehen und verzeihen): <br><div class="scrollable-table"><table><tbody><tr><td>  Anbieter 1 </td><td>  - Stört nicht und legt einen eigenen DNS-Server und einen transparenten Proxyserver fest.  Na ja? .. aber wir haben Zugang zu wo wir brauchen (wenn wir es brauchen :)) </td></tr><tr><td>  Anbieter 2 </td><td>  - Er ist der Meinung, dass sein Top-Anbieter darüber nachdenken sollte. Der technische Support des Top-Anbieters gab sogar zu, warum ich die erforderliche nicht verbotene Website nicht für mich öffnen kann.  Ich denke das Bild wird dich amüsieren :) <br><br><img src="https://habrastorage.org/webt/vm/qh/v2/vmqhv2z15q8rx7wo2hqmd62zlma.png"><br><br>  Wie sich herausstellte, übersetzen sie die Namen verbotener Sites in IP-Adressen und blockieren IP (es stört sie nicht, dass 20 Sites unter dieser IP-Adresse gehostet werden können). <br></td></tr><tr><td>  Anbieter 3 </td><td>  - leitet den Verkehr dort weiter, lässt ihn aber nicht auf der Strecke zurück. </td></tr><tr><td>  Anbieter 4 </td><td>  - verbietet alle Manipulationen mit Paketen in der angegebenen Richtung. </td></tr></tbody></table></div>  Und was tun mit VPN (Opera Browser Respekt) und Browser-Plug-Ins?  Zuerst haben wir beim Spielen mit dem Mikrotik-Hub sogar ein ressourcenintensives Rezept für L7 erhalten, das wir später aufgeben mussten (es gibt möglicherweise verbotene Namen, es wird traurig, wenn der PPC460GT-Prozessor zusätzlich zu seinen direkten Aufgaben auf Routen in Dutzenden von Ausdrücken auf 100 geht %). <br><br><img src="https://habrastorage.org/webt/mh/aa/5y/mhaa5y8mjctihnqzfcauqq8ctgc.png">  . <br><br>  Was wurde klar: <br>  CSN unter 127.0.0.1 ist absolut kein Allheilmittel. Moderne Versionen von Browsern ermöglichen es Ihnen dennoch, solche Probleme zu umgehen.  Es ist unmöglich, alle Benutzer mit reduzierten Rechten einzuschränken, und man darf die große Anzahl alternativer DNS nicht vergessen.  Das Internet ist nicht statisch. Zusätzlich zu neuen DNS-Adressen kaufen gesperrte Websites neue Adressen, ändern Domänen der obersten Ebene und können Zeichen in ihren Adressen hinzufügen / entfernen.  Trotzdem hat er das Recht, so etwas zu leben (subjektiv: In einem solchen Schutz sehe ich, wie der Browser ratlos immer noch auf eine Antwort wartet und das Laden der Seite, die Elemente verbotenen Inhalts enthält, lange dauert): <br><br><pre><code class="bash hljs">ip route add blackhole 1.2.3.4</code> </pre> <br>  Das Abrufen einer Liste von IP-Adressen aus der Liste der gesperrten Websites wäre sehr effektiv, aber aus den oben genannten Gründen haben wir uns den Überlegungen zu Iptables zugewandt.  Unter CentOS Linux Release 7.5.1804 gab es bereits einen Live-Balancer. <br><br>  Das Internet des Benutzers sollte schnell sein und der Browser sollte keine halbe Minute warten, um zu dem Schluss zu kommen, dass diese Seite nicht verfügbar ist.  Nach langer Suche nach verschiedenen Sperroptionen kamen wir zu diesem Modell: <br>  Datei 1 -&gt; <b>/ script / verweigerter_Host</b> , Liste der verbotenen Namen: <br><br><pre> <code class="plaintext hljs">test.test blablabla.bubu torrent porno</code> </pre> <br>  Datei 2 -&gt; <b>/ script / verweigerter_Bereich</b> , eine Liste verbotener Adressräume und Adressen: <br><br><pre> <code class="plaintext hljs">192.168.111.0/24 241.242.0.0/16</code> </pre> <br>  <b>Skriptdatei</b> 3 -&gt; <b>ipt.sh</b> , die mit ipables funktioniert: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#       HOSTS=`cat /script/denied_host | grep -v '^#'` RANGE=`cat /script/denied_range | grep -v '^#'` echo "Stopping firewall and allowing everyone..." #    iptables,      sudo iptables -F sudo iptables -X sudo iptables -t nat -F sudo iptables -t nat -X sudo iptables -t mangle -F sudo iptables -t mangle -X sudo iptables -P INPUT ACCEPT sudo iptables -P FORWARD ACCEPT sudo iptables -P OUTPUT ACCEPT #     (  ) sudo sh rout.sh #          for i in $HOSTS; do sudo iptables -I FORWARD -m string --string $i --algo bm --from 1 --to 600 -p tcp -j REJECT --reject-with tcp-reset; sudo iptables -I FORWARD -m string --string $i --algo bm --from 1 --to 600 -p udp -j DROP; done #          for i in $RANGE; do sudo iptables -I FORWARD -p UDP -d $i -j DROP; sudo iptables -I FORWARD -p TCP -d $i -j REJECT --reject-with tcp-reset; done</span></span></code> </pre><br>  Die Verwendung von sudo ist auf die Tatsache zurückzuführen, dass wir einen kleinen Hack über die WEB-Schnittstelle steuern müssen. Wie die Erfahrung mit der Verwendung eines solchen Modells seit mehr als einem Jahr gezeigt hat, ist WEB nicht so notwendig.  Nach der Implementierung bestand der Wunsch, die Sites in der Datenbank usw. aufzulisten.  Die Anzahl der blockierten Hosts beträgt mehr als 250 + ein Dutzend Adressräume.  In der Tat gibt es ein Problem beim Wechsel zur Site über eine https-Verbindung sowie beim Systemadministrator. Ich habe Beschwerden über Browser :), aber dies sind Sonderfälle. Die meisten Antworten auf den fehlenden Zugriff auf die Ressource sind immer noch auf unserer Seite. Wir blockieren auch erfolgreich Opera VPN-Plugins wie friGate und Telemetrie von Microsoft. <br><br><img src="https://habrastorage.org/webt/mm/_t/jy/mm_tjyvq1tpwumvwb3pezgfmixe.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de471402/">https://habr.com/ru/post/de471402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de471380/index.html">Pentester an der Spitze der Cybersicherheit</a></li>
<li><a href="../de471384/index.html">Liga des freien Internets</a></li>
<li><a href="../de471388/index.html">Einige Merkmale der Fähigkeitsentwicklung für Alice</a></li>
<li><a href="../de471394/index.html">Habr Weekly # 22 / Wie man in einem Team kommuniziert, neue Steuern für Megakonzerne, TON an den Fingern, Amazon kopiert Produkte</a></li>
<li><a href="../de471396/index.html">Wie CSS Grid die Inhaltsstrukturierung ändert</a></li>
<li><a href="../de471404/index.html">Kann man mehr verdienen, wenn man als Ingenieur in einem anderen Land arbeitet?</a></li>
<li><a href="../de471408/index.html">Eine Alternative zu Summenphasenwechselrichtern: Übertragungsleitungen (TQWT, ALT)</a></li>
<li><a href="../de471412/index.html">Ein Beitrag über eine Menge Müll auf dem Desktop</a></li>
<li><a href="../de471414/index.html">Führendes Helpdesk-System. Wie erhalten wir Anforderungen und entwickeln einen Cloud-Service?</a></li>
<li><a href="../de471418/index.html">Was kann der VR-Markt einem Spieledesigner beibringen?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>