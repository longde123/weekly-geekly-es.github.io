<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍷 👇🏿 ↕️ نمذجة لعبة محمولة ، ومن أين تبدأ ، وكيفية القيام بذلك. الجزء 2 💃 🆑 🗞️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="بالنسبة لأولئك الذين فاتتهم الجزء الأول - الجزء 1 
 الجزء التالي - الجزء 3 

 إذا كان أي شخص مهتمًا بالقراءة حول المجمع الذي يستخدمه الحدث ، فأنت هنا ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>نمذجة لعبة محمولة ، ومن أين تبدأ ، وكيفية القيام بذلك. الجزء 2</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453236/" style=";text-align:right;direction:rtl">  بالنسبة لأولئك الذين فاتتهم الجزء الأول - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزء 1</a> <br>  الجزء التالي - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزء 3</a> <br><br>  إذا كان أي شخص مهتمًا بالقراءة حول المجمع الذي يستخدمه الحدث ، فأنت <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> ، ولكن هذا ليس ضروريًا. <br><br><h3 style=";text-align:right;direction:rtl">  لذلك ، نبدأ في جمع كل شيء في كومة </h3><br><img src="https://habrastorage.org/webt/z-/sa/5r/z-sa5rumeqhyobemc4hutmppbai.png"><br><a name="habracut"></a><br>  <b>الصواريخ:</b> <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">فئة الصواريخ قاعدة</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="java hljs">using DG.Tweening; using GlobalEventAggregator; using UnityEngine; namespace PlayerRocket { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rocket</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayerRocketBase</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pathorrectionTime = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 movingUp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartEventReact</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ButtonStartPressed buttonStartPressed)</span></span></span><span class="hljs-function"> </span></span>{ transform.SetParent(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); rocketState = RocketState.MOVE; transform.DORotate(Vector3.zero, pathorrectionTime); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ base.Start(); EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RegisterUser { playerHelper = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rocketState == RocketState.WAITFORSTART) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; RocketBehaviour(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RocketBehaviour(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RocketBehaviour</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (rocketState) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.WAITFORSTART: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputController.OnTouch &amp;&amp; !inputController.OnDrag) rocketHolder.RotateHolder(inputController.worldMousePos); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.MOVE: rigidbody.AddRelativeForce(Vector3.up*(config.Speed*Time.deltaTime)); forceModel.AddModificator(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.STOP: Debug.Log(<span class="hljs-string"><span class="hljs-string">" "</span></span>); rigidbody.velocity = Vector3.zero; rigidbody.drag = <span class="hljs-number"><span class="hljs-number">50</span></span>; rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.COMPLETESTOP: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } }</code> </pre> <br></div></div><br>  ماذا نحتاج لإطلاق صاروخ؟  في مساحة اللعب ، نحتاج إلى كوكب مشروط نبدأ به ، زر تشغيل وصاروخ.  ماذا يجب أن يكون صاروخ قادرًا على فعله؟ <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  انتظر البداية </li><li style=";text-align:right;direction:rtl">  أن يطير </li><li style=";text-align:right;direction:rtl">  تتأثر المعدلات </li><li style=";text-align:right;direction:rtl">  للتوقف </li></ol><br>  بمعنى ، لدينا سلوك / حالة صاروخ مختلفة ، اعتمادًا على الحالة الحالية ، يجب أن يوفر الصاروخ سلوكًا مختلفًا.  في البرمجة ، نواجه باستمرار موقفًا حيث يمكن أن يكون للكائن العديد من السلوكيات المختلفة جذريًا. <br><br>  بالنسبة إلى السلوك المعقد للكائنات - من الأفضل استخدام الأنماط السلوكية ، على سبيل المثال ، نمط الحالة.  بالنسبة للبساطة ، غالبًا ما يستخدم المبرمجون المبتدئون الكثير إذا كان الأمر كذلك.  أوصي باستخدام التبديل والتعداد.  أولاً ، هذا تقسيم أوضح للمنطق إلى مراحل محددة ، وبفضل هذا سنعرف تمامًا الحالة التي نحن فيها الآن ، وما يحدث ، هناك فرص أقل لتحويل الشفرة إلى مجموعة من الاستثناءات من الاستثناءات. <br><br>  <b>كيف يعمل:</b> <br><br>  أولاً نبدأ بالتعداد مع الحالات التي نحتاجها: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> RocketState { WAITFORSTART = <span class="hljs-number"><span class="hljs-number">0</span></span>, MOVE = <span class="hljs-number"><span class="hljs-number">1</span></span>, STOP = <span class="hljs-number"><span class="hljs-number">2</span></span>, COMPLETESTOP = <span class="hljs-number"><span class="hljs-number">3</span></span>, }</code> </pre> <br>  في الصف الأم لدينا حقل - <pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> RocketState rocketState;</code> </pre> <br>  بشكل افتراضي ، يتم تعيين القيمة الأولى لها.  يقوم التعداد نفسه بتعيين القيم الافتراضية ، ولكن بالنسبة للبيانات التي يمكن تغييرها من الأعلى أو تكوينها بواسطة مصممي الألعاب - أقوم بتعيين القيم يدويًا ، لماذا؟  من أجل أن تكون قادرة على إضافة قيمة أخرى إلى inam في أي مكان وعدم انتهاك البيانات المخزنة.  كما أنصحك أن تدرس علم التعداد. <br><br>  <b>التالي:</b> <br><br>  نحدد السلوك نفسه في التحديث ، وهذا يتوقف على قيمة حقل rocketState <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RocketBehaviour(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RocketBehaviour</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (rocketState) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.WAITFORSTART: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputController.OnTouch &amp;&amp; !inputController.OnDrag) rocketHolder.RotateHolder(inputController.worldMousePos); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.MOVE: rigidbody.AddRelativeForce(Vector3.up*(config.Speed*Time.deltaTime)); forceModel.AddModificator(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.STOP: Debug.Log(<span class="hljs-string"><span class="hljs-string">" "</span></span>); rigidbody.velocity = Vector3.zero; rigidbody.drag = <span class="hljs-number"><span class="hljs-number">50</span></span>; rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> RocketState.COMPLETESTOP: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: rocketState = RocketState.COMPLETESTOP; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  <b>سوف أفهم ما يحدث:</b> <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  عندما ننتظر ، نقوم ببساطة بتدوير الصاروخ باتجاه مؤشر الماوس ، وبالتالي تحديد المسار الأولي </li><li style=";text-align:right;direction:rtl">  الحالة الثانية - الطيران ، تسريع الصاروخ في الاتجاه الصحيح ، وتحديث نموذج التعديل لظهور الكائنات التي تؤثر على المسار </li><li style=";text-align:right;direction:rtl">  الحالة الثالثة هي عندما يصل الفريق إلينا للتوقف ، وهنا نقوم بعمل كل شيء حتى يتوقف الصاروخ ويترجم إلى الحالة - لقد توقفنا تمامًا. </li><li style=";text-align:right;direction:rtl">  الحالة الأخيرة هي أننا لا نفعل شيئًا. </li></ol><br>  راحة النموذج الحالي - كل هذا قابل للتوسعة وقابل للتعديل بسهولة ، ولكن هناك شيء واحد ولكن ارتباط ضعيف - وهذا هو الوقت الذي يمكن أن يكون لدينا حالة تجمع بين عدد من الحالات الأخرى.  هنا إما علامة inam للعلم ، مع تعقيد المعالجة ، أو التبديل بالفعل إلى المزيد من الأنماط "الثقيلة". <br><br>  اكتشفنا الصاروخ.  والخطوة التالية هي كائن بسيط ولكن مضحك - زر البداية. <br><br><h3 style=";text-align:right;direction:rtl">  زر البدء </h3><br>  الوظائف التالية مطلوبة من قِبل النقر عليها ، وأبلغت أنها نقرت عليها. <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">بدء زر الفصل</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs">using UnityEngine; using UnityEngine.EventSystems; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StartButton</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IPointerDownHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> bool isTriggered; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonStartPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isTriggered) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isTriggered = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonStartPressed()); Debug.Log(<span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPointerDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ ButtonStartPressed(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> struct ButtonStartPressed { }</code> </pre> <br></div></div><br>  وفقًا لتصميم اللعبة ، هذا كائن ثلاثي الأبعاد على المسرح ، من المفترض أن يكون الزر مدمجًا في تصميم كوكب البدء.  حسنًا ، حسنًا ، هناك فارق بسيط - كيفية تتبع نقرة على كائن في مشهد؟ <br><br>  إذا قمنا google ، فسنجد مجموعة من أساليب OnMouse ، من بينها نقرة.  قد يبدو هذا خيارًا سهلاً ، لكنه سيء ​​جدًا ، بدءًا من حقيقة أنه يعمل غالبًا (هناك العديد من الفروق الدقيقة لتتبع النقرات) ، "عزيزي" ، ينتهي بحقيقة أنه لا يعطي هذا العدد من الكتل من الكعك الموجودة في UnityEngine.EventSystems. <br><br>  في النهاية ، أوصي باستخدام UnityEngine.EventSystems والواجهات IPointerDownHandler ، IPointerClickHandler.  في أساليبهم ، ندرك رد الفعل على الضغط ، ولكن هناك العديد من الفروق الدقيقة. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يجب أن يكون EventSystem حاضرًا في المشهد ، وهذا هو كائن / فئة / مكون من الوحدة ، يتم إنشاؤه عادةً عند إنشاء اللوحة القماشية للواجهة ، ولكن يمكنك أيضًا إنشاءها بنفسك. </li><li style=";text-align:right;direction:rtl">  يجب أن يكون Physics RayCaster موجودًا على الكاميرا (هذا ثلاثي الأبعاد ، ولرسومات ثنائية الأبعاد يوجد متسابق منفصل) </li><li style=";text-align:right;direction:rtl">  يجب أن يكون هناك مصادم في المنشأة </li></ol><br>  <i>في المشروع ، يبدو كما يلي:</i> <br><br><img src="https://habrastorage.org/webt/-l/qa/1s/-lqa1sfgetxwqvlj7tqn1qdafia.jpeg"><br><br>  الآن يتتبع الكائن النقرة وتسمى هذه الطريقة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnPointerDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PointerEventData eventData)</span></span></span><span class="hljs-function"> </span></span>{ ButtonStartPressed(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ButtonStartPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isTriggered) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; isTriggered = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; GlobalEventAggregator.EventAggregator.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ButtonStartPressed()); Debug.Log(<span class="hljs-string"><span class="hljs-string">""</span></span>); }</code> </pre> <br>  <b>ما يجري هنا:</b> <br><br>  لدينا حقل منطقي نتتبع فيه ما إذا كان الزر قد تم الضغط عليه أم لا (هذا هو الحماية من الضغط المتكرر حتى لا يكون هناك برنامج تشغيل يبدأ في كل مرة). <br><br>  بعد ذلك ، نسمي الحدث - يتم الضغط على الزر ، والذي تشترك فيه فئة الصواريخ ، ووضع الصاروخ في حالة حركة. <br><br>  القفز إلى الأمام قليلاً - لماذا هو هنا وهناك للأحداث؟  هذه برمجة موجهة نحو الحدث ، أولاً ، نموذج الحدث أرخص من المعالجة المستمرة للبيانات من أجل اكتشاف التغييرات.  ثانياً ، هذا هو أضعف اتصال ، لا نحتاج إلى أن نعرف على الصاروخ أن هناك زرًا ، وضغط عليه شخص ما ، وهكذا ، نحن نعرف فقط أن هناك حدثًا لبدء ، تلقيناه ونتصرف.  علاوة على ذلك ، هذا الحدث مثير للاهتمام ليس فقط للصاروخ ، على سبيل المثال ، يتم توقيع لوحة مع المعدلات لنفس الحدث ، بل يتم إخفاؤها في بداية الصاروخ.  أيضًا ، قد يكون هذا الحدث موضع اهتمام وحدة التحكم في الإدخال - وقد لا تتم معالجة إدخال المستخدم أو معالجته بشكل مختلف بعد إطلاق الصاروخ. <br><br>  لماذا لا يحب الكثير من المبرمجين نموذج الحدث؟  نظرًا لأن الكثير من الأحداث والاشتراكات في هذه الأحداث يمكن بسهولة تحويل الشفرة إلى شعرية ، حيث لا يكون من الواضح على الإطلاق من أين تبدأ وما إذا كانت ستنتهي في مكان ما ، ناهيك عن حقيقة أنك تحتاج أيضًا إلى مراقبة إلغاء الاشتراك / الاشتراك والحفاظ على جميع الكائنات حية. <br><br>  ولهذا السبب ، استخدم تطبيق مجمع الأحداث الخاص بي لتنفيذ الأحداث ، وهو في الواقع لا ينقل الأحداث ، ولكن حاويات البيانات من خلال الأحداث ، وتشترك الطبقات في البيانات التي تهمهم.  أيضًا ، يقوم المُجمّع نفسه بمراقبة الكائنات الحية ورمي الكائنات الميتة من المشتركين.  بفضل نقل الحاوية ، يمكن أيضًا إجراء الحقن ؛ يمكنك تمرير رابط إلى الفئة التي تهمنا.  بواسطة الحاوية ، يمكنك بسهولة تتبع من يقوم بمعالجة وإرسال هذه البيانات.  للنماذج هو شيء عظيم. <br><br><h3 style=";text-align:right;direction:rtl">  دوران الصواريخ لتحديد مسار البداية </h3><br><img src="https://habrastorage.org/webt/se/fm/hx/sefmhxvs8qjjymxmsj-i9uogdk0.jpeg"><br>  وفقًا لتصميم اللعبة ، يجب أن يكون الصاروخ قادرًا على الدوران حول الكوكب لتحديد المسار الأولي ، ولكن ليس أكثر من زاوية معينة.  يتم الدوران عن طريق اللمس - يتبع الصاروخ ببساطة الإصبع ويتم توجيهه دائمًا إلى المكان الذي وضعناه فيه على الشاشة.  بالمناسبة ، إنه فقط النموذج الأولي الذي جعل من الممكن تحديد أن هذه نقطة ضعف وهناك العديد من الحلقات المرتبطة بالإدارة والتي تحد من هذه الوظيفة. <br><br>  <b>لكن بالترتيب:</b> <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نحن بحاجة إلى أن يتحول الصاروخ نسبة إلى الكوكب في اتجاه عربة اليد </li><li style=";text-align:right;direction:rtl">  نحن بحاجة إلى المشبك زاوية الدوران </li></ol><br>  بالنسبة إلى الدوران بالنسبة للكوكب - يمكنك الدوران برفق حول المحور وحساب محور الدوران ، أو يمكنك ببساطة إنشاء كائن مع دمية متمركزة داخل الكوكب ، وتحريك الصاروخ هناك ، وتدوير الدمية بهدوء حول المحور Z ، وستحتوي الدمية على فئة تحدد سلوك الكائن.  سوف الصاروخ تدور معها.  الكائن اتصلت RocketHolder.  نحن برزت بها. <br><br>  الآن عن القيود المفروضة على تحول وتحول في اتجاه عربة اليد: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">الطبقة RocketHolder</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs">using UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketHolder</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> clampAngle = <span class="hljs-number"><span class="hljs-number">45</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Awake</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ GlobalEventAggregator.EventAggregator.AddListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, (InjectEvent&lt;RocketHolder&gt; obj) =&gt; obj.inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampAngle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> angle, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> from, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> to)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) angle = <span class="hljs-number"><span class="hljs-number">360</span></span> + angle; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &gt; <span class="hljs-number"><span class="hljs-number">180f</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Mathf.Max(angle, <span class="hljs-number"><span class="hljs-number">360</span></span> + from); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Mathf.Min(angle, to); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClampRotationVectorZ</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vector3 rotation )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(rotation.x, rotation.y, ClampAngle(rotation.z, -clampAngle, clampAngle)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RotateHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Vector3 targetPosition)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> diff = targetPosition - transform.position; diff.Normalize(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> rot_z = Mathf.Atan2(diff.y, diff.x) * Mathf.Rad2Deg; transform.rotation = Quaternion.Euler(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">0f</span></span>, rot_z - <span class="hljs-number"><span class="hljs-number">90</span></span>); transform.eulerAngles = ClampRotationVectorZ(transform.rotation.eulerAngles); } }</code> </pre> <br></div></div><br>  على الرغم من أن اللعبة في النظرية ثلاثية الأبعاد ، إلا أن المنطق واللعب بالكامل في الواقع ثنائي الأبعاد.  ونحن بحاجة فقط إلى تشديد الصاروخ حول المحور Z في اتجاه مكان الضغط.  في نهاية الطريقة ، نقوم بربط درجة الدوران بالقيمة المحددة في المفتش.  في طريقة الاستيقاظ ، يمكنك رؤية التنفيذ الصحيح لحقن الصف من خلال مجمع. <br><br><h3 style=";text-align:right;direction:rtl">  InputController </h3><br>  أحد أهم الفصول ، هو الذي يجمع سلوك المستخدم ويعالجه.  الضغط على مفاتيح الاختصار وأزرار لوحة اللعبة ولوحة المفاتيح وما إلى ذلك  لديّ إدخال بسيط إلى حد ما في النموذج الأولي ، في الواقع أنت بحاجة إلى معرفة 3 أشياء فقط: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  هل هناك نقرة وإحداثياتها </li><li style=";text-align:right;direction:rtl">  هل هناك انتقاد عمودي وكم انتقد </li><li style=";text-align:right;direction:rtl">  هل أعمل مع واجهة / المعدلات </li></ol><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">الطبقة InputController</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs">using System; using UnityEngine; using UnityEngine.EventSystems; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputController</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MonoBehaviour</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> DirectionRange = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector3 clickedPosition; [Header(<span class="hljs-string"><span class="hljs-string">"     "</span></span>)] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> afterThisDistanceWeGonnaDoSwipe = <span class="hljs-number"><span class="hljs-number">0.5f</span></span>; [Header(<span class="hljs-string"><span class="hljs-string">"  "</span></span>)] [SerializeField] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> speedOfVerticalScroll = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ReactiveValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; ReactiveVerticalScroll { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> set; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 worldMousePos =&gt; Camera.main.ScreenToWorldPoint(Input.mousePosition); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool OnTouch { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> set; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> bool OnDrag { get; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> set; } <span class="hljs-comment"><span class="hljs-comment">// Start is called before the first frame update private void Awake() { ReactiveVerticalScroll = new ReactiveValue&lt;float&gt;(); GlobalEventAggregator.EventAggregator.AddListener(this, (ImOnDragEvent obj) =&gt; OnDrag = obj.IsDragging); GlobalEventAggregator.EventAggregator.AddListener&lt;InjectEvent&lt;InputController&gt;&gt;(this, InjectReact); } private void InjectReact(InjectEvent&lt;InputController&gt; obj) { obj.inject(this); } private void OnEnable() { GlobalEventAggregator.EventAggregator.Invoke(this); } void Start() { GlobalEventAggregator.EventAggregator.Invoke(this); } private void MouseInput() { if (EventSystem.current.IsPointerOverGameObject() &amp;&amp; EventSystem.current.gameObject.layer == 5) return; if (Input.GetKeyDown(KeyCode.Mouse0)) clickedPosition = Input.mousePosition; if (Input.GetKey(KeyCode.Mouse0)) { if (OnDrag) return; VerticalMove(); OnTouch = true; return; } OnTouch = false; ReactiveVerticalScroll.CurrentValue = 0; } private void VerticalMove() { if ( Math.Abs(Input.mousePosition.y-clickedPosition.y) &lt; afterThisDistanceWeGonnaDoSwipe) return; var distance = clickedPosition.y + Input.mousePosition.y * speedOfVerticalScroll; if (Input.mousePosition.y &gt; clickedPosition.y) ReactiveVerticalScroll.CurrentValue = distance; else if (Input.mousePosition.y &lt; clickedPosition.y) ReactiveVerticalScroll.CurrentValue = -distance; else ReactiveVerticalScroll.CurrentValue = 0; } // Update is called once per frame void Update() { MouseInput(); } } }</span></span></code> </pre> <br></div></div><br>  كل شيء في المقدمة وبدون مشاكل ، قد يكون التطبيق المثير للاهتمام هو التطبيق البدائي للملكية التفاعلية - عندما كنت بدأت للتو في البرنامج ، كان من المثير للاهتمام دائمًا كيفية معرفة أن البيانات قد تغيرت ، دون تهوية مستمرة للبيانات.  حسنا ، هذا كل شيء. <br><br>  يبدو مثل هذا: <br><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">فئة ReactiveValue</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReactiveValue</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T currentState; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;T&gt; OnChange; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T CurrentValue { get =&gt; currentState; set { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value.Equals(currentState)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { currentState = value; OnChange?.Invoke(currentState); } } } }</code> </pre><br></div></div><br>  نحن نشترك في OnChange ، ونتعذب إذا تغيرت القيمة فقط. <br><br>  فيما يتعلق بالنماذج الأولية والهندسة المعمارية - النصائح متشابهة ، والخصائص والأساليب العامة فقط ، يجب تغيير جميع البيانات محليًا فقط.  أي معالجة والحسابات - إضافة ما يصل وفقا لطرق منفصلة.  نتيجة لذلك ، يمكنك دائمًا تغيير التطبيق / الحسابات ، ولن يؤثر ذلك على المستخدمين الخارجيين للفئة.  هذا كل شيء الآن ، في الجزء الأخير - حول المعدلات والواجهة (إسقاط السحب).  وأخطط لوضع المشروع في بوابة حتى أستطيع أن أرى / أشعر.  إذا كانت لديك أسئلة حول النماذج الأولية - اسأل ، سأحاول الإجابة بوضوح. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar453236/">https://habr.com/ru/post/ar453236/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar453220/index.html">13 أخطاء التسويق عبر البريد الإلكتروني لتجنب تحسين المشاركة</a></li>
<li><a href="../ar453222/index.html">SphinxSearch-meetup SuperJob</a></li>
<li><a href="../ar453228/index.html">ساعة Nixie على المؤشرات IN-18</a></li>
<li><a href="../ar453232/index.html">كتابة مليار أغنية باستخدام C # و Deep Learning</a></li>
<li><a href="../ar453234/index.html">الهندسة العكسية لبروتوكول التبادل في معدات EOS</a></li>
<li><a href="../ar453238/index.html">تشغيل الاضواء على التتابع</a></li>
<li><a href="../ar453242/index.html">ملعب للأحداث الصيفية</a></li>
<li><a href="../ar453246/index.html">ERP - نظام التدهور المستمر</a></li>
<li><a href="../ar453248/index.html">بعثة أرتيميس القمرية - إنتاج العنصر الرئيسي لمحطة القمر المدارية القمرية المدارية</a></li>
<li><a href="../ar453252/index.html">كيف فعلنا برنامج نادي Sportmaster</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>