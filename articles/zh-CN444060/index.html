<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–•ğŸ¼ â—»ï¸ ğŸ” ä»Nagiosè¿ç§»åˆ°æ¾³å¤§åˆ©äºšçš„Icinga2 ğŸ“’ ğŸˆ‚ï¸ ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ 


 æˆ‘æ˜¯Linuxç³»ç»Ÿç®¡ç†å‘˜ï¼Œæˆ‘äº2015å¹´å‡­ç‹¬ç«‹çš„ä¸“ä¸šç­¾è¯ä»ä¿„ç½—æ–¯ç§»å±…åˆ°æ¾³å¤§åˆ©äºšï¼Œä½†æœ¬æ–‡ä¸ä¼šæ¶‰åŠå¦‚ä½•è®©å°çŒªæˆä¸ºæ‹–æ‹‰æœºã€‚ è¿™äº›æ–‡ç« å·²ç»è¶³å¤Ÿäº†ï¼ˆå°½ç®¡å¦‚æ­¤ï¼Œå¦‚æœæœ‰å…´è¶£çš„è¯ï¼Œæˆ‘ä¹Ÿä¼šå†™è¿™ç¯‡æ–‡ç« ï¼‰ï¼Œæ‰€ä»¥æˆ‘æƒ³è°ˆä¸€è°ˆåœ¨æˆ‘ä½œä¸ºlinux-opså·¥ç¨‹å¸ˆåœ¨æ¾³å¤§åˆ©äºšå·¥ä½œæœŸé—´å¦‚ä½•ä»ä¸€ä¸ªç³»ç»Ÿå¼€å§‹ç§»æ¤ç›‘è§†å¦ä¸€ä¸ªã€‚ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»Nagiosè¿ç§»åˆ°æ¾³å¤§åˆ©äºšçš„Icinga2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444060/"><p> å¤§å®¶å¥½ </p><br><p> æˆ‘æ˜¯Linuxç³»ç»Ÿç®¡ç†å‘˜ï¼Œæˆ‘äº2015å¹´å‡­ç‹¬ç«‹çš„ä¸“ä¸šç­¾è¯ä»ä¿„ç½—æ–¯ç§»å±…åˆ°æ¾³å¤§åˆ©äºšï¼Œä½†æœ¬æ–‡ä¸ä¼šæ¶‰åŠå¦‚ä½•è®©å°çŒªæˆä¸ºæ‹–æ‹‰æœºã€‚ è¿™äº›æ–‡ç« å·²ç»è¶³å¤Ÿäº†ï¼ˆå°½ç®¡å¦‚æ­¤ï¼Œå¦‚æœæœ‰å…´è¶£çš„è¯ï¼Œæˆ‘ä¹Ÿä¼šå†™è¿™ç¯‡æ–‡ç« ï¼‰ï¼Œæ‰€ä»¥æˆ‘æƒ³è°ˆä¸€è°ˆåœ¨æˆ‘ä½œä¸ºlinux-opså·¥ç¨‹å¸ˆåœ¨æ¾³å¤§åˆ©äºšå·¥ä½œæœŸé—´å¦‚ä½•ä»ä¸€ä¸ªç³»ç»Ÿå¼€å§‹ç§»æ¤ç›‘è§†å¦ä¸€ä¸ªã€‚ å…·ä½“æ¥è¯´-Nagios =&gt; Icinga2ã€‚ </p><br><p> æœ¬æ–‡éƒ¨åˆ†æ˜¯æŠ€æœ¯æ€§çš„ï¼Œéƒ¨åˆ†æ˜¯å…³äºä¸äººä¹‹é—´çš„æ²Ÿé€šä»¥åŠä¸æ–‡åŒ–å’Œå·¥ä½œæ–¹æ³•çš„å·®å¼‚ç›¸å…³çš„é—®é¢˜ã€‚ </p><a name="habracut"></a><br><p> ä¸å¹¸çš„æ˜¯ï¼Œâ€œ codeâ€æ ‡ç­¾æ²¡æœ‰çªå‡ºæ˜¾ç¤ºPuppetå’Œyamlä»£ç ï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸ä½¿ç”¨â€œ plaintextâ€ã€‚ </p><br><p>  2016å¹´12æœˆ21æ—¥ä¸Šåˆï¼Œæ²¡æœ‰ä»»ä½•ç”Ÿç—…çš„è¿¹è±¡ã€‚ æˆ‘åƒå¾€å¸¸ä¸€æ ·ï¼Œåœ¨å·¥ä½œæ—¥çš„å‰åŠå°æ—¶ä»¥æœªç»æ³¨å†Œçš„åŒ¿åæ–¹å¼é˜…è¯»Habrï¼Œå¸ç€å’–å•¡ï¼Œè¯»äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™ç¯‡æ–‡ç« </a> ã€‚ </p><br><p> ç”±äºNagiosåœ¨å…¬å¸ä¸­ä½¿ç”¨è¿‡ï¼Œæ— éœ€ä¸‰æ€è€Œåè¡Œï¼Œæ‰€ä»¥æˆ‘åœ¨Redmineä¸­åˆ›å»ºäº†ä¸€å¼ ç¥¨è¯ï¼Œå¹¶å°†é“¾æ¥æ‰”åˆ°äº†å¸¸è§„èŠå¤©ä¸­ï¼Œå› ä¸ºæˆ‘è®¤ä¸ºè¿™å¾ˆé‡è¦ã€‚ è¯¥å€¡è®®ç”šè‡³åœ¨æ¾³å¤§åˆ©äºšä¹Ÿåº”å—åˆ°æƒ©ç½šï¼Œå› æ­¤è‡ªä»æˆ‘å‘ç°è¿™ä¸ªé—®é¢˜ä»¥æ¥ï¼Œé¦–å¸­å·¥ç¨‹å¸ˆå°±æŠŠè¿™ä¸ªé—®é¢˜æŒ‚åœ¨æˆ‘èº«ä¸Šã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ¥è‡ªRedmineçš„å±å¹•</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ge/uc/gu/geucgutwhu3_zu4uwes2ozuwa3e.jpeg"></div></div><br><p> åœ¨æˆ‘ä»¬çš„éƒ¨é—¨ä¸­ï¼Œåœ¨æå‡ºæ„è§ä¹‹å‰ï¼Œä¹ æƒ¯ä¸Šæä¾›è‡³å°‘ä¸€ä¸ªæ›¿ä»£æ–¹æ³•ï¼Œå³ä½¿é€‰æ‹©å¾ˆæ˜æ˜¾ï¼Œå› æ­¤æˆ‘ä»è°·æ­Œæœç´¢å½“å‰æ€»ä½“ä¸Šä¸å“ªäº›ç›‘è§†ç³»ç»Ÿç›¸å…³ï¼Œå› ä¸ºåœ¨æˆ‘ä¸Šæ¬¡å·¥ä½œçš„æœ€åä¸€ä¸ªåœ°æ–¹ï¼Œæˆ‘æœ‰è‡ªå·±çš„ä¸ªäººè®°å½•ç³»ç»Ÿï¼Œéå¸¸åŸå§‹ï¼Œä½†ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œå¹¶å®Œæˆåˆ†é…ç»™å®ƒçš„æ‰€æœ‰ä»»åŠ¡ã€‚  Pythonï¼Œåœ£å½¼å¾—å ¡ç†å·¥å­¦é™¢å’Œåœ°é“è§„åˆ™ã€‚ ä¸ï¼Œåœ°é“å¾ˆçƒ‚ã€‚ è¿™æ˜¯ä¸ªäººçš„ï¼ˆ11å¹´çš„å·¥ä½œç»éªŒï¼‰ï¼Œå€¼å¾—å•ç‹¬æ’°å†™ï¼Œä½†ç°åœ¨ä¸è¡Œäº†ã€‚ </p><br><p> å…³äºåœ¨å½“å‰ä½ç½®æ›´æ”¹åŸºç¡€ç»“æ„é…ç½®çš„è§„åˆ™ã€‚ æˆ‘ä»¬ä½¿ç”¨Puppetï¼ŒGitlabå’ŒåŸºç¡€æ¶æ„åŸç†ä½œä¸ºä»£ç ï¼Œå› æ­¤ï¼š </p><br><ul><li> é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹è™šæ‹Ÿæœºä¸Šçš„ä»»ä½•æ–‡ä»¶ï¼Œæ— éœ€é€šè¿‡SSHè¿›è¡Œä»»ä½•æ‰‹åŠ¨æ›´æ”¹ã€‚ åœ¨ä¸‰å¹´çš„å·¥ä½œä¸­ï¼Œæˆ‘å·²ç»å¤šæ¬¡æ¥å—è¿™æ ·çš„å·¥ä½œï¼Œè¿™æ˜¯ä¸€å‘¨å‰çš„æœ€åä¸€æ¬¡ï¼Œä½†æˆ‘è®¤ä¸ºè¿™ä¸æ˜¯æœ€åä¸€æ¬¡ã€‚ å¥½å§ï¼Œå®é™…ä¸Š-ä¿®å¤é…ç½®ä¸­çš„ä¸€è¡Œï¼Œé‡æ–°å¯åŠ¨æœåŠ¡ï¼Œçœ‹çœ‹é—®é¢˜æ˜¯å¦å·²è§£å†³-10ç§’ã€‚ åœ¨Gitlabä¸­åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œæ¨é€æ›´æ”¹ï¼Œç­‰å¾…r10kåœ¨Puppetmasterä¸Šè¿è¡Œï¼Œè¿è¡ŒPuppet --environment = mybranchï¼Œå†ç­‰å¾…å‡ åˆ†é’Ÿï¼Œç›´åˆ°æ‰€æœ‰å·¥ä½œéƒ½å®Œæˆ-æœ€å°‘5åˆ†é’Ÿã€‚ </li><li> ä»»ä½•æ›´æ”¹éƒ½å¯ä»¥é€šè¿‡åœ¨Gitlabä¸­åˆ›å»ºåˆå¹¶è¯·æ±‚æ¥è¿›è¡Œï¼Œæ‚¨éœ€è¦è‡³å°‘è·å¾—ä¸€åå›¢é˜Ÿæˆå‘˜çš„æ‰¹å‡†ã€‚ å›¢é˜Ÿé¢†å¯¼çš„é‡å¤§å˜æ›´éœ€è¦ä¸¤åˆ°ä¸‰ä¸ªæ‰¹å‡†ã€‚ </li><li> æ‰€æœ‰æ›´æ”¹éƒ½æ˜¯ä»¥ä¸€ç§æˆ–å¦ä¸€ç§æ–¹å¼è¿›è¡Œæ–‡æœ¬æ›´æ”¹ï¼ˆå› ä¸ºPuppetæ¸…å•ï¼ŒHieraè„šæœ¬å’Œæ•°æ®æ˜¯æ–‡æœ¬ï¼‰ï¼Œå› æ­¤ä¸é¼“åŠ±ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä¸”éœ€è¦å……åˆ†çš„ç†ç”±æ¥æ‰¹å‡†å®ƒä»¬ã€‚ </li></ul><br><p> å› æ­¤ï¼Œæˆ‘æŸ¥çœ‹çš„é€‰é¡¹æ˜¯ï¼š </p><br><ul><li>  Munin-å¦‚æœåŸºç¡€æ¶æ„ä¸­æœ‰10å°ä»¥ä¸Šçš„æœåŠ¡å™¨ï¼Œé‚£ä¹ˆç®¡ç†å°±ä¼šé™·å…¥å›°å¢ƒï¼ˆä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡å¼€å§‹</a> ã€‚æˆ‘å¹¶ä¸æƒ³æ£€æŸ¥å®ƒï¼Œæ‰€ä»¥æˆ‘ä¿¡æœäº†ï¼‰ã€‚ </li><li>  Zabbix-é•¿æœŸä»¥æ¥ä¸€ç›´åœ¨ä¿„ç½—æ–¯ç•™æ„ï¼Œä½†åæ¥å¯¹äºæˆ‘çš„å·¥ä½œæ¥è¯´æ˜¯å¤šä½™çš„ã€‚ åœ¨è¿™é‡Œ-ç”±äºä½¿ç”¨Puppetä½œä¸ºé…ç½®ç®¡ç†å™¨ä»¥åŠä½¿ç”¨Gitlabä½œä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè€Œä¸å¾—ä¸åˆ é™¤ã€‚ æ®æˆ‘äº†è§£ï¼Œå½“æ—¶Zabbixå°†æ•´ä¸ªé…ç½®å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå› æ­¤ç›®å‰å°šä¸æ¸…æ¥šå¦‚ä½•åœ¨å½“å‰æ¡ä»¶ä¸‹ç®¡ç†é…ç½®ä»¥åŠå¦‚ä½•è·Ÿè¸ªæ›´æ”¹ã€‚ </li><li> ä»éƒ¨é—¨çš„æƒ…ç»ªæ¥çœ‹ï¼Œæ™®ç½—ç±³ä¿®æ–¯æ˜¯æˆ‘ä»¬æœ€ç»ˆè¦è¾¾åˆ°çš„ç›®æ ‡ï¼Œä½†æ˜¯é‚£æ—¶æˆ‘æ— æ³•æŒæ¡å®ƒï¼Œä¹Ÿæ— æ³•è¯æ˜ä¸€ä¸ªçœŸæ­£å¯è¡Œçš„æ ·æœ¬ï¼ˆæ¦‚å¿µè¯æ˜ï¼‰ï¼Œå› æ­¤æˆ‘ä¸å¾—ä¸æ‹’ç»ã€‚ </li><li> è¿˜æœ‰å…¶ä»–å‡ ç§é€‰æ‹©ï¼Œæˆ–è€…éœ€è¦å®Œå…¨é‡æ–°è®¾è®¡ç³»ç»Ÿï¼Œæˆ–è€…å¤„äºèµ·æ­¥é˜¶æ®µ/è¢«æ”¾å¼ƒï¼Œå¹¶ä¸”å‡ºäºç›¸åŒçš„åŸå› è€Œè¢«æ‹’ç»ã€‚ </li></ul><br><p> æœ€åï¼Œå‡ºäºä»¥ä¸‹ä¸‰ä¸ªåŸå› ï¼Œæˆ‘é€‰æ‹©äº†Icinga2ï¼š </p><br><p>  1-ä¸Nrpeå…¼å®¹ï¼ˆå®¢æˆ·ç«¯æœåŠ¡è¿è¡Œå¯¹æ¥è‡ªNagiosçš„å‘½ä»¤çš„æ£€æŸ¥ï¼‰ã€‚ è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸ºå½“æ—¶æˆ‘ä»¬æœ‰135å°è™šæ‹Ÿæœºï¼ˆç°åœ¨åˆ°2019å¹´æœ‰165å°ï¼‰å¸¦æœ‰ä¸€å †è‡ªå†™æœåŠ¡/æ£€æŸ¥çš„è™šæ‹Ÿæœºï¼Œè€Œé‡åšæ‰€æœ‰è¿™äº›å°†æ˜¯ä¸€ä¸ªå¯æ€•çš„ç—”ç–®ã€‚ <br>  2-æ‰€æœ‰é…ç½®æ–‡ä»¶å‡ä¸ºæ–‡æœ¬ï¼Œå¯è½»æ¾ç¼–è¾‘æ­¤å†…å®¹ï¼Œåˆ›å»ºåˆå¹¶è¯·æ±‚ï¼Œå¹¶èƒ½å¤ŸæŸ¥çœ‹å·²æ·»åŠ æˆ–åˆ é™¤çš„å†…å®¹ã€‚ <br>  3æ˜¯ä¸€ä¸ªæ´»è·ƒä¸”ä¸æ–­å‘å±•çš„OpenSourceé¡¹ç›®ã€‚ æˆ‘ä»¬éå¸¸å–œæ¬¢OpenSourceï¼Œå¹¶é€šè¿‡åˆ›å»ºPull Requestså’ŒIssuesè§£å†³é—®é¢˜ä¸ºOpenSourceåšå‡ºäº†åˆ‡å®å¯è¡Œçš„è´¡çŒ®ã€‚ </p><br><p> è®©æˆ‘ä»¬èµ°å§ï¼ŒIcinga2ã€‚ </p><br><p> æˆ‘é¦–å…ˆè¦é¢å¯¹çš„æ˜¯åŒäº‹ä»¬çš„æƒ°æ€§ã€‚ æ¯ä¸ªäººéƒ½ä¹ æƒ¯äºNagios / Najiosï¼ˆå°½ç®¡å³ä½¿åœ¨è¿™é‡Œä»–ä»¬ä¹Ÿä¸èƒ½å¦¥åå¦‚ä½•å‘éŸ³ï¼‰å’ŒCheckMKç•Œé¢ã€‚  icingaç•Œé¢çœ‹ä¸Šå»å®Œå…¨ä¸åŒï¼ˆè¿™æ˜¯å‡å·ï¼‰ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨æ ¹æ®ä»»ä½•å‚æ•°çš„å­—é¢æ„æ€çµæ´»åœ°é…ç½®æ‰€éœ€çš„å†…å®¹ï¼ˆè¿™æ˜¯ä¸€ä¸ªåŠ å·ï¼Œä½†æˆ‘ä¸ºæ­¤ç‰¹åˆ«åŠªåŠ›ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç­›é€‰å™¨</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/kx/bf/0e/kxbf0eqj-gh7bfkpgtzgjjgvhwm.jpeg"></div></div><br><p> ä¼°è®¡æ»šåŠ¨æ¡çš„å¤§å°ä¸æ»šåŠ¨å­—æ®µçš„å¤§å°ä¹‹æ¯”ã€‚ </p><br><p> å…¶æ¬¡ï¼Œæ¯ä¸ªäººéƒ½ä¹ æƒ¯äºåœ¨ä¸€å°æ˜¾ç¤ºå™¨ä¸Šçœ‹åˆ°æ•´ä¸ªåŸºç¡€æ¶æ„ï¼Œå› ä¸ºCheckMkå…è®¸æ‚¨ä½¿ç”¨å¤šå°Nagiosä¸»æœºï¼Œä½†æ˜¯Icingaä¸çŸ¥é“è¯¥æ€ä¹ˆåšï¼ˆäº‹å®ä¸Šï¼Œå®ƒç¡®å®å¯ä»¥åšåˆ°ï¼Œä½†ä¸‹é¢æœ‰æ›´å¤šä»‹ç»ï¼‰ã€‚ å¦ä¸€ç§é€‰æ‹©æ˜¯å«åšThrukçš„ä¸œè¥¿ï¼Œä½†æ˜¯å®ƒçš„è®¾è®¡å¼•èµ·äº†æ‰€æœ‰å›¢é˜Ÿæˆå‘˜çš„å‘•åï¼Œé™¤äº†ä¸€ä¸ªäººï¼ˆæå‡ºè¿™ä¸ªé—®é¢˜çš„äººï¼ˆä¸æ˜¯æˆ‘ï¼‰ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">Thruk Firebox-å›¢é˜Ÿä¸€è‡´å†³å®š</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tv/1c/_l/tv1c_lkx-h9rbwgpdy63jdohnve.png"></div></div><br><p> ç»è¿‡å‡ å¤©çš„å¤´è„‘é£æš´ï¼Œæˆ‘æå‡ºäº†é›†ç¾¤ç›‘è§†çš„æƒ³æ³•ï¼Œå³åœ¨ç”Ÿäº§åŒºåŸŸä¸­æœ‰ä¸€ä¸ªä¸»æ§ä¸»æœºï¼Œè€Œæœ‰ä¸¤ä¸ªä¸‹å±-ä¸€ä¸ªåœ¨å¼€å‘/æµ‹è¯•ä¸­ï¼Œä¸€ä¸ªå¤–éƒ¨ä¸»æœºä½äºå¦ä¸€ä¸ªæä¾›å•†å¤„ï¼Œä»¥ä¾¿ä»å®¢æˆ·æˆ–å¤–éƒ¨äººå‘˜çš„è§’åº¦ç›‘è§†æˆ‘ä»¬çš„æœåŠ¡ã€‚è§‚å¯Ÿè€…ã€‚ è¿™ç§é…ç½®ä½¿æˆ‘èƒ½å¤Ÿåœ¨ä¸€ä¸ªåŸºäºWebçš„ç•Œé¢ä¸­æŸ¥çœ‹æ‰€æœ‰é—®é¢˜ï¼Œå¹¶ä¸”å¯¹è‡ªå·±ä¹Ÿæœ‰æ•ˆï¼Œä½†æ˜¯Puppet ... Puppetçš„é—®é¢˜åœ¨äºï¼Œä¸»ä¸»æœºç°åœ¨å¿…é¡»äº†è§£ç³»ç»Ÿä¸­çš„æ‰€æœ‰ä¸»æœºå’ŒæœåŠ¡/æ£€æŸ¥ï¼Œå¹¶ä¸”å¿…é¡»åœ¨åŒºåŸŸä¹‹é—´åˆ†é…å®ƒä»¬ï¼ˆdev-testï¼Œstaging-prodï¼Œextï¼‰ï¼Œä½†æ˜¯é€šè¿‡Icinga APIå‘é€æ›´æ”¹éœ€è¦èŠ±è´¹å‡ ç§’é’Ÿï¼Œä½†æ˜¯ä¸ºæ‰€æœ‰ä¸»æœºç¼–è¯‘æ‰€æœ‰æœåŠ¡çš„Puppetç›®å½•åˆ™éœ€è¦èŠ±è´¹å‡ åˆ†é’Ÿã€‚ å°½ç®¡æˆ‘å·²ç»å¤šæ¬¡è§£é‡Šäº†ä¸€åˆ‡çš„è¿ä½œæ–¹å¼ä»¥åŠä¸ºä½•èŠ±è´¹å¦‚æ­¤é•¿æ—¶é—´çš„åŸå› ï¼Œä½†è¿™ä»ç„¶å½’å’äºæˆ‘ã€‚ </p><br><p> ç¬¬ä¸‰-ä¸€å †Snowflakesï¼ˆé›ªèŠ±ï¼‰-ç”±äºå®ƒä»¬å…·æœ‰æŸäº›ç‰¹æ®Šä¹‹å¤„è€Œè¢«ä»é€šç”¨ç³»ç»Ÿä¸­å‰”é™¤çš„ä¸œè¥¿ï¼Œå› æ­¤é€šç”¨è§„åˆ™ä¸é€‚ç”¨äºå®ƒä»¬ã€‚ å®ƒæ˜¯é€šè¿‡æ­£é¢æ”»å‡»æ¥è§£å†³çš„-å¦‚æœæœ‰è­¦æŠ¥ï¼Œä½†å®é™…ä¸Šä¸€åˆ‡æ­£å¸¸ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦æ›´æ·±å…¥åœ°æŒ–æ˜å¹¶ç†è§£ä¸ºä»€ä¹ˆå®ƒä¼šè­¦å‘Šæˆ‘ï¼Œå°½ç®¡åº”è¯¥è¿™æ ·åšã€‚ åä¹‹äº¦ç„¶-ä¸ºä»€ä¹ˆNagiosææ…Œè€ŒIcingaåˆ™ä¸ç„¶ã€‚ </p><br><p> ç¬¬å››-Nagiosåœ¨è¿™é‡Œä¸ºæˆ‘å·¥ä½œäº†ä¸‰å¹´ï¼Œæœ€åˆå¯¹ä»–çš„ä¿¡ä»»æ¯”å¯¹æˆ‘æ–°æ½®çš„è¡Œå®¶ç³»ç»Ÿçš„ä¿¡ä»»æ›´å¤§ï¼Œå› æ­¤æ¯æ¬¡Icingaå¼•èµ·ææ…Œæ—¶ï¼Œç›´åˆ°Nagioså¯¹åŒä¸€é—®é¢˜æ„Ÿåˆ°å…´å¥‹ä¹‹å‰ï¼Œæ²¡äººåšä»»ä½•äº‹æƒ…ã€‚ ä½†æ˜¯ï¼Œå¾ˆå°‘æœ‰Icingaæ—©äºNagioså‘å‡ºçœŸæ­£çš„è­¦æŠ¥ï¼Œæˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œæˆ‘å°†åœ¨â€œç»“è®ºâ€éƒ¨åˆ†ä¸­è¿›è¡Œè®¨è®ºã€‚ </p><br><p> ç»“æœï¼Œè°ƒè¯•è¢«æ¨è¿Ÿäº†è¶…è¿‡5ä¸ªæœˆï¼ˆå®é™…ä¸Šè®¡åˆ’äº2018å¹´6æœˆ28æ—¥-2018å¹´12æœˆ3æ—¥ï¼‰ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºâ€œå¥‡å¶æ ¡éªŒâ€-å½“Nagiosä¸­æœ‰å‡ é¡¹æœåŠ¡æ²¡æœ‰äººè°ˆè®ºæ—¶ï¼Œå®ƒä¼šåºŸå¼ƒè¿‡å»å‡ å¹´æˆ‘ä»€ä¹ˆéƒ½æ²¡å¬åˆ°ï¼Œä½†æ˜¯ç°åœ¨ä»–ä»¬æ— ç¼˜æ— æ•…å‘å‡ºäº†æš´å‡»ï¼Œæˆ‘ä¸å¾—ä¸è§£é‡Šä¸ºä»€ä¹ˆä»–ä»¬ä¸åœ¨æˆ‘çš„é¢æ¿ä¸Šï¼Œå¹¶ä¸”ä¸å¾—ä¸å°†å®ƒä»¬æ·»åŠ åˆ°Icingaä¸­ä»¥â€œå®Œæˆå¥‡å¶æ£€æŸ¥â€ï¼ˆæ‰€æœ‰æœåŠ¡/æ£€æŸ¥åœ¨Nagiosä¸­å¯¹åº”äºIcingaä¸­çš„æœåŠ¡/æ”¯ç¥¨ï¼‰ </p><br><p> å®ç°æ–¹å¼ï¼š <br> é¦–å…ˆæ˜¯ä»£ç ä¸æ•°æ®ä¹‹æˆ˜ï¼Œä¾‹å¦‚æœ¨å¶é£æ ¼ã€‚ æ‰€æœ‰æ•°æ®ï¼ˆé€šå¸¸æ˜¯æ‰€æœ‰æ•°æ®ï¼‰éƒ½åº”å­˜æ”¾åœ¨å¸Œæ‹‰ä¸­ï¼Œè€Œåˆ«æ— å…¶ä»–ã€‚ æ‰€æœ‰ä»£ç éƒ½ä½äº.ppæ–‡ä»¶ä¸­ã€‚ å˜é‡ï¼ŒæŠ½è±¡ï¼Œå‡½æ•°-ä¸€åˆ‡ä»¥ppå¼€å¤´ã€‚ <br> ç»“æœï¼Œæˆ‘ä»¬æœ‰ä¸€å †è™šæ‹Ÿæœºï¼ˆåœ¨æ’°å†™æœ¬æ–‡æ—¶ä¸º165ä¸ªï¼‰å’Œ68ä¸ªWebåº”ç”¨ç¨‹åºï¼Œéœ€è¦å¯¹å…¶SSLè¯ä¹¦çš„è¿è¡ŒçŠ¶å†µå’Œæœ‰æ•ˆæ€§è¿›è¡Œç›‘è§†ã€‚ ä½†æ˜¯ç”±äºå†å²ä¸Šçš„ç—”ç–®ï¼Œç”¨äºç›‘è§†åº”ç”¨ç¨‹åºçš„ä¿¡æ¯æ¥è‡ªå•ç‹¬çš„gitlabå­˜å‚¨åº“ï¼Œå¹¶ä¸”è‡ªPuppet 3èµ·æ•°æ®æ ¼å¼å°±æ²¡æœ‰æ”¹å˜ï¼Œè¿™å¸¦æ¥äº†æ›´å¤šçš„é…ç½®å›°éš¾ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">åº”ç”¨ç¨‹åºçš„ä¼ªä»£ç ï¼Œè¯·å°å¿ƒ</b> <div class="spoiler_text"><pre><code class="plaintext hljs">define profiles::services::monitoring::docker_apps( Hash $app_list, Hash $apps_accessible_from, Hash $apps_access_list, Hash $webhost_defaults, Hash $webcheck_defaults, Hash $service_overrides, Hash $targets, Hash $app_checks, ) { #### APPS #### $zone = $name $app_list.each | String $app_name, Hash $app_data | { $notify_group = { 'notify_group' =&gt; ($webcheck_defaults[$zone]['notify_group'] + pick($app_data['notify_group'], {} )) } # adds notifications for default group (systems) + any group defined in int/pm_docker_apps.eyaml $data = merge($webhost_defaults, $apps_accessible_from, $app_data) $site_domain = $app_data['site_domain'] $regexp = pick($app_data['check_regex'], 'html') # Pick a regex to check $check_url = $app_data['check_url'] ? { undef =&gt; { 'http_uri' =&gt; '/' }, default =&gt; { 'http_uri' =&gt; $app_data['check_url'] } } $check_regex = $regexp ?{ 'absent' =&gt; {}, default =&gt; {'http_expect_body_regex' =&gt; $regexp} } $site_domain.each | String $vhost, Hash $vdata | { # Split an app by domains if there are two or more $vhost_name = {'http_vhost' =&gt; $vhost} $vars = $data['vars'] + $vhost_name + $check_regex + $check_url $web_ipaddress = is_array($vdata['web_ipaddress']) ? { # Make IP-address an array if it's not, because askizzy has 2 ips and it's an array true =&gt; $vdata['web_ipaddress'], false =&gt; [$vdata['web_ipaddress']], } $access_from_zones = [$zone] + $apps_access_list[$data['accessible_from']] # Merge default zone (where the app is defined) and extra zones if they exist $web_ipaddress.each | String $ip_address | { # For each IP (if we have multiple) $suffix = length($web_ipaddress) ? { # If we have more than one - add IP as a suffix to this hostname to avoid duplicating resources 1 =&gt; '', default =&gt; "_${ip_address}" } $octets = split($ip_address, '\.') $ip_tag = "${octets[2]}.${octets[3]}" # Using last octet only causes a collision between nginx-vip 203.15.70.94 and ext. ip 49.255.194.94 $access_from_zones.each | $zone_prefix |{ $zone_target = $targets[$zone_prefix] $nginx_vip_name = "${zone_prefix}_nginx-vip-${ip_tag}" # If it's a host for ext - prefix becomes 'ext_' (ext_nginx-vip...) $nginx_host_vip = { $nginx_vip_name =&gt; { ensure =&gt; present, target =&gt; $zone_target, address =&gt; $ip_address, check_command =&gt; 'hostalive', groups =&gt; ['nginx_vip',], } } $ssl_vars = $app_checks['ssl'] $regex_vars = $app_checks['http'] + $vars + $webcheck_defaults[$zone] + $notify_group if !defined( Profiles::Services::Monitoring::Host[$nginx_vip_name] ) { ensure_resources('profiles::services::monitoring::host', $nginx_host_vip) } if !defined( Icinga2::Object::Service["${nginx_vip_name}_ssl"] ) { icinga2::object::service {"${nginx_vip_name}_ssl": ensure =&gt; $data['ensure'], assign =&gt; ["host.name == $nginx_vip_name",], groups =&gt; ['webchecks',], check_command =&gt; 'ssl', check_interval =&gt; $service_overrides['ssl']['check_interval'], target =&gt; $targets['services'], apply =&gt; true, vars =&gt; $ssl_vars } } if $regexp != 'absent'{ if !defined(Icinga2::Object::Service["${vhost}${$suffix} regex"]){ icinga2::object::service {"${vhost}${$suffix} regex": ensure =&gt; $data['ensure'], assign =&gt; ["match(*_nginx-vip-${ip_tag}, host.name)",], groups =&gt; ['webchecks',], check_command =&gt; 'http', check_interval =&gt; $service_overrides['regex']['check_interval'], target =&gt; $targets['services'], enable_flapping =&gt; true, apply =&gt; true, vars =&gt; $regex_vars } } } } } } } }</code> </pre> </div></div><br><p> ä¸»æœºå’ŒæœåŠ¡é…ç½®ä»£ç çœ‹èµ·æ¥ä¹Ÿå¾ˆç³Ÿç³•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">ç›‘æ§/ config.pp</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">class profiles::services::monitoring::config( Array $default_config, Array $hostgroups, Hash $hosts = {}, Hash $host_defaults, Hash $services, Hash $service_defaults, Hash $service_overrides, Hash $webcheck_defaults, Hash $servicegroups, String $servicegroup_target, Hash $user_defaults, Hash $users, Hash $oncall, Hash $usergroup_defaults, Hash $usergroups, Hash $notifications, Hash $notification_defaults, Hash $notification_commands, Hash $timeperiods, Hash $webhost_defaults, Hash $apps_access_list, Hash $check_commands, Hash $hosts_api = {}, Hash $targets = {}, Hash $host_api_defaults = {}, ) { # Profiles::Services::Monitoring::Hostgroup &lt;&lt;| |&gt;&gt; # will be enabled when we move to icinga completely #### APPS #### case $location { 'int', 'ext': { $apps_by_zone = {} } 'pm': { $int_apps = hiera('int_docker_apps') $int_app_defaults = hiera('int_docker_app_common') $st_apps = hiera('staging_docker_apps') $srs_apps = hiera('pm_docker_apps_srs') $pm_apps = hiera('pm_docker_apps') + $st_apps + $srs_apps $pm_app_defaults = hiera('pm_docker_app_common') $apps_by_zone = { 'int' =&gt; $int_apps, 'pm' =&gt; $pm_apps, } $app_access_by_zone = { 'int' =&gt; {'accessible_from' =&gt; $int_app_defaults['accessible_from']}, 'pm' =&gt; {'accessible_from' =&gt; $pm_app_defaults['accessible_from']}, } } default: { fail('Please ensure the node has $location fact set (int, pm, ext)') } } file { '/etc/icinga2/conf.d/': ensure =&gt; directory, recurse =&gt; true, purge =&gt; true, owner =&gt; 'icinga', group =&gt; 'icinga', mode =&gt; '0750', notify =&gt; Service['icinga2'], } $default_config.each | String $file_name |{ file {"/etc/icinga2/conf.d/${file_name}": ensure =&gt; present, source =&gt; "puppet:///modules/profiles/services/monitoring/default_config/${file_name}", owner =&gt; 'icinga', group =&gt; 'icinga', mode =&gt; '0640', } } $app_checks = { 'ssl' =&gt; $services['webchecks']['checks']['ssl']['vars'], 'http' =&gt; $services['webchecks']['checks']['http_regexp']['vars'] } $apps_by_zone.each | String $zone, Hash $app_list | { profiles::services::monitoring::docker_apps{$zone: app_list =&gt; $app_list, apps_accessible_from =&gt; $app_access_by_zone[$zone], apps_access_list =&gt; $apps_access_list, webhost_defaults =&gt; $webhost_defaults, webcheck_defaults =&gt; $webcheck_defaults, service_overrides =&gt; $service_overrides, targets =&gt; $targets, app_checks =&gt; $app_checks, } } #### HOSTS #### # Profiles::Services::Monitoring::Host &lt;&lt;| |&gt;&gt; # This is for spaceship invasion when it's ready. $hosts_has_large_disks = query_nodes('mountpoints.*.size_bytes &gt;= 1099511627776') $hosts.each | String $hostgroup, Hash $list_of_hosts_with_settings | { # Splitting site lists by hostgroups - docker_host/gluster_host/etc $list_of_hosts_in_group = $list_of_hosts_with_settings['hosts'] $hostgroup_settings = $list_of_hosts_with_settings['settings'] $merged_hostgroup_settings = deep_merge($host_defaults, $list_of_hosts_with_settings['settings']) $list_of_hosts_in_group.each | String $host_name, Hash $host_settings |{ # Splitting grouplists by hosts # Is this host in the array $hosts_has_large_disks ? If so set host.vars.has_large_disks if ( $hosts_has_large_disks.reduce(false) | $found, $value| { ( $value =~ "^${host_name}" ) or $found } ) { $vars_has_large_disks = { 'has_large_disks' =&gt; true } } else { $vars_has_large_disks = {} } $host_data = deep_merge($merged_hostgroup_settings, $host_settings) $hostgroup_settings_vars = pick($hostgroup_settings['vars'], {}) $host_settings_vars = pick($host_settings['vars'], {}) $host_notify_group = delete_undef_values($host_defaults['vars']['notify_group'] + $hostgroup_settings_vars['notify_group'] + $host_settings_vars['notify_group']) $host_data_vars = delete_undef_values(deep_merge($host_data['vars'] , {'notify_group' =&gt; $host_notify_group}, $vars_has_large_disks)) # Merging vars separately $hostgroups = delete_undef_values([$hostgroup] + $host_data['groups']) profiles::services::monitoring::host{$host_name: ensure =&gt; $host_data['ensure'], display_name =&gt; $host_data['display_name'], address =&gt; $host_data['address'], groups =&gt; $hostgroups, target =&gt; $host_data['target'], check_command =&gt; $host_data['check_command'], check_interval =&gt; $host_data['check_interval'], max_check_attempts =&gt; $host_data['max_check_attempts'], vars =&gt; $host_data_vars, template =&gt; $host_data['template'], } } } if !empty($hosts_api){ # All hosts managed by API $hosts_api.each | String $zone, Hash $hosts_api_zone | { # Split api hosts by zones $hosts_api_zone.each | String $hostgroup, Hash $list_of_hosts_with_settings | { # Splitting site lists by hostgroups - docker_host/gluster_host/etc $list_of_hosts_in_group = $list_of_hosts_with_settings['hosts'] $hostgroup_settings = $list_of_hosts_with_settings['settings'] $merged_hostgroup_settings = deep_merge($host_api_defaults, $list_of_hosts_with_settings['settings']) $list_of_hosts_in_group.each | String $host_name, Hash $host_settings |{ # Splitting grouplists by hosts # Is this host in the array $hosts_has_large_disks ? If so set host.vars.has_large_disks if ( $hosts_has_large_disks.reduce(false) | $found, $value| { ( $value =~ "^${host_name}" ) or $found } ) { $vars_has_large_disks = { 'has_large_disks' =&gt; true } } else { $vars_has_large_disks = {} } $host_data = deep_merge($merged_hostgroup_settings, $host_settings) $hostgroup_settings_vars = pick($hostgroup_settings['vars'], {}) $host_settings_vars = pick($host_settings['vars'], {}) $host_api_notify_group = delete_undef_values($host_defaults['vars']['notify_group'] + $hostgroup_settings_vars['notify_group'] + $host_settings_vars['notify_group']) $host_data_vars = delete_undef_values(deep_merge($host_data['vars'] , {'notify_group' =&gt; $host_api_notify_group}, $vars_has_large_disks)) $hostgroups = delete_undef_values([$hostgroup] + $host_data['groups']) if defined(Profiles::Services::Monitoring::Host[$host_name]){ $hostname = "${host_name}_from_${zone}" } else { $hostname = $host_name } profiles::services::monitoring::host{$hostname: ensure =&gt; $host_data['ensure'], display_name =&gt; $host_data['display_name'], address =&gt; $host_data['address'], groups =&gt; $hostgroups, target =&gt; "${host_data['target_base']}/${zone}/hosts.conf", check_command =&gt; $host_data['check_command'], check_interval =&gt; $host_data['check_interval'], max_check_attempts =&gt; $host_data['max_check_attempts'], vars =&gt; $host_data_vars, template =&gt; $host_data['template'], } } } } } #### END OF HOSTS #### #### SERVICES #### $services.each | String $service_group, Hash $s_list |{ # Service_group and list of services in that group $service_list = $s_list['checks'] # List of actual checks, separately from SG settings $service_list.each | String $service_name, Hash $data |{ $merged_defaults = merge($service_defaults, $s_list['settings']) # global service defaults + service group defaults $merged_data = merge($merged_defaults, $data) $settings_vars = pick($s_list['settings']['vars'], {}) $this_service_vars = pick($data['vars'], {}) $all_service_vars = delete_undef_values($service_defaults['vars'] + $settings_vars + $this_service_vars) # If we override default check_timeout, but not nrpe_timeout, make nrpe_timeout the same as check_timeout if ( $merged_data['check_timeout'] and ! $this_service_vars['nrpe_timeout'] ) { # NB: Icinga will convert 1m to 60 automatically! $nrpe = { 'nrpe_timeout' =&gt; $merged_data['check_timeout'] } } else { $nrpe = {} } # By default we use nrpe and all commands are run via nrpe. So vars.nrpe_command = $service_name is a default value # If it's server-side Icinga command - we don't need 'nrpe_command' # but there is no harm to have that var and the code is shorter if $merged_data['check_command'] == 'nrpe'{ $check_command = $merged_data['vars']['nrpe_command'] ? { undef =&gt; { 'nrpe_command' =&gt; $service_name }, default =&gt; { 'nrpe_command' =&gt; $merged_data['vars']['nrpe_command'] } } }else{ $check_command = {} } # Assembling $vars from Global Default service settings, servicegroup settings, this particular check settings and let's not forget nrpe settings. if $all_service_vars['graphite_template'] { $graphite_template = {'check_command' =&gt; $all_service_vars['graphite_template']} }else{ $graphite_template = {'check_command' =&gt; $service_name} } $service_notify = [] + pick($settings_vars['notify_group'], []) + pick($this_service_vars['notify_group'], []) # pick is required everywhere, otherwise becomes "The value '' cannot be converted to Numeric" $service_notify_group = $service_notify ? { [] =&gt; $service_defaults['vars']['notify_group'], default =&gt; $service_notify } # Assing default group (systems) if no other groups are defined $vars = $all_service_vars + $nrpe + $check_command + $graphite_template + {'notify_group' =&gt; $service_notify_group} # This needs to be merged separately, because merging it as part of MERGED_DATA overwrites arrays instead of merging them, so we lose some "assign" and "ignore" values $assign = delete_undef_values($service_defaults['assign'] + $s_list['settings']['assign'] + $data['assign']) $ignore = delete_undef_values($service_defaults['ignore'] + $s_list['settings']['ignore'] + $data['ignore']) icinga2::object::service {$service_name: ensure =&gt; $merged_data['ensure'], apply =&gt; $merged_data['apply'], enable_flapping =&gt; $merged_data['enable_flapping'], assign =&gt; $assign, ignore =&gt; $ignore, groups =&gt; [$service_group], check_command =&gt; $merged_data['check_command'], check_interval =&gt; $merged_data['check_interval'], check_timeout =&gt; $merged_data['check_timeout'], check_period =&gt; $merged_data['check_period'], display_name =&gt; $merged_data['display_name'], event_command =&gt; $merged_data['event_command'], retry_interval =&gt; $merged_data['retry_interval'], max_check_attempts =&gt; $merged_data['max_check_attempts'], target =&gt; $merged_data['target'], vars =&gt; $vars, template =&gt; $merged_data['template'], } } } #### END OF SERVICES #### #### OTHER BORING STUFF #### $servicegroups.each | $servicegroup, $description |{ icinga2::object::servicegroup{ $servicegroup: target =&gt; $servicegroup_target, display_name =&gt; $description } } $hostgroups.each| String $hostgroup |{ profiles::services::monitoring::hostgroup { $hostgroup:} } $notifications.each | String $name, Hash $settings |{ $assign = pick($notification_defaults['assign'], []) + $settings['assign'] $ignore = pick($notification_defaults['ignore'], []) + $settings['ignore'] $merged_settings = $settings + $notification_defaults icinga2::object::notification{$name: target =&gt; $merged_settings['target'], apply =&gt; $merged_settings['apply'], apply_target =&gt; $merged_settings['apply_target'], command =&gt; $merged_settings['command'], interval =&gt; $merged_settings['interval'], states =&gt; $merged_settings['states'], types =&gt; $merged_settings['types'], assign =&gt; delete_undef_values($assign), ignore =&gt; delete_undef_values($ignore), user_groups =&gt; $merged_settings['user_groups'], period =&gt; $merged_settings['period'], vars =&gt; $merged_settings['vars'], } } # Merging notification settings for users with other settings $users_oncall = deep_merge($users, $oncall) # Magic. Do not touch. create_resources('icinga2::object::user', $users_oncall, $user_defaults) create_resources('icinga2::object::usergroup', $usergroups, $usergroup_defaults) create_resources('icinga2::object::timeperiod',$timeperiods) create_resources('icinga2::object::checkcommand', $check_commands) create_resources('icinga2::object::notificationcommand', $notification_commands) profiles::services::sudoers { 'icinga_runs_ping_l2': ensure =&gt; present, sudoersd_template =&gt; 'profiles/os/redhat/centos7/sudoers/icinga.erb', } }</code> </pre> </div></div><br><p> æˆ‘ä»åœ¨ç ”ç©¶è¿™ç§é¢æ¡ï¼Œå¹¶å°½å¯èƒ½è¿›è¡Œæ”¹è¿›ã€‚ ä½†æ˜¯ï¼Œæ­£æ˜¯æ­¤ä»£ç ä½¿åœ¨Hieraä¸­ä½¿ç”¨ç®€å•æ˜äº†çš„è¯­æ³•æˆä¸ºå¯èƒ½ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">èµ„æ–™</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">profiles::services::monitoring::config::services: perf_checks: settings: check_interval: '2m' assign: - 'host.vars.type == linux' checks: procs: {} load: {} memory: {} disk: check_interval: '5m' vars: notification_period: '24x7' disk_iops: vars: notifications: - 'silent' cpu: vars: notifications: - 'silent' dns_fqdn: check_interval: '15m' ignore: - 'xenserver in host.groups' vars: notifications: - 'silent' iftraffic_nrpe: vars: notifications: - 'silent' logging: settings: assign: - 'logserver in host.groups' checks: rsyslog: {} nginx_limit_req_other: {} nginx_limit_req_s2s: {} nginx_limit_req_s2x: {} nginx_limit_req_srs: {} logstash: {} logstash_api: vars: notifications: - 'silent'</code> </pre> </div></div><br><p> æ‰€æœ‰æ£€æŸ¥å‡åˆ†ä¸ºå‡ ç»„ï¼Œæ¯ç»„éƒ½æœ‰é»˜è®¤è®¾ç½®ï¼Œä¾‹å¦‚è¿è¡Œè¿™äº›æ£€æŸ¥çš„ä½ç½®å’Œé¢‘ç‡ï¼Œå‘é€ç»™è°çš„é€šçŸ¥ã€‚ </p><br><p> åœ¨æ¯ä¸ªæ£€æŸ¥ä¸­ï¼Œæ‚¨éƒ½å¯ä»¥è¦†ç›–ä»»ä½•é€‰é¡¹ï¼Œæœ€ç»ˆæ‰€æœ‰è¿™äº›éƒ½åŠ èµ·æ¥æˆä¸ºæ‰€æœ‰æ£€æŸ¥æ•´ä½“çš„é»˜è®¤è®¾ç½®ã€‚ å› æ­¤ï¼Œè¿™ç§é¢æ¡æ˜¯ç”¨config.ppç¼–å†™çš„-æ‰€æœ‰é»˜è®¤è®¾ç½®éƒ½ä¸ç»„çš„è®¾ç½®åˆå¹¶ï¼Œç„¶åä¸æ¯ä¸ªå•ç‹¬çš„æ£€æŸ¥åˆå¹¶ã€‚ </p><br><p> å¦å¤–ï¼Œä¸€é¡¹éå¸¸é‡è¦çš„æ›´æ”¹æ˜¯å¯ä»¥ä½¿ç”¨è®¾ç½®ä¸­çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œæ›´æ”¹ç«¯å£ï¼Œåœ°å€å’Œurlä»¥æ£€æŸ¥http_regexçš„åŠŸèƒ½ã€‚ </p><br><pre> <code class="plaintext hljs">http_regexp: assign: - 'host.vars.http_regex' - 'static_sites in host.groups' check_command: 'http' check_interval: '1m' retry_interval: '20s' max_check_attempts: 6 http_port: '{{ if(host.vars.http_port) { return host.vars.http_port } else { return 443 } }}' vars: notification_period: 'host.vars.notification_period' http_vhost: '{{ if(host.vars.http_vhost) { return host.vars.http_vhost } else { return host.name } }}' http_ssl: '{{ if(host.vars.http_ssl) { return false } else { return true } }}' http_expect_body_regex: 'host.vars.http_regex' http_uri: '{{ if(host.vars.http_uri) { return host.vars.http_uri } else { return "/" } }}' http_onredirect: 'follow' http_warn_time: 8 http_critical_time: 15 http_timeout: 30 http_sni: true</code> </pre> <br><p> è¿™æ„å‘³ç€-å¦‚æœä¸»æœº<em>å®šä¹‰ä¸­</em>å­˜åœ¨<em>http_port</em>å˜é‡-åˆ™ä½¿ç”¨å®ƒï¼Œå¦åˆ™ä½¿ç”¨443ã€‚ä¾‹å¦‚ï¼Œjabber Webç•Œé¢æŒ‚åœ¨9090ï¼ŒUnifiæŒ‚åœ¨7443ã€‚ <br>  <em>http_vhost</em>è¡¨ç¤ºå¿½ç•¥DNSå¹¶ä½¿ç”¨æ­¤åœ°å€ã€‚ <br> å¦‚æœåœ¨ä¸»æœºä¸­æŒ‡å®šäº†uriï¼Œè¯·ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™ä½¿ç”¨â€œ /â€ã€‚ </p><br><p>  http_sslä¼ å‡ºä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹-è¿™ç§æ„ŸæŸ“ä¸æƒ³æŒ‰éœ€æ–­å¼€è¿æ¥ã€‚ æˆ‘æ„šè ¢åœ°åœ¨è¿™è¡Œä¸Šç»Šäº†å¾ˆé•¿æ—¶é—´ï¼Œç›´åˆ°æˆ‘å‘ç°ä¸»æœºå®šä¹‰ä¸­çš„å˜é‡æ˜¯ï¼š </p><br><pre> <code class="plaintext hljs">http_ssl: false</code> </pre> <br><p> æ›¿ä»£è¡¨è¾¾ </p><br><pre> <code class="plaintext hljs">if(host.vars.http_ssl) { return false } else { return true }</code> </pre> <br><p> ä½œä¸º<strong>é”™è¯¯</strong> ï¼Œæœ€åç»“æœ </p><br><pre> <code class="plaintext hljs">if(false) { return false } else { return true }</code> </pre> <br><p> ä¹Ÿå°±æ˜¯è¯´ï¼Œsslæ£€æŸ¥å§‹ç»ˆå¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ é€šè¿‡æ›¿æ¢è¯­æ³•æ¥å†³å®šï¼š </p><br><pre> <code class="plaintext hljs">http_ssl: no</code> </pre> <br><p>  <strong>ç»“è®º</strong> ï¼š </p><br><p> ä¼˜ç‚¹ï¼š </p><br><ul><li> ç°åœ¨ï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸€ä¸ªç›‘æ§ç³»ç»Ÿï¼Œè€Œæ²¡æœ‰åƒè¿‡å»7-8ä¸ªæœˆé‚£æ ·çš„ä¸¤ä¸ªç›‘æ§ç³»ç»Ÿï¼Œæˆ–è€…åªæœ‰ä¸€ä¸ªè¿‡æ—¶ä¸”è„†å¼±çš„ç›‘æ§ç³»ç»Ÿã€‚ </li><li> ä¸»æœº/æœåŠ¡ï¼ˆæ£€æŸ¥ï¼‰çš„æ•°æ®ç»“æ„ç°åœ¨ï¼ˆåœ¨æˆ‘çœ‹æ¥ï¼‰æ›´å…·å¯è¯»æ€§å’Œå¯ç†è§£æ€§ã€‚ å¯¹äºå…¶ä»–äººæ¥è¯´ï¼Œè¿™å¹¶ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œæ‰€ä»¥æˆ‘ä¸å¾—ä¸åœ¨æœ¬åœ°Wikiä¸Šå‰ªå‡ é¡µæ¥è§£é‡Šå®ƒçš„å·¥ä½œåŸç†å’Œç¼–è¾‘ä½ç½®ã€‚ </li><li> å¯ä»¥ä½¿ç”¨å˜é‡å’Œå‡½æ•°çµæ´»é…ç½®æ£€æŸ¥ï¼Œä¾‹å¦‚æ£€æŸ¥http_regexpï¼Œå¯ä»¥åœ¨ä¸»æœºè®¾ç½®ä¸­è®¾ç½®æ‰€éœ€çš„æ¨¡å¼ï¼Œè¿”å›ä»£ç ï¼ŒURLå’Œç«¯å£ã€‚ </li><li> æœ‰å‡ ä¸ªä»ªè¡¨æ¿ï¼Œæ‚¨å¯ä»¥ä¸ºæ¯ä¸ªä»ªè¡¨æ¿å®šä¹‰è‡ªå·±çš„æ˜¾ç¤ºè­¦æŠ¥åˆ—è¡¨ï¼Œå¹¶é€šè¿‡Puppetå’Œåˆå¹¶è¯·æ±‚è¿›è¡Œç®¡ç†ã€‚ </li></ul><br><p> ç¼ºç‚¹ï¼š </p><br><ul><li> å›¢é˜Ÿæˆå‘˜çš„æƒ¯æ€§-Nagiosä¸€ç›´åœ¨å·¥ä½œï¼Œè€Œä¸”ä¸€ç›´åœ¨å·¥ä½œï¼Œè¿™ä½¿æ‚¨çš„Isingaä¸æ–­å‡ºé”™å¹¶æ”¾æ…¢é€Ÿåº¦ã€‚ æˆ‘æ€ä¹ˆçœ‹è¿™ä¸ªæ•…äº‹ï¼Ÿ è€Œä¸”ï¼Œè¯¥æ­»ï¼Œå®ƒä¸ä¼šæ›´æ–°...ï¼ˆçœŸæ­£çš„é—®é¢˜æ˜¯è­¦æŠ¥å†å²è®°å½•ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œåªèƒ½é€šè¿‡F5è¿›è¡Œæ›´æ–°ï¼‰ </li><li> ç³»ç»Ÿçš„æƒ°æ€§-å½“æˆ‘åœ¨Webç•Œé¢ä¸­å•å‡»â€œç«‹å³æ£€æŸ¥â€æ—¶-æ‰§è¡Œçš„ç»“æœå–å†³äºç«æ˜Ÿçš„å¤©æ°”ï¼Œå°¤å…¶æ˜¯éœ€è¦æ•°åç§’æ‰èƒ½å®Œæˆçš„å¤æ‚æœåŠ¡ã€‚ ç±»ä¼¼çš„ç»“æœæ˜¯æ­£å¸¸ç°è±¡ã€‚ <img src="https://habrastorage.org/webt/ue/73/wa/ue73wa4yt4bhedebd1n66kizsf8.jpeg"></li><li> æ€»çš„æ¥è¯´ï¼Œæ ¹æ®ä¸¤ä¸ªç³»ç»Ÿå¹¶è¡Œå·¥ä½œçš„åŠå¹´åº¦ç»Ÿè®¡ï¼ŒNagiosçš„å·¥ä½œé€Ÿåº¦æ€»æ˜¯æ¯”Icingaå¿«ï¼Œè¿™è®©æˆ‘å¾ˆçƒ¦ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œæœ‰ä¸€äº›è¢«è®¡æ—¶å™¨è¿·ä½çš„ä¸œè¥¿ï¼Œæ¯éš”5:30å°±ä¼šè¿›è¡Œä¸€æ¬¡5åˆ†é’Ÿçš„æ£€æŸ¥ï¼Œæˆ–è€…ç±»ä¼¼çš„äº‹æƒ…ã€‚ </li><li> å¦‚æœæ‚¨éšæ—¶é‡æ–°å¯åŠ¨æœåŠ¡ï¼ˆsystemctlé‡æ–°å¯åŠ¨icinga2ï¼‰-å½“æ—¶æ­£åœ¨è¿›è¡Œçš„æ‰€æœ‰æ£€æŸ¥éƒ½ä¼šåœ¨å±å¹•ä¸Šæ˜¾ç¤ºä¸¥é‡çš„&lt;ä¿¡å·ç»ˆæ­¢çŠ¶æ€&gt;è­¦æŠ¥ï¼Œä»ä¾§é¢çœ‹ï¼Œå¥½åƒä¸€åˆ‡éƒ½æ‰äº†ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·²ç¡®è®¤é”™è¯¯ï¼‰</a> ï¼‰ </li></ul><br><p> ä½†æ€»çš„æ¥è¯´-å®ƒæœ‰æ•ˆã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN444060/">https://habr.com/ru/post/zh-CN444060/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN444048/index.html">æ•°å­—å–è¯æŠ€å·§å’Œçªé—¨ï¼šå¦‚ä½•æ£€æµ‹å…¥ä¾µè€…é©±åŠ¨çš„ç»„ç­–ç•¥æ›´æ”¹</a></li>
<li><a href="../zh-CN444050/index.html">è®¨è®ºï¼šDNAå‚¨å­˜ä¼šå˜å¾—åºå¤§</a></li>
<li><a href="../zh-CN444052/index.html">æˆ‘ä»¬IntelliJ IDEAå¦‚ä½•å¯»æ‰¾lambdaè¡¨è¾¾å¼</a></li>
<li><a href="../zh-CN444056/index.html">å…‹é‡Œç±³äºšçš„äº’è”ç½‘æä¾›å•†å¤§å¹…æé«˜äº†æœåŠ¡ä»·æ ¼</a></li>
<li><a href="../zh-CN444058/index.html">å½“å­©å­ä»¬çŸ¥é“ä»–ä»¬çš„ä¸€ç”Ÿå·²ç»åœ¨çº¿æ—¶</a></li>
<li><a href="../zh-CN444062/index.html">ç‚¹äº®ï¼ æ‹‰èµ«å¡”ä¸­å¿ƒçš„å¤œé—´æ”¹é€ </a></li>
<li><a href="../zh-CN444064/index.html">å´­æ–°çš„æœªæ¥çš„æ–°æ€è·¯</a></li>
<li><a href="../zh-CN444068/index.html">è°åœ¨çœ‹ï¼Ÿ</a></li>
<li><a href="../zh-CN444070/index.html">ä»é›¶å¼€å§‹å¼€å‘å…­è„šæ¶ï¼ˆç¬¬4éƒ¨åˆ†ï¼‰-æ•°å­¦è½¨è¿¹å’Œåºåˆ—</a></li>
<li><a href="../zh-CN444072/index.html">Androidè´­ç‰©-Playå¸å•åº“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>