<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèæ üè¥Û†ÅßÛ†Å¢Û†Å≥Û†Å£Û†Å¥Û†Åø üçù Generaci√≥n de nivel de procedimiento üë®‚Äçüè´ üê† üßëüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se termin√≥ el trabajo de programaci√≥n, gr√°ficos y sonidos en algunos juegos nuevos , solo quedan niveles. Trabajo f√°cil y agradable, pero por alguna r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Generaci√≥n de nivel de procedimiento</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418685/"><p><img src="https://habrastorage.org/webt/2m/0y/gv/2m0ygvmlc1izxgmo4chumrammxi.png"></p><br><p>  Se termin√≥ el trabajo de programaci√≥n, gr√°ficos y sonidos en <em>algunos juegos nuevos</em> , solo quedan niveles.  Trabajo f√°cil y agradable, pero por alguna raz√≥n viene con gran dificultad.  Quiz√°s el efecto de la fatiga general. </p><br><p>  Pensando en c√≥mo simplificar su vida, se me ocurri√≥ la idea de la generaci√≥n procesal.  Por supuesto, tambi√©n tendr√° que escribirse, pero como se dijo en un trabajo bien conocido, "es mejor perder un d√≠a y luego volar en cinco minutos". </p><br><p>  <strong>Atencion</strong>  <strong>Debajo del corte hay mucho texto y gifs "gordos".</strong> </p><a name="habracut"></a><br><h2 id="vvodnaya">  Introductorio </h2><br><p>  Los niveles se seguir√°n puliendo manualmente, por lo que no hay requisitos especiales para la memoria, la velocidad o incluso la calidad de los niveles resultantes. </p><br><p>  Inicialmente, plane√© que el generador solo arroje habitaciones y puertas, y todo el refinamiento adicional (trama, escenario y enemigos) se llevar√° a cabo en modo manual.  Pero por ahora, creo que el generador puede hacer mucho m√°s.  Sin embargo, la sintonizaci√≥n manual seguir√° siendo v√°lida: es necesario que los jugadores sientan que se invierte al menos un poco de amor en los niveles. </p><br><p>  Mir√© mi base de conocimientos sobre desarrollo de juegos y escrib√≠ enlaces a art√≠culos sobre generaci√≥n de procedimientos en un documento separado.  La mayor√≠a, por supuesto, se trata de generar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">laberintos cl√°sicos</a> o de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">generar terreno</a> (por cierto, los resultados son muy impresionantes), lo que no es adecuado para un tirador 3D.  Pero algunos estaban cerca de lo que necesitaba (con un asterisco not√© los que me parec√≠an m√°s adecuados): </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://www.progamer.ru/dev/procedural-dungeon-generation.htm</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://habr.com/post/333692/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.gamasutra.com/blogs/GrahamDavis/20170130/290326/Procedural_Level_Generation_in_Unity_for_MERC_part_1_of_2.php</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://ijdykeman.github.io/ml/2017/10/12/wang-tile-procedural-generation.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://habr.com/post/332832/</a> (*) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://habr.com/post/184818/</a> (*) </li></ul><br><p>  Decid√≠ comenzar con los dos √∫ltimos: solo se est√°n implementando y dan buenos resultados. </p><br><h2 id="struktura-generatora">  Estructura del generador </h2><br><p>  De hecho, no llegu√© a esta estructura de inmediato, sino en el proceso de numerosas refactorizaciones y reescrituras, pero escribo sobre ello de inmediato para que quede claro lo que est√° sucediendo: </p><br><ol><li>  Generaci√≥n de geometr√≠a inicial (para elegir, ya sea "BSP" o dise√±o de sala). </li><li>  Limpieza de secciones de basura (secciones que no pueden existir en el juego). </li><li>  Construyendo conexiones. </li><li>  Borrado de subgr√°ficos de basura (grupos de secciones que est√°n interconectados, pero no hay conexi√≥n con las secciones restantes). </li><li>  Eliminaci√≥n de conexiones innecesarias (al construir un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√°rbol de expansi√≥n</a> , se proporciona un enlace al √°rbol de expansi√≥n <strong>m√≠nimo</strong> , porque hay una imagen all√≠, pero para el generador no hay necesidad del m√≠nimo). </li><li>  La aleatorizaci√≥n de las conexiones es la restauraci√≥n de algunas conexiones remotas (para un tipo de nivel m√°s "humano"), as√≠ como la transformaci√≥n de algunos otros en pasajes entre secciones (que fusiona varias secciones en una forma m√°s compleja). </li><li>  Generaci√≥n de sala secreta. </li><li>  Generaci√≥n de un "escenario" (d√≥nde estar√°n las secciones inicial y final, y qu√© camino tendr√° que pasar para pasar de la inicial a la final). </li><li>  Optimizaci√≥n de conexi√≥n. </li><li>  Creaci√≥n de puertas y ventanas. </li><li>  La elecci√≥n de la acci√≥n que se realizar√° en esta secci√≥n (presione el interruptor, levante la tecla o encuentre el muro secreto). </li></ol><br><p>  Todav√≠a hay alrededor de 12 puntos, pero a√∫n no se han completado (cuando termine, escribir√© una publicaci√≥n separada sobre ellos). </p><br><h2 id="generaciya-iznachalnoy-geometrii-bsp">  Generaci√≥n de geometr√≠a inicial: "BSP" </h2><br><p><img src="https://habrastorage.org/webt/zn/j4/_k/znj4_kemnzlvr4cfr45tqtzami8.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Esta traducci√≥n</a> fue tomada como la base.  No estoy seguro de cu√°nto sucede en este algoritmo cerca del BSP real, as√≠ que escribo "BSP" entre comillas. </p><br><p>  El algoritmo es bastante simple.  Inicialmente, cree un rect√°ngulo del tama√±o de todo el campo de juego: </p><br><p><img src="https://habrastorage.org/webt/fh/mx/x-/fhmxx-boo4euwsc4dl2g0gfc2nk.png"></p><br><p>  Luego lo dividimos aleatoriamente en dos partes, ya sea horizontal o verticalmente.  Donde tendr√° lugar la l√≠nea de separaci√≥n, tambi√©n elegimos al azar: </p><br><p><img src="https://habrastorage.org/webt/ml/lo/jm/mllojmhd2qxiga7ma_skqxqoera.png"></p><br><p>  Hacemos lo mismo recursivamente para los nuevos rect√°ngulos: </p><br><p><img src="https://habrastorage.org/webt/ew/sw/wf/ewswwfagu3jcskhcebem5sd-jo8.png"></p><br><p>  Y una y otra vez, hasta cierto punto: </p><br><p><img src="https://habrastorage.org/webt/fl/s-/hd/fls-hd2xm17ghbjbvnwpyhwzd_m.png"></p><br><p>  Luego, en cada rect√°ngulo seleccionamos una "habitaci√≥n", un rect√°ngulo del mismo tama√±o que el original o m√°s peque√±o (pero no menos de 3x3, m√°s sobre eso a continuaci√≥n). </p><br><p><img src="https://habrastorage.org/webt/r8/h1/_y/r8h1_yacj5bpuux_xmmxuwzdlo0.png"></p><br><p>  Luego las habitaciones est√°n conectadas por pasillos.  Pero no cada uno, sino un poco complicado, porque est√°n almacenados en una estructura tipo "BSP" (consulte el algoritmo original para obtener m√°s detalles). </p><br><p><img src="https://habrastorage.org/webt/5t/y6/3e/5ty63ewmz5eey4oaphja4uixjuu.png"><br>  <em>El corredor que conecta las secciones moradas y blancas.</em> </p><br><p>  En el algoritmo original, tanto las habitaciones como los corredores son del mismo color (es decir, son equivalentes), por lo que los corredores simplemente se dibujan en la parte superior de las habitaciones.  En mi caso, las habitaciones originales deben conservarse, de modo que los pasillos se dibujen como "detr√°s" de las habitaciones. </p><br><p>  Adem√°s, si la habitaci√≥n (turquesa en la figura) cruza el corredor, entonces debe dividirla en dos secciones diferentes (por lo tanto, el mismo corredor se puede dibujar en diferentes colores): </p><br><p><img src="https://habrastorage.org/webt/5n/wr/51/5nwr510wdeg8x9iw3cgy_eorsau.png"></p><br><p>  Y aqu√≠ est√° el resultado: </p><br><p><img src="https://habrastorage.org/webt/q4/hq/7r/q4hq7rocs2amqbt-guzspzcmbp4.png"></p><br><p>  Luego comienza la fase de marcar celdas de basura: </p><br><p><img src="https://habrastorage.org/webt/f0/ob/sc/f0obscdf1tabhec9mxv4m-wrj5s.png"></p><br><p>  Como ya escrib√≠, ning√∫n sector puede ser m√°s peque√±o que las celdas 3x3.  Esto se debe al hecho de que el sector debe estar rodeado de paredes (al menos 1 celda en cada lado) y debe tener al menos una celda de espacio libre: </p><br><p><img src="https://habrastorage.org/webt/iy/e8/ne/iye8ne6qltvzxtwrpgrtjgmgeae.png"></p><br><p>  Por lo tanto, todas esas celdas que no se ajustan a esta regla est√°n etiquetadas.  Pero t√≥malo y no podr√°s eliminarlos: desaparecen tantas conexiones y el nivel es muy escaso. </p><br><p>  En cambio, para cada celda etiquetada, se busca el sector al que se puede unir (observando la regla 3x3): </p><br><p><img src="https://habrastorage.org/webt/nc/6q/-y/nc6q-yh8jlkx_rhlilpamtzt27s.png"><br>  <em>Si la celda a√∫n no se puede atribuir a ning√∫n sector, se eliminar√° (pero no en este caso, todo est√° bien aqu√≠).</em> </p><br><p>  En la √∫ltima etapa, esta hermosa imagen se vectoriza, y los sectores dibujados se convierten en poliacajas, tales pol√≠gonos en los que cada borde es estrictamente vertical u estrictamente horizontal (probablemente haya un nombre m√°s cient√≠fico): </p><br><p><img src="https://habrastorage.org/webt/xx/8x/8v/xx8x8vpyawz-uricpycndaadgfy.png"></p><br><h2 id="generaciya-iznachalnoy-geometrii-planirovka-pomescheniy">  Generaci√≥n de geometr√≠a inicial: disposici√≥n de la sala. </h2><br><p><img src="https://habrastorage.org/webt/7w/jh/nb/7wjhnbk6xzc6zmdaqyiufpq7t5m.gif"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Otro art√≠culo</a> fue tomado como base.  Este algoritmo es algo m√°s complicado que el anterior, pero tampoco es ciencia espacial. </p><br><p>  Primero, el campo de juego se llena con un cierto valor de detenci√≥n, y luego se borra al azar un √°rea rectangular: </p><br><p><img src="https://habrastorage.org/webt/4n/24/py/4n24pyropjvmm0d8gsmzj9znte0.png"></p><br><p>  La etapa de limpieza de un rect√°ngulo aleatorio se lleva a cabo un n√∫mero m√°s (tambi√©n aleatorio) de veces, y como resultado, se obtienen los contornos externos del nivel: </p><br><p><img src="https://habrastorage.org/webt/np/4v/fi/np4vfi_iumlrznv8bsy8ba3babk.png"></p><br><p>  En el espacio libre, los puntos de crecimiento de la habitaci√≥n se dispersan al azar (el tama√±o m√≠nimo de la habitaci√≥n es 3x3): </p><br><p><img src="https://habrastorage.org/webt/2y/wm/3n/2ywm3n3lgak23tcn0dmyshbicne.png"></p><br><p>  Comienza la primera etapa de crecimiento de la habitaci√≥n: para cada habitaci√≥n se selecciona el lado m√°s grande, que a√∫n puede crecer, y crece en 1 celda (si hay varios lados con la misma longitud, uno aleatorio).  Las habitaciones se mueven a su vez para que no haya intersecciones. </p><br><p><img src="https://habrastorage.org/webt/-b/4r/cd/-b4rcdczwe-_hu8xvha_cko1ihk.gif"></p><br><p>  Luego las habitaciones se convierten en polyboxes: </p><br><p><img src="https://habrastorage.org/webt/pd/j8/qo/pdj8qos36_hf4slo-jlm2eailsw.png"></p><br><p>  Y comienza la segunda etapa de crecimiento: en esta etapa, el lado se puede dividir en varias partes.  A diferencia de la primera etapa, no crece una c√©lula a la vez, sino inmediatamente hasta la parada m√°xima, esto evita la "escalera" en las juntas de las habitaciones.  Si despu√©s de pasar por todas las habitaciones todav√≠a hay celdas vac√≠as, el ciclo se repite. </p><br><p>  El resultado es un espacio completamente lleno: </p><br><p><img src="https://habrastorage.org/webt/mi/8j/zf/mi8jzfzhpksr2cz7jzd1_k3gmng.png"></p><br><p>  Luego, los polyboxes se dibujan en forma de r√°ster y (como en el caso del generador "BSP"), comienza la etapa de marcar celdas "basura": </p><br><p><img src="https://habrastorage.org/webt/ev/na/ru/evnaruhyjwsei7hfbywiiuxyzq4.png"></p><br><p>  Y uni√©ndolos a sectores existentes: </p><br><p><img src="https://habrastorage.org/webt/1h/yv/kf/1hyvkfcnerw5yu30txvbztecfzw.png"><br>  <em>Aqu√≠ no fue posible unir todas las celdas; se eliminaron las adicionales.</em> </p><br><p>  El resultado se convierte nuevamente en polyboxes: </p><br><p><img src="https://habrastorage.org/webt/ji/l3/yq/jil3yqqnbqpf4cfjyx-sklb_g8w.png"></p><br><h2 id="ochistka-ot-musornyhsekciy">  Limpieza de tramos de basura </h2><br><p>  A veces surgen secciones dentro de las cuales no se respeta la regla 3x3: </p><br><p><img src="https://habrastorage.org/webt/6v/zx/2v/6vzx2vnhvhn_kkxvqp1jyzenh6g.png"></p><br><p>  Puede intentar "restaurar" tales secciones, pero fui por el camino m√°s simple y simplemente las elimin√©: </p><br><p><img src="https://habrastorage.org/webt/gc/5s/4y/gc5s4yzeywvc6pi1kh0apfk90pm.png"></p><br><h2 id="postroenie-soedineniy">  Construyendo conexiones </h2><br><p><img src="https://habrastorage.org/webt/af/3m/w2/af3mw25mgkjtqwskriypbpzzaeo.gif"></p><br><p>  Para cada secci√≥n, se buscan sus vecinos, y en los lugares de contacto de dichas secciones, se crean conexiones.  Las conexiones se crean en ambos lados: si la secci√≥n A est√° en contacto con la secci√≥n B, habr√° una conexi√≥n de A a B y de B a A. El resultado es un gr√°fico bidireccional. </p><br><h2 id="ochistka-ot-musornyh-podgrafov">  Limpieza de subgrafos de basura </h2><br><p>  A veces, como resultado de la limpieza de secciones de basura, no obtenemos un gr√°fico, sino varios independientes, como en este ejemplo: </p><br><p><img src="https://habrastorage.org/webt/yi/s5/5u/yis55urvft0bohq8x0dsurgyyam.png"></p><br><p>  En este caso, el subgrafo se selecciona como el principal, el "√°rea" de las secciones es m√°ximo, y el resto se elimina (el "√°rea" est√° entre comillas, porque aunque es posible calcular el √°rea real del cuadro de polietileno, simplifiqu√© la tarea y considero el √°rea del cuadro delimitador) esto est√° mal, pero es adecuado para un generador). </p><br><h2 id="ochistka-ot-izlishnih-soedineniy">  Eliminar el exceso de compuestos </h2><br><p>  Si hay un pasaje de cada sector a cada uno con el que est√° conectado, entonces habr√° demasiadas puertas en el nivel, y se sentir√° con mayor fuerza que se genera.  Por lo tanto, en esta etapa, se eliminan las conexiones en exceso: </p><br><p><img src="https://habrastorage.org/webt/oa/sh/oy/oashoyuavho98281lo_s4hpc-ks.gif"></p><br><p>  Para una mayor aleatorizaci√≥n, no genero un √°rbol de expansi√≥n en el n√∫mero m√≠nimo de pasadas, sino que elimino un borde aleatorio a la vez (eligi√©ndolo aleatoriamente de entre todos los posibles en el paso actual). </p><br><p>  <em>Aunque, cuando escribo esto, parec√≠a la idea de que ser√≠a bastante aleatorio seleccionar el sector inicial y eliminar los bordes, un algoritmo ya m√°s eficiente.</em> </p><br><h2 id="randomizaciya-soedineniy">  Aleatorizaci√≥n de conexi√≥n </h2><br><p><img src="https://habrastorage.org/webt/ok/zl/vk/okzlvk4rclc7x3imkpjnjza3kje.gif"><br>  <em>En lo sucesivo, las ilustraciones vendr√°n de otra generaci√≥n, porque</em>  <em>en el anterior hubo un error en el generador, debido a que otras im√°genes eran incorrectas.</em> </p><br><p>  Pero un nivel en el que no hay una sola conexi√≥n superflua tampoco parece muy humano, por lo que se introduce un poco de caos: </p><br><ol><li>  Algunos bordes eliminados se restauran. </li><li>  Y algunos se convierten en pasillos. </li></ol><br><p>  Adem√°s, esas secciones entre las cuales se formaron los pasajes se fusionan en una: </p><br><p><img src="https://habrastorage.org/webt/nh/j_/uj/nhj_ujd0n7sqjdnddlvs9uozq5u.gif"><br>  <em>Si le pareci√≥ que en esta ilustraci√≥n reaparecieron las conexiones eliminadas en el paso anterior, le pareci√≥ a usted :).</em>  <em>Cuando le√≠ el texto, tambi√©n me pareci√≥ as√≠, pero despu√©s de mirar cuidadosamente la ilustraci√≥n anterior, queda claro que todo est√° bien.</em> </p><br><h2 id="generaciya-sekretnyh-komnat">  Generaci√≥n de sala secreta </h2><br><p>  Los sectores que solo tienen una conexi√≥n se seleccionan en el gr√°fico: </p><br><p><img src="https://habrastorage.org/webt/xt/ku/qw/xtkuqweqgctwcbcckilick4-es4.png"></p><br><p>  Si hay varios sectores de este tipo, todos se agrupan y se ordenan por "√°rea".  Luego, esta matriz se trunca al azar (pero para que al menos un elemento permanezca en ella).  Estos sectores se convertir√°n en salas secretas: </p><br><p><img src="https://habrastorage.org/webt/pf/w0/yu/pfw0yufvv3orwiw_xohtfii8gqi.png"></p><br><h2 id="generaciya-scenariya">  Generaci√≥n de guiones </h2><br><p><img src="https://habrastorage.org/webt/p2/ql/dn/p2qldn0n-scgjotykszlvsvd05a.gif"></p><br><p>  Primero, se seleccionan los sectores con el n√∫mero m√≠nimo de conexiones libres (es decir, los m√°s cercanos al "borde" del gr√°fico): </p><br><p><img src="https://habrastorage.org/webt/lc/iw/7v/lciw7vahyrhoirla-hyahd7jzhu.png"><br>  <em>En esta ilustraci√≥n, se selecciona un sector, pero si hubiera m√°s, de todos modos se seleccionar√≠a uno (al azar).</em> </p><br><p>  <em>NB.</em>  <em>Durante la revisi√≥n del art√≠culo, pude llegar a una situaci√≥n en la que un sector con un n√∫mero m√≠nimo de conexiones libres no solo no estar√° al l√≠mite, sino que asignarle un script lo llevar√° a un nivel intransitable.</em>  <em>De hecho, puede elegir cualquier sector, pero solo uno, despu√©s de lo cual el gr√°fico no caer√≠a en varios subgrafos.</em> </p><br><p>  A continuaci√≥n, seleccione los sectores que est√°n conectados al sector actual y que solo tienen una conexi√≥n libre.  Ellos, con cierta probabilidad, se utilizar√°n para continuar el gui√≥n.  Por ejemplo, si el gr√°fico fuera el mismo que en la ilustraci√≥n a continuaci√≥n, entonces el sector indicado por la pregunta podr√≠a incluirse en la lista. </p><br><p><img src="https://habrastorage.org/webt/6u/b6/vf/6ub6vfbxncsmbug4optzec19gyw.png"><br>  <em>La sala secreta est√° marcada en gris, las cruces son aquellas conexiones que deber√≠an haberse eliminado en el gr√°fico original, y el sector de origen es una ventaja.</em> </p><br><p>  <em>NB.</em>  <em>Durante la revisi√≥n del art√≠culo, me pareci√≥ que la condici√≥n para la presencia de una sola conexi√≥n era demasiado estricta, lo mismo que en el paso anterior ser√≠a suficiente, de modo que despu√©s de eliminar este sector, el gr√°fico no se romper√≠a.</em> </p><br><p>  Luego, el n√∫mero de script se asigna a esta lista de sectores (solo un n√∫mero, en esta etapa no significa nada espec√≠fico), y las conexiones en los bordes de esta lista de sectores est√°n marcadas como cerradas por este script. </p><br><p><img src="https://habrastorage.org/webt/tw/4w/3w/tw4w3wxhybxndd5_94mw-l0e1zc.png"><br>  <em>En estas ilustraciones, diferentes escenarios tendr√°n diferentes colores de relleno de sector.</em>  <em>No tienen nada que ver con el color del borde del sector (en los pr√≥ximos pasos se corregir√°, pero en este paso es m√°s conveniente para m√≠).</em> </p><br><p>  A continuaci√≥n, se selecciona el siguiente sector, se compila una lista y esta lista se marca con un nuevo escenario: </p><br><p><img src="https://habrastorage.org/webt/qo/01/qw/qo01qww9cg-s2km6vfrjvoqb_vk.png"></p><br><p>  Presta atenci√≥n a los peque√±os puntos azules dentro de los cuadrados rojos: as√≠ es como se dibuja el abridor de escenarios, es decir  En alg√∫n lugar dentro de la secci√≥n con el gui√≥n rojo habr√° una tecla o interruptor que abrir√° el pasaje a sectores con un gui√≥n azul. </p><br><p>  Esto contin√∫a hasta que no queden sectores libres: </p><br><p><img src="https://habrastorage.org/webt/5f/ok/yn/5fokynxff0gfpspu7-d8paaw7wi.png"></p><br><p>  Al sector m√°s reciente no se le asigna un script, sino solo un abridor de escenarios.  Este sector ser√° el sector en el que el jugador comienza el juego. </p><br><p>  Para este nivel: </p><br><ul><li>  El jugador comienza en el sector inicial, en alg√∫n lugar all√≠ encuentra un "abridor de botellas" para el sector amarillo, va all√≠. </li><li>  En el sector amarillo, abre el sector azul, va all√≠. </li><li>  En el sector azul se abre verde, va all√≠. </li><li>  En el sector verde se abre violeta, se va all√≠. </li><li>  En violeta se abre rojo. </li><li>  En rojo - azul. </li><li>  Donde encuentra el interruptor de nivel final. </li></ul><br><p>  Esquem√°ticamente, esto se puede mostrar de la siguiente manera: </p><br><p><img src="https://habrastorage.org/webt/c7/6o/xd/c76oxdwcgff53io6pv3sfcptpuu.png"></p><br><p>  Un "abridor" puede ser una llave o un interruptor, o algo m√°s, por ejemplo, una tarea para destruir a todos los enemigos en cualquier sector (pero no planeo que en el futuro cercano el generador o el motor lo admitan). </p><br><h2 id="optimizaciya-soedineniy">  Optimizaci√≥n de conexi√≥n </h2><br><p><img src="https://habrastorage.org/webt/5q/vl/gw/5qvlgwjtnablead4upxcwph7m6k.gif"></p><br><p>  En este paso, para cada conexi√≥n se selecciona un lado (como recordar√°, inicialmente las conexiones se generan en ambas direcciones).  Esto es necesario para que el nivel parezca m√°s "manual" y para simplificar los siguientes pasos <em>(pero para un tipo de nivel a√∫n m√°s interesante, en un futuro pr√≥ximo planeo dar un paso para "des-optimizar" algunas conexiones)</em> . </p><br><h2 id="sozdanie-dverey-iokon">  Creando puertas y ventanas </h2><br><p><img src="https://habrastorage.org/webt/xr/je/m5/xrjem5kqzr7ncka2vuf8nsukw2c.gif"></p><br><p>  Para cada sector, se ven todas sus conexiones (que despu√©s del paso anterior se ven solo en una direcci√≥n), y se colocan puertas y ventanas en cada conexi√≥n vista. </p><br><ul><li>  Primero, se selecciona un punto en la uni√≥n, preferiblemente m√°s cerca del centro. </li><li>  Luego, en este punto, se coloca una puerta o una ventana (y si es una conexi√≥n a una habitaci√≥n secreta, entonces un muro secreto). </li><li>  Si se coloca una puerta, puede tener un tama√±o de 1 a 3 celdas (una es una puerta normal, dos o tres son una puerta herm√©tica gruesa, que se abre despu√©s de presionar un interruptor). </li><li>  Adem√°s, la conexi√≥n se divide en dos partes: la parte anterior al punto seleccionado y la parte posterior.  Y, si queda espacio antes o despu√©s, la funci√≥n se llama recursivamente. </li></ul><br><p>  Para que el nivel se vea m√°s interesante, en diferentes pasos hay una probabilidad diferente de colocar una puerta o ventana: </p><br><ol><li>  En el primer paso, la puerta siempre se coloca,  de qu√© sirve conectarse si solo hay ventanas all√≠. </li><li>  En el segundo paso, con <strong>una</strong> mayor probabilidad (75%), se coloca una ventana que una puerta. </li><li>  Si hay un tercer paso (por ejemplo, la conexi√≥n es larga), entonces se debe colocar una ventana. </li><li>  En el caso del cuarto paso, la puerta o ventana se coloca igualmente probable. </li><li>  Si la conexi√≥n es extra larga, el generador vuelve al segundo paso. </li></ol><br><h2 id="vybor-deystviya">  Selecci√≥n de acci√≥n </h2><br><p>  Aunque esto no est√° relacionado con la generaci√≥n, la visualizaci√≥n cambia en este paso: ahora el borde del sector est√° pintado en el color del gui√≥n: </p><br><p><img src="https://habrastorage.org/webt/rc/6y/xv/rc6yxvsq6duv-xdujaamzq0fdry.png"><br>  <em>El sector inicial es gris claro, el sector final es azul.</em>  <em>Tambi√©n tenga en cuenta que en lugar de la puerta de la habitaci√≥n secreta (gris oscuro a la izquierda) se dibuja una pared: todo es correcto, esta es una pared secreta.</em> </p><br><p>  A continuaci√≥n, seleccione los sectores en los que puede colocar las claves: </p><br><p><img src="https://habrastorage.org/webt/kl/os/jz/klosjzmyvv_tl2djbz5v6b9sqze.png"></p><br><p>  Se seleccionan simplemente: </p><br><ul><li>  Si esta es una habitaci√≥n secreta, entonces no puede haber un "abridor" y la llave no puede colocarse all√≠. </li><li>  Tampoco puede colocar la clave en el sector final, porque es final. </li><li>  Adem√°s, la llave no puede abrir puertas dobles y triples: debido a las caracter√≠sticas del motor, solo se pueden abrir con el interruptor <em>(no hay tales sectores en la ilustraci√≥n anterior)</em> . </li></ul><br><p>  Despu√©s de eso, se selecciona aleatoriamente el n√∫mero de teclas en un nivel (de cero a tres) y luego, aleatoriamente, de la lista de sectores disponibles, se seleccionan aquellas en las que se seleccionar√°n las teclas. </p><br><p>  En los sectores restantes habr√° interruptores. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418685/">https://habr.com/ru/post/es418685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418675/index.html">C√≥mo fui a Droidcon Berlin</a></li>
<li><a href="../es418677/index.html">Toda la verdad sobre RTOS. Art√≠culo # 6. Otros servicios RTOS</a></li>
<li><a href="../es418679/index.html">Escribimos un componente con botones de "material" para Svelte</a></li>
<li><a href="../es418681/index.html">D√≠a de la amistad: 50% de descuento en todos los IDE de JetBrains para nuestros amigos</a></li>
<li><a href="../es418683/index.html">Creaci√≥n de una m√°quina arcade emulador. Parte 2</a></li>
<li><a href="../es418687/index.html">Revoluci√≥n de 3.5 ": detalles de un peque√±o boom de disquetes con vapores</a></li>
<li><a href="../es418689/index.html">C√≥mo crear bibliotecas de componentes en Figma, ahorrando un presupuesto, usando el ejemplo de una subasta en l√≠nea</a></li>
<li><a href="../es418691/index.html">Ganadero: Kubernetes en 5 minutos sobre metal desnudo.</a></li>
<li><a href="../es418693/index.html">¬øPor qu√© es tan dif√≠cil detectar la felicidad en el cerebro?</a></li>
<li><a href="../es418695/index.html">Guerras contra la pirater√≠a: el imperio contraataca</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>