<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ– ğŸŒº ğŸ† Elasticsearchçš„å°æŠ€å·§ ğŸ™ğŸ½ ğŸ‘§ğŸ¿ ğŸŒ¨ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å…³äºElasticsearchä¸­çš„æ•°æ®æ¢å¤å°æŠ€å·§çš„ç®€çŸ­è¯´æ˜ï¼Œå¯¹æˆ‘æœ¬äººè€Œè¨€ã€‚ å¦‚æœæ²¡æœ‰å¤‡ä»½ï¼Œå¦‚ä½•ä¿®å¤çº¢è‰²ç´¢å¼•ï¼Œåˆ é™¤æ–‡æ¡£å¹¶ä¸”æ²¡æœ‰å‰¯æœ¬ï¼Œè¯¥æ€ä¹ˆåŠ-ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå®ƒä»¬æ²¡æœ‰ä»»ä½•æç¤ºã€‚ 

 åå¤‡ 


 é¦–å…ˆè¦åšçš„æ˜¯è®¾ç½®é‡è¦æ•°æ®çš„å¤‡ä»½ã€‚ å®˜æ–¹æ–‡æ¡£ä¸­å¯¹æ­¤è¿›è¡Œäº†è¯´æ˜ ã€‚ 

 æ€»è€Œè¨€ä¹‹ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Elasticsearchçš„å°æŠ€å·§</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416955/"> å…³äºElasticsearchä¸­çš„æ•°æ®æ¢å¤å°æŠ€å·§çš„ç®€çŸ­è¯´æ˜ï¼Œå¯¹æˆ‘æœ¬äººè€Œè¨€ã€‚ å¦‚æœæ²¡æœ‰å¤‡ä»½ï¼Œå¦‚ä½•ä¿®å¤çº¢è‰²ç´¢å¼•ï¼Œåˆ é™¤æ–‡æ¡£å¹¶ä¸”æ²¡æœ‰å‰¯æœ¬ï¼Œè¯¥æ€ä¹ˆåŠ-ä¸å¹¸çš„æ˜¯ï¼Œåœ¨å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå®ƒä»¬æ²¡æœ‰ä»»ä½•æç¤ºã€‚ <br><a name="habracut"></a><br><h2> åå¤‡ </h2><br><img src="https://habrastorage.org/webt/ov/ua/p_/ovuap_rbyndffch-bceedhmlzis.png"><br><br> é¦–å…ˆè¦åšçš„æ˜¯è®¾ç½®é‡è¦æ•°æ®çš„å¤‡ä»½ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>å®˜æ–¹æ–‡æ¡£ä¸­</b></a>å¯¹æ­¤è¿›è¡Œäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>è¯´æ˜</b></a> ã€‚ <br><br> æ€»è€Œè¨€ä¹‹ï¼Œæ²¡æœ‰ä»€ä¹ˆå¤æ‚çš„ã€‚ åœ¨æœ€ç®€å•çš„ç‰ˆæœ¬ä¸­ï¼Œåœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªçƒï¼Œç„¶åä»¥ä»»ä½•æ–¹ä¾¿çš„æ–¹å¼ï¼ˆnfsï¼Œsmbfsç­‰ï¼‰å°†å…¶å®‰è£…åˆ°æ‰€æœ‰å¼¹æ€§èŠ‚ç‚¹ä¸Šã€‚ æ¥ä¸‹æ¥ï¼Œä½¿ç”¨cronï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºæˆ–å…¶ä»–ä»»ä½•ä¸œè¥¿å‘é€å®šæœŸå¿«ç…§çš„è¯·æ±‚ã€‚ <br><br> ç¬¬ä¸€ä¸ªå¿«ç…§å°†å¾ˆé•¿ï¼Œéšåçš„å¿«ç…§å°†ä»…åŒ…å«ç´¢å¼•çŠ¶æ€ä¹‹é—´çš„å¢é‡ã€‚ è¯·æ³¨æ„ï¼Œå¦‚æœå®šæœŸæ‰§è¡Œ<b>å¼ºåˆ¶åˆå¹¶</b> ï¼Œåˆ™å¢é‡å°†å¾ˆå¤§ï¼Œå› æ­¤åˆ›å»ºå¿«ç…§<b>æ‰€éœ€</b>çš„æ—¶é—´å°†ä¸ç¬¬ä¸€æ¬¡ç›¸ä¼¼ã€‚ <br><br> æ³¨æ„äº‹é¡¹ï¼š <br><br><ul><li>æ£€æŸ¥å¤‡ä»½çš„çŠ¶æ€ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨_catï¼š <code>curl localhost:9200/_cat/snapshots/ <b>yourbackuprepo</b> /</code> ã€‚  <b>éƒ¨åˆ†</b>æˆ–<b>å¤±è´¥</b>å¿«ç…§ä¸æ˜¯æ‚¨çš„å…„å¼Ÿã€‚ </li><li> ä»ES 6.xå¼€å§‹ï¼Œelasticå¯¹è¯·æ±‚æ ‡å¤´çš„è¦æ±‚éå¸¸é«˜ã€‚ å¦‚æœæ‚¨æ‰‹åŠ¨æ‰§è¡Œè¿™äº›æ“ä½œï¼ˆè€Œä¸æ˜¯é€šè¿‡APIï¼‰ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å·²è®¾ç½®<code>Content-Type: application/json</code> ï¼Œå¦åˆ™æ‰€æœ‰è¯·æ±‚éƒ½å°†ä¸­æ–­å¹¶ä¸”ä¸ä¼šå‘ç”Ÿå¤‡ä»½ </li><li> å¿«ç…§æ— æ³•è¿˜åŸåˆ°æ‰“å¼€çš„ç´¢å¼•ã€‚ å¿…é¡»å…ˆå…³é—­æˆ–å¸ä¸‹å®ƒã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨rename_patternï¼Œrename_replacementå¹¶æ’è¿˜åŸå¿«ç…§ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯·å‚é˜…æ‰©å±•åä¸­çš„ç¤ºä¾‹</a> ï¼‰ã€‚ æ­¤å¤–ï¼Œè¿˜åŸå¿«ç…§æ—¶ï¼Œå…¶è®¾ç½®ä¹Ÿä¼šè¿˜åŸï¼ŒåŒ…æ‹¬åˆ«åï¼Œå‰¯æœ¬æ•°ç­‰ã€‚ å¦‚æœæ‚¨ä¸éœ€è¦è¿™æ ·åšï¼Œè¯·æ·»åŠ index_settingsï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ‰å…³ç¤ºä¾‹ï¼Œè¯·å‚è§Dock</a> ï¼‰ï¼Œå¹¶å¯¹è¿˜åŸè¯·æ±‚è¿›è¡Œå¿…è¦çš„æ›´æ”¹ã€‚ </li><li> å¸¦æœ‰å¿«ç…§çš„å­˜å‚¨åº“ï¼ˆçƒï¼‰å¯ä»¥è¿æ¥åˆ°å¤šä¸ªç¾¤é›†ï¼Œå¹¶å°†å¿«ç…§ä»ä»»ä½•ç¾¤é›†è¿˜åŸåˆ°å…¶ä»–ç¾¤é›†ã€‚ æœ€ä¸»è¦çš„æ˜¯å¼¹æ€§ç‰ˆæœ¬æ˜¯å…¼å®¹çš„ã€‚ </li></ul><br> é€šå¸¸ï¼Œçœ‹ä¸€ä¸‹æ–‡æ¡£ï¼Œæˆ–å¤šæˆ–å°‘åœ°å…¬å¼€äº†è¿™ä¸ªä¸»é¢˜ã€‚ <br><br><h2> å¼¹æ€§è½¬å‚¨ </h2><br><img src="https://habrastorage.org/webt/w_/5e/xy/w_5exyoyb7acppvivweuwj1kmiq.jpeg"><br><br>  nodejsä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸€ä¸ªå°å®ç”¨ç¨‹åº</a> ï¼Œå¯è®©æ‚¨å°†æ•°æ®ä»ä¸€ä¸ªç´¢å¼•å¤åˆ¶åˆ°å¦ä¸€ä¸ªç´¢å¼•ï¼Œé›†ç¾¤ï¼Œæ–‡ä»¶ï¼Œstdoutã€‚ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¯ä»¥å°†è¾“å‡ºåˆ°æ–‡ä»¶æˆ–stdoutçš„æ–¹æ³•ç”¨ä½œå¤‡ç”¨å¤‡ä»½æ–¹æ³•-è¾“å‡ºæ˜¯å¸¸è§„çš„æœ‰æ•ˆjsonï¼ˆç±»ä¼¼äºsql dumpï¼‰ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é‡å¤ä½¿ç”¨ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†è¾“å‡ºç²˜è´´åœ¨ç®¡é“ä¸­ï¼Œæ‚¨çš„è„šæœ¬å°†ä»¥æŸç§æ–¹å¼åœ¨å…¶ä¸­è½¬æ¢æ•°æ®å¹¶å°†å…¶å‘é€åˆ°å¦ä¸€ä¸ªå­˜å‚¨åº“ï¼Œä¾‹å¦‚clickhouseã€‚ æœ€ç®€å•çš„jsè½¬æ¢å¯ä»¥ç›´æ¥ç”±elasticdumpæœ¬èº«å®Œæˆï¼Œæœ‰ä¸€ä¸ªå¯¹åº”çš„é”®<b>--transform</b> ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæ˜¯ä¸€ç§å¹»æƒ³ã€‚ <br><br> é™·é˜±ï¼š <br><br><ul><li> ä½œä¸ºå¤‡ä»½æ–¹æ³•ï¼Œå®ƒæ¯”å¿«ç…§è¦æ…¢å¾—å¤šã€‚ å¦å¤–ï¼Œå¤‡ä»½ä¼šéšç€æ—¶é—´çš„å»¶é•¿è€Œæ‰©å±•ï¼Œå› æ­¤é¢‘ç¹æ›´æ”¹ç´¢å¼•çš„ç»“æœå¯èƒ½ä¼šä¸ä¸€è‡´ã€‚ è¯·è®°ä½ã€‚ </li><li> ä¸è¦ä½¿ç”¨æ¥è‡ªdebianä»“åº“çš„nodejsï¼Œå› ä¸ºå®ƒçš„ç‰ˆæœ¬å¤ªæ—§ä¼šå¯¹å·¥å…·çš„ç¨³å®šæ€§äº§ç”Ÿè´Ÿé¢å½±å“ã€‚ </li><li> ç¨³å®šæ€§å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œå°¤å…¶æ˜¯å½“å…¶ä¸­ä¸€æ–¹è¿‡è½½æ—¶ã€‚ ä¸è¦å°è¯•é€šè¿‡åœ¨åŠå…¬è®¡ç®—æœºä¸Šè¿è¡Œè¯¥å·¥å…·ä»ä¸€å°æœåŠ¡å™¨å¤‡ä»½åˆ°å¦ä¸€å°æœåŠ¡å™¨-æ‰€æœ‰æµé‡éƒ½å°†æµç»è¯¥æœåŠ¡å™¨ã€‚ </li><li> æ— èŠ±æœå¤åˆ¶æ˜ å°„ã€‚ å¦‚æœé‚£é‡Œæœ‰äº›å¤æ‚ï¼Œè¯·æ‰‹åŠ¨åˆ›å»ºç´¢å¼•ï¼Œç„¶åå†å°†æ•°æ®å¡«å……åˆ°å…¶ä¸­ã€‚ </li><li> æœ‰æ—¶æ›´æ”¹å—çš„å¤§å°ï¼ˆå‚æ•°--limitï¼‰å¾ˆæœ‰æ„ä¹‰ã€‚ æ­¤é€‰é¡¹ç›´æ¥å½±å“å¤åˆ¶é€Ÿåº¦ã€‚ </li></ul><br> è¦åŒæ—¶åˆå¹¶å¤§é‡ç´¢å¼•ï¼Œå¯ä»¥ä½¿ç”¨å¸¦æœ‰ä¸€ç»„ç®€åŒ–é€‰é¡¹çš„multielasticdumpï¼Œä½†æ˜¯æ‰€æœ‰ç´¢å¼•éƒ½æ˜¯å¹¶è¡Œåˆå¹¶çš„ã€‚ <br><br>  <b>æ³¨æ„ï¼</b> è¯¥å®ç”¨ç¨‹åºçš„ä½œè€…è¯´ï¼Œä»–ä¸å†æœ‰æ—¶é—´æ”¯æŒï¼Œå› æ­¤è¯¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>ç¨‹åºæ­£åœ¨å¯»æ‰¾æ–°çš„ç»´æŠ¤äººå‘˜</b></a> ã€‚ <br><br> æ ¹æ®ä¸ªäººç»éªŒï¼šæœ‰ç”¨çš„å·¥å…·ï¼Œå¤šæ¬¡è¢«æ•‘å‡ºã€‚ é€Ÿåº¦å’Œç¨³å®šæ€§å¾ˆä¸€èˆ¬ï¼Œæˆ‘å¸Œæœ›æœ‰ä¸€ä¸ªåˆé€‚çš„æ›¿ä»£äº§å“ï¼Œä½†æ˜¯åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰ä»»ä½•ä¸œè¥¿ã€‚ <br><br><h2> æ£€æŸ¥ç´¢å¼• </h2><br> å› æ­¤ï¼Œæˆ‘ä»¬å¼€å§‹æ¥è¿‘é˜´æš—é¢ã€‚ æƒ…å†µï¼šç´¢å¼•å˜çº¢äº†ã€‚ åœ¨æ—¥å¿—ä¸­-å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ”¯ç¥¨ä¸é‡‘é¢ä¸ç¬¦ï¼Œæ‚¨å¯èƒ½æœ‰å†…å­˜æˆ–ç£ç›˜ï¼š <br><br> <code>org.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?)</code> <br> <br> å½“ç„¶ï¼Œè¿™å¯¹äºæ¯äº²ç®¡ç†å‘˜æ˜¯æ°¸è¿œä¸ä¼šå‘ç”Ÿçš„ï¼Œå› ä¸ºä»–ä»¬æ‹¥æœ‰å…·æœ‰ä¸‰é‡å¤åˆ¶åŠŸèƒ½çš„é«˜ç«¯ç¡¬ä»¶ï¼Œå¯å³æ—¶çº æ­£æ‰€æœ‰é”™è¯¯çº§åˆ«çš„superECCå†…å­˜ï¼Œå¹¶ä¸”é€šå¸¸æ¯ç§’é…ç½®ä¸€æ¬¡å¿«ç…§ã€‚ <br><br> ä½†æ˜¯ä¸å¹¸çš„æ˜¯ï¼Œç°å®æœ‰æ—¶ä¼šæç¤ºè¿™æ ·çš„é€‰é¡¹ï¼Œå½“å¤‡ä»½æ—¶é—´ç›¸å¯¹è¾ƒé•¿æ—¶ï¼ˆå¦‚æœæ‚¨æ¯å°æ—¶ç´¢å¼•äº†åƒå…†å­—èŠ‚ï¼Œé‚£ä¹ˆå¤‡ä»½æ˜¯å¦åœ¨2å°æ—¶ä¹‹å‰è¿‡æ—§äº†ï¼Ÿï¼‰ï¼Œæ²¡æœ‰åœ°æ–¹å¯ä»¥è¿˜åŸæ•°æ®ï¼Œå¤åˆ¶æ²¡æœ‰æ—¶é—´å’Œè¯¸å¦‚æ­¤ç±»çš„ä¸œè¥¿ã€‚ <br><br> å½“ç„¶ï¼Œå¦‚æœæœ‰å¿«ç…§ï¼Œå¤‡ä»½ç­‰ã€‚  -éå¸¸å¥½ï¼Œæ¨å‡ºï¼Œä¸ç”¨æ‹…å¿ƒã€‚ å¦‚æœæ²¡æœ‰å‘¢ï¼Ÿ å¹¸è¿çš„æ˜¯ï¼Œè‡³å°‘æŸäº›æ•°æ®ä»ç„¶å¯ä»¥ä¿å­˜ã€‚ <br><br> é¦–å…ˆï¼Œå…³é—­ç´¢å¼•å’Œ/æˆ–å…³é—­å¼¹æ€§ï¼Œåˆ¶ä½œæ•…éšœåˆ†ç‰‡çš„å¤‡ä»½å‰¯æœ¬ã€‚ <br><br>  Luceneï¼ˆå³ï¼Œå®ƒåœ¨elasticsearchä¸­ç”¨ä½œåç«¯ï¼‰å…·æœ‰å‡ºè‰²çš„CheckIndexæ–¹æ³•ã€‚ æˆ‘ä»¬åªéœ€è¦åœ¨ç ´ç¢çš„ç¢ç‰‡ä¸Šå¬å”¤å®ƒå³å¯ã€‚  Luceneå°†æ£€æŸ¥æ‰€æœ‰åˆ†æ®µï¼Œå¹¶åˆ é™¤æŸåçš„åˆ†æ®µã€‚ æ˜¯çš„ï¼Œæ•°æ®å°†ä¸¢å¤±ï¼Œä½†è‡³å°‘ä¸ä¼šä¸¢å¤±æ‰€æœ‰æ•°æ®ã€‚ è™½ç„¶æœ‰å¤šä¹ˆå¹¸è¿ã€‚ <br><br> è‡³å°‘æœ‰ä¸¤ç§æ–¹æ³•ã€‚ <br><br><h3> æ–¹æ³•1ï¼šç›´æ¥åœ¨ç«™ç‚¹ä¸Š </h3><br> è¿™æ ·ä¸€ä¸ªç®€å•çš„è„šæœ¬å°†å¯¹æˆ‘ä»¬æœ‰æ‰€å¸®åŠ©ã€‚ <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash pushd /usr/share/elasticsearch/lib java -cp lucene-core*.jar -ea:org.apache.lucene... org.apache.lucene.index.CheckIndex "$@" popd</span></span></code> </pre><br> åœ¨ä¸å¸¦å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="hljs vhdl"><span class="hljs-literal"><span class="hljs-literal">ERROR</span></span>: index path <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> specified Usage: java org.apache.lucene.index.CheckIndex pathToIndex [-exorcise] [-crossCheckTermVectors] [-segment X] [-segment Y] [-dir-impl X] -exorcise: actually write a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> segments_N <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>, removing any problematic segments -fast: just verify <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> checksums, omitting logical integrity checks -crossCheckTermVectors: verifies that term vectors match postings; THIS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> VERY SLOW! -codec X: <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> exorcising, codec <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> write the <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> segments_N <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> -verbose: print additional details -segment X: only check the specified segments. This can be specified multiple times, <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> check more than one segment, eg '-segment _2 -segment _a'. You can<span class="hljs-symbol"><span class="hljs-symbol">'t</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> this <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the -exorcise option -dir-impl X: <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> a specific FSDirectory implementation. <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> no <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> specified the org.apache.lucene.store <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> will be used. **<span class="hljs-literal"><span class="hljs-literal">WARNING</span></span>**: -exorcise *LOSES DATA*. This should only be used <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> an emergency basis as it will cause documents (perhaps many) <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be permanently removed from the index. Always make a backup copy <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> your index before running this! Do <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> run this tool <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> an index that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> actively being written <span class="hljs-keyword"><span class="hljs-keyword">to</span></span>. You have been warned! Run without -exorcise, this tool will <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> the index, <span class="hljs-keyword"><span class="hljs-keyword">report</span></span> version information <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">report</span></span> any exceptions it hits <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> what action it would take <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> -exorcise were specified. <span class="hljs-keyword"><span class="hljs-keyword">With</span></span> -exorcise, this tool will remove any segments that have issues <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> write a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> segments_N <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>. This means <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> documents contained <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the affected segments will be removed. This tool exits <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span> code <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> the index cannot be opened <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> has any corruption, <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.</code> </pre><br> å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°è¿è¡Œç´¢å¼•æµ‹è¯•ï¼Œä¹Ÿå¯ä»¥ä½¿CheckIndexâ€œä¿®å¤â€å®ƒï¼Œä»¥æ¶ˆé™¤æ‰€æœ‰æŸåçš„ä¸œè¥¿ã€‚ <br><br>  Luceneç´¢å¼•çš„ç”Ÿå­˜æ–¹å¼å¤§è‡´ç›¸åŒï¼š/ var / lib / elasticsearch / nodes / 0 / indexs / str4ngEHashVa1uE / 0 / index /ï¼Œå…¶ä¸­0å’Œ0æ˜¯æœåŠ¡å™¨ä¸Šçš„èŠ‚ç‚¹å·å’ŒèŠ‚ç‚¹ä¸Šçš„åˆ†ç‰‡æ•°ã€‚ å®ƒä»¬ä¹‹é—´çš„å¯æ€•å€¼-ç´¢å¼•çš„å†…éƒ¨åç§°-å¯ä»¥ä»curl localhostçš„è¾“å‡ºä¸­è·å–ï¼š9200 / _cat / indexsã€‚ <br><br> æˆ‘é€šå¸¸å°†å‰¯æœ¬å¤åˆ¶åˆ°å¦ä¸€ä¸ªç›®å½•ï¼Œç„¶åå°±åœ°ä¿®å¤ã€‚ ç„¶åï¼Œæˆ‘é‡æ–°å¯åŠ¨elasticsearchã€‚ é€šå¸¸ï¼Œæ‰€æœ‰å†…å®¹éƒ½ä¼šè¢«æ”¶é›†ï¼Œå°½ç®¡ä¼šä¸¢å¤±æ•°æ®ã€‚ æœ‰æ—¶ç”±äºshardsæ–‡ä»¶å¤¹ä¸­çš„*æŸå*æ–‡ä»¶ï¼Œä»ç„¶ä¸å¸Œæœ›è¯»å–ç´¢å¼•ã€‚ å°†å®ƒä»¬ç§»åˆ°å®‰å…¨çš„åœ°æ–¹ä¸€ä¼šå„¿ã€‚ <br><br><h3> æ–¹æ³•2ï¼šè·¯åŠ  </h3><br><img src="https://habrastorage.org/webt/t3/8s/pi/t38spiezlwrxrxynldo8qnj9bh0.png"><br>  ï¼ˆå›¾ç‰‡æ¥è‡ªäº’è”ç½‘ï¼‰ <br><br> ä¸Luceneä¸€èµ·å·¥ä½œçš„å®ç”¨å·¥å…·<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å«åš<b>Luke</b></a> ã€‚ <br><br> è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒç®€å•ã€‚ ä»æ‚¨çš„elasticsearchä¸­æ‰¾å‡ºLuceneç‰ˆæœ¬ï¼š <br><br><pre> <code class="bash hljs">$ curl localhost:9200 { <span class="hljs-string"><span class="hljs-string">"name"</span></span> : <span class="hljs-string"><span class="hljs-string">"node00"</span></span>, <span class="hljs-string"><span class="hljs-string">"cluster_name"</span></span> : <span class="hljs-string"><span class="hljs-string">"main"</span></span>, <span class="hljs-string"><span class="hljs-string">"cluster_uuid"</span></span> : <span class="hljs-string"><span class="hljs-string">"UCbEivvLTcyWSQElOipgTQ"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span> : { <span class="hljs-string"><span class="hljs-string">"number"</span></span> : <span class="hljs-string"><span class="hljs-string">"6.2.4"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"ccec39f"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_date"</span></span> : <span class="hljs-string"><span class="hljs-string">"2018-04-12T20:37:28.497551Z"</span></span>, <span class="hljs-string"><span class="hljs-string">"build_snapshot"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"lucene_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"7.2.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"minimum_wire_compatibility_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.6.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"minimum_index_compatibility_version"</span></span> : <span class="hljs-string"><span class="hljs-string">"5.0.0"</span></span> }, <span class="hljs-string"><span class="hljs-string">"tagline"</span></span> : <span class="hljs-string"><span class="hljs-string">"You Know, for Search"</span></span> }</code> </pre><br> é‡‡å–ç›¸åŒç‰ˆæœ¬çš„å¢å…‹ã€‚ æˆ‘ä»¬ç”¨dawåœ¨å…¶ä¸­æ‰“å¼€ä¸€ä¸ªç´¢å¼•ï¼ˆå½“ç„¶æ˜¯å‰¯æœ¬ï¼‰ã€‚ <b>ä¸è¦æ‰“å¼€IndexReaderï¼ˆæ‰“å¼€æŸåçš„ç´¢å¼•æ—¶ï¼‰</b> ã€‚ æ¥ä¸‹æ¥ï¼Œå•å‡»å·¥å…·/æ£€æŸ¥ç´¢å¼•ã€‚ é¦–å…ˆï¼Œæˆ‘å»ºè®®ç©ºè¿è½¬ï¼Œç„¶åå†ä»¥ç»´ä¿®æ¨¡å¼è¿è½¬ã€‚ è¿›ä¸€æ­¥çš„æ“ä½œç±»ä¼¼-å¤åˆ¶å›å¼¹æ€§ï¼Œé‡æ–°å¯åŠ¨/æ‰“å¼€ç´¢å¼•ã€‚ <br><br><h2> æ¢å¤å·²åˆ é™¤çš„æ–‡æ¡£ </h2><br> æƒ…å†µï¼šæ‚¨æ‰§è¡Œäº†ç ´åæ€§æŸ¥è¯¢ï¼Œåˆ é™¤äº†å¾ˆå¤š/æ‰€æœ‰éœ€è¦çš„æ•°æ®ã€‚ è€Œä¸”æ— å¤„å¯æ¢å¤ï¼Œæˆ–è€…éå¸¸æ˜‚è´µã€‚ å¥½å§ï¼ŒSSZBå½“ç„¶æ²¡æœ‰å¤‡ä»½ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µä¹Ÿä¼šå‘ç”Ÿã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼ŒLuceneä»æœªç›´æ¥åˆ é™¤ä»»ä½•ä¸œè¥¿ã€‚ å®ƒçš„ç†å¿µæ›´æ¥è¿‘CoWï¼Œå› æ­¤åˆ é™¤çš„æ•°æ®å®é™…ä¸Šå¹¶æœªåˆ é™¤ï¼Œè€Œä»…æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚ åˆ é™¤æœ¬èº«å‘ç”Ÿåœ¨ç´¢å¼•ä¼˜åŒ–è¿‡ç¨‹ä¸­-åˆ†æ®µä¸­çš„å®æ—¶æ•°æ®è¢«å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„åˆ†æ®µä¸­ï¼Œæ—§åˆ†æ®µä»…è¢«åˆ é™¤ã€‚ é€šå¸¸ï¼Œå°½ç®¡å·²åˆ é™¤ç´¢å¼•çš„çŠ¶æ€ä¸ä¸º0ï¼Œä½†ä»æœ‰æœºä¼šå°†å…¶åˆ é™¤ã€‚ <br><br><pre> <code class="bash hljs">$ curl localhost:9200/_cat/indices?v health status index uuid pri rep docs.count docs.deleted store.size pri.store.size green open data.0 R0fgvfPnTUaoI2KKyQsgdg 5 1 7238685 1291566 45.1gb 22.6gb</code> </pre><br> å¼ºåˆ¶åˆå¹¶åå°±æ²¡æœ‰æœºä¼šäº†ã€‚ <br><br> å› æ­¤ï¼Œé¦–å…ˆï¼Œå…³é—­ç´¢å¼•ï¼Œåœæ­¢å¼¹æ€§ï¼Œå°†ç´¢å¼•ï¼ˆæ–‡ä»¶ï¼‰å¤åˆ¶åˆ°å®‰å…¨çš„åœ°æ–¹ã€‚ <br><br> æ— æ³•æå–å•ä¸ªå·²åˆ é™¤çš„æ–‡æ¡£ã€‚ æ‚¨åªèƒ½æ¢å¤æŒ‡å®šæ®µä¸­çš„æ‰€æœ‰å·²åˆ é™¤æ–‡æ¡£ã€‚ <br><br> å¯¹äºä½äº4çš„Luceneç‰ˆæœ¬ï¼Œä¸€åˆ‡éƒ½éå¸¸ç®€å•ã€‚  Lucene APIå…·æœ‰ä¸€ä¸ªç§°ä¸ºundeleteAllçš„å‡½æ•°ã€‚ æ‚¨å¯ä»¥ä»ä¸Šä¸€æ®µç›´æ¥ä»<b>å¢å…‹ï¼ˆLukeï¼‰</b>æ‰“ç”µè¯ç»™å¥¹ã€‚ <br><br>  newï¼Œå¯¹äºè¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œè¯¥åŠŸèƒ½å·²è¢«åˆ é™¤ã€‚ ä½†æ˜¯ä»ç„¶æœ‰åŠæ³•ã€‚ æœ‰å…³å®æ—¶æ–‡æ¡£çš„ä¿¡æ¯å­˜å‚¨åœ¨* .livæ–‡ä»¶ä¸­ã€‚ ä½†æ˜¯ï¼Œä»…åˆ é™¤å®ƒä»¬å°†ä½¿ç´¢å¼•ä¸å¯è¯»ã€‚ æ‚¨éœ€è¦æ›´æ­£segments_Næ–‡ä»¶ï¼Œä»¥ä¾¿å®ƒå®Œå…¨å¿˜è®°å®ƒä»¬çš„å­˜åœ¨ã€‚ <br><br> åœ¨æ‚¨æœ€å–œæ¬¢çš„Hexç¼–è¾‘å™¨ä¸­æ‰“å¼€segments_Næ–‡ä»¶ï¼ˆNæ˜¯æ•´æ•°ï¼‰ã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><b>å®˜æ–¹æ–‡æ¡£</b></a>å°†å¸®åŠ©æˆ‘ä»¬è¿›è¡Œå¯¼èˆªï¼š <br><pre> <code class="bash hljs">segments_N: Header, LuceneVersion, Version, NameCounter, SegCount, MinSegmentLuceneVersion, &lt;SegName, SegID, SegCodec, DelGen, DeletionCount, FieldInfosGen, DocValuesGen, UpdatesFiles&gt;SegCount, CommitUserData, Footer</code> </pre> <br> æ‰€æœ‰è¿™äº›ï¼Œæˆ‘ä»¬éœ€è¦DelGenï¼ˆInt64ï¼‰å’ŒDeletionCountï¼ˆInt32ï¼‰çš„å€¼ã€‚ ç¬¬ä¸€ä¸ªå¿…é¡»è®¾ç½®ä¸ºç­‰äº-1ï¼Œç¬¬äºŒä¸ªè®¾ç½®ä¸º0ã€‚ <br><br><img src="https://habrastorage.org/webt/8t/3s/dg/8t3sdgluq35ibmu0att0yzjapju.png"><br><br> æ‰¾åˆ°å®ƒä»¬å¹¶ä¸éš¾ï¼Œå®ƒä»¬å°±ä½äºSegCodecçš„åé¢ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸å¼•äººæ³¨ç›®çš„å­—ç¬¦ä¸²ï¼Œå¦‚Lucene62ã€‚ åœ¨æ­¤å±å¹•å¿«ç…§ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°DelGençš„å€¼ä¸º3ï¼Œå¹¶ä¸”DeletionCount-184614ã€‚å°†ç¬¬ä¸€ä¸ªæ›¿æ¢ä¸º0xFFFFFFFFFFFFFFFFï¼Œç¬¬äºŒä¸ªæ›¿æ¢ä¸º0x00000000ã€‚ é‡å¤æ‰€æœ‰å¿…è¦çš„ç»†åˆ†ï¼Œä¿å­˜ã€‚ <br><br> ä½†æ˜¯ï¼Œç”±äºæ ¡éªŒå’Œé”™è¯¯ï¼Œå›ºå®šç´¢å¼•å°†ä¸å¸Œæœ›åŠ è½½ã€‚ è¿™é‡Œè¿˜æ˜¯æ¯”è¾ƒç®€å•ã€‚ ä»¥Lukeä¸ºä¾‹ï¼Œä½¿ç”¨ç¦ç”¨çš„IndexReaderï¼Œå·¥å…·/æ£€æŸ¥ç´¢å¼•åŠ è½½ç´¢å¼•ã€‚ æˆ‘ä»¬è¿›è¡Œæµ‹è¯•å¹¶ç«‹å³å‘ç°segment_Nå·²æŸåã€‚ è¿™æ ·çš„æ£€æŸ¥æ˜¯æœŸæœ›çš„ï¼Œä½†æ˜¯è¿™æ ·çš„æ£€æŸ¥æ˜¯å¯ä»¥æ¥æ”¶çš„ã€‚ <br><br><pre> <code class="bash hljs">Caused by: org.apache.lucene.index.CorruptIndexException: checksum failed (hardware problem?) : expected=51fbdb5c actual=6e964d17</code> </pre> <br> åºŸè¯ï¼ æˆ‘ä»¬å°†é¢„æœŸçš„æ ¡éªŒå’Œè¾“å…¥åˆ°æ–‡ä»¶çš„æœ€å4ä¸ªå­—èŠ‚ä¸­ã€‚ <br><br><img src="https://habrastorage.org/webt/h5/1q/q-/h51qq-yrc9s_jbwrpq1n92d8qm8.png"><br><br> ä¿å­˜ã€‚ æˆ‘ä»¬å†æ¬¡è¿è¡ŒCheckIndexä»¥ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼Œå¹¶ä¸”ç´¢å¼•æ­£åœ¨åŠ è½½ã€‚ <br><br> ç­‰ç­‰ï¼ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN416955/">https://habr.com/ru/post/zh-CN416955/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN416945/index.html">æ­£å¦‚æˆ‘ä»¬åšçš„BelAZã€‚ ç¬¬1éƒ¨åˆ†-é“</a></li>
<li><a href="../zh-CN416947/index.html">åœ¨å¥¥è¿ä¼šä¹‹å‰ç©æ¸¸æˆï¼šç”µå­ç«æŠ€æˆä¸ºæ­£å¼æ¯”èµ›</a></li>
<li><a href="../zh-CN416949/index.html">å²è’‚æ–‡å…ˆç”Ÿçš„å¤§è§„æ¨¡å‡çº§å®‰è£…äº†å››å€çš„å¤§å‹ç‹©çŒç½‘ç»œï¼Œç°å·²å®Œæˆ</a></li>
<li><a href="../zh-CN416951/index.html">VPCæœåŠ¡ä¸­çš„Kubernetesé›†ç¾¤</a></li>
<li><a href="../zh-CN416953/index.html">ä¸ºç½‘ç»œåˆ›å»ºå¡é€šæ°´ç€è‰²å™¨ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN416959/index.html">è‹¹æœæ¨å‡ºæ–°çš„iOSé˜²ç›—åŠŸèƒ½</a></li>
<li><a href="../zh-CN416961/index.html">ä½¿ç”¨æ“ä½œè½¬æ¢è‡ªåŠ¨è§£å†³å†²çª</a></li>
<li><a href="../zh-CN416963/index.html">æ­£å¦‚æˆ‘ä»¬åšçš„BelAZã€‚ ç¬¬2éƒ¨åˆ†-å®éªŒå®¤æµ‹è¯•</a></li>
<li><a href="../zh-CN416967/index.html">æ­£å¦‚æˆ‘ä»¬åšçš„BelAZã€‚ ç¬¬3éƒ¨åˆ†-åˆ†æ®µè°ƒè¯•</a></li>
<li><a href="../zh-CN416969/index.html">æ¯•è¾¾å“¥æ‹‰æ–¯ä¹è°±çš„æ•°å­¦è¯æ˜</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>