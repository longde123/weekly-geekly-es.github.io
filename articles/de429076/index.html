<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💖 🔹 🧙🏻 Die Entwicklung der Suche - wie man ein Klavier mit drei Klicks kauft 👼🏿 📼 🤚</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bisher konnten Sie unter Avito mithilfe von Keyword-Filterung oder Kategoriebaumnavigation das richtige Produkt finden. Diese Methode war zwar bekannt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die Entwicklung der Suche - wie man ein Klavier mit drei Klicks kauft</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/429076/"><p>  Bisher konnten Sie unter Avito mithilfe von Keyword-Filterung oder Kategoriebaumnavigation das richtige Produkt finden.  Diese Methode war zwar bekannt, aber nicht immer praktisch. Um ein Produkt oder eine Dienstleistung zu finden, musste eine große Anzahl von Klicks ausgeführt werden.  Vor mehr als einem Jahr haben wir an Relevanz gewonnen, wodurch die Suche besser geworden ist. Jetzt ist es einfacher und bequemer, ein Produkt oder eine Dienstleistung auch auf der Hauptseite zu finden.  Mit dieser Innovation fielen ungeeignete, offen gesagt „Müll“ -Waren nicht mehr in das Thema.  Und dies ist nur einer der Schritte, um Ihre Suche zu verbessern.  Wir ändern schrittweise die Infrastruktur, wodurch wir intensiver an der Suchqualität arbeiten, diese schneller verbessern und neue Funktionen einführen können, die Verkäufern und Käufern von Avito zugute kommen. </p><br><p>  In dem Artikel werde ich Ihnen erzählen, wie sich die Suche nach Avito verändert hat: wie wir angefangen haben und wie wir uns jetzt darauf konzentrieren, das Leben unserer Benutzer zu verbessern, und unsere Innovationen sowohl im Produkt als auch in seiner Füllung - dem technischen Teil - teilen.  Es wird hier kein Hardcore-Fleisch geben, aber ich hoffe es gefällt euch. </p><br><img src="https://habrastorage.org/webt/19/zx/he/19zxhesvegeiygbo4haapoe4mic.png"><a name="habracut"></a><br><p>  Einige einleitende Anmerkungen: Avito ist der beliebteste Werbedienst in Russland.  Wir haben jeden Tag mehr als 450.000 Anzeigen und die monatliche Anzahl der eindeutigen Besucher erreicht 35 Millionen, was täglich mehr als 140 Millionen Suchanfragen entspricht. </p><br><h1 id="tipichnyy-scenariy-poiska-ranshe">  Typisches Suchszenario zuvor </h1><br><p>  Schauen wir uns ein einfaches Beispiel an, wie eine Suche vor über einem Jahr funktioniert hat.  Angenommen, Sie brauchen ein Klavier (warum nicht?).  Wir gehen zur Hauptseite und geben "Klavier" ein. </p><br><img src="https://habrastorage.org/webt/yh/jq/di/yhjqdiamdihyfnkermrcwkhwzpq.png"><br><p>  Bei der Auslieferung erhalten Sie höchstwahrscheinlich Umzugsunternehmen, Klaviertransportdienste oder ähnliches, jedoch kein Musikinstrument. </p><br><img src="https://habrastorage.org/webt/wy/dp/rm/wydprmf6to16xbqxq6mfkpfqlno.png"><br><p>  Dies geschieht, weil wir nach dem Datum der Platzierung sortieren müssen - und diese Dienste werden am häufigsten platziert. </p><br><img src="https://habrastorage.org/webt/bt/m8/rz/btm8rzqberfol38jrn2uln1ipju.jpeg"><br><p>  Um das Klavier zu sehen, müssen Sie die Kategorie angeben.  Wir klicken auf die Überschrift „Hobbys und Freizeit“, gehen den Kategorienbaum hinunter zu „Musikinstrumente“ und dann zu „Tastaturinstrumenten“. </p><br><img src="https://habrastorage.org/webt/d1/h2/oq/d1h2oqqqz5gv9snlihpiu51yzau.png"><br><img src="https://habrastorage.org/webt/be/c2/zf/bec2zflrha8wktusuudqo1w3o08.png"><br><p>  Und erst danach sehen wir das Klavier, das wir gesucht haben. </p><br><img src="https://habrastorage.org/webt/-c/wz/71/-cwz71ifodfnrcda86qj03u__5y.png"><br><p>  Es stellte sich heraus, dass es die folgenden Optionen gab, um die gewünschte Anzeige zu finden: </p><br><ul><li>  Verfeinerung der Kategorie bei der Suche nach Stichwörtern, </li><li>  Sortierung nach Frische und Preis, </li><li>  Filter </li><li>  Suche nur nach Namen. </li></ul><br><h1 id="chto-izmenilos-blagodarya-relevantnosti">  Was hat sich aufgrund der Relevanz geändert </h1><br><p>  Anzeigen, die überhaupt nicht passen, werden aufgrund ihrer Relevanz nicht mehr in die Ausgabe aufgenommen.  Wenn Sie auf der Hauptseite nach einem Klavier suchen, werden Sie höchstwahrscheinlich nicht die Dienste von Ladern sehen, die Ihnen beim Transport helfen, aber Sie werden sofort das gewünschte Musikinstrument sehen.  Gleichzeitig wurde eine neue Sortierung hinzugefügt - "Standardmäßig".  Es besteht aus zwei Indikatoren: Anzeigenrelevanz für die Textabfrage und Aktualität. </p><br><img src="https://habrastorage.org/webt/oc/p_/ry/ocp_rycbztfxg1fdvec-3usu0cm.png"><br><p>  Oben sehen Sie die frischesten der relevanten. </p><br><img src="https://habrastorage.org/webt/cg/md/pq/cgmdpq3ogawjuoqf4cr66l17gr0.png"><br><p>  Auf Avito können Sie gegen eine zusätzliche Gebühr Ihre Anzeige schalten.  Und mit der Einführung von Relevanz arbeiten bezahlte Erhöhungen effizienter.  Sie funktionieren zunächst, wenn Ihre Anzeige für die Textabfrage relevant ist. </p><br><p>  Die Einführung von Relevanz bedeutet nicht, dass wir die Übergänge zum Kategoriebaum vollständig aufgegeben haben.  In den meisten Fällen haben wir die Anzahl der Klicks auf die gewünschte Anzeige reduziert, wenn wir von der Hauptseite aus gesucht haben.  Wenn Sie weiterhin Transportdienste benötigen, obwohl Sie bei der Suche gerade "Klavier" eingegeben haben, durchsuchen Sie den Kategoriebaum und Sie finden diese Anzeigen.  Die Suche begann auch effizienter und innerhalb der Kategorie zu arbeiten, zum Beispiel „Persönliche Gegenstände“ und „Haushaltsgeräte“. </p><br><h1 id="kak-nayti-nuzhnyy-tovar-v-tri-klika">  So finden Sie mit drei Klicks das richtige Produkt </h1><br><p>  Die Suche wird für Benutzer nicht nur aufgrund der Qualität der Suchergebnisse bequemer.  Es gibt andere Möglichkeiten, dies zu verbessern.  Einer von ihnen leitet an die Kategorie weiter.  Zum Beispiel suchen wir Lamborghini Gayardo (ja, Sie spielen gerne Klavier und möchten Lamborghini reiten).  Um in die Kategorie eines Autos eines bestimmten Modells zu gelangen, müssen Sie zwei zusätzliche Klicks ausführen.  Mit Relevanz erhalten Sie höchstwahrscheinlich das, was Sie wollen. </p><br><img src="https://habrastorage.org/webt/vd/d0/-y/vdd0-ymtzuq15oeaxe_bdikffne.png"><br><p>  Es gibt jedoch eine zusätzliche Methode, mit der Sie sofort in Autos geworfen werden.  Die Ausgabe wird eingegrenzt, das richtige Auto wird in den Filtern ausgewählt und Sie erhalten wirklich Autos in der Ausgabe. </p><br><img src="https://habrastorage.org/webt/xq/b_/7v/xqb_7v4xa6vmvo4rtt88h8yvttk.png"><br><img src="https://habrastorage.org/webt/vo/lk/yo/volkyo_aktkx5cemgpd9fvy2hp4.png"><br><p>  Eine andere Möglichkeit besteht darin, Tags zu erweitern.  Wenn Sie beispielsweise das Wort "Jacke" eingeben, erhalten Sie Hinweise. </p><br><img src="https://habrastorage.org/webt/mv/7q/si/mv7qsiygsxehsjbl0pkctnhykjo.png"><br><p>  Der Screenshot oben zeigt die Tipps: die Art der Jacken - weiblich, männlich, für Mädchen, für Jungen.  Wenn Sie auf "Für Mädchen" klicken, fallen Sie sofort in die Kategorie, in der die entsprechenden Filter ausgewählt werden.  Hier wird auch eine Reihe zusätzlicher expandierender Tags angezeigt: Winterjacke, Leder, Neu und so weiter.  Wenn Sie den Kategoriebaum manuell zum gewünschten Produkt durchgehen, müssen Sie weitere Aktionen ausführen. </p><br><img src="https://habrastorage.org/webt/4k/hq/vg/4khqvgdpjs1sgxhb_icjrxl__v0.png"><br><h1 id="v-chem-raznica-mezhdu-poiskom-i-filtrami">  Was ist der Unterschied zwischen Suche und Filtern? </h1><br><p>  Als ich bei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RIT ++</a> sprach, hatte das Publikum eine Frage: Was ist der Unterschied zwischen Textsuche und Filtern?  Alles ist ganz einfach.  Sie können die gewünschte Anzeige auch ohne Textanforderung finden, indem Sie den Kategoriebaum durchgehen.  In diesem Fall werden bei der Suche weiterhin Waren und Dienstleistungen gefunden, nicht anhand des angegebenen Textes, sondern anhand der Parameter, die von den entsprechenden Filtern der ausgewählten Kategorie übergeben wurden. </p><br><p>  Jede Kategorie hat ihre eigenen Filter.  Zum Beispiel in der Kategorie „Autos“ - einige Filter, in der Kategorie „Persönliche Dinge“ - andere Filter.  Das heißt, Filter sind fest an eine Kategorie gebunden. </p><br><h1 id="razmeschenie-obyavleniya-za-dve-minuty">  Schalten einer Anzeige in zwei Minuten </h1><br><p>  Für Verkäufer ist eine wichtige Neuerung aufgetaucht, die sie beim Einreichen ihrer Anzeige spüren.  Wenn Ihre Anzeige kein "Verbotenes" enthält oder kein Duplikat ist - die übliche gute Anzeige -, wird sie fast sofort in der Ausgabe angezeigt.  Eigentlich dauert diese Verzögerung ungefähr zwei Minuten, kann aber in seltenen Fällen auf bis zu 30 Minuten verlängert werden.  Bisher wurde eine Anzeige immer erst nach einer halben Stunde auf der Website geschaltet. </p><br><h1 id="avito-pomoschnik">  Avito-Assistent </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Avito Helper</a> ist eine Erweiterung für Chrome, die den Preis eines ähnlichen Produkts auf Avito auf Websites von Drittanbietern anzeigt.  In der Erweiterung können Sie die Preise in vielen Online-Shops mit den Preisen für Avito vergleichen oder einfach nach den erforderlichen Waren und Dienstleistungen in unserem Service suchen, ohne direkt auf die Website oder die Anwendung zuzugreifen.  Wir konnten den „Assistenten“ auch dank neuer Infrastrukturänderungen implementieren. </p><br><img src="https://habrastorage.org/webt/d5/hv/cw/d5hvcwkpl7-npnqilrei9wfcz80.png"><br><h1 id="arhitektura">  Architektur </h1><br><h2 id="pilim-monolit">  Einen Monolithen sägen </h2><br><p>  Avito hat einen Monolithen in PHP.  Vor einem Jahr befand sich die gesamte Suchfunktion, die in Avito funktioniert, in diesem Monolithen.  Die Suche im Monolithen funktionierte mit vier Plattformen: Android, iOS, die mobile Version im Browser und Desktop.  Um die Ausgabe zu erhalten, wurden die entsprechenden SQL-Abfragen in Sphinx in diesem Code generiert, die Verarbeitung wurde fortgesetzt und die Ausgabe wurde im JSON- oder HTML-Format gesendet.  Dann sahen die Benutzer, wonach sie suchten. </p><br><img src="https://habrastorage.org/webt/cw/l_/rn/cwl_rnema8zlhzfu4gnrrgrz1jq.jpeg"><br><h2 id="chto-u-nas-seychas">  Was wir jetzt haben </h2><br><p>  Wenn Sie neue Funktionen implementieren, ist die Integration in diesen Monolithen sehr schwierig.  Aus diesem Grund haben wir uns entschlossen, einen Suchdienst zu entwickeln, den wir "Gesucht" nannten.  Jetzt geht der Monolith zu diesem Suchdienst und der Dienst geht zu Sphinx. </p><br><img src="https://habrastorage.org/webt/wk/rf/up/wkrfupfza_kexfbo_yiafhq-lz4.jpeg"><br><h2 id="prichiny-sozdaniya-poiskovogo-servisa">  Gründe für die Erstellung eines Suchdienstes </h2><br><p>  Bei der Entwicklung von Diensten müssen Sie immer verstehen, warum Sie dies tun.  Das erste offensichtliche Plus ist das Entfernen der Logik auf niedriger Ebene.  In unserem Fall verbirgt dies die Küche für die Verarbeitung von SphinxQL-Abfragen.  Darüber hinaus können wir Suchsystemen für Systeme von Drittanbietern einfacher bereitstellen. </p><br><p>  Asynchrone Abfrageausführung.  Dieser Vorteil liegt auf der Hand und je nach Implementierung kann der eine oder andere Erfolg erzielt werden.  Unser Service wurde auf Golang implementiert und es gab Funktionen, die parallelisiert werden konnten - drei Anfragen in Sphinx, die zu guten Ergebnissen führten. </p><br><p>  Schnelle Bereitstellung.  Wir haben eine separate Funktion mit weniger Code und zusätzlichen Tests identifiziert (der Monolith verfügt über viele Tests, nicht nur Suchfunktionen), und die Einführung ist einfacher.  Vor allem konnten wir aufgrund eines erfolgreichen Ansatzes für die Implementierung dieses Dienstes interessante Dinge reduzieren und fortschrittliche Ranking-Algorithmen implementieren - um eine ziemlich komplizierte Verarbeitung durchzuführen, die wir in einem Monolithen nicht durchführen konnten.  Dies bietet uns eine sehr gute Grundlage für das Experimentieren mit der Suchqualität. </p><br><p>  Als Bonus haben wir die Möglichkeit, von Sphinx zu Elastic zu wechseln, da die Logik auf niedriger Ebene jetzt verborgen ist. </p><br><p>  Dieses Diagramm zeigt bereits den Fall eines Monolithen, des Dienstes "Gesucht" und des Drittanbieter-Dienstes "Avito-Assistent". </p><br><img src="https://habrastorage.org/webt/ed/3s/ws/ed3swsgnqulgqx9lokpg6l4po8g.jpeg"><br><h2 id="kak-rabotaet-poiskovyy-servis">  Wie funktioniert ein Suchdienst? </h2><br><p>  Es hat eine Reihe von Aggregatoren.  Jeder Aggregator führt eine bestimmte Geschäftslogik aus, die sich auf die Verarbeitung der Ausgabe bezieht.  Er kann dieses Thema auf eine bestimmte Weise gestalten. </p><br><p>  Die Anfrage kommt beim Scheduler an.  Der Scheduler wählt den Aggregator gemäß den Abfragekriterien hinsichtlich seiner Parameter aus (oder wenn der gewünschte Aggregator in der Anforderung selbst angegeben ist).  Aggregator geht zur Sphinx.  Nachdem eine Antwort von Sphinx erhalten wurde, wird eine Ausgabe generiert und die Antwort an den Client weitergegeben. </p><br><img src="https://habrastorage.org/webt/f9/56/lj/f956ljoot6y6pas3k94vkb8bo3k.gif"><br><p>  In diesem Fall war die Anfrage außerhalb und nicht aus der Cloud, in der unser Suchdienst arbeitet.  Es ist aber auch eine andere Option möglich: Einige andere unserer Dienste in der Cloud, z. B. Avito Assistant, wenden sich an einen Suchdienst.  Diese Anfrage geht bereits an einen anderen Aggregator - es gibt eine andere Geschäftslogik.  So funktioniert es: </p><br><img src="https://habrastorage.org/webt/vb/gb/yu/vbgbyukk8a5yynkv5kupow23s6y.gif"><br><h2 id="kak-rabotaet-asinhronnoe-vypolnenie-zaprosov-na-agregatore">  Funktionsweise der asynchronen Abfrageausführung auf dem Aggregator </h2><br><p>  Der Aggregator besteht aus mehreren Profilen.  Ein Profil ist grob gesagt eine Entität, in der Sie eine Ankündigung eines bestimmten Typs oder auf eine bestimmte Art und Weise erhalten können.  Dies kann zum Beispiel durch eine Analogie erklärt werden: Es gibt "Premium" -, "VIP" - und reguläre Anzeigen auf Avito.  Der Aggregator empfängt eine Anforderung vom Scheduler, während parallele Anforderungen für den im Aggregator bekannten Profilsatz ausgeführt werden.  Das Profil enthält einen Treiber, der physisch auf die zugrunde liegende Ebene zugreift, in diesem Fall in Sphinx. Es kann sich jedoch auch um eine andere Datenquelle handeln </p><br><img src="https://habrastorage.org/webt/la/np/ic/lanpiclts0oo-uhfktoxszkxl3g.jpeg"><br><p>  Der Aggregator kann dem Scheduler einfach die Ergebnisse von Abfragen an die Profile geben und auch komplexere Aktionen ausführen, z. B. diese Ergebnisse mit dem einen oder anderen Algorithmus mischen. </p><br><img src="https://habrastorage.org/webt/zy/_o/ji/zy_ojiffyfpbt4h9vmkcyciqsuy.jpeg"><br><h2 id="hranenie-poiskovogo-indeksa">  Indexspeicher durchsuchen </h2><br><p>  Aufgrund der Tatsache, dass wir Kubernetes in der Architektur verwenden, wurde mir bei RIT ++ eine Frage zum Speichern des Suchindex gestellt - wird dieser in Kubernetes gespeichert?  Nein, wir haben Sphinx, die auf physischen Maschinen lebt.  Bei Kubernetes stellen wir einen Suchdienst bereit, der die Suchlogik verarbeitet.  Die Cloud enthält auch einen Beispielsuchindex für die Entwicklungsumgebung, in der Tests ausgeführt werden. Es ist jedoch unerwünscht, dort einen Kampfindex zu platzieren, da es sich bei den in Kubernetes funktionierenden Diensten in erster Linie um zustandslose Dienste handelt. </p><br><h2 id="nagruzka-na-poiskovyy-servis">  Suchdienst laden </h2><br><p>  Jetzt ist dieser Dienst im Kampf, er dient mit wenigen Ausnahmen 100% der Last.  Die Last, die er hält, beträgt ungefähr 200 krpm.  Verzögerung: Median - bis zu 17 ms, 95 Perzentil - bis zu 120 ms, 99 Perzentil - bis zu 320 ms. </p><br><img src="https://habrastorage.org/webt/bt/46/ny/bt46nyowpcuqysikxjcpp2weov8.png"><br><img src="https://habrastorage.org/webt/bn/fj/hx/bnfjhx1hqse5b4lfok8cgv3ez04.png"><br><h2 id="itogo-po-poiskovomu-servisu">  Gesamtsuchdienst </h2><br><p>  Der Suchdienst ist in Golang geschrieben und für Kubernetes bereitgestellt. Der Aggregator arbeitet asynchron mit mehreren Profilen.  Das Profil funktioniert mit dem angegebenen Treiber, der Treiber greift auf die angegebene Datenquelle zu, z. B. Sphinx.  Die Anzahl der Anfragen, die unser Service bearbeitet, beträgt derzeit bis zu 200 krpm.  Verzögerung: Median - bis zu 17 ms, 95 Perzentil - bis zu 120 ms, 99 Perzentil - bis zu 320 ms. </p><br><h2 id="vnedrenie-servisa-v-rabochuyu-sistemu">  Implementierung des Dienstes in einem funktionierenden System </h2><br><p>  Das Problem der doppelten Funktionalität liegt auf der Hand. Wir müssen zwei Codebasen unterstützen, die dieselbe Aufgabe ausführen müssen.  Wir brauchen einen Fallback.  Wir nannten es "Strohhalme" - wir erinnerten uns an "Strohhalme".  Darüber hinaus benötigen wir eine Verkehrskontrolle. Es ist wünschenswert, dass diese über ein Dashboard schnell ist. </p><br><h2 id="kak-rabotaet-solomka">  Wie funktioniert der "Strohhalm" </h2><br><p>  Die Suchabfrage kommt zum „Strohhalm“, der innerhalb des Monolithen funktioniert und entweder eine neue oder eine alte Suche aufrufen kann.  Sie ruft eine neue Suche an, er erfüllt sie, und wenn sie erfolgreich ist, erhalten wir nur das Ergebnis einer neuen Suche. </p><br><img src="https://habrastorage.org/webt/y1/xa/wm/y1xawmqms1bxqtotevfsl7bfatu.gif"><br><p>  Es gibt Situationen, in denen eine Abfrage an den Suchdienst fehlschlägt: Zum Beispiel und bis eine bestimmte Funktionalität im Suchdienst implementiert ist.  Dann versprechen wir unbedingt eine solche Anfrage - "The Straw" wird sie in der alten Suche ausführen.  Die alte Suche des Monolithen wird an Sphinx weitergeleitet, und die Antwort geht an den Kunden.  Der Kunde wird nichts fühlen. </p><br><img src="https://habrastorage.org/webt/cr/zu/za/crzuzaufpka6dvpjsjy_m5qq0jc.gif"><br><p>  Ein ziemlich zuverlässiges Schema, und es ist immer interessant zu sehen, was in der Praxis passiert.  Die Architekturabteilung von Avito verbessert unsere Cloud ständig, optimiert sie und macht sie zuverlässiger und produktiver.  Irgendwann gab es Probleme, dass bei der Wartung eines der Knoten mit einer ausreichend hohen Intensität Fehler vom Monolithen kamen (100 Fehler pro Sekunde). </p><br><img src="https://habrastorage.org/webt/tu/zv/wm/tuzvwmgmpzid5objz-4bmvl157y.png"><br><p>  Gleichzeitig hat sich die Serviceverzögerung stark erhöht - im Bild unten sehen Sie Spitzen. </p><br><img src="https://habrastorage.org/webt/pq/of/z5/pqofz5fynz2bsibynewd3gro2cw.png"><br><p>  Der „Strohhalm“ hat diese Situation bemerkenswert gelöst, und die daraus resultierenden HTTP-Fehler waren auf dem gleichen Niveau - eine Fehlereinheit für den gesamten Avito.  Unsere Besucher haben nichts bemerkt. </p><br><img src="https://habrastorage.org/webt/wx/ya/ij/wxyaij2xka5dhghoa74ovncverq.png"><br><h2 id="avtomatizaciya-eksperimentov">  Experimentautomatisierung </h2><br><p>  Wir möchten, dass sich die Suche schnell entwickelt und die Einführung neuer Funktionen einfacher wurde.  Hierzu wird eine entsprechende Infrastruktur benötigt.  Wir haben die Automatisierung von A / B-Tests konfiguriert.  Über das Dashboard können wir neue Experimente starten, sie basierend auf den hinzugefügten Innovationen konfigurieren und dementsprechend Experimente ausführen, ohne den Monolithen zu rollen. </p><br><p>  Im Ausgangszustand, wenn kein einziges Experiment gestartet wurde, sehen alle Besucher die üblichen Suchfunktionen. </p><br><img src="https://habrastorage.org/webt/go/rz/qp/gorzqpca1whra33-df1c6ss18yk.jpeg"><br><p>  In einem typischen Experiment werden Benutzer in Gruppen eingeteilt.  Die Kontrollgruppe - mit der für unsere Besucher üblichen Funktionalität.  Es gibt mehrere Testgruppen - mit Innovationen.  Wenn wir ein neues Experiment erstellen müssen, implementieren wir im Suchdienst eine neue Suchfunktion (neue Aggregatoren hinzufügen) und richten das Experiment über das Dashboard mit den erforderlichen Gruppen ein und verknüpfen sie mit neuen Aggregatoren. </p><br><p>  Bei der Analyse von Experimenten vergleichen wir das Verhalten der Besucher in der Kontrollgruppe mit denen der Testgruppe und ziehen daraus Schlussfolgerungen über den Erfolg des Experiments. </p><br><img src="https://habrastorage.org/webt/gd/g5/r2/gdg5r20saoh4inq46d5jggjcxee.gif"><br><p>  Angenommen, wir haben eine neue Ranking-Formel entwickelt.  Was müssen wir tun, um mit ihr zu experimentieren? </p><br><ol><li>  Rollen Sie im Suchdienst den entsprechenden Aggregator ein (sei es "Aggregator 2"). </li><li>  Erstellen Sie ein Experiment über ein Dashboard und verbinden Sie eine der Gruppen in diesem Experiment mit diesem Aggregator. </li><li>  Wenn nun eine Abfrage in der Suche eintrifft, die in die Testgruppe fällt, wird sie an den Suchdienst unter "Aggregator 2" weitergeleitet. </li></ol><br><p>  Wir können weiterhin neue Experimente erstellen und ihre Testgruppen neuen Aggregatoren zuordnen. </p><br><h1 id="itogo-po-infrastrukture-poiska">  Gesamte Suchinfrastruktur </h1><br><p>  Es gibt einen Cluster von Sphinx 3-Servern mit 13 krps SphinxQL-Abfragen und mehr als 45 Millionen aktiven Anzeigen. </p><br><p>  Sphinx 3.0 ist stabil und gefällt mit seiner Leistung.  Binärdateien sind übrigens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gemeinfrei</a> .  Dank Avito werden in Sphinx 3 außerdem neue Funktionen gefilmt, z. B. die Funktionsweise des Skalarprodukts von Vektoren, und gefundene Fehler werden behoben. </p><br><p>  Wir verwenden Service-Architektur.  Wir haben den Suchdienst "Iskalo" und den Dienst "Avito Assistant".  Ein Teil der Funktionalität ist im Monolithen geblieben, aber wir arbeiten weiter an seinem Schneiden. </p><br><h1 id="vyvody">  Schlussfolgerungen </h1><br><p>  Im vergangenen Jahr wurde ein erweitertes Entwicklungssystem für Suchfunktionen erhalten.  Wir hatten die Möglichkeit, schnelle und flexible Experimente durchzuführen.  Und jetzt ist die Suche nach Benutzern bequemer, schneller und hilft besser, ihre Probleme zu lösen. </p><br><h1 id="chto-dalshe">  Was weiter </h1><br><p>  Außerdem werden wir weiterhin das, was übrig bleibt, aus dem Monolithen entfernen: Rendering, Filter.  Wir werden daran arbeiten, die Qualität der Suche zu verbessern und unsere Besucher weiterhin zu begeistern.  Hoffe du auch. </p><br><p>  Wenn Sie Fragen zur Arbeit unserer Suche haben, möchten wir weitere technische Details erfahren, schreiben Sie in die Kommentare.  Ich werde gerne antworten.  Übrigens sprach Andrey Drozdov kürzlich auf der Highload ++ 2018 mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bericht über die Optimierung der Suchergebnisse nach mehreren Kriterien.</a> Hier ist seine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Präsentation</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429076/">https://habr.com/ru/post/de429076/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429066/index.html">Wie sich die Flugzeugbesatzung auf den Abflug vorbereitet</a></li>
<li><a href="../de429068/index.html">Ein sehr korporativer Beitrag: Eröffnung in Moskau oder warum der 10. und 11. November gute Tage sind, um Elektronik zu kaufen</a></li>
<li><a href="../de429070/index.html">Linux kann aufgrund des T2-Chips nicht auf neue MacBooks geladen werden</a></li>
<li><a href="../de429072/index.html">Warum Kodak starb und Fujifilm aufblühte: die Geschichte zweier Filmemacher</a></li>
<li><a href="../de429074/index.html">Gute Taten für Google Money: Neue AI Impact Challenge</a></li>
<li><a href="../de429078/index.html">So erstellen Sie prozedurale Kunst in weniger als 100 Codezeilen</a></li>
<li><a href="../de429082/index.html">Thailand ohne Stereotypen</a></li>
<li><a href="../de429084/index.html">Das zweite Leben des Elektroofens "Kharkov"</a></li>
<li><a href="../de429086/index.html">Backup Bierparty</a></li>
<li><a href="../de429088/index.html">Ausführen von GraphQL-Abfragen mit OdataToEntity</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>