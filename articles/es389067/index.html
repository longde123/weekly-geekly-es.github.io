<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Equipo inal谩mbrico NooLite y Smart Home (Parte 1). Arduino 锔  </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola queridos lectores de Geektimes! Esta vez quiero llamar su atenci贸n sobre una serie de art铆culos sobre la integraci贸n del equipo inal谩mbrico nooLi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Equipo inal谩mbrico NooLite y Smart Home (Parte 1). Arduino</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/389067/"><img src="https://habrastorage.org/files/d8c/f00/38e/d8cf0038e7a040fe8e07446481c0a1a0.jpg" alt="nooLite"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hola queridos lectores de Geektimes! </font><font style="vertical-align: inherit;">Esta vez quiero llamar su atenci贸n sobre una serie de art铆culos sobre la integraci贸n del equipo inal谩mbrico </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nooLite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> en los sistemas de automatizaci贸n del hogar. </font><font style="vertical-align: inherit;">Este ciclo ser谩 similar a la serie de art铆culos ya publicados ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uno</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dos</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tres</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) sobre la integraci贸n de los m贸dulos Laurent en los sistemas Smart Home, solo hablar谩 sobre el sistema nooLite y despu茅s de leer este ciclo no tendr谩 preguntas sobre la administraci贸n de dispositivos nooLite desde su Smart en casa</font></font><br>
<a name="habracut"></a><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre la serie de art铆culos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El ciclo se divide en tres partes. En la primera parte, aprender谩 sobre los principios de funcionamiento del equipo inal谩mbrico nooLite y c贸mo administrarlo desde sus proyectos Arduino. La </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segunda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parte describir谩 en detalle sobre la integraci贸n del m贸dulo de control MT1132 en el Mega Servidor Arduino y sobre las posibilidades para administrar un Smart Home que se est谩n abriendo en esta conexi贸n. Y el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tercer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> art铆culo de la serie estar谩 dedicado a un tema muy interesante: el concepto de crear dispositivos "100 en 1" basados en el Mega Servidor Arduino. Se examinar谩 en detalle un ejemplo de la creaci贸n de una estaci贸n de soldadura inal谩mbrica en AMS, literalmente de la nada, basado en un solo d铆mero inal谩mbrico nooLite. Tambi茅n habr谩 una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuarta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parte a partir de la cual aprender谩s a crear un cristal m谩gico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por cierto, la estaci贸n de soldadura, que se discutir谩 en el tercer art铆culo, ya est谩 presente en el 煤ltimo ensamblaje de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con el n煤mero 0.14. </font><font style="vertical-align: inherit;">Y los lectores m谩s curiosos no pueden esperar al tercer art铆culo, sino que descargan inmediatamente el kit de distribuci贸n y descubren c贸mo funciona todo por su cuenta. </font></font><br>
<br>
<img src="https://habrastorage.org/files/428/a18/eeb/428a18eeb1f84623bc6c9f8d59e08974.jpg" alt="estaci贸n de soldadura"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y lo mejor es que puede haber cientos de dispositivos de este tipo en AMS, y al mismo tiempo. </font><font style="vertical-align: inherit;">Por ejemplo, una estaci贸n de soldadura, una estaci贸n meteorol贸gica, una unidad de seguridad, un controlador de invernadero, etc. Y todo esto puede funcionar simult谩neamente o "arrancar" cargando una p谩gina web o incluso un sitio completo dedicado a un dispositivo espec铆fico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no nos adelantemos, dejemos lo m谩s interesante al final, pero por ahora haremos la preparaci贸n te贸rica necesaria. </font><font style="vertical-align: inherit;">Prometo que todo se expresar谩 de la manera m谩s simple e inteligible. </font><font style="vertical-align: inherit;">Entonces comencemos.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipo NooLite</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo NooLite ya es un sistema conocido y popular y hay mucha informaci贸n al respecto en Internet. </font><font style="vertical-align: inherit;">Tratar茅 de resumir los puntos principales aqu铆. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El concepto es muy simple: hay unidades de potencia para controlar la luz y varias cargas, y paneles de control que env铆an comandos a estas unidades de potencia. </font><font style="vertical-align: inherit;">Y todo esto funciona, naturalmente, sin la participaci贸n de conexiones por cable. </font><font style="vertical-align: inherit;">En realidad todo. </font><font style="vertical-align: inherit;">La belleza del sistema es que todos los componentes est谩n pensados, bien hechos y hacen exactamente lo que dice: controlan de manera confiable el equipo conectado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi茅n hay sensores inal谩mbricos, control de dispositivos desde un tel茅fono inteligente y mucho m谩s, pero es imposible cubrir todo en un art铆culo, aqu铆 nos centraremos solo en la integraci贸n de nooLite con la popular plataforma de bricolaje: Arduino.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De todo el amplio espectro de equipos nooLite, estaremos interesados en el m贸dulo de control MT1132 porque est谩 dise帽ado para conectarse a computadoras Arduino y de placa 煤nica como Raspberry Pi. Y funciona en una interfaz serial simple. Mirando hacia el futuro un poco, dir茅 que me gust贸 el m贸dulo debido a su simplicidad, previsibilidad y operaci贸n confiable. Y pude apreciar estas cualidades despu茅s de un mes de lucha infructuosa con el m贸dulo de red en el chip W5500, que no quer铆a funcionar normalmente. </font></font><br>
<br>
<img src="https://habrastorage.org/files/af4/5a9/4dc/af45a94dc2684467920e9191ebcafc83.jpg" alt="M贸dulo MT1132"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y me gust贸 especialmente el hecho de que (aparte de la fuente de alimentaci贸n) el m贸dulo est谩 conectado al Arduino con solo un (!) Cable (RX). El segundo (TX) se puede omitir por completo. El m贸dulo es "unidireccional", es decir, est谩 dise帽ado solo para enviar se帽ales de control. Los planes de la compa帽铆a Nootehnika incluyen el desarrollo y lanzamiento de una versi贸n "bidireccional" del m贸dulo.</font></font><br>
<br>
<img src="https://habrastorage.org/files/60c/dfb/d07/60cdfbd0709b41b88b19a00638637d59.jpg" alt="SU111-300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El segundo elemento que necesitamos del equipo nooLite es una unidad de control de potencia, por ejemplo, SU111-300. La conexi贸n de la unidad es elemental y se puede ver en la ilustraci贸n. Dos cables est谩n conectados a una red de 220 voltios, y los otros dos a la carga. Lo 煤nico a lo que me gustar铆a prestar atenci贸n es que los m贸dulos se suministran con un puente que bloquea el modo de atenuaci贸n y, si desea ajustar la potencia, debe cortar este puente (y recuerde aislar los cables pelados resultantes).</font></font><br>
<br>
<img src="https://habrastorage.org/files/acf/cd5/4ad/acfcd54ad9ab4c57bf6409799dd3a133.jpg" alt="PU311-2"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No me detendr茅 en los controles remotos porque este es un control "manual", y nosotros, en relaci贸n con la automatizaci贸n, estamos m谩s interesados en la autom谩tica. </font><font style="vertical-align: inherit;">Solo puedo decir que los experimentos se llevaron a cabo con el control remoto PU311-2, hecho en forma de un interruptor de pared y se mostr贸 de la mejor manera, es decir, encendi贸 y apag贸 la luz claramente y sin fallas. </font><font style="vertical-align: inherit;">Lo que, de hecho, es un buen equipo y diferente del malo, simplemente no se nota bien.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Concepto de trabajo. </font><font style="vertical-align: inherit;">Enlace y desvinculaci贸n</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de poder encender y apagar los aparatos el茅ctricos con el sistema nooLite, debe "vincular" los m贸dulos de control a las unidades de potencia correspondientes. Esto se hace utilizando el llamado procedimiento. "Enlaces" y "desvinculaci贸n", descritos en detalle en la documentaci贸n de nooLite. En resumen, todo se reduce a presionar un par de botones en los bloques vinculados y no presenta ninguna dificultad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el caso de que se use el m贸dulo de control MT1132 en lugar del control remoto, el procedimiento ocurre de una manera ligeramente diferente. A saber: dado que el m贸dulo no tiene botones, debe generar y enviar mediante programaci贸n un comando de control en el canal deseado, y luego presionar el bot贸n en la unidad de alimentaci贸n, confirmando el "enlace" o "desvinculaci贸n".</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los canales son "l铆neas de control" y hay 32 de ellos en el m贸dulo MT1132, como lo demuestran los dos 煤ltimos d铆gitos del nombre. </font><font style="vertical-align: inherit;">Esto significa que con este m贸dulo puede administrar 32 grupos separados de equipos, lo que es m谩s que suficiente para un apartamento o una casa peque帽a. </font><font style="vertical-align: inherit;">Si tiene una casa grande, entonces los m贸dulos pueden trabajar en conjunto y escalar a cualquier n煤mero de canales.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci贸n del protocolo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documento</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> maravilloso </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">en el</font></a><font style="vertical-align: inherit;"> sitio web de la compa帽铆a Nootehnika </font><font style="vertical-align: inherit;">que describe de manera exhaustiva y detallada la conexi贸n del m贸dulo y su protocolo de control. </font><font style="vertical-align: inherit;">No saturar茅 el art铆culo con detalles t茅cnicos innecesarios, cualquiera puede leer este documento, solo describir茅 los puntos principales. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para controlar el m贸dulo, necesitamos formar un comando de control que consta de 12 bytes. </font><font style="vertical-align: inherit;">Los principios para la formaci贸n de este equipo se describen en el documento anterior. </font><font style="vertical-align: inherit;">Y como ver谩 a continuaci贸n, todas estas reglas ya est谩n programadas en las funciones de control y solo necesitamos usarlas para emitir comandos al m贸dulo.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Equipos de prueba</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
nooLite tiene un sistema de comando bastante desarrollado, desde el cual seleccionaremos los m谩s simples y m谩s comunes e ilustraremos el sistema usando su ejemplo.</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Snap</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Desatar</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inclusi贸n</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apagado</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajuste de potencia (atenuaci贸n)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Al comprender c贸mo funcionan los equipos b谩sicos, puede usar f谩cilmente cualquier otro.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conexi贸n del m贸dulo MT1132</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como ya dije, el m贸dulo MT1132 est谩 conectado literalmente con un cable (a excepci贸n de la alimentaci贸n). </font><font style="vertical-align: inherit;">El m贸dulo puede ser alimentado por un voltaje de 5 voltios y un voltaje de 3,3 voltios. </font><font style="vertical-align: inherit;">Por lo tanto, no hubo problemas para conectarse al Arduino Mega de 5 voltios o al Arduino Due de 3,3 voltios. </font><font style="vertical-align: inherit;">El 煤nico punto es que con una potencia reducida, el rango de operaci贸n confiable del sistema disminuye. </font><font style="vertical-align: inherit;">Y esto debe tenerse en cuenta si desea alimentar el m贸dulo desde un voltaje de 3,3 voltios.</font></font><br>
<br>
<img src="https://habrastorage.org/files/fb8/2a4/d76/fb82a4d769cb49bda099e57591c13157.jpg" alt="Arduino"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m贸dulo tiene pines RX y TX para recibir y enviar se帽ales a trav茅s de la interfaz en serie. </font><font style="vertical-align: inherit;">Para la operaci贸n del m贸dulo, es fundamental la conexi贸n de RX, para recibir comandos de control del controlador. </font><font style="vertical-align: inherit;">En consecuencia, el pin RX en el lado del m贸dulo est谩 conectado al pin TX (18) en el lado Arduino. </font><font style="vertical-align: inherit;">Este pinout es v谩lido tanto para Arduino Mega como para Arduino Due.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parte de software</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora veamos c贸mo gestionar toda esta econom铆a a partir de bocetos en Arduino. </font><font style="vertical-align: inherit;">Primero, inicialice Serial1, al que conectamos el m贸dulo MT1132 (esto se hace a la frecuencia est谩ndar 9600):</font></font><br>
<br>
<pre><code class="java hljs">Serial1.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora el c贸digo de la funci贸n de control principal:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooSendCommand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> channel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> command, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> format)</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> buf[<span class="hljs-number"><span class="hljs-number">12</span></span>];<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">12</span></span>; i++) {<font></font>
    buf[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
  }<font></font>
<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">85</span></span>;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">1</span></span>] = B01010000;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">2</span></span>] = command;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">3</span></span>] = format;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">5</span></span>] = channel;<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">6</span></span>] = data;<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> checkSum = <span class="hljs-number"><span class="hljs-number">0</span></span>;
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) {<font></font>
    checkSum += buf[i];<font></font>
  }<font></font>
<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">10</span></span>] = lowByte(checkSum);<font></font>
  buf[<span class="hljs-number"><span class="hljs-number">11</span></span>] = <span class="hljs-number"><span class="hljs-number">170</span></span>;<font></font>
<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-number"><span class="hljs-number">12</span></span>); i++) {<font></font>
    Serial1.write(buf[i]);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En principio, ni siquiera necesitamos saber c贸mo funciona, podemos usarlo en el modo de "recuadro negro" o en una especie de API, con cierta interfaz sobresaliendo. </font><font style="vertical-align: inherit;">Solo necesitamos saber c贸mo usar esta interfaz. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, solo hay cuatro par谩metros: canal, comando, datos y formato. </font><font style="vertical-align: inherit;">Puede leer por qu茅 principio las solicitudes a esta API se pueden leer en el documento mencionado anteriormente, pero simplificaremos a煤n m谩s nuestra tarea y envolveremos esta interfaz en comandos simples de control de dispositivos nooLite.</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooBind</span></span></span><span class="hljs-function">  </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooUnbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooOn</span></span></span><span class="hljs-function">    </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooOff</span></span></span><span class="hljs-function">   </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch)</span></span></span><span class="hljs-function">         </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);}
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nooValue</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ch, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> v)</span></span></span><span class="hljs-function"> </span></span>{nooSendCommand(ch,  <span class="hljs-number"><span class="hljs-number">6</span></span>, v, <span class="hljs-number"><span class="hljs-number">1</span></span>);}
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El equipo relativamente complejo es solo el 煤ltimo, all铆, adem谩s del canal, tambi茅n se establece el nivel de potencia. </font><font style="vertical-align: inherit;">Tambi茅n hay equipos en el bosquejo en los que no nos detendremos ahora, pero se forman con la misma facilidad. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En realidad ... eso es todo! </font><font style="vertical-align: inherit;">En ninguna parte es m谩s f谩cil. </font><font style="vertical-align: inherit;">En el c贸digo, los comandos de control se ven as铆:</font></font><br>
<br>
<pre><code class="java hljs">nooBind(ch);<font></font>
nooUnbind(ch);<font></font>
nooOn(ch);<font></font>
nooOff(ch);<font></font>
nooValue(ch, v);<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ahora practiquemos la pr谩ctica de la gesti贸n del m贸dulo de potencia nooLite. </font><font style="vertical-align: inherit;">Entonces, vinculamos el bloque de alimentaci贸n en el canal cero:</font></font><br>
<br>
<pre><code class="java hljs">nooBind(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El LED de la unidad de alimentaci贸n comienza a parpadear. </font><font style="vertical-align: inherit;">Presione el bot贸n en el bloque; el LED deja de parpadear; el bloque de alimentaci贸n est谩 conectado. </font><font style="vertical-align: inherit;">En lugar del canal cero, puede usar cualquier otro. </font><font style="vertical-align: inherit;">Y puede generar f谩cilmente el n煤mero de canal en el c贸digo de croquis seg煤n sus necesidades. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encienda la l谩mpara (si atamos la l谩mpara en el canal cero, entonces los comandos para ello deben enviarse en este canal):</font></font><br>
<br>
<pre><code class="java hljs">nooOn(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Configure la potencia (brillo de la l谩mpara):</font></font><br>
<br>
<pre><code class="java hljs">nooValue(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 debes decir un poco sobre las reglas para formar un equipo que establezca el nivel de poder. El valor de potencia no cambia de 0 a 255, como podr铆a pensarse, sino de 35 a 155. Si el valor es superior a 155, entonces la potencia ser谩 m谩xima, si es 0, esto ser谩 equivalente a un comando de apagado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 (por si acaso) una f贸rmula que traduce valores "est谩ndar" de 0 a 100 en un formato comprendido por el m贸dulo nooLite:</font></font><br>
<br>
<pre><code class="java hljs">v = x * <span class="hljs-number"><span class="hljs-number">1.2</span></span> + <span class="hljs-number"><span class="hljs-number">34</span></span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con esta f贸rmula, puede establecer el brillo de la l谩mpara en el porcentaje de potencia habitual. </font><font style="vertical-align: inherit;">Y, por supuesto, si necesita ajustar la potencia de forma no lineal, puede crear una variable v de acuerdo con cualquier ley o incluso simplemente elegir valores fijos. </font><font style="vertical-align: inherit;">Esto se discutir谩 en la tercera parte del ciclo, cuando ajustaremos la temperatura de calentamiento de la estaci贸n de soldadura. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Apaga el dispositivo:</font></font><br>
<br>
<pre><code class="java hljs">nooOff(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Desatar:</font></font><br>
<br>
<pre><code class="java hljs">nooUnbind(<span class="hljs-number"><span class="hljs-number">0</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El LED de la unidad de alimentaci贸n comienza a parpadear. </font><font style="vertical-align: inherit;">Confirmamos el desacoplamiento presionando el bot贸n de la unidad de potencia. </font><font style="vertical-align: inherit;">Eso es todo, ahora la unidad de alimentaci贸n ha dejado de responder a nuestros comandos y podemos "ajustarla" nuevamente en cualquiera de los 32 canales del m贸dulo nooLite MT1132. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu铆 est谩 el boceto completo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C贸digo de boceto completo</font></font></b><div class="spoiler_text">byte const PIN_TX = 18; // TX PIN (to RX noolite)<br>
byte const PIN_RX = 19; // RX PIN (to TX noolite)<br>
<br>
void nooSendCommand(byte channel, byte command, byte data, byte format) {<br>
 byte buf[12];<br>
<br>
for (byte i = 0; i &lt; 12; i++) {<br>
 buf[i] = 0;<br>
 }<br>
<br>
buf[0] = 85;<br>
 buf[1] = B01010000;<br>
 buf[2] = command;<br>
 buf[3] = format;<br>
 buf[5] = channel;<br>
 buf[6] = data;<br>
<br>
int checkSum = 0;<br>
 for (byte i = 0; i &lt; 10; i++) {<br>
 checkSum += buf[i];<br>
 }<br>
<br>
buf[10] = lowByte(checkSum);<br>
 buf[11] = 170;<br>
<br>
for (byte i = 0; i &lt; (12); i++) {<br>
 Serial1.write(buf[i]);<br>
 }<br>
}<br>
<br>
void nooBind (byte ch) {nooSendCommand(ch, 15, 0, 0);}<br>
void nooUnbind (byte ch) {nooSendCommand(ch, 9, 0, 0);}<br>
<br>
void nooOn (byte ch) {nooSendCommand(ch, 2, 0, 0);}<br>
void nooOff (byte ch) {nooSendCommand(ch, 0, 0, 0);}<br>
void nooTrigger(byte ch) {nooSendCommand(ch, 4, 0, 0);}<br>
void nooCancel (byte ch) {nooSendCommand(ch, 10, 0, 0);}<br>
<br>
void nooUp (byte ch) {nooSendCommand(ch, 3, 0, 0);}<br>
void nooDown (byte ch) {nooSendCommand(ch, 1, 0, 0);}<br>
void nooRevers (byte ch) {nooSendCommand(ch, 5, 0, 0);}<br>
<br>
void nooValue (byte ch, byte v) {nooSendCommand(ch, 6, v, 1);}<br>
<br>
void setup() {<br>
 Serial1.begin(9600);<br>
<br>
/*     <br>
      loop(),    */<br>
<br>
//nooBind(0);<br>
<br>
//nooOn(0);<br>
 //nooOff(0);<br>
 //nooValue(0, 100);<br>
<br>
//nooUnbind(0); <br>
}<br>
<br>
void loop(){<br>
<br>
}<br>
</div></div><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Subtotal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como puede ver, </font><font style="vertical-align: inherit;">no hay nada complicado </font><font style="vertical-align: inherit;">en el control de los m贸dulos de potencia </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nooLite</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> utilizando Arduino, por el contrario, el control es fenomenalmente simple: el m贸dulo est谩 conectado con un cable y los comandos son casi un lenguaje humano natural: "encienda el canal 0", "apague el canal 1", "Establecer la potencia del 50% en el canal 3" en realidad no es nada m谩s simple.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bono para aquellos que han le铆do hasta el final</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Justo el otro d铆a, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se lanz贸</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una nueva versi贸n de </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;">Arduino Mega Server</font></a><font style="vertical-align: inherit;"> en el n煤mero 0.14, en la que se superaron todas las enfermedades infantiles de la tecnolog铆a y que funciona de manera r谩pida y estable. </font><font style="vertical-align: inherit;">Y la misma versi贸n contiene el n煤cleo de control integrado del instrumento nooLite y c贸mo funciona todo, aprender谩 del siguiente art铆culo de la serie Equipo inal谩mbrico nooLite y Smart Home (Parte 2). </font><font style="vertical-align: inherit;">Arduino Mega Server ". </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La segunda</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tercera</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cuarta</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> partes del ciclo.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es389067/">https://habr.com/ru/post/es389067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es389051/index.html">CNET Smart Home: campo de prueba de gadgets</a></li>
<li><a href="../es389053/index.html">Casa inteligente. Cerebros</a></li>
<li><a href="../es389057/index.html">CES 2016: anuncios de LG y Samsung para el hogar inteligente</a></li>
<li><a href="../es389063/index.html">C贸mo los coches cuadrados de los 80 se racionalizaron en los 90</a></li>
<li><a href="../es389065/index.html">La sonda Dawn envi贸 im谩genes detalladas de los cr谩teres de Ceres</a></li>
<li><a href="../es389069/index.html">Remix OS, un sistema operativo de m煤ltiples ventanas basado en Android, ahora est谩 disponible para PC</a></li>
<li><a href="../es389071/index.html">Interferencia en los sistemas mundiales de navegaci贸n por sat茅lite.</a></li>
<li><a href="../es389073/index.html">Branto ORB: una bola casi m谩gica para controlar tu hogar</a></li>
<li><a href="../es389075/index.html">邪锌芯写邪卸邪 胁 小邪泄 芯胁泄 谐芯写</a></li>
<li><a href="../es389077/index.html">Fundador de Oculus: la PC de baja potencia es el principal obst谩culo para la popularizaci贸n de la realidad virtual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>