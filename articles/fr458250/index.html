<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÜüèø üåï üë®‚Äç‚ù§Ô∏è‚Äçüë® BTRFS pour les plus petits ü§≠ üì© üï∂Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Khabravchane. Je travaille chez Veeam Software et je suis l'un des d√©veloppeurs de notre solution de sauvegarde Linux. Par occupation, il m'e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>BTRFS pour les plus petits</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/veeam/blog/458250/"> Bonjour, Khabravchane.  Je travaille chez Veeam Software et je suis l'un des d√©veloppeurs de notre solution de sauvegarde Linux.  Par occupation, il m'est arriv√© de rencontrer BTRFS.  Plus r√©cemment, il est pass√© du statut ¬´pas encore adapt√©¬ª au statut ¬´stable¬ª.  Et tandis que ses premiers utilisateurs sur le r√©seau discutaient des probl√®mes et des probl√®mes de stabilit√©, nous, chez Veeam, l'avons pouss√© avec une baguette et avons essay√© de le sauvegarder.  Il s'est av√©r√©, pour ne pas dire grand-chose - c'est trop diff√©rent, pas comme les syst√®mes de fichiers traditionnels.  J'ai d√ª √©tudier de nombreux aspects et collecter beaucoup de r√¢teaux avant d'apprendre √† travailler avec.  Dans le processus d'apprentissage, BTRFS a r√©ussi √† m'impressionner, √† la fois dans le bon sens et moins.  Je suis s√ªr qu'elle ne laissera indiff√©rent aucun sp√©cialiste informatique du monde Linux: certains cracheront, d'autres feront l'√©loge. <br><br>  Si vous avez entendu parler de ce syst√®me de fichiers, mais que vous ne savez pas pourquoi il est int√©ress√© par les d√©tails ou que vous cherchez o√π commencer √† le conna√Ætre, je vous invite √† chatter. <br><a name="habracut"></a><br><h1>  Pr√©sentation </h1><br>  BTRFS (B-Tree Filesystem) - syst√®me de fichiers pour les syst√®mes d'exploitation de type Unix, bas√© sur la technique Copy on Write (CoW), con√ßu pour fournir une facilit√© de mise √† l'√©chelle du syst√®me de fichiers, un degr√© √©lev√© de fiabilit√© et de s√©curit√© des donn√©es, une flexibilit√© de configuration et une facilit√© d'administration, tout en maintenant en m√™me temps √† grande vitesse.  C'est du moins ce que dit la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">page principale du wiki</a> . <br><br>  Pour respecter les formalit√©s, nous listons les principales fonctionnalit√©s de btrfs: <br><br><ul><li>  Taille maximale du fichier 2 ^ 64 octets <br></li><li>  Table d'inode dynamique <br></li><li>  D√©duplication des donn√©es <br></li><li>  Stockage efficace des fichiers de tr√®s petites et tr√®s grandes tailles <br></li><li>  Cr√©ation de sous-groupes et d'instantan√©s <br></li><li>  Quotas de sous-volume <br></li><li>  Somme de contr√¥le des donn√©es et des m√©tadonn√©es <br></li><li>  La possibilit√© de combiner plusieurs disques en un seul syst√®me de fichiers <br></li><li>  Cr√©ation d'une configuration RAID au niveau du syst√®me de fichiers <br></li><li>  Compression des donn√©es <br></li><li>  D√©fragmentation des donn√©es √† la vol√©e <br></li></ul><br>  Je tiens √† vous avertir imm√©diatement que BTRFS se d√©veloppe activement, et certains points peuvent diff√©rer d'une version √† l'autre.  Le lien - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://btrfs.wiki.kernel.org/index.php/Changelog,</a> vous permet de savoir quand quelles fonctionnalit√©s ont √©t√© ajout√©es, modifi√©es ou corrig√©es. <br><br>  Oui, BTRFS est un syst√®me de fichiers jeune et moderne qui r√©sout un large √©ventail de t√¢ches, mais pas sans ses inconv√©nients: <br><br><ul><li>  Son d√©veloppement actif entra√Æne une modification de tous les points cl√©s sur lesquels les utilitaires tiers peuvent s'appuyer lorsqu'ils travaillent avec. <br></li><li>  Malgr√© les assurances des d√©veloppeurs quant √† la stabilit√© de BTRFS, les utilisateurs rencontrent r√©guli√®rement des probl√®mes pouvant entra√Æner une perte de donn√©es.  En r√®gle g√©n√©rale, ils sont de nature ¬´flottante¬ª, de sorte qu'ils n'ont pas encore √©t√© √©tudi√©s et corrig√©s. <br></li><li>  Haute sensibilit√© √† la fragmentation. <br></li><li>  Documentation limit√©e et parfois obsol√®te. <br></li></ul><br>  Une page enti√®re est consacr√©e aux probl√®mes du syst√®me de fichiers sur diff√©rentes versions des noyaux - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://btrfs.wiki.kernel.org/index.php/Gotchas</a> .  Je vous conseille fortement de regarder l√†-bas - cela s'av√®re beaucoup int√©ressant et non √©vident. <br><br><h1>  Structure BTRFS </h1><br>  Le p√©riph√©rique BTRFS simplifi√© peut √™tre divis√© selon les niveaux suivants: <br><br><img src="https://habrastorage.org/webt/zz/n8/zj/zzn8zjyt0dai6ge9rifhgcdwg0q.png"><br><br>  Les p√©riph√©riques de bloc sont situ√©s au niveau le plus bas, repr√©sentant un ou plusieurs espaces d'adressage physiques distincts (le m√™me ¬´physique¬ª que les p√©riph√©riques de bloc eux-m√™mes, mais ce sont d√©j√† des d√©tails).  Gr√¢ce √† des structures sp√©ciales, les blocs de m√©moire physique allou√©s sont combin√©s en un seul espace d'adressage virtuel. <br><br>  Les structures de m√©tadonn√©es et les blocs contenant des donn√©es utilisateur (√©tendues) sont d√©j√† trait√©s √† un niveau logique.  Par cons√©quent, les donn√©es situ√©es s√©quentiellement √† un niveau logique peuvent r√©sider physiquement sur diff√©rents p√©riph√©riques de bloc. <br><br>  Les structures de m√©tadonn√©es peuvent √™tre divis√©es en niveaux.  Bien s√ªr, je ne les classerai pas - il y en a beaucoup, et ces d√©tails de bas niveau font l'objet d'un article s√©par√©.  Il est important ici que certaines structures de la hi√©rarchie se r√©v√®lent √™tre de niveau sup√©rieur √† d'autres, et tout en haut, il y aura une structure qui est un sous-volume. <br><br>  Le sous-volume est une sorte de point d'entr√©e, ou plut√¥t, les √©l√©ments racine du syst√®me de fichiers.  Ils forment une couche distincte de repr√©sentation des donn√©es, qui encapsule le travail des couches inf√©rieures, pr√©sentant les donn√©es utilisateur sous la forme habituelle: r√©pertoires et fichiers.  De plus, les sous-loups sont un √©l√©ment cl√© du m√©canisme CoW sur BTRFS.  Les m√™mes fichiers dans deux sous-volumes peuvent se r√©v√©ler √™tre le m√™me ensemble de donn√©es aux niveaux inf√©rieurs. <br><br>  La derni√®re couche est la couche de donn√©es.  Comme l'utilisateur les voit.  Ce sont des fichiers et des r√©pertoires situ√©s dans le sous-volume. <br><br>  Mais assez de th√©orie.  Il est temps de passer √† la pratique! <br><br><h1>  Btrfs-progs </h1><br>  Il s'agit d'un ensemble standard d'utilitaires pour la gestion de BTRFS.  Selon le package de distribution avec ces utilitaires dans le r√©f√©rentiel peuvent avoir des noms diff√©rents: <b>btrfsprogs</b> , <b>btrfs-progs</b> , <b>btrfs-tools</b> , etc.  Si votre r√©f√©rentiel n'avait rien de similaire, vous pouvez toujours le compiler manuellement, les sources ne sont pas loin - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/kdave/btrfs-progs</a> . <br>  Les utilitaires les plus importants de ce package sont <b>btrfs</b> et <b>mkfs.btrfs</b> .  √Ä partir de la seconde, je pense que tout est tr√®s clair - il est n√©cessaire de cr√©er BTRFS sur un p√©riph√©rique bloc.  Tout d'abord, <b>btrfs</b> est l'utilitaire principal qui vous permet de faire le reste.  Une sorte de "couteau suisse". <br><br>  Dans cet article, j'ai utilis√© la version v4.15.1.  L'utilitaire se d√©veloppe tr√®s activement et il existe des diff√©rences notables d'une version √† l'autre.  Donc, si vous n'aviez pas la commande n√©cessaire, v√©rifiez la version de l'utilitaire <b>btrfs</b> , elle est peut-√™tre d√©j√† obsol√®te. <br><br>  De plus, tr√®s probablement, les <b>utilitaires btrfsck</b> et <b>btrfstune</b> se trouvent dans le package. <br><br><ul><li>  Le premier sert √† v√©rifier le syst√®me de fichiers pour les erreurs et les corrections ult√©rieures, cependant, je ne recommande pas de l'utiliser - il est dans <i>un</i> √©tat <i>obsol√®te</i> , sa fonctionnalit√© a √©t√© d√©plac√©e vers la commande de <b>v√©rification btrfs</b> . </li><li>  Le second vous permet d'effectuer certaines op√©rations utiles sur btrfs, par exemple, de changer l'identifiant unique du syst√®me de fichiers (FS UUID), ou d'activer certaines fonctionnalit√©s du syst√®me de fichiers. </li></ul><br>  En plus des utilitaires r√©pertori√©s ci-dessus, il existe plusieurs autres utilitaires dans le package, mais ils sont principalement n√©cessaires pour le d√©bogage de btrfs et ne nous seront pas utiles dans cet article. <br><br><h1>  Formatage d'un disque en BTRFS </h1><br>  En pratique, tout est plus simple.  Commen√ßons par un lecteur. <br>  Le formatage d'un seul disque dans btrfs se produit avec la commande habituelle: <br><br><pre><code class="bash hljs">mkfs.btrfs /dev/sdc -L single_drive</code> </pre> <br>  En r√©ponse, l'utilitaire affichera les param√®tres du syst√®me de fichiers cr√©√© sur la console: <br><br><pre> <code class="bash hljs">btrfs-progs v4.15.1 See http://btrfs.wiki.kernel.org <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more information. Label:       single_drive UUID:        59307d69-6d2f-4d2e-aae2-a5189ad3c256 Node size:     16384 Sector size:    4096 Filesystem size:  1.00GiB Block group profiles: Data:       single 8.00MiB Metadata:     DUP 51.19MiB System:      DUP 8.00MiB SSD detected:    no Incompat features: extref, skinny-metadata Number of devices: 1 Devices:  ID    SIZE PATH   1   1.00GiB /dev/sdc</code> </pre><br>  Passons en revue les param√®tres pr√©sent√©s. <br><br><ul><li>  <b>√âtiquette</b> - Un nom d'√©tiquette ou de syst√®me de fichiers.  Il est sp√©cifi√© par le commutateur <code>-L</code> et est un param√®tre facultatif. </li><li>  <b>UUID</b> est un identifiant unique qui permet au noyau btrfs de diff√©rencier les instances les unes des autres. </li><li>  <b>Taille du n≈ìud</b> - la taille des √©l√©ments de l'arbre B dans lesquels les m√©tadonn√©es sont stock√©es.  Il peut √™tre d√©fini √† l'aide de l' <code>-n | --nodesize</code>  <code>-n | --nodesize</code> , et il doit √™tre un multiple de la taille de la taille du <b>secteur</b> .  La petite taille du n≈ìud entra√Æne une augmentation de la hauteur de l'arbre B (une augmentation du nombre de n≈ìuds) et, par cons√©quent, une diminution de la concurrence pour bloquer un n≈ìud individuel.  D'un autre c√¥t√©, la petite taille du n≈ìud rend l'instance du syst√®me de fichiers plus sujette √† la fragmentation.  Les gros n≈ìuds, en revanche, contribuent √† un meilleur empaquetage des m√©tadonn√©es sur le disque, ce qui r√©duit la fragmentation. <br>  L'inconv√©nient est l'augmentation du temps d'acc√®s aux donn√©es pour la mise √† jour du m√™me n≈ìud par plusieurs threads.  Sur les noyaux ant√©rieurs √† 3.11, par d√©faut, la taille du n≈ìud est de 16384 octets ou la taille de la page de m√©moire du syst√®me d'exploitation (la plus grande de ces deux valeurs). </li><li>  <b>Taille du secteur</b> - la quantit√© d'espace qui est des multiples dont l'espace est allou√© et lib√©r√© au niveau physique.  Elle est √©gale √† la taille de page de la m√©moire virtuelle du syst√®me d'exploitation, sauf indication contraire avec le <code>-s</code> . </li><li>  <b>Taille du syst√®me de fichiers</b> - la capacit√© totale du syst√®me de fichiers (donn√©es et m√©tadonn√©es).  D√©fini manuellement avec le commutateur <code>-b</code> .  Par d√©faut, tout le volume du p√©riph√©rique de bloc est occup√©. </li><li>  <b>Fonctionnalit√©s incompatibles</b> - une liste de fonctionnalit√©s incluses sur les btrfs cr√©√©s qui rompent la compatibilit√© descendante avec les anciennes versions du noyau.  Si la compatibilit√© descendante est n√©cessaire, vous pouvez d√©sactiver: <br><br><pre> <code class="bash hljs">--features ^extref,^skinny-metadata.</code> </pre> <br>  Soit dit en passant, vous pouvez v√©rifier les fonctionnalit√©s prises en charge par le noyau actuel par l'appel suivant: <br><br><pre> <code class="bash hljs">mkfs.btrfs --features list-all</code> </pre> </li><li>  <b>Nombre de p√©riph√©riques et de p√©riph√©riques</b> - combien de p√©riph√©riques de bloc sont impliqu√©s dans l'instance btrfs cr√©√©e, et une liste de tous les p√©riph√©riques, respectivement. </li><li>  Nous devrions √©galement parler du param√®tre <b>Block Group Profiles</b> .  Il indique le profil d'enregistrement applicable pour chacun des trois types de donn√©es: donn√©es, m√©tadonn√©es et syst√®me.  Revenant √† la structure g√©n√©ralis√©e de btrfs, on peut dire que: <br><br><ul><li>  Les donn√©es sont des donn√©es utilisateur; </li><li>  Les m√©tadonn√©es sont une combinaison d'une couche de sous-volume et d'une couche de m√©tadonn√©es et d'√©tendues; </li><li>  Les syst√®mes sont des structures permettant de mapper l'espace d'adressage de la m√©moire physique en un espace continu d'adresses logiques. </li></ul><br>  Un profil d'enregistrement est un moyen de stocker des donn√©es au niveau physique: <br><br><ul><li>  Single - stockage des donn√©es en une seule copie; </li><li>  DUP - duplication de donn√©es sur un seul support; </li><li>  RAIDX est l'une des configurations de RAID0, RAID1, RAID10, RAID5 et RAID6. </li></ul><br></li></ul><br>  Lors du balisage d'un p√©riph√©rique bloc, btrfs appliquera la duplication aux m√©tadonn√©es et aux donn√©es syst√®me par d√©faut, et les donn√©es utilisateur resteront sur le support en une seule copie.  La cr√©ation de btrfs sur plusieurs disques √† la fois appliquera le profil ¬´RAID0¬ª aux donn√©es utilisateur par d√©faut et ¬´RAID1¬ª aux m√©tadonn√©es. <br>  Ce groupe de param√®tres est contr√¥l√© √† l'aide de deux cl√©s: <code>-d</code> pour les donn√©es et <code>-m</code> pour les m√©tadonn√©es et les donn√©es syst√®me. <br><br>  Mais il y a une nuance ... Les choses sont diff√©rentes avec les SSD.  Le fait est que si nous marquions un lecteur SSD (ou un lecteur flash), par d√©faut, le syst√®me de fichiers ne dupliquerait pas les m√©tadonn√©es.  Les disques SSD peuvent √©tendre la d√©duplication des donn√©es pour prolonger la dur√©e de vie des √©l√©ments de m√©moire.  C'est-√†-dire  ayant deux copies logiques des donn√©es, en fait une seule sera enregistr√©e sur le support.  Par cons√©quent, lorsqu'un segment de m√©moire √©choue, les ¬´deux copies¬ª des donn√©es seront endommag√©es.  De plus, en √©crivant deux fois des donn√©es, la ressource SSD est simplement consomm√©e plus rapidement. <br><br>  Pour d√©terminer le type de support, btrfs v√©rifie le contenu du fichier <i>/ sys / block / DEV / queue / rotation</i> , o√π "DEV" est le nom du p√©riph√©rique de bloc en cours de v√©rification. <br>  Bien s√ªr, m√™me dans le cas d'un SSD, le profil de stockage peut √™tre forc√©. <br><br>  Pour cr√©er une instance btrfs sur plusieurs appareils, sp√©cifiez-les simplement avec un espace: <br><br><pre> <code class="bash hljs">sudo mkfs.btrfs /dev/sdc /dev/sdd -L double_drive</code> </pre> <br>  ou avec des profils: <br><br><pre> <code class="bash hljs">sudo mkfs.btrfs /dev/sdc /dev/sdd -d raid1 -m raid1 -L raid1_drive</code> </pre> <br>  Il convient de noter que les supports ne doivent pas n√©cessairement √™tre de la m√™me taille, m√™me si la mise en miroir compl√®te est utilis√©e.  Cependant, d√®s qu'il n'y a pas assez d'espace sur le plus petit lecteur pour allouer de la m√©moire, le syst√®me de fichiers affiche un message indiquant qu'il n'y a pas d'espace libre, bien que physiquement il puisse toujours y avoir de l'espace libre sur d'autres supports. <br><br><h1>  Montage </h1><br>  Le premier montage de btrfs fra√Æchement cr√©√© n'est pas diff√©rent des autres syst√®mes de fichiers: <br><br><pre> <code class="bash hljs">mount /dev/sdc /mnt</code> </pre> <br>  Si le syst√®me de fichiers se trouve sur plusieurs disques, pour le montage, il suffit de sp√©cifier l'un d'entre eux. <br><br>  En g√©n√©ral, le montage de btrfs implique toujours le montage d'un ou plusieurs de ses sous-volumes.  Si la commande mount n'est pas sp√©cifi√©e, quel sous-volume doit √™tre mont√©, alors btrfs lira √† partir de l'enregistrement sp√©cial l'ID du sous-volume, qui doit √™tre mont√© par d√©faut.  Cette entr√©e peut √™tre modifi√©e ult√©rieurement avec la commande <code>btrfs set-default</code> , mais lorsque vous la montez pour la premi√®re fois sur btrfs, il n'y a qu'un seul sous-volume - celui racine.  Il est sp√©cifi√© par d√©faut pour le montage. <br><br>  Le sous-monde racine sur btrfs est toujours pr√©sent.  Il appara√Æt avec le syst√®me de fichiers et n'est soumis √† aucune modification √† l'avenir. <br><br>  Il existe deux fa√ßons de monter un sous-volume autre que celui par d√©faut: <br>  sp√©cifiez le chemin depuis le sous-volume racine btrfs: <br><br><pre> <code class="bash hljs">mount -o subvol=/path/to/subvol /dev/sdc /mnt</code> </pre> <br>  sp√©cifiez soit l'ID de sous-volume: <br><br><pre> <code class="bash hljs">mount -o subvolid=257 /dev/sdc /mnt</code> </pre> <br>  Comme d√©j√† mentionn√©, l'un des sous-volumes btrfs est sp√©cifi√© comme mont√© par d√©faut.  D√©couvrez lequel est possible en faisant: <br><br><pre> <code class="bash hljs">btrfs subvolume get-default /path/to/any/subvolume</code> </pre> <br>  Pour installer le sous-montage par d√©faut, vous pouvez utiliser la commande: <br><br><pre> <code class="bash hljs">btrfs subvolume <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-default 258 /path/to/any/subvolume</code> </pre> <br>  Dans ce cas, le chemin d'acc√®s au sous-volume n'est n√©cessaire que pour indiquer l'instance btrfs sp√©cifique √† laquelle la commande s'applique.  Soit dit en passant, il n'est pas n√©cessaire que ce soit un sous-monde; le chemin vers n'importe quel r√©pertoire convient √©galement. <br><br>  La commande <code>mount</code> accepte un grand nombre d'options pour contr√¥ler les capacit√©s de btrfs: d√©fragmentation, vidage du cache, compression, vache, journalisation, √©quilibre, prise en charge ssd et beaucoup d'autres choses sp√©cifiques √† btrfs.  Je ne les consid√©rerai pas dans le cadre de cet article, car  ils sont n√©cessaires pour affiner le syst√®me de fichiers, et dans la grande majorit√© des cas, vous pouvez vous en passer. <br><br><h1>  Le sous-volume est </h1><br>  Un sous-volume est un √©l√©ment cl√© de btrfs qui remplit diverses fonctions: <br><br><ul><li>  stockage des donn√©es utilisateur et autres sous-volumes, <br></li><li>  acc√®s aux donn√©es (montage), <br></li><li>  M√©canisme CoW <br></li><li>  cr√©er des instantan√©s. <br></li></ul><br>  En premi√®re approximation, le sous-volume est un r√©pertoire normal.  Vous pouvez les renommer / d√©placer, afficher leur contenu, y placer et modifier des fichiers.  Aucun utilitaire sp√©cial n'est requis. <br><br>  La cr√©ation et la suppression d'un sous-volume sont effectu√©es sur des btrfs mont√©s √† l'aide de commandes sp√©ciales: <br><br><pre> <code class="bash hljs">btrfs subvolume create /mnt/subvolume_name btrfs subvolume delete /mnt/subvolume_name</code> </pre> <br>  Je note que si vous essayez de supprimer le sous-volume √† l'aide du gestionnaire de fichiers ou de l'utilitaire <b>rm</b> , l'op√©ration se terminera par une erreur d' <i>op√©ration non autoris√©e</i> (l'op√©ration n'est pas autoris√©e). <br><br>  <b>UPD: √†</b> partir de la version 4.18.0 du noyau, les sous-vol√©es peuvent √™tre supprim√©es √† l'aide de l'utilitaire <b>rm</b> ou des outils du gestionnaire de fichiers.  Apparemment, c'√©tait un bug, pas une fonctionnalit√©.  Merci √† Prototik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">habravchanin</a> pour la clarification. <br><br>  Apr√®s avoir cr√©√© un sous-volume, vous pouvez voir ses propri√©t√©s: <br><br><pre> <code class="bash hljs">btrfs subvolume show /mnt/subvolume_name Name:          subx UUID:          09af45e8-d2b2-b342-8a92-fa270ac82d0a Parent UUID:      - Received UUID:     - Creation time:     2019-03-23 17:59:28 +0100 Subvolume ID:      268 Generation:       39 Gen at creation:    35 Parent ID:       260 Top level ID:      260 Flags:         - Snapshot(s):</code> </pre> <br>  Passons en revue les principales propri√©t√©s du sous-volume: <br><br><ul><li>  <b>Nom</b> - le nom du sous-volume <br></li><li>  <b>UUID</b> est un identifiant unique universel qui sert principalement √† d√©terminer les relations subwoofer-snapshot, <br></li><li>  <b>UUID parent</b> - identifiant de l'anc√™tre du sous-volume dont d√©rive l'actuel, <br></li><li>  <b>UUID re√ßu</b> - identifiant de l'anc√™tre du sous-volume envoy√© via <i>btrfs send</i> , <br></li><li>  <b>ID de sous-volume</b> - un identifiant unique pour le placement dans l'arbre B, <br></li><li>  <b>G√©n√©ration</b> - num√©ro de transaction lors de la derni√®re mise √† jour des m√©tadonn√©es de sous-volume, <br></li><li>  <b>G√©n √† la cr√©ation</b> - num√©ro de transaction au moment de la cr√©ation du sous-volume, <br></li><li>  <b>ID parent</b> - identifiant du sous-volume dans lequel le courant est int√©gr√©, <br></li><li>  <b>L'ID de niveau sup√©rieur</b> est exactement le m√™me que l'ID parent, <br></li><li>  <b>Drapeaux</b> - drapeaux (en fait, un seul drapeau est en <i>lecture seule</i> ), <br></li><li>  <b>Instantan√©s</b> - une liste d'instantan√©s pris √† partir de ce sous-volume. <br></li></ul><br>  Le sous-volume a un param√®tre de plus - c'est son chemin depuis l'√©l√©ment racine btrfs.  Le chemin est affich√© lors de la liste du sous-volume: <br><br><pre> <code class="plaintext hljs">btrfs subvolume list /path/to/any/btrfs/mountpoint</code> </pre> <br>  Mais ici, tout est simple et clair - cela n'a m√™me pas de sens d'apporter la sortie de la commande. <br>  Comme pour les commandes <code>get-default</code> et <code>set-default</code> , vous pouvez sp√©cifier ici le chemin d'acc√®s √† n'importe quel sous-volume, le r√©sultat ne changera pas.  Ce chemin est utilis√© pour trouver les btrfs du sous-bol racine.  Apr√®s quoi tout l'arbre sous-wolum est lu. <br><br>  Si vous essayez de copier le sous-volume, par exemple, avec l'utilitaire <b>cp</b> , l'op√©ration de copie r√©ussira, mais en cons√©quence, non le sous-volume sera cr√©√©, mais le r√©pertoire habituel.  Cependant, btrfs fournit un outil beaucoup plus flexible pour cr√©er de telles copies - des instantan√©s. <br><br><h1>  Le snapshot est </h1><br>  Snapshot est √©galement un sous-monde, ayant juste des propri√©t√©s avanc√©es. <br><br>  Leur principale diff√©rence est que l'instantan√© contient des enregistrements √† partir desquels il a √©t√© produit.  Il s'agit des champs <b>UUID</b> <b>parent</b> et <b>UUID re√ßu</b> .  Dans le caisson de basses, ces champs sont √©galement pr√©sents, mais ils sont toujours vides.  Donc, en fait, un instantan√© et un sous-volume sont une seule et m√™me chose. <br>  Lors de la cr√©ation, vous pouvez bloquer l'instantan√© des modifications √† l'aide du commutateur <code>-r</code> . <br><br><pre> <code class="plaintext hljs">btrfs subvolume snapshot -r /path/to/subvol /path/to/snapshot</code> </pre> <br>  Dans ce cas, les fichiers sont garantis dans leur √©tat d'origine au moment de la cr√©ation de l'instantan√©. <br><br>  L'indicateur en lecture seule peut √©galement √™tre contr√¥l√© manuellement, cela fonctionne pour n'importe quel sous-volume: <br><br><pre> <code class="plaintext hljs">btrfs property get /path/to/subvol ro btrfs property set /path/to/subvol ro true</code> </pre> <br>  Si nous regardons maintenant les propri√©t√©s de l'instantan√©, nous verrons le champ <b>UUID parent</b> rempli: <br><br><pre> <code class="plaintext hljs">btrfs subvolume show /path/to/snapshot Name:          subx UUID:          d08612d8-596a-11e9-8647-d663bd873d93 Parent UUID:      09af45e8-d2b2-b342-8a92-fa270ac82d0a Received UUID:     - Creation time:     2019-03-23 17:59:28 +0100 Subvolume ID:      269 Generation:       39 Gen at creation:    35 Parent ID:       260 Top level ID:      260 Flags:         - Snapshot(s):</code> </pre> <br>  Une caract√©ristique importante de l'op√©ration d'instantan√© est qu'elle n'est pas r√©cursive.  Au lieu d'un sous-volume imbriqu√©, des r√©pertoires vides seront cr√©√©s dans l'instantan√©. <br><br>  Passons √† l'exemple suivant. <br><br>  Sur le syst√®me de fichiers, il y a un subwoofer ¬´sub0¬ª, √† l'int√©rieur duquel se trouve un subwoofer <i>subA</i> et un r√©pertoire <i>dirB</i> .  √Ä l'int√©rieur de chacun d'eux se trouvent respectivement le <i>fichierA</i> et le <i>fichierB</i> . <br><br>  Supprimer l'instantan√©: <br><br><pre> <code class="plaintext hljs">btrfs subvolume snapshot sub0 snap0</code> </pre> <br><img src="https://habrastorage.org/webt/cf/or/w-/cforw-vhzoma9iub2hcyejkbh84.png"><br><br>  Le snapshot <i>snap0 cr√©√©</i> h√©ritera de tous les fichiers et r√©pertoires de son parent, cependant, le <i>subwoofer</i> subA n'appara√Ætra pas dans le snapshot.  Au lieu de cela, seul un r√©pertoire vide appara√Ætra dans l'instantan√©, c'est-√†-dire  le contenu du <i>sous-</i> volume subA ne sera pas h√©rit√©. <br><br>  D'une part, c'est bien - nous supprimons l'instantan√© d'un sous-volume sp√©cifique, et tous ceux imbriqu√©s ne nous int√©ressent pas.  D'un autre c√¥t√©, si un instantan√© r√©cursif est requis, alors btrfs n'a pas de solution √† ce probl√®me.  Nous devrons chercher des tourn√©es de travail. <br><br>  La premi√®re solution de contournement est bas√©e sur le fait que l'instantan√© a √©t√© supprim√© sans indicateur de lecture seule, ce qui vous permet de corriger la situation tout simplement: <br><br><ul><li>  supprimer un r√©pertoire suppl√©mentaire de l'instantan√© <br><br><pre> <code class="plaintext hljs">rmdir snap0/subA</code> </pre> <br></li><li>  supprimer un instantan√© d'un sous-volume imbriqu√© <br><br><pre> <code class="plaintext hljs">btrfs subvolume snapshot sub0/subA snap0/subA</code> </pre> <br></li></ul><br><img src="https://habrastorage.org/webt/ja/u3/fy/jau3fyzmzjxzxweajh-tmjld-iw.png"><br><br>  Si l'instantan√© a √©t√© supprim√© avec l'indicateur de lecture seule, l'option ci-dessus ne fonctionnera pas, car  dans <i>snap0,</i> vous ne pouvez ni supprimer le r√©pertoire ni placer un instantan√©.  Il n'y a qu'une seule option - placer des instantan√©s quelque part pr√®s du caisson de <i>basses</i> snap0: <br><br><pre> <code class="plaintext hljs">btrfs subvolume snapshot sub0/subA snapA</code> </pre> <br>  puis montez <i>snapA</i> dans l'instantan√© <i>snap0</i> , le r√©pertoire correspondant est d√©j√† l√†: <br><br><pre> <code class="plaintext hljs">mount -o subvol=snapA snap0/subA</code> </pre> <br><img src="https://habrastorage.org/webt/mu/-w/nn/mu-wnnj0jiyyinnxokz08nuipag.png"><br><br>  Dans tous les cas, il est important de comprendre que les instantan√©s r√©cursifs seront tous tourn√©s dans diff√©rentes op√©rations, √† des moments diff√©rents.  Il ne peut √™tre question d'une suppression atomique d'un instantan√© de plusieurs sous-volumes. <br><br><h1>  Copie en √©criture </h1><br>  Un peu sur le sous-volume et l'approche CoW.  Imaginez qu'un sous-volume soit pr√©sent sur le syst√®me de fichiers et qu'un fichier s'y trouve (prenez le cas id√©al - le fichier n'est pas fragment√©).  Ensuite, un instantan√© est supprim√© du sous-chariot. <br><br><img src="https://habrastorage.org/webt/hg/yo/sl/hgyoslduv5eeenpopaqu3dk7qyw.png"><br><br>  Un nouveau sous-volume (instantan√©) appara√Ætra sur le syst√®me de fichiers avec exactement le m√™me contenu que le sous-volume d'origine.  Le processus de cr√©ation d'un instantan√© est presque instantan√© - les donn√©es du fichier lui-m√™me ne sont pas copi√©es.  Au lieu de cela, des m√©tadonn√©es suppl√©mentaires sont cr√©√©es et un instantan√© avec le sous-volume parent devient le propri√©taire du fichier.  En fait, il n'y avait qu'un seul fichier sur le disque, mais maintenant il appartient √† la fois au sous-volume et √† l'instantan√©. <br>  Si vous modifiez maintenant le fichier dans le sous-volume, les modifications n'affecteront pas le fichier dans l'instantan√©.  Si l'indicateur de lecture seule n'a pas √©t√© d√©fini lors de la cr√©ation de l'instantan√©, le fichier de l'instantan√© peut √©galement √™tre modifi√©. <br><br><img src="https://habrastorage.org/webt/7n/1e/0t/7n1e0tkdlxsuqkpjmtinix0yiys.png"><br><br>  Techniquement, lorsqu'un fichier est modifi√©, seules ces modifications sont enregistr√©es.  Ainsi, le fichier source sera stock√© sur le disque plus un delta qui distingue le fichier d'origine du fichier modifi√©.  Si vous supprimez l'un des sous-volumes (par la seconde je veux dire un instantan√©), les donn√©es en exc√®s qui ne sont plus utilis√©es par personne seront effac√©es du disque, et seule la version actuelle du fichier restera sur le disque (du point de vue du sous-volume restant). <br><br>  <i>Une courte note</i> : lors du retrait, le caisson de graves dispara√Ætra instantan√©ment des yeux de l'utilisateur, et l'utilitaire rendra le contr√¥le au terminal, cependant, les donn√©es sur le disque seront nettoy√©es par le processus d'arri√®re-plan pendant un certain temps.  Autrement dit, contrairement √† la suppression d'un r√©pertoire normal, il n'est pas n√©cessaire d'attendre la fin r√©elle de l'op√©ration de suppression.  Si vous devez vous synchroniser avec ce processus et attendre qu'il se termine, vous pouvez sp√©cifier le <code>--commit-after</code> lors de l'appel de la <b>suppression</b> .  La commande <b>btrfs subvolume list</b> , <b>invoqu√©e</b> avec le commutateur <code>-d</code> , affiche une liste des sous-volumes qui ont √©t√© supprim√©s par l'utilisateur et sont en train d'√™tre supprim√©s du disque. <br><br>  De plus, btrfs vous permet de cloner des fichiers sur le syst√®me de fichiers sans avoir recours √† des instantan√©s.  Cela se fait en copiant r√©guli√®rement avec l' <code>--reflink</code> : <br><br><pre> <code class="plaintext hljs">cp -ax --reflink=always /original/file /copied/file</code> </pre> <br>  La <code>reflink=always</code> indique au syst√®me de fichiers que nous voulons utiliser le m√©canisme CoW lors de la copie.  Apr√®s la copie, les fichiers peuvent √™tre modifi√©s ind√©pendamment les uns des autres, de sorte que nous obtenons le m√™me comportement qu'apr√®s la cr√©ation d'un instantan√©.  Alors pourquoi avons-nous besoin de sous-bols? <br><br>  Les sous-volumes sur btrfs jouent le r√¥le d'un outil de contr√¥le de haut niveau pour des ensembles de donn√©es entiers: d'une part, il s'agit de la suppression d'instantan√©s atomiques de toutes les donn√©es d'un sous-volume (dans le cas o√π --reflink atomicity n'est qu'au niveau du fichier), et d'autre part, il est possible de voir de qui il est h√©rit√© ou ¬´restaurez¬ª rapidement l'ensemble de donn√©es dans une version ant√©rieure, etc. <br>  Ainsi, btrfs offre la possibilit√© de capturer les √©tats des fichiers aux moments souhait√©s, en utilisant le sous-volume comme moyen de haut niveau pour g√©rer ces √©tats. <br><br><h1>  R√©cup√©ration de sous-volume </h1><br>  Dans les vastes √©tendues, la question se pose souvent: "J'ai un subwoofer, j'ai un instantan√©, comment faire un reverse?"  Cette approche n'est pas applicable √† btrfs, car  il n'y a aucune possibilit√© de "faire reculer le sous-chariot".  Au lieu de cela, btrfs propose une strat√©gie pour remplacer le sous-chariot par son instantan√©.  En effet, pourquoi revenir sur quelque chose, si l'instantan√© lui-m√™me est cet objet que nous voulons obtenir avec revenir. <br><br>  Imaginez ce sc√©nario: sur btrfs il y a un sous-volume dans lequel se trouvent les fichiers d'une base de donn√©es (enfin, ou d'autres donn√©es importantes).  Les instantan√©s sont p√©riodiquement supprim√©s de ce sous-volume et, √† un moment donn√©, il est n√©cessaire de restaurer les donn√©es.  Dans ce cas, nous nous d√©barrassons simplement du sous-groupe et commen√ßons √† la place √† utiliser l'instantan√© qui en est extrait, ou - si nous ne voulons pas g√¢cher ces donn√©es √©galement - nous supprimons un autre instantan√© de l'instantan√©.  Si le sous-monde d'origine n'a pas √©t√© mont√© et utilis√© comme r√©pertoire normal, il doit alors √™tre supprim√© ou d√©plac√© / renomm√©, et un instantan√© doit √™tre mis √† sa place. <br><br><img src="https://habrastorage.org/webt/sn/os/od/snosodoezxac3a-2s7xzmpqa-js.png"><br><br>  Dans la console, cela pourrait ressembler √† ceci: <br><br><ul><li>  renommer la subwolly <br><br><pre> <code class="plaintext hljs">mv the_subvolume the_subvol.old</code> </pre> </li><li>  mettre son instantan√© √† la place du sous-volume <br><br><pre> <code class="plaintext hljs">btrfs subvolume snapshot the_snapshot the_subvolume</code> </pre> </li></ul><br>  Si le sous-volume a √©t√© mont√© et utilis√© via le point de montage, il suffit de d√©monter le sous-volume et de monter un instantan√© √† sa place. <br><br><img src="https://habrastorage.org/webt/4z/mi/sw/4zmisws4w5keyk7mhsr6eaav-ri.png"><br><br><ul><li>  D√©montez le caisson de basses <br><br><pre> <code class="plaintext hljs">umount /mnt/</code> </pre> </li><li>  Vous pouvez cr√©er un instantan√© d'un instantan√© afin de ne pas g√¢cher les derni√®res donn√©es survivantes: <br><br><pre> <code class="plaintext hljs">btrfs subvolume snapshot /path/to/snapshot /path/to/snapshot_copy</code> </pre> </li><li>  montage instantan√©: <br><br><pre> <code class="plaintext hljs">mount -o subvol=path/to/snapshot_copy /mnt</code> </pre> </li></ul><br>  Pour √™tre complet, je vais r√©essayer et un peu diff√©remment.  Le sous-volume dans lequel les changements se produisent est la branche <i>principale</i> . <br><br><img src="https://habrastorage.org/webt/gh/pt/m7/ghptm7ykmordfcur4bdddehng6c.jpeg"><br><br>  Lors de la cr√©ation d'un instantan√©, l'√©tat des fichiers sur le disque est fixe.  D√©sormais, un instantan√© est un brunch de la branche <i>principale</i> .  Toutes les autres modifications apport√©es √† <i>main principale</i> n'affecteront en aucun cas l'instantan√©.  Revenir √† l'instantan√© signifie arr√™ter l'utilisation de la branche <i>principale</i> et passer compl√®tement au brunch.  La branche <i>principale</i> peut √™tre supprim√©e car inutile.  Ainsi, btrfs est pratiquement un syst√®me de contr√¥le de version, mais sans possibilit√© de fusionner les branches. <br><br><h1>  Arborescence du syst√®me de fichiers </h1><br>  L'un des points non √©vidents associ√©s √† l'utilisation de btrfs est de savoir comment diviser les donn√©es syst√®me en sous-volume.  Bien s√ªr, il n'y a pas de ¬´bonne¬ª approche √† ce probl√®me.  Mais il y a 3 fa√ßons d'organiser la structure du sous-volume: une structure plate, imbriqu√©e et mixte. <br><br>  Une structure plate signifie que le sous-volume est plac√© dans une liste plate dans le sous-volume racine.  Par exemple, vous pouvez s√©lectionner la racine du syst√®me de fichiers (appelons-la <i>root</i> ), le r√©pertoire utilisateur <i>home</i> , le r√©pertoire avec le site <i>/ var / www</i> et la base de donn√©es situ√©e par exemple dans <i>/ var / database</i> comme sous-volumes s√©par√©s. <br><br><img src="https://habrastorage.org/webt/ga/yp/ma/gaypma96_mzvjtlwjyh3atw5qgm.png"><br><br>  Pour plus de commodit√©, certains sous-volumes peuvent √™tre plac√©s dans des r√©pertoires, comme, par exemple, dans le cas du sous-volume <i>var / www</i> . <br><br>  Avec cette approche, tous les sous-volumes doivent √™tre mont√©s.  Le sous- <i>root</i> doit avoir un point de montage /, et √† l'int√©rieur il doit contenir les r√©pertoires <i>home</i> et <i>var</i> .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apr√®s le </font><font style="vertical-align: inherit;">montage de </font><font style="vertical-align: inherit;">la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">racine</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maison /</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> doit √™tre install√© sabvolyum la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">maison</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et dans le </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ var / www</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ var / databas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e - sabvolyumy </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var / www</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base de </font><font style="vertical-align: inherit;">donn√©es</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , respectivement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ainsi, l'arborescence de btrfs-subvolume peut √™tre affich√©e arbitrairement dans le syst√®me de fichiers virtuel de l'OS, et il y en a d√©j√† assez pour cela.</font></font><br><br>  Avantages: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> l'utilisateur ne voit que le sous-volume mont√©, </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il est facile de remplacer le subwoofer (d√©monter l'un, monter l'autre), </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> subwoofer facile √† retirer. </font></font><br></li></ul><br>  Inconv√©nients: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il est facile de se demander o√π l'installer, </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pour chaque sous-volume, il devrait y avoir une entr√©e dans fstab, et s'il y a des ¬´rollbacks¬ª aux instantan√©s, alors les entr√©es correspondantes dans fstab doivent √©galement √™tre mises √† jour. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La structure imbriqu√©e du sous-volume sugg√®re une utilisation simple du sous-volume au lieu de certains r√©pertoires. </font></font><br><br><img src="https://habrastorage.org/webt/v2/41/e5/v241e5bwrguy3_f76frc2k3ygwk.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans ce cas, en plus du sous-volume racine, rien de plus n'est requis pour √™tre mont√©.</font></font><br><br>  Avantages: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tous les sous-volumes sont visibles, la structure est facile √† percevoir, </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vous n'avez plus besoin de monter quoi que ce soit, tout est comme avec un syst√®me de fichiers ¬´normal¬ª. </font></font><br></li></ul><br>  Inconv√©nients: <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tous les sous-volumes sont visibles, peut-√™tre que certains voudraient se cacher de l'utilisateur, </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> il est difficile de retirer / remplacer le sous-loup (la raison en est les sous-loups imbriqu√©s). </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eh bien, la troisi√®me approche est mixte. </font><font style="vertical-align: inherit;">Il implique une combinaison des deux premiers pour maximiser les avantages des deux. </font><font style="vertical-align: inherit;">Cependant, il est possible que cette approche particuli√®re conduise √† une structure complexe, difficile √† modifier et confuse avec un grand nombre d'entr√©es dans fstab. </font><font style="vertical-align: inherit;">Tout d√©pend de la </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sobri√©t√©</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de l'administrateur syst√®me.</font></font><br><br><img src="https://habrastorage.org/webt/bv/qw/zv/bvqwzvl0wqspgvlaknnd3l9eyqo.png"><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ajouter / retirer un disque, √©quilibrer </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> btrfs poss√®de d'excellentes fonctionnalit√©s - la possibilit√© d'ajouter des p√©riph√©riques bloqu√©s √† chaud directement pendant le fonctionnement du syst√®me de fichiers: </font></font><br><br><pre> <code class="plaintext hljs">btrfs device add /path/to/device /path/to/btrfs</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ou supprimez: </font></font><br><br><pre> <code class="plaintext hljs">btrfs device remove /path/to/device /path/to/btrfs</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soit dit en passant, dans un seul appel d'ajout / suppression, vous pouvez sp√©cifier plusieurs disques. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Encore une fois, le chemin sp√©cifi√© est le chemin vers tout sous-volume de ce btrfs auquel la commande sera appliqu√©e. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√©rifions le nombre et les p√©riph√©riques de blocs contr√¥l√©s par btrfs:</font></font><br><br><pre> <code class="plaintext hljs">btrfs filesystem show /path/to/btrfs Label: none uuid: 52961dda-df84-4e2d-9727-e93e7738df81       Total devices 2 FS bytes used 192.00KiB       devid  1 size 20.00GiB used 132.00MiB path /dev/sdc       devid  2 size 50.00GiB used 0.00B path /dev/sdd</code> </pre><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,00B</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans le champ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilis√©</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nous indique que le disque ajout√© est vide. </font><font style="vertical-align: inherit;">Pour le remplir de donn√©es en fonction du profil d'enregistrement, vous devez √©quilibrer:</font></font><br><br><pre> <code class="plaintext hljs">btrfs balance start /path/to/btrfs</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> redistribue les donn√©es sur les disques en fonction du profil d'enregistrement s√©lectionn√©. Par exemple, dans le cas de RAID1, l'√©quilibre entra√Ænera le clonage des donn√©es du p√©riph√©rique d'origine, dans le cas de RAID0, cela conduira √† une distribution plus uniforme des donn√©es sur deux disques, etc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En raison de l'√©quilibre, si auparavant il y avait des vides sur le disque, les donn√©es sur le disque seront √©crites de mani√®re plus dense, c'est-√†-dire la d√©fragmentation se r√©v√©lera. Cependant, il est important de comprendre qu'il ne s'agit pas exactement de ¬´cette¬ª d√©fragmentation. Dans ce cas, la commande </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ne regarde pas le contenu logique, mais ne fonctionne que sur les blocs de donn√©es. Elle ne fait pas attention au fait qu'un fichier soit √©tal√© sur le disque. Au lieu de cela, le </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">solde</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> transf√®re les blocs de donn√©es d'un endroit √† un autre.</font></font> C'est-√†-dire<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un fichier fragment√© pour √©quilibrer restera fragment√© apr√®s lui. Mais! La fragmentation au niveau des blocs de donn√©es continuera de diminuer, et cela peut √™tre utilis√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour √©viter toute confusion, disons ceci: l'op√©ration d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©quilibrage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> r√©duit la fragmentation au niveau des blocs de donn√©es, mais n'affecte pas la fragmentation des fichiers. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De plus, la commande de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">balance</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> offre la possibilit√© de modifier le profil d'enregistrement. Par exemple, le profil DUP a √©t√© utilis√© sur le disque, et apr√®s avoir ajout√© le disque, ils ont d√©cid√© de faire un RAID1 complet. Pour ce faire, utilisez le filtre </font></font><code>convert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="plaintext hljs">btrfs balance start -dconvert=raid1 -mconvert=raid1 /path/to/btrfs</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä l'aide des options </font></font><code>-dconvert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et, de </font></font><code>-mconvert</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouveaux profils d'enregistrement sont d√©finis pour les donn√©es et les m√©tadonn√©es, respectivement. </font><font style="vertical-align: inherit;">Il existe √©galement l'option -sconvert, qui est con√ßue pour modifier le profil d'√©criture des donn√©es syst√®me, mais vous devrez √©galement ajouter le commutateur -f (--force) avec lui pour forcer l'op√©ration.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En g√©n√©ral, l'objectif principal des filtres est de d√©finir les r√®gles de l'op√©ration d'√©quilibrage: quels blocs traiter et lesquels ne pas toucher. </font><font style="vertical-align: inherit;">Ainsi, par exemple, vous ne pouvez affecter que des blocs enregistr√©s avec un profil d'enregistrement sp√©cifique (profils de filtre), ou des blocs occup√©s au-dessus d'un certain pourcentage (filtre d'utilisation), ou vous ne pouvez affecter que des groupes de blocs li√©s √† un disque particulier (filtre d√©vid), etc. </font><font style="vertical-align: inherit;">√Ä propos, ils peuvent toujours √™tre combin√©s. </font><font style="vertical-align: inherit;">En g√©n√©ral, les capacit√©s des filtres sont tr√®s √©tendues et sont principalement n√©cessaires pour effectuer un √©quilibre s√©lectif des donn√©es.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Fragmentation </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Malheureusement, btrfs, en raison de son architecture, est extr√™mement sensible √† un ph√©nom√®ne tel que la fragmentation. </font><font style="vertical-align: inherit;">Le fait est que les donn√©es sont toujours √©crites dans un nouvel emplacement sur le disque. </font><font style="vertical-align: inherit;">M√™me si vous lisez le fichier, ne faites rien avec les donn√©es et r√©√©crivez-les dans le m√™me fichier, les donn√©es iront dans une nouvelle zone sur le disque. </font><font style="vertical-align: inherit;">La m√™me chose se produit si vous ne mettez √† jour que partiellement les donn√©es du fichier - les modifications sont √©crites dans une nouvelle zone du disque. </font><font style="vertical-align: inherit;">Ainsi, les changements fr√©quents de fragments de fichiers tr√®s fortement, augmentant la ¬´dispersion¬ª des fragments, dans le cas g√©n√©ral, sur plusieurs disques. </font><font style="vertical-align: inherit;">Cela entra√Æne une charge accrue sur le processeur et une consommation de m√©moire inutile. </font><font style="vertical-align: inherit;">Les plus fragment√©s sont les bases de donn√©es et les images de machines virtuelles. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez √©valuer la fragmentation des fichiers √† l'aide de l'utilitaire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">filefrag</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (non inclus dans btrfs-progs). </font></font><br><br><pre> <code class="plaintext hljs">filefrag /path/to/your/file</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il indique le nombre d'extensions utilis√©es pour stocker le fichier. </font><font style="vertical-align: inherit;">Autrement dit - moins il y a d'extensions, moins le fichier est fragment√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe deux m√©thodes pour lutter contre la fragmentation sur btrfs: la d√©fragmentation et l'indicateur </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La d√©fragmentation peut √™tre appliqu√©e √† un seul fichier ou √† un sous-volume / r√©pertoire, y compris r√©cursivement. </font><font style="vertical-align: inherit;">La commande est la suivante:</font></font><br><br><pre> <code class="plaintext hljs">btrfs filesystem defragment /path/to/file/or/dir</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je dois dire que cette √©quipe ne conduit pas toujours aux r√©sultats escompt√©s. </font><font style="vertical-align: inherit;">Les petits fichiers l√©g√®rement fragment√©s (10 √† 20 extensions) apr√®s la d√©fragmentation peuvent √™tre divis√©s en plusieurs parties. </font><font style="vertical-align: inherit;">De plus, la d√©fragmentation btrfs sur certaines versions du noyau rompt la d√©duplication des fichiers, ce qui en fait de v√©ritables copies physiques.</font></font> C'est-√†-dire<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les instantan√©s au niveau physique deviendront des copies compl√®tes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La deuxi√®me fa√ßon de lutter contre la fragmentation consiste √† utiliser un attribut de fichier </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><pre> <code class="plaintext hljs">chattr +C /path/to/file</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'attribut </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut √™tre d√©fini que sur un fichier nouveau ou vide. </font><font style="vertical-align: inherit;">Il d√©sactive le m√©canisme de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">copie en √©criture</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , donc btrfs fonctionnera toujours avec une zone de disque fixe lors de la mise √† jour du contenu d'un fichier, en √©crivant des donn√©es sur celles existantes (au niveau physique). </font><font style="vertical-align: inherit;">Parmi les inconv√©nients de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nocow</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - il d√©sactive √©galement la v√©rification de la somme de contr√¥le pour ce fichier. </font><font style="vertical-align: inherit;">En d'autres termes, pas de vache - pas de somme de contr√¥le. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien s√ªr, d√©finissez manuellement l'attribut</font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chaque fichier est une t√¢che ingrate. Si cet indicateur du r√©pertoire / sous-volume est d√©fini, tous les nouveaux fichiers cr√©√©s dans celui-ci h√©riteront automatiquement de l'indicateur. Il en va de m√™me pour les r√©pertoires imbriqu√©s cr√©√©s. Si au moment o√π l'attribut a √©t√© activ√©, des donn√©es √©taient d√©j√† dans le r√©pertoire, cela ne les affectera en aucune fa√ßon - l'attribut </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne peut √™tre d√©fini que dans un fichier nouveau ou vide. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et une autre fa√ßon de d√©finir l'indicateur automatiquement </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">est de monter le syst√®me de fichiers avec l'option </font></font><code>nodatacow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="plaintext hljs">mount -o subvol=path/to/subvol,nodatacow /dev/sdXX /path/to/mountpoint</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette option entra√Ænera la connexion automatique de l'option </font></font><code>nodatasum</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, de sorte que pour les fichiers nouvellement cr√©√©s, les sommes de contr√¥le ne seront pas calcul√©es. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme d'habitude, il y a une nuance: vous ne pouvez pas monter un seul subwoofer avec une option </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Soit tous les sous-volumes auront une option </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, soit aucune. Tout est d√©cid√© par le premier sous-volume mont√©: si une option √©tait sp√©cifi√©e </font></font><code>nodatacow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, tous les montages suivants iront automatiquement avec cette option. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un moment non √©vident se produit si vous placez un indicateur sur un fichier </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et supprimez l'instantan√© du sous-volume dans lequel se trouve ce fichier. Dans ce cas, btrfs ignore l'indicateur </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">si plusieurs sous-volumes font r√©f√©rence au bloc de donn√©es mis √† jour. Par cons√©quent, malgr√© le drapeau</font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(par ailleurs, le fichier en h√©ritera √©galement dans l'instantan√©), les modifications apport√©es √† l'un des fichiers iront dans une nouvelle zone sur le disque et le fichier sera √† nouveau fragment√©. </font><font style="vertical-align: inherit;">Si le bloc de donn√©es du fichier est mis √† jour plusieurs fois, la premi√®re fois, il tombera dans une nouvelle zone sur le disque et, avec les entr√©es suivantes, il sera mis √† jour dans cette nouvelle zone ¬´en place¬ª.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Astuces et √©checs </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Lorsque vous utilisez btrfs-progs, vous pouvez omettre le nom complet de la commande: </font></font><br><br><pre> <code class="plaintext hljs">btrfs sub cre = btrfs subvolume create</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Il suffit juste de la co√Øncidence des premiers caract√®res, qui d√©terminent uniquement la commande: </font></font><br><br><pre> <code class="plaintext hljs">su = subvolume, fi = filesystem, ba = balance, de = device;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je pense que le principe est clair. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√©las, btrfs ne peut pas cr√©er un instantan√© du r√©pertoire, mais il existe une solution:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©er un sous-volume </font></font><br><br><pre> <code class="plaintext hljs">btrfs subvolume create ./subvol</code> </pre> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> copiez les fichiers du r√©pertoire dans le sous-volume: </font></font><br><br><pre> <code class="plaintext hljs">cp -ax --reflink=always your/dir/. ./subvol</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">la cl√© </font></font><code>reflink=always</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">utilisera le m√©canisme CoW, c'est-√†-dire </font><font style="vertical-align: inherit;">les donn√©es ne seront pas copi√©es, mais des liens vers celles-ci seront cr√©√©s √† un btrfs de bas niveau.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Maintenant, le sous-monde contient tous les fichiers qui se trouvaient dans le r√©pertoire, et vous pouvez en supprimer l'instantan√©. </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous </font></font><code>nocow</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne pouvez pas d√©finir l' </font><font style="vertical-align: inherit;">attribut sur un </font><font style="vertical-align: inherit;">fichier de donn√©es existant. </font><font style="vertical-align: inherit;">Cependant, vous pouvez suivre le chemin suivant:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cr√©er un fichier vide </font></font><br><br><pre> <code class="plaintext hljs">touch nocowfile</code> </pre> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lui mettre un drapeau </font></font><code>nocow</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> allouer de l'espace disque pour un nouveau fichier </font></font><br><br><pre> <code class="plaintext hljs">fallocate -l10g nocowfile</code> </pre> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> copier le contenu d'un fichier existant dans </font></font><br><br><pre> <code class="plaintext hljs">cp -v oldcowfile nocowfile</code> </pre> </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si btrfs manque d'espace, m√™me la suppression d'un fichier peut provoquer une erreur </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬´Il ne reste plus d'espace sur le p√©riph√©rique¬ª</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Pour la solution, il est recommand√© de connecter un lecteur temporaire avec des tailles de pr√©f√©rence d'au moins 1 Go √† btrfs. </font><font style="vertical-align: inherit;">Nettoyez ensuite les donn√©es. </font><font style="vertical-align: inherit;">Retirez ensuite le lecteur temporaire. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'op√©ration d' </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√©quilibrage</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , invoqu√©e sans sp√©cifier de profils d'√©criture, les fait implicitement passer de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √† </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">raid1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Ce qui est d'ailleurs √©crit sur la page </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gotchas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Cela se produit apr√®s l'ajout du disque √† btrfs, qui utilise le profil d'√©criture </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Rappelez-vous que le formatage d'un seul lecteur dans btrfs utilise le profil de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dup</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> par d√©faut pour les m√©tadonn√©es et les donn√©es syst√®me.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Peut-√™tre le plus important </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âvitez de cr√©er des clones de bas niveau de p√©riph√©riques de blocs avec btrfs. √âtant un syst√®me de fichiers ¬´intelligent¬ª, pour certaines op√©rations (le plus souvent, lors du montage), btrfs relit les donn√©es syst√®me sur les p√©riph√©riques de bloc par lui-m√™me pour trouver toutes les parties du syst√®me de fichiers. Si deux p√©riph√©riques de bloc avec les m√™mes UUID sont trouv√©s dans le processus de recherche, alors btrfs les acceptera comme faisant partie de la m√™me instance. Si, cependant, ces deux p√©riph√©riques s'av√®rent √™tre l'original et son clone, alors apr√®s le montage, le pilote seul sait comment le syst√®me de fichiers fonctionnera, mais il est clair que cela ne se terminera pas par quelque chose de bon. Dans le pire des cas, cela entra√Ænera une corruption irr√©versible des donn√©es.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous voulez vraiment cloner des disques avec btrfs de mani√®re basique, une extr√™me prudence doit √™tre prise. </font><font style="vertical-align: inherit;">En g√©n√©ral, un clone ne doit pas √™tre visible par le noyau du syst√®me d'exploitation en tant que p√©riph√©rique de bloc tant que l'original est pr√©sent dans le syst√®me, et vice versa. </font><font style="vertical-align: inherit;">En fournissant cette condition, vous pouvez changer l'UUID du clone (enfin, ou l'original, ici facultatif). </font><font style="vertical-align: inherit;">L'utilitaire </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">btrfstune</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fourni avec le package </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">btrfs-progs vous aidera √†</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="plaintext hljs">btrfstune -u /path/to/device</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et encore: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">btrfstune</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , √©tant un utilitaire ¬´intelligent¬ª, changera l'UUID non seulement sur le disque, mais sur l'ensemble du syst√®me de fichiers. </font><font style="vertical-align: inherit;">Cela signifie que lorsqu'elle sera appel√©e, elle lira tous les p√©riph√©riques de bloc afin de remplacer l'UUID sur tous les p√©riph√©riques li√©s au syst√®me de fichiers.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Au lieu d'une conclusion </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si en ce moment vous ne comprenez rien, c'est normal. Btrfs n'est pas trivial et peut ne pas succomber imm√©diatement. Chaque fois qu'il me semblait que maintenant je la comprenais, elle me faisait une surprise et lui faisait repenser les choses existantes. Je ne peux pas dire que j'ai tout compris √† l'heure actuelle - en train d'√©crire, j'ai trouv√© quelque chose de nouveau, m√™me si j'ai d√©j√† √©crit sur la base de mon exp√©rience. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je comparerais le processus de ma√Ætrise de btrfs avec la transition d'un style de programmation proc√©dural √† un style orient√© objet. La premi√®re impression est ¬´wow, comme c'est g√©nial¬ª, mais ensuite vous continuez constamment √† √©crire du code proc√©dural envelopp√© dans des classes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans l'article, j'ai essay√© de ne pas verser d'eau - d'√©crire tout sur l'affaire. </font><font style="vertical-align: inherit;">Malgr√© cela, cela s'est av√©r√© assez volumineux. </font><font style="vertical-align: inherit;">Mais loin de tout, il √©tait possible de le dire - vous pouvez toujours √©crire et √©crire sur btrfs. </font><font style="vertical-align: inherit;">Cet article n'est que la pointe de l'iceberg. </font><font style="vertical-align: inherit;">Le tout d√©but est de comprendre sa philosophie et de commencer √† l'utiliser. </font><font style="vertical-align: inherit;">Et maintenant, il est temps de finir. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Merci d'avoir lu jusqu'au bout. </font><font style="vertical-align: inherit;">J'esp√®re pas fatigu√©. </font><font style="vertical-align: inherit;">√âcrivez dans les commentaires ce que vous aimeriez savoir d'autre. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faites des sauvegardes, messieurs. </font><font style="vertical-align: inherit;">Et laissez-les ne jamais vous √™tre utiles.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr458250/">https://habr.com/ru/post/fr458250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr458240/index.html">Comment l'intelligence artificielle, les drones et les cam√©ras assurent la s√©curit√© des routes et des ponts</a></li>
<li><a href="../fr458242/index.html">Le nouvel op√©rateur de vaisseau spatial en C ++ 20</a></li>
<li><a href="../fr458244/index.html">Une liste interminable et ridicule de ce que vous devez savoir pour utiliser en toute s√©curit√© les r√©seaux Wi-Fi publics</a></li>
<li><a href="../fr458246/index.html">Co√Øncidences al√©atoires dans la vie, ou comment il s'est av√©r√© qu'on vous a pr√©sent√© un g√¢teau dans une usine de tracteurs</a></li>
<li><a href="../fr458248/index.html">Simplifiez votre code avec Rocket Science: l'op√©rateur de vaisseau spatial de C ++ 20</a></li>
<li><a href="../fr458252/index.html">Mod√®le math√©matique d'un radiot√©lescope super long</a></li>
<li><a href="../fr458256/index.html">N'est-il pas temps pour le lavage de cerveau?</a></li>
<li><a href="../fr458260/index.html">Une autre fa√ßon d'optimiser les images Docker pour les applications Java</a></li>
<li><a href="../fr458262/index.html">Concepteur en ligne de la salle de r√©union - s√©lection de la solution optimale pour la visioconf√©rence</a></li>
<li><a href="../fr458264/index.html">10 principes du code auto-document√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>