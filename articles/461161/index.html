<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤮 👂🏻 🧔🏿 Delegado de preferencias de Android 🛬 🥙 🦌</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artículo muestra un ejemplo de cómo crear un delegado para SharedPreferences, lo que reduce la repetitiva y hace que el uso de SharedPrefernces s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Delegado de preferencias de Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461161/"><p> Este artículo muestra un ejemplo de cómo crear un delegado para SharedPreferences, lo que reduce la repetitiva y hace que el uso de SharedPrefernces sea más conveniente.  Aquellos que quieran ver el resultado pueden recurrir a una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solución preparada.</a> </p><a name="habracut"></a><br><p>  Una de las tareas urgentes de desarrollo para Android es guardar los datos entre sesiones.  Las principales formas de hacer esto: almacenar en el servidor o en archivos en el dispositivo ejecutable.  Una de las primeras formas en que cualquier desarrollador novato de Android puede conocer esto es almacenarlo en un archivo utilizando la herramienta SharedPreferences ya preparada. </p><br><p>  Digamos que necesitamos registrar el nombre de usuario y luego mostrarlo en algún lugar de la aplicación. </p><br><pre><code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences: SharedPreferences) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preferences.getString(USER_NAME, <span class="hljs-string"><span class="hljs-string">""</span></span>) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveUserName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(userName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { preferences.edit().putString(USER_NAME, userName).apply() } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> USER_NAME = <span class="hljs-string"><span class="hljs-string">"user_name"</span></span> } }</code> </pre> <br><h2 id="chto-takoe-delegat-i-kak-ego-gotovyat">  ¿Qué es un delegado y cómo se prepara? </h2><br><p>  En pocas palabras, esta es una clase que encapsula la configuración y la obtención de una propiedad.  ¿Quién quiere saber más <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación oficial</a> ? </p><br><p>  Para hacer que una clase sea un delegado, debe implementar la interfaz ReadOnlyProperty para val y ReadWriteProperty para var.  Pasamos SharedPreferences, la clave por la cual la propiedad y el valor predeterminado se almacenarán a través del constructor.  En setValue establece el valor para getValue obtener el valor. </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringPreferencesDelegate</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences: SharedPreferences, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> defValue: String ) : ReadWriteProperty&lt;Any?, String?&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;, value: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span> { preferences.edit().putString(name, value).apply() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: String? { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> preferences.getString(name, defValue) } }</code> </pre> <br><h3 id="primenyaem-delegat">  Aplicar delegado </h3><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences: SharedPreferences) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userName: String <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> StringPreferencesDelegate(preferences, USER_NAME, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> USER_NAME = <span class="hljs-string"><span class="hljs-string">"user_name"</span></span> } }</code> </pre> <br><p>  La asignación a una propiedad delegada se realiza mediante la palabra clave.  Ahora, cada vez que se solicita o establece esta propiedad, se iniciarán los métodos getValue y setValue del delegado creado. </p><br><p>  Ahora se puede hacer lo mismo con otros campos, por ejemplo, si desea guardar el teléfono del usuario de la misma manera. </p><br><pre> <code class="kotlin hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userPhone: String <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> StringPreferencesDelegate(preferences, USER_PHONE, <span class="hljs-string"><span class="hljs-string">""</span></span>)</code> </pre> <br><h2 id="generic">  Genérico </h2><br><p>  Para no hacer un delegado separado para cada tipo de datos, utilizamos generalizaciones de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentación oficial genérica</a> . </p><br><p>  Por lo general, el primer conocimiento inconsciente de genérico ocurre cuando se crea una instancia de la clase Lista.  Para ello, se determina el tipo de datos específico con el que trabaja. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> names :List&lt;String&gt; = listOf(<span class="hljs-string"><span class="hljs-string">"Jon"</span></span>,<span class="hljs-string"><span class="hljs-string">"Bob"</span></span>,<span class="hljs-string"><span class="hljs-string">"Max"</span></span>)</code> </pre> <br><p>  Para especificar un tipo de datos generalizado para una clase después de su nombre, debe especificar el nombre de esta variable entre paréntesis angulares. </p><br><pre> <code class="kotlin hljs">PreferencesDelegate&lt;TValue&gt;(...)</code> </pre> <br><p>  Ahora debe especificar que el valor establecido y el valor predeterminado son del tipo TValue. </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreferencesDelegate</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TValue</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences: SharedPreferences, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> defValue: TValue ) : ReadWriteProperty&lt;Any?, TValue&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: TValue { ... } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;, value: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TValue</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { ... } }</code> </pre> <br><p>  En consecuencia, ahora crear una instancia de la clase se ve así: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userName: String? <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> StringPreferencesDelegate&lt;String?&gt;(...)</code> </pre> <br><p>  Queda por hacer el mapeo de obtención y configuración de las propiedades, determinamos el tipo de datos por delaultValue, al mismo tiempo da un reparto inteligente de este valor al tipo de datos específico, si algo salió mal y la propiedad no es del tipo TValue, devolvemos defValue. </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: TValue { with(preferences) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (defValue) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> -&gt; (preferences.getBoolean(name, defValue) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? TValue) ?: defValue ... } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;, value: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TValue</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { with(preferences.edit()) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (value) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> -&gt; putBoolean(name, value) ... } apply() } }</code> </pre> <br><p>  Con otros tipos de datos es similar. </p><br><h2 id="kastomnaya-oshibka">  Error personalizado </h2><br><p>  La pregunta sigue siendo qué hacer con la rama else, ya que el tipo TValue puede ser absolutamente cualquier cosa. <br>  Es una buena forma cometer su error personalizado.  Si ocurre una excepción, entonces será lo más claro posible lo que sucedió. </p><br><pre> <code class="kotlin hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotFoundRealizationException</span></span></span></span>(value: Any?) : Exception(<span class="hljs-string"><span class="hljs-string">"not found realization for </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${value?.javaClass}</span></span></span><span class="hljs-string">"</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> NotFoundRealizationException(value) ...</code> </pre> <br><h2 id="ending">  Conclusión </h2><br><p>  En total, tenemos un delegado listo para usar: </p><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Suppress(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UNCHECKED_CAST"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreferencesDelegate</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TValue</span></span></span><span class="hljs-class">&gt;</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences: SharedPreferences, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> defValue: TValue ) : ReadWriteProperty&lt;Any?, TValue&gt; { <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: TValue { with(preferences) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (defValue) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> -&gt; (getBoolean(name, defValue) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? TValue) ?: defValue <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; (getInt(name, defValue) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TValue) ?: defValue <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> -&gt; (getFloat(name, defValue) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TValue) ?: defValue <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span> -&gt; (getLong(name, defValue) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TValue) ?: defValue <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> String -&gt; (getString(name, defValue) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TValue) ?: defValue <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> NotFoundRealizationException(defValue) } } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(thisRef: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Any</span></span></span></span><span class="hljs-function"><span class="hljs-params">?, property: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">KProperty</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;, value: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">TValue</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { with(preferences.edit()) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (value) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> -&gt; putBoolean(name, value) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; putInt(name, value) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> -&gt; putFloat(name, value) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span> -&gt; putLong(name, value) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> String -&gt; putString(name, value) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> NotFoundRealizationException(value) } apply() } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotFoundRealizationException</span></span></span></span>(defValue: Any?) : Exception(<span class="hljs-string"><span class="hljs-string">"not found realization for </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$defValue</span></span></span><span class="hljs-string">"</span></span>) }</code> </pre> <br><p>  Ejemplo de aplicación </p><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserStore</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> preferences: SharedPreferences) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userName: String <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> PreferencesDelegate(preferences, USER_NAME, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userPhone: String <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> PreferencesDelegate(preferences, USER_PHONE, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isShowLicence: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> PreferencesDelegate(preferences, USER_LICENCE, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> USER_NAME = <span class="hljs-string"><span class="hljs-string">"user_name"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> USER_PHONE = <span class="hljs-string"><span class="hljs-string">"user_phone"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> USER_LICENCE = <span class="hljs-string"><span class="hljs-string">"user_licence"</span></span> } }</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461161/">https://habr.com/ru/post/461161/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461151/index.html">De la idea a la producción: desarrollo del proyecto IoT</a></li>
<li><a href="../461153/index.html">WebComponents como frameworks, interacción de componentes</a></li>
<li><a href="../461155/index.html">Charity Cloud: Guía de migración</a></li>
<li><a href="../461157/index.html">Qué ofrecerá Feedback Assistant: una plataforma de desarrollador que reemplazará a Bug Reporter</a></li>
<li><a href="../461159/index.html">Ivideon Bridge: cómo conectar sistemas CCTV heredados a la nube</a></li>
<li><a href="../461163/index.html">¿Qué vincula la paradoja del cumpleaños y la vulnerabilidad de las firmas electrónicas?</a></li>
<li><a href="../461165/index.html">La biometría se acerca</a></li>
<li><a href="../461171/index.html">Telegram aprendió a disfrazarse de HTTPS</a></li>
<li><a href="../461175/index.html">27 cosas que me gustaría saber de antemano antes de comenzar la programación</a></li>
<li><a href="../461177/index.html">Historial de Internet: ARPANET - Subred</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>