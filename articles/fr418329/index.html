<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖ üìò ‚òùüèæ Organisation de tests s√ªrs en production. 2e partie ü§õüèø üë∞üèº üå¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cette partie de l'article, nous continuerons √† consid√©rer diff√©rents types de tests en production. Ceux qui ont saut√© la premi√®re partie peuvent ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Organisation de tests s√ªrs en production. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/funcorp/blog/418329/"><img src="https://habrastorage.org/webt/ht/ra/sh/htrashsucmi8c4a6nok7rihdoay.png"><br><br>  Dans cette partie de l'article, nous continuerons √† consid√©rer diff√©rents types de tests en production.  Ceux qui ont saut√© la premi√®re partie peuvent le lire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Pour le reste - bienvenue au chat. <br><a name="habracut"></a><br><h2>  Tests de production: version </h2><br>  Apr√®s avoir test√© le service apr√®s le <i>d√©ploiement</i> , il doit √™tre pr√©par√© pour sa <i>publication</i> . <br>  Il est important de noter qu'√† ce stade, l'annulation des changements n'est possible que dans des situations d'√©chec <i>durable</i> , par exemple: <br><br><ul><li>  boucle de panne de service; </li><li>  d√©passement du temps d'attente pour un nombre important de connexions en amont, provoquant une forte augmentation de la fr√©quence des erreurs; </li><li>  changement de configuration inacceptable, par exemple, l'absence d'une cl√© secr√®te dans une variable d'environnement qui provoque l'√©chec du service (les variables d'environnement sont g√©n√©ralement mieux √† √©viter, mais c'est un sujet pour une autre discussion). </li></ul><br>  Des tests approfondis au stade du <i>d√©ploiement</i> me permettent de minimiser id√©alement ou d'√©viter compl√®tement les mauvaises surprises au stade de la <i>sortie</i> .  Cependant, il existe un certain nombre de recommandations pour publier en toute s√©curit√© un nouveau code. <br><br><h3>  D√©ploiement des Canaries </h3><br>  <i>Le d√©ploiement Canary</i> est une <i>version</i> partielle <i>d'un</i> service en production.  √Ä mesure que le bilan de sant√© de base passe, les petites parties du trafic de l'environnement de production actuel sont envoy√©es aux parties valid√©es.  Les r√©sultats des parties du service sont surveill√©s au fur et √† mesure que le trafic est trait√©, les indicateurs sont compar√©s √† ceux de r√©f√©rence (non li√©s √† ceux des canaris), et s'ils tombent en dehors des valeurs de seuil acceptables, un retour √† l'√©tat pr√©c√©dent est effectu√©.  Bien que cette approche soit g√©n√©ralement utilis√©e lors de la publication d'un logiciel serveur, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">test canari du logiciel client</a> devient √©galement plus courant. <br><br>  Divers facteurs influencent le trafic qui sera utilis√© pour le d√©ploiement des canaris.  Dans un certain nombre d'entreprises, les parties du service publi√©es ne re√ßoivent d'abord que du trafic utilisateur interne (appel√© dogfooding).  Si aucune erreur n'est observ√©e, une petite partie du trafic de l'environnement de production est ajout√©e, apr√®s quoi un d√©ploiement complet est effectu√©.  Il est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">recommand√© de</a> revenir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">automatiquement</a> √† l'√©tat pr√©c√©dent en cas de r√©sultats de d√©ploiement canaries non valides, et des outils tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Spinnaker</a> ont une prise en charge int√©gr√©e pour les fonctions automatis√©es d'analyse et de restauration. <br><br>  Il y a quelques probl√®mes avec le test canari, et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://">cet article en</a> donne un aper√ßu assez complet. <br><br><h3>  Suivi </h3><br>  La surveillance est une proc√©dure absolument n√©cessaire √† <i>chaque</i> √©tape du d√©ploiement du produit en production, mais cette fonction sera particuli√®rement importante au stade de la <i>version</i> .  La surveillance est bien adapt√©e pour obtenir des informations sur le niveau g√©n√©ral de performances du syst√®me.  Mais tout surveiller dans le monde n'est peut-√™tre pas la meilleure solution.  <i>Une</i> surveillance <i>efficace</i> est effectu√©e de mani√®re ponctuelle, ce qui vous permet d'identifier un petit ensemble de modes de d√©faillance durable du syst√®me ou un ensemble de base d'indicateurs.  Des exemples de tels modes de d√©faillance peuvent √™tre: <br><br><ul><li>  augmentation du taux d'erreur; </li><li>  une diminution de la vitesse globale de traitement des demandes tout au long du service, √† un point de terminaison sp√©cifique, ou, pire encore, un arr√™t complet du travail; </li><li>  retard accru. </li></ul><br>  L'observation de l'un de ces modes de d√©faillance durable est √† la base d'un retour imm√©diat √† un √©tat pr√©c√©dent ou d'un retour en arri√®re des nouvelles versions de logiciels <i>publi√©es</i> .  Il est important de se rappeler que le suivi √† ce stade est peu susceptible d'√™tre complet et indicatif.  Beaucoup pensent que le nombre id√©al de signaux surveill√©s pendant la surveillance est de 3 √† 5, mais <i>certainement</i> pas plus de 7-10.  Le livre blanc de Kraken Facebook propose la solution suivante: <br><br>  <i>¬´Le probl√®me est r√©solu √† l'aide d'un composant de surveillance facilement configurable, qui signale deux indicateurs de base (le 99e centile du temps de r√©ponse du serveur Web et la fr√©quence d'occurrence d'erreurs HTTP fatales) qui d√©crivent objectivement la qualit√© de l'interaction utilisateur.¬ª</i> <br><br>  Il est pr√©f√©rable de d√©terminer l'ensemble d'indicateurs syst√®me et d'application surveill√©s pendant la phase de publication lors de la conception du syst√®me. <br><br><h3>  Suivi des exceptions </h3><br>  Nous parlons de suivre les exceptions au stade de la publication, bien qu'il puisse sembler qu'au stade du <i>d√©ploiement</i> et apr√®s la publication, cela ne serait pas moins utile.  Les outils de suivi des exceptions ne garantissent souvent pas la m√™me rigueur, pr√©cision et couverture de masse que certains autres outils de surveillance du syst√®me, mais ils peuvent toujours √™tre tr√®s utiles. <br><br>  Les outils open source (tels que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sentry</a> ) affichent des informations avanc√©es sur les demandes entrantes et cr√©ent des piles de donn√©es de trace et de variables locales, ce qui simplifie consid√©rablement le processus de d√©bogage, qui consiste g√©n√©ralement √† afficher les journaux des √©v√©nements.  Le suivi des exceptions est √©galement utile lors du tri et de la hi√©rarchisation des probl√®mes qui ne n√©cessitent pas un retour complet √† un √©tat pr√©c√©dent (par exemple, un cas limite qui l√®ve une exception). <br><br><h3>  Mise en forme du trafic </h3><br>  La mise en forme du trafic (redistribution du trafic) n'est pas tant une forme ind√©pendante de test qu'un outil pour soutenir l'approche canarienne et la publication progressive d'un nouveau code.  En fait, la mise en forme du trafic est assur√©e par la mise √† jour de la configuration de l'√©quilibreur de charge, qui vous permet de rediriger progressivement plus de trafic vers la nouvelle version <i>publi√©e</i> . <br><br>  Cette m√©thode est √©galement utile pour le d√©ploiement progressif de nouveaux logiciels (distinct du d√©ploiement normal).  Prenons un exemple.  Imgix devait d√©ployer une architecture d'infrastructure fondamentalement nouvelle en juin 2016.  Apr√®s les premiers tests de la nouvelle infrastructure avec une certaine quantit√© de trafic sombre, ils ont commenc√© √† se d√©ployer en production, redirigeant initialement environ 1% du trafic de l'environnement de production vers une nouvelle pile.  Puis, au cours de plusieurs semaines, le volume de donn√©es arrivant sur la nouvelle pile a augment√© (r√©solvant les probl√®mes en cours de route), jusqu'√† ce qu'il commence √† traiter 100% du trafic. <br><br>  La popularit√© de l'architecture de maillage de service a d√©clench√© une nouvelle vague d'int√©r√™t pour les serveurs proxy.  En cons√©quence, les anciens (nginx, HAProxy) et les nouveaux (Envoy, Conduit) proxys ont ajout√© un support pour de nouvelles fonctions afin de d√©passer les concurrents.  Il me semble que l'avenir, dans lequel la redistribution du trafic de 0 √† 100% au stade de la sortie du produit se fait automatiquement, approche √† grands pas. <br><br><h2>  Tests de production: apr√®s publication </h2><br>  Les tests post-publication sont effectu√©s comme une v√©rification effectu√©e <i>apr√®s une</i> <i>publication</i> r√©ussie <i>du</i> code.  √Ä ce stade, vous pouvez √™tre s√ªr que le code dans son ensemble est correct, qu'il a √©t√© correctement <i>publi√©</i> en production et traite correctement le trafic.  Le code d√©ploy√© est directement ou indirectement utilis√© dans des conditions r√©elles, au service de clients r√©els ou pour l'ex√©cution de t√¢ches ayant un impact significatif sur l'entreprise. <br><br>  Le but de tout test √† ce stade est principalement de v√©rifier l‚Äôop√©rabilit√© du syst√®me, en tenant compte des diff√©rentes charges et sch√©mas de trafic possibles.  La meilleure fa√ßon de le faire est de collecter des preuves documentaires de tout ce qui se passe en production et de les utiliser √† la fois pour le d√©bogage et pour obtenir une image compl√®te du syst√®me. <br><br><h3>  Marquage de fonctionnalit√© ou lancement sombre </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://">La publication la plus ancienne</a> sur l'utilisation r√©ussie des indicateurs de fonctionnalit√© que j'ai trouv√©e a √©t√© publi√©e il y a pr√®s de dix ans.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Featureflags.io</a> fournit le guide le plus complet √† ce sujet. <br><br>  <i>¬´Le marquage des fonctionnalit√©s est une m√©thode utilis√©e par les d√©veloppeurs pour marquer une nouvelle fonction √† l'aide d'instructions if-then, ce qui permet un meilleur contr√¥le sur sa sortie.</i>  <i>En signalant une fonction et en l'isolant de cette mani√®re, le d√©veloppeur peut activer et d√©sactiver cette fonction quel que soit l'√©tat du d√©ploiement.</i>  <i>Cela s√©pare efficacement la publication de la fonction du d√©ploiement du code. "</i> <br><br>  En signalant le nouveau code, vous pouvez tester ses performances et ses performances en production selon vos besoins.  Le signalement des fonctionnalit√©s est l'un des types de tests g√©n√©ralement accept√©s en production, il est bien connu et est souvent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crit</a> dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diverses sources</a> .  Le fait que cette m√©thode puisse √™tre utilis√©e pour tester le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">transfert de bases de donn√©es</a> ou de logiciels pour des syst√®mes personnels est beaucoup moins connu. <br><br>  Les auteurs d'articles √©crivent rarement sur les meilleures m√©thodes de d√©veloppement et d'utilisation des drapeaux de fonction.  L'utilisation incontr√¥l√©e de drapeaux peut √™tre un probl√®me grave.  Le manque de discipline en termes de suppression des indicateurs inutilis√©s apr√®s une p√©riode sp√©cifi√©e conduit parfois au fait que vous devez effectuer un audit complet et supprimer les indicateurs obsol√®tes accumul√©s au cours des mois (sinon des ann√©es) de travail. <br><br><h3>  Test A / B </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les tests A / B sont</a> souvent effectu√©s dans le cadre d'une analyse exp√©rimentale et ne sont pas consid√©r√©s comme des tests en production.  Pour cette raison, les tests A / B sont non seulement largement utilis√©s (parfois m√™me de mani√®re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">douteuse</a> ), mais √©galement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">activement</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://">√©tudi√©s</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©crits</a> (y compris des articles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce qui d√©termine un tableau</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bord efficace</a> pour les exp√©riences en ligne).  Beaucoup moins souvent, les tests A / B sont utilis√©s pour tester diverses configurations mat√©rielles ou machines virtuelles.  Ils sont souvent appel√©s ¬´tuning¬ª (par exemple, tuning JVM), mais ils ne sont pas class√©s comme des tests A / B typiques (bien que le tuning puisse √™tre consid√©r√© comme un type de test A / B effectu√© avec le m√™me niveau de rigueur en ce qui concerne les mesures) . <br><br><h3>  Journaux, √©v√©nements, indicateurs et tra√ßage </h3><br>  Vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pouvez en savoir plus</a> sur les soi-disant ¬´trois baleines observables¬ª - journaux, indicateurs et suivi distribu√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h3>  Profilage </h3><br>  Dans certains cas, pour diagnostiquer les probl√®mes de performances, il est n√©cessaire d'utiliser le profilage d'application en production.  Selon les langues et les temps d'ex√©cution pris en charge, le profilage peut √™tre une proc√©dure assez simple, qui consiste √† ajouter une seule ligne de code √† l'application ( <code>import _ "net/http/pprof"</code> dans le cas de Go).  D'autre part, cela peut n√©cessiter l'utilisation de nombreux outils ou tester le processus par la m√©thode de la bo√Æte noire et v√©rifier les r√©sultats √† l'aide d'outils tels que des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">graphiques</a> √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">flamme</a> . <br><br><h3>  Test de d√©part </h3><br>  Beaucoup de gens consid√®rent ces tests comme quelque chose comme la duplication fant√¥me des donn√©es, car dans les deux cas, le trafic de l'environnement de production est envoy√© vers des clusters ou des processus hors production.  √Ä mon avis, la diff√©rence est que l'utilisation du trafic √† <i>des</i> fins de <i>test</i> est quelque peu diff√©rente de son utilisation √† <i>des</i> fins de <i>d√©bogage</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://">Etsy a √©crit sur son blog √†</a> propos de l'utilisation des tee-tests comme outil de v√©rification (cet exemple ressemble vraiment √† la duplication fant√¥me des donn√©es). <br>  <i>¬´Ici, <b>tee</b> peut √™tre compris comme la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tee</a> sur la ligne de commande.</i>  <i>Nous avons √©crit une r√®gle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://devcentral.f5.com/articles/">iRule</a> bas√©e sur un √©quilibreur de charge F5 existant pour cloner le trafic HTTP dirig√© vers l'un des pools et le rediriger vers un autre pool.</i>  <i>Ainsi, nous avons pu utiliser le trafic de l'environnement de production dirig√© vers notre cluster API et en envoyer une copie au cluster HHVM exp√©rimental, ainsi qu'√† un cluster PHP isol√© pour comparaison.</i> <i><br></i>  <i>Cette technique s'est av√©r√©e tr√®s efficace.</i>  <i>Il nous a permis de comparer les performances des deux configurations en utilisant des profils de trafic identiques. ¬ª</i> <br><br>  Cependant, parfois un test de d√©part bas√© sur le trafic de l'environnement de production dans un syst√®me autonome est requis pour le <i>d√©bogage</i> .  Dans de tels cas, le syst√®me autonome peut √™tre modifi√© pour configurer la sortie d'informations de diagnostic suppl√©mentaires ou une autre proc√©dure de compilation (par exemple, en utilisant l'outil de nettoyage de flux), ce qui simplifie consid√©rablement le processus de d√©pannage.  Dans de tels cas, les tests en t√© devraient √™tre consid√©r√©s, plut√¥t que <i>des outils de d√©bogage</i> , plut√¥t qu'une <i>v√©rification</i> . <br><br>  Auparavant, de tels types de d√©bogage √©taient relativement rares dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">imgix</a> , mais ils √©taient toujours utilis√©s, en particulier lorsqu'il s'agissait de probl√®mes avec des applications de d√©bogage sensibles au d√©lai. <br><br>  Par exemple, voici une description analytique de l'un de ces incidents survenus en 2015.  L'erreur 400 s'est produite si rarement qu'elle n'a presque pas √©t√© vue lors de la tentative de reproduction du probl√®me.  Elle est apparue dans quelques cas sur un milliard.  Il y en avait tr√®s peu pendant la journ√©e.  En cons√©quence, il s'est av√©r√© qu'il √©tait tout simplement impossible de reproduire le probl√®me de mani√®re fiable, il √©tait donc n√©cessaire d'effectuer un d√©bogage √† l'aide du trafic de travail afin d'avoir une chance de suivre l'occurrence de cette erreur.  Voici ce que mon ancien coll√®gue a √©crit √† ce sujet: <br><br>  <i>¬´J'ai choisi une biblioth√®que qui √©tait cens√©e √™tre interne, mais j'ai finalement d√ª cr√©er la mienne en fonction de la biblioth√®que fournie par le syst√®me.</i>  <i>Dans la version fournie par le syst√®me, une erreur se produisait p√©riodiquement qui n'apparaissait en aucune fa√ßon alors que la quantit√© de trafic √©tait faible.</i>  <i>Cependant, le nom tronqu√© dans le titre √©tait le vrai probl√®me.</i> <i><br><br></i>  <i>Au cours des deux jours suivants, j'ai √©tudi√© en d√©tail le probl√®me li√© √† l'augmentation de la fr√©quence des fausses erreurs 400. L'erreur s'est manifest√©e dans un tr√®s petit nombre de demandes, et les probl√®mes de ce type sont difficiles √† diagnostiquer.</i>  <i>Tout cela ressemblait √† l'aiguille notoire d'une botte de foin: le probl√®me √©tait rencontr√© dans un cas par milliard.</i> <i><br><br></i>  <i>La premi√®re √©tape pour localiser la source des erreurs a √©t√© d'obtenir toutes les donn√©es brutes de requ√™te HTTP qui ont abouti √† une r√©ponse incorrecte.</i>  <i>Pour effectuer un test de d√©part du trafic entrant lorsqu'il est connect√© √† un socket, j'ai ajout√© le point de terminaison de socket de domaine Unix au serveur de rendu.</i>  <i>L'id√©e √©tait de nous permettre d'activer et de d√©sactiver rapidement et facilement le flux de trafic sombre et d'effectuer des tests directement sur l'ordinateur du d√©veloppeur.</i>  <i>Pour √©viter les probl√®mes de production, il √©tait n√©cessaire de rompre la connexion en cas de probl√®me de contre-pression.</i>  <i>C'est-√†-dire</i>  <i>si le doublon ne pouvait pas faire face √† la t√¢che, il √©tait d√©connect√©.</i>  <i>Cette socket a √©t√© tr√®s utile dans certains cas lors du d√©veloppement.</i>  <i>Cette fois, cependant, nous l'avons utilis√© pour collecter le trafic entrant sur les serveurs s√©lectionn√©s, en esp√©rant obtenir suffisamment de requ√™tes pour r√©v√©ler le mod√®le qui a conduit √† l'apparition de fausses erreurs 400. En utilisant dsh et netcat, j'ai pu g√©n√©rer relativement facilement le trafic entrant dans un fichier local .</i> <i><br><br></i>  <i>La majeure partie de l'environnement a √©t√© consacr√©e √† la collecte de ces donn√©es.</i>  <i>D√®s que nous avions suffisamment de donn√©es, j'ai pu utiliser netcat pour les lire sur le syst√®me local, dont la configuration a √©t√© modifi√©e pour afficher une grande quantit√© d'informations de d√©bogage.</i>  <i>Et tout s'est parfaitement d√©roul√©.</i>  <i>L'√©tape suivante consiste √† lire les donn√©es √† la vitesse la plus √©lev√©e possible.</i>  <i>Dans ce cas, la boucle avec le contr√¥le de condition a envoy√© les requ√™tes brutes une √† la fois.</i>  <i>Apr√®s environ deux heures, j'ai r√©ussi √† obtenir le r√©sultat souhait√©.</i>  <i>Les donn√©es dans les journaux ont montr√© l'absence d'un en-t√™te!</i> <i><br><br></i>  <i>J'utilise du bois rouge-noir pour transmettre les en-t√™tes.</i>  <i>De telles structures consid√®rent la comparabilit√© comme une identit√©, ce qui en soi est tr√®s utile lorsqu'il existe des exigences particuli√®res pour les cl√©s: dans notre cas, les en-t√™tes HTTP n'√©taient pas sensibles √† la casse.</i>  <i>Au d√©but, nous pensions que le probl√®me √©tait dans le n≈ìud feuille de la biblioth√®que utilis√©e.</i>  <i>L'ordre d'addition affecte vraiment l'ordre de construction de l'arbre de base, et l'√©quilibrage de l'arbre rouge-noir est un processus assez compliqu√©.</i>  <i>Et bien que cette situation √©tait peu probable, elle n'√©tait pas impossible.</i>  <i>Je suis pass√© √† une autre impl√©mentation en √©b√®ne rouge.</i>  <i>Il a √©t√© corrig√© il y a plusieurs ann√©es, j'ai donc d√©cid√© de l'int√©grer directement dans la source pour obtenir exactement la version requise.</i>  <i>N√©anmoins, l'assemblage a choisi une version diff√©rente, et comme je comptais sur une version plus r√©cente, j'ai finalement eu un comportement incorrect.</i> <i><br><br></i>  <i>Pour cette raison, le syst√®me de visualisation a g√©n√©r√© 500 erreurs, ce qui a entra√Æn√© l'interruption du cycle.</i>  <i>C'est pourquoi l'erreur ne s'est produite qu'avec le temps.</i>  <i>Apr√®s le traitement cyclique de plusieurs assemblys, le trafic provenant d'eux a √©t√© redirig√© vers une route diff√©rente, ce qui a accru l'ampleur du probl√®me sur ce serveur.</i>  <i>Mon hypoth√®se selon laquelle le probl√®me √©tait dans la biblioth√®que s'est av√©r√©e incorrecte et le commutateur invers√© a r√©solu 500 erreurs.</i> <i><br><br></i>  <i>Je suis revenu √† 400 erreurs: il y avait toujours un probl√®me avec l'erreur, qui a pris environ deux heures √† d√©tecter.</i>  <i>Changer la biblioth√®que, √©videmment, n'a pas r√©solu le probl√®me, mais j'√©tais s√ªr que la biblioth√®que s√©lectionn√©e √©tait suffisamment fiable.</i>  <i>Ne r√©alisant pas l'erreur du choix, je n'ai rien chang√©.</i>  <i>Apr√®s avoir √©tudi√© la situation plus en d√©tail, je me suis rendu compte que la valeur correcte √©tait stock√©e dans un en-t√™te √† un seul caract√®re (par exemple, ¬´h: 12345¬ª).</i>  <i>J'ai finalement compris que h √©tait le caract√®re de fin de l'en-t√™te Content-Length.</i>  <i>En regardant √† nouveau les donn√©es, j'ai r√©alis√© que l'en-t√™te Content-Length √©tait vide.</i> <i><br><br></i>  <i>En cons√©quence, le tout √©tait une erreur de biais de un lors de la lecture des en-t√™tes.</i>  <i>L'analyseur HTTP nginx / joyent cr√©e des donn√©es partielles, et chaque fois que le champ d'en-t√™te partiel s'est av√©r√© √™tre un caract√®re plus court que n√©cessaire, j'ai envoy√© l'en-t√™te sans valeur et j'ai ensuite re√ßu un champ d'en-t√™te √† un caract√®re contenant la valeur correcte.</i>  <i>C'est une combinaison assez rare, donc son fonctionnement prend tellement de temps.</i>  <i>J'ai donc augment√© la quantit√© de collecte de donn√©es chaque fois qu'un en-t√™te √† un caract√®re est apparu, j'ai appliqu√© le correctif propos√© et j'ai r√©ussi √† ex√©cuter le script pendant plusieurs heures.</i> <i><br></i>  <i>Bien s√ªr, d'autres pi√®ges avec le dysfonctionnement de la biblioth√®que mentionn√© ont pu √™tre d√©tect√©s, mais les deux erreurs ont √©t√© corrig√©es. ¬ª</i> <i><br></i> <br><br>  Les ing√©nieurs impliqu√©s dans le d√©veloppement d'applications sensibles aux retards doivent pouvoir d√©boguer √† l'aide du trafic dynamique captur√©, car des erreurs se produisent souvent qui ne peuvent pas √™tre reproduites pendant les tests unitaires ou d√©tect√©es √† l'aide d'un outil de surveillance (en particulier s'il y a un retard important dans la journalisation). <br><br><h3>  Approche de l'ing√©nierie du chaos </h3><br>  <i>Chaos Engineering est une approche bas√©e sur des exp√©riences sur un syst√®me distribu√© afin de confirmer sa capacit√© √† r√©sister aux conditions chaotiques de l'environnement de production.</i> <br><br>  La m√©thode Chaos Engineering, d'abord rendue c√©l√®bre par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chaos Monkey de</a> Netflix, est maintenant devenue une discipline ind√©pendante.  Le terme Chaos Engineering est apparu r√©cemment, mais le test de panne est une pratique de longue date. <br><br>  Le terme ¬´tests chaotiques¬ª fait r√©f√©rence aux techniques suivantes: <br><br><ul><li>  d√©sactiver les n≈ìuds arbitraires pour d√©terminer la r√©sistance du syst√®me aux d√©faillances; </li><li>  introduire des erreurs (par exemple, augmenter le retard) afin de confirmer que le syst√®me les traite correctement; </li><li>  violation forc√©e du r√©seau afin de d√©terminer la r√©ponse du service. </li></ul><br>  La plupart des entreprises utilisent un environnement d'exploitation insuffisamment complexe et hi√©rarchis√© pour effectuer efficacement des tests chaotiques.  Il est important de souligner que l'introduction de d√©fauts dans le syst√®me se fait mieux apr√®s avoir d√©fini les fonctions de base de la tol√©rance aux d√©fauts.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ce livre blanc de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gremlin</a> fournit une description assez compl√®te des principes des tests chaotiques, ainsi que des instructions pour la pr√©paration de cette proc√©dure. <br><br>  <i>¬´Le fait que Chaos Engineering soit consid√©r√© comme une discipline scientifique est particuli√®rement important.</i>  <i>Dans cette discipline, des processus d'ing√©nierie de haute pr√©cision sont appliqu√©s.</i> <i><br></i>  <i>La t√¢che de Chaos Engineering est <b>de dire aux</b> utilisateurs quelque chose de nouveau sur les vuln√©rabilit√©s du syst√®me en effectuant des exp√©riences sur celui-ci.</i>  <i>Il est n√©cessaire d'identifier tous les probl√®mes cach√©s qui pourraient survenir dans la production, avant m√™me qu'ils ne provoquent une panne massive.</i>  <i>Ce n'est qu'apr√®s cela que vous pourrez √©liminer efficacement toutes les faiblesses du syst√®me et le rendre vraiment tol√©rant aux pannes. ¬ª</i> <br><br><h2>  Conclusion </h2><br>  Le but des tests en production n'est pas d' <i>√©liminer</i> compl√®tement toutes les d√©faillances possibles du syst√®me.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">John Allspaw</a> dit: <br>  <i>¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous constatons que les</a> syst√®mes deviennent de plus en plus tol√©rants aux pannes - et c'est formidable.</i>  <i>Mais nous devons admettre: ¬´de plus en plus¬ª n'est pas √©gal √† ¬´absolument¬ª.</i>  <i>Dans tout syst√®me complexe, une d√©faillance peut se produire (et se produira) de la mani√®re la plus impr√©visible. ¬ª</i> <i><br></i> <br>  Les tests en production √† premi√®re vue peuvent sembler une t√¢che assez compliqu√©e, allant bien au-del√† des comp√©tences de la plupart des soci√©t√©s d'ing√©nierie.  Et bien que de tels tests <i>ne</i> soient <i>pas</i> une t√¢che <i>facile</i> , associ√©e √† certains risques, si vous les suivez par toutes les r√®gles, ils aideront √† atteindre la fiabilit√© des syst√®mes distribu√©s complexes que l'on trouve partout aujourd'hui. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr418329/">https://habr.com/ru/post/fr418329/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr418317/index.html">2048 est interdit. Pas RosKomNadzor</a></li>
<li><a href="../fr418319/index.html">Ampoules LED Gauss 2017-2018</a></li>
<li><a href="../fr418321/index.html">G√©n√©rateur de nombres al√©atoires de photons: le cryptage le plus fiable?</a></li>
<li><a href="../fr418323/index.html">Un peu sur les attributs des h√¥tes, clavier, code et SCS dans la s√©rie "World of the Wild West" (Westworld)</a></li>
<li><a href="../fr418327/index.html">Cordonniers avec des bottes: quels smartphones les experts choisissent-ils pour eux-m√™mes</a></li>
<li><a href="../fr418331/index.html">Ma√Ætres des serveurs et des r√©seaux - joyeuses f√™tes</a></li>
<li><a href="../fr418333/index.html">Les robots Uber reprennent la route, mais les gens les conduiront</a></li>
<li><a href="../fr418335/index.html">Confrontation √† Positive Hack Days 8: analyse des cha√Ænes d'attaque</a></li>
<li><a href="../fr418337/index.html">Hot DataGrip d'√©t√© 2018.2</a></li>
<li><a href="../fr418341/index.html">Bonne journ√©e de l'administrateur syst√®me! Carte de voeux avec sens</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>