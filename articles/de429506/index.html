<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>➖ 👩🏼‍🔬 🙊 Wir schauen unter die Haube des neuen Google Mail 😡 🖥️ 👨🏼‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vor sechs Monaten hat Google eine aktualisierte Version seines E-Mail-Dienstes eingeführt. Trotz der Tatsache, dass viele Benutzer mit dem Redesign un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir schauen unter die Haube des neuen Google Mail</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429506/"><p>  Vor sechs Monaten hat Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">eine</a> aktualisierte Version seines E-Mail-Dienstes eingeführt.  Trotz der Tatsache, dass viele Benutzer mit dem Redesign unzufrieden waren, auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bei Habré</a> , ist dies nun die Hauptoberfläche für Benutzer. </p><br><p>  Unter anderem beschweren sich die Leute über den Leistungsabfall der neuen Version, insbesondere auf schwachen Computern.  Mal sehen, warum dies passiert und was in der Mail-Oberfläche so schwierig sein kann.  In diesem Artikel werden wir die Entwicklertools in Google Chrome verwenden, sodass dieser Artikel auch daran erinnert, welche Möglichkeiten dort verfügbar sind. </p><a name="habracut"></a><br><h2 id="ishodnye-dannye">  Ausgangsdaten </h2><br><p>  Zunächst müssen Sie verstehen, womit wir es zu tun haben.  Google Chrome Devtools verfügt über ein integriertes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lighthouse-</a> Tool, mit dem Sie einen einfachen und unkomplizierten Leistungsbericht für Ihre Website erstellen können.  Darin erhält Google Mail einen Leistungsschub (von maximal 100 Punkten!) </p><br><p><img src="https://habrastorage.org/webt/yu/zg/lp/yuzglprkqo7bjwn7ddfbcdxz8k0.png"></p><br><p>  Um ehrlich zu sein, ist dies nicht das Ergebnis, das Sie von einem Google-Produkt erwarten.  Lassen Sie uns diese Situation jedoch genauer betrachten.  Deaktivieren Sie den Cache und laden Sie die Google Mail-Oberfläche mit aktivierten devtools.  Auf der Registerkarte Netzwerk werden alle Anforderungen zum Herunterladen dieser Seite angezeigt.  Es stellte sich heraus, 6,9 Mb.  Dies ist eine beeindruckende Größe, da selbst Youtube, ein weiterer kürzlich aktualisierter Dienst, nur 2 MB Ressourcen lädt. </p><br><blockquote>  Es ist erwähnenswert, dass moderne Dienste, einschließlich Google Mail, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Service Worker</a> für ein verbessertes Zwischenspeichern von Ressourcen verwenden.  Für genaue Messungen eines Kaltstarts reicht <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">es daher</a> nicht aus, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den Cache auszuschalten.</a> Außerdem müssen Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Servicemitarbeiter zurücksetzen</a> , die auch über Ressourcen verfügen.  Erst danach ist die Download-Nummer von Grund auf echt. </blockquote><p>  Versuchen wir nun, das Laden der Seite in Zeitlupe zu betrachten.  In der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Chrome-Dokumentation wird dies</a> erläutert.  Wir erhalten eine Reihe von Screenshots aus verschiedenen Phasen des Seitenladens: </p><br><p><img src="https://habrastorage.org/webt/2j/tw/ao/2jtwaofovrdv_ytxy6vjd6dnzrm.png"></p><br><p>  Hier sehen Sie, dass die Seite in der 9. Sekunde mehr oder weniger geladen ist. </p><br><p>  Beim Neuladen bei Verwendung des Caches ist die Situation besser.  Die Seite macht nur 250 KB Anfragen, aber das macht es nicht schneller, wir sehen immer noch den Begrüßungsbildschirm für fast 10 Sekunden.  Der Punkt ist eindeutig nicht die Anzahl der Anfragen, etwas anderes verlangsamt die Seite. </p><br><h2 id="blokiruem-resursy">  Wir blockieren Ressourcen </h2><br><p>  Schauen Sie sich nun die Liste der herunterladbaren Skripte an: </p><br><p><img src="https://habrastorage.org/webt/md/2l/qw/md2lqwcqm3bl9l5frwa4-c3qpqi.png"></p><br><p>  Vielleicht sind einige von ihnen für den normalen Betrieb der Schnittstelle nicht so notwendig?  Versuchen wir, sie einzeln auszuschalten und die Seite ohne sie zu testen.  Dies ist mit der in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">devtools integrierten Funktionalität</a> einfach möglich. </p><br><p> Empirisch stellte sich heraus, dass Anforderungen für <code>https://mail.google.com/_/scs/*</code> für die Funktion der Benutzeroberfläche von entscheidender Bedeutung sind. Die folgenden Anforderungen können jedoch blockiert werden: </p><br><ul><li>  <code>www.gstatic.com/og/*</code> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google API Client Library</a> , Bibliothek für Anfragen an Google-Dienste </li><li>  <code>ssl.gstatic.com/inputtools/*</code> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Input Tools</a> - Bildschirmtastatur-Widget </li><li>  <code>hangouts.google.com</code> - verantwortlich für das Handgout-Widget </li></ul><br><blockquote>  Zusätzlich zu diesen Anforderungen hat mein AdBlock bereits blockierte Anforderungen an <code>https://play.google.com/log</code> installiert. Wir berücksichtigen sie nicht, da sie noch vor Beginn der Experimente mit Sperren nicht erstellt wurden. </blockquote><p>  Wir fügen diese Skripte der Blacklist hinzu und stellen fest, dass die Seite in 4 Sekunden geladen wurde, Sie jedoch weiterhin Briefe lesen und schreiben können. </p><br><h2 id="smotrim-v-profayler">  Wir schauen in den Profiler </h2><br><p>  Wir haben das Laden von Ressourcen so weit wie möglich minimiert, aber das Laden der Seite dauert noch lange.  Wir müssen sehen, was während dieser 4 Sekunden passiert.  Hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hilft</a> uns <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der in Chrome integrierte Profiler</a> .  Er zeigt uns dieses Bild: </p><br><p><img src="https://habrastorage.org/webt/nf/df/5f/nfdf5fyvr7vgproydoxpqjo4zgo.png"></p><br><p>  Hier können Sie sehen, dass der Browser während dieser ganzen Zeit mit der Ausführung von Javascript beschäftigt war.  Es ist interessant, dass in diesem Code so etwas Wichtiges und Schwieriges passiert.  Glücklicherweise wird Javascript fast unverändert in den Browser geladen und kann gelesen werden. </p><br><h2 id="rassmatrivaem-ostavshiysya-kod">  Betrachten Sie den verbleibenden Code </h2><br><p>  Lesen wir den uns zur Verfügung stehenden Javascript-Code.  Hier besteht die Möglichkeit, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">den minimierten Code so</a> zu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">formatieren</a> , dass er besser lesbar ist. </p><br><p>  Nach den Ergebnissen der Betrachtung wurde Folgendes gefunden: </p><br><ul><li>  Der Code ist sehr verschleiert.  Höchstwahrscheinlich wurde der Google Closure Compiler im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">erweiterten Modus verwendet</a> .  Das heißt, Google Mail-Entwickler haben die modernen Minifizierungstechnologien optimal genutzt. </li><li>  Leistungsmetriken werden im Code erfasst, daher sollten Entwickler wissen, wie langsam die Benutzeroberfläche geladen wird. </li><li>  Quellen enthalten Polyfills für Promise, Map, Set und andere moderne APIs, die in modernen Browsern möglicherweise nicht geladen werden. </li><li>  In <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google Closure Libary</a> geschriebener <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google</a> Mail-Code </li></ul><br><p>  Am letzten Punkt lohnt es sich, näher darauf einzugehen.  Die Closure Library ist ein Framework für die Schnittstellenentwicklung, das 2009 veröffentlicht wurde und sich seitdem nicht wesentlich geändert hat.  Beispielsweise wird <a href="https://github.com/google/closure-library/blob/master/closure/goog/net/xml">Ajax über ActiveXObject</a> dort weiterhin unterstützt: <a href="https://github.com/google/closure-library/blob/master/closure/goog/net/xml">Dies</a> wird nur für IE6 und niedriger benötigt, obwohl das aktuelle Google Mail <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziell</a> nur IE 10+ unterstützt. </p><br><p>  Darüber hinaus basiert die Closure-Benutzeroberfläche auf einer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Klassenhierarchie</a> in der „besten“ GWT-Tradition - einem Ansatz mit vielen ausführlichen Abstraktionen, die sich offensichtlich auf die Renderleistung auswirken.  Moderne UI-Frameworks (z. B. React oder Vue) bieten viel leichtere Abstraktionen - Komponenten -, die viel billiger zu rendern sind. </p><br><p>  Daher die lange Initialisierung: Tausende von Klassen werden im Code erstellt und viele Abstraktionen werden initialisiert, bevor die Google Mail-Oberfläche tatsächlich für uns gerendert wird. </p><br><p>  Trotz des aktualisierten Erscheinungsbilds zeichnet Google Mail ein Erbe alter Technologien auf, deren Schweregrad nicht hinter der äußeren Hülle verborgen werden kann. </p><br><h2 id="vyvody">  Schlussfolgerungen </h2><br><p>  Ich hoffe, dass nach dieser Überprüfung etwas klarer wird, warum Google Mail langsamer wird.  Leider liegt es nicht in unserer Macht, Google dazu zu bringen, seinen Service zu beschleunigen, aber Sie können zumindest ein paar Lektionen für Ihre Anwendungen lernen: </p><br><ul><li>  Legacy-Projekte stoßen normalerweise auf unnötigen Code, z. B. Hacks für Legacy-Browser.  Überprüfen Sie Ihre Quellen und entfernen Sie die Dinge, die irrelevant geworden sind. </li><li>  Abstraktionen sind nicht frei.  Wenn Sie ein Problem mithilfe eines eleganten Architekturmusters lösen möchten, überlegen Sie zunächst, ob es sich um ein zu schweres Werkzeug handelt. Möglicherweise gibt es eine einfachere Option. </li><li>  Laden Sie keine sekundären Elemente nativ auf die Seite hoch.  In diesem Fall blockiert das Hangouts-Widget möglicherweise nicht den Kanal, wodurch das Laden der wichtigsten Google Mail-Ressourcen beeinträchtigt wird, sondern wird nach dem Rendern der Hauptfunktionalität im Hintergrund geladen. </li><li>  Vernachlässigen Sie nicht die moderne Technologie.  Sie können grundlegend neue Lösungen für Ihre Aufgaben enthalten, die produktiver und bequemer sind.  Es ist seltsam, 2018 eine Neugestaltung des Dienstes von Google zu sehen, bei dem keine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Webkomponenten verwendet werden</a> , für die Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf Konferenzen</a> so aktiv <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ertrinkt</a> . </li><li>  Vergessen Sie nicht, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf Leistungsmessungen</a> für Ihre Projekte zu achten.  Dafür gibt es jetzt viele praktische Tools, sowohl browserbasiert als auch zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Starten in CI</a> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de429506/">https://habr.com/ru/post/de429506/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de429496/index.html">Selbst gemachter Lichtschwertlaser: wie es war. Teil 2</a></li>
<li><a href="../de429498/index.html">4 Gründe für den Aufschub (Text)</a></li>
<li><a href="../de429500/index.html">"Zeit, Geschäfte zu machen" flog schließlich</a></li>
<li><a href="../de429502/index.html">Lohnt es sich, kompetenzübergreifende Kompetenzen zu entwickeln?</a></li>
<li><a href="../de429504/index.html">So rufen Sie Audio-VK-Methoden auf</a></li>
<li><a href="../de429508/index.html">Zusammenfassung des Berichts „Wie man ein cooler Spezialist für Datenbanken wird“ (HL2018, Data Egret, Ilya Kosmodemyansky)</a></li>
<li><a href="../de429510/index.html">ArduPilot für Anfänger. Installieren und konfigurieren Sie auf BeagleBone Blue</a></li>
<li><a href="../de429512/index.html">Digitale Veranstaltungen in Moskau vom 12. bis 18. November</a></li>
<li><a href="../de429514/index.html">Microsoft erklärte, wie das Problem der Datensicherheit auf SSDs mit undichter Hardwareverschlüsselung gelöst werden kann</a></li>
<li><a href="../de429522/index.html">Entwerfen eines Serviceroboters. Problemstellung, Lösungsarchitektur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>