<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèΩ ü§ê üßõ KVM, passthrough PCI, Looking Glass et tout-tout üÖ∞Ô∏è ü§∑üèø üõÄüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apr√®s une transition r√©ussie vers les d√©veloppeurs de logiciels Linux, le moment est venu de travailler un peu et a √©galement chang√© le syst√®me d'expl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>KVM, passthrough PCI, Looking Glass et tout-tout</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433878/"> Apr√®s une transition r√©ussie vers les d√©veloppeurs de logiciels Linux, le moment est venu de travailler un peu et a √©galement chang√© le syst√®me d'exploitation principal.  Des inqui√©tudes ont √©t√© caus√©es par les logiciels de n√©cro-plateforme pour soutenir les projets existants.  Une partie du logiciel fonctionnait √† travers le vin.  Cependant, il s'est av√©r√© que certains logiciels refusent de travailler sous le vin.  Il a √©t√© d√©cid√© d'ex√©cuter le logiciel sur la machine virtuelle QEMU + KVM.  Le logiciel a commenc√© √† fonctionner, mais y travailler √©tait plut√¥t g√™nant.  Les performances des cartes vid√©o virtuelles logicielles ne diff√®rent pas et la prise en charge des graphiques 3D est tr√®s modeste.  J'ai d√ª d√©couvrir le tambourin et chercher une issue. <br><a name="habracut"></a><br><h1>  Allouez une carte vid√©o distincte au syst√®me invit√©! </h1><br>  Il n'a pas fallu longtemps pour trouver une issue, mais l'id√©e de frapper un tambourin avec un projecteur s'est av√©r√©e tr√®s √©trange.  En ce qui concerne le transfert de cartes vid√©o vers une machine virtuelle, Internet regorge d'instructions de diff√©rentes √©poques et pour diff√©rents mat√©riels.  Qu'est-ce qu'un √©norme article sur le site Arch Linux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[0]</a> .  Je vais vous donner une version abr√©g√©e des instructions pour transf√©rer une carte vid√©o. <br><br><h3>  0. V√©rifiez que le mat√©riel prend en charge IOMMU </h3><br>  Par exemple, ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[1]</a> . <br><br><h3>  1. Nous incluons le support de IOMMU dans un noyau. </h3><br><div class="spoiler">  <b class="spoiler_title">chat / etc / default / grub</b> <div class="spoiler_text"><blockquote>  GRUB_CMDLINE_LINUX_DEFAULT = "splash silencieux amd_iommu = on" <br>  ou <br>  GRUB_CMDLINE_LINUX_DEFAULT = "splash silencieux intel_iommu = on" <br></blockquote><br></div></div><br>  N'oubliez pas <code>sudo update-grub</code> . <br><br><h3>  2. Nous s√©lectionnons la carte vid√©o du pilote </h3><br>  Nous recherchons les p√©riph√©riques n√©cessaires et voyons quels pilotes les utilisent. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> Contr√¥leur compatible VGA [0300]: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (rev a2) <br>  Pilote du noyau en cours d'utilisation: <b>nouveau</b> <br>  Modules du noyau: nvidiafb, nouveau <br>  <b>04: 00.1</b> P√©riph√©rique audio [0403]: Contr√¥leur audio haute d√©finition NVIDIA Corporation [ <b>10de: 0be3</b> ] (rev a1) <br>  Pilote du noyau en cours d'utilisation: <b>snd_hda_intel</b> <br>  Modules du noyau: snd_hda_intel <br></blockquote><br></div></div><br>  Ajoutez des modules VFIO afin qu'ils soient charg√©s au d√©marrage. <br><br><div class="spoiler">  <b class="spoiler_title">cat / etc / modules |</b>  <b class="spoiler_title">grep vfio</b> <div class="spoiler_text"><blockquote>  vfio <br>  vfio_iommu_type1 <br>  vfio_pci <br>  vfio_virqfd <br></blockquote><br></div></div><br>  Nous configurons le module VFIO pour qu'il intercepte les p√©riph√©riques, emp√™chant le chargement des pilotes principaux.  Si n√©cessaire, ajoutez √† la liste noire le pilote principal. <br><br><div class="spoiler">  <b class="spoiler_title">cat /etc/modprobe.d/vfio.conf</b> <div class="spoiler_text"><blockquote>  options vfio-pci ids = <b>10de: 0a65,10de: 0be3</b> <br>  liste noire nouveau <br></blockquote><br></div></div><br><h3>  3. Red√©marrez et v√©rifiez que tout a fonctionn√© </h3><br>  IOMMU s'est allum√©. <br><br><div class="spoiler">  <b class="spoiler_title">dmesg |</b>  <b class="spoiler_title">grep -e DMAR -e IOMMU -e AMD-Vi</b> <div class="spoiler_text"><blockquote>  DMAR: technologie de virtualisation Intel¬Æ pour les E / S dirig√©es <br>  ou <br>  AMD-Vi: IOMMU trouv√© √† 0000: 00: 00.2 cap 0x40 <br>  AMD-Vi: remappage d'interruption activ√© <br>  AMD-Vi: rin√ßage paresseux IO / TLB activ√© <br></blockquote><br></div></div><br>  Les appareils composites faisaient partie d'un groupe. <br><br><div class="spoiler">  <b class="spoiler_title">pour un fichier dans / sys / kernel / iommu_groups / *;</b>  <b class="spoiler_title">trouver $ a -type l;</b>  <b class="spoiler_title">fait |</b>  <b class="spoiler_title">sort --version-sort</b> <div class="spoiler_text"><blockquote>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.1</b> <br>  /sys/kernel/iommu_groups/16/devices/0000:02:00.0 <br>  /sys/kernel/iommu_groups/17/devices/0000:03:00.0 <br>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.1</b> <br></blockquote><br></div></div><br>  Pilotes KVM et VFIO charg√©s. <br><br><div class="spoiler">  <b class="spoiler_title">lsmod |</b>  <b class="spoiler_title">grep -e kvm -e vfio</b> <div class="spoiler_text"><blockquote><pre> kvm_amd 94208 0
 ccp 90112 1 kvm_amd
 kvm 622592 1 kvm_amd
 vfio_pci 45056 0
 vfio_virqfd 16384 1 vfio_pci
 irqbypass 16384 2 vfio_pci, kvm
 vfio_iommu_type1 24576 0
 vfio 28672 2 vfio_iommu_type1, vfio_pci
</pre></blockquote><br></div></div><br>  Carte vid√©o pour OS invit√© captur√©e par VFIO. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> Contr√¥leur compatible VGA [0300]: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (rev a2) <br>  Pilote du noyau en cours d'utilisation: <b>vfio-pci</b> <br>  Modules du noyau: nvidiafb, nouveau <br>  <b>04: 00.1</b> P√©riph√©rique audio [0403]: Contr√¥leur audio haute d√©finition NVIDIA Corporation [ <b>10de: 0be3</b> ] (rev a1) <br>  Pilote du noyau en cours d'utilisation: <b>vfio-pci</b> <br>  Modules du noyau: snd_hda_intel <br></blockquote><br></div></div><br><h3>  4. Configurez QEMU et lancez le syst√®me d'exploitation invit√© </h3><br><div class="spoiler">  <b class="spoiler_title">Installer, s'il n'est pas d√©j√† install√©</b> <div class="spoiler_text"><blockquote>  sudo apt install qemu-kvm qemu-utils seabios ovmf virt-viewer <br></blockquote></div></div><br><div class="spoiler">  <b class="spoiler_title">Cr√©er un disque sur lequel le syst√®me d'exploitation invit√© sera install√©</b> <div class="spoiler_text"><blockquote>  qemu-img create -f raw -o preallocation = full guest.img 50G <br>  ou <br>  fallocate -l 50G guest.img <br></blockquote></div></div><br>  Nous d√©marrons la machine virtuelle sans transf√©rer la carte vid√©o pour installer le syst√®me d'exploitation invit√©.  Puisqu'il y a une vue sur Looking Glass, pour l'invit√©, il vaut la peine de choisir Windows 10. Windows 8 / 8.1 selon les derni√®res donn√©es est √©galement pris en charge. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  √©pice pour t√©l√©spectateur: //127.0.0.1: 5900 &amp; <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = heure locale, horloge = h√¥te \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'w10.iso', if = ide, format = raw, index = 2, media = cdrom, cache = none \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -pice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br><h3>  5. Nous transmettons la carte vid√©o √† l'OS invit√© </h3><br>  Pour commencer, d√©marrez avec deux cartes vid√©o.  Nous v√©rifions que la carte transmise est apparue dans le syst√®me, y avons plac√© les pilotes et nous nous assurons qu'ils fonctionnent. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  √©pice pour t√©l√©spectateur: //127.0.0.1: 5900 &amp; <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = heure locale, horloge = h√¥te \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -pice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  <b>-device ioh3420, bus = pcie.0, addr = 1c.0, multifonction = on, port = 1, chassis = 1, id = root \</b> <b><br></b>  <b>-device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on \</b> <b><br></b>  <b>-device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \</b> <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Apr√®s le fonctionnement de la carte vid√©o transf√©r√©e et dans le gestionnaire de p√©riph√©riques √©crit ¬´Le p√©riph√©rique fonctionne correctement¬ª, nous d√©marrons la machine virtuelle uniquement avec la carte vid√©o transf√©r√©e. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = heure locale, horloge = h√¥te \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga <b>aucun</b> \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifonction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nous y connectons un moniteur et admirons l'image de bureau de l'OS invit√©. <br><br><h1>  L'endroit o√π les d√©cisions simples se terminent </h1><br>  Et puis le plaisir commence.  Quelqu'un, tout va bien, l'image est partie et tout est simple.  Mon exp√©rience a tr√©buch√© deux fois au stade du manque d'image.  La premi√®re fois a √©t√© la transmission de la carte graphique int√©gr√©e du processeur Intel 6700T HD 530, les sorties vid√©o √©taient vides et l'√©chec √©tait d√ª au fait que les plug-ins ne fonctionnaient pas bien.  La deuxi√®me fois, le Nvidia GF210 externe a √©t√© renvers√©, qui avait d√©j√† √©t√© sp√©cialement achet√© pour les exp√©riences.  Le r√©sultat √©tait encore plus int√©ressant.  En mode non EFI, la carte vid√©o a √©t√© transf√©r√©e avec succ√®s et a m√™me montr√© une image, mais la d√©sactivation du syst√®me d'exploitation invit√© a <abbr title="environ 50 √† 50">√©chou√©</abbr> . <br><br>  Le transfert ult√©rieur pourrait simplement bloquer l'h√¥te.  Quelques heures de recherche facile sur Google m√®nent au fait que le probl√®me du gel d'une carte vid√©o est assez courant.  Cela entra√Æne un arr√™t incorrect de la machine virtuelle et, avec une certaine chance, m√™me un arr√™t correct.  En sortie, il est recommand√© de transmettre en mode EFI.  Mais VBIOS Nvidia GF210 ne prend pas en charge EFI ... <br><br><h3>  Coudre ou ne pas coudre, telle est la question </h3><br>  Ne cousez pas.  QEMU prend en charge l'usurpation d'identit√© VBIOS lors du transfert d'une carte vid√©o.  Mais VBIOS doit encore apprendre √† prendre en charge le mode EFI.  Il est g√©n√©ralement recommand√© de v√©rifier cela avant de commencer le transfert de la carte vid√©o, par exemple ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[2]</a> .  Mais il faut faire face √† ce qui est, et ne voulait pas chercher une nouvelle carte vid√©o avec support EFI.  Vous devez donc patcher VBIOS.  <u>Toutes les op√©rations effectu√©es avec VBIOS se font √† vos propres risques.</u>  J'ai utilis√© un progiciel et des instructions √† partir d'ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[3]</a> .  Apr√®s avoir lu VBIOS, nous obtenons le fichier <code>gt210.rom</code> , patch et √† la sortie, nous avons <code>gt210_uefi.rom</code> .  C'est l√† que vous devez glisser la carte vid√©o lors du chargement de la machine virtuelle. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = heure locale, horloge = h√¥te \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga aucun \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifonction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, <b>romfile = gt210_uefi.rom</b> \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nous d√©marrons la machine virtuelle et regardons. <br><br><h3>  Obscurit√© </h3><br>  Les sorties de la carte vid√©o brillaient dans le noir.  Une fois de plus, la morale a pass√© l'√©preuve de l'√©chec.  La premi√®re chose qui me vient √† l'esprit est que le syst√®me d'exploitation invit√© se bloque au d√©marrage.  Journaux, j'ai besoin de ses journaux.  Pour ce faire, ex√©cutez <code>vga_qxl.sh</code> .  Nous regardons le lancement pr√©c√©dent.  Et l√† tout va bien, sauf que la nourriture a √©t√© fortement tir√©e.  Il s'av√®re que cela fonctionne, bien que cela ne fonctionne pas.  La premi√®re id√©e √©tait de se connecter via RDP et de voir ce qui s'y passe, mais il est toujours pr√©f√©rable d'utiliser VNC, par exemple tightvnc <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[4]</a> .  Nous installons VNC, configurons le port <code>5600</code> et transmettons ce port pour l'acc√®s √† partir de l'h√¥te. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = heure locale, horloge = h√¥te \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga aucun \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifonction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, romfile = gt210_uefi.rom \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -utilisateur netdev, id = n1, <b>hostfwd = tcp: 127.0.0.1: 5600-: 5600,</b> ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nous connectons et voyons la machine qui fonctionne, seul le moniteur a un √©trange moniteur g√©n√©rique non-PnP (le moniteur universel n'est pas PnP).  Il y a une image, vous pouvez donc essayer de lancer Looking Glass. <br><br><h3>  Miroir </h3><br>  Bien que cette technologie utilise OpenGL, aucun espace n'est n√©cessaire apr√®s gl.  Mais vous devez lire les instructions <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[5]</a> sur le site Web du projet.  Pour le syst√®me d'exploitation invit√©, t√©l√©chargez l'application de capture d'√©cran <b>looking-glass-host.exe</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[6]</a> , t√©l√©chargez et installez Microsoft Visual C ++ 2015 Redistributable <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[7]</a> , t√©l√©chargez le pilote du p√©riph√©rique IVSHMEM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[8]</a> .  Pour l'h√¥te, nous ajoutons des d√©pendances, t√©l√©chargeons et construisons l'application cliente. <br><br><div class="spoiler">  <b class="spoiler_title">build_looking_glass_a12.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo apt-get install cmake libsdl2-dev libsdl2-ttf-dev nettle-dev libspice-protocol-dev libfontconfig1-dev libx11-dev fonts-freefont-ttf libconfig-dev <br>  wget <a href="">github.com/gnif/LookingGlass/archive/a12.tar.gz</a> <br>  tar -xf a12.tar.gz <br>  cd LookingGlass-a12 <br>  client / build mkdir <br>  client / build cd <br>  cmake ../ <br>  faire <br></blockquote></div></div><br>  Nous d√©marrons la machine virtuelle avec le p√©riph√©rique IVSHMEM.  La taille de m√©moire de 32 Mo est s√©lectionn√©e pour une r√©solution de 1920 x 1080. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_lg_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  <b>si [!</b>  <b>-f / dev / shm / mirroir];</b>  <b>alors</b> <b><br></b>  <b>tactile / dev / shm / miroir</b> <b><br></b>  <b>chown `whoami`: kvm / dev / shm / miroir</b> <b><br></b>  <b>chmod 660 / dev / shm / miroir</b> <b><br></b>  <b>fi</b> <br>  sudo qemu-system-x86_64 \ <br>  -machine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, sockets = 1, cores = 2, threads = 1 \ <br>  -m 6G \ <br>  -rtc base = heure locale, horloge = h√¥te \ <br>  -device piix3-usb-uhci \ <br>  -device usb-tablet \ <br>  -drive if = pflash, format = raw, readonly, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga aucun \ <br>  -device ioh3420, bus = pcie.0, addr = 1c.0, multifonction = on, port = 1, chassis = 1, id = root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, romfile = gt210_uefi.rom \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  <b>-device ivshmem-plain, memdev = ivshmem, bus = pcie.0 \</b> <b><br></b>  <b>-object memory-backend-file, id = ivshmem, share = on, mem-path = / dev / shm / looking-glass, size = 32M \</b> <br>  -monitor stdio \ <br>  -utilisateur netdev, id = n1, hostfwd = tcp: 127.0.0.1: 5600-: 5600, ipv6 = off, smb = "/ media / user / data" \ <br>  -device e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nous nous connectons via VNC, installons le pilote sur le p√©riph√©rique IVSHMEM, peut-√™tre qu'un pilote standard sera install√© dessus, situ√© dans les "P√©riph√©riques syst√®me".  Nous commen√ßons √† <b>regarder-glass-host.exe</b> .  Sur l'h√¥te, ex√©cutez <code>./LookingGlass-a12/client/build/looking-glass-client</code> . <br><br>  √Ä ce sujet, un syst√®me avec NVidia GF210 a fonctionn√© pour moi, puis Intel HD530 a √©t√© lanc√© sur la m√™me route.  Il y avait un petit probl√®me avec la r√©solution d'√©cran, pour passer √† une r√©solution rare, par exemple 2048x1152, j'ai d√ª utiliser l'utilitaire de r√©solution personnalis√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[9]</a> . <br><br>  Autre nuance, lors de l'ajout de l'application <b>looking-glass-host.exe</b> au chargement automatique, vous devez configurer la connexion utilisateur automatique, pour des raisons de s√©curit√©, le syst√®me d'exploitation invit√© ne permet pas de capturer l'√©cran de connexion. <br><br><h1>  Postface </h1><br>  Si vous ne d√©finissez pas de t√¢che, obtenir une image sur une sortie vid√©o physique, ce r√©sultat sera suffisant pour obtenir une machine virtuelle fonctionnelle avec une carte vid√©o physique et un contr√¥le r√©actif.  La gestion est effectu√©e √† partir de l'h√¥te dans une fen√™tre s√©par√©e ou en plein √©cran.  Cependant, il y a des nuances. <br><br>  <b>Performance</b> .  Les ressources suppl√©mentaires pour la virtualisation et non le syst√®me d'exploitation invit√© le plus efficace ne vous permettront pas de travailler confortablement sur du mat√©riel faible et moyen-faible.  Il faudra un processeur puissant d'au moins 6-8 c≈ìurs, une bonne carte graphique pour un OS invit√©, 16 Go + RAM, au moins 8 Go pour chaque syst√®me d'exploitation.  Et danser avec un tambourin pour tirer le meilleur parti du fer. <br>  <b>Patience</b> .  Si cela ne fonctionne pas tout de suite, vous devrez passer du temps et du temps d√©cemment.  Recherchez, lisez, essayez.  Encore une fois, regardez, lisez et r√©essayez.  Je vais laisser quelques liens suppl√©mentaires que j'ai rencontr√©s, peut-√™tre y aura-t-il des informations plus utiles.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[10]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[11]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">[12]</a> <br><br>  <b>Les r√©f√©rences</b> <br><br>  Attention, les liens s'ouvrent dans cette fen√™tre. <br><br><a name="L0"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">0. https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF</a> <br><a name="L1"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1. https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware</a> <br><a name="L2"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2. https://www.techpowerup.com/vgabios/</a> <br><a name="L3"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3. https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html</a> <br><a name="L4"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4. https://www.tightvnc.com/download.php</a> <br><a name="L5"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5. https://looking-glass.hostfission.com/quickstart</a> <br><a name="L6"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6. https://github.com/gnif/LookingGlass/releases</a> <br><a name="L7"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">7. https://www.microsoft.com/en-us/download/details.aspx?id=48145</a> <br><a name="L8"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">8. https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/</a> <br><a name="L9"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">9. https://www.monitortests.com/forum/Thread-Custom-Resolution-Utility-CRU</a> <br><a name="L10"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">10. https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough</a> <br><a name="L11"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">11. https://ycnrg.org/vga-passthrough-with-ovmf-vfio/</a> <br><a name="L12"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">12. https://www.reddit.com/r/VFIO/comments/8h352p/guide_running_windows_via_qemukvm_and_intel_gvtg/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433878/">https://habr.com/ru/post/fr433878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433868/index.html">Pourquoi le lecteur de glyc√©mie d'Alphabet n'a pas vol√©</a></li>
<li><a href="../fr433870/index.html">Pourquoi est-il si difficile de mesurer en continu le glucose?</a></li>
<li><a href="../fr433872/index.html">Acc√®s mobile - utilisation d'un smartphone dans les syst√®mes de contr√¥le d'acc√®s</a></li>
<li><a href="../fr433874/index.html">Exp√©riences d'interface neuronale JavaScript</a></li>
<li><a href="../fr433876/index.html">Pr√©sentations de produits en trois dimensions sur Three.js pour les plus petits</a></li>
<li><a href="../fr433880/index.html">Life Hacks for Developers: Utilisation efficace de SQ (Source Qualifier) ‚Äã‚Äãchez Informatica Power Center</a></li>
<li><a href="../fr433884/index.html">Aspects juridiques de la vid√©osurveillance: comment √©viter les probl√®mes avec la loi</a></li>
<li><a href="../fr433886/index.html">Apprentissage automatique Python avec d√©mos interactives Jupyter</a></li>
<li><a href="../fr433888/index.html">L'utilisation de batteries lithium-ion dans les onduleurs monophas√©s</a></li>
<li><a href="../fr433892/index.html">FSTEC vs NIST: protection contre les fuites en russe et en am√©ricain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>