<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏾‍🏫 👨🏼‍🎤 🤞🏻 Sistemas de análise de servidor 📎 🧝 👨🏾‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta é a segunda parte de uma série de artigos sobre sistemas analíticos ( link para a parte 1 ). 



 Hoje, não há dúvida de que o processamento prec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistemas de análise de servidor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444254/"> Esta é a segunda parte de uma série de artigos sobre sistemas analíticos ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">link para a parte 1</a> ). <br><br><img src="https://habrastorage.org/webt/bn/xe/4l/bnxe4lnwruhoopwd582keuoybrc.png" alt="imagem"><br><br>  Hoje, não há dúvida de que o processamento preciso dos dados e a interpretação dos resultados podem ajudar quase qualquer tipo de negócio.  Nesse sentido, os sistemas analíticos estão cada vez mais carregados de parâmetros, o número de gatilhos e eventos do usuário em aplicativos está aumentando. <br><br>  Por esse motivo, as empresas fornecem a seus analistas informações cada vez mais "brutas" para análise e as transformam nas decisões corretas.  A importância de um sistema de análise para uma empresa não deve ser subestimada, e o próprio sistema deve ser confiável e sustentável. <br><a name="habracut"></a><br><h2>  Análise do cliente </h2><br>  A análise de clientes é um serviço que uma empresa conecta ao seu site ou aplicativo por meio do SDK oficial, integra-se à sua própria base de códigos e seleciona os acionadores de eventos.  Essa abordagem tem uma desvantagem óbvia: todos os dados coletados não podem ser totalmente processados ​​como você gostaria, devido às limitações de qualquer serviço selecionado.  Por exemplo, em um sistema não será fácil executar tarefas do MapReduce, em outro você não poderá executar seu modelo.  Outra desvantagem será uma fatura regular (impressionante) de serviços. <br>  Existem muitas soluções de análise de clientes no mercado, mas, mais cedo ou mais tarde, os analistas se deparam com o fato de que não há um serviço universal adequado para qualquer tarefa (enquanto os preços de todos esses serviços estão constantemente aumentando).  Nessa situação, as empresas geralmente decidem criar seu próprio sistema de análise com todas as configurações e recursos personalizados necessários. <br><br><h2>  Análise de servidor </h2><br>  A análise de servidor é um serviço que pode ser implantado internamente em uma empresa em seus próprios servidores e (geralmente) por seus próprios esforços.  Nesse modelo, todos os eventos do usuário são armazenados em servidores internos, permitindo que os desenvolvedores tentem bancos de dados diferentes para armazenamento e escolham a arquitetura mais conveniente.  E mesmo se você ainda quiser usar análises de clientes de terceiros para algumas tarefas, ainda será possível. <br>  A análise do servidor pode ser implantada de duas maneiras.  Primeiro: selecione alguns utilitários de código aberto, implante em suas máquinas e desenvolva lógica de negócios. <br><br><table><tbody><tr><td>  <b>Prós</b> </td><td>  <b>Contras</b> </td></tr><tr><td>  Você pode personalizar qualquer coisa </td><td>  Muitas vezes, é muito difícil e são necessários desenvolvedores individuais. </td></tr></tbody></table><br>  Segundo: adote serviços SaaS (Amazon, Google, Azure) em vez de implantá-lo você mesmo.  Sobre o SaaS em mais detalhes, contaremos na terceira parte. <br><br><table><tbody><tr><td>  <b>Prós</b> </td><td>  <b>Contras</b> </td></tr><tr><td>  Pode ser mais barato em volumes médios, mas com um grande crescimento ainda se tornará muito caro </td><td>  Não é possível controlar todos os parâmetros </td></tr><tr><td>  A administração é totalmente transferida para os ombros do provedor de serviços </td><td>  Nem sempre se sabe o que está dentro do serviço (pode não ser necessário) </td></tr></tbody></table><br><h2>  Como coletar análises do servidor </h2><br>  Se quisermos evitar o uso da análise do cliente e montar a nossa própria, primeiro precisamos pensar na arquitetura do novo sistema.  Abaixo, passo a passo, o que você deve considerar, por que cada uma das etapas é necessária e quais ferramentas você pode usar. <br><br><h3>  1. Aquisição de dados </h3><br>  Assim como no caso da análise de clientes, em primeiro lugar, os analistas da empresa escolhem os tipos de eventos que desejam estudar no futuro e os agrupam em uma lista.  Geralmente, esses eventos ocorrem em uma determinada ordem, chamada de "padrão de evento". <br><br>  Em seguida, imagine que um aplicativo móvel (site) tenha usuários regulares (dispositivos) e muitos servidores.  Para transferir com segurança eventos de dispositivos para servidores, é necessária uma camada intermediária.  Dependendo da arquitetura, várias filas de eventos diferentes podem ocorrer. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Apache Kafka</a> é uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fila de pub / sub</a> que é usada como uma fila para coletar eventos. <br><blockquote>  De acordo com um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">post no Kvor</a> em 2014, o criador do Apache Kafka decidiu nomear o software como Franz Kafka porque "é um sistema otimizado para gravação" e porque ele amava os trabalhos de Kafka.  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Wikipedia</a> </blockquote><br>  No nosso exemplo, existem muitos produtores de dados e seus consumidores (dispositivos e servidores), e o Kafka ajuda a conectá-los.  Os consumidores serão descritos com mais detalhes nas próximas etapas, onde serão os principais atores.  Agora vamos considerar apenas produtores de dados (eventos). <br><br>  Kafka encapsula os conceitos de fila e partição; mais especificamente, é melhor ler sobre isso em outro lugar (por exemplo, na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documentação</a> ).  Sem entrar em detalhes, imagine que um aplicativo móvel seja lançado para dois sistemas operacionais diferentes.  Em seguida, cada versão cria seu próprio fluxo de eventos separado.  Os produtores enviam eventos para Kafka, eles são gravados em uma fila adequada. <br><img src="https://habrastorage.org/webt/79/bi/0o/79bi0ooejp8zfiw4siua1gkhagu.png" alt="Filas em Kafka"><br>  (foto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a> ) <br><br>  Ao mesmo tempo, Kafka permite que você leia em pedaços e processe o fluxo de eventos com mini-morcegos.  Kafka é uma ferramenta muito conveniente que se adapta bem às necessidades crescentes (por exemplo, por geolocalização de eventos). <br><br>  Normalmente, um fragmento é suficiente, mas as coisas se tornam mais difíceis devido ao dimensionamento (como sempre).  Provavelmente ninguém vai querer usar apenas um fragmento físico na produção, pois a arquitetura deve ser tolerante a falhas.  Além do Kafka, há outra solução conhecida - RabbitMQ.  Não o usamos na produção como uma fila para análise de eventos (se você tiver essa experiência, conte-nos nos comentários!).  No entanto, eles usaram o AWS Kinesis. <br><br>  Antes de avançar para a próxima etapa, precisamos mencionar mais uma camada adicional do sistema - o armazenamento de logs brutos.  Essa não é uma camada necessária, mas será útil se algo der errado e as filas de eventos no Kafka forem redefinidas.  O armazenamento de logs brutos não requer uma solução complicada e cara; você pode simplesmente gravá-los em algum lugar na ordem correta (mesmo em um disco rígido). <br><img src="https://habrastorage.org/webt/yt/tn/we/yttnwe1yfgconmy3z4frdmnypmc.jpeg" alt="Eventos alinhados"><br><h3>  2. Processamento de Fluxos de Eventos </h3><br>  Depois de preparar todos os eventos e colocá-los em filas adequadas, prosseguimos para a etapa de processamento.  Aqui vou falar sobre as duas opções de processamento mais comuns. <br><br>  A primeira opção é habilitar o Spark Streaming em um sistema Apache.  Todos os produtos Apache vivem no HDFS, um sistema de arquivos de réplica de arquivo seguro.  O Spark Streaming é uma ferramenta fácil de usar que processa bem os dados de streaming e dimensiona bem.  No entanto, pode ser um pouco difícil de manter. <br><br>  Outra opção é criar seu próprio manipulador de eventos.  Para fazer isso, por exemplo, você precisa escrever um aplicativo Python, construí-lo na janela de encaixe e assinar a fila Kafka.  Quando os gatilhos chegarem aos manipuladores na janela de encaixe, o processamento será iniciado.  Com esse método, você precisa manter aplicativos em execução constante. <br><br>  Suponha que escolhemos uma das opções descritas acima e prossiga para o próprio processamento.  Os processadores devem começar verificando a validade dos dados, filtrando o lixo e os eventos "interrompidos".  Para validação, geralmente usamos o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cerberus</a> .  Depois disso, você pode fazer o mapeamento dos dados: dados de diferentes fontes são normalizados e padronizados para serem adicionados ao rótulo geral. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/iu/m8/osium8y24ypxtq-bk3oesiszhc4.jpeg" alt="Eventos chegam ao manipulador"></div><br><h3>  3. Banco de Dados </h3><br>  O terceiro passo é manter os eventos normalizados.  Ao trabalhar com um sistema analítico pronto, muitas vezes precisamos entrar em contato com eles, por isso é importante escolher um banco de dados conveniente. <br><br>  Se os dados se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ajustarem</a> bem a um esquema fixo, você poderá escolher <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Clickhouse</a> ou algum outro banco de dados de colunas.  Portanto, as agregações funcionarão muito rapidamente.  A desvantagem é que o esquema é rigidamente fixo e, portanto, dobrar objetos arbitrários sem refinamento falhará (por exemplo, quando ocorrer um evento não padrão).  Mas você pode contar muito rápido. <br><br>  Para dados não estruturados, você pode usar o NoSQL, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apache Cassandra</a> .  Funciona no HDFS, é bem replicado, você pode criar várias instâncias, tolerante a falhas. <br><br>  Você pode escolher algo mais simples, por exemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MongoDB</a> .  É bastante lento e para pequenos volumes.  Mas a vantagem é que é muito simples e, portanto, adequado para começar. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zc/z0/54/zcz054-gr2mczuf_dns72caehec.jpeg" alt="imagem"></div><br><h3>  4. Agregações </h3><br>  Depois de salvar cuidadosamente todos os eventos, queremos coletar todas as informações importantes do lote que veio e atualizar o banco de dados.  Globalmente, queremos obter painéis e métricas relevantes.  Por exemplo, de eventos para coletar um perfil de usuário e de alguma forma medir o comportamento.  Os eventos são agregados, coletados e salvos novamente (já em tabelas de usuários).  Ao mesmo tempo, você pode criar o sistema para conectar também um filtro ao agregador-coordenador: coletar usuários apenas de um determinado tipo de evento. <br><br>  Depois disso, se alguém da equipe precisar apenas de análises de alto nível, você poderá conectar sistemas de análises externos.  Você pode tomar o Mixpanel novamente.  mas, como é muito caro, não envia todos os eventos do usuário para lá, mas apenas o necessário.  Para fazer isso, é necessário criar um coordenador que transmita alguns eventos brutos ou algo que nós mesmos agregamos anteriormente a sistemas externos, APIs ou plataformas de publicidade. <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pj/fn/ck/pjfnckuoonpbyua_5d3qbhyegfa.jpeg" alt="imagem"></div><br><h3>  5. Frontend </h3><br>  Você precisa conectar o front-end ao sistema criado.  Um bom exemplo é o serviço <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">redash</a> , uma GUI para bancos de dados que ajuda a criar painéis.  Como a interação funciona: <br><br><ol><li>  O usuário faz uma consulta SQL. </li><li>  Em resposta, recebe um tablet. </li><li>  Para ela, ela cria uma 'nova visualização' e recebe uma agenda bonita que já pode ser salva para si mesma. </li></ol><br>  As visualizações no serviço são atualizadas automaticamente, você pode configurar e acompanhar seu monitoramento.  O Redash é gratuito, no caso de hospedagem automática, e como o SaaS custará US $ 50 por mês. <br><img src="https://habrastorage.org/webt/mn/tv/vb/mntvvbd4vacpm4r6qvujl6xwc8s.jpeg" alt="imagem"><br><h2>  Conclusão </h2><br>  Depois de concluir todas as etapas acima, você criará a análise do servidor.  Observe que essa não é uma maneira tão fácil como simplesmente conectar a análise do cliente, porque tudo precisa ser configurado de forma independente.  Portanto, antes de criar seu próprio sistema, vale a pena comparar a necessidade de um sistema de análise sério com os recursos que você está pronto para dedicar a ele. <br>  Se você calculou tudo e descobriu que os custos são muito altos, na próxima parte, falarei sobre como criar uma versão mais barata da análise de servidor. <br><br>  Obrigado pela leitura!  Ficarei feliz em fazer perguntas nos comentários. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt444254/">https://habr.com/ru/post/pt444254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt444244/index.html">Movendo-se através do espaço e do tempo</a></li>
<li><a href="../pt444246/index.html">Verificando o FreeRDP com PVS-Studio</a></li>
<li><a href="../pt444248/index.html">Teste sem cabeça em um navegador. Prós e contras</a></li>
<li><a href="../pt444250/index.html">As pessoas não estão prontas para bitcoin ou bitcoin para adoção em massa?</a></li>
<li><a href="../pt444252/index.html">AMD anuncia sua arquitetura de chips 3D para acompanhar o Intel Foveros 3D</a></li>
<li><a href="../pt444256/index.html">Meu primeiro leitor Sharp PC3000</a></li>
<li><a href="../pt444260/index.html">Estamos desenvolvendo um sistema para avaliar o trabalho dos agentes de suporte</a></li>
<li><a href="../pt444262/index.html">Código fonte Markdown2pdf para Linux</a></li>
<li><a href="../pt444264/index.html">Como se tornar um colaborador e você realmente precisa dele</a></li>
<li><a href="../pt444268/index.html">Semana 12 de segurança: ataques de teclado</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>