<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÉüèæ üí™üèΩ üë®üèø‚Äçüé® Comment les graphiques NES ont-ils √©t√© organis√©s? üôçüèª ‚õµÔ∏è üèá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Lanc√©e en 1983, la console de salon Nintendo Entertainment System (NES) √©tait une machine bon march√© mais puissante qui a connu un succ√®s ph√©nom√©nal. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment les graphiques NES ont-ils √©t√© organis√©s?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470614/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/f22/f28/9adf22f2804a300f6f3e9a98fe15c13b.gif" alt="image"></div><br>  Lanc√©e en 1983, la console de salon Nintendo Entertainment System (NES) √©tait une machine bon march√© mais puissante qui a connu un succ√®s ph√©nom√©nal.  √Ä l'aide de l'unit√© de traitement d'image (PPU), le syst√®me pourrait cr√©er des graphiques assez impressionnants pour l'√©poque, ce qui semble encore assez bon dans le bon contexte.  L'aspect le plus important √©tait l'efficacit√© de la m√©moire - lors de la cr√©ation de graphiques, nous devions g√©rer avec le moins d'octets possible.  Cependant, NES a fourni aux d√©veloppeurs des fonctionnalit√©s puissantes et faciles √† utiliser qui lui ont permis de se d√©marquer des anciennes consoles de salon.  Apr√®s avoir compris les principes de cr√©ation de graphiques NES, vous pouvez sentir la perfection technique du syst√®me et r√©aliser √† quel point il est plus facile pour les d√©veloppeurs de jeux modernes de travailler. <br><br>  Les graphiques d'arri√®re-plan NES ont √©t√© assembl√©s √† partir de quatre composants distincts, dont la combinaison a form√© l'image que nous voyons √† l'√©cran.  Chaque composante √©tait responsable d'un aspect distinct;  couleur, disposition, graphiques en pixels bruts, etc.  Un tel syst√®me peut sembler inutilement compliqu√© et encombrant, mais il a finalement utilis√© la m√©moire beaucoup plus efficacement et a permis de cr√©er des effets simples dans une petite quantit√© de code.  Si vous voulez comprendre les graphiques NES, ces quatre composants seront des informations cl√©s. <br><br>  Cet article suppose que vous √™tes familier avec les math√©matiques informatiques, et en particulier avec le fait que 8 bits = 1 octet et 8 bits peuvent repr√©senter 256 valeurs.  Une compr√©hension du fonctionnement de la notation hexad√©cimale est √©galement n√©cessaire.  Mais m√™me sans cette connaissance technique, l'article peut sembler int√©ressant. <br><a name="habracut"></a><br><h1>  Br√®ve revue </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ca1/6f8/9a7/ca16f89a75e658d68c28f81e9794ff86.png" width="512" height="480"></div><br>  Ci-dessus est une image de la premi√®re sc√®ne de Castlevania (1986): la porte menant au ch√¢teau, o√π le jeu aura lieu.  Cette image mesure 256 √ó 240 pixels et utilise 10 couleurs diff√©rentes.  Pour d√©crire cette image en m√©moire, nous devons tirer parti de la palette de couleurs limit√©e et √©conomiser de l'espace en ne stockant qu'une quantit√© minimale d'informations.  L'une des approches na√Øves consiste √† utiliser une palette index√©e dans laquelle chaque pixel a un volume de 4 bits, c'est-√†-dire que 2 pixels sont plac√©s dans un octet.  Cela n√©cessitera 256 * 240/2 = 30720 octets, mais comme nous le verrons bient√¥t, NES peut faire face √† cette t√¢che beaucoup plus efficacement. <br><br>  Les principaux concepts du th√®me graphique NES sont les tuiles et les blocs [1].  Une tuile est une zone de 8 √ó 8 pixels, et un bloc est une zone de 16 √ó 16 pixels, et chacun d'eux est li√© √† une grille avec la m√™me taille de cellule.  Apr√®s avoir ajout√© ces grilles, nous pouvons voir la structure des graphiques.  Voici l'entr√©e du ch√¢teau avec une grille √† double grossissement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uz/de/sk/uzdeskry1wkruscxe8xsyephbnc.png"></div><br>  Dans cette grille, les blocs sont affich√©s en vert clair et les tuiles en vert fonc√©.  Les r√®gles le long des axes ont des valeurs hexad√©cimales qui peuvent √™tre ajout√©es pour trouver une position;  par exemple, le c≈ìur dans la barre d'√©tat est √† 15 $ + 60 $ = 75 $, ce qui en d√©cimal est 117. Chaque √©cran contient 16 √ó 15 blocs (240) et 32 ‚Äã‚Äã√ó 30 tuiles (960).  Voyons maintenant comment cette image est d√©crite et commen√ßons par les graphiques en pixels bruts. <br><br><h1>  CHR </h1><br>  La structure CHR d√©crit des graphiques de pixels ¬´bruts¬ª sans sa couleur et sa position, et est d√©finie en mosa√Øques.  La page de m√©moire enti√®re contient 256 tuiles CHR, et chaque tuile a une profondeur de 2 bits.  Voici les graphiques du c≈ìur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad9/d14/fb3/ad9d14fb3cc4321c5ae65e1e7f61dd52.png" width="128" height="128"></div><br>  Et voici comment cela est d√©crit dans CHR [2]: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/162/974/e0f/162974e0fe800447c8edecf9157d1763.png" alt="pixel-heart-chr" width="128" height="128"></div><br>  Une telle description prend 2 bits par pixel, c'est-√†-dire qu'avec une taille de 8 √ó 8, il s'av√®re que 8 * 8 * 2 = 128 bits = 16 octets.  Ensuite, la page enti√®re prend 16 * 256 = 4096 octets.  Voici tous les CHR utilis√©s dans l'image de Castlevania. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5da/3ef/83d/5da3ef83d0e339ca2d91d799745157e9.png" width="271" height="101"></div><br>  Rappelons que le remplissage d'une image n√©cessite 960 tuiles, mais CHR n'en autorise que 256. Cela signifie que la plupart des tuiles sont r√©p√©t√©es, en moyenne, 3,75 fois, mais le plus souvent seulement un petit nombre d'entre elles sont utilis√©es (par exemple, fond vide, tuiles monochromes). ou r√©p√©tition de motifs).  L'image de Castlevania utilise de nombreuses tuiles vides, ainsi que du bleu uni.  Pour voir comment les tuiles sont attribu√©es, nous utilisons des tables de noms. <br><br><h1>  NAMETABLE </h1><br>  La table de noms attribue un fichier CHR √† chaque position sur l'√©cran, et il y en a 960 au total. Chaque position est sp√©cifi√©e dans un octet, c'est-√†-dire que la table de noms enti√®re prend jusqu'√† 960 octets.  Les tuiles sont attribu√©es dans l'ordre de gauche √† droite, de haut en bas et correspondent √† la position calcul√©e trouv√©e en ajoutant les valeurs des r√®gles indiqu√©es ci-dessus.  Autrement dit, la position dans le coin sup√©rieur gauche est de 0 $, √† droite de 1 $ et en dessous de 20 $. <br><br>  Les valeurs de la table de noms d√©pendent de l'ordre dans lequel le CHR est rempli.  Voici l'une des options [3]: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h_/vs/qc/h_vsqc5mxdu8ydb1o8cu4mflf9e.png"></div><br>  <i>Dans ce cas, le c≈ìur (√† la position 75 $) a une valeur de 13 $.</i> <br><br>  Ensuite, pour ajouter de la couleur, nous devons s√©lectionner une palette. <br><br><h1>  Palette </h1><br>  NES poss√®de une palette syst√®me de 64 couleurs [4], et nous en s√©lectionnons les palettes qui seront utilis√©es dans le rendu.  Chaque palette contient 3 couleurs uniques plus la couleur de fond globale.  L'image a un maximum de 4 palettes, qui occupent au total 16 octets.  Voici les palettes de l'image de Castlevania: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f03/59a/259/f0359a259c032b5f6c9048c0231ffb85.png" alt="castlevania-pal" width="168" height="24"></div><br>  Les palettes ne peuvent pas √™tre utilis√©es arbitrairement.  Une seule palette est appliqu√©e par bloc.  C'est √† cause de ce besoin de s√©parer chaque zone 16 √ó 16 selon la palette de couleurs du jeu pour que NES ait un tel aspect ¬´bloc¬ª.  Les graphiques ex√©cut√©s de mani√®re magistrale, par exemple √† partir de l'√©cran de d√©marrage Castlevania, peuvent √™tre √©vit√©s en m√©langeant les couleurs sur les bords des blocs, ce qui masque la pr√©sence d'une grille. <br><br>  La s√©lection d'une palette pour chaque bloc est effectu√©e en utilisant les derniers composants - attributs. <br><br><h1>  Attributs </h1><br>  Les attributs occupent 2 bits par bloc.  Ils d√©terminent laquelle des 4 palettes utiliser.  Cette image montre quelles palettes d√©finies par les attributs utilisent diff√©rents blocs [5]: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k4/kj/3i/k4kj3imqlxxbwnasjcz3t60abym.png"></div><br>  Comme vous pouvez le voir, les palettes sont divis√©es en sections, mais cela est d√©licat en raison de l'utilisation des m√™mes couleurs dans diff√©rentes zones.  Le rouge au milieu de la porte se confond avec les murs qui l'entourent et un fond noir brouille la ligne entre le ch√¢teau <br>  et portes. <br><br>  Avec 2 bits par bloc ou 4 blocs par octet, les attributs d'image n'occupent que 240/4 = 60 octets, mais en raison de la fa√ßon dont ils sont cod√©s, 4 autres octets sont perdus, c'est-√†-dire que 64 octets au total sont obtenus.  Cela signifie que l'image enti√®re, y compris CHR, table de noms, palettes et attributs, prend 4096 + 960 + 16 + 64 = 5136 octets - bien mieux que le 30720 mentionn√© ci-dessus. <br><br><h1>  MAKECHR </h1><br>  La cr√©ation de ces quatre composants pour les graphiques NES est plus difficile que l'utilisation des API bitmap standard, mais les outils viennent √† la rescousse.  Les d√©veloppeurs NES avaient probablement une sorte de cha√Æne d'outils, mais quoi que ce soit, l'histoire ne l'a pas enregistr√©e.  Aujourd'hui, les d√©veloppeurs √©crivent g√©n√©ralement des programmes pour convertir des graphiques au format NES souhait√©. <br><br>  Toutes les images de ce post ont √©t√© cr√©√©es √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">makechr</a> , un outil r√©√©crit utilis√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Star Versus</a> .  Il s'agit d'un outil en ligne de commande con√ßu pour les versions automatis√©es et destin√© √† la vitesse, la qualit√© des messages d'erreur, la portabilit√© et l'intelligibilit√©.  Il cr√©e √©galement des visualisations int√©ressantes comme celles utilis√©es dans le post. <br><br><h1>  Les r√©f√©rences </h1><br>  Surtout des connaissances sur la programmation pour NES, et en particulier sur la cr√©ation de graphiques, j'ai obtenu des sources suivantes: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nintendo Age Nerdy Nights</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wiki de NesDev</a> </li></ul><br><h1>  Remarques </h1><br>  [1] Terminologie - dans certains documents, les blocs sont appel√©s ¬´m√©ta-tuiles¬ª, ce qui me semble personnellement moins utile. <br><br>  [2] Codage CHR - 2 bits par pixel ne sont pas stock√©s c√¥te √† c√¥te.  L'image compl√®te est d'abord enregistr√©e uniquement avec les bits faibles, puis √† nouveau enregistr√©e uniquement avec les bits √©lev√©s. <br><br>  Autrement dit, le c≈ìur sera stock√© comme ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc5/68c/f95/cc568cf959b148d1d11a408876806ae8.png" alt="pixel-coeur-bas" width="128" height="128"><img src="https://habrastorage.org/getpro/habr/post_images/f87/947/070/f879470703605322e98a2582241b071e.png" alt="pixel-coeur-haut" width="128" height="128"><br><br>  Chaque ligne est un octet.  Autrement dit, 01100110 est de 66 $, 01111111 est de 7 $.  Au total, les octets du c≈ìur ressemblent √† ceci: <br><br>  $ 66 $ 7f $ ff $ ff $ ff $ 7e $ 3c $ 18 $ 66 $ 5f $ bf $ bf $ ff $ 7e $ 3c $ 18 $ <br><br>  [3] Table de noms - dans ce tableau en jeu, la table des noms est utilis√©e diff√©remment.  En r√®gle g√©n√©rale, les lettres de l'alphabet sont conserv√©es en m√©moire dans le quartier, y compris Castlevania. <br><br>  [4] Palette syst√®me - NES n'utilise pas de palette RVB et les couleurs r√©elles qu'elle rend d√©pendent du t√©l√©viseur particulier.  Les √©mulateurs utilisent g√©n√©ralement des palettes RVB compl√®tement diff√©rentes.  Les couleurs de cet article correspondent √† la palette √©nonc√©e dans makechr. <br><br>  [5] Encodage des attributs - Les attributs sont stock√©s dans un ordre √©trange.  Ils ne vont pas de gauche √† droite, de haut en bas - la zone de bloc 2 √ó 2 est cod√©e avec un octet, sous la forme de la lettre Z. C'est pourquoi 4 octets sont gaspill√©s;  la ligne de fond est un plein 8 octets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/71a/951/0db/71a9510db28128bca1841689ce909c27.png" alt="pal-block-group" width="64" height="64"></div><br>  Par exemple, un bloc de 308 $ est stock√© avec 30 $, 348 $ et 34 $.  Leurs valeurs de palette sont 1, 2, 3 et 3 et sont stock√©es dans l'ordre de la position la plus basse √† la position la plus √©lev√©e, ou 11 :: 11 :: 10 :: 01 = 11111001. Par cons√©quent, la valeur en octets de ces attributs est $ f9. <br><br><h2>  2e partie </h2><br>  Dans la premi√®re partie, nous avons parl√© des composants des graphiques d'arri√®re-plan NES - CHR, table de noms, palettes et attributs.  Mais ce n'est que la moiti√© de l'histoire. <br><br>  Pour commencer, il existe en fait deux tables de noms [6].  Chacun d'eux a ses propres attributs pour d√©finir la couleur, mais ils ont le m√™me CHR.  L'√©quipement des cartouches d√©termine leur position: soit c√¥te √† c√¥te, soit l'une au-dessus de l'autre.  Voici des exemples de deux types d'emplacements diff√©rents: Lode Runner (1984) et Bubble Bobble (1988). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/759/7ef/7c9/7597ef7c97f3e31ed3bb4198727dee37.png" width="512" height="500"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e7/035/72a/0e703572ad771478c13bffa254a86579.png" alt="bulle-bobble-scrolling" width="532" height="480"></div><br><h1>  D√©filement </h1><br>  Pour profiter de la pr√©sence de deux tables de noms, PPU prend en charge la possibilit√© de faire d√©filer les pixels √† la fois le long des axes X et Y. Il est contr√¥l√© par un registre avec affichage en m√©moire √† 2005 $: l'√©criture de seulement deux octets √† cette adresse d√©place tout l'√©cran au nombre de pixels souhait√© [7] .  Au moment de la sortie de NES, c'√©tait le principal avantage par rapport aux autres consoles de salon, dans lesquelles pour le d√©filement, il fallait souvent r√©√©crire toute la m√©moire vid√©o.  Un tel syst√®me facile √† utiliser a conduit √† l'√©mergence d'un grand nombre de plateformes et de tireurs, et est devenu la principale raison d'un tel succ√®s du syst√®me. <br><br>  Pour un jeu simple, dont le champ ne fait que deux √©crans de large, par exemple, Load Runner, il suffisait juste de remplir les deux tableaux de noms et de modifier le d√©filement en cons√©quence.  Mais dans la plupart des jeux √† d√©filement, les niveaux avaient une largeur arbitraire.  Pour les impl√©menter, le jeu doit mettre √† jour la partie hors √©cran des tables de noms avant qu'elles n'apparaissent √† l'√©cran.  La valeur de d√©filement est boucl√©e, mais comme la table des noms est constamment mise √† jour, cela cr√©e l'illusion d'une taille infinie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/829/936/ab4/829936ab4b2855cd7f824ebd01941bb3.gif" width="512" height="500"></div><br><h1>  Sprites </h1><br>  En plus de faire d√©filer les tableaux de noms, NES avait √©galement un aspect compl√®tement diff√©rent des graphiques: les sprites.  Contrairement aux tables de noms qui doivent √™tre align√©es dans des grilles, les sprites peuvent √™tre positionn√©s arbitrairement, de sorte qu'ils peuvent √™tre utilis√©s pour afficher les personnages des joueurs, les obstacles, les projectiles et tous les objets avec des mouvements complexes.  Par exemple, dans la sc√®ne ci-dessus de Mega Man (1987) pour afficher le personnage d'un joueur.  les points et les bandes d'√©nergie sont des sprites utilis√©s, ce qui leur permet de sortir de la grille des tables de noms lors du d√©filement de l'√©cran. <br><br>  Les sprites ont leur propre page CHR [8] et un ensemble de 4 palettes.  De plus, ils occupent une page de m√©moire de 256 octets.  qui r√©pertorie la position et l'apparence de chaque image-objet (il s'av√®re que la m√©moire vid√©o NES est deux fois et demie plus grande que celle mentionn√©e dans la premi√®re partie de l'article).  Le format de ces enregistrements est assez inhabituel - ils contiennent d'abord une position en Y, puis un num√©ro de tuile, puis un attribut, puis une position en X [9].  √âtant donn√© que chaque enregistrement prend 4 octets, il existe une restriction stricte: √† l'√©cran, il ne peut pas y avoir plus de 256/4 = 64 sprites √† la fois. <br><br>  Les octets Y et X sp√©cifient le pixel sup√©rieur gauche du sprite dessin√©.  Par cons√©quent, sur le c√¥t√© droit de l'√©cran, le sprite peut √™tre rogn√©, mais sur le c√¥t√© gauche, il laisse un espace vide.  L'octet de la tuile est similaire √† la valeur dans la table des noms, seulement pour ces tuiles les sprites utilisent leur propre CHR.  Un octet d'attribut est un paquet de bits qui effectue trois t√¢ches: deux bits sont allou√©s √† la palette, deux bits sont utilis√©s pour refl√©ter le sprite horizontalement ou verticalement, et un bit d√©termine s'il faut rendre le sprite sous les tables de noms [10]. <br><br><h1>  Limitations </h1><br>  Les syst√®mes modernes permettent de travailler avec des sprites de n'importe quelle taille arbitraire, mais sur NES, le sprite d√ª aux limitations CHR devait avoir une taille de 8 √ó 8 [11].  Les objets plus grands sont constitu√©s de plusieurs sprites, et le programme doit s'assurer que toutes les parties individuelles sont rendues c√¥te √† c√¥te.  Par exemple, une taille de personnage Megaman peut atteindre 10 sprites, ce qui vous permet √©galement d'utiliser plus de couleurs, en particulier pour ses yeux blancs et son teint. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dd8/fea/3dc/dd8fea3dc4880761b52885c8ff83acdd.png"></div><br>  La principale limitation associ√©e √† l'utilisation de sprites est qu'il ne doit pas y avoir plus de 8 sprites par ligne raster.  Si plus de 8 sprites apparaissent sur une ligne horizontale de l'√©cran, ceux qui sont apparus plus tard ne seront tout simplement pas rendus.  C'est la raison du scintillement dans les jeux avec beaucoup de sprites;  le programme √©change les adresses des sprites en m√©moire afin que chacun d'eux soit rendu au moins occasionnellement. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f0/b67/13c/5f0b6713c1be1837d0da2d8213253932.gif" alt="m√©gaman-scintillement" width="332" height="128"></div><br>  Enfin, le d√©filement n'affecte pas les sprites: la position du sprite sur l'√©cran est d√©termin√©e par ses valeurs Y et X, quelle que soit la position du d√©filement.  Parfois, c'est un plus, par exemple, lorsque le niveau se d√©place par rapport au joueur ou que l'interface reste dans une position fixe.  Cependant, dans d'autres cas, c'est un inconv√©nient - vous devez d√©placer l'objet en mouvement, puis changer sa position en fonction de la quantit√© de changement dans le d√©filement. <br><br><h1>  Remarques </h1><br>  [6] En th√©orie, il y a en fait quatre tables de noms, mais elles sont refl√©t√©es de telle mani√®re que seulement 2 d'entre elles contiennent des graphiques uniques.  Lorsqu'ils sont plac√©s c√¥te √† c√¥te, cela s'appelle la mise en miroir verticale, et lorsque les tables de noms sont situ√©es l'une au-dessus de l'autre, la mise en miroir horizontale. <br><br>  [7] Il existe √©galement un registre qui s√©lectionne la table de noms avec laquelle commencer le rendu, c'est-√†-dire que le d√©filement est en fait une valeur de 10 bits, ou 9 bits, compte tenu de la mise en miroir. <br><br>  [8] Ce n'est pas toujours le cas.  PPU peut √™tre configur√© pour utiliser la m√™me page CHR pour les tables de noms que pour les sprites. <br><br>  [9] Cette commande a peut-√™tre √©t√© utilis√©e car elle correspond aux donn√©es que le PPU doit traiter pour un rendu efficace. <br><br>  [10] Ce bit est utilis√© pour divers effets, par exemple, pour d√©placer Mario sous les blocs blancs dans Super Mario Bros 3, ou pour rendre le brouillard sur les sprites dans Castlevania 3. <br><br>  [11] PPU a √©galement une option pour activer les sprites 8 √ó 16, qui est utilis√© dans des jeux comme Contra, o√π il y a de grands personnages.  Cependant, toutes les autres restrictions s'appliquent. <br><br><h2>  3e partie </h2><br>  Dans les parties pr√©c√©dentes, nous avons parl√© des donn√©es CHR, des arri√®re-plans bas√©s sur des tables de noms, des sprites et du d√©filement.  Et c'est pratiquement tout ce qu'une simple cartouche NES peut faire sans mat√©riel suppl√©mentaire.  Mais pour aller plus loin, nous devons expliquer en d√©tail le fonctionnement du rendu. <br><br><h1>  Rendu </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/12b/0d4/0ad/12b0d40ad74d27ce6d8ff2499c6df163.gif" width="200" height="200"></div><br>  <i>Raster rendu avec une pause pour vblank</i> <br><br>  Comme d'autres anciens ordinateurs, NES a √©t√© con√ßu pour fonctionner avec les t√©l√©viseurs CRT.  Ils dessinent des lignes de balayage sur l'√©cran, une √† la fois, de gauche √† droite, de haut en bas, √† l'aide d'un canon √† √©lectrons qui se d√©place physiquement jusqu'au point de l'√©cran o√π ces lignes sont trac√©es.  Apr√®s avoir atteint le coin inf√©rieur, une p√©riode de temps appel√©e ¬´blanc vertical¬ª (ou vblank) s'installe: le canon √† √©lectrons retourne dans le coin sup√©rieur gauche pour pr√©parer le dessin de l'image suivante.  A l'int√©rieur de NES, le PPU (Picture Processing Unit) effectue automatiquement le rendu raster, dans chaque image, et le code travaillant dans le CPU fait toutes les t√¢ches que le jeu doit effectuer.  Vblank permet au programme de remplacer les donn√©es dans la m√©moire PPU, car sinon ces donn√©es seront utilis√©es pour le rendu.  Le plus souvent, des modifications sont apport√©es √† la table des noms et aux palettes PPU pendant cette petite fen√™tre. <br><br>  Cependant, certains changements dans l'√©tat du PPU peuvent √™tre effectu√©s pendant le rendu d'√©cran.  Ils sont appel√©s ¬´effets raster¬ª.  L'action la plus courante effectu√©e pendant le rendu d'√©cran consiste √† d√©finir la position de d√©filement.  Gr√¢ce √† cela, une partie de l'image reste statique (par exemple, l'interface de jeu), et tout le reste continue de d√©filer.  Pour obtenir cet effet, il est n√©cessaire de s√©lectionner pr√©cis√©ment l'heure de modification de la valeur de d√©filement afin qu'elle se produise sur la ligne raster souhait√©e.  Il existe de nombreuses m√©thodes pour impl√©menter une telle synchronisation entre le code du jeu et PPU. <br><br><h1>  √âcran partag√© </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36e/4bf/c1e/36e4bfc1e8e92ae1dbfb83225946dc0f.png" width="512" height="480"></div><br>  <i>Le niveau d√©file et l'interface en haut de l'√©cran reste immobile</i> <br><br>  Premi√®rement, PPU a un mat√©riel int√©gr√© qui traite les sprites dans la position de m√©moire z√©ro d'une mani√®re sp√©ciale.  Lors du rendu de cette image-objet, si l'un de ses pixels chevauche la partie visible de l'arri√®re-plan, un bit est d√©fini sous le nom "indicateur de l'image-objet".  Le code du jeu peut d'abord placer ce sprite l√† o√π le fractionnement d'√©cran doit se produire, puis attendre en boucle, en v√©rifiant la valeur du drapeau sprite0.  Par cons√©quent, lorsque la boucle est termin√©e, le jeu saura avec certitude quelle ligne raster est actuellement en cours de rendu.  Cette technique est utilis√©e pour impl√©menter le partage d'√©cran simple dans de nombreux jeux NES, notamment Ninja Gaiden (1989), illustr√© ci-dessus [12] <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/66b/acd/f19/66bacdf196bab83b91ea70c2657dd497.png" alt="ninja-hud" width="256" height="240"></div><br>  <i>Sprite0 est situ√© √† Y $ 26, X $ a0.</i>  <i>Lorsque sa rang√©e inf√©rieure de pixels est rendue, le drapeau sprite0 est d√©fini</i> <br><br>  Dans certains jeux, le drapeau sprite0 est combin√© avec une autre technique - boucle temporis√©e de mani√®re pr√©visible (¬´un cycle avec un timing pr√©visible¬ª): le programme attend jusqu'√† ce que plusieurs lignes suppl√©mentaires soient rendues pour diviser l'√©cran en plusieurs parties. ,       Ninja Gaiden    , ,       .    ,       ,    ,   sprite0    ,      timed loops. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf9/19a/bfd/cf919abfdd1c0d786440e0af2c99bb24.gif" alt="ninjas-in-field" width="512" height="480"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f77/fab/d51/f77fabd51c4431db2c98ee1bf64e0eb2.gif" alt="castle-view" width="512" height="480"></div><br>             ,    ,      .          ( ,         (memory mapping)),          [13],       .             ,     .      NES,      ,    . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/9c3/f4f/6189c3f4fa79e5c31b80b2c14df75dcb.gif" alt="train-level" width="512" height="480"></div><br>    Ninja Gaiden 2,           ,      ,     . ,         ;            .   ,           . <br><br><h1>   </h1><br>       ,        .  ,       ,      [14].        (        ),     CHR,      ,       .      ,       .                 .    Ninja Gaiden             ,     ,           CHR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69f/896/804/69f8968042bded347183e35af32c16ae.gif" alt="goofall-bg" width="512" height="480"></div><br> <i> ,     </i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/290/882/f90/290882f90bb731af9e98f7ee65b4e64f.png" alt="goofall-nt" width="512" height="480"></div><br> <i>  ,        </i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf7/077/b23/cf7077b23ea5242b4f27d308b7514077.png" width="512" height="480"></div><br> <i>      CHR.     ,     </i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7a2/335/28e/7a233528e53b01341d21112b3651310e.png" alt="who-are-they-bottom-bank" width="512" height="480"></div><br> <i>      CHR.       </i> <br><br>        ,   (   ) .      ,     ,              .        ,      .               ,      [15].      ,           CHR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/501/6b4/281/5016b4281a88523177dffef3f8de4250.gif" alt="metal-storm-bg" width="512" height="464"></div><br> <i>Metal Storm (1991 )      </i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c05/7d4/6cb/c057d46cbf7f4d2cfb3e401d1658692f.png" alt="metal-storm-nt" width="512" height="464"></div><br> <i>      </i> <br><br> CHR    ‚Äî    ,     .       ,           ;       .  ,  CHR   ,     ,    . ,       ,        ,      . <br><br><h1>   </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ad/f22/f28/9adf22f2804a300f6f3e9a98fe15c13b.gif" alt="vice-fire" width="512" height="480"></div><br> <i> Vice: Project Doom (1991 )    ,        .       ,     .</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/253/25b/9b9/25325b9b935359508dc420aa35ef1748.gif" alt="sword-master" width="512" height="480"></div><br> <i>Sword Master (1990 )        ,            .</i> <br><br><h1>  Remerciements </h1><br>              ,   FCEUX.  ,      sprite0    NesDev: <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FCEUX</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">NesDev wiki</a> </li></ul><br><h1>  </h1><br> [12]   ,   Ninja Gaiden  .     8√ó16 sprites ‚Äî  ,  PPU,       .   sprite0  ,  sprite1      .    z-  ,      ,   . <br><br> [13]    .          .      PPU  , ,     .          (IRQ),      ,  ,        . <br><br> [14]      ,         ,    .   ,    , -      4   8 . <br><br> [15]     CHR        :      ,      .        , ,  1   ,     . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470614/">https://habr.com/ru/post/fr470614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470602/index.html">√Ä quoi ressemblerait le m√©tro de Moscou dans un monde en trois dimensions</a></li>
<li><a href="../fr470604/index.html">Vitesse de chargement des sites dans le commerce √©lectronique: analyse des 48 meilleurs magasins en ligne en Russie</a></li>
<li><a href="../fr470608/index.html">Optimisation de l'interface utilisateur Unity</a></li>
<li><a href="../fr470610/index.html">Un jour dans la vie d'un d√©veloppeur</a></li>
<li><a href="../fr470612/index.html">Ce qu'un voltm√®tre montre, ou des prises math√©matiques</a></li>
<li><a href="../fr470616/index.html">Une nouvelle solution au paradoxe de Fermi (pourquoi nous sommes seuls dans l'univers)</a></li>
<li><a href="../fr470618/index.html">Mod√©lisation th√©matique de l'actualit√© √† l'aide de l'analyse factorielle</a></li>
<li><a href="../fr470620/index.html">Infrastructure en tant que code: comment surmonter les probl√®mes avec XP</a></li>
<li><a href="../fr470622/index.html">Pr√©sentation des m√©thodes de s√©lection des fonctionnalit√©s</a></li>
<li><a href="../fr470628/index.html">Construction navale de simulateur de vaisseau spatial</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>