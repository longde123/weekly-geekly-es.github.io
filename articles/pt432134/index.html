<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö° üîá üîï Gera√ß√£o de ambiente baseado em som e m√∫sica no Unity3D. Parte 2. Criando uma faixa 2D a partir da m√∫sica üë©üèø‚Äçüè´ üôÖüèº üë©‚Äçüè´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anota√ß√£o 


 Ol√° pessoal. Recentemente, escrevi um artigo Gerando um ambiente baseado em som e m√∫sica no Unity3D , no qual dei v√°rios exemplos de jogo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gera√ß√£o de ambiente baseado em som e m√∫sica no Unity3D. Parte 2. Criando uma faixa 2D a partir da m√∫sica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/432134/"><h2 id="annotaciya">  Anota√ß√£o </h2><br><p>  Ol√° pessoal.  Recentemente, escrevi um artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gerando um ambiente baseado em som e m√∫sica no Unity3D</a> , no qual dei v√°rios exemplos de jogos que usam a mec√¢nica de gera√ß√£o de conte√∫do com base em m√∫sica e tamb√©m falei sobre os aspectos b√°sicos de tais jogos.  Praticamente n√£o havia c√≥digo no artigo e prometi que haveria uma sequ√™ncia.  E aqui est√°, na sua frente.  Desta vez, tentaremos criar uma faixa para uma corrida 2D, no estilo de Hill Climb, a partir da sua m√∫sica.  Vamos ver o que temos .. </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  1. Introdu√ß√£o </h2><br><p>  Lembro que esta s√©rie de artigos foi projetada para desenvolvedores iniciantes e para aqueles que recentemente come√ßaram a trabalhar com som.  Se voc√™ estiver fazendo uma transforma√ß√£o r√°pida de Fourier em sua mente, provavelmente ficar√° entediado. </p><br><p>  Aqui est√° o nosso roteiro para hoje: </p><br><ol><li>  Considere o que √© discretiza√ß√£o. </li><li>  Descubra quais dados podemos obter do Audio Clip Unity </li><li>  Entenda como podemos trabalhar com esses dados. </li><li>  Descubra o que podemos gerar com esses dados. </li><li>  Aprenda a criar um jogo com tudo isso (bem, ou algo semelhante a um jogo) </li></ol><br><p>  Ent√£o vamos l√°! </p><br><h2 id="diskretizaciya-analogovogo-singala">  Discretiza√ß√£o de cingal√™s anal√≥gico </h2><br><p>  Como muitas pessoas sabem, para usar um sinal em sistemas digitais, precisamos convert√™-lo.  Uma das etapas de convers√£o √© a amostragem de sinal, na qual o sinal anal√≥gico √© dividido em partes (relat√≥rios tempor√°rios), ap√≥s o qual √© atribu√≠do a cada relat√≥rio o valor de amplitude que estava no momento selecionado. <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p>  A letra T indica o per√≠odo de amostragem.  Quanto menor o per√≠odo, mais precisa ser√° a convers√£o do sinal.  Mas na maioria das vezes eles falam sobre o inverso: Taxa de amostragem (√© l√≥gico que seja F = 1 / T).  8.000 Hz s√£o suficientes para um telefone individual e, por exemplo, uma das op√ß√µes para o formato DVD-Audio requer uma frequ√™ncia de amostragem de 192.000 Hz.  O padr√£o na grava√ß√£o digital (em editores de jogos, editores de m√∫sica) √© 44 100 Hz - essa √© a frequ√™ncia do CD Audio. </p><br><p>  Os valores num√©ricos da amplitude s√£o armazenados nas chamadas amostras e √© com elas que iremos trabalhar.  O valor da amostra √© flutuante e pode ser de -1 a 1. Simplificado, fica assim. </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno">  Renderiza√ß√£o de ondas sonoras (est√°tica) </h2><br><h3 id="bazovaya-informaciya">  Informa√ß√£o b√°sica </h3><br><p>  A forma de onda (ou forma de √°udio e em pessoas comuns - "peixe") √© uma representa√ß√£o visual do sinal sonoro ao longo do tempo.  A forma de onda pode nos mostrar em que ponto do som a fase ativa ocorre e onde a atenua√ß√£o ocorre.  Frequentemente, a forma de onda √© apresentada para cada canal separadamente, por exemplo, assim: </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p>  Imagine que j√° temos um AudioSource e um script no qual trabalhamos.  Vamos ver o que a Unity pode nos dar. </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov">  Selecione o n√∫mero de relat√≥rios </h3><br><p>  Antes de prosseguirmos, precisamos falar um pouco sobre a profundidade de renderiza√ß√£o do nosso som.  Com uma frequ√™ncia de amostragem de 44100 Hz por segundo, somos capazes de processar 44100 relat√≥rios.  Digamos que precisamos renderizar uma faixa com 10 segundos de dura√ß√£o.  Desenharemos cada relat√≥rio com uma linha em um pixel de largura.  Acontece que nossa forma de onda ter√° 441.000 pixels de comprimento.  Voc√™ obt√©m uma onda sonora muito longa, alongada e pouco compreendida.  Mas, nele voc√™ pode ver cada relat√≥rio espec√≠fico!  E voc√™ carregar√° terrivelmente o sistema, n√£o importa como o desenhe. </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p>  Se voc√™ n√£o cria software de √°udio profissional, n√£o precisa dessa precis√£o.  Para uma imagem de √°udio geral, podemos dividir todas as amostras em per√≠odos maiores e obter, por exemplo, a m√©dia de cada 100 amostras.  Ent√£o nossa onda ter√° uma forma muito distinta: </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p>  Obviamente, isso n√£o √© totalmente preciso, pois voc√™ pode pular os picos de volume necess√°rios para tentar n√£o o valor m√©dio, mas o m√°ximo desse segmento.  Isso dar√° uma imagem um pouco diferente, mas seus picos n√£o desaparecer√£o. </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh">  Preparando para receber √°udio </h3><br><p>  Vamos definir a precis√£o de nossa amostra como qualidade e o n√∫mero final de relat√≥rios como sampleCount. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p>  Um exemplo de c√°lculo de todos os n√∫meros estar√° abaixo. </p><br><p>  Em seguida, precisamos obter as amostras n√≥s mesmos.  Isso pode ser feito a partir de um clipe de √°udio usando o m√©todo <strong>GetData</strong> . </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Este m√©todo utiliza uma matriz na qual grava amostras.  offsetSamples - par√¢metro respons√°vel pelo ponto inicial da leitura da matriz de dados.  Se voc√™ ler a matriz desde o in√≠cio, deve haver zero. </p><br><p>  Para registrar amostras, precisamos preparar uma matriz para elas.  Por exemplo, assim: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p>  Por que multiplicamos o comprimento pelo n√∫mero de canais?  Agora vou contar ... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Informa√ß√µes do canal de √°udio da Unity </h3><br><p>  Muitas pessoas sabem que no som geralmente usamos dois canais: esquerdo e direito.  Algu√©m sabe que existem sistemas 2.1, bem como 5.1, 7.1 nos quais as fontes sonoras envolvem todos os lados.  O tema dos canais est√° bem descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no wiki</a> .  Como isso funciona no Unity? </p><br><p>  Ao baixar um arquivo, ao abrir um clipe, voc√™ pode encontrar a seguinte imagem: </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p>  √â apenas mostrado aqui que temos dois canais, e voc√™ pode at√© notar que eles s√£o diferentes um do outro.  O Unity registra amostras desses canais um ap√≥s o outro.  Acontece esta imagem: <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-7"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-9" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-13" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-17" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-29" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-31"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-33" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-37" style="vertical-align: -0.4em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-38" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-39"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-41" style="vertical-align: -0.4em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-45" style="vertical-align: -0.4em;">6</span></span><span class="MJXp-mo" id="MJXp-Span-46" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-47"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;">6</span></span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-51"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-53" style="vertical-align: -0.4em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-57" style="vertical-align: -0.4em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-61" style="vertical-align: -0.4em;">8</span></span><span class="MJXp-mo" id="MJXp-Span-62" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">8</span></span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-1"> [L_1, R_1, L_2, R_2, L_3, R_3, L_4, R_4, L_5, R_5, L_6, R_6, L_7, R_7, L_8, R_8 ...] </script></p><br><p>  √â por isso que precisamos do dobro do espa√ßo na matriz do que apenas para o n√∫mero de amostras. </p><br><p>  Se voc√™ selecionar a op√ß√£o For√ßar clipe mono, o canal ser√° um e todo o som estar√° no centro.  A pr√©-visualiza√ß√£o da sua onda mudar√° imediatamente. </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh">  Receber dados de √°udio </h3><br><p>  Aqui est√° o que temos: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p>  Total, se a faixa durar 10 segundos e for de dois canais, obteremos o seguinte: </p><br><ul><li>  O n√∫mero de amostras no clipe (myAudio.clip.sample) = 44100 * 10 = 441000 </li><li>  A matriz de amostras para dois canais √© longa (samples.Length) = 441000 * 2 = 882000 </li><li>  N√∫mero de relat√≥rios (sampleCount) = 44100/100 = 441 </li><li>  O comprimento da matriz final = samples.Length / sampleCount = 2000 </li></ul><br><p>  Como resultado, trabalharemos com 2000 pontos, o que √© suficiente para desenhar a onda.  Agora voc√™ precisa incluir a imagina√ß√£o e pensar em como podemos usar esses dados. </p><br><h3 id="otrisovka-audioinformacii">  Renderizando informa√ß√µes de √°udio </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv">  Crie uma faixa de √°udio simples usando as ferramentas de depura√ß√£o </h4><br><p>  Como muitas pessoas sabem, o Unity possui meios convenientes para exibir todos os tipos de informa√ß√µes de depura√ß√£o.  Um desenvolvedor inteligente baseado nessas ferramentas pode criar, por exemplo, extens√µes muito poderosas para o editor.  Nosso caso mostra um uso muito at√≠pico dos m√©todos Debug. </p><br><p>  Para desenhar, precisamos de uma linha.  Podemos fazer isso com a ajuda de um vetor que ser√° criado a partir dos valores de nossa matriz.  Observe que, para criar uma bela forma de espelho de √°udio, precisamos "colar" as duas metades da nossa visualiza√ß√£o. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p>  Em seguida, basta usar Debug.DrawLine para desenhar nossos vetores.  Qualquer cor pode escolher.  Todos esses m√©todos devem ser chamados em Atualizar, portanto, atualizaremos as informa√ß√µes a cada quadro. </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p>  Se desejar, voc√™ pode adicionar um "controle deslizante" que mostrar√° a posi√ß√£o atual da faixa que est√° sendo reproduzida.  Esta informa√ß√£o pode ser obtida no campo "AudioSource.timeSamples". </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p>  Total, aqui est√° o nosso script: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p>  E aqui est√° o resultado: </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d">  Crie uma paisagem sonora suave com o PolygonCollider2D </h4><br><p>  Antes de prosseguir para esta se√ß√£o, quero observar o seguinte: √© claro que dirigir pela trilha gerada pela m√∫sica √© divertido, mas do ponto de vista da jogabilidade, √© praticamente in√∫til.  E aqui est√° o porqu√™: </p><br><ol><li>  Para que a faixa seja aceit√°vel, precisamos suavizar nossos dados.  Todos os picos desaparecem e voc√™ praticamente para de "sentir sua m√∫sica" </li><li>  Geralmente, as faixas de m√∫sica s√£o altamente compactadas e representam um tijolo de som, pouco adequado para um jogo 2D. </li><li>  A quest√£o n√£o resolvida da velocidade do nosso transporte, que deve ser adequada √† velocidade da pista.  Quero considerar esse problema no pr√≥ximo artigo. </li></ol><br><p>  Portanto, como um experimento, esse tipo de gera√ß√£o √© bastante engra√ßado, mas √© dif√≠cil criar um recurso de jogabilidade real com base nele.  De qualquer forma, continuamos. </p><br><p>  Ent√£o, precisamos criar o PolygonCollider2D usando nossos dados.  Isso √© f√°cil de fazer.  PolygonCollider2D possui um campo de pontos p√∫blicos que aceita Vector2 [].  Primeiro, precisamos transferir nossos pontos para os vetores do tipo desejado.  Vamos criar uma fun√ß√£o para converter a matriz de nossas amostras em uma matriz vetorial: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  Depois disso, basta passar nossa matriz de vetores resultante para o colisor: </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p>  N√≥s olhamos para o resultado.  Aqui est√° o come√ßo da nossa faixa ... hmm ... n√£o parece muito aceit√°vel (n√£o pense em visualiza√ß√£o ainda, os coment√°rios vir√£o mais tarde). </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p>  Temos uma forma de √°udio muito n√≠tida, ent√£o a faixa sai estranha.  Precisa suavizar.  Aqui usamos o algoritmo de m√©dia m√≥vel.  Voc√™ pode ler mais sobre isso no Habr, no artigo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O algoritmo da m√©dia m√≥vel (m√©dia m√≥vel simples)</a> . </p><br><p>  No Unity, o algoritmo √© implementado da seguinte maneira: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p>  Modificamos nossa cria√ß√£o de caminho: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p>  Verificando ... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p>  Agora nossa pista parece bastante normal.  Usei uma largura de janela de 10. Voc√™ pode modificar esse par√¢metro para escolher a suaviza√ß√£o de que precisa. </p><br><p>  Aqui est√° o script completo para esta se√ß√£o: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p>  Como eu disse no in√≠cio da se√ß√£o, com essa suaviza√ß√£o, paramos de sentir a faixa, al√©m disso, a velocidade da m√°quina n√£o est√° atrelada √† velocidade da m√∫sica (BPM).  Analisaremos esse problema na pr√≥xima parte desta s√©rie de artigos.  Al√©m disso, abordaremos o t√≥pico de promo√ß√µes.  efeitos sob o ritmo.  A prop√≥sito, peguei uma m√°quina de escrever desse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ativo gratuito</a> . </p><br><p>  Provavelmente muitos de voc√™s, olhando as capturas de tela, se perguntaram como eu desenhei a trilha?  Afinal, os colisores n√£o s√£o vis√≠veis. </p><br><p>  Usei a sabedoria da Internet e encontrei uma maneira de transformar um colisor de pol√≠gono em uma malha √† qual voc√™ pode atribuir qualquer material, e o renderizador de linhas far√° um esbo√ßo elegante.  Este m√©todo √© descrito em detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Triangulador que voc√™ pode enfrentar na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Unity Community</a> . </p><br><h2 id="zavershenie">  Conclus√£o </h2><br><p>  O que aprendemos neste artigo √© um esbo√ßo b√°sico para jogos musicais.  Sim, nesta forma, √©, at√© agora, um pouco feio, mas voc√™ pode dizer com seguran√ßa "Pessoal, fiz a m√°quina seguir a trilha de √°udio!".  Para tornar isso um jogo real, voc√™ precisa fazer muito esfor√ßo.  Aqui est√° uma lista do que podemos fazer aqui: </p><br><ol><li>  Ligue a velocidade da m√°quina √† faixa de BPM.  O jogador pode controlar apenas a inclina√ß√£o do carro, mas n√£o a velocidade.  Ent√£o a m√∫sica ser√° sentida muito mais forte durante o curso. </li><li>  Fa√ßa um pouco de detector e adicione promo√ß√µes.  efeitos que funcionar√£o sob o ritmo.  Al√©m disso, voc√™ pode adicionar anima√ß√£o √† carroceria do carro, que saltar√° na batida de uma batida.  Tudo depende da sua imagina√ß√£o. </li><li>  Em vez de mover a m√©dia, voc√™ precisa processar a trilha com mais compet√™ncia e obter uma matriz de dados para que os picos n√£o desapare√ßam, mas foi f√°cil criar um rastreio. </li><li>  Bem, e, claro, voc√™ precisa tornar a jogabilidade interessante.  Voc√™ pode colocar um pouco de moeda em cada golpe, adicionar zonas de perigo etc. </li></ol><br><p>  Estudaremos tudo isso e muito mais nas demais partes desta s√©rie de artigos.  Obrigado a todos pela leitura! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt432134/">https://habr.com/ru/post/pt432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt432120/index.html">Lenovo pagar√° aos propriet√°rios de laptop uma compensa√ß√£o de US $ 8,3 milh√µes pela instala√ß√£o do malware Superfish</a></li>
<li><a href="../pt432122/index.html">Xcode e depura√ß√£o avan√ßada no LLDB: parte 2</a></li>
<li><a href="../pt432128/index.html">Muletas, N√°rnia e Procrustes Ninja: tr√™s dores timl√≠dicas em uma startup</a></li>
<li><a href="../pt432130/index.html">Metas de outono sobre desenvolvimento m√≥vel no escrit√≥rio Tutu.ru</a></li>
<li><a href="../pt432132/index.html">William Shakespeare: dificuldades em traduzir sonetos para o russo</a></li>
<li><a href="../pt432136/index.html">Resfrie a CPU no data center - a impress√£o a laser 3D ajudar√°</a></li>
<li><a href="../pt432138/index.html">Vamos falar sobre m√©tricas como uma maneira de avaliar o trabalho de um programador</a></li>
<li><a href="../pt432142/index.html">Monitoramento de Colm√©ias e Projeto Aberto</a></li>
<li><a href="../pt432144/index.html">Como nos integramos √†s lojas SAP na Europa com balc√µes na R√∫ssia atrav√©s da 1C</a></li>
<li><a href="../pt432146/index.html">Zimbra Collaboration Suite como um substituto digno para o Microsoft Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>