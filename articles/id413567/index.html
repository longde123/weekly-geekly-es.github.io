<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äç‚öïÔ∏è üëàüèø üéÜ Memulai dengan layanan microser di Spring Boot ü§πüèª üéΩ üßôüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo semuanya! 

 Pada artikel ini, kami akan menunjukkan komponen dasar untuk membuat microservices RESTful menggunakan registri layanan Konsul, Spri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Memulai dengan layanan microser di Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/413567/">  Halo semuanya! <br><br>  Pada artikel ini, kami akan menunjukkan komponen dasar untuk membuat microservices RESTful menggunakan registri layanan Konsul, Spring Boot untuk semua perancah, injeksi dependensi, Maven untuk perakitan, serta Spring REST dan Java RESTful Jersey / JaxRS API. <br><br>  Keuntungan utama dari layanan microser: <br><br><ul><li>  Microservices membantu melonggarkan kode Anda </li></ul><br><ul><li>  Microservices memungkinkan tim yang berbeda untuk bekerja pada komponen kecil menggunakan teknologi independen, menyediakan penyebaran yang lebih aman dan sering. Spring Boot mendukung berbagai implementasi untuk membuat API REST </li></ul><br><ul><li>  Penemuan dan panggilan layanan tidak tergantung pada platform layanan </li></ul><br><ul><li>  Swagger menciptakan dokumentasi API dan antarmuka panggilan yang kuat </li></ul><br>  Jika Anda belum menggunakan layanan Microsoft, Anda belum berhasil masuk ke fase pengikut awal pada kurva persepsi teknologi, dan mungkin ini saatnya untuk memulai. <br><br><img src="https://habrastorage.org/webt/o_/ze/uu/o_zeuux9s9xpxbxjvitgdmiqox4.png"><a name="habracut"></a><br><br>  Selama dua dekade terakhir, perusahaan telah menjadi sangat fleksibel dalam proses SDLC kami, tetapi aplikasi kami, sebagai suatu peraturan, masih tetap monolitik, dengan toples besar yang mendukung semua berbagai API dan versi di pasar.  Tetapi saat ini, ada keinginan untuk lebih Ramping, proses DevOps, dan fungsi menjadi "serverless".  Refactoring ke layanan microser dapat mengurangi keterikatan kode dan sumber daya, membuat perakitan lebih kecil, rilis lebih aman, dan API lebih stabil. <br><br>  Dalam artikel ini, kami akan membuat aplikasi manajemen portofolio pasar saham sederhana yang dapat dihubungi pelanggan untuk mengevaluasi portofolio saham mereka (ticker dan nilai saham).  Layanan portofolio mikro akan mengambil portofolio klien, mengirimkannya ke layanan harga mikro untuk menerapkan harga terbaru, dan kemudian mengembalikan portofolio yang sepenuhnya dievaluasi dan disubotisasi, menunjukkan semua ini melalui panggilan sisa. <br><br><img src="https://habrastorage.org/webt/qe/ea/aw/qeeaawb8mapjtsibfyw3nro_ue8.png"><br><br>  Sebelum kita mulai membuat microservices, mari siapkan lingkungan kita dengan mengatur Konsul. <br><br><h3>  Unduh Konsul </h3><br>  Kami akan menggunakan Konsul Hashicorp untuk menemukan layanan, jadi kunjungi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.consul.io/downloads.html</a> dan unduh Konsul untuk Windows, Linux, Mac, dll.  Ini akan memberi Anda file yang dapat dieksekusi yang perlu Anda tambahkan ke jalur Anda. <br><br><h3>  Luncurkan Konsul </h3><br>  Pada prompt perintah, meluncurkan Konsul dalam mode dev: <br><br><pre><code class="bash hljs">consul agent -dev</code> </pre> <br>  Untuk memverifikasi bahwa itu sedang berjalan, buka browser Anda dan akses antarmuka konsul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 8500</a> .  Jika semuanya berjalan dengan baik, konsul harus melaporkan bahwa ia masih hidup dan sehat.  Dengan mengklik pada layanan konsul (di sebelah kiri), Anda akan menerima informasi tambahan (di sebelah kanan). <br><br><img src="https://habrastorage.org/webt/9p/4m/2t/9p4m2taqogtv6ahb3dnpmvvt2oc.png"><br><br>  Jika saat ini ada masalah, pastikan Anda menambahkan Konsul ke jalur eksekusi, dan port 8500 dan 8600 tersedia. <br><br><h3>  Bangun Aplikasi SpringBoot </h3><br>  Kami akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spring Initializr</a> , yang terintegrasi ke dalam sebagian besar IDE, untuk merancah aplikasi SpringBoot kami.  Tangkapan layar di bawah ini menggunakan IntelliJ IDEA. <br><br>  Pilih "File / Proyek Baru" untuk membuka templat proyek baru, dan kemudian "Spring Initializr". <br><br><img src="https://habrastorage.org/webt/xb/j5/3t/xbj53tf_bfr5dauohwqmv9gkdmm.png"><br><br>  Secara umum, Anda dapat mengatur perancah tanpa IDE dengan mengisi formulir online melalui halaman web SpringBoot Initializr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">start.spring.io</a> , yang akan membuat file zip untuk proyek kosong Anda, siap untuk diunduh. <br><br>  Klik "Next" dan isi metadata proyek.  Gunakan konfigurasi berikut: <br><br><img src="https://habrastorage.org/webt/l0/_p/zk/l0_pzkpsppbplfrusj7suogqmyk.png"><br><br>  Klik "Next" untuk memilih dependensi, dan masukkan "Jersey" dan "Consul Discovery" dalam pencarian dependensi.  Tambahkan dependensi ini: <br><br><img src="https://habrastorage.org/webt/jt/t8/l8/jtt8l89pauvzyu_oo_riav_na4e.png"><br><br>  Klik "Next" untuk menunjukkan nama proyek dan lokasinya.  Simpan nama "portofolio" default dan tentukan lokasi proyek yang disukai, lalu klik "selesai" untuk membuat dan membuka proyek: <br><br><img src="https://habrastorage.org/webt/un/xl/gh/unxlgh-ufplppxqhuyfyfdoug5g.png"><br><br>  Kita dapat menggunakan properti application.prop yang dihasilkan, tetapi SpringBoot juga mengenali format YAML, yang sedikit lebih mudah untuk divisualisasikan, jadi mari kita ganti namanya menjadi application.yml. <br><br>  Kami menyebut microservice "layanan portofolio".  Kita dapat menentukan port atau menggunakan port 0 sehingga aplikasi menggunakan port yang tersedia.  Dalam kasus kami, kami akan menggunakan 57116. Jika Anda meng-host layanan ini sebagai wadah Docker, Anda dapat memetakannya ke port yang Anda pilih.  Beri nama aplikasi dan tentukan port kami dengan menambahkan yang berikut ke application.yml kami: <br><br><pre> <code class="bash hljs">spring: application: name: portfolio-service server: port: 57116</code> </pre><br>  Untuk membuat layanan kami tersedia, tambahkan anotasi ke kelas aplikasi SpringBoot kami.  Buka aplikasi PortfolioApplication dan tambahkan @EnableDiscoveryClient di atas deklarasi kelas. <br><br>  Konfirmasikan impor.  Kelas akan terlihat seperti ini: <br><br><pre> <code class="bash hljs">package com.restms.demo.portfolio; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; . . . @SpringBootApplication @EnableDiscoveryClient public class PortfolioApplication { public static void main(String[] args) { SpringApplication.run(PortfolioApplication.class, args); } }</code> </pre><br>  (Untuk menunjukkan bagaimana layanan microsoft dapat terdiri dari platform independen, kami akan menggunakan Jersey untuk layanan ini dan Spring REST untuk selanjutnya). <br>  Untuk mengkonfigurasi layanan web RESTful di Jersey, kita perlu menentukan kelas konfigurasi ResourceConfig.  Tambahkan kelas JerseyConfig (untuk demonstrasi, kami akan menyimpannya dalam paket yang sama dengan kelas aplikasi kami).  Seharusnya terlihat seperti ini, ditambah paket yang benar dan impor: <br><br><pre> <code class="bash hljs">@Configuration @ApplicationPath(<span class="hljs-string"><span class="hljs-string">"portfolios"</span></span>) public class JerseyConfig extends ResourceConfig { public <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JerseyConfig</span></span></span></span>() { register(PortfolioImpl.class); } }</code> </pre><br>  Perhatikan bahwa ia mewarisi dari ResourceConfig untuk menetapkannya sebagai kelas konfigurasi Jersey.  Atribut @ApplicationPath ("portfolios") mendefinisikan konteks panggilan, yang berarti bahwa panggilan harus dimulai dengan elemen path "portfolioios".  (Jika Anda menghilangkannya, konteks default adalah "/"). <br><br>  Kelas PortfolioImpl akan melayani dua permintaan: portofolio / pelanggan / {pelanggan-id} mengembalikan semua portofolio dan portofolio / pelanggan / {pelanggan-id} / portofolio / {portfolio-id} mengembalikan satu portofolio.  Portofolio terdiri dari seperangkat ticker dan jumlah saham yang dimiliki oleh ticker itu.  (Untuk demonstrasi, ada tiga klien dengan pengidentifikasi 0, 1 dan 2, yang masing-masing memiliki tiga portofolio dengan pengidentifikasi 0, 1 dan 2). <br><br>  IDE Anda akan meminta Anda untuk membuat PortfolioImpl;  lakukan sekarang.  Untuk menunjukkan, tambahkan ke paket yang sama.  Masukkan kode di bawah ini dan konfirmasikan semua impor: <br><br><pre> <code class="bash hljs">@Component @Path(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) public class PortfolioImpl implements InitializingBean { private Object[][][][] clientPortfolios; @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) // a portfolio consists of an array of arrays, each containing an array of // stock ticker and associated shares public Object[][][] getPortfolios(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> clientPortfolios[customerId]; } @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) public Object[][] getPortfolio(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId, @PathParam(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) int portfolioId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> getPortfolios(customerId)[portfolioId]; } @Override public void afterPropertiesSet() throws Exception { Object[][][][] clientPortfolios = { { // 3 customers, 3 portfolios each {new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 10201}, new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 20400}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 38892}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"KO"</span></span>, 12449}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 23454}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 45344}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"WMT"</span></span>, 39583}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 95867}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 384756}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 38475}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MCD"</span></span>, 12395}, new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 91234}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"VZ"</span></span>, 22342}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 385432}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 23432}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 18343}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 45673}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AAPL"</span></span>, 23456}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 34543}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 55322}, new Object[]{<span class="hljs-string"><span class="hljs-string">"NKE"</span></span>, 45642}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"CVX"</span></span>, 44332}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 12453}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JNJ"</span></span>, 45433}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 32346}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 46532}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 45663}}, } }; this.clientPortfolios = clientPortfolios; } }</code> </pre><br>  Anotasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Komponen</a> menunjuk ini sebagai kelas komponen Pegas dan menyediakannya sebagai titik akhir.  Anotasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">jalur</a> tentang deklarasi kelas menyatakan bahwa kelas diakses melalui elemen path ‚Äú/‚Äù, dan dua panggilan api yang didukung tersedia melalui portofolio / pelanggan / {customer-id} dan portofolio / pelanggan / {customer-id} / portfolio / {portfolio- id}, seperti yang kita lihat dari penjelasan metode.  Perhatikan bahwa path ("/") adalah default, tetapi kami membiarkannya untuk referensi.  Metode ditetapkan sebagai HTTP DAPATKAN melalui @GETannotation.  Metode kami dirancang untuk mengembalikan array dan beranotasi untuk mengembalikan Json, sehingga mengembalikan array Json.  Perhatikan bagaimana anotasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Path</a> Param digunakan dalam tanda tangan metode untuk mengekstrak parameter yang ditampilkan dari kueri yang ditampilkan. <br><br>  (Untuk demo kami, kami mengembalikan nilai hardcoded. Tentu saja, dalam praktiknya, implementasi akan meminta basis data atau layanan lain atau sumber data alih-alih hardcode.) <br>  Sekarang buat proyek dan jalankan.  Jika Anda menggunakan IntelliJ, itu akan membuat executable default, jadi cukup klik panah "run" hijau.  Anda juga bisa menggunakan <br><br><pre> <code class="bash hljs">mvn spring-boot:run</code> </pre> <br>  Atau Anda dapat melakukan instalasi maven dan menjalankan aplikasi menggunakan java -jar, menunjuk ke jar yang dihasilkan di direktori target: <br><br><pre> <code class="bash hljs">java -jar target\portfolio-0.0.1-SNAPSHOT.jar</code> </pre> <br>  Sekarang kita akan melihat layanan ini di Konsul, jadi mari kembali ke browser kami, unduh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 8500 / ui / # / dc1 / services</a> (atau perbarui jika Anda sudah ada di sana). <br><br><img src="https://habrastorage.org/webt/bs/ab/2v/bsab2vs-dswpzy7nmpevmtphdma.png"><br><br>  Hmm, kami melihat layanan kami di sana, tetapi ditampilkan sebagai gagal.  Ini karena Konsul mengharapkan sinyal detak jantung "sehat" dari layanan kami. <br>  Untuk menghasilkan sinyal detak jantung, kita dapat menambahkan ketergantungan pada layanan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spring Actuator</a> ke pom aplikasi kita. <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt;</code> </pre><br>  Sementara kita berada di pom, perhatikan bahwa ada konflik versi dengan Jersey antara starter Konsul dan starter Jersey.  Untuk memperlancar ini, tentukan starter Jersey sebagai kecanduan pertama. <br><br>  Pom Anda sekarang harus berisi dependensi berikut: <br><br><pre> <code class="bash hljs">&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;</code> </pre><br>  Dengan memulai kembali Konsul, layanan Portofolio menampilkan yang bahagia: <br><br><img src="https://habrastorage.org/webt/uf/oq/qr/ufoqqrtcnxnlwazqy-ozrp1lceo.png"><br><br>  Sekarang dalam layanan portofolio ada dua node transmisi: salah satunya adalah implementasi layanan portofolio kami, dan yang lainnya adalah detak jantung. <br><br>  Mari kita periksa port yang telah ditetapkan.  Anda dapat melihat itu di output aplikasi: <br><br><pre> <code class="bash hljs">INFO 19792 --- [ main] sbcetTomcatEmbeddedServletContainer : Tomcat started on port(s): 57116 (http)</code> </pre> <br>  Anda juga dapat melihat port langsung di antarmuka pengguna Konsul.  Klik "layanan pelanggan", lalu pilih tautan "Layanan 'layanan pelanggan' ', yang menampilkan port layanan, dalam hal ini 57116. <br><br><img src="https://habrastorage.org/webt/s_/up/ce/s_upceczzu0xupqioariurhawz8.png"><br><br>  Minta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 57116 / portofolio / pelanggan / 1 / portofolio / 2</a> dan Anda akan melihat json array [["IBM", 18343], ["DIS", 45673], ["AAPL", 23456]] <br><br>  Layanan microser pertama kami terbuka untuk bisnis! <br><br><h3>  Layanan penetapan harga </h3><br>  Selanjutnya, kami akan membuat layanan penetapan harga kami, kali ini menggunakan Spring RestController alih-alih Jersey. <br><br>  Layanan penetapan harga akan menerima pengidentifikasi klien dan pengidentifikasi portofolio sebagai parameter dan akan menggunakan RestTemplate untuk meminta layanan portofolio, menerima ticker dan stok, dan mengembalikan harga saat ini.  (Saya tidak perlu memberi tahu Anda bahwa nilai-nilai ini adalah berita palsu, jadi jangan menggunakannya untuk membuat keputusan perdagangan!) <br><br>  Buat proyek baru menggunakan informasi berikut: <br><br><img src="https://habrastorage.org/webt/gz/sy/sm/gzsysm7_cgynyxucuhgrcfoxhbs.png"><br><br>  Kali ini, pilih dependensi Web, Consul Discovery, dan Actuator: <br><br><img src="https://habrastorage.org/webt/1l/ke/ov/1lkeovxzix2pxqwmodb2efdw-zu.png"><br><br>  Biarkan nama default proyek ‚Äúpenetapan harga‚Äù dan buat proyek di direktori pilihan Anda. <br><br>  Kali ini kita akan menggunakan application.properties alih-alih application.yml. <br>  Tetapkan nama dan porta di application.properties sebagai: <br><br><pre> <code class="bash hljs">spring.application.name=pricing server.port=57216</code> </pre> <br>  Annotate PricingApplication dengan @EnableDiscoveryClient.  Kelas akan terlihat seperti ini, ditambah paket dan impor. <br><br><pre> <code class="bash hljs">@SpringBootApplication @EnableDiscoveryClient public class PricingApplication { public static void main(String[] args) { SpringApplication.run(PricingApplication.class, args); } }</code> </pre><br>  Kemudian kita akan membuat kelas PricingEndpoint.  Di sini saya akan memberikan contoh yang lebih rinci, karena menunjukkan beberapa fungsi penting, termasuk penemuan layanan (mencari layanan portofolio) dan menggunakan RestTemplate untuk permintaan: <br><br><pre> <code class="bash hljs">@RestController @RequestMapping(<span class="hljs-string"><span class="hljs-string">"/pricing"</span></span>) public class PricingEndpoint implements InitializingBean { @Autowired DiscoveryClient client; Map&lt;String, Double&gt; pricingMap = new HashMap&lt;&gt;(); RestTemplate restTemplate = new RestTemplate(); @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio( @PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId) { List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream() .findFirst() .orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>)); String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId); // query <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the portfolios, returned as an array of List // of size 2, containing a ticker and a position (<span class="hljs-comment"><span class="hljs-comment"># of shares) Object[] portfolio = restTemplate.getForObject(url, Object[].class); // Look up the share prices, and return a list of Strings, formatted as // ticker, shares, price, total List&lt;String&gt; collect = Arrays.stream(portfolio).map(position -&gt; { String ticker = ((List&lt;String&gt;) position).get(0); int shares = ((List&lt;Integer&gt;) position).get(1); double price = getPrice(ticker); double total = shares * price; return String.format("%s %d %f %f", ticker, shares, price, total); }).collect(Collectors.toList()); return collect; } private double getPrice(String ticker) { return pricingMap.get(ticker); } @Override public void afterPropertiesSet() throws Exception { pricingMap.put("MMM",201.81); pricingMap.put("AXP",85.11); pricingMap.put("AAPL",161.04); pricingMap.put("BA",236.32); pricingMap.put("CAT",118.02); pricingMap.put("CVX",111.31); pricingMap.put("CSCO",31.7); pricingMap.put("KO",46.00); pricingMap.put("DIS",101.92); pricingMap.put("XOM",78.7); pricingMap.put("GE",24.9); pricingMap.put("GS",217.62); pricingMap.put("HD",155.82); pricingMap.put("IBM",144.29); pricingMap.put("INTC",35.66); pricingMap.put("JNJ",130.8); pricingMap.put("JPM",89.75); pricingMap.put("MCD",159.81); pricingMap.put("MRK",63.89); pricingMap.put("MSFT",73.65); pricingMap.put("NKE",52.78); pricingMap.put("PFE",33.92); pricingMap.put("PG",92.79); pricingMap.put("TRV",117.00); pricingMap.put("UTX",110.12); pricingMap.put("UNH",198.00); pricingMap.put("VZ",47.05); pricingMap.put("V",103.34); pricingMap.put("WMT", 80.05); } }</span></span></code> </pre><br>  Untuk menemukan layanan portofolio, kita perlu memiliki akses ke DiscoveryClient.  Sangat mudah untuk mendapatkan dengan anotasi @Autowired Spring. <br><br><pre> <code class="bash hljs">@Autowired DiscoveryClient client;</code> </pre><br>  Contoh DiscoveryClient ini kemudian digunakan untuk mencari layanan dalam panggilan: <br><br><pre> <code class="bash hljs">List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream().findFirst().orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>));</code> </pre><br>  Setelah layanan ditemukan, kami dapat menggunakannya untuk memenuhi permintaan kami, yang kami susun sesuai dengan panggilan api yang dibuat dalam layanan portofolio kami. <br><br><pre> <code class="bash hljs">String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId);</code> </pre><br>  Terakhir, kami menggunakan RestTemplate untuk menjalankan permintaan GET kami. <br><br><pre> <code class="bash hljs">Object[] portfolio = restTemplate.getForObject(url, Object[].class);</code> </pre> <br>  Perhatikan bahwa untuk pengendali Rest (dan juga untuk Spring MVC Request Controller) variabel path diambil menggunakan anotasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Path</a> Variable, tidak seperti Jersey, yang, seperti yang kita lihat, menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">Path</a> Param. <br><br>  Ini menyimpulkan harga kami dengan Spring RestController. <br><br><h3>  Dokumentasi </h3><br>  Kami memecahkan semua masalah ini untuk menciptakan layanan microser kami, tetapi mereka tidak akan membawa manfaat yang cukup jika kami tidak memberikan pengetahuan dunia tentang cara menggunakannya. <br><br>  Untuk melakukan ini, kami menggunakan alat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Swagger yang</a> nyaman dan mudah digunakan, yang tidak hanya mendokumentasikan panggilan API kami, tetapi juga menyediakan klien web yang nyaman untuk memanggil mereka. <br><br>  Pertama, mari kita tentukan Swagger di pom kami: <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt;</code> </pre><br>  Maka kita perlu memberi tahu Swagger tentang kelas mana yang ingin kita dokumentasikan.  Mari kita perkenalkan kelas SwaggerConfig baru yang berisi spesifikasi Swagger. <br><br><pre> <code class="bash hljs">@Configuration @EnableSwagger2 public class SwaggerConfig { @Bean public Docket <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> new Docket(DocumentationType.SWAGGER_2) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.regex(<span class="hljs-string"><span class="hljs-string">"/pricing.*"</span></span>)) .build(); } }</code> </pre><br>  Mari kita lihat apa yang dilakukan kelas ini.  Pertama, kami menetapkan ini sebagai konfigurasi Swagger dengan penjelasan @ EnableSwagger2. <br><br>  Lalu kami membuat komponen map yang memberi tahu Swagger API mana yang harus ditampilkan.  Dalam contoh di atas, kami memberi tahu Swagger untuk menunjukkan jalan apa pun yang dimulai dengan "/ harga".  Alternatifnya adalah dengan menentukan kelas untuk dokumentasi, dan bukan untuk jalur: <br><br><pre> <code class="bash hljs">.apis(RequestHandlerSelectors.basePackage(<span class="hljs-string"><span class="hljs-string">"com.restms.demo"</span></span>)) .paths(PathSelectors.any())</code> </pre><br>  Mulai ulang microservice harga dan hubungi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 57216 / swagger-ui.html</a> dari browser <br><br><img src="https://habrastorage.org/webt/8x/0k/gk/8x0kgk8hxs_dpijzolsmxk8rdva.png"><br><br>  Klik Operasi Daftar untuk melihat operasi layanan secara rinci. <br>  Klik Perluas Operasi untuk membuat permintaan berdasarkan formulir.  Tetapkan beberapa parameter, klik "Cobalah!"  dan tunggu jawabannya: <br><br><img src="https://habrastorage.org/webt/rf/0_/iu/rf0_ius_kz3fljd74-aaqhzwsia.png"><br><br>  Anda dapat menambahkan lebih banyak warna dengan menambahkan penjelasan Swagger ke metode Anda. <br>  Misalnya, hiasi metode PricingImpl.getPricedPortfolio yang ada menggunakan anotasi @ApiOperation, seperti yang ditunjukkan di bawah ini: <br><br><pre> <code class="bash hljs">@ApiOperation(value = <span class="hljs-string"><span class="hljs-string">"Retrieves a fully priced portfolio"</span></span>, notes = <span class="hljs-string"><span class="hljs-string">"Retrieves fully priced portfolio given customer id and portfolio id"</span></span>) @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio(@PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId)</code> </pre> <br>  Muat ulang dan perbarui swagger-ui untuk melihat dokumentasi baru yang diperbarui: <br><br><img src="https://habrastorage.org/webt/1z/vy/bj/1zvybjvfyh6zmjxd7gahn5_tlyi.png"><br><br>  Dan itu tidak semua yang dapat Anda lakukan dengan Swagger, jadi lihat dokumentasi. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Yuri Dvorzhetsky</a> , dosen mata kuliah kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">"Pengembang Kerangka Kerja Musim Semi",</a> akan memberi tahu Anda lebih banyak tentang pekerjaan Boot Musim Semi: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zgd9SfSxO0Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><i>Artikel asli</i></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id413567/">https://habr.com/ru/post/id413567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id413557/index.html">NewSQL: SQL tidak ke mana-mana</a></li>
<li><a href="../id413559/index.html">Degradasi web atau cara membuat web manusia dapat dibaca</a></li>
<li><a href="../id413561/index.html">Kecepatan Linq Expression Tree dikompilasi</a></li>
<li><a href="../id413563/index.html">4 cara untuk mengimpor paket ke Go</a></li>
<li><a href="../id413565/index.html">Analisis hack Kubernetes - backdoor via kubelet</a></li>
<li><a href="../id413569/index.html">Membongkar pabrik 18650 baterai lithium-ion</a></li>
<li><a href="../id413571/index.html">Edisi # 25: Pelatihan TI - masalah saat ini dan tantangan dari perusahaan terkemuka</a></li>
<li><a href="../id413575/index.html">BricsCAD Shape - CAD 3D gratis dari Bricsys</a></li>
<li><a href="../id413577/index.html">[Pengumuman] Hub untuk kompetisi di CodinGame.com di tujuh kota di Rusia</a></li>
<li><a href="../id413579/index.html">Kami akan memberi kata tentang dekomposisi kode: pemrograman kontekstual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>