<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧔🏿 👩🏽 ✌🏾 SAMBA classicupgrade Erfahrung auf Debian 8 💇🏾 🤹🏻 😩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hintergrund 
 Es gibt ein kleines lokales Netzwerk des Unternehmens, in dem vor ungefähr 10 Jahren eine Domain auf 3rd Samba + LDAP + BIND (auf dem Ga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SAMBA classicupgrade Erfahrung auf Debian 8</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418499/"><h2>  Hintergrund </h2><br>  Es gibt ein kleines lokales Netzwerk des Unternehmens, in dem vor ungefähr 10 Jahren eine Domain auf 3rd Samba + LDAP + BIND (auf dem Gateway) auf Debian 5 erstellt wurde.  Tatsächlich benötigte sie nur eine Benutzerauthentifizierung und Dateibälle.  Im Laufe der Jahre hat der Server problemlos auf neue Versionen von Debian aktualisiert.  Im Moment hat es Debian 8 und Samba 4.2 aus Paketen. <br><br>  Seit Windows 7 funktionierte die Einführung von Computern in die Domäne ohne die bekannte Krücke beim Bearbeiten der Registrierung nicht mehr.  Dieselbe Krücke funktionierte in Win 8 und Win 10 bis zur Version 1803. Zusätzlich zur Unfähigkeit, Computer in die Domäne einzugeben, häuften sich andere Probleme, und als Ergebnis wurde beschlossen, ein klassisches Upgrade durchzuführen.  Aufgrund der Einfachheit der LAN-Struktur wurde beschlossen, das interne Samba-DNS zu verwenden. <br><br>  Ich möchte gleich sagen, dass der Artikel keine exakte Anleitung ist, sondern die Erfahrung bei der Durchführung dieser Operation.  Die Vorprüfungsphase wird dringend empfohlen.  In meinem Fall wurden Server-Images zum Testen erstellt und auf virtuellen VirtualBox-Maschinen bereitgestellt. Um das Verhalten vorhandener Domänenclients zu testen, wurden Win XP SP3- und Win 10 1709- und 1803-Client-Computer erstellt. <br><br>  Ich möchte auch darauf hinweisen, dass wiederholt Fehler durch alltägliche Tippfehler verursacht wurden.  Seien Sie aufmerksam. <br><a name="habracut"></a><br><h2>  Umgebungsbeschreibung </h2><br>  Betriebssystem: Debian 8 <br>  Domain: samdom.local <br>  Servername: pdc <br>  Server-IP: 10.10.1.220 <br><cut></cut><br><h2>  Übergangsprozess </h2><br><h4>  Aktualisieren von Paketen auf die neuesten Versionen + Installieren der fehlenden. </h4><br>  In meinem Fall musste nach dem Update nur krb5-user ausgeliefert werden. <br><br><pre><code class="hljs sql">apt-get <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">upgrade</span></span> apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> samba smbclient krb5-<span class="hljs-keyword"><span class="hljs-keyword">user</span></span> winbind</code> </pre> <br>  Bei der Installation von krb5-user stellt das System einige Fragen zum Servernamen und zum Domänennamen.  Wir geben die Daten unseres Servers ein. <br><cut></cut><br><h4>  Samba halt an </h4><br><pre> <code class="hljs sql">service samba-ad-dc <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> service smbd <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> service nmbd <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span> service winbind <span class="hljs-keyword"><span class="hljs-keyword">stop</span></span></code> </pre> <br><h4>  Übertragung alter Basen und Samba-Konfiguration </h4><br><pre> <code class="hljs swift">mv /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba.<span class="hljs-type"><span class="hljs-type">NT</span></span> mv /etc/samba/smb.conf /etc/samba/smb.conf.<span class="hljs-type"><span class="hljs-type">NT</span></span></code> </pre> <br>  Ich habe die alten Datenbanken nach /var/lib/samba.NT verschoben, sodass Sie das Verzeichnis / var / lib / samba neu erstellen müssen <br><br><pre> <code class="hljs swift">mkdir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba</code> </pre> <br>  In der Dokumentation wird empfohlen, alle Datenbanken in einen separaten Ordner zu verschieben.  In meinem Fall lag nur gencache_notrans.tdb separat, sodass ich es nur übertragen musste. <br><br><pre> <code class="hljs swift">cp -p /run/samba/gencache_notrans.tdb /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba.<span class="hljs-type"><span class="hljs-type">NT</span></span></code> </pre> <br>  Die Dokumentation besagt auch, dass nur sechs Datenbanken benötigt werden: <br><br><blockquote>  Geheimnisse.tdb <br>  schannel_store.tdb <br>  passdb.tdb <br>  gencache_notrans.tdb <br>  group_mapping.tdb <br>  account_policy.tdb </blockquote><br>  Das Vorhandensein anderer Dateien im Ordner hat den Übergangsprozess jedoch nicht verhindert. <br><cut></cut><br><h4>  Starten des klassischen Upgrade-Prozesses </h4><br><pre> <code class="hljs powershell">samba<span class="hljs-literal"><span class="hljs-literal">-tool</span></span> domain classicupgrade —dbdir=/var/lib/samba.NT -<span class="hljs-literal"><span class="hljs-literal">-realm</span></span>=samdom.local -<span class="hljs-literal"><span class="hljs-literal">-dns</span></span><span class="hljs-literal"><span class="hljs-literal">-backend</span></span>=SAMBA_INTERNAL /etc/samba/smb.conf.NT</code> </pre> <br>  Ich stelle fest, dass in der Dokumentation die Verwendung der lokalen Domäne der obersten Ebene nicht empfohlen wird. In meinem Fall ist dies jedoch historisch geschehen. <br><br>  In dem Blatt, das auf dem Bildschirm angezeigt wird, blinkt das Administratorkennwort, das Sie auf Wunsch notieren können. <br><br>  Wenn Sie Probleme haben, müssen Sie vor neuen Versuchen eines klassischen Upgrades daran denken, die dabei erstellten Datenbankdateien und die smb.conf zu löschen. <br><br><pre> <code class="hljs powershell">rm <span class="hljs-operator"><span class="hljs-operator">-f</span></span> /etc/samba/smb.conf rm <span class="hljs-literal"><span class="hljs-literal">-rf</span></span> /var/lib/samba/*</code> </pre> <br>  Wenn alles gut gegangen ist, können Sie mit dem nächsten Schritt fortfahren. <br><br><h4>  Überprüfen und Bearbeiten von Serverkonfigurationen </h4><br>  In /etc/resolv.conf sollte sein (wenn es nicht automatisch für Sie erstellt wird) <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">domain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samdom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nameserver</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.220</span></span></code> </pre> <br>  In / etc / hosts <br><br><pre> <code class="hljs css">127<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">localhost</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.localdomain</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.220</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pdc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.samdom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pdc</span></span></code> </pre> <br>  Die Datei / etc / hostname muss einen abgekürzten Hostnamen haben <br><br><pre> <code class="hljs">pdc</code> </pre> <br>  In / etc / network / interfases <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">dns-nameservers</span></span> 10<span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.220</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dns-search</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">samdom</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.local</span></span></code> </pre> <br><h4>  DNS-Anfragen umleiten </h4><br>  Wenn Ihr Server DNS-Abfragen ins Internet umleitet (und INTERNAL_DNS Samba verwendet wird), müssen Sie im Abschnitt [global] in smb.conf eine Zeile von Ihrer ISP-IP hinzufügen: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">dns</span></span> forwarder = ip</code> </pre> <br>  In "Samba" 4.2 können Sie nur eine IP angeben.  Im Folgenden - einige mit einem Leerzeichen. <br>  Wenn der ausgehende Datenverkehr an Ihrem Gateway gesteuert wird, vergessen Sie nicht, den Durchgang von udp-Paketen vom Server zum Port 53 zu öffnen. <br><br><h4>  Konfigurieren Sie Kerberos </h4><br>  Wir bringen /etc/krb5.conf in eine ähnliche Form: <br><br><pre> <code class="hljs pgsql">[libdefaults] default_realm = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> dns_lookup_realm = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> dns_lookup_kdc = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> krb4_config = /etc/krb.conf krb4_realms = /etc/krb.realms kdc_timesync = <span class="hljs-number"><span class="hljs-number">1</span></span> ccache_type = <span class="hljs-number"><span class="hljs-number">4</span></span> forwardable = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> proxiable = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> v4_instance_resolve = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> v4_name_convert = { host = { rcmd = host ftp = ftp } plain = { something = something-<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> } } fcc-mit-ticketflags = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> [realms] SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> = { kdc = pdc admin_server = pdc default_domain = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> } [domain_realm] .samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> = SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span></code> </pre> <br><h4>  Zeitsynchronisation </h4><br>  Wenn sich das NTP-Paket nicht lohnt, setzen Sie: <br><br><pre> <code class="hljs swift">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install ntp</code> </pre> <br>  In meinem Fall gab es kein Verzeichnis / var / lib / samba / ntp_signd /.  Manuell erstellt. <br><br>  Als nächstes müssen Sie ihm Rechte geben: <br><br><pre> <code class="hljs swift">chown root:ntp /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba/ntp_signd/ chmod <span class="hljs-number"><span class="hljs-number">750</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/samba/ntp_signd/</code> </pre> <br>  Als Nächstes müssen Sie die Datei /etc/ntp.conf in eine ähnliche Form bringen: <br><br><pre> <code class="hljs pgsql"># <span class="hljs-keyword"><span class="hljs-keyword">Local</span></span> clock (Note: This <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> the localhost address!) <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">127.127</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> fudge <span class="hljs-number"><span class="hljs-number">127.127</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> stratum <span class="hljs-number"><span class="hljs-number">10</span></span> # The source, <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> we are receiving the <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>pool.ntp.org iburst prefer driftfile /var/lib/ntp/ntp.drift logfile /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/ntp ntpsigndsocket /var/lib/samba/ntp_signd/ # <span class="hljs-keyword"><span class="hljs-keyword">Access</span></span> control # <span class="hljs-keyword"><span class="hljs-keyword">Default</span></span> restriction: <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> allow querying <span class="hljs-type"><span class="hljs-type">time</span></span> (incl. ms-sntp) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> this machine <span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> kod nomodify notrap nopeer mssntp # Allow everything <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> localhost <span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> # Allow that our <span class="hljs-type"><span class="hljs-type">time</span></span> source can <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> provide <span class="hljs-type"><span class="hljs-type">time</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">restrict</span></span> <span class="hljs-number"><span class="hljs-number">0.</span></span>pool.ntp.org mask <span class="hljs-number"><span class="hljs-number">255.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span><span class="hljs-number"><span class="hljs-number">.255</span></span> nomodify notrap nopeer noquery</code> </pre> <br><h4>  Slapd entfernen und neu starten </h4><br><pre> <code class="hljs cs">apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">remove</span></span> slapd reboot</code> </pre> <br><h4>  Testen </h4><br>  In der Dokumentation wird der Test über das Administratorkonto durchgeführt.  Wir haben in der Vergangenheit entwickelt, dass administrative Aktionen von domain_admin stammen.  Als nächstes werden Befehle und ihre korrekte Ausgabe angezeigt. <br><br>  <b>Samba testen:</b> <br><br><pre> <code class="hljs pgsql">root@debian:/root# smbclient -L localhost -U% <span class="hljs-keyword"><span class="hljs-keyword">Domain</span></span>=[SAMDOM] OS=[Unix] <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>=[Samba <span class="hljs-number"><span class="hljs-number">4.1</span></span><span class="hljs-number"><span class="hljs-number">.17</span></span>-Debian] Sharename <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Comment</span></span> <span class="hljs-comment"><span class="hljs-comment">--------- ---- ------- netlogon Disk sysvol Disk IPC$ IPC IPC Service (Samba 4.1.17-Debian) Domain=[SAMDOM] OS=[Unix] Server=[Samba 4.1.17-Debian] Server Comment --------- ------- Workgroup Master --------- -------</span></span></code> </pre> <br>  Wenn Sie hier eine Fehlermeldung erhalten: <br><blockquote>  Verbindung zu loclhost fehlgeschlagen (Fehler NT_STATUS_UNSUCCESSFUL) </blockquote><br>  Überprüfen Sie, ob Samba startet.  In einem Test habe ich vergessen, slapd zu entfernen (auszuschalten) und habe auch diesen Fehler gesehen. <br><br>  Noch ein Scheck: <br><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> smbclient //localhost/netlogon <span class="hljs-literal"><span class="hljs-literal">-Udomain_admin</span></span> <span class="hljs-literal"><span class="hljs-literal">-c</span></span> <span class="hljs-string"><span class="hljs-string">'ls'</span></span> Enter Administrator<span class="hljs-string"><span class="hljs-string">'s password: Domain=[SAMDOM] OS=[Unix] Server=[Samba xyz] . D 0 Tue Nov 1 08:40:00 2016 .. D 0 Tue Nov 1 08:40:00 2016 49386 blocks of size 524288. 42093 blocks available</span></span></code> </pre> <br>  <b>DNS testen</b> <br><br><pre> <code class="hljs pgsql">root@debian:/root# nslookup samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>: <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span> Address: <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span>#<span class="hljs-number"><span class="hljs-number">53</span></span> <span class="hljs-type"><span class="hljs-type">Name</span></span>: samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span> Address: <span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.220</span></span></code> </pre> <br><pre> <code class="hljs pgsql">$ host -t SRV _ldap._tcp.samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>. _ldap._tcp.samdom.example.com has SRV <span class="hljs-type"><span class="hljs-type">record</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">389</span></span> pdc.samdom.example.com.</code> </pre> <br><pre> <code class="hljs pgsql">$ host -t SRV _kerberos._udp.samdom.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>. _kerberos._udp.samdom.example.com has SRV <span class="hljs-type"><span class="hljs-type">record</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-number"><span class="hljs-number">88</span></span> pdc.samdom.example.com.</code> </pre> <br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> host <span class="hljs-literal"><span class="hljs-literal">-t</span></span> A pdc.samdom.local. dc1.samdom.example.com has address <span class="hljs-number"><span class="hljs-number">10.10</span></span>.<span class="hljs-number"><span class="hljs-number">1.220</span></span></code> </pre> <br>  <b>Kerberos testen</b> <br><br><pre> <code class="hljs pgsql">root@debian:/root# kinit domain_admin@SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> domain_admin@SAMDOM.<span class="hljs-keyword"><span class="hljs-keyword">LOCAL</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Warning</span></span>: Your <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> will expire <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">41</span></span> days <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>  <span class="hljs-number"><span class="hljs-number">27</span></span>  <span class="hljs-number"><span class="hljs-number">2015</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span></code> </pre><br><pre> <code class="hljs ruby">root@debian<span class="hljs-symbol"><span class="hljs-symbol">:/root</span></span><span class="hljs-comment"><span class="hljs-comment"># klist Ticket cache: FILE:/tmp/krb5cc_0 Default principal: domain_admin</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SAMDOM</span></span></span><span class="hljs-comment">.LOCAL Valid starting Expires Service principal 16.10.2015 15:07:12 17.10.2015 01:07:12 krbtgt/SAMDOM.LOCAL</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@SAMDOM</span></span></span><span class="hljs-comment">.LOCAL renew until 17.10.2015 15:07:07</span></span></code> </pre> <br><h2>  Zusätzliches Setup </h2><br>  <b>Damit Domainnamen und Gruppen unter Linux angezeigt werden, müssen Sie /etc/nsswitch.conf anstelle von Zahlen korrigieren</b> <br><br>  Zeichenfolgen sollten auf die folgende Form reduziert werden: <br><blockquote>  passwd: Dateien <u>winbind</u> <br>  Gruppe: Dateien <u>winbind</u> </blockquote><br>  Bitte beachten Sie, dass winbind nur zu diesen Zeilen hinzugefügt wird.  Einzelheiten finden Sie in der Dokumentation. <br>  In meinem Fall habe ich auch die Erwähnung von ldap aus dieser Datei entfernt. <br><br><pre> <code class="hljs">reboot</code> </pre> <br>  <b>Wenn Sie, wie ich, vor dem klassischen Upgrade von DNS den Server auf einem anderen Computer gefunden haben und einen DHCP-Server verwenden, vergessen Sie nicht, die DHCP-Servereinstellungen zu ändern, die auf den DNS-Server verweisen</b> <br><br><h4>  Konfigurieren Sie Netzwerkordner </h4><br>  Entwicklern wird nicht empfohlen, den AD-Domänencontroller als Dateiserver zu verwenden.  In meinem Fall gab es jedoch keine anderen Server. <br><br>  Die Einstellung ist in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> zu "Samba" sehr gut beschrieben und Sie müssen dort suchen.  Kurz gesagt: <br><br>  <b>Es ist notwendig, die ACL-Unterstützung von Samba zu überprüfen.</b> <br><br><pre> <code class="hljs perl">smbd -b | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> HAVE_LIBACL HAVE_LIBACL</code> </pre> <br>  <b>Vergessen Sie nicht, dass der Abschnitt mit den Optionen user_xattr und acl bereitgestellt werden muss.</b> <br><br>  <b>Nur Benutzer und Gruppen mit SeDiskOperatorPrivilege können die Rechte an den Bällen konfigurieren:</b> <br><br>  Um beispielsweise der Gruppe "Domänenadministratoren" solche Rechte zu gewähren, müssen Sie den folgenden Befehl ausführen: <br><pre> <code class="hljs pgsql">net rpc rights <span class="hljs-keyword"><span class="hljs-keyword">grant</span></span> "Samdom\Domain Admins" SeDiskOperatorPrivilege -U "Samdom\domain_admin"</code> </pre> <br>  <b>Direkt zum Hinzufügen von Bällen benötigen Sie:</b> <br><br>  Erstellen Sie ein Verzeichnis und weisen Sie die erforderlichen Rechte zu: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># mkdir -p /srv/samba/Demo/ # chown root:</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Domain Admins"</span></span></span><span class="hljs-meta"> /srv/samba/Demo/ # chmod 0770 /srv/samba/Demo/</span></span></code> </pre> <br>  zur smb.conf hinzufügen <br><br><pre> <code class="hljs pgsql">[Demo] <span class="hljs-type"><span class="hljs-type">path</span></span> = /srv/samba/Demo/ <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-keyword"><span class="hljs-keyword">only</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span></code> </pre> <br>  Laden Sie danach die Samba-Konfigurationen mit dem folgenden Befehl neu: <br><br><pre> <code class="hljs pgsql">smbcontrol <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> reload-config</code> </pre> <br>  Nach wie vor können die Kugeln ausgeblendet werden, indem der Beschreibung Folgendes hinzugefügt wird: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">browseable</span></span> = <span class="hljs-literal"><span class="hljs-literal">no</span></span></code> </pre> <br>  Als Nächstes werden die Rechte aus den Fenstern des Computers über ein Konto bei <u>SeDiskOperatorPrivilege verteilt</u> .  Gehen Sie dazu zu "Computerverwaltung". <br>  Halten Sie sich an einen Remotecomputer (in unserem Fall einen pdc-Domänencontroller).  Verteilen Sie Rechte über: "Freigegebene Ordner" -&gt; "Freigegebene Ressourcen". <br><br>  Wenn Sie zum Element "Freigegebene Ordner" wechseln, wird wahrscheinlich die Fehlermeldung "Die Prozedurnummer liegt außerhalb der zulässigen Grenzen (1745)" angezeigt.  Ich ignoriere es, weil ich im Internet nichts Verständliches gefunden habe und es beim Testen und Betrieb keine Probleme verursacht. <br><br>  Probleme können auftreten, wenn Sie die alten Netzwerkordner auf diese Weise freigeben.  Vor dem klassischen Upgrade wurden die Rechte an Bällen über smb.conf, Linux-Benutzer, group, other und setfacl festgelegt.  Nach der klassischen Aufwertung tauchten nach und nach Schulen mit dem Recht auf Änderung, Umbenennung usw. auf.  Das rekursive Setfacl half nicht, da Pfosten mit Vererbung von Rechten auftauchten. <br><br>  Es ist anzumerken, dass in der Dokumentation empfohlen wird, Rechte aus den Fenstern des Computers über Remotezugriff zu verteilen. <br><br>  Aufgrund des nicht sehr großen Dateivolumens wurde daher beschlossen, Daten außerhalb der Arbeitszeit auf einen Windows-Computer zu übertragen, Netzwerkordner gemäß den Empfehlungen der Samba-Entwickler neu zu erstellen und Dateien erneut hochzuladen. <br><br><h4>  Benutzer-Home-Ordner auf dem Server </h4><br>  Die Verwaltung der Benutzerordner wurde ebenfalls geändert. <br>  Es ist erwähnenswert, dass der Prozess aus der Konfiguration auch in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> sehr gut beschrieben ist. <br>  Ich werde nur die Hauptmerkmale für meinen Fall beschreiben. <br><br>  Zuvor hatte jeder Benutzer seinen eigenen Ball.  Jetzt wird nur der freigegebene Ordner freigegeben, und Benutzer haben nur Zugriff auf ihr Verzeichnis. <br><br>  Die Einrichtung erfolgt mit den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Microsoft Remote Server Administration Tools (RSAT)</a> .  RSAT hat eine unangenehme Funktion.  Wenn Sie Win 10 auf eine neue Version aktualisieren, muss es neu installiert werden. <br><br>  Heimbälle können manuell über Benutzereigenschaften im Snap-In Benutzer und Computer aufgenommen werden.  Registerkarte Profil.  U-Festplatte: \\ pdc \ user-shared \ username <br><br>  Es ist jedoch bequemer, dies über eine Domänenrichtlinie zu tun, die in der obigen Dokumentation im Abschnitt <b>„Verwenden einer Gruppenrichtlinieneinstellung“</b> sehr klar beschrieben wird. <br><br>  Vergessen Sie nicht, dass der gemeinsame Ball versteckt werden kann, indem Sie ihn zu seiner Beschreibung hinzufügen: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">browseable</span></span> = <span class="hljs-literal"><span class="hljs-literal">no</span></span></code> </pre> <br><h4>  Domain Level Up </h4><br>  Die Domain wurde ohne Probleme mit dem folgenden Befehl auf das Level 2008_R2 aktualisiert: <br><br><pre> <code class="hljs pgsql">samba-tool <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> <span class="hljs-comment"><span class="hljs-comment">--domain=2008_R2 --forest=2008_R2</span></span></code> </pre> <br>  Sie können die Ebene mit dem folgenden Befehl anzeigen: <br><br><pre> <code class="hljs pgsql">samba-tool <span class="hljs-keyword"><span class="hljs-keyword">domain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span></code> </pre> <br><h4>  Wenn smbd.log mit CUPS-Fehlern bombardiert wird </h4><br>  In meinem Fall zeigte sich dieses Problem: <br><br><blockquote>  Es kann keine Verbindung zum lokalen Host des CUPS-Servers hergestellt werden: 631 </blockquote><br>  Korrigiert durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesen</a> kurzen Artikel. <br><br><h2>  Nachfolgendes Upgrade auf Debian 9 Problem und Lösung </h2><br>  Bei <br><br><pre> <code class="hljs powershell">apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> dist<span class="hljs-literal"><span class="hljs-literal">-upgrade</span></span></code> </pre> <br>  Es gab ein Problem, nämlich Samba und Winbind wollten nicht aktualisiert werden.  Ging in einen Abhängigkeitskonflikt. <br><br>  Die Methode aus dem Artikel half dem Link, auf den ich leider nicht gespeichert habe. <br>  Hier ist ein direktes Zitat daraus: <br><br><blockquote>  Wenn sich Samba im AD-DC-Modus befindet, schlagen dies und die WinBind fehl. <br>  Führen Sie diese Befehle aus und versuchen Sie dann erneut, das Upgrade auszuführen <br><br>  systemctl stop smbd nmbd winbind <br>  systemctl deaktiviere smbd nmbd winbind <br>  systemctl entlarvt samba-ad-dc <br>  systemctl starte samba-ad-dc <br>  systemctl enable samba-ad-dc <br></blockquote><br><br><h4>  Nach dem Aktualisieren der SAMBA-Version wird Folgendes empfohlen: "Samba AD DC-Datenbankprüfung". </h4><br><br> <code># samba-tool dbcheck --cross-ncs</code> <br> <br>  Seit Deb 9 SAMBA Version 4.5 habe ich eine Reihe von Fehlern "replPropertyMetaData" erhalten. <br>  Der Fehlerbehebungsprozess wird in der Dokumentation beschrieben: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wiki.samba.org/index.php/Updating_Samba#Fixing_replPropertyMetaData_Attributes</a> <br><br>  Und es kommt auf die Ausführung des Befehls an: <br><br> <code>samba-tool dbcheck --cross-ncs --fix --yes</code> <br> <br><h2>  Liste der verwendeten Quellen </h2><br>  SAMBA-Dokumentation: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Migrieren einer Samba NT4-Domäne zu Samba AD (klassisches Upgrade)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einrichten von Samba als Active Directory-Domänencontroller</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einrichten einer Freigabe mithilfe von Windows-ACLs</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Benutzer-Home-Ordner</a> <br>  Toller Artikel: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Debian 8 Domain Controller (... der bereits einen eingebauten Samba4 hat)</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Samba-Fehler: Es kann keine Verbindung zum lokalen Host des CUPS-Servers hergestellt werden: 631</a> <br>  Ein Artikel eines unbekannten englischen Autors, der beschreibt, wie ein Upgrade auf Debian 9 durchgeführt wird </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de418499/">https://habr.com/ru/post/de418499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de418487/index.html">Über die Arbeit in Deutschland</a></li>
<li><a href="../de418489/index.html">Meisterwerke des Weltsäulenbaus: Entwicklung eines Drei-Wege-Standard-Studiokults von JBL</a></li>
<li><a href="../de418491/index.html">Testen Sie den Automatisierungswiderstand</a></li>
<li><a href="../de418493/index.html">Bluetooth Ich-Geschichte</a></li>
<li><a href="../de418497/index.html">"Ich erkenne dich nicht im Make-up" (c)</a></li>
<li><a href="../de418501/index.html">Opfer der DSGVO: die ihre Arbeit aufgrund einer neuen Regelung personenbezogener Daten bereits eingestellt haben</a></li>
<li><a href="../de418503/index.html">Nach 2020 wird Großbritannien den ersten Raumhafen erwerben - in Schottland</a></li>
<li><a href="../de418505/index.html">Übersicht und Vergleich von Quanten-Software-Plattformen auf Gate-Ebene</a></li>
<li><a href="../de418507/index.html">Was hat uns die Kosmonautik gegeben?</a></li>
<li><a href="../de418509/index.html">Amazon Rekognition erkennt 28 US-Kongressabgeordnete als Kriminelle an</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>