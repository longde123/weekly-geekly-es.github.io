<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📂 🙍🏻 🎄 巴别塔@ 7的管道运营商历险记 📳 👨🏽‍🚀 ☝️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="babel@7.0.0-beta52发行版为@babel/plugin-proposal-pipeline-operator 提供了一个新的必需配置标志，这破坏了该插件先前版本的向后兼容性。 在本文中，您将学习什么是pipeline运算符以及为什么需要配置。 


 UPD：智能管道出现在babel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>巴别塔@ 7的管道运营商历险记</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/418125/"><img src="https://habrastorage.org/webt/tt/8e/8a/tt8e8alhcx3dtck1h8mebjlihsg.png"><br><p> <a href="">babel@7.0.0-beta52</a>发行版为<code>@babel/plugin-proposal-pipeline-operator</code> <a href="">提供</a>了一个新的必需<a href="">配置</a>标志，这破坏了该插件先前版本的向后兼容性。 在本文中，您将学习什么是<code>pipeline</code>运算符以及为什么需要配置。 </p><a name="habracut"></a><br><p>  UPD：智能管道出现在babel@7.2.0： <a href="https://babeljs.io/blog/2018/12/03/7.2.0#smart-pipeline-operator-parsing-8289-">https</a> ://babeljs.io/blog/2018/12/03/7.2.0#smart-pipeline-operator-parsing-8289-https-githubcom-babel-babel- <a href="https://babeljs.io/blog/2018/12/03/7.2.0#smart-pipeline-operator-parsing-8289-">拉8289</a> </p><br><h2 id="tekuschiy-status"> 现况 </h2><br><p> 最初<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">提出</a> <code>pipeline</code>运算符的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">吉尔伯特·加萨</a> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gilbert Garza）</a>着手获得一种简单的语法，以“以可读的函数样式编写有序的函数调用链”。 管道运算符起源于F＃，Hack，Elm，Elixir等语言，当将其添加到JavaScript时，会出现两个有争议的问题： </p><br><ul><li> 在哪里以及如何使用占位符？ </li><li>  <code>async / await</code>如何在管道中<code>async / await</code> ？ </li></ul><br><h3 id="pleysholdery"> 占位符 </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">凯文•史密斯</a> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kevin Smith）</a>在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这张票中</a>提出了第一个问题，他建议使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">哈克语言</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">管道</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">风格</a> 。 在Hack中，占位符对于管道的任何右侧都是必需的，例如： </p><br><pre> <code class="plaintext hljs">namespace Hack\UserDocumentation\Operators\Pipe\Examples\MapFilterCountPiped; function piped_example(array&lt;int&gt; $arr): int { return $arr |&gt; \array_map($x ==&gt; $x * $x, $$) |&gt; \array_filter($$, $x ==&gt; $x % 2 == 0) |&gt; \count($$); } var_dump(piped_example(range(1, 10)));</code> </pre> <br><p> 我们以此为基础，可以在任何表达式中使用占位符，并且占位符来自最后一个管道步骤。 这种方法为我们提供了灵活性和充足的机会来编写表达式。 </p><br><p> 硬币的另一面是由于添加了新令牌导致语言的复杂性。 到目前为止，我们选择了哈希（ <code>#</code> ），尽管讨论仍在进行中，但任何令牌都可能与其他用途有交叉之处。 例如，散列也由<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">该类</a>的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">私有字段</a>使用，就像<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">仍然使用</a>任何其他令牌变体一样。 </p><br><h3 id="async--await"> 异步/等待 </h3><br><p>  <code>pipeline</code>语句的第一个版本包含以下用于<code>await</code>语法： </p><br><pre> <code class="plaintext hljs">x |&gt; await f</code> </pre> <br><p> 可以部署到： </p><br><pre> <code class="plaintext hljs">await f(x)</code> </pre> <br><p> 不幸的是，用户可能会期望这样的部署： </p><br><pre> <code class="plaintext hljs">(await f)(x)</code> </pre> <br><p> 虽然向<code>pipeline</code>添加<code>async</code>想法已经破灭，但委员会成员反对不支持<code>async / await</code>的<code>pipeline</code>运营商。 是的，对于如何使用无需显式语法返回Promise的函数，有一些选项，但是所有这些选项都太麻烦或需要辅助函数。 </p><br><h2 id="predlagaemye-resheniya"> 建议的解决方案 </h2><br><p> 讨论的结果是，形成了两个建议（除了最小选项之外）：使用F＃管道和智能管道。 让我们看看这些建议。 </p><br><h3 id="minimalnyy-variant-operatorahttpsgithubcomtc39proposal-pipeline-operator">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最小操作员选项</a> </h3><br><p> 此优惠仅适用于基本功能。 在最低版本中，删除了对异步的支持，并且没有占位符。 该选项与配置出现之前的先前版本的babel插件的行为相对应，并且与存储库中<code>pipeline</code>操作员的当前规范相对应。 它更多地用作确定其他提案的利弊的探针草案，并且如果没有替代提案中的根本性更改，就不太可能被接受。 </p><br><h3 id="f-payplaynyhttpsgithubcomvaltech-nycproposal-fsharp-pipelines">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">F＃管道</a> </h3><br><p> 根本不需要F＃管道的占位符。 在基本版本中，箭头函数基于每个人都熟悉的ES2015语法，涵盖了对占位符的需求，所需的书写较少。 </p><br><p> 此刻（根据F＃线的规范），箭头功能应放在方括号中： </p><br><pre> <code class="plaintext hljs">let person = { score: 25 }; let newScore = person.score |&gt; double |&gt; (_ =&gt; add(7, _)) |&gt; (_ =&gt; boundScore(0, 100, _));</code> </pre> <br><p> 正在进行调查以确定使用不带括号的箭头功能是否可行，此处在语法上看起来是多余的。 </p><br><p> 至于异步， <code>await</code>在F＃管道中用作一元函数： </p><br><pre> <code class="plaintext hljs">promise |&gt; await</code> </pre> <br><p> 发生的事情： </p><br><pre> <code class="plaintext hljs">await promise</code> </pre> <br><p> 因此<code>await</code>可以在一长串异步调用的中间使用： </p><br><pre> <code class="plaintext hljs">promise |&gt; await |&gt; (x =&gt; doubleSay(x, ', ')) |&gt; capitalize |&gt; (x =&gt; x + '!') |&gt; (x =&gt; new User.Message(x)) |&gt; (x =&gt; stream.write(x)) |&gt; await |&gt; console.log;</code> </pre> <br><p> 这种特殊的<code>await</code>处理可能会潜在地打开使用其他一元运算符（例如<code>typeof</code> ）的类似可能性，但是F＃管道的原始规范不包含它们。 </p><br><h3 id="smart-payplaynyhttpsgithubcomjs-choiproposal-smart-pipelines">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">智能管道</a> </h3><br><p>  Smar管道将占位符的概念带到了逻辑上的结论，允许在管线中使用部分使用和任意表达。 前面的长链可以这样写： </p><br><pre> <code class="plaintext hljs">promise |&gt; await # |&gt; doubleSay(#, ', ') |&gt; # || throw new TypeError() |&gt; capitalize |&gt; # + '!' |&gt; new User.Message(#) |&gt; await stream.write(#) |&gt; console.log;</code> </pre> <br><p> 在智能管道中使用占位符的规则非常简单。 如果将单个标识符传递到管道步骤，则不需要其他令牌（占位符），这称为<a href="">“裸样式”</a> ： </p><br><pre> <code class="plaintext hljs">x |&gt; a; x |&gt; fb;</code> </pre> <br><p> 与Hack不同，一元函数不需要占位符。 </p><br><p> 对于其他表达式，需要一个占位符（称为“词法主题标记”），并且认为管道可以在“主题样式”- <a href="">“主题样式”内工作</a> 。 在这种情况下，缺少占位符标记会导致早期的SyntaxError错误： </p><br><pre> <code class="plaintext hljs">10 |&gt; # + 1; promise |&gt; await #;</code> </pre> <br><p> 如果有任何运算符，方括号（包括用于调用方法的内容），引号或除标识符和点之外的其他任何内容，则需要使用占位符标记。 这将有助于避免被脚踩开并消除不确定性。 </p><br><p> 智能管道以更通用的方式解决了支持异步的问题，这使我们能够在管道中使用所有可能的表达式，不仅可以使用<code>await</code> ，还可以使用<code>typeof</code> ， <code>yield</code>和其他任何运算符。 </p><br><h2 id="na-scenu-vyhodit-babel"> 巴别塔进入现场 </h2><br><p> 一旦将所有三个提案具体化，我们就得出结论，这种讨论不会导致解决提案之间的深刻矛盾。 我们认为最好的方法是使用真实代码中的句子收集开发人员的反馈。 考虑到Babel在开发人员社区中的角色，我们决定将所有三个选项添加到<code>pipeline</code>操作符插件中。 </p><br><p> 由于<code>babylon</code>三个句子的解析略有不同，但有所不同，因此必须首先将它们的支持添加到<code>@babel/parser</code> （即<code>babylon</code> ）中，并且解析器必须知道现在应该支持哪个提议。 因此， <code>pipeline</code>操作员插件需要<code>"proposal"</code>选项，用于配置巴比伦进行解析和后续转换。 </p><br><p> 我们在线上进行此工作是因为我们需要进行所有更改，以破坏向后兼容性，直到babel @ 7不再是beta。 最后，我们希望使插件的管道选项之一成为默认选项，以消除对配置选项的需求。 </p><br><p> 考虑到这些限制，我们决定在插件配置中添加一个选项并使其成为必需，从而迫使用户确定他们要在项目中使用哪些商品。 一旦选择了一个特定的建议作为操作员的规范行为，我们便将选项<code>"proposal"</code>标记为过时，并且该规范选项将默认运行。 对已取消优惠的支持将一直持续到下一个主要版本。 </p><br><h2 id="prinyat-uchastie"> 参加 </h2><br><p> 如果您想参与提案的讨论，那么所有讨论都是公开的，您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在管道运营商的提案存储库中</a>找到它们。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TC39会议的演讲</a>也<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">将为</a>您服务。 最后，您可以在Twitter上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">关注James DiGioia</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JS Choi</a>或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Daniel Ehrenberg</a> 。 </p><br><p> 但更重要的是，一旦<code>pipeline</code>上的工作完成，请在您的项目中尝试一下！ 我们还在努力为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">repl</a>添加新功能，以便您可以交互式检查代码。 我们需要反馈，并且在实际代码中使用它确实有助于组装。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">将推</a>文<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">发布</a>到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">@babeljs</a> 。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN418125/">https://habr.com/ru/post/zh-CN418125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN418115/index.html">极客设置在路上</a></li>
<li><a href="../zh-CN418117/index.html">Micronaut框架简介</a></li>
<li><a href="../zh-CN418119/index.html">本月史诗般的失败：rsync作为拉取数据的“向量”</a></li>
<li><a href="../zh-CN418121/index.html">Piu-bah-vzhuh：闪电探测卫星也注意到流星</a></li>
<li><a href="../zh-CN418123/index.html">原子存储器：Mario的8位字母和192位调</a></li>
<li><a href="../zh-CN418127/index.html">人脸识别系统的真假</a></li>
<li><a href="../zh-CN418131/index.html">使用Go Cloud进行跨云编程</a></li>
<li><a href="../zh-CN418133/index.html">捍卫巴解组织。 对手的7个站不住脚的论点</a></li>
<li><a href="../zh-CN418135/index.html">如何使用二十一点和版本控制来组织自己的Node.js模块存储库</a></li>
<li><a href="../zh-CN418137/index.html">嗜血：DonorSearch创始人专访</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>