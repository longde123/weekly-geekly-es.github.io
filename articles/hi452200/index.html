<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯжС ЁЯЩА ЁЯСйЁЯП╜тАНЁЯТ╝ GOSTIM: P2P F2F E2EE IM рдПрдХ рд╢рд╛рдо рдореЗрдВ GOST рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреЗ рд╕рд╛рде тМия╕П ЁЯСйЁЯП╝тАНЁЯОи ЁЯМЯ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PyGOST рд▓рд╛рдЗрдмреНрд░реЗрд░реА (рд╢реБрджреНрдз рдкрд╛рдЗрдерди рдореЗрдВ GOST рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдкреНрд░рд╛рдЗрдорд░реА) рдХреЗ рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдореБрдЭреЗ рдЕрдХреНрд╕рд░ рдЕрдкрдиреЗ рдШреБрдЯрдиреЗ рдкрд░ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрджреЗрд╢ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рди...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GOSTIM: P2P F2F E2EE IM рдПрдХ рд╢рд╛рдо рдореЗрдВ GOST рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреЗ рд╕рд╛рде</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452200/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PyGOST</a> рд▓рд╛рдЗрдмреНрд░реЗрд░реА (рд╢реБрджреНрдз рдкрд╛рдЗрдерди рдореЗрдВ GOST рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рд╛рдЗрдорд░реА) рдХреЗ</a> рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдореБрдЭреЗ рдЕрдХреНрд╕рд░ рдЕрдкрдиреЗ рдШреБрдЯрдиреЗ рдкрд░ рд╕рдмрд╕реЗ рд╕рд░рд▓ рд╕реБрд░рдХреНрд╖рд┐рдд рд╕рдВрджреЗрд╢ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреНрд░рд╢реНрди рдорд┐рд▓рддреЗ рд╣реИрдВред  рдХрдИ рд▓реЛрдЧ рд▓рд╛рдЧреВ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреЛ рдХрд╛рдлреА рд╕рд░рд▓ рдЪреАрдЬ рдорд╛рдирддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рд╕рдВрдЪрд╛рд░ рдЪреИрдирд▓ рдкрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдмреНрд▓реЙрдХ рд╕рд┐рдлрд░ рдХреЗ рд▓рд┐рдП рдПрдХ .encrypt () рдХреЙрд▓ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрдЧрд╛ред  рджреВрд╕рд░реЛрдВ рдХрд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рд▓рд╛рдЧреВ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреБрдЫ рдХреА рдирд┐рдпрддрд┐ рд╣реИ, рдФрд░ рдпрд╣ рд╕реНрд╡реАрдХрд╛рд░реНрдп рд╣реИ рдХрд┐ рдЯреЗрд▓рд┐рдЧреНрд░рд╛рдо рдЬреИрд╕реА рдзрдиреА рдХрдВрдкрдирд┐рдпрд╛рдВ рдЧрдгрд┐рдд рдСрд▓рд┐рдореНрдкреАрдбреНрд╕ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХ</a> рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреА рд╣реИрдВ</a> ред <br><br>  рдЗрд╕ рд╕рдмрдиреЗ рдореБрдЭреЗ рдпрд╣ рд▓реЗрдЦ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ рдХрд┐ рдпрд╣ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдЖрдИрдПрдо рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЗрддрдирд╛ рдореБрд╢реНрдХрд┐рд▓ рдХрд╛рдо рдирд╣реАрдВ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рдкреНрд░рдореБрдЦ рд╕рдордЭреМрддреЗ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдХрд░рдирд╛ рдЗрд╕рдХреЗ рд▓рд╛рдпрдХ рдирд╣реАрдВ рд╣реИред <br><br><div style="text-align:center;"><img alt="рд╕реБрдирд╡рд╛рдИ" src="https://habrastorage.org/getpro/habr/post_images/4e2/2bb/f04/4e22bbf0480a8181bcbb2054c6f95815.jpg"></div><br>  рд▓реЗрдЦ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ GOST рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдПрд▓реНрдЧреЛрд░рд┐рджрдо PyGOST рдкреБрд╕реНрддрдХрд╛рд▓рдп рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ASD.1 PyDERASN</a> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд╕рд╛рде рд╕рдВрджреЗрд╢реЛрдВ рдХреА рдПрдиреНрдХреЛрдбрд┐рдВрдЧ (рдЬрд┐рд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╣реА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд▓рд┐рдЦрд╛ рдерд╛</a> )ред  рдкреВрд░реНрд╡рд╛рдкреЗрдХреНрд╖рд╛: рдпрд╣ рдЗрддрдирд╛ рд╕рд░рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЗрд╕реЗ рдПрдХ рд╢рд╛рдо (рдпрд╛ рдХрд╛рд░реНрдп рджрд┐рд╡рд╕) рдореЗрдВ рдЦрд░реЛрдВрдЪ рд╕реЗ рд▓рд┐рдЦрд╛ рдЬрд╛ рд╕рдХреЗ, рдЕрдиреНрдпрдерд╛ рдпрд╣ рдЕрдм рдПрдХ рд╕рд░рд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо рдирд╣реАрдВ рд╣реИред  рд╕рдВрднрд╡рддрдГ рдЗрд╕рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВ, рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХрдард┐рдирд╛рдЗрдпрд╛рдБ, рдХрдорд┐рдпрд╛рдБ рд╣реИрдВ, рд╕рд╛рде рд╣реА рдпрд╣ рдПрд╕рд┐рдВрдХреЛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдореЗрд░рд╛ рдкрд╣рд▓рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИред <br><a name="habracut"></a><br><h2>  рдбрд┐рдЬрд╛рдЗрди рдЖрдИрдПрдо </h2><br>  рдЖрд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдпрд╣ рд╕рдордЭрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рд╣рдорд╛рд░рд╛ рдЖрдИрдПрдо рдХреИрд╕рд╛ рджрд┐рдЦреЗрдЧрд╛ред  рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП, рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреА рдХрд┐рд╕реА рднреА рдЦреЛрдЬ рдХреЗ рдмрд┐рдирд╛, рдпрд╣ рд╕рд╣рдХрд░реНрдореА рд╕реЗ рд╕рд╣рдХрд░реНрдореА рдиреЗрдЯрд╡рд░реНрдХ рд╣реЛрдиреЗ рджреЗрдВред  рд╣рдо рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдХрд┐рд╕ рдкрддреЗ рдкрд░ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдВрдЧреЗ: рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рд╕реЗ рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЛрд░реНрдЯред <br><br>  рдореИрдВ рд╕рдордЭрддрд╛ рд╣реВрдВ рдХрд┐ рдЗрд╕ рд╕рдордп, рджреЛ рдордирдорд╛рдиреЗ рдХрдВрдкреНрдпреВрдЯрд░реЛрдВ рдХреЗ рдмреАрдЪ рдкреНрд░рддреНрдпрдХреНрд╖ рд╕рдВрдЪрд╛рд░ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреА рдзрд╛рд░рдгрд╛ рд╡реНрдпрд╡рд╣рд╛рд░ рдореЗрдВ рдЖрдИрдПрдо рдХреА рдкреНрд░рдпреЛрдЬреНрдпрддрд╛ рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕реАрдорд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЕрдзрд┐рдХ рдбреЗрд╡рд▓рдкрд░реНрд╕ рд╕рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ NAT-traversal рдмреИрд╕рд╛рдЦреА рдХреЛ рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗ, рдЕрдм рд╣рдо IPv4 рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдмрдиреЗ рд░рд╣реЗрдВрдЧреЗ, рдордирдорд╛рдиреЗ рдврдВрдЧ рд╕реЗ рдХрдВрдкреНрдпреВрдЯрд░ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреА рдирд┐рд░рд╛рд╢рд╛рдЬрдирдХ рд╕рдВрднрд╛рд╡рдирд╛ рдХреЗ рд╕рд╛рдеред  рдареАрдХ рд╣реИ, рдЖрдк рдШрд░ рдФрд░ рдХрд╛рдо рдкрд░ рдЖрдИрдкреАрд╡реА 6 рдХреА рдХрдореА рдХреЛ рдХрд┐рддрдирд╛ рд╕рд╣рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ? <br><br>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдПрдХ рдорд┐рддреНрд░-рд╕реЗ-рдорд┐рддреНрд░ рдиреЗрдЯрд╡рд░реНрдХ рд╣реЛрдЧрд╛: рд╕рднреА рд╕рдВрднрд╡ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЬрд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рд╕рдм рдХреБрдЫ рдмрд╣реБрдд рд╕рд░рд▓ рдХрд░рддрд╛ рд╣реИ: рдЦреБрдж рдХреЛ рдкреЗрд╢ рдХрд┐рдпрд╛, рдкрд╛рдпрд╛ рдпрд╛ рдирд╣реАрдВ рдорд┐рд▓рд╛ рдПрдХ рдирд╛рдо / рдХреБрдВрдЬреА, рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдпрд╛ рдХрд╛рдо рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрдирд╛, рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреЛ рдЬрд╛рдирдирд╛ред  рджреВрд╕рд░реЗ, рд╕рд╛рдорд╛рдиреНрдп рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ рдФрд░ рдХрдИ рд╣рдорд▓реЛрдВ рдХреЛ рдмрд╛рд╣рд░ рдХрд░рддрд╛ рд╣реИред <br><br>  IM рдЗрдВрдЯрд░рдлрд╝реЗрд╕ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреЗрдХрд╛рд░ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ</a> рдХреЗ рдХреНрд▓рд╛рд╕рд┐рдХ рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХреЗ рдХрд░реАрдм рд╣реЛрдЧрд╛, рдЬреЛ рдореБрдЭреЗ рдЙрдирдХреЗ рдЕрддрд┐рд╕реВрдХреНрд╖реНрдорд╡рд╛рдж рдФрд░ рдпреВрдирд┐рдХреНрд╕-рдорд╛рд░реНрдЧ рджрд░реНрд╢рди рдХреЗ рд▓рд┐рдП рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд╕рдВрдж рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдЗрдВрдЯрд░рд╕реНрдХреНрдпреВрдЯрд░ рдХреЗ рд▓рд┐рдП рдПрдХ IM рдкреНрд░реЛрдЧреНрд░рд╛рдо рддреАрди рдпреВрдирд┐рдХреНрд╕ рдбреЛрдореЗрди рд╕реЙрдХреЗрдЯ рдХреЗ рд╕рд╛рде рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рддрд╛ рд╣реИ: <br><br><ul><li>  рдореЗрдВ - рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреЛ рднреЗрдЬреЗ рдЧрдП рд╕рдВрджреЗрд╢ рдЗрд╕рдореЗрдВ рджрд░реНрдЬ рдХрд┐рдП рдЧрдП рд╣реИрдВ; </li><li>  рдмрд╛рд╣рд░ - рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╕рдВрджреЗрд╢ рдЗрд╕рд╕реЗ рдкрдврд╝реЗ рдЬрд╛рддреЗ рд╣реИрдВ; </li><li>  рд░рд╛рдЬреНрдп - рдЗрд╕реЗ рдкрдврд╝рдиреЗ рд╕реЗ, рд╣рдо рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдПрдВрдЧреЗ рдХрд┐ рдХреНрдпрд╛ рдЗрдВрдЯрд░рд▓рд╛рдХреНрдпреВрдЯрд░ рдЕрдм рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИ, рдХрдиреЗрдХреНрд╢рди рдкрддрд╛ / рдкреЛрд░реНрдЯред </li></ul><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХ рдХреЙрди рд╕реЙрдХреЗрдЯ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╣реЛрд╕реНрдЯ рдкреЛрд░реНрдЯ рдкрд░ рд▓рд┐рдЦрддреЗ рд╣реБрдП, рд╣рдо рдПрдХ рд░рд┐рдореЛрдЯ рдЗрдВрдЯрд░рд▓рд╛рдХреНрдпреВрдЯрд░ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> | - рдРрд▓рд┐рд╕
 |  | - рдореЗрдВ
 |  | - рдмрд╛рд╣рд░
 |  `- рд░рд╛рдЬреНрдп
 | - рдмреЙрдм
 |  | - рдореЗрдВ
 |  | - рдмрд╛рд╣рд░
 |  `- рд░рд╛рдЬреНрдп
 `- рдХреЙрди
</pre><br>  рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдЖрдкрдХреЛ рдЖрдИрдПрдо рдкрд░рд┐рд╡рд╣рди рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рд╕реНрд╡рддрдВрддреНрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕реНрд╡рд╛рдж рдФрд░ рд░рдВрдЧ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рджреЛрд╕реНрдд рдирд╣реАрдВ рд╣реИ, рдЖрдк рд╕рднреА рдХреЛ рдЦреБрд╢ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Tmux</a> рдФрд░ / рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдорд▓реНрдЯреАрдЯреИрд▓</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рд╕рд┐рдВрдЯреИрдХреНрд╕ рд╣рд╛рдЗрд▓рд╛рдЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдПрдХ рдорд▓реНрдЯреА-рд╡рд┐рдВрдбреЛ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">rlwrap рдХреЗ</a> рд╕рд╛рде <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">,</a> рдЖрдк рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рджрд░реНрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП GNU Readline- рд╕рдВрдЧрдд рд╕реНрдЯреНрд░рд┐рдВрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдмреЗрдХрд╛рд░ рдкреНрд░реЛрдЬреЗрдХреНрдЯ FIFO рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдореИрдВ рд╕рдордЭ рдирд╣реАрдВ рдкрд╛ рд░рд╣рд╛ рдерд╛ рдХрд┐ рдЪрдпрдирд┐рдд рдереНрд░реЗрдбреНрд╕ рд╕реЗ рд╣рд╛рде рд╕реЗ рдмрдиреЗ рд╕рдмреНрд╕рдЯреНрд░реЗрдЯ рдХреЗ рдмрд┐рдирд╛ рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрд╕рд┐рдВрдХреЛ рдореЗрдВ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реВрдВ (рдореИрдВ рд▓рдВрдмреЗ рд╕рдордп рд╕реЗ рдРрд╕реА рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧреЛ</a> рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВ)ред  рдЗрд╕рд▓рд┐рдП, рдореИрдВрдиреЗ рдпреВрдирд┐рдХреНрд╕ рдбреЛрдореЗрди рд╕реЙрдХреЗрдЯ рдХреЗ рд╕рд╛рде рдорд┐рд▓рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдпрд╣ 2001 рдЗрдХреЛ рдХрд░рдирд╛ рдЕрд╕рдВрднрд╡ рдмрдирд╛рддрд╛ рд╣реИ: 470: рдореГрдд :: рдмреЗрдм 6666&gt; рдХреЙрдиред  рдореИрдВрдиреЗ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рддреЗ рд╣реБрдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕рдорд╛рдЬ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛: рдЧреВрдВрдЬ 2001: 470: рдбреЗрдб :: рдмреЗрдм 6666 |  рд╕реЛрд╕рд╛рдЗрдЯреА - UNIX-CONNECT: рдХреЙрди, рд╕реЛрд╕рд╛рдЗрдЯреА READLINE UNIX-CONNECT: alice / inред <br><br><h2>  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ </h2><br>  рдЯреАрд╕реАрдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдкрд░рд┐рд╡рд╣рди рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдпрд╣ рд╡рд┐рддрд░рдг рдФрд░ рдЙрд╕рдХреЗ рдЖрджреЗрд╢ рдХреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИред  рдпреВрдбреАрдкреА рдЧрд╛рд░рдВрдЯреА рджреЗрддрд╛ рд╣реИ рдХрд┐ рди рддреЛ рдХреЛрдИ рдФрд░ рди рд╣реА (рдЬреЛ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рд▓рд╛рдЧреВ рд╣реЛрдиреЗ рдкрд░ рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛), рдФрд░ рдкрд╛рдпрдерди рдореЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрд╕рд╕реАрдЯреАрдкреА</a> рд╕рдорд░реНрдерди рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИред <br><br>  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, рдЯреАрд╕реАрдкреА рдореЗрдВ рдПрдХ рд╕рдВрджреЗрд╢ рдХреА рдХреЛрдИ рдЕрд╡рдзрд╛рд░рдгрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдХреЗрд╡рд▓ рдмрд╛рдЗрдЯреНрд╕ рдХреА рдПрдХ рдзрд╛рд░рд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рдЖрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдЗрд╕ рдзрд╛рд░рд╛ рдореЗрдВ рдЖрдкрд╕ рдореЗрдВ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред  рд╣рдо рд▓рд╛рдЗрди рдлреАрдб рдЪрд░рд┐рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рд╣рдордд рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рд╢реБрд░реБрдЖрдд рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЙрдкрдпреБрдХреНрдд рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬрдм рд╣рдо рдЕрдкрдиреЗ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдкреНрд░рддреАрдХ рд╕рд┐рдлрд░рдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рдХрд╣реАрдВ рднреА рджрд┐рдЦрд╛рдИ рджреЗ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд▓реЛрдХрдкреНрд░рд┐рдп рд╣реИрдВ, рд╕рдВрджреЗрд╢ рдХреА рдкрд╣рд▓реА рд▓рдВрдмрд╛рдИ рдмрд╛рдЗрдЯреНрд╕ рдореЗрдВ рднреЗрдЬрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдкрд╛рдпрдерди рдореЗрдВ, рдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ xdrlib рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдПрдХ рд╕рдорд╛рди <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">XDR</a> рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред <br><br>  рд╣рдо рдЯреАрд╕реАрдкреА рдкрдврд╝рдиреЗ рдХреЗ рд╕рд╛рде рд╕рд╣реА рдФрд░ рдХреБрд╢рд▓рддрд╛ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ - рд╣рдо рдХреЛрдб рдХреЛ рд╕рд░рд▓ рдХрд░рддреЗ рд╣реИрдВред  рд╣рдо рдПрдХ рдЕрдВрддрд╣реАрди рд▓реВрдк рдореЗрдВ рд╕реЙрдХреЗрдЯ рд╕реЗ рдбреЗрдЯрд╛ рдкрдврд╝рддреЗ рд╣реИрдВ рдЬрдм рддрдХ рдХрд┐ рд╣рдо рдкреВрд░рд╛ рд╕рдВрджреЗрд╢ рдбрд┐рдХреЛрдб рдирд╣реАрдВ рдХрд░рддреЗред  рдЖрдк рдЗрд╕ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд░реВрдк рдХреЗ рд░реВрдк рдореЗрдВ XML рдХреЗ рд╕рд╛рде JSON рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЬрдм рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреЛ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдбреЗрдЯрд╛ рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд рдФрд░ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ - рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрд╛рдЗрдЯ-рдмрд╛рдп-рдмрд╛рдЗрдЯ рд╕рдорд╛рди рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд╕рдорд╛рди рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЬреЛ JSON / XML рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ (рдбрдВрдк рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ)ред <br><br>  XDR рдЗрд╕ рддрд░рд╣ рдХреЗ рдХрд╛рд░реНрдп рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореИрдВ DER рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PyDERASN</a> рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреЗ рд╕рд╛рде ASN.1 рдХреЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЪреБрдирддрд╛ рд╣реВрдВ</a> , рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╣рд╛рде рдкрд░ рдЙрдЪреНрдЪ-рд╕реНрддрд░реАрдп рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реЛрдВрдЧреЗ, рдЬрд┐рдирдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдХреНрд╕рд░ рдЕрдзрд┐рдХ рд╕реБрдЦрдж рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реЛрддреЗ рд╣реИрдВред  рд╕реНрдХреАрдорд╛рд▓реЗрд╕ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреЗрдВрдХреЛрдбреЛрдб</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдореИрд╕реЗрдЬрдкреИрдХ</a> , рдпрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реАрдмреАрдУрдЖрд░ рдХреЗ рд╡рд┐рдкрд░реАрдд</a> , ASN.1 рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╣рд╛рд░реНрдб-рдХреЛрдбреЗрдб рд╕реНрдХреАрдо рдХреЗ рдЦрд┐рд▓рд╛рдл рдбреЗрдЯрд╛ рдХреЛ рдорд╛рдиреНрдп рдХрд░реЗрдЧрд╛ред <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Msg ::= CHOICE { # text MsgText, # handshake [0] EXPLICIT MsgHandshake } class Msg(Choice): schema = (( ("text", MsgText()), ("handshake", MsgHandshake(expl=tag_ctxc(0))), )) # MsgText ::= SEQUENCE { # text UTF8String (SIZE(1..MaxTextLen))} class MsgText(Sequence): schema = (( ("text", UTF8String(bounds=(1, MaxTextLen))), )) # MsgHandshake ::= SEQUENCE { # peerName UTF8String (SIZE(1..256)) } class MsgHandshake(Sequence): schema = (( ("peerName", UTF8String(bounds=(1, 256))), ))</span></span></code> </pre> <br>  рдкреНрд░рд╛рдкреНрдд рд╕рдВрджреЗрд╢ Msg рд╣реЛрдЧрд╛: рдпрд╛ рддреЛ рдПрдХ рдкрд╛рда MsgText (рдЕрдм рддрдХ рдПрдХ рдкрд╛рда рдХреНрд╖реЗрддреНрд░ рдХреЗ рд╕рд╛рде) рдпрд╛ рдПрдХ рд╣рд╛рде рдорд┐рд▓рд╛рдиреЗ рдХрд╛ рд╕рдВрджреЗрд╢ MsgHandshake (рдЬрд┐рд╕рдореЗрдВ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХрд╛ рдирд╛рдо рдкреНрд░рд╕рд╛рд░рд┐рдд рд╣реЛрддрд╛ рд╣реИ)ред  рдЕрдм рдпрд╣ рдЕрдзреВрд░рд╛ рджрд┐рдЦрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рднрд╡рд┐рд╖реНрдп рдХреЗ рд▓рд┐рдП рдПрдХ рдЪреБрдиреМрддреА рд╣реИред <br><br><pre>      тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
      тФВPeerAтФВ тФВPeerBтФВ
      тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
         )MsgHandshake (IdA) H
         тФВ &gt;&gt; тФВ
         тФВ тФВ
         )MsgHandshake (IdB) H
         тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ &lt;тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ
         тФВ тФВ
         Ext MsgText () ext
         тФВ &gt;&gt; тФВ
         тФВ тФВ
         Ext MsgText () ext
         тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ &lt;тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ
         тФВ тФВ
</pre><br><br><h2>  рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлреА рдХреЗ рдмрд┐рдирд╛ рдЖрдИрдПрдо </h2><br>  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдХрд╣рд╛, рд╕реЙрдХреЗрдЯ рдХреЗ рд╕рд╛рде рд╕рднреА рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрд╕рд┐рдВрд╕реАрдУ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд▓реЙрдиреНрдЪ рдХреЗ рд╕рдордп рд╣рдо рдЙрдореНрдореАрдж рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="python hljs">parser = argparse.ArgumentParser(description=<span class="hljs-string"><span class="hljs-string">"GOSTIM"</span></span>) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--our-name"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Our peer name"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--their-names"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Their peer names, comma-separated"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--bind"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"::1"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Address to listen on"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--port"</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">6666</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Port to listen on"</span></span>, ) args = parser.parse_args() OUR_NAME = UTF8String(args.our_name) THEIR_NAMES = set(args.their_names.split(<span class="hljs-string"><span class="hljs-string">","</span></span>))</code> </pre><br>  рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдирд╛рдо (--our-name alice) рд╕реЗрдЯ рдХрд░реЗрдВред  рдЕрд▓реНрдкрд╡рд┐рд░рд╛рдо рд╕рднреА рдЕрдкреЗрдХреНрд╖рд┐рдд рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рддрд╛ рд╣реИ (- рдЙрдирдХрд╛ рдирд╛рдо-рдирд╛рдо рдмреЙрдм, рдкреВрд░реНрд╡ рд╕рдВрдзреНрдпрд╛)ред  рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП, рдпреВрдирд┐рдХреНрд╕ рд╕реЙрдХреЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдИ рдЬрд╛рддреА рд╣реИ, рд╕рд╛рде рд╣реА рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП, рдмрд╛рд╣рд░, рд░рд╛рдЬреНрдп: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> peer_name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> THEIR_NAMES: makedirs(peer_name, mode=<span class="hljs-number"><span class="hljs-number">0o700</span></span>, exist_ok=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) out_queue = asyncio.Queue() OUT_QUEUES[peer_name] = out_queue asyncio.ensure_future(asyncio.start_unix_server( partial(unixsock_out_processor, out_queue=out_queue), path.join(peer_name, <span class="hljs-string"><span class="hljs-string">"out"</span></span>), )) in_queue = asyncio.Queue() IN_QUEUES[peer_name] = in_queue asyncio.ensure_future(asyncio.start_unix_server( partial(unixsock_in_processor, in_queue=in_queue), path.join(peer_name, <span class="hljs-string"><span class="hljs-string">"in"</span></span>), )) asyncio.ensure_future(asyncio.start_unix_server( partial(unixsock_state_processor, peer_name=peer_name), path.join(peer_name, <span class="hljs-string"><span class="hljs-string">"state"</span></span>), )) asyncio.ensure_future(asyncio.start_unix_server(unixsock_conn_processor, <span class="hljs-string"><span class="hljs-string">"conn"</span></span>))</code> </pre><br>  рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рд╕реЙрдХреЗрдЯ рдореЗрдВ рд╕рдВрджреЗрд╢ рдХрддрд╛рд░ рдореЗрдВ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ IN_QUEUES: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_in_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer, in_queue: asyncio.Queue)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> reader.read(MaxTextLen) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text == <span class="hljs-string"><span class="hljs-string">b""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> in_queue.put(text.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>))</code> </pre><br>  рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдХреЗ рд╕рдВрджреЗрд╢ OUT_QUEUES рдХрддрд╛рд░ рдореЗрдВ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдБ рд╕реЗ рдбреЗрдЯрд╛ рдЖрдЙрдЯ рд╕реЙрдХреЗрдЯ рдХреЛ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_out_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer, out_queue: asyncio.Queue)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> out_queue.get() writer.write((<span class="hljs-string"><span class="hljs-string">"[%s] %s"</span></span> % (datetime.now(), text)).encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain()</code> </pre><br>  рдЬрдм рд░рд╛рдЬреНрдп рд╕реЙрдХреЗрдЯ рд╕реЗ рдкрдврд╝рддреЗ рд╣реИрдВ, рддреЛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреЗ рдкрддреЗ рдХреЗ рд▓рд┐рдП PEER_ALIVE рд╢рдмреНрджрдХреЛрд╢ рдореЗрдВ рджрд┐рдЦрддрд╛ рд╣реИред  рдпрджрд┐ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХрд╛ рдЕрднреА рддрдХ рдХреЛрдИ рд╕рдВрдмрдВрдз рдирд╣реАрдВ рд╣реИ, рддреЛ рдПрдХ рдЦрд╛рд▓реА рд▓рд╛рдЗрди рд▓рд┐рдЦреА рдЬрд╛рддреА рд╣реИред <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_state_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer, peer_name: str)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> peer_writer = PEER_ALIVES.get(peer_name) writer.write( <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> peer_writer <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>.join([ str(i) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> peer_writer.get_extra_info(<span class="hljs-string"><span class="hljs-string">"peername"</span></span>)[:<span class="hljs-number"><span class="hljs-number">2</span></span>] ]).encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) + <span class="hljs-string"><span class="hljs-string">b"\n"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() writer.close()</code> </pre><br>  рдЬрдм рдПрдХ рдкрддрд╛ рдХреЙрди рд╕реЙрдХреЗрдЯ рдХреЛ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдХрдиреЗрдХреНрд╢рди рдХрд╛ "рдЖрд░рдВрднрдХрд░реНрддрд╛" рдлрд╝рдВрдХреНрд╢рди рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_conn_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> reader.read(<span class="hljs-number"><span class="hljs-number">256</span></span>) writer.close() host, port = data.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>).split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> initiator(host=host, port=int(port))</code> </pre><br>  рд╕рд░реНрдЬрдХ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╡рд╣ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╣реЛрд╕реНрдЯ / рдкреЛрд░реНрдЯ рд╕реЗ рдПрдХ рдХрдиреЗрдХреНрд╢рди рдЦреЛрд▓рддрд╛ рд╣реИ рдФрд░ рдЕрдкрдиреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рдПрдХ рд╣реИрдВрдбрд╢реЗрдХ рд╕рдВрджреЗрд╢ рднреЗрдЬрддрд╛ рд╣реИ: <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">130</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initiator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host, port)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">131</span></span> _id = repr((host, port)) <span class="hljs-number"><span class="hljs-number">132</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: dialing"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">133</span></span> reader, writer = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.open_connection(host, port) <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-comment"><span class="hljs-comment"># Handshake message {{{ 135 writer.write(Msg(("handshake", MsgHandshake(( 136 ("peerName", OUR_NAME), 137 )))).encode()) 138 # }}} 139 await writer.drain()</span></span></code> </pre><br>  рдлрд┐рд░ рдпрд╣ рджреВрд░ рдХреА рдУрд░ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИред  Msg ASN.1 рдпреЛрдЬрдирд╛ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдкреНрд░рд╛рдкреНрдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдбрд┐рдХреЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ред  рд╣рдо рдорд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рд╕рдВрдкреВрд░реНрдг рд╕рдВрджреЗрд╢ рдПрдХ рдЯреАрд╕реАрдкреА рд╕реЗрдЧрдореЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд╣рдо рдЗрд╕реЗ .read () рдХрд╣реЗ рдЬрд╛рдиреЗ рдкрд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВрдЧреЗред  рд╣рдо рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рд╣реИрдВрдбрд╢реЗрдХ рд╕рдВрджреЗрд╢ рдорд┐рд▓рд╛ рд╣реИред <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">141</span></span> <span class="hljs-comment"><span class="hljs-comment"># Wait for Handshake message {{{ 142 data = await reader.read(256) 143 if data == b"": 144 logging.warning("%s: no answer, disconnecting", _id) 145 writer.close() 146 return 147 try: 148 msg, _ = Msg().decode(data) 149 except ASN1Error: 150 logging.warning("%s: undecodable answer, disconnecting", _id) 151 writer.close() 152 return 153 logging.info("%s: got %s message", _id, msg.choice) 154 if msg.choice != "handshake": 155 logging.warning("%s: unexpected message, disconnecting", _id) 156 writer.close() 157 return 158 # }}}</span></span></code> </pre><br>  рд╣рдо рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдЬрд┐рд╕ рд╡реНрдпрдХреНрддрд┐ рд╕реЗ рдмрд╛рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдЙрд╕рдХрд╛ рдирд╛рдо рд╣рдореЗрдВ рдЬреНрдЮрд╛рдд рд╣реИред  рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдХрдиреЗрдХреНрд╢рди рддреЛрдбрд╝ рджреЗрдВред  рд╣рдо рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдЙрд╕рдХреЗ рд╕рд╛рде рдПрдХ рд╕рдВрдмрдВрдз рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ (рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдиреЗ рдлрд┐рд░ рд╕реЗ рд╣рдореЗрдВ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрдЬреНрдЮрд╛ рджреА рд╣реИ) рдФрд░ рдЗрд╕реЗ рдмрдВрдж рдХрд░ рджреЗрдВред  рд╕рдВрджреЗрд╢ рдкрд╛рда рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ IN_QUEUES рдХрддрд╛рд░ рдореЗрдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╡рд┐рд╢реЗрд╖ рдореВрд▓реНрдп рдХреЛрдИ рднреА рдирд╣реАрдВ рд╣реИ, рдЬреЛ msg_sender рдХреЛ рдХреЛрд░рдЯрд╛рдЗрди рдХреЛ рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдВрдХреЗрдд рджреЗрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рдЕрдкрдиреЗ рд▓реЗрдЦрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рднреВрд▓ рдЬрд╛рдП, рдЬреЛ рдПрдХ рдкреБрд░рд╛рдиреЗ рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реИред <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">159</span></span> msg_handshake = msg.value <span class="hljs-number"><span class="hljs-number">160</span></span> peer_name = str(msg_handshake[<span class="hljs-string"><span class="hljs-string">"peerName"</span></span>]) <span class="hljs-number"><span class="hljs-number">161</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> peer_name <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> THEIR_NAMES: <span class="hljs-number"><span class="hljs-number">162</span></span> logging.warning(<span class="hljs-string"><span class="hljs-string">"unknown peer name: %s"</span></span>, peer_name) <span class="hljs-number"><span class="hljs-number">163</span></span> writer.close() <span class="hljs-number"><span class="hljs-number">164</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: session established: %s"</span></span>, _id, peer_name) <span class="hljs-number"><span class="hljs-number">166</span></span> <span class="hljs-comment"><span class="hljs-comment"># Run text message sender, initialize transport decoder {{{ 167 peer_alive = PEER_ALIVES.pop(peer_name, None) 168 if peer_alive is not None: 169 peer_alive.close() 170 await IN_QUEUES[peer_name].put(None) 171 PEER_ALIVES[peer_name] = writer 172 asyncio.ensure_future(msg_sender(peer_name, writer)) 173 # }}}</span></span></code> </pre><br>  msg_sender рдЖрдЙрдЯрдЧреЛрдЗрдВрдЧ рд╕рдВрджреЗрд╢реЛрдВ (рд╕реЙрдХреЗрдЯ рдореЗрдВ рд╕реЗ рдХрддрд╛рд░рдмрджреНрдз) рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рдЙрдиреНрд╣реЗрдВ MsgText рд╕рдВрджреЗрд╢ рдореЗрдВ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЯреАрд╕реАрдкреА рдХрдиреЗрдХреНрд╢рди рднреЗрдЬрддрд╛ рд╣реИред  рдпрд╣ рдХрд┐рд╕реА рднреА рдХреНрд╖рдг рдЯреВрдЯ рд╕рдХрддрд╛ рд╣реИ - рд╣рдо рдЗрд╕реЗ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд░реЛрдХ рд░рд╣реЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_sender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(peer_name: str, writer)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> in_queue = IN_QUEUES[peer_name] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> in_queue.get() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> writer.write(Msg((<span class="hljs-string"><span class="hljs-string">"text"</span></span>, MsgText(( (<span class="hljs-string"><span class="hljs-string">"text"</span></span>, UTF8String(text)), )))).encode()) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionResetError: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> PEER_ALIVES[peer_name] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: sent %d characters message"</span></span>, peer_name, len(text))</code> </pre><br>  рдЕрдВрдд рдореЗрдВ, рдЖрд░рдВрднрдХрд░реНрддрд╛ рд╕реЙрдХреЗрдЯ рд╕реЗ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рдПрдХ рдЕрдВрддрд╣реАрди рдЪрдХреНрд░ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИред  рдЬрд╛рдБрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдпрд╣ рдПрдХ рдкрд╛рда рд╕рдВрджреЗрд╢ рд╣реИ, рдФрд░ OUT_QUEUES рдореЗрдВ рд╡рд╣ рд╕реНрдерд╛рди рд╣реИ рдЬрд╣рд╛рдБ рд╕реЗ рдЙрдиреНрд╣реЗрдВ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреЗ рдЖрдЙрдЯ рд╕реЙрдХреЗрдЯ рдкрд░ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЖрдк рдХреЗрд╡рд▓ .read () рдФрд░ рд╕рдВрджреЗрд╢ рдХреЛ рдбрд┐рдХреЛрдб рдХреНрдпреЛрдВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ?  рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХрдИ рд╕рдВрджреЗрд╢ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдмрдлрд░ рдореЗрдВ рдПрдХрддреНрд░ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ рдФрд░ рдПрдХ рдЯреАрд╕реАрдкреА рд╕реЗрдЧрдореЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рднреЗрдЬреЗ рдЬрд╛рдПрдВрдЧреЗред  рд╣рдо рдкрд╣рд▓реЗ рдПрдХ рдХреЛ рдбреАрдХреЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рд╡рд╛рд▓реЗ рд╣рд┐рд╕реНрд╕реЗ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрдлрд░ рдореЗрдВ рд░рд╣ рд╕рдХрддрд╛ рд╣реИред  рдХрд┐рд╕реА рднреА рдЖрдкрд╛рдд рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдо TCP рдХрдиреЗрдХреНрд╢рди рдХреЛ рдмрдВрдж рдХрд░рддреЗ рд╣реИрдВ рдФрд░ msg_sender coroutine (OUT_QUEUES рдХрддрд╛рд░ рдореЗрдВ рдХреЛрдИ рдирд╣реАрдВ рднреЗрдЬрдХрд░) рдХреЛ рд░реЛрдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">174</span></span> buf = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-comment"><span class="hljs-comment"># Wait for test messages {{{ 176 while True: 177 data = await reader.read(MaxMsgLen) 178 if data == b"": 179 break 180 buf += data 181 if len(buf) &gt; MaxMsgLen: 182 logging.warning("%s: max buffer size exceeded", _id) 183 break 184 try: 185 msg, tail = Msg().decode(buf) 186 except ASN1Error: 187 continue 188 buf = tail 189 if msg.choice != "text": 190 logging.warning("%s: unexpected %s message", _id, msg.choice) 191 break 192 try: 193 await msg_receiver(msg.value, peer_name) 194 except ValueError as err: 195 logging.warning("%s: %s", err) 196 break 197 # }}} 198 logging.info("%s: disconnecting: %s", _id, peer_name) 199 IN_QUEUES[peer_name].put(None) 200 writer.close() 66 async def msg_receiver(msg_text: MsgText, peer_name: str) -&gt; None: 67 text = str(msg_text["text"]) 68 logging.info("%s: received %d characters message", peer_name, len(text)) 69 await OUT_QUEUES[peer_name].put(text)</span></span></code> </pre><br>  рдЖрдЗрдП рдореБрдЦреНрдп рдХреЛрдб рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВред  рд╕рднреА coroutines рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рдЬрд┐рд╕ рд╕рдордп рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рд╣рдо TCP рд╕рд░реНрд╡рд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рдкрд┐рдд рдХрдиреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП, рд╡рд╣ рдПрдХ рдЙрддреНрддрд░рд╡рд░реНрддреА рдХреЛрд░рдЯрд╛рдЗрди рдмрдирд╛рддрд╛ рд╣реИред <br><br><pre> <code class="python hljs">logging.basicConfig( level=logging.INFO, format=<span class="hljs-string"><span class="hljs-string">"%(levelname)s %(asctime)s: %(funcName)s: %(message)s"</span></span>, ) loop = asyncio.get_event_loop() server = loop.run_until_complete(asyncio.start_server(responder, args.bind, args.port)) logging.info(<span class="hljs-string"><span class="hljs-string">"Listening on: %s"</span></span>, server.sockets[<span class="hljs-number"><span class="hljs-number">0</span></span>].getsockname()) loop.run_forever()</code> </pre><br>  рдЙрддреНрддрд░рджрд╛рддрд╛ рд╕рд░реНрдЬрдХ рдХреЗ рд╕рдорд╛рди рд╣реИ рдФрд░ рд╕рднреА рд╕рдорд╛рди рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкрдврд╝рдиреЗ рдХреЗ рд╕рдВрджреЗрд╢реЛрдВ рдХрд╛ рдПрдХ рдЕрдВрддрд╣реАрди рд▓реВрдк рд╕рд░рд▓рддрд╛ рдХреЗ рд▓рд┐рдП рддреБрд░рдВрдд рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред  рдЕрдм рд╣реИрдВрдбрд╢реЗрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдкреНрд░рддреНрдпреЗрдХ рдкрдХреНрд╖ рд╕реЗ рдПрдХ рд╕рдВрджреЗрд╢ рднреЗрдЬрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рднрд╡рд┐рд╖реНрдп рдореЗрдВ, рдХрдиреЗрдХреНрд╢рди рдХреЗ рдЖрд░рдВрднрдХрд░реНрддрд╛ рд╕реЗ рджреЛ рд╣реЛрдВрдЧреЗ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдкрд╛рда рд╕рдВрджреЗрд╢ рддреБрд░рдВрдд рднреЗрдЬреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">72</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">responder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> _id = writer.get_extra_info(<span class="hljs-string"><span class="hljs-string">"peername"</span></span>) <span class="hljs-number"><span class="hljs-number">74</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: connected"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">75</span></span> buf = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> msg_expected = <span class="hljs-string"><span class="hljs-string">"handshake"</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span> peer_name = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-number"><span class="hljs-number">78</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-number"><span class="hljs-number">79</span></span> <span class="hljs-comment"><span class="hljs-comment"># Read until we get Msg message {{{ 80 data = await reader.read(MaxMsgLen) 81 if data == b"": 82 logging.info("%s: closed connection", _id) 83 break 84 buf += data 85 if len(buf) &gt; MaxMsgLen: 86 logging.warning("%s: max buffer size exceeded", _id) 87 break 88 try: 89 msg, tail = Msg().decode(buf) 90 except ASN1Error: 91 continue 92 buf = tail 93 # }}} 94 if msg.choice != msg_expected: 95 logging.warning("%s: unexpected %s message", _id, msg.choice) 96 break 97 if msg_expected == "text": 98 try: 99 await msg_receiver(msg.value, peer_name) 100 except ValueError as err: 101 logging.warning("%s: %s", err) 102 break 103 # Process Handshake message {{{ 104 elif msg_expected == "handshake": 105 logging.info("%s: got %s message", _id, msg_expected) 106 msg_handshake = msg.value 107 peer_name = str(msg_handshake["peerName"]) 108 if peer_name not in THEIR_NAMES: 109 logging.warning("unknown peer name: %s", peer_name) 110 break 111 writer.write(Msg(("handshake", MsgHandshake(( 112 ("peerName", OUR_NAME), 113 )))).encode()) 114 await writer.drain() 115 logging.info("%s: session established: %s", _id, peer_name) 116 peer_alive = PEER_ALIVES.pop(peer_name, None) 117 if peer_alive is not None: 118 peer_alive.close() 119 await IN_QUEUES[peer_name].put(None) 120 PEER_ALIVES[peer_name] = writer 121 asyncio.ensure_future(msg_sender(peer_name, writer)) 122 msg_expected = "text" 123 # }}} 124 logging.info("%s: disconnecting", _id) 125 if msg_expected == "text": 126 IN_QUEUES[peer_name].put(None) 127 writer.close()</span></span></code> </pre><br><h2>  рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ </h2><br>  рд╣рдорд╛рд░реЗ рд╕рдВрдЪрд╛рд░ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИред  рд╣рдореЗрдВ рд╕реБрд░рдХреНрд╖рд╛ рд╕реЗ рдХреНрдпрд╛ рдорддрд▓рдм рд╣реИ рдФрд░ рд╣рдо рдХреНрдпрд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ: <br><br><ul><li>  рдкреНрд░реЗрд╖рд┐рдд рд╕рдВрджреЗрд╢реЛрдВ рдХреА рдЧреЛрдкрдиреАрдпрддрд╛; </li><li>  рдкреНрд░реЗрд╖рд┐рдд рд╕рдВрджреЗрд╢реЛрдВ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рдФрд░ рдЕрдЦрдВрдбрддрд╛ - рдЙрдирдХреЗ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП; </li><li>  рд░рд┐рдкреНрд▓реЗ рд╣рдорд▓реЛрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ - рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рд╕рдВрджреЗрд╢ рдЦреЛ рдЧрдП рд╣реИрдВ рдпрд╛ рдкреАрдЫреЗ рд╣рдЯ рдЧрдП рд╣реИрдВ, рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП (рдФрд░ рд╣рдо рдбрд┐рд╕реНрдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХрд╛ рдирд┐рд░реНрдгрдп рд▓реЗрддреЗ рд╣реИрдВ); </li><li>  рдкреВрд░реНрд╡-рдЪрд╛рд▓рд┐рдд рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдФрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг - рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рддрдп рдХрд░ рд▓рд┐рдпрд╛ рд╣реИ рдХрд┐ рд╣рдо рдорд┐рддреНрд░-рд╕реЗ-рдорд┐рддреНрд░ рдиреЗрдЯрд╡рд░реНрдХ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВред  рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдмрд╛рдж рд╣реА рд╣рдо рд╕рдордЭ рдкрд╛рдПрдВрдЧреЗ рдХрд┐ рд╣рдо рдХрд┐рд╕рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░ рд░рд╣реЗ рд╣реИрдВ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░рд┐рдкреВрд░реНрдг рдлрд╝реЙрд░рд╡рд░реНрдб рд╕реАрдХреНрд░реЗрд╕реА</a> рдкреНрд░реЙрдкрд░реНрдЯреАрдЬрд╝ (PFS) рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ - рд╣рдорд╛рд░реА рд▓рдВрдмреЗ рд╕рдордп рд╕реЗ рдЪрд▓реА рдЖ рд░рд╣реА рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреБрдВрдЬреА рдХрд╛ рд╕рдордЭреМрддрд╛ рдкрд┐рдЫрд▓реЗ рд╕рднреА рдкрддреНрд░рд╛рдЪрд╛рд░ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХреА рдУрд░ рдирд╣реАрдВ рд▓реЗ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯреЗрдб рдЯреНрд░реИрдлрд╝рд┐рдХ рд░рд┐рдХреЙрд░реНрдб рдХрд░рдирд╛ рдмреЗрдХрд╛рд░ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ; </li><li>  рдХреЗрд╡рд▓ рдЯреАрд╕реАрдкреА рд╕рддреНрд░ рдХреЗ рднреАрддрд░ рд╕рдВрджреЗрд╢реЛрдВ (рдкрд░рд┐рд╡рд╣рди рдФрд░ рд╣реИрдВрдбрд╢реЗрдХ) рдХреА рд╡реИрдзрддрд╛ / рд╡реИрдзрддрд╛ред  рдПрдХ рдФрд░ рд╕рддреНрд░ рд╕реЗ (рдПрдХ рд╣реА рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреЗ рд╕рд╛рде) рд╕рд╣реА рдврдВрдЧ рд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░рд┐рдд / рдкреНрд░рдорд╛рдгрд┐рдд рд╕рдВрджреЗрд╢реЛрдВ рдХрд╛ рд╕рдореНрдорд┐рд▓рди рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП; </li><li>  рдирд┐рд╖реНрдХреНрд░рд┐рдп рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЛ рдирд╣реАрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдкреНрд░реЗрд╖рд┐рдд рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП, рди рд╣реА рдЙрдирд╕реЗ рд╣реИрд╢ред  рдПрдХ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХ рд╕реЗ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЧреБрдордирд╛рдореАред </li></ul><br>  рд╣реИрд░рд╛рдиреА рдХреА рдмрд╛рдд рд╣реИ, рд▓рдЧрднрдЧ рд╣рд░ рдХреЛрдИ рдЪрд╛рд╣рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдХрд┐рд╕реА рднреА рд╣реИрдВрдбрд╢реЗрдХ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо рд╣реЛ, рдФрд░ рдЙрдкрд░реЛрдХреНрдд рдореЗрдВ рд╕реЗ рдмрд╣реБрдд рдХрдо рдЕрдВрддрддрдГ рдШрд░-рд╡рд┐рдХрд╕рд┐рдд рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд▓рд┐рдП рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП рдЕрдм рд╣рдо рдирдИ рдЪреАрдЬреЛрдВ рдХрд╛ рдЖрд╡рд┐рд╖реНрдХрд╛рд░ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  рдореИрдВ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╢реЛрд░ рдврд╛рдВрдЪреЗ</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреВрдВрдЧрд╛, рд▓реЗрдХрд┐рди рдЪрд▓реЛ рдХреБрдЫ рд╕рд░рд▓ рдЪреБрдиреЗрдВред <br><br>  рд╕рдмрд╕реЗ рд▓реЛрдХрдкреНрд░рд┐рдп рджреЛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИрдВ: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреАрдПрд▓рдПрд╕</a> рдПрдХ рдЬрдЯрд┐рд▓ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдмрдЧ, рд╕реНрдХреВрд▓реЛрдВ, рдХрдордЬреЛрд░рд┐рдпреЛрдВ, рдЦрд░рд╛рдм рд╡рд┐рдЪрд╛рд░, рдЬрдЯрд┐рд▓рддрд╛ рдФрд░ рдХрдорд┐рдпреЛрдВ рдХрд╛ рдПрдХ рд▓рдВрдмрд╛ рдЗрддрд┐рд╣рд╛рд╕ рд╣реИ (рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдЯреАрдПрд▓рдПрд╕ 1.3 рдкрд░ рдмрд╣реБрдд рдЕрдзрд┐рдХ рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ)ред  рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕реЗ рдЬрдЯрд┐рд▓рддрд╛ рдХреЗ рдХрд╛рд░рдг рдирд╣реАрдВ рдорд╛рдирддреЗ рд╣реИрдВред </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">IKE рдХреЗ</a> рд╕рд╛рде <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">IPsec</a> - рдЧрдВрднреАрд░ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рд╕рдорд╕реНрдпрд╛рдПрдВ рдирд╣реАрдВ рд╣реИрдВ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рд╡реЗ рднреА рд╕рд░рд▓ рдирд╣реАрдВ рд╣реИрдВред  рдпрджрд┐ рдЖрдк IKEv1 рдФрд░ IKEv2 рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкрдврд╝рддреЗ рд╣реИрдВ, рддреЛ рдЙрдирдХрд╛ рд╕реНрд░реЛрдд <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">STS</a> , ISO / IEC IS 9798-3 рдФрд░ SIGMA (SIGn-and-MAc) рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИрдВ - рдПрдХ рд╢рд╛рдо рдореЗрдВ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рд╕рд░рд▓ред </li></ul><br>  SIGMA, STS / ISO рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рд╡рд┐рдХрд╛рд╕ рдореЗрдВ рдЕрдВрддрд┐рдо рдХрдбрд╝реА рдХреЗ рд░реВрдк рдореЗрдВ рдХреИрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╣реИ?  рдпрд╣ рд╣рдорд╛рд░реА рд╕рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ рд╕рдВрддреБрд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ (рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреЛ "рдЫрд┐рдкрд╛рдирд╛" рд╕рд╣рд┐рдд), рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд╝рд┐рдХ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рдирд╣реАрдВ рдЬрд╛рдирддрд╛ рд╣реИред  рдпрд╣ рдиреНрдпреВрдирддрд░ рд╣реИ - рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕рдВрджреЗрд╢ рд╕реЗ рдХрдо рд╕реЗ рдХрдо рдПрдХ рддрддреНрд╡ рдХреЛ рд╣рдЯрд╛рдиреЗ рд╕реЗ рдЗрд╕рдХреА рдЕрд╕реБрд░рдХреНрд╖рд╛ рд╣реЛ рдЬрд╛рдПрдЧреАред <br><br>  рдЖрдЗрдП рд╕рд░рд▓рддрдо рд╣реЛрдордЧреНрд░реЛрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕реЗ рд╕рд┐рдЧреНрдорд╛ рдкрд░ рдЬрд╛рдПрдВред  рд╕рдмрд╕реЗ рдмреБрдирд┐рдпрд╛рджреА рдСрдкрд░реЗрд╢рди рдЬреЛ рд╣рдо рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдВрдЬреА рдорд┐рд▓рд╛рди рд╣реИ</a> : рдПрдХ рд╕рдорд╛рд░реЛрд╣ рдЬрд┐рд╕рдореЗрдВ рдЖрдЙрдЯрдкреБрдЯ рджреЛрдиреЛрдВ рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ рд╕рдорд╛рди рдореВрд▓реНрдп рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛ рдЬреЛ рдХрд┐ рдПрдХ рд╕рдордорд┐рдд рдХреБрдВрдЬреА рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╡рд┐рд╡рд░рдг рдореЗрдВ рдЬрд╛рдиреЗ рдХреЗ рдмрд┐рдирд╛: рдкреНрд░рддреНрдпреЗрдХ рдкрдХреНрд╖ рдПрдХ рдкрдВрдЪрд╛рдВрдЧ (рдХреЗрд╡рд▓ рдПрдХ рд╣реА рд╕рддреНрд░ рдХреЗ рднреАрддрд░ рдкреНрд░рдпреБрдХреНрдд) рдХреБрдВрдЬреА рдЬреЛрдбрд╝реА (рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдФрд░ рдирд┐рдЬреА рдХреБрдВрдЬреА) рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдореЗрд▓ рдорд┐рд▓рд╛рдк рд╕рдорд╛рд░реЛрд╣ рдХреЛ рдХреЙрд▓ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдЗрдирдкреБрдЯ рдкрд░ рд╡реЗ рдЕрдкрдиреА рдирд┐рдЬреА рдХреБрдВрдЬреА рдФрд░ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рд╕рдВрдЪрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
 тФВPeerAтФВ тФВPeerBтФВ
 тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
    тФВ рдЗрдбрд╛, рдкреВрдмрд╛ P P
    тФВтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА &gt;&gt; тФВтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА rPrvA, PubA = DHgen () тФВ
    тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ
    тФВ рдЖрдИрдбреАрдмреА, рдкрдмрдмреА P P
    тФВ &lt;тФВ тХСPrvB, PubB = DHgen () тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ
    тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ
    тФАтФАтФАтФАтФР тФАтФАтФАтФАтФР
        Ey PрдХреЗрдп = рдбреАрдПрдЪ (рдкреАрдЖрд░рд╡реАрдП, рдкрдмрдмреА) ey
    &lt;тХЪтХРтХРтХРтХРтХРтХРтХРтХдтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ тХЪтХРтХРтХРтХРтХРтХРтХРтХдтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ
    тФВ тФВ
    тФВ тФВ
</pre><br><br>  рдХреЛрдИ рднреА рдмреАрдЪ рдореЗрдВ рд╣рд╕реНрддрдХреНрд╖реЗрдк рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЛ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕рд╛рде рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ - рдЗрд╕ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░реЛрдВ рдХрд╛ рдХреЛрдИ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдирд╣реАрдВ рд╣реИред  рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд░рд╣рдиреЗ рд╡рд╛рд▓реА рдЪрд╛рдмрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдЬреЛрдбрд╝реЗрдВред <br><br><pre> тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
 тФВPeerAтФВ тФВPeerBтФВ
 тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
    тФВрдЗрдбрд╛, рдкрдм, рд╕рд╛рдЗрди (рд╕рд╛рдЗрдирдкреНрд░рд╡рд╛, (рдкрдм)) тФВ,
    тФВтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА&gt; тФВ тХСSignPrvA, SignPubA = рд▓реЛрдб () тХС
    тФВ тХС тФВPrvA, PubA = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВIdB, PubB, рд╕рд╛рдЗрди (SignPrvB, (PubB)),,
    тФВ &lt;тФВ PSignPrvB, SignPubB = load () тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ
    тФВ тХС rPrvB, PubB = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВ тФВ тФВ
        тФВ тФВverify (SignPubB, ...) ify ify
    &lt;&lt;=Key = DH (PrvA, PubB) тХС тХС
    тФВ тФВ тФВ
    тФВ тФВ
</pre><br><br>  рдРрд╕рд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рддреНрд░ рд╕реЗ рдмрдВрдзрд╛ рдирд╣реАрдВ рд╣реИред  рдРрд╕реЗ рд╕рдВрджреЗрд╢ рдЕрдиреНрдп рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рднреА рдЙрдкрдпреБрдХреНрдд рд╣реИрдВред  рдкреВрд░реЗ рд╕рдВрджрд░реНрдн рдХреЛ рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдм рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣ A рдХреЗ рджреВрд╕рд░реЗ рд╕рдВрджреЗрд╢ рдХреЛ рдЬреЛрдбрд╝рдиреЗ рдХреЗ рд▓рд┐рдП рднреА рдмрд╛рдзреНрдп рдХрд░рддрд╛ рд╣реИред <br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдХреНрдпреЛрдВрдХрд┐, рдЕрдиреНрдпрдерд╛, рд╣рдо IdXXX рдХреЛ рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рдВрджреЗрд╢ рдХреЛ рдПрдХ рдЕрдиреНрдп рдкреНрд░рд╕рд┐рджреНрдз рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдХреА рдХреБрдВрдЬреА рдХреЗ рд╕рд╛рде рдлрд┐рд░ рд╕реЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкреНрд░рддрд┐рдмрд┐рдВрдм рдХреЗ рд╣рдорд▓реЛрдВ</a> рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдХрд┐ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреЗ рддрд╣рдд рддрддреНрд╡ рдЙрдирдХреЗ рдЕрд░реНрде рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рд╣реЛрдВ: рдпрджрд┐ рдХреЛрдИ рд╕рдВрдХреЗрдд (PUBA, PubB) рд╣реИ, рддреЛ B рдХреЛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ (PubB, PubA)ред  рдпрд╣ рдХреНрд░рдордмрджреНрдз рдбреЗрдЯрд╛ рдХреА рд╕рдВрд░рдЪрдирд╛ рдФрд░ рдкреНрд░рд╛рд░реВрдк рдХреЛ рдЪреБрдирдиреЗ рдХреЗ рдорд╣рддреНрд╡ рдХреЛ рднреА рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, ASN.1 DER рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдореЗрдВ рд╕реЗрдЯ рдХреЛ рд╕реЙрд░реНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: SET OF (PUBA, PUBB) SET OF (PUBB, PUBA) рдХреЗ рд╕рдорд╛рди рд╣реЛрдЧрд╛ред <br><br><pre> тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
 тФВPeerAтФВ тФВPeerBтФВ
 тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
    тФВ рдЗрдбрд╛, рдкреВрдмрд╛ P P
    тФВтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА&gt; тФВ тХСSignPrvA, рд╕рд╛рдЗрдирдкреБрдмреНрдмрд╛ = рд▓реЛрдб () load
    тФВ тХС тФВPrvA, PubA = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВIdB, PubB, рд╕рд╛рдЗрди (SignPrvB, (IdB, PUBA, PubB)),,
    тФВ &lt;тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА PSignPrvB, рд╕рд╛рдЗрдирдкрдм = рд▓реЛрдб () load
    тФВ тХС rPrvB, PubB = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВ рд╕рд╛рдЗрди (SignPrvA, (IdA, PubB, PUBA)) P P
    тФА тФА тФВ тФА тФА if&gt; ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify рд╕рд╛рдЗрдирдкрдм, ...) ...
    тФВ v тФВKey = DH (PrvA, PubB) тХС
    тХЪтХРтХР тХЪтХРтХР тФВ тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВ тФВ
</pre><br><br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдо рдЕрднреА рднреА "рд╕рд┐рджреНрдз" рдирд╣реАрдВ рд╣реБрдП рд╣реИрдВ рдХрд┐ рд╣рдордиреЗ рдЗрд╕ рд╕рддреНрд░ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рд╕рд╛рдорд╛рдиреНрдп рдХреБрдВрдЬреА рд╡рд┐рдХрд╕рд┐рдд рдХреА рд╣реИред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЖрдк рдЗрд╕ рдХрджрдо рдХреЗ рдмрд┐рдирд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ - рдкрд╣рд▓рд╛ рдкрд░рд┐рд╡рд╣рди рдХрдиреЗрдХреНрд╢рди рдЕрдорд╛рдиреНрдп рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЬрдм рд╣реИрдВрдбрд╢реЗрдХ рдкреВрд░рд╛ рд╣реЛ рдЬрд╛рдП, рддреЛ рд╣рдореЗрдВ рдпрдХреАрди рд╣реЛрдЧрд╛ рдХрд┐ рд╕рдм рдХреБрдЫ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рд╣рдордд рд╣реИред  рдлрд┐рд▓рд╣рд╛рд▓, рд╣рдорд╛рд░реЗ рд╣рд╛рде рдореЗрдВ ISO / IEC IS 9798-3 рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╣реИред <br><br>  рд╣рдо рдХреБрдВрдЬреА рдкрд░ рд╣реА рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░ рд╕рдХрддреЗ рдереЗред  рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдореЗрдВ рд▓реАрдХ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ (рдмрд┐рдЯреНрд╕-рдкреНрд░рддрд┐-рд╣рд╕реНрддрд╛рдХреНрд╖рд░, рд▓реЗрдХрд┐рди рдЕрднреА рднреА рд▓реАрдХ рд╣реИрдВ)ред  рдЖрдк рдЬреЗрдирд░реЗрдЯ рдХреА рдХреА рд╕реЗ рд╣реИрд╢ рд╕рд╛рдЗрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЬреЗрдирд░реЗрдЯ рдХреА рд╕реЗ рдПрдХ рд╣реИрд╢ рд▓реАрдХ рднреА рдЬреЗрдирд░реЗрд╢рди рдлрдВрдХреНрд╢рди рдкрд░ рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдЕрдЯреИрдХ рдореЗрдВ рд╡реИрд▓реНрдпреВ рдХрд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рд╕рд┐рдЧреНрдорд╛ рдПрдХ рдореИрдХ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдкреНрд░реЗрд╖рдХ рдЖрдИрдбреА рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рддрд╛ рд╣реИред <br><br><pre> тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
 тФВPeerAтФВ тФВPeerBтФВ
 тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
    тФВ рдЗрдбрд╛, рдкреВрдмрд╛ P P
    тФА тФА тФА тФА тФА тФА тФА тФА тФА тФАтФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА рдЭрд╛рдЗрдпреЛрдВ рд╡рд╛рд▓реЗ рдмрд╛рд▓реЛрдВ рд╡рд╛рд▓реА рдХрдЯрд╛рдИ рдХреЗ рд╕рдордп рд╕реЗ рд╣рдЯрдХрд░ рддреИрдпрд╛рд░ рдХрд░реЗрдВред &gt; тХС PSignPrvA, SignPubA = рд▓реЛрдб () тХС
    тФВ тХС тФВPrvA, PubA = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    SignIdB, PubB, рд╕рд╛рдЗрди (SignPrvB, (PUBA, PubB)), MAC (IdB),,
    тФАтФАтФА &lt;тФВ тФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФВ тФАтФВSignPrvB, SignPubB = рд▓реЛрдб () ign
    тФВ тХС rPrvB, PubB = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тХФтХРтХР тХФтХРтХР тФВ тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР
    тФВ рд╕рд╛рдЗрди (SignPrvA, (PubB, PUBA)), рдореИрдХ (IdA) = PrKey = DH (PrvA, PubB) P
    тФА тФА тФА тФА тФА тФА тФА тФА тФА тФАтФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА рдЭрд╛рдЗрдпреЛрдВ рд╡рд╛рд▓реЗ рдмрд╛рд▓реЛрдВ рд╡рд╛рд▓реА рдХрдЯрд╛рдИ рдХреЗ рд╕рдордп рд╕реЗ рд╣рдЯрдХрд░ рддреИрдпрд╛рд░ рдХрд░реЗрдВред &gt; тХС тФВverify (рдХреА, IdB) тХС
    тХС B (verify (SignPubB, ...) тХС
    тХЪтХРтХР тХЪтХРтХР тФВ тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВ тФВ
</pre><br><br>  рдЕрдиреБрдХреВрд▓рди рдХреЗ рд░реВрдк рдореЗрдВ, рдХреБрдЫ рдЕрдкрдиреА рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ (рдЬреЛ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ, рдкреАрдПрдлрдПрд╕ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╣реА рдХрдо рд╣реИ)ред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдордиреЗ рдПрдХ рдХреБрдВрдЬреА рдЬреЛрдбрд╝реА рдмрдирд╛рдИ, рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА, рд▓реЗрдХрд┐рди рдЯреАрд╕реАрдкреА рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рдерд╛ рдпрд╛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗ рдмреАрдЪ рдореЗрдВ рдХрд╣реАрдВ рд╕реЗ рдЯреВрдЯ рдЧрдпрд╛ред  рдпрд╣ рдПрдХ рдирдИ рдЬреЛрдбрд╝реА рдкрд░ рдЦрд░реНрдЪ рдХрд┐рдП рдЧрдП рдПрдиреНрдЯреНрд░рд╛рдкреА рдФрд░ рдкреНрд░реЛрд╕реЗрд╕рд░ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдЦрд░реНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рджрдпрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рддрдерд╛рдХрдерд┐рдд рдХреБрдХреА рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреЗ рд╣реИрдВ - рдПрдХ рдЫрджреНрдо рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдореВрд▓реНрдп рдЬреЛ рдХрд┐ рдкрдВрдЪрд╛рдВрдЧ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рд╕рдВрднрд╛рд╡рд┐рдд рдЖрдХрд╕реНрдорд┐рдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рд╣рдорд▓реЛрдВ рд╕реЗ рдмрдЪрд╛рдПрдЧрд╛ред  рдХреБрдХреА рдФрд░ рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЗ рдмреАрдЪ рдмрд╛рдзреНрдпрдХрд╛рд░реА рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рд╡рд┐рдкрд░реАрдд рдкрдХреНрд╖ рдХреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдХреБрдВрдЬреА рдХреЛ рдЕрдирд╛рд╡рд╢реНрдпрдХ рдХреЗ рд░реВрдк рдореЗрдВ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╕реЗ рд╣рдЯрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre> тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
 тФВPeerAтФВ тФВPeerBтФВ
 тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
    тФВ рдЖрдИрдбреАрдП, рдкрдмрдП, рдХреБрдХреА тХФтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХР P
    тФА тФА тФА тФА тФА тФА тФА тФА тФА тФАтФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА рдЭрд╛рдЗрдпреЛрдВ рд╡рд╛рд▓реЗ рдмрд╛рд▓реЛрдВ рд╡рд╛рд▓реА рдХрдЯрд╛рдИ рдХреЗ рд╕рдордп рд╕реЗ рд╣рдЯрдХрд░ рддреИрдпрд╛рд░ рдХрд░реЗрдВред тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА &gt;&gt; тФВ P SignPrvA, SignPubA = load () тФВ
    тФВ тХС тФВPrvA, PubA = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВIdB, PubB, рдХреБрдХреА, рд╕рд╛рдЗрди (SignPrvB, (рдХреБрдХреА, рдХреБрдХреА, PubB)), MAC (IdB),, тХРтХРтХРтХЧ
    тФАтФАтФА &lt;тФВ тФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФА тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВSignPrvB, SignPubB = рд▓реЛрдб () ign
    тФВ тХС rPrvB, PubB = DHgen () тХС
    тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тХФтХРтХР тХФтХРтХР тФВ тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР тХФтХРтХР
    тФВ рд╕рд╛рдЗрди (SignPrvA, (CookieB, рдХреБрдХреА, PUBA)), MAC (IdA) A =Key = DH (PrvA, PubB) P
    тФАтФВтФА Y ify ify ify ify ify ify ify ify ify рд╡реЗрд░реАрдлрд╛рдИ рдХрд░реЗрдВ (рдХреА, IdB) y
    тХС B (verify (SignPubB, ...) тХС
    тХЪтХРтХР тХЪтХРтХР тФВ тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР тХЪтХРтХР
    тФВ тФВ
</pre><br><br>  рдЕрдВрдд рдореЗрдВ, рд╣рдо рдПрдХ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХ рд╕реЗ рд╣рдорд╛рд░реЗ рд╡рд╛рд░реНрддрд╛рдХрд╛рд░ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛рдУрдВ рдХреА рдЧреЛрдкрдиреАрдпрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, SIGMA рдкрд╣рд▓реА рдмрд╛рд░ рдЕрд▓реНрдкрдХрд╛рд▓рд┐рдХ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХрд╛ рд╕реБрдЭрд╛рд╡ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдХреБрдВрдЬреА рдХрд╛рдо рдХрд░рддреА рд╣реИ, рдЬрд┐рд╕ рдкрд░ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕рд┐рдЧреНрдорд╛ рджреЛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддрд╛ рд╣реИ: <br><br><ul><li>  рд╕рд┐рдЧреНрдорд╛- I - рд╕рдХреНрд░рд┐рдп рд╣рдорд▓реЗ рд╕реЗ рд╕рд░реНрдЬрдХ рдХреА рд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рдирд┐рд╖реНрдХреНрд░рд┐рдп рд▓реЛрдЧреЛрдВ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ: рд╕рд░реНрдЬрдХ рдЙрддреНрддрд░рджрд╛рддрд╛ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдпрджрд┐ рдХреБрдЫ рдлрд┐рдЯ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рдЕрдкрдиреА рдкрд╣рдЪрд╛рди рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИред  рдпрджрд┐ рдЖрдк рдЙрд╕рдХреЗ рд╕рд╛рде рд╕рдХреНрд░рд┐рдп рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдкреНрд░рддрд┐рд╡рд╛рджреА рдЕрдкрдиреА рдкрд╣рдЪрд╛рди рджреЗрддрд╛ рд╣реИред  рдирд┐рд╖реНрдХреНрд░рд┐рдп рдкрд░реНрдпрд╡реЗрдХреНрд╖рдХ рдХреЛ рдХреБрдЫ рднреА рдирд╣реАрдВ рдкрддрд╛ рд╣реЛрдЧрд╛; <br>  рд╕рд┐рдЧреНрдорд╛-рдЖрд░ - рд╕рдХреНрд░рд┐рдп рд╣рдорд▓реЛрдВ рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдХрд░реНрддрд╛ рдХреА рд░рдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ, рд╕рд░реНрдЬрдХ рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╕реЗред  рд╕рдм рдХреБрдЫ рдмрд┐рд▓реНрдХреБрд▓ рд╡рд┐рдкрд░реАрдд рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЪрд╛рд░ рд╣реИрдВрдбрд╢реЗрдХ рд╕рдВрджреЗрд╢ рдкреНрд░рд╕рд╛рд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред <br><br><br>  рд╣рдо SIGMA-I рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рд╕рд░реНрд╡рд░-рдХреНрд▓рд╛рдЗрдВрдЯ рдЪреАрдЬреЛрдВ рд╕реЗ рдЬрд┐рддрдиреА рдЙрдореНрдореАрдж рдХрд░рддреЗ рд╣реИрдВ, рдЙрд╕рдХреЗ рд╕рдорд╛рди рдЪреБрдирддреЗ рд╣реИрдВ: рдХреЗрд╡рд▓ рдПрдХ рдкреНрд░рдорд╛рдгрд┐рдд рд╕рд░реНрд╡рд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИ, рдФрд░ рд╣рд░ рдХреЛрдИ рд╕рд░реНрд╡рд░ рдХреЛ рд╡реИрд╕реЗ рднреА рдЬрд╛рдирддрд╛ рд╣реИред  рд╕рд╛рде рд╣реА рдХрдо рд╣реИрдВрдбрд╢реЗрдХ рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рдХрд╛рд░рдг рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред  рд╣рдо рд╕рднреА рдХреЛ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ рд╕рдВрджреЗрд╢ рднрд╛рдЧ рдХрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдФрд░ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХрд╛ рдЕрдВрддрд┐рдо рд╕рдВрджреЗрд╢ рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рднрд╛рдЧ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╣реЛрддрд╛ рд╣реИ: <br><br><pre> тФМтФАтФАтФАтФАтФАтФР тФМтФАтФАтФАтФАтФАтФР
 тФВPeerAтФВ тФВPeerBтФВ
 тФФтФАтФАтФмтФАтФАтФШ тФФтФАтФАтФмтФАтФАтФШ
    тФВ рдкреВрдмрд╛, рдХреБрдХреА тФВ,
    тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФАтФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА тФА рдо рд╕рдЧрдиреНрд╕рдиреНрд╕ рдХреЗ рд▓рд┐рдпреЗ тФА тФА тФА тФАтФА тФА тФА тФА тФА тФА рдЗрдЧреНрдирд┐рд╢рди рдЗрдЧреНрдирд┐рд╢рди рдЗрдЧреНрдирд┐рд╢рди рдЗрдЧреНрдиреЛрд░ рдЗрдЧреНрдиреЛрд░ рдЗрдЧреНрдиреЛрд░ рдЗрдЧреНрдиреЛрд░, рдЗрдЧреНрдиреЛрд░ ,,,,, рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рд╕рд╛рдЗрди рдЗрди рдХрд░реЗрдВ рд╕рд╛рдЗрди рд▓реЛрдб рд▓реЛрдб рд▓реЛрдб рд▓реЛрдб рд▓реЛрдб рд▓реЛрдб рдХрд░реЗрдВ (рдФрд░ (((((((
    тФВ тХС тФВPrvA, PubA = DHgen () тХС<font></font>
   тФВ тФВ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ<font></font>
   тФВPubB, CookieB, Enc((IdB, sign(SignPrvB, (CookieA, CookieB, PubB)), MAC(IdB))) тФВ тХФтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЧ<font></font>
   тФВ&lt;тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФВ тХСSignPrvB, SignPubB = load()тХС<font></font>
   тФВ тФВ тХСPrvB, PubB = DHgen() тХС<font></font>
   тФВ тФВ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ<font></font>
   тФВ тФВ тХФтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЧ<font></font>
   тФВ Enc((IdA, sign(SignPrvA, (CookieB, CookieA, PubA)), MAC(IdA))) тФВ тХСKey = DH(PrvA, PubB) тХС<font></font>
   тФВтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФА&gt;тФВ тХСverify(Key, IdB) тХС<font></font>
   тФВ тФВ тХСverify(SignPubB, ...)тХС<font></font>
   тФВ тФВ тХЪтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХРтХЭ<font></font>
   тФВ тФВ<font></font>
</pre><br><br><ul><li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">34.10-2012</a>   256- . </li><li>      34.10-2012 VKO. </li><li>   MAC  CMAC.       ,     34.13-2015.        тАФ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> (34.12-2015). </li><li>          .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">-256</a> (34.11-2012 256 ). </li></ul><br><br>        .         .         :   ,  ,  (MAC)   , .         ,    , .     , ,  ?          .   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">KDF</a> (key derivation function).  ,     - : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">HKDF</a>  ,       .  ,    Python   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">hkdf</a> . HKDF   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">HMAC</a> , ,   ,  -.    Python   Wikipedia    .      34.10-2012,   -   -256.         ,      : <br><br><pre> <code class="python hljs">kdf = Hkdf(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, key_session, hash=GOST34112012256) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake1-mac-identity"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake1-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake1-mac"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake2-mac-identity"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake2-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake2-mac"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-initiator-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-initiator-mac"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-responder-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-responder-mac"</span></span>)</code> </pre><br><h2> / </h2><br>     ASN.1         : <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Msg</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Choice)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"text"</span></span>, MsgText()), (<span class="hljs-string"><span class="hljs-string">"handshake0"</span></span>, MsgHandshake0(expl=tag_ctxc(<span class="hljs-number"><span class="hljs-number">0</span></span>))), (<span class="hljs-string"><span class="hljs-string">"handshake1"</span></span>, MsgHandshake1(expl=tag_ctxc(<span class="hljs-number"><span class="hljs-number">1</span></span>))), (<span class="hljs-string"><span class="hljs-string">"handshake2"</span></span>, MsgHandshake2(expl=tag_ctxc(<span class="hljs-number"><span class="hljs-number">2</span></span>))), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgText</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"payload"</span></span>, MsgTextPayload()), (<span class="hljs-string"><span class="hljs-string">"payloadMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgTextPayload</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"nonce"</span></span>, Integer(bounds=(<span class="hljs-number"><span class="hljs-number">0</span></span>, float(<span class="hljs-string"><span class="hljs-string">"+inf"</span></span>)))), (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">1</span></span>, MaxTextLen))), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgHandshake0</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"cookieInitiator"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"pubKeyInitiator"</span></span>, PubKey()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgHandshake1</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"cookieResponder"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"pubKeyResponder"</span></span>, PubKey()), (<span class="hljs-string"><span class="hljs-string">"ukm"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>))), (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString()), (<span class="hljs-string"><span class="hljs-string">"ciphertextMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgHandshake2</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString()), (<span class="hljs-string"><span class="hljs-string">"ciphertextMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandshakeTBE</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"identity"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>))), (<span class="hljs-string"><span class="hljs-string">"signature"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>))), (<span class="hljs-string"><span class="hljs-string">"identityMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandshakeTBS</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"cookieTheir"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"cookieOur"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"pubKeyOur"</span></span>, PubKey()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cookie</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(OctetString)</span></span></span><span class="hljs-class">:</span></span> bounds = (<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PubKey</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(OctetString)</span></span></span><span class="hljs-class">:</span></span> bounds = (<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MAC</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(OctetString)</span></span></span><span class="hljs-class">:</span></span> bounds = (<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>)</code> </pre><br> HandshakeTBS тАФ ,    (to be signed). HandshakeTBE тАФ ,    (to be encrypted).     ukm  MsgHandshake1. 34.10 VKO,      ,   UKM (user keying material) тАФ   . <br><br><h2>     </h2><br>        ,      (  ,     ,       ). <br><br>           ,     -  .    JSON  : <br><br><pre> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"our"</span></span>: { <span class="hljs-string"><span class="hljs-string">"prv"</span></span>: <span class="hljs-string"><span class="hljs-string">"21254cf66c15e0226ef2669ceee46c87b575f37f9000272f408d0c9283355f98"</span></span>, <span class="hljs-string"><span class="hljs-string">"pub"</span></span>: <span class="hljs-string"><span class="hljs-string">"938c87da5c55b27b7f332d91b202dbef2540979d6ceaa4c35f1b5bfca6df47df0bdae0d3d82beac83cec3e353939489d9981b7eb7a3c58b71df2212d556312a1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"their"</span></span>: { <span class="hljs-string"><span class="hljs-string">"alice"</span></span>: <span class="hljs-string"><span class="hljs-string">"d361a59c25d2ca5a05d21f31168609deeec100570ac98f540416778c93b2c7402fd92640731a707ec67b5410a0feae5b78aeec93c4a455a17570a84f2bc21fce"</span></span>, <span class="hljs-string"><span class="hljs-string">"bob"</span></span>: <span class="hljs-string"><span class="hljs-string">"aade1207dd85ecd283272e7b69c078d5fae75b6e141f7649ad21962042d643512c28a2dbdc12c7ba40eb704af920919511180c18f4d17e07d7f5acd49787224a"</span></span> } }</code> </pre><br> our тАФ   ,     . their тАФ      .        JSON : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pygost <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gost3410 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pygost.gost34112012256 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GOST34112012256 CURVE = gost3410.GOST3410Curve( *gost3410.CURVE_PARAMS[<span class="hljs-string"><span class="hljs-string">"GostR3410_2001_CryptoPro_A_ParamSet"</span></span>] ) parser = argparse.ArgumentParser(description=<span class="hljs-string"><span class="hljs-string">"GOSTIM"</span></span>) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--keys-gen"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Generate JSON with our new keypair"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--keys"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"keys.json"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, help=<span class="hljs-string"><span class="hljs-string">"JSON with our and their keys"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--bind"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"::1"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Address to listen on"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--port"</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">6666</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Port to listen on"</span></span>, ) args = parser.parse_args() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args.keys_gen: prv_raw = urandom(<span class="hljs-number"><span class="hljs-number">32</span></span>) pub = gost3410.public_key(CURVE, gost3410.prv_unmarshal(prv_raw)) pub_raw = gost3410.pub_marshal(pub) print(json.dumps({ <span class="hljs-string"><span class="hljs-string">"our"</span></span>: {<span class="hljs-string"><span class="hljs-string">"prv"</span></span>: hexenc(prv_raw), <span class="hljs-string"><span class="hljs-string">"pub"</span></span>: hexenc(pub_raw)}, <span class="hljs-string"><span class="hljs-string">"their"</span></span>: {}, })) exit(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Parse and unmarshal our and their keys {{{ with open(args.keys, "rb") as fd: _keys = json.loads(fd.read().decode("utf-8")) KEY_OUR_SIGN_PRV = gost3410.prv_unmarshal(hexdec(_keys["our"]["prv"])) _pub = hexdec(_keys["our"]["pub"]) KEY_OUR_SIGN_PUB = gost3410.pub_unmarshal(_pub) KEY_OUR_SIGN_PUB_HASH = OctetString(GOST34112012256(_pub).digest()) for peer_name, pub_raw in _keys["their"].items(): _pub = hexdec(pub_raw) KEYS[GOST34112012256(_pub).digest()] = { "name": peer_name, "pub": gost3410.pub_unmarshal(_pub), } # }}}</span></span></code> </pre><br>   34.10  тАФ  .  256-  256-  . PyGOST     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> ,     (urandom(32))    ,  gost3410.prv_unmarshal().      ,  gost3410.public_key().   34.10 тАФ   ,            ,  gost3410.pub_marshal(). <br><br>   JSON ,  , ,   ,  gost3410.pub_unmarshal().             ,              . -256   gost34112012256.GOST34112012256(),   hashlib  -. <br><br>    ? ,    :  cookie (128-  ),    34.10,     VKO   . <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">395</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initiator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host, port)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">396</span></span> _id = repr((host, port)) <span class="hljs-number"><span class="hljs-number">397</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: dialing"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">398</span></span> reader, writer = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.open_connection(host, port) <span class="hljs-number"><span class="hljs-number">399</span></span> <span class="hljs-comment"><span class="hljs-comment"># Generate our ephemeral public key and cookie, send Handshake 0 message {{{ 400 cookie_our = Cookie(urandom(16)) 401 prv = gost3410.prv_unmarshal(urandom(32)) 402 pub_our = gost3410.public_key(CURVE, prv) 403 pub_our_raw = PubKey(gost3410.pub_marshal(pub_our)) 404 writer.write(Msg(("handshake0", MsgHandshake0(( 405 ("cookieInitiator", cookie_our), 406 ("pubKeyInitiator", pub_our_raw), 407 )))).encode()) 408 # }}} 409 await writer.drain()</span></span></code> </pre><br><ul><li>      Msg ; </li><li>    handshake1; </li><li>          ; </li><li>       TBE  . </li></ul><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">423</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: got %s message"</span></span>, _id, msg.choice) <span class="hljs-number"><span class="hljs-number">424</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> msg.choice != <span class="hljs-string"><span class="hljs-string">"handshake1"</span></span>: <span class="hljs-number"><span class="hljs-number">425</span></span> logging.warning(<span class="hljs-string"><span class="hljs-string">"%s: unexpected message, disconnecting"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">426</span></span> writer.close() <span class="hljs-number"><span class="hljs-number">427</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">428</span></span> <span class="hljs-comment"><span class="hljs-comment"># }}} 429 msg_handshake1 = msg.value 430 # Validate Handshake message {{{ 431 cookie_their = msg_handshake1["cookieResponder"] 432 pub_their_raw = msg_handshake1["pubKeyResponder"] 433 pub_their = gost3410.pub_unmarshal(bytes(pub_their_raw)) 434 ukm_raw = bytes(msg_handshake1["ukm"]) 435 ukm = ukm_unmarshal(ukm_raw) 436 key_session = kek_34102012256(CURVE, prv, pub_their, ukm, mode=2001) 437 kdf = Hkdf(None, key_session, hash=GOST34112012256) 438 key_handshake1_mac_identity = kdf.expand(b"handshake1-mac-identity") 439 key_handshake1_enc = kdf.expand(b"handshake1-enc") 440 key_handshake1_mac = kdf.expand(b"handshake1-mac")</span></span></code> </pre><br> UKM  64-  (urandom(8)),       ,  gost3410_vko.ukm_unmarshal(). VKO   34.10-2012 256-  gost3410_vko.kek_34102012256() (KEK тАФ key encryption key). <br><br>      256-   .        HKDF .   GOST34112012256  hashlib ,        Hkdf .  (  Hkdf)   ,     -               . kdf.expand()       256-,     . <br><br>   TBE  TBS   : <br><br><ul><li>    MAC   ; </li><li>  ; </li><li>  TBE ; </li><li>            ; </li><li>    MAC   ; </li><li>    TBS ,    cookie        .      . </li></ul><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">441</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">442</span></span> peer_name = validate_tbe( <span class="hljs-number"><span class="hljs-number">443</span></span> msg_handshake1, <span class="hljs-number"><span class="hljs-number">444</span></span> key_handshake1_mac_identity, <span class="hljs-number"><span class="hljs-number">445</span></span> key_handshake1_enc, <span class="hljs-number"><span class="hljs-number">446</span></span> key_handshake1_mac, <span class="hljs-number"><span class="hljs-number">447</span></span> cookie_our, <span class="hljs-number"><span class="hljs-number">448</span></span> cookie_their, <span class="hljs-number"><span class="hljs-number">449</span></span> pub_their_raw, <span class="hljs-number"><span class="hljs-number">450</span></span> ) <span class="hljs-number"><span class="hljs-number">451</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> err: <span class="hljs-number"><span class="hljs-number">452</span></span> logging.warning(<span class="hljs-string"><span class="hljs-string">"%s: %s, disconnecting"</span></span>, _id, err) <span class="hljs-number"><span class="hljs-number">453</span></span> writer.close() <span class="hljs-number"><span class="hljs-number">454</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">455</span></span> <span class="hljs-comment"><span class="hljs-comment"># }}} 128 def validate_tbe( 129 msg_handshake: Union[MsgHandshake1, MsgHandshake2], 130 key_mac_identity: bytes, 131 key_enc: bytes, 132 key_mac: bytes, 133 cookie_their: Cookie, 134 cookie_our: Cookie, 135 pub_key_our: PubKey, 136 ) -&gt; str: 137 ciphertext = bytes(msg_handshake["ciphertext"]) 138 mac_tag = mac(GOST3412Kuznechik(key_mac).encrypt, KUZNECHIK_BLOCKSIZE, ciphertext) 139 if not compare_digest(mac_tag, bytes(msg_handshake["ciphertextMac"])): 140 raise ValueError("invalid MAC") 141 plaintext = ctr( 142 GOST3412Kuznechik(key_enc).encrypt, 143 KUZNECHIK_BLOCKSIZE, 144 ciphertext, 145 8 * b"\x00", 146 ) 147 try: 148 tbe, _ = HandshakeTBE().decode(plaintext) 149 except ASN1Error: 150 raise ValueError("can not decode TBE") 151 key_sign_pub_hash = bytes(tbe["identity"]) 152 peer = KEYS.get(key_sign_pub_hash) 153 if peer is None: 154 raise ValueError("unknown identity") 155 mac_tag = mac( 156 GOST3412Kuznechik(key_mac_identity).encrypt, 157 KUZNECHIK_BLOCKSIZE, 158 key_sign_pub_hash, 159 ) 160 if not compare_digest(mac_tag, bytes(tbe["identityMac"])): 161 raise ValueError("invalid identity MAC") 162 tbs = HandshakeTBS(( 163 ("cookieTheir", cookie_their), 164 ("cookieOur", cookie_our), 165 ("pubKeyOur", pub_key_our), 166 )) 167 if not gost3410.verify( 168 CURVE, 169 peer["pub"], 170 GOST34112012256(tbs.encode()).digest(), 171 bytes(tbe["signature"]), 172 ): 173 raise ValueError("invalid signature") 174 return peer["name"]</span></span></code> </pre><br>    , 34.13-2015   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">   </a>  34.12-2015.      ,  MAC-.  PyGOST  gost3413.mac().       (     ),   , ,  .   hardcode-  ? 34.12-2015    128-  ,    64- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> тАФ    28147-89,               . <br><br>   gost.3412.GOST3412Kuznechik(key)      .encrypt()/.decrypt() ,     34.13 . MAC   : gost3413.mac(GOST3412Kuznechik(key).encrypt, KUZNECHIK_BLOCKSIZE, ciphertext).      MAC-     (==)  ,        , ,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">BEAST</a>   TLS.  Python   hmac.compare_digest   . <br><br>         .   ,      ,    .  34.13-2015  : ECB, CTR, OFB, CBC, CFB.        .   ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">  </a> ( CCM, OCB, GCM  ) тАФ       MAC.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> (CTR):       ,  ,    ,          (   CBC,      ). <br><br>   .mac(), .ctr()     : ciphertext = gost3413.ctr(GOST3412Kuznechik(key).encrypt, KUZNECHIK_BLOCKSIZE, plaintext, iv).    ,     .           (    ),      .   handshake        . <br><br>   gost3410.verify() :        (      GOSTIM ),    ( ,         ,    ), 34.11-2012     . <br><br> ,       handshake2  ,           ,  :      ,  .тАж <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">456</span></span> <span class="hljs-comment"><span class="hljs-comment"># Prepare and send Handshake 2 message {{{ 457 tbs = HandshakeTBS(( 458 ("cookieTheir", cookie_their), 459 ("cookieOur", cookie_our), 460 ("pubKeyOur", pub_our_raw), 461 )) 462 signature = gost3410.sign( 463 CURVE, 464 KEY_OUR_SIGN_PRV, 465 GOST34112012256(tbs.encode()).digest(), 466 ) 467 key_handshake2_mac_identity = kdf.expand(b"handshake2-mac-identity") 468 mac_tag = mac( 469 GOST3412Kuznechik(key_handshake2_mac_identity).encrypt, 470 KUZNECHIK_BLOCKSIZE, 471 bytes(KEY_OUR_SIGN_PUB_HASH), 472 ) 473 tbe = HandshakeTBE(( 474 ("identity", KEY_OUR_SIGN_PUB_HASH), 475 ("signature", OctetString(signature)), 476 ("identityMac", MAC(mac_tag)), 477 )) 478 tbe_raw = tbe.encode() 479 key_handshake2_enc = kdf.expand(b"handshake2-enc") 480 key_handshake2_mac = kdf.expand(b"handshake2-mac") 481 ciphertext = ctr( 482 GOST3412Kuznechik(key_handshake2_enc).encrypt, 483 KUZNECHIK_BLOCKSIZE, 484 tbe_raw, 485 8 * b"\x00", 486 ) 487 mac_tag = mac( 488 GOST3412Kuznechik(key_handshake2_mac).encrypt, 489 KUZNECHIK_BLOCKSIZE, 490 ciphertext, 491 ) 492 writer.write(Msg(("handshake2", MsgHandshake2(( 493 ("ciphertext", OctetString(ciphertext)), 494 ("ciphertextMac", MAC(mac_tag)), 495 )))).encode()) 496 # }}} 497 await writer.drain() 498 logging.info("%s: session established: %s", _id, peer_name)</span></span></code> </pre><br>   ,     (   ,  ,    ),       MAC-: <br><br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">499</span></span> <span class="hljs-comment"><span class="hljs-comment"># Run text message sender, initialize transport decoder {{{ 500 key_initiator_enc = kdf.expand(b"transport-initiator-enc") 501 key_initiator_mac = kdf.expand(b"transport-initiator-mac") 502 key_responder_enc = kdf.expand(b"transport-responder-enc") 503 key_responder_mac = kdf.expand(b"transport-responder-mac") ... 509 asyncio.ensure_future(msg_sender( 510 peer_name, 511 key_initiator_enc, 512 key_initiator_mac, 513 writer, 514 )) 515 encrypter = GOST3412Kuznechik(key_responder_enc).encrypt 516 macer = GOST3412Kuznechik(key_responder_mac).encrypt 517 # }}} 519 nonce_expected = 0 520 # Wait for test messages {{{ 521 while True: 522 data = await reader.read(MaxMsgLen) ... 530 msg, tail = Msg().decode(buf) ... 537 try: 538 await msg_receiver( 539 msg.value, 540 nonce_expected, 541 macer, 542 encrypter, 543 peer_name, 544 ) 545 except ValueError as err: 546 logging.warning("%s: %s", err) 547 break 548 nonce_expected += 1 549 # }}}</span></span></code> </pre><br> msg_sender    ,    TCP-.      nonce,          .           . <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_sender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(peer_name: str, key_enc: bytes, key_mac: bytes, writer)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> nonce = <span class="hljs-number"><span class="hljs-number">0</span></span> encrypter = GOST3412Kuznechik(key_enc).encrypt macer = GOST3412Kuznechik(key_mac).encrypt in_queue = IN_QUEUES[peer_name] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> in_queue.get() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> ciphertext = ctr( encrypter, KUZNECHIK_BLOCKSIZE, text.encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>), long2bytes(nonce, <span class="hljs-number"><span class="hljs-number">8</span></span>), ) payload = MsgTextPayload(( (<span class="hljs-string"><span class="hljs-string">"nonce"</span></span>, Integer(nonce)), (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString(ciphertext)), )) mac_tag = mac(macer, KUZNECHIK_BLOCKSIZE, payload.encode()) writer.write(Msg((<span class="hljs-string"><span class="hljs-string">"text"</span></span>, MsgText(( (<span class="hljs-string"><span class="hljs-string">"payload"</span></span>, payload), (<span class="hljs-string"><span class="hljs-string">"payloadMac"</span></span>, MAC(mac_tag)), )))).encode()) nonce += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>     msg_receiver,    : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_receiver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( msg_text: MsgText, nonce_expected: int, macer, encrypter, peer_name: str, )</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> payload = msg_text[<span class="hljs-string"><span class="hljs-string">"payload"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(payload[<span class="hljs-string"><span class="hljs-string">"nonce"</span></span>]) != nonce_expected: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">"unexpected nonce value"</span></span>) mac_tag = mac(macer, KUZNECHIK_BLOCKSIZE, payload.encode()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> compare_digest(mac_tag, bytes(msg_text[<span class="hljs-string"><span class="hljs-string">"payloadMac"</span></span>])): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">"invalid MAC"</span></span>) plaintext = ctr( encrypter, KUZNECHIK_BLOCKSIZE, bytes(payload[<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>]), long2bytes(nonce_expected, <span class="hljs-number"><span class="hljs-number">8</span></span>), ) text = plaintext.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> OUT_QUEUES[peer_name].put(text)</code> </pre><br><h2>  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br> GOSTIM       (    ,  )!      <a href=""></a> (-256 : 995bbd368c04e50a481d138c5fa2e43ec7c89bc77743ba8dbabee1fde45de120).     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GoGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">PyDERASN</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">NNCP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GoVPN</a> , GOSTIM   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GPLv3+</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="></a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> </a> , Python/Go-,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="> ┬л тАЮтАЬ</a> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi452200/">https://habr.com/ru/post/hi452200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi452186/index.html">рд╕рдмрд╕реЗ рджреБрд░реНрд▓рдн рдФрд░ рд╕рдмрд╕реЗ рдорд╣рдВрдЧреА рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛рдПрдВ</a></li>
<li><a href="../hi452188/index.html">рд╕реНрдкреНрд░рд┐рдВрдЧ рдмреВрдЯ рдореЗрдВ рдЬрд╕рди рдХреНрд░рдорд╛рдВрдХрди рдЗрдХрд╛рдИ рдкрд░реАрдХреНрд╖рдг</a></li>
<li><a href="../hi452190/index.html">WebAssembly 20x рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рддреНрд╡рд░рд┐рдд</a></li>
<li><a href="../hi452192/index.html">рдпрд╣ рдпрд╣рд╛рдБ рдХреНрдпрд╛ рд╣реИ? рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╡рд╕реНрддреБрдУрдВ рдХрд╛ рдЖрдВрддрд░рд┐рдХ рд╕рдВрдЪрд╛рд▓рди</a></li>
<li><a href="../hi452198/index.html">рд╕реЗрд▓реЗрдирд┐рдпрдо 4 рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рдХреНрдпреВрдП рдЗрдВрдЬреАрдирд┐рдпрд░ рдХреЛ рдХреНрдпрд╛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП?</a></li>
<li><a href="../hi452202/index.html">рд╕реНрдкреНрд░рд┐рдВрдЯ рд╕рдореАрдХреНрд╖рд╛: рдиреАрдЪреЗ - рдиреАрдЪреЗ</a></li>
<li><a href="../hi452204/index.html">рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдЕрдкрдирд╛ рдкрд╣рд▓рд╛ AI рд▓рд┐рдЦрд╛ рд╣реИ</a></li>
<li><a href="../hi452206/index.html">рдИ - рдкреНрд░рдпреЛрдЧред рдпрд╛ рд╡рд┐рдЬреНрдЮрд╛рди рдХреИрд╕реЗ рдбрд┐рдЬрд╝рд╛рдЗрди рдЗрдВрдЯрд░рдлреЗрд╕ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ</a></li>
<li><a href="../hi452210/index.html">рдПрдХ рдШрдВрдЯреЗ рдореЗрдВ MySQL рдХреЗ рд╕рд╛рде рдкрд╛рдпрдерди рдкрд░ рд╡реАрдХреЗ рдХреЗ рд▓рд┐рдП рдмреЙрдЯ, рднрд╛рдЧ 2</a></li>
<li><a href="../hi452212/index.html">рдЕрдкрдиреЗ рд╕реНрдЯрд╛рд░реНрдЯрдЕрдк рдХреЗ рд╕рд╛рде рдпреВрдПрд╕рдП рдХреИрд╕реЗ рдЬрд╛рдПрдВ: 3 рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡реАрдЬрд╛ рд╡рд┐рдХрд▓реНрдк, рдЙрдирдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ рдФрд░ рдЖрдВрдХрдбрд╝реЗ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>