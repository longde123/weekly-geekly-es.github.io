<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ø ü§úüèΩ üôçüèª La lutte pour les ressources, partie 3: il y a peu de m√©moire ü§±üèø ‚ö∞Ô∏è üï£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous continuons d'√©tudier les groupes de contr√¥le (Cgroups) dans Red Hat Enterprise Linux 7. Prenons soin de la m√©moire. Vous vous souvenez qu'il y a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La lutte pour les ressources, partie 3: il y a peu de m√©moire</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/425803/">  Nous continuons d'√©tudier les groupes de contr√¥le (Cgroups) dans Red Hat Enterprise Linux 7. Prenons soin de la m√©moire.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vous vous souvenez</a> qu'il y a deux ajustements √† l'allocation du temps processeur: CPUShares pour d√©finir les partages relatifs et CPUQuota afin de limiter l'utilisateur, le service ou la machine virtuelle (VM) en valeurs absolues (pourcentage) du temps processeur.  De plus, ces deux r√©glages peuvent √™tre utilis√©s simultan√©ment.  Par exemple, si un utilisateur a un quota CPU de 50%, sa boule CPU sera √©galement prise en compte jusqu'√† ce qu'il s√©lectionne compl√®tement son quota √† 50% du temps processeur. <br><br><img src="https://habrastorage.org/webt/to/-f/1d/to-f1denfarqdbt2kwl5nc4rdh8.png" width="100%"><br><br>  Quant √† la RAM, systemd n'offre qu'une seule fa√ßon de r√©gler, √† savoir ... <br><a name="habracut"></a><br>  Quantit√© de m√©moire pouvant √™tre allou√©e √† un utilisateur ou √† un service.  Supposons que nous voulions limiter l'utilisateur mrichter √† 200 Mo de RAM.  Si vous vous souvenez, son UID est 1000, nous entrons donc la commande suivante: <br><br><pre>  systemctl set-property user-1000.slice MemoryLimit = 200M
</pre><br>  Maintenant, mrichter veut v√©rifier ses limites et lance l'utilitaire de test de stress stress, qui commence √† consommer intens√©ment la m√©moire.  Et le stress produit tr√®s rapidement une erreur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w3/ab/6n/w3ab6njy6vlrp2o6vuc0phtp_gw.png"></div><br>  Selon le journal syst√®me, le stress a √©t√© simplement interrompu par OOM (Out Of Memory) Killer. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l4/8-/2z/l48-2zrd_rt7-rpflbdz8zbxvni.png"></div><br>  Ici, il est important de faire attention √† cela: par d√©faut, la limite de RAM ne s'applique qu'√† la m√©moire r√©sidente.  Autrement dit, si le processus peut aller dans le fichier d'√©change (¬´√©change¬ª), il contournera la limite √©tablie.  Dans notre exemple, le stress s'est √©cras√© car il d√©passait la limite de m√©moire r√©sidente. <br><br>  Et si nous ne voulons pas que le programme fusionne en un √©change? <br><br>  Ceci, en g√©n√©ral, est facile √† interdire.  Eh bien, ou relativement facile ... En g√©n√©ral, il faut grimper quelque part. <br><br>  Il existe des param√®tres de groupe de contr√¥le qui ne sont pas accessibles via la commande systemctl ou via les fichiers d'unit√©.  Cependant, ces param√®tres peuvent √™tre modifi√©s √† la vol√©e dans les fichiers du dossier / sys / fs / cgroup /.  Voici √† quoi ressemble, par exemple, crich de l'utilisateur mrichter en m√©moire: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8g/m-/wa/8gm-waijbkzwa9kwk7powehhy-i.png"></div><br>  Le fichier responsable de la quantit√© de m√©moire pouvant aller dans le swap est √©videmment appel√© memory.swappiness.  Voyons ce qu'il y a dedans: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_j/5y/qj/_j5yqjouurqozrx8pkghqmgoll0.png"></div><br>  S'il vous arrive de jouer avec les param√®tres du noyau et le sous-syst√®me swap, vous verrez imm√©diatement la valeur par d√©faut standard pour le param√®tre swappiness ici.  Si vous le changez √† z√©ro, le contr√¥leur RAM de l'utilisateur mrichter lui interdit g√©n√©ralement d'utiliser un swap. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pl/uc/jd/plucjdxbkz2-j42mjxgjgztmsou.png"></div><br>  Au fait, ici, vous pouvez consulter les statistiques de m√©moire de l'utilisateur mrichter: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lj/5l/jv/lj5ljvwkcsemooltny485dwuzn0.png"></div><br>  La valeur du param√®tre hierarchical_memory_limit est le m√™me MemoryLimit que nous avons sp√©cifi√© avec la commande systemctl.  Le param√®tre hierarchical_memsw_limit repr√©sente la limite totale (m√©moire r√©sidente et m√©moire dans le fichier du fichier).  Nous avons emp√™ch√© l'utilisateur mrichter d'utiliser le fichier d'√©change, donc la valeur de ce param√®tre est tellement bizarre. <br><br>  Passons maintenant aux probl√®mes de l'approche qui vient d'√™tre d√©crite: <br><br><ul><li>  Vous ne pouvez apporter des modifications √† ces fichiers que lorsque l'utilisateur mrichter s'est connect√© au syst√®me.  Jusqu'√† ce qu'il se connecte, son groupe de contr√¥le sera inactif. </li><li>  Ces param√®tres ne sont pas enregistr√©s apr√®s un red√©marrage.  De plus, ils seront perdus si le mrichter se d√©place. </li></ul><br>  Le script pam_exec aidera √† faire face √† ces probl√®mes (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">access.redhat.com/solutions/46199 pour plus de d√©tails</a> ). <br><br>  Voici le script que nous allons cr√©er dans le dossier / usr / local / bin: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5x/o5/1i/5xo51ipwnvn-yp0ydserzgmbasy.png"></div><br>  Et puis ajoutez son appel √† la derni√®re ligne de /etc/pam.d/sshd.  Par cons√©quent, ce script sera ex√©cut√© √† chaque fois qu'un utilisateur se connecte via ssh.  C'est pourquoi nous v√©rifions dans le script qu'il s'agit bien de l'utilisateur mrichter, avant de modifier les param√®tres. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/wg/wb/eewgwb827xdg7xgznxg5gjsq8ke.png"></div><br>  Nous avons donc coup√© l'utilisateur mrichter du fichier d'√©change. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/00/m9/yr/00m9yr10virvxpqpahoypamb3le.png"></div><br>  Bien s√ªr, vous pouvez aller encore plus loin et modifier les fichiers de configuration du groupe de contr√¥le actif √† la vol√©e, mais pour l'instant nous allons reporter cette entreprise risqu√©e.  Cependant, la m√©thode g√©n√©rale de modification des param√®tres utilisateur est quelque chose que vous avez d√©tect√©. <br><br>  Et avec les services, c'est encore plus simple.  Dans le fichier d'unit√© de service, vous pouvez utiliser la directive ExecStartPost = pour ex√©cuter un script qui modifie les param√®tres.  Par exemple, voici comment modifier le fichier d'unit√© de service foo pour d√©sactiver l'√©change: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j4/fj/83/j4fj835spqzxr6tkqcpf4fsgeti.png"></div><br>  Ex√©cutez foo - et pas d'√©change: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rx/ur/wz/rxurwz1hv22-9lqm8xurnndsoe8.png"></div><br>  Eh bien, pour aujourd'hui, peut-√™tre, ce chamanisme nous suffit. <br><br>  Mais avant de terminer, nous allons nous attarder sur la documentation de cgroup, o√π vous pouvez trouver des informations sur tous ces param√®tres de r√©gulateur cach√©s.  Vous pouvez installer le paquetage kernel-doc sur votre ordinateur, comme je l'ai fait en le t√©l√©chargeant depuis le d√©p√¥t rhel-7-server-rpms. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yt/3l/3r/yt3l3rwjdwq8bpcyenphk36211w.png"></div><br>  Apr√®s l'installation, ouvrez le dossier / usr / share / docs qui correspond √† votre noyau et acc√©dez au dossier cgroups, qui contient les derni√®res informations sur tous les r√©gulateurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zr/qq/-w/zrqq-wt3yrgsjf2aj4w4habrm6m.png"></div><br>  La prochaine fois, nous parlerons d'E / S.  Et en passant, nous avons presque d√©couvert comment les cgroups ont conduit √† l'√©mergence de conteneurs (en fait, les cgroups sont un composant cl√© des conteneurs dans Red Hat Enterprise Linux et Red Hat OpenShift Container Platform). <br><br><ul><li>  Partie 1 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/423051</a> </li><li>  Partie 2 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/424367</a> </li><li>  Partie 4 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/427413</a> </li><li>  Partie 5 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/429064</a> </li><li>  Partie 6 - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">habr.com/company/redhatrussia/blog/430748</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr425803/">https://habr.com/ru/post/fr425803/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr425787/index.html">Rencontrez des gens qui utilisent des ordinateurs h√©rit√©s</a></li>
<li><a href="../fr425791/index.html">Conf√©rence DEFCON 20. Comment baiser les m√©chants (et la mafia) en utilisant le botnet JavaScript. 2e partie</a></li>
<li><a href="../fr425793/index.html">Alice paiera plus d'un million de roubles avant la fin de l'ann√©e. Nouveau concours et recommandations de Yandex pour les d√©veloppeurs de comp√©tences</a></li>
<li><a href="../fr425799/index.html">Comment prendre et voir les assemblys .NET dans SQL Server √† l'aide de ICSharpCode.Decompiler</a></li>
<li><a href="../fr425801/index.html">Imagerie spatiale, sports a√©riens, livraison de caf√© - comment combiner l'amour du ciel avec l'informatique</a></li>
<li><a href="../fr425805/index.html">DevOops 2018: streaming en ligne gratuit, f√™te et plus</a></li>
<li><a href="../fr425807/index.html">Complexit√© des syst√®mes et m√©thodes de ¬´lutte¬ª avec elle</a></li>
<li><a href="../fr425809/index.html">Apprentissage des langages de programmation dans le processus: d√©veloppeur de logiciels sur des projets complexes</a></li>
<li><a href="../fr425811/index.html">Un autre probl√®me d'affichage du MacBook Pro</a></li>
<li><a href="../fr425813/index.html">CICD: d√©ploiement transparent sur des syst√®mes de cluster distribu√©s sans temps d'arr√™t</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>