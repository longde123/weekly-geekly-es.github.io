<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèø üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üîÆ Precios din√°micos, o c√≥mo Yandex.Taxi predice una alta demanda üòû ‚õ¥Ô∏è üíÉüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anteriormente, para llamar a un taxi, ten√≠an que llamar a diferentes n√∫meros de servicios de despacho y esperar a que se entregara el autom√≥vil durant...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Precios din√°micos, o c√≥mo Yandex.Taxi predice una alta demanda</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/429226/"><img src="https://habrastorage.org/webt/6p/yq/tr/6pyqtrc3l2zveuaglelsme4xphg.png"><br><br>  Anteriormente, para llamar a un taxi, ten√≠an que llamar a diferentes n√∫meros de servicios de despacho y esperar a que se entregara el autom√≥vil durante media hora o m√°s.  Ahora los servicios de taxi est√°n bien automatizados, y el tiempo promedio para la entrega de autom√≥viles Yandex.Taxi en Mosc√∫ es de aproximadamente 3-4 minutos.  Pero vale la pena llover o terminar un evento masivo, y nuevamente podemos encontrar una escasez de autos gratis. <br><br>  Mi nombre es Anton Skogorev, encabezo el grupo de desarrollo de rendimiento de la plataforma Yandex.Taxi.  Hoy les contar√© a los lectores de Habr c√≥mo aprendimos a predecir la alta demanda y, adem√°s, a atraer conductores para que los usuarios puedan encontrar un autom√≥vil gratis en cualquier momento.  Aprender√° c√≥mo se forma un coeficiente que afecta el valor del pedido.  Todo lo que hay lejos de ser tan simple como parece a primera vista. <br><br><a name="habracut"></a><br><h3>  Desaf√≠o din√°mico de precios </h3><br>  La tarea m√°s importante de los precios din√°micos es brindar siempre la oportunidad de pedir un taxi.  Se logra utilizando el coeficiente de aumento de precios, por el cual se multiplica el precio calculado.  Lo llamamos simplemente aumento.  Es importante decir que el aumento no solo regula la demanda de taxis, sino que tambi√©n ayuda a atraer nuevos conductores para aumentar la oferta. <br><br>  Si el aumento es demasiado grande, reduciremos la demanda demasiado, habr√° un exceso de autos gratis.  Si se configura demasiado bajo, los usuarios ver√°n "no hay autos gratis".  Debe poder elegir un coeficiente en el que caminemos sobre hielo delgado entre la falta de autom√≥viles gratuitos y la baja demanda. <br><br>  ¬øDe qu√© deber√≠a depender este coeficiente?  Inmediatamente me viene a la mente la dependencia de la cantidad de autos y pedidos alrededor del usuario.  Ahora puede simplemente dividir el n√∫mero de pedidos por el n√∫mero de controladores, obtener el coeficiente y convertirlo en nuestro aumento con alguna f√≥rmula (posiblemente lineal). <br><br>  Pero hay un peque√±o problema en esta tarea: puede ser demasiado tarde para contar los pedidos alrededor del usuario.  Despu√©s de todo, un pedido es casi siempre una m√°quina ya ocupada, lo que significa que un aumento en nuestro coeficiente siempre llegar√° tarde.  Por lo tanto, consideramos √≥rdenes no creadas, sino <b>intenciones de</b> ordenar un autom√≥vil.  Un pin es una etiqueta "A" en una tarjeta que un usuario coloca al iniciar nuestra aplicaci√≥n. <br><br><img src="https://habrastorage.org/webt/8t/du/0a/8tdu0aql7pjzmgqgqerbnso7zuw.png"><br><br>  Formulemos el problema: necesitamos leer los valores <b>instant√°neos</b> de m√°quinas y pines en alg√∫n punto del usuario. <br><br><h3>  Contamos el n√∫mero de pines y autos alrededor </h3><br>  Cuando cambia la posici√≥n del pin (el usuario selecciona el punto "A"), la aplicaci√≥n del usuario env√≠a nuevas coordenadas y una peque√±a hoja de informaci√≥n adicional al backend, lo que ayuda a evaluar el pin con mayor precisi√≥n (por ejemplo, la tarifa seleccionada). <br><br>  Intentamos adherirnos a la arquitectura del microservicio, donde cada microservicio se dedica a tareas separadas.  El microservicio de cirug√≠a se dedica al c√°lculo de la sobretensi√≥n.  Registra los pines, los guarda en la base de datos y tambi√©n actualiza la pepita de los pines en la RAM, en la que encajan bastante bien.  El retraso de la cach√© durante dicho trabajo es de solo unos segundos, lo cual es aceptable en nuestro caso. <br><br><div class="spoiler">  <b class="spoiler_title">Algunas palabras sobre la base de datos</b> <div class="spoiler_text">  Al registrarse, cada pin se agrega de forma as√≠ncrona a MongoDb con el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">√çndice TTL</a> , donde TTL es la "vida √∫til" del pin, en el que lo consideramos activo para calcular el coeficiente de aumento.  El usuario no espera mientras realizamos estas acciones.  Incluso si algo sale mal, perder un alfiler no es una gran tragedia. <br><br><img src="https://habrastorage.org/webt/7g/u0/f6/7gu0f6uercnenpw3c4h2xyu4tls.jpeg"><br></div></div><br>  Se construye una cach√© activa con un √≠ndice <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">geo-hash</a> .  Agrupamos todos los pines por geohash, y luego recogemos los pines para el radio deseado alrededor del punto de orden. <br><br>  Hacemos lo mismo con los autom√≥viles, pero en otro servicio llamado Rastreador, al que Surger responde simplemente con la pregunta "cu√°ntos conductores hay en este radio". <br><br>  Entonces consideramos los valores instant√°neos del coeficiente. <br><br><img src="https://habrastorage.org/webt/mi/r7/y7/mir7y77n8i0b_dh8-w9vaxtex9k.jpeg"><br><br><h3>  Almacenamiento en cach√© </h3><br>  <b>Caso</b> : est√°s parado en el Garden Ring en Mosc√∫ y quieres reservar un auto.  Al mismo tiempo, el precio sube con bastante frecuencia y esto es molesto. <br><br>  Ya conociendo la mec√°nica, uno puede entender que esto puede deberse al hecho de que los conductores se acumulan en un sem√°foro condicional al momento de la solicitud de sobretensi√≥n y tambi√©n se van r√°pidamente.  Debido a esto, el aumento y el precio pueden notablemente "saltar". <br><br>  Para evitar esto, almacenamos en cach√© el valor del aumento por usuario.  Cuando un usuario acude a una sobretensi√≥n, observamos si hay un valor de sobretensi√≥n guardado para este usuario en un radio aceptable (un recorrido lineal de todas las sobretensiones guardadas del usuario).  Si lo hay, lo devolvemos, de lo contrario, contamos con uno nuevo y tambi√©n lo guardamos. <br><br>  Esto funcion√≥ bien, pero hay otras situaciones. <br><br>  <b>Caso</b> : 2 usuarios solicitan oleada.  Uno ordena 30 segundos m√°s tarde que el otro cuando los autom√≥viles de un sem√°foro de un caso anterior ya se han ido.  Obtenemos una imagen donde 2 usuarios que ordenan casi simult√°neamente pueden tener oleadas notablemente diferentes. <br><br>  Y aqu√≠ vamos de cach√© por usuario a cach√© por posici√≥n.  Ahora, en lugar de almacenar en cach√© el valor de aumento solo por el usuario, comenzamos a almacenarlo por el geo-hash que ya conocemos.  As√≠ que casi arreglamos el problema.  ¬øPor qu√© casi?  Porque puede haber diferencias en los bordes de las geoheshes.  Pero el problema no es tan significativo, porque tenemos suavizado. <br><br><h3>  Suavizado </h3><br>  Quiz√°s, al leer un caso sobre un sem√°foro, se le ocurri√≥ que de alguna manera era injusto considerar un aumento instant√°neo, dependiendo del sem√°foro.  Tambi√©n creemos que s√≠, as√≠ que descubrimos c√≥mo solucionar la situaci√≥n. <br><br>  Decidimos tomar prestado el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√©todo de vecinos m√°s cercanos</a> del aprendizaje autom√°tico para el problema de regresi√≥n con el fin de determinar cu√°nto es diferente el valor del aumento instant√°neo de lo que sucede a su alrededor. <br><br>  La etapa de entrenamiento, como en la descripci√≥n formal del m√©todo, consiste en almacenar todos los objetos; en nuestro caso, los valores calculados de la sobretensi√≥n en el pin, ya hacemos todo esto al momento de cargar todos los pines en el cach√©.  Lo peque√±o es calcular el valor instant√°neo, compararlo con el valor en la zona y aceptar que no podemos desviarnos demasiado del valor en la zona. <br><br>  Entonces obtenemos un sistema con una respuesta r√°pida a los eventos y que le permite leer r√°pidamente el valor del coeficiente creciente. <br><br><h3>  Tarjeta de conducci√≥n de sobretensi√≥n </h3><br>  Para comunicarnos con el conductor, debemos poder mostrar el mapa de sobretensi√≥n en la aplicaci√≥n del conductor: un tax√≠metro.  Esto le da al conductor comentarios sobre si hay demanda en el √°rea donde se encuentra ahora y d√≥nde debe moverse para obtener los pedidos m√°s caros.  Para nosotros, esto significa que m√°s conductores vendr√°n a la zona con alta demanda y la resolver√°n. <br><br><img src="https://habrastorage.org/webt/q8/89/m-/q889m-nye_deix_n6i5tqkbnoba.png"><br><br>  Vivimos con el paradigma de que el dispositivo del controlador es un dispositivo bastante d√©bil.  Por lo tanto, la representaci√≥n de la rejilla hexagonal de sobretensi√≥n se encuentra en el lado del backend.  El cliente llega al backend por los mosaicos.  Estas son im√°genes r√°ster cortadas para su visualizaci√≥n directa en el mapa. <br><br>  Tenemos un servicio separado que recoge peri√≥dicamente moldes de pines del microservicio Surger y calcula toda la metainformaci√≥n necesaria para representar la cuadr√≠cula hexagonal: d√≥nde est√° qu√© hex√°gono y qu√© oleada hay en cada uno. <br><br><h3>  Conclusi√≥n </h3><br>  El precio din√°mico es una b√∫squeda constante de un equilibrio entre la oferta y la demanda, de modo que los usuarios siempre tengan autos gratis disponibles, incluso a trav√©s del mecanismo de atraer conductores adicionales a √°reas de alta demanda.  Por ejemplo, actualmente estamos trabajando en un uso m√°s profundo del aprendizaje autom√°tico para calcular el aumento.  Como parte de una de las tareas en esta √°rea, estamos aprendiendo a determinar la probabilidad de que un pin se convierta en un pedido y tener en cuenta esta informaci√≥n.  Aqu√≠ hay suficiente trabajo, por lo que siempre estamos contentos con los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuevos especialistas</a> en el equipo. <br><br>  Si est√° interesado en conocer una parte de este gran tema con m√°s detalle, escriba los comentarios.  ¬°Los comentarios y las ideas tambi√©n son bienvenidos! <br><br>  PD: En la pr√≥xima <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaci√≥n,</a> mi colega hablar√° sobre el uso del aprendizaje autom√°tico para predecir la hora prevista de llegada de un taxi. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429226/">https://habr.com/ru/post/es429226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429216/index.html">Verifique las ventas en Google Play: ¬øvale la pena preocuparse?</a></li>
<li><a href="../es429218/index.html">Julia y ecuaciones diferenciales parciales</a></li>
<li><a href="../es429220/index.html">FSIN versus las leyes de la f√≠sica o abejas versus miel</a></li>
<li><a href="../es429222/index.html">La Duma del Estado devolver√° la factura de los grandes datos del usuario para su revisi√≥n.</a></li>
<li><a href="../es429224/index.html">Patrones de formularios web oscuros o cu√°l ser√≠a la mayor forma de conversi√≥n</a></li>
<li><a href="../es429228/index.html">PMP Pasando el examen. Qu√© considerar y por qu√© lo necesitas</a></li>
<li><a href="../es429230/index.html">Informe: proyectores Epson en Integrated Systems Russia 2018</a></li>
<li><a href="../es429232/index.html">Carrera de esteroides. Perros</a></li>
<li><a href="../es429234/index.html">Creaci√≥n del juego "Me gusta las monedas" en Godot Engine. Parte 1</a></li>
<li><a href="../es429236/index.html">¬øCu√°ntos cient√≠ficos de datos necesita para encender una bombilla (o qu√© equipo har√° que los datos funcionen para el negocio)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>