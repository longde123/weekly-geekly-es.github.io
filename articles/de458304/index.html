<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öúÔ∏è ü•´ üí™üèæ Albtraum des ‚ÄûRitters‚Äú: eine lehrreiche Geschichte √ºber DevOps ‚ÜòÔ∏è üñêüèæ ‚úçüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1066 sind mehr als 200 Jahre seit dem Beginn der Invasion der Wikinger in England vergangen. K√∂nig Harold sammelte eine Abteilung von Rittern und mars...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Albtraum des ‚ÄûRitters‚Äú: eine lehrreiche Geschichte √ºber DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moex/blog/458304/"><img src="https://habrastorage.org/webt/im/2a/ct/im2actpwxzvrz1_j4k-2easujdy.jpeg"><br><br>  1066 sind mehr als 200 Jahre seit dem Beginn der Invasion der Wikinger in England vergangen.  K√∂nig Harold sammelte eine Abteilung von Rittern und marschierte zum Derwent River, um einen entscheidenden Kampf mit den Truppen seines Namensvetters - des norwegischen K√∂nigs Harald - zu f√ºhren.  Die B√ºchsenmacher arbeiteten einen Monat lang daran, gen√ºgend R√ºstungen der neuen Generation zu schmieden, um den Ritter vor einem Treffer durch eine skandinavische Axt zu sch√ºtzen.  Und wie viele Experimente und Versuche in Turnieren waren zuvor gewesen!  Aber die Erwartung h√§tte sich rechtfertigen m√ºssen - leichte, aber zuverl√§ssige Ausr√ºstung, die es auch zu Fu√ü ohne gro√üe Verluste erm√∂glichte, den Wikingerhund zu zerstreuen.  Und schlie√ülich trafen sie sich an der Stamford Bridge.  Die Hauptabteilung der Ritter, angef√ºhrt von einem Kommandanten in gl√§nzender R√ºstung, stie√ü mitten auf einer Br√ºcke mit Feinden zusammen.  Ja, der Stahl der podgorny Meister h√§lt den Schlag! <br><br>  Langsam aber sicher bewegen sich die Wikinger zu einer Round-Robin-Verteidigung.  Der Sieg scheint nahe zu sein.  Und schlie√ülich finden sich auf dem Schlachtfeld der Ritterkommandant und der norwegische Jarl. <br><a name="habracut"></a><br>  Die zweih√§ndige Jarl-Axt ist bereits gebrochen und er ist gezwungen, sich mit einem gew√∂hnlichen Sachsen zu verteidigen, der nicht mit einem Ritter und einem halben Schwert zu vergleichen ist.  Eine Welle mit einem Dolch - f√ºr die R√ºstung des Kommandanten ist es wie ein Taschenmesser, aber es geht durch die R√ºstung und ... es scheint, dass Magie ins Spiel gekommen ist - die R√ºstung benachbarter Ritter ist verstreut!  Eine weitere Welle, wieder am Ziel, und jetzt bei den Rittern auf der linken Seite leuchtet die R√ºstung pl√∂tzlich gl√ºhend hei√ü.  Der dritte Schlag - die Ritter schwimmen vor ihren Augen, sie stolpern, fallen und erheben sich nie wieder. <br><br>  "*** ** **** ****!"  Rief Petrovich und wachte am Montag um 5 Uhr morgens in kaltem Schwei√ü auf.  Alles lief v√∂llig schief: Um elf Uhr abends stieg er in Wikipedia ein, um nach Materialien f√ºr den Bericht des Kindes √ºber die Natur der Tundra zu suchen, aber zum Zeitpunkt der Nacht befand er sich irgendwie in der Beschreibung der Invasion der Wikinger in England.  Und am Wochenende haben sie die n√§chste Ver√∂ffentlichung in den Kampf gezogen, die heute beginnen soll.  Wie immer haben wir es lange getestet und gr√ºndlich durchlaufen, es millionenfach durch kontinuierliche Integrationssysteme gefahren, ob alles reibungslos l√§uft ... <br><br>  Zum Gl√ºck f√ºr einige, aber leider f√ºr die Opfer, gibt es immer die M√∂glichkeit, aus den Fehlern anderer zu lernen, etwas zu Hause zu verbessern und einen zus√§tzlichen Teil des Vertrauens zu gewinnen.  Mit diesem √ºbersetzten Artikel m√∂chten wir noch einmal genauer auf einen der F√§lle in "unserer" Branche eingehen. <br><br><hr><br>  Letztes Jahr sprach ich auf der Konferenz √ºber DevOps, Konfiguration als Code und kontinuierliche Bereitstellung.  Anhand der folgenden Geschichte habe ich erkl√§rt, wie wichtig es ist, im Rahmen der DevOps / Continuous Delivery-Initiative vollst√§ndig automatisierte und reproduzierbare Bereitstellungen zu erstellen.  Nach der Konferenz baten mich mehrere Leute, eine Geschichte in einem Blog zu teilen.  Dies ist eine absolut wahre Geschichte.  Dies ist eine Nacherz√§hlung von dem, was ich gelesen habe, ich selbst habe nicht daran teilgenommen. <br><br>  Die Geschichte, wie ein Unternehmen mit einem Verm√∂gen von fast 400 Millionen US-Dollar aufgrund eines erfolglosen Einsatzes innerhalb von 45 Minuten bankrott ging. <br><br><h1>  Ein kleiner Hintergrund </h1><br>  Knight Capital Group (‚ÄûKnight‚Äú bedeutet auf Englisch ‚ÄûKnight‚Äú) ist ein amerikanisches globales Finanzunternehmen, das sich mit Market Making, elektronischer Ausf√ºhrung, institutionellem Verkauf und Handel befasst.  2012 war Knight der gr√∂√üte US-Aktienh√§ndler mit einem Marktanteil von rund 17% an der NYSE und der NASDAQ.  Die Electronic Trading Group (ETG) von Knight verwaltete ein durchschnittliches t√§gliches Handelsvolumen von √ºber 3,3 Milliarden Transaktionen pro Tag und handelte √ºber 21 Milliarden US-Dollar ... pro Tag.  Das ist kein Scherz! <br><br>  Zum 31. Juli 2012 verf√ºgte Knight √ºber liquide Mittel in H√∂he von ca. 365 Mio. USD. <br><br>  Am 1. August 2012 plante die NYSE die Einf√ºhrung eines neuen Liquidit√§tsprogramms f√ºr Privatanleger, des Retail Liquidity Program (ein Programm zur Verbesserung der Preisgestaltung f√ºr Privatanleger durch Einzelhandelsmakler wie Knight).  In Vorbereitung auf dieses Ereignis hat Knight den automatisierten algorithmischen Hochgeschwindigkeits-Router SMARS aktualisiert, der Anwendungen zur Ausf√ºhrung auf den Markt sendet.  Eine der Hauptfunktionen von SMARS besteht darin, Anwendungen von anderen Komponenten der Knights-Handelsplattform ("√ºbergeordnete" Anwendungen) zu empfangen und anschlie√üend eine oder mehrere "untergeordnete" Anwendungen zur Ausf√ºhrung zu senden.  Mit anderen Worten, SMARS erh√§lt gro√üe Auftr√§ge von der Handelsplattform und teilt sie in mehrere kleine auf, um einen K√§ufer / Verk√§ufer f√ºr Aktien zu finden.  Je gr√∂√üer die √ºbergeordnete Anwendung ist, desto mehr untergeordnete Anwendungen werden erstellt. <br><br>  Das SMARS-Update sollte den alten, nicht verwendeten Code namens ‚ÄûPower Peg‚Äú ersetzen - diese Funktionalit√§t hatte Knight seit 8 Jahren nicht mehr verwendet (warum der Code, der so lange tot war, noch in der Codebasis war, ist ein R√§tsel, aber das ist nicht die Hauptsache).  Der aktualisierte Code hat das alte Flag neu zugewiesen, mit dem die Power Peg-Funktionalit√§t aktiviert wurde.  Der Code wurde gr√ºndlich getestet, funktionierte korrekt und war zuverl√§ssig.  Was h√§tte schief gehen k√∂nnen? <br><br><h1>  Was h√§tte schief gehen k√∂nnen?  Und wirklich! </h1><br>  Zwischen dem 27. Juli 2012 und dem 31. Juli 2012 stellte Knight neue Software manuell auf einer begrenzten Anzahl von Servern pro Tag bereit - insgesamt acht (8) Server.  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SEC-Dokument</a> sagt Folgendes √ºber die manuelle Bereitstellung aus (SEC ist die Securities and Exchanges Comission, die amerikanische B√∂rsenaufsichtsbeh√∂rde). <br><br><blockquote>  ‚ÄûW√§hrend der Bereitstellung des neuen Codes hat einer der Knight-Mitarbeiter den neuen Code nicht auf einen der acht SMARS-Server kopiert.  Knight f√ºhrte keine zweite technische √úberpr√ºfung dieser Bereitstellung durch, sodass der Power Peg-Code nicht vom achten Server gel√∂scht und der neue RLP-Code nicht hinzugef√ºgt wurde.  Das Unternehmen verf√ºgte nicht √ºber Verfahren, die eine erneute Pr√ºfung erforderten. ‚Äú  Release Nr. 70694, 16. Oktober 2013 </blockquote><br>  Am 1. August 2012 um 9:30 Uhr EST √∂ffneten sich die M√§rkte und Knight begann, Anfragen von Broker-Dealern im Namen seiner Kunden im neuen Retail Liquidity Program zu bearbeiten.  Sieben (7) Server, die ordnungsgem√§√ü bereitgestellt wurden, begannen, Anwendungen ordnungsgem√§√ü zu verarbeiten.  Und diese Anwendungen, die auf den achten Server gingen, haben wahrscheinlich das ge√§nderte Flag aktiviert und Power Peg wiederbelebt. <br><br><h1>  Zombie Attack: Killer Code </h1><br>  Hier m√ºssen Sie erkl√§ren, warum der "tote" Power Peg-Code ben√∂tigt wurde.  Diese Funktion diente zum Z√§hlen von Aktien, die auf Wunsch eines Elternteils gekauft / verkauft wurden, wenn die Bestellungen des Kindes abgeschlossen sind.  Nachdem die √ºbergeordnete Anwendung ausgef√ºhrt wurde, verbietet Power Peg die Einreichung von untergeordneten Anwendungen.  Im Prinzip verfolgt Power Peg untergeordnete Bestellungen und stoppt deren Ausf√ºhrung nach der Verarbeitung der √ºbergeordneten Anwendung.  Im Jahr 2005 hat Knight diese kumulative Nachverfolgungsfunktion auf eine fr√ºhere Phase der Codeausf√ºhrung zur√ºckgesetzt (wodurch die Mengenverfolgung aus Power Peg entfernt wurde). <br><br>  Als das Power Peg-Flag auf dem achten Server aktiviert wurde, begann Power Peg, untergeordnete Befehle zur Ausf√ºhrung weiterzuleiten, korrelierte sie jedoch nicht mit der Anzahl der Freigaben in der √ºbergeordneten Reihenfolge - es entstand eine Art geschlossener Regelkreis <br><br><h1>  Infernal 45 Minuten </h1><br>  Stellen Sie sich vor: Sie haben ein System, mit dem automatische Hochgeschwindigkeitsanwendungen ohne Nachverfolgung auf den Markt gebracht werden k√∂nnen und das feststellen kann, ob gen√ºgend Anwendungen abgeschlossen wurden.  Ja, alles ist so schlimm geworden. <br><br>  Als der Markt um 9:30 Uhr √∂ffnete, stellten die Leute schnell fest, dass etwas nicht stimmte.  Um 9:31 Uhr hatten viele an der Wall Street bemerkt, dass etwas Ernstes geschah.  Der Markt war mit Geboten √ºberflutet, deren Handelsvolumen f√ºr bestimmte Aktien im Vergleich zur normalen Situation ungew√∂hnlich war.  Um 9:32 Uhr an der Wall Street fragten sie sich, warum diese Schande nicht aufh√∂rt.  Fast f√ºr immer im Hochgeschwindigkeitshandel.  Warum hat jemand auf dem System, das es getan hat, nicht auf die Schaltfl√§che "T√∂ten" geklickt?  Wie sich herausstellte, gab es keinen Schalter.  W√§hrend der ersten 45 Handelsminuten betrug die Ausf√ºhrung von Transaktionen von Knight mehr als 50% des Handelsvolumens, wodurch bestimmte Aktien um mehr als 10% ihres Wertes erh√∂ht wurden.  Infolgedessen fielen andere Aktien aufgrund fehlerhafter Transaktionen an Wert. <br><br>  Und um die Sache noch schlimmer zu machen, begann das Knight-System bereits vor diesen Ereignissen mit dem Versenden automatisierter E-Mails - bereits um 8:01 Uhr (als SMARS Auftr√§ge verarbeitete, die f√ºr den Handel vor dem Inverkehrbringen geeignet waren).  In Nachrichten verwies das System auf SMARS und zeigte den Fehler "Power Peg ist nicht verf√ºgbar" an.  Zwischen 8:01 Uhr und 9:30 Uhr wurden 97 Briefe an Knight-Mitarbeiter gesendet.  Nat√ºrlich sahen diese Buchstaben nicht wie Systemwarnungen aus, also sah sie niemand sofort an.  Autsch. <br><br>  F√ºr h√∂llische 45 Minuten versuchte Knight, die fehlerhafte Transaktion zu stoppen.  Es war nicht m√∂glich, das System auszuschalten (da es keine dokumentierten Verfahren gab, um auf eine solche Situation zu reagieren). Daher versuchten sie, das Problem unter Live-Handelsbedingungen zu l√∂sen, und blieben auf dem Markt, auf dem jede Minute 8 Millionen Aktien verkauft wurden.  Da die Mitarbeiter des Unternehmens nicht feststellen konnten, woher die fehlerhaften Anwendungen stammten, entfernten sie den neuen Code von den Servern, auf denen er ordnungsgem√§√ü bereitgestellt wurde.  Mit anderen Worten, sie haben den Arbeitscode gel√∂scht und sind kaputt geblieben.  Dies versch√§rfte nur die Probleme, die dazu f√ºhrten, dass zus√§tzliche elterliche Anforderungen den Power Peg-Code auf allen Servern aktivierten, und nicht nur dort, wo der Code urspr√ºnglich falsch bereitgestellt wurde.  Am Ende gelang es mir, das System zu stoppen - nach 45 Minuten Handel. <br><br>  W√§hrend des Handels erhielt und verarbeitete der Power Peg-Code 212 Anfragen von Eltern.  Infolgedessen schickte SMARS Millionen von Tochterunternehmen auf den Markt und schloss 4 Millionen Transaktionen in 154 Transaktionen mit mehr als 397 Millionen Aktien ab.  F√ºr B√∂rsenkenner bedeutete dies, dass Knight Aktien von 80 verschiedenen Unternehmen f√ºr 3,5 Milliarden US-Dollar kaufte und Aktien von 74 Unternehmen f√ºr 3,15 Milliarden US-Dollar verkaufte. Aus Sicht von Laien verlor die Knight Capital Group innerhalb von 45 Minuten 460 Millionen US-Dollar.  Aber Knight verf√ºgt nur √ºber 365 Millionen US-Dollar an liquiden Mitteln.  In 45 Minuten hat sich Knight vom gr√∂√üten H√§ndler amerikanischer Aktien und einem gro√üen Market Maker an der NYSE und der NASDAQ in den Bankrott verwandelt.  Sie hatten 48 Stunden Zeit, um den zur Deckung der Verluste erforderlichen Betrag einzutreiben (was sie dank einer Investition von etwa einem halben Dutzend Investoren in H√∂he von 400 Millionen US-Dollar tun konnten).  Letztendlich wurde die Knight Capital Group von Getco LLC (im Dezember 2012) √ºbernommen, und jetzt hei√üt das kombinierte Unternehmen KCG Holdings. <br><br><h1>  Welche Schlussfolgerungen m√ºssen Sie ziehen? </h1><br>  Die Ereignisse vom 1. August 2012 sollten eine Lektion f√ºr alle Entwicklungsteams und Projektteams sein.  Es reicht nicht aus, gro√üartige Software zu erstellen und zu testen.  Sie m√ºssen auch sicherstellen, dass es korrekt auf den Markt gebracht wird, damit Ihre Kunden genau den Wert erhalten, den Sie bereitstellen (und dass Sie Ihr Unternehmen nicht bankrott machen).  Die Ingenieure, die SMARS eingesetzt haben, sind nicht nur daf√ºr verantwortlich, dass das bei Knight angewandte Verfahren keine Risiken ber√ºcksichtigt hat.  Das Verfahren (oder seine Abwesenheit) war offensichtlich fehlerhaft.  Jedes Mal, wenn der Bereitstellungsprozess davon abh√§ngt, wie Benutzer Anweisungen lesen und befolgen, setzen Sie sich selbst einem Risiko aus.  Menschen machen Fehler.  Fehler k√∂nnen in den Anweisungen, in der Interpretation der Anweisungen oder in ihrer Implementierung liegen. <br><br>  Das Layout sollte automatisiert, reproduzierbar und so frei wie m√∂glich von menschlichen Fehlern sein.  Wenn Knight ein automatisiertes Bereitstellungssystem implementiert h√§tte - eine Reihe von Konfigurationen, automatischen Bereitstellungen und Tests -, h√§tte der Fehler, der zum Albtraum eines Ritters wurde, vermieden werden k√∂nnen. <br><br>  Hier sind einige Prinzipien der kontinuierlichen Lieferung (auch wenn Sie nicht den vollst√§ndigen Prozess der kontinuierlichen Lieferung implementieren): <br><br><ul><li>  Die Softwareversion sollte ein wiederholbarer und zuverl√§ssiger Prozess sein. <br></li><li>  Automatisieren Sie alles, was Sie k√∂nnen. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458304/">https://habr.com/ru/post/de458304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458290/index.html">Biosynthetischer Dual-Core-Computer in einer lebenden Zelle</a></li>
<li><a href="../de458292/index.html">PHP Digest Nr. 159 (17. Juni - 1. Juli 2019)</a></li>
<li><a href="../de458298/index.html">Machte ein gro√ües halbes Zahnrad auf Sonnenkollektoren f√ºr 250.000 Rubel (2 Teile)</a></li>
<li><a href="../de458300/index.html">Weiterentwicklung des beliebtesten Tools jedes Entwicklers (in Visual Studio)</a></li>
<li><a href="../de458302/index.html">Frontend Weekly Digest (24. - 30. Juni 2019)</a></li>
<li><a href="../de458306/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends f√ºr die letzte Woche Nr. 371 (24. - 30. Juni 2019)</a></li>
<li><a href="../de458308/index.html">√úberblick: Was wird die Zukunft von Tesla sein und welche Faktoren werden es beeinflussen</a></li>
<li><a href="../de458310/index.html">Sammeln Sie mithilfe von Telegraf Metriken aus .NET-Anwendungen</a></li>
<li><a href="../de458312/index.html">Android Academy in Moskau: Fortgeschrittenenkurs</a></li>
<li><a href="../de458316/index.html">Yandex Retro Games Battle 2019 - Entwicklung von Spielen f√ºr ZX Spectrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>