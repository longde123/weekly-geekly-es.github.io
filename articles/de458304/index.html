<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚜️ 🥫 💪🏾 Albtraum des „Ritters“: eine lehrreiche Geschichte über DevOps ↘️ 🖐🏾 ✍🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1066 sind mehr als 200 Jahre seit dem Beginn der Invasion der Wikinger in England vergangen. König Harold sammelte eine Abteilung von Rittern und mars...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Albtraum des „Ritters“: eine lehrreiche Geschichte über DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/moex/blog/458304/"><img src="https://habrastorage.org/webt/im/2a/ct/im2actpwxzvrz1_j4k-2easujdy.jpeg"><br><br>  1066 sind mehr als 200 Jahre seit dem Beginn der Invasion der Wikinger in England vergangen.  König Harold sammelte eine Abteilung von Rittern und marschierte zum Derwent River, um einen entscheidenden Kampf mit den Truppen seines Namensvetters - des norwegischen Königs Harald - zu führen.  Die Büchsenmacher arbeiteten einen Monat lang daran, genügend Rüstungen der neuen Generation zu schmieden, um den Ritter vor einem Treffer durch eine skandinavische Axt zu schützen.  Und wie viele Experimente und Versuche in Turnieren waren zuvor gewesen!  Aber die Erwartung hätte sich rechtfertigen müssen - leichte, aber zuverlässige Ausrüstung, die es auch zu Fuß ohne große Verluste ermöglichte, den Wikingerhund zu zerstreuen.  Und schließlich trafen sie sich an der Stamford Bridge.  Die Hauptabteilung der Ritter, angeführt von einem Kommandanten in glänzender Rüstung, stieß mitten auf einer Brücke mit Feinden zusammen.  Ja, der Stahl der podgorny Meister hält den Schlag! <br><br>  Langsam aber sicher bewegen sich die Wikinger zu einer Round-Robin-Verteidigung.  Der Sieg scheint nahe zu sein.  Und schließlich finden sich auf dem Schlachtfeld der Ritterkommandant und der norwegische Jarl. <br><a name="habracut"></a><br>  Die zweihändige Jarl-Axt ist bereits gebrochen und er ist gezwungen, sich mit einem gewöhnlichen Sachsen zu verteidigen, der nicht mit einem Ritter und einem halben Schwert zu vergleichen ist.  Eine Welle mit einem Dolch - für die Rüstung des Kommandanten ist es wie ein Taschenmesser, aber es geht durch die Rüstung und ... es scheint, dass Magie ins Spiel gekommen ist - die Rüstung benachbarter Ritter ist verstreut!  Eine weitere Welle, wieder am Ziel, und jetzt bei den Rittern auf der linken Seite leuchtet die Rüstung plötzlich glühend heiß.  Der dritte Schlag - die Ritter schwimmen vor ihren Augen, sie stolpern, fallen und erheben sich nie wieder. <br><br>  "*** ** **** ****!"  Rief Petrovich und wachte am Montag um 5 Uhr morgens in kaltem Schweiß auf.  Alles lief völlig schief: Um elf Uhr abends stieg er in Wikipedia ein, um nach Materialien für den Bericht des Kindes über die Natur der Tundra zu suchen, aber zum Zeitpunkt der Nacht befand er sich irgendwie in der Beschreibung der Invasion der Wikinger in England.  Und am Wochenende haben sie die nächste Veröffentlichung in den Kampf gezogen, die heute beginnen soll.  Wie immer haben wir es lange getestet und gründlich durchlaufen, es millionenfach durch kontinuierliche Integrationssysteme gefahren, ob alles reibungslos läuft ... <br><br>  Zum Glück für einige, aber leider für die Opfer, gibt es immer die Möglichkeit, aus den Fehlern anderer zu lernen, etwas zu Hause zu verbessern und einen zusätzlichen Teil des Vertrauens zu gewinnen.  Mit diesem übersetzten Artikel möchten wir noch einmal genauer auf einen der Fälle in "unserer" Branche eingehen. <br><br><hr><br>  Letztes Jahr sprach ich auf der Konferenz über DevOps, Konfiguration als Code und kontinuierliche Bereitstellung.  Anhand der folgenden Geschichte habe ich erklärt, wie wichtig es ist, im Rahmen der DevOps / Continuous Delivery-Initiative vollständig automatisierte und reproduzierbare Bereitstellungen zu erstellen.  Nach der Konferenz baten mich mehrere Leute, eine Geschichte in einem Blog zu teilen.  Dies ist eine absolut wahre Geschichte.  Dies ist eine Nacherzählung von dem, was ich gelesen habe, ich selbst habe nicht daran teilgenommen. <br><br>  Die Geschichte, wie ein Unternehmen mit einem Vermögen von fast 400 Millionen US-Dollar aufgrund eines erfolglosen Einsatzes innerhalb von 45 Minuten bankrott ging. <br><br><h1>  Ein kleiner Hintergrund </h1><br>  Knight Capital Group („Knight“ bedeutet auf Englisch „Knight“) ist ein amerikanisches globales Finanzunternehmen, das sich mit Market Making, elektronischer Ausführung, institutionellem Verkauf und Handel befasst.  2012 war Knight der größte US-Aktienhändler mit einem Marktanteil von rund 17% an der NYSE und der NASDAQ.  Die Electronic Trading Group (ETG) von Knight verwaltete ein durchschnittliches tägliches Handelsvolumen von über 3,3 Milliarden Transaktionen pro Tag und handelte über 21 Milliarden US-Dollar ... pro Tag.  Das ist kein Scherz! <br><br>  Zum 31. Juli 2012 verfügte Knight über liquide Mittel in Höhe von ca. 365 Mio. USD. <br><br>  Am 1. August 2012 plante die NYSE die Einführung eines neuen Liquiditätsprogramms für Privatanleger, des Retail Liquidity Program (ein Programm zur Verbesserung der Preisgestaltung für Privatanleger durch Einzelhandelsmakler wie Knight).  In Vorbereitung auf dieses Ereignis hat Knight den automatisierten algorithmischen Hochgeschwindigkeits-Router SMARS aktualisiert, der Anwendungen zur Ausführung auf den Markt sendet.  Eine der Hauptfunktionen von SMARS besteht darin, Anwendungen von anderen Komponenten der Knights-Handelsplattform ("übergeordnete" Anwendungen) zu empfangen und anschließend eine oder mehrere "untergeordnete" Anwendungen zur Ausführung zu senden.  Mit anderen Worten, SMARS erhält große Aufträge von der Handelsplattform und teilt sie in mehrere kleine auf, um einen Käufer / Verkäufer für Aktien zu finden.  Je größer die übergeordnete Anwendung ist, desto mehr untergeordnete Anwendungen werden erstellt. <br><br>  Das SMARS-Update sollte den alten, nicht verwendeten Code namens „Power Peg“ ersetzen - diese Funktionalität hatte Knight seit 8 Jahren nicht mehr verwendet (warum der Code, der so lange tot war, noch in der Codebasis war, ist ein Rätsel, aber das ist nicht die Hauptsache).  Der aktualisierte Code hat das alte Flag neu zugewiesen, mit dem die Power Peg-Funktionalität aktiviert wurde.  Der Code wurde gründlich getestet, funktionierte korrekt und war zuverlässig.  Was hätte schief gehen können? <br><br><h1>  Was hätte schief gehen können?  Und wirklich! </h1><br>  Zwischen dem 27. Juli 2012 und dem 31. Juli 2012 stellte Knight neue Software manuell auf einer begrenzten Anzahl von Servern pro Tag bereit - insgesamt acht (8) Server.  Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SEC-Dokument</a> sagt Folgendes über die manuelle Bereitstellung aus (SEC ist die Securities and Exchanges Comission, die amerikanische Börsenaufsichtsbehörde). <br><br><blockquote>  „Während der Bereitstellung des neuen Codes hat einer der Knight-Mitarbeiter den neuen Code nicht auf einen der acht SMARS-Server kopiert.  Knight führte keine zweite technische Überprüfung dieser Bereitstellung durch, sodass der Power Peg-Code nicht vom achten Server gelöscht und der neue RLP-Code nicht hinzugefügt wurde.  Das Unternehmen verfügte nicht über Verfahren, die eine erneute Prüfung erforderten. “  Release Nr. 70694, 16. Oktober 2013 </blockquote><br>  Am 1. August 2012 um 9:30 Uhr EST öffneten sich die Märkte und Knight begann, Anfragen von Broker-Dealern im Namen seiner Kunden im neuen Retail Liquidity Program zu bearbeiten.  Sieben (7) Server, die ordnungsgemäß bereitgestellt wurden, begannen, Anwendungen ordnungsgemäß zu verarbeiten.  Und diese Anwendungen, die auf den achten Server gingen, haben wahrscheinlich das geänderte Flag aktiviert und Power Peg wiederbelebt. <br><br><h1>  Zombie Attack: Killer Code </h1><br>  Hier müssen Sie erklären, warum der "tote" Power Peg-Code benötigt wurde.  Diese Funktion diente zum Zählen von Aktien, die auf Wunsch eines Elternteils gekauft / verkauft wurden, wenn die Bestellungen des Kindes abgeschlossen sind.  Nachdem die übergeordnete Anwendung ausgeführt wurde, verbietet Power Peg die Einreichung von untergeordneten Anwendungen.  Im Prinzip verfolgt Power Peg untergeordnete Bestellungen und stoppt deren Ausführung nach der Verarbeitung der übergeordneten Anwendung.  Im Jahr 2005 hat Knight diese kumulative Nachverfolgungsfunktion auf eine frühere Phase der Codeausführung zurückgesetzt (wodurch die Mengenverfolgung aus Power Peg entfernt wurde). <br><br>  Als das Power Peg-Flag auf dem achten Server aktiviert wurde, begann Power Peg, untergeordnete Befehle zur Ausführung weiterzuleiten, korrelierte sie jedoch nicht mit der Anzahl der Freigaben in der übergeordneten Reihenfolge - es entstand eine Art geschlossener Regelkreis <br><br><h1>  Infernal 45 Minuten </h1><br>  Stellen Sie sich vor: Sie haben ein System, mit dem automatische Hochgeschwindigkeitsanwendungen ohne Nachverfolgung auf den Markt gebracht werden können und das feststellen kann, ob genügend Anwendungen abgeschlossen wurden.  Ja, alles ist so schlimm geworden. <br><br>  Als der Markt um 9:30 Uhr öffnete, stellten die Leute schnell fest, dass etwas nicht stimmte.  Um 9:31 Uhr hatten viele an der Wall Street bemerkt, dass etwas Ernstes geschah.  Der Markt war mit Geboten überflutet, deren Handelsvolumen für bestimmte Aktien im Vergleich zur normalen Situation ungewöhnlich war.  Um 9:32 Uhr an der Wall Street fragten sie sich, warum diese Schande nicht aufhört.  Fast für immer im Hochgeschwindigkeitshandel.  Warum hat jemand auf dem System, das es getan hat, nicht auf die Schaltfläche "Töten" geklickt?  Wie sich herausstellte, gab es keinen Schalter.  Während der ersten 45 Handelsminuten betrug die Ausführung von Transaktionen von Knight mehr als 50% des Handelsvolumens, wodurch bestimmte Aktien um mehr als 10% ihres Wertes erhöht wurden.  Infolgedessen fielen andere Aktien aufgrund fehlerhafter Transaktionen an Wert. <br><br>  Und um die Sache noch schlimmer zu machen, begann das Knight-System bereits vor diesen Ereignissen mit dem Versenden automatisierter E-Mails - bereits um 8:01 Uhr (als SMARS Aufträge verarbeitete, die für den Handel vor dem Inverkehrbringen geeignet waren).  In Nachrichten verwies das System auf SMARS und zeigte den Fehler "Power Peg ist nicht verfügbar" an.  Zwischen 8:01 Uhr und 9:30 Uhr wurden 97 Briefe an Knight-Mitarbeiter gesendet.  Natürlich sahen diese Buchstaben nicht wie Systemwarnungen aus, also sah sie niemand sofort an.  Autsch. <br><br>  Für höllische 45 Minuten versuchte Knight, die fehlerhafte Transaktion zu stoppen.  Es war nicht möglich, das System auszuschalten (da es keine dokumentierten Verfahren gab, um auf eine solche Situation zu reagieren). Daher versuchten sie, das Problem unter Live-Handelsbedingungen zu lösen, und blieben auf dem Markt, auf dem jede Minute 8 Millionen Aktien verkauft wurden.  Da die Mitarbeiter des Unternehmens nicht feststellen konnten, woher die fehlerhaften Anwendungen stammten, entfernten sie den neuen Code von den Servern, auf denen er ordnungsgemäß bereitgestellt wurde.  Mit anderen Worten, sie haben den Arbeitscode gelöscht und sind kaputt geblieben.  Dies verschärfte nur die Probleme, die dazu führten, dass zusätzliche elterliche Anforderungen den Power Peg-Code auf allen Servern aktivierten, und nicht nur dort, wo der Code ursprünglich falsch bereitgestellt wurde.  Am Ende gelang es mir, das System zu stoppen - nach 45 Minuten Handel. <br><br>  Während des Handels erhielt und verarbeitete der Power Peg-Code 212 Anfragen von Eltern.  Infolgedessen schickte SMARS Millionen von Tochterunternehmen auf den Markt und schloss 4 Millionen Transaktionen in 154 Transaktionen mit mehr als 397 Millionen Aktien ab.  Für Börsenkenner bedeutete dies, dass Knight Aktien von 80 verschiedenen Unternehmen für 3,5 Milliarden US-Dollar kaufte und Aktien von 74 Unternehmen für 3,15 Milliarden US-Dollar verkaufte. Aus Sicht von Laien verlor die Knight Capital Group innerhalb von 45 Minuten 460 Millionen US-Dollar.  Aber Knight verfügt nur über 365 Millionen US-Dollar an liquiden Mitteln.  In 45 Minuten hat sich Knight vom größten Händler amerikanischer Aktien und einem großen Market Maker an der NYSE und der NASDAQ in den Bankrott verwandelt.  Sie hatten 48 Stunden Zeit, um den zur Deckung der Verluste erforderlichen Betrag einzutreiben (was sie dank einer Investition von etwa einem halben Dutzend Investoren in Höhe von 400 Millionen US-Dollar tun konnten).  Letztendlich wurde die Knight Capital Group von Getco LLC (im Dezember 2012) übernommen, und jetzt heißt das kombinierte Unternehmen KCG Holdings. <br><br><h1>  Welche Schlussfolgerungen müssen Sie ziehen? </h1><br>  Die Ereignisse vom 1. August 2012 sollten eine Lektion für alle Entwicklungsteams und Projektteams sein.  Es reicht nicht aus, großartige Software zu erstellen und zu testen.  Sie müssen auch sicherstellen, dass es korrekt auf den Markt gebracht wird, damit Ihre Kunden genau den Wert erhalten, den Sie bereitstellen (und dass Sie Ihr Unternehmen nicht bankrott machen).  Die Ingenieure, die SMARS eingesetzt haben, sind nicht nur dafür verantwortlich, dass das bei Knight angewandte Verfahren keine Risiken berücksichtigt hat.  Das Verfahren (oder seine Abwesenheit) war offensichtlich fehlerhaft.  Jedes Mal, wenn der Bereitstellungsprozess davon abhängt, wie Benutzer Anweisungen lesen und befolgen, setzen Sie sich selbst einem Risiko aus.  Menschen machen Fehler.  Fehler können in den Anweisungen, in der Interpretation der Anweisungen oder in ihrer Implementierung liegen. <br><br>  Das Layout sollte automatisiert, reproduzierbar und so frei wie möglich von menschlichen Fehlern sein.  Wenn Knight ein automatisiertes Bereitstellungssystem implementiert hätte - eine Reihe von Konfigurationen, automatischen Bereitstellungen und Tests -, hätte der Fehler, der zum Albtraum eines Ritters wurde, vermieden werden können. <br><br>  Hier sind einige Prinzipien der kontinuierlichen Lieferung (auch wenn Sie nicht den vollständigen Prozess der kontinuierlichen Lieferung implementieren): <br><br><ul><li>  Die Softwareversion sollte ein wiederholbarer und zuverlässiger Prozess sein. <br></li><li>  Automatisieren Sie alles, was Sie können. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458304/">https://habr.com/ru/post/de458304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458290/index.html">Biosynthetischer Dual-Core-Computer in einer lebenden Zelle</a></li>
<li><a href="../de458292/index.html">PHP Digest Nr. 159 (17. Juni - 1. Juli 2019)</a></li>
<li><a href="../de458298/index.html">Machte ein großes halbes Zahnrad auf Sonnenkollektoren für 250.000 Rubel (2 Teile)</a></li>
<li><a href="../de458300/index.html">Weiterentwicklung des beliebtesten Tools jedes Entwicklers (in Visual Studio)</a></li>
<li><a href="../de458302/index.html">Frontend Weekly Digest (24. - 30. Juni 2019)</a></li>
<li><a href="../de458306/index.html">Die Verdauung von frischen Materialien aus der Welt des Frontends für die letzte Woche Nr. 371 (24. - 30. Juni 2019)</a></li>
<li><a href="../de458308/index.html">Überblick: Was wird die Zukunft von Tesla sein und welche Faktoren werden es beeinflussen</a></li>
<li><a href="../de458310/index.html">Sammeln Sie mithilfe von Telegraf Metriken aus .NET-Anwendungen</a></li>
<li><a href="../de458312/index.html">Android Academy in Moskau: Fortgeschrittenenkurs</a></li>
<li><a href="../de458316/index.html">Yandex Retro Games Battle 2019 - Entwicklung von Spielen für ZX Spectrum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>