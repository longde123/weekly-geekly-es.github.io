<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßúüèæ üëÄ üßúüèæ Mengelola Relai Internet dari RouterOS Mikrotik via API üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üêï üë©üèø‚Äçüé§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alat praktis untuk mengelola PDU di router MikroTik 
 MikroTik dikenal sebagai produsen peralatan jaringan dengan keandalan tinggi dengan harga murah ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengelola Relai Internet dari RouterOS Mikrotik via API</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410107/"><img src="https://habrastorage.org/webt/ip/ds/cs/ipdscs4kq9sanmqsyphzumdxvck.png" alt="MikroTik RODOS-8/9/10" align="left"><br><br><h2>  Alat praktis untuk mengelola PDU di router MikroTik </h2><br>  <b>MikroTik</b> dikenal sebagai produsen peralatan jaringan dengan keandalan tinggi dengan harga murah dan fungsionalitas yang kaya.  Dasar perangkat lunak untuk produk MikroTik adalah <b>RouterOS</b> , sistem operasi jaringan berbasis Linux.  Ini berjalan pada <b>RouterBOARD</b> , garis besar solusi perangkat keras yang mencakup peralatan operator murni dan platform untuk digunakan di rumah.  RouterOS memberi administrator / pengguna opsi-opsi hebat untuk mengonfigurasi dan mengelola router, memungkinkan Anda untuk beroperasi tidak hanya dengan fungsionalitas built-in sistem, tetapi juga membuat opsi Anda sendiri untuk hampir semua solusi melalui pemrograman skrip. <br><br>  Pada artikel ini, saya akan membahas bagaimana Anda dapat menggunakan fungsionalitas lanjutan dari router MikroTik untuk mengeluarkan perintah kontrol daya menggunakan <b>PDU (Internet relay)</b> langsung dari router melalui fungsi skrip. <a name="habracut"></a>  Sebagai PDU, saya menggunakan relay Ethernet RODOS-8/9/10 dari perusahaan OLIMP (perangkat ini benar-benar identik dalam hal kontrol), yang tetap ada setelah beberapa proyek dan ‚Äúsiap‚Äù. <br><br><h2>  Fitur RouterOS untuk manajemen PDU </h2><br>  Fungsi lanjutan RouterOS dapat memungkinkan: <br><br><ul><li>  Mengaktifkan / menonaktifkan daya perangkat yang terhubung ke PDU dari jarak jauh </li><li>  Secara remote mengontrol PDU pada terjadinya berbagai peristiwa dalam jaringan (katakanlah, jika tidak ada respons dari perangkat apa pun untuk melakukan ping, ketika klien VPN tertentu, klien jaringan wifi, dll., Terhubung ke router), tergantung pada waktu (dijadwalkan) </li><li>  Beri tahu administrator atau pengguna tentang perubahan status relai pada PDU melalui email atau nomor telepon (melalui SMS) </li></ul><br>  Dengan demikian, dimungkinkan untuk mengatur, misalnya, kontrol peralatan server, menghidupkan / mematikan / me-restart peralatan jaringan "hung", menghidupkan pendinginan atau pemanasan, penerangan, mengatur beban yang dapat diterima untuk daya pengenal sebagai bagian dari Smart Home, dan banyak lagi yang dapat memungkinkan Imajinasi Anda <br><br>  Kemampuan untuk mengontrol relai Internet dari RouterOS disediakan oleh perintah <b>fetch</b> router, sintaksnya dijelaskan secara rinci di tautan di akhir artikel. <br><br><h2>  Mengelola PDU melalui "fetch" Router Command </h2><br>  RODOS-8/9/10 PDU mendukung format URL berikut: <br><br><div class="spoiler">  <b class="spoiler_title">http: // [login]: [Kata sandi] @ [alamat IP] [/ lindungi] / rb [X-1] [tindakan] .cgi</b> <div class="spoiler_text"><ul><li>  Login dan kata sandi - data yang relevan untuk mengakses perangkat dalam "mode terlindungi" (lindungi) </li><li>  Alamat IP - alamat IP perangkat di jaringan </li><li>  / lindungi - kunci akses dalam "mode terlindungi".  Jika akses "terbuka" diinstal pada perangkat, / proteksi tidak ditentukan, login dan kata sandi juga tidak ditentukan </li><li>  [aksi] - aksi yang diambil pada relai: n-nyalakan, f-matikan, s-berikan pulsa yang tahan 1 detik </li><li>  X adalah jumlah relai yang sedang diakses, nilai yang mungkin tergantung pada model perangkat: <br><ol><li>  RODOS-8 - tidak diindikasikan, seperti  perangkat ini memiliki satu relay </li><li>  RODOS-9 - X = 1 atau X = 2 </li><li>  RODOS-10 - X = [1-4] </li></ol></li></ul><br>  Semua parameter yang ditentukan dilewatkan tanpa tanda kurung []. </div></div><br>  Jadi, untuk menyelesaikan masalah kami di RouterOS, untuk mengaktifkan relay pertama PDU kami, entri berikut sudah cukup: <br><br><pre><code class="hljs pgsql">/tool <span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span> url="http://[:]@192.168.1.20/protect/rb0n"</code> </pre> <br>  Jika kita menginginkan respons dari perangkat, kita harus menggunakan: <br><br><pre> <code class="hljs powershell">/tool fetch url=<span class="hljs-string"><span class="hljs-string">"http://[:]@192.168.1.20/protect/rb0n"</span></span> mode=http dst<span class="hljs-literal"><span class="hljs-literal">-path</span></span>=<span class="hljs-string"><span class="hljs-string">"Rodosanswer.txt"</span></span>; :local Rodosanswer [/<span class="hljs-type"><span class="hljs-type">file</span></span> <span class="hljs-type"><span class="hljs-type">get</span></span> <span class="hljs-type"><span class="hljs-type">Rodosanswer.txt</span></span> <span class="hljs-type"><span class="hljs-type">contents</span></span>];</code> </pre> <br>  Respons PDU dalam kasus kami dikembalikan menggunakan mekanisme <b>json</b> ke variabel <b>Rodosanswer</b> dalam bentuk berikut: <br><br><ul><li>  "Sukses!  "- dalam hal eksekusi yang sukses dari perintah </li><li>  "Kesalahan" - jika perintah tidak dieksekusi (sebagai aturan, ketika mengakses tanpa menunjukkan login dan kata sandi PDU di baris URL, jika PDU dalam mode "dilindungi") </li></ul><br><h2>  Kami membuat fungsi manajemen Rodos PDU dalam repositori router Mikrotik </h2><br>  Jadi mari kita mulai.  Mari kita buat fungsi kontrol relai menggunakan contoh kontrol RODOS-10 dalam repositori skrip router MikroTik dengan nama "Func_RODOS10rele": <br><br><div class="spoiler">  <b class="spoiler_title">Kode "Func_RODOS10rele"</b> <div class="spoiler_text"><pre> <code class="hljs mel">################ FuncRODOS10rele ###################### #     PDU RODOS<span class="hljs-number"><span class="hljs-number">-10</span></span> # by Sergej Serkov <span class="hljs-number"><span class="hljs-number">23.12</span></span><span class="hljs-number"><span class="hljs-number">.2017</span></span> ####################################################### #  ,   :<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> FuncRODOS10rele <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :local Sport <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ([:len $Rport]=<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:set Sport <span class="hljs-string"><span class="hljs-string">"80"</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={:set Sport $Rport;} :<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> FuncPing; :local PingAnswer [$FuncPing PingAdr=$Radr]; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($PingAnswer=<span class="hljs-string"><span class="hljs-string">"OK"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :local Rprotect; :local Wprotect; :local Rmode <span class="hljs-string"><span class="hljs-string">"0"</span></span>; :local Nrele <span class="hljs-number"><span class="hljs-number">0</span></span>; :local Act; :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (([:len $Rlogin]=<span class="hljs-number"><span class="hljs-number">0</span></span>) and ([:len $Rpass]=<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:set Rprotect <span class="hljs-string"><span class="hljs-string">""</span></span>; set Wprotect <span class="hljs-string"><span class="hljs-string">""</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={:set Rprotect (<span class="hljs-string"><span class="hljs-string">"$Rlogin"</span></span>.<span class="hljs-string"><span class="hljs-string">":"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Rpass"</span></span>.<span class="hljs-string"><span class="hljs-string">"@"</span></span>); set Wprotect <span class="hljs-string"><span class="hljs-string">"/protect"</span></span>;} :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Rstatus=<span class="hljs-string"><span class="hljs-string">"on"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:set Rmode <span class="hljs-string"><span class="hljs-string">"1"</span></span>; :set Act <span class="hljs-string"><span class="hljs-string">"n"</span></span>} :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Rstatus=<span class="hljs-string"><span class="hljs-string">"off"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:set Rmode <span class="hljs-string"><span class="hljs-string">"1"</span></span>; :set Act <span class="hljs-string"><span class="hljs-string">"f"</span></span>} :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Rstatus=<span class="hljs-string"><span class="hljs-string">"inv"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={:set Rmode <span class="hljs-string"><span class="hljs-string">"1"</span></span>; :set Act <span class="hljs-string"><span class="hljs-string">"s"</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={} :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($Rmode=<span class="hljs-string"><span class="hljs-string">"1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :set Nrele ([:tonum $Rrele] - <span class="hljs-number"><span class="hljs-number">1</span></span>); :<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($Nrele &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> and ($Nrele &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :local StrFetchRodos; :set StrFetchRodos (<span class="hljs-string"><span class="hljs-string">"http://"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Rprotect"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Radr"</span></span>.<span class="hljs-string"><span class="hljs-string">":"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Sport"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Wprotect"</span></span>.<span class="hljs-string"><span class="hljs-string">"/rb"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Nrele"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Act"</span></span>.<span class="hljs-string"><span class="hljs-string">".cgi"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { [/tool fetch url=$StrFetchRodos mode=http dst-path=<span class="hljs-string"><span class="hljs-string">"Rodosanswer.txt"</span></span>;]; } on-<span class="hljs-keyword"><span class="hljs-keyword">error</span></span>={: <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> (<span class="hljs-string"><span class="hljs-string">"Call ERROR function &lt;RODOS10rele&gt; ERROR fetch command"</span></span>); :local Rodosanswer <span class="hljs-string"><span class="hljs-string">"ERROR: command ROS &lt;fetch&gt;"</span></span>; : <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $Rodosanswer} :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">warning</span></span> (<span class="hljs-string"><span class="hljs-string">"all "</span></span>.<span class="hljs-string"><span class="hljs-string">"$Wprotect "</span></span>.<span class="hljs-string"><span class="hljs-string">"function &lt;RODOS10rele&gt; set rele #"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Rrele "</span></span>.<span class="hljs-string"><span class="hljs-string">"is ["</span></span>.<span class="hljs-string"><span class="hljs-string">"$Rstatus"</span></span>.<span class="hljs-string"><span class="hljs-string">"]"</span></span>); :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :delay <span class="hljs-number"><span class="hljs-number">2</span></span>s; :local Rodosanswer [/<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> get Rodosanswer.txt contents]; /<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> remove Rodosanswer.txt; :<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $Rodosanswer; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> (<span class="hljs-string"><span class="hljs-string">"all ERROR"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Wprotect "</span></span>.<span class="hljs-string"><span class="hljs-string">"function &lt;RODOS10rele&gt; set rele#"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Rrele"</span></span>.<span class="hljs-string"><span class="hljs-string">" but NUMBER RELE MISMATCH"</span></span>); :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :local Rodosanswer <span class="hljs-string"><span class="hljs-string">"ERROR: rele range mismath"</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $Rodosanswer;} } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> (<span class="hljs-string"><span class="hljs-string">"all ERROR"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Wprotect "</span></span>.<span class="hljs-string"><span class="hljs-string">"function &lt;RODOS10rele&gt; set rele#"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Rrele"</span></span>.<span class="hljs-string"><span class="hljs-string">" but RELE REGIME SET MISMATCH"</span></span>); :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :local Rodosanswer <span class="hljs-string"><span class="hljs-string">"ERROR: rele regime set mismatch"</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $Rodosanswer;} } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>={ :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> (<span class="hljs-string"><span class="hljs-string">"all ERROR"</span></span>.<span class="hljs-string"><span class="hljs-string">"$Wprotect "</span></span>.<span class="hljs-string"><span class="hljs-string">"function &lt;RODOS10rele&gt; but DEVICE NOT RESPONDED"</span></span>); :<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> info <span class="hljs-string"><span class="hljs-string">""</span></span>; :local Rodosanswer <span class="hljs-string"><span class="hljs-string">"ERROR: device not responded"</span></span>; :<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $Rodosanswer;} }</code> </pre></div></div><br>  Fungsi FuncRODOS10rele juga menggunakan dalam fungsinya fungsi kecil lainnya untuk memeriksa alamat jaringan untuk ping - <b>FuncPing</b> , yang harus ada dalam lingkungan variabel repositori router selama pengoperasian fungsi utama. <br><br><div class="spoiler">  <b class="spoiler_title">Kode "Func_Ping"</b> <div class="spoiler_text"><pre> <code class="hljs mel">:<span class="hljs-keyword"><span class="hljs-keyword">global</span></span> FuncPing <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :local PingCount <span class="hljs-number"><span class="hljs-number">3</span></span>; #  ; :local Result [/ping $PingAdr count=$PingCount]; :delay <span class="hljs-number"><span class="hljs-number">2</span></span>s; :local PingAnswer <span class="hljs-string"><span class="hljs-string">""</span></span>; :local MainIfInetOk false; :set MainIfInetOk ((<span class="hljs-number"><span class="hljs-number">3</span></span>*$Result) &gt;= (<span class="hljs-number"><span class="hljs-number">2</span></span> * $PingCount)) :put <span class="hljs-string"><span class="hljs-string">"MainIfInetOk=$MainIfInetOk"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$MainIfInetOk) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :set PingAnswer <span class="hljs-string"><span class="hljs-string">"ERROR"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($MainIfInetOk) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>={ :set PingAnswer <span class="hljs-string"><span class="hljs-string">"OK"</span></span> } :<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $PingAnswer;}</code> </pre></div></div><br><h2>  Penerapan fungsi kontrol relai </h2><br>  Yang berikut ini harus dilewatkan sebagai parameter ke fungsi FuncRODOS10rele: <br><br><ul><li>  Radr - alamat IP perangkat </li><li>  Rport - port http.  Jika port standar untuk http (80) dikonfigurasi, parameter ini dapat dihilangkan </li><li>  Rrele - jumlah relai tempat kami melakukan aksi (untuk RODOS-10 [1-4]), <br>  untuk RODOS-9 [1-2], karena RODOS-8 tidak ditransmisikan) </li><li>  Rstatus - tindakan diambil ("tidak aktif" - nonaktifkan; "aktif" - aktifkan; "inv" - beri dorongan) </li><li>  Rlogin - login, Rpass - kata sandi akses perangkat <br>  (jika tidak disetel, panggilan perintah digunakan tanpa "/ lindungi") <br></li></ul><br><div class="spoiler">  <b class="spoiler_title">Contoh 1: memanggil fungsi dengan akses ke PDU melalui port http standar ketika "mode terproteksi" dimatikan dalam modul, menyalakan relai No. 2:</b> <div class="spoiler_text"><pre> <code class="hljs powershell">[<span class="hljs-variable"><span class="hljs-variable">$FuncRODOS10rele</span></span> <span class="hljs-type"><span class="hljs-type">Radr</span></span>=<span class="hljs-string"><span class="hljs-string">"192.168.1.20"</span></span> <span class="hljs-type"><span class="hljs-type">Rrele</span></span>=<span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-type"><span class="hljs-type">Rstatus</span></span>=<span class="hljs-string"><span class="hljs-string">"on"</span></span>]</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Contoh 2: memanggil fungsi dengan akses ke PDU melalui port http 8021 yang dikonfigurasi dengan set "protected mode", mematikan relai No. 2</b> <div class="spoiler_text"><pre> <code class="hljs powershell">[<span class="hljs-variable"><span class="hljs-variable">$FuncRODOS10rele</span></span> <span class="hljs-type"><span class="hljs-type">Radr</span></span>=<span class="hljs-string"><span class="hljs-string">"192.168.1.20"</span></span> <span class="hljs-type"><span class="hljs-type">Rport</span></span>=<span class="hljs-string"><span class="hljs-string">"8021"</span></span> <span class="hljs-type"><span class="hljs-type">Rrele</span></span>=<span class="hljs-string"><span class="hljs-string">"2"</span></span> <span class="hljs-type"><span class="hljs-type">Rstatus</span></span>=<span class="hljs-string"><span class="hljs-string">"off"</span></span> <span class="hljs-type"><span class="hljs-type">Rlogin</span></span>=<span class="hljs-string"><span class="hljs-string">"login"</span></span> <span class="hljs-type"><span class="hljs-type">Rpass</span></span>=<span class="hljs-string"><span class="hljs-string">"password"</span></span>]</code> </pre> </div></div><br>  Respons fungsi dapat dikembalikan ke variabel string <b>Rodosanswer</b> . <br><br><div class="spoiler">  <b class="spoiler_title">Rodosanswer dapat berisi teks berikut:</b> <div class="spoiler_text"><pre>  ‚Ä¢ "Sukses!" - dalam kasus panggilan sukses dan eksekusi tim

  ‚Ä¢ "Fault" - dalam hal penanganan yang salah dan non-eksekusi perintah

  ‚Ä¢ "ERROR: release range mismatch" - jika nomor relai tidak valid ditentukan 
	 dalam parameter fungsi Rrele untuk versi perangkat ini

  ‚Ä¢ "GALAT: melepaskan rezim yang mengatur ketidakcocokan" - dalam kasus tidak ditentukan atau salah 
     parameter yang ditentukan dari fungsi Rstatus ("on", "off", "inv")

  ‚Ä¢ "GALAT: perangkat tidak merespons" - jika tidak ada respons dari perangkat 
     untuk ping

  ‚Ä¢ "ERROR: command ROS &lt;fetch&gt;" - jika ada kesalahan secara langsung
     ketika menjalankan RouterOS mengambil perintah URL (biasanya jika tidak
     nomor port yang ditentukan di Rport, parameter Rlogine yang ditentukan salah
     dan / atau Rpass)
</pre></div></div><br>  Anda dapat memanggil fungsi kontrol relay pada PDU dari skrip Anda yang lain sebagai berikut: <br><br><ol><li>  Pertama, Anda perlu menjalankan skrip yang menempatkan fungsi yang diperlukan di lingkungan variabel repositori router.  Ini dapat dilakukan sekali, misalnya, ketika memulai router dari RouterOS Scheduler ( <b>/ system scheduler</b> ) <br><br><pre> <code class="hljs pgsql">#          /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> script run Func_RODOS10rele; #      ¬´FuncPing¬ª # (  FuncRODOS10rele) /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> script run Func_Ping;</code> </pre> </li><li>  Setelah fungsi-fungsi didefinisikan, Anda dapat menggunakannya (khususnya, panggil FuncRODOS10rele) <br><br>  Sebagai contoh, kita memanggil fungsi kita dengan menerapkan pulsa ke relai No. 4 dari PDU RODOS-10: <br><br><pre> <code class="hljs powershell">:global FuncRODOS10rele; :local Rodosanswer [<span class="hljs-variable"><span class="hljs-variable">$FuncRODOS10rele</span></span> <span class="hljs-type"><span class="hljs-type">Radr</span></span>=<span class="hljs-string"><span class="hljs-string">"192.168.1.20"</span></span> <span class="hljs-type"><span class="hljs-type">Rport</span></span>=<span class="hljs-string"><span class="hljs-string">"8021"</span></span> <span class="hljs-type"><span class="hljs-type">Rrele</span></span>=<span class="hljs-string"><span class="hljs-string">"4"</span></span> <span class="hljs-type"><span class="hljs-type">Rstatus</span></span>=<span class="hljs-string"><span class="hljs-string">"inv"</span></span> <span class="hljs-type"><span class="hljs-type">Rlogin</span></span>=<span class="hljs-string"><span class="hljs-string">"login"</span></span> <span class="hljs-type"><span class="hljs-type">Rpass</span></span>=<span class="hljs-string"><span class="hljs-string">"password"</span></span>]; :log info <span class="hljs-variable"><span class="hljs-variable">$Rodosanswer</span></span>;</code> </pre><br>  Respons akan dikembalikan ke variabel <b>Rodosanswer</b> dan, dalam hal ini, ditampilkan di log router. <br><br><h2>  Pustaka fungsi siap pakai untuk bekerja dengan PDU </h2><br>  Untuk kemudahan penggunaan, saya membuat perpustakaan fungsi untuk Rodos PDU model 8, 9, 10 dan 10 dari pelaksanaan DIN (perpustakaan versi 1.0 tanggal 25 Desember 2017).  Script perpustakaan digabungkan ke dalam file Func_RODOS.rsc, yang dapat diimpor ke RouterOS dengan perintah terminal utilitas WINBOX berikut: <br><br><pre> <code class="hljs swift">/<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> file= Func_RODOS.rsc</code> </pre> <br>  Proses impor dapat berlangsung dari 20 detik hingga 1 menit, tergantung pada model router Mikrotik (kecepatannya). <br>  Dalam hal ini, semua skrip yang sebelumnya tersedia di router tidak terpengaruh, fungsi dan skrip pustaka Func_RODOS ditambahkan ke skrip repositori yang ada. <br><br><div class="spoiler">  <b class="spoiler_title">Pustaka Rodos.rsc versi 1.0 berisi skrip berikut:</b> <div class="spoiler_text"><ul><li>  start_RODOS - menjalankan skrip ini menyetel semua fungsi ke variabel lingkungan </li><li>  Func_Ping - fungsi memeriksa alamat untuk "ping" </li><li>  Func_Mail - berfungsi untuk mengirim pesan sewenang-wenang ke surat administrator </li><li>  Func_RODOS8rele - fungsi kontrol relai RODOS-8 PDU </li><li>  Func_RODOS8reset - fungsi reset ("reset") dari relay PDU RODOS-8 </li><li>  Func_RODOS9rele - ... sama untuk model yang ditunjukkan ... </li><li>  Pengaturan Func_RODOS9 </li><li>  Func_RODOS10rele </li><li>  Pengaturan Func_RODOS10 </li><li>  call_example [...] - contoh panggilan fungsi perpustakaan </li><li>  Func_RODOS_lib - semua fungsi PDU (kecuali Ping dan Mail) dalam satu file skrip </li></ul></div></div><br>  Setelah mengimpor perpustakaan, Anda dapat menghapus fungsi dan skrip yang tidak perlu dari repositori, hanya menyisakan fungsi model dan skrip PDU Anda dengan fungsi FuncMail dan FuncPing. <br><br>  Di perpustakaan, untuk masing-masing model PDU yang didukung, ada juga fungsi reset ("reset") yang nyaman (ditandai dengan nama "~ reset").  Parameter fungsi reset mirip dengan parameter fungsi instalasi relai, dengan pengecualian pada parameter "Rstatus", yang tidak digunakan selama "reset" dan opsional opsional parameter Rtime, yang menentukan waktu dalam detik antara mematikan dan menghidupkan relai lagi (jika Rtime tidak dialihkan ke fungsi, digunakan secara default. waktu 5 detik). <br><br>  Fungsi boot ulang berfungsi sebagai berikut: <br><ol><li>  Relai yang ditentukan dikirim perintah mematikan </li><li>  Kemudian ia menunggu detik Rtime dengan perintah inklusi berikutnya.  Dalam hal ini, fungsi reset merujuk ke fungsi instalasi relai yang sesuai, yang harus ditentukan sebelum yang pertama </li></ol><br>  Jadi, jika, sebelum panggilan ke fungsi reset, relay tertentu dinyalakan, itu akan dimatikan dan setelah waktu yang ditentukan akan dihidupkan lagi (dan beban yang terhubung dengannya akan "reset").  Operasi serupa dilakukan pada relai mati, dan setelah fungsi diaktifkan, relai menjadi dinyalakan (yaitu, dalam hal ini fungsi memenuhi dirinya sebagai fungsi relai switching).  Lebih mudah menggunakan fungsi reset untuk me-reboot peralatan jaringan "hung" yang terhubung ke Rodos PDU (titik akses, router, sakelar, berbagai server, dll ...). <br><br>  Kode sumber pustaka Rodos.rsc (fungsi dan skrip, contoh mengaksesnya) ‚Äúdikomentari‚Äù dengan cukup rinci, yang mungkin berguna bagi mereka yang ingin memahami perpustakaan secara detail (atau mungkin memodifikasi sendiri, atau menulis versi Anda sendiri). <br><br>  Dalam contoh panggilan ke fungsi reboot, setelah fungsi tersebut berhasil, Anda dapat mengirim pesan ke alamat email administrator router (Anda dapat menentukan alamat email Anda dalam pengaturan variabel skrip).  Dalam hal ini, skrip menggunakan layanan surat RouterOS dari <b>/ tool e-mail</b> , yang parameternya harus dikonfigurasi dengan benar sebelumnya oleh Anda. <br><br><h2>  Rencana masa depan </h2><br>  Di masa depan, perpustakaan skrip untuk Rodos PDU akan diperluas - direncanakan untuk membuat fungsi untuk stasiun cuaca Internet RODOS-16, yang memiliki "on board", selain relay, jalur input / output dan sensor suhu / kelembaban / tekanan atmosfer.  Hal ini juga direncanakan untuk menerapkan pencatatan fungsi tidak hanya ke log dan surat router, tetapi juga ke nomor telepon yang ditentukan pilihan pengguna (dengan mengirim pesan SMS melalui modem router). <br><br>  Mungkin, dalam proses menggunakan perpustakaan oleh pengguna (termasuk pembaca materi ini), beberapa kesalahan akan terungkap, yang, sebagai aturan, tidak bisa dihindari selama pengembangan apa pun.  Harap beri tahu saya jika ada kesalahan, komentar, dan saran untuk perbaikannya. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan ke deskripsi perintah Fetch untuk router MikroTik</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan ke dokumentasi untuk PDU bekas</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tautan ke pustaka fungsi skrip untuk Rodos PDU</a> <br><br>  Serkov Sergey Vladimirovich, 26 Desember 2017 </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id410107/">https://habr.com/ru/post/id410107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id410093/index.html">Quadrocopter Kanada mematuhi perintah operator</a></li>
<li><a href="../id410095/index.html">Penggemar komputer merakit prosesor 8-bit dari bahan yang tersedia</a></li>
<li><a href="../id410099/index.html">MIT menjelaskan bagaimana kebiasaan terbentuk</a></li>
<li><a href="../id410103/index.html">DNA melalui mata seorang programmer</a></li>
<li><a href="../id410105/index.html">Antarmuka DALI dan Arduino. Surealisme nyata</a></li>
<li><a href="../id410109/index.html">Botnet Smominru membantu penyerang mendapatkan lebih dari $ 3,6 juta</a></li>
<li><a href="../id410111/index.html">Seorang kandidat untuk membran sel ditemukan di Titan</a></li>
<li><a href="../id410113/index.html">Kendaraan peluncuran terkecil berhasil meluncurkan satelit ke orbit</a></li>
<li><a href="../id410115/index.html">Mitap DIY Keenam di Grup Mail.Ru (18/02/2018)</a></li>
<li><a href="../id410117/index.html">Para peneliti telah menyarankan cara melacak smartphone dengan GPS dimatikan.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>