<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ò¢Ô∏è üíâ üëãüèª Toda la verdad sobre RTOS. Art√≠culo # 30. Inicializaci√≥n de Nucleus SE y procedimientos de inicio üéµ üßëüèº‚Äçü§ù‚Äçüßëüèª üñ•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cualquier sistema operativo tiene un mecanismo de inicio espec√≠fico. El principio de funcionamiento de este mecanismo para cada sistema es diferente. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toda la verdad sobre RTOS. Art√≠culo # 30. Inicializaci√≥n de Nucleus SE y procedimientos de inicio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460617/"><img src="https://habrastorage.org/webt/nr/me/cz/nrmeczn3tg-kdwyme6qgmd7ily4.jpeg"><br><br>  Cualquier sistema operativo tiene un mecanismo de inicio espec√≠fico.  El principio de funcionamiento de este mecanismo para cada sistema es diferente.  Por lo general, dicen que el sistema arranca (Eng. Boot), esta es una abreviatura de "bootstrap", que se refiere a la expresi√≥n "tirarse de una cerca por los bootstraps" c√≥mo el sistema se mueve independientemente de un estado en el que la memoria est√° llena de vac√≠o ( <i>aprox. traductor: si es absolutamente preciso, luego basura</i> ) a una ejecuci√≥n estable de programas.  Tradicionalmente, una peque√±a parte del programa se carga en la memoria; se puede almacenar en la ROM.  En el pasado, se pod√≠a ingresar usando los interruptores en la parte frontal de la computadora.  Este gestor de arranque lee un programa de arranque m√°s complejo que ya carg√≥ el sistema operativo.  Hoy, la computadora de escritorio arranca de la siguiente manera: el c√≥digo del BIOS busca dispositivos (discos duros, CD-ROM, memorias USB) desde los cuales arrancar, y luego arranca el sistema operativo. <br><br>  El sistema operativo para sistemas integrados tambi√©n se puede inicializar de manera similar.  Y, de hecho, se cargan los sistemas operativos integrados desarrollados sobre la base de los sistemas operativos de escritorio.  Pero en la mayor√≠a de los RTOS "cl√°sicos", se usa un m√©todo mucho m√°s simple (y por lo tanto m√°s r√°pido). <br><a name="habracut"></a><br>  El sistema operativo es parte del software.  Si este software ya est√° en la memoria (por ejemplo, en una forma u otra de ROM), solo debe asegurarse de que la secuencia de comandos de la CPU despu√©s del reinicio finalice con la ejecuci√≥n del c√≥digo de inicializaci√≥n del sistema operativo.  As√≠ es como funciona la mayor√≠a de RTOS, incluido Nucleus SE ( <i>nota del traductor: esto tambi√©n se aplica a nuestro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS MAX</a></i> ). <br><br>  La mayor√≠a de las herramientas de desarrollo de software integradas incluyen el c√≥digo de inicio necesario para manejar el reinicio de la CPU y el control de transferencia a la funci√≥n Punto de entrada en la funci√≥n <b>main ()</b> .  El c√≥digo redistribuible de Nucleus SE no se ocupa de este proceso, ya que debe ser lo m√°s port√°til posible.  En cambio, contiene la funci√≥n <b>main ()</b> , que toma el control de la CPU e inicializa e inicia el sistema operativo.  Esta caracter√≠stica se discutir√° en detalle a continuaci√≥n. <br><br><div class="spoiler">  <b class="spoiler_title">Art√≠culos anteriores de la serie:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 29.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Interrupciones en el n√∫cleo SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 28.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Temporizadores de software</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 27.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hora del sistema</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 26.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Canales: servicios auxiliares y estructuras de datos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 25.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Canales de datos: introducci√≥n y servicios b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 24.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Colas: servicios auxiliares y estructuras de datos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo 23.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Colas: introducci√≥n y servicios b√°sicos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Buzones: servicios auxiliares y estructuras de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Buzones: Introducci√≥n y servicios b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sem√°foros: servicios auxiliares y estructuras de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sem√°foros: introducci√≥n y servicios b√°sicos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grupos de banderas de eventos: servicios auxiliares y estructuras de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grupos de banderas de eventos: Introducci√≥n y servicios b√°sicos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Se√±ales</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Particiones de memoria: servicios y estructuras de datos</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Secciones de memoria: introducci√≥n y servicios b√°sicos.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Estructuras de datos de tareas y llamadas de API no compatibles</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Servicios para trabajar con tareas.</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas: configuraci√≥n e introducci√≥n a la API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programador: funciones avanzadas y preservaci√≥n del contexto</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Programador: implementaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nucleus SE: dise√±o interno y despliegue</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">N√∫cleo SE: Introducci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Otros servicios RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Interacci√≥n de tareas y sincronizaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas, cambio de contexto e interrupciones</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Tareas y planificaci√≥n</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS: estructura y modo en tiempo real</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Art√≠culo # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RTOS: introducci√≥n.</a> <br></div></div><br><h3>  Inicializaci√≥n de la memoria </h3><br>  Las declaraciones de todas las variables est√°ticas en el c√≥digo de Nucleus SE comienzan con el prefijo <b>ROM</b> o <b>RAM</b> para indicar d√≥nde deben ubicarse.  Estas dos directivas <b>#define</b> est√°n definidas en el archivo <b>nuse_types.h</b> y deben configurarse teniendo en cuenta los detalles del conjunto de herramientas de desarrollo utilizado (compilador y enlazador).  Por lo general, la <b>ROM</b> debe ser de tipo <b>const</b> ( <i>nota del traductor: desde mi experiencia, <b>const</b> no siempre es suficiente, la <b>est√°tica</b> es mejor</i> ) y la <b>RAM</b> es un valor vac√≠o. <br><br>  Todas <b>las</b> variables <b>ROM</b> se inicializan est√°ticamente, lo cual es l√≥gico.  <b>Las</b> variables de <b>RAM</b> no se inicializan est√°ticamente (ya que esto solo funciona con ciertas cajas de herramientas que est√°n configuradas para copiar autom√°ticamente de ROM a RAM);  Se incluye un c√≥digo de inicializaci√≥n expl√≠cito en la aplicaci√≥n y se describir√° en detalle a continuaci√≥n. <br><br>  Nucleus SE no almacena datos "constantes" en la RAM, que generalmente es escasa en sistemas peque√±os.  En lugar de utilizar estructuras de datos complejas para describir objetos del n√∫cleo, se utilizan conjuntos de tablas (matrices), que se colocan f√°cilmente en ROM o RAM, seg√∫n la necesidad. <br><br><h2>  Funci√≥n principal () </h2><br>  El siguiente es el c√≥digo completo para la funci√≥n <b>main ()</b> de Nucleus SE: <br><br><pre><code class="plaintext hljs">void main(void) { NUSE_Init(); /* initialize kernel data */ /* user initialization code here */ NUSE_Scheduler(); /* start tasks */ }</code> </pre> <br>  La secuencia de operaciones es bastante simple: <br><br><ul><li>  Primero, se <b>llama a la</b> funci√≥n <b>NUSE_Init ()</b> .  Inicializa todas las estructuras de datos de Nucleus SE y se describir√° en detalle a continuaci√≥n. </li><li>  Luego, el usuario puede insertar cualquier c√≥digo de inicializaci√≥n de la aplicaci√≥n que se ejecutar√° antes de que comience el programador de tareas.  Para obtener m√°s informaci√≥n sobre lo que se puede lograr con este c√≥digo, consulte m√°s adelante en este art√≠culo. </li><li>  Finalmente, se inicia el planificador de Nucleus SE ( <b>NUSE_Scheduler ()</b> ).  Esto tambi√©n se discutir√° en detalle m√°s adelante en este art√≠culo. </li></ul><br><h2>  Funci√≥n NUSE_Init () </h2><br>  Esta funci√≥n inicializa todas las variables de n√∫cleo y estructuras de datos de Nucleus SE. <br><br><div class="spoiler">  <b class="spoiler_title">A continuaci√≥n se muestra el c√≥digo de funci√≥n completo:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">void NUSE_Init(void) { U8 index; /* global data */ NUSE_Task_Active = 0; NUSE_Task_State = NUSE_STARTUP_CONTEXT; #if NUSE_SYSTEM_TIME_SUPPORT NUSE_Tick_Clock = 0; #endif #if NUSE_SCHEDULER_TYPE == NUSE_TIME_SLICE_SCHEDULER NUSE_Time_Slice_Ticks = NUSE_TIME_SLICE_TICKS; #endif /* tasks */ #if ((NUSE_SCHEDULER_TYPE != NUSE_RUN_TO_COMPLETION_SCHEDULER) || NUSE_SIGNAL_SUPPORT || NUSE_TASK_SLEEP || NUSE_SUSPEND_ENABLE || NUSE_SCHEDULE_COUNT_SUPPORT) for (index=0; index&lt;NUSE_TASK_NUMBER; index++) { NUSE_Init_Task(index); } #endif /* partition pools */ #if NUSE_PARTITION_POOL_NUMBER != 0 for (index=0; index&lt;NUSE_PARTITION_POOL_NUMBER; index++) { NUSE_Init_Partition_Pool(index); } #endif /* mailboxes */ #if NUSE_MAILBOX_NUMBER != 0 for (index=0; index&lt;NUSE_MAILBOX_NUMBER; index++) { NUSE_Init_Mailbox(index); } #endif /* queues */ #if NUSE_QUEUE_NUMBER != 0 for (index=0; index&lt;NUSE_QUEUE_NUMBER; index++) { NUSE_Init_Queue(index); } #endif /* pipes */ #if NUSE_PIPE_NUMBER != 0 for (index=0; index&lt;NUSE_PIPE_NUMBER; index++) { NUSE_Init_Pipe(index); } #endif /* semaphores */ #if NUSE_SEMAPHORE_NUMBER != 0 for (index=0; index&lt;NUSE_SEMAPHORE_NUMBER; index++) { NUSE_Init_Semaphore(index); } #endif /* event groups */ #if NUSE_EVENT_GROUP_NUMBER != 0 for (index=0; index&lt;NUSE_EVENT_GROUP_NUMBER; index++) { NUSE_Init_Event_Group(index); } #endif /* timers */ #if NUSE_TIMER_NUMBER != 0 for (index=0; index&lt;NUSE_TIMER_NUMBER; index++) { NUSE_Init_Timer(index); } #endif }</code> </pre><br></div></div><br>  Primero, se inicializan las variables globales: <br><ul><li>  <b>NUSE_Task_Active</b> : √≠ndice de la tarea activa, inicializado a cero;  luego esto puede cambiar el programador. </li><li>  <b>NUSE_Task_State</b> : inicializado con el valor <b>NUSE_STARTUP_CONTEXT</b> , que limita la funcionalidad de la API para cualquier c√≥digo de inicializaci√≥n de aplicaci√≥n posterior. </li><li>  Si el soporte de hora del sistema est√° activado, <b>NUSE_Tick_Clock se establece</b> en cero. </li><li>  Si el planificador Time Slice est√° activado, a <b>NUSE_Time_Slice_Ticks se le</b> asigna el valor configurado <b>NUSE_TIME_SLICE_TICKS</b> . </li></ul><br>  Luego se llaman las funciones para inicializar los objetos del n√∫cleo: <br><br><ul><li>  <b>NUSE_Init_Task ()</b> se llama para inicializar las estructuras de datos de cada tarea.  Esta llamada se omite solo si se usa el planificador Run to Completion, y las se√±ales, la pausa de la tarea y el contador de programaci√≥n no est√°n configurados (dado que esta combinaci√≥n de funciones dar√° como resultado la ausencia de estas estructuras de tareas en la RAM, por lo tanto, no se realizar√° la inicializaci√≥n). </li><li>  Se llama a <b>NUSE_Init_Partition_Pool ()</b> para inicializar cada objeto de grupo de particiones.  Estas llamadas se omiten si no se configuran grupos de particiones. </li><li>  Se llama a <b>NUSE_Init_Mailbox ()</b> para inicializar cada objeto de buz√≥n.  Estas llamadas se omiten si no hay buzones configurados. </li><li>  <b>NUSE_Init_Queue ()</b> se llama para inicializar cada objeto de cola.  Estas llamadas se omiten si no hay colas configuradas. </li><li>  Se llama a <b>NUSE_Init_Pipe ()</b> para inicializar cada objeto de canal.  Estas llamadas se omiten si no hay canales configurados. </li><li>  Se llama a <b>NUSE_Init_Semaphore ()</b> para inicializar cada objeto de sem√°foro.  Estas llamadas se omiten si no hay sem√°foros configurados. </li><li>  Se llama a <b>NUSE_Init_Event_Group ()</b> para inicializar cada objeto de grupo de eventos.  Estas llamadas se omiten si no hay grupos de eventos configurados. </li><li>  Se llama a <b>NUSE_Init_Timer ()</b> para inicializar cada objeto del temporizador.  Estas llamadas se omiten si no hay temporizadores configurados. </li></ul><br><h3>  Inicializaci√≥n de tareas </h3><br><div class="spoiler">  <b class="spoiler_title">El siguiente es el c√≥digo completo para la funci√≥n NUSE_Init_Task ():</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">void NUSE_Init_Task(NUSE_TASK task) { #if NUSE_SCHEDULER_TYPE != NUSE_RUN_TO_COMPLETION_SCHEDULER NUSE_Task_Context[task][15] = /* SR */ NUSE_STATUS_REGISTER; NUSE_Task_Context[task][16] = /* PC */ NUSE_Task_Start_Address[task]; NUSE_Task_Context[task][17] = /* SP */ (U32 *)NUSE_Task_Stack_Base[task] + NUSE_Task_Stack_Size[task]; #endif #if NUSE_SIGNAL_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Signal_Flags[task] = 0; #endif #if NUSE_TASK_SLEEP || NUSE_INCLUDE_EVERYTHING NUSE_Task_Timeout_Counter[task] = 0; #endif #if NUSE_SUSPEND_ENABLE || NUSE_INCLUDE_EVERYTHING #if NUSE_INITIAL_TASK_STATE_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Status[task] = NUSE_Task_Initial_State[task]; #else NUSE_Task_Status[task] = NUSE_READY; #endif #endif #if NUSE_SCHEDULE_COUNT_SUPPORT || NUSE_INCLUDE_EVERYTHING NUSE_Task_Schedule_Count[task] = 0; #endif }</code> </pre><br></div></div><br>  Si el planificador Ejecutar para completar no se ha configurado, <b>se</b> inicializa el bloque de contexto para la <b>tarea NUSE_Task_Context [tarea] []</b> .  La mayor√≠a de los elementos no son valores asignados, ya que representan registros de m√°quina comunes, que deben tener un valor intermedio al iniciar una tarea.  En el ejemplo (Freescale ColdFire) de la implementaci√≥n de Nucleus SE (pero para otros procesadores el mecanismo ser√° similar), las √∫ltimas tres entradas se establecen expl√≠citamente: <br><br><ul><li>  <b>NUSE_Task_Context [tarea] [15]</b> contiene el registro de estado ( <b>SR</b> , registro de estado) y tiene el valor de la directiva <b>#define NUSE_STATUS_REGISTER</b> . </li><li>  <b>NUSE_Task_Context [tarea] [16]</b> contiene el contador de programa ( <b>PC</b> , contador de programa) y tiene el valor de direcci√≥n del punto de entrada del c√≥digo de tarea: <b>NUSE_Task_Start_Address [tarea]</b> . </li><li>  <b>NUSE_Task_Context [tarea] [17]</b> contiene el puntero de pila ( <b>SP</b> , puntero de pila) y se inicializa con el valor calculado como la suma de la direcci√≥n de la pila de tareas ( <b>NUSE_Task_Stack_Base [tarea]</b> ) y el tama√±o de la pila de tareas ( <b>NUSE_Task_Stack_Size [tarea]</b> ). </li></ul><br>  Si el soporte de se√±al est√° activado, los indicadores de se√±al de tarea ( <b>NUSE_Task_Signal_Flags [tarea]</b> ) se establecen en cero. <br><br>  Si se activa la suspensi√≥n de la tarea (es decir, la llamada de servicio API <b>NUSE_Task_Sleep ()</b> ), el contador de tiempo de espera de la tarea ( <b>NUSE_Task_Timeout_Counter [tarea]</b> ) se establece en cero. <br><br>  Si el estado de suspensi√≥n de la tarea est√° activado, el estado de la tarea ( <b>NUSE_Task_Status [tarea]</b> ) se inicializa.  El usuario establece este valor inicial (en <b>NUSE_Task_Initial_State [tarea]</b> ) si el soporte para el estado inicial de la tarea est√° activado.  De lo contrario, el estado se asigna a <b>NUSE_READY</b> . <br><br>  Si el contador de planificaci√≥n est√° activado, el contador de tareas ( <b>NUSE_Task_Schedule_Count [tarea]</b> ) se establece en cero. <br><br><h3>  Inicializar agrupaciones de particiones </h3><br>  El siguiente es el c√≥digo completo para la funci√≥n <b>NUSE_Init_Partition_Pool ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Partition_Pool(NUSE_PARTITION_POOL pool) { NUSE_Partition_Pool_Partition_Used[pool] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Partition_Pool_Blocking_Count[pool] = 0; #endif }</code> </pre><br>  El contador del grupo de particiones "usado" ( <b>NUSE_Partition_Pool__Partition_Used [pool]</b> ) se establece en cero. <br><br>  Si el bloqueo de tareas est√° activado, el contador de tareas bloqueadas de los grupos de particiones ( <b>NUSE_Partition_Pool_Blocking_Count [grupo]) se establece</b> en cero. <br><br><h3>  Inicializando buzones </h3><br>  A continuaci√≥n se muestra el <b>c√≥digo</b> completo <b>NUSE_Init_Mailbox ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Mailbox(NUSE_MAILBOX mailbox) { NUSE_Mailbox_Data[mailbox] = 0; NUSE_Mailbox_Status[mailbox] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Mailbox_Blocking_Count[mailbox] = 0; #endif }</code> </pre><br>  El almac√©n de datos del buz√≥n ( <b>NUSE_Mailbox_Data [buz√≥n]</b> ) se establece en cero, y el estado ( <b>NUSE_Mailbox_Status [buz√≥n]</b> ) se vuelve "no utilizado" (es decir, cero). <br><br>  Si el bloqueo de tareas est√° activado, el contador de tareas de buz√≥n bloqueado ( <b>NUSE_Mailbox_Blocking_Count [buz√≥n]</b> ) se establece en cero. <br><br><h3>  Inicializaci√≥n de cola </h3><br>  El siguiente es el c√≥digo completo para la funci√≥n <b>NUSE_Init_Queue ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Queue(NUSE_QUEUE queue) { NUSE_Queue_Head[queue] = 0; NUSE_Queue_Tail[queue] = 0; NUSE_Queue_Items[queue] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Queue_Blocking_Count[queue] = 0; #endif }</code> </pre><br>  Los punteros al principio y al final de la cola (de hecho, estos son los √≠ndices <b>NUSE_Queue_Head [queue</b> ] y <b>NUSE_Queue_Tail [queue]</b> ) son valores asignados que indican el comienzo del √°rea de datos de las colas (es decir, toman un valor cero).  El contador en la cola ( <b>NUSE_Queue_Items [queue]</b> ) tambi√©n se establece en cero. <br><br>  Si el bloqueo de tareas est√° activado, el contador de tareas de cola bloqueadas ( <b>NUSE_Queue_Blocking_Count [cola]</b> ) se establece en cero. <br><br><h3>  Inicializaci√≥n de canal </h3><br>  El siguiente es el c√≥digo completo para la funci√≥n <b>NUSE_Init_Pipe ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Pipe(NUSE_PIPE pipe) { NUSE_Pipe_Head[pipe] = 0; NUSE_Pipe_Tail[pipe] = 0; NUSE_Pipe_Items[pipe] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Pipe_Blocking_Count[pipe] = 0; #endif }</code> </pre><br>  Los punteros al principio y al final del canal (de hecho, estos son los √≠ndices: <b>NUSE_Pipe_Head [pipe]</b> y <b>NUSE_Pipe_Tail [pipe]</b> ) tienen asignado un valor que indica el comienzo del √°rea de datos del canal (es decir, toman un valor nulo).  El <b>contador de</b> canal ( <b>NUSE_Pipe_Items [pipe]</b> ) tambi√©n se establece en cero. <br><br>  Si el bloqueo de tareas est√° activado, el contador de tareas bloqueadas del canal ( <b>NUSE_Pipe_Blocking_Count [pipe]</b> ) se establece en cero. <br><br><h3>  Inicializaci√≥n de sem√°foro </h3><br>  El siguiente es el c√≥digo completo para la funci√≥n <b>NUSE_Init_Semaphore ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Semaphore(NUSE_SEMAPHORE semaphore) { NUSE_Semaphore_Counter[semaphore] = NUSE_Semaphore_Initial_Value[semaphore]; #if NUSE_BLOCKING_ENABLE NUSE_Semaphore_Blocking_Count[semaphore] = 0; #endif }</code> </pre><br>  El contador de sem√°foros ( <b>NUSE_Semaphore_Counter [semaphore]</b> ) se inicializa con el valor establecido por el usuario ( <b>NUSE_Semaphore_Initial_Value [semaphore]</b> ). <br><br>  Si el bloqueo de tareas est√° activado, el contador de tareas de sem√°foro bloqueado ( <b>NUSE_Semaphore_Blocking_Count [semaphore]</b> ) se establece en cero. <br><br><h3>  Inicializando grupos de eventos </h3><br>  El siguiente es el c√≥digo completo para la funci√≥n <b>NUSE_Init_Event_Group ()</b> : <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Event_Group(NUSE_EVENT_GROUP group) { NUSE_Event_Group_Data[group] = 0; #if NUSE_BLOCKING_ENABLE NUSE_Event_Group_Blocking_Count[group] = 0; #endif }</code> </pre><br>  Los indicadores del grupo de eventos se restablecen, es decir  <b>NUSE_Event_Group_Data [grupo] tiene</b> asignado un valor nulo. <br><br>  Si el bloqueo de tareas est√° activado, el contador de tareas bloqueadas del grupo de indicadores de eventos ( <b>NUSE_Event_Group_Blocking_Count [grupo]</b> ) se establece en cero. <br><br><h3>  Inicializaci√≥n del temporizador </h3><br>  A continuaci√≥n se muestra el c√≥digo completo de <b>NUSE_Init_Timer ()</b> ; <br><br><pre> <code class="plaintext hljs">void NUSE_Init_Timer(NUSE_TIMER timer) { NUSE_Timer_Status[timer] = FALSE; NUSE_Timer_Value[timer] = NUSE_Timer_Initial_Time[timer]; NUSE_Timer_Expirations_Counter[timer] = 0; }</code> </pre><br>  El estado del temporizador ( <b>NUSE_Timer_Status [timer]</b> ) se establece en "no utilizado", es decir  <b>FALSO</b> <br><br>  El valor de la cuenta regresiva ( <b>NUSE_Timer_Value [timer</b> ]) se inicializa mediante el valor establecido por el usuario ( <b>NUSE_Timer_Initial_Time [timer]</b> ). <br><br>  El contador de finalizaci√≥n ( <b>NUSE_Timer_Expirations_Counter [timer]</b> ) se establece en cero. <br><br><h2>  Inicializando el c√≥digo de aplicaci√≥n </h2><br>  Una vez que se han inicializado las estructuras de datos de Nucleus SE, es posible ejecutar el c√≥digo responsable de inicializar la aplicaci√≥n antes de comenzar la tarea.  Esta caracter√≠stica puede ser √∫til para las siguientes tareas: <br><br><ul><li>  Inicializaci√≥n de estructuras de datos de aplicaci√≥n.  El llenado expl√≠cito de estructuras de datos es m√°s f√°cil de entender y depurar en comparaci√≥n con la inicializaci√≥n autom√°tica de variables est√°ticas. </li><li>  Asignaci√≥n de objetos del n√∫cleo.  Dado que todos los objetos del n√∫cleo se crean est√°ticamente en la etapa de construcci√≥n y se identifican utilizando valores de √≠ndice, puede ser √∫til asignar un "propietario" o determinar el uso de estos objetos.  Esto se puede hacer usando la directiva #define, sin embargo, si hay varias instancias de tareas, es mejor asignar √≠ndices de objeto a trav√©s de matrices globales (indexadas por ID de tarea). </li><li>  Inicializaci√≥n del dispositivo.  Esto puede ser √∫til para la instalaci√≥n inicial de perif√©ricos. </li></ul><br>  Obviamente, muchos de estos objetivos se pueden lograr antes de la inicializaci√≥n de Nucleus SE, pero la ventaja en la ubicaci√≥n del c√≥digo de la aplicaci√≥n aqu√≠ es que ahora puede usar los servicios del n√∫cleo (llamadas API).  Por ejemplo, una cola o un buz√≥n de correo puede rellenarse previamente con datos que deber√°n procesarse cuando comience la tarea. <br><br>  Las llamadas a la API tienen una restricci√≥n: todas las acciones que generalmente conducen a la activaci√≥n del programador est√°n prohibidas (por ejemplo, pausar / bloquear tareas).  La variable global <b>NUSE_Task_State se</b> ha establecido en <b>NUSE_STARTUP_CONTEXT</b> para <b>indicar</b> esta limitaci√≥n. <br><br><h2>  Planificador de lanzamiento </h2><br>  Una vez completada la inicializaci√≥n, solo queda ejecutar el programador para comenzar a ejecutar el c√≥digo de la aplicaci√≥n: tareas.  La configuraci√≥n del programador y el trabajo de varios tipos de programadores se describieron en detalle en uno de los art√≠culos anteriores ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="># 9</a> ), por lo que aqu√≠ solo se requiere un breve resumen. <br>  La secuencia de pasos clave es la siguiente: <br><br><ul><li>  <b>Establecer la</b> variable global <b>NUSE_Task_State en</b> <b>NUSE_TASK_CONTEXT</b> . </li><li>  Seleccione el √≠ndice de la primera tarea a ejecutar.  Si se activa el soporte para la tarea inicial, se realiza la b√∫squeda de la primera tarea finalizada; de lo contrario, se utiliza un valor cero. </li><li>  El planificador se <b>llama</b> - <b>NUSE_Scheduler ()</b> . </li></ul><br>  Lo que sucede exactamente en el √∫ltimo paso depende del planificador seleccionado.  Cuando se usa el programador Ejecutar para completar, se inicia un ciclo de planificaci√≥n y las tareas se llaman secuencialmente.  Cuando se usan otros planificadores, el contexto de la primera tarea se carga y el control se transfiere a la tarea. <br><br>  El siguiente art√≠culo discutir√° el diagn√≥stico y la verificaci√≥n de errores. <br><br>  <b>Sobre el autor:</b> Colin Walls ha trabajado en la industria electr√≥nica durante m√°s de treinta a√±os, dedicando la mayor parte de su tiempo al firmware.  Ahora es ingeniero de firmware en Mentor Embedded (una divisi√≥n de Mentor Graphics).  Colin Walls a menudo habla en conferencias y seminarios, autor de numerosos art√≠culos t√©cnicos y dos libros sobre firmware.  Vive en el Reino Unido.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Blog</a> profesional <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de Colin</a> , correo electr√≥nico: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460617/">https://habr.com/ru/post/460617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460603/index.html">V2G. Los autos el√©ctricos ayudar√°n a equilibrar la producci√≥n y el consumo de electricidad.</a></li>
<li><a href="../460605/index.html">Estudio fotogr√°fico autom√°tico, parte 1</a></li>
<li><a href="../460607/index.html">Tienda de aplicaciones de seguridad ofensiva con herramientas de hackeo de Android</a></li>
<li><a href="../460611/index.html">Conmutaci√≥n por error: el perfeccionismo nos arruina y ... la pereza</a></li>
<li><a href="../460615/index.html">A ra√≠z de Industrial Ninja: c√≥mo se pirate√≥ PLC en Positive Hack Days 9</a></li>
<li><a href="../460621/index.html">Tic Tac Toe Parte 4: Interactuar con el backend de Flask usando HTTP</a></li>
<li><a href="../460623/index.html">Sobre la tortura de Julian Assange</a></li>
<li><a href="../460625/index.html">Como no ocup√© el primer lugar en la competencia para desarrolladores de JavaScript de Telegram</a></li>
<li><a href="../460627/index.html">vGPU: el uso no se puede ignorar</a></li>
<li><a href="../460629/index.html">La probabilidad de que 2 mineros tengan el mismo mundo.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>