<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¥Ô∏è üçö ü§∑üèº Surveillance des applications avec Logger.Backends üåä üîê ‚ôëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Elixir utilise pleinement l'infrastructure de journalisation d' Erlang pour cr√©er des journaux. √Ä partir de la version 1.10 , qui doit √™tre publi√©e pr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance des applications avec Logger.Backends</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482626/"><p>  <em>Elixir</em> utilise pleinement l'infrastructure de journalisation d' <em>Erlang</em> pour cr√©er des journaux.  √Ä partir de la version <em>1.10</em> , qui doit √™tre publi√©e prochainement, de nouvelles fonctions de journalisation des utilisateurs apparues dans <em>Erlang / OTP 21+</em> sont √† notre disposition. </p><br><p> Tandis <em>qu'OTP</em> fournit toute l'infrastructure pour fournir des √©v√©nements de journal (√©v√©nements) aux abonn√©s, la journalisation elle-m√™me, si elle est comprise comme <em>stockant</em> et / ou <em>affichant</em> des √©v√©nements de journal, doit √™tre impl√©ment√©e par l'application.  √Ä cet effet, l'abstraction correspondante de <code>Logger.Backend</code> . </p><a name="habracut"></a><br><p>  Voici un extrait de la documentation officielle: </p><br><blockquote>  <code>Logger</code> prend en charge divers backends o√π les messages de journal sont √©crits. <br><br>  Les backends disponibles par d√©faut sont limit√©s √† un: <br><ul><li>  <code>:console</code> - enregistre les messages sur la console (activ√© par d√©faut) </li></ul><br><br>  Tout d√©veloppeur peut cr√©er sa propre moisson comme un backend pour <code>Logger</code> .  √âtant donn√© que <code>Logger</code> est un gestionnaire d'√©v√©nements qui impl√©mente le comportement Erlang <code>:gen_event</code> , l'√©criture d'un nouveau backend consiste simplement √† cr√©er votre propre gestionnaire d'√©v√©nements, comme d√©crit dans la documentation de <code>:gen_event</code> . </blockquote><p>  Les backends utilis√©s sont charg√©s via la section <code>:backends</code> du fichier de configuration, qui doit √™tre trait√©e avant de lancer l'application <code>:logger</code> . </p><br><p>  L'approche la plus courante qui a donn√© naissance √† un grand nombre du m√™me type de biblioth√®ques <a href="https://hex.pm/" rel="nofollow"><code>hex.pm</code></a> consiste √† cr√©er <code>Logger.Backend</code> , qui comprend et crache la console JSON, et √† visser une sorte de livraison de journal l√† o√π vous en avez besoin (g√©n√©ralement c'est une sorte de <code>LaaS</code> ) .  Ainsi, tous les journaux se retrouvent g√©n√©ralement dans une <em>base de donn√©es NoSQL</em> , comme <em>Elastic</em> , ou quelque chose de similaire. </p><br><p>  Nous ne sommes pas devenus originaux et nous stockons √©galement nos journaux dans <em>Elastic</em> , mais maintenant les journaux seuls ne suffisent plus: les gar√ßons √† la mode modernes s'accrochent √† tous les messages dans les journaux - des mesures pour tout sur tout.  La norme de facto pour travailler avec des m√©triques dans les applications <em>OTP</em> a r√©cemment √©t√© la biblioth√®que de <a href="https://www.erlang-solutions.com/blog/introducing-telemetry.html" rel="nofollow">t√©l√©m√©trie</a> , un projet open source relativement r√©cent visant √† unifier et √† normaliser la fa√ßon dont les biblioth√®ques et les applications BEAM sont <em>instrument√©es</em> et <em>contr√¥l√©es</em> . </p><br><p>  L'approche adopt√©e par la <em>t√©l√©m√©trie</em> est simple au <a href="https://hexdocs.pm/telemetry/telemetry.html" rel="nofollow"><code>:telemetry.execute/2</code></a> horreur: nous appelons <a href="https://hexdocs.pm/telemetry/telemetry.html" rel="nofollow"><code>:telemetry.execute/2</code></a> chaque fois qu'il y a un besoin de mesurer quelque chose dans l'application, et la biblioth√®que r√©pond avec le rappel enregistr√© au d√©but de l'application.  De plus, il est possible d'attacher <a href="https://hexdocs.pm/telemetry_poller" rel="nofollow"><code>Telemetry.Poller</code></a> et d'effectuer p√©riodiquement des requ√™tes m√©triques.  L'exemple dans l'article auquel j'ai donn√© le lien ci-dessus sugg√®re d'appeler <a href="https://hexdocs.pm/logger/Logger.html" rel="nofollow"><code>Logger.log/3</code></a> partir du gestionnaire d'√©v√©nements de <em>t√©l√©m√©trie</em> interne. </p><br><h3 id="gelato"> <code>Gelato</code> </h3> <br><p>  Je d√©teste le code passe-partout que vous devez faire glisser-copier de projet en projet, de fichier en fichier.  Je veux que tout ce qui peut √™tre fait par le compilateur, le planificateur et les travailleurs soit fait pour que je n'y pense m√™me pas.  Pour ce faire, j'emballe souvent le code passe-partout dans de minuscules biblioth√®ques qui cachent tous les passe-partout n√©cessaires sous le capot et fournissent des interfaces propres pour effectuer les actions n√©cessaires √† notre application.  Je voudrais juste quelque chose qui puisse √™tre appel√© comme <code>report("message", payload)</code> pour cr√©er un enregistrement, ajouter des donn√©es de t√©l√©m√©trie et envoyer cet enregistrement √† notre stockage √©lastique. </p><br><p>  Il s'av√®re que ce n'est pas si difficile √† faire. </p><br><p>  Nous avons d√©cid√© d'utiliser les appels <code>Logger</code> standard comme interface, afin qu'en changeant simplement les configurations, nous puissions introduire la fonctionnalit√© souhait√©e dans les projets existants.  Ajoutez simplement un nouveau <code>Logger.Backend</code> √† un projet existant: </p><br><pre> <code class="ruby hljs">config <span class="hljs-symbol"><span class="hljs-symbol">:logger</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">backends:</span></span> [Our.Fancy.Logger.Backend]</code> </pre> <br><p>  - et voil√† - les journaux avec t√©l√©m√©trie sont d√©sormais envoy√©s dans un bunker √©lastique. </p><br><p>  Et c'est ainsi que la biblioth√®que <a href="https://hexdocs.pm/gelato/" rel="nofollow"><code>Gelato</code></a> a vu le jour.  Je sais que les vrais d√©veloppeurs s√©rieux et r√©fl√©chis, comme les biblioth√®ques, doivent √™tre appel√©s un peu moins √©sot√©riquement, mais je ne suis pas un vrai d√©veloppeur.  Ce qui est, vous devez vous r√©concilier.  Bien que le <em>gelato</em> (en espagnol - la cr√®me glac√©e, soit dit en passant) soit m√™me un peu en phase avec l'√©lasticit√©. </p><br><p>  La biblioth√®que est tr√®s concentr√©e sur la fa√ßon dont je vois le bon monde, et dans la queue et la crini√®re utilise l'approche de ¬´convention au-dessus de la configuration¬ª.  Il regroupe tout ce dont vous pourriez avoir besoin dans un seul <em>JSON</em> et l'envoie √† un serveur √©lastique pr√©configur√© avec une simple requ√™te HTTP.  Il joint √©galement toutes les m√©tadonn√©es qu'il peut atteindre, telles que les mesures obtenues √† l'aide de <a href="https://hexdocs.pm/elixir/master/Process.html%3F" rel="nofollow"><code>Process.info/1</code></a> , etc. </p><br><p>  Pour commencer √† utiliser cette biblioth√®que dans un projet, vous devez ajouter ce qui suit √† votre fichier <code>config/releases.exs</code> : </p><br><pre> <code class="ruby hljs">config <span class="hljs-symbol"><span class="hljs-symbol">:gelato</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">uri:</span></span> <span class="hljs-string"><span class="hljs-string">"http://127.0.0.1:9200"</span></span>, <span class="hljs-comment"><span class="hljs-comment"># Elastic API endoint events: [:foo, :bar], # attached telemetry events handler: :elastic # or :console for tests config :logger, backends: [Gelato.Logger.Backend], level: :info</span></span></code> </pre> <br><p>  Apr√®s cela, tout appel <code>Logger.log/3</code> comme celui ci-dessous sera transmis par <code>telemetry</code> et envoy√© au serveur √©lastique configur√©. </p><br><pre> <code class="ruby hljs">Logger.info <span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">question:</span></span> <span class="hljs-string"><span class="hljs-string">"why?"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">answer:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">now:</span></span> System.monotonic_time(<span class="hljs-symbol"><span class="hljs-symbol">:microsecond</span></span>)</code> </pre> <br><p>  La biblioth√®que pr√©sente √©galement la macro <a href="https://hexdocs.pm/gelato/Gelato.html" rel="nofollow"><code>Gelato.bench/4</code></a> , qui prend un bloc et effectue deux appels √† <code>Logger.log/3</code> : un avant l'ex√©cution du bloc et l'autre imm√©diatement apr√®s, par type d'aspects en Java. </p><br><p>  <code>Gelato</code> insiste discr√®tement sur une meilleure organisation des interfaces au sein des projets en utilisant la macro <a href="https://hexdocs.pm/gelato/Gelato.html" rel="nofollow"><code>Gelato.defdelegatelog/2</code></a> , la composition simple <code>Gelato.bench/4</code> et <code>Kernel.defdelegate/2</code> .  √Ä l'aide de cette macro, vous pouvez extraire toutes les interfaces du projet dans un ensemble limit√© de modules de niveau sup√©rieur et effectuer ces appels enregistr√©s avec la t√©l√©m√©trie hors de la bo√Æte. </p><br><h3 id="enviolog"> <code>EnviÃÅo.Log</code> </h3> <br><p>  <code>Logger.Backend</code> autre impl√©mentation de <code>Logger.Backend</code> qui est n√©e dans notre coin de passion technologique.  Il utilise la biblioth√®que <a href="https://hexdocs.pm/envio" rel="nofollow"><code>EnviÃÅo</code></a> pour envoyer des messages √† un canal <em>Slack</em> d√©di√©.  Cet enregistreur a son propre param√®tre <code>log_level</code> , dont la valeur est g√©n√©ralement d√©finie sur <code>:warn</code> ou <code>:error</code> , pour emp√™cher le canal <em>Slack</em> d'√™tre spamm√©, et tous les appels √† des niveaux inf√©rieurs √† ceux configur√©s seront supprim√©s de <em>BEAM</em> lors de la compilation. </p><br><p>  Une configuration typique ressemblerait √† ceci: </p><br><pre> <code class="ruby hljs">config <span class="hljs-symbol"><span class="hljs-symbol">:envio</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:log</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">level:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:warn</span></span>, <span class="hljs-comment"><span class="hljs-comment"># do not send :info to Slack process_info: false # do not attach process info config :logger, backends: [Envio.Log.Backend], level: :debug config :envio, :backends, %{ Envio.Slack =&gt; %{ {Envio.Log.Publisher, :info} =&gt; [ hook_url: {:system, "YOUR_SLACK_CHANNEL_API_ENDPOINT"} ] } }</span></span></code> </pre> <br><p>  Apr√®s la configuration, tous les appels √† l' <code>Logger.{warn,error}/2</code> seront envoy√©s au canal <em>Slack</em> correspondant.  Il est tr√®s pratique pour surveiller les processus de travail en production en temps r√©el. </p><br><p>  Bonne journalisation! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr482626/">https://habr.com/ru/post/fr482626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr482610/index.html">Lancez l'√©cran TFT transflectif sur SSD1283A avec STM32</a></li>
<li><a href="../fr482612/index.html">Busi-board d'ing√©nierie touchante, nouvel an et b√©n√©voles</a></li>
<li><a href="../fr482614/index.html">L'utilisation de BSP dans Doom est-elle vraiment une initiative ing√©nieuse?</a></li>
<li><a href="../fr482620/index.html">Slurm: Habr, bonnes vacances ...</a></li>
<li><a href="../fr482622/index.html">Simulation de courir sous la pluie</a></li>
<li><a href="../fr482628/index.html">Regardez "Little Green Spider of Time"</a></li>
<li><a href="../fr482634/index.html">Mais l'essence est quelque chose, ou minimiser le code source est plus facile qu'il n'y para√Æt.</a></li>
<li><a href="../fr482636/index.html">Exp√©rience d'admission dans une magistrature en Allemagne (analyse d√©taill√©e)</a></li>
<li><a href="../fr482642/index.html">OSCD: Sprint Detection Sprint # 1, r√©sultats</a></li>
<li><a href="../fr482644/index.html">Enregistreur de frappe pour Windows avec changement de droits dans DACL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>