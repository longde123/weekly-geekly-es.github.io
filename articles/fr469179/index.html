<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌞 💅🏼 👴🏾 Une brève introduction à Kustomize 👇🏼 🍑 ☑️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : L'article a été écrit par Scott Lowe, un ingénieur informatique senior qui est l'auteur / co-auteur de sept livres imprimés (princip...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Une brève introduction à Kustomize</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/469179/"> <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: L'article a été écrit par Scott Lowe, un ingénieur informatique senior qui est l'auteur / co-auteur de sept livres imprimés (principalement pour VMware vSphere).</i>  <i>Il travaille actuellement dans sa filiale VMware, Heptio (acquise en 2016), spécialisée dans le cloud computing et Kubernetes.</i>  <i>Le texte lui-même sert d'introduction vaste et facile à comprendre à la gestion de la configuration pour Kubernetes à l'aide de la technologie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kustomize</a> , récemment incluse avec les K8.</i> <br><br><img src="https://habrastorage.org/webt/3k/3j/if/3k3jifu6nisnqt_nghi6iitekoy.png"><br><br>  Kustomize est un outil qui permet aux utilisateurs de "personnaliser des fichiers YAML simples et sans modèle à diverses fins, en laissant le YAML d'origine intact et utilisable" (la description est empruntée directement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">au référentiel kustomize sur GitHub</a> ).  Kustomize peut être exécuté directement ou, à partir de Kubernetes 1.14, utiliser <code>kubectl -k</code> pour accéder à ses fonctions (bien que depuis Kubernetes 1.15, un binaire distinct soit plus récent que les fonctionnalités intégrées à kubectl).  <i>( <b>Remarque</b> : Avec la récente version de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes 1.16</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">kustomize est</a> également <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pris</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">charge</a> dans l'utilitaire kubeadm.)</i> Dans cet article, je souhaite présenter aux lecteurs les bases de kustomize. <a name="habracut"></a><br><br>  Dans sa forme / application la plus simple, kustomize est simplement une collection de ressources (fichiers YAML qui définissent les objets Kubernetes: déploiements, services, etc.) plus une liste d'instructions sur les modifications à apporter à ces ressources.  Tout comme make utilise le jeu d'instructions contenu dans le <code>Makefile</code> et Docker <code>Dockerfile</code> conteneur basé sur les instructions du <code>Dockerfile</code> , kustomize utilise <code>kustomization.yaml</code> pour stocker des instructions sur les modifications que l'utilisateur souhaite apporter au jeu de ressources. <br><br>  Voici un exemple de fichier <code>kustomization.yaml</code> : <br><br><pre> <code class="plaintext hljs">resources: - deployment.yaml - service.yaml namePrefix: dev- namespace: development commonLabels: environment: development</code> </pre> <br>  Je n'essaierai pas de parler de tous les champs possibles du fichier <code>kustomization.yaml</code> (c'est bien écrit <a href="">ici</a> ), mais je donnerai une brève explication d'un exemple spécifique: <br><br><ul><li>  Le champ des <code>resources</code> indique quelles (quelles ressources) kustomize va changer.  Dans ce cas, il recherchera des ressources dans les fichiers <code>deployment.yaml</code> et <code>service.yaml</code> dans son répertoire (si nécessaire, vous pouvez spécifier des chemins d'accès complets ou relatifs). </li><li>  Le champ <code>namePrefix</code> demande à kustomize d'ajouter un préfixe spécifique (dans ce cas, <code>dev-</code> ) à l'attribut <code>name</code> de toutes les ressources définies dans le champ <code>resources</code> .  Ainsi, s'il existe un <code>name</code> dans Deployment avec la valeur <code>nginx-deployment</code> , kustomize en fera <code>dev-nginx-deployment</code> . </li><li>  Le champ d' <code>namespace</code> demande à kustomize d'ajouter l'espace de noms spécifié à toutes les ressources.  Dans ce cas, Deployment and Service tombera dans l'espace de noms de <code>development</code> . </li><li>  Enfin, le champ <code>commonLabels</code> contient un ensemble d'étiquettes qui seront ajoutées à toutes les ressources.  Dans notre exemple, kustomize attribuera une étiquette aux ressources avec l' <code>environment</code> nom et le <code>development</code> valeur. </li></ul><br>  Si l'utilisateur exécute <code>kustomize build .</code>  dans le répertoire avec le fichier <code>kustomization.yaml</code> et les ressources nécessaires (c'est-à-dire les fichiers <code>deployment.yaml</code> et <code>service.yaml</code> ), puis à la sortie, il recevra le texte avec les modifications enregistrées dans <code>kustomization.yaml</code> . <br><br><img src="https://habrastorage.org/webt/nv/sf/uy/nvsfuyar7x570ia_zrcp_v4lohi.jpeg"><br>  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: Illustration tirée de la documentation du projet pour l'utilisation «simple» de kustomize</i> <br><br>  La sortie peut être redirigée si vous devez valider les modifications: <br><br><pre> <code class="bash hljs">kustomize build . &gt; custom-config.yaml</code> </pre> <br>  La sortie est déterministe (avec la même entrée, la même sortie sera obtenue), vous ne pouvez donc pas enregistrer le résultat dans un fichier.  Au lieu de cela, vous pouvez immédiatement le passer à une autre commande: <br><br><pre> <code class="bash hljs">kustomize build . | kubectl apply -f -</code> </pre> <br>  Les fonctions Kustomize sont également accessibles via <code>kubectl -k</code> (depuis la version 1.14 de Kubernetes).  Cependant, gardez à l'esprit qu'un package kustomize distinct est mis à jour plus rapidement qu'un package intégré dans kubectl (du moins c'est le cas avec la version de Kubernetes 1.15). <br><br>  Les lecteurs peuvent demander: «Pourquoi toutes ces difficultés, si vous pouvez éditer des fichiers directement?».  Grande question.  Dans notre exemple, il est vraiment <i>possible de</i> modifier directement les fichiers <code>deployment.yaml</code> et <code>service.yaml</code> , mais qu'en est-il s'ils sont un fork du projet de quelqu'un d'autre?  La modification directe des fichiers rend difficile (voire impossible) le rebasage du fork lorsque des modifications sont apportées à la source / source.  L'utilisation de kustomize vous permet de centraliser ces modifications dans le fichier <code>kustomization.yaml</code> , en laissant les fichiers d'origine intacts et en facilitant ainsi le rebase des fichiers source si nécessaire. <br><br>  Les avantages de kustomize deviennent évidents dans des cas d'utilisation plus complexes.  Dans l'exemple ci-dessus, <code>kustomization.yaml</code> et les ressources se trouvent dans le même répertoire.  Cependant, kustomize prend en charge les scénarios d'utilisation lorsqu'il existe une configuration de base et plusieurs de ses variantes, également appelées <i>superpositions</i> .  Par exemple, un utilisateur voulait prendre Déploiement et Service pour nginx, que j'ai utilisé comme exemple, et créer des versions (ou variantes) de développement, de transfert et de production (ou variantes) de ces fichiers.  Pour ce faire, il aura besoin des superpositions mentionnées ci-dessus et, en fait, des ressources de base elles-mêmes. <br><br>  Pour illustrer l'idée de superpositions et <i>de ressources de base</i> , supposons que les répertoires aient la structure suivante: <br><br><pre> <code class="plaintext hljs">- base - deployment.yaml - service.yaml - kustomization.yaml - overlays - dev - kustomization.yaml - staging - kustomization.yaml - prod - kustomization.yaml</code> </pre> <br>  Dans le <code>base/kustomization.yaml</code> utilisateurs utilisent simplement le champ des <code>resources</code> pour déclarer les ressources que kustomize doit activer. <br><br>  Dans chacun des <code>overlays/{dev,staging,prod}/kustomization.yaml</code> utilisateurs se réfèrent à la configuration de base dans le champ des <code>resources</code> , puis indiquent les modifications spécifiques à <i>cet environnement</i> .  Par exemple, le <code>overlays/dev/kustomization.yaml</code> peut ressembler à l'exemple donné précédemment: <br><br><pre> <code class="plaintext hljs">resources: - ../../base namePrefix: dev- namespace: development commonLabels: environment: development</code> </pre> <br>  Dans le même temps, le <code>overlays/prod/kustomization.yaml</code> peut être complètement différent: <br><br><pre> <code class="plaintext hljs">resources: - ../../base namePrefix: prod- namespace: production commonLabels: environment: production sre-team: blue</code> </pre> <br>  Lorsque l'utilisateur démarre la <code>kustomize build .</code>  dans le <code>overlays/dev</code> , kustomize générera une option de développement.  Si vous exécutez <code>kustomize build .</code>  dans le répertoire <code>overlays/prod</code> - vous obtenez l'option de production.  Et tout cela - sans apporter de modifications aux fichiers <i>(de base) d'origine</i> , et tout cela - de manière déclarative et déterministe.  Vous pouvez valider la configuration de base et les répertoires de superposition directement dans le système de contrôle de version, sachant qu'à partir de ces fichiers, vous pouvez reproduire la configuration souhaitée à tout moment. <br><br><img src="https://habrastorage.org/webt/ou/3-/f1/ou3-f1faejz5z8fnho8hmtlcfoy.jpeg"><br>  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: Illustration de la documentation du projet pour l'utilisation de superpositions dans kustomize</i> <br><br>  Kustomize peut faire <i>bien</i> plus que ce qui est décrit dans cet article.  Cependant, j'espère que cela servira de bonne introduction. <br><br><h2>  Ressources supplémentaires </h2><br>  Il existe de nombreux bons articles et publications sur kustomize.  En voici quelques-unes que j'ai trouvées particulièrement utiles: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Changer la configuration de base YAML pour différents environnements prod / test en utilisant Kustomize</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kustomize - La bonne façon de faire des modèles dans Kubernetes</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Gestion déclarative des objets Kubernetes à l'aide de Kustomize</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Personnalisation des graphiques de barre en amont avec Kustomize</a> . </li></ul><br>  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: Vous pouvez également conseiller le bloc de liens publiés en tant que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ressources</a> sur le site Web de l'utilitaire, et la collection ultérieure de vidéos avec les derniers rapports sur kustomize.</i> <br><br>  Si vous avez des questions ou des suggestions pour améliorer ce matériel, je suis toujours ouvert aux commentaires.  Vous pouvez me contacter sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Twitter</a> ou sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la chaîne Kubernetes Slack</a> .  Amusez-vous à modifier vos manifestes avec kustomize! <br><br><h2>  PS du traducteur </h2><br>  Lisez aussi dans notre blog: <br><br><ul><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Outils pour les développeurs d'applications fonctionnant sur Kubernetes</a> »; </li><li>  « <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kubernetes 1.14: un aperçu des principales innovations</a> »; </li><li>  «Les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cinq principaux résultats du Helm Summit 2019 à Amsterdam</a> »; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une introduction pratique au gestionnaire de paquets pour Kubernetes - Helm</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr469179/">https://habr.com/ru/post/fr469179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr469163/index.html">Historique des runes: rappelez-vous comment le réseau a été tempéré</a></li>
<li><a href="../fr469165/index.html">Nous vous invitons à la formation des développeurs de logiciels Intel et Yandex "Développement de logiciels dans le cloud"</a></li>
<li><a href="../fr469167/index.html">Amour et hiboux: à quoi bon le quart de nuit</a></li>
<li><a href="../fr469171/index.html">Les meilleurs produits partent de vrais problèmes: Intercom sur les tâches à faire. 2e partie</a></li>
<li><a href="../fr469173/index.html">Solitude en ligne</a></li>
<li><a href="../fr469181/index.html">Nous utilisons des liens statiques pour les propriétés d'objet à l'aide de lambdas</a></li>
<li><a href="../fr469183/index.html">AMA avec Habr, # 12. Problème froissé</a></li>
<li><a href="../fr469187/index.html">Le livre "Swift. Bases du développement d'applications pour iOS, iPadOS et macOS. 5e éd. complété et révisé "</a></li>
<li><a href="../fr469189/index.html">Pourquoi MS-DOS stocke le tampon de lecture de disquette pendant exactement deux secondes?</a></li>
<li><a href="../fr469193/index.html">Performances du backend PHP. Vidéo du Badoo PHP Meetup # 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>