<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è≠Ô∏è üå¶Ô∏è üë∫ Trouv√© une formule pour une transition indolore vers .Net Core üèúÔ∏è ‚è© üßëüèæ‚Äçü§ù‚Äçüßëüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour tout sur tout, 50 tasses de caf√© suffisent. 


 En plus de la r√®gle g√©n√©rale d√©crite ci-dessus, nous publions une br√®ve note sur les points qui d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trouv√© une formule pour une transition indolore vers .Net Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/true_engineering/blog/422441/"><p>  Pour tout sur tout, 50 tasses de caf√© suffisent. </p><br><p>  En plus de la r√®gle g√©n√©rale d√©crite ci-dessus, nous publions une br√®ve note sur les points qui doivent √™tre suivis de pr√®s afin que rien ne se brise dans la bataille et dans les processus.  La note a √©t√© faite dans la poursuite de la sortie d'un service mobile qui a compl√®tement migr√© vers .Net Core (le d√©but a √©t√© pos√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ).  Nous avons r√©ussi √† r√©aliser cette op√©ration √† l'insu du client, presque sans arr√™ter le processus de d√©veloppement principal. </p><br><p>  Vous trouverez ci-dessous un plan d'action pr√™t √† l'emploi, il y aura une liste de tests tr√®s vaste, cette image sera l√† pour l'humeur: </p><br><p><img src="https://habrastorage.org/webt/pt/yp/6s/ptyp6szarkzymkgf34tz0ide3r8.jpeg"></p><a name="habracut"></a><br><h3 id="itak-po-shagam">  Donc, par √©tapes: </h3><br><h4 id="1-zaplanirovat-dlinnyy-sprint-s-bolshimi-fichami-iili-regressom">  1. Planifiez un long sprint avec de grandes fonctionnalit√©s et / ou une r√©gression </h4><br><p>  Avec la r√©√©criture fondamentale du code, le service aura besoin de temps pour insister le plus longtemps possible afin d'avoir le temps de corriger tous les d√©fauts de l'environnement de test. </p><br><h4 id="2-v-akkurat-k-sprintu-perepisat-kod-na-net-core">  2. Dans le sprint exact pour r√©√©crire le code sur .Net Core </h4><br><p>  Pourquoi est-il important de ne pas d√©marrer cette entreprise √† l'avance?  Parce que vous devez tirer deux branches de code avec le nouveau et l'ancien .net, car √† tout moment un oiseau d'urgence peut voler ou vous devrez effectuer une d√©monstration de nouvelles fonctionnalit√©s, puis vous devrez apporter des modifications √† l'ancienne branche stable.  Afin de ressentir une inqui√©tude minimale √† ce sujet, il est pr√©f√©rable de raccourcir le moment de l'√©tat de transition. </p><br><p>  Soit dit en passant, lorsque nous travaillons avec le code, nous sommes rapidement arriv√©s √† la conclusion qu'il est plus pratique de conserver deux copies du r√©f√©rentiel localement.  C'est plus facile et plus pratique que de changer deux branches massives. </p><br><ul><li>  Si possible, r√©√©crivez les interfaces WCF dans webapi dans les services utilis√©s </li></ul><br><p>  L'impl√©mentation .Net Core du client WCF est encore loin d'√™tre id√©ale.  Malgr√© le fait que les anciennes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plaies sont</a> en quelque sorte corrig√©es, dans les nouvelles versions, vous devez toujours utiliser une solution de contournement ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2</a> ). </p><br><blockquote>  Pour l'histoire: sur .Net Core 2.0, la version de travail stable de WCF est 4.4.2 du r√©f√©rentiel myget.  Elle, par exemple, n'a aucun probl√®me avec un d√©lai d'attente pr√©coce </blockquote><p>  Au d√©but de la migration, nous avons utilis√© la version de .Net Core 2.0.  Pendant ce temps, Microsoft a publi√© .Net Core 2.1.  Qui est int√©ress√© √† admirer les succ√®s des gars de Redmond dans l'optimisation de la plate-forme, veuillez lire les progr√®s r√©alis√©s par le moteur de recherche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bing</a> lors de la mise √† niveau vers la nouvelle version (spoiler: latensi a chut√© de 34%!) </p><br><p>  Nous avons √©galement mis √† niveau vers .Net Core 2.1 et WCF 4.5.3.  Et nous n'avons pas oubli√© de sp√©cifier dans le Dockerfile une nouvelle image de base microsoft / dotnet: 2.1-aspnetcore-runtime.  Quelle a √©t√© la surprise quand, au lieu de 1,4 Go, ils ont vu une taille d'image de 0,5 Go (nous parlons d'une image Windows, si soudainement). </p><br><h4 id="3-zadeploit-na-test-i-demo">  3. Pr√©parez-vous pour un test et une d√©monstration </h4><br><p>  Nous avons deux environnements √† notre disposition.  Nous avons laiss√© la d√©mo avec l'ancienne version comme r√©f√©rence.  Un nouveau service a √©t√© d√©ploy√© dans l'environnement de test - une ex√©cution sur les d√©veloppeurs et les testeurs. </p><br><p> Il y avait une certaine confusion due au fait que les d√©veloppeurs travaillent g√©n√©ralement avec le test, et les testeurs principalement avec une d√©mo.  S'il fallait rafra√Æchir l'ancien service, la situation √©tait exactement le contraire de la normale.  Par cons√©quent, une discussion et une feuille de triche sur o√π et quoi rechercher sont utiles. </p><br><ul><li>  Configurer IIS </li></ul><br><p>  Pour ex√©cuter le service .Net Core dans IIS, vous devez installer le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">module</a> fourni avec le runtime. </p><br><p>  Commutateur AppPool vers CLR Runtime = aucun code manag√©. </p><br><p>  En solution dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">web.config</a> standard <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">,</a> il est important de ne pas oublier de d√©finir le requestTimeout souhait√© et de d√©sactiver le module WebDAV, s'il existe des m√©thodes DELETE. </p><br><p>  En outre, il existe deux options pour publier un service dans IIS: </p><br><ul><li>  vous effectuez la synchronisation MSDeploy - cela signifie que vous avez √©galement besoin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">du</a> commutateur -enableRule: AppOffline </li><li>  vous publiez un fichier - cela signifie exactement avant la publication que vous devez placer le fichier app_offline.htm dans le r√©pertoire de service, et apr√®s la publication le supprimer </li></ul><br><p>  Cela et un autre permettent d'arr√™ter un processus de travail et d'ouvrir des fichiers ex√©cutables.  Sinon, une erreur se produira lorsque les fichiers ne seront pas disponibles pour l'√©crasement. </p><br><blockquote>  Nous avons refus√© la journalisation via Nlog au profit de Serilog, et perdu la compression automatique des journaux - dans Serilog, il n'y a tout simplement pas une telle fonctionnalit√©.  Dans ce cas, vous pouvez √™tre enregistr√© √† l'aide des outils Windows standard et installer la compression NTFS dans les propri√©t√©s du r√©pertoire. </blockquote><br><h4 id="4-protestirovat">  4. Test </h4><br><p>  Voici la liste de contr√¥le la plus r√©duite pour les endroits les plus fragiles: </p><br><ul><li>  v√©rifier le retour des codes d'√©tat Mauvaise demande, non autoris√©, non modifi√©, introuvable - tout ce que l'API peut donner </li><li>  v√©rifier la journalisation des demandes pour tous les codes d'√©tat </li><li>  faire un diagramme des d√©pendances externes;  en r√®gle g√©n√©rale, toutes les informations n√©cessaires se trouvent dans les param√®tres des applications <br><ul><li>  bannir les m√©thodes qui affectent leur travail </li><li>  v√©rifier la journalisation des demandes externes </li></ul></li><li>  v√©rifier le fonctionnement des param√®tres pour les param√®tres de r√©glage des applications;  essayez de les changer pour chaud </li><li>  v√©rifier la mise en cache http pour les codes d'√©tat positifs et n√©gatifs <br><ul><li>  En-t√™te ETag </li><li>  contr√¥le du cache d'en-t√™te </li></ul></li><li>  v√©rifier les longues demandes et les d√©lais </li><li>  v√©rifier les demandes avec une r√©ponse vide </li><li>  v√©rifier les m√©thodes DELETE (WebDAV est d√©sactiv√© ou non) </li><li>  v√©rifier le travail avec du contenu brut <br><ul><li>  t√©l√©charger et t√©l√©charger un / plusieurs fichiers </li><li>  t√©l√©charger des fichiers d'une taille sup√©rieure √† la limite </li><li>  disposition d'en-t√™te Content-Disposition </li></ul></li><li>  v√©rifier tous les autres en-t√™tes;  les mettre tous ensemble dans le code est assez facile </li><li> v√©rifier l'ex√©cution de code conditionnel lors du changement d'environnements <code>if (env.IsDevelopment())</code> </li><li>  v√©rifier la d√©connexion du client et du serveur </li><li>  comparer avec le swagger.json standard - aidera √† d√©tecter la diff√©rence dans les champs transmis <br><blockquote>  Notre application mobile utilise un g√©n√©rateur de code pour fonctionner avec l'API bas√©e sur la description de swagger.json, il √©tait donc important que la diff√©rence par rapport √† la description d'origine soit minime.  Dans la derni√®re version de Swashbuckle.AspNetCore, l'interface et le swagger.json g√©n√©r√© ont beaucoup chang√©.  J'ai d√ª revenir √† la version minable de Swashbuckle.AspNetCore 1.2.0 et ajouter quelques filtres. <br></blockquote></li></ul><br><h4 id="5-zadeploit-na-boy-popivaya-kofeek">  5. Pr√©parez-vous √† vous battre tout en buvant du caf√© </h4><br><p>  Dans notre cas, l'environnement de combat se compose de deux n≈ìuds: actif et passif. <br>  Pour que le passage au nouveau service se fasse inaper√ßu, nous avons dupliqu√© le pool et le site sur chaque n≈ìud, et √©crit un script pour basculer la liaison entre l'ancien et le nouveau site. </p><br><p>  Ainsi, en cas d'urgence, nous avons pu passer rapidement √† l'ancienne version. </p><br><p>  De plus, apr√®s le d√©ploiement √† la bataille, en une semaine, nous avons √©t√© convaincus de la viabilit√© du service et avons allum√© un feu vert pour le lancement de l'application mobile.  La vie sur le projet est revenue en toute s√©curit√© √† son cours pr√©c√©dent. </p><br><h3 id="promezhutochnyy-itog">  Sous-total </h3><br><p>  Maintenant, notre service est pr√™t √† d√©velopper un conteneur docker √† livrer au cluster.  Nous sommes pr√™ts pour le d√©ploiement √† la fois dans Kubernetes et Service Fabric. </p><br><p>  Des pr√©paratifs sont en cours pour la pr√©sentation de la nouvelle infrastructure au client.  Nous parlerons de nos r√©alisations dans la prochaine s√©rie, gardez le doigt sur le pouls;) </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422441/">https://habr.com/ru/post/fr422441/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422431/index.html">Les f√©es japonaises montrent un d√©clencheur ma√Ætre-esclave dans un nouveau manga sur l'√©lectronique num√©rique</a></li>
<li><a href="../fr422433/index.html">Panneaux solaires et routes asphalt√©es. Symbiose de la technologie</a></li>
<li><a href="../fr422435/index.html">Minuterie - D√©marrer</a></li>
<li><a href="../fr422437/index.html">Jeux d'exp√©rience utilisateur et vitesse du site Web et des applications</a></li>
<li><a href="../fr422439/index.html">Le combat avec Yandex: comment j'ai pass√© plus d'un an pour amener le site au top</a></li>
<li><a href="../fr422443/index.html">Corona SDK Precise Timer</a></li>
<li><a href="../fr422445/index.html">Impl√©mentation de BottomAppBar. Partie 3: Comportement pour Android</a></li>
<li><a href="../fr422447/index.html">bytes.Buffer in Go: optimisations qui ne fonctionnent pas</a></li>
<li><a href="../fr422449/index.html">S√©nateurs contre Amazon: ce qu'a fait une boutique en ligne</a></li>
<li><a href="../fr422451/index.html">Pour √©couter le marketing de jeu et la place d'un sc√©nariste dans l'industrie du jeu le 26 septembre chez VShBI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>