<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚öñÔ∏è üìñ üßëüèº Juega Tetris en AR üì£ üßû üíä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Se me ocurri√≥ una extra√±a idea de que la casa podr√≠a ser una buena plataforma para jugar Tetris. No muy lejos de m√≠, solo hab√≠a un edificio adecuado p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Juega Tetris en AR</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454664/">  Se me ocurri√≥ una extra√±a idea de que la casa podr√≠a ser una buena plataforma para jugar Tetris.  No muy lejos de m√≠, solo hab√≠a un edificio adecuado para esto.  El resultado se puede ver en el video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/eGaokauVQ2o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  El proyecto se implementa a un nivel bastante bajo, sin utilizar ninguna soluci√≥n preparada. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥digo fuente</a> <br><a name="habracut"></a><br>  La mayor√≠a de las veces usan 2 opciones para implementar la realidad aumentada: <br><br><ul><li>  sin marcador, es decir  la posici√≥n de la c√°mara est√° determinada por el movimiento de los puntos clave de su transmisi√≥n de video; </li><li>  imagen como marcador relativo a la posici√≥n de la c√°mara. </li></ul><br>  Estas implementaciones no requieren preparaci√≥n especial o condiciones especiales. <br><br>  Hay otra opci√≥n de implementaci√≥n: reconocer un objeto espec√≠fico y usarlo como marcador.  Esto requiere al menos su presencia, pero hace posible controlarlo visualmente.  Uno de los m√©todos de dicho reconocimiento es la detecci√≥n de un objeto por bordes.  Tiene limitaciones: el objeto marcador debe tener bordes claramente definidos, es decir  el objeto probablemente deber√≠a ser s√≥lido. <br><br>  O los bordes deben estar claramente delineados, como la iluminaci√≥n de este edificio: <br><br><img src="https://habrastorage.org/webt/51/y8/nt/51y8ntbjtnm_hdy6iy5v2pmwgsu.jpeg"><br><br>  Se puede ver que la luz de fondo puede separarse f√°cilmente en la imagen y usarse para la detecci√≥n. <br><br><h2>  Implementaci√≥n </h2><br>  En Qt.  Este marco le permite trabajar en diferentes plataformas y al mismo tiempo en C ++.  Como el rendimiento es importante para nosotros, los profesionales parecen una opci√≥n obvia. <br><br>  Aunque Qt no funcion√≥ muy bien con Android (lanzamiento prolongado, la depuraci√≥n se deshabilit√≥), pero todo se estabiliz√≥ por la capacidad de depurar el algoritmo en el escritorio. <br><br>  Se visualizaron gr√°ficos tridimensionales en el OpenGL sin procesar incrustado en Qt. <br><br>  El trabajo con la c√°mara se realiz√≥ a trav√©s de Qt.  Se grab√≥ un video para la depuraci√≥n, y fue lo suficientemente conveniente como para reemplazar la transmisi√≥n de video de la c√°mara con una transmisi√≥n de video de un archivo. <br><br>  La salida se realiz√≥ a trav√©s de herramientas qml.  Hacer amigos qml y OpenGL no estuvo exento de problemas, pero no nos detendremos en esto. <br><br>  Para el procesamiento de im√°genes, la biblioteca OpenCV est√° conectada. <br><br><h4>  Algoritmo de seguimiento </h4><br>  Ahora pasemos a la parte m√°s interesante: el algoritmo para rastrear un objeto a lo largo de sus bordes. <br>  Y comience resaltando los bordes de la imagen.  Todos los bordes en nuestro caso tienen la forma de l√≠neas rectas, por lo que el primer pensamiento que viene a la mente es usar un detector de l√≠nea.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Las transformaciones de Hough</a> podr√≠an usarse como un detector de l√≠nea.  Sin embargo, esta forma me parece poco cierta, ya que la transformaci√≥n de Hough es bastante costosa, adem√°s, este detector no es muy confiable (esto es subjetivo, tal vez todo depende de la tarea). <br>  En cambio, vamos de una manera diferente y m√°s general.  No tendremos en cuenta que nuestras l√≠neas son rectas, pero trabajaremos simplemente en una imagen binaria.  La presencia de bordes se codificar√° en la imagen binaria.  Es decir  un p√≠xel con un valor de cero significa que hay un borde en este lugar, el valor del p√≠xel es mayor que cero, no hay borde.  Dicha imagen se puede obtener usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un detector de l√≠mites Canny</a> o usando una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">transformaci√≥n de umbral</a> simple.  Estos algoritmos se pueden encontrar en OpenCV. <br><br>  Tambi√©n en OpenCV hay otra funci√≥n que nos resulta √∫til ahora: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">distanceTransform</a> , que toma una imagen binaria en la entrada y proporciona una imagen en la salida, en cuyos p√≠xeles se codifica la distancia al p√≠xel cero m√°s cercano. <br><br>  Ahora supongamos que ya tenemos la primera buena aproximaci√≥n de d√≥nde debe ubicarse nuestro modelo.  A continuaci√≥n, describimos la funci√≥n de error, que describe hasta qu√© punto los bordes de nuestra aproximaci√≥n no coinciden con los bordes en la imagen resultante.  Usando la imagen de distanceTransform ya podemos hacer esto.  Y luego ejecutamos el algoritmo de optimizaci√≥n de funciones, cambiando solo nuestra aproximaci√≥n de la posici√≥n del objeto en el espacio.  Como resultado, nuestra aproximaci√≥n deber√≠a describir con bastante precisi√≥n la posici√≥n real del objeto. <br>  Como resultado, el algoritmo se puede dividir en dos etapas: <br><br><ol><li>  Preprocesamiento de im√°genes: binarizaci√≥n, filtrado y uso de la funci√≥n distanceTransfrom. </li><li>  Seguimiento: optimizaci√≥n de la funci√≥n de error. </li></ol><br><h4>  Preprocesamiento de imagen </h4><br>  En este punto, debe resaltar los bordes de la imagen.  Puede usar el detector de l√≠mites Canny, pero en nuestro caso la conversi√≥n de umbral habitual o su versi√≥n adaptativa funciona mejor (en OpenCV estas son funciones de umbral o umbral adaptativo).  Est√° claro que habr√° ruido en dicha imagen, por lo que se necesita filtrado.  Hag√°moslo de la siguiente manera: seleccione el contorno utilizando la funci√≥n OpenCV <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">findCountours</a> y elimine segmentos que son demasiado peque√±os o no lo suficientemente como una l√≠nea. <br><br>  El resultado del procesamiento se puede ver en la imagen: <br><br><img src="https://habrastorage.org/webt/ef/g9/ts/efg9tspnpbvzqb1gn2o0cricah8.jpeg"><br><br>  Consistentemente: la imagen original -&gt; despu√©s de la transformaci√≥n del umbral -&gt; despu√©s del filtrado. <br><br>  Esta imagen ya nos dice claramente d√≥nde est√° el borde derecho y d√≥nde no.  Despu√©s de eso, usamos la funci√≥n distanceTransform, y como resultado, tendremos informaci√≥n sobre qu√© tan lejos est√° cada punto del borde.  La imagen resultante se denota como <img src="https://habrastorage.org/webt/qt/cr/xz/qtcrxzl1ow1zbp0xoducghnxhms.png">  . <br><br>  As√≠ es como se ve si se normaliza y visualiza: <br><br><img src="https://habrastorage.org/webt/ho/ll/vm/hollvmy8tp4ozcc424szu5pjjuc.jpeg"><br><br>  A continuaci√≥n, necesitaremos algunas herramientas matem√°ticas. <br><br><h5>  Algoritmo de optimizaci√≥n de funciones </h5><br>  La optimizaci√≥n de funciones es la tarea de encontrar el m√≠nimo de una funci√≥n. <br><br>  Si estamos tratando con un sistema lineal de ecuaciones, encontrar un m√≠nimo es bastante simple.  Imagine el sistema de ecuaciones en forma de matriz: <img src="https://habrastorage.org/webt/8o/ib/1o/8oib1oj6a6trr7kkhjozgiy3day.png">  , entonces nuestra soluci√≥n: <img src="https://habrastorage.org/webt/ly/rc/qu/lyrcqutfkhebqb6tqlrfix5d1ms.png">  .  Si tenemos un sistema de ecuaciones sobredeterminado, entonces podemos usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el m√©todo de m√≠nimos cuadrados</a> : <img src="https://habrastorage.org/webt/ll/4i/ok/ll4iok4um66gxr9zxre_lxlyylm.png">  . <br><br>  Si nuestra funci√≥n no es lineal, la tarea se vuelve m√°s complicada.  Para encontrar el m√≠nimo, puede usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el algoritmo de Gauss-Newton</a> .  El algoritmo funciona de la siguiente manera: <br><br><ol><li>  Se supone que ya tenemos una aproximaci√≥n inicial de la soluci√≥n. <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  que vamos a refinar iterativamente </li><li>  Usando la expansi√≥n de Taylor, podemos aproximar nuestra funci√≥n no lineal lineal en el punto de aproximaci√≥n actual.  Resolvemos el sistema lineal de ecuaciones resultante por el m√©todo de m√≠nimos cuadrados, obteniendo <img src="https://habrastorage.org/webt/_l/so/zd/_lsozdiipx0ny5krc_nvtsklixq.png">  .  Como resultado, la soluci√≥n resultante no ser√° una soluci√≥n, pero estar√° m√°s cerca que la aproximaci√≥n actual. </li><li>  Reemplazar la aproximaci√≥n actual <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  decisi√≥n recibida <img src="https://habrastorage.org/webt/_l/so/zd/_lsozdiipx0ny5krc_nvtsklixq.png">  y vaya al paso 2. Entonces repita hasta la diferencia entre <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  y <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  No ser√° inferior a un cierto valor. </li></ol><br>  Analicemos el algoritmo con m√°s detalle. <br><br>  Dejar <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  - funci√≥n de trabajo, <img src="https://habrastorage.org/webt/i5/uo/zz/i5uozzwwbb4_f-ivitxfs2qferi.png">  - un vector de valores de funci√≥n previamente conocido.  Con la soluci√≥n perfecta a la ecuaci√≥n. <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  la siguiente afirmaci√≥n es verdadera <img src="https://habrastorage.org/webt/m-/dk/pv/m-dkpv_tnys9clufhps155qfxkq.png">  .  Pero solo tenemos su aproximaci√≥n <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  .  Entonces el vector de error de esta aproximaci√≥n se denota como: <img src="https://habrastorage.org/webt/_v/d4/n1/_vd4n1yd6irh6smzqcnpswmmbjm.png">  .  Un error general de la funci√≥n ser√°: <img src="https://habrastorage.org/webt/8d/lf/me/8dlfmeklxb1jvlffcyk8w0vb478.png">  .  Ahora encontrando tal <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  en que <img src="https://habrastorage.org/webt/xl/um/pw/xlumpww55az0itxqrtigh2qofqg.png">  alcanzar√° un m√≠nimo, obtendremos una mejor aproximaci√≥n de la soluci√≥n <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  . <br>  Comenzando desde el enfoque <img src="https://habrastorage.org/webt/mg/yf/5k/mgyf5kyuniayj8w1_veck_sgciq.png">  lo aproximaremos iterativamente, obteniendo en cada iteraci√≥n <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  .  Para hacer esto, necesitamos cada iteraci√≥n para calcular <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la matriz de Jacobi</a> para la funci√≥n <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  para la aproximaci√≥n actual, que consiste en derivados de nuestra funci√≥n: <br><img src="https://habrastorage.org/webt/m1/g0/g-/m1g0g-jmv04dlsbyoivbvjbwpwi.png"><br>  Y la siguiente aproximaci√≥n se da como: <img src="https://habrastorage.org/webt/lm/xc/y4/lmxcy4rjlhtxgwz_lb8kpi1cpys.png">  . <br>  A menudo, las tareas se construyen de tal manera que tenemos una gran cantidad de datos independientes entre s√≠ (solo a partir de los valores <img src="https://habrastorage.org/webt/ht/2u/lo/ht2ulowooc32s10ajclpbeug1w4.png">  )  Como resultado, la matriz general de Jacobi es muy escasa.  Hay una manera de optimizar los c√°lculos. <br>  Suponga que una funci√≥n com√∫n se calcula a partir de un conjunto de puntos.  Desde el punto <i>j</i> <img src="https://habrastorage.org/webt/29/lv/wk/29lvwk822xw4y0xlriuxrxx4gli.png">  .  En lugar de calcular la matriz de Jacobi <img src="https://habrastorage.org/webt/fu/vl/ui/fuvluirwbxatvxammyfzrbkxwug.png">  para toda la funci√≥n, calculamos la matriz de Jacobi espec√≠ficamente para <img src="https://habrastorage.org/webt/29/lv/wk/29lvwk822xw4y0xlriuxrxx4gli.png">  y denotarlo como: <img src="https://habrastorage.org/webt/zf/al/h0/zfalh0ntw3nupwu56dhc7u0fzn0.png">  .  Entonces la siguiente aproximaci√≥n se dar√° de la siguiente manera: <img src="https://habrastorage.org/webt/hl/2k/d6/hl2kd6neuqqtrclxyf6efubd8by.png">  .  Adem√°s, este cambio le permite paralelizar los c√°lculos. <br>  Puede suceder que el siguiente valor <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  dar√° un error m√°s grande que <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  .  Para resolver este problema, puede usar una modificaci√≥n del algoritmo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el algoritmo Levenberg-Marquardt</a> .  Agregar valor <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  en nuestra f√≥rmula: <img src="https://habrastorage.org/webt/d-/jv/hi/d-jvhiklwzbaxqihirj97fnyvg4.png">  donde <img src="https://habrastorage.org/webt/hp/qi/1y/hpqi1yohaku8yblniy_qjap0ghe.png">  Es una matriz unitaria.  Valor <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  seleccionado de la siguiente manera: <br><ul><li>  primero, tiene un valor bastante peque√±o (tal que el algoritmo converge); </li><li>  entonces si un error para <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  mas que <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  , luego aumente el valor <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  e intente calcular el error para <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  de nuevo </li></ul><br>  Cuanto m√°s no lineal es la funci√≥n <img src="https://habrastorage.org/webt/vc/j3/mp/vcj3mpo1jjwkew5a0enemocdyoq.png">  cuanto mayor sea el valor <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  .  Sin embargo, cuanto mayor sea el valor <img src="https://habrastorage.org/webt/zi/jx/hs/zijxhs_ibqcwfjnfdefeoh7fwqu.png">  , m√°s lento converge el algoritmo. <br><br>  Completamos el algoritmo cuando <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  diferente de <img src="https://habrastorage.org/webt/n_/t0/bp/n_t0bpjlwogupz25g2toyse8w60.png">  lo suficientemente peque√±o y tomar <img src="https://habrastorage.org/webt/2u/gv/-3/2ugv-3nsnzjslkonizusvzbgbuo.png">  como soluci√≥n <br><br>  El algoritmo es bastante universal y puede usarse para una variedad de tareas. <br><br><h5>  Modelo de seguimiento matem√°tico </h5><br>  Como estamos tratando con coordenadas en el espacio, est√° claro que necesitamos poder manipular estas coordenadas.  Supongamos que tenemos alg√∫n conjunto de puntos <img src="https://habrastorage.org/webt/pi/mv/hb/pimvhb7w8_hegkijjpdddui99ts.png">  .  Y necesitamos rotarlos alrededor del punto con coordenadas cero.  Probablemente, la forma m√°s f√°cil ser√≠a utilizar la matriz de rotaci√≥n <i>R</i> , que describe la rotaci√≥n necesaria: <img src="https://habrastorage.org/webt/dn/qr/lf/dnqrlfvvkeyngvdbbqy8uwnbgyk.png">  .  Si necesitamos cambiar los puntos, simplemente agregue el vector deseado <i>t</i> : <img src="https://habrastorage.org/webt/ds/qc/jc/dsqcjcik5lk13aheb3_q78x8x6s.png">  . <br>  Por lo tanto, puede cambiar arbitrariamente la posici√≥n de un objeto en el espacio.  Resulta que las coordenadas del objeto est√°n determinadas por la matriz tridimensional <i>R</i> y el vector tridimensional <i>t</i> , es decir.  12 par√°metros.  Adem√°s, estos par√°metros no son independientes entre s√≠, los componentes de la matriz de rotaci√≥n est√°n interconectados por ciertas condiciones.  Por lo tanto, desde el punto de vista del uso de estas funciones en la optimizaci√≥n, estos par√°metros no son la mejor soluci√≥n.  Hay m√°s par√°metros que grados de libertad, hay una relaci√≥n entre ellos.  Hay otra forma de rotaci√≥n: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la f√≥rmula de rotaci√≥n de Rodrigue</a> .  Esta rotaci√≥n se especifica mediante tres par√°metros, formando un vector tridimensional. <br><br>  El vector normalizado es el eje de rotaci√≥n, y la longitud de este vector es el √°ngulo de rotaci√≥n alrededor de este eje. <br><br>  Establecemos la funci√≥n de rotaci√≥n del vector <i>v</i> : <img src="https://habrastorage.org/webt/kl/hc/cz/klhccza_fs2fv8gmvh3uovdnzvw.png">  utilizando los par√°metros <i>r</i> de la f√≥rmula Rodrigue.  Obtenemos la siguiente f√≥rmula de esto: <img src="https://habrastorage.org/webt/_s/sg/p1/_ssgp1pn5q49yx32g-zkluqkn8u.png">  . <br>  Y al final, podemos establecer las coordenadas de la posici√≥n del objeto con un vector de 6 dimensiones: <img src="https://habrastorage.org/webt/mb/mo/dl/mbmodlujklivexjnp7zo0eyup_o.png"><br>  Obtenemos la siguiente f√≥rmula: <img src="https://habrastorage.org/webt/ih/ls/hx/ihlshxts9oar5kcqw4l0a0ilj1w.png">  . <br><br><h5>  Modelo de c√°mara estenopeica </h5><br>  Ahora describimos un modelo matem√°tico simple de la c√°mara utilizada en el proyecto: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;vec&amp;#xA0;{p}&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{pmatrix}&amp;#xA0;p_x&amp;#xA0;&amp;amp;&amp;#xA0;p_y&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{pmatrix}&amp;#xA0;^&amp;#xA0;T&amp;#xA0;=&amp;#xA0;cam&amp;#xA0;(\&amp;#xA0;vec&amp;#xA0;{v})&amp;#xA0;=&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{pmatrix}&amp;#xA0;f_x&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{v_x}&amp;#xA0;{v_z}&amp;#xA0;+&amp;#xA0;c_x&amp;#xA0;&amp;amp;&amp;#xA0;f_y&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{v_y}&amp;#xA0;{v_z}&amp;#xA0;+&amp;#xA0;c_y&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{pmatrix}&amp;#xA0;^&amp;#xA0;T</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\ vec {p} = \ begin {pmatrix} p_x &amp; p_y \ end {pmatrix} ^ T = cam (\ vec {v}) = \ begin {pmatrix} f_x \ frac {v_x} {v_z} + c_x &amp; f_y \ frac {v_y} {v_z} + c_y \ end {pmatrix} ^ T</font></font></span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;vec&nbsp;{p}&nbsp;=&nbsp;\&nbsp;begin&nbsp;{pmatrix}&nbsp;p_x&nbsp;&amp;&nbsp;p_y&nbsp;\&nbsp;end&nbsp;{pmatrix}&nbsp;^&nbsp;T&nbsp;=&nbsp;cam&nbsp;(\&nbsp;vec&nbsp;{v})&nbsp;=&nbsp;\&nbsp;begin&nbsp;{pmatrix}&nbsp;f_x&nbsp;\&nbsp;frac&nbsp;{v_x}&nbsp;{v_z}&nbsp;+&nbsp;c_x&nbsp;&amp;&nbsp;f_y&nbsp;\&nbsp;frac&nbsp;{v_y}&nbsp;{v_z}&nbsp;+&nbsp;c_y&nbsp;\&nbsp;end&nbsp;{pmatrix}&nbsp;^&nbsp;T</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ vec {p} = \ begin {pmatrix} p_x & p_y \ end {pmatrix} ^ T = cam (\ vec {v}) = \ begin {pmatrix} f_x \ frac {v_x} {v_z} + c_x & f_y \ frac {v_y} {v_z} + c_y \ end {pmatrix} ^ T </script></p>  donde <img src="https://habrastorage.org/webt/4y/1n/eo/4y1neonrkqigjzoumocsltdvi-e.png">  - distancia focal en p√≠xeles; <img src="https://habrastorage.org/webt/en/zb/z6/enzbz61iibgzcsxm0jtasbuek28.png">  - El centro √≥ptico tambi√©n est√° en p√≠xeles.  Estos son par√°metros individuales de la c√°mara, que se denominan par√°metros intr√≠nsecos de la c√°mara.  T√≠picamente, estos par√°metros son conocidos de antemano.  En este proyecto, estos par√°metros se seleccionan a simple vista. <br><br>  Este modelo no tiene en cuenta la distorsi√≥n del objetivo de las c√°maras ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">distorsi√≥n</a> ).  Supongamos que no lo son. <br><br>  Con este modelo, obtenemos una proyecci√≥n central, cuyos puntos tienden m√°s hacia el centro √≥ptico, cuanto m√°s lejos est√°n de la c√°mara.  As√≠ obtenemos el efecto de un ferrocarril que se estrecha: <br><br><img src="https://habrastorage.org/webt/3c/a2/gn/3ca2gngkegajdjw25-gm6zgy3_u.jpeg"><br><br>  En el espacio, la c√°mara est√° alineada con el eje <i>z</i> , el plano de la imagen es paralelo al plano <i>xy</i> .  Complementamos nuestro modelo con la capacidad de moverse en el espacio: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>p</mi></mrow><mi>j</mi></msub><mo>=</mo><mi>c</mi><mi>a</mi><mi>m</mi><mo stretchy=&quot;false&quot;>(</mo><mi>r</mi><mi>o</mi><mi>t</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mi>r</mi></msub><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>v</mi></mrow><mi>j</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mi>t</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.654ex" height="3.021ex" viewBox="0 -832 17934.4 1300.8" role="img" focusable="false" style="vertical-align: -1.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-6A" x="712" y="-326"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-3D" x="2808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-63" x="3864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-61" x="4298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-6D" x="4827" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-28" x="5706" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-72" x="6095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-6F" x="6547" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-74" x="7032" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-28" x="7394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-76" x="8033" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-65" x="8519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-63" x="8985" y="0"></use><g transform="translate(9419,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-72" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-2C" x="10410" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-76" x="11106" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-65" x="11591" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-63" x="12058" y="0"></use><g transform="translate(12491,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-76" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-6A" x="686" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-29" x="13368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-2B" x="13980" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-76" x="15231" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-65" x="15716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-63" x="16183" y="0"></use><g transform="translate(16616,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMATHI-74" x="809" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/454664/&amp;usg=ALkJrhjQRYbwyzZA-uaLOZ2AlSR8yjoAPg#MJMAIN-29" x="17544" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>p</mi></mrow><mi>j</mi></msub><mo>=</mo><mi>c</mi><mi>a</mi><mi>m</mi><mo stretchy="false">(</mo><mi>r</mi><mi>o</mi><mi>t</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><mi>r</mi></msub><mo>,</mo><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>v</mi></mrow><mi>j</mi></msub><mo stretchy="false">)</mo><mo>+</mo><mtext>&nbsp;</mtext><mi>v</mi><mi>e</mi><mi>c</mi><msub><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><mi>t</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> \ vec {p} _j = cam (rot (\ vec {x} _r, \ vec {v} _j) + \ vec {x} _t) </script></p><br>  Por lo tanto, obtuvimos un modelo con el que podemos simular en forma algebraica la proyecci√≥n de puntos del mundo exterior en la imagen de la c√°mara (desde las coordenadas del mundo a la pantalla).  Para nosotros, los par√°metros de la posici√≥n relativa de la c√°mara en el espacio siguen siendo desconocidos en este modelo. <img src="https://habrastorage.org/webt/ln/ib/-f/lnib-foisc9iu_aqy0wernf1xgu.png">  .  Estos par√°metros se denominan par√°metros extr√≠nsecos de la c√°mara. <br><br><h5>  Seguimiento </h5><br>  Implementado ya sin herramientas OpenCV.  Primero, necesitamos obtener la funci√≥n de error para nuestra soluci√≥n aproximada, que se describi√≥ anteriormente.  Y escribiremos su c√°lculo en etapas: <br><br><ol><li>  Seleccionamos dichos bordes del modelo de seguimiento que son visibles en funci√≥n de los par√°metros de la aproximaci√≥n actual. </li><li>  Convertimos el conjunto de aristas seleccionado en un conjunto fijo de puntos, para simplificar los c√°lculos.  Es posible, por ejemplo, tomar el en√©simo n√∫mero de puntos de cada borde, o (una opci√≥n m√°s correcta) elegir una cantidad tal que haya una distancia fija en p√≠xeles entre los puntos.  Los llamaremos puntos de control (en el proyecto: controlPoint - puntos de control y controlPixelDistance - la misma distancia fija en p√≠xeles). </li><li>  Proyectamos puntos de control en la imagen.  Gracias a <i>distanceImage,</i> podemos obtener la distancia de la proyecci√≥n del punto de control al borde de la imagen.  En el caso ideal, todos los puntos de control deben estar estrictamente en los bordes de la imagen, es decir.  la distancia a la costilla debe ser cero.  En base a esto, obtenemos un error para un punto de control espec√≠fico: <img src="https://habrastorage.org/webt/aj/yl/of/ajylofx-nqzxqkzyaaxwcczmd6a.png">  . </li><li>  Obtenemos la siguiente funci√≥n de error: <img src="https://habrastorage.org/webt/o8/u-/8w/o8u-8wwvnt2jhgyulfun8kyzh6k.png"></li></ol><br>  Ahora queda por encontrar un m√≠nimo de <i>E.</i>  Para hacer esto, usamos el algoritmo de Levenberg-Marquardt descrito anteriormente.  Como ya sabemos, el algoritmo requiere el c√°lculo de la matriz de Jacobi, es decir.  funciones derivadas  Puede usar el hallazgo num√©rico de derivados.  Tambi√©n puede usar algunas soluciones listas para este algoritmo.  Sin embargo, en este proyecto todo fue escrito manualmente, por lo que describir√© la conclusi√≥n completa de toda la soluci√≥n. <br><br>  Para cada punto de control, obtenemos una ecuaci√≥n independiente de otros puntos.  Ya se ha descrito anteriormente que en este caso es posible considerar estas ecuaciones independientemente una de la otra, calculando la matriz de Jacobi espec√≠ficamente para cada una.  Lo analizaremos en orden, usando las reglas de diferenciaci√≥n de una funci√≥n compleja: <br><br><img src="https://habrastorage.org/webt/qf/lm/3t/qflm3tr6vrmyirsufolpiwmlte4.png"><br><br>  Denotamos <img src="https://habrastorage.org/webt/_b/_i/i1/_b_ii1eklzapugxeahtbl7wwuky.png">  entonces <img src="https://habrastorage.org/webt/tr/pz/a-/trpza-t1j_sr_otvetkquuvnac8.png"><br><br><img src="https://habrastorage.org/webt/en/k3/2q/enk32qx_j0zgvqzujalzydlfxyi.png"><br><br>  Desde aqu√≠: <br><br><img src="https://habrastorage.org/webt/ld/nh/s1/ldnhs1vypzpsx_mxlu6wjat4qtm.png"><br><br>  Adem√°s denotamos <img src="https://habrastorage.org/webt/dl/2z/q0/dl2zq0jren9jpbmbpoaexelsrhw.png">  y <img src="https://habrastorage.org/webt/gb/kc/ps/gbkcpsry9q7nmsdz2kqpq-6br6y.png">  entonces: <br><img src="https://habrastorage.org/webt/et/_j/ez/et_jez8fzupc2jtpk3bhteevl7y.png"><br><br>  Las derivadas de <i>distanceImage</i> son num√©ricamente.  Y para computar vectores <img src="https://habrastorage.org/webt/iq/ur/_3/iqur_3xmxhxrdeia7bnkmonogxi.png">  y <img src="https://habrastorage.org/webt/z-/fy/qz/z-fyqzcgc19axrhujj5y6v0lxcm.png">  necesitar√° encontrar derivados de acuerdo con la f√≥rmula de rotaci√≥n de Rodrigue.  Encontr√© a Jacobian con esta f√≥rmula en la publicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Una f√≥rmula compacta para la derivada de una rotaci√≥n tridimensional en</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">coordenadas exponenciales ¬ªGuillermo Gallego, Anthony Yezzi</a> : <br><br><img src="https://habrastorage.org/webt/lb/rr/cr/lbrrcr3knmrvyjbessogjsvjyos.png">  , <br>  donde <i>R</i> es la matriz de rotaci√≥n obtenida por la f√≥rmula Rodrigue del vector de rotaci√≥n <img src="https://habrastorage.org/webt/qz/bd/pe/qzbdpe7zjfanzdyip7acfhwgwvo.png">  ; <img src="https://habrastorage.org/webt/bn/9c/-b/bn9c-blmg7tsys7l83pbu-2upny.png">  - el punto que estamos cambiando;  <i>I</i> es la matriz de identidad; <img src="https://habrastorage.org/webt/lq/im/g6/lqimg6wecrfth32alae6l435sxk.png">  .  Como vemos aqu√≠, tenemos una divisi√≥n por la longitud del vector de rotaci√≥n, y si el vector es cero, entonces la f√≥rmula ya no funciona.  Esto probablemente se deba al hecho de que en el vector cero el eje de rotaci√≥n no est√° definido.  Si el vector de rotaci√≥n est√° muy cerca de cero, entonces usamos esta f√≥rmula: <img src="https://habrastorage.org/webt/sm/hk/dc/smhkdchm-zr63paet8-nm_jftwo.png">  . <br>  Queda por pintar <img src="https://habrastorage.org/webt/iq/ur/_3/iqur_3xmxhxrdeia7bnkmonogxi.png">  y <img src="https://habrastorage.org/webt/z-/fy/qz/z-fyqzcgc19axrhujj5y6v0lxcm.png">  (aqu√≠ <i>se</i> omite el √≠ndice <i>j</i> ): <br><br><img src="https://habrastorage.org/webt/nt/xz/lf/ntxzlffpi42xgp1imuodytk2bqc.png"><img src="https://habrastorage.org/webt/hx/nz/pb/hxnzpbadbgyhlb2doqetg7f4iea.png"><br>  Por lo tanto, obtuvimos la matriz de Jacobi para el punto que necesitamos y podemos usarla para el algoritmo de optimizaci√≥n descrito anteriormente. <br><br>  Hay varios problemas con este algoritmo.  En primer lugar, precisi√≥n.  Como resultado, la posici√≥n global de la c√°mara salta ligeramente de cuadro a cuadro.  Puedes arreglarlo un poco.  Tenemos informaci√≥n a priori de que la posici√≥n de la c√°mara no puede cambiar dram√°ticamente de cuadro a cuadro.  Y podemos reducir esta inquietud agregando ecuaciones adicionales a la funci√≥n. <br><br>  Debe recordarse que el vector de desplazamiento <i>t</i> no <i>es</i> en nuestro caso la coordenada de la posici√≥n global de la c√°mara.  La posici√≥n global es un punto local con coordenadas cero, por lo que se puede derivar de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/ly/zk/bk/lyzkbkk1zig1yfqu2shk9ziogbc.png"><br><br>  Recordamos la posici√≥n del marco anterior en <i>prevGlobalPosition</i> .  Ahora la posici√≥n anterior deber√≠a estar cerca de cero, es decir  longitud del vector <img src="https://habrastorage.org/webt/hv/lb/ww/hvlbwwdmw-wcymqnyxvaosx75mc.png">  deber√≠a ser lo suficientemente peque√±o.  Es decir  Adem√°s de otros valores de discrepancias, el vector <i>d</i> tambi√©n debe minimizarse.  Para determinar el grado de influencia de esta modificaci√≥n, introducimos el valor <img src="https://habrastorage.org/webt/25/ij/uy/25ijuyi5965hui7hbmywcsgfnuy.png">  y multiplique el vector <i>d</i> sumando por <img src="https://habrastorage.org/webt/25/ij/uy/25ijuyi5965hui7hbmywcsgfnuy.png">  : <img src="https://habrastorage.org/webt/pc/eo/6_/pceo6_067ezk979vii2pi4ex8k4.png">  .  Es decir  en el algoritmo de optimizaci√≥n, tambi√©n minimizamos el vector <i>d '</i> .  Por supuesto, para esto ser√° necesario calcular la matriz de Jacobi para ella, que se deriva de la misma manera que ya derivamos anteriormente para la funci√≥n de error general. <br><br>  El segundo problema del algoritmo es que puede atascarse en m√≠nimos locales.  En otros trabajos, este problema se resuelve utilizando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">filtro de part√≠culas.</a>  En nuestro caso, esta opci√≥n result√≥ ser, en principio, suficiente. <br><br><h4>  Bonificaciones por rastrear un objeto </h4><br>  Conociendo la posici√≥n y la forma del objeto, puede manipularlos visualmente, lo que intent√© demostrar en el video.  El objeto fue distorsionado usando sombreadores OpenGL.  Con la ayuda de nuestro modelo, proyect√© el punto del objeto en la imagen, y as√≠ recib√≠ el color de este punto.  Luego puede mover este punto, obteniendo efectos interesantes, por ejemplo, morphing.  Sin embargo, uno debe recordar que al cambiar el punto, es necesario que algo permanezca en su lugar, de lo contrario las inconsistencias se har√°n evidentes.  Adem√°s, dependiendo de la calidad de nuestro seguimiento y la forma del objeto, recibiremos varios efectos indeseables debido a los errores acumulados, que seguir√°n siendo.  Solo debe tenerse en cuenta de alguna manera.  En el video presentado anteriormente, quer√≠a mostrar que la realidad aumentada puede usarse un poco m√°s que simplemente imponer objetos virtuales en la imagen. <br><br>  Por cierto, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SDK de Vuforia</a> implementa el seguimiento de un objeto por su forma, aunque no creo que sea posible implementar este proyecto con √©l, ya que no es posible usar bordes estrictamente definidos y no puede asociarse con la iluminaci√≥n del edificio. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/454664/">https://habr.com/ru/post/454664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454646/index.html">Compilaci√≥n @Pythonetc, mayo de 2019</a></li>
<li><a href="../454648/index.html">Consejos y trucos de mi canal de Telegram @pythonetc, mayo de 2019</a></li>
<li><a href="../454652/index.html">Motor a reacci√≥n en una impresora 3D dom√©stica</a></li>
<li><a href="../454658/index.html">Gadgets de belleza: negocios serios</a></li>
<li><a href="../454662/index.html">Cuidado de mudarse a los Pa√≠ses Bajos con su esposa e hipoteca. Parte 1: b√∫squeda de empleo</a></li>
<li><a href="../454666/index.html">Radio definida por software: ¬øc√≥mo funciona? Parte 7</a></li>
<li><a href="../454668/index.html">Developer Cookbook: DDD Recipes (Parte 5, Procesos)</a></li>
<li><a href="../454670/index.html">La serie "Chernobyl": mira y piensa</a></li>
<li><a href="../454672/index.html">Clave para el inicio: el mejor software y hardware para inform√°tica forense</a></li>
<li><a href="../454674/index.html">Monitoreo del pobre o monitoreo del servidor desde la consola</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>