<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•í üßëüèø‚Äçü§ù‚Äçüßëüèº üôÖüèª Painel de controle centralizado para fontes de ilumina√ß√£o TsPKIO-2D Rotor üåù üßó üëçüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desculpe, n√£o me divirto com nomes h√° muito tempo, assim como com perif√©ricos para automa√ß√£o residencial. Especificamente, essa coisa - o controle rem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Painel de controle centralizado para fontes de ilumina√ß√£o TsPKIO-2D Rotor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/411093/"><img src="https://habrastorage.org/getpro/geektimes/post_images/72f/6a9/ceb/72f6a9ceb826b19cdb266c3d334da65b.jpg" alt="imagem"><br><br>  Desculpe, n√£o me divirto com nomes h√° muito tempo, assim como com perif√©ricos para automa√ß√£o residencial.  Especificamente, essa coisa - o controle remoto da luz - acabou porque eu queria algo com uma interface push-twist-click, e n√£o com a dispers√£o usual de bot√µes.  O efeito uau n√£o foi alcan√ßado: em casa, n√£o noto o controle remoto √† queima-roupa, mas pelo menos fechei a gestalt. <br><a name="habracut"></a><br>  Resumo TOR: <br><br>  1) Gerenciamento de tr√™s grupos de ilumina√ß√£o na cozinha <br>  2) Gest√£o de tr√™s grupos de ilumina√ß√£o na sala <br>  3) Gerenciamento de todas as fontes de luz ao mesmo tempo <br>  4) Vida √∫til da bateria razo√°vel (a partir de uma semana) <br>  5) Compat√≠vel com a codifica√ß√£o Livolo, SC2260, EV1527 <br><br>  Portanto, voc√™ n√£o precisa ler mais se n√£o gostar de Arduino, comutadores Livolo e tomadas de r√°dio chinesas.  Porque o primeiro √© a base do controle remoto, e o segundo e o terceiro s√£o a periferia. <br><br><h2>  Conceito </h2><br>  A l√≥gica de controle me pareceu a seguinte: <br><br><ol><li>  Pressionar o bot√£o girat√≥rio alterna as zonas do grupo de ilumina√ß√£o em um anel (cozinha - sala - tudo). </li><li>  Girar o bot√£o, dependendo da dire√ß√£o da rota√ß√£o, liga ou desliga a ilumina√ß√£o do grupo selecionado. </li><li>  O modo operacional (grupo selecionado) √© exibido por uma indica√ß√£o discreta do LED. </li></ol><br>  Como uso o controle por r√°dio de acordo com a op√ß√£o mais desprezada, sem prote√ß√£o contra interfer√™ncias e feedback, ao mesmo tempo, √© fornecido um pequeno truque em caso de falha na opera√ß√£o. <br><br>  Se girar o bot√£o n√£o levar ao resultado desejado, pressione e gire combinados na dire√ß√£o oposta para pular o comando.  Em seguida, o comando pode ser repetido como de costume. <br><br>  Ou seja, se eu girar o bot√£o no sentido hor√°rio e a luz principal n√£o acender, eu posso pressionar o bot√£o, gir√°-lo no sentido anti-hor√°rio e solt√°-lo e gir√°-lo novamente no sentido hor√°rio para repetir a ativa√ß√£o. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/V0ZpCxEb3-U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Por que √© t√£o dif√≠cil?  Al√©m dos protocolos desajeitados, tamb√©m tenho perif√©ricos desajeitados.  Por exemplo, as luzes controladas por r√°dio comutam o Livolo e os rel√©s de r√°dio, que t√™m o mesmo comando para ligar e desligar, juntamente com as tomadas de r√°dio comuns, cujos comandos para ligar e desligar s√£o separados. <br><br>  O truque de pular da equipe permite que voc√™ supere de maneira criativa a n√£o inclus√£o (n√£o exclus√£o) sem quebrar o esquema geral de ilumina√ß√£o.  Al√©m disso, pular um comando permite pular sobre fontes de luz que voc√™ n√£o precisa ativar ou desativar. <br><br>  Bem, √© claro, para entender o que est√° acontecendo com o controle remoto, ele tem um indicador separado que acende ao enviar um comando. <br><br>  Se o console n√£o for tocado por algum tempo (configurado no c√≥digo), o controlador entrar√° em suspens√£o.  No entanto, ele n√£o salva o √∫ltimo estado e, quando acorda pressionando a caneta, come√ßa a vida do zero. <br><br>  Isto n√£o √© um erro.  Repito, tenho comutadores sem feedback e o console √© fisicamente incapaz de obter informa√ß√µes sobre o estado atual de cada dispositivo perif√©rico controlado. <br><br>  Portanto, imediatamente ap√≥s acordar, o bot√£o girat√≥rio liga ou desliga a luz do zero. <br><br><h2>  Primeira abordagem </h2><br>  O conceito visual do tipo ‚Äúcaixa com uma tor√ß√£o‚Äù exigia, como voc√™ pode imaginar, duas coisas: caixas e tor√ß√µes.  Na primeira vers√£o, o papel da caixa foi desempenhado por um fino banco de pot√™ncia, cujo uso resolveu dois problemas ao mesmo tempo: eu tinha um gabinete e um esquema de carregamento de bateria, al√©m disso, com um conector.  A pr√≥pria bateria, √© claro, teve que ser substitu√≠da por uma mais compacta, caso contr√°rio, o enchimento n√£o poderia mais caber. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/640/299/4df/6402994df7e71b82835d12f42541f1f0.jpg" alt="imagem"><br><br>  Acabou mais complicado com a tor√ß√£o.  Ao pesquisar, descobri que quanto mais bonito o bot√£o do potenci√¥metro e maior, mais pr√≥ximo o custo de seu grama do custo de um grama de ouro.  Portanto, adquiri uma caneta, que me servia minimamente para propriedades est√©ticas. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/232/a3e/b60/232a3eb6074d6d8724fdc76d353274cc.jpg" alt="imagem"><br><br>  A parte de controle foi o resultado de um experimento com o ATmega328P e uma continua√ß√£o l√≥gica do enredo definido pela automa√ß√£o residencial existente (no mesmo Arduino e nos protocolos de r√°dio primitivos). <br><br>  N√£o comprei muito dispendiosamente os controladores mencionados e prot√≥tipo condicionalmente (de fato, um adaptador de um gabinete pequeno para um grande passo) com o objetivo de tentar criar uma vers√£o de baixo or√ßamento do Arduino com um n√∫mero m√≠nimo (mas razo√°vel) de elementos. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/625/ebb/095/625ebb0959641911621741e00fb1b699.jpg" alt="imagem"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/be0/e1c/ac4/be0e1cac460246c56f97f0c45e1c8bc7.jpg" alt="imagem"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/53d/bc5/9f1/53dbc59f1bb9ec5583f84de546b2df76.jpg" alt="imagem"><br><br>  O experimento acabou sendo bem-sucedido, e o controlador configurado para o ambiente Arduino piscou o LED com bastante sucesso depois de engolir o cl√°ssico Blink.  Bem, ent√£o, com o princ√≠pio de ‚Äúterminar a coruja‚Äù, adicionei um codificador (com um bot√£o), tr√™s LEDs e um transmissor normal com modula√ß√£o de amplitude em uma portadora de 433,92 MHz √† placa resultante. <br><br>  Para colocar todos os elementos em um estojo pequeno, tive que sofrer um pouco, mas o controle remoto ainda funcionava.  E, embora, ao que parece, o problema esteja resolvido, eu queria mais - o caso original. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b0b/716/2cc/b0b7162cc2941009ef081f0f76e4a2a8.jpg" alt="imagem"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/36b/08b/c76/36b08bc76093a6b66fe3f5e1b3597b1a.jpg" alt="imagem"><br><br><h2>  Segunda abordagem </h2><br>  Na verdade, a primeira vers√£o (reclamando) na apar√™ncia de um grupo de camaradas foi destru√≠da, ent√£o eu a adiei indefinidamente.  Mas ele n√£o entendeu: √© uma pena. <br><br>  Mas quando a impressora 3D apareceu, ele prometeu a si mesmo um dia fazer o mesmo estojo original e, assim, encerrar a quest√£o com o controle remoto. <br><br>  N√£o sei se ficou bom ou ruim - n√£o sei como avaliar minhas coisas.  Mas no 3DToday a equipe √© mais acolhedora do que no MySKU (do qual n√£o estou reclamando - n√£o √© um presente para mim), e eles classificaram o caso como mais alto do que eu. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5a1/89d/905/5a189d905d402c93afba5e4f4d88c1da.jpg" alt="imagem"><br><br>  Mas, com total liberdade de a√ß√£o, recusei as fr√°geis e gastas baterias chinesas e tomei a boa e velha 18650 como fonte de energia.E, como voc√™ pode ver facilmente, s√£o precisamente suas dimens√µes que determinam amplamente as dimens√µes de todo o caso. <br><br>  Comecei a tornar o inv√≥lucro modular, composto por v√°rias partes, o que me permitiu reimprimir apenas elementos individuais (err√¥neos ou n√£o muito ideais), e n√£o o produto inteiro. <br><br>  Outro ponto √© que eu realmente n√£o gosto de fazer recortes para conectores, o que realmente n√£o posso fazer.  Portanto, na cadeia de suprimentos h√° outro truque conhecido por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Evelyn, o ouri√ßo</a> : o carregamento sem fio. <br><br><img src="https://habrastorage.org/webt/ie/zq/6m/iezq6m_73cckmk6y-bidsohs9ye.jpeg"><br><br>  No meu zashashnik apenas colocar outro receptor, que eu imediatamente coloquei em a√ß√£o. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/fDLqxxDvQhM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Finalmente, o √∫ltimo truque √© bastante √≥bvio, mas ainda assim: para que o controle remoto n√£o se arraste pela mesa, colei um peda√ßo de um tapete antiderrapante no fundo.  E, no final, isso √© um mon√≥lito absoluto, embora reorganiz√°-lo para outro lugar tamb√©m n√£o seja um problema. <br><br><h2>  O que √© preciso para repetir </h2><br><h3>  Peda√ßo de ferro </h3><br>  1) Controlador ATmega328P - 1 pc.  (no meu pacote TQFP, mas qualquer um pode) <br>  2) resistor de 10 kOhm - 5 unid.  (4 para suprimir o retorno do codificador, 1 para o controlador) <br>  3) Resistor de 100 Ohm - 3 pe√ßas. <br>  4) Capacitores de cer√¢mica 0,1 microfarads - 4 un.  (ao controlador e supress√£o do retorno do codificador) <br>  5) Empurre o codificador (valcoder) - 1 pc.  (Eu tenho <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">PEC12-4220F-S0024</a> ) <br>  6) LEDs - 3 pe√ßas.  (di√¢metro 3 mm) <br>  7) Placa de carregamento da bateria de l√≠tio - 1 pc.  (do banco de pot√™ncia que chegou a m√£o, em teoria, qualquer pessoa com ativa√ß√£o autom√°tica sob carga far√°) <br>  8) Receptor de carregamento sem fio Qi - 1 pc. <br>  9) Um transmissor com modula√ß√£o de amplitude em 433 MHz - 1 pc.  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">assim</a> ) <br>  10) Alguma fibra de vidro para a placa do codificador <br>  11) impressora 3D <br>  12) Pl√°stico adequado (imprimi PLA) <br>  13) Parafusos M4x30 - 4 pe√ßas <br><br>  Em geral, o n√∫mero de componentes pode ser reduzido.  Por exemplo, em uma vers√£o muito m√≠nima, o controlador n√£o exige cintagem, embora eu tenha decidido seguir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o conselho de Nick Gammon</a> e n√£o poupou alguns capacitores e um resistor. <br><br>  Da mesma forma, voc√™ n√£o pode se preocupar com a supress√£o por hardware da rejei√ß√£o de contato e tentar se dar bem com o software.  Depois, voc√™ pode atravessar mais quatro resistores e um par de capacitores. <br><br>  Como alternativa, voc√™ pode usar uma placa Arduino pronta, como o Pro Mini, mas, neste caso, n√£o posso garantir um baixo n√≠vel de consumo de energia e voc√™ deve evoc√°-la.  Ao mesmo tempo, voc√™ ter√° que corrigir o caso. <br><br>  Esquema: <br><br><img src="https://habrastorage.org/webt/wo/xv/hh/woxvhhfaucpc3emhiyipfk56m1s.png"><br><br>  Para refer√™ncia, a pinagem ATmega328p no pacote TQFP-32 da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Hobby Electronics</a> : <br><br><img src="https://habrastorage.org/webt/1y/ea/sp/1yeasp0veriyrgvhrafu_inlwlm.jpeg"><br><br>  Para o meu codificador, desenhei uma pequena placa: <br><br><img src="https://habrastorage.org/webt/i2/jg/d7/i2jgd7p7jlv1kyhbyjhoayd3d4k.jpeg"><br><br><img src="https://habrastorage.org/webt/ke/cr/yt/kecrytksno5yhwsjjdpcbwgc9-c.jpeg"><br><br><img src="https://habrastorage.org/webt/6y/vb/8j/6yvb8jl1h6zvpm-z-atgntumnsw.jpeg"><br><br>  Se estiver bom, teria que ser perfurado para montar o codificador ou pressionado com a ‚Äúbarriga contra a placa (cuidando do isolamento para que n√£o houvesse curto-circuito) para que o codificador fosse montado a) mais ou menos uniformemente eb) n√£o oscilaria.  Historicamente, tenho uma segunda op√ß√£o. <br><br>  Para o caso, √© importante que a altura da placa com pe√ßas, excluindo o codificador, n√£o tenha mais (ou n√£o muito mais) 5 mm. <br><br><div class="spoiler">  <b class="spoiler_title">Se a placa do Arduino n√£o estiver pronta, ent√£o para que tudo funcione, voc√™ deve primeiro gravar o carregador de inicializa√ß√£o do Arduino no controlador ATmega328P.</b> <div class="spoiler_text">  Para fazer isso, primeiro, adicione uma descri√ß√£o do controlador ao ambiente do Arduino.  Para fazer isso, acesse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o site oficial do Arduino</a> e fa√ßa o download do arquivo de descri√ß√£o adequado para sua vers√£o do ambiente ( <a href="">para 1.6</a> , <a href="">para 1.5</a> , <a href="">para 1.0</a> ). <br><br>  O conte√∫do do arquivo morto deve ser extra√≠do para a pasta de hardware da pasta de ambiente do Arduino.  No futuro, descrevo o que est√° acontecendo no exemplo do ambiente 1.0.3, que ainda uso. <br><br>  Quando as descri√ß√µes s√£o copiadas, voc√™ deve iniciar o Arduino e carregar o esbo√ßo do programador no Arduino, que ser√° usado como esse pr√≥prio programador.  O esbo√ßo est√° localizado no menu Arquivo - Exemplos - ArduinoISP. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/037/517/98f/03751798f648adb8fea47a284a912667.jpg" alt="imagem"><br><br>  Obviamente, voc√™ deve escolher sua placa e porta.  Eu escolho Mega, porque eu tenho: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/7e7/483/4bd/7e74834bdd786979f926f4b65e2e344f.jpg" alt="imagem"><br><br>  Ap√≥s carregar o esbo√ßo do programador, voc√™ precisa mudar para o quadro de destino.  I.e.  no nosso caso - ATmega328 com uma frequ√™ncia de 8 MHz e um oscilador mestre interno.  Estar√° na lista de pain√©is se as descri√ß√µes mencionadas acima forem copiadas corretamente: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b89/e98/7b2/b89e987b2243a79cc1d36e95d5a7ebab.jpg" alt="imagem"><br><br>  Agora voc√™ precisa conectar as linhas MISO, MOSI e SCK da placa do programador e da placa com o futuro Arduino, al√©m de conectar RESET, GND e VCC.  Al√©m disso, o poder √© o melhor em √∫ltimo lugar. <br><br>  Com base no infogr√°fico acima e na descri√ß√£o do Arduino Mega, a seguinte imagem aparece: <br><br>  SPI - Arduino Mega - ATmega328p <br><br>  MISO - 50 - 16 <br>  MOSI - 51 - 15 <br>  SCK - 52 - 17 <br>  SS (RESET) - 53 - 29 <br><br>  Conex√£o f√≠sica ao seu gosto, usei um m√©todo exclusivamente b√°rbaro - fios comuns da t√°bua de p√£o diretamente nos orif√≠cios da placa, sem solda e isolamento: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c14/df6/d5f/c14df6d5f4cdda937de81eb2fa555ee0.jpg" alt="imagem"><br><br>  Se tudo estiver pronto, anote o gerenciador de inicializa√ß√£o.  Primeiro, verifique se o programador correto est√° selecionado (Servi√ßo - Programador - Arduino como ISP): <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e0c/dc4/a0c/e0cdc4a0c8914fbed3f5328c676f0210.jpg" alt="imagem"><br><br>  Em seguida, fazemos o servi√ßo - Bootloader Record: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/568/21e/12f/56821e12f02cd705995d40429b15eec6.jpg" alt="imagem"><br></div></div><br>  Depois disso, a sa√≠da √© uma placa Arduino minimalista, para carregar esbo√ßos nos quais voc√™ pode usar o adaptador USB-Serial ou uma placa Arduino completa com esse adaptador na placa.  No primeiro caso, voc√™ precisa conectar RX e TX transversalmente e n√£o se esque√ßa de conectar um ponto comum.  No segundo caso, √© adicionalmente necess√°rio colocar em curto o RESET Arduino, que √© usado como um adaptador, para o aterramento. <br><br>  Se voc√™, como eu, n√£o possui um circuito para redefinir automaticamente o controlador antes de baixar o esbo√ßo, h√° duas op√ß√µes: puxar sua redefini√ß√£o ou simplesmente ligar sua energia quando o ambiente do Arduino diz que o download foi iniciado. <br><br><h3>  Habita√ß√£o </h3><br>  O caso, como eu disse, √© modular.  Isso significa que, na parte interna oculta dos olhos, voc√™ pode deixar entrar o pl√°stico velho e que n√£o √© mais adequado.  Voc√™ pode colocar eletr√¥nicos nele: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/030/0a3/251/0300a325144382295c6e3b8d54971e23.jpg" alt="imagem"><br><br>  Chamo a aten√ß√£o para o fato de que o caso √© espec√≠fico e foi projetado para caber na minha vers√£o do preenchimento. <br><br>  Proponho tornar o rotor transparente, para dispersar a luz dos indicadores.  Para maior peso, uma porca M16 pode ser inserida dentro do rotor: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/9a0/8ef/68e/9a08ef68e2a079da4af3ed1eb148e961.jpg" alt="imagem"><br><br>  Ainda precisa de uma camisa do rotor e uma capa.  A tampa √© simplesmente inserida para dentro e repousa sobre o atrito.  E, √© claro, voc√™ n√£o pode prescindir das partes superior e inferior da caixa externa. <br><br>  Imprimi um rotor com um preenchimento de 10%, o restante dos elementos com um preenchimento de 5%.  Pl√°stico - PLA.  A temperatura definida do bico na minha impressora √© de 200 ¬∞ C nas tr√™s primeiras camadas, e de 185 ¬∞ C na pr√≥xima.  Infelizmente, n√£o sei dizer qual √© a temperatura real do bico.  A mesa est√° fria. <br><br>  A montagem √© simples. <br><br><img src="https://habrastorage.org/webt/ka/cq/2-/kacq2-crn1cictkqxhpb0sok15u.jpeg"><br><br>  As placas s√£o colocadas nas ranhuras da caixa dur√°vel, os LEDs - pernas nas ranhuras da parte inferior da caixa dur√°vel.  A antena do transmissor √© derrubada, o receptor de carregamento sem fio √© derrubado da mesma maneira - para que fique mais pr√≥ximo dessa mesma carga. <br><br><img src="https://habrastorage.org/webt/d9/zu/ex/d9zuextrjywuvjbj4ve68-c2rgg.png"><br><br>  O preenchimento √© fixado por uma placa intermedi√°ria, na ranhura da qual passa a fia√ß√£o do encoder. <br><br>  O codificador √© fixado com a placa superior, todos juntos s√£o apertados com parafusos M4x30, que cortam as roscas em pl√°stico. <br><br>  Agora, o estojo dur√°vel pode ser colocado ao meio do estojo externo.  Um rotor √© colocado no eixo do codificador e uma camisa √© colocada no rotor.  Opcionalmente, um tapete antiderrapante √© colado na parte inferior do corpo.  Outra op√ß√£o √© uma inser√ß√£o decorativa que oculta a costura entre as metades do corpo. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text">  No c√≥digo, voc√™ precisa especificar comandos para ligar e desligar seus dispositivos perif√©ricos.  Opcional - altere o tempo limite do desligamento autom√°tico. <br><br>  Tudo isso est√° localizado na se√ß√£o vari√°vel. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  : http://donalmorrissey.blogspot.ru/2010/04/sleeping-arduino-part-5-wake-up-via.html //  Livolo: http://forum.arduino.cc/index.php?action=dlattach;topic=153525.0;attach=108106 #include &lt;avr/sleep.h&gt; #include &lt;avr/power.h&gt; #include &lt;livolo.h&gt; #define adc_disable() (ADCSRA &amp;= ~(1&lt;&lt;ADEN)) // disable ADC (before power-off) #define adc_enable() (ADCSRA |= (1&lt;&lt;ADEN)) // re-enable ADC #define txPin 7 //   Livolo livolo(txPin); #define PULSESHORT 450 #define PULSELONG 1350 #define PULSESYNC 13950 #define encA 5 #define encB 6 //   #define buttonPin 2 //   () #define roomLed 10 //    #define kitchenLed 9 //    #define switchLed 3 //     #define switchLedTimeOut 150 //      #define switchTreshold 4 //      #define offDelay 15000 //   #define rLev 3 //     #define kLev 3 //     #define glev 2 //     #define txPowerPin 8 //    #define kitchenBackLightOn1 12 #define kitchenBackLightOn2 34 #define kitchenMainLightOn 56 #define roomBackLightOn 12 #define roomMainLightOn1 34 #define roomMainLightOn2 56 #define mainLightOn 12 #define kitchenBackLightOff1 12 #define kitchenBackLightOff2 34 #define kitchenMainLightOff 56 #define roomBackLightOff 12 #define roomMainLighOtff1 34 #define roomMainLightOff2 56 #define mainLightOff 12 #define LivoloID 8500 volatile byte rotorMode = 0; //   byte currentMode = 0; //    int curEncA, prevEncA, curButton, prevButton; //   ,  byte encCountPlus = 0; //   byte encCountMinus = 0; //   unsigned long offTimeOut = 0; //    unsigned long modeTimeOut = 0; //        unsigned long switchLedTime = 0; //      unsigned long modeTime = 0; //   unsigned int modeTreshold = 500; //     (  ) unsigned int bounceTreshold = 200; //     byte rLevState = 0; byte kLevState = 0; byte gLevState = 0; //   k - , r - , h - , b -  boolean kBackState = false; boolean kBackState1 = false; boolean kMainState = false; boolean rBackState = false; boolean rMainState = false; boolean rMainState1 = false; boolean hMainState = false; boolean bMainState = false; boolean afterSleep = false; //      boolean modeTimeOutStart = false; boolean switchLedOn = false; boolean allOn = false; //  " "    boolean allOff = false; //  " "    static void ookPulse(int on, int off) { digitalWrite(txPin, HIGH); delayMicroseconds(on); digitalWrite(txPin, LOW); delayMicroseconds(off); } static void rcSend(long remoteCode) { for (byte reSend = 0; reSend &lt; 8; reSend++) { for(byte repeat=0; repeat&lt;4; repeat++){ for (byte i = 24; i&gt;0; i--) { // transmit remoteID byte txPulse=bitRead(remoteCode, i-1); // read bits from remote ID // Serial.print(txPulse); switch (txPulse) { case 0: // 00 ookPulse(PULSESHORT,PULSELONG); //ookPulse(PULSESHORT,PULSELONG); break; case 1: // 11 ookPulse(PULSELONG,PULSESHORT); //ookPulse(PULSELONG,PULSESHORT); break; } // switch } // for loop ookPulse(PULSESHORT,PULSESYNC); // S(ync) // Serial.println(); } // repeat } delay(150); } void switchLedToggle() { digitalWrite(switchLed, HIGH); switchLedTime = millis(); switchLedOn = true; } void lightsUp(boolean lightsUpMode) { //       ""     //   "" -   if (afterSleep == true) { if (lightsUpMode == false) { gLevState = 1; rLevState = 3; kLevState = 3; } else {gLevState = 0; rLevState = 0; kLevState = 0; } afterSleep = false; //   " " } //   if (rotorMode == 2) { if (lightsUpMode == false){ if (allOff == false) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { //   gLevState = 0; rLevState = 0; kLevState = 0; rcSend(kitchenBackLightOff1); rcSend(kitchenBackLightOff2); rcSend(roomBackLightOff); livolo.sendButton(LivoloID, mainLightOff); } allOff = true; allOn = false; } } if (lightsUpMode == true){ //  ,    if (allOn == false) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { gLevState = 1; rLevState = 3; kLevState = 3; rcSend(kitchenBackLightOn1); rcSend(kitchenBackLightOn2); rcSend(roomBackLightOn); livolo.sendButton(LivoloID, mainLightOff); //    Livolo livolo.sendButton(LivoloID, kitchenMainLightOn); //#1   livolo.sendButton(LivoloID, roomMainLightOn1); // #2 livolo.sendButton(LivoloID, roomMainLightOn2); // #3 livolo.sendButton(LivoloID, mainLightOn); // #6 } allOn = true; allOff = false; } } } //  if (rotorMode == 1) { if (lightsUpMode == false &amp;&amp; kLevState &gt; 0) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { if (kLevState == 3) { //   livolo.sendButton(LivoloID, kitchenMainLightOff); // #3 } if (kLevState == 2) { //   2 livolo.sendButton(LivoloID, kitchenBackLightOff2); // #6 } if (kLevState == 1) { //   1 rcSend(kitchenBackLightOff1); } } if (kLevState!=0) { kLevState--;} // Serial.println(kLevState); } if (lightsUpMode == true &amp;&amp; kLevState &lt; 3) { switchLedToggle(); kLevState++; if (digitalRead(buttonPin) == HIGH) { if (kLevState &gt; 3) {kLevState = 3;} // Serial.println(kLevState); if (kLevState == 1) { //   1 rcSend(kitchenBackLightOn1); } if (kLevState == 2) { //   2 livolo.sendButton(LivoloID, kitchenBackLightOn2); // #6 } if (kLevState == 3) { //   livolo.sendButton(LivoloID, kitchenMainLightOn); // #3 } } } } //  if (rotorMode == 0) { if (lightsUpMode == false &amp;&amp; rLevState &gt; 0) { switchLedToggle(); if (digitalRead(buttonPin) == HIGH) { if (rLevState == 3) { //  1 livolo.sendButton(LivoloID, roomMainLighOtff1); //#1 } if (rLevState == 2) { //   livolo.sendButton(LivoloID, roomMainLightOff2); // #2 } if (rLevState == 1) { //   rcSend(roomBackLightOff); } } if (rLevState != 0) { rLevState--; } } if (lightsUpMode == true &amp;&amp; rLevState &lt; 3) { switchLedToggle(); rLevState++; if (digitalRead(buttonPin) == HIGH) { if (rLevState == 1) { //   rcSend(roomBackLightOn); } if (rLevState == 2) { //   livolo.sendButton(LivoloID, roomMainLightOn1); //#1 } if (rLevState == 3) { //   1 livolo.sendButton(LivoloID, roomMainLightOn2); // #2 } } } } } void wakeUp() { detachInterrupt(0); } void setMode() { if (rotorMode &gt;= 2 ) { rotorMode = 0; } else { rotorMode++; } offTimeOut = millis(); } void ledBlink() { for (byte iLed = 0; iLed&lt;3; iLed++) { digitalWrite(kitchenLed, HIGH); digitalWrite(roomLed, HIGH); delay(100); digitalWrite(kitchenLed, LOW); digitalWrite(roomLed, LOW); delay(100); } } void setLed() { if (rotorMode == 0) { //  digitalWrite(roomLed, HIGH); digitalWrite(kitchenLed, LOW); } if (rotorMode == 1) { //  digitalWrite(roomLed, LOW); digitalWrite(kitchenLed, HIGH); } if (rotorMode == 2) { //    digitalWrite(roomLed, HIGH); digitalWrite(kitchenLed, HIGH); } } void enterSleep() { // ledBlink(); afterSleep = true; digitalWrite(txPin, LOW); digitalWrite(txPowerPin, LOW); digitalWrite(roomLed, LOW); digitalWrite(kitchenLed, LOW); digitalWrite(switchLed, LOW); pinMode(txPin, INPUT); pinMode(txPowerPin, INPUT); pinMode(roomLed, INPUT); pinMode(kitchenLed, INPUT); pinMode(switchLed, INPUT); attachInterrupt(0, wakeUp, LOW); adc_disable(); set_sleep_mode(SLEEP_MODE_PWR_DOWN); sleep_enable(); sleep_mode(); sleep_disable(); power_all_enable(); pinMode(txPin, OUTPUT); pinMode(txPowerPin, OUTPUT); pinMode(roomLed, OUTPUT); pinMode(kitchenLed, OUTPUT); pinMode(switchLed, OUTPUT); digitalWrite(txPin, LOW); digitalWrite(txPowerPin, HIGH); // ledBlink(); setLed(); offTimeOut = millis(); allOn = false; allOff = false; } void setup() { // Serial.begin(115200); pinMode(txPin, OUTPUT); pinMode(txPowerPin, OUTPUT); pinMode(roomLed, OUTPUT); pinMode(kitchenLed, OUTPUT); pinMode(switchLed, OUTPUT); digitalWrite(txPin, LOW); digitalWrite(txPowerPin, HIGH); digitalWrite(roomLed, LOW); digitalWrite(kitchenLed, LOW); digitalWrite(switchLed, LOW); // pinMode(buttonPin, INPUT_PULLUP); pinMode(buttonPin, INPUT); pinMode(encA, INPUT); pinMode(encB, INPUT); prevEncA = digitalRead(encA); offTimeOut = millis(); rotorMode = 0; setLed(); prevButton = digitalRead(buttonPin); } void loop() { if ((millis() - offTimeOut) &gt; offDelay) { enterSleep(); } else { //     if (switchLedOn == true) { if ((millis() - switchLedTime) &gt; switchLedTimeOut) { digitalWrite(switchLed, LOW); switchLedOn = false; } } //       if (digitalRead(buttonPin) == LOW) { offTimeOut = millis(); } //   curButton = digitalRead(buttonPin); if ((prevButton == HIGH) &amp;&amp; (curButton == LOW)) { if (modeTimeOutStart == false) { modeTimeOut = millis(); modeTimeOutStart = true; } } else { if (modeTimeOutStart == true) { modeTime = millis() - modeTimeOut; if ((modeTime &lt; modeTreshold) &amp;&amp; (modeTime &gt; bounceTreshold)) { setMode(); modeTimeOutStart = false; prevButton = digitalRead(buttonPin); } else { modeTimeOutStart = false; prevButton = digitalRead(buttonPin); } } } //    if (currentMode != rotorMode) { //       ,     currentMode = rotorMode; //     setLed(); } //   curEncA = digitalRead(encA); if ((prevEncA == LOW) &amp;&amp; (curEncA == HIGH)) { offTimeOut = millis(); if (digitalRead(encB) == LOW) { encCountMinus++; encCountPlus = 0; // Serial.println("Encoder Minus"); if (encCountMinus &gt; switchTreshold) { encCountMinus = 0; lightsUp(false); } } else { encCountPlus++; encCountMinus = 0; // Serial.println("Encoder Plus"); if (encCountPlus &gt; switchTreshold) { encCountPlus = 0; lightsUp(true); } } } prevEncA = curEncA; } }</span></span></code> </pre> <br></div></div><br>  Modelo de caso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por refer√™ncia</a> . <br><br>  S√≥ isso. <br><br>  PS: Tentei n√£o esquecer nada, mas consegui.  Nesse caso, pe√ßo desculpas e farei o poss√≠vel para responder corretamente √†s perguntas principais e corrigir os erros. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt411093/">https://habr.com/ru/post/pt411093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt411083/index.html">P√¥r do sol "Estrelas da humanidade"</a></li>
<li><a href="../pt411085/index.html">Pi-Sonos v3.0: trabalhando em bugs ou em um projeto completamente novo?</a></li>
<li><a href="../pt411087/index.html">O futuro pr√≥ximo das placas de v√≠deo</a></li>
<li><a href="../pt411089/index.html">Como identificar um sat√©lite em √≥rbita</a></li>
<li><a href="../pt411091/index.html">Data Center Technologies: Informa√ß√µes gerais sobre comutadores QFX</a></li>
<li><a href="../pt411095/index.html">O telesc√≥pio Kepler fica sem combust√≠vel. A final est√° pr√≥xima</a></li>
<li><a href="../pt411097/index.html">Mensageiro m√≥vel aut√¥nomo</a></li>
<li><a href="../pt411099/index.html">√â f√°cil avaliar o PPFD ao iluminar uma planta com LEDs brancos: 1000 lux = 15 Œºmol / s / m2</a></li>
<li><a href="../pt411101/index.html">As autoridades de Nova York permitiram aumentar o custo da eletricidade para os mineiros</a></li>
<li><a href="../pt411105/index.html">O desempenho do drone Courier depender√° de onde voc√™ mora</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>