<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå¶Ô∏è üë©üèø‚Äçüè≠ ‚ú® IP-KVM √ºber QEMU üôÖüèæ üöà üíø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Fehlerbehebung beim Laden des Betriebssystems auf Servern ohne KVM ist keine leichte Aufgabe. Wir erstellen KVM-over-IP mithilfe eines Wiederherst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>IP-KVM √ºber QEMU</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/selectel/blog/464565/"><img src="https://habrastorage.org/webt/jr/rx/m6/jrrxm6jhxdczns-5x0qym8maw_u.png"><br><br>  Die Fehlerbehebung beim Laden des Betriebssystems auf Servern ohne KVM ist keine leichte Aufgabe.  Wir erstellen KVM-over-IP mithilfe eines Wiederherstellungsabbilds und einer virtuellen Maschine. <br><br>  Bei Problemen mit dem Betriebssystem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf dem Remote-Server</a> l√§dt der Administrator das Wiederherstellungsimage herunter und f√ºhrt die erforderlichen Arbeiten aus.  Diese Methode funktioniert einwandfrei, wenn die Fehlerursache bekannt ist und das Wiederherstellungsimage und das auf dem Server installierte Betriebssystem derselben Familie angeh√∂ren.  Wenn die Fehlerursache noch nicht bekannt ist, m√ºssen Sie den Fortschritt des Ladens des Betriebssystems √ºberwachen. <br><a name="habracut"></a><br><h2>  Remote-KVM </h2><br>  Sie k√∂nnen mit integrierten Tools wie IPMI oder Intel¬Æ vPro ‚Ñ¢ oder mit externen Ger√§ten, die als IP-KVMs bezeichnet werden, auf die Serverkonsole zugreifen.  Es gibt Situationen, in denen nicht alle aufgef√ºhrten Technologien verf√ºgbar sind.  Dies ist jedoch nicht das Ende.  Wenn der Server remote in ein Wiederherstellungsimage neu gestartet werden kann, das auf dem Linux-Betriebssystem basiert, kann KVM-over-IP schnell organisiert werden. <br><br>  Das Wiederherstellungsimage ist ein vollwertiges Betriebssystem, das sich im RAM befindet.  Somit k√∂nnen wir jede Software ausf√ºhren, einschlie√ülich virtueller Maschinen (VMs).  Das hei√üt, Sie k√∂nnen die VM starten, in der das Server-Betriebssystem funktioniert.  Der Zugriff auf die VM-Konsole kann beispielsweise √ºber die VNC erfolgen. <br><br>  Um das Server-Betriebssystem in der VM zu starten, m√ºssen Sie die Server-Festplatten als VM-Festplatten angeben.  Unter Linux-Betriebssystemen werden physische Festplatten als Blockger√§te der Form <b>/ dev / sdX dargestellt</b> , die wie normale Dateien <b>behandelt werden</b> k√∂nnen. <br><br>  Bei einigen Hypervisoren wie QEMU und VirtualBox k√∂nnen Sie VM-Daten in einer Rohform speichern, dh nur Speicherdaten ohne Hypervisor-Metadaten.  Auf diese Weise kann eine VM √ºber die physischen Festplatten des Servers gestartet werden. <br><br>  Diese Methode erfordert Ressourcen, um das Wiederherstellungsimage und die darin enthaltene VM auszuf√ºhren.  Bei vier oder mehr Gigabyte RAM ist dies jedoch kein Problem. <br><br><h2>  Umweltvorbereitung </h2><br>  Als virtuelle Maschine k√∂nnen Sie das einfache und einfache <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">QEMU-</a> Programm verwenden, das meistens nicht Teil des Wiederherstellungsimages ist. Daher muss es separat installiert werden.  Das Wiederherstellungsimage, das wir unseren Kunden anbieten, basiert auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Arch Linux</a> , das den <b>pacman-</b> Paketmanager verwendet. <br><br>  Zuerst m√ºssen Sie sicherstellen, dass das Wiederherstellungsimage die neueste Software verwendet.  Sie k√∂nnen alle Betriebssystemkomponenten mit dem folgenden Befehl √ºberpr√ºfen und aktualisieren: <br><br> <code>pacman -Suy</code> <br> <br>  Nach dem Update m√ºssen Sie QEMU installieren.  Der Installationsbefehl √ºber pacman sieht folgenderma√üen aus: <br><br> <code>pacman -S qemu</code> <br> <br>  √úberpr√ºfen Sie, ob qemu korrekt installiert ist: <br><br> <code>root@sel-rescue ~ # qemu-system-x86_64 --version <br> QEMU emulator version 4.0.0 <br> Copyright (c) 2003-2019 Fabrice Bellard and the QEMU Project developers</code> <br> <br>  Wenn ja, ist das Wiederherstellungsimage einsatzbereit. <br><br><h2>  Start der virtuellen Maschine </h2><br>  Zun√§chst m√ºssen Sie die Menge der der VM zugewiesenen Ressourcen ermitteln und die Pfade zu physischen Festplatten ermitteln.  In unserem Fall weisen wir der virtuellen Maschine zwei Kerne und zwei Gigabyte RAM zu, und die Festplatten befinden sich in den Pfaden <b>/ dev / sda</b> und <b>/ dev / sdb</b> .  VM ausf√ºhren: <br><br> <code>qemu-system-x86_64 \ <br> -m 2048M \ <br> -net nic -net user \ <br> -enable-kvm \ <br> -cpu host,nx \ <br> -M pc \ <br> -smp 2 \ <br> -vga std \ <br> -drive file=/dev/sda,format=raw,index=0,media=disk \ <br> -drive file=/dev/sdb,format=raw,index=1,media=disk \ <br> -vnc :0,password \ <br> -monitor stdio</code> <br> <br>  Ein bisschen mehr dar√ºber, was jeder der Parameter bedeutet: <br><br><ul><li>  <b>-m 2048M</b> - 2 GB RAM pro VM zuweisen; </li><li>  <b>-net nic -net user</b> - Hinzuf√ºgen einer einfachen Netzwerkverbindung √ºber einen Hypervisor mithilfe von NAT (Network Address Translation); </li><li>  <b>-enable-kvm</b> - <b>Aktiviert die</b> vollst√§ndige KVM-Virtualisierung (Kernel Virtual Machine). </li><li>  <b>-cpu host</b> - <b>Weist</b> den virtuellen Prozessor an, alle Funktionen des Serverprozessors <b>abzurufen</b> . </li><li>  <b>-M PC</b> - Typ der PC-Ausr√ºstung; </li><li>  <b>-smp 2</b> - Der virtuelle Prozessor muss Dual-Core sein. </li><li>  <b>-vga std</b> - <b>W√§hlen</b> Sie eine Standard-Grafikkarte aus, die keine Aufl√∂sungen f√ºr gro√üe Bildschirme unterst√ºtzt. </li><li>  <b>-drive file = / dev / sda, format = raw, index = 0, media = disk</b> <br><ul><li>  <b>file = / dev / sdX</b> - Pfad zum Blockger√§t, das die <b>Serverfestplatte darstellt</b> ; </li><li>  <b>format = raw</b> - Markieren Sie, dass in der angegebenen Datei alle Daten in der "raw" -Form vorliegen, dh wie auf der Festplatte. </li><li>  <b>index = 0</b> - Plattennummer, sollte f√ºr jede n√§chste Platte um eins erh√∂ht werden; </li><li>  <b>media = disk</b> - Die virtuelle Maschine sollte diesen Speicher als Festplatte erkennen. </li></ul></li><li>  <b>-vnc: 0, Kennwort</b> - F√ºhren Sie den Standard-VNC-Server um 0.0.0.0:5900 aus. Verwenden Sie das Kennwort als Autorisierung. </li><li>  <b>-monitor stdio</b> - Der Administrator kommuniziert mit qemu √ºber Standard-Eingabe- / Ausgabestreams. </li></ul><br>  Wenn alles in Ordnung ist, startet der QEMU-Monitor: <br><br> <code>QEMU 4.0.0 monitor - type 'help' for more information <br> (qemu)</code> <br> <br>  Wir haben angegeben, dass die Autorisierung mit einem Passwort erfolgt, das Passwort selbst jedoch nicht angegeben.  Sie k√∂nnen dies tun, indem Sie den Befehl change vnc password an den QEMU-Monitor senden.  Wichtiger Hinweis: Das Passwort darf nicht l√§nger als acht Zeichen sein. <br><br> <code>(qemu) change vnc password <br> Password: ******</code> <br> <br>  Danach k√∂nnen wir √ºber die IP-Adresse unseres Servers mit dem von Ihnen angegebenen Passwort eine Verbindung zu jedem VNC-Client herstellen, z. B. Remmina. <br><br><img src="https://habrastorage.org/webt/hz/c8/gv/hzc8gv9gh83yjki7t3ycmiazdds.png" title="Parameter f√ºr die Verbindung √ºber VNC"><br><br><img src="https://habrastorage.org/webt/um/qs/sh/umqsshwhmcbnd0c2uc_u0nte-la.png" title="Der VNC-Client hilft herauszufinden, warum das Betriebssystem nicht gestartet wurde."><br><br>  Jetzt sehen wir m√∂gliche Fehler nicht nur beim Laden, sondern k√∂nnen sie auch bek√§mpfen. <br><br>  Am Ende der Arbeit m√ºssen Sie die virtuelle Maschine fertigstellen.  Dies kann entweder innerhalb des Betriebssystems durch <b>Senden eines</b> Abschaltsignals erfolgen, oder Sie k√∂nnen dem QEMU-Monitor den Befehl <b>system_powerdown</b> geben.  Dies entspricht einem einzigen Druck auf die Schaltfl√§che zum Herunterfahren: Das Betriebssystem in der virtuellen Maschine wird reibungslos heruntergefahren. <br><br><h2>  Installation des Betriebssystems </h2><br>  Die virtuelle Maschine hat vollen Zugriff auf die Festplatten des Servers und kann daher zur manuellen Installation des Betriebssystems verwendet werden.  Die einzige Einschr√§nkung ist die RAM-Gr√∂√üe: Nicht immer kann das ISO-Image im RAM abgelegt werden.  Wir w√§hlen vier Gigabyte RAM zum Speichern des Bildes in <b>/ mnt</b> : <br><br> <code>mount -t tmpfs -o size=4G tmpfs /mnt</code> <br> <br>  Wir laden auch das Installationsimage des FreeBSD 12.0-Betriebssystems: <br><br> <code>wget -P /mnt ftp://ftp.freebsd.org/pub/FreeBSD/releases/amd64/amd64/ISO-IMAGES/12.0/FreeBSD-12.0-RELEASE-amd64-bootonly.iso</code> <br> <br>  Jetzt k√∂nnen Sie die VM starten: <br><br> <code>qemu-system-x86_64 \ <br> -m 2048M \ <br> -net nic -net user \ <br> -enable-kvm \ <br> -cpu host,nx \ <br> -M pc \ <br> -smp 2 \ <br> -vga std \ <br> -drive file=/dev/sda,format=raw,index=0,media=disk \ <br> -drive file=/dev/sdb,format=raw,index=1,media=disk \ <br> -vnc :0,password \ <br> -monitor stdio \ <br> -cdrom /mnt/FreeBSD-12.0-RELEASE-amd64-bootonly.iso \ <br> -boot d <br></code> <br><br>  Das <b>Flag -boot d</b> setzt den Start vom CD-Laufwerk.  Wir sind durch den VNC-Client verbunden und sehen den FreeBSD-Loader. <br><br><img src="https://habrastorage.org/webt/j4/jb/hh/j4jbhhidggiupbszepsduhffn0g.png" title="FreeBSD Bootloader."><br><br>  Da DHCP f√ºr den Zugriff auf das Internet verwendet wurde, ist es m√∂glich, dass nach der Konfiguration das neu installierte System gestartet und die Netzwerkeinstellungen korrigiert werden m√ºssen.  In einigen F√§llen kann es erforderlich sein, Netzwerkadaptertreiber zu installieren, da die auf dem Server installierte und in der VM emulierte Netzwerkkarte unterschiedlich ist. <br><br><h2>  Fazit </h2><br>  Diese Methode zum Organisieren des Remotezugriffs auf die Serverkonsole beansprucht einen Teil der Serverressourcen, stellt jedoch keine besonderen Anforderungen an die Hardwarekomponente des Servers und kann daher unter nahezu allen Bedingungen ausgef√ºhrt werden.  Die Verwendung dieser L√∂sung kann die Diagnose von Softwarefehlern erheblich erleichtern und den Zustand eines Remote-Servers wiederherstellen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464565/">https://habr.com/ru/post/de464565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464555/index.html">Einfache M√∂glichkeit, mit Bug Bounty Geld zu verdienen</a></li>
<li><a href="../de464557/index.html">XD Design Bobby Pro: Das Remake, auf das wir gewartet haben</a></li>
<li><a href="../de464559/index.html">Merkmale des Universiade-Transports und ein sehr begeisterter Alex</a></li>
<li><a href="../de464561/index.html">Schreiben von iOS-Anwendungen mit dem Redux-Muster</a></li>
<li><a href="../de464563/index.html">Informationssicherheit - Was m√ºssen Sie wissen und als guter Spezialist f√ºr Informationssicherheit gelten k√∂nnen?</a></li>
<li><a href="../de464571/index.html">Gehirn + VPS f√ºr 30 Rubel =?</a></li>
<li><a href="../de464579/index.html">Computer Vision Sommercamp - Intel Computer Vision Sommerschule</a></li>
<li><a href="../de464581/index.html">25 Arten von "Caesar" und englischen W√∂rtern</a></li>
<li><a href="../de464583/index.html">Ein riesiger 3D-Datensatz hilft Robotern, Dinge zu verstehen</a></li>
<li><a href="../de464591/index.html">Chemie von Brath√§hnchen. Detaillierte Analyse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>