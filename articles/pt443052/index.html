<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêØ üìå üë©üèº‚Äçüîß Lindo rel√≥gio preciso de um smartphone antigo üèéÔ∏è üôáüèΩ ‚è≠Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O artigo abordar√° como refazer um telefone celular desnecess√°rio antigo em excelentes rel√≥gios de parede com grandes n√∫meros, sempre com tempo preciso...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lindo rel√≥gio preciso de um smartphone antigo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443052/"><img src="https://habrastorage.org/webt/v3/zb/xe/v3zbxe4oreekk9jb1bdtkraqdcu.jpeg"><br><br>  O artigo abordar√° como refazer um telefone celular desnecess√°rio antigo em excelentes rel√≥gios de parede com grandes n√∫meros, sempre com tempo preciso e energia de backup. <br><br>  Vou falar sobre alguns dos recursos clarificados da sincroniza√ß√£o de tempo no sistema operacional Android, bem como sobre v√°rios truques el√©tricos no sistema de energia do smartphone.  Descreverei um exemplo de um circuito em componentes anal√≥gicos simples que fornece energia de backup autom√°tica.  E, √© claro, falaremos sobre a parte do software do Android - como e com que ajuda voc√™ pode criar um rel√≥gio bonito para todos os gostos do seu smartphone. <br><a name="habracut"></a><br>  ( <i>isen√ß√£o de responsabilidade tradicional - quaisquer marcas, marcas registradas, etc. mencionadas n√£o s√£o publicidade, espero que isso esteja claro.</i> ) <br><br><h4>  A segunda vida de um smartphone antigo </h4><br>  Meu antigo Philips Xenium W732 ficou ocioso por um longo tempo.  Totalmente funcionando, com uma tela cheia.  Eu decidi dar a ele uma segunda vida - transformar em um rel√≥gio de parede.  Meu antigo rel√≥gio dom√©stico, ainda sovi√©tico, com pequenos n√∫meros tremeluzentes, era muito dif√≠cil de ver a alguns metros.  Al√©m disso, eles estavam terrivelmente atrasados, tinham que ser decepcionados de vez em quando, com qualquer perda de eletricidade na casa, eram redefinidos para zero e exigiam um procedimento tedioso de apertar bot√µes e acertar a hora novamente.  Estava cansado de tudo isso e resolvi fazer um bom rel√≥gio "inteligente", desprovido de todas essas defici√™ncias, a partir do antigo celular. <br><br><h4>  O que eu precisava </h4><br><ol><li>  Grandes n√∫meros claros de qualquer cor, fonte e brilho desejados. </li><li>  M√°xima precis√£o e estabilidade sem nenhuma interven√ß√£o externa da mina. </li><li>  N√£o volatilidade, ou seja,  O rel√≥gio deve continuar a funcionar durante quedas de energia tempor√°rias. </li><li>  Trabalho totalmente aut√¥nomo, no sentido de - sem usar redes de dados pagas, cart√µes SIM, operadoras, etc. </li><li>  M√°xima conformidade com o princ√≠pio de "fabricado, ligado e esquecido".  Ou seja, um dispositivo nunca deve exigir manuten√ß√£o ou qualquer outro tipo de intera√ß√£o. </li></ol><br><h4>  N√≥s fornecemos Android com tempo preciso. </h4><br>  A primeira coisa a fazer era obter um hor√°rio mundial constantemente preciso em seu smartphone.  O conceito de "exato" para mim se encaixa em 1 ... 2 segundos de desvio do mundo. <br><br>  √â claro que o temporizador do sistema do celular n√£o dar√° tal estabilidade, n√£o √© exigido dele.  Portanto, a conformidade garantida com o hor√°rio mundial s√≥ pode ser obtida por sincroniza√ß√£o externa regular. <br><br>  No caso mais simples do Android, ele pode ser configurado usando o m√©todo "rede".  Al√©m disso, mesmo uma rede celular com inevit√°veis ‚Äã‚Äãcart√µes SIM e pagamentos de tarifas n√£o ser√° necess√°ria.  √â suficiente distribuir o Wi-Fi dom√©stico para o smartphone e configurar o roteador para sincronizar o tempo do provedor de Internet ou do servidor ntp. <br><br>  No entanto, existe um segundo m√©todo de sincroniza√ß√£o - para sat√©lites GPS, que pessoalmente acho melhor. <br><br>  Dos profissionais - voc√™ pode sincronizar em qualquer lugar do mundo onde o c√©u √© vis√≠vel.  Precis√£o absoluta de tempo, uma vez que o pr√≥prio GPS √© baseado nisso.  A falta de canais e emiss√µes adicionais de r√°dio. <br><br>  Das defici√™ncias do GPS - o dispositivo deve ver pelo menos um pouco de c√©u aberto.  Provavelmente, nada ser√° pego em um local arbitr√°rio no fundo da sala, especialmente se o dispositivo tiver um chip antigo e insens√≠vel.  E como meu rel√≥gio estava localizado exatamente longe da janela, eu precisava de uma antena GPS remota ... <br><br><h4>  A antena externa mais simples para recep√ß√£o GPS </h4><br>  Na Internet, tudo acabou sendo bastante restrito a esse t√≥pico.  Imediatamente percebi que n√£o poderia fabricar uma antena assim - projetos t√£o elaborados e volumosos com alguns c√°lculos complicados e complicados eram oferecidos em todo lugar.  Tentei encontrar uma compra - tamb√©m n√£o gostei de tudo.  Alguns s√£o grandes, desajeitados, exigem energia externa, com v√°rias funcionalidades desnecess√°rias e, ao mesmo tempo, inadequadamente caras. <br><br>  A solu√ß√£o foi encontrada por acaso - de alguma maneira vi uma descri√ß√£o de uma antena do tipo "dipolo de meia onda".  Em seu design mais simples, √© simplesmente um peda√ßo de fio reto com um comprimento igual √† metade do comprimento de onda do sinal desejado.  Essa ‚Äúcomplexidade‚Äù de constru√ß√£o foi bastante adequada para mim, ent√£o peguei o primeiro coaxial com imped√¢ncia de onda arbitr√°ria e o soldei delicadamente no smartphone para os contatos correspondentes da antena GPS. <br><br><div class="spoiler">  <b class="spoiler_title">Foto dos contatos da antena GPS na placa W732</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nn/em/ci/nnemci1spx4laynkv4kd_fe_syy.jpeg"><br>  <i>A tran√ßa e o n√∫cleo central do coaxial s√£o soldados a esses contatos</i> <br></div></div><br>  Acabei de liberar a outra extremidade do cabo da tran√ßa de tela para que um n√∫cleo central de 95 mm de comprimento permanecesse - isso √© metade do comprimento de onda na frequ√™ncia L1 do sinal GPS padr√£o (1575,42 MHz). <br><br><div class="spoiler">  <b class="spoiler_title">A antena GPS mais simples.</b>  <b class="spoiler_title">Dipolo de meia onda</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/as/a2/yk/asa2yk0mwvmd034n7maxcwsexkq.jpeg"><br>  <i>Esta antena deve ser colocada o mais pr√≥ximo poss√≠vel da janela.</i> <i><br></i>  <i>Eu colei no vidro com fita adesiva.</i> <i><br></i> </div></div><br>  O telefone tirou-o da janela e, por outro lado, a extremidade do fio com 95 mm de comprimento levou-o √† janela para que pudesse ver mais do c√©u. <br><br>  E assim - a Philips logo pegou seus honestos 5 ... 7 sat√©lites e consertou!  A antena est√° funcionando! <br><br>  E eu ainda estava preocupado com a coordena√ß√£o das imped√¢ncias de onda do cabo, antena e receptor, o que era supostamente necess√°rio nesses casos, com o qual eu estava coberto de c√©rebros na Internet nos f√≥runs de antenas.  Mais tarde, descobri que essa coordena√ß√£o de resist√™ncias √© necess√°ria para obter a m√°xima efici√™ncia da linha de transmiss√£o (falta de reflex√µes finais e atenua√ß√£o excessiva).  E se a linha tem apenas 2 ... 3 metros, como a minha, e a tarefa √© simplesmente entregar pelo menos uma parte do sinal ao receptor, voc√™ n√£o deve pensar nessa coordena√ß√£o - tudo funcionar√° com qualquer coaxial. <br><br><h4>  Recursos do processo de sincroniza√ß√£o do GPS </h4><br>  Tendo recebido um GPS em funcionamento, √© claro que eu imediatamente defini o m√©todo de sincroniza√ß√£o da hora "nos sat√©lites GPS" nas configura√ß√µes do Android e deixei o telefone nesse estado para verifica√ß√£o.  Qual foi a minha surpresa quando, algumas horas depois, o tempo no telefone "se separou" significativamente do rel√≥gio de controle no computador (onde o Windows est√° sincronizado com NTP).  Comecei a descobrir o motivo ... Acontece que o andr√≥ide, configurado para sincronizar o tempo via GPS, na verdade realiza essa sincroniza√ß√£o apenas <i>uma vez - no momento de fixar as coordenadas</i> . <br>  E ent√£o, mesmo que o smartphone continue monitorando continuamente os sat√©lites, o tempo do sistema ainda √© determinado apenas pelo gerador interno, ou seja, n√£o h√° sincroniza√ß√£o!  Pelo menos no meu Philips Android 4.0.3, tudo acontece dessa maneira. <br><br>  Para mim, foi uma surpresa desagrad√°vel.  N√£o vou continuar puxando o GPS manualmente para atualizar a hora exata ... <br><br>  A solu√ß√£o foi encontrada software.  Eu uso o programa Locus do software Asamm para navega√ß√£o, no qual √© poss√≠vel configurar manuten√ß√£o n√£o constante do GPS no estado ativo, mas corre√ß√µes peri√≥dicas de coordenadas √∫nicas em intervalos determinados, √© exatamente isso que eu precisava.  Defino o intervalo para 15 minutos e o problema desapareceu com seguran√ßa - o tempo no telefone celular desde ent√£o sempre coincide claramente com o mundo!  Por 15 minutos, o timer do sistema de qualquer smartphone normal n√£o acumular√° um erro de tempo de mais de 1 ... 2 segundos, o que me conv√©m perfeitamente.  Se desejar, voc√™ pode corrigir o clima quente pelo menos a cada dez segundos. <br><br><h4>  Restaura√ß√£o de um smartphone estacion√°rio </h4><br>  Ap√≥s o hor√°rio exato, foi a vez de fazer uma dieta competente para o meu rel√≥gio. <br><br>  Como eu j√° mencionei, eu precisava que o rel√≥gio n√£o desligasse e n√£o chegasse a zero durante quedas de energia a curto prazo em casa, o que, embora raro, acontece. <br><br>  A primeira solu√ß√£o mais desajeitada aqui √© conectar estupidamente o smartphone a uma tomada e deix√°-lo assim.  De fato, ao mesmo tempo, a quest√£o das quedas de energia √© perfeitamente resolvida - o celular simplesmente muda para uma bateria, que sempre estar√° totalmente carregada e pronta para uso.  Mal disse o que fez.  Conectado ... Uma semana se passou, o segundo - eu j√° estava come√ßando a me alegrar ... E no terceiro, um belo dia houve um aplauso, e a bateria voou com alegria do telefone para o meio da sala, inflada por press√£o interna para o estado da bola. <br><br><div class="spoiler">  <b class="spoiler_title">Bateria padr√£o Phillips</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/p7/e6/oj/p7e6ojfzrl_xu9egovxblz_l6mi.jpeg"><br>  <i>Esta √© a sua condi√ß√£o normal.</i>  <i>Plana e dura ...</i> <i><br></i> </div></div><br>  Como voc√™ sabe, tive at√© sorte de que as costuras do estojo da bateria n√£o pudessem suportar e n√£o teriam sido abertas; caso contr√°rio, eu seria capaz de evitar um inc√™ndio de l√≠tio, fuma√ßa, mau cheiro e lin√≥leo estragado. <br><br>  H√° apenas uma conclus√£o: voc√™ n√£o pode <i>usar um smartphone por meses e anos com uma carga constante</i> .  O telefone n√£o se aperfei√ßoou em tal cen√°rio.  Sua principal tarefa √© carregar corretamente a bateria ao m√°ximo, n√£o permitindo que a tens√£o e a temperatura excedam.  E ent√£o a descarga ainda √© suposta.  Se o dispositivo nunca for desconectado da tomada, o controlador geralmente come√ßar√° a manter um cronograma de carregamento do dente de serra - primeiro ajustando at√© 100%, depois desligando a corrente e aguardando a descarga em torno de 90%.  E essa √© uma abordagem ainda mais ou menos cuidadosa.  E muitos telefones antigos podem simplesmente estupidamente sempre manter a tens√£o m√°xima na bateria. <br><br>  Sabe-se que quanto maior a tens√£o em uma c√©lula de √≠ons de l√≠tio, mais r√°pido seu envelhecimento e degrada√ß√£o.  Alguns smartphones geralmente enchem suas baterias at√© acima de 4,2V para maximizar a vida √∫til da bateria.  Mas h√° apenas um resultado - estando constantemente na tens√£o m√°xima, a bateria se degrada muito mais rapidamente.  Se tamb√©m √© antigo, n√£o est√° longe do desenvolvimento gradual de circuitos internos microsc√≥picos, acelera√ß√£o t√©rmica e explos√£o, como aconteceu comigo. <br><br>  Ap√≥s o incidente com a bateria explodida, pensei: como posso ter energia de backup ao mesmo tempo e impedir que a bateria fique constantemente sob tens√£o total? <br><br>  Eu passei por muitos cen√°rios diferentes, eventualmente resolvi o seguinte. <br><br>  No modo normal, o telefone sempre ser√° alimentado por uma tomada, ou seja, 5V por meio de um conector USB. <br><br>  Usando um circuito adicional simples, a bateria de reserva √© carregada autom√°tica e simultaneamente at√© seu m√°ximo normal de 4,2V, ap√≥s o que √© <i>completamente desconectada da carga</i> .  Al√©m disso, a bateria √© simplesmente descarregada silenciosamente por autodescarga, n√£o sendo conectada a lugar algum.  Nesse caso, o circuito monitora constantemente sua tens√£o e volta a ligar a carga √∫nica at√© 4,2 apenas quando a tens√£o da c√©lula cai abaixo de um determinado m√≠nimo predeterminado (tomei 3,6V).  E assim por diante, tudo √© totalmente autom√°tico.  O tempo real entre essas recargas √© de anos, durante os quais a bateria se auto-descarrega lentamente, mas ainda assim √© capaz de suprir a carga a qualquer momento, mesmo que n√£o seja de sua capacidade total. <br><br>  No caso de uma falha de energia da tomada, a bateria deve ser conectada automaticamente automaticamente ao smartphone (como em fontes de alimenta√ß√£o ininterruptas), ap√≥s o que o sistema continuar√° a trabalhar com ele de forma aut√¥noma at√© que a energia da rede el√©trica seja restaurada ou at√© que a bateria esteja completamente descarregada (e desligada). <br><br>  Com essa abordagem, a c√©lula de l√≠tio √© operada em um modo mais poupador do que quando a tens√£o m√°xima √© constantemente mantida nela.  E certamente n√£o vai explodir! <br><br><h4>  Truques el√©tricos para smartphones </h4><br>  Agora, sobre como implementar todo esse circuito. <br><br>  A quest√£o aqui √© complicada pelo fato de que no smartphone n√£o era t√£o f√°cil organizar no sistema de energia. <br><br>  Por exemplo, sem bateria, o telefone n√£o liga, mesmo que haja 5V via USB. <br><br>  Se voc√™ remover a bateria enquanto estiver usando USB, tudo tamb√©m ficar√° em branco imediatamente.  Embora a energia ao mesmo tempo obviamente seja proveniente apenas do conector USB! <br><br>  No in√≠cio, houve um problema com o terceiro contato da bateria.  Eu n√£o queria estar ligado a uma bateria normal da Philips e decidi descobrir - o que acontecer√° se eu deixar o terceiro terminal de contato n√£o conectado?  Aconteceu que o smartphone n√£o ligava ao mesmo tempo ... Eu at√© comecei a temer que algum tipo de barramento digital sofisticado, como o i2c, passasse pelo contato do meio, que transmitiria ao telefone n√£o apenas v√°rias telemetrias t√©cnicas, mas tamb√©m todos os tipos de c√≥digos de f√°brica no estilo "amigo ou inimigo".  Isso significaria que eu estava eternamente ligada √† minha bateria nativa da Philips, porque definitivamente n√£o pretendia colocar nenhum tipo de interface digital enganosa aqui (lembro que tive uma surpresa semelhante ao trabalhar com baterias de filmadoras de uma empresa japonesa respeitada e mundialmente famosa). <br><br>  Eu olhei para o oscilosc√≥pio no que estava acontecendo no terceiro contato.  Felizmente para mim, o Philips W732 acabou por ser muito simples!  Ele exibe a tens√£o constante usual do sensor de temperatura da bateria interna.  A entrada do terceiro contato no smartphone √© alta imped√¢ncia. <br><br>  Montei um divisor de afina√ß√£o simples e, aplicando diferentes tens√µes no contato do meio, tirei v√°rios pontos da depend√™ncia da temperatura da bateria exibida pelo androide na tens√£o no terceiro contato. <br><br><div class="spoiler">  <b class="spoiler_title">Gr√°fico da temperatura da bateria exibida na tens√£o do terceiro contato</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dc/-g/gd/dc-ggdncroj-gfw1mrxyiltj530.png"><br></div></div><br>  Verificou-se que, se o terceiro for inferior a 153mV, os avisos em tela cheia sobre o superaquecimento da bateria ser√£o iniciados e, ap√≥s alguns segundos, o telefone ser√° desligado normalmente.  Em voltagens acima de 630mV, o andr√≥ide come√ßa a acreditar que sua bateria est√° congelada a menos temperatura, mas continuar√° funcionando (e mesmo silenciosamente!).  N√£o precisava mais experimentar - acabei de perceber que √© fundamental enganar o terceiro contato - basta aplicar qualquer potencial entre 155 e 600 mV l√°. <br><br>  Como resultado, adotei os crit√©rios da forma 2, sem os quais o smartphone n√£o funcionar√°: <br><br>  <b>1.</b> Tens√£o obrigat√≥ria no terminal positivo da bateria (apesar do sistema ser alimentado por um conector USB) <br><br>  E isso n√£o deve ser algum tipo de engano potencial falso, apenas para que o telefone pense que uma bateria est√° inserida nele.  Requer uma <i>fonte de</i> tens√£o de <i>baixa imped√¢ncia completa</i> com uma corrente de pelo menos a corrente operacional do smartphone. <br><br>  <b>2.</b> Presen√ßa de tens√£o constante no terceiro contato da bateria na faixa de 155 a 600mV.  J√° existe bastante potencial potencial de mistura simples. <br><br><hr><br>  A prop√≥sito, ainda n√£o entendo por que o andr√≥ide tem um limite de desligamento t√£o alto (3,4V), enquanto uma c√©lula de l√≠tio padr√£o pode facilmente descarregar at√© 3 e at√© 2,8V!  A √∫nica coisa que vem √† mente √© a presen√ßa em smartphones de consumidores internos a 3,3V, que precisam de um suprimento de energia para seus conversores buck.  Mas voc√™ pode colocar o SEPIC e usar a bateria mais completamente!  Ou na era moderna, ningu√©m pensa sobre isso? <br><hr><br>  Em seguida, foi necess√°rio criar um esquema auxiliar simples que monitorasse tudo isso e o controlasse automaticamente.  Decidi imediatamente que n√£o usaria nenhum microcontrolador, embora possa trabalhar com eles.  Nesse caso, voc√™ s√≥ precisava pensar um pouco, otimizar tudo minuciosamente e todas as fun√ß√µes foram implementadas em componentes anal√≥gicos simples.  Tudo funciona e nunca congela. <br><br>  A bateria do rel√≥gio de backup precisa ser carregada periodicamente a partir de alguma coisa.  No come√ßo, eu decidi faz√™-lo diretamente da bateria mais do smartphone, porque eu acreditava ingenuamente que tinha 4,2V honesto e imut√°vel.  Com a ajuda de um oscilosc√≥pio, observei o que realmente estava acontecendo l√°.  Descobriu-se que n√£o cheira a n√≠veis constantes! .. <br><br>  Primeiro, se nada estiver conectado ao terminal positivo da bateria, o controlador de carregamento ainda n√£o dorme e periodicamente o "verifica" com verifica√ß√µes. <br><br><div class="spoiler">  <b class="spoiler_title">Forma de onda de tens√£o no terminal positivo da bateria</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bi/hc/kq/bihckq8fd_wy5kabjuultdy7oai.png"><br>  ( <i>reconstru√ß√£o de uma forma de onda real</i> ) <br></div></div><br>  Voc√™ v√™ - depois de cada 45 milissegundos que o telefone fornece uma escada de "sondagem" consecutiva - a tens√£o externa apareceu no contato da bateria?  E entre essas verifica√ß√µes, um certo n√≠vel constante de 4,05V √© mantido. <br><br>  Se voc√™ conectar a bateria, o sistema a reconhecer√° e come√ßar√° a preencher a corrente regularmente.  Mas, novamente, n√£o constantemente, mas em per√≠odos de 10 segundos.  Ap√≥s cada um desses 10 segundos de carga, o smartphone por 2 segundos inclui uma <i>corrente reversa</i> completa, ou seja,  leva corrente da bateria e com energia decente (n√£o medi os valores num√©ricos exatos de todos esses par√¢metros, estava interessado no princ√≠pio).  Durante essa amostragem de corrente de curto prazo, o smartphone mede a carga da bateria sob carga, obtendo assim valores honestos de porcentagem e tens√£o.  Era claramente vis√≠vel como exatamente ap√≥s esse reverso no android os valores de todos os par√¢metros da bateria s√£o atualizados. <br><br>  Todo esse mecanismo de carga complicado n√£o me agradou nem interferiu, porque eu pretendia construir a l√≥gica dos circuitos de carregamento com base no controle cont√≠nuo de tens√£o anal√≥gica no shunt de medi√ß√£o.  E desligue automaticamente a carga quando a queda na deriva√ß√£o diminuir para um m√≠nimo predeterminado, indicando que a corrente de carga atingiu o est√°gio final de carga.  E ent√£o esse reverso estragou tudo ... No come√ßo, tentei contornar ou engan√°-lo, mas, como resultado, percebi que √© mais f√°cil usar uma fonte externa de uma tens√£o de refer√™ncia de carga.  Ser√° mais confi√°vel e mais transparente para um maior entendimento. <br><br>  Instalei um estabilizador externo externo (normal, linear), com o qual recebi 4,2V precisos e <i>com estabilidade de temperatura</i> de um carregador USB 5 ... 6V mal estabilizado.  Com eles, em primeiro lugar, alimentei o smartphone com um terminal de bateria positivo, para que ele sempre pensasse que tinha uma bateria 100% carregada e nunca transmitisse nada na tela por completo.  E em segundo lugar, o sistema de carga da bateria reserva funciona a partir desse barramento. <br><br>  Ao longo do caminho, me deparei com uma observa√ß√£o curiosa.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Acontece que, se voc√™ desligar a energia via USB e aplicar uma </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tens√£o constante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> de uma fonte estabilizada que nunca ser√° alterada para o </font><font style="vertical-align: inherit;">terminal da bateria do smartphone </font><font style="vertical-align: inherit;">, o andr√≥ide desenhar√° persistentemente um gr√°fico inclinado e decrescente da porcentagem de carga! </font><font style="vertical-align: inherit;">Aparentemente, algum tipo de equa√ß√£o para calcular essas porcentagens est√° incorporada no programa de monitoramento de bateria do Android, que leva em conta n√£o apenas a tens√£o real da c√©lula, mas tamb√©m o consumo atual do dispositivo. </font><font style="vertical-align: inherit;">Realizei experi√™ncias especificamente, ligando e desligando a luz de fundo da tela, como um dos consumidores atuais mais vorazes. </font><font style="vertical-align: inherit;">Aqui est√£o as estat√≠sticas coletadas por dia:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ent√£o, o Android desenhou um gr√°fico de "descarga da bateria"</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m-/_j/dc/m-_jdcx_h9vkganwg0-nuci6fdc.jpeg"><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b7/y_/vv/b7y_vvrfjlfd_5teazjmiksc8bi.jpeg"></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veja bem, quando a tela funcionou e a corrente do terminal da bateria ficou percept√≠vel, o androide apresentou uma boa inclina√ß√£o, um decl√≠nio de cerca de 5% por hora. Depois desliguei a luz de fundo e o smartphone adormeceu, a corrente caiu para alguns pequenos valores de espera e o gr√°fico foi quase na horizontal. Ele ligou a tela novamente - e novamente a rampa. Observe que a tens√£o no terminal positivo da bateria sempre foi estritamente </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">constante</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Assim, o andr√≥ide calculou sua porcentagem de carga apenas com base na corrente medida. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, assim que a carga atinge 15% (aqui o telefone emite um aviso sobre a bateria descarregada), o gr√°fico para de diminuir e depois continua 15% horizontalmente ... Aqui est√° o truque (ou falha).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Havia outro recurso. Verificou-se que, se voc√™ fornecer simultaneamente energia USB e energia externa estabilizada ao terminal da bateria, mas </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">menos de 4,2V</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , o smartphone mostrar√° primeiro e por muito tempo honestamente uma porcentagem incompleta de carga e, de repente, come√ßar√° a repreender, no estilo " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ algo com uma bateria! A carga est√° demorando muito!</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " E, claro, tudo isso de novo em tela cheia e em cima do meu rel√≥gio! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bem, se voc√™ aplicar mais de 4,2V, em torno de 4,3V ele come√ßar√° a jurar sobre o perigoso excesso de tens√£o da bateria, isso √© compreens√≠vel. Portanto, a "faixa de calma" aqui √© bastante estreita - apenas 0,1V.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E somente se ele receber energia USB de 5V e emula√ß√£o total dos 4,2V exatos atrav√©s do terminal da bateria - s√≥ ent√£o o androide feliz se calar√°, acreditando que ele honestamente carregou sua bateria ao m√°ximo. </font><font style="vertical-align: inherit;">E mais, ele j√°, gra√ßas a Deus, nunca reclama de nada!</font></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tranquilizarei imediatamente aqueles que podem ter pensado mal o fato de carregar duas fontes de tens√£o de baixa imped√¢ncia inconsistentes umas sobre as outras (ou seja, um estabilizador externo de 4,2V e um terminal positivo da bateria, que tamb√©m "alimenta") . </font><font style="vertical-align: inherit;">O fato √© que meu estabilizador externo √© um LDO linear comum e, por seus circuitos, n√£o √© capaz de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desviar a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corrente. </font><font style="vertical-align: inherit;">Apenas falhe. </font><font style="vertical-align: inherit;">Portanto, nenhum conflito el√©trico surge aqui, pois isso pode acontecer, por exemplo, quando v√°rias baterias diferentes s√£o conectadas em paralelo.</font></font><hr><br><br><h4>  Esquema </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o TK foi finalmente determinado, foi poss√≠vel come√ßar a desenvolver um esquema espec√≠fico. </font><font style="vertical-align: inherit;">Apesar da aparente simplicidade da tarefa, eu a consertei notavelmente! </font><font style="vertical-align: inherit;">Eu tive que inventar e depois rejeitar mais de uma d√∫zia de op√ß√µes diferentes, de indecentemente simples a volumosas.</font></font> Aqui est√° o resultado: <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plano de energia</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5p/av/_r/5pav_ru8mahbacmdyz4xxr6covo.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apesar da aparente redund√¢ncia, o esquema √© simples. </font><font style="vertical-align: inherit;">Gra√ßas ao SMD, um cachecol do tamanho de 35x22 mm cabe facilmente dentro do compartimento de uma bateria comum removida. </font><font style="vertical-align: inherit;">Como bateria de reserva, usei um √≠on de l√≠tio 18650 comum montado em um suporte de rel√≥gio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O circuito fornece as seguintes fun√ß√µes:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A principal fonte de alimenta√ß√£o constante de 5V da tomada atrav√©s do conector USB. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transfer√™ncia autom√°tica do smartphone para a bateria de reserva quando a energia √© perdida no USB. </font></font></li><li>   4,2     (    ). </li><li>       (   ). </li><li>            . </li><li>     ,   . </li><li>         . </li><li>        . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agora, brevemente, como o circuito funciona. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para obter um 4.2V est√°vel e independente da temperatura, usei o maravilhoso LDO ADM7172 integrado da Analog Devices. D√°-me a tens√£o desejada e perfeitamente uniforme de 4.22V at√© 2A de carga. Coloquei-o no meu smartphone na parte superior do conector da bateria (VBAT) e tamb√©m o utilizei para carregar a bateria de backup do sistema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O circuito de emula√ß√£o de tens√£o para o terceiro contato da bateria (TEMP) √© feito em um diodo simples D2, alimentado por uma corrente de fundo escassa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O mosfet de canal P Q4 conecta uma bateria de backup ao smartphone imediatamente, assim que a tens√£o desaparecer no barramento de alimenta√ß√£o principal de + 5V USB. O LED2 foi definido aqui apenas com o objetivo de alterar o n√≠vel para acelerar levemente a abertura do quarto trimestre no processo de flacidez do pneu. √â infravermelho e n√£o brilha em lugar algum.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O restante dos detalhes fez o circuito de carga. A bateria de reserva BT1 √© carregada atrav√©s do mosfet Q3 e do resistor limitador R9R10. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O trabalho de YOU U2 √© interessante aqui. Est√° t√£o inclu√≠do aqui que fornece controle tanto do grau de descarga quanto do grau de carga. O op-amp aqui opera no modo comparador, e um SO positivo para ele √© obtido por si s√≥ devido aos processos nos circuitos que controla.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eis como acontece: quando est√° tudo bem - h√° + 5V de energia USB e a bateria de reserva √© carregada at√© uma voltagem maior que a definida pelo ponto divisor R4R5R6 - ent√£o o amplificador operacional gera o potencial de um barramento de 4,2 volts (do qual √© alimentado) e o carregamento O Mosfet Q3 est√° fechado. Quando a bateria, por um motivo ou outro, descarrega abaixo desse ponto (+ 3,63 V no diagrama), a sa√≠da do amplificador operacional "se desconecta" gradualmente do sinal de mais e abre o mosfet de carregamento Q3. A corrente fluir√° para a bateria, a tens√£o na c√©lula aumentar√° imediatamente em pelo menos alguns milivolts (devido a resist√™ncia interna diferente de zero) e isso servir√° como um POS confi√°vel para o amplificador operacional. Aqui voc√™ pode aplicar um comparador real com sua pr√≥pria histerese, mas, na realidade, trocar o amplificador √© confi√°vel e r√°pido, n√£o h√° desvios.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A carga da bateria passa pelo resistor R9R10 (√© composto para aumentar a pot√™ncia de dissipa√ß√£o). Em primeiro lugar, limita a corrente de carga, o que √© absolutamente necess√°rio aqui, caso contr√°rio, mesmo um carregador de 2 A simplesmente n√£o suporta e cede. Em segundo lugar, de acordo com a queda de tens√£o nesse resistor, o circuito determina o momento em que a carga deve ser desligada.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso acontece da seguinte maneira: assim que a carga √© ligada, o mosfet auxiliar Q2 √© aberto ao mesmo tempo, que reconstr√≥i o divisor de controle R4R5R6 para a entrada inversora do amplificador operacional e, assim, o amplificador operacional come√ßa a monitorar a tens√£o que √© liberada no resistor de carga. No in√≠cio da carga, quando a bateria est√° completamente descarregada, cerca de 0,5V cai no R9R10, o que torna o amplificador operacional desequilibrado de forma confi√°vel no modo de estado de carga. E somente quando a bateria est√° gradualmente totalmente carregada, a corrente atrav√©s do resistor de controle enfraquece at√© um determinado valor (aproximadamente 20 mA), ent√£o os potenciais das entradas do amplificador operacional s√£o equalizados, ap√≥s o que √© transferido pelo mesmo mecanismo POS externo para o estado oposto (mais na sa√≠da), desligando os mosfets Q2 e Q3 e parar a cobran√ßa. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quanto ao esquema resultante</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perfil de carga de uma</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> bateria de √≠ons de l√≠tio, o resistor R9R10 aqui implementa automaticamente uma fun√ß√£o de carregamento simples com uma corrente inicial m√°xima, sua diminui√ß√£o gradual autom√°tica e se aproximando de zero.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gr√°fico da fun√ß√£o de carga</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yx/6o/cx/yx6ocxkusa2pis2406l_y9jqvrq.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Os fabricantes de baterias, por sua vez, recomendam o seguinte perfil de carga conhecido com se√ß√µes de estabiliza√ß√£o de corrente e tens√£o: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perfil de carga recomendado t√≠pico para √≠on de l√≠tio</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rt/o0/ab/rto0abfgdgab_tlfpkkwdhx2cdu.jpeg"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No meu caso, nem a tens√£o nem a corrente na c√©lula s√£o estabilizadas especificamente, mas a tens√£o nunca exceder√° os limites de seguran√ßa. Portanto, considero um m√©todo t√£o simplificado de cobran√ßa bastante eficiente e eficaz. Na pr√°tica, funciona muito bem e, ao mesmo tempo, requer apenas um resistor. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O Mosfet Q1 √© usado para que, ao trabalhar apenas com uma bateria de reserva, n√£o seja necess√°rio desperdi√ßar sua corrente para alimentar o restante do circuito. Quando a energia √© perdida na tomada, o Q1 fecha e corta toda a parte n√£o utilizada do circuito do fio comum. Devido a isso, o consumo pr√≥prio de toda a estrutura cai para um microsseguran√ßa desprez√≠vel de 3 ... 5, e isso impede automaticamente uma descarga profunda da bateria, caso voc√™ se esque√ßa do sistema morto por um longo tempo.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O diodo Schottky D1 na entrada do estabilizador U1 executa uma fun√ß√£o dupla - bloqueando a corrente reversa atrav√©s do U1 (n√£o existe esse bloqueio no ADM7172) e descarregando o microcircuito pequeno do estabilizador da dissipa√ß√£o excessiva de energia. </font><font style="vertical-align: inherit;">No in√≠cio da carga da bateria, a corrente de carga atinge 1A e, se todos os 1 volts da queda de tens√£o do barramento USB + 5V forem colocados no min√∫sculo ADM7172 de 3x3 mm, estar√° muito quente, mesmo com o bloco t√©rmico soldado √† placa. </font><font style="vertical-align: inherit;">Portanto, parte da tens√£o de entrada √© extinta com sucesso no diodo de bloqueio D1 e, como resultado, ambas as partes s√£o aquecidas mais uniformemente e nem tanto.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sobre componentes usados </font></font></h4><br>  Como estabilizador de entrada, usei um excelente LDO com uma queda de passagem m√≠nima muito baixa, embora neste local a tens√£o nunca caia abaixo de 0,4V.  Eu realmente gosto do ADM7172 para muitas de suas especifica√ß√µes.  E ent√£o aqui voc√™ pode colocar quase qualquer microcircuito estabilizador linear, o principal √© que ele fornece volts confi√°veis ‚Äã‚Äãque n√£o flutuam na temperatura e pelo menos 1,5 A de corrente. <br><br>  Dos mosfets, eu precisava de resist√™ncia m√≠nima de canal aberto (RdsON) aqui.  Isto √© especialmente verdade na chave de canal P bit Q4.  Coloquei uma amostra magn√≠fica do Toshibov TPH1R712MD - a melhor encontrada pela resist√™ncia do canal em uma pequena caixa plana.  No estado aberto, possui 1,3 mOhm real, que com uma corrente de trabalho de um smartphone de 200 ... 300 mA fornece perdas de tr√¢nsito da valiosa tens√£o da bateria no n√≠vel de 0,4 mV desprez√≠vel! <br><br>  Tamb√©m √© desej√°vel ter um RdsON baixo para Q1, a fim de se conectar com mais precis√£o ao potencial do fio comum.  Os mosfets FDMC8010 da Fairchild tamb√©m est√£o indo bem com isso.  Existem mais amostras de baixa imped√¢ncia, mas neste projeto as pequenas dimens√µes das pe√ßas tamb√©m foram importantes para mim. <br><br>  O restante dos mosfets pode ser qualquer um, √© apenas desej√°vel que eles tenham uma voltagem de abertura mais baixa. <br><br>  Como um comparador U2, usei o microchip Microchip MCP6V11 IOW, que gostei com sua excelente efici√™ncia - apenas 7 microamperes em segundo plano.  √â verdade que, comparado ao YOW convencional, √© certamente lento como uma tartaruga (GBW 80 kHz e taxa de rota√ß√£o de apenas 0,03 V / Œºs).  Mas funciona muito bem aqui de qualquer maneira.  A prop√≥sito, tentei colocar aqui um comparador real com histerese embutida.  Encontrei uma excelente amostra MCP6541, que consome apenas 600 nanoamps (!) Em segundo plano e, quando acionada, pode puxar a sa√≠da com uma pot√™ncia de at√© 30 mA ... Mas, colocando-a diretamente em vez de MCP6V11 (coincidindo sua pinagem), de repente tive uma falha no circuito.  Aconteceu que o MCP6541 comuta t√£o r√°pido que a frente de alta velocidade de seu pulso penetra facilmente atrav√©s da capacit√¢ncia Q2 do eletrodo de porta no circuito do divisor de controle R4R5R6 e chega √† sua pr√≥pria entrada inversora.  Acontece um feedback din√¢mico e o comparador n√£o muda, mas come√ßa a gerar. <br>  O problema ser√° resolvido com a simples adi√ß√£o de um resistor de alta resist√™ncia entre a sa√≠da do comparador e a porta Q2, mas eu j√° tinha uma placa na qual n√£o havia lugar para nenhum resistor SMD adicional adicional, ent√£o deixei o MCP6V11 aqui. <br><br>  O LED1 √© necess√°rio apenas para indicar quando uma carga est√° sendo derramada na bateria.  De uma maneira boa, isso deve acontecer a cada poucos anos ... Voc√™ pode usar absolutamente qualquer cor, ou n√£o pode coloc√°-lo. <br><br>  Resistores e capacitores s√£o os SMDs mais comuns, n√£o h√° requisitos para eles, exceto para o tamanho pequeno.  Usei capacitores de t√¢ntalo, baixoESR, nos gabinetes 7343H, mas qualquer um caber√°, apenas para caber no compartimento da bateria com a placa (para a Philips W732, ela tem 55x60x8 mm). <br><br>  No processo de carregamento da bateria, toda a placa aquece decentemente pelas primeiras duas horas, at√© 60 graus. Como ainda havia espa√ßo suficiente no compartimento, aumentei intencionalmente a √°rea da placa e ampliei as pe√ßas de aquecimento para que n√£o superaquecessem uma √† outra e aos outros vizinhos em v√£o. <br><br><div class="spoiler">  <b class="spoiler_title">Placa de gerenciamento de energia no compartimento da bateria</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bt/bf/jy/btbfjybybqxy0ope5aikbng-efw.jpeg"><br></div></div><br>  Feito √† m√£o, fotorresistente.  O m√©todo FR facilita a obten√ß√£o de um "processo" de 0,15 mm, mas, por alguma raz√£o, tenho todo o textolito de qualidade t√£o ruim que as estradas finas tentam cair quando se enlatam ... Se algu√©m sabe onde voc√™ pode comprar um textolite de boa qualidade com garantia - escreva nos coment√°rios ! <br><br>  Ent√£o, o smartphone finalmente est√° com energia adequada e funciona "como um rel√≥gio" em todos os sentidos!  Liga de forma est√°vel, com energia da tomada e da bateria, funciona silenciosamente.  Quando o carregador est√° conectado, ele sempre mostra 100% de carga.  Se voc√™ remov√™-lo da tomada, ele continuar√° funcionando silenciosamente a partir da bateria reserva e logo come√ßar√° a exibir a tens√£o real nela.  Ao restaurar o fornecimento de energia, novamente mostra silenciosamente e com calma uma carga de 100%.  Tudo est√° como deveria! <br><br>  Em princ√≠pio, atrav√©s de um circuito semelhante, voc√™ pode alimentar qualquer telefone celular que receba uma tens√£o constante simples atrav√©s do terceiro contato da bateria. <br><br><h4>  Rel√≥gio digital para Android </h4><br>  Sobre isso, o assunto foi conclu√≠do com ferro.  Chegou a hora das coberturas de software.  Ou seja, era necess√°rio obter um grande rel√≥gio digital na tela do smartphone. <br><br>  Aqui est√° o que eu precisava: <br><br><ol><li>  Os maiores n√∫meros poss√≠veis!  N√£o gosto de olhar de soslaio e de longe. </li><li>  Capacidade de colocar qualquer fonte de qualquer cor.  A legibilidade tamb√©m depende disso. </li><li>  A exclusividade de exibir o rel√≥gio na tela - nada al√©m de d√≠gitos de tempo n√£o deve estar l√°.  Nenhuma previs√£o do tempo, avisos, mensagens, barras de status e outras bobagens - <i>nunca devem</i> aparecer. </li><li>  √â claro que a tela do smartphone nunca deve ficar preta sozinha. </li><li>  Funcionamento adequado da fun√ß√£o de brilho autom√°tico da tela. </li><li>  Confiabilidade m√°xima (ainda vivo neste rel√≥gio).  Depende, frisos - tudo isso √© exclu√≠do. </li></ol><br>  Comecei ligando o telefone e arrancando sem piedade todo o lixo que consegui alcan√ßar.  Todos os tipos de gapps, blotware e tudo o que n√£o √© necess√°rio para o carregamento normal voaram para dentro do cesto.  Incluindo v√°rios aplicativos de sistema, v√°rios utilit√°rios para trabalhar com cart√µes SIM, discadores, SMS, navegadores, calend√°rios, pap√©is de parede e outras bobagens.  Eu at√© fui longe demais algumas vezes - o telefone estava em loop por erros.  Mas eu restaurei tudo e limpei novamente. <br><br>  Por um longo tempo, pesquisei na Internet um programa normal de rel√≥gios digitais de tela cheia para o Android.  Apesar de uma montanha de programas similares, quase nenhum me convinha!  Todos os desenvolvedores, sem exce√ß√£o, est√£o tentando colocar um monte de coisas desnecess√°rias em seus produtos - come√ßando com algum tipo de hist√≥rico engra√ßado (n√£o desconect√°vel) e terminando com previs√µes do tempo, not√≠cias, calend√°rios e outros tipos de lixo semelhantes.  Em geral, sou silencioso sobre os an√∫ncios pop-up que j√° chegaram a todos ... Eu s√≥ precisava de tempo desde o rel√≥gio! <br><br>  E o recurso universal dos programas e widgets de exibi√ß√£o √© o uso completamente antiecon√¥mico da √°rea da tela.  Os n√∫meros s√£o pequenos em todos os lugares e as margens das bordas da tela s√£o enormes.  Minha Philips, e por isso a tela n√£o √© a maior - apenas 4,3 ". <br><br>  Em resumo, encontrei quase o √∫nico programa adequado - Big Digital Clock 1.1.1. <br><br><div class="spoiler">  <b class="spoiler_title">Grande Rel√≥gio Digital</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/i7/lw/eq/i7lweqe_tgvvqwiqqzdmjo_sk9q.png"><br></div></div><br>  Ela tem os maiores n√∫meros.  E ainda est√£o longe do uso total da √°rea da matriz.  Das vantagens do programa - a capacidade de remover tudo da tela, exceto o tempo, a capacidade de escolher qualquer cor, formato de 24 horas, dois pontos divisores sem piscar, qualquer orienta√ß√£o da tela e manuten√ß√£o autom√°tica da luz de fundo n√£o esmaecida.  Das defici√™ncias - uma fonte bem costurada que imita um t√≠pico segmento de sete. <br><br>  Entregou e come√ßou o uso di√°rio.  No come√ßo, tudo estava bem - os n√∫meros parecem grandes, s√£o vis√≠veis normalmente e, depois das minhas antigas horas - geralmente c√©u e terra!  Mas agora, ap√≥s cerca de um m√™s de trabalho cont√≠nuo, repentinamente notei que o tempo <i>congelou</i> neles <i>e n√£o mudou!</i>  Que bobagem!?  Eu decidi verificar - esta √© uma falha √∫nica ou "recurso" do programa. <br><br>  Reiniciou o rel√≥gio e, ap√≥s algumas semanas, o friso foi repetido.  O tempo simplesmente para de atualizar.  Em vez disso, o programa afunda aleatoriamente a cada 7 ... 10 minutos, atualiza o rel√≥gio e novamente cai em um estupor.  √â claro que essa "confiabilidade" n√£o me agradou. <br><br><h4>  Android Automators e seus "chips" </h4><br>  Como esse era praticamente o √∫nico programa adequado, tive que come√ßar a inventar muletas para ele.  Decidi que precisava instalar algum tipo de ferramenta de automa√ß√£o do Android para reiniciar periodicamente o programa do rel√≥gio de buggy antes mesmo de ter tempo de congelar.  Coloque Tasker.  Ele estava ocupado, resolveu o problema - mas algo que eu n√£o gostei ... mudei para Automagic.  Quem n√£o conhece - esta ferramenta de automa√ß√£o usa scripts com base em fluxogramas visuais.  E essa caracter√≠stica dele realmente me atraiu! <br><br><div class="spoiler">  <b class="spoiler_title">Representar cen√°rios de automa√ß√£o Automagic</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dl/pr/ki/dlprki-84b4sgbvlax3ao2wm9kw.jpeg"><br></div></div><br>  A fun√ß√£o de reiniciar periodicamente meu programa de observa√ß√£o de buggy eu implementei quase imediatamente.  E ent√£o ele colocou o Automagic em seu smartphone principal e ficou por uma semana em experi√™ncias interessantes com ele.  Como resultado, fiz muita utilidade para a vida cotidiana no meu telefone. <br><br>  Mas isso n√£o era o principal.  Me deparei com propriedades Automagic em um chip como Widgets personalizados.  E ent√£o descobriu-se que, com sua ajuda, voc√™ pode desenhar e "reviver" praticamente <i>qualquer widget caseiro</i> que tenha apenas a imagina√ß√£o e a funcionalidade do programa!  Ent√£o percebi que podia me desenhar um rel√≥gio, que apenas meu cora√ß√£o deseja!  Al√©m disso, a ajuda do programa acabou de descrever um exemplo de cria√ß√£o de um widget de rel√≥gio. <br><br>  Depois de alguns dias, tudo estava pronto da melhor maneira poss√≠vel!  Gra√ßas ao lancer Nova, tenho a capacidade de esticar widgets at√© as extremidades da matriz.  Tamb√©m escondi a barra de encaixe e a barra de status, liberando a tela de todos os elementos da interface.  E aqui est√° o resultado: n√∫meros realmente enormes em rela√ß√£o √†s bordas da tela ... Finalmente, feliz !!! <br><br><div class="spoiler">  <b class="spoiler_title">Finalmente, os n√∫meros ocupam toda a largura da tela!</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/5k/xv/9s/5kxv9sdud2mssdnn7xm1iuo8k5m.jpeg"><br></div></div><br>  O uso do Automagic me permitiu satisfazer todos os meus requisitos.  Voc√™ pode colocar qualquer fonte .ttf ou .otf.  Voc√™ pode desenhar e esticar caracteres em qualquer propor√ß√£o para ajust√°-los perfeitamente na tela.  Finalmente, voc√™ s√≥ pode ter o que precisa!  Eu nem desenhei dois pontos divididos no rel√≥gio - com um espa√ßo simples, tudo √© perfeitamente leg√≠vel.  Na aplica√ß√£o de quaisquer programas e muletas externos, imediatamente n√£o √© mais necess√°rio. <br><br>  Al√©m disso, agora eu nem precisava do Locus para corrigir periodicamente as coordenadas do GPS para sincroniza√ß√£o de tempo.  Tudo isso pode ser feito perfeitamente por qualquer ferramenta de automa√ß√£o.  Em um cen√°rio de controle, voc√™ pode implementar quase tudo o que precisa.  Por exemplo, mantendo a tela em um estado n√£o esbatido. <br><br>  Al√©m disso, geralmente foram problemas com diferentes esmaltes da apar√™ncia.  E por que n√£o, se tudo isso pode ser facilmente implementado? <br><br>  Por exemplo, ao escolher o tamanho e o fator da fonte, voc√™ precisa come√ßar com um formato de hora com quatro caracteres (XX: XX).  Mas no per√≠odo de 0:00 a 9:59, h√° apenas tr√™s d√≠gitos na tela, eles ocupam uma largura menor que quatro e, portanto, n√£o usam totalmente a matriz.  Um pouco, mas feio.  Com o Automagic, o caso √© facilmente resolvido com alguns comandos adicionais.  Ele possui uma fun√ß√£o que permite alterar praticamente qualquer par√¢metro de um widget personalizado <i>em tempo real</i> .  Nesse caso, esse √© o fator da largura (nivelamento) dos caracteres da fonte, que defino para alterar pelo acionador dos intervalos de tempo acima.  Isso funciona! <br><br><div class="spoiler">  <b class="spoiler_title">Tr√™s e quatro caracteres cabem no mesmo tamanho de tela</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9t/ns/5r/9tns5rg_kbtelwl0fixwluearic.jpeg"><br>  <i>O fator de largura da fonte muda "on the fly" com a transi√ß√£o das 9:59 para as 10:00</i> <i><br></i>  <i>e volta das 23:59 √†s 0:00</i> <br></div></div><br>  No come√ßo, tive d√∫vidas sobre o <i>momento em que as</i> leituras <i>do</i> rel√≥gio eram <i>atualizadas a</i> cada minuto.  Eu tinha medo que o Automagic o atualizasse n√£o de forma s√≠ncrona com a altera√ß√£o dos minutos do rel√≥gio do sistema do smartphone, mas arbitrariamente, introduzindo um erro aleat√≥rio por um minuto.  Comecei a verificar ... <br><br>  No Automagic, existem duas maneiras diferentes de implementar o tempo em um widget personalizado.  Voc√™ pode enviar valores num√©ricos para um campo de texto comum de um widget por um evento de a√ß√£o externo.  Para cada evento, existe apenas uma op√ß√£o especial ‚ÄúEm hor√°rio fixo‚Äù, o que significa que voc√™ precisa envi√°-lo exatamente de forma s√≠ncrona com o momento em que a hora do sistema muda. <br><br>  E o segundo m√©todo √© mais simples - ele n√£o usa scripts externos e consiste em escrever uma fun√ß√£o de chamada do sistema do tipo diretamente no campo de texto desejado do widget <br><br><pre><code class="plaintext hljs">{getDate(),dateFormat,HH:mm}</code> </pre> <br>  Mas n√£o existe essa op√ß√£o "Em hor√°rio fixo".  O widget √© simplesmente marcado como "Atualizar automaticamente" e definido como "Intervalo de atualiza√ß√£o" exatamente por um minuto.  E aqui meus medos eram precisamente que esse intervalo de auto-renova√ß√£o do widget em um minuto possa ser contado arbitrariamente em rela√ß√£o √† "grade" de tempo da mudan√ßa de minutos da hora do sistema.  Fiz algumas experi√™ncias, mas, para minha alegria, tudo estava em ordem.  O widget se atualiza claramente imediatamente, assim que os minutos do rel√≥gio do sistema mudam! <br><br>  N√£o importa em que momento o widget come√ßou a funcionar. <br><br><h4>  Tela de brilho autom√°tico </h4><br>  A pr√≥xima coisa que eu queria fazer era um bom brilho autom√°tico da tela.  O brilho autom√°tico embutido na minha Philips antiga funcionou muito bem.  Espasmos, inadequados e com uma faixa muito estreita.  Aqui eu n√£o me incomodei e coloquei um dos muitos programas de brilho autom√°tico.  Eu tentei Lux no come√ßo, mas n√£o gostei de algumas tinturas n√£o intuitivas e perfis complexos.  Mudou para Velis, e isso acabou sendo o que precisamos.  O que eu gostei especialmente - Velis permite desenhar uma curva real da depend√™ncia do brilho nas leituras do lux√¥metro e mostra em tempo real neste gr√°fico como o smartphone ajusta o brilho de acordo com ele.  Voc√™ pode configurar qualquer lei de mudan√ßa de brilho muito suave e, claro, qualquer valor dela, at√© 1%, quando a tela estiver quase invis√≠vel.  √â muito conveniente √† noite, quando os n√∫meros mal devem brilhar. <br><br>  Enquanto eu corria em torno do novo rel√≥gio, notei que a matriz do smartphone, mesmo com um fundo de tela completamente preto, ainda brilha decentemente com a luz de fundo passando por ele.  Isso √© especialmente vis√≠vel na escurid√£o total - o ret√¢ngulo da tela √© claramente vis√≠vel na forma de um plano de fundo cinza, algo como um efeito de brilho.  Eu decidi consert√°-lo com um filtro externo.  A cor dos n√∫meros do rel√≥gio que escolhi vermelho, porque  a cor vermelha que vejo mais claramente de longe. <br><br>  Fiz o primeiro filtro manualmente - imprimi um preenchimento vermelho s√≥lido em uma impressora a jato de tinta em um filme transparente e dobrei duas impress√µes ainda cruas com tinta uma na outra.  Os filmes s√£o firmemente aderidos e √© obtido um bom "vidro" transparente de uma cor vermelha espessa.  A prop√≥sito, agora que esse golpe de vida n√£o funcionar√° mais, √© brega, porque no meu trabalho absolutamente todas as impressoras a jato de tinta foram substitu√≠das por MFPs a laser da moda.  Eles imprimem perfeitamente no papel, mas √© imposs√≠vel obter um preenchimento de cor transparente no filme com a ajuda deles - haver√° uma camada fosca barulhenta atrav√©s da qual nada √© vis√≠vel. <br><br>  Mas aqui, de alguma forma, entrei no Komus em busca de l√°pis e vi acidentalmente esse tipo de coisa: <br><br><div class="spoiler">  <b class="spoiler_title">Foto</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/of/e8/pw/ofe8pwoxfgo5hvkmvhul5evpync.jpeg"><br></div></div><br>  Essa √© uma bandeja de papel comum para escrit√≥rio, mas veja do que √© feita.  Plexiglass ou pl√°stico transparente, mas √© da mesma cor e transmiss√£o de luz que eu preciso para o filtro.  Comprei, recortei cuidadosamente um prato para encaixar na tela e o adaptei.  Beleza! <br><br><div class="spoiler">  <b class="spoiler_title">Com filtro vermelho</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/oq/oh/dr/oqohdrcoghynsiygiugq_egez_0.jpeg"><br></div></div><br><h4>  Toques finais </h4><br>  Em princ√≠pio, com isso, a transforma√ß√£o de um velho telefone celular desnecess√°rio em excelentes rel√≥gios pode ser considerada completa. <br><br>  √â verdade que, mesmo antes da pilha, fiquei confuso com o fato de que no editor de fontes alterei um pouco a fonte .otf para que os caracteres fossem como eu queria, at√© as menores dobras.  Um pouco, mas legal!  Tamb√©m era necess√°rio tornar a fonte monoespa√ßada, para que, ao alterar os caracteres, a linha n√£o se movesse para fora dos limites da exibi√ß√£o.  Utilizou um dos editores de fonte aberta, o Glyphr Studio. <br><br>  Bem, no final, resta apenas fixar toda a estrutura em uma prateleira no canto da sala.  H√° uma grande margem para criatividade.  Simplesmente dobrei a tira de alum√≠nio em forma de L e apertei suavemente a tampa traseira do smartphone com parafusos.  Aparafusou a outra extremidade na prateleira.  Voc√™ pode girar definindo qualquer √¢ngulo de vis√£o.  E um pouco de alum√≠nio dobrado, ajustando o √¢ngulo verticalmente.  Na verdade, geralmente instalei tudo, para n√£o tocar mais. <br><br>  A bateria de reserva se adaptou na dobra da tira de montagem.  Aqui eu fiz sem um design requintado, nada pode ser visto por tr√°s.  Eu tamb√©m n√£o me incomodei com nenhum cont√™iner de terminal para a bateria, mas simplesmente soldei cuidadosamente a caixa de metal 18650 nos locais que n√£o uniam o conte√∫do interno da bateria para n√£o superaquec√™-la com um ferro de solda. <br><br>  Todas as conex√µes s√£o feitas por fia√ß√£o comum, lan√ßada atrav√©s dos furos na tampa traseira do smartphone.  E l√° dentro, vi diretamente os detalhes e as faixas da placa do smartphone. <br><br>  No total, dois fios externos v√™m do design: energia de 5V do carregador principal e um cabo de antena GPS que vai para a janela e √© colado ao vidro com fita adesiva. <br><br>  H√° quase um ano, os rel√≥gios me encantam com n√∫meros grandes e bonitos, funcionamento preciso e opera√ß√£o confi√°vel ininterrupta. <br><br>  E por divers√£o, desenhei um segundo widget de rel√≥gio - para a localiza√ß√£o vertical do smartphone. <br><br><div class="spoiler">  <b class="spoiler_title">Rel√≥gios horizontais e verticais na mesma escala</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hr/_b/o6/hr_bo6oelso-e2dyzglvbvnf9qa.jpeg"><br></div></div><br>  Comecei a invent√°-lo pela raz√£o de que os n√∫meros com esse arranjo n√£o convencional podem ser ainda maiores, ou seja, o uso √∫til da √°rea da tela acaba sendo o m√°ximo poss√≠vel.  Al√©m disso, nesse caso, a necessidade de alterar o fator de largura de caractere sempre que mudar do formato de hora X: XX para XX: XX e vice-versa desaparece, pois tudo sempre entra automaticamente. <br><br>  √â verdade que quase todo mundo a quem mostrei um rel√≥gio vertical t√£o fora do padr√£o disse: ‚Äúfuu, a horizontal √© melhor!‚Äù.  Bem, isso √© um assunto amador, eu pessoalmente gosto dos dois. <br><br>  Isso √© tudo.  Obrigado a todos que leram! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt443052/">https://habr.com/ru/post/pt443052/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt443038/index.html">Se a supercola entrar nos olhos</a></li>
<li><a href="../pt443040/index.html">7 principais raz√µes pelas quais os aplicativos est√£o bloqueados no Google Play e AppStore</a></li>
<li><a href="../pt443042/index.html">Lan√ßamento de 619 mil tetris no GLSL, sua renderiza√ß√£o e um bot simples</a></li>
<li><a href="../pt443046/index.html">Como os pesquisadores de seguran√ßa acessam sites protegidos do c√≥digo iOS</a></li>
<li><a href="../pt443050/index.html">A explica√ß√£o mais simples de como os algoritmos de criptografia sim√©trica funcionam hoje</a></li>
<li><a href="../pt443054/index.html">Uma sele√ß√£o de utilit√°rios para um programador no Linux</a></li>
<li><a href="../pt443056/index.html">Segundo paciente com HIV atinge remiss√£o</a></li>
<li><a href="../pt443058/index.html">Arquitetura limpa. Parte I - Introdu√ß√£o</a></li>
<li><a href="../pt443060/index.html">A nave estelar alcan√ßar√° Marte?</a></li>
<li><a href="../pt443062/index.html">Como eu criei o Recycle! VR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>