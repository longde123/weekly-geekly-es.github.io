<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüîß üê• üë¢ Backdoors de microc√≥digo montados no processador X86 üï• üïû üòø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√£o confiamos em software h√° muito tempo e, portanto, realizamos sua auditoria, realizamos engenharia reversa, executamos em um modo passo a passo, ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Backdoors de microc√≥digo montados no processador X86</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427757/"><p> N√£o confiamos em software h√° muito tempo e, portanto, realizamos sua auditoria, realizamos engenharia reversa, executamos em um modo passo a passo, executamos na sandbox.  E o processador no qual nosso software √© executado?  - Confiamos cegamente e de todo o cora√ß√£o neste pequeno peda√ßo de sil√≠cio.  No entanto, o hardware moderno tem os mesmos problemas que o software: funcionalidade secreta n√£o documentada, bugs, vulnerabilidades, malware, cavalos de Troia, rootkits, backdoors. </p><br><p><img src="https://habrastorage.org/webt/ip/yi/6i/ipyi6itjefhde2aetsgvqabmbwo.jpeg"></p><br><p>  O ISA (Arquitetura do conjunto de instru√ß√µes) x86 √© uma das ‚Äúarquiteturas do conjunto de instru√ß√µes‚Äù que mais mudam continuamente na hist√≥ria.  Come√ßando com o design do 8086 desenvolvido em 1976, o ISA est√° passando por mudan√ßas e atualiza√ß√µes cont√≠nuas;  mantendo a compatibilidade com as vers√µes anteriores e o suporte para a especifica√ß√£o original.  Ao longo de 40 anos, a arquitetura ISA cresceu e continua a crescer com muitos novos modos e conjuntos de instru√ß√µes, cada um dos quais adiciona uma nova camada ao design anterior, que j√° est√° sobrecarregado.  Devido √† pol√≠tica de total compatibilidade com vers√µes anteriores, os modernos processadores x86 ainda cont√™m instru√ß√µes e modos que j√° est√£o completamente esquecidos.  Como resultado, temos uma arquitetura de processador, que √© um labirinto complexo de tecnologias novas e antigas.  Um ambiente t√£o complexo - causa muitos problemas com a seguran√ßa cibern√©tica do processador.  Portanto, os processadores x86 n√£o podem afirmar ser a raiz confi√°vel da infraestrutura cibern√©tica cr√≠tica. </p><a name="habracut"></a><br><h2 id="vy-vsyo-eschyo-doveryaete-svoemu-processoru">  Voc√™ ainda confia no seu processador? </h2><br><p>  Seguran√ßa de programas e sistema operacional - baseia-se na seguran√ßa do hardware no qual eles s√£o implantados.  Como regra, os desenvolvedores de software n√£o levam em considera√ß√£o o fato de que o hardware no qual o software √© implantado pode ser n√£o confi√°vel, malicioso.  Quando o hardware se comporta erroneamente (intencionalmente ou n√£o), os mecanismos de seguran√ßa do software se tornam completamente in√∫teis.  Por muitos anos, v√°rios modelos de processadores seguros foram oferecidos: Intel SGX, AMD Pacifica, etc. No entanto, a regularidade invej√°vel com a qual as informa√ß√µes s√£o publicadas sobre falhas cr√≠ticas (das mais recentes, por exemplo, Meltdown e Spectre) e detectadas fun√ß√µes n√£o documentadas de "depura√ß√£o" - levam a o pensamento de que nossa confian√ßa total nos processadores n√£o tem fundamento. </p><br><p>  Os processadores x86 modernos s√£o um entrela√ßamento muito complexo e complicado das tecnologias mais recentes e antigas.  8086 tinha 29 mil transistores, Pentium 3 milh√µes, Broadwell 3,2 bilh√µes, Cannonlake mais de 10 bilh√µes. </p><br><p><img src="https://habrastorage.org/webt/tn/p-/_2/tnp-_2qkl0ubruapqvdv-57kcko.png"></p><br><p>  Com tantos transistores, n√£o √© surpreendente que os modernos processadores x86 estejam repletos de instru√ß√µes n√£o documentadas e vulnerabilidades de hardware.  Entre os documentos n√£o documentados, descobertos quase por acidente, est√£o as instru√ß√µes: ICEBP (0xF1), LOADALL (0x0F07), apicall (0x0FFFF0) [1], que permitem o desbloqueio do processador para acesso n√£o autorizado a √°reas de mem√≥ria protegidas. </p><br><p>  Quanto √†s numerosas vulnerabilidades de hardware dos processadores (veja duas figuras abaixo), elas permitem que um ciberataqueiro tenha privil√©gios [3], extraia chaves criptogr√°ficas [4], crie novas instru√ß√µes de montagem [2], altere a funcionalidade das instru√ß√µes de montagem j√° existentes [2] , instale ganchos nas instru√ß√µes do montador [2], assuma o controle da ‚Äúvirtualiza√ß√£o acelerada por hardware‚Äù [7], intervenha nos ‚Äúc√°lculos criptogr√°ficos at√¥micos‚Äù [7] e, finalmente, doce, entre no ‚Äúmodo deus‚Äù:  ive-se um hardware leg√≠timo Intel ME backdoor (que permite que voc√™ receba acesso remoto mesmo o computador desligado). [8]  E tudo isso - sem deixar vest√≠gios digitais. </p><br><p><img src="https://habrastorage.org/webt/8b/7r/hu/8b7rhuqyqipkayzqgoa-dvxximu.png"><br><img src="https://habrastorage.org/webt/v9/hi/pk/v9hipk3k6e1n8krpm22zz8j_0uk.png"></p><br><h2 id="sovremennye-processory--eto-bolshe-soft-chem-zhelezo">  Processadores modernos s√£o mais software que hardware </h2><br><p>  A rigor, os processadores modernos nem mesmo podem ser chamados de "hardware" no sentido pleno da palavra.  Porque sua funcionalidade mais cr√≠tica (incluindo ISA) √© fornecida piscando o microc√≥digo.  Inicialmente, o microc√≥digo era o principal respons√°vel pelo controle da decodifica√ß√£o e execu√ß√£o de instru√ß√µes complexas do montador: opera√ß√µes de ponto flutuante, primitivas MMX, manipuladores de linha com o prefixo REP etc.  No entanto, com o tempo, mais e mais responsabilidades s√£o atribu√≠das ao microc√≥digo pelas opera√ß√µes de processamento dentro do processador.  Por exemplo, extens√µes modernas de processadores Intel, como AVX (Advanced Vector Extensions) e VT-d (virtualiza√ß√£o de hardware) s√£o implementadas no microc√≥digo. </p><br><p>  Al√©m disso, hoje o microc√≥digo √© respons√°vel, entre outras coisas, por manter o estado do processador, gerenciar o cache e tamb√©m gerenciar a economia de energia.  Para economizar energia, o microc√≥digo possui um mecanismo de interrup√ß√£o que processa os estados de energia: estado C (grau de sono de economia de energia: do estado ativo ao sono profundo) e estado P (diferentes combina√ß√µes de tens√£o e frequ√™ncia).  Assim, por exemplo, o microc√≥digo √© respons√°vel por redefinir o cache L2 ao entrar no estado C4 e ao sair dele. </p><br><h2 id="zachem-proizvoditeli-processorov-polzuyutsya-mikrokodom">  Por que os fabricantes de processadores usam microc√≥digo? </h2><br><p>  Os fabricantes de processadores x86 usam o microc√≥digo para decompor instru√ß√µes de montagem complexas (que podem ter at√© 15 bytes de comprimento) em uma cadeia de micro-instru√ß√µes simples, a fim de simplificar a arquitetura do hardware e facilitar o diagn√≥stico.  De fato, o microc√≥digo √© um int√©rprete entre a arquitetura CISC externa (vis√≠vel ao usu√°rio) e a arquitetura RISC interna (hardware). </p><br><p>  Se forem detectados erros na arquitetura CISC (principalmente no ISA), os fabricantes publicam uma atualiza√ß√£o de microc√≥digo que pode ser baixada no processador atrav√©s do BIOS / UEFI da placa-m√£e ou do sistema operacional (durante o processo de inicializa√ß√£o).  Gra√ßas a esse sistema de atualiza√ß√£o baseado em microc√≥digos, os fabricantes de processadores oferecem flexibilidade e redu√ß√£o de custos - enquanto corrigem erros em seus equipamentos.  O erro sensacional com o fdiv, que derrubou severamente os processadores Intel Pentium em 1994, tornou o fato de que os erros de hardware de alta tecnologia propensos exatamente como o software o tornam ainda mais √≥bvio.  Esse incidente deu aos fabricantes ainda mais interesse na arquitetura de processadores baseados em microc√≥digo.  Portanto, Intel e AMD come√ßaram a construir seus processadores usando a tecnologia de microc√≥digo.  Intel - come√ßando com o Pentium Pro (P6), lan√ßado em 1995.  AMD - come√ßando com o K7, lan√ßado em 1999. </p><br><h2 id="vsyo-taynoe-stanovitsya-yavnym">  Tudo segredo fica claro </h2><br><p>  Apesar do fato de os fabricantes de processadores estarem tentando manter a arquitetura dos microc√≥digos e o mecanismo para atualiz√°-los com a maior confidencialidade, o inimigo n√£o est√° dormindo.  Peda√ßos de informa√ß√µes fragmentadas (principalmente de patentes, como AMD RISC86 [5]) e revers√£o ponderada das atualiza√ß√µes oficiais do BIOS (como aconteceu com o K8 [6]), gradualmente lan√ßam luz sobre o segredo do microc√≥digo (veja, por exemplo, na figura abaixo " Mecanismo de atualiza√ß√£o de microc√≥digo do processador AMD ‚Äù).  E gra√ßas √† constante evolu√ß√£o das ferramentas de engenharia reversa (software e hardware) [2], t√©cnicas promissoras de difus√£o [1] e o advento de ferramentas OpenSource como Microparse [9] e Sandsifter [10] - um invasor cibern√©tico pode aprender tudo sobre um microc√≥digo necess√°rio para ter que escrever um malware de microc√≥digo nele. </p><br><p><img src="https://habrastorage.org/webt/rp/ko/yc/rpkoycfyygkkxhvcyxe4poffqri.png"></p><br><p>  Ent√£o, por exemplo, em [2] como "Ol√°, mundo!"  (a primeira etapa para trojanizar o microc√≥digo), foi desenvolvido um ‚Äúmicro gancho‚Äù (programa de microc√≥digo que intercepta a instru√ß√£o assembler), que conta quantas vezes o processador acessou o comando div.  Este microhook √© uma inje√ß√£o no manipulador da instru√ß√£o assembler div. </p><br><p><img src="https://habrastorage.org/webt/rn/kv/os/rnkvos_2xlvug2sjpyxjkif2h5a.png"></p><br><p>  Ibid [2] apresenta um microhook mais avan√ßado - que fica silenciosamente na instru√ß√£o assembler do div ebx, sem dar presen√ßa, e √© ativado apenas quando condi√ß√µes espec√≠ficas s√£o atendidas ao acessar o ebx div: o registrador ebx cont√©m o valor B e o registrador eax cont√©m o valor A. Quando ativado, este microhook aumenta em um o valor do registro eip (ponteiro de instru√ß√£o atual).  Como resultado, a execu√ß√£o do programa (que teve a coragem de se referir √† instru√ß√£o div ebx) continua com um deslocamento: n√£o a partir do primeiro byte do comando ap√≥s a div ebx, mas a partir do segundo byte.  Se outros valores forem especificados nos registros eax e ebx, a div ebx funcionar√° normalmente.  Qual √© o valor pr√°tico disso?  Por exemplo, para ativar silenciosamente uma cadeia oculta de instru√ß√µes do montador ao usar t√©cnicas de ofusca√ß√£o com ‚Äúinstru√ß√µes sobrepostas‚Äù [11]. </p><br><p><img src="https://habrastorage.org/webt/gx/af/w9/gxafw9lfzweuvhrirvuwf_qfbu0.png"></p><br><p>  Estes dois exemplos demonstram como as instru√ß√µes leg√≠timas do assembler podem ser usadas para ocultar neles o c√≥digo de Trojan </p><br><p>  Ao mesmo tempo, um invasor cibern√©tico pode ativar sua carga maliciosa - inclusive remotamente.  Por exemplo, quando a condi√ß√£o necess√°ria para a ativa√ß√£o √© cumprida em uma p√°gina da web controlada por um invasor.  Isso √© poss√≠vel gra√ßas aos compiladores Just-in-Time (JIT) e Ahead-of-Time (AOT) incorporados nos modernos navegadores da web.  Esses compiladores permitem emitir um fluxo predefinido de instru√ß√µes do assembler para c√≥digo de m√°quina - mesmo se voc√™ escrever o programa exclusivamente em JavaScript de alto n√≠vel (consulte a √∫ltima lista, logo acima). </p><br><div class="spoiler">  <b class="spoiler_title">Bibliografia</b> <div class="spoiler_text"><ol><li>  <em>Christopher Domas</em> .  Quebrando o ISA x86 // DEFCON 25.07.2017. </li><li>  <em>Philipp Koppe</em> .  Microc√≥digo do processador x86 de engenharia reversa // Anais do 26¬∫ Simp√≥sio de Seguran√ßa da USENIX.  2017. pp.  1163-1180. </li><li>  <em>Matthew Hicks</em> .  SPECS: um mecanismo de tempo de execu√ß√£o leve para proteger software de erros cr√≠ticos do processador de seguran√ßa // Anais da 28¬™ Confer√™ncia Internacional sobre Suporte √† Arquitetura para Linguagens de Programa√ß√£o e Sistemas Operacionais (ASPLOS).  2015. pp.  517-529. </li><li>  <em>Adi Shamir</em> .  Ataques de bugs // Anais da 28¬™ confer√™ncia anual sobre criptografia: avan√ßos na criptografia.  2008. pp.  221-240. </li><li>  <em>John Favor</em> .  Conjunto de Instru√ß√µes RISC86 // Patente US 6336178. 2002. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Opteron Exposed: Atualiza√ß√µes de Microc√≥digo AMD K8 de Engenharia Reversa</a> .  2004. </li><li>  <em>Saming Chen</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">An√°lise de seguran√ßa de x86 Processor Microcode</a> .2014. </li><li>  <em>Catalin Cimpanu</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O malware usa o recurso obscuro da CPU Intel para roubar dados e evitar firewalls</a> .  2017. </li><li>  <em>Daming Chen</em> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Microparse: Analisador de microc√≥digo para processadores AMD, Intel e VIA</a> // GitHub.  2014. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Sandsifter: O fuzzer do processador x86</a> // GitHib.  2017. </li><li>  <em>Karev V.M.</em>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Como escrever um programa assembler com instru√ß√µes sobrepostas (outra t√©cnica para ofuscar o c√≥digo de bytes)</a> // Habrahabr.  2018. URL: (Data de acesso: 25 de outubro de 2018). </li></ol></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427757/">https://habr.com/ru/post/pt427757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427745/index.html">Dicas e truques do Kubernetes: acesso aos sites de desenvolvimento</a></li>
<li><a href="../pt427747/index.html">Quem esmaga um carro n√£o tripulado: resultados do experimento da M√°quina Moral</a></li>
<li><a href="../pt427749/index.html">Apple e Samsung s√£o multadas pela primeira vez por desacelerar telefones antigos</a></li>
<li><a href="../pt427751/index.html">CudaText Sublime Ideas</a></li>
<li><a href="../pt427755/index.html">Nova vers√£o do GitLab 11.4 com revis√£o por pares de solicita√ß√µes de mesclagem e sinalizadores de recursos</a></li>
<li><a href="../pt427759/index.html">Sobre a resolubilidade de problemas na via em tempo polinomial</a></li>
<li><a href="../pt427761/index.html">Implementa√ß√£o do algoritmo k-means (k-means) usando o exemplo de trabalho com pixels</a></li>
<li><a href="../pt427763/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Aula 13: Protocolos de Rede, Parte 1</a></li>
<li><a href="../pt427767/index.html">Situa√ß√£o: no Canad√°, eles propuseram a introdu√ß√£o de um imposto sobre streaming - estamos discutindo qual √© o problema.</a></li>
<li><a href="../pt427771/index.html">Curso MIT "Seguran√ßa de sistemas de computadores". Aula 13: Protocolos de Rede, Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>