<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐪 🔲 🏳️ Tarantool Data Grid: Architektur und Funktionen 👨‍👩‍👧 ⬇️ 👨🏾‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="2017 haben wir den Wettbewerb für die Entwicklung des Transaktionskerns für das Investmentgeschäft der Alfa-Bank gewonnen und sofort mit der Arbeit be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tarantool Data Grid: Architektur und Funktionen</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/471744/"><img src="https://habrastorage.org/webt/v7/6-/di/v76-dikmo5ifekbsg35xutol68s.jpeg"><br><br>  2017 haben wir den Wettbewerb für die Entwicklung des Transaktionskerns für das Investmentgeschäft der Alfa-Bank gewonnen und sofort mit der Arbeit begonnen.  (Vladimir Drynkin, Leiter des Entwicklungsteams für den Investment Business Transaction Core der Alfa-Bank, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">sprach</a> auf der HighLoad ++ 2018 über den Investment Business Core.) Dieses System sollte Transaktionsdaten in verschiedenen Formaten aus verschiedenen Quellen zusammenfassen, die Daten vereinheitlichen, speichern und Zugriff darauf gewähren. <br><br>  Im Laufe der Entwicklung hat das System seine Funktionen weiterentwickelt und erweitert.  Irgendwann wurde uns klar, dass wir viel mehr als nur Anwendungssoftware für einen genau definierten Aufgabenbereich erstellt haben: Wir haben ein System zum Erstellen verteilter Anwendungen mit dauerhaftem Speicher erstellt.  Unsere Erfahrung diente als Grundlage für das neue Produkt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tarantool Data Grid</a> (TDG). <br><br>  Ich möchte über die TDG-Architektur und die Lösungen sprechen, die wir während der Entwicklung erarbeitet haben.  Ich werde die Grundfunktionen vorstellen und zeigen, wie unser Produkt zur Grundlage für schlüsselfertige Lösungen werden kann. <br><a name="habracut"></a><br>  In Bezug auf die Architektur haben wir das System in separate <i>Rollen unterteilt</i> .  Jeder von ihnen ist für eine bestimmte Reihe von Aufgaben verantwortlich.  Eine laufende Instanz einer Anwendung implementiert einen oder mehrere Rollentypen.  In einem Cluster können mehrere Rollen desselben Typs vorhanden sein: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/305/53b/214/30553b214c136611f00c94a8c33621e0.png"></div><br><h2>  Anschluss </h2><br>  Der Connector ist für die Kommunikation mit der Außenwelt verantwortlich.  Es ist so konzipiert, dass es die Anforderung akzeptiert, analysiert und bei Erfolg die Daten zur Verarbeitung an den Eingabeprozessor sendet.  Folgende Formate werden unterstützt: HTTP, SOAP, Kafka, FIX.  Die Architektur ermöglicht es uns, Unterstützung für neue Formate hinzuzufügen (IBM MQ-Unterstützung wird in Kürze verfügbar sein).  Wenn das Analysieren von Anforderungen fehlschlägt, gibt der Connector einen Fehler zurück.  Andernfalls wird geantwortet, dass die Anforderung erfolgreich verarbeitet wurde, auch wenn bei der weiteren Verarbeitung ein Fehler aufgetreten ist.  Dies geschieht absichtlich, um mit Systemen zu arbeiten, die nicht wissen, wie Anforderungen wiederholt werden sollen, oder umgekehrt, und zwar zu aggressiv.  Um sicherzustellen, dass keine Daten verloren gehen, wird die Reparaturwarteschlange verwendet: Das Objekt tritt der Warteschlange bei und wird erst nach erfolgreicher Verarbeitung aus der Warteschlange entfernt.  Der Administrator erhält Benachrichtigungen über die in der Reparaturwarteschlange verbleibenden Objekte und kann die Verarbeitung nach Behandlung eines Softwarefehlers oder eines Hardwarefehlers wiederholen. <br><br><h3>  Eingabeprozessor </h3><br>  Der Eingabeprozessor kategorisiert die empfangenen Daten nach Merkmalen und ruft die entsprechenden Handler auf.  Handler sind Lua-Code, der in einer Sandbox ausgeführt wird, sodass sie den Systembetrieb nicht beeinflussen können.  In diesem Stadium könnten die Daten nach Bedarf transformiert werden, und bei Bedarf können beliebig viele Aufgaben ausgeführt werden, um die erforderliche Logik zu implementieren.  Wenn Sie beispielsweise einen neuen Benutzer in MDM hinzufügen (Master Data Management basierend auf Tarantool Data Grid), wird ein goldener Datensatz als separate Aufgabe erstellt, damit die Anforderungsverarbeitung nicht verlangsamt wird.  Die Sandbox unterstützt Anforderungen zum Lesen, Ändern und Hinzufügen von Daten.  Außerdem können Sie eine Funktion für alle Rollen des Speichertyps aufrufen und das Ergebnis aggregieren (Zuordnen / Reduzieren). <br><br>  Handler können in Dateien beschrieben werden: <br><br><pre><code class="lua hljs">sum.lua <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> x, y = <span class="hljs-built_in"><span class="hljs-built_in">unpack</span></span>(...) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> x + y</code> </pre> <br>  Dann in der Konfiguration deklariert: <br><br><pre> <code class="lua hljs">functions: sum: { __file: sum.lua }</code> </pre> <br>  Warum Lua?  Lua ist eine einfache Sprache.  Basierend auf unserer Erfahrung beginnen Menschen, Code zu schreiben, der ihr Problem nur ein paar Stunden nach dem ersten Sehen der Sprache löst.  Und das sind nicht nur professionelle Entwickler, sondern zum Beispiel Analysten.  Darüber hinaus ist Lua dank des JIT-Compilers sppedy. <br><br><h3>  Lagerung </h3><br>  Der Speicher speichert persistente Daten.  Vor dem Speichern werden die Daten auf Übereinstimmung mit dem Datenschema überprüft.  Zur Beschreibung des Schemas verwenden wir das erweiterte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Apache Avro-</a> Format.  Beispiel: <br><br><pre> <code class="plaintext hljs">{ "name": "User", "type": "record", "logicalType": "Aggregate", "fields": [ { "name": "id", "type": "string" }, { "name": "first_name", "type": "string" }, { "name": "last_name", "type": "string" } ], "indexes": ["id"] }</code> </pre> <br>  Basierend auf dieser Beschreibung werden DDL (Data Definition Language) für Tarantool DBMS und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GraphQL-</a> Schema für den Datenzugriff automatisch generiert. <br><br>  Die asynchrone Datenreplikation wird unterstützt (wir planen auch die synchrone Replikation). <br><br><h3>  Ausgabeprozessor </h3><br>  Manchmal ist es notwendig, externe Verbraucher über die neuen Daten zu informieren.  Deshalb haben wir die Rolle des Ausgabeprozessors.  Nach dem Speichern der Daten können diese in den entsprechenden Handler übertragen werden (z. B. um sie gemäß den Anforderungen des Verbrauchers zu transformieren) und dann zum Senden an den Connector übertragen werden.  Die Reparaturwarteschlange wird auch hier verwendet: Wenn niemand das Objekt akzeptiert, kann der Administrator es später erneut versuchen. <br><br><h3>  Skalieren </h3><br>  Die Rollen Connector, Input Processor und Output Processor sind zustandslos. Dadurch können wir das System horizontal skalieren, indem wir lediglich neue Anwendungsinstanzen mit der erforderlichen aktivierten Rolle hinzufügen.  Für die horizontale Speicherskalierung wird ein Cluster mithilfe des Virtual Buckets- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ansatzes organisiert</a> .  Nach dem Hinzufügen eines neuen Servers werden einige Buckets von den alten Servern auf einen neuen Server im Hintergrund verschoben.  Dieser Prozess ist für die Benutzer transparent und wirkt sich nicht auf den Betrieb des gesamten Systems aus. <br><br><h3>  Dateneigenschaften </h3><br>  Objekte können sehr groß sein und andere Objekte enthalten.  Wir stellen sicher, dass Daten atomar hinzugefügt und aktualisiert werden und das Objekt mit allen Abhängigkeiten von einem einzigen virtuellen Bucket gespeichert wird.  Dies geschieht, um das sogenannte "Verschmieren" des Objekts über mehrere physische Server hinweg zu vermeiden. <br><br>  Die Versionierung wird ebenfalls unterstützt: Jedes Update des Objekts erstellt eine neue Version, und wir können jederzeit eine Zeitscheibe erstellen, um zu sehen, wie alles zu der Zeit aussah.  Für Daten, die keinen langen Verlauf benötigen, können wir die Anzahl der Versionen begrenzen oder sogar nur die letzte speichern, dh die Versionierung für einen bestimmten Datentyp deaktivieren.  Wir können auch die historischen Grenzen festlegen: Löschen Sie beispielsweise alle Objekte eines bestimmten Typs, die älter als ein Jahr sind.  Die Archivierung wird ebenfalls unterstützt: Wir können Objekte ab einem bestimmten Alter hochladen, um den Cluster-Speicherplatz freizugeben. <br><br><h3>  Aufgaben </h3><br>  Zu den interessanten Funktionen gehört die Möglichkeit, Aufgaben pünktlich, auf Benutzerwunsch oder automatisch über die Sandbox auszuführen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6d2/99c/7ea/6d299c7ea95444bb922af6b9606a81c9.png"></div><br>  Hier sehen wir eine andere Rolle namens Runner.  Diese Rolle hat keinen Staat;  Bei Bedarf können dem Cluster weitere Anwendungsinstanzen mit dieser Rolle hinzugefügt werden.  Der Runner ist für die Ausführung der Aufgaben verantwortlich.  Wie bereits erwähnt, können neue Aufgaben aus der Sandbox erstellt werden.  Sie treten der Warteschlange im Speicher bei und werden dann auf dem Läufer ausgeführt.  Diese Art von Aufgaben wird als Job bezeichnet.  Wir haben auch einen Aufgabentyp namens Task, dh eine benutzerdefinierte Aufgabe, die pünktlich (unter Verwendung der Cron-Syntax) oder bei Bedarf ausgeführt wird.  Um solche Aufgaben auszuführen und zu verfolgen, verfügen wir über einen praktischen Task-Manager.  Die Scheduler-Rolle muss aktiviert sein, um diese Funktion verwenden zu können.  Diese Rolle hat einen Status, daher wird sie nicht skaliert, was ohnehin nicht erforderlich ist.  Wie bei jeder anderen Rolle kann es jedoch eine Replik geben, die funktioniert, wenn der Master plötzlich ausfällt. <br><br><h3>  Logger </h3><br>  Eine andere Rolle heißt Logger.  Es sammelt Protokolle aller Clustermitglieder und bietet eine Schnittstelle zum Hochladen und Anzeigen über die Weboberfläche. <br><br><h3>  Dienstleistungen </h3><br>  Es ist erwähnenswert, dass das System das Erstellen von Diensten vereinfacht.  In der Konfigurationsdatei können Sie angeben, welche Anforderungen an den vom Benutzer geschriebenen Handler gesendet werden sollen, der in der Sandbox ausgeführt wird.  Ein solcher Handler kann beispielsweise eine Art analytische Anforderung ausführen und das Ergebnis zurückgeben. <br>  Der Dienst wird in der Konfigurationsdatei beschrieben: <br><br><pre> <code class="lua hljs">services: sum: doc: <span class="hljs-string"><span class="hljs-string">"adds two numbers"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return_type</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">args</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">x</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">y</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span></code> </pre> <br>  Die GraphQL-API wird automatisch generiert und der Dienst steht für Aufrufe zur Verfügung: <br><br><pre> <code class="lua hljs">query { sum(x: <span class="hljs-number"><span class="hljs-number">1</span></span>, y: <span class="hljs-number"><span class="hljs-number">2</span></span>) }</code> </pre> <br>  Dies ruft den Summenhandler auf, der das Ergebnis zurückgibt: <br><br><pre> <code class="plaintext hljs">3</code> </pre> <br><h3>  Profilerstellung und Metriken anfordern </h3><br>  Wir haben die Unterstützung für das OpenTracing-Protokoll implementiert, um ein besseres Verständnis der Systemmechanismen und der Erstellung von Anforderungsprofilen zu ermöglichen.  Bei Bedarf kann das System Informationen darüber, wie die Anforderung ausgeführt wurde, an Tools senden, die dieses Protokoll unterstützen (z. B. Zipkin): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b47/84b/ff8/b4784bff86dfccbf05879af28a5c04bd.png"></div><br>  Selbstverständlich bietet das System interne Metriken, die mit Prometheus erfasst und mit Grafana visualisiert werden können. <br><br><h3>  Bereitstellung </h3><br>  Tarantool Data Grid kann mithilfe des integrierten Dienstprogramms oder Ansible aus RPM-Paketen oder Archiven bereitgestellt werden.  Kubernetes wird ebenfalls unterstützt ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tarantool Kubernetes Operator</a> ). <br><br>  Eine Anwendung, die Geschäftslogik (Konfiguration, Handler) implementiert, wird über die Benutzeroberfläche oder als Skript unter Verwendung der bereitgestellten API in den bereitgestellten Tarantool Data Grid-Cluster im Archiv geladen. <br><br><h3>  Beispielanwendungen </h3><br>  Welche Anwendungen können Sie mit Tarantool Data Grid erstellen?  Tatsächlich hängen die meisten Geschäftsaufgaben in irgendeiner Weise mit der Verarbeitung, Speicherung und dem Zugriff auf Datenströme zusammen.  Wenn Sie also große Datenströme haben, die sicheren Speicher und Zugriff erfordern, kann unser Produkt Ihnen viel Zeit bei der Entwicklung sparen und Ihnen helfen, sich auf Ihre Geschäftslogik zu konzentrieren. <br><br>  Sie möchten beispielsweise Informationen über den Immobilienmarkt sammeln, um über die besten Angebote der Zukunft auf dem Laufenden zu bleiben.  In diesem Fall werden die folgenden Aufgaben herausgearbeitet: <br><br><ol><li>  Roboter, die Informationen aus offenen Quellen sammeln, sind Ihre Datenquellen.  Sie können dieses Problem mit vorgefertigten Lösungen oder durch Schreiben von Code in einer beliebigen Sprache lösen. </li><li>  Als Nächstes akzeptiert und speichert Tarantool Data Grid die Daten.  Wenn das Datenformat aus verschiedenen Quellen unterschiedlich ist, können Sie in Lua Code schreiben, der alles in ein einziges Format konvertiert.  In der Vorverarbeitungsphase können Sie beispielsweise auch wiederkehrende Angebote filtern oder Datenbankinformationen über auf dem Markt tätige Agenten weiter aktualisieren. </li><li>  Jetzt haben Sie bereits eine skalierbare Lösung im Cluster, die mit Daten gefüllt und zum Erstellen von Datenproben verwendet werden kann.  Anschließend können Sie neue Funktionen implementieren, z. B. einen Dienst schreiben, der eine Datenanforderung erstellt und das vorteilhafteste Angebot pro Tag zurückgibt.  Es würde nur mehrere Zeilen in der Konfigurationsdatei und etwas Lua-Code erfordern. </li></ol><br><h3>  Was kommt als nächstes? </h3><br>  Für uns ist es eine Priorität, den Entwicklungskomfort mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tarantool Data Grid</a> zu erhöhen.  (Dies ist beispielsweise eine IDE mit Unterstützung für die Profilerstellung und das Debuggen von Handlern, die in der Sandbox funktionieren.) <br><br>  Wir achten auch sehr auf Sicherheitsfragen.  Derzeit wird unser Produkt von der FSTEC Russlands (Föderaler Dienst für Technologie und Exportkontrolle) zertifiziert, um das hohe Sicherheitsniveau anzuerkennen und die Zertifizierungsanforderungen für Softwareprodukte zu erfüllen, die in Informationssystemen für personenbezogene Daten und Informationssystemen des Bundes verwendet werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de471744/">https://habr.com/ru/post/de471744/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de471728/index.html">Avalonia meine Vor- und Nachteile</a></li>
<li><a href="../de471736/index.html">Berührungsloser Ethernet-Sensor</a></li>
<li><a href="../de471738/index.html">Eine kurze Geschichte darüber, wie Convenience manchmal ins Knie schießt</a></li>
<li><a href="../de471740/index.html">Smart Cache Service basierend auf ZeroMQ und Tarantool</a></li>
<li><a href="../de471742/index.html">Sberbank AI Reise. Wie wir einem neuronalen Netzwerk beigebracht haben, eine Prüfung abzulegen</a></li>
<li><a href="../de471746/index.html">Vollständiges Handbuch zum Konfigurieren von HTTP-Headern für die Sicherheit</a></li>
<li><a href="../de471748/index.html">Apothekenoptimierung: Was wir mit Mathe gemacht haben</a></li>
<li><a href="../de471750/index.html">Privilegierte Zugriffsverwaltung als vorrangige Aufgabe in der Informationssicherheit (z. B. Fudo PAM)</a></li>
<li><a href="../de471756/index.html">Wie der Server startet</a></li>
<li><a href="../de471758/index.html">Wie übersetze ich Text in eine andere Sprache?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>