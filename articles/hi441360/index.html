<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСйЁЯП╛тАНЁЯОд ЁЯЩПЁЯП╗ тЖЩя╕П Openshift - рд▓рд╛рд▓ рдЯреЛрдкреА рд╢рд┐рд▓реНрдк ЁЯПЙ тЬКЁЯП╛ ЁЯдм</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="OpenShift 


1. рд╕реНрд╡реАрдк рдУрдкреЗрдВрд╢рд┐рдлреНрдЯред 
2. рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рд╡рд┐рдиреНрдпрд╛рд╕ред 
3. рдкреАрд╡реА рдмрдирд╛рдПрдВ рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред 
4. Red Hat Decision Manager рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд░рд┐рдирд┐рдп...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Openshift - рд▓рд╛рд▓ рдЯреЛрдкреА рд╢рд┐рд▓реНрдк</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441360/"><h2>  OpenShift </h2><br><ol><li>  рд╕реНрд╡реАрдк рдУрдкреЗрдВрд╢рд┐рдлреНрдЯред </li><li>  рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рд╡рд┐рдиреНрдпрд╛рд╕ред </li><li>  рдкреАрд╡реА рдмрдирд╛рдПрдВ рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░реЗрдВред </li><li>  Red Hat Decision Manager рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди (kie-workbench рдХрд╛ рдЙрджреНрдпрдо рд╕рд╛рджреГрд╢реНрдп)ред </li><li>  рдПрдПрдордХреНрдпреВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди (рд▓рд╛рд▓ рдЯреЛрдкреА рд╕рдХреНрд░рд┐рдп mq) рдФрд░ рд▓рдЧрд╛рддрд╛рд░ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдХреНрдХрд▓ рдкреНрд░реЛрдЬреЗрдХреНрдЯред </li><li>  рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг, рдЙрдирдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкреНрд▓реЗрдЯ, рдкрд╛рдЗрдкрд▓рд╛рдЗрди, рдЧрд┐рдЯрд▓реИрдм рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг, рдЧрд┐рдЯрд▓реИрдм рд░реАрдЧреЗрд╕реНрдЯреНрд░реАред </li></ol><a name="habracut"></a><br><h2>  <b>1. рдУрдкрдирд┐рд╢рд┐рдлреНрдЯ рд╕реНрд╡реАрдк</b> </h2><br>  рд╕рд░реНрд╡рд░ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ, рдбреАрдПрдирдПрд╕ рд╕рд░реНрд╡рд░ рддреИрдпрд╛рд░ рдХрд░рдирд╛, рд╕рд░реНрд╡рд░ рдирд╛рдореЛрдВ рдХреА рд╕реВрдЪреА, рд╕рд░реНрд╡рд░ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВред <br><br>  рдиреНрдпреВрдирддрдо рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд╣реИрдВ - рд╕рднреА рд╕рд░реНрд╡рд░реЛрдВ рдореЗрдВ рдХрдо рд╕реЗ рдХрдо 16 рдЬреАрдмреА рд░реИрдо 2 рдХреЛрд░ рдФрд░ рдбреЙрдХрдЯрд░ рдХреА рдЬрд░реВрд░рддреЛрдВ рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо 100 рдЧреАрдЧрд╛рдмрд╛рдЗрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  Bind- рдЖрдзрд╛рд░рд┐рдд рдбреАрдПрдирдПрд╕ рдореЗрдВ рдирд┐рдореНрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред <br>  dkm - Master, dk0 - рдирд┐рд╖реНрдкрд╛рджрд┐рдд, ifr - рдЕрд╡рд╕рдВрд░рдЪрдирд╛, bln - balancer, shd - nfs, dkr - рдирд┐рдпрдВрддреНрд░рдг рдиреЛрдб рдЬрд┐рд╕рдХреЗ рд╕рд╛рде рдХреНрд▓рд╕реНрдЯрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдХреЛ рднреА docker regestry рдХреЗ рддрд╣рдд рдПрдХ рдЕрд▓рдЧ рдиреЛрдб рдХреЗ рд░реВрдк рдореЗрдВ рдпреЛрдЬрдирд╛ рдмрдирд╛рдИ рдЧрдИ рдереАред <br><br><pre><code class="plaintext hljs">db.osh $TTL 1h @ IN SOA test.osh. root.test.osh. ( 2008122601 ; Serial 28800 ; Refresh 14400 ; Retry 604800 ; Expire - 1 week 86400 ) ; Minimum @ IN NS test.osh. @ IN A 127.0.0.1 rnd-osh-dk0-t01 IN A 10.19.86.18 rnd-osh-dk0-t02 IN A 10.19.86.19 rnd-osh-dk0-t03 IN A 10.19.86.20 rnd-osh-dkm-t01 IN A 10.19.86.21 rnd-osh-dkm-t02 IN A 10.19.86.22 rnd-osh-dkm-t03 IN A 10.19.86.23 rnd-osh-ifr-t01 IN A 10.19.86.24 rnd-osh-ifr-t02 IN A 10.19.86.25 rnd-osh-ifr-t03 IN A 10.19.86.26 rnd-osh-bln-t01 IN A 10.19.86.27 rnd-osh-shd-t01 IN A 10.19.86.28 rnd-osh-dkr-t01 IN A 10.19.86.29 lb IN A 10.19.86.27 openshift IN A 10.19.86.27 api-openshift IN A 10.19.86.27 *.apps.openshift IN A 10.19.86.21 *.apps.openshift IN A 10.19.86.22 *.apps.openshift IN A 10.19.86.23</code> </pre> <br><pre> <code class="plaintext hljs">db.rv.osh $TTL 1h @ IN SOA test.osh. root.test.osh. ( 1 ; Serial 604800 ; Refresh 86400 ; Retry 2419200 ; Expire 604800 ) ; Negative Cache TTL ; @ IN NS test.osh. @ IN A 127.0.0.1 18 IN PTR rnd-osh-dk0-t01.test.osh. 19 IN PTR rnd-osh-dk0-t02.test.osh. 20 IN PTR rnd-osh-dk0-t03.test.osh. 21 IN PTR rnd-osh-dkm-t01.test.osh. 22 IN PTR rnd-osh-dkm-t02.test.osh. 23 IN PTR rnd-osh-dkm-t03.test.osh. 24 IN PTR rnd-osh-ifr-t01.test.osh. 25 IN PTR rnd-osh-ifr-t02.test.osh. 26 IN PTR rnd-osh-ifr-t03.test.osh. 27 IN PTR rnd-osh-bln-t01.test.osh. 28 IN PTR rnd-osh-shd-t01.test.osh. 29 IN PTR rnd-osh-dkr-t01.test.osh. 27 IN PTR lb.test.osh. 27 IN PTR api-openshift.test.osh. named.conf.default-zones</code> </pre><br><pre> <code class="plaintext hljs">zone "test.osh" IN { type master; file "/etc/bind/db.osh"; allow-update { none; }; notify no; }; zone "86.19.10.in-addr.arpa" { type master; file "/etc/bind/db.rv.osh"; };</code> </pre><br>  <b>рд╕рд░реНрд╡рд░ рдХреА рддреИрдпрд╛рд░реА</b> <br><br>  рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рдмрд╛рджред  рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдХреЛ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдФрд░ рд╢реБрд░реВ рдореЗрдВ рдЖрдкрдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдкреИрдХреЗрдЬреЛрдВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ред <br><br><pre> <code class="bash hljs">rm -rf /etc/yum.repos.d/cdrom.repo subscription-manager repos --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>=<span class="hljs-string"><span class="hljs-string">"*"</span></span> subscription-manager repos --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-rpms"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-extras-rpms"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-ose-3.10-rpms"</span></span> --<span class="hljs-built_in"><span class="hljs-built_in">enable</span></span>=<span class="hljs-string"><span class="hljs-string">"rhel-7-server-ansible-2.4-rpms"</span></span> yum -y install wget git net-tools <span class="hljs-built_in"><span class="hljs-built_in">bind</span></span>-utils yum-utils iptables-services bridge-utils bash-completion kexec-tools sos psacct yum -y update yum -y install docker</code> </pre> <br>  рдбреЙрдХрд░ рд╕реНрдЯреЛрд░реЗрдЬ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди (рдЕрд▓рдЧ рдбреНрд░рд╛рдЗрд╡)ред <br><br><pre> <code class="bash hljs">systemctl stop docker rm -rf /var/lib/docker/* <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"STORAGE_DRIVER=overlay2"</span></span> &gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"DEVS=/dev/sdc"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONTAINER_ROOT_LV_NAME=dockerlv"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONTAINER_ROOT_LV_SIZE=100%FREE"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"CONTAINER_ROOT_LV_MOUNT_PATH=/var/lib/docker"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"VG=docker-vg"</span></span> &gt;&gt; /etc/sysconfig/docker-storage-setup systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> docker docker-storage-setup systemctl is-active docker systemctl restart docker docker info | grep Filesystem</code> </pre><br>  рд╢реЗрд╖ рдЖрд╡рд╢реНрдпрдХ рдкреИрдХреЗрдЬ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред <br><br><pre> <code class="bash hljs">yum -y install atomic atomic trust show yum -y install docker-novolume-plugin systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> docker-novolume-plugin systemctl start docker-novolume-plugin yum -y install openshift-ansible</code> </pre> <br>  рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛, рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреБрдВрдЬрд┐рдпрд╛рдБ рдмрдирд╛рдирд╛, рдмрдирд╛рдирд╛ред <br><br><pre> <code class="bash hljs">useradd --create-home --groups users,wheel ocp sed -i <span class="hljs-string"><span class="hljs-string">'s/# %wheel/%wheel/'</span></span> /etc/sudoers mkdir -p /home/ocp/.ssh <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"ssh-rsa AAAAB3NzaC........8Ogb3Bv ocp SSH Key"</span></span> &gt;&gt; /home/ocp/.ssh/authorized_keys</code> </pre> <br>  рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд╕рдмрдиреЗрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ - рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЗ рдЕрдВрджрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдкрддреЗ рдХреЛ рдмрджрд▓рдирд╛ред <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{ "bip": "172.26.0.1/16" }'</span></span> &gt; /etc/docker/daemon.json systemctl restart docker</code> </pre> <br>  рдиреЗрдЯрд╡рд░реНрдХ рдкреНрд░рдмрдВрдзрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рдиред  (рдбреАрдПрдирдПрд╕ рдХреЛ рдмрд╛рд╣рд░реА рджреБрдирд┐рдпрд╛ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП) <br><br><pre> <code class="bash hljs">nmcli connection modify ens192 ipv4.dns 172.17.70.140 nmcli connection modify ens192 ipv4.dns-search cluster.local +ipv4.dns-search test.osh +ipv4.dns-search cpgu systemctl stop firewalld systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> firewalld systemctl restart network</code> </pre> <br>  рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ, рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рдорд╢реАрди рдХрд╛ рдкреВрд░рд╛ рдирд╛рдоред <br><br><pre> <code class="bash hljs">hhh=$(cat /etc/hostname) <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$hhh</span></span></span><span class="hljs-string">"</span></span>.test.osh &gt; /etc/hostname</code> </pre> <br>  рдкреВрд░реНрдг рдЪрд░рдгреЛрдВ рдХреЗ рдмрд╛рдж, рд╕рд░реНрд╡рд░ рдХреЛ рдкреБрдирд░рд╛рд░рдВрдн рдХрд░реЗрдВред <br><br><h3>  Dkr рдХрдВрдЯреНрд░реЛрд▓ рдиреЛрдб рддреИрдпрд╛рд░ рдХрд░рдирд╛ </h3><br>  рдирд┐рдпрдВрддреНрд░рдг рдиреЛрдб рдФрд░ рдмрд╛рдХреА рдХреЗ рдмреАрдЪ рдЕрдВрддрд░ рдпрд╣ рд╣реИ рдХрд┐ рдбреЙрдХ рдХреЛ рдПрдХ рдЕрд▓рдЧ рдбрд┐рд╕реНрдХ рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  Ntp рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><pre> <code class="bash hljs">yum install ntp -y systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> ntpd service ntpd start service ntpd status ntpq -p chmod 777 -R /usr/share/ansible/openshift-ansible/</code> </pre> <br>  рдЖрдкрдХреЛ рдСрдк рдХреЗ рд▓рд┐рдП рдирд┐рдЬреА рдХреБрдВрдЬреА рднреА рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рд╕рднреА рдиреЛрдбреНрд╕ рдкрд░ ocp рдХреЗ рд░реВрдк рдореЗрдВ ssh рдПрдХреНрд╕реЗрд╕ рдХрд░реЗрдВред <br><br>  <b>рдЗрдиреНрд╡реЗрдВрдЯрд░реА рдлрд╝рд╛рдЗрд▓ рддреИрдпрд╛рд░ рдХрд░рдирд╛ рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░рдирд╛ред</b> <br><br><pre> <code class="plaintext hljs">host-poc.yaml [OSEv3:children] masters nodes etcd lb nfs [OSEv3:vars] ansible_ssh_user=ocp ansible_become=yes openshift_override_hostname_check=True openshift_master_cluster_method=native openshift_disable_check=memory_availability,disk_availability,package_availability openshift_deployment_type=openshift-enterprise openshift_release=v3.10 oreg_url=registry.access.redhat.com/openshift3/ose-${component}:${version} debug_level=2 os_firewall_use_firewalld=True openshift_install_examples=true openshift_clock_enabled=True openshift_router_selector='node-role.kubernetes.io/infra=true' openshift_registry_selector='node-role.kubernetes.io/infra=true' openshift_examples_modify_imagestreams=true os_sdn_network_plugin_name='redhat/openshift-ovs-multitenant' openshift_master_identity_providers=[{'name': 'htpasswd_auth', 'login': 'true', 'challenge': 'true', 'kind': 'HTPasswdPasswordIdentityProvider'}] openshift_master_htpasswd_users={'admin': '$apr1$pQ3QPByH$5BDkrp0m5iclRske.M0m.0'} openshift_master_default_subdomain=apps.openshift.test.osh openshift_master_cluster_hostname=api-openshift.test.osh openshift_master_cluster_public_hostname=openshift.test.osh openshift_enable_unsupported_configurations=true openshift_use_crio=true openshift_crio_enable_docker_gc=true # registry openshift_hosted_registry_storage_kind=nfs openshift_hosted_registry_storage_access_modes=['ReadWriteMany'] openshift_hosted_registry_storage_nfs_directory=/exports openshift_hosted_registry_storage_nfs_options='*(rw,root_squash)' openshift_hosted_registry_storage_volume_name=registry openshift_hosted_registry_storage_volume_size=30Gi # cluster monitoring openshift_cluster_monitoring_operator_install=true openshift_cluster_monitoring_operator_node_selector={'node-role.kubernetes.io/master': 'true'} #metrics openshift_metrics_install_metrics=true openshift_metrics_hawkular_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_metrics_cassandra_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_metrics_heapster_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_metrics_storage_kind=nfs openshift_metrics_storage_access_modes=['ReadWriteOnce'] openshift_metrics_storage_nfs_directory=/exports openshift_metrics_storage_nfs_options='*(rw,root_squash)' openshift_metrics_storage_volume_name=metrics openshift_metrics_storage_volume_size=20Gi #logging openshift_logging_kibana_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_logging_curator_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_logging_es_nodeselector={"node-role.kubernetes.io/infra": "true"} openshift_logging_install_logging=true openshift_logging_es_cluster_size=1 openshift_logging_storage_kind=nfs openshift_logging_storage_access_modes=['ReadWriteOnce'] openshift_logging_storage_nfs_directory=/exports openshift_logging_storage_nfs_options='*(rw,root_squash)' openshift_logging_storage_volume_name=logging openshift_logging_storage_volume_size=20Gi #ASB ansible_service_broker_install=true openshift_hosted_etcd_storage_kind=nfs openshift_hosted_etcd_storage_nfs_options="*(rw,root_squash,sync,no_wdelay)" openshift_hosted_etcd_storage_nfs_directory=/opt/osev3-etcd openshift_hosted_etcd_storage_volume_name=etcd-vol2 openshift_hosted_etcd_storage_access_modes=["ReadWriteOnce"] openshift_hosted_etcd_storage_volume_size=30G openshift_hosted_etcd_storage_labels={'storage': 'etcd'} ansible_service_broker_local_registry_whitelist=['.*-apb$'] #cloudforms #openshift_management_install_management=true #openshift_management_app_template=cfme-template # host group for masters [masters] rnd-osh-dkm-t0[1:3].test.osh # host group for etcd [etcd] rnd-osh-dkm-t0[1:3].test.osh [lb] rnd-osh-bln-t01.test.osh containerized=False [nfs] rnd-osh-shd-t01.test.osh [nodes] rnd-osh-dkm-t0[1:3].test.osh openshift_node_group_name='node-config-master' rnd-osh-ifr-t0[1:3].test.osh openshift_node_group_name='node-config-infra' rnd-osh-dk0-t0[1:3].test.osh openshift_node_group_name='node-config-compute'</code> </pre> <br>  рдмрд╛рд░реА-рдмрд╛рд░реА рд╕реЗ рдкреНрд▓реЗрдмреБрдХ рдЪрд▓рд╛ рд░рд╣реЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">ansible-playbook -i host-poc.yaml /usr/share/ansible/openshift-ansible/playbooks/prerequisites.yml ansible-playbook -i host-poc.yaml /usr/share/ansible/openshift-ansible/playbooks/openshift-checks/pre-install.yml ansible-playbook -i host-poc.yaml /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml</code> </pre> <br>  рдпрджрд┐ рдЕрдВрдд рдореЗрдВ рд╕рдм рдареАрдХ рд╣реИ, рддреЛ рд▓рдЧрднрдЧ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реЛрдВрдЧреЗред <br><br><img src="https://habrastorage.org/webt/n8/5h/sh/n85hshlwjuugbzqsaottl3foscg.jpeg"><br><br>  рд╡реЗрдм рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдерд╛рдкрдирд╛ oprenshift рдСрдкрд░реЗрд╢рди рдХреЗ рдмрд╛рдж рд╕рддреНрдпрд╛рдкрди рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп рд╣реЛрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд╕рдВрдкрд╛рджрдиред <br><br><pre> <code class="plaintext hljs">10.19.86.18 rnd-osh-dk0-t01.test.osh 10.19.86.19 rnd-osh-dk0-t02.test.osh 10.19.86.20 rnd-osh-dk0-t03.test.osh 10.19.86.21 rnd-osh-dkm-t01.test.osh 10.19.86.22 rnd-osh-dkm-t02.test.osh 10.19.86.23 rnd-osh-dkm-t03.test.osh 10.19.86.24 rnd-osh-ifr-t01.test.osh 10.19.86.25 rnd-osh-ifr-t02.test.osh 10.19.86.26 rnd-osh-ifr-t03.test.osh 10.19.86.27 rnd-osh-bln-t01.test.osh openshift.test.osh 10.19.86.28 rnd-osh-shd-t01.test.osh 10.19.86.29 rnd-osh-dkr-t01.test.osh</code> </pre><br>  Url <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Openhift.test.osh</a> : 8443 рдкрд░ рд╕рддреНрдпрд╛рдкрди <br><br><h3>  <b>2. рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рдмрд╛рдж рд╡рд┐рдиреНрдпрд╛рд╕</b> </h3><br>  Dkm рджрд░реНрдЬ рдХрд░реЗрдВред <br><br><pre> <code class="bash hljs">oc login -u system:admin oc adm policy add-cluster-role-to-user cluster-admin admin --rolebinding-name=cluster-admin</code> </pre> <br>  рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╡реЗрдм рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдореЗрдВ рдкрд╣рд▓реЗ рд╕реЗ рдЫрд┐рдкреА рд╣реБрдИ рдкрд░рд┐рдпреЛрдЬрдирд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдУрдкрдирд╢рд┐рдлреНрдЯ) рдХреЛ рджреЗрдЦрдирд╛ рд╕рдВрднрд╡ рд╣реИред <br><br><h3>  <b>3. рдкреАрд╡реА рдмрдирд╛рдирд╛ рдФрд░ рдЬреЛрдбрд╝рдирд╛</b> </h3><br>  Nfs рд╕рд░реНрд╡рд░ рдкрд░ рд▓рдЧрд╛рддрд╛рд░ рд╡реЙрд▓реНрдпреВрдо рдмрдирд╛рдПрдВред <br><br><pre> <code class="bash hljs">mkdir -p /exports/examplpv chmod -R 777 /exports/examplpv chown nfsnobody:nfsnobody -R /exports/examplpv <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/examplpv" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre> <br>  рдЦреБрд▓рдиреЗ рдХреЗ рд╕рдордп pv рдЬреЛрдбрд╝рдирд╛ред <br><br>  рдЖрдкрдХреЛ рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ-рдкреНрд░реЛрдЬреЗрдХреНрдЯ examppv- рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдпрджрд┐ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрдирд╛рдИ рдЧрдИ рд╣реИ, рддреЛ рдЙрд╕ рдкрд░ рдЬрд╛рдПрдВ рдорд╣рд╛рд╕рд╛рдЧрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛ examplpv- рдкрд░рд┐рдпреЛрдЬрдирд╛ред  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде yaml рдмрдирд╛рдПрдБред <br><br><pre> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: examplpv-ts1 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteOnce nfs: path: /exports/examplpv server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre> <br>  рдФрд░ рдЖрд╡реЗрджрди рдХрд░реЗрдВред  рдорд╣рд╛рд╕рд╛рдЧрд░ рд▓рд╛рдЧреВ -f рдлрд╝рд╛рдЗрд▓ рдирд╛рдо <br><br>  рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж <br><br><pre> <code class="bash hljs">oc get pv</code> </pre> <br>  рдирд┐рд░реНрдорд┐рдд pv рд╕реВрдЪреА рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред <br><br><h3>  <b>4. Red Hat Decision Manager рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди (kie-workbench рдХрд╛ рдЙрджреНрдпрдо рд╕рд╛рджреГрд╢реНрдп)</b> </h3><br>  рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреЗ рд▓рд┐рдП рдЬрд╛рдБрдЪ рдХрд░реЗрдВред <br><br><pre> <code class="bash hljs">oc get imagestreamtag -n openshift | grep rhdm</code> </pre> <br><img src="https://habrastorage.org/webt/qj/ta/tc/qjtatcty6wmkrszyiromshu6zum.png"><br><br>  рдЯреЗрдореНрдкрд▓реЗрдЯ рдЬреЛрдбрд╝рдирд╛ - рдПрдХ рд▓рд┐рдВрдХ рдФрд░ рдЕрдзрд┐рдХ рд╕рдВрдкреВрд░реНрдг рд╡рд┐рд╡рд░рдг рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ <br><br><pre> <code class="bash hljs">unzip rhdm-7.2.1-openshift-templates.zip -d ./rhdm-7.2.1-openshift-templates</code> </pre> <br>  рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="bash hljs">oc new-project rhdm72</code> </pre> <br>  рдбреЙрдХрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЬреЛрдбрд╝рдирд╛ .redhat.io рд╕рд░реНрд╡рд░: <br><br><pre> <code class="bash hljs">docker login registry.redhat.io cat ~/.docker/config.json oc create secret generic pull-secret-name --from-file=.dockerconfigjson=/root/.docker/config.json --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=kubernetes.io/dockerconfigjson oc secrets link default pull-secret-name --<span class="hljs-keyword"><span class="hljs-keyword">for</span></span>=pull oc secrets link builder pull-secret-name</code> </pre> <br>  рдЖрдпрд╛рдд рдХрд▓реНрдкрдирд╛, рдкреНрд░рдореБрдЦ рдирд┐рд░реНрдорд╛рдг рдирд┐рд░реНрдгрдп рд╕рд░реНрд╡рд░, рдирд┐рд░реНрдгрдп рдХреЗрдВрджреНрд░реАрдпред <br><br><pre> <code class="bash hljs">keytool -genkeypair -<span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> jboss -keyalg RSA -keystore keystore.jks -storepass mykeystorepass --dname <span class="hljs-string"><span class="hljs-string">"CN=STP,OU=Engineering,O=POC.mos,L=Raleigh,S=NC,C=RU"</span></span> oc create -f rhdm72-image-streams.yaml oc create secret generic kieserver-app-secret --from-file=keystore.jks oc create secret generic decisioncentral-app-secret --from-file=keystore.jks</code> </pre> <br>  Nfs рд╕рд░реНрд╡рд░ рдкрд░ рд▓рдЧрд╛рддрд╛рд░ рд╡реЙрд▓реНрдпреВрдо рдмрдирд╛рдПрдВред <br><br><pre> <code class="bash hljs">mkdir -p /exports/rhdm72 chmod -R 777 /exports/rhdm72 chown nfsnobody:nfsnobody -R /exports/rhdm72 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/rhamq72" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre> <br>  рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ pv рдЬреЛрдбрд╝реЗрдВ: <br><br><pre> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: rhdm72-pv1 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteMany nfs: path: /exports/rhdm72 server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre> <br>  RhDM70 рдХреЛ PV рдорд╛рдкрджрдВрдбреЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ <br>  accessModes: <br>  - ReadWriteOnce <br>  рд▓реЗрдХрд┐рди 7.2 рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ <br>  accessModes: <br>  - ReadWiteMany <br>  рд▓рд╛рдЧреВ рдХрд░реЗрдВ - рдорд╣рд╛рд╕рд╛рдЧрд░ рд▓рд╛рдЧреВ -f рдлрд╝рд╛рдЗрд▓ рдирд╛рдо <br>  + рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдирд┐рд░реНрдорд┐рдд pv рдЙрдкрд▓рдмреНрдз рд╣реЛ рдЧрдпрд╛ рд╣реИред <br><img src="https://habrastorage.org/webt/yz/jd/kj/yzjdkjxx8h-_hh-ivjflfg6zk0u.png"><br>  рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рд╕реЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВред <br><br><pre> <code class="bash hljs">oc new-app -f rhdm-7.2.1-openshift-templates/templates/rhdm72-authoring.yaml -p DECISION_CENTRAL_HTTPS_SECRET=decisioncentral-app-secret -p KIE_SERVER_HTTPS_SECRET=kieserver-app-secret</code> </pre> <br>  рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдбреЙрдХ-рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдкреБрд▓ рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рдкреВрд░рд╛ рд╣реЛрдиреЗ рдкрд░ рддреИрдирд╛рдд рд╣реЛрдЧрд╛ред <br>  рдЗрд╕ рдХреНрд╖рдг рддрдХ, рд╕реНрдерд┐рддрд┐ рдпрд╣реА рд░рд╣реЗрдЧреАред <br><br><img src="https://habrastorage.org/webt/mq/f_/76/mqf_76tvlkrevnb1i0ko-c5geog.png"><br><br>  рдпрджрд┐ рдЖрдк рдЫрд╡рд┐ рд▓рд┐рдВрдХ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдирд┐рдореНрди рддреНрд░реБрдЯрд┐ рд╣реЛрдЧреА <br><br><img src="https://habrastorage.org/webt/ja/tt/fk/jattfkbexppthirthvr4olxo3j4.png"><br><br>  рдЖрдкрдХреЛ рдпрдорд▓ рдХреЛ edit.redhat.io рд╕реЗ edit.access.redhat.com рдкрд░ рдЪреБрдирдХрд░ рдЫрд╡рд┐ рдЕрдкрд▓реЛрдб рдпреВрдЖрд░рдПрд▓ рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ <br><br><img src="https://habrastorage.org/webt/i7/au/7q/i7au7qlcag2vyzowpvah_curhhy.png"><br><br>  рдЕрдкрдиреЗ рд╡реЗрдм рдЗрдВрдЯрд░рдлреЗрд╕ рдореЗрдВ рддреИрдирд╛рдд рд╕реЗрд╡рд╛ рдкрд░ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╣реЛрд╕реНрдЯреНрд╕ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВ <img src="https://habrastorage.org/webt/eu/_p/mj/eu_pmjasouvshqh4sljl4chcs_k.png"><br>  рдЗрдиреНрдлреНрд░рд╛ рдиреЛрдбреНрд╕ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдкрд░ <br><blockquote>  10.19.86.25 rnd-osh-ifr-t02.test.osh myapp-rhdmcentr-rhdm72.apps.openshift.test.osh </blockquote><br><br><img src="https://habrastorage.org/webt/uq/ce/03/uqce03lnqjk7-snzah8dy1jljhc.png"><br><br><h3>  <b>5. рдПрдПрдордХреНрдпреВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдФрд░ рдкрд░рд┐рдирд┐рдпреЛрдЬрди (рд▓рд╛рд▓ рдЯреЛрдкреА рд╕рдХреНрд░рд┐рдп mq) рдФрд░ рд▓рдЧрд╛рддрд╛рд░ рд░рд┐рдкреЛрдЬрд┐рдЯрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреЛрд╕реНрдЯрдЧреНрд░реИрдХреНрдХрд▓ рдкреНрд░реЛрдЬреЗрдХреНрдЯ</b> </h3><br><br>  <b>RHAMQ</b> <br><br>  рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВ <br><br><pre> <code class="bash hljs">oc new-project rhamq-and-pgsql</code> </pre><br>  рд╣рдо рдЙрдирдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЪрд┐рддреНрд░ рдЖрдпрд╛рдд рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">oc replace --force -f https://raw.githubusercontent.com/jboss-container-images/jboss-amq-7-broker-openshift-image/72-1.1.GA/amq-broker-7-image-streams.yaml oc replace --force -f https://raw.githubusercontent.com/jboss-container-images/jboss-amq-7-broker-openshift-image/72-1.1.GA/amq-broker-7-scaledown-controller-image-streams.yaml oc import-image amq-broker-72-openshift:1.1 oc import-image amq-broker-72-scaledown-controller-openshift:1.0</code> </pre> <br>  рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕реНрдерд╛рдкрдирд╛ <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> template <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> amq-broker-72-basic.yaml \ amq-broker-72-ssl.yaml \ amq-broker-72-custom.yaml \ amq-broker-72-persistence.yaml \ amq-broker-72-persistence-ssl.yaml \ amq-broker-72-persistence-clustered.yaml \ amq-broker-72-persistence-clustered-ssl.yaml; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> oc replace --force -f \ https://raw.githubusercontent.com/jboss-container-images/jboss-amq-7-broker-openshift-image/72-1.1.GA/templates/<span class="hljs-variable"><span class="hljs-variable">${template}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br>  рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддреЗ рдореЗрдВ рдПрдХ рднреВрдорд┐рдХрд╛ рдЬреЛрдбрд╝рдирд╛ред <br><br><pre> <code class="bash hljs">oc policy add-role-to-user view -z default</code> </pre> <br>  Nfs рд╕рд░реНрд╡рд░ рдкрд░ pv рдмрдирд╛рдирд╛ <br><br><pre> <code class="bash hljs">mkdir -p /exports/pgmq chmod -R 777 /exports/pgmq chown nfsnobody:nfsnobody -R /exports/pgmq <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/pgmq" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre><br>  рдпрдо рдмрдирд╛рдПрдБ <br><br>  pgmq_storage.yaml <br><br><pre> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: pgmq-ts1 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteOnce nfs: path: /exports/pgmq server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre> <br>  Pv рд▓рд╛рдЧреВ рдХрд░реЗрдВ <br><br><pre> <code class="plaintext hljs">oc apply -f pgmq_storage.yaml</code> </pre> <br>  рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕реЗ рдмрдирд╛рдПрдБ <br><br><img src="https://habrastorage.org/webt/ft/ue/ot/ftueotubh-sihze42urwj8keoxq.png"><br><br>  рддреИрдпрд╛рд░ <br><br><img src="https://habrastorage.org/webt/3d/tj/6j/3dtj6jdf9dw6ym4bvidbznruig8.png"><br><br>  Ssl рдХреНрд▓рд╕реНрдЯрд░рд┐рдВрдЧ, рдЖрджрд┐ рдХреЗ рд╕рд╛рде рдЕрдиреНрдп рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдПред  рдЖрдк рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХреНрд╕реЗрд╕ рдХрд╛</a> рдЙрд▓реНрд▓реЗрдЦ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">редredhat.com/</a> documentation/ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">en-us/red_hat_amq/7.2/html/deploying_amq_broker_on_openshift_container_platform</a> <br><br>  PostgreSQL <br><br>  рд╣рдо рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдПрдХ рдФрд░ рдкреАрд╡реА рдмрдирд╛рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рд╣рдордиреЗ рдПрдордХреНрдпреВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдерд╛ред <br><br><pre> <code class="bash hljs">mkdir -p /exports/pgmq2 chmod -R 777 /exports/pgmq2 chown nfsnobody:nfsnobody -R /exports/pgmq2 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'"/exports/pgmq2" *(rw,root_squash)'</span></span> &gt;&gt; /etc/exports.d/openshift-ansible.exports exportfs -ar restorecon -RvF</code> </pre> <br>  pgmq_storage.yaml <br><br><pre> <code class="python hljs">apiVersion: v1 kind: PersistentVolume metadata: name: pgmq-ts2 spec: capacity: storage: <span class="hljs-number"><span class="hljs-number">20</span></span>Gi accessModes: - ReadWriteOnce nfs: path: /exports/pgmq2 server: rnd-osh-shd-t01 persistentVolumeReclaimPolicy: Recycle</code> </pre><br><img src="https://habrastorage.org/webt/sc/_b/da/sc_bda3bjxmgtonlqct5ncvzgkc.png"><br><br>  рд╣рдо рдЖрд╡рд╢реНрдпрдХ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рднрд░рддреЗ рд╣реИрдВ <br><br><img src="https://habrastorage.org/webt/qq/qu/5a/qqqu5aqvvl4kyrocork_6zw_408.png"><br><br><img src="https://habrastorage.org/webt/ii/nj/dd/iinjdd2ye08h1qcew-yuiwum-ss.png"><br><br>  рддреИрдпрд╛рд░ рд╣реИред <br><br><h3>  <b>6. рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг, рдЙрдирдХреЗ рд▓рд┐рдП рдЯреЗрдореНрдкрд▓реЗрдЯ, рдкрд╛рдЗрдкрд▓рд╛рдЗрди, рдЧрд┐рдЯрд▓реИрдм рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг, рдЧрд┐рдЯрд▓реИрдм рд░реАрдЧреЗрд╕реНрдЯреНрд░реА</b> </h3><br>  <b>рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИред</b> <br><br><pre> <code class="bash hljs">oc new-project ttttt</code> </pre> <br><img src="https://habrastorage.org/webt/5j/ho/r9/5jhor9y3veoydqwp7d4wzlxgwa8.png"><br>  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ, рдЖрдк рдЗрд╕реЗ рдПрдХ рдореИрдиреБрдЕрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред <br>  <b>рдЗрд╕рдХреЗ рджреЛ рддрд░реАрдХреЗ рд╣реИрдВред</b> <br>  <i>рдкрд╣рд▓реЗ</i> рдмрд╕ рдПрдХ рддреИрдпрд╛рд░ рдЫрд╡рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдлрд┐рд░ рдЫрд╡рд┐рдпреЛрдВ рдХрд╛ рд╕рдВрд╕реНрдХрд░рдг, рдЖрджрд┐ рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдпрд╣ рдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реЛрдЧрд╛ред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЖрдкрдХреЛ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЗ рд▓рд┐рдП рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  Gitlab рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЗрдХрдЯреНрдареА рдЫрд╡рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, рдпрд╣ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><img src="https://habrastorage.org/webt/80/t9/dp/80t9dpkvstrfb3-a-45dypptupo.png"><br><br>  рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдбреЙрдХрдЯрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд░рд╣рд╕реНрдп рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ - рд╡рд┐рдХрд▓реНрдк рдФрд░ рд╕рд┐рдВрдЯреИрдХреНрд╕ рджреЗрдЦреЗрдВред <br><br><pre> <code class="bash hljs">oc create secret docker-registry</code> </pre> <br>  рдлрд┐рд░ рдПрдХ рд░рд╣рд╕реНрдп рдмрдирд╛рдПрдБ <br><br><pre> <code class="bash hljs">oc create secret docker-registry gitlabreg --docker-server=<span class="hljs-string"><span class="hljs-string">'gitlab.xxx.com:4567'</span></span> --docker-username=<span class="hljs-string"><span class="hljs-string">'gitlab+deploy-token-1'</span></span> --docker-password=<span class="hljs-string"><span class="hljs-string">'syqTBSMjHtT_t-X5fiSY'</span></span> --docker-email=<span class="hljs-string"><span class="hljs-string">'email'</span></span></code> </pre> <br>  рдлрд┐рд░ рд╣рдорд╛рд░рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдПрдВред <br><br><pre> <code class="bash hljs">oc new-app --docker-image=<span class="hljs-string"><span class="hljs-string">'gitlab.xxx.com:4567/oko/oko-service:latest'</span></span></code> </pre> <br>  рдпрджрд┐ рдХреБрдЫ рдЧрд▓рдд рд╣реЛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЫрд╡рд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдЦрд┐рдВрдЪрд╛рд╡ рдирд╣реАрдВ рдХрд░рддреА рд╣реИ, рддреЛ рд╣рдорд╛рд░реА рд░реАрд╕реЗрдВрдЯреНрд░реА рдХреЛ рдЧреБрдкреНрдд рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред <br><br><img src="https://habrastorage.org/webt/cl/bh/0_/clbh0_c9htdaqd1rgqvfgearvuw.png"><br><br>  рдлрд┐рд░ рд╣рдо рдЖрд╡рд╢реНрдпрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/of/tl/kq/oftlkqo4eq-xizgq1jjngv2p2ae.png"><br><br>  рд╣реЛ рдЧрдпрд╛ - рдХрдВрдЯреЗрдирд░ рдЬреАрд╡рд┐рдд рд╣реИред <br><br>  рдлрд┐рд░ рд░рд╛рдЗрдЯ рдПрдбрд┐рдЯ рдпрдореНрд▓ рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдФрд░ рдкреЛрд░реНрдЯ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред <br><br><img src="https://habrastorage.org/webt/0o/tc/-3/0otc-3ewuzgidcqb2b43hltjeyy.png"><br><br>  рдлрд┐рд░, рд╣рдорд╛рд░реЗ рдХрдВрдЯреЗрдирд░ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рдорд╛рд░реНрдЧ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рд╕реЗрд╡рд╛ рдХреЗ рдмрд┐рдирд╛ рдЗрд╕реЗ рдмрдирд╛рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдкрд╣рд▓реА рдЪреАрдЬ рдЬреЛ рдЖрдкрдХреЛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рд╡рд╣ рдПрдХ рд╕реЗрд╡рд╛ рдмрдирд╛рдирд╛ рд╣реИред <br><br>  service.yaml <br><br><pre> <code class="python hljs">kind: Service apiVersion: v1 metadata: name: oko-service spec: type: ClusterIP ports: - port: <span class="hljs-number"><span class="hljs-number">9000</span></span> protocol: TCP targetPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> selector: app: oko-service sessionAffinity: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: loadBalancer: {}</code> </pre> <br><pre> <code class="bash hljs">oc apply -f service.yaml</code> </pre> <br>  рдПрдХ рд░реВрдЯ рдмрдирд╛рдПрдВред <br><br><img src="https://habrastorage.org/webt/tn/tr/st/tntrstju-zih92pce1renqfbkzk.png"><br><br>  рдЕрдкрдиреА рдорд╢реАрди рдкрд░ рдореЗрдЬрдмрд╛рди рдореЗрдВ url рджрд░реНрдЬ рдХрд░реЗрдВ рдЬреЛ рдХрд┐ рдПрдХ рдЗрдиреНрдлреНрд░рд╛ рдиреЛрдб рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред <br><br><img src="https://habrastorage.org/webt/te/xj/51/texj51gumi95cwkxcsnaygudih8.png"><br><br>  рдЕрдкрдиреА рдорд╢реАрди рдкрд░ рдореЗрдЬрдмрд╛рди рдореЗрдВ url рджрд░реНрдЬ рдХрд░реЗрдВ рдЬреЛ рдХрд┐ рдПрдХ рдЗрдиреНрдлреНрд░рд╛ рдиреЛрдб рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред <br><br>  рд╣реЛ рдЧрдпрд╛ред <br><br>  <b>рдЯреЗрдореНрдкрд▓реЗрдЯред</b> <br><br>  рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреЛ рдпрдорд▓ рдореЗрдВ рдЙрди рд╕рднреА рдШрдЯрдХреЛрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рдХреЗ рдЙрддрд╛рд░рд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИрдВред <br><br>  рдЕрд░реНрдерд╛рддреН, рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ dc Service Route рдХрд╛ рд░рд╣рд╕реНрдп рд╣реИред <br><br>  рдЖрдк рд╡рд╣ рд╕рдм рдХреБрдЫ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ <br><br><pre> <code class="bash hljs">oc get all</code> </pre> <br>  рджрд┐рд▓рдЪрд╕реНрдк рдЙрддрд╛рд░рдирд╛ <br><br><pre> <code class="bash hljs">oc get deploymentconfig.apps.openshift.io oko-service -o yaml</code> </pre> <br>  рдпрд╛ <br><br><pre> <code class="bash hljs">oc get d oko-service -o yaml</code> </pre> <br>  рдлрд┐рд░ рдЖрдк рдУрдкрдирд╢рд┐рдлреНрдЯ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдЖрдзрд╛рд░ рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЗ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЙрд╕реЗ рдПрдХреАрдХреГрдд рдХрд░реЗрдВред <br><br>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд░рд┐рдгрд╛рдо рдЗрд╕ рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛: <br><br>  template.yaml <br><br><pre> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"Template"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: oko-service-template objects: - kind: DeploymentConfig apiVersion: v1 metadata: name: oko-service annotations: description: <span class="hljs-string"><span class="hljs-string">"ImageStream Defines how to build the application oko-service"</span></span> labels: app: oko-service spec: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> revisionHistoryLimit: <span class="hljs-number"><span class="hljs-number">10</span></span> selector: matchLabels: app: oko-service deploymentconfig: oko-service template: metadata: labels: app: oko-service spec: selector: app: oko-service deploymentconfig: oko-service containers: - env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trCsm5"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> ports: - containerPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> name: acces protocol: TCP readinessProbe: failureThreshold: <span class="hljs-number"><span class="hljs-number">3</span></span> httpGet: path: / port: <span class="hljs-number"><span class="hljs-number">9000</span></span> scheme: HTTP initialDelaySeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> periodSeconds: <span class="hljs-number"><span class="hljs-number">10</span></span> successThreshold: <span class="hljs-number"><span class="hljs-number">1</span></span> timeoutSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> image: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service imagePullPolicy: Always name: oko-service imagePullSecrets: - name: gitlab.xxx.com type: ImageChange strategy: activeDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">21600</span></span> resources: {} rollingParams: intervalSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> maxSurge: <span class="hljs-number"><span class="hljs-number">25</span></span>% maxUnavailable: <span class="hljs-number"><span class="hljs-number">25</span></span>% timeoutSeconds: <span class="hljs-number"><span class="hljs-number">600</span></span> updatePeriodSeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> type: Rolling triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> imageChangeParams: automatic: true containerNames: - <span class="hljs-string"><span class="hljs-string">"oko-service"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStream name: <span class="hljs-string"><span class="hljs-string">'oko-service:latest'</span></span> - kind: ImageStream apiVersion: v1 metadata: name: oko-service annotations: openshift.io/generated-by: OpenShiftNewApp labels: app: oko-service deploymentconfig: oko-service spec: dockerImageRepository: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service tags: - annotations: openshift.io/imported-<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: DockerImage name: gitlab.xxx.com:<span class="hljs-number"><span class="hljs-number">4567</span></span>/oko/oko-service importPolicy: insecure: <span class="hljs-string"><span class="hljs-string">"true"</span></span> name: latest referencePolicy: type: Source forcePull: true - kind: Service apiVersion: v1 metadata: name: oko-service spec: type: ClusterIP ports: - port: <span class="hljs-number"><span class="hljs-number">9000</span></span> protocol: TCP targetPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> selector: app: oko-service sessionAffinity: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: loadBalancer: {} - kind: Route apiVersion: route.openshift.io/v1 metadata: name: oko-service spec: host: oko-service.moxs.ru to: kind: Service name: oko-service weight: <span class="hljs-number"><span class="hljs-number">100</span></span> wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: ingress: - conditions: host: oko-service.xxx.com routerName: router wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> <br>  рдЖрдк рдпрд╣рд╛рдВ рд░рд╣рд╕реНрдп рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рд╣рдо рдЦреБрд▓рдиреЗ рд╡рд╛рд▓реЗ рдХрд┐рдирд╛рд░реЗ рдкрд░ рдПрдХ рдирд┐рд░реНрдорд╛рдг рдХреЗ рд╕рд╛рде рдПрдХ рд╕реЗрд╡рд╛ рд╡рд┐рдХрд▓реНрдк рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ рдЬрд╣рд╛рдВ рд░рд╣рд╕реНрдп рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╣реЛрдВрдЧреЗред <br><br>  <i>рджреВрд╕рд░рд╛ рддрд░реАрдХрд╛</i> <br><br>  рдЫрд╡рд┐ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЗ рдкреВрд░реНрдг рдЪрд░рдгреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрдирд╛рдирд╛, рдкреБрд╢ рджреНрд╡рд╛рд░рд╛ рдПрдХ рд╕рд░рд▓ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдФрд░ рд╡рд┐рдзрд╛рдирд╕рднрд╛ред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рдирдпрд╛ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдмрдирд╛рдПрдВред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдЧрд┐рдЯ рд╕реЗ рдПрдХ рдмрд┐рд▓реНрдбрдХреЙрдиреНрдлрд╝рд┐рдЧ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рддреАрди рдбреЙрдХ рдлрд╛рдЗрд▓реЗрдВ рд╣реИрдВ, рдПрдХ рдирд┐рдпрдорд┐рдд рдбреЙрдХ рдлрд╝рд╛рдЗрд▓ рд╣реИ рдЬреЛ рджреЛ FROM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдКрдкрд░ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг 1.17 рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИ, рдФрд░ рдмреЗрд╕ рдЗрдореЗрдЬ рдФрд░ рд▓рдХреНрд╖реНрдп рдПрдХ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рджреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдбреЙрдХрдлрд╝рд╛рдЗрд▓реНрд╕ рд╣реИрдВред) <br><br>  рдпрджрд┐ рдпрд╣ рдирд┐рдЬреА рд╣реИ, рддреЛ рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рд░рд╣рд╕реНрдп рдмрдирд╛рдПрдБред <br><br><pre> <code class="bash hljs">oc create secret generic sinc-git --from-literal=username=gitsinc --from-literal=password=Paaasssword123</code> </pre><br>  рдЖрдЗрдП рд╕рд░реНрд╡рд┐рд╕ рд╕реА рдмрд┐рд▓реНрдбрд░ рдмрд┐рд▓реНрдбрд░ рдХреЛ рд╣рдорд╛рд░реЗ рд╕реАрдХреНрд░реЗрдЯ рддрдХ рдкрд╣реБрдВрдЪрд╛рдПрдВ <br><br><pre> <code class="bash hljs">oc secrets link builder sinc-git</code> </pre> <br>  Url git рдХрд╛ рд░рд╣рд╕реНрдп рдмрд╛рдБрдзреЗрдВ <br><br><pre> <code class="bash hljs">oc annotate secret sinc-git <span class="hljs-string"><span class="hljs-string">'build.openshift.io/source-secret-match-uri-1=https://gitlab.xxx.com/*'</span></span></code> </pre> <br>  рдФрд░ рдЕрдВрдд рдореЗрдВ, рдЖрдЗрдП рд╣рдо рдХреБрдВрдЬреА - рдЧрд╛рдпрдм-рд▓рд╛рдкрддрд╛ рдЫрд╡рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рдЧреАрддрд╛ рд╕реЗ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ, рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рддрдХ рдПрдХ рдореВрд▓ рдЫрд╡рд┐ рдирд╣реАрдВ рд╣реИред <br><br>  oc new-app <a href="">gitlab.xxx.com/OKO/oko-service.git</a> --strategy = <a href="">docker</a> - <a href="">allow-</a> рд▓рд╛рдкрддрд╛-рдЫрд╡рд┐рдпрд╛рдВ <br>  рдлрд┐рд░, рдирд┐рд░реНрдорд┐рдд рдмрд┐рд▓реНрдбрдХреЙрдиреНрдлрд┐рдЧ рдореЗрдВ, рдЖрдкрдХреЛ рд╣рдорд╛рд░реЗ рджреНрд╡рд╛рд░рд╛ рдЖрд╡рд╢реНрдпрдХ dockerfile рдХреЗ рд▓рд┐рдП рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><img src="https://habrastorage.org/webt/rf/_k/_m/rf_k_myzec3x1ao-x18cl3oznci.png"><br>  рд╕рд╣реА <br><img src="https://habrastorage.org/webt/kd/xy/4o/kdxy4ophl95y8kk0maiyzz65mlo.png"><br><img src="https://habrastorage.org/webt/af/2f/zd/af2fzdlg49hshegumeacnpupdsg.png"><br>  рд╣рдо рдЖрдзрд╛рд░ рдХрдВрдЯреЗрдирд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдкрджрдВрдбреЛрдВ рдХреЛ рднреА рдмрджрд▓рддреЗ рд╣реИрдВред <br><img src="https://habrastorage.org/webt/yq/tw/1t/yqtw1taajm-0ikv3cxg92l4gvcs.png"><br>  рдЖрдЗрдП рдЗрд╕ рд╕реЗ рджреЛ Buildcconfig рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред рдЖрдзрд╛рд░ рдЫрд╡рд┐ рдХреЗ рддрд╣рдд, рдпрдо рдореЗрдВ рдЕрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЖрд╡рд╢реНрдпрдХ рд╕рд╛рдорд╛рди рд▓реЗрдВред <br><br>  рдЖрдк рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рджреЛ рдРрд╕реЗ рдкреИрдЯрд░реНрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  BC-py <br><br><pre> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build-pyton-ml"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.com/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-python-ml forcePull: true output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span></code> </pre> <br>  BC-oko <br><br><pre> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.xom/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStreamTag name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span> forcePull: true env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trCsn5"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"oko-service:latest"</span></span></code> </pre> <br><br>  рд╣рдореЗрдВ рдПрдХ рддреИрдирд╛рддреА рддреИрдирд╛рддреА рджреЛ рдХрд▓реНрдкрдирд╛ рдмрдирд╛рдиреЗ рдФрд░ рд╕реЗрд╡рд╛ рдФрд░ рдорд╛рд░реНрдЧ рдХреА рддреИрдирд╛рддреА рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреА рднреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br>  рдореИрдВрдиреЗ рдЕрд▓рдЧ рд╕реЗ рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реНрд╕ рдХрд╛ рдЙрддреНрдкрд╛рджрди рдирд╣реАрдВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рджреА, рд▓реЗрдХрд┐рди рддреБрд░рдВрдд рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рд╕рдореЗрдВ рд╕реЗрд╡рд╛ рдХреЗ рд╕рднреА рдШрдЯрдХ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЗ рдмрд┐рдирд╛ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд▓рд┐рдП рдкрд┐рдЫрд▓реЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред <br><br><pre> <code class="python hljs">template kind: <span class="hljs-string"><span class="hljs-string">"Template"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: oko-service-template objects: - kind: Secret apiVersion: v1 type: kubernetes.io/basic-auth metadata: name: git-oko annotations: build.openshift.io/source-secret-match-uri<span class="hljs-number"><span class="hljs-number">-1</span></span>: https://gitlab.xxx.com/* data: password: R21ZFSw== username: Z2l0cec== - kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build-pyton-ml"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.com/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-python-ml forcePull: true output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span> - kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-build"</span></span> labels: app: oko-service spec: completionDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">2400</span></span> triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> source: type: git git: uri: <span class="hljs-string"><span class="hljs-string">"https://gitlab.xxx.com/OKO/oko-service.git"</span></span> ref: <span class="hljs-string"><span class="hljs-string">"master"</span></span> sourceSecret: name: git-oko strategy: type: Docker dockerStrategy: dockerfilePath: Dockerfile-oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStreamTag name: <span class="hljs-string"><span class="hljs-string">"python-ml:latest"</span></span> forcePull: true env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trC"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> output: to: kind: <span class="hljs-string"><span class="hljs-string">"ImageStreamTag"</span></span> name: <span class="hljs-string"><span class="hljs-string">"oko-service:latest"</span></span> - kind: DeploymentConfig apiVersion: v1 metadata: name: oko-service annotations: description: <span class="hljs-string"><span class="hljs-string">"ImageStream Defines how to build the application oko-service"</span></span> labels: app: oko-service spec: replicas: <span class="hljs-number"><span class="hljs-number">1</span></span> revisionHistoryLimit: <span class="hljs-number"><span class="hljs-number">10</span></span> selector: matchLabels: app: oko-service deploymentconfig: oko-service template: metadata: labels: app: oko-service spec: selector: app: oko-service deploymentconfig: oko-service containers: - env: - name: serverPort value: <span class="hljs-string"><span class="hljs-string">"9000"</span></span> - name: storeLogin value: <span class="hljs-string"><span class="hljs-string">"iii"</span></span> - name: storePassword value: <span class="hljs-string"><span class="hljs-string">"trCsn5"</span></span> - name: storeApiUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2"</span></span> - name: storeWsdlUrl value: <span class="hljs-string"><span class="hljs-string">"http://14.75.41.20/custom-api-2.0/CustomWebService2/CustomWebService2.wsdl"</span></span> - name: logLevel value: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span> - name: logPath value: <span class="hljs-string"><span class="hljs-string">"/var/log/efp-oko.log"</span></span> ports: - containerPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> name: acces protocol: TCP readinessProbe: failureThreshold: <span class="hljs-number"><span class="hljs-number">3</span></span> httpGet: path: / port: <span class="hljs-number"><span class="hljs-number">9000</span></span> scheme: HTTP initialDelaySeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> periodSeconds: <span class="hljs-number"><span class="hljs-number">10</span></span> successThreshold: <span class="hljs-number"><span class="hljs-number">1</span></span> timeoutSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> image: docker-registry.default.svc:<span class="hljs-number"><span class="hljs-number">5000</span></span>/oko-service-p/oko-service imagePullPolicy: Always name: oko-service type: ImageChange strategy: activeDeadlineSeconds: <span class="hljs-number"><span class="hljs-number">21600</span></span> resources: {} rollingParams: intervalSeconds: <span class="hljs-number"><span class="hljs-number">1</span></span> maxSurge: <span class="hljs-number"><span class="hljs-number">25</span></span>% maxUnavailable: <span class="hljs-number"><span class="hljs-number">25</span></span>% timeoutSeconds: <span class="hljs-number"><span class="hljs-number">600</span></span> updatePeriodSeconds: <span class="hljs-number"><span class="hljs-number">5</span></span> type: Rolling triggers: - type: <span class="hljs-string"><span class="hljs-string">"ImageChange"</span></span> imageChangeParams: automatic: true containerNames: - <span class="hljs-string"><span class="hljs-string">"oko-service"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: ImageStreamTag name: <span class="hljs-string"><span class="hljs-string">'oko-service:latest'</span></span> - kind: ImageStream apiVersion: v1 metadata: name: oko-service annotations: openshift.io/generated-by: OpenShiftNewApp labels: app: oko-service deploymentconfig: oko-service spec: dockerImageRepository: <span class="hljs-string"><span class="hljs-string">""</span></span> tags: - annotations: openshift.io/imported-<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: oko-service <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: DockerImage name: oko-service importPolicy: insecure: <span class="hljs-string"><span class="hljs-string">"true"</span></span> name: latest referencePolicy: type: Source - kind: ImageStream apiVersion: v1 metadata: name: python-ml spec: dockerImageRepository: <span class="hljs-string"><span class="hljs-string">""</span></span> tags: - annotations: openshift.io/imported-<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: oko-service-build <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: kind: DockerImage name: python-ml importPolicy: insecure: <span class="hljs-string"><span class="hljs-string">"true"</span></span> name: latest referencePolicy: type: Source - kind: Service apiVersion: v1 metadata: name: oko-service spec: type: ClusterIP ports: - port: <span class="hljs-number"><span class="hljs-number">9000</span></span> protocol: TCP targetPort: <span class="hljs-number"><span class="hljs-number">9000</span></span> selector: app: oko-service sessionAffinity: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: loadBalancer: {} - kind: Route apiVersion: route.openshift.io/v1 metadata: name: oko-service spec: host: oko-service.xxx.com to: kind: Service name: oko-service weight: <span class="hljs-number"><span class="hljs-number">100</span></span> wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> status: ingress: - conditions: host: oko-service.xxx.com routerName: router wildcardPolicy: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre><br>  рдпрд╣ рдЯреЗрдореНрдкрд▓реЗрдЯ рдУрдХреЛ-рд╕рд░реНрд╡рд┐рд╕-рдкреА рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЗрд╕ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br>  рдЖрдк рд╡рд╛рдВрдЫрд┐рдд рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдирд╛рдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br>  рдореИрдВ рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рд╕реЗ рджреЛрд╣рд░рд╛рддрд╛ рд╣реВрдВ рдХрд┐ рдореВрд▓ рдпрдорд▓ рдХреЛ рдорд╣рд╛рд╕рд╛рдЧрд░ рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдбреЗрдЯрд╛ рдЕрдкрд▓реЛрдб рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ ... -рдУ рдпрдорд▓ <br><br>  рдЖрдк рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╕реНрдХреИрдирд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <br><br><pre> <code class="bash hljs">oc process -f oko-service-templatebuild.yaml | oc create -f -</code> </pre> <br>  рдлрд┐рд░ рдПрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдПрдВ <br><br>  OKO-рд╕реЗрд╡рд╛-pipeline.yaml <br><br><pre> <code class="python hljs">kind: <span class="hljs-string"><span class="hljs-string">"BuildConfig"</span></span> apiVersion: <span class="hljs-string"><span class="hljs-string">"v1"</span></span> type: <span class="hljs-string"><span class="hljs-string">"GitLab"</span></span> gitlab: secret: <span class="hljs-string"><span class="hljs-string">"secret101"</span></span> metadata: name: <span class="hljs-string"><span class="hljs-string">"oko-service-sample-pipeline"</span></span> spec: strategy: jenkinsPipelineStrategy: jenkinsfile: |- // path of the template to use // <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">templatePath</span></span></span><span class="hljs-function"> = '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">https</span></span></span><span class="hljs-function">:</span></span>//raw.githubusercontent.com/openshift/nodejs-ex/master/openshift/templates/nodejs-mongodb.json<span class="hljs-string"><span class="hljs-string">' // name of the template that will be created def templateName = '</span></span>oko-service-template<span class="hljs-string"><span class="hljs-string">' // NOTE, the "pipeline" directive/closure from the declarative pipeline syntax needs to include, or be nested outside, pipeline { agent any environment { DEV_PROJECT = "oko-service"; } stages { stage('</span></span>deploy<span class="hljs-string"><span class="hljs-string">') { steps { script { openshift.withCluster() { openshift.withProject() { echo "Hello from project ${openshift.project()} in cluster ${openshift.cluster()}" def dc = openshift.selector('</span></span>dc<span class="hljs-string"><span class="hljs-string">', "${DEV_PROJECT}") openshiftBuild(buildConfig: '</span></span>oko-service-build<span class="hljs-string"><span class="hljs-string">', waitTime: '</span></span><span class="hljs-number"><span class="hljs-number">3000000</span></span><span class="hljs-string"><span class="hljs-string">') openshiftDeploy(deploymentConfig: '</span></span>oko-service<span class="hljs-string"><span class="hljs-string">', waitTime: '</span></span><span class="hljs-number"><span class="hljs-number">3000000</span></span><span class="hljs-string"><span class="hljs-string">') } } } } } } // stages } // pipeline type: JenkinsPipeline triggers: - type: GitLab gitlab: secret: ffffffffk</span></span></code> </pre> <br>  рдЪрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рдж рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж <br><br><pre> <code class="bash hljs">oc describe buildconfig oko-service-sample-pipeline</code> </pre> <br>  Gitlab рдореЗрдВ webhook рдХреЗ рд▓рд┐рдП url рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/_l/ee/bk/_leebk_a59h1kbzn8widsczafsk.png"><br><br>  рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд░рд╣рд╕реНрдп рдХреЗ рд╕рд╛рде рд░рд╣рд╕реНрдп рдХреЛ рдмрджрд▓реЗрдВред <br><img src="https://habrastorage.org/webt/nt/63/ce/nt63ceczqzpqujqysq0caka5yle.png"><br><br>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдУрдкрдирд╢рд┐рдлреНрдЯ рд▓рдЧрд╛рдиреЗ рдХреЗ рдмрд╛рдж рдЦреБрдж рдкрд╛рдЗрдкрд▓рд╛рдЗрди рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдЬреЗрдирдХреАрдВрд╕ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджреЗрдЧрд╛ред  рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд▓реЙрдиреНрдЪ рд▓рдВрдмрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдереЛрдбрд╝реА рджреЗрд░ рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рдлрд┐рд░ рд╣рдорд╛рд░реЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдЧрд┐рдЯрд▓реИрдм рдореЗрдВ: <br><br><img src="https://habrastorage.org/webt/nt/63/ce/nt63ceczqzpqujqysq0caka5yle.png"><br><br>  Url рдореЗрдВ рднрд░реЗрдВ, рдЧреБрдкреНрдд, рдирд┐рдХрд╛рд▓реЗрдВ SSL рд╕рддреНрдпрд╛рдкрди рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рдФрд░ рд╣рдорд╛рд░рд╛ webhook рддреИрдпрд╛рд░ рд╣реИред <br><br>  рдЖрдк рдПрдХ рдкрд░реАрдХреНрд╖рдг рдзрдХреНрдХрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреА рдкреНрд░рдЧрддрд┐ рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ <br><br><img src="https://habrastorage.org/webt/c4/sd/at/c4sdatvqowwtgn_rjyzqvjj_hd4.png"><br><br>  Infranode рдкрд░ рд╕рдорд╛рди рдЬреЗрдирдХреАрдВрд╕ рдкрд░ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрд╕реНрдЯ url рдореЗрдВ рдкрдВрдЬреАрдХрд░рдг рдХрд░рдирд╛ рди рднреВрд▓реЗрдВред <br><br><img src="https://habrastorage.org/webt/zj/d_/1n/zjd_1nqxegz1jrodji6wmsi8ebm.png"><br><br>  рдЖрдк рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреА рдкреНрд░рдЧрддрд┐ рднреА рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/-o/ru/zq/-oruzqelmtrzyhwairvn8t8am_u.png"><br><br><h4>  рдкреАрдПрд╕ рдореБрдЭреЗ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдпрд╣ рд▓реЗрдЦ рдХрдИ рд▓реЛрдЧреЛрдВ рдХреЛ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ рдХрд┐ рдУрдкрдирд╢рдлреНрдЯ рдХреИрд╕реЗ рдЦрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╡реЗ рдХреНрдпрд╛ рдЦрд╛рддреЗ рд╣реИрдВ, рдХрдИ рдмрд┐рдВрджреБрдУрдВ рдХреЛ рд╕реНрдкрд╖реНрдЯ рдХрд░реЗрдВрдЧреЗ рдЬреЛ рдкрд╣рд▓реА рдирдЬрд╝рд░ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рд╣реИрдВред <br><br>  рдкреАрдПрд╕рдПрд╕ рдХреБрдЫ рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рд╕рдорд╛рдзрд╛рди </h4><br>  рдмрд┐рд▓реНрдб рдмрд┐рд▓реНрдб рд╢реБрд░реВ рдХрд░рдирд╛ рдЖрджрд┐ рд╕рдорд╕реНрдпрд╛рдПрдВред <br>  - рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрд╡рд╛ рдЦрд╛рддрд╛ рдмрдирд╛рдПрдБ <br><br><pre> <code class="bash hljs">oc create serviceaccount oko-serviceaccount oc adm policy add-scc-to-user privileged system:serviceaccount:__:oko-serviceaccount oc adm policy add-scc-to-group anyuid system:authenticated oc adm policy add-scc-to-user anyuid system:serviceaccount:__:oko-serviceaccount</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкреНрд░реЙрдЬреЗрдХреНрдЯ рдХреЛ рдлреНрд░реАрдЬрд╝ рдХрд░рдиреЗ рдФрд░ рдЙрд╕реЗ рдбрд┐рд▓реАрдЯ рди рдХрд░рдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛рдПрдБ </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- рдЬрд╝рдмрд░рджрд╕реНрддреА рдкреВрд░реА рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ (рдЬрдиреНрдордЬрд╛рдд рдмреАрдорд╛рд░реА)</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $(oc get projects | grep Terminating| awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$i</span></span>; oc get serviceinstance -n <span class="hljs-variable"><span class="hljs-variable">$i</span></span> -o yaml | sed <span class="hljs-string"><span class="hljs-string">"/kubernetes-incubator/d"</span></span>| oc apply -f - ; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдЪрд┐рддреНрд░ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛рдПрдБред </font></font><br><br><pre> <code class="bash hljs">oc adm policy add-role-to-group system:image-puller system:serviceaccounts:__ oc adm policy add-role-to-user system:image-puller system:serviceaccount:__::default oc adm policy add-role-to-group system:image-puller system:serviceaccounts:__ oc policy add-role-to-user system:image-puller system:serviceaccount:__::default oc policy add-role-to-group system:image-puller system:serviceaccounts:__</code> </pre> <br><img src="https://habrastorage.org/webt/ij/zc/kp/ijzckpza-dz2ninhkmak58f0sj0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nfs рдкрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреЗ рд▓рд┐рдП рдлрд╝реЛрд▓реНрдбрд░ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЛ рднреА рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВред </font><font style="vertical-align: inherit;">(рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд▓реЙрдЧ рдореЗрдВ рд░рд╛рдЗрдЯ рдПрд░рд░ рд╣реИрдВ, рдмрд┐рд▓реНрдб рдкреБрд╢ рдкрд░ рд▓рдЯрдХрд╛ рд╣реБрдЖ рд╣реИ)ред</font></font><br><br><pre> <code class="bash hljs">chmod 777 -r /exports/registry/docker/registry/ chmod -R 777 /exports/registry/docker/registry/ chown nfsnobody:nfsnobody -R /exports/registry/ hown -R 1001 /exports/registry/ restorecon -RvF exportfs -ar</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi441360/">https://habr.com/ru/post/hi441360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi441348/index.html">NFT рдмрдирд╛рдо Nginx рдХреЗ рд╕рд╛рде рдкреНрд░рддреНрдпрдХреНрд╖ рд░реВрдЯрд┐рдВрдЧ рдФрд░ рд╕рдВрддреБрд▓рди</a></li>
<li><a href="../hi441350/index.html">рдХреНрдпрд╛ рд╣рд╛рд╕реНрдХреЗрд▓ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкреНрд░рддрд┐рднрд╛ рдФрд░ рд╢рд┐рдХреНрд╖рд╛ рдХреА рднрд╛рд╖рд╛ рд╣реИ?</a></li>
<li><a href="../hi441352/index.html">рд╕реАрдЖрдИ / рд╕реАрдбреА рдкреИрдЯрд░реНрди рдФрд░ рд╡рд┐рд░реЛрдзреА рдкреИрдЯрд░реНрдиред рднрд╛рдЧ реи</a></li>
<li><a href="../hi441356/index.html">"рд╡рд┐рджреЗрд╢реА" рдХреЛрдб рдХреЛ рдХреИрд╕реЗ рд╕рдордЭреЗрдВ рдФрд░ рдПрдХ рдирдИ рдЯреАрдо рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ?</a></li>
<li><a href="../hi441358/index.html">рдкрд╣рд▓реЗ рдмреЗрд░реЗрд╕реИрдЯ рд╡рд╛рдгрд┐рдЬреНрдпрд┐рдХ рдЪрдВрджреНрд░ рд▓реИрдВрдбрд░ рд▓реЙрдиреНрдЪ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi441362/index.html">рдХрд┐рдмрд╛рдирд╛ рдпреВрдЬрд░ рдЧрд╛рдЗрдбред рджреГрд╢реНрдпред рднрд╛рдЧ 3</a></li>
<li><a href="../hi441364/index.html">рдорд╛рд╕реНрдХреЛ 2019 рдореЗрдВ рд╕рдореНрдореЗрд▓рди рдХрд╛рд░реНрдпрдХреНрд░рдо рд▓реБрдЖ</a></li>
<li><a href="../hi441366/index.html">рдХреНрдпрд╛ рд╕реНрдЯреЛрд░ рдХреЛ рд╕реНрдЯрд╛рдЗрд▓рд┐рд╢ рдХреНрд░реЙрд╕рд▓реЗрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: рд╕рд┐рдлрд╛рд░рд┐рд╢реЛрдВ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЫрд╡рд┐ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдореЗрдВ рд░рд┐рдЯреЗрд▓ рд░реЙрдХреЗрдЯ рдХрд╛ рдЕрдиреБрднрд╡</a></li>
<li><a href="../hi441368/index.html">рдиреЗрдкреНрдЪреНрдпреВрди рдХрд╛ рдкреВрд░реНрд╡ рдЕрджреГрд╢реНрдп рдЪрдВрджреНрд░рдорд╛ рдХреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИ</a></li>
<li><a href="../hi441370/index.html">рдирд┐рдбрд░ рд╕рдВрд░рдХреНрд╖рдгред рдереНрд░реЗрдб рд╕реБрд░рдХреНрд╖рд╛ рдЬрдВрдЧ рдореЗрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>