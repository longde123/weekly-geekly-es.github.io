<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📹 😘 🧖🏻 Isometry, indeks-z dalam game mobile dan pengoptimalannya 🐹 🎥 🦇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Baru-baru ini kami keluar dengan permainan kami , yang kami siapkan untuk waktu yang lama dan dalam proses yang telah mengumpulkan banyak ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Isometry, indeks-z dalam game mobile dan pengoptimalannya</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415051/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/eu/4v/lkeu4vc8aqhbtyddxs_2cckvcbq.gif"></div><br>  Halo, Habr!  Baru-baru ini kami keluar dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">permainan kami</a> , yang kami siapkan untuk waktu yang lama dan dalam proses yang telah mengumpulkan banyak topik menarik yang layak untuk dibagikan kepada masyarakat.  Topik ini akan menarik tidak hanya untuk iOS dan pengembang seluler lainnya, tetapi juga untuk semua orang yang tertarik pada bagaimana segala macam hal grafis bekerja di bawah tenda, serta semua penggemar strategi 2D, yang saya sendiri telah lakukan selama dekade ketiga. <br><a name="habracut"></a><br>  Hari ini kita akan berbicara tentang nuansa topik penting seperti z-indeks pada permukaan isometrik (ya, tidak semuanya sesederhana kelihatannya bagi beberapa orang bijak).  Di dunia 3d, kita, anehnya, memiliki tiga koordinat - x, y, z - yang sepenuhnya menentukan posisi objek di ruang angkasa.  Tugas menentukan kedekatan objek dengan kamera juga ada, tetapi sepenuhnya berada di pundak OpenGL.  Pengembang hanya beroperasi dengan parameter tingkat tinggi seperti kedalaman buffer-z, yang memengaruhi kinerja, tetapi Anda dapat mempercayai OpenGL sebagai kotak hitam - ia memiliki informasi yang cukup. <br><br>  Situasi yang sangat berbeda diamati di dunia "pseudo-3D" kami - setiap objek hanya memiliki (x, y) - koordinat dan ukuran sprite.  Tugas pertama yang dihadapi seorang programmer saat menulis mesin adalah tugas menentukan objek mana yang harus saling tumpang tindih di depan "kamera" virtual kami. <br><br><h3>  Sinopsis </h3><br>  Koordinat SpriteKit (di mana (0; 0) adalah pusat dari "dunia" dan Y naik) dalam hal ini kita sama sekali tidak tertarik, karena  mereka tidak berarti apa-apa di "dunia" isometrik kami dengan Anda, jadi mari kita melakukan pemesanan - kami memiliki bidang berbentuk berlian seperti Zaman Kerajaan. <br><br><img src="https://habrastorage.org/webt/wr/5e/vv/wr5evvkc_hek_pscypdlvngc_rc.jpeg"><br><br>  Ubin dengan koordinat (0; 0) terletak di sudut kiri belah ketupat, absis X meningkatkan "turun" dan "kanan", yaitu.  tumbuh lebih dekat dengan pengamat, Y ditahbiskan meningkat "ke atas" dan "ke kanan", yaitu  berkurang saat Anda mendekati pengamat. <br><br>  Juga, rel harus "di bawah" kereta, asap dari cerobong asap harus "di atas" kereta.  Tapi kita tidak akan repot-repot sekarang dengan "lapisan makhluk" - jelas, tidak ada yang mencegah kita membuat sebanyak "irisan" isometrik yang Anda suka, bekerja sesuai dengan aturan yang sama.  Kami berasumsi bahwa dalam satu ubin selalu ada satu objek - untuk kejelasan, lebih banyak tidak diperlukan. <br><br><img src="https://habrastorage.org/webt/qi/2u/cs/qi2ucse8xajdr-r3ttwf1t9smt4.jpeg"><br><br>  Perhatikan dua kereta di atas.  Jelas, dari sudut pandang pengamat, mobil-mobil harus ditempatkan "di bawah" kereta, yaitu  indeks-z mereka harus lebih kecil.  Pada saat yang sama, kereta "atas" harus "tumpang tindih" dengan tetangga, menjadi "lebih jauh".  Bisakah kita, hanya memiliki koordinat (x; y), membangun peta indeks-z untuk setiap ubin? <br><br>  Jelas, ya, menggunakan rumus berikut (pseudocode a la swift): <br><br><pre><code class="hljs matlab">zIndex = pos.x * field.<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>.width - pos.y</code> </pre> <br>  Dengan demikian, kami menjamin bahwa ketika ordinat tumbuh, benda-benda bergerak menjauh (-pos.y), serta dengan pertumbuhan absis, pendekatan objek (pos.x) dan, yang penting, setiap objek yang memiliki absis, katakanlah 44, akan sengaja “lebih dekat” "Daripada benda apa pun yang memiliki absis 43. Untuk menambahkan" pelapisan "di sini (ingat, rel di bawah kereta, asap di atas pipa), itu sudah cukup untuk menambahkan" ketinggian "konstan lapisan: <br><br><pre> <code class="hljs matlab">zIndex = layerZIndex + pos.x * field.<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>.width - pos.y</code> </pre> <br>  Itu saja, Anda bisa mengakhiri artikel, dan memuji diri sendiri untuk dasar-dasar stereometri yang dipelajari di kelas 10 dan memulai logika permainan.  Tidak  Kalau saja!  Saya akan menulis tentang hal-hal yang jelas!  (Yah, sudah jelas, beberapa hari hancur dan ini) <br><br>  Kami baru saja turun ke bagian yang menyenangkan, bergerak maju. <br><br><h3>  Perjuangan kinerja </h3><br>  Semua orang, setidaknya sekali, menjalankan proyek uji untuk SpriteKit (atau kelapa, atau mesin lainnya), melihat angka ajaib - fps dan node. <br><br><img src="https://habrastorage.org/webt/ej/ly/fg/ejlyfgpeamuachzwte2aucpuxhy.jpeg"><br><br>  Jelas, fps adalah jumlah frame per detik, node adalah jumlah node, terutama sprite.  Namun dalam praktiknya, sebagian besar dari semua fps diatur bukan oleh jumlah node, tetapi oleh parameter lain, yang secara default tidak ditampilkan, tetapi yang juga dapat ditampilkan dengan satu baris - jumlah undian digambar ulang. <br><br><img src="https://habrastorage.org/webt/or/w6/mq/orw6mqdp2bgxt5bfybnz1evzt5y.jpeg"><br><br>  Dalam adegan yang sama, seperti yang Anda lihat sekarang, jumlah node adalah sekitar 6000, dan jumlah rendering sekitar 120. Ini adalah pada zoom minimum (kamera sedekat mungkin ke permukaan), 1: 1. <br><br>  Sekarang, mari kita gerakkan kamera ke jarak maksimum (dalam game kami ini 2,5: 1) <br><br><img src="https://habrastorage.org/webt/g1/78/wz/g178wz_a1q85pqtrtyzvffswndo.jpeg"><br><br>  Kami mengubah skala hanya 2,5 kali (dalam contoh, jauh dari semua objek yang diambil), dan jumlah undian meningkat 5-6 kali dengan jumlah node tidak berubah! <br><br>  Tentu saja, jumlah rendering mempengaruhi fps jauh lebih banyak daripada jumlah abstrak node.  SpriteKit tidak menggambar node yang tidak jatuh ke viewport (ke dalam kamera).  Satu-satunya pengecualian yang saya temukan sejauh ini adalah penghasil partikel, yang selalu digambar, terlepas dari apakah mereka terlihat atau tidak. <br><br>  Sekarang mari kita bicara tentang apa arti menggambar "menggambar" ini.  Kartu video memiliki semua "lapisan" node, dipandu oleh indeks-z mereka.  Dan itu melewati seluruh gambar berulang-ulang, dari yang terendah ke yang tertinggi.  Jumlah siklus perenderan seperti itu adalah draw. <br><br>  Sekarang Anda mengerti bahwa jika Anda menggambar setiap objek kecil (dan kami memiliki peta besar, sekitar 6000 x 3000) dengan indeks-z sendiri, ini akan merusak kinerja ponsel apa pun. <br><br>  Masalah paling baik dilihat pada versi 5 dan 5 yang lama, tetapi kehadiran iPhone 10 tidak menjamin apa pun - dengan pendekatan yang salah, Anda dapat membuang perangkat keras yang kuat.  Dalam permainan kami, salah satu landasannya adalah kejelasan ekstrim.  Pada zoom terdekat, sprite satu-satu sesuai dengan retin piksel.  Saya harus mengatakan bahwa di sebagian besar permainan ponsel, resolusinya lebih rendah daripada pesanan, sehingga persyaratannya tidak terlalu besar, tetapi kami melakukannya secara kualitatif, seperti untuk diri kami sendiri ... <br><br>  Jadi, Anda harus pergi ke trik. <br><br><ul><li>  Semua objek yang tidak berinteraksi dengan pemain, dan yang berada pada level yang sama dalam koordinat X, umumnya dapat digabung menjadi satu sprite.  Untuk kartu video, lebih mudah untuk menggambar satu sprite besar daripada 10 yang kecil.  Oleh karena itu, jalur hutan antara jalan adalah sprite integral yang terdiri dari beberapa pohon.  Dan pohon-pohon yang tidak tumpang tindih jalan dan pohon-pohon lain umumnya dijahit ke dalam peta.  Di alpha, ngomong-ngomong, ada beberapa bug ketika pohon ek berumur satu abad tumbuh tepat di bawah rel kereta api atau di bawah lampu lalu lintas kereta api, jadi hati-hati menguji game Anda agar tidak menghibur pengguna. <br></li><li>  Objek yang memiliki satu indeks-z digambar sesuai urutan kemunculannya pada kartu video.  Yaitu  menambahkan objek "jauh" sebelum yang "tutup", mereka akan jatuh dengan benar, tetapi tidak akan menambah jumlah kartu grafis yang dirender. <br></li></ul><br>  Semua ini memungkinkan Anda untuk mengurangi jumlah pengundian di kali, memperbaiki fps bahkan di iPhone lama.  Saya harus sangat membatasi beberapa efek pada mereka, tetapi Apple belum merilis pembaruan untuk mereka selama satu tahun sekarang - dosa akan mengeluh! <br><br><h3>  Ketinggian </h3><br>  Nah, semuanya, mesin sudah siap, bisakah Anda memulai sesuatu yang menarik?  Seseorang bisa, tetapi masih terlalu dini untuk kita.  Lagipula, kereta itu seharusnya dengan indahnya meninggalkan terowongan, dan di sini semuanya tidak sesederhana kelihatannya. <br><br><img src="https://habrastorage.org/webt/sp/cb/nm/spcbnmehem8_bu1ogy0fijlt_ho.jpeg"><br><br>  Kereta harus ditempatkan "lebih tinggi" dari dinding terowongan yang "jauh", dan "lebih rendah" dari atap terowongan dan gunung-gunung yang mengikutinya.  Betapa indahnya, ketika peta itu multi-level, dengan perubahan ketinggian - sekali lagi, kita tidak melakukan omong kosong tanpa jiwa, tapi apa yang kita sukai! <br><br>  Tetapi kembali ke detail - untuk ini peta "dipotong" sebagai berikut. <br><br><img src="https://habrastorage.org/webt/wj/vc/cq/wjvccqdd_chsxclx127yy127ffo.png"><br><br>  Dinding bagian dalam terowongan dan segala sesuatu di sebelah kiri lebih rendah dan <br><br><img src="https://habrastorage.org/webt/7e/iz/4v/7eiz4vshagonj-yf5of3ndzsr6m.png"><br><br>  bagian atas terowongan bersama dengan pegunungan di mana ia mengalir.  Di sini, tidak ada generasi prosedural indeks-z yang akan membantu, hanya hardcode Belarusia yang parah. <br><br>  Habrayuzer yang penuh perhatian memperhatikan dalam cuplikan layar dari permainan bahwa di dekat terowongan, pohon-pohon itu "dipangkas" dengan rapi, memperlihatkan pasir pantai yang masih asli.  Kelemahan yang tampaknya ini datang dari ketidakmungkinan mendasar untuk mewujudkan penanaman pohon seperti itu dalam 2D.  Kereta, meninggalkan terowongan, harus dengan sengaja "di atas" pohon-pohon yang tumpang tindih, menutupinya dengan sendirinya.  Tapi pohon-pohon yang sama ini harus tumpang tindih dengan atap terowongan, di mana kereta harus memanggil!  Dan atapnya harus lebih tinggi dari kereta, dan dalam lingkaran, kita memiliki kontradiksi logis ... <br><br>  Untuk alasan yang sama, karena ketidaksempurnaan mesin grafis, dalam game lama seperti Duke Nukem dan Doom2 tidak ada perbedaan besar dalam ketinggian dan lantai bangunan. <br><br>  Itu sebabnya pohon tidak tumbuh di dekat terowongan. <br><br>  Saya harap itu menarik, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mainannya tinggal di sini (gratis untuk bermain)</a> , artikel selanjutnya dalam seri ini akan tentang air 2D realistis yang indah, jangan ketinggalan! <br><br>  PS By the way, video untuk menarik perhatian dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dilihat di youtube</a> dalam kualitas normal. <br><br>  PPS Game ini sejauh ini hanya tersedia di CIS, Kanada dan Irlandia, jika seseorang ingin melihat dari negara lain, kirim email pribadi dengan appleId - Saya akan menambahkannya ke TestFlight </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id415051/">https://habr.com/ru/post/id415051/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi486174/index.html">मेरा जीरो टर्नओवर है</a></li>
<li><a href="../id415043/index.html">Robot terbang berubah bentuk di udara</a></li>
<li><a href="../id415045/index.html">Kebijakan lisensi Oracle mendorong analitik pada Hadoop</a></li>
<li><a href="../id415047/index.html">Acara digital di Moskow dari 25 Juni hingga 1 Juli</a></li>
<li><a href="../id415049/index.html">Membuat perintah manajemen di Django</a></li>
<li><a href="../id415053/index.html">Mengapa prosesor Skylake terkadang berjalan 2 kali lebih lambat</a></li>
<li><a href="../id415055/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 320 (18-24 Juni, 2018)</a></li>
<li><a href="../id415057/index.html">PHP Digest No. 133 (10 - 24 Juni 2018)</a></li>
<li><a href="../id415059/index.html">Rahasia masakan JavaScript: rempah-rempah</a></li>
<li><a href="../id415061/index.html">Dari frontend ke backend</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>