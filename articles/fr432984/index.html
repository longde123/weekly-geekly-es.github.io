<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçú üßê üéõÔ∏è Apprentissage automatique avec Node.js √† l'aide de la biblioth√®que Tensorflow.js üå≥ ü§±üèΩ üöØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous, chers coll√®gues! 

 Peut-√™tre que les fans de la biblioth√®que Tensorflow, qui ont d√©j√† remarqu√© ce livre dans notre pr√©-commande, ont ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apprentissage automatique avec Node.js √† l'aide de la biblioth√®que Tensorflow.js</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/432984/">  Bonjour √† tous, chers coll√®gues! <br><br>  Peut-√™tre que les fans de la biblioth√®que Tensorflow, qui ont d√©j√† remarqu√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce livre</a> dans notre pr√©-commande, ont √©galement examin√© de pr√®s les possibilit√©s de la machine et du deep learning dans le navigateur, d'autant plus que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fran√ßois Schollet</a> lui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-</a> m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">n'a pas ignor√© le</a> sujet.  Nous invitons les personnes int√©ress√©es par le chat, qui explique comment les images sont reconnues √† l'aide de la biblioth√®que Tensorflow.js. <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TensorFlow.js</a> est une nouvelle version de la biblioth√®que open source populaire qui enrichit JavaScript avec des capacit√©s d'apprentissage approfondi.  Les d√©veloppeurs peuvent d√©sormais d√©finir, former et ex√©cuter des mod√®les √† l'aide de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API de biblioth√®que de haut niveau</a> . <br><br>  Gr√¢ce √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des mod√®les pr√©-form√©s, les</a> d√©veloppeurs peuvent d√©sormais facilement r√©soudre des t√¢ches complexes telles que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la reconnaissance de formes</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la g√©n√©ration de musique</a> ou la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©termination de positions humaines en</a> seulement quelques lignes de JavaScript. <br><br>  Tensorflow.js a commenc√© comme une biblioth√®que frontale pour travailler dans un navigateur, mais cette ann√©e, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un support exp√©rimental pour</a> Node.js y a √©t√© ajout√©.  Ainsi, TensorFlow.js peut √©galement √™tre utilis√© dans des applications backend JavaScript, ce qui nous √©vite compl√®tement d'avoir √† recourir √† Python. <br><br>  <i>En lisant cette biblioth√®que, j'ai d√©cid√© de l'essayer sur une t√¢che simple ...</i> <br><blockquote>  Utilisez TensorFlow.js pour la reconnaissance visuelle des images sur les images lors de l'utilisation de JavaScript √† partir de Node.js </blockquote>  Malheureusement, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemples de code</a> d√©crivent principalement l'utilisation de cette biblioth√®que dans le navigateur. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les utilitaires de projet</a> con√ßus pour simplifier le chargement et l'utilisation de mod√®les pr√©-form√©s au moment de l'√©criture ne prenaient pas encore en charge Node.js.  J'ai d√ª consacrer beaucoup de temps √† bien lire les sources Typescript pour cette biblioth√®que. <br><br>  Cependant, apr√®s quelques jours de swotting, je l'ai toujours fait!  Hourra! <br><br>  <i>Avant de passer √† une analyse d√©taill√©e du code, parlons d'autres impl√©mentations de la biblioth√®que TensorFlow.</i> <br><br>  <b>Tensorflow</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TensorFlow</a> est une biblioth√®que de logiciels gratuite pour les applications d'apprentissage automatique.  TensorFlow peut √™tre utilis√© pour cr√©er des r√©seaux de neurones et impl√©menter d'autres algorithmes d'apprentissage en profondeur. <br><br>  Il s'agit d'une biblioth√®que publi√©e par Google en novembre 2015, initialement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crite en Python</a> .  Pour la formation et l'√©valuation des mod√®les cr√©√©s, il utilise des calculs sur un CPU ou un GPU.  Initialement, cette biblioth√®que a √©t√© cr√©√©e pour fonctionner sur des serveurs hautes performances utilisant des GPU gourmands en ressources. <br><br>  Des mises √† jour r√©centes ont permis d'optimiser cette biblioth√®que et de l'utiliser dans des environnements aux ressources plus limit√©es, par exemple sur les appareils mobiles et les navigateurs Web. <br><br>  <b>TensorFlow Lite</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tensorflow Lite</a> , la version all√©g√©e de cette biblioth√®que pour appareils mobiles et syst√®mes embarqu√©s, est sortie en mai 2017.  Avec lui, un nouvel ensemble de mod√®les profonds pr√©-form√©s est fourni pour les t√¢ches li√©es √† la reconnaissance des formes;  cette collection s'appelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MobileNet</a> .  Les mod√®les MobileNet ont √©t√© sp√©cialement con√ßus pour un fonctionnement efficace dans des environnements avec une quantit√© limit√©e de ressources, tels que les appareils mobiles. <br><br>  TensorFlow.js <br><br>  Apr√®s Tensorflow Lite, TensorFlow.js a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">annonc√©</a> en mars 2018.  Cette version de la biblioth√®que est con√ßue pour fonctionner dans un navigateur et est bas√©e sur un projet ant√©rieur appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deeplearn.js</a> .  WebGL fournit un acc√®s GPU √† la biblioth√®que.  Les d√©veloppeurs utilisent l'API JavaScript pour former, charger et ex√©cuter des mod√®les. <br><br>  Plus tard, TensorFlow.js a √©t√© d√©velopp√© pour fonctionner avec Node.js, le <code>tfjs-node</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compl√©mentaire de biblioth√®que</a> <code>tfjs-node</code> est utilis√© √† cet effet. <br><br>  <b>Importez des mod√®les existants dans TensorFlow.js</b> <br><br>  Les mod√®les TensorFlow et Keras pr√™ts √† l'emploi peuvent √™tre ex√©cut√©s √† l'aide de la biblioth√®que TensorFlow.js.  Avant d'ex√©cuter le mod√®le, vous devez convertir un nouveau format √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cet outil</a> .  Des mod√®les pr√©-form√©s et transform√©s pour classer les images, d√©finir les poses et d√©tecter les k-voisins les plus proches <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sont disponibles sur Github</a> . <br><br>  <b>Utilisation de TensorFlow.js avec Node.js</b> <br><br>  Installer les biblioth√®ques TensorFlow <br><br>  TensorFlow.js peut √™tre install√© √† partir du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">registre NPM</a> . <br><br><ul><li>  <code>@tensorflow/tfjs</code> - <code>@tensorflow/tfjs</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Core TensorFlow.js</a> </li><li>  <code>@tensorflow/tfjs-node</code> - extension <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TensorFlow.js Node.js</a> </li><li>  <code>@tensorflow/tfjs-node-gpu</code> - <code>@tensorflow/tfjs-node-gpu</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TensorFlow.js Node.js avec support informatique GPU</a> </li></ul><br><pre> <code class="plaintext hljs">npm install @tensorflow/tfjs @tensorflow/tfjs-node // ... npm install @tensorflow/tfjs @tensorflow/tfjs-node-gpu</code> </pre> <br>  Les deux extensions pour Node.js utilisent des d√©pendances natives, qui seront compil√©es √† la demande. <br><br>  <b>T√©l√©charger les biblioth√®ques TensorFlow</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'API JavaScript</a> pour Tensorflow est fournie par la biblioth√®que principale.  Aucune API d'extension n'est fournie dans les modules d'extension qui prennent en charge Node.js. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tf = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@tensorflow/tfjs'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   ( CPU) require('@tensorflow/tfjs-node') //    ( GPU) require('@tensorflow/tfjs-node-gpu')</span></span></code> </pre> <br>  <b>T√©l√©charger les mod√®les TensorFlow</b> <br><br>  TensorFlow.js fournit une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que NPM</a> ( <code>tfjs-models</code> ) qui simplifie le chargement de <code>tfjs-models</code> pr√©-form√©s et transform√©s pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classer les images</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©finir les poses</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©tecter k voisins les plus proches</a> . <br><br>  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le de</a> classification d'images de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MobileNet</a> est un r√©seau neuronal profond form√© pour distinguer entre <a href="">1000 classes d'images diff√©rentes</a> . <br><br>  Dans le fichier README du projet, le code suivant est utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comme exemple</a> , utilis√© pour charger le mod√®le. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mobilenet <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@tensorflow-models/mobilenet'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   const model = await mobilenet.load();</span></span></code> </pre> <br>  L'un des premiers probl√®mes que j'ai rencontr√©s est que ce code ne fonctionne pas avec Node.js. <br><br><pre> <code class="plaintext hljs">Error: browserHTTPRequest is not supported outside the web browser.</code> </pre> <br>  Apr√®s avoir examin√© le <a href="">code source</a> , nous voyons que la biblioth√®que mobilenet est un wrapper pour la classe <code>tf.Model</code> .  Lorsqu'elle est appel√©e, la m√©thode <code>load()</code> t√©l√©charge automatiquement les fichiers de mod√®le n√©cessaires situ√©s √† une adresse HTTP externe et instancie le mod√®le TensorFlow. <br><br>  L'extension Node.js au moment de l'√©criture ne prenait pas encore en charge les requ√™tes HTTP pour la r√©cup√©ration de mod√®le dynamique.  Il ne restait plus qu'√† charger manuellement les mod√®les dans le syst√®me de fichiers. <br><br>  <i>Cependant, apr√®s avoir lu le code source de la biblioth√®que, j'ai trouv√© une solution de contournement ...</i> <br><br>  <b>T√©l√©chargement de mod√®les √† partir du syst√®me de fichiers</b> <br><br>  Si la classe MobileNet est cr√©√©e manuellement, vous ne pouvez pas appeler la m√©thode de <code>load</code> du module, mais r√©√©crire le <code>path</code> variable g√©n√©r√© automatiquement contenant l'adresse HTTP du mod√®le, en rempla√ßant cette adresse par le chemin local dans le syst√®me de fichiers.  Apr√®s cela, lorsque la m√©thode de <code>load</code> est appel√©e dans l'instance de classe, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la</a> classe du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chargeur de syst√®me de fichiers</a> se d√©clenche;  dans ce cas, nous refusons d'utiliser un t√©l√©chargeur HTTP bas√© sur un navigateur. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-string"><span class="hljs-string">"mobilenet/model.json"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mobilenet.MobileNet(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); mn.path = <span class="hljs-string"><span class="hljs-string">`file://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${path}</span></span></span><span class="hljs-string">`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> mn.load()</code> </pre> <br>  Cool, tout fonctionne! <br><br>  Mais d'o√π viennent les fichiers mod√®les? <br><br>  <b>Mod√®les MobileNet</b> <br><br>  Les mod√®les pour TensorFlow.js se composent de deux types de fichiers: un fichier de configuration de mod√®le stock√© au format JSON et des poids de mod√®le stock√©s au format binaire.  Les poids des mod√®les sont souvent fragment√©s en plusieurs parties pour optimiser la mise en cache du navigateur. <br><br>  Apr√®s avoir consid√©r√© le <a href="">code de t√©l√©chargement automatique</a> pour les mod√®les MobileNet, nous voyons que les mod√®les, leurs configurations et fragments de poids sont extraits du conteneur public √† l'adresse suivante. <br><br><pre> <code class="plaintext hljs">https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v${version}_${alpha}_${size}/</code> </pre> <br>  Les param√®tres de mod√®le dans l'URL d√©crivent les versions de mod√®le r√©pertori√©es <a href="">ici</a> .  La pr√©cision de classification r√©sultante est √©galement affich√©e sur la m√™me page. <br><br>  Le code source indique que seuls les mod√®les de MobileNet v1 peuvent √™tre t√©l√©charg√©s √† l'aide de la <code>tensorflow-models/mobilenet</code> . <br><br>  Le code d'extraction HTTP t√©l√©charge le fichier <code>model.json</code> √† partir de l'emplacement de stockage, puis s√©lectionne r√©cursivement tous les fragments de mod√®les avec des poids r√©f√©renc√©s.  Ce sont des fichiers au format <code>groupX-shard1of1</code> . <br><br>  <b>T√©l√©chargement manuel des mod√®les</b> <br><br>  Si vous souhaitez enregistrer tous les fichiers de mod√®le dans le syst√®me de fichiers, vous pouvez le faire: extraire le fichier de configuration de mod√®le, analyser la syntaxe de tous les fichiers pond√©r√©s r√©f√©renc√©s dans le fichier de configuration, puis t√©l√©charger manuellement chaque fichier pond√©r√©. <br>  <b>J'allais utiliser le module MobileNet V1 avec une valeur alpha de 1,0 et une image de 224 pixels</b> .  J'obtiens donc l' <a href="">URL suivante</a> pour le fichier de configuration du mod√®le. <br><br><pre> <code class="plaintext hljs">https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/model.json</code> </pre> <br>  Une fois ce fichier t√©l√©charg√© localement, vous pouvez utiliser l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">outil</a> <code>jq</code> pour analyser les noms de tous les fichiers pond√©r√©s. <br><br><pre> <code class="javascript hljs">$ cat model.json | jq -r <span class="hljs-string"><span class="hljs-string">".weightsManifest[].paths[0]"</span></span> group1-shard1of1 group2-shard1of1 group3-shard1of1 ...</code> </pre> <br>  √Ä l'aide de l'outil <code>sed</code> , vous pouvez pr√©fixer le nom de chaque √©l√©ment HTTP avec une URL pour g√©n√©rer une URL pour chaque fichier de poids. <br><br><pre> <code class="javascript hljs">$ cat model.json | jq -r <span class="hljs-string"><span class="hljs-string">".weightsManifest[].paths[0]"</span></span> | sed <span class="hljs-string"><span class="hljs-string">'s/^/https:\/\/storage.googleapis.com\/tfjs-models\/tfjs\/mobilenet_v1_1.0_224\//'</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/group1-shard1of1 https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/group2-shard1of1 https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_1.0_224/group3-shard1of1 ...</span></span></code> </pre><br>  Les commandes <code>parallel</code> et <code>curl</code> vous permettent ensuite de t√©l√©charger tous ces fichiers dans mon r√©pertoire local. <br><br><pre> <code class="plaintext hljs">cat model.json | jq -r ".weightsManifest[].paths[0]" | sed 's/^/https:\/\/storage.googleapis.com\/tfjs-models\/tfjs\/mobilenet_v1_1.0_224\//' | parallel curl -O</code> </pre> <br>  <b>Classification d'image</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cet exemple de code</a> fourni avec TensorFlow.js montre comment renvoyer le r√©sultat de la classification d'image. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> img = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'img'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   const predictions = await model.classify(img);</span></span></code> </pre> <br>  Cela ne fonctionne pas dans Node.js en raison du manque de prise en charge DOM. <br><br>  <a href="">La m√©thode</a> classify accepte divers √©l√©ments DOM ( <code>canvas</code> , <code>video</code> , <code>image</code> ) et extrait et convertit automatiquement les octets "image" de ces √©l√©ments en la classe <code>tf.Tensor3D</code> , utilis√©e comme entr√©e de mod√®le.  Alternativement, l' <code>tf.Tensor3D</code> peut √™tre transmise directement. <br><br>  <b>J'ai d√©cid√© de ne pas essayer d'utiliser un package externe pour simuler un √©l√©ment DOM manuellement, mais <code>tf.Tensor3D</code> trouv√© que <code>tf.Tensor3D</code> plus facile √† assembler manuellement</b> . <br><br>  <b>Nous g√©n√©rons Tensor3D √† partir de l'image</b> <br><br>  En lisant le <a href="">code source de la</a> m√©thode utilis√©e pour convertir les √©l√©ments DOM en classes Tensor3D, nous constatons que les param√®tres d'entr√©e suivants sont utilis√©s pour g√©n√©rer la classe Tensor3D. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int32Array</span></span>(image.height * image.width * numChannels); <span class="hljs-comment"><span class="hljs-comment">//     ,    const outShape = [image.height, image.width, numChannels]; const input = tf.tensor3d(values, outShape, 'int32');</span></span></code> </pre> <br>  <code>pixels</code> est un tableau bidimensionnel de type <code>(Int32Array)</code> contenant une liste s√©quentielle de valeurs de canal pour chaque pixel.  <code>numChannels</code> est le nombre de valeurs de canal par pixel. <br><br>  <b>Cr√©ation de valeurs d'entr√©e pour JPEG</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La biblioth√®que</a> <code>jpeg-js</code> est un encodeur / d√©codeur JPEG pour Node.js √©crit en JavaScript pur.  √Ä l'aide de cette biblioth√®que, vous pouvez extraire des valeurs RVB pour chaque pixel. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixels = jpeg.decode(buffer, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre> <br>  En cons√©quence, nous obtenons un Uint8Array avec quatre valeurs de canal ( <code>RGBA</code> ) pour chaque pixel ( <code>width * height</code> ).  Le mod√®le MobileNet n'utilise que trois canaux de couleur ( <code>RGB</code> ) pour la classification, le canal alpha est ignor√©.  Ce code convertit un tableau √† quatre canaux en une v√©ritable version √† trois canaux. <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> numChannels = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> numPixels = image.width * image.height; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int32Array</span></span>(numPixels * numChannels); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numPixels; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> channel = <span class="hljs-number"><span class="hljs-number">0</span></span>; channel &lt; numChannels; ++channel) { values[i * numChannels + channel] = pixels[i * <span class="hljs-number"><span class="hljs-number">4</span></span> + channel]; } }</code> </pre> <br>  <b>Exigences d'entr√©e pour les mod√®les MobileNet</b> <br><br>  Le <a href="">mod√®le MobileNet</a> utilis√© ici classe les images de 224 pixels de haut et de large.  Les tenseurs d'entr√©e doivent contenir des valeurs √† virgule flottante dans la plage de -1 √† 1 pour chacune des trois valeurs de canal de chaque pixel. <br><br>  Les valeurs d'entr√©e pour les images avec une dimension diff√©rente doivent √™tre converties √† la taille correcte avant la classification.  De plus, les valeurs de pixels obtenues √† partir du d√©codeur JPEG sont comprises entre 0 et 255, et non -1 et 1. Ces valeurs doivent √©galement √™tre converties avant la classification. <br><br>  TensorFlow.js dispose de m√©thodes de biblioth√®que pour simplifier ce processus, mais, mieux encore, il existe une <b><code>tfjs-models/mobilenet</code> sp√©ciale <code>tfjs-models/mobilenet</code> qui <a href="">r√©sout automatiquement ce probl√®me</a> !</b> <br><br>  Le d√©veloppeur peut transmettre des Tensor3D d'entr√©e de type <code>int32</code> , ainsi que diverses dimensions √† la m√©thode classify, qui traduit les valeurs d'entr√©e dans le format correct avant la classification.  Autrement dit, nous n'avons rien √† faire ici.  Super! <br><br>  <b>Obtenir des pr√©dictions</b> <br><br>  Les mod√®les MobileNet de Tensorflow apprennent √† reconna√Ætre les objets des <a href="">1000 classes les plus importantes</a> de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ensemble de</a> donn√©es d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ImageNet</a> .  En sortie du mod√®le, donner des valeurs probabilistes caract√©risant les chances de retrouver ces objets dans l'image class√©e. <br><br>  <i>Une liste compl√®te des classes form√©es pour le mod√®le utilis√© se trouve dans <a href="">ce fichier</a></i> . <br><br>  La <code>tfjs-models/mobilenet</code> propose la m√©thode <code>MobileNet</code> dans la classe <code>MobileNet</code> , qui renvoie le top-X des classes les plus probables, en fonction de ce qui est montr√© dans l'image. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> predictions = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> mn_model.classify(input, <span class="hljs-number"><span class="hljs-number">10</span></span>);</code> </pre> <br>  <code>predictions</code> est un tableau de classes X et de probabilit√©s au format suivant. <br><br><pre> <code class="javascript hljs"> { <span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">'panda'</span></span>, <span class="hljs-attr"><span class="hljs-attr">probability</span></span>: <span class="hljs-number"><span class="hljs-number">0.9993536472320557</span></span> }</code> </pre> <br>  <b>Exemple</b> <br><br>  Nous avons donc compris comment utiliser la biblioth√®que TensorFlow.js et les mod√®les MobileNet dans Node.js, et examinons maintenant comment ce script classe l'image sp√©cifi√©e comme argument de ligne de commande. <br><br>  <i>Code source</i> <br><br>  Enregistrez ce fichier de script et le descripteur de package dans des fichiers locaux. <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"tf-js"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"script.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"@tensorflow-models/mobilenet"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.2.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"@tensorflow/tfjs"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.12.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"@tensorflow/tfjs-node"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.1.9"</span></span>, <span class="hljs-string"><span class="hljs-string">"jpeg-js"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.3.4"</span></span> } }</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tf = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@tensorflow/tfjs'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mobilenet = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@tensorflow-models/mobilenet'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@tensorflow/tfjs-node'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jpeg = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jpeg-js'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> NUMBER_OF_CHANNELS = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> readImage = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buf = fs.readFileSync(path) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixels = jpeg.decode(buf, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pixels } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imageByteArray = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">image, numChannels</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pixels = image.data <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> numPixels = image.width * image.height; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int32Array</span></span>(numPixels * numChannels); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; numPixels; i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> channel = <span class="hljs-number"><span class="hljs-number">0</span></span>; channel &lt; numChannels; ++channel) { values[i * numChannels + channel] = pixels[i * <span class="hljs-number"><span class="hljs-number">4</span></span> + channel]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> values } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> imageToInput = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">image, numChannels</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> values = imageByteArray(image, numChannels) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> outShape = [image.height, image.width, numChannels]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> input = tf.tensor3d(values, outShape, <span class="hljs-string"><span class="hljs-string">'int32'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> loadModel = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> path =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mobilenet.MobileNet(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); mn.path = <span class="hljs-string"><span class="hljs-string">`file://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${path}</span></span></span><span class="hljs-string">`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> mn.load() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mn } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> classify = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (model, path) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> image = readImage(path) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> input = imageToInput(image, NUMBER_OF_CHANNELS) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mn_model = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> loadModel(model) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> predictions = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> mn_model.classify(input) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'classification results:'</span></span>, predictions) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process.argv.length !== <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'incorrect arguments: node script.js &lt;MODEL&gt; &lt;IMAGE_FILE&gt;'</span></span>) classify(process.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>], process.argv[<span class="hljs-number"><span class="hljs-number">3</span></span>])</code> </pre> <br>  <b>Test</b> <br><br>  T√©l√©chargez les fichiers de mod√®le dans le r√©pertoire mobilenet en suivant les instructions ci-dessus. <br>  D√©finir les d√©pendances du projet √† l'aide de NPM <br><br> <code>npm install</code> <br> <br>  T√©l√©charger un exemple de fichier JPEG pour la classification <br><br> <code>wget http://bit.ly/2JYSal9 -O panda.jpg</code> <br> <br><img src="https://habrastorage.org/webt/vt/sm/-2/vtsm-2o5y-t3vhqx5-qaomhxnfw.jpeg"><br><br>  Ex√©cutez le script, dont les arguments seront le fichier mod√®le et l'image d'entr√©e. <br><br> <code>node script.js mobilenet/model.json panda.jpg</code> <br> <br>  Si tout fonctionnait correctement, la sortie suivante devrait appara√Ætre dans la console. <br><br><pre> <code class="javascript hljs"> classification results: [ { <span class="hljs-attr"><span class="hljs-attr">className</span></span>: <span class="hljs-string"><span class="hljs-string">'giant panda, panda, panda bear, coon bear'</span></span>, <span class="hljs-attr"><span class="hljs-attr">probability</span></span>: <span class="hljs-number"><span class="hljs-number">0.9993536472320557</span></span> } ]</code> </pre> <br>  L'image est correctement class√©e comme contenant un panda avec une probabilit√© de 99,93%! <br><br>  <b>Conclusion</b> <br><br>  La biblioth√®que TensorFlow.js ouvre des opportunit√©s d'apprentissage approfondi aux d√©veloppeurs JavaScript.  L'utilisation de mod√®les pr√©-form√©s avec la biblioth√®que TensorFlow.js vous permet de cr√©er facilement dans les applications JavaScript de nouvelles fonctionnalit√©s pour r√©soudre des probl√®mes complexes d'apprentissage automatique, avec un minimum d'effort et un code concis. <br><br>  La biblioth√®que TensorFlow.js a √©t√© cr√©√©e uniquement pour fonctionner dans un navigateur, mais maintenant elle interagit avec Node.js, bien que tous les outils et utilitaires ne prennent pas en charge ce nouveau runtime.  Apr√®s avoir bricol√© la biblioth√®que pendant plusieurs jours, j'ai appris √† l'utiliser avec des mod√®les MobileNet pour la reconnaissance visuelle des images d'un fichier local. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432984/">https://habr.com/ru/post/fr432984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432972/index.html">Source: "Loi de Conway"</a></li>
<li><a href="../fr432976/index.html">P√®re No√´l anonyme 2018-2019: poste offrant des cadeaux du Nouvel An</a></li>
<li><a href="../fr432978/index.html">John Romero: R√©flexion DOOM</a></li>
<li><a href="../fr432980/index.html">VMware NSX pour les plus petits. Partie 1</a></li>
<li><a href="../fr432982/index.html">L'introduction la plus courte √† la cr√©ation de compilateurs</a></li>
<li><a href="../fr432986/index.html">Boucles C vs Go et math√©matiques simples</a></li>
<li><a href="../fr432988/index.html">Huiti√®me webmaster. En direct sur Habr√©</a></li>
<li><a href="../fr432990/index.html">Lampe en bois √† commande vocale Edison. Prix ‚Äã‚Äãd'√©mission 5 $</a></li>
<li><a href="../fr432992/index.html">Il a mis ses √©couteurs et est mort: nous parlons de la mort √©trange d'un √©colier √† Rimbau</a></li>
<li><a href="../fr432994/index.html">Vivaldi 2.2 - Conversion de quantit√© en qualit√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>