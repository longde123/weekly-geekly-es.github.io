<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêú ü§∑ üèÇ Construyendo un paquete de transporte sin instalar MODX üöÉ üë¥üèΩ ‚úåüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Escribir sus paquetes para MODX no es f√°cil para un principiante, y un desarrollador experimentado a veces se lo pasa en grande. Pero el principiante ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Construyendo un paquete de transporte sin instalar MODX</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439420/"><img src="https://habrastorage.org/webt/jv/hq/2n/jvhq2nbsj0ti2v8v_ucoyk_bwam.jpeg"><br><br>  Escribir sus paquetes para MODX no es f√°cil para un principiante, y un desarrollador experimentado a veces se lo pasa en grande.  Pero el principiante tiene miedo, y el experimentado entiende :). <br><br>  Esta publicaci√≥n habla sobre c√≥mo puede escribir y construir un paquete de componentes para MODX sin instalar y configurar MODX.  El nivel est√° por encima de la media, por lo que es posible que tengas que estrujarte el cerebro en algunos casos, pero vale la pena. <br><br>  Pido detalles bajo cat. <br><a name="habracut"></a><br>  Una vez, cuando apareci√≥ MODX Revolution, estaba en la versi√≥n beta temprana, los desarrolladores a√∫n no sab√≠an c√≥mo trabajar con √©l y c√≥mo escribir complementos para √©l.  Bueno, excepto por el equipo que estudi√≥ el CMS.  Y el equipo, debo decir, tuvo √©xito en parte y proporcion√≥ al sistema en s√≠ mismo para recopilar convenientemente paquetes que luego se pueden instalar a trav√©s del repositorio, lo que parece l√≥gico.  Pero desde entonces, han pasado muchos a√±os y los requisitos para los paquetes y su montaje han cambiado un poco. <br><br><h2>  Copiar y pegar es malo, aunque no siempre </h2><br>  En los √∫ltimos meses, me preguntaba por qu√©, para crear un paquete para MODX, debe instalarlo, crear una base de datos, crear un administrador, etc.  Tantas acciones extra.  No, no hay nada de malo en eso si lo configura una vez y luego lo usa.  Muchos lo hacen  Pero, ¬øqu√© pasa cuando quieres confiar la asamblea al gui√≥n e ir a tomar un caf√© t√∫ mismo? <br><br>  Sucedi√≥ que los creadores de MODX estaban acostumbrados a trabajar con MODX y agregaron clases al paquete directamente al kernel.  Tambi√©n escribieron los primeros componentes, los primeros scripts de compilaci√≥n, que luego fueron utilizados como ejemplos por otros desarrolladores que simplemente copiaron la soluci√≥n, no siempre profundizando en la esencia de lo que estaba sucediendo.  Y lo hice <br><br>  Pero la tarea es automatizar el ensamblaje del paquete, preferiblemente en el servidor, siempre con un conjunto m√≠nimo de software requerido, con recursos m√≠nimos y, por lo tanto, con mayor velocidad.  La tarea se estableci√≥ y despu√©s de estudiar la fuente, Jason fren√≥ en el chat y encontr√≥ una soluci√≥n. <br><br><h2>  Y cual? </h2><br>  Lo primero que descubr√≠ es que el c√≥digo responsable de compilar el paquete se encuentra directamente en la biblioteca xPDO, y en MODX solo hay clases de contenedor que proporcionan una API m√°s conveniente y son algo m√°s f√°ciles de trabajar, pero solo si MODX est√° instalado.  Por lo tanto, probablemente solo se pueda usar xPDO de alguna manera, pero en el c√≥digo el constructor del objeto xPDO requiere especificar datos para la conexi√≥n de la base de datos. <br><br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $dsn, $username = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $password = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $options = [], $driverOptions= null )</span></span></span></span>;</code> </pre> <br>  Despu√©s de interrogar a Jason, qued√≥ claro que, aunque los par√°metros deben establecerse, la conexi√≥n f√≠sica real a la base de datos se produce exactamente en el momento en que es necesario.  Carga perezosa en todo su esplendor.  El segundo problema ha sido resuelto. <br><br>  El tercer problema fue el problema de conectar xPDO al proyecto.  Composer me vino a la mente de inmediato, pero la versi√≥n 2.x en la que se ejecuta el MODX actual no es compatible con Composer, y la rama 3.x usa espacios de nombres y los nombres de clase se escriben de manera diferente que en 2.x, lo que genera conflictos y errores.  En general, incompatible.  Luego tuve que usar herramientas git y conectar xPDO como un subm√≥dulo. <br><blockquote><h4>  C√≥mo usar subm√≥dulos </h4><br><br>  Primero, lea la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> sobre ellos. <br><br>  Luego, si este es un proyecto nuevo, debe agregar un subm√≥dulo: <br><br><pre> <code class="plaintext hljs">$ git submodule add https://github.com/username/reponame</code> </pre> <br>  Este comando clonar√° e instalar√° un subm√≥dulo en su proyecto.  Luego, deber√° agregar la carpeta de subm√≥dulos a su repositorio con el comando git add.  No agregar√° toda la carpeta con el subm√≥dulo, pero agregar√° a git solo un enlace al √∫ltimo commit desde el subm√≥dulo. <br><br>  Para que otro desarrollador pueda clonar el proyecto con todas las dependencias, debe crear una configuraci√≥n .gitmodules para subm√≥dulos.  En el proyecto Slackify, es as√≠: <br><br><pre> <code class="plaintext hljs">[submodule "_build/xpdo"] path = _build/xpdo url = https://github.com/modxcms/xpdo.git branch = 2.x</code> </pre><br>  Despu√©s de eso, al clonar, solo especifique el indicador recursivo y git descargar√° todos los repositorios dependientes. </blockquote>  Como resultado, tenemos xPDO, xPDO se puede usar sin conectarse a la base de datos, si no es necesario, xPDO se puede conectar al c√≥digo del componente como una dependencia externa (subm√≥dulo git).  Ahora la implementaci√≥n del script de compilaci√≥n. <br><br><h2>  Entendamos </h2><br>  Describir√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">script de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">compilaci√≥n del</a> complemento <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Slackify</a> publicado recientemente por m√≠.  Este componente es gratuito y est√° disponible p√∫blicamente en GitHub, lo que facilitar√° el autoestudio. <br><br><h3>  Conectar xPDO </h3><br>  Omitimos la tarea de constantes con el nombre del paquete y otras llamadas necesarias y conectamos xPDO. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'xpdo/xpdo/xpdo.class.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'xpdo/xpdo/transport/xpdotransport.class.php'</span></span>; $xpdo = xPDO::getInstance(<span class="hljs-string"><span class="hljs-string">'db'</span></span>, [ xPDO::OPT_CACHE_PATH =&gt; <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../cache/'</span></span>, xPDO::OPT_HYDRATE_FIELDS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDO::OPT_HYDRATE_RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDO::OPT_HYDRATE_ADHOC_FIELDS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDO::OPT_CONNECTIONS =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'dsn'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=xpdotest;charset=utf8'</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; [xPDO::OPT_CONN_MUTABLE =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>], <span class="hljs-string"><span class="hljs-string">'driverOptions'</span></span> =&gt; [], ] ] ]);</code> </pre> <br>  Agregu√© el subm√≥dulo xPDO a la carpeta _build, que solo necesitamos en la etapa de desarrollo y ensamblaje del paquete y que no entrar√° en el archivo principal del componente.  La segunda copia de xPDO en el sitio con Live MODX no la necesitamos. <br><br>  En la configuraci√≥n de conexi√≥n xPDO, configuro el nombre de la base de datos en <code>dsn</code> , pero no juega ning√∫n papel.  Es importante que la carpeta de cach√© dentro de xPDO sea grabable.  Eso es todo, xPDO se inicializa. <br><br><h3>  Haciendo un truco complicado con clases </h3><br>  Al usar el MODX instalado al crear el paquete, todo es simple, tomamos y creamos un objeto de la clase que necesitamos.  MODX realmente encuentra la clase requerida, encuentra la implementaci√≥n necesaria para esta clase (la clase con el postfix _mysql), que depende de la base de datos y luego crea el objeto deseado (debido a esta caracter√≠stica, puede obtener errores al construir el paquete que la clase * _mysql no encontrado, esto no da miedo).  Sin embargo, no tenemos una base ni una implementaci√≥n.  Necesitamos reemplazar de alguna manera la clase deseada, que estamos haciendo. <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modNamespace</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xPDOObject</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modSystemSetting</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xPDOObject</span></span></span><span class="hljs-class"> </span></span>{}</code> </pre> <br>  Creamos una clase ficticia (stub), que es necesaria para crear el objeto deseado.  Esto no deber√≠a hacerse si xPDO no verifica espec√≠ficamente a qu√© clase pertenece el objeto.  Pero √©l lo comprueba. <br><br>  Pero hay casos especiales en los que necesita hacer un poco m√°s que solo definir una clase.  Estos son casos de dependencias entre clases.  Por ejemplo, necesitamos agregar un complemento a la categor√≠a.  En el c√≥digo, solo <code>$category-&gt;addOne($plugin);</code>  pero en nuestro caso esto no funcionar√°. <br><br>  Si alguna vez examin√≥ <a href="">el esquema de base de datos MODX</a> , probablemente vio elementos como agregado y compuesto.  Est√° escrito sobre ellos en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> , pero si de una manera simple, describen la relaci√≥n entre clases. <br><br>  En nuestro caso, puede haber varios complementos en una categor√≠a, de los cuales el elemento agregado es responsable de la clase <code>modCategory</code> .  Por lo tanto, dado que tenemos una clase sin una implementaci√≥n concreta, debemos indicar esta conexi√≥n a mano.  Es m√°s f√°cil hacer esto anulando el m√©todo <code>getFKDefinition</code> : <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">modCategory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">xPDOObject</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getFKDefinition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($alias)</span></span></span><span class="hljs-function"> </span></span>{ $aggregates = [ <span class="hljs-string"><span class="hljs-string">'Plugins'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modPlugin'</span></span>, <span class="hljs-string"><span class="hljs-string">'local'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'foreign'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'category'</span></span>, <span class="hljs-string"><span class="hljs-string">'cardinality'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'many'</span></span>, <span class="hljs-string"><span class="hljs-string">'owner'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'local'</span></span>, ] ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($aggregates[$alias]) ? $aggregates[$alias] : []; } }</code> </pre> <br>  En nuestro componente, solo se usan complementos, por lo que agregamos enlaces solo para ellos.  Despu√©s de eso, el m√©todo addMany de la clase modCategory puede agregar f√°cilmente los complementos necesarios a la categor√≠a y luego al paquete. <br><br><h3>  Crea un paquete </h3><br><pre> <code class="php hljs">$package = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> xPDOTransport($xpdo, $signature, $directory);</code> </pre> <br>  Como puede ver, todo es muy, muy simple.  Aqu√≠ necesit√°bamos pasar el par√°metro <code>$xpdo</code> , que inicializamos al principio.  Si no fuera por este momento, no habr√≠a problema 2.  <code>$signature</code> - el nombre del paquete, incluida la versi√≥n, <code>$directory</code> - el lugar donde el paquete se colocar√° cuidadosamente.  De d√≥nde provienen estas variables, compru√©belo usted mismo en la fuente. <br><br><h3>  Cree un espacio de nombres y agr√©guelo al paquete </h3><br>  Necesitamos un espacio de nombres para vincular l√©xicos y configuraciones del sistema.  En nuestro caso, solo por esto, otros a√∫n no se consideran. <br><br><pre> <code class="php hljs">$namespace = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> modNamespace($xpdo); $namespace-&gt;fromArray([ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'path'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'{core_path}components/'</span></span> . PKG_NAME_LOWER . <span class="hljs-string"><span class="hljs-string">'/'</span></span>, ]); $package-&gt;put($namespace, [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RESOLVE_FILES =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RESOLVE_PHP =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::NATIVE_KEY =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'namespace'</span></span> =&gt; PKG_NAME_LOWER, <span class="hljs-string"><span class="hljs-string">'package'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modx'</span></span>, <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'validate'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ]);</code> </pre> <br>  La primera parte es clara para cualquiera que haya escrito c√≥digo para MODX.  El segundo, con la adici√≥n al paquete, es un poco m√°s complicado.  El m√©todo <code>put</code> toma 2 par√°metros: el objeto en s√≠ y una matriz de par√°metros que describen este objeto y su posible comportamiento al momento de instalar el paquete.  Por ejemplo, <code>xPDOTransport::UNIQUE_KEY =&gt; 'name'</code> significa que el campo de <code>name</code> con el nombre del propio espacio de nombres como valor se usar√° para el espacio de nombres como una clave √∫nica en la base de datos.  Puede leer m√°s sobre los par√°metros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la documentaci√≥n de xPDO</a> , y mejor estudiando el c√≥digo fuente. <br><br>  Del mismo modo, puede agregar otros objetos, como la configuraci√≥n del sistema. <br><br><pre> <code class="php hljs">$package-&gt;put($setting, [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'key'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modSystemSetting'</span></span>, <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'validate'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-string"><span class="hljs-string">'package'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modx'</span></span>, ]);</code> </pre> <br><h3>  Crea una categor√≠a </h3><br>  Con la adici√≥n de una categor√≠a, tuve la mayor mordaza cuando lo descubr√≠ todo.  Los elementos puestos en una categor√≠a en el modelo xPDO deben pertenecer a esta categor√≠a, es decir.  estar anidado en √©l, y solo entonces la categor√≠a en s√≠ debe estar anidada en el paquete.  Y al mismo tiempo, debe tener en cuenta las relaciones entre las clases, que ya he descrito anteriormente.  Tom√≥ bastante tiempo entenderlo, darse cuenta y aplicarlo correctamente. <br><br><pre> <code class="php hljs">$package-&gt;put($category, [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'category'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::ABORT_INSTALL_ON_VEHICLE_FAIL =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::RELATED_OBJECT_ATTRIBUTES =&gt; [ <span class="hljs-string"><span class="hljs-string">'Plugins'</span></span> =&gt; [ xPDOTransport::UNIQUE_KEY =&gt; <span class="hljs-string"><span class="hljs-string">'name'</span></span>, xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ], <span class="hljs-string"><span class="hljs-string">'PluginEvents'</span></span> =&gt; [ xPDOTransport::UNIQUE_KEY =&gt; [<span class="hljs-string"><span class="hljs-string">'pluginid'</span></span>, <span class="hljs-string"><span class="hljs-string">'event'</span></span>], xPDOTransport::PRESERVE_KEYS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, xPDOTransport::UPDATE_OBJECT =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, xPDOTransport::RELATED_OBJECTS =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ] ], xPDOTransport::NATIVE_KEY =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'package'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'modx'</span></span>, <span class="hljs-string"><span class="hljs-string">'validate'</span></span> =&gt; $validators, <span class="hljs-string"><span class="hljs-string">'resolve'</span></span> =&gt; $resolvers ]);</code> </pre> <br>  Parece monstruoso, pero no tan visto.  Un par√°metro importante es <code>xPDOTransport::RELATED_OBJECTS =&gt; true</code> , que indica que la categor√≠a tiene elementos anidados que tambi√©n deben empaquetarse y luego instalarse. <br><br>  Dado que la mayor√≠a de los m√≥dulos contienen varios elementos (fragmentos, fragmentos, complementos), la categor√≠a con elementos es la pieza m√°s importante del paquete de transporte.  Por lo tanto, es aqu√≠ donde se especifican los validadores y los solucionadores, que se realizan durante la instalaci√≥n del paquete. <br><blockquote>  Los validadores se realizan antes de la instalaci√≥n, los solucionadores, despu√©s. </blockquote><br>  Casi se me olvida, antes de empacar la categor√≠a, necesitamos agregarle nuestros elementos.  As√≠: <br><br><pre> <code class="php hljs">$plugins = <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> $sources[<span class="hljs-string"><span class="hljs-string">'data'</span></span>] . <span class="hljs-string"><span class="hljs-string">'transport.plugins.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($plugins)) { $category-&gt;addMany($plugins, <span class="hljs-string"><span class="hljs-string">'Plugins'</span></span>); }</code> </pre> <br><h3>  Agregue otros datos al paquete. </h3><br>  En el paquete, debe agregar otro archivo con una licencia, un archivo con un registro de cambios y un archivo con una descripci√≥n del componente.  Si es necesario, puede agregar otro script especial a trav√©s del atributo <code>setup-options</code> , que mostrar√° la ventana antes de instalar el paquete.  Esto es cuando en lugar de "Instalar" el bot√≥n "Opciones de instalaci√≥n".  Y a partir de la versi√≥n de MODX 2.4 se hizo posible especificar dependencias entre paquetes usando el atributo <code>requires</code> , y en √©l tambi√©n se puede especificar la versi√≥n de PHP y MODX. <br><br><pre> <code class="php hljs">$package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'changelog'</span></span>, file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'changelog.txt'</span></span>)); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'license'</span></span>, file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'license.txt'</span></span>)); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'readme'</span></span>, file_get_contents($sources[<span class="hljs-string"><span class="hljs-string">'docs'</span></span>] . <span class="hljs-string"><span class="hljs-string">'readme.txt'</span></span>)); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'requires'</span></span>, [<span class="hljs-string"><span class="hljs-string">'php'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'&gt;=5.4'</span></span>]); $package-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'setup-options'</span></span>, [<span class="hljs-string"><span class="hljs-string">'source'</span></span> =&gt; $sources[<span class="hljs-string"><span class="hljs-string">'build'</span></span>] . <span class="hljs-string"><span class="hljs-string">'setup.options.php'</span></span>]);</code> </pre> <br><h3>  Empacamos </h3><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($package-&gt;pack()) { $xpdo-&gt;log(xPDO::LOG_LEVEL_INFO, <span class="hljs-string"><span class="hljs-string">"Package built"</span></span>); }</code> </pre> <br>  Eso es todo, recoja el paquete terminado en <code>_packages</code> , bien, o desde donde configur√≥ el ensamblaje. <br><br><h2>  Cual es el resultado? </h2><br>  El resultado super√≥ mis expectativas, ya que este enfoque, aunque impone algunas limitaciones y en algunos lugares agrega algunos inconvenientes, pero gana en t√©rminos de posibilidades de aplicaci√≥n. <br><br>  Para construir el paquete, solo ejecute 2 comandos: <br><br><pre> <code class="plaintext hljs">git clone --recursive git@github.com:Alroniks/modx-slackify.git cd modx-slackify/_build &amp;&amp; php build.transport.php</code> </pre> <br>  El primero es la clonaci√≥n del repositorio y sus subm√≥dulos.  Un par√°metro importante es <code>--recursive</code> , gracias a √©l git descargar√° e instalar√°, adem√°s del c√≥digo del componente en s√≠, todas las dependencias descritas como subm√≥dulos. <br><br>  El segundo es construir el paquete directamente.  Despu√©s de eso, puede recoger el <code>package-1.0.0-pl.transport.zip</code> terminado <code>_packages</code> carpeta <code>_packages</code> y cargarlo, por ejemplo, en el repositorio. <br><br>  Las perspectivas son amplias.  Por ejemplo, puede configurar un enlace en GitHub que, despu√©s de comprometerse con una rama, ejecutar√° un script en su servidor que recopilar√° el paquete y lo colocar√° en todos los sitios que tenga.  O suba la nueva versi√≥n a alg√∫n repositorio, y en ese momento preparar√° caf√© para usted, como dije al principio.  O puede crear y escribir pruebas para el m√≥dulo y ejecutar la ejecuci√≥n de prueba y construir a trav√©s de Jenkins o Travis.  S√≠, un mont√≥n de escenarios que se te pueden ocurrir.  Con este enfoque, hacer esto ahora es mucho m√°s f√°cil. <br><br>  Haga preguntas, intente responder. <br><br>  PD: No pases, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pon una estrella de Slackify en GitHub</a> , por favor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439420/">https://habr.com/ru/post/439420/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439408/index.html">Pseudo destello de lente</a></li>
<li><a href="../439410/index.html">Jeff Hawkins finalmente est√° listo para explicar su investigaci√≥n cerebral</a></li>
<li><a href="../439414/index.html">Cliente para "Servidor de mensajes push"</a></li>
<li><a href="../439416/index.html">Art√≠culo de revisi√≥n del marco A</a></li>
<li><a href="../439418/index.html">Pentaho Data Integration (PDI), Python y Deep Learning</a></li>
<li><a href="../439422/index.html">¬øQu√© necesita un programador para desarrollar juegos y qui√©n es un desarrollador de juegos de un programador?</a></li>
<li><a href="../439424/index.html">C√≥mo luch√© con el alojamiento gratuito y el compositor</a></li>
<li><a href="../439426/index.html">Situaci√≥n: una nueva ola de ataques con la intercepci√≥n de consultas DNS: analizamos los m√©todos b√°sicos de protecci√≥n</a></li>
<li><a href="../439428/index.html">¬øC√≥mo prevenir los ataques cibern√©ticos dirigidos? 10 mejores entornos limitados de red</a></li>
<li><a href="../439430/index.html">Cr√©eme si puedes. Medidores de agua. parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>