<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>„äôÔ∏è ‚è∫Ô∏è ü¶á Sinopse do relat√≥rio ‚ÄúMon√≥lito para centenas de vers√µes de clientes‚Äù (HL2018, Badoo, Vladimir Yants) ü¶ó üò∂ üßëüèæ‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuando uma s√©rie de resumos com o HL2018. Os caras do Badoo (Vladimir Yants vyants e Nikolai Krapivny) me ajudaram a conferir este comp√™ndio , pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sinopse do relat√≥rio ‚ÄúMon√≥lito para centenas de vers√µes de clientes‚Äù (HL2018, Badoo, Vladimir Yants)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429776/">  Continuando uma s√©rie de resumos com o HL2018.  Os caras do Badoo (Vladimir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">Yants vyants</a> e Nikolai Krapivny) me ajudaram a conferir este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">comp√™ndio</a> , pelo qual muito obrigado a eles.  Espero que isso tenha um efeito positivo na qualidade da mensagem do relat√≥rio. <br><br><img src="https://habrastorage.org/webt/8w/zh/nr/8wzhnrc5cvcugbedz9xrxkx8jm8.jpeg" alt="imagem"><br><a name="habracut"></a><br><h3>  Recursos do processo de desenvolvimento: </h3><br>  A responsabilidade do desenvolvedor n√£o termina com o lan√ßamento do back-end.  Ele √© respons√°vel antes da implementa√ß√£o nas plataformas. <br><br><img src="https://habrastorage.org/webt/je/gx/03/jegx038nczykw6kld4fu1ynaalq.jpeg" alt="imagem"><br><br>  H√° testes manuais, mas o cliente n√£o est√° pronto no momento do lan√ßamento e √© lan√ßado com um atraso (imprevis√≠vel).  Geralmente, n√£o sabemos quando os clientes come√ßar√£o a implement√°-lo.  √Äs vezes (n√£o frequentemente) os recursos come√ßam a ser executados ap√≥s um longo per√≠odo de tempo.  Portanto, testar com as m√£os √© dif√≠cil e nem tudo √© poss√≠vel.  Portanto, s√£o necess√°rios autotestes. <br><br><h2>  Testes </h2><br><h3>  Testes unit√°rios </h3><br>  Escrito em phpunit. <br><br>  Teste uma pequena unidade.  Eles n√£o v√£o ao banco de dados ou aos servi√ßos (eles n√£o devem interagir com nada). <br><br>  O legado ainda tem e complica o processo de teste. <br><br>  Eles desenvolveram a biblioteca softMocks - todos os ganchos incluem / exigem e a substituem pela que foi alterada. <br><br>  Voc√™ pode encerrar qualquer m√©todo: est√°tico, privado, final. <br>  A biblioteca est√° dispon√≠vel em c√≥digo aberto. <br><br>  Problema: os softmocks relaxam e permitem escrever c√≥digo n√£o testado (e cobri-lo com testes). <br><br>  Aceitou as regras: <br><br><ul><li>  O novo c√≥digo deve ser f√°cil de testar o phpunit </li><li>  SoftMocks - caso extremo (c√≥digo antigo / longo / caro / complicado) </li></ul><br>  Observamos a revis√£o do c√≥digo para essas regras. <br><br><h2>  Qualidade de teste </h2><br><h3>  Teste de muta√ß√£o </h3><br><ul><li>  Pegue o c√≥digo </li><li>  Obter cobertura de c√≥digo </li><li>  Analisamos o c√≥digo e aplicamos muta√ß√µes (altera√ß√£o + =&gt; -; true =&gt; false, etc.) </li><li>  Para cada muta√ß√£o, executamos um conjunto (conjunto) de testes. </li><li>  Se os testes falharem, aprox.  Caso contr√°rio, eles n√£o s√£o eficazes o suficiente.  Entendemos, alteramos / adicionamos testes. </li></ul><br>  Existem solu√ß√µes prontas (Farsa, Infec√ß√£o), mas elas n√£o se encaixam (n√£o s√£o compat√≠veis com softmocks, h√° dificuldades com a cobertura do c√≥digo).  Portanto, eles escreveram os seus pr√≥prios. <br><br>  O teste de muta√ß√£o ainda n√£o est√° dispon√≠vel para teste manual.  Dispon√≠vel para execu√ß√£o manual, no console.  Agora estamos implementando-o no pipeline de IC, estamos construindo o processo.  O resultado ser√° para Habr. <br><br><h3>  Testes de integra√ß√£o </h3><br>  Testando a opera√ß√£o de v√°rios componentes em conjunto;  Verificamos o trabalho com a base e / ou servi√ßos. <br><br>  Abordagem padr√£o para teste de banco de dados (DBUnit): <br><br><ol><li>  Aumente o banco de dados de teste </li><li>  Preencha </li><li>  Execute o teste </li><li>  Limpamos o banco de dados </li></ol><br>  Os problemas: <br><br><ul><li>  √â necess√°rio suportar tabelas de dados e conjunto de dados (relev√¢ncia do conte√∫do do banco de dados) </li><li>  Leva tempo para preparar o banco de dados </li><li>  Lan√ßamentos paralelos tornam os testes inst√°veis ‚Äã‚Äãe causam impasses </li></ul><br>  Solu√ß√£o: biblioteca DBMocks (solu√ß√£o pr√≥pria) <br><br>  Princ√≠pio de funcionamento: <br><br><ul><li>  M√©todos de driver de banco de dados interceptados usando SoftMocks no teste de configura√ß√£o </li><li>  A partir da solicita√ß√£o parsim db + table </li><li>  Tmpfs cria tabelas tempor√°rias com o mesmo esquema </li><li>  Todas as consultas v√£o apenas para tabelas tempor√°rias </li><li>  No TearDown, eles s√£o exclu√≠dos </li></ul><br>  A biblioteca √© pequena, mas ainda n√£o est√° aberta em c√≥digo aberto. <br><br>  Resultados: <br><br><ul><li>  Os testes n√£o podem corromper dados nas tabelas originais </li><li>  Os testes s√£o isolados um do outro (podem ser executados em paralelo) </li><li>  Testando a compatibilidade de consultas com a vers√£o MySQL </li></ul><br><h3>  Testes de API </h3><br><ul><li>  Imitar uma sess√£o do cliente </li><li>  Capaz de enviar solicita√ß√µes de back-end </li><li>  O back-end responde quase como um cliente real </li></ul><br>  Normalmente, esses testes requerem um usu√°rio autorizado.  Ele deve ser criado antes do teste e exclu√≠do depois.  Isso apresenta riscos adicionais (replica√ß√£o, tarefas em segundo plano). <br><br>  Solu√ß√£o: fizemos um pool de usu√°rios de teste.  Aprendeu como limp√°-los. <br><br><img src="https://habrastorage.org/webt/yh/ny/jk/yhnyjk6mfogisbdjyro_g-egtwm.jpeg" alt="imagem"><br><br>  Os usu√°rios de teste est√£o no mesmo ambiente que os reais, porque desenvolvem! = Prod.  √â necess√°rio isolar usu√°rios ativos e de teste. <br><br>  Para isolamento, o sinalizador is_test_user foi adicionado ao usu√°rio.  E esses usu√°rios tamb√©m s√£o exclu√≠dos da an√°lise e dos resultados do teste a / b. <br><br>  Pode ser mais barato enviando usu√°rios de teste "para a Ant√°rtica", onde ningu√©m os ver√° (exceto pinguins). <br><br><h3>  API de controle de qualidade </h3><br>  Uma ferramenta para preparar o ambiente em testes de API, de fato um backdoor no back-end para alterar rapidamente as configura√ß√µes do usu√°rio / ambiente. <br><br><ul><li>  M√©todos api bem documentados </li><li>  Gerencie dados de maneira r√°pida e f√°cil. </li><li>  Desenvolvedores escrevem back-end </li><li>  S√≥ pode ser aplicado para testar usu√°rios. </li></ul><br>  Permite ao usu√°rio alterar dados imut√°veis ‚Äã‚Äã(por exemplo, data do registro). <br><br>  Prote√ß√£o necess√°ria: <br><br><ul><li>  No n√≠vel da rede (dispon√≠vel apenas na rede do escrit√≥rio) </li><li>  Um segredo √© passado com cada solicita√ß√£o, cuja validade √© verificada </li><li>  Os m√©todos funcionam apenas com usu√°rios de teste. </li></ul><br>  Existe um programa BugsBounty no HackerOne.  Eles pagam pelas vulnerabilidades encontradas.  Foi poss√≠vel encontrar um problema com a API do controle de qualidade. <br><br><h3>  Zombarias remotas </h3><br>  Moki para o back-end remoto. <br><br>  Trabalhe na base de zombarias macias.  O teste solicita que o back-end seja inicializado para a sess√£o simulada.  Ap√≥s o recebimento da solicita√ß√£o, o back-end verifica a lista de mox da sess√£o e as aplica usando o SoftMocks. <br><br>  Exemplo de teste: <br><br><img src="https://habrastorage.org/webt/gh/uk/7y/ghuk7yxvowxd5x3gqxald-3wrnm.jpeg" alt="imagem"><br><br>  Os testes de API s√£o muito convenientes.  √â tentador escrev√™-los em vez de Unit.  Mas os testes de API s√£o muito mais lentos. <br><br>  Adotou um conjunto de regras: <br><br><ul><li>  O objetivo dos testes de API √© testar o protocolo e a integra√ß√£o </li><li>  Fluxo complexo de verifica√ß√£o v√°lido </li><li>  Pequena variabilidade n√£o pode ser testada. </li><li>  Na revis√£o de c√≥digo, tamb√©m testamos os testes. </li></ul><br><h3>  Testes de interface do usu√°rio </h3><br>  O comando de back-end n√£o escreve. <br><br>  O recurso √© coberto pelos testes de interface do usu√°rio quando ele se estabiliza. <br>  Usado pelo sel√™nio para a web.  Para caba√ßa m√≥vel. <br><br><h2>  Execu√ß√£o de teste </h2><br>  100.000 testes de unidade.  6.000 integra√ß√£o, 14.000 testes de API. <br>  Em um fluxo, o tempo √© de 40 min / 90 min / 10 horas. <br><br>  Feito TestCloud - uma nuvem para executar testes. <br><br><img src="https://habrastorage.org/webt/lh/bn/yx/lhbnyxws1gdtptpwew0rnwwk58i.jpeg" alt="imagem"><br><br>  A distribui√ß√£o do teste entre os threads: <br><br><ul><li>  Voc√™ pode igualmente (mal, todos os testes s√£o diferentes, resultam desiguais em partes do tempo) </li><li>  Execute v√°rios threads e teste de phpunit de feed um de cada vez (sobrecarga de inicializa√ß√£o. Long!) </li></ul><br>  Solu√ß√£o: <br><br><ul><li>  Cole√ß√£o de estat√≠sticas sobre o tempo de execu√ß√£o. </li><li>  Layout dos testes para que o bloco n√£o execute mais de 30 segundos </li></ul><br>  O problema com os testes da API √© muito tempo, muitos recursos e n√£o permite a execu√ß√£o de outros. <br><br>  Para resolver, dividimos a nuvem em 2 partes: <br><br><ol><li>  Executa apenas testes r√°pidos. </li><li>  Executa os dois tipos de testes. </li></ol><br>  O resultado √© uma acelera√ß√£o do tempo para: <br><br><ul><li>  Unidade - 1 min </li><li>  Integra√ß√£o - 5 min </li><li>  API - 15 minutos. </li></ul><br><h2>  Execu√ß√£o de cobertura de c√≥digo </h2><br>  Quais testes executar?  Mostrar√° a cobertura do c√≥digo. <br><br><ol><li>  Temos diff diff </li><li>  Crie uma lista de arquivos modificados </li><li>  Obtenha uma lista de testes para esses arquivos. </li><li>  n√≥s executamos a su√≠te apenas nesses testes. </li></ol><br>  A cobertura √© formada uma vez por dia, √† noite, para o ramo principal.  Os resultados (diff) s√£o adicionados ao banco de dados. <br><br>  Pr√≥s: <br><br><ul><li>  Executamos menos testes: menos carga de hardware e feedback de teste mais r√°pido </li><li>  Voc√™ pode executar testes para corre√ß√µes.  Isso permite que voc√™ implante rapidamente o hotfix.  Nos patches, a velocidade √© mais importante. </li></ul><br>  Contras: <br><br><ul><li>  Libera√ß√£o de back-end 2 vezes ao dia.  Ap√≥s o almo√ßo, a cobertura √© menos relevante (mas ao lan√ßar uma batida, sempre conduzimos um conjunto completo). </li><li>  Os testes de API geram uma cobertura abrangente.  Para eles, essa abordagem n√£o oferece muita economia. </li></ul><br>  Se o desenvolvedor precisar ver imediatamente a cobertura do c√≥digo, ou seja, uma ferramenta que pode ser iniciada no console e obter imediatamente uma nova m√©trica para a cobertura de um arquivo / componente espec√≠fico. <br>  √â considerado complicado: os dados no mestre de cobertura s√£o coletados, todos os testes modificados s√£o adicionados, resultando em um pequeno conjunto no qual a cobertura j√° √© considerada. <br><br><h2>  Sum√°rio </h2><br><ul><li>  Precisa de todos os n√≠veis de teste </li><li>  Quantidade! = Qualidade.  Revis√£o de c√≥digo e teste de muta√ß√£o </li><li>  Isole os usu√°rios de teste dos reais. </li><li>  Os back-end no back-end simplificam e agilizam os testes de grava√ß√£o </li><li>  Colete estat√≠sticas sobre testes. </li></ul><br><h2>  Refer√™ncias </h2><br><ul><li>  Slides: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bit.ly/yants-HL18</a> </li><li>  Nosso protocolo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúComo suportamos 100 vers√µes diferentes de clientes no Badoo‚Äù / Yaroslav Golub</a> </li><li>  SoftMocks: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúSoftMocks: nosso runkit de substitui√ß√£o para o PHP 7‚Äù / Yuri Nasretdinov</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github.com/badoo/soft-mocks</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Badoo bugsbounty</a> </li><li>  Testes de interface do usu√°rio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚ÄúAutoma√ß√£o de teste m√≥vel entre plataformas e entrega cont√≠nua‚Äù / Sathish Gogineni</a> </li><li>  TestCloud: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚Äú</a> Paraleliza√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ideal de testes unit√°rios ou 17000 testes em 4 minutos‚Äù / Ilya Kudinov</a> </li><li>  QAAPI: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Uma olhada nos testes do outro lado das barricadas.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/ Relat√≥rio de Dmitry Marushchenko no LoveQA</a> </li><li>  Back-end: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Badoo.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tudo sobre o back-end de aplicativos m√≥veis do Badoo</a> / Nikolay Krapivny </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt429776/">https://habr.com/ru/post/pt429776/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt429766/index.html">Dino Esposito, guru do .NET: "N√£o seja passageiro de um trem que est√° descendo a colina"</a></li>
<li><a href="../pt429768/index.html">"DNS sobre HTTPS" √© emitido na RFC 8484 - mas nem todos est√£o satisfeitos com isso</a></li>
<li><a href="../pt429770/index.html">Como a prolifera√ß√£o de dispositivos da Internet est√° mudando os h√°bitos de pagamento</a></li>
<li><a href="../pt429772/index.html">Distribuir e conquistar: ferramentas para criar e testar boletins</a></li>
<li><a href="../pt429774/index.html">Crie sua pr√≥pria paleta de cores</a></li>
<li><a href="../pt429778/index.html">Conceito de interface de voz do sistema de computa√ß√£o para ajudar pessoas com defici√™ncia de fala</a></li>
<li><a href="../pt429780/index.html">C ++ moderno = (mais) novo padr√£o</a></li>
<li><a href="../pt429782/index.html">A hist√≥ria de como aceleramos os testes 12 vezes</a></li>
<li><a href="../pt429786/index.html">Fast Sin and Cos no ASM incorporado para Delphi</a></li>
<li><a href="../pt429788/index.html">Outro motivo pelo qual os cont√™ineres do Docker ficam mais lentos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>