<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçü§ù‚Äçüë®üèº üö£ üë©üèº‚Äçüè≠ Serializa√ß√£o .Net bin√°ria sem refer√™ncia ao assembly com o tipo de origem ou como negociar com BinaryFormatter üìø üöú üêπ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, compartilharei a experi√™ncia de serializa√ß√£o de tipo bin√°rio entre assemblies, sem refer√™ncia um ao outro. Como se viu, existem casos re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Serializa√ß√£o .Net bin√°ria sem refer√™ncia ao assembly com o tipo de origem ou como negociar com BinaryFormatter</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430646/">  Neste artigo, compartilharei a experi√™ncia de serializa√ß√£o de tipo bin√°rio entre assemblies, sem refer√™ncia um ao outro.  Como se viu, existem casos reais e "leg√≠timos" em que voc√™ precisa desserializar dados sem ter um link para o assembly em que eles s√£o declarados.  No artigo, falarei sobre o cen√°rio em que foi necess√°rio, descreverei o m√©todo de solu√ß√£o e tamb√©m falarei sobre erros intermedi√°rios cometidos no processo de busca <br><br><h3>  1. Introdu√ß√£o  Declara√ß√£o do problema </h3><br>  Cooperamos com uma grande corpora√ß√£o que trabalha no campo da geologia.  Historicamente, a empresa escreveu um software muito diferente para trabalhar com dados provenientes de diferentes tipos de equipamento + an√°lise de dados + previs√£o.  Infelizmente, todo esse software est√° longe de ser sempre ‚Äúamig√°vel‚Äù um com o outro e, na maioria das vezes, nem um pouco amig√°vel.  Para, de alguma forma, consolidar as informa√ß√µes, agora est√° sendo criado um portal da Web, onde diferentes programas enviam seus dados na forma de xml.  E o portal est√° tentando criar uma vis√£o mais-menos-completa.  Uma nuance importante: como os desenvolvedores do portal n√£o s√£o fortes nas √°reas de assunto de cada aplicativo, cada equipe forneceu um m√≥dulo analisador / conversor de dados de seu xml para as estruturas de dados do portal. <br><a name="habracut"></a><br>  Eu trabalho em uma equipe desenvolvendo um dos aplicativos e escrevemos com facilidade um mecanismo de exporta√ß√£o para nossos dados.  Mas aqui, o analista de neg√≥cios decidiu que o portal central precisava de um dos relat√≥rios que nosso programa estava construindo.  Foi aqui que o primeiro problema apareceu: o relat√≥rio √© constru√≠do novamente a cada vez e os resultados n√£o s√£o salvos em nenhum lugar. <br>  "Ent√£o salve!"  O leitor provavelmente pensar√°.  Eu tamb√©m pensava assim, mas fiquei seriamente desapontado com a exig√™ncia de que o relat√≥rio j√° fosse constru√≠do para os dados baixados.  Nada a fazer - voc√™ precisa transferir a l√≥gica. <br><br><h2>  Etapa 0. Refatora√ß√£o.  Nada com problemas </h2><br>  Foi decidido separar a l√≥gica da cria√ß√£o do relat√≥rio (na verdade, esse √© um r√≥tulo de 4 colunas, mas a l√≥gica √© um vag√£o e um carrinho grande) em uma classe separada e incluir o arquivo com essa classe por refer√™ncia no conjunto do analisador.  Com isso, n√≥s: <br><br><ol><li>  Evite c√≥pia direta </li><li>  Protegendo contra discrep√¢ncias de vers√£o </li></ol><br>  Separar a l√≥gica em uma classe separada n√£o √© uma tarefa dif√≠cil.  Mas nem tudo foi t√£o otimista: o algoritmo foi baseado em objetos de neg√≥cios, cuja transfer√™ncia n√£o se encaixava no nosso conceito.  Eu tive que reescrever os m√©todos para que eles aceitassem apenas tipos simples e operassem com eles.  Nem sempre era simples e, em alguns lugares, exigia decis√µes, cuja beleza permanecia em quest√£o, mas, em geral, uma solu√ß√£o confi√°vel foi obtida sem muletas √≥bvias. <br><br>  Havia um detalhe que, como voc√™ sabe, geralmente serve como um ref√∫gio acolhedor para o diabo: herdamos uma abordagem estranha das gera√ß√µes anteriores de desenvolvedores, segundo a qual alguns dos dados necess√°rios para criar um relat√≥rio s√£o armazenados no banco de dados como objetos .Net serializados em bin√°rios ( as perguntas ‚Äúpor qu√™?‚Äù, ‚Äúkaaak?‚Äù, etc., infelizmente, permanecer√£o sem resposta devido √† falta de destinat√°rios).  E na entrada dos c√°lculos, √© claro que devemos desserializ√°-los. <br><br>  Esses tipos, dos quais era imposs√≠vel se livrar, tamb√©m inclu√≠mos "por refer√™ncia", especialmente porque eles n√£o eram complicados. <br><br><h3>  Etapa 1. Desserializa√ß√£o.  Lembre-se do nome completo do tipo </h3><br>  Depois de fazer as manipula√ß√µes acima e executar uma execu√ß√£o de teste, recebi inesperadamente um erro de tempo de execu√ß√£o que <br><blockquote>  [A] Namespace.TypeA n√£o pode ser convertido em [B] Namespace.TypeA.  O tipo A √© origin√°rio de 'Assembley.Application, Vers√£o = 1.0.0.0, Culture = neutral, PublicKeyToken = null' no contexto 'Padr√£o' no local '...'.  O tipo B √© origin√°rio de 'Assmbley.Portal, vers√£o = 1.0.0.0, Cultura = neutra, PublicKeyToken = null' no contexto 'Padr√£o' no local ''. </blockquote>  Os primeiros links do Google me disseram que o BinaryFormatter grava n√£o apenas dados, mas tamb√©m digita informa√ß√µes no fluxo de sa√≠da, o que √© l√≥gico.  E, levando em considera√ß√£o que o nome completo do tipo cont√©m a montagem na qual √© declarado, a imagem do que tentei desserializar um tipo √© completamente diferente do ponto de vista do .Net <br><br>  Depois de co√ßar a cabe√ßa, tomei uma decis√£o √≥bvia, mas, infelizmente, cruel, de substituir um tipo TypeA espec√≠fico durante <b>a</b> desserializa√ß√£o <b>din√¢mica</b> .  Tudo funcionou.  Os resultados do relat√≥rio convergiram de cima para baixo, os testes no servidor de compila√ß√£o foram aprovados.  Com uma sensa√ß√£o de realiza√ß√£o, enviamos a tarefa aos testadores. <br><br><h3>  Etapa 2. O principal.  Serializa√ß√£o entre montagens </h3><br>  O acerto de contas veio rapidamente na forma de bugs registrados pelos testadores, que afirmavam que o analisador no lado do portal caiu com a exce√ß√£o de que n√£o era poss√≠vel carregar o assembly Assembley.Application (montagem do nosso aplicativo).  Primeiro pensamento: n√£o limpei as refer√™ncias.  Mas - n√£o, est√° tudo bem, ningu√©m se refere.  Eu tento execut√°-lo novamente na caixa de areia - tudo funciona.  Come√ßo a suspeitar de um erro de compila√ß√£o, mas aqui surge uma id√©ia que n√£o me agrada: altero o caminho de sa√≠da do analisador para uma pasta separada e n√£o para o diret√≥rio bin compartilhado do aplicativo.  E pronto - recebo a exce√ß√£o descrita.  A an√°lise Stectrace confirma suposi√ß√µes vagas - a desserializa√ß√£o est√° caindo. <br><br>  A conscientiza√ß√£o foi r√°pida e dolorosa: a substitui√ß√£o de um tipo espec√≠fico por din√¢mico n√£o mudou nada, o BinaryFormatter ainda criou um tipo a partir de uma montagem externa, somente quando a montagem com o tipo estava pr√≥xima, o tempo de execu√ß√£o o carregava naturalmente e quando a montagem desaparecia - temos um erro. <br><br>  Havia um motivo para ficar triste.  Mas pesquisar no Google deu esperan√ßa na forma da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">classe SerializationBinder</a> .  Como se viu, permite determinar o tipo em que nossos dados s√£o desserializados.  Para fazer isso, crie um herdeiro e defina o seguinte m√©todo. <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> Type </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindToType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">String assemblyName, String typeName</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  em que voc√™ pode retornar qualquer tipo para determinadas condi√ß√µes. <br>  A classe BinaryFormatter possui uma propriedade <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Binder na</a> qual voc√™ pode injetar sua implementa√ß√£o. <br><br>  Parece que n√£o h√° problema.  Mas, novamente, os detalhes permanecem (veja acima). <br><br>  Primeiro, voc√™ deve processar solicita√ß√µes para <b>todos os</b> tipos (e padr√£o tamb√©m). <br><blockquote>  Uma op√ß√£o de implementa√ß√£o interessante foi encontrada na Internet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , mas eles est√£o tentando usar o fich√°rio padr√£o do BinaryFormatter, na forma de uma constru√ß√£o <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> defaultBinder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter().Binder</code> </pre> <br>  Mas, de fato, a propriedade Binder √© nula por padr√£o.  Uma an√°lise do c√≥digo fonte mostrou que, dentro do BinaryFormatter, se o Binder est√° marcado, em caso afirmativo, seus m√©todos s√£o chamados, se n√£o, √© usada l√≥gica interna, que finalmente se resume a <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assembly = Assembly.Load(assemblyName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FormatterServices.GetTypeFromAssembly(assembly, typeName);</code> </pre><br></blockquote>  Sem mais delongas, repeti a mesma l√≥gica em mim. <br><br>  Aqui est√° o que aconteceu na primeira implementa√ß√£o <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyBinder</span></span> : <span class="hljs-title"><span class="hljs-title">SerializationBinder</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Type </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindToType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> assemblyName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> typeName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (assemblyName.Contains(<span class="hljs-string"><span class="hljs-string">"&lt;ObligatoryPartOfNamespace&gt;"</span></span>) ) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bindToType = Type.GetType(typeName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bindToType; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bindToType = LoadTypeFromAssembly(assemblyName, typeName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bindToType; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Type </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadTypeFromAssembly</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> assemblyName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> typeName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(assemblyName) || <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(typeName)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> assembly = Assembly.Load(assemblyName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FormatterServices.GetTypeFromAssembly(assembly, typeName); } }</code> </pre><br>  I.e.  √© verificado se o espa√ßo para nome pertence ao projeto - retornamos o tipo do dom√≠nio atual, se o tipo de sistema - carregamos do assembly correspondente <br><br>  Parece l√≥gico.  Come√ßamos a testar: nosso tipo vem - n√≥s substitu√≠mos, ele √© criado.  Viva!  String vem - n√≥s seguimos o ramo com o carregamento da montagem.  Isso funciona!  Champanhe virtual aberto ... <br><br>  Mas aqui ... Um dicion√°rio vem com elementos de tipos de usu√°rio: como esse √© um tipo de sistema, ent√£o ... obviamente, estamos tentando carreg√°-lo da montagem, mas como os elementos que ela possui s√£o nossos tipos, al√©m disso, com qualifica√ß√£o completa (montagem, vers√£o, chave ), ent√£o ca√≠mos novamente.  (deve haver um sorriso triste). <br><br>  Claramente, voc√™ precisa alterar o nome de entrada do tipo, substituindo os links na montagem desejada.  Eu realmente esperava que, para o nome do tipo, houvesse um an√°logo da classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AssemblyName</a> , mas n√£o encontrei nada parecido.  Escrever um analisador universal com substitui√ß√£o n√£o √© uma tarefa f√°cil.  Ap√≥s uma s√©rie de experimentos, cheguei √† seguinte solu√ß√£o: no construtor est√°tico, subtraio os tipos a serem substitu√≠dos e, em seguida, procuro seus nomes na linha com o nome do tipo criado e, quando o encontro, substituo o nome do assembly <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> The types that may be changed to local </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> protected static IEnumerable</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;Type&gt;</span></span></span><span class="hljs-comment"> _changedTypes; static MyBinder() { var executingAssembly = Assembly.GetCallingAssembly(); var name = executingAssembly.GetName().Name; _changedTypes = executingAssembly.GetTypes().Where(t =&gt; t.Namespace != null &amp;&amp; !t.Namespace.Contains(name) &amp;&amp; !t.Name.StartsWith("</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;")); //!t.Namespace.Contains(name) - .     ,         // "&lt;'      -     } private static string CorrectTypeName(string name) { foreach (var changedType in _changedTypes) { var ind = name.IndexOf(changedType.FullName); if (ind != -1) { var endIndex = name.IndexOf("PublicKeyToken", ind) ; if (endIndex != -1) { endIndex += +"PublicKeyToken".Length + 1; while (char.IsLetterOrDigit(name[endIndex++])) { } var sb = new StringBuilder(); sb.Append(name.Substring(0, ind)); sb.Append(changedType.AssemblyQualifiedName); sb.Append(name.Substring(endIndex-1)); name = sb.ToString(); } } } return name; } /// &lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> look up the type locally if the assembly-name is "NA" </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="assemblyName"&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="typeName"&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment"> public override Type BindToType(string assemblyName, string typeName) { typeName = CorrectTypeName(typeName); if (assemblyName.Contains("</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;ObligatoryPartOfNamespace&gt;</span></span></span><span class="hljs-comment">") || assemblyName.Equals("NA")) { var bindToType = Type.GetType(typeName); return bindToType; } else { var bindToType = LoadTypeFromAssembly(assemblyName, typeName); return bindToType; } }</span></span></code> </pre><br>  Como voc√™ pode ver, comecei pelo fato de que PublicKeyToken √© o √∫ltimo na descri√ß√£o do tipo.  Talvez isso n√£o seja 100% confi√°vel, mas em meus testes n√£o encontrei casos em que isso n√£o fosse verdade. <br><br>  Assim, uma linha do formul√°rio <br><blockquote>  "System.Collections.Generic.Dictionary`2 [[SomeNamespace.CustomType, Assembley.Application, Vers√£o = 1.0.0.0, Cultura = neutra, PublicKeyToken = null], [System.Byte [], mscorlib, Vers√£o = 4.0.0.0, Cultura = neutra, PublicKeyToken = b77a5c561934e089]] ¬ª </blockquote><br>  se transforma em <br><blockquote>  "System.Collections.Generic.Dictionary`2 [[SomeNamespace.CustomType, Assembley.Portal, Vers√£o = 1.0.0.0, Cultura = neutra, PublicKeyToken = null], [System.Byte [], mscorlib, Vers√£o = 4.0.0.0, Cultura = neutra, PublicKeyToken = b77a5c561934e089]] ¬ª </blockquote><br>  Agora tudo finalmente funcionou "como um rel√≥gio".  Havia pequenas sutilezas t√©cnicas: se voc√™ se lembra, os arquivos que inclu√≠mos foram inclu√≠dos no link do aplicativo principal.  Mas na aplica√ß√£o principal, todas essas dan√ßas n√£o s√£o necess√°rias.  Portanto, um mecanismo de compila√ß√£o condicional do formul√°rio <br><br><pre> <code class="cs hljs">BinaryFormatter binForm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BinaryFormatter(); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> EXTERNAL_LIB binForm.Binder = new MyBinder(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  Assim, na montagem do portal, definimos a macro EXTERNAL_LIB, mas no aplicativo principal - n√£o <br><blockquote><h4>  "Digress√£o n√£o l√≠rica" </h4><br>  De fato, no processo de codifica√ß√£o, para verificar rapidamente a solu√ß√£o, fiz um erro de c√°lculo, o que provavelmente me custou um certo n√∫mero de c√©lulas nervosas: para iniciantes, eu apenas codifiquei a substitui√ß√£o de tipo para Dicitionary.  Como resultado, ap√≥s a desserializa√ß√£o, acabou sendo um dicion√°rio vazio, que tamb√©m "travou" ao tentar executar algumas opera√ß√µes com ele.  Eu j√° estava come√ßando a pensar que voc√™ <i>n√£o podia enganar o BinaryFormatter</i> e comecei experi√™ncias desesperadas com a tentativa de escrever o herdeiro do Dictionary.  Felizmente, parei quase a tempo e voltei a escrever um mecanismo de substitui√ß√£o universal e, implementando-o, percebi que para criar um Dicion√°rio n√£o basta redefinir seu tipo: voc√™ ainda precisa cuidar dos tipos de KeyValuePair &lt;TKey, TValue&gt;, Comparer, que tamb√©m s√£o solicitados a Fich√°rio <br><br><br>  Essas s√£o as aventuras de serializa√ß√£o bin√°ria.  Ficaria muito grato pelo feedback. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt430646/">https://habr.com/ru/post/pt430646/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt430634/index.html">Criando um m√≥dulo de software para o programador XELTEK SuperPro 6100</a></li>
<li><a href="../pt430636/index.html">Cerebelo e n√∫cleos basais em vez da bola de cristal: como o c√©rebro prediz o futuro</a></li>
<li><a href="../pt430640/index.html">Mar Vermelho: por que as a√ß√µes da Apple e outras empresas de tecnologia est√£o caindo</a></li>
<li><a href="../pt430642/index.html">Dire√ß√£o "Fot√¥nica" nas Olimp√≠adas "Eu sou um profissional", ou como se inscrever em uma magistratura sem exames</a></li>
<li><a href="../pt430644/index.html">Uma nova vulnerabilidade no Facebook leva ao vazamento de dados pessoais dos usu√°rios</a></li>
<li><a href="../pt430648/index.html">Hist√≥ria do Pac-Man</a></li>
<li><a href="../pt430650/index.html">O sexo √© um vendedor de jogos de arcade cl√°ssicos. E quem √© o comprador?</a></li>
<li><a href="../pt430654/index.html">devleads meetup: reunimos uma equipe eficaz, otimizamos o desenvolvimento, discutimos quest√µes atuais</a></li>
<li><a href="../pt430656/index.html">Programa SAFe¬Æ certificado</a></li>
<li><a href="../pt430658/index.html">Como come√ßou - o nascimento dos videogames</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>