<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง๐พ ๐ ๐น ุฃููุงู ูู ุจูุณุชุฌุฑุณ: 4. ุฃููุงู ูู ุงูุฐุงูุฑุฉ ๐๏ธ ๐ฐ๐ป โฑ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงุณูุญูุง ูู ุฃู ุฃุฐูุฑู ุจุฃููุง ุชุญุฏุซูุง ุจุงููุนู ุนู ุฃููุงู ุงูุนูุงูุงุช ุ ูุฃููุงู ูุณุชูู ุงูุตู ุ ูุนู ุฃููุงู ุงููุงุฆูุงุช ุงูุฃุฎุฑู (ุจูุง ูู ุฐูู ุงูุนูุงุตุฑ ุงูุฃุตููุฉ) ุ ูุนู ุงูุนูุงูุฉ ุจู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃููุงู ูู ุจูุณุชุฌุฑุณ: 4. ุฃููุงู ูู ุงูุฐุงูุฑุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/466199/" style=";text-align:right;direction:rtl">  ุงุณูุญูุง ูู ุฃู ุฃุฐูุฑู ุจุฃููุง ุชุญุฏุซูุง ุจุงููุนู ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃููุงู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุนูุงูุงุช</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุ ูุฃููุงู ูุณุชูู ุงูุตู</a> ุ ูุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃููุงู ุงููุงุฆูุงุช ุงูุฃุฎุฑู</a> (ุจูุง ูู ุฐูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุนูุงุตุฑ</a> ุงูุฃุตููุฉ) ุ ูุนู ุงูุนูุงูุฉ ุจูู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุฃููุงู. <br><br>  ุงูููู ุ ุฃููู ูุฐู ุงูุณูุณูุฉ ุจููุงู ุนู <strong>ุฃููุงู ุงูุฐุงูุฑุฉ</strong> .  ุณูุชุญุฏุซ ุนู ุงููุบุงุฒู ุ ูุงูุฃููุงู ุฎูููุฉ ุงููุฒู ุ ูุงูููู ุงููุคูุช ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃุฏูุงุช ูุฑุงูุจุฉ ุงูุชููุนุงุช ูุฃุฎุฐ ุงูุนููุงุช. <br><br><img src="https://habrastorage.org/webt/2y/vt/2g/2yvt2gpimbdqmnibpzaiuf8qu0q.png"><br><a name="habracut"></a><br><h1 style=";text-align:right;direction:rtl">  ุชุฏูุฑ ููู </h1><br>  ุนูู ุนูุณ ุงูุฃููุงู "ุงูุซูููุฉ" ุงูุนุงุฏูุฉ ุ ูุชู ุงุณุชุฎุฏุงู ุฃููุงู ุฃุฎู ูุฒูุง ูุฃุฑุฎุต (ูู ุญูุซ ุงูุญูู) ูุญูุงูุฉ ุงูููุงูู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุงููุดุชุฑูุฉ. <br><br>  ุฃุจุณุท ูููู <em>ุงูุฃููุงู ุชุฏูุฑ</em> ุฃู <em>spinlocks</em> .  ููู ูุตููุฉ ูุงูุชูุงุท ููุชุฑุฉ ูุตูุฑุฉ ุฌุฏูุง (ุนุฏุฉ ุชุนูููุงุช ูููุนุงูุฌ) ูุญูุงูุฉ ุฃูุณุงู ุงูุฐุงูุฑุฉ ุงููุฑุฏูุฉ ูู ุงูุชุบููุฑุงุช ุงููุชุฒุงููุฉ. <br><br>  ูุชู ุชุทุจูู ุฃููุงู ุงูุฏูุฑุงู ุจูุงุกู ุนูู ุชุนูููุงุช ุฐุฑูุฉ ูู ุงููุนุงูุฌ ุ ูุซู ุงูููุงุฑูุฉ ูุงููุจุงุฏูุฉ.  ุฃููุง ุชุฏุนู ูุถุน ุญุตุฑู ูุงุญุฏ.  ุฅุฐุง ูุงู ุงูููู ูุดุบููุงู ุ ูุนูููุฉ ุงูุงูุชุธุงุฑ ุชูุชุธุฑ ุงูุชุธุงุฑูุง ูุดุทูุง - ูุชูุฑุฑ ุงูุฃูุฑ ("ูุฏูุฑ" ูู ุงูุญููุฉ ุ ูุจุงูุชุงูู ุงูุงุณู) ุญุชู ูุชู ุชูููุฐู ุจูุฌุงุญ.  ูุฐุง ุฃูุฑ ููุทูู ุ ุญูุซ ูุชู ุงุณุชุฎุฏุงู ุฃููุงู ุงูุฏูุฑุงู ุนูุฏูุง ูููู ุงุญุชูุงู ุงูุตุฑุงุน ููุฎูุถูุง ููุบุงูุฉ. <br><br>  ูุง ุชููุฑ ุฃููุงู ุงูุฏูุฑุงู ุงููุดู ุนู ุญุงูุฉ ุชููู ุชุงู (ูุฑุงูุจ ูุทูุฑู PostgreSQL ูุฐุง) ููุง ููุฏููู ุฃู ุฃุฏูุงุช ูุฑุงูุจุฉ.  ุฅูู ุญุฏ ูุจูุฑ ุ ูุฅู ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูููููุง ุงูููุงู ุจู ูุน ุฃููุงู ุงูุฏูุฑุงู ูู ูุนุฑูุฉ ูุฌูุฏูุง. <br><br><h1 style=";text-align:right;direction:rtl">  ุฃููุงู ุงูุถูุก </h1><br>  ูุฃุชู ุจุนุฏ ุฐูู <em>ุงูุฃููุงู</em> ุงูุฎูููุฉ ุงููุฒุนููุฉ (ุงูุฃููุงู ุงูุฎูููุฉ ุ ุงูุฃููุงู). <br><br>  ูุชู ุงูุชูุงุทูุง ููููุช ุงููุตูุฑ ุงูุฐู ุชุณุชุบุฑูู ููุนูู ูุน ุจููุฉ ุงูุจูุงูุงุช (ุนูู ุณุจูู ุงููุซุงู ุ ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุฃู ูุงุฆูุฉ ุงููุคุดุฑุงุช).  ููุงุนุฏุฉ ุนุงูุฉ ุ ูุง ูุชู ููู ููู ุงูุถูุก ููุชุฑุฉ ุทูููุฉ ุ ูููู ูู ุจุนุถ ุงูุญุงูุงุช ุ ูุญูู ููู ุงูุถูุก ุนูููุงุช ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุ ูุฐูู ูู ุญูุซ ุงููุจุฏุฃ ุ ูููู ุฃู ูููู ุงูููุช ูุจูุฑูุง. <br><br>  ูุชู ุฏุนู ูุถุนูู: ุญุตุฑู (ูุชุบููุฑ ุงูุจูุงูุงุช) ููุดุงุฑูุชู (ูููุฑุงุกุฉ ููุท).  ุนูู ูุฐุง ุงููุญู ุ ูุง ุชูุฌุฏ ูุงุฆูุฉ ุงูุชุธุงุฑ ููุงูุชุธุงุฑ: ุฅุฐุง ูุงูุช ููุงู ุนุฏุฉ ุนูููุงุช ุชูุชุธุฑ ุฅุตุฏุงุฑ ุงูููู ุ ูุณุชุชููู ุฅุญุฏุงูุง ูู ุงููุตูู ุจุดูู ุนุดูุงุฆู ุฃู ุฃูุซุฑ.  ูู ุงูุฃูุธูุฉ ุงูุชู ุชุชูุชุน ุจุฏุฑุฌุฉ ุนุงููุฉ ูู ุงูุชูุงุฒู ูุงูุญูู ุงูุซููู ุ ูููู ุฃู ูุคุฏู ุฐูู ุฅูู ุชุฃุซูุฑุงุช ุบูุฑ ุณุงุฑุฉ (ุงูุธุฑ ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุงูุดุฉ</a> ). <br><br>  ูู ูุชู ุชูููุฑ ุขููุฉ ููุชุญูู ูู ุงูุฌููุฏ ุ ููุฐุง ูุง ูุฒุงู ุนูู ุถููุฑ ูุทูุฑู ุงูููุงุฉ.  ููุน ุฐูู ุ ุชุญุชูู ุฃููุงู ุงูุฅุถุงุกุฉ ุนูู ุฃุฏูุงุช ูุฑุงูุจุฉ ุ ูุจุงูุชุงูู ุ ุนูู ุนูุณ ุฃููุงู ุงูุฏูุฑุงู ุ ูููู "ุฑุคูุชูุง" (ุจุนุฏ ูุชุฑุฉ ูุฌูุฒุฉ ุณุฃุธูุฑ ูู ููู). <br><br><h1 style=";text-align:right;direction:rtl">  ููุทุน ุงูุนุงุฒูุฉ </h1><br>  ููุงู ููุน ุขุฎุฑ ูู ุงูููู ุงูุฐู ูุงูุดูุงู ุจุงููุนู ูู ุงูููุงูุฉ ุญูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช</a> ููู <em>ุชุซุจูุช ุงูุนุงุฒูุฉ</em> . <br><br>  ูุน ูุฌูุฏ ูุฎุฒู ูุคูุช ุซุงุจุช ุ ููููู ุชูููุฐ ุงูุนุฏูุฏ ูู ุงูุฅุฌุฑุงุกุงุช ุ ุจูุง ูู ุฐูู ุชุบููุฑ ุงูุจูุงูุงุช ุ ูููู ุจุดุฑุท ุฃู ูุฐู ุงูุชุบููุฑุงุช ูู ุชููู ูุฑุฆูุฉ ููุนูููุงุช ุงูุฃุฎุฑู ุจุณุจุจ ุงูุฅุตุฏุงุฑุงุช ุงููุชุนุฏุฏุฉ.  ููุฐุง ูุนูู ุ ููููู ุฅุถุงูุฉ ุณุทุฑ ุฌุฏูุฏ ุฅูู ุงูุตูุญุฉ ุ ูููู ูุง ููููู ุงุณุชุจุฏุงู ุงูุตูุญุฉ ูู ุงููุฎุฒู ุงููุคูุช ุจุณุทุฑ ุขุฎุฑ. <br><br>  ุฅุฐุง ุชู ุฅุนุงูุฉ ุงูุนูููุฉ ุนู ุทุฑูู ุงูุฑุจุท ุ ูุนุงุฏุฉู ูุง ุชุชุฎุทู ูุซู ูุฐุง ุงููุฎุฒู ุงููุคูุช ูุชุฎุชุงุฑ ุฃุฎุฑู.  ูููู ูู ุจุนุถ ุงูุญุงูุงุช ุ ุนูุฏูุง ูููู ูุฐุง ุงููุฎุฒู ุงููุคูุช ุงููุญุฏุฏ ูุทููุจูุง ุ ูุฅู ููุงุฆู ุงูุงูุชุธุงุฑ ุงูุนูููุฉ ุชุบูู - ูุณุชููุธ ุงููุธุงู ุนูุฏ ุฅุฒุงูุฉ ุงูุฑุงุจุท. <br><br>  ุชููุนุงุช ุงูุชูุญูุฏ ูุชุงุญุฉ ูููุฑุงูุจุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ูุซุงู: ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช </h1><br><img src="https://habrastorage.org/webt/gt/z8/gy/gtz8gylhroqbvj7jmwemqbd4jys.png"><br><br>  ุงูุขู ุ ููุญุตูู ุนูู ุจุนุถ (ุบูุฑ ููุชูู!) ุฅููุงุก ูุธุฑุฉ ุนูู ููููุฉ ูููุงู ุงุณุชุฎุฏุงู ุงูุฃููุงู ุ ููุฑ ูู ูุซุงู ุนูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช. <br><br>  ูููุตูู ุฅูู ุฌุฏูู ุชุฌุฒุฆุฉ ูุญุชูู ุนูู ูุฑุงุฌุน ุฅูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุ ูุฌุจ ุฃู ุชูุชูุท ุงูุนูููุฉ ููููุง ูุชุนููู ุงููุฎุฒู ุงููุคูุช ููุถูุก ูู ุงููุถุน ุงููุดุชุฑู ุ ูุฅุฐุง ูุงู ุงูุฌุฏูู ุจุญุงุฌุฉ ุฅูู ุชุบููุฑ ุ ูู ูุถุน ุงุณุชุซูุงุฆู.  ูุชูููู ุงูุชูุงุตูู ุ ูุชู ุชุฑุชูุจ ูุฐุง ุงูููู ุนูู ุดูู <em>ุดุฑูุญุฉ</em> ุ ุชุชุฃูู ูู 128 ููููุง ูููุตููุง ุ ูุญูู ูู ูููุง ุงูุฌุฒุก ุงูุฎุงุต ุจู ูู ุฌุฏูู ุงูุชุฌุฒุฆุฉ. <br><br>  ุชุญุตู ุงูุนูููุฉ ุนูู ุฅููุงููุฉ ุงููุตูู ุฅูู ุฑุฃุณ ุงููุฎุฒู ุงููุคูุช ุจุงุณุชุฎุฏุงู ููู ุงูุฏูุฑุงู.  ูููู ุฃูุถูุง ุชูููุฐ ุงูุนูููุงุช ุงููุฑุฏูุฉ (ูุซู ุฒูุงุฏุฉ ุงูุนุฏุงุฏ) ุฏูู ุฃููุงู ุตุฑูุญุฉ ุจุงุณุชุฎุฏุงู ุชุนูููุงุช ุฐุฑูุฉ ูู ุงููุนุงูุฌ. <br><br>  ููุฑุงุกุฉ ูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช ุ ูุทููุจ ุชุฃููู ูุญุชูู ุงููุฎุฒู ุงููุคูุช.  ุนุงุฏุฉู ูุง ูุชู ุงูุชูุงุทู ููุท ููููุช ุงููุงุฒู ููุฑุงุกุฉ ุงููุคุดุฑุงุช ุฅูู ุฅุตุฏุงุฑ ุงูุฎุทูุท ุ ููู ุซู ุชููู ุงูุญูุงูุฉ ุงูุชู ูููุฑูุง ููุทุน ุงููุฎุฒู ุงููุคูุช ูุงููุฉ.  ูุชุนุฏูู ูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช ุ ูุฌุจ ุงูุชูุงุท ูุฐุง ุงูููู ูู ุงููุถุน ุงูุงุณุชุซูุงุฆู. <br><br>  ุนูุฏ ูุฑุงุกุฉ ูุฎุฒู ูุคูุช ูู ุงููุฑุต (ุฃู ุงููุชุงุจุฉ ุฅูู ุงููุฑุต) ุ ูุชู ุฃูุถูุง ุงูุชูุงุท ููู IO ููุฏ ุงูุชุดุบูู ุ ููุง ูุดูุฑ ุฅูู ุงูุนูููุงุช ุงูุฃุฎุฑู ุงูุชู ุชุชู ูุฑุงุกุชูุง ุงูุตูุญุฉ (ุฃู ูุชุงุจุชูุง) - ูููููู ุงูุงูุชุธุงุฑ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุฅุฐุง ุงุญุชุงุฌูุง ุฃูุถูุง ุฅูู ุงูููุงู ุจุดูุก ูุง ุจูุฐู ุงูุตูุญุฉ. <br><br>  ูุชู ุญูุงูุฉ ุงููุคุดุฑุงุช ุฅูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุงูุญุฑุฉ ูุงูุถุญูุฉ ุงูุชุงููุฉ ุนู ุทุฑูู ููู ุชุฏูุฑ ููู ุงูุนุงุฒูุฉ ุงุณุชุฑุงุชูุฌูุฉ ูุงุญุฏุฉ. <br><br><h1 style=";text-align:right;direction:rtl">  ูุซุงู: ุณุฌู ุงููุฎุงุฒู ุงููุคูุชุฉ </h1><br><img src="https://habrastorage.org/webt/_f/mu/ub/_fmuubhon3hualbtorx4rmjgur4.png"><br>  ูุซุงู ุขุฎุฑ: ุณุฌู ุงููุฎุงุฒู ุงููุคูุชุฉ. <br><br>  ุจุงููุณุจุฉ ูุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูููุฌูุฉ ุ ูุชู ุฃูุถูุง ุงุณุชุฎุฏุงู ุฌุฏูู ุงูุชุฌุฒุฆุฉ ุงูุฐู ูุญุชูู ุนูู ุชุนููู ุงูุตูุญุงุช ุฅูู ุงููุฎุงุฒู ุงููุคูุชุฉ.  ุจุฎูุงู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช ุ ูุชู ุญูุงูุฉ ุฌุฏูู ุงูุชุฌุฒุฆุฉ ูุฐุง ุจูุงุณุทุฉ ุงูููู ุงูุฎููู ุงููุญูุฏ ูู WALBufMappingLock ุ ูุธุฑูุง ูุฃู ุญุฌู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ูููุฌูุฉ ูููู ุฃุตุบุฑ (ุนุงุฏุฉ ูุง ูููู 1/32 ูู ุฐุงูุฑุฉ ุงูุชุฎุฒูู ุงููุคูุช ุงููุฎุฒู ุงููุคูุช) ููููู ุงููุตูู ุฅูู ุงููุฎุงุฒู ุงููุคูุชุฉ ุฃูุซุฑ ุงูุณูุงุจูุฉ. <br><br>  ุชุชู ุญูุงูุฉ ุตูุญุงุช ุงููุชุงุจุฉ ุนูู ุงููุฑุต ุจูุงุณุทุฉ ููู WALWriteLock ุฎููู ุงููุฒู ุจุญูุซ ูููู ุฅุฌุฑุงุก ุนูููุฉ ูุงุญุฏุฉ ููุท ูู ูู ูุฑุฉ. <br><br>  ูุฅูุดุงุก ุฅุฏุฎุงู ุฏูุชุฑ ููููุฉ ุ ูุฌุจ ุฃู ุชุญุฌุฒ ุงูุนูููุฉ ุฃููุงู ูุณุงูุฉ ุนูู ุตูุญุฉ WAL.  ููููุงู ุจุฐูู ุ ูุฅูู ููุชูุท ููู ููุถุน ุฅุฏุฑุงุฌ ููู ุงูุฏูุฑุงู.  ุจุนุฏ ุญุฌุฒ ููุงู ุ ุชููู ุงูุนูููุฉ ุจูุณุฎ ูุญุชููุงุช ุณุฌููุง ุฅูู ุงูููุงู ุงููุญุฏุฏ.  ูููู ุฅุฌุฑุงุก ุงููุณุฎ ูู ุฎูุงู ุนุฏุฉ ุนูููุงุช ูู ููุณ ุงูููุช ุ ูุงูุฐู ูุชู ุญูุงูุฉ ุงูุณุฌู ูู ุฎูุงู ุดุฑูุญุฉ ููููุฉ ูู 8 ุฃููุงู ุณููุฉ ูุฅุฏุฎุงู ุงูููู (ูุฌุจ ุฃู ุชูุชูุท ุงูุนูููุฉ <em>ุฃููุง</em> ูููุง). <br><br>  ูุง ููุธูุฑ ุงูุดูู ุฌููุน ุงูุฃููุงู ุงููุชุนููุฉ ุจุณุฌู ุงูุณุฌู ุงููุณุจู ุ ูููู ูุฐุง ูุงููุซุงู ุงูุณุงุจู ูุฌุจ ุฃู ูุนุทูุง ููุฑุฉ ุนู ุงุณุชุฎุฏุงู ุงูุฃููุงู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู. <br><br><h1 style=";text-align:right;direction:rtl">  ุฑุตุฏ ุงูุชููุนุงุช </h1><br>  ุจุฏุกูุง ูู PostgreSQL 9.6 ุ ูุชู ุชุถููู ุฃุฏูุงุช ูุฑุงูุจุฉ ุงูุงูุชุธุงุฑ ูู ุทุฑููุฉ ุงูุนุฑุถ pg_stat_activity.  ุนูุฏูุง ูุง ุชุชููู ุงูุนูููุฉ (ุงููุธุงู ุฃู ุงูุตูุงูุฉ) ูู ุฃุฏุงุก ุนูููุง ูุชูุชุธุฑ ุดูุฆูุง ูุง ุ ูููู ุฑุคูุฉ ูุฐุง ุงูุชููุน ูู ุทุฑููุฉ ุงูุนุฑุถ: ูุดูุฑ ุงูุนููุฏ wait_event_type ุฅูู ููุน ุงูุชููุน ุ ููุดูุฑ ุงูุนููุฏ wait_event ุฅูู ุงุณู ุชููุน ูุญุฏุฏ. <br><br>  ุถุน ูู ุงุนุชุจุงุฑู ุฃู ุทุฑููุฉ ุงูุนุฑุถ ุชุธูุฑ ููุท ุชูู ุงูุชููุนุงุช ุงูุชู ูุชู ุงูุชุนุงูู ูุนูุง ุจุดูู ููุงุณุจ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงููุตุฏุฑ.  ุฅุฐุง ูู ุชุธูุฑ ุทุฑููุฉ ุงูุนุฑุถ ุงูุชููุน ุ ููุฐุง ูุง ูุนูู ุนููููุง ุงุญุชูุงู 100ูช ุฃู ุงูุนูููุฉ ูุง ุชุชููุน ุฃู ุดูุก ุญููุง. <br><br>  ูุณูุก ุงูุญุธ ุ ูุฅู ุงููุนูููุงุช ุงููุญูุฏุฉ ุงููุชุงุญุฉ ุญูู ุงูุชููุนุงุช ูู ุงููุนูููุงุช <em>ุงูุญุงููุฉ</em> .  ูุง ุชูุฌุฏ ุฅุญุตุงุกุงุช ูุญููุธุฉ.  ุงูุทุฑููุฉ ุงููุญูุฏุฉ ููุญุตูู ุนูู ุตูุฑุฉ ููุชููุนุงุช ุจูุฑูุฑ ุงูููุช ูู <em>ุฃุฎุฐ ุนููุงุช</em> ูู ุทุฑููุฉ ุงูุนุฑุถ ูู ูุงุตู ุฒููู ูุญุฏุฏ.  ูุง ุชูุฌุฏ ูุณุงุฆู ูุฏูุฌุฉ ููุฐุง ุงูุบุฑุถ ุ ููู ููููู ุงุณุชุฎุฏุงู ุงูุงูุชุฏุงุฏุงุช ุ ุนูู ุณุจูู ุงููุซุงู ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pg_wait_sampling</a> . <br><br>  ูู ุงูุถุฑูุฑู ูุฑุงุนุงุฉ ุงูุทุจูุนุฉ ุงูุงุญุชูุงููุฉ ูุฃุฎุฐ ุงูุนููุงุช.  ููุญุตูู ุนูู ุตูุฑุฉ ุฃูุซุฑ ุฃู ุฃูู ููุซูููุฉ ุ ูุฌุจ ุฃู ูููู ุนุฏุฏ ุงูููุงุณุงุช ูุจูุฑูุง ุจุฏุฑุฌุฉ ูุงููุฉ.  ูุฏ ูุง ูุนุทู ุฃุฎุฐ ุงูุนููุงุช ุจุชุฑุฏุฏ ููุฎูุถ ุตูุฑุฉ ูููู ุงูุงุนุชูุงุฏ ุนูููุง ุ ูุณุชุคุฏู ุฒูุงุฏุฉ ุงูุชุฑุฏุฏ ุฅูู ุฒูุงุฏุฉ ูู ุงูุญูู.  ููุณุจุจ ููุณู ุ ุฃุฎุฐ ุงูุนููุงุช ุบูุฑ ูุฌุฏูุฉ ูุชุญููู ุฌูุณุงุช ูุตูุฑุฉ ุงูุฃุฌู. <br><br>  ูู ุงูุชููุนุงุช ูููู ุชูุณูููุง ุฅูู ุนุฏุฉ ุฃููุงุน. <br><br>  ุชุดูู ุงูุฃููุงู ุงููุฏุฑูุณุฉ ูุฆุฉ ูุจูุฑุฉ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุงูุชุธุงุฑ ุชุฃููู ุงููุงุฆูุงุช (ูููุฉ ุงูุชุฃููู ูู ุงูุนููุฏ wait_event_type) ุ </li><li style=";text-align:right;direction:rtl">  ุงูุชุธุงุฑ ุงูุฃููุงู ุงูุฎูููุฉ (LWLock) ุ </li><li style=";text-align:right;direction:rtl">  ุงูุชุธุงุฑ ุงููุฎุฒู ุงููุคูุช ูุซุจุช (BufferPin). </li></ul><br>  ููู ุงูุนูููุงุช ูููู ุฃู ุชุชููุน ุฃุญุฏุงุซูุง ุฃุฎุฑู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญุฏุซ ุชููุนุงุช I / O (IO) ุนูุฏูุง ุชุญุชุงุฌ ุงูุนูููุฉ ุฅูู ูุชุงุจุฉ ุงูุจูุงูุงุช ุฃู ูุฑุงุกุชูุง ุ </li><li style=";text-align:right;direction:rtl">  ูููู ููุนูููุฉ ุงูุชุธุงุฑ ุงูุจูุงูุงุช ุงูุถุฑูุฑูุฉ ููุนูู ูู ุงูุนููู (ุงูุนููู) ุฃู ูู ุนูููุฉ ุฃุฎุฑู (IPC) ุ </li><li style=";text-align:right;direction:rtl">  ูููู ููุฅุถุงูุงุช ุชุณุฌูู ุชููุนุงุชูู ุงููุญุฏุฏุฉ (ููุญู). </li></ul><br>  ููุงู ุญุงูุงุช ุนูุฏูุง ูุง ุชุคุฏู ุงูุนูููุฉ ุจุจุณุงุทุฉ ุนููุงู ูููุฏูุง.  ูุฐู ุงููุฆุฉ ุชุดูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุชุธุงุฑ ุงูุนูููุงุช ุงูุฎูููุฉ ูู ุญููุฉ ุงูุฑุฆูุณู (ุงููุดุงุท) ุ </li><li style=";text-align:right;direction:rtl">  ูู ุงูุชุธุงุฑ ูุคูุช (ูููุฉ). </li></ul><br>  ููุงุนุฏุฉ ุนุงูุฉ ุ ูุฐู ุงูุชููุนุงุช "ุทุจูุนูุฉ" ููุง ุชุชุญุฏุซ ุนู ุฃู ูุดุงูู. <br><br>  ูุชุจุน ููุน ุงูุชููุน ุงุณู ุงูุชููุน ุงููุญุฏุฏ.  ูููู ุงูุนุซูุฑ ุนูู ุงูุฌุฏูู ุงููุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ุงููุซุงุฆู</a> . <br><br>  ุฅุฐุง ูู ูุชู ุชุญุฏูุฏ ุงุณู ุงูุชุธุงุฑ ุ ููู ุชููู ุงูุนูููุฉ ูู ุญุงูุฉ ุงูุชุธุงุฑ.  ูุฌุจ ุงุนุชุจุงุฑ ูุซู ูุฐุง ุงูููุช ูู <em>ุนุฏุงุฏ ุงูููููุฏูู</em> ุ ูุฃูู ูู ุงููุงูุน ููุณ ูู ุงููุนุฑูู ูุง ูุญุฏุซ ุจุงูุถุจุท ูู ูุฐู ุงููุญุธุฉ. <br><br>  ููุน ุฐูู ุ ููุฏ ุญุงู ุงูููุช ูููุธุฑ. <br><br><pre style=";text-align:right;direction:rtl"><code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pid, backend_type, wait_event_type, wait_event <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity;</code> </pre> <pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | backend_type | wait_event_type | wait_event -------+------------------------------+-----------------+--------------------- 28739 | logical replication launcher | Activity | LogicalLauncherMain 28736 | autovacuum launcher | Activity | AutoVacuumMain 28963 | client backend | | 28734 | background writer | Activity | BgWriterMain 28733 | checkpointer | Activity | CheckpointerMain 28735 | walwriter | Activity | WalWriterMain (6 rows)</code> </pre><br>  ูููู ููุงุญุธุฉ ุฃู ุฌููุน ุนูููุงุช ุฎุฏูุฉ ุงูุฎูููุฉ "ุชุนุจุซ". ุชุดูุฑ ุงูููู ุงููุงุฑุบุฉ ูู wait_event_type ู wait_event ุฅูู ุฃู ุงูุนูููุฉ ูุง ุชุชููุน ุฃู ุดูุก - ูู ุญุงูุชูุง ุ ุนูููุฉ ุงูุชูุฏูู ูุดุบููุฉ ูู ุชูููุฐ ุงูุทูุจ. <br><br><h2 style=";text-align:right;direction:rtl">  ุฃุฎุฐ ุงูุนููุงุช </h2><br>  ููุญุตูู ุนูู ุตูุฑุฉ ูุงููุฉ ุฃู ุฃูู ููุชููุนุงุช ุจุงุณุชุฎุฏุงู ุฃุฎุฐ ุงูุนููุงุช ุ ูุณุชุฎุฏู ุงูุชุฏุงุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">pg_wait_sampling</a> .  ูุฌุจ ุฃู ูุชู ุชุฌููุนูุง ูู ุดูุฑุฉ ุงููุตุฏุฑ ุ  ุณูู ุฃุบูู ูุฐุง ุงูุฌุฒุก.  ุซู ูููู ุจุชุณุฌูู ุงูููุชุจุฉ ูู ุงููุนููุฉ <em>Shared_preload_libraries</em> ูุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SYSTEM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> shared_preload_libraries = <span class="hljs-string"><span class="hljs-string">'pg_wait_sampling'</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ sudo pg_ctlcluster 11 main restart</code> </pre><br>  ุงูุขู ุชุซุจูุช ุงูุชูุฏูุฏ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTENSION</span></span> pg_wait_sampling;</code> </pre><br>  ูุณูุญ ูู ุงูููุญู ุจุนุฑุถ ูุญููุธุงุช ุงูุชููุน ุ ูุงูุชู ูุชู ุชุฎุฒูููุง ูู ูุฎุฒู ูุคูุช ุฏุงุฆุฑู.  ูููู ุงูุดูุก ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู ูู ุฑุคูุฉ ููู ุชุนุฑูู ุงูุชููุนุงุช - ุงูุฅุญุตุงุกุงุช ุงููุชุฑุงููุฉ ุทูุงู ูุชุฑุฉ ุงูุนูู. <br><br>  ุฅููู ูุง ุณูุฑุงู ุฎูุงู ุจุถุน ุซูุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_wait_sampling_profile;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | event_type | event | queryid | count -------+------------+---------------------+---------+------- 29074 | Activity | LogicalLauncherMain | 0 | 220 29070 | Activity | WalWriterMain | 0 | 220 29071 | Activity | AutoVacuumMain | 0 | 219 29069 | Activity | BgWriterMain | 0 | 220 29111 | Client | ClientRead | 0 | 3 29068 | Activity | CheckpointerMain | 0 | 220 (6 rows)</code> </pre><br>  ูุธุฑูุง ูุนุฏู ุญุฏูุซ ุฃู ุดูุก ููุฐ ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู ุ ูุฅู ุงูุชููุนุงุช ุงูุฑุฆูุณูุฉ ูู ูู ููุน ุงููุดุงุท (ุนูููุงุช ุงูุฎุฏูุฉ ุชูุชุธุฑ ุญุชู ูุธูุฑ ุงูุนูู) ูุงูุนููู (ููุชุธุฑ psql ูููุณุชุฎุฏู ูุฅุฑุณุงู ุทูุจ). <br><br>  ุจุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ( <em>pg_wait_sampling.profile_period</em> ุงููุนููุฉ) ุ ุชููู ูุชุฑุฉ ุฃุฎุฐ ุงูุนููุงุช 10 ูููู ุซุงููุฉ ุ ุฃู ุ ูุชู ุญูุธ ุงูููู 100 ูุฑุฉ ูู ุงูุซุงููุฉ.  ูุฐูู ุ ูุชูุฏูุฑ ูุฏุฉ ุงูุงูุชุธุงุฑ ุจุงูุซูุงูู ุ ูุฌุจ ุชูุณูู ูููุฉ ุงูุนุฏุฏ ุนูู 100. <br><br>  ูููู ุชููุนุงุช ุงูุนูููุฉ ุงูุชู ุชูุชูู ุฅูููุง ุ ูุถูู ุทุฑููุฉ ุงูุนุฑุถ pg_stat_activity ุฅูู ุงูุทูุจ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.pid, a.backend_type, a.application_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> app, p.event_type, p.event, p.count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_wait_sampling_profile p <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> pg_stat_activity a <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.pid = a.pid <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> p.pid, p.count <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | backend_type | app | event_type | event | count -------+------------------------------+------+------------+----------------------+------- 29068 | checkpointer | | Activity | CheckpointerMain | 222 29069 | background writer | | Activity | BgWriterMain | 222 29070 | walwriter | | Activity | WalWriterMain | 222 29071 | autovacuum launcher | | Activity | AutoVacuumMain | 221 29074 | logical replication launcher | | Activity | LogicalLauncherMain | 222 29111 | client backend | psql | Client | ClientRead | 4 29111 | client backend | psql | IPC | MessageQueueInternal | 1 (7 rows)</code> </pre><br>  ุฏุนููุง ุชุญููู ูุน pgbench ููุฑู ููู ุชุชุบูุฑ ุงูุตูุฑุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ pgbench -i test</code> </pre><br>  ูููู ุจุฅุนุงุฏุฉ ุชุนููู ููู ุงูุชุนุฑูู ุงูุฐู ุชู ุฌูุนู ุฅูู ุตูุฑ ููุฌุฑู ุงูุงุฎุชุจุงุฑ ููุฏุฉ 30 ุซุงููุฉ ูู ุนูููุฉ ูููุตูุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_wait_sampling_reset_profile();</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ pgbench -T 30 test</code> </pre><br>  ูุฌุจ ุฅููุงู ุงูุทูุจ ูุจู ุงูุชูุงู ุนูููุฉ pgbench: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.pid, a.backend_type, a.application_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> app, p.event_type, p.event, p.count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_wait_sampling_profile p <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> pg_stat_activity a <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.pid = a.pid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> a.application_name = <span class="hljs-string"><span class="hljs-string">'pgbench'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> p.pid, p.count <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | backend_type | app | event_type | event | count -------+----------------+---------+------------+------------+------- 29148 | client backend | pgbench | IO | WALWrite | 8 29148 | client backend | pgbench | Client | ClientRead | 1 (2 rows)</code> </pre><br>  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุฅู ุชููุนุงุช ุนูููุฉ pgbench ุณุชููู ูุฎุชููุฉ ุจุนุถ ุงูุดูุก ุงุนุชูุงุฏูุง ุนูู ุงููุธุงู ุงููุญุฏุฏ.  ูู ุญุงูุชูุง ุ ูู ุงููุญุชูู ุฌุฏูุง ุชูุฏูู ุงูุชุธุงุฑ ุฅุฏุฎุงู ุณุฌู (IO / WALWrite) ุ ููู ูู ูุนุธู ุงูููุช ูู ุชุชููู ุงูุนูููุฉ ุ ูููููุง ูุนูุช ุดูุฆูุง ูููุฏูุง. <br><br><h2 style=";text-align:right;direction:rtl">  ุฃููุงู ุงูุถูุก </h2><br>  ูุฌุจ ุฃู ุชุชุฐูุฑ ุฏุงุฆููุง ุฃู ุนุฏู ูุฌูุฏ ุฃู ุชููุนุงุช ุนูุฏ ุฃุฎุฐ ุงูุนููุงุช ูุง ูุนูู ุนุฏู ูุฌูุฏ ุชููุนุงุช.  ุฅุฐุง ูุงูุช ุงููุชุฑุฉ ุฃูุตุฑ ูู ูุชุฑุฉ ุฃุฎุฐ ุงูุนููุงุช (ูุงุฆุฉ ุซุงููุฉ ูู ูุซุงููุง) ุ ููู ุชุชููู ุจุจุณุงุทุฉ ูู ุงููููุน ูู ุงูุนููุฉ. <br><br>  ูุฐูู ุ ูู ุชุธูุฑ ุฃููุงู ุงูุฅุถุงุกุฉ ูู ููู ุงูุชุนุฑูู - ูููููุง ุณุชุธูุฑ ุฅุฐุง ููุช ุจุฌูุน ุงูุจูุงูุงุช ููุชุฑุฉ ุทูููุฉ.  ูุถูุงู ุฅููุงุก ูุธุฑุฉ ุนูููุง ุ ููููู ุฅุจุทุงุก ูุธุงู ุงููููุงุช ุจุดูู ูุตุทูุน ุ ุนูู ุณุจูู ุงููุซุงู ุ ุงุณุชุฎุฏุงู ูุดุฑูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">slowfs</a> ุงููุจูู ุนูู ูุธุงู ุงููููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">FUSE</a> . <br><br>  ูุฐุง ูู ูุง ูููููุง ุฑุคูุชู ูู ููุณ ุงูุงุฎุชุจุงุฑ ุฅุฐุง ุงุณุชุบุฑูุช ุฃู ุนูููุฉ ุฅุฏุฎุงู / ุฅุฎุฑุงุฌ 1/10 ูู ุงูุซุงููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_wait_sampling_reset_profile();</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">student$ pgbench -T 30 test</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.pid, a.backend_type, a.application_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> app, p.event_type, p.event, p.count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_wait_sampling_profile p <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> pg_stat_activity a <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.pid = a.pid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> a.application_name = <span class="hljs-string"><span class="hljs-string">'pgbench'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> p.pid, p.count <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | backend_type | app | event_type | event | count -------+----------------+---------+------------+----------------+------- 29240 | client backend | pgbench | IO | WALWrite | 1445 29240 | client backend | pgbench | LWLock | WALWriteLock | 803 29240 | client backend | pgbench | IO | DataFileExtend | 20 (3 rows)</code> </pre><br>  ุงูุขู ุ ูุฑุชุจุท ุงูุชููุน ุงูุฑุฆูุณู ูุนูููุฉ pgbench ุจู I / O ุ ุฃู ุจุงูุฃุญุฑู ุ ุฅุฏุฎุงู ุณุฌู ูุชู ุชูููุฐู ูู ูุถุน ูุชุฒุงูู ูุน ูู ุงูุชุฒุงู.  ุจูุง ุฃูู (ููุง ูู ููุถุญ ูู ุงููุซุงู ุฃุนูุงู) ุ ูุฅู ูุชุงุจุฉ ุณุฌู ุฅูู ุงููุฑุต ูุญูู ุจูุงุณุทุฉ ููู ุงููุตุจุงุญ WALWriteLock ุ ูุฅู ูุฐุง ุงูููู ููุฌูุฏ ุฃูุถูุง ูู ุงูููู ุงูุดุฎุตู - ุฃุฑุฏูุง ุฃู ููุธุฑ ุฅููู. <br><br><h2 style=";text-align:right;direction:rtl">  ููุทุน ุงูุนุงุฒูุฉ </h2><br>  ูุฑุคูุฉ ุชุซุจูุช ุงููุฎุฒู ุงููุคูุช ุ ูุณุชููุฏ ูู ุญูููุฉ ุฃู ุงููุคุดุฑุงุช ุงูููุชูุญุฉ ุชุญูู ุงูุฏุจูุณ ุจุญูุซ ุชููู ูุฑุงุกุฉ ุงูุณุทุฑ ุงูุชุงูู ุฃุณุฑุน. <br><br>  ูุจุฏุฃ ุงููุนุงููุฉ ูููุชุญ ุงููุคุดุฑ ููุฎุชุงุฑ ุตููุง ูุงุญุฏูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">CURSOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pgbench_history; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> c;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> tid | bid | aid | delta | mtime | filler -----+-----+-------+-------+----------------------------+-------- 9 | 1 | 35092 | 477 | 2019-09-04 16:16:18.596564 | (1 row)</code> </pre><br>  ุชุญูู ูู ุชุซุจูุช ุงููุฎุฒู ุงููุคูุช (pinning_backends): <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_buffercache <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> relfilenode = pg_relation_filenode(<span class="hljs-string"><span class="hljs-string">'pgbench_history'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> relforknumber = <span class="hljs-number"><span class="hljs-number">0</span></span> \gx</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-[ RECORD 1 ]----+------ bufferid | 190 relfilenode | 47050 reltablespace | 1663 reldatabase | 16386 relforknumber | 0 relblocknumber | 0 isdirty | t usagecount | 1 pinning_backends | 1 &lt;--   1 </code> </pre><br>  ุงูุขู ุณูู ูููู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจูุณุญ</a> ุงูุฌุฏูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| pg_backend_pid | ---------------- | 29367 | (1 row)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">VACUUM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VERBOSE</span></span> pgbench_history;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| INFO: vacuuming "public.pgbench_history" | INFO: "pgbench_history": found 0 removable, 0 nonremovable row versions in 1 out of 1 pages | DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 732651 | There were 0 unused item pointers.</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| Skipped 1 page due to buffer pins, 0 frozen pages.</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| 0 pages are entirely empty. | CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s. | VACUUM</code> </pre><br>  ููุง ูุฑู ุ ุชู ุชุฎุทู ุงูุตูุญุฉ (ุชู ุชุฎุทู ุตูุญุฉ ูุงุญุฏุฉ ุจุณุจุจ ุงููุณุงููุฑ ุงููุคูุชุฉ).  ูู ุงููุงูุน ุ ูุง ูููู ููุชูุธูู ูุนุงูุฌุชู ุ ูุฃูู ููุญุธุฑ ุญุฐู ุฅุตุฏุงุฑุงุช ุงูุตููู ูุนูููุง ูู ุตูุญุฉ ูู ูุฎุฒู ูุคูุช ูุซุจุช.  ููู ุงูุชูุธูู ูู ููุชุธุฑ - ุณุชุชู ูุนุงูุฌุฉ ุงูุตูุญุฉ ูู ุงููุฑุฉ ุงููุงุฏูุฉ. <br><br>  ูุงูุขู ุณูููู ุจุนูููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชูุธูู ุจุงูุชุฌููุฏ</a> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">VACUUM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FREEZE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VERBOSE</span></span> pgbench_history;</code> </pre><br>  ูู ุฎูุงู ุงูุชุฌููุฏ ุงููุทููุจ ุจูุถูุญ ุ ูุง ููููู ุชุฎุทู ุตูุญุฉ ูุงุญุฏุฉ ุบูุฑ ูุญุฏุฏุฉ ูู ุฎุฑูุทุฉ ุงูุชุฌููุฏ - ูุฅูุง ูุฅูู ูู ุงููุณุชุญูู ุชูููู ุงูุญุฏ ุงูุฃูุตู ูุณู ุงููุนุงููุงุช ุบูุฑ ุงููุฌูุฏุฉ ูู pg_class.relfrozenxid.  ูุฐูู ุ ุชููู ุงูุชูุธูู ุญุชู ูุบูู ุงููุคุดุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> age(relfrozenxid) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-type"><span class="hljs-type">oid</span></span> = <span class="hljs-string"><span class="hljs-string">'pgbench_history'</span></span>::<span class="hljs-type"><span class="hljs-type">regclass</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> age ----- 27 (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>; <span class="hljs-comment"><span class="hljs-comment">--   </span></span></code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| INFO: aggressively vacuuming "public.pgbench_history" | INFO: "pgbench_history": found 0 removable, 26 nonremovable row versions in 1 out of 1 pages | DETAIL: 0 dead row versions cannot be removed yet, oldest xmin: 732651 | There were 0 unused item pointers.</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| Skipped 0 pages due to buffer pins, 0 frozen pages.</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| 0 pages are entirely empty. | CPU: user: 0.00 s, system: 0.00 s, elapsed: 3.01 s. | VACUUM</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> age(relfrozenxid) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_class <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-type"><span class="hljs-type">oid</span></span> = <span class="hljs-string"><span class="hljs-string">'pgbench_history'</span></span>::<span class="hljs-type"><span class="hljs-type">regclass</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> age ----- 0 (1 row)</code> </pre><br>  ุญุณููุง ุ ุฏุนูุง ููุธุฑ ุฅูู ููู ุชุนุฑูู ุงูุชููุนุงุช ูุฌูุณุฉ psql ุงูุซุงููุฉ ุงูุชู ุชู ูููุง ุชูููุฐ ุฃูุงูุฑ VACUUM: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> p.pid, a.backend_type, a.application_name <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> app, p.event_type, p.event, p.count <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_wait_sampling_profile p <span class="hljs-keyword"><span class="hljs-keyword">LEFT JOIN</span></span> pg_stat_activity a <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> p.pid = a.pid <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> p.pid = <span class="hljs-number"><span class="hljs-number">29367</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> p.pid, p.count <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | backend_type | app | event_type | event | count -------+----------------+------+------------+------------+------- 29367 | client backend | psql | BufferPin | BufferPin | 294 29367 | client backend | psql | Client | ClientRead | 10 (2 rows)</code> </pre><br>  ูุดูุฑ ููุน ุงูุงูุชุธุงุฑ BufferPin ุฅูู ุฃู ุงูุชุฏูู ูุงู ููุชุธุฑ ุชุญุฑูุฑ ุงููุฎุฒู ุงููุคูุช. <br><br>  ุนูู ูุฐุง ุณููุชุฑุถ ุฃููุง ุฃููููุง ุงูุฃููุงู.  ุดูุฑุง ููู ุฌููุนุง ุนูู ุงูุชูุงููู ูุงูุชุนูููุงุช! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar466199/">https://habr.com/ru/post/ar466199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar466187/index.html">ูุญุฑุฑ ุงูููุทู ุงููุฑุฆู ูู Unity3d. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar466191/index.html">ุงูุดูุก ุงูุฑุฆูุณู ุญูู ุงููุนุฑูุฉ ูู ุฃุฌู ุญูุงุฏูุฉ ุงูุดุจูุงุช ูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ุงูุฃูุฑูููุฉ ูู ุงูุชุณูุณู ุงูุฒููู ููุฃุญุฏุงุซ ูุงูุญุงูุฉ ุงูุฑุงููุฉ</a></li>
<li><a href="../ar466193/index.html">ุนุฑู MailChimp ุงูุชููุงุฆู ุชุบุฐูุฉ ูู ุขุฑ ุฅุณ ุฅุณ</a></li>
<li><a href="../ar466195/index.html">PVS-Studio 7.04</a></li>
<li><a href="../ar466197/index.html">PVS-Studio 7.04</a></li>
<li><a href="../ar466201/index.html">ููู ุชุชุฑู ุงูุนูู ูู ุชูููููุฌูุง ุงููุนูููุงุช ูุชุตุจุญ ูุฎุชุจุฑุงู: ุชุงุฑูุฎ ูููุฉ ูุงุญุฏุฉ</a></li>
<li><a href="../ar466203/index.html">ููู Techdir ูู ุณุงู ุจุทุฑุณุจุฑุฌ. ุงูุจูุฑุฉ ูุงูุจูุชุฒุง ูุงุซููู ูู ุงููููุฑููููุงุช</a></li>
<li><a href="../ar466211/index.html">ูุดุฑูุน ุฑุฆูุณู ูู ุฃูุฏุฑููุฏ 10</a></li>
<li><a href="../ar466213/index.html">4 ุฎุทูุงุช ูุฅูุดุงุก ููู ุชุนุฑูู ุงููุฑุดุญ</a></li>
<li><a href="../ar466215/index.html">ุชุตููู ูููุฐุฌู ุงูููุญู. ุฅูุดุงุก ูููุฐุฌ ููุซูู ุ ุจุงุณุชุฎุฏุงู ูุซุงู ูุจุงุฏู ุญุฑุงุฑู ููุทูุฑุงู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>