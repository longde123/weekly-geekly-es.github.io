<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåù üóª ü§≤üèΩ Comment rendre le cadre de la Terre du Milieu: L'Ombre du Mordor üë®‚Äçüëß‚Äçüëß üë¶ üíÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Middle Earth: Shadow of Mordor a √©t√© lanc√© en 2014. Le jeu lui-m√™me a √©t√© une grande surprise, et le fait qu'il s'agissait d'un spin-off de l'histoire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment rendre le cadre de la Terre du Milieu: L'Ombre du Mordor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/430518/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ow/br/se/owbrsedfx4zll9o8sxbxx2fbnza.gif"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Middle Earth: Shadow of Mordor a</a> √©t√© lanc√© en 2014.  Le jeu lui-m√™me a √©t√© une grande surprise, et le fait qu'il s'agissait d'un spin-off de l'histoire de l'univers du Seigneur de l'Anneau √©tait assez inattendu.  Le jeu a remport√© un grand succ√®s, et au moment de la r√©daction, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Monolith</a> a d√©j√† publi√© une suite - Shadow of War.  Les graphismes du jeu sont tr√®s beaux, d'autant plus qu'il est sorti pour diff√©rentes g√©n√©rations de consoles, dont la Xbox 360 et la PS3.  La version PC est assez bien polie, contient des options graphiques suppl√©mentaires et des packs de textures haute r√©solution qui r√©v√®lent pleinement le potentiel du jeu. <br><br>  Le jeu utilise le rendu diff√©r√© DX11 relativement nouveau.  J'ai utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Renderdoc</a> pour apprendre en profondeur les techniques de rendu du jeu.  Lors du travail, le maximum de param√®tres graphiques possibles (ultra) a √©t√© utilis√© et toutes les ¬´lotions¬ª possibles ont √©t√© incluses, telles que la transparence ind√©pendante de l'ordre, la mosa√Øque, l'occlusion dans l'espace de l'√©cran et divers flous de mouvement. <br><a name="habracut"></a><br><h2>  Cadre </h2><br>  Voici un cadre que nous analyserons.  Le joueur est situ√© sur une plateforme en bois dans la r√©gion d'Udun.  Shadow of Mordor utilise des m√©canismes similaires √† ceux de jeux comme Assassin's Creed, o√π vous pouvez escalader des b√¢timents et des tours, puis profiter du paysage num√©rique environnant depuis les toits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73d/325/3e0/73d3253e0323327f95babf989f060f93.jpg" alt="image"></div><br><h2>  Passage en profondeur </h2><br>  Les quelque 140 premiers appels de rendu font une passe pr√©liminaire rapide pour rendre les √©l√©ments d'√©l√©vation et les b√¢timents les plus grands au tampon de profondeur.  La plupart des objets ne tombent pas dans cette passe pr√©liminaire, mais cela aide lorsque le jeu a un tr√®s grand nombre d'appels de tirage et que vous pouvez regarder loin.  Fait int√©ressant, un personnage qui est toujours au centre de l'√©cran et occupe une fraction d√©cente de l'espace d'√©cran ne tombe pas dans ce passage.  Comme dans de nombreux autres jeux en monde ouvert, le moteur utilise les valeurs z inverses.  Cette technique lie le plan proche √† 1,0 et le plan lointain √† 0,0 pour augmenter la pr√©cision √† de grandes distances et √©viter les conflits z.  En savoir plus sur la pr√©cision du tampon z <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/181/ba6/57d/181ba657ddc430ee3a892e852cc276e9.png" alt="image"></div><br><h4>  G-buffer </h4><br>  Imm√©diatement apr√®s cela, la passe du tampon G commence, qui est effectu√©e dans environ 2700 appels de tirage.  Si vous avez lu mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">analyse pr√©c√©dente de Castlevania: Lords of Shadow 2</a> ou √©tudi√© d'autres articles similaires, ce passage devrait vous √™tre familier.  La propri√©t√© des surfaces est enregistr√©e dans un ensemble de tampons, qui sont ensuite lus dans les passes du calcul d'√©clairage pour calculer les r√©actions des surfaces √† la lumi√®re.  Shadow of Mordor utilise un rendu diff√©r√© classique, mais un nombre relativement faible de cibles de rendu du G-buffer est utilis√© pour atteindre cet objectif (3).  A titre de comparaison: Unreal Engine dans ce passage utilise 5-6 tampons.  G-buffer a le sch√©ma suivant: <br><br><h5>  Tampon normal </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Un</strong> </td></tr><tr><td>  <strong>Normal.x</strong> </td><td>  <strong>Normal.y</strong> </td><td>  <strong>Normal.z</strong> </td><td>  <strong>Identifiant</strong> </td></tr></tbody></table><br>  Le tampon des normales stocke les normales dans l'espace mondial au format ¬´8 bits par canal¬ª.  Cela suffit √† peine, et parfois pas du tout, pour d√©crire des surfaces plates variant en douceur.  Si vous regardez attentivement, cela peut √™tre vu dans certaines flaques d'eau dans le jeu.  Le canal alpha est utilis√© comme identifiant qui marque diff√©rents types d'objets.  Par exemple, j'ai d√©couvert que 255 fait r√©f√©rence au personnage, 128 √† la partie anim√©e du drapeau, et le ciel est marqu√© avec ID 1, car plus tard ces identifiants sont utilis√©s pour le filtrer au stade de l'ajout (le ciel obtient sa propre floraison radiale). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/jf/y8/zajfy84cg-abqarjiybgm3qcztw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9k/aq/4v/9kaq4vempyj-n14_kdfte3d51ss.png"></div><br>  <i>Dans l'article d'origine, ces images et bien d'autres sont anim√©es pour plus de clart√©, donc je vous recommande d'y regarder.</i> <br><br><h5>  Albedo tampon </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Un</strong> </td></tr><tr><td>  <strong>Albedo.r</strong> </td><td>  <strong>Albedo.g</strong> </td><td>  <strong>Albedo.b</strong> </td><td>  <b>Occlusion de la cavit√©</b> </td></tr></tbody></table><br>  Le tampon d'alb√©do stocke les trois composants de l'alb√©do et une occlusion √† petite √©chelle (parfois appel√©e occlusion de cavit√©), qui est utilis√©e pour ombrer de petits d√©tails qui ne peuvent pas √™tre obtenus avec une carte d'ombre ou un post-traitement dans l'espace de l'√©cran.  Il est principalement utilis√© √† des fins d√©coratives, par exemple, des trous et des plis sur les v√™tements, de petites fissures dans un arbre, de petits motifs sur les v√™tements de Talion, etc. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/t6/ul/bz/t6ulbzqtlw3ncodrlnd49uxtmwa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/28/52/lr/2852lrdq75bxtqpkywvutfsm4se.png"></div><br>  Lors du traitement des ennemis dans le shader, l'alb√©do prend en compte la texture du sang (il est int√©ressant de noter que Talion n'a jamais de blessures visibles).  La texture du sang est l'entr√©e pour la phase de rendu des v√™tements et du corps des ennemis, mais elle ne sp√©cifie pas la couleur du sang, qui est l'entr√©e dans le tampon constant, mais d√©termine les facteurs / niveaux de sang pour contr√¥ler la quantit√© de sang affich√©e.  De plus, l'orientation normale est utilis√©e pour mettre √† l'√©chelle l'effet, vous permettant de contr√¥ler la direction des √©claboussures de sang.  Ensuite, l'alb√©do s'obscurcit essentiellement avec la luminosit√© des blessures re√ßues par l'ennemi, prises √† l'endroit correspondant sur la carte du sang, et modifie √©galement d'autres propri√©t√©s, telles que sp√©culaires, pour obtenir un effet sanguin convaincant.  Je n'ai pas pu trouver la partie du cadre dans laquelle la carte est rendue, mais je suppose qu'elles sont enregistr√©es d√®s le d√©but du cadre lorsque l'√©p√©e est expos√©e, puis utilis√©es ici. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1y/_r/rt/1y_rrtgi8bsuryvjmqmpdvzwpfk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mi/tv/nu/mitvnumojb0zx4qhzohrgrj810e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qp/wx/t7/qpwxt7y4r-k3ugakdasysx1vtvm.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6d/-r/lz/6d-rlzgi7fvdep6xrxnakmjp9yg.png"></div><br><h5>  Tampon sp√©culaire </h5><br><table><tbody><tr><td>  <strong><font color="#ff0000">R</font></strong> </td><td>  <strong><font color="#00ff00">G</font></strong> </td><td>  <strong><font color="#0000ff">B</font></strong> </td><td>  <strong>Un</strong> </td></tr><tr><td>  <b>Rugosit√©</b> </td><td>  <b>Intensit√© sp√©culaire</b> </td><td>  <b>Fresnel</b> </td><td>  <b>Facteur de diffusion souterraine</b> </td></tr></tbody></table><br>  Le tampon sp√©culaire contient d'autres propri√©t√©s de surface que l'on peut s'attendre √† voir dans les jeux, telles que la rugosit√© (ce n'est pas tout √† fait de la rugosit√©, mais un degr√© sp√©culaire √† l'√©chelle, mais il peut √™tre interpr√©t√© de cette fa√ßon), l'intensit√© sp√©culaire (la luminosit√© de la r√©flexion sp√©culaire) qui √©volue l'alb√©do pour obtenir le facteur de r√©flexion sp√©culaire de couleur correct (commun√©ment appel√© F0 dans la litt√©rature, car il s'agit de l'entr√©e de la r√©ponse du miroir de Fresnel) et du composant de diffusion souterraine (diffusion souterraine).  Ce dernier composant est utilis√© pour √©clairer les mat√©riaux translucides tels que les tissus fins, les plantes et la peau.  Si plus tard nous plongons dans l'√©tude du shader d'√©clairage, nous constatons que nous utilisons ici la variation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le sp√©culaire normalis√© selon Blinn-Fong</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qx/rv/8c/qxrv8c9xk-4-akibiogsgnvxszw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wv/xw/_f/wvxw_f6h-5vgmu6cvlucuum3sei.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/f3/v1/fbf3v1y8ardyfkjtshlv8zf5ld8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ql/zq/lz/qlzqlzbbxwy_mlx05pwxwpxmrga.png"></div><br><h5>  Autocollants diff√©r√©s </h5><br>  Comme nous l'avons vu ci-dessus, Shadow of Mordor affiche des traces de sang assez d√©taill√©es sur les personnages bless√©s.  Lorsque Talion agite son √©p√©e, l'environnement re√ßoit √©galement sa part de sang d'orque noir.  Cependant, une autre technique est utilis√©e pour les environnements - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©calcomanies diff√©r√©es</a> .  Cette technique consiste √† projeter un ensemble de textures plates sur la surface de ce qui a √©t√© pr√©c√©demment rendu.  De cette fa√ßon, le contenu du G-buffer est remplac√© par ce nouveau contenu avant d'effectuer la passe d'√©clairage.  Dans le cas du sang, une simple pulv√©risation sanglante suffit, et lors du rendu de nombreux d√©calques √† tour de r√¥le, un paysage plut√¥t sombre est rapidement cr√©√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8_/zo/no/8_zonoux0rx6h_cemftpprebcke.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pk/sc/qn/pkscqng3m2s0c2hj-e-fs1eonis.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/a4/uf/rs/a4ufrsgki8blucgm4g8zq3n95ha.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dj/jl/3c/djjl3c5s2dsimxwtoim-c5vk3rg.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/hj/cb/wjhjcbcfdu0ts1kpnmh_2_tvhdq.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8r/tk/fi/8rtkfinzlyym0jweyx0gpizv4zs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uh/ns/pw/uhnspwmomqsrlnoctsokx8q878a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/di/7m/70/di7m700h63pqtmaiydgrezyt0w4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8t/ky/sz/8tkyszkhinic56jqebsteeudram.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0a/tu/kj/0atukjo4vjzv3djehm6sttjhqps.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-5/vm/ja/-5vmjatrsxyfdjhqm5nhsmu_vxw.png"></div><br>  La derni√®re chose qui est rendue dans le passage du tampon G est le ciel, la texture du ciel est en tr√®s haute r√©solution (8192 √ó 2048) au format HDR BC6H.  J'ai d√ª faire une petite correction de tonalit√©, car en HDR toutes les couleurs sont trop sombres. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95a/6b2/dda/95a6b2dda3a632aebe8fc902f143232d.jpg" alt="image"></div><br><h3>  Tessellation </h3><br>  Une ¬´fonctionnalit√©¬ª tr√®s int√©ressante du jeu (si elle est activ√©e) est la tessellation.  Il est utilis√© pour de nombreuses choses diff√©rentes, du terrain au rendu des personnages (ainsi que des accessoires et des objets de personnages).  Ici, la tessellation ne subdivise pas le maillage low poly, mais cr√©e des polygones √† partir d'un nuage de points, en utilisant le degr√© de subdivision n√©cessaire, en fonction des crit√®res du niveau de d√©tail, par exemple, de la distance √† la cam√©ra.  Un exemple int√©ressant est la cape Talion, qui est transmise au GPU sous forme de nuage de points (apr√®s simulation physique), et le shader de pavage recr√©e les polygones. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1i/jf/3i/1ijf3ikncscrhyvhjyyan6kdx80.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wj/fp/il/wjfpil_rw7_t1z7pxrfntobcrse.png"></div><br><h3>  Transparence ind√©pendante des commandes </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b78/f09/897/b78f09897b7ed45f990f51f91291c967.png"></div><br>  L'une des premi√®res choses qui m'a frapp√© par son √©tranget√© est le traitement capillaire, car il effectue un shader sp√©cial tr√®s complexe.  Dans les options graphiques, l'option OIT (Order-Independent Transparency) pour les cheveux est mentionn√©e, c'est-√†-dire qu'elle devrait l'√™tre.  Premi√®rement, il effectue la sortie vers un tampon s√©par√© et calcule le nombre total de pixels transparents superpos√©s les uns aux autres, tout en sauvegardant les propri√©t√©s dans une structure "profonde" similaire √† un tampon G.  Plus tard, un autre shader trie les fragments individuels selon leur profondeur.  Il semble que les fl√®ches rendent √©galement de cette fa√ßon (probablement, leur plumage n√©cessite un tri appropri√©).  C'est un effet tr√®s subtil qui n'ajoute aucune diff√©rence graphique particuli√®re, mais c'est quand m√™me un d√©tail int√©ressant.  Voici un exemple simple: l'image ci-dessus montre le nombre de fragments qui se chevauchent (le plus rouge, le plus de fragments).  La transparence r√©guli√®re est toujours tri√©e par le processeur et rendue en alpha traditionnel.  Seules les entit√©s individuelles tombent dans la passe OIT. <br><br><h3>  Ombres du Mordor </h3><br>  SoM a de nombreuses sources d'ombre.  En plus des cartes d'ombre traditionnelles des sources de lumi√®re dynamiques, SoM utilise une occlusion ambiante √† deux canaux dans l'espace de l'√©cran, une occlusion √† micro-√©chelle cr√©√©e pour presque tous les objets du jeu et une texture d'occlusion similaire √† une carte de hauteur avec une vue de dessus. <br><br><h5>  Occlusion dans l'espace √©cran </h5><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2cb/58c/fc5/2cb58cfc57777d65a15af4813977c962.png"></div><br>  Le premier passage est rendu en utilisant le tampon G ambiant et l'occlusion sp√©culaire dans l'espace d'√©cran.  Le shader lui-m√™me est un √©norme cycle d√©pli√© qui √©chantillonne √† la fois la carte de profondeur en taille r√©elle et la carte de profondeur moyenne pr√©c√©demment r√©duite, √† la recherche d'√©chantillons voisins dans un mod√®le donn√©.  Il utilise une texture carr√©e 4x4 pour s√©lectionner des vecteurs pseudo-al√©atoires √† la recherche de sources d'occlusion.  Il rend un tampon d'occlusion bruyant, qui est ensuite liss√© par un simple flou en deux passes.  La caract√©ristique la plus int√©ressante ici est qu'il existe deux canaux d'occlusion diff√©rents: l'un d'eux est utilis√© comme occlusion sp√©culaire et l'autre comme occlusion diffuse.  Dans les impl√©mentations SSAO standard, un canal est calcul√© qui s'applique √† tout l'√©clairage cuit.  Ici, la carte SSAO est √©galement lue pour √™tre transmise au passage d'√©clairage directionnel, le cas √©ch√©ant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/re/xf/kj/rexfkjx49htyufzecfeg2n7lsau.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/dl/va/nz/dlvanzzg8bpcqughsrout8kaxlg.png"></div><br><h5>  Cartes fant√¥mes </h5><br>  L'√©v√©nement suivant est le rendu de la carte d'ombre.  √âtant donn√© que l'action du jeu se d√©roule principalement dans des espaces ouverts, la plupart de la lumi√®re et des ombres proviennent de la lumi√®re directionnelle principale.  Nous utilisons ici la technique des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cartes d'ombres en cascade</a> (dont une variante est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://">des cartes d'ombres divis√©es parall√®les</a> ), une technique assez standard pour appliquer des ombres sur de longues distances, qui consiste √† rendre la m√™me sc√®ne d'un point de vue de la source lumineuse pour diff√©rentes zones de l'espace.  Habituellement, les cartes ombr√©es √©loign√©es de la zone de couverture de la cam√©ra sont √† de grandes distances ou ont une r√©solution inf√©rieure aux pr√©c√©dentes, ce qui r√©duit essentiellement la r√©solution dans les zones o√π les d√©tails ne sont toujours pas n√©cessaires en raison du fait que la g√©om√©trie est trop √©loign√©e.  Dans cette sc√®ne, le jeu affiche trois cascades d'ombres 4096 √ó 4096 (en fait, le jeu a une place pour quatre).  La cascade sup√©rieure est tr√®s proche de Talion, et celle du bas comprend des montagnes et des objets tr√®s loin de la cam√©ra.  Lorsque vous travaillez avec des ombres, le jeu utilise la m√™me astuce avec la coordonn√©e z inverse que dans la carte de profondeur. \ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/347/7bc/a65/3477bca65b8cff92dfcfd68c9d66b8a8.jpg"></div><br><h5>  Tampon d'ombre </h5><br>  L'√©tape suivante consiste √† cr√©er un tampon cach√©.  Il s'agit d'une texture monocanal, bas√©e sur les informations d'occlusion des cartes d'ombre pr√©c√©dentes, elle code un facteur d'ombre dans l'intervalle [0, 1].  Pour cr√©er un lissage autour des bords, la carte d'ombre est √©chantillonn√©e 4 fois en utilisant l'√©tat d'un √©chantillonneur bilin√©aire sp√©cial, qui re√ßoit 4 √©chantillons et les compare avec une valeur donn√©e (c'est ce qu'on appelle le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://">filtrage de fermeture en pourcentage</a> ).  L'obtention de plusieurs √©chantillons et la moyenne de leurs r√©sultats sont souvent appel√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ombres douces plus proches en pourcentage</a> .  En plus de lire la carte des ombres, la derni√®re composante du tampon sp√©culaire (c'est-√†-dire le coefficient de diffusion souterraine) est √©galement √©chantillonn√©e, qui est multipli√©e par le ¬´facteur de saignement l√©ger¬ª.  Il semble que cela soit n√©cessaire pour √©liminer l'ombrage de ces objets, afin qu'un peu plus de lumi√®re les traverse. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b7f/b55/63f/b7fb5563faae1553e0f970374ee0b774.jpg"></div><br><h5>  Texture de projection directionnelle </h5><br>  Une autre source de lumi√®re et d'ombre est une texture vue de dessus √©chantillonn√©e par une source de lumi√®re directionnelle.  Il s'agit de la dominante de couleur ajout√©e √† la couleur de la source de lumi√®re directionnelle, plus l'effet de l'ombrage global qui s'applique √† l'√©clairage directionnel.  Il semble que certains d'entre eux ont √©t√© cr√©√©s manuellement au-dessus d'une carte d'√©clairage de niveau g√©n√©r√©e automatiquement avec une vue de dessus.  Il semble que les bords des ombres pour la g√©om√©trie statique soient ajust√©s manuellement (peut-√™tre pour √©viter les conflits avec la vraie carte des ombres), et certaines parties semblent √©galement √™tre l√©g√®rement teint√©es √† la main.  La t√¢che de cette texture est probablement l'ajout √† faible co√ªt d'occlusion ambiante √† grande √©chelle et de simulations d'√©clairage global l√©g√®res en plus de l'√©clairage directionnel.  Les images ci-dessous montrent la teinte, l'occlusion et le produit des deux facteurs, ce qui nous donne une id√©e de ce √† quoi ressemble le masque de couleur final. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6v/vf/6a/6vvf6aaf5khdrbclmwpzp9_faka.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7e/fs/fe/7efsferrjbdtsu9megpk0gtfidc.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sd/bk/sv/sdbksv3a4jlkgzxui4nvl-suylq.png"></div><br>  Le r√©sultat de toutes les passes d'√©clairage est enregistr√© dans la cible de rendu du format R11G11B10F.  Voici √† quoi ressemble le r√©sultat.  J'ai effectu√© une correction tonale des r√©sultats pour rendre plus visible l'effet de l'√©clairage directionnel au niveau. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f2a/28e/a63/f2a28ea6372642667b3778dfc32b193f.jpg"></div><br>  Toutes les montagnes √©loign√©es (non repr√©sent√©es dans l'image ci-dessus) sont √©galement √©clair√©es par la lumi√®re directionnelle, mais elles sont mises en √©vidence comme un bo√Ætier s√©par√© afin que l'√©clairage puisse √™tre mieux contr√¥l√©.  Certains sont √† l'√©chelle, mais ceux plus loin sont en fait des imposteurs avec des cartes normales et alb√©do intelligemment cr√©√©es.  Ils ont des sources sp√©ciales d'√©clairage directionnel qui n'affectent que les montagnes. <br><br><h3>  √âclairage statique </h3><br>  Shadow of Mordor utilise une impl√©mentation d'√©clairage statique tr√®s gourmande en m√©moire, qui utilise des textures de tr√®s grand volume.  L'image ci-dessous montre trois textures statiques pour la quantit√© d'√©clairage utilis√©e pour √©clairer de mani√®re diffuse une partie de cette zone.  Chacun d'eux est une √©norme texture compress√©e 512x512x128 BC6H, c'est-√†-dire qu'ils occupent 32 Mo par texture ou 96 Mo en g√©n√©ral (nous jouons avec des param√®tres de qualit√© maximale).  La texture de la couleur indique l'intensit√© entrant dans le voxel.  Les deux autres indiquent la force ou l'amplitude de cette intensit√© dans les six directions xyz et -xyz, et la normale est utilis√©e pour s√©lectionner trois composantes (xyz positive ou n√©gative, celles qui sont les plus coh√©rentes avec la normale).  Apr√®s avoir construit ce vecteur, nous prenons son produit vectoriel par le carr√© de la normale, et cela devient le facteur d'√©chelle pour l'intensit√©.  La formule est la suivante: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/l9/yw/vk/l9ywvkgxuoti8bbppke_2c8o068.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ez/j3/uf/ezj3ufolhefyqxafjqskci0msho.png"></div><br>  Les volumes de lumi√®re statique rendent √©galement une carte cubique pour l'√©clairage sp√©culaire, qui est probablement captur√© au centre du SLV.  Chose int√©ressante, les textures de volume stockent des valeurs HDR compress√©es au BC6H et les cartes cubiques sont stock√©es au format BC3 (DXT5), qui ne peut pas stocker de valeurs √† virgule flottante.  Pour compenser cette limitation, le canal alpha conserve la luminosit√©, qui passe ensuite de 1 √† 10.  C'est une d√©cision un peu bizarre, et pour moi, cela ressemble plus √† une impl√©mentation Legacy.  N'oubliez pas que le jeu a √©t√© publi√© pour les consoles de g√©n√©ration pr√©c√©dente, qui ne prennent pas en charge les nouveaux formats de texture HDR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k3/qo/z-/k3qoz-zblorjdxi7jyqthripztg.png"></div><br>  Les cadres ci-dessous montrent les r√©sultats ¬´avant et apr√®s¬ª en tenant compte de l'impact de l'image moyenne.  Pour la visualisation, j'ai effectu√© une correction tonale. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4i/iq/yo/4iiqyosjg2tmdud840rxbhstofa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/su/of/cd/suofcd-ls4myfuivd5vqb9ykbgi.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/37/rq/wb/37rqwb76ngards_rywaxhb_x9xw.png"></div><br><h3>  Brouillard atmosph√©rique </h3><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9af/086/c47/9af086c474cada9250daae007ec3c8bc.jpg"></div><br>  Shadow of Mordor a un syst√®me m√©t√©o et horaire, gr√¢ce auquel le soleil brille ou la pluie se d√©verse √† travers le jeu dans Mordor.  Ce syst√®me est contr√¥l√© par la somme des composants, et l'un des plus importants est le brouillard.  Shadow of Mordor utilise un mod√®le de brouillard atmosph√©rique assez simple mais physiquement solide, y compris <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la</a> diffusion de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rayleigh</a> unique, ainsi que la diffusion par une particule sph√©rique (diffusion Mie). <br><br>  Il commence par calculer la position de la cam√©ra par rapport au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">centre de la terre</a> .  Plusieurs formules trigonom√©triques permettent de d√©terminer o√π se trouve la cam√©ra dans l'atmosph√®re, o√π se trouve le pixel, et quelle distance le faisceau parcourt dans l'atmosph√®re √† une hauteur maximale donn√©e de l'atmosph√®re.  Dans notre cas, l'atmosph√®re est situ√©e √† une hauteur de 65 000 m√®tres au-dessus de la surface de la plan√®te.  Compte tenu de ces informations, Rayleigh et les coefficients de particules sph√©riques sont utilis√©s pour calculer √† la fois les types de densit√©s des particules de brouillard et leurs couleurs.  Ces densit√©s obscurcissent les pixels d√©j√† ombr√©s, diffusant la lumi√®re entrant dans la cam√©ra depuis la surface ombrag√©e et contribuant au brouillard.  Lors de la simulation d'une telle diffusion, la luminosit√© et la direction du soleil sont prises en compte. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ye/at/id/yeatidzdiemga1gntnm1zg9uz8k.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zj/39/zr/zj39zryuhmwdyadmcp0nb_g1uz8.png"></div><br><h3>  Vitesse d'obturation et correction de tonalit√© </h3><br>  Lors du calcul de la vitesse d'obturation, une approche assez standard est utilis√©e: la r√©duction s√©quentielle de la r√©solution du tampon de luminosit√©, calcul√©e √† partir du tampon de couleur HDR principal, en une cha√Æne de textures, chacune ayant la moiti√© de la taille de la texture pr√©c√©dente, en commen√ßant par une texture 1/3 du tampon de cadre principal.  Avec cette diminution de r√©solution, 4 √©chantillons sont pr√©lev√©s, faisant la moyenne des valeurs des pixels voisins, c'est-√†-dire qu'apr√®s avoir converti toutes les valeurs moyennes en un seul texel, le r√©sultat final devient une luminosit√© moyenne.  Une fois que la texture atteint la taille de 16 √ó 9 texels, un shader de calcul est lanc√©, r√©sumant tous les texels restants.  Cette valeur est imm√©diatement lue dans la passe de correction de tonalit√© pour modifier les valeurs de luminosit√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ig/bi/h4/igbih41dc2x9aytucfgq1z_iuye.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/gw/t8/osgwt8co0pqgvomovsydsemapuw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qh/bc/qv/qhbcqvqxy5hgvtn9x0c9kd1an6e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/dw/fm/g-dwfm48oqtvuu1bizc1sikm7sq.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zg/8w/oz/zg8wozwpviq0nnt4-kef9b9azis.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/56/ik/dc/56ikdcoixmrbo0whghswhxdzxhk.png"></div><br>  Pour la correction de tonalit√©, l'op√©rateur Reinhardt est utilis√©, dont une formule optimis√©e peut √™tre trouv√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  En code hlsl, cela ressemblera √† ceci: <br><br><pre><code class="cpp hljs">float3 hdrColor = tex2D(HDRTexture, uv.xy); hdrColor *= exposureValue; <span class="hljs-comment"><span class="hljs-comment">// This was calculated by the compute shader in the luminance downsampling pass float3 x = max(0.0, hdrColor - 0.004); float3 finalColor = (x * (6.2 * x + 0.5)) / (x * (6.2 * x + 1.7) + 0.06);</span></span></code> </pre> <br>  Si nous tra√ßons cette courbe, nous verrons que cet op√©rateur rejette 10% des valeurs blanches m√™me avec une valeur d'entr√©e de 2,0, tout en laissant de force une petite partie de l'intervalle inf√©rieur compl√®tement noire.  Cela cr√©e une image sombre et d√©satur√©e. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc2/ea1/097/cc2ea10970239fb761b995496c049a8b.jpg" alt="image"></div><br><h3>  Stade Alpha </h3><br>  L'√©tape alpha est un peu inhabituelle car elle rend les objets directement dans le tampon LDR.  D'autres jeux les rendent √©galement dans le tampon HDR afin qu'ils puissent participer au passage d'obturateur.  Quoi qu'il en soit, la texture de luminosit√© pr√©c√©demment calcul√©e est limit√©e √† tous les objets illumin√©s par alpha (dans certains cas, par exemple, pour les objets √©lectroluminescents, la vitesse d'obturation est calcul√©e en utilisant les constantes de shader, pas la recherche de texture), et donc la vitesse d'obturation est appliqu√©e automatiquement lors du rendu, et non effectu√©e en post-traitement.  Un cas tr√®s sp√©cifique d'utilisation de l'alpha dans un jeu est une transition vers le mode fant√¥me (le fant√¥me de Celebrimbor y est rendu au-dessus du personnage du joueur, forg√© dans les anneaux souverains de l'univers LOTR; ainsi, le jeu montre qu'il est toujours √† proximit√©, bien qu'invisible).  Le jeu transmet plusieurs param√®tres aux mailles des deux personnages, qui contr√¥lent l'opacit√© et permettent au jeu d'obscurcir partiellement Talion et de montrer progressivement Celebrimore.  D'autres objets du jeu en mode fant√¥me rendent √©galement des versions fant√¥mes au-dessus d'objets opaques, tels que des ennemis et des tours.  Voici une autre sc√®ne avec la transition vers le monde fantomatique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ux/ca/zs/uxcazsok9pqzuusfrb__dutdphw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6g/1c/9e/6g1c9esdqit50db_mbck516ma-0.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f_/dq/ss/f_dqss-avlzlyrb4s6_z6kqog0e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uw/yy/va/uwyyvakydfnsksy49ntfltpbwp8.png"></div><br><h3>  La pluie </h3><br>  Dans le cadre principal que nous avons examin√©, il n'y a pas de pluie, mais la m√©t√©o est une partie tellement importante du jeu que je voudrais le mentionner ici.  Il est g√©n√©r√© et simul√© dans le GPU, et rendu juste √† la fin de la phase alpha.  Un shader de calcul est ex√©cut√© qui ex√©cute la simulation et √©crit les positions dans le tampon.  Ces positions sont prises par un autre shader qui, √† l'aide d'un appel indirect instanci√©, rend autant d'instances de quads que les positions ont √©t√© calcul√©es lors de la passe pr√©c√©dente.  Le vertex shader a un simple quad qui, si n√©cessaire, est d√©form√© et tourne vers la cam√©ra.  Pour emp√™cher la pluie de p√©n√©trer dans les surfaces, le vertex shader lit √©galement les cartes de hauteur √† partir d'une vue de dessus, ce qui vous permet de rejeter toutes les gouttes sous la surface qui se chevauchent.  Cette carte de hauteur est rendue juste au d√©but du cadre.  Le m√™me vertex shader indique au pixel shader o√π obtenir l'√©chantillon de la texture de goutte;  si la goutte est proche de la surface, elle s√©lectionne une zone de texture contenant une animation de d√©marrage.  De plus, les gouttes de pluie effectuent des calculs de brouillard dans le pixel shader pour se fondre parfaitement avec le reste de la sc√®ne.  Voici une capture d'√©cran du m√™me point de vue un jour de pluie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xv/yv/ds/xvyvds_w25ybjxilgvr5crbcpo4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/ox/ax/3coxaxhejifprppkaheiahszfcm.png"></div><br>  Lorsque l'effet de pluie est activ√©, le tampon sp√©culaire est globalement modifi√© pour cr√©er des surfaces humides et les vagues de pluie sont restitu√©es dans le tampon normal.  L'animation est chronom√©tr√©e, donc une seule image de l'animation en boucle est utilis√©e.  Le tampon normal illustr√© ci-dessous est modifi√© pour afficher les ondes rendues dans le tampon. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ur/du/mz/urdumzhuebf1o2pnud_b2ztlfik.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p3/cv/t_/p3cvt_qq7vo9txgwycf7l2oec2y.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vc/3d/u3/vc3du3ytthqfsw1h7vwzr0tfxom.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6y/tk/rk/6ytkrkj0w38kvccrtrjpey95c_w.png"></div><br><h3>  Fus√©es √©clairantes et Bloom </h3><br>  Une fois le rendu alpha termin√©, les reflets de l'objectif sont rendus par-dessus.  Une s√©rie de quads d√©cal√©s est rendue √† partir du point d'o√π vient la lumi√®re directionnelle (dans notre cas, le soleil).  Imm√©diatement apr√®s cela, une passe de floraison est effectu√©e.  Il s'agit d'une technique assez standard, qui consiste en une s√©rie de textures de taille r√©duite et floues contenant des pixels dont la luminosit√© d√©passe un certain seuil.  Deux passes de floraison sont utilis√©es, communes avec le flou gaussien pour toute la sc√®ne et un flou radial sp√©cial qui ne s'applique qu'au ciel.  Le flou radial est l'une des op√©rations qui utilise un identifiant sp√©cial du tampon G des cartes normales, car seuls les pixels du ciel sont pris en compte.  En prime, ce flou √©chantillonnera la carte de profondeur et peut cr√©er des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rayons cr√©pusculaires √†</a> faible co√ªt.  Puisque nous travaillons avec un tampon LDR √† ce stade, la valeur du seuil de floraison est diff√©rente de la valeur du tapis HDR (les valeurs sup√©rieures au seuil, g√©n√©ralement 1,0, conduisent au calcul), ce qui signifie que la valeur de la floraison obtenue √† partir de celui-ci est l√©g√®rement limit√©e.  En tout cas, c'est bon pour le jeu et voici les r√©sultats.  Dans les images ci-dessous, les couleurs de la texture du mip de floraison semblent un peu √©tranges car chaque pixel est mis √† l'√©chelle par la luminosit√© contenue dans le canal alpha.  Cette luminosit√© a √©t√© calcul√©e plus t√¥t, au stade de la correction tonale.  Dans la composition finale, la floraison est calcul√©e comme <strong>bloom.rgb ¬∑ bloom.a ¬∑ bloomScale</strong> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/h3/2y/ra/h32yra8lvz_-pxsab9raxyfobei.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/le/2k/dx/le2kdxxuaqtjrdnhdvxfobubyhw.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/kz/mk/jbkzmkd2ans3vxvs_we9eowudvs.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/xs/gs/dg/xsgsdgnvhckxgckfhs7k4hvpc7u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/v3/yr/hh/v3yrhhxazolya5nu8fn7id66p6k.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q8/r1/wl/q8r1wlekxf0tae6ivo6bfyjngie.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/5c/tj/gw5ctjh8owpukokne73nskb4n48.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8k/te/sg/8ktesgsr6ser_l6ssaorfcpniww.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/j6/u6/ts/j6u6tsvqcjuwqqzepsfeogf330i.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ee/tf/vg/eetfvgkcuahvbbonuhfnpinh32w.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m-/zw/bc/m-zwbcp4qvnr69vn1unq1clh3ws.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ei/ta/-s/eita-ssnu2cqzwkspcrjan42-ua.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/db/cb/cs/dbcbcsoo_znq2ex30ixasi-c8le.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/ja/ro/i4jarols6px4f0nnbai-rk5r87u.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/na/ag/mj/naagmjq8e75kxcxmyhberqpslag.png"></div><br><h3>  Anticr√©nelage + profondeur de champ </h3><br>  Il n'y a pas grand-chose √† dire sur ces deux op√©rations; des approches standard de l'industrie sont utilis√©es.  Un simple passage √† travers l'anticr√©nelage FXAA est effectu√© imm√©diatement apr√®s la composition de la floraison avec l'image LDR, et la profondeur de champ est effectu√©e imm√©diatement apr√®s.  Pour la profondeur de champ, le jeu rend deux versions floues diminu√©es du tampon final.  Ensuite, la profondeur de pixel est utilis√©e pour m√©langer des images floues et normales, ce qui donne un effet de d√©focalisation.  Pour plus de clart√©, dans cette capture, j'ai exag√©r√© l'effet de la profondeur de champ.  Le jeu dispose d'un mode capture d'√©cran int√©gr√©, vous permettant de configurer facilement ces conditions. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ug/et/zf/ugetzfmh2jbbcpvrzb1e6dpwbhu.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p_/x4/fk/p_x4fkleolfxxnpvs9vnveywipy.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bi/vg/bp/bivgbpqa_nmzkx4zgiuzmu3nm6e.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w2/vn/hg/w2vnhg6eoxe92rjat51qf65pggo.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/uf/0g/kj/uf0gkjnripqq4ctkcpsremqrqnk.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/bx/k5/z4/bxk5z47piwcgchqepehqpyypwgu.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ue/dc/xq/uedcxqx7svcjyq6g0-tp4uc1gho.png"></div><br><h3>  Flou de mouvement </h3><br>  Le flou de mouvement se compose de deux passes.  Tout d'abord, les donn√©es des orientations pr√©c√©dente et actuelle de la cam√©ra sont transf√©r√©es vers le tampon de vitesse plein √©cran.  Dans ce cas, deux canaux de la texture sont remplis de vitesse dans l'espace d'√©cran.  Maintenant, le canal r contient l'amplitude du changement de pixel dans la direction horizontale de l'√©cran, et le canal g contient l'amplitude dans la direction verticale.  C'est ainsi que les rayures radiales sont obtenues lors du d√©placement de la cam√©ra.  Le personnage est √† nouveau rendu, remplissant cette fois le canal bleu en fonction de ses poses actuelles et pr√©c√©dentes, comme c'est le cas avec la cam√©ra.  Le canal bleu est utilis√© pour marquer si le rendu doit √™tre rendu ou non.  Le canal alpha est √©galement rempli d'une valeur constante (0,0598), mais je n'ai pas √©tudi√© sa valeur ou ses objectifs.  La r√©solution du tampon de vitesse est r√©duite √† une tr√®s petite texture en faisant la moyenne sur une plage de vitesses relativement large dans la texture d'origine.  Dans la derni√®re passe, cela donne √† chaque pixel une id√©e approximative de ce que sera le rayon de flou dans une vraie passe de flou. <br><br>  Ensuite, la passe de flou lit les textures de vitesse, une carte de profondeur, le tampon de couleurs d'origine et la texture de bruit.  Cette derni√®re sert √† masquer l'effet d'une image miroir, ce qui peut se produire avec ce type de flou √† grand rayon.  Ensuite, le tampon d'image est √©chantillonn√© plusieurs fois dans la direction indiqu√©e par le tampon de vitesse, les couleurs sont moyenn√©es, ce qui conduit √† un flou de l'image dans la direction des vecteurs de mouvement.  En outre, cet effet est mis √† l'√©chelle en fonction de la fr√©quence d'images avec laquelle le jeu fonctionne.  Pour cette capture, j'ai d√ª limiter le jeu √† 30fps, car √† 60fps et plus, c'est √† peine perceptible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zn/4r/-7/zn4r-7rgnvx9zuh6asjnzqxknno.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hr/x_/yu/hrx_yug350grzjbnn6r6d9b7spa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/94/i5/bc/94i5bcpjozmzuykcwfh9vksqjk8.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n7/mr/zo/n7mrzoppnprexpqv5h7uj-xobvu.png"></div><br><h3>  Correction des couleurs </h3><br>  La derni√®re passe de correction des couleurs est effectu√©e √† l'aide des ¬´cubes de couleur¬ª.  Un cube de couleur est une texture 3D dont les composants RVB s'accrochent aux coordonn√©es xyz de la texture.  Ces coordonn√©es xyz contiennent la couleur dont nous avons besoin pour remplacer la couleur d'origine.  Dans notre cas, la table de recherche (LUT) est neutre (c'est-√†-dire que les coordonn√©es et la couleur contiennent la m√™me valeur), j'ai donc modifi√© la m√™me sc√®ne en utilisant les pr√©r√©glages fournis par le jeu dans l'√©diteur de cam√©ra. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-i/dk/rd/-idkrdltmru5ndotkyzhmdbwth4.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/az/-x/it/az-xitiqseycg8t_mz0kuhjxh1m.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/em/p0/ds/emp0dsyarj3nhdi-s453p0p0rsa.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/9q/fa/1e9qfapyuezjdafa8licevb6csu.png"></div><br><h3>  Cadre final </h3><br>  Apr√®s la cr√©ation du cadre principal dans un tampon s√©par√©, l'interface utilisateur est rendue.  Cela garantit que, quelle que soit la taille s√©lectionn√©e pour le tampon arri√®re, l'interface utilisateur restera toujours claire et belle dans la taille de la fen√™tre native, tandis que le jeu peut modifier la r√©solution si n√©cessaire pour garantir la vitesse.  Au final, les deux textures sont m√©lang√©es ensemble sur la base des donn√©es du canal alpha de l'interface utilisateur, puis rendues dans le tampon de trame final, qui est pr√™t √† √™tre affich√© √† l'√©cran. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cv/ba/t9/cvbat95whbpymp0cfpnjmohp_oo.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i0/y0/qm/i0y0qmb9x6liyqlpcd4vs2rli3y.png"></div><br>  J'esp√®re que vous avez appr√©ci√© mon analyse.  Je tiens √† remercier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Adrian Correge</a> pour le travail incroyable qui m'a inspir√© √† √©tudier les graphismes, ainsi que le personnel du studio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Monolith</a> pour ce jeu vraiment inoubliable. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430518/">https://habr.com/ru/post/fr430518/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430506/index.html">Art sombre de la r√©surrection: comment r√©cup√©rer des donn√©es √† partir de supports endommag√©s</a></li>
<li><a href="../fr430508/index.html">DevOps: qu'est-ce que c'est vraiment</a></li>
<li><a href="../fr430510/index.html">Comment √©crire du code que tout le monde comprendra?</a></li>
<li><a href="../fr430512/index.html">Comment vivent les pigistes: ne travaillez pas avec des clients omniscients et laissez-vous tergiverser</a></li>
<li><a href="../fr430514/index.html">Blockchain Charity - DataArt remporte le hackathon du sommet de la blockchain de Malte</a></li>
<li><a href="../fr430520/index.html">Pr√©sentation de Spring Data MongoDB</a></li>
<li><a href="../fr430522/index.html">Avez-vous besoin d'une culture d'entreprise en informatique? Confession du chef de marque du studio Krasnodar Plarium</a></li>
<li><a href="../fr430524/index.html">Architecture de r√©seau de neurones</a></li>
<li><a href="../fr430526/index.html">Machines √† sous: d'o√π viennent-elles en URSS et comment sont-elles arrang√©es</a></li>
<li><a href="../fr430528/index.html">Programmation avec PyUSB 1.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>