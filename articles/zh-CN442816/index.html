<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎷 👨🏻‍💻 📄 创建自己的游戏控制器 🛥️ 👨🏼‍💼 🤲🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="灵感来源 
 在游戏展览中，“ 太空中的物体”开发人员在大型太空船的驾驶舱中使用控制器演示了他们的游戏演示。 它还配有照明按钮，模拟设备，状态指示灯，开关等。...这极大地影响了游戏的沉浸感： 


 Arduino教程已发布在游戏的网站上，其中描述了此类控制器的通信协议 。 

 我想为我的游戏创...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>创建自己的游戏控制器</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442816/"><h2> 灵感来源 </h2><br> 在游戏展览中，“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">太空中的物体”</a>开发人员在大型太空船的驾驶舱中使用控制器演示了他们的游戏演示。 它还配有照明按钮，模拟设备，状态指示灯，开关等。...这极大地影响了游戏的沉浸感： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e96/44d/1ad/e9644d1ad417a9a97f888feea64d0e8a.jpg"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">Arduino教程已</a>发布在游戏的网站上，其中描述了此类控制器的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">通信协议</a> 。 <br><br>  <strong>我想为我的游戏创建相同的内容</strong> <br><br> 在此示例中，我将花费约40美元在赛车模拟器的驾驶舱中添加美观，大型和重型的开关。 这些开关的主要成本是相关的-如果我使用简单的开关/按钮，价格将是原来的一半！ 这是可以承受240瓦功率的真实设备，我只会散发出约0.03瓦的功率。 <br><br> 警告：我决定省钱，所以我留下了一个便宜的中文网站的链接，在那里我购买了许多不同的组件/工具。 购买廉价组件的缺点之一是它们通常没有文档，因此在本文中，我将解决此问题。 <br><a name="habracut"></a><br><h2> 主要组成 </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">Arduino Mega2560-9</a>美元 <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">点火开关赛车面板</a> -$ 26 <br></li><li> 一束连接线（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">“公对公”</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">“公对母”</a>等）-$ 2 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f5c/e18/fb6/f5ce18fb6e69f6d2dd322d5295a8c7db.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c43/2d0/b89/c432d0b89b271194d7e3c72a96f4a458.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/454/485/de1/454485de13be106ba6733352efa8c249.jpg"></div><br><h2> 特色工具 </h2><br><ul><li> 烙铁（ <em>值得选择一个<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">好的</a></em>烙铁<em>，但应付工作也很<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">便宜</a></em> ） </li><li> 焊料（ <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用松香60/40-</a>尽管对环境有害，但使用起来很容易</em> 。） <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">热缩管</a> （ <em>和工业吹风机，吹风机或打火机</em> ）或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">胶带</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">胶枪</a> （ <em>及其上的棒</em> ）或某种<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">环氧树脂</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">万用表</a> <br></li><li> 如果需要省钱，可使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">剥线钳</a>或剪子的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">钳子/钳子</a> 。 </li></ul><br><h2> 软体类 </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">Arduino IDE，</a>用于对Arduino处理器进行编程 </li><li> 要创建显示为真实硬件USB控制器/操纵杆的控制器，请执行以下操作： <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">FLIP</a>用于在Arduino USB控制器中刷新新固件 </li><li>  github上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">Arduino-usb</a>库 </li></ul></li><li> 创建与游戏直接通信的控制器（ <em>或显示为虚拟USB控制器/操纵杆的控制器</em> ） <ul><li> 我在github上的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">ois_protocol</a>库 <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">VJoy驱动程序（</a>如果要将该控制器用作虚拟USB控制器/操纵杆）。 </li></ul></li></ul><br><h2> 警告 </h2><br> 我在高中学习了电子学，学习了如何使用烙铁，学习了红线需要连接到红色，黑线需要连接到黑...电压，安培，电阻和连接它们的方程式-这就是我在电子学方面的正式培训所花的全部时间。 <br><br> 对我来说，这是一个培训项目，因此可能有不好的建议或错误！ <br><br><h1> 第1部分。将控制器放在一起！ </h1><br><h2> 我们使用没有文档的开关... </h2><br> 如上所述，我从低利润零售商那里购买便宜的零件，所以要做的第一件事就是弄清楚这些开关/按钮的工作方式。 <br><br><h3> 简单的按钮/开关 </h3><br> 使用该按钮，一切都很简单-里面没有LED，只有两个触点。 将万用表切换到连续性/拨号模式（ <img src="https://habrastorage.org/getpro/habr/post_images/628/15d/e9f/62815de9fa4516b533fa2a44197455da.gif">  ）并触摸不同触点的探针-屏幕上将显示OL（开环，开路）：这意味着两个探针之间没有连接。 然后，我们按下按钮，仍然触摸接触式探针-屏幕上现在应该会出现类似0.1Ω的信号，万用表将开始发出哔声（ <em>表明探针之间的电阻非常低-闭合电路</em> ）。 <br><br> 现在我们知道，按下按钮时，电路闭合，按下时，电路断开。 在图中，可以将其描述为一个简单的开关： <img src="https://habrastorage.org/getpro/habr/post_images/ff1/078/8d9/ff10788d996450509595baba45cad58e.png"><br><br><h2> 我们将开关连接到Arduino </h2><br> 在Arduino板上找到两个引脚：标记为GND和标记为“ 2”（或任何其他任意数字-这些是我们可以通过软件控制的通用I / O引脚）。 <br><br> 如果我们以这种方式连接开关，然后我们命令Arduino将引脚“ 2”配置为INPUT引脚，则会得到左侧所示的电路（如下图所示）。 按下按钮时，引脚2将直接接地/ 0V，按下时，引脚2将不连接任何东西。 这种状态（ <em>未连接任何东西</em> ）被称为“浮动”（高阻抗状态），不幸的是，对于我们的目的而言，这不是一个很好的条件。 当我们从软件中的触点读取数据（ <em>使用digitalRead（2）</em> ）时，如果触点接地，则为LOW；如果触点处于浮动状态，则将得到不可预测的结果（LOW或HIGH）！ <br><br> 为了解决这个问题，我们可以将触点配置为INPUT_PULLUP模式，该模式连接到处理器内部的电阻并创建右侧所示的电路。 在此电路中，在开关断开的情况下，引脚2的路径为+ 5V，因此当读取时，结果始终为HIGH。 当开关闭合时，触点仍将具有高至+ 5V电阻的路径，以及不具有接地电阻/ 0V的路径，该路径“获胜”，因此当我们读取触点时，将得到LOW。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/450/a26/fa9/450a26fa93dae881e4f2aca3f68d52ad.png"></div><br> 对于软件开发人员来说，顺序似乎是相反的-单击按钮时，读为false / LOW，而当按下按钮时，读为true / HIGH。 <br><br> 您可以做相反的事情，但是处理器只有内置的上拉电阻，没有下拉电阻，因此我们将坚持这种模式。 <br><br>  Arduino的最简单程序读取开关的状态并告知PC其状态，看起来类似于以下所示。 您可以单击Arduino IDE中的下载按钮，然后打开“串行监视器”（在“工具”菜单中）以查看结果。 <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, INPUT_PULLUP); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state = digitalRead(pin); Serial.println( state == HIGH ? <span class="hljs-string"><span class="hljs-string">"Released"</span></span> : <span class="hljs-string"><span class="hljs-string">"Pressed"</span></span> ); delay(<span class="hljs-number"><span class="hljs-number">100</span></span>);<span class="hljs-comment"><span class="hljs-comment">//artifically reduce the loop rate so the output is at a human readable rate... }</span></span></code> </pre> <br><h2> 其他几乎没有文档的交换机... </h2><br><h3> 三针LED开关 </h3><br> 幸运的是，在面板的主开关上有三个触点的标记： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43a/9c1/8e7/43a9c18e7e7c13e8ce02744fe8320bb6.jpg"></div><br> 我不太确定它是如何工作的，因此我们将万用表切换回连续模式，并在开关打开和关闭时触​​摸所有的触点对……但是，这一次，当我们在触摸[GND]和[+]探针时用“开机！ 万用表发出哔哔声（ <em>检测到连接</em> ）的唯一配置是当开关“打开”且探头在[+]和[lamp]上时。 <br><br> 开关内部的LED阻止了连续性测量，因此从上述测试中我们可以假定LED直接连接到[GND]引脚，而不是[+]和[lamp]触点。 接下来，我们将万用表切换到二极管测试模式（符号 <img src="https://habrastorage.org/getpro/habr/post_images/aa4/e65/abe/aa4e65abeb894a55aa7074cbb67543aa.jpg">  ）并再次检查一对触点，但是这次极性很重要（ <em>红色和黑色探针</em> ）。 现在，如果将红色探针连接到[lamp]，将黑色探针连接到[GND]，则LED将点亮，并且万用表上将显示2.25V。 这是二极管的直流电压，或者是打开二极管所需的最低电压。 无论开关位置如何，从[灯]到[GND]的2.25V电压都会使LED点亮。 如果将红色探针连接到[+]，将黑色探针连接到[GND]，则仅当开关打开时，LED才会点亮。 <br><br> 从这些读数中，我们可以假定此开关的内部外观类似于下图： <br><br><ol><li> 当开关打开/关闭时，[+]和[灯]短路。 <br></li><li> 从[灯]到[GND]的正电压始终点亮LED。 <br></li><li> 只有当开关打开/关闭时，从[+]到[GND]的正电压才会点亮LED。 </li></ol><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bd6/34a/728/bd634a728856e82e71eecafa5d42d8a4.png"></div><br> 老实说，我们只能猜测电阻的存在。  LED <strong>必须</strong>连接到适当的电阻器，以限制提供给它的电流，否则它会烧坏。 矿井没有烧毁，看起来工作正常。 在卖方的网站论坛上，我找到了一篇帖子，内容涉及已安装的支持最高12 V的电阻器，这节省了我检查/计算合适电阻器的时间。 <br><br><h3> 我们将开关连接到Arduino </h3><br> 最简单的方法是将开关与Arduino一起使用，而忽略[lamp]引脚：将[GND]连接至Arduino中的GND，并将[+]连接至编号的Arduino触点之一，例如3。 <br><br> 如果将引脚3配置为INPUT_PULLUP（ <em>与上一个按钮相同</em> ），则将得到如下所示的结果。 左上方显示了通过执行Arduino代码中的“ digitalRead（3）”将获得的值。 <br><br> 当开关打开/关闭时，我们读到LOW（低），LED点亮！ 要在此配置中使用此类开关，我们可以使用与按钮示例中相同的Arduino代码。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fd5/cc5/8ba/fd5cc58ba50f376abbd42806718b0f92.png"></div><br><h3> 该解决方案的问题 </h3><br> 连接到Arduino之后，整个电路如下所示： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/92c/305/f91/92c305f91bf0cf6fac213e2eba1db65e.png"></div><br> 但是，在这里我们可以看到，当开关闭合时，除了LED前面的小限流电阻（我假设其电阻为100欧姆）外，还存在一个20 kOhm的上拉电阻，这进一步减少了流经LED的电流量。 这意味着尽管电路正常工作，但LED不会非常亮。 <br><br> 该方案的另一个缺点是我们没有对LED进行软件控制的功能-当开关打开时，LED会打开，在相反的情况下会禁用。 <br><br> 您可以看到如果将[lamp]引脚连接到0V或+ 5V会发生什么。 <br><br> 如果[lamp]连接到0V，则LED指示灯将始终熄灭（ <em>与开关位置无关</em> ），并且仍执行Arduino位置识别。 这使我们能够以编程方式禁用LED！ <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a55/de7/6d3/a55de76d395358050d3c96139e47df73.png"></div><br> 如果[lamp]连接到+ 5V，则LED一直亮着（ <em>无论开关的位置如何</em> ）， <strong>但是，</strong> Arduino位置<strong>的</strong>识别被破坏了-始终从触点读取HIGH。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/310/ea5/4a8/310ea54a861f7f89bc624261abd71ce5.png"></div><br><h3> 我们将此开关正确连接到Arduino </h3><br> 通过编写更多代码，我们可以克服上述限制（ <em>LED的低电流/亮度以及对LED缺乏程序控制</em> ）！ 为了解决控制LED的能力与由于其损坏而导致的位置识别之间的冲突，我们可以及时分离两个任务，即在读取传感器触点（3）时暂时关闭LED。 <br><br> 首先，将[lamp]引脚连接到另一个通用Arduino引脚，例如，连接到4，以便您可以控制灯泡。 <br><br> 要创建一个可以正确读取开关位置并控制LED的程序（我们将使其闪烁），我们只需要在读取开关状态之前关闭LED即可。  LED将仅关闭一毫秒的时间，因此闪烁不应明显： <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pinSwitch = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pinLed = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//connect to the PC Serial.begin(9600); //connect our switch's [+] connector to a digital sensor, and to +5V through a large resistor pinMode(pinSwitch, INPUT_PULLUP); //connect our switch's [lamp] connector to 0V or +5V directly pinMode(pinLed, OUTPUT); } void loop() { int lampOn = (millis()&gt;&gt;8)&amp;1;//make a variable that alternates between 0 and 1 over time digitalWrite(pinLed, LOW);//connect our [lamp] to +0V so the read is clean int state = digitalRead(pinSwitch); if( lampOn ) digitalWrite(pinLed, HIGH);//connect our [lamp] to +5V Serial.println(state);//report the switch state to the PC }</span></span></code> </pre> <br> 在Arduino Mega中，引脚2-13和44-46可以使用AnalogWrite函数，该函数实际上不会产生0V至+ 5V的电压，而是使用方波对其进行逼近。 如果需要，可以使用它来控制LED的亮度！ 此代码将使光脉动，而不仅仅是闪烁： <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lampState = (millis()&gt;&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>)&amp;<span class="hljs-number"><span class="hljs-number">0xFF</span></span>;<span class="hljs-comment"><span class="hljs-comment">//make a variable that alternates between 0 and 255 over time digitalWrite(pinLed, LOW);//connect our [lamp] to +0V so the read is clean int state = digitalRead(pinSwitch); if( lampState &gt; 0 ) analogWrite(pinLed, lampState); }</span></span></code> </pre> <br><h2> 组装技巧 </h2><br> 帖子已经很大，所以我不会添加焊接教程，可以谷歌搜索！ <br><br> 但是，我将给出最基本的提示： <br><br><ul><li> 连接带有大金属触点的电线时，首先要确保烙铁很热，然后将金属触点加热一会儿。 焊接的含义是通过形成合金来形成永久连接，但是如果连接的仅一部分是热的，则可以轻松获得看起来像连接但实际上并未连接的“冷连接”。 <br></li><li> 连接两根电线时， <i>首先要</i>在其中一根上放一根热缩管-连接后，就不能再穿管了。 这似乎很明显，但是我经常忘记它，我必须使用电工胶带代替管子……将收缩管从连接处拉开，以免其提前加热。 检查焊接连接后，将管子滑到其上并加热。 <br></li><li> 我一开始提到的细细连接线非常适合无焊连接（例如，当连接到Arduino时！），但相当脆弱。 焊接后，使用胶枪将其固定，并消除连接本身的所有应力。 例如，下图中的红色导线在操作过程中可能会被意外拉出，因此在焊接后，我用一滴热胶将其固定： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a0d/fa0/1d4/a0dfa01d48145b489d680cc6e7f43bc8.jpg"></div></li></ul><br><h1> 第2部分。我们将设备变成游戏控制器！ </h1><br> 为了使操作系统将设备识别为USB游戏控制器，您需要一个相当简单的代码，但是，不幸的是，您还需要用另一个USB固件替换Arduino USB芯片固件，可在此处获取： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">//github.com/harlequin-tech/arduino-usb</a> 。 <br><br> 但是在将该固件上传到Arduino之后，设备变成了USB游戏杆，不再是Arduino。 因此，要对其进行重新编程，您需要重新刷新原始Arduino固件。 这些迭代非常痛苦-加载Arduino代码，刷新操纵杆固件，测试，刷新arduino固件，重复执行... <br><br> 可以与该固件一起使用的Arduino程序示例如下所示-将三个按钮配置为输入，读取它们的值，将值复制到该固件所需的数据结构中，然后发送数据。 洗净，用肥皂洗，重复一遍。 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// define DEBUG if you want to inspect the output in the Serial Monitor // don't define DEBUG if you're ready to use the custom firmware #define DEBUG //Say we've got three buttons, connected to GND and pins 2/3/4 int pinButton1 = 2; int pinButton2 = 3; int pinButton3 = 4; void setup() { //configure our button's pins properly pinMode(pinButton1, INPUT_PULLUP); pinMode(pinButton2, INPUT_PULLUP); pinMode(pinButton3, INPUT_PULLUP); #if defined DEBUG Serial.begin(9600); #else Serial.begin(115200);//The data rate expected by the custom USB firmware delay(200); #endif } //The structure expected by the custom USB firmware #define NUM_BUTTONS 40 #define NUM_AXES 8 // 8 axes, X, Y, Z, etc typedef struct joyReport_t { int16_t axis[NUM_AXES]; uint8_t button[(NUM_BUTTONS+7)/8]; // 8 buttons per byte } joyReport_t; void sendJoyReport(struct joyReport_t *report) { #ifndef DEBUG Serial.write((uint8_t *)report, sizeof(joyReport_t));//send our data to the custom USB firmware #else // dump human readable output for debugging for (uint8_t ind=0; ind&lt;NUM_AXES; ind++) { Serial.print("axis["); Serial.print(ind); Serial.print("]= "); Serial.print(report-&gt;axis[ind]); Serial.print(" "); } Serial.println(); for (uint8_t ind=0; ind&lt;NUM_BUTTONS/8; ind++) { Serial.print("button["); Serial.print(ind); Serial.print("]= "); Serial.print(report-&gt;button[ind], HEX); Serial.print(" "); } Serial.println(); #endif } joyReport_t joyReport = {}; void loop() { //check if our buttons are pressed: bool button1 = LOW == digitalRead( pinButton1 ); bool button2 = LOW == digitalRead( pinButton2 ); bool button3 = LOW == digitalRead( pinButton3 ); //write the data into the structure joyReport.button[0] = (button1?0x01:0) | (button2?0x02:0) | (button3?0x03:0); //send it to the firmware sendJoyReport(joyReport) }</span></span></code> </pre> <br><h1> 第3部分。我们将设备与我们自己的游戏集成在一起！ </h1><br> 如果您可以控制设备应与之交互的游戏，则可以选择直接与控制器通信-无需将其作为操纵杆在OS上显示！ 在文章的开头，我提到了太空中的物体； 这是开发人员使用的方法。 他们创建了一个简单的ASCII通信协议，该协议允许控制器和游戏相互通信。 只需列出系统的串行端口（ <em>它们是Windows上的COM端口；顺便说一下， <a href="" rel="external nofollow">看一下它在C语言中的表现如何</a></em> ），找到称为“ Arduino”的设备所连接的端口，然后开始从此链接读取/写入ASCII。 <br><br> 在Arduino方面，我们仅使用上面示例中使用的Serial.print函数。 <br><br> 在本文的开头，我还提到了用于解决此问题的库： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">//github.com/hodgman/ois_protocol</a> 。 <br><br> 它包含可以集成到游戏中并用作“服务器”的C ++代码，以及可以在控制器中执行以将其用作“客户端”的Arduino代码。 <br><br><h2> 自定义Arduino </h2><br> 在<a href="" rel="external nofollow">example_hardware.h中，</a>我创建了一些类来抽象单个按钮/单选按钮； 例如，“开关”是第一个示例中的一个简单按钮。而“ LedSwitch2Pin”是第二个示例中的带有受控LED的开关。 <br><br> 我的按钮栏的示例代码在<a href="" rel="external nofollow">example.ino中</a> 。 <br><br> 举一个小例子，假设我们有一个需要发送到游戏的按钮和一个游戏控制的LED。 所需的Arduino代码如下所示： <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ois_protocol.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//instantiate the library OisState ois; //inputs are values that the game will send to the controller struct { OisNumericInput myLedInput{"Lamp", Number}; } inputs; //outputs are values the controller will send to the game struct { OisNumericOutput myButtonOutput{"Button", Boolean}; } outputs; //commands are named events that the controller will send to the game struct { OisCommand quitCommand{"Quit"}; } commands; int pinButton = 2; int pinLed = 3; void setup() { ois_setup_structs(ois, "My Controller", 1337, 42, commands, inputs, outputs); pinMode(pinButton, INPUT_PULLUP); pinMode(pinLed, OUTPUT); } void loop() { //read our button, send it to the game: bool buttonPressed = LOW == digitalRead(pin); ois_set(ois, outputs.myButtonOutput, buttonPressed); //read the LED value from the game, write it to the LED pin: analogWrite(pinLed, inputs.myLedInput.value); //example command / event: if( millis() &gt; 60 * 1000 )//if 60 seconds has passed, tell the game to quit ois_execute(ois, commands.quitCommand); //run the library code (communicates with the game) ois_loop(ois); }</span></span></span></span></code> </pre> <br><h2> 定制游戏 </h2><br> 游戏代码以“单个标题”的形式编写。 要导入库， <a href="" rel="external nofollow">请</a>在游戏中包含<a href="" rel="external nofollow">oisdevice.h</a> 。 <br><br> 在单个CPP文件中，在执行#include头之前，编写#define OIS_DEVICE_IMPL和#define OIS_SERIALPORT_IMPL-这会将类的源代码添加到CPP文件中。 如果您有自己的语句，日志，字符串或向量，则可以在导入标头之前定义其他几个OIS_ *宏，以利用引擎的功能。 <br><br> 要列出COM端口并创建与特定设备的连接，可以使用以下代码： <br><br><pre> <code class="cpp hljs">OIS_PORT_LIST portList; OIS_STRING_BUILDER sb; SerialPort::EnumerateSerialPorts(portList, sb, <span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> it = portList.begin(); it != portList.end(); ++it ) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> label = it-&gt;name + <span class="hljs-string"><span class="hljs-string">'('</span></span> + it-&gt;path + <span class="hljs-string"><span class="hljs-string">')'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-comment"><span class="hljs-comment">/*device selection choice*/</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> gameVersion = <span class="hljs-number"><span class="hljs-number">1</span></span>; OisDevice* device = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OisDevice(it-&gt;id, it-&gt;path, it-&gt;name, gameVersion, <span class="hljs-string"><span class="hljs-string">"Game Title"</span></span>); ... } }</code> </pre> <br> 收到OisDevice的实例后，您需要定期调用其Poll成员函数（例如，在每个帧中），可以使用DeviceOutputs（）获取控制器输出的当前状态，使用PopEvents（）使用设备事件，并使用SetInput（）将值发送到设备。 <br><br> 可以在以下位置找到一个示例应用程序： <a href="" rel="external nofollow">example_ois2vjoy / main.cpp</a> 。 <br><br><h1> 第4部分。如果我同时需要第2部分和第3部分，该怎么办？ </h1><br> 为了使控制器能够在其他游戏中工作（第2部分），您需要安装自己的固件和一个Arduino程序，但是对于要由游戏进行完全编程的控制器，我们使用了标准的Arduino固件和另一个Arduino程序。 但是，如果我们想同时拥有两种可能性怎么办？ <br><br> 我在上面提供了链接的示例应用程序（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">ois2vjoy</a> ）解决了此问题。 <br><br> 该应用程序与OIS设备（第3部分中的程序）进行通信，然后在PC上将此数据转换为常规控制器/操纵杆数据，然后将其传输到<em>虚拟</em>控制器/操纵杆设备。 这意味着您可以允许您的控制器不断使用OIS库（不需要其他固件），并且如果我们想将其用作常规控制器/操纵杆，则只需在PC上运行ois2vjoy应用程序即可执行转换。 <br><br><h1> 第5部分。完成 </h1><br> 我希望有人觉得这篇文章有用或有趣。 感谢您阅读到底！ <br><br> 如果您感到好奇，那么我邀请您参与<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="external nofollow">ois_protocol</a>库的开发！ 我认为开发单一协议以支持游戏中各种自制控制器并鼓励游戏直接支持自制控制器将是一件很棒的事情！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN442816/">https://habr.com/ru/post/zh-CN442816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN442806/index.html">DUMP-2019初步计划已准备就绪。 来自Evil Martians，Tinkoff.ru，HTML Academy，SkyEng，2GIS的发言人</a></li>
<li><a href="../zh-CN442808/index.html">我们邀请您参加Droid派对-专门讨论开发Android应用程序和设备的实际问题的会议</a></li>
<li><a href="../zh-CN442810/index.html">大众物理学神话，续：重力</a></li>
<li><a href="../zh-CN442812/index.html">“除了懒惰之外，我认为没有理由使用Python与Spark配合使用”</a></li>
<li><a href="../zh-CN442814/index.html">10年过去了，没有人知道如何使用区块链。 再来一次吗？</a></li>
<li><a href="../zh-CN442818/index.html">英文书写中的10个常见错误及其处理方法</a></li>
<li><a href="../zh-CN442820/index.html">自定义协程与偏好和妓女的统一</a></li>
<li><a href="../zh-CN442822/index.html">海上和在轨数据中心：它们是否具有实际意义？</a></li>
<li><a href="../zh-CN442824/index.html">欢迎来到硅谷</a></li>
<li><a href="../zh-CN442826/index.html">社会工程学是一种戏剧，或者是网络钓鱼领域和契kh夫步枪的共同点</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>