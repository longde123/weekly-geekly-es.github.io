<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè® üë®üèª‚ÄçüöÄ üö£üèº Inicio de la biblioteca de componentes React y TypeScript ‚úåüèª üèÑ üëõ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La mayor parte de mi trabajo, escribo backends, pero el otro d√≠a hab√≠a una tarea para iniciar una biblioteca de componentes en React. Hace unos a√±os, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inicio de la biblioteca de componentes React y TypeScript</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461439/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/nc/57/zc/nc57zcknvdousryimpgxxqsiz1i.jpeg"></div><br><p>  La mayor parte de mi trabajo, escribo backends, pero el otro d√≠a hab√≠a una tarea para iniciar una biblioteca de componentes en React.  Hace unos a√±os, cuando la versi√≥n React era tan peque√±a como mi experiencia en el desarrollo front-end, ya adopt√© un enfoque del proyectil y result√≥ torpe y torpemente.  Teniendo en cuenta la madurez del ecosistema actual de React y mi creciente experiencia, esta vez me inspir√© para hacer todo bien y convenientemente.  Como resultado, ten√≠a un espacio en blanco para la futura biblioteca, y para no olvidar nada y recopilar todo en un solo lugar, se escribi√≥ este art√≠culo de hoja de trucos, que tambi√©n deber√≠a ayudar a aquellos que no saben por d√≥nde empezar.  Veamos que hice. </p><a name="habracut"></a><br><p>  <strong><em>TL / DR: el c√≥digo para una biblioteca lista para comenzar se puede ver en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a></em></strong> </p><br><p>  El problema puede abordarse desde dos lados: </p><br><ol><li>  Encuentre un kit de inicio listo para usar, placa de caldera o generador de cli </li><li>  Recoge todo t√∫ mismo </li></ol><br><p>  El primer m√©todo es bueno para un inicio r√°pido, cuando absolutamente no desea ocuparse de configurar y conectar los paquetes necesarios.  Adem√°s, esta opci√≥n es adecuada para principiantes que no saben por d√≥nde empezar y cu√°l deber√≠a ser la diferencia entre la biblioteca y la aplicaci√≥n habitual. </p><br><p>  Al principio fui por el primer camino, pero luego decid√≠ actualizar las dependencias y fijar un par de paquetes m√°s, y luego llovieron todo tipo de errores e inconsistencias.  Como resultado, se arremang√≥ e hizo todo por s√≠ mismo.  Pero mencionar√© el generador de la biblioteca. </p><br><h2 id="create-react-library">  Crear biblioteca de reacci√≥n </h2><br><p>  La mayor√≠a de los desarrolladores que tratan con React han o√≠do hablar de un pr√°ctico iniciador de aplicaciones React que le permite minimizar la configuraci√≥n del proyecto y proporciona valores predeterminados razonables: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Crear aplicaci√≥n React</a> (CRA).  En principio, podr√≠a usarse para la biblioteca ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hay un art√≠culo sobre el Habr√©</a> ).  Sin embargo, la estructura del proyecto y el enfoque para el desarrollo del kit de interfaz de usuario es ligeramente diferente del SPA habitual.  Necesitamos un directorio separado con c√≥digos fuente de componentes (src), un sandbox para su desarrollo y depuraci√≥n (ejemplo), una herramienta de documentaci√≥n y demostraci√≥n ("showcase") y un directorio separado con archivos preparados para la exportaci√≥n (dist).  Adem√°s, los componentes de la biblioteca no se agregar√°n a la aplicaci√≥n SPA, sino que se exportar√°n a trav√©s de un archivo de √≠ndice.  Pensando en ello, fui a buscar y descubr√≠ r√°pidamente un paquete CRA similar: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Creat React Library</a> (CRL). </p><br><p>  CRL, como CRA, es una utilidad CLI f√°cil de usar.  Utiliz√°ndolo, puedes generar un proyecto.  Contendr√°: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rollup</a> configurado para construir m√≥dulos cjs y es y un mapa fuente con soporte para m√≥dulos css </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">babel</a> para transpilaci√≥n en ES5 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Broma</a> para las pruebas </li><li>  TypeScript (TS) como una opci√≥n que nos gustar√≠a usar </li></ul><br><p>  Para generar el proyecto de la biblioteca, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">podemos</a> hacerlo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">npx</a> nos permite no instalar paquetes globalmente): </p><br><pre><code class="bash hljs">npx create-react-library</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Respondemos las preguntas propuestas.</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/wd/ql/qq/wdqlqqfmjrgntiqz6zphcdyccdw.png" alt="Preguntas CLR"></p></div></div><br><p>  Y como resultado de la utilidad, obtenemos un proyecto generado y listo para trabajar de la biblioteca de componentes. </p><br><div class="spoiler">  <b class="spoiler_title">Con cierta estructura</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vs/d4/l2/vsd4l2o2g1wn3n0folb_yr30ui8.png" alt="√Årbol clr"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Y entonces algo sali√≥ mal ...</b> <div class="spoiler_text"><p>  Las dependencias est√°n un poco desactualizadas hoy, as√≠ que decid√≠ actualizarlas a las √∫ltimas versiones usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">npm-check</a> : </p><br><pre> <code class="bash hljs">npx npm-check -u</code> </pre> <br><p>  Otro hecho triste es que la aplicaci√≥n de sandbox en el directorio de <code>example</code> se genera en js.  Tendr√° que reescribirlo manualmente en TypeScript, agregando <code>tsconfig.json</code> y algunas dependencias (por ejemplo, el <code>typescript</code> y los <code>@types</code> b√°sicos). </p><br><p>  Adem√°s, el paquete <code>react-scripts-ts</code> se declara <code>deprecated</code> y ya no es compatible.  En su lugar, debe instalar <code>react-scripts</code> , porque desde hace alg√∫n tiempo CRA (cuyo paquete es <code>react-scripts</code> ) admite TypeScript desde el cuadro (usando Babel 7). </p><br><p>  Como resultado, no domin√© la <code>react-scripts</code> en mi idea de la biblioteca.  Hasta donde recuerdo, el Jest de este paquete requer√≠a la opci√≥n del compilador <code>isolatedModules</code> , lo que iba en contra de mi deseo de generar y exportar <code>d.ts</code> desde la biblioteca (todo esto est√° relacionado de alguna manera con las limitaciones de Babel 7, que Jest usa y <code>react-scripts</code> para compilar TS )  As√≠ que hice una <code>eject</code> de <code>react-scripts</code> de <code>react-scripts</code> , mir√© el resultado y rehice todo con mis manos, sobre lo que escribir√© m√°s adelante. </p></div></div><br><h2 id="tsdx">  tsdx </h2><br><p>  Gracias al usuario <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">StanEgo</a> , quien habl√≥ sobre una excelente alternativa para Crear Biblioteca de React - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tsdx</a> .  Esta utilidad cli tambi√©n es similar a CRA y en un comando crear√° la base para su biblioteca con Rollup, TS, Prettier, husky, Jest y React configurados.  Y React viene como una opci√≥n.  Suficientemente simple para hacer: </p><br><pre> <code class="bash hljs">npx tsdx create mytslib</code> </pre> <br><p>  Y como resultado, se instalar√°n las nuevas versiones necesarias de los paquetes y se realizar√°n todas las configuraciones.  Obtenga un proyecto similar a CRL.  La principal diferencia de CRL es la configuraci√≥n cero.  Es decir, la configuraci√≥n de Rollup est√° oculta para nosotros en tsdx (al igual que CRA). </p><br><p>  Despu√©s de haber revisado r√°pidamente la documentaci√≥n, no encontr√© los m√©todos recomendados para una configuraci√≥n m√°s fina o algo as√≠ como expulsar como en CRA.  Despu√©s de analizar el tema del proyecto, descubr√≠ que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hasta ahora no existe tal posibilidad</a> .  Para algunos proyectos, esto puede ser cr√≠tico, en cuyo caso tendr√° que trabajar un poco con las manos.  Si no lo necesita, tsdx es una excelente manera de comenzar r√°pidamente. </p><br><h2 id="beryom-upravlenie-v-svoi-ruki">  Tomar el control en nuestras propias manos </h2><br><p>  Pero, ¬øqu√© pasa si vas por el segundo camino y recoges todo t√∫ mismo?  Entonces, comencemos desde el principio.  Ejecute <code>npm init</code> y genere <code>package.json</code> para la biblioteca.  Agregue informaci√≥n sobre nuestro paquete all√≠.  Por ejemplo, escribimos las versiones m√≠nimas para node y npm en el campo de <code>engines</code> .  Los archivos recopilados y exportados se colocar√°n en el directorio <code>dist</code> .  Indicamos esto en el campo de <code>files</code> .  Estamos creando una biblioteca de componentes de reacci√≥n, por lo que esperamos que los usuarios tengan los paquetes necesarios: <code>peerDependencies</code> versiones m√≠nimas requeridas de <code>react</code> y <code>react-dom</code> en el campo <code>peerDependencies</code> . </p><br><p>  Ahora instale los paquetes <code>react</code> y <code>react-dom</code> y los tipos necesarios (ya que estaremos cortando componentes en TypeScript) como devDependencies (como todos los paquetes en este art√≠culo): </p><br><pre> <code class="bash hljs">npm install --save-dev react react-dom @types/react @types/react-dom</code> </pre> <br><p>  Instalar TypeScript: </p><br><pre> <code class="bash hljs">npm install --save-dev typescript</code> </pre> <br><p>  <code>tsconfig.json</code> archivos de configuraci√≥n para el c√≥digo principal y las pruebas: <code>tsconfig.json</code> y <code>tsconfig.test.json</code> .  Nuestro <code>target</code> estar√° en <code>es5</code> , generaremos <code>sourceMap</code> , etc.  Puede encontrar una lista completa de posibles opciones y sus significados en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> .  No olvide <code>include</code> directorio fuente en el <code>include</code> , y agregue los <code>node_modules</code> y <code>dist</code> en el <code>exclude</code> .  En <code>package.json</code> indicamos en el campo de <code>typings</code> d√≥nde obtener los tipos para nuestra biblioteca: <code>dist/index</code> . </p><br><p>  Cree el directorio <code>src</code> para los componentes de origen de la biblioteca.  Agregue todo tipo de cosas peque√±as, como <code>.gitignore</code> , <code>.editorconfig</code> , un archivo con licencia y <code>README.md</code> . </p><br><h3 id="rollup">  Rollup </h3><br><p>  Utilizaremos Rollup para el ensamblaje, como lo sugiere CRL.  Paquetes necesarios y configuraci√≥n, tambi√©n espiaba CRL.  En general, escuch√© la opini√≥n de que Rollup es bueno para las bibliotecas y Webpack para las aplicaciones.  Sin embargo, no configur√© Webpack (lo que CRA hace por m√≠), pero Rollup es realmente bueno, simple y hermoso. </p><br><p>  Instalar: </p><br><pre> <code class="bash hljs">npm install --save-dev rollup rollup-plugin-babel rollup-plugin-commonjs rollup-plugin-node-resolve rollup-plugin-peer-deps-external rollup-plugin-postcss rollup-plugin-typescript2 rollup-plugin-url @svgr/rollup</code> </pre> <br><p>  En <code>package.json</code> agregue los campos con la distribuci√≥n de los paquetes de biblioteca recopilados, como nos recomienda el <code>rollup</code> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pkg.module</a> : </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"module"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"jsnext:main"</span></span>: <span class="hljs-string"><span class="hljs-string">"dist/index.es.js"</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Cree el archivo de configuraci√≥n rollup.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> typescript <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-typescript2'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> commonjs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-commonjs'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> external <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-peer-deps-external'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> postcss <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-postcss'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> resolve <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-node-resolve'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> url <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rollup-plugin-url'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> svgr <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@svgr/rollup'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pkg <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./package.json'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">input</span></span>: <span class="hljs-string"><span class="hljs-string">'src/index.tsx'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.main, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'cjs'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">file</span></span>: pkg.module, <span class="hljs-attr"><span class="hljs-attr">format</span></span>: <span class="hljs-string"><span class="hljs-string">'es'</span></span>, <span class="hljs-attr"><span class="hljs-attr">exports</span></span>: <span class="hljs-string"><span class="hljs-string">'named'</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourcemap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } ], <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ external(), postcss({ <span class="hljs-attr"><span class="hljs-attr">modules</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">extract</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">sourceMap</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), url(), svgr(), resolve(), typescript({ <span class="hljs-attr"><span class="hljs-attr">rollupCommonJSResolveHack</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">clean</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), commonjs() ] };</code> </pre> </div></div><br><p>  La configuraci√≥n es un archivo js, ‚Äã‚Äão m√°s bien un objeto exportado.  En el campo de <code>input</code> , especifique el archivo en el que se registran las exportaciones para nuestra biblioteca.  <code>output</code> - describe nuestras expectativas sobre la salida - en qu√© m√≥dulo compilar en el formato y d√≥nde colocarlo. </p><br><div class="spoiler">  <b class="spoiler_title">Luego viene el campo con una lista y configuraci√≥n de complementos</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rollup-plugin-peer-deps-external</a> : le permite excluir <code>peerDependencies</code> del <code>bundle</code> para reducir su tama√±o.  Esto es razonable, porque se esperan <code>peerDependencies</code> del usuario de la biblioteca. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rollup-plugin-postcss</a> : integra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PostCss</a> y Rollup.  Aqu√≠ deshabilitamos los m√≥dulos css, incluimos css en el paquete de exportaci√≥n de nuestra biblioteca, lo minimizamos y habilitamos la creaci√≥n de sourceMap.  Si no exporta ning√∫n CSS que no sea el utilizado por los componentes de la biblioteca, entonces se puede evitar el <code>extract</code> : al final, se agregar√° el CSS necesario en los componentes a la etiqueta de encabezado de la p√°gina seg√∫n sea necesario.  Sin embargo, en mi caso, es necesario distribuir algunos css adicionales (cuadr√≠cula, colores, etc.), y el cliente tendr√° que conectar expl√≠citamente la biblioteca css-bundle a s√≠ mismo. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rollup-plugin-url</a> : le permite exportar varios recursos, como im√°genes </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">svgr</a> : transforma svg en componentes React </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rollup-plugin-node-resolve</a> - define la ubicaci√≥n de m√≥dulos de terceros en node_modules </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rollup-plugin-typescript2</a> : conecta el compilador TypeScript y proporciona la capacidad de configurarlo </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rollup-plugin-commonjs</a> : convierte los m√≥dulos de dependencia de commonjs en m√≥dulos es para que puedan incluirse en el paquete </li></ul></div></div><br><p>  Agregue un comando en el campo <code>scripts</code> <code>package.json</code> para compilar ( <code>"build": "rollup -c"</code> ) e inicie el ensamblaje en modo de observaci√≥n durante el desarrollo ( <code>"start": "rollup -c -w &amp;&amp; npm run prettier-watch"</code> ) . </p><br><h3 id="pervyy-komponent-i-eksportnyy-fayl">  El primer componente y archivo de exportaci√≥n </h3><br><p>  Ahora escribiremos el componente de reacci√≥n m√°s simple para verificar c√≥mo funciona nuestro ensamblaje.  Cada componente de la biblioteca se colocar√° en un directorio separado en el directorio principal: <code>src/components/ExampleComponent</code> .  Este directorio contendr√° todos los archivos asociados con el componente: <code>tsx</code> , <code>css</code> , <code>test.tsx</code> , etc. <br>  <code>tsx</code> archivo de estilos para el componente y el archivo <code>tsx</code> del componente mismo. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * @class ExampleComponent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> interface Props { <span class="hljs-comment"><span class="hljs-comment">/** * Simple text prop **/</span></span> text: string; } <span class="hljs-comment"><span class="hljs-comment">/** My First component */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Props</span></span></span><span class="hljs-class">&gt; </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { text } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"test"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Example Component: {text} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Coool!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ExampleComponent;</code> </pre> </div></div><br><p>  Tambi√©n en <code>src</code> necesita crear un archivo con tipos que sean comunes a las bibliotecas, donde se declarar√° un tipo para css y svg (se espi√≥ en CRL). </p><br><div class="spoiler">  <b class="spoiler_title">typings.d.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Default CSS definition for typescript, * will be overridden with file-specific definitions by rollup */</span></span> declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.css'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> content: { [className: string]: string }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> content; } interface SvgrComponent extends React.FunctionComponent&lt;React.SVGAttributes&lt;SVGElement&gt;&gt; {} declare <span class="hljs-built_in"><span class="hljs-built_in">module</span></span> <span class="hljs-string"><span class="hljs-string">'*.svg'</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgUrl: string; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> svgComponent: SvgrComponent; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> svgUrl; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { svgComponent <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ReactComponent }; }</code> </pre> </div></div><br><p>  Todos los componentes exportados y CSS deben especificarse en el archivo de exportaci√≥n.  Lo tenemos: <code>src/index.tsx</code> .  Si algunos css no se utilizan en el proyecto y no figuran como parte de los importados en <code>src/index.tsx</code> , se eliminar√° del ensamblaje, lo cual est√° bien. </p><br><div class="spoiler">  <b class="spoiler_title">src / index.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent, Props } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./export.css'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { ExampleComponent, Props };</code> </pre> </div></div><br><p>  Ahora puede intentar compilar la biblioteca: <code>npm run build</code> .  Como resultado, el <code>rollup</code> comienza y recopila nuestra biblioteca en paquetes, que encontraremos en el directorio <code>dist</code> . </p><br><p>  A continuaci√≥n, agregamos algunas herramientas para mejorar la calidad de nuestro proceso de desarrollo y su resultado. </p><br><h3 id="zabyvaem-o-formatirovanii-koda-s-prettier">  Olvidar el formato de c√≥digo con Prettier </h3><br><p>  Odio en una revisi√≥n de c√≥digo se√±alar el formato que es descuidado o no est√°ndar para un proyecto, y a√∫n m√°s discutir sobre ello.  Tales fallas deber√≠an, naturalmente, corregirse, pero los desarrolladores deber√≠an centrarse en qu√© y c√≥mo funciona el c√≥digo, en lugar de c√≥mo se ve.  Estas soluciones son el primer candidato para la automatizaci√≥n.  Hay un paquete maravilloso para esta tarea: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s bonito</a> .  Instalarlo: </p><br><pre> <code class="bash hljs">npm install --save-dev prettier</code> </pre> <br><p>  Agregue una configuraci√≥n para un peque√±o refinamiento de las reglas de formato. </p><br><div class="spoiler">  <b class="spoiler_title">.prettierrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"tabWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">"singleQuote"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"jsxBracketSameLine"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"arrowParens"</span></span>: <span class="hljs-string"><span class="hljs-string">"always"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"printWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">"semi"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"bracketSpacing"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> </div></div><br><p>  Puede ver el significado de las reglas disponibles en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> .  WebStrom despu√©s de crear el archivo de configuraci√≥n en s√≠ sugerir√° usar <code>prettier</code> al comenzar a formatear a trav√©s del IDE.  Para evitar que el formateo pierda tiempo, agregue el <code>/node_modules</code> y <code>/dist</code> a las excepciones utilizando el archivo <code>.prettierignore</code> (el formato es similar a <code>.gitignore</code> ).  Ahora puede ejecutar <code>prettier</code> aplicando reglas de formato al c√≥digo fuente: </p><br><pre> <code class="bash hljs">prettier --write <span class="hljs-string"><span class="hljs-string">"**/*"</span></span></code> </pre> <br><p>  Para no ejecutar el comando expl√≠citamente cada vez con sus manos y para asegurarse de que el c√≥digo de otros desarrolladores del proyecto tambi√©n tendr√° un formato <code>prettier</code> , agregue la ejecuci√≥n <code>prettier</code> en el <code>precommit-hook</code> de <code>precommit-hook</code> para los archivos marcados como por <code>staged</code> (a trav√©s de <code>git add</code> ).  Para tal cosa, necesitamos dos herramientas.  En primer lugar, es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inc√≥modo</a> , responsable de ejecutar cualquier comando antes de cometer, empujar, etc.  Y, en segundo lugar, est√° organizado en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pelusas</a> , que puede ejecutar diferentes linters en archivos en <code>staged</code> .  Necesitamos ejecutar solo una l√≠nea para entregar estos paquetes y agregar comandos de lanzamiento a <code>package.json</code> : </p><br><pre> <code class="bash hljs">npx mrm lint-staged</code> </pre> <br><p>  No podemos esperar a formatear antes de comprometernos, pero aseg√∫rese de que <code>prettier</code> trabaje constantemente en archivos modificados en el proceso de nuestro trabajo.  S√≠, necesitamos otro paquete: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">onchange</a> .  Le permite monitorear los cambios en los archivos del proyecto e inmediatamente ejecutar el comando necesario para ellos.  Instalar: </p><br><pre> <code class="bash hljs">npm install --save-dev --save-exact onchange</code> </pre> <br><p>  Luego agregamos a los <code>scripts</code> campo de <code>scripts</code> en <code>package.json</code> : </p><br><pre> <code class="json hljs"><span class="hljs-string"><span class="hljs-string">"prettier-watch"</span></span>: <span class="hljs-string"><span class="hljs-string">"onchange 'src/**/*' -- prettier --write {{changed}}"</span></span></code> </pre> <br><p>  Sobre esto, todas las disputas sobre el formato en el proyecto pueden considerarse cerradas. </p><br><h3 id="izbegaem-oshibok-s-eslint">  Evitar errores con ESLint </h3><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ESLint se</a> ha convertido en un est√°ndar durante mucho tiempo y se puede encontrar en casi todos los proyectos js y ts.  √âl nos ayudar√° tambi√©n.  En la configuraci√≥n de ESLint, conf√≠o en CRA, as√≠ que solo tome los paquetes necesarios de CRA y con√©ctelos a nuestra biblioteca.  Adem√°s, agregue configuraciones para TS y <code>prettier</code> (para evitar conflictos entre <code>ESLint</code> y <code>prettier</code> ): </p><br><pre> <code class="bash hljs">npm install --save-dev eslint eslint-config-react-app eslint-loader eslint-plugin-flowtype eslint-plugin-import eslint-plugin-jsx-a11y eslint-plugin-react eslint-plugin-react-hooks @typescript-eslint/eslint-plugin @typescript-eslint/parser babel-eslint eslint-config-prettier eslint-plugin-prettier</code> </pre> <br><p>  <code>ESLint</code> usando el archivo de configuraci√≥n. </p><br><div class="spoiler">  <b class="spoiler_title">.eslintrc.json</b> <div class="spoiler_text"><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:@typescript-eslint/recommended"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-app"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier"</span></span>, <span class="hljs-string"><span class="hljs-string">"prettier/@typescript-eslint"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"@typescript-eslint"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/no-empty-interface"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-function-return-type"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"@typescript-eslint/explicit-member-accessibility"</span></span>: <span class="hljs-string"><span class="hljs-string">"off"</span></span> } }</code> </pre> </div></div><br><p>  Agregue el comando <code>lint</code> - <code>eslint src/**/* --ext .ts,.tsx --fix</code> al campo de <code>scripts</code> desde <code>package.json</code> .  Ahora puede ejecutar eslint a trav√©s de <code>npm run lint</code> . </p><br><h3 id="testiruem-s-jest">  Prueba con Jest </h3><br><p>  Para escribir pruebas unitarias para componentes de la biblioteca, instale y configure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Jest</a> , una biblioteca de prueba de Facebook.  Sin embargo, desde  compilamos TS no a trav√©s de babel 7, sino a trav√©s de tsc, entonces tambi√©n necesitamos instalar el paquete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ts-jest</a> : </p><br><pre> <code class="bash hljs">npm install --save-dev jest ts-jest @types/jest</code> </pre> <br><p>  Para que Jest acepte correctamente las importaciones de CSS u otros archivos, debe reemplazarlos con mokami.  Cree el directorio <code>__mocks__</code> y cree dos archivos all√≠. <br>  <code>styleMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = {};</code> </pre> <br><p>  <code>fileMock.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-string"><span class="hljs-string">'test-file-stub'</span></span>;</code> </pre> <br><p>  Ahora crea la configuraci√≥n jest. </p><br><div class="spoiler">  <b class="spoiler_title">jest.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">preset</span></span>: <span class="hljs-string"><span class="hljs-string">'ts-jest'</span></span>, <span class="hljs-attr"><span class="hljs-attr">testEnvironment</span></span>: <span class="hljs-string"><span class="hljs-string">'node'</span></span>, <span class="hljs-attr"><span class="hljs-attr">moduleNameMapper</span></span>: { <span class="hljs-string"><span class="hljs-string">'\\.(css|less|sass|scss)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/styleMock.ts'</span></span>, <span class="hljs-string"><span class="hljs-string">'\\.(gif|ttf|eot|svg)$'</span></span>: <span class="hljs-string"><span class="hljs-string">'&lt;rootDir&gt;/__mocks__/fileMock.ts'</span></span> } };</code> </pre> </div></div><br><p>  Escribiremos la prueba m√°s simple para nuestro <code>ExampleComponent</code> en su directorio. </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.test.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; describe(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; { it(<span class="hljs-string"><span class="hljs-string">'is truthy'</span></span>, () =&gt; { expect(ExampleComponent).toBeTruthy(); }); });</code> </pre> </div></div><br><p>  Agregue el <code>npm run lint &amp;&amp; jest</code> <code>test</code> - <code>npm run lint &amp;&amp; jest</code> al campo de <code>scripts</code> de <code>package.json</code> .  Para mayor confiabilidad, tambi√©n manejaremos el linter.  Ahora puede ejecutar nuestras pruebas y asegurarse de que pasen - <code>npm run test</code> .  Y para que las pruebas no caigan en <code>dist</code> durante el ensamblaje, agregue el campo de <code>exclude</code> en el complemento de configuraci√≥n de <code>Rollup</code> al campo de <code>exclude</code> - <code>['src/**/*.test.(tsx|ts)']</code> .  Especifique la ejecuci√≥n de pruebas en el <code>husky pre-commit hook</code> antes de ejecutar <code>lint-staged</code> - <code>"pre-commit": "npm run test &amp;&amp; lint-staged"</code> . </p><br><h3 id="razrabatyvaem-dokumentiruem-i-lyubuemsya-komponentami-s-storybook">  Dise√±ando, documentando y admirando componentes con un Storybook </h3><br><p>  Cada biblioteca necesita buena documentaci√≥n para su uso exitoso y productivo.  En cuanto a la biblioteca de componentes de interfaz, no solo quiero leer sobre ellos, sino tambi√©n para ver c√≥mo se ven, y es mejor tocarlos y cambiarlos.  Para admitir dicha lista de deseos, hay varias soluciones.  Sol√≠a ‚Äã‚Äãusar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Styleguidist</a> .  Este paquete le permite escribir documentaci√≥n en formato de descuento, as√≠ como insertar ejemplos de los componentes React descritos en √©l.  Adem√°s, se recopila la documentaci√≥n y se obtiene un cat√°logo de escaparate del sitio, donde puede encontrar el componente, leer la documentaci√≥n al respecto, conocer sus par√°metros y tambi√©n meter una varita m√°gica en √©l. </p><br><p>  Sin embargo, esta vez decid√≠ echar un vistazo m√°s de cerca a su competidor: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Storybook</a> .  Hoy parece m√°s poderoso con su sistema de complementos.  Adem√°s, est√° en constante evoluci√≥n, tiene una gran comunidad y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pronto</a> tambi√©n comenzar√° a generar sus p√°ginas de documentaci√≥n utilizando archivos de descuento.  Otra ventaja del Storybook es que es un sandbox, un entorno para el desarrollo de componentes aislados.  Esto significa que no necesitamos ninguna aplicaci√≥n de muestra completa para el desarrollo de componentes (como sugiere CRL).  En el libro de cuentos escribimos <code>stories</code> : archivos ts en los que transferimos nuestros componentes con algunos <code>props</code> entrada a funciones especiales (es mejor mirar el c√≥digo para aclararlo).  Como resultado, se ensambla una aplicaci√≥n de escaparate a partir de estas <code>stories</code> . </p><br><p>  Ejecute el script que inicializa el libro de cuentos: </p><br><pre> <code class="bash hljs">npx -p @storybook/cli sb init</code> </pre> <br><p>  Ahora hazte amigo de TS.  Para hacer esto, necesitamos algunos paquetes m√°s, y al mismo tiempo pondremos un par de complementos √∫tiles: </p><br><pre> <code class="bash hljs">npm install --save-dev awesome-typescript-loader @types/storybook__react @storybook/addon-info react-docgen-typescript-loader @storybook/addon-actions @storybook/addon-knobs @types/storybook__addon-info @types/storybook__addon-knobs webpack-blocks</code> </pre> <br><p>  El script cre√≥ un directorio con la configuraci√≥n del <code>storybook</code> : <code>.storybook</code> y un directorio de ejemplo que eliminamos sin piedad.  Y en el directorio de configuraci√≥n cambiamos los <code>addons</code> extensi√≥n y la <code>config</code> a <code>ts</code> .  <code>addons.ts</code> complementos al archivo <code>addons.ts</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-actions/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-links/register'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/register'</span></span>;</code> </pre> <br><p>  Ahora, debe ayudar al libro de cuentos usando la configuraci√≥n del <code>.storybook</code> web en el directorio <code>.storybook</code> . </p><br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ config }</span></span></span><span class="hljs-function">) =&gt;</span></span> { config.module.rules.push({ <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(ts|tsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.resolve(<span class="hljs-string"><span class="hljs-string">'awesome-typescript-loader'</span></span>) }, <span class="hljs-comment"><span class="hljs-comment">// Optional { loader: require.resolve('react-docgen-typescript-loader') } ] }); config.resolve.extensions.push('.ts', '.tsx'); return config; };</span></span></code> </pre> </div></div><br><p>  <code>config.ts</code> un poco la configuraci√≥n de <code>config.ts</code> , agregando decoradores para conectar complementos a todas nuestras historias. </p><br><div class="spoiler">  <b class="spoiler_title">config.ts</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { configure } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { addDecorator } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withInfo } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-info'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { withKnobs } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// automatically import all files ending in *.stories.tsx const req = require.context('../src', true, /\.stories\.tsx$/); function loadStories() { req.keys().forEach(req); } configure(loadStories, module); addDecorator(withInfo); addDecorator(withKnobs);</span></span></code> </pre> </div></div><br><p>  Escribiremos nuestra primera <code>story</code> en el directorio de componentes <code>ExampleComponent</code> </p><br><div class="spoiler">  <b class="spoiler_title">ExampleComponent.stories.tsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { storiesOf } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { ExampleComponent } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./ExampleComponent'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { text } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@storybook/addon-knobs/react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> stories = storiesOf(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>); stories.add(<span class="hljs-string"><span class="hljs-string">'ExampleComponent'</span></span>, () =&gt; &lt;ExampleComponent text={text('text', 'Some text')} /&gt;, { info: { inline: true }, text: ` ### Notes Simple example component ### Usage ~~~js &lt;ExampleComponent text="Some text" /&gt; ~~~ ` });</code> </pre> <br><p>  Utilizamos complementos: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mandos</a> : permite el cambio de accesorios en tiempo real en el componente que se muestra en Storybook.  Para hacer esto, envuelva accesorios en funciones especiales en historias </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">info</a> : le permite agregar documentaci√≥n y descripci√≥n de accesorios a la p√°gina de la historia </li></ul></div></div><br><p>  Ahora tenga en cuenta que el script de inicializaci√≥n del libro de cuentos agreg√≥ el comando del libro de cuentos a nuestro <code>package.json</code> .  √öselo para ejecutar el <code>npm run storybook</code> .  El Storybook se ensamblar√° y ejecutar√° en <code>http://localhost:6006</code> .  No olvide agregar a la excepci√≥n para el m√≥dulo de <code>typescript</code> en la configuraci√≥n de <code>Rollup</code> - <code>'src/**/*.stories.tsx'</code> . </p><br><h3 id="razrabatyvaem">  Estamos desarrollando </h3><br><p>  Entonces, habi√©ndose rodeado de muchas herramientas convenientes y prepar√°ndolas para el trabajo, puede comenzar a desarrollar nuevos componentes.  Cada componente se colocar√° en su directorio en <code>src/components</code> con el nombre del componente.  Contendr√° todos los archivos asociados con √©l: css, el componente en s√≠ mismo en el archivo tsx, pruebas, historias.  Comenzamos el libro de cuentos, creamos historias para el componente y all√≠ escribimos documentaci√≥n para ello.  Creamos pruebas y pruebas.  La importaci√≥n-exportaci√≥n del componente terminado se escribe en <code>index.ts</code> . </p><br><p>  Adem√°s, puede iniciar sesi√≥n en <code>npm</code> y publicar su biblioteca como un nuevo paquete npm.  Y puede conectarlo directamente desde el repositorio git tanto desde el maestro como desde otras ramas.  Por ejemplo, para mi pieza de trabajo puede hacer: </p><br><pre> <code class="bash hljs">npm i -s git+https://github.com/jmorozov/react-library-example.git</code> </pre> <br><p>  Para que en la aplicaci√≥n de consumidor de la biblioteca en el directorio <code>node_modules</code> solo haya el contenido del directorio <code>dist</code> en el estado ensamblado, debe agregar el comando <code>"prepare": "npm run build"</code> al campo de <code>scripts</code> . </p><br><p>  Adem√°s, gracias a TS, la finalizaci√≥n autom√°tica en el IDE funcionar√°. </p><br><h2 id="podvodim-itogi">  Para resumir </h2><br><p>  A mediados de 2019, puede comenzar a desarrollar r√°pidamente su biblioteca de componentes en React y TypeScript, utilizando pr√°cticas herramientas de desarrollo.  Este resultado puede lograrse tanto con la ayuda de una utilidad automatizada como en modo manual.  Se prefiere la segunda forma si necesita paquetes actuales y m√°s control.  Lo principal es saber d√≥nde cavar, y con la ayuda de un ejemplo en este art√≠culo, espero que esto se haya vuelto algo m√°s f√°cil. </p><br><p>  Tambi√©n puede tomar la pieza de trabajo resultante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </p><br><p>  Entre otras cosas, no pretendo ser la verdad √∫ltima y, en general, estoy involucrado en el front-end en la medida en que.  Puede elegir paquetes alternativos y opciones de configuraci√≥n y tambi√©n tener √©xito en la creaci√≥n de su biblioteca de componentes.  Me alegrar√≠a si compartes tus recetas en los comentarios.  ¬°Feliz codificaci√≥n! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/461439/">https://habr.com/ru/post/461439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461425/index.html">C√≥mo convertirse en un gerente de producto y crecer m√°s</a></li>
<li><a href="../461431/index.html">"Ama y no le gusta": DNS sobre HTTPS</a></li>
<li><a href="../461433/index.html">Uso de Identity Server 4 en Net Core 3.0</a></li>
<li><a href="../461435/index.html">Reconocimiento de emociones usando una red neuronal convolucional</a></li>
<li><a href="../461437/index.html">370 bombillas</a></li>
<li><a href="../461441/index.html">Informes sobre el estado de almacenamiento utilizando R. Computaci√≥n paralela, gr√°ficos, xlsx, correo electr√≥nico y todo esto</a></li>
<li><a href="../461443/index.html">An√°lisis posterior: lo que se sabe sobre el √∫ltimo ataque a la red del servidor de claves criptogr√°ficas SKS Keyserver</a></li>
<li><a href="../461447/index.html">La √©pica sobre los administradores del sistema como una especie en peligro de extinci√≥n.</a></li>
<li><a href="../461449/index.html">PhpStorm 2019.2: Propiedades tipificadas de PHP 7.4, Buscador duplicado, EditorConfig, Shell Scripts y m√°s</a></li>
<li><a href="../461451/index.html">Mi segundo d√≠a con Haiku: encantado, pero a√∫n no estoy listo para ir</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>