<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗣️ 🙌 🧕 Citymobil-在初创企业业务增长中提高可用性的手册。 第5部分 🧗🏻 ⏱️ 🏩</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="这是描述如何提高Citymobil的服务可用性的系列文章的最后一部分（您可以在此处阅读上一部分）。 现在，我将讨论另一种中断类型，以及我们对这些中断所得出的结论，我们如何修改开发流程以及所引入的自动化。 

 1.错误发布：错误 
 这是最令人不愉快的中断和事件。 除了最终用户或企业用户的投诉外，唯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Citymobil-在初创企业业务增长中提高可用性的手册。 第5部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/450994/"><img src="https://habrastorage.org/getpro/habr/post_images/69d/ea9/db3/69dea9db332a69e8d7f992ab82102329.png"><br><br> 这是描述如何提高Citymobil的服务可用性的系列文章的最后一部分（您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>阅读上一部分）。 现在，我将讨论另一种中断类型，以及我们对这些中断所得出的结论，我们如何修改开发流程以及所引入的自动化。 <br><a name="habracut"></a><br><h2>  1.错误发布：错误 </h2><br> 这是最令人不愉快的中断和事件。 除了最终用户或企业用户的投诉外，唯一没有任何明显症状的类型。 这就是为什么这样的事件（尤其是很小的事件）在生产中可能会被暂时忽略。 <br><br> 所有其他类型的中断都或多或少类似于“不良版本：500个内部服务器错误”。 唯一的事情是它们不是由版本触发的，而是工作负载，手动操作或外部服务问题引起的。 <br><br> 为了描述处理此类中断的方法，我们应该回想起一个老笑话： <br><br><blockquote> 给数学家和物理学家提供相同的任务：烧开水。 为他们提供了一些辅助工具：火炉，水壶，带水的龙头和火柴。 他们俩轮流向水壶中注水，打开燃气并开始加热水壶。 然后简化了任务：为他们提供一个装满水的水壶和一个已经打开的炉子。 任务是一样的-烧开水。 物理学家把水壶放在火炉上。 数学家倒空了水壶，关掉了煤气，说：“问题已经解决了。”  ©anekdotov.net </blockquote><br> 必须不计一切代价将这种中断减少为“错误发布：500个内部服务器错误”。 理想情况下，错误的记录方式应与500个错误的记录方式相同。 但是，当然，您不能记录错误事件，因为如果可以的话，您一开始就不会犯错误。 <br><br> 跟踪错误的想法之一是在数据库中搜索跟踪。 这些跟踪使我们能够看到存在错误并发出警报。 我们如何对此提供帮助？ 我们开始研究每个大错误并提出解决方案：可以创建什么样的监视/ SMS警报以使该错误立即显示为500错误？ 这里有一些例子。 <br><br><h4>  1.1。 错误导致的中断示例 </h4><br> 突然，我们收到了来自用户的大量投诉：无法关闭通过Apple Pay支付的订单。 我们开始调查； 问题是在测试环境中重现的。 找到了根本原因：我们更新了信用卡的到期日期格式，因为它被付款处理服务更改了，但是对于通过Apple Pay付款，我们没有正确执行； 因此，所有Apple Pay付款均被拒绝。 我们一知道问题就将其修复，部署并解决了问题。 但是，此问题已存在45分钟。 <br><br> 发生此问题后，我们监控了许多Apple Pay付款失败的情况，并创建了一些非零阈值的SMS和IVR警报（因为该服务认为某些未成功付款是正常的；例如，如果客户的账户中没有钱）或她的信用卡被屏蔽）。 从那一刻起，我们将立即发现阈值交叉点。 如果新版本对Apple Pay的处理造成任何问题，我们将通过监控立即发现该问题，并在3分钟内回滚该版本（手动回滚的过程在前面的一篇文章中进行了介绍）。 因此过去曾经是45分钟的部分停机时间，而现在是3分钟。 赢利！ <br><br><h4>  1.2。 其他例子 </h4><br> 订单列表中的错误。 我们在驱动程序应用程序中优化了订单列表。 该代码有一个错误。 结果，有时驾驶员看到空订单列表。 我们偶然发现了这个错误：一位工程师正在使用驱动程序，并遇到了这个问题。 我们很快发现了不良版本，并立即将其回滚。 因此，我们根据数据库中的信息创建了列表中平均订单数的图表。 然后，我们逐月回顾了该图。 我们注意到由该错误引起的最近一次山沟，并通过SQL查询创建了SMS警报。 当列表中的平均订单数超过根据当前月份的最小值设置的下限阈值时，它将构建此图。 <br><br>  Cachback中的错误。 我们正在更改用户的现金返还赠与逻辑。 除其他外，我们将其发送给错误的客户群。 问题已解决，创建了现金返还图表； 我们看到它急剧增加，并且还注意到这从未发生过，并创建了具有适当阈值的SMS警报。 <br><br> 再次是付款错误。 新版本导致了该错误-订单需要花很长时间，卡付款无效，司机要求客户以现金付款。 我们通过呼叫中心投诉发现了问题所在。 我们部署了一个修复程序，并通过历史图表分析发现了带有阈值的订单的关闭时间警报。 <br><br> 如您所知，我们正在使用相同的方法来处理所有此类事件： <br><br><ol><li> 我们发现一个问题。 </li><li> 我们对其进行故障排除并找到代码中的错误。 </li><li> 我们修复它。 </li><li> 我们找出数据库中的痕迹（也可以在Web服务器日志或Kibana中找到痕迹），这些痕迹可以指出问题的征兆。 </li><li> 我们建立这些痕迹的图形。 </li><li> 我们回到过去，看看图表中的起伏。 </li><li> 我们为警报选择了一个好的阈值。 </li><li> 当问题再次出现时，我们立即通过SMS警报找到有关问题。 </li></ol><br> 这种方法的优点是：一张图表和一个警报可以解决整个大问题（问题组的示例：无法结清订单，额外奖金，Apple Pay付款不通过等） <br><br> 最终，我们将每一个大错误实施了警报和监视，作为我们工程文化的一部分。 为了不丢失这种文化，我们将其正式化。 我们开始强迫自己为每次故障创建报告。 该报告的表格填写了以下问题的答案：根本原因，我们如何解决，业务影响，要点。 所有字段均为必填项。 因此，我们必须得出结论，我们是否喜欢它。 显然，此过程更改已记录为“做”和“不做”。 <br><br><h2>  2. Kotan </h2><br> 我们的流程自动化水平正在提高，我们认为是时候创建一个可以显示当前开发流程状态的Web界面了。 我们将此网络界面称为“ Kotan”（俄语单词“ roll”，“ roll out” :-） <br><br>  “ Kotan”具有以下功能： <br><br>  <b>事件清单</b> 。 它包含过去警报中触发的所有事件的列表-要求立即做出人为反应的事件。 对于每个事件，我们都会记录它的开始时间，结束时间（如果已经结束），链接到报告（如果事件结束并且有报告）和警报指南链接，以查看此事件的警报类型属于。 <br><br>  <b>警报目录</b> 。 这实际上是所有警报的列表。 更清楚地说，警报和事件之间的区别如下：警报就像一个类，而事件-是一个对象。 例如，警报为“ 500个错误的数量大于1”。 并且“ 500个错误的数量大于1，并且在这个日期发生了，此时，持续了这么长时间”-是一个事件。 在解决了某些从未由警报系统检测到的特定问题之后，通过上述过程将每个警报手动添加到系统中。 这种迭代方法保证了误报的风险低（不需要采取任何措施）。 该目录包含每种警报类型的完整报告历史记录。 可以帮助您更快地诊断问题：您会收到警报，转到“ Kotan”，单击“目录”，查看所有历史记录并获得有关在何处潜水的想法。 成功进行故障排除的关键是掌握所有信息。 警报源代码的链接（以确保知道此警报在什么情况下向您发出信号）。 对抗此警报的最佳最新方法的书面说明。 <br><br>  <b>报告书</b> 这些都是历史上的所有报告。 每个报告都有与之关联的所有事件的链接（有时这些事件按组分组；根本原因是相同的，并且我们为整个组创建了一个报告），该报告的撰写日期，问题解决方案确认标志以及大多数重要的是：根本原因，解决方法，对业务的影响和收益。 <br><br>  <b>外卖清单</b> 。 每个外卖都有注释，说明是否已实施，是否仍要实施或不需要（说明为什么不这样做）。 <br><br><h2>  3.软件开发过程中发生了什么变化？ </h2><br> 可用性改进的关键组成部分是软件开发过程。 这个过程在不断变化。 此类更改的目标是减少发生事故的机会。 修改流程的决定不应抽象地做出，而应基于经验，事实和数字。 整个过程绝不能从总监的​​角度进行，而应由下而上地在所有团队成员的积极参与下进行，因为整个团队的许多负责人要胜过经理的一个主管。 该过程必须得到遵循和监控； 否则，没有意义。 团队成员必须相互纠正以防出现分歧：还有谁会为他们做这些呢？ 必须要有最大程度的自动化来照顾主要功能，因为人类会不断犯错，尤其是在创造性工作中。 <br><br> 为了确保每个事件都能解决，我们做了以下工作： <br><br><ul><li> 每个警报都会自动阻止发布。 </li><li> 当我们收到关闭警报（一条短信指出事件已结束）时，我们不会立即取消阻止发布，而是为我们提供了一份事故报告。 </li><li> 报告必须包含以下信息：事故的根本原因，如何解决，业务影响，要点。 </li><li> 该报告由对事故进行故障排除的团队撰写。 那些掌握有关事故的完整信息的人。 </li><li> 在创建和批准此类报告之前，发布会被自动阻止。 这激励团队在事故修复后立即集中精力并创建报告。 </li><li> 该报告必须得到非团队成员的批准，以确保该报告包含理解该报告所需的所有信息。 </li></ul><br> 这样，我们一方面在保存每个事件的历史记录方面实现了自律，另一方面，我们提供了自动控制功能。 现在不可能不得出结论或不写报告。 <br><br><h2>  4.代替结尾 </h2><br> 代替结尾，让我快速总结一下我们在软件开发过程中所做的更改，以减少丢失的行程。 <br><br><div class="scrollable-table"><table><tbody><tr><th> 我们改变了什么？ <br></th><th> 我们为什么要更改它？ <br></th></tr><tr><td> 我们开始保留事故日志。 <br></td><td> 外卖并防止将来发生事故。 <br></td></tr><tr><td> 我们为每一次大故障（有很多旅行失败的人）创建一个验尸。 <br></td><td> 了解将来如何快速排除故障并修复此类故障。 <br></td></tr><tr><td> 我们创建了“执行”和“不执行”文件。 <br></td><td> 与所有工程师共享智慧。 <br></td></tr><tr><td> 每五分钟仅发布一次。 <br></td><td> 减少故障排除的时间。 <br></td></tr><tr><td> 首先，我们将代码部署在一个低优先级的Web服务器上，然后再部署在所有其他服务器上。 <br></td><td> 减少不良发布的影响。 <br></td></tr><tr><td> 自动化的错误发布回滚。 <br></td><td> 减少不良发布的影响。 <br></td></tr><tr><td> 中断期间无部署。 <br></td><td> 加快故障排除速度。 <br></td></tr><tr><td> 我们在群聊中写有关释放和事故的信息。 <br></td><td> 加快故障排除速度。 <br></td></tr><tr><td> 每次发行后，我们都会监控图表3分钟。 <br></td><td> 加快故障排除速度。 <br></td></tr><tr><td> 有关问题的SMS和IVR警报。 <br></td><td> 加快故障排除速度。 <br></td></tr><tr><td> 每个错误（尤其是大错误）之后都进行监视和警报。 <br></td><td> 以便日后加快对类似情况的故障排除。 <br></td></tr><tr><td> 代码优化审查。 <br></td><td> 为了减少由于数据库超载而导致事故的机会。 <br></td></tr><tr><td> 常规代码优化（使用MySQL slow.log作为输入）。 <br></td><td> 减少因“复活节彩蛋”引起的事故。 <br></td></tr><tr><td> 每次事故都必须有外卖。 <br></td><td> 它减少了将来发生此类事故的机会。 <br></td></tr><tr><td> 每次事故都必须有警报。 <br></td><td> 它减少了以后对此类事故进行故障排除和修复的时间。 <br></td></tr><tr><td> 事故发生后，在编写和批准报告之前，自动阻止新版本。 <br></td><td> 它增加了适当外卖的机会，从而减少了将来发生此类事故的机会。 <br></td></tr><tr><td>  “ Kotan”-自动化服务改进工具。 <br></td><td> 它减少了停机时间； 减少发生中断的机会。 <br></td></tr><tr><td> 事件目录。 <br></td><td> 它减少了故障排除的时间 <br></td></tr></tbody></table></div><br> 感谢您阅读到最后。 祝您生意兴隆！ 希望您能少丢失订单，交易，购买，旅行以及对您而言至关重要的一切！ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN450994/">https://habr.com/ru/post/zh-CN450994/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN450984/index.html">我们邀请您参加第二届Camunda BPM Meetup Raiffeisenbank UPD广播</a></li>
<li><a href="../zh-CN450986/index.html">长名太长</a></li>
<li><a href="../zh-CN450988/index.html">JavaScript捷径：基本指南</a></li>
<li><a href="../zh-CN450990/index.html">从.NET世界到JavaScript世界的桥梁</a></li>
<li><a href="../zh-CN450992/index.html">如何下载JDK 12？ 7个字符说明</a></li>
<li><a href="../zh-CN450996/index.html">游戏框架：2019年JavaScript趋势</a></li>
<li><a href="../zh-CN450998/index.html">游戏中3D纹理的简史</a></li>
<li><a href="../zh-CN451002/index.html">定制计算机组装，第1部分</a></li>
<li><a href="../zh-CN451004/index.html">技术圈。 讲座课程“ IT项目和产品管理”</a></li>
<li><a href="../zh-CN451006/index.html">IT领域HR专业人员的事件摘要（2019年5月）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>