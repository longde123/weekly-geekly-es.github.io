<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ず   Estructuras de referencia desechables en C # 8.0 锔  </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Veamos qu茅 dice el blog sobre los pr贸ximos cambios en C # 8.0 (versi贸n de Visual Studio 2019 Preview 2): 


 Las estructuras de solo pila aparecieron...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estructuras de referencia desechables en C # 8.0</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/clrium/blog/447014/"><img src="https://habrastorage.org/webt/nm/tj/eq/nmtjeqodhdjh27wvs0w6v8_0dhu.png"><br><p>  Veamos qu茅 dice el blog sobre los pr贸ximos cambios en C # 8.0 (versi贸n de Visual Studio 2019 Preview 2): </p><br><p>  Las estructuras de solo pila aparecieron en C # 7.2.  Son extremadamente 煤tiles, pero al mismo tiempo su uso est谩 estrechamente relacionado con restricciones, por ejemplo, la incapacidad de implementar interfaces.  Ahora las estructuras de enlace se pueden limpiar usando el m茅todo Dispose dentro de ellas sin usar la interfaz IDisposable ". </p><br><p>  As铆 es: las estructuras de referencia solo de pila no implementan interfaces, de lo contrario, la probabilidad de su empaquetado surgir铆a.  Por lo tanto, no pueden implementar IDisposable, y no podemos usar estas estructuras en la declaraci贸n de uso: </p><br><pre><code class="plaintext hljs">class Program { static void Main(string[] args) { using (var book = new Book()) { Console.WriteLine("Hello World!"); } } } ref struct Book : IDisposable { public void Dispose() { } }</code> </pre> <br><p>  Intentar ejecutar este c贸digo dar谩 como resultado un error de compilaci贸n <a name="habracut"></a>  : </p><br><pre> <code class="plaintext hljs">Error CS8343 'Book': ref structs cannot implement interfaces</code> </pre> <br><p>  Sin embargo, ahora si agregamos el m茅todo p煤blico <code>Dispose</code> a la estructura de referencia, la instrucci贸n <code>using</code> lo aceptar谩 m谩gicamente y todo se compilar谩: </p><br><pre> <code class="plaintext hljs">class Program { static void Main(string[] args) { using (var book = new Book()) { // ... } } } ref struct Book { public void Dispose() { } }</code> </pre> <br><p>  Adem谩s, gracias a los cambios en la declaraci贸n en s铆, ahora puede usar el uso en una forma m谩s corta (las llamadas declaraciones de <code>using</code> ): </p><br><pre> <code class="plaintext hljs">class Program { static void Main(string[] args) { using var book = new Book(); // ... } }</code> </pre> <br><p>  Pero ... porque? </p><br><p>  Esta es una larga historia, pero en general, la limpieza expl铆cita (finalizaci贸n determinista) es preferible a la impl铆cita (finalizaci贸n no determinista).  Esto es intuitivo.  Es mejor borrar expl铆citamente los recursos lo antes posible (llamando a Cerrar, Eliminar o usando la declaraci贸n), en lugar de esperar la limpieza impl铆cita que suceder谩 "alg煤n d铆a" (cuando el entorno mismo inicie los finalizadores). </p><br><p>  Por lo tanto, al crear un tipo que posee un determinado recurso, es mejor prever la posibilidad de limpieza expl铆citamente.  En C #, esta es obviamente la interfaz <code>IDisposable</code> y su m茅todo <code>Dispose</code> . </p><br><p>  Nota  No olvide que en el caso de las estructuras de referencia, solo se utiliza una limpieza expl铆cita, ya que la definici贸n de finalizadores para ellas es imposible. </p><br><p>  Veamos un ejemplo ilustrativo del habitual "contenedor para un grupo de memoria no administrado".  Ocupa el espacio m谩s peque帽o posible (el mont贸n no se usa en absoluto) precisamente gracias a la estructura de enlace destinada a personas obsesionadas con el rendimiento: </p><br><pre> <code class="plaintext hljs">public unsafe ref struct UnmanagedArray&lt;T&gt; where T : unmanaged { private T* data; public UnmanagedArray(int length) { data = // get memory from some pool } public ref T this[int index] { get { return ref data[index]; } } public void Dispose() { // return memory to the pool } }</code> </pre> <br><p>  Como el contenedor contiene un recurso no administrado, utilizamos el m茅todo Dispose para limpiarlo despu茅s de su uso.  Entonces el ejemplo se parece a esto: </p><br><pre> <code class="plaintext hljs">static void Main(string[] args) { var array = new UnmanagedArray&lt;int&gt;(10); Console.WriteLine(array[0]); array.Dispose(); }</code> </pre> <br><p>  Esto es inconveniente porque debe recordar llamar a Dispose.  Adem谩s, esta es una decisi贸n dolorosa, ya que manejar excepciones correctamente no es aplicable aqu铆.  Por lo tanto, para que se llame a Dispose desde dentro, se introdujo la instrucci贸n using.  Sin embargo, antes, como ya se mencion贸, era imposible aplicarlo en esta situaci贸n. </p><br><p>  Pero en C # 8.0, puede aprovechar al m谩ximo la declaraci贸n de uso: </p><br><pre> <code class="plaintext hljs">static void Main(string[] args) { using (var array = new UnmanagedArray&lt;int&gt;(10)) { Console.WriteLine(array[0]); } }</code> </pre> <br><p>  Al mismo tiempo, el c贸digo se ha vuelto m谩s conciso gracias a las declaraciones: </p><br><pre> <code class="plaintext hljs">static void Main(string[] args) { using var array = new UnmanagedArray&lt;int&gt;(10); Console.WriteLine(array[0]); }</code> </pre> <br><p>  Los otros dos ejemplos a continuaci贸n (gran parte del c贸digo omitido por brevedad) se toman del repositorio CoreFX. </p><br><p>  El primer ejemplo es la estructura de referencia ValueUtf8Converter, que envuelve un conjunto de bytes [] de un conjunto de conjuntos: </p><br><pre> <code class="plaintext hljs">internal ref struct ValueUtf8Converter { private byte[] _arrayToReturnToPool; ... public ValueUtf8Converter(Span&lt;byte&gt; initialBuffer) { _arrayToReturnToPool = null; } public Span&lt;byte&gt; ConvertAndTerminateString(ReadOnlySpan&lt;char&gt; value) { ... } public void Dispose() { byte[] toReturn = _arrayToReturnToPool; if (toReturn != null) { _arrayToReturnToPool = null; ArrayPool&lt;byte&gt;.Shared.Return(toReturn); } } }</code> </pre> <br><p>  El segundo ejemplo es RegexWriter, que envuelve dos estructuras de referencia de ValueListBuilder que deben borrarse expl铆citamente (ya que tambi茅n administran matrices del conjunto de matrices): </p><br><pre> <code class="plaintext hljs">internal ref struct RegexWriter { ... private ValueListBuilder&lt;int&gt; _emitted; private ValueListBuilder&lt;int&gt; _intStack; ... public void Dispose() { _emitted.Dispose(); _intStack.Dispose(); } }</code> </pre> <br><h2 id="zaklyuchenie">  Conclusi贸n </h2><br><p>  Las estructuras referenciadas removibles se pueden considerar como tipos de poco espacio que tienen un destructor REAL, como en C ++.  Se invocar谩 tan pronto como la instancia correspondiente vaya m谩s all谩 del alcance de la declaraci贸n de uso (o alcance en el caso de una declaraci贸n de uso). </p><br><p>  Por supuesto, de repente no se volver谩n populares cuando escriban programas regulares orientados al comercio, pero si est谩 creando c贸digo de alto rendimiento y bajo nivel, debe conocerlos. </p><br><p>  <em>Y tambi茅n tenemos un art铆culo sobre nuestra conferencia:</em> </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/97f/1d3/cf0/97f1d3cf0e2a6bf007066eb60a789c31.png"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/447014/">https://habr.com/ru/post/447014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447002/index.html">Tour de coworking fotogr谩fico de Cabinet Lounge</a></li>
<li><a href="../447004/index.html">Universal Watchdog en ATtiny13</a></li>
<li><a href="../447006/index.html">Gu铆a: c贸mo hacer un bot simple para JS Telegram para un principiante en programaci贸n</a></li>
<li><a href="../447008/index.html">C贸mo tomar el control de su infraestructura de red. Tabla de contenidos</a></li>
<li><a href="../447010/index.html">No por mucho tiempo la m煤sica son贸 ... o c贸mo el OS Elbrus nunca se volvi贸 libre</a></li>
<li><a href="../447016/index.html">25 a帽os despu茅s: una entrevista con Linus Torvalds</a></li>
<li><a href="../447018/index.html">Enriquecimiento cu谩ntico en una interpretaci贸n multimundo</a></li>
<li><a href="../447020/index.html">La productividad no se trata de la gesti贸n del tiempo, sino de la gesti贸n de la atenci贸n.</a></li>
<li><a href="../447022/index.html">No obligue a los oyentes a reflexionar</a></li>
<li><a href="../447024/index.html">驴C贸mo combinar las ventajas de una computadora port谩til y una computadora de escritorio? An谩lisis del problema y soluciones.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>