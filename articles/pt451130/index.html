<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèΩ üë©üèø‚Äçü§ù‚Äçüë©üèº üßõüèº Swift: ARC e gerenciamento de mem√≥ria üåÆ üóíÔ∏è üòæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sendo uma linguagem moderna de alto n√≠vel, o Swift basicamente cuida do gerenciamento de mem√≥ria em seus aplicativos, alocando e liberando mem√≥ria. Is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Swift: ARC e gerenciamento de mem√≥ria</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451130/">  Sendo uma linguagem moderna de alto n√≠vel, o <b>Swift</b> basicamente cuida do gerenciamento de mem√≥ria em seus aplicativos, alocando e liberando mem√≥ria.  Isso ocorre devido a um mecanismo chamado <b>contagem autom√°tica de refer√™ncia</b> , ou <b>ARC, para</b> abreviar.  Neste guia, voc√™ aprender√° como o ARC funciona e como gerenciar adequadamente a mem√≥ria no Swift.  No√ß√µes b√°sicas sobre esse mecanismo, voc√™ pode influenciar a vida √∫til dos objetos localizados na pilha ( <b>pilha</b> ). <br><br>  Neste guia, voc√™ desenvolver√° seu conhecimento sobre Swift e ARC aprendendo o seguinte: <br><br><ul><li>  como o ARC funciona </li><li>  o que s√£o <b>ciclos de refer√™ncia</b> e como corrigi-los corretamente </li><li>  como criar um loop de link de exemplo </li><li>  Como encontrar loops de link usando as ferramentas visuais oferecidas pelo Xcode </li><li>  como lidar com tipos de refer√™ncia e tipos de valor </li></ul><a name="habracut"></a><br><h2>  Introdu√ß√£o </h2><br>  Fa√ßa o download dos <a href="" rel="nofollow">materiais de origem.</a>  Abra o projeto na pasta <b>Cycles / Starter</b> .  Na primeira parte do nosso guia, entendendo os principais conceitos, trataremos exclusivamente do arquivo <b>MainViewController.swif</b> t. <br><br>  Adicione esta classe na parte inferior do MainViewController.swift: <br><br><pre><code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = name <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"User \(name) was initialized"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Deallocating user named: \(name)"</span></span>) } }</code> </pre> <br>  A classe <b>User</b> √© definida aqui, a qual, com a ajuda das instru√ß√µes <b>print</b> , nos sinaliza sobre a inicializa√ß√£o e o lan√ßamento da inst√¢ncia da classe. <br><br>  Agora crie uma inst√¢ncia da classe User na parte superior do MainViewController. <br><br>  Coloque esse c√≥digo antes do m√©todo <b>viewDidLoad ()</b> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user = <span class="hljs-type"><span class="hljs-type">User</span></span>(name: <span class="hljs-string"><span class="hljs-string">"John"</span></span>)</code> </pre> <br>  Inicie o aplicativo.  Torne o console do Xcode vis√≠vel com <b>Command-Shift-Y</b> para ver a sa√≠da das instru√ß√µes de impress√£o. <br><br>  Observe que o <b>usu√°rio John foi inicializado</b> apareceu no console, mas a instru√ß√£o print dentro do <b>deinit</b> n√£o <b>foi</b> executada.  Isso significa que esse objeto n√£o foi lan√ßado, pois n√£o saiu do <b>escopo</b> . <br><br>  Em outras palavras, at√© que o controlador de exibi√ß√£o que cont√©m este objeto fique fora do escopo, o objeto nunca ser√° liberado. <br><br><h2>  Ele est√° no escopo? </h2><br>  Ao envolver uma inst√¢ncia da classe User em um m√©todo, permitiremos que ela fique fora do escopo, permitindo que o ARC a liberte. <br><br>  Vamos criar o m√©todo <b>runScenario ()</b> dentro da classe MainViewController e mover a inicializa√ß√£o da inst√¢ncia da classe User dentro dela. <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runScenario</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user = <span class="hljs-type"><span class="hljs-type">User</span></span>(name: <span class="hljs-string"><span class="hljs-string">"John"</span></span>) }</code> </pre><br>  runScenario () define o escopo da inst√¢ncia do usu√°rio.  Ao sair desta zona, o <b>usu√°rio</b> deve ser liberado. <br><br>  Agora chame runScenario () adicionando isso no final de viewDidLoad (): <br><br><pre> <code class="swift hljs">runScenario()</code> </pre> <br>  Inicie o aplicativo.  A sa√≠da do console agora fica assim: <br><br>  O usu√°rio John foi inicializado <br>  Desalocando usu√°rio chamado: John <br><br>  Isso significa que voc√™ liberou um objeto que saiu do campo de vis√£o. <br><br><h2>  Dura√ß√£o do objeto </h2><br><br>  A exist√™ncia do objeto √© dividida em cinco est√°gios: <br><br><ul><li>  aloca√ß√£o de mem√≥ria: da pilha ou da pilha </li><li>  inicializa√ß√£o: o c√≥digo √© executado dentro do init </li><li>  uso de </li><li>  desinicializa√ß√£o: o c√≥digo √© executado dentro do deinit </li><li>  mem√≥ria livre: a mem√≥ria alocada √© retornada √† pilha ou pilha </li></ul><br>  N√£o existe uma maneira direta de rastrear as etapas de aloca√ß√£o e libera√ß√£o de mem√≥ria, mas voc√™ pode usar o c√≥digo dentro de init e deinit. <br><br>  <b>As contagens de refer√™ncia</b> , tamb√©m conhecidas como <b>contagens de uso</b> , determinam quando um objeto n√£o √© mais necess√°rio.  Este contador mostra o n√∫mero daqueles que "usam" este objeto.  Um objeto se torna desnecess√°rio quando o contador de uso √© zero.  Em seguida, o objeto √© dessinicializado e liberado. <br><br><img src="https://habrastorage.org/webt/b5/oo/78/b5oo78ealf173ey0ayz7rngnszk.png"><br><br>  Quando o objeto Usu√°rio √© inicializado, sua contagem de refer√™ncia √© 1, porque a constante do <b>usu√°rio</b> se refere a esse objeto. <br><br>  No final de runScenario (), o usu√°rio fica fora do escopo e a contagem de refer√™ncia √© reduzida para 0. Como resultado, o usu√°rio √© n√£o inicializado e liberado. <br><br><h2>  Ciclos de refer√™ncia </h2><br>  Na maioria dos casos, o ARC funciona como deveria.  O desenvolvedor geralmente n√£o precisa se preocupar com vazamentos de mem√≥ria quando objetos n√£o utilizados permanecem n√£o alocados indefinidamente. <br><br>  Mas nem sempre!  Poss√≠veis vazamentos de mem√≥ria. <br><br>  Como isso pode acontecer?  Imagine uma situa√ß√£o em que dois objetos n√£o sejam mais usados, mas cada um deles se refira ao outro.  Como cada contagem de refer√™ncia n√£o √© 0, nenhum deles ser√° liberado. <br><br><img src="https://habrastorage.org/webt/hd/zp/ff/hdzpffk1eh3rug0fgmgnlghnb3q.png"><br><br>  Este √© um <b>forte ciclo de refer√™ncia</b> .  Essa situa√ß√£o confunde o ARC e n√£o permite que ele limpe a mem√≥ria. <br><br>  Como voc√™ pode ver, a contagem de refer√™ncia no final n√£o √© 0 e, embora nenhum objeto seja mais necess√°rio, o objeto1 e o objeto2 n√£o ser√£o liberados. <br><br><h2>  Confira nossos links </h2><br>  Para testar tudo isso em a√ß√£o, adicione esse c√≥digo ap√≥s a classe User em MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Phone</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> model: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner: <span class="hljs-type"><span class="hljs-type">User?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(model: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = model <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Phone \(model) was initialized"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Deallocating phone named: \(model)"</span></span>) } }</code> </pre> <br>  Esse c√≥digo adiciona uma nova classe <b>Phone</b> com duas propriedades, uma para o modelo e outra para o propriet√°rio, al√©m dos m√©todos init e deinit.  A propriedade do propriet√°rio √© opcional, pois o telefone pode n√£o ter um propriet√°rio. <br><br>  Agora adicione esta linha ao runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> iPhone = <span class="hljs-type"><span class="hljs-type">Phone</span></span>(model: <span class="hljs-string"><span class="hljs-string">"iPhone Xs"</span></span>)</code> </pre><br>  Isso criar√° uma inst√¢ncia da classe Phone. <br><br><h2>  Segure o celular </h2><br>  Agora adicione esse c√≥digo √† classe User, imediatamente ap√≥s a propriedade name: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> phones: [<span class="hljs-type"><span class="hljs-type">Phone</span></span>] = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phone: Phone)</span></span></span></span> { phones.append(phone) phone.owner = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> }</code> </pre><br>  Adicione uma variedade de telefones pertencentes ao usu√°rio.  O setter est√° marcado como privado, portanto, adicione (telefone :) deve ser usado. <br><br>  Inicie o aplicativo.  Como voc√™ pode ver, as inst√¢ncias das classes de objetos Telefone e Usu√°rio s√£o liberadas conforme necess√°rio. <br><br>  O usu√°rio John foi inicializado <br>  O telefone iPhone XS foi inicializado <br>  Desalocando o telefone com o nome: iPhone Xs <br>  Desalocando usu√°rio chamado: John <br><br>  Agora adicione isso no final do runScenario (): <br><pre> <code class="swift hljs">user.add(phone: iPhone)</code> </pre> <br><br>  Aqui, adicionamos nosso iPhone √† lista de telefones pertencentes ao <b>usu√°rio</b> e tamb√©m definimos a propriedade do <b>propriet√°rio</b> do telefone como ' <b>usu√°rio</b> '. <br><br>  Execute o aplicativo novamente.  Voc√™ ver√° que os objetos de usu√°rio e iPhone n√£o s√£o liberados.  O ciclo de fortes v√≠nculos entre eles impede o ARC de liber√°-los. <br><br><img src="https://habrastorage.org/webt/lo/az/mu/loazmuamyoww2ttr7wnwcd8_n4w.png"><br><br><h2>  Links Fracos </h2><br>  Para interromper o ciclo de v√≠nculos fortes, voc√™ pode designar o relacionamento entre objetos como fraco. <br><br>  Por padr√£o, todos os links s√£o fortes e a atribui√ß√£o leva a um aumento na contagem de refer√™ncia.  Ao usar refer√™ncias fracas, a contagem de refer√™ncias n√£o aumenta. <br><br>  Em outras palavras, <b>os elos fracos n√£o afetam o gerenciamento da vida de um objeto</b> .  Links fracos s√£o sempre declarados <b>opcionais</b> .  Dessa forma, quando a contagem de links se tornar 0, o link poder√° ser definido como nulo. <br><br><img src="https://habrastorage.org/webt/ti/qd/kc/tiqdkcyfstrndd8xswpf8zfebfo.png"><br><br>  Nesta ilustra√ß√£o, linhas tracejadas indicam links fracos.  Observe que a contagem de refer√™ncia do objeto1 √© 1, pois a vari√°vel1 se refere a ele.  A contagem de refer√™ncia do objeto2 √© 2, porque √© referenciada pela vari√°vel2 e pelo objeto1. <br><br>  O objeto2 tamb√©m faz refer√™ncia ao objeto1, mas <b>WEAK</b> , o que significa que ele n√£o afeta a contagem de refer√™ncias do objeto1. <br><br>  Quando a vari√°vel1 e a vari√°vel2 s√£o liberadas, o objeto1 tem uma contagem de refer√™ncia 0, que a libera.  Isso, por sua vez, libera uma forte refer√™ncia ao objeto2, que j√° leva ao seu lan√ßamento. <br><br>  Na classe Phone, altere a declara√ß√£o de propriedade do propriet√°rio da seguinte maneira: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner: <span class="hljs-type"><span class="hljs-type">User?</span></span></code> </pre> <br>  Ao declarar a refer√™ncia da propriedade do propriet√°rio como 'fraca', interrompemos o ciclo de v√≠nculos fortes entre as classes User e Phone. <br><br><img src="https://habrastorage.org/webt/ym/ax/_m/ymax_mv9cvlpi8xqwnxmb14vr2g.png"><br><br>  Inicie o aplicativo.  Agora, usu√°rio e telefone foram liberados corretamente. <br><br><h2>  Links n√£o propriet√°rios </h2><br>  H√° tamb√©m outro modificador de link que n√£o aumenta a contagem de refer√™ncia: <b>sem dono</b> . <br><br>  Qual a diferen√ßa entre <b>n√£o dono</b> e <b>fraco</b> ?  Uma refer√™ncia fraca √© sempre opcional e se torna automaticamente nula quando o objeto referenciado √© liberado. <br><br>  √â por isso que devemos declarar propriedades fracas como uma vari√°vel opcional do tipo: essa propriedade deve mudar. <br><br>  Os links n√£o propriet√°rios, por outro lado, nunca s√£o opcionais.  Se voc√™ tentar acessar uma propriedade n√£o propriet√°ria que se refere a um objeto liberado, receber√° um erro que se parece com um desembrulhamento for√ßado contendo uma vari√°vel nula (for√ßar desembrulhamento). <br><br><img src="https://habrastorage.org/webt/i9/hf/bc/i9hfbcizzk2eg38s_hidjq3evju.png"><br><br>  Vamos tentar aplicar <b>sem dono</b> . <br><br>  Adicione uma nova classe <b>CarrierSubscription</b> no final do MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CarrierSubscription</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> countryCode: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user: <span class="hljs-type"><span class="hljs-type">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>, countryCode: <span class="hljs-type"><span class="hljs-type">String</span></span>, number: <span class="hljs-type"><span class="hljs-type">String</span></span>, user: <span class="hljs-type"><span class="hljs-type">User</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = name <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.countryCode = countryCode <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.number = number <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.user = user <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"CarrierSubscription \(name) is initialized"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Deallocating CarrierSubscription named: \(name)"</span></span>) } }</code> </pre> <br>  CarrierSubscription possui quatro propriedades: <br><br>  Nome: nome do provedor. <br>  CountryCode: c√≥digo do pa√≠s. <br>  N√∫mero: n√∫mero de telefone. <br>  Usu√°rio: link para o usu√°rio. <br><br><h2>  Quem √© o seu provedor? </h2><br>  Agora adicione isso √† classe User ap√≥s a propriedade name: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> subscriptions: [<span class="hljs-type"><span class="hljs-type">CarrierSubscription</span></span>] = []</code> </pre> <br>  Aqui mantemos uma variedade de provedores de usu√°rios. <br><br>  Agora adicione isso √† classe Phone, ap√≥s a propriedade do propriet√°rio: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> carrierSubscription: <span class="hljs-type"><span class="hljs-type">CarrierSubscription?</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provision</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(carrierSubscription: CarrierSubscription)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.carrierSubscription = carrierSubscription } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decommission</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { carrierSubscription = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> }</code> </pre> <br>  Isso adiciona a propriedade opcional CarrierSubscription e dois m√©todos para registrar e cancelar o registro do telefone com o provedor. <br><br>  Agora adicione a classe CarrierSubscription dentro do m√©todo init, logo antes da instru√ß√£o print: <br><br><pre> <code class="swift hljs">user.subscriptions.append(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)</code> </pre> <br>  Adicionamos CarrierSubscription √† matriz de provedores de usu√°rios. <br><br>  Por fim, adicione isso no final do m√©todo runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> subscription = <span class="hljs-type"><span class="hljs-type">CarrierSubscription</span></span>( name: <span class="hljs-string"><span class="hljs-string">"TelBel"</span></span>, countryCode: <span class="hljs-string"><span class="hljs-string">"0032"</span></span>, number: <span class="hljs-string"><span class="hljs-string">"31415926"</span></span>, user: user) iPhone.provision(carrierSubscription: subscription)</code> </pre> <br>  Criamos uma assinatura do provedor para o usu√°rio e conectamos o telefone a ele. <br><br>  Inicie o aplicativo.  No console, voc√™ ver√°: <br><br>  O usu√°rio John foi inicializado <br>  Telefone iPhone Xs foi inicializado <br>  CarrierSubscription TelBel √© inicializado <br><br>  E novamente um ciclo de links!  usu√°rio, iPhone e assinatura n√£o foram liberados no final. <br><br>  Voc√™ consegue encontrar um problema? <br><br><img src="https://habrastorage.org/webt/uu/fg/eq/uufgeqkvqa31jwwlsnlikc-iob8.png"><br><br><h2>  Quebrando a corrente </h2><br>  O link do usu√°rio para a assinatura ou o link da assinatura para o usu√°rio deve ser n√£o propriet√°rio para interromper o ciclo.  A quest√£o √© qual op√ß√£o escolher.  Vamos olhar para as estruturas. <br><br>  Um usu√°rio possui uma assinatura de um provedor, mas vice-versa - n√£o, uma assinatura de um provedor n√£o possui um usu√°rio. <br><br>  Al√©m disso, n√£o faz sentido a exist√™ncia de CarrierSubscription sem refer√™ncia ao usu√°rio que o possui. <br><br>  Portanto, o link do usu√°rio deve ser sem dono. <br><br>  Altere a declara√ß√£o do usu√°rio em CarrierSubscription: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> user: <span class="hljs-type"><span class="hljs-type">User</span></span></code> </pre><br>  Agora, o usu√°rio n√£o √© propriet√°rio, o que quebra o ciclo dos links e permite liberar todos os objetos. <br><br><img src="https://habrastorage.org/webt/en/vx/cu/envxcuihbevfcfqv1cyg-kc3lo4.png"><br><br><h2>  Loop de links em fechamentos </h2><br>  Os ciclos de link para objetos ocorrem quando os objetos t√™m propriedades que se referem um ao outro.  Como objetos, os fechamentos s√£o um tipo de refer√™ncia e podem levar a loops de refer√™ncia.  Os fechamentos capturam objetos que eles usam. <br><br>  Por exemplo, se voc√™ atribuir um fechamento a uma propriedade de uma classe, e esse fechamento usar propriedades da mesma classe, obteremos um loop de links.  Em outras palavras, o objeto mant√©m um link para o fechamento atrav√©s da propriedade  O fechamento cont√©m uma refer√™ncia ao objeto atrav√©s do valor capturado de si mesmo. <br><br><img src="https://habrastorage.org/webt/z-/lh/ow/z-lhowlkfyvy4ycusafxhygjisw.png"><br><br>  Adicione este c√≥digo ao CarrierSubscription imediatamente ap√≥s a propriedade do usu√°rio: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completePhoneNumber: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.countryCode + <span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.number }</code> </pre><br>  Esse fechamento calcula e retorna o n√∫mero de telefone completo.  A propriedade √© declarada <b>pregui√ßosa</b> , ser√° atribu√≠da no primeiro uso. <br><br>  Isso √© necess√°rio porque ele usa self.countryCode e self.number, que n√£o estar√£o dispon√≠veis at√© que o c√≥digo do inicializador seja executado. <br><br>  Adicione runScenario () ao final: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(subscription.completePhoneNumber())</code> </pre> <br>  A chamada completePhoneNumber () executar√° o fechamento. <br><br>  Inicie o aplicativo e voc√™ ver√° que o usu√°rio e o iPhone foram liberados, mas CarrierSubscription n√£o √©, devido a um ciclo de fortes v√≠nculos entre o objeto e o fechamento. <br><br><img src="https://habrastorage.org/webt/7t/rb/ax/7trbaxtrrhtadtm29-dvqwehzo4.png"><br><br><h2>  Listas de captura </h2><br>  O Swift fornece uma maneira simples e elegante de quebrar o ciclo de v√≠nculos fortes nos fechamentos.  Voc√™ declara uma lista de captura na qual define o relacionamento entre o fechamento e os objetos que ele captura. <br><br>  Para demonstrar a lista de captura, considere o seguinte c√≥digo: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> someClosure = { [x] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"\(x), \(y)"</span></span>) } x = <span class="hljs-number"><span class="hljs-number">6</span></span> y = <span class="hljs-number"><span class="hljs-number">6</span></span> someClosure() <span class="hljs-comment"><span class="hljs-comment">// Prints 5, 6 print("\(x), \(y)") // Prints 6, 6</span></span></code> </pre> <br>  x est√° na lista de captura de fechamento, portanto, o valor de x √© copiado para a defini√ß√£o de fechamento.  √â capturado pelo valor. <br><br>  y n√£o est√° na lista de capturas, √© capturado por refer√™ncia.  Isso significa que o valor de y ser√° o que era no momento em que o circuito foi chamado. <br><br>  As listas de bloqueio ajudam a identificar intera√ß√µes fracas ou n√£o propriet√°rias com rela√ß√£o aos objetos capturados dentro do loop.  No nosso caso, a escolha apropriada n√£o √© possu√≠da, pois um fechamento n√£o pode existir se a inst√¢ncia CarrierSubscription for liberada. <br><br><h2>  Aproveite-se </h2><br>  Substitua a defini√ß√£o completePhoneNumber por CarrierSubscription :: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> completePhoneNumber: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.countryCode + <span class="hljs-string"><span class="hljs-string">" "</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.number }</code> </pre> <br>  N√≥s adicionamos <b>[self sem dono]</b> √† lista de captura de fechamento.  Isso significa que nos capturamos como um elo <b>sem dono em</b> vez de forte. <br><br>  Inicie o aplicativo e voc√™ ver√° que o CarrierSubscription foi lan√ßado. <br><br>  De fato, a sintaxe acima √© uma forma abreviada de uma mais longa e mais completa, na qual uma nova vari√°vel aparece: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> closure = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> newID = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-comment"><span class="hljs-comment">// Use unowned newID here... }</span></span></code> </pre> <br>  Aqui newID √© uma c√≥pia sem dono do eu.  Al√©m do fechamento, o eu permanece em si.  Na forma abreviada dada anteriormente, <b>criamos uma nova vari√°vel auto</b> que obscurece o eu existente dentro do fechamento. <br><br><h2>  Use Unowned cuidadosamente </h2><br>  No seu c√≥digo, o relacionamento entre self e completePhoneNumber √© designado como n√£o propriet√°rio. <br><br>  Se voc√™ tiver certeza de que o objeto usado no fechamento n√£o ser√° liberado, poder√° usar o n√£o propriet√°rio.  Se ele faz, voc√™ est√° com problemas! <br><br>  Adicione este c√≥digo no final do MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WWDCGreeting</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> who: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(who: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.who = who } <span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \(self.who)."</span></span> } }</code> </pre><br>  Agora, aqui est√° o fim do runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mermaid = <span class="hljs-type"><span class="hljs-type">WWDCGreeting</span></span>(who: <span class="hljs-string"><span class="hljs-string">"caffeinated mermaid"</span></span>) greetingMaker = mermaid.greetingMaker } <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(greetingMaker()) <span class="hljs-comment"><span class="hljs-comment">// !</span></span></code> </pre> <br>  Inicie o aplicativo e voc√™ ver√° uma falha e algo assim no console: <br><br>  O usu√°rio John foi inicializado <br>  O telefone iPhone XS foi inicializado <br>  CarrierSubscription TelBel √© inicializado <br>  0032 31415926 <br>  Erro fatal: tentativa de ler uma refer√™ncia sem dono, mas o objeto 0x600000f0de30 j√° foi desalocado2019-02-24 12: 29: 40.744248-0600 Ciclos [33489: 5926466] Erro fatal: tentativa de ler uma refer√™ncia sem dono, mas o objeto 0x600000f0de30 j√° foi desalocado <br><br>  Uma exce√ß√£o ocorreu porque o fechamento aguarda a exist√™ncia de si mesmo, mas foi liberado assim que a sereia saiu do escopo no final do bloco do. <br><br>  Este exemplo pode parecer sugado de um dedo, mas essas coisas acontecem.  Por exemplo, quando usamos fechamentos para iniciar algo muito mais tarde, digamos, ap√≥s o t√©rmino da chamada ass√≠ncrona na rede. <br><br><h2>  Desarmar a armadilha </h2><br>  Substitua greetingMaker na classe WWDCGreeting por esta: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \(self?.who)."</span></span> }</code> </pre> <br>  Fizemos duas coisas: primeiro, substitu√≠mos os n√£o propriet√°rios pelos fracos.  Em segundo lugar, como o eu se tornou fraco, acessamos a propriedade who atrav√©s do eu?  Ignore o aviso do Xcode, iremos corrigi-lo em breve. <br><br>  O aplicativo n√£o trava mais, mas se voc√™ execut√°-lo, obtemos um resultado engra√ßado: "Ol√°, nada". <br><br>  Talvez o resultado seja bastante aceit√°vel, mas geralmente precisamos fazer algo se o objeto foi liberado.  Isso pode ser feito usando a declara√ß√£o de guarda. <br><br>  Substitua o texto do fechamento por este: <br><br><pre> <code class="swift hljs"><span class="hljs-built_in"><span class="hljs-built_in">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> greetingMaker: () -&gt; <span class="hljs-type"><span class="hljs-type">String</span></span> = { [<span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"No greeting available."</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Hello \(self.who)."</span></span> }</code> </pre><br>  A declara√ß√£o de guarda designa o eu retirado do eu fraco.  Se self for nulo, o fechamento retornar√° "Nenhuma sauda√ß√£o dispon√≠vel".  Caso contr√°rio, o eu se torna uma refer√™ncia forte, de modo que o objeto √© garantido at√© o final do fechamento. <br><br><h2>  Procurando loops de link no Xcode 10 </h2><br>  Agora que voc√™ entende como o ARC funciona, o que s√£o loops de link e como quebr√°-los, √© hora de ver um exemplo de aplicativo real. <br><br>  Abra o projeto Starter localizado na pasta Contatos. <br><br>  Inicie o aplicativo. <br><br><img src="https://habrastorage.org/webt/a8/ce/l1/a8cel1rgbdkm_fel_d880f2swf4.png"><br><br>  Este √© o gerenciador de contatos mais simples.  Tente clicar em um contato, adicione alguns novos. <br><br>  Atribui√ß√£o de arquivo: <br><br>  ContactsTableViewController: mostra todos os contatos. <br>  DetailViewController: mostra as informa√ß√µes detalhadas do contato selecionado. <br>  NewContactViewController: permite adicionar um novo contato. <br>  ContactTableViewCell: c√©lula da tabela mostrando detalhes do contato. <br>  Contato: modelo de contato. <br>  N√∫mero: modelo de n√∫mero de telefone. <br><br>  No entanto, com este projeto, tudo est√° ruim: h√° um ciclo de links.  No in√≠cio, os usu√°rios n√£o perceber√£o problemas devido ao pequeno tamanho da mem√≥ria que vazou, pelo mesmo motivo que √© dif√≠cil encontrar o vazamento. <br><br>  Felizmente, o Xcode 10 possui ferramentas integradas para encontrar o menor vazamento de mem√≥ria. <br><br>  Inicie o aplicativo novamente.  Exclua 3-4 contatos usando o furto √† esquerda e o bot√£o excluir.  Parece que eles desaparecem completamente, certo? <br><br><img src="https://habrastorage.org/webt/xu/d9/qf/xud9qf3rcyaf5ot_08l8vauizto.png"><br><br><h2>  Para onde flui? </h2><br>  Quando o aplicativo estiver em execu√ß√£o, clique no bot√£o Debug Memory Graph: <br><br><img src="https://habrastorage.org/webt/la/na/km/lanakmzc0d2ousrcf5jwkpu-ova.png"><br><br>  Observe os problemas de tempo de execu√ß√£o no navegador Debug.  Eles s√£o marcados com quadrados roxos com um ponto de exclama√ß√£o branco dentro: <br><br><img src="https://habrastorage.org/webt/uc/ko/vj/uckovjp_eqoplopih79xuz1jl7e.png"><br><br>  Selecione um dos objetos de contato problem√°ticos no navegador.  O ciclo √© claramente vis√≠vel: os objetos Contato e N√∫mero, referindo-se um ao outro, permanecem. <br><br><img src="https://habrastorage.org/webt/7f/wi/os/7fwios8n7zdk4ww7bj81p4kvgle.png"><br><br>  Parece que voc√™ deve procurar no c√≥digo.  Lembre-se de que um contato pode existir sem um n√∫mero, mas n√£o vice-versa. <br><br>  Como voc√™ resolveria esse loop?  Link de contato para n√∫mero ou de n√∫mero para contato?  fraco ou sem dono?  Tente voc√™ mesmo primeiro! <br><br><div class="spoiler">  <b class="spoiler_title">Se voc√™ precisasse de ajuda ...</b> <div class="spoiler_text">  Existem 2 solu√ß√µes poss√≠veis: fa√ßa um link de Contato para N√∫mero fraco ou de N√∫mero para Contato sem dono. <br><br>  A documenta√ß√£o da Apple recomenda que o objeto pai tenha uma forte refer√™ncia a "filho" - e n√£o vice-versa.  Isso significa que damos ao Contato uma forte refer√™ncia ao N√∫mero e N√∫mero - um link n√£o propriet√°rio para o Contato: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Number</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contact: <span class="hljs-type"><span class="hljs-type">Contact</span></span> <span class="hljs-comment"><span class="hljs-comment">// Other code... } class Contact { var number: Number? // Other code... }</span></span></code> </pre> <br></div></div><br><h2>  B√¥nus: loops com tipos de refer√™ncia e tipos de valor. </h2><br>  Swift tem tipos de refer√™ncia (classes e fechamentos) e tipos de valor (estruturas, enumera√ß√µes).  O tipo de valor √© copiado quando √© passado e os tipos de refer√™ncia compartilham o mesmo valor usando o link. <br><br>  Isso significa que, no caso de tipos de valor, n√£o pode haver ciclos.  Para que um loop ocorra, precisamos de pelo menos 2 tipos de refer√™ncia. <br><br>  Vamos voltar ao projeto Cycles e adicionar esse c√≥digo no final do MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Error var payload = 0 var next: Node? }</span></span></code> </pre><br>  N√£o vai funcionar!  Estrutura √© um tipo de valor e n√£o pode ter recurs√£o em uma inst√¢ncia de si mesma.  Caso contr√°rio, essa estrutura teria tamanho infinito. <br><br>  Mude a estrutura para uma classe. <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Node</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> payload = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> next: <span class="hljs-type"><span class="hljs-type">Node?</span></span> }</code> </pre> <br>  A refer√™ncia a si mesma √© bastante aceit√°vel para classes (tipo de refer√™ncia), portanto, o compilador n√£o tem problemas. <br><br>  Agora adicione isso no final do MainViewController.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Person</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends: [<span class="hljs-type"><span class="hljs-type">Person</span></span>] = [] <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(name: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name = name <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"New person instance: \(name)"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">deinit</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Person instance \(name) is being deallocated"</span></span>) } }</code> </pre> <br>  E isso √© no final do runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ernie = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Ernie"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bert = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Bert"</span></span>) ernie.friends.append(bert) <span class="hljs-comment"><span class="hljs-comment">// Not deallocated bert.friends.append(ernie) // Not deallocated }</span></span></code> </pre><br>  Inicie o aplicativo.  Observe: nem ernie nem bert s√£o liberados. <br><br><h2>  Link e significado </h2><br>  Este √© um exemplo de uma combina√ß√£o de um tipo de refer√™ncia e um tipo de valor que levou a um loop de links. <br><br>  ernie e bert permanecem in√©ditos, mantendo-se nas matrizes de seus amigos, embora as matrizes sejam tipos de valor. <br><br>  Tente fazer com que os amigos arquivem como sem dono, e o Xcode mostrar√° um erro: sem dono se aplica apenas a classes. <br><br>  Para corrigir esse loop, precisamos criar um objeto wrapper e us√°-lo para adicionar inst√¢ncias ao array. <br><br>  Adicione a seguinte defini√ß√£o antes da classe Person: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unowned</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnyObject</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unowned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> value: <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span> (<span class="hljs-number"><span class="hljs-number">_</span></span> value: <span class="hljs-type"><span class="hljs-type">T</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value = value } }</code> </pre><br>  Altere a defini√ß√£o de amigos na classe Person: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> friends: [<span class="hljs-type"><span class="hljs-type">Unowned</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Person</span></span>&gt;] = []</code> </pre> <br>  Por fim, substitua o conte√∫do do bloco do em runScenario (): <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ernie = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Ernie"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bert = <span class="hljs-type"><span class="hljs-type">Person</span></span>(name: <span class="hljs-string"><span class="hljs-string">"Bert"</span></span>) ernie.friends.append(<span class="hljs-type"><span class="hljs-type">Unowned</span></span>(bert)) bert.friends.append(<span class="hljs-type"><span class="hljs-type">Unowned</span></span>(ernie)) }</code> </pre> <br>  Inicie o aplicativo, agora ernie e bert foram lan√ßados corretamente! <br><br>  A matriz de amigos n√£o √© mais uma cole√ß√£o de objetos Pessoa.  Agora, essa √© uma <b>cole√ß√£o de objetos n√£o propriet√°rios</b> que servem como wrappers para inst√¢ncias de Person. <br><br>  Para obter objetos Person de Unowned, use a propriedade value: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> firstFriend = bert.friends.first?.value <span class="hljs-comment"><span class="hljs-comment">// get ernie</span></span></code> </pre> <br><h2>  Conclus√£o </h2><br>  Agora voc√™ tem um bom entendimento do gerenciamento de mem√≥ria no Swift e sabe como o ARC funciona.  Espero que a publica√ß√£o tenha sido √∫til para voc√™. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">Apple: contagem autom√°tica de refer√™ncia</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451130/">https://habr.com/ru/post/pt451130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451116/index.html">Como lutei com a transi√ß√£o de elemento compartilhado e escrevi minha primeira biblioteca de c√≥digo-fonte aberto</a></li>
<li><a href="../pt451118/index.html">O teste n√£o √© para iniciantes</a></li>
<li><a href="../pt451120/index.html">Sobre os desafios de transportar c√©lulas mortas para plataformas m√≥veis</a></li>
<li><a href="../pt451124/index.html">Desenvolvimento de prote√≠nas na nuvem usando Python e Transcriptic ou Como criar qualquer prote√≠na por US $ 360</a></li>
<li><a href="../pt451126/index.html">Caixa de ferramentas para pesquisadores - Edi√ß√£o um: Auto-organiza√ß√£o e visualiza√ß√£o de dados</a></li>
<li><a href="../pt451132/index.html">Contratos orientados ao consumidor ou automa√ß√£o de teste de controle de qualidade com base no Gitlab CI</a></li>
<li><a href="../pt451138/index.html">Symfony CLI - Nova ferramenta de desenvolvimento local</a></li>
<li><a href="../pt451140/index.html">Quanto custa criar uma solu√ß√£o de IoT?</a></li>
<li><a href="../pt451144/index.html">Antiguidades: T√©cnica em publicidade na TV</a></li>
<li><a href="../pt451146/index.html">Acelerando a cria√ß√£o de aplicativos da web com o webpack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>