<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😠 👨‍👨‍👧‍👦 💃🏼 流分析：SAS ESP快速入门 👧🏾 📉 📺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在数据流上使用分析算法现在是构建分析系统领域中最紧迫的任务之一。 例如，许多高精度的预测模型都是基于工厂传感器的读数而开发的，它们可以防止严重的工业事故，但是为此，它们必须在终端设备（“边缘设备”）上执行，这些传感器会实时获取读数。 调用SAS事件流处理产品来解决此问题并将分析转移到“在线”。 在本...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>流分析：SAS ESP快速入门</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sas/blog/429176/"> 在数据流上使用分析算法现在是构建分析系统领域中最紧迫的任务之一。 例如，许多高精度的预测模型都是基于工厂传感器的读数而开发的，它们可以防止严重的工业事故，但是为此，它们必须在终端设备（“边缘设备”）上执行，这些传感器会实时获取读数。 调用SAS事件流处理产品来解决此问题并将分析转移到“在线”。 在本出版物中，我想通过一个应用问题的例子（摄像机图像的分析）来分享其配置的经验。 <br><br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png"><br><a name="habracut"></a><br><h3> 技术领域 </h3><br>  SAS已经存在于SAS产品线中多年，并且正在开发自己的流处理解决方案SAS事件流处理（以下称为ESP）。 开发人员的主要任务是获得高性能，比市场上现有的解决方案高几个数量级。 为此，在ESP的开发过程中，他们完全放弃了中间计算和索引在磁盘上的存储。 所有流转换都在RAM中执行，并且保留特定于事件的重新计数。 <br><br><img src="https://habrastorage.org/webt/_f/ry/6r/_fry6rq07g-c2mwytu_n0thqpp0.png"><br>  <i>使用SAS ESP中的内存。</i>  <i>RAM中的事件存储库存储中间结果，并且由于其他索引而在并行访问内部或外部进程时不会阻塞事件存储库。</i> <br><br> 该引擎可以处理大量数据流-每秒处理几百万个事件。 同时，在保持低延迟的同时，他很快在在线营销和打击银行欺诈的解决方案中占据了一席之地。 在那里，它是客户操作的智能过滤器，可以立即检测到帐户上的非标准活动，从而将欺诈性操作与数据流隔离开。 <br><br> 但这仍然是ESP的次要功能。 该引擎被设计为一种在数据流上连续使用分析模型（SAS，C，Python等）的机制。 <br><br><img src="https://habrastorage.org/webt/2m/qg/st/2mqgstvtjf69ku-dd-9elmuooii.png"><br>  <i>流事件处理的原理。</i> <br><br> 举一个说明性的例子，在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SAS Viya商务早餐</a>论坛上，我们SAS决定建立一个演示台，以图像分析为基础。 这就是我们进行设置的过程以及在过程中遇到的问题。 <br><br><h3> 流视频分析 </h3><br> 我们可以使用由SAS Viya平台上深入分析部门的同事构建的分析模型。 其本质是，在接收到汽车内部驾驶员的输入图像后，一种算法（在这种情况下为经过训练的卷积神经网络）根据以下类别对驾驶员的行为进行分类：“正常驾驶”，“与乘客交谈分散注意力”，“交谈”手机”，“写短信”等。 <br><img src="https://habrastorage.org/webt/q3/v9/2k/q3v92kdx036qyngrxp-ndx7w7km.png" align="left">  <i>该模型的一个示例：根据图像中用手机敲打手的部分，将输入图像分类为“写SMS”。</i> <br><br> 出现了一个问题，即如何实时运行该算法以便能够对不需要的行为做出响应。 根据方案，来自联机模式下的摄像机的图像已经以文件的形式落入磁盘上的网络目录。 <br><br> 剩下的一切就是：连接到数据，将图像转换为所需的格式，应用模型，并且很可能属于一类行为，在在线仪表板上显示实时警报。 事实证明，所有这些都可以在SAS ESP GUI中进行配置，而无需一行程序代码（！）。 <br><br><h3>  SAS事件流处理 </h3><br><img src="https://habrastorage.org/webt/t4/3w/ca/t43wcat2jtk84v43qaztpzw6yfg.png" width="300" align="left">  <i>SAS ESP Studio图形界面中的危害检测项目。</i> <br clear="left"> 在ESP图形编辑器中，我们添加了以下数据流转换： <br><br><ol><li>作为输入，我们有两个类型为source的节点：model_source和input_image。 在model_source中，我们发布分类模型。 为此，请配置文件连接器，该文件连接器从包含三个参数的文本文件中读取命令：操作名称，模型格式的类型以及二进制文件的物理路径。  ESP落后于每个数据源的静态和流式传输能力，因此，我们可以随时发布新命令以将模型下载到该节点，这在工业操作中很方便-我们无需停止项目来更新算法的版本。 <br><br><img src="https://habrastorage.org/webt/hk/lj/ys/hkljystucnei9_ctlsegjhp9o5o.png"><br>  <i>设置发布到model_source的命令</i> <br><br> 输入模型文件的内容： <br><br> <code>I,N,1,action,load <br> I,N,2,type,astore <br> I,N,3,reference,/opt/sas/demo/image_processing/d.astore</code> </li> <li> 第二个来源input_image是来自相机的图片。 要发布数据，我们使用标准适配器-一种程序，该程序从ESP中的源发布数据。 在这种情况下，我们使用了文件适配器，但是您也可以直接连接到相机，例如，通过解决方案随附的UVC适配器。 <br><br><img src="https://habrastorage.org/webt/ay/ql/hp/ayqlhpbfglnxdttpuv1ckoqdo9k.png"><br>  <i>为普通类型的摄像机配置UVC连接器。</i> </li><li> 图像的格式可能不同于训练模型的格式，这可能会影响分类的质量。 因此，在input_image之后，我们立即添加resize_image节点并在其设置中指定所需的格式。 在这种情况下，请压缩为100/100像素的正方形。 <br><br><img src="https://habrastorage.org/webt/jl/bp/th/jlbpthn46z31lehm1ulcb5oe6fy.png" align="left" width="250">  <i>图像处理设置</i> <br clear="left"></li><li> 模型执行在CNN_score_code中配置。 该界面将自动从模型的元描述中提取输出属性-P__label_c0，P__label_c1，P__label_c2和P__label_c9-每个行为类别的概率。 接下来，在max_class节点中，我们将定义一个新的计算字段，该字段将以最大概率选择类别。 </li><li> 现在，通过启动该项目，我们将能够对每个输入图像进行实时分类。 在我们的历史上，不道德的驾驶员会定期从道路上分散注意力。 但重要的是，要把那些他分散注意力的情况与长时间危险驾驶的情况分开。 为此，我们添加了3个节点：存储最后一分钟的事件（copy_1_min），按行为类进行汇总（aggr_for_alert）和“危险驾驶”事实过滤器（filter_alert）。 <br><br><img src="https://habrastorage.org/webt/zi/kk/tn/zikktnzlze0q_w1zvir7awy5gum.png" width="300" align="left">  <i>配置事件存储设置-最后一分钟。</i> <br clear="left"><img src="https://habrastorage.org/webt/65/bx/n7/65bxn7cssoq6r2g8tmv20uu-wbs.png" width="300" align="left"><br>  <i>为每个行为类设置事件计数。</i> <br clear="left"><img src="https://habrastorage.org/webt/8t/bt/sc/8tbtscxuouv-v3ab5xpykssttvk.png"><br>  <i>设置过滤规则。</i> <br></li></ol><br><h3> 指标 </h3><br> 重要的是要注意，ESP中的每个转换都有一个设置-“状态”。 它表征了数据转换是否正在流式传输，即 当处理输入事件时，结果将立即沿图进一步传输，并从该节点的内存中删除。 或者，我们可以存储处理每个事件的结果并在其上建立索引以允许随时访问它。 例如，聚合窗口始终存储状态，并根据输入流连续进行事件重新计算。 <br><br><h3> 发射 </h3><br> 回到项目。 我们只需要运行它 <img src="https://habrastorage.org/webt/uv/dy/le/uvdyleayvtubt4nmqhcd2jlcqjo.png" width="50">  。 <br> 为了便于查看数据流，ESP附带了一个在线报表设计器SAS ESP Stream Viewer。 在设置模式下，我们看到服务器上所有正在运行的项目，我们可以连接到它们并选择方便的可视化效果。 <br><br><img src="https://habrastorage.org/webt/hc/jm/7f/hcjm7fhuisbkt_unw2m3poekrhc.gif"><br>  <i>SAS ESP Stream Viewer中的在线仪表板</i> <br><br> 仅此而已。 我们有机会实时自动响应视频信号。 在这种情况下，我们设置了在线监视，但是使用相同的适配器/连接器，我们可以针对每种检测到的违规情况发送消息，或者对外部系统形成控制措施。 <br><br><h3> 还是Python？ </h3><br> 从技术上讲，此案已经完成，但出于在论坛上进行演示的目的，它似乎不够互动。 由于不方便，而且非常不安全（！），无法实时显示，因此照片是事先拍摄的，汽车在停车场。 <br><br>  SAS ESP支持以Python制作的模型的流执行。 为了进行确认，我们使用OpenCV库设置了图像分析，即在图像中搜索对象。 <br><br><img src="https://habrastorage.org/webt/62/nr/gh/62nrghkxa8unlmf2m3fjy82knz0.png" width="300" align="left">  <i>ESP模型，用于在图像输入流上查找安全帽</i> <br clear="left"> 在ESP图表中，我们有2个数据源：笔记本电脑的在线相机的帧和我们要寻找的物体的照片。 在这种情况下，我们将确定施工现场的潜在工人是否已经忘记了安全规则：上面是否戴着头盔。 在proc_detection节点中，我们执行以下Python代码： <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compute_total</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Image,image_template)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"Output: score_point"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> imageio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> imread MIN_MATCH_COUNT = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">#       DIST_COEFF = 0.55 img_big = imread(io.BytesIO(base64.b64decode(image_template))) sift = cv2.xfeatures2d.SIFT_create() # Initiate SIFT detector matcher = cv2.BFMatcher() # BFMatcher with default params kp_big, des_big = sift.detectAndCompute(img_big,None) img_tpl = imread(io.BytesIO(base64.b64decode(Image))) kp_tpl, des_tpl = sift.detectAndCompute(img_tpl,None) matches = matcher.knnMatch(des_tpl,des_big,k=2) good = [] for m,n in matches: if m.distance &lt; n.distance * DIST_COEFF: good.append(m) score_point = len(good) return score_point</span></span></code> </pre><br><img src="https://habrastorage.org/webt/xb/ql/56/xbql56g_rpt7jzmxp6bdzjwab-a.gif" width="500"><br>  <i>从<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SAS Viya商务早餐</a>论坛的摄像头中识别出头盔中存在头盔（同事， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">maxxts正在</a>测试展台）</i> <br><br><h3> 机器学习 </h3><br> 如果我们谈论流处理的进一步发展，那么重点可能会转向流分析模型的训练。 即 与前面的示例不同，模型不仅可以执行，而且可以在SAS ESP中训练。 这将需要一个额外的数据流，通过该数据流可以根据事件在该算法上执行所选算法的训练操作（例如，对于初学者而言，简单的k均值聚类）。 然后，装有ESP的汽车将有机会使用刚刚连接的新传感器来分析情况。 按照工业4.0的概念，这将使快速开启和自动化新设备成为可能。 <br><br> 请在评论中写下流分析面临的任务，当然，我很乐意回答有关<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SAS事件流处理的问题</a> 。 <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN429176/">https://habr.com/ru/post/zh-CN429176/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN429162/index.html">“做出改变，理解人们为何抗拒”：吉姆·霍姆斯（Jim Holmes）在测试文化</a></li>
<li><a href="../zh-CN429166/index.html">多晶：从历史到对未来的猜测</a></li>
<li><a href="../zh-CN429168/index.html">穿越火与水：俄罗斯科普文学史</a></li>
<li><a href="../zh-CN429172/index.html">Proxmox上为1C。 一般注意事项</a></li>
<li><a href="../zh-CN429174/index.html">BlueStacks 4：在较弱的硬件上进行测试+开发人员评论</a></li>
<li><a href="../zh-CN429178/index.html">微软订购了Minecraft的新校园模型</a></li>
<li><a href="../zh-CN429180/index.html">转到</a></li>
<li><a href="../zh-CN429182/index.html">人工智能遇到了理解障碍</a></li>
<li><a href="../zh-CN429184/index.html">在线媒体有望打破Oumuamua和哈佛学者之间的链条</a></li>
<li><a href="../zh-CN429186/index.html">@Pythonetc 2018年10月</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>