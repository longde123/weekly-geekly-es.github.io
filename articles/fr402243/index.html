<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî¥ üéÜ üèµÔ∏è Ionistors Micro-UPS ‚ö°Ô∏è üö∑ üç•</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† toute la communaut√© respect√©e. J'ai l'honneur d'offrir aux Hubrovites int√©ress√©s par l'√©lectronique radio quelques consid√©rations et une imp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ionistors Micro-UPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402243/">  Bonjour √† toute la communaut√© respect√©e.  J'ai l'honneur d'offrir aux Hubrovites int√©ress√©s par l'√©lectronique radio quelques consid√©rations et une impl√©mentation sp√©cifique de l'alimentation de secours sur les ionistors (ce sont des supercondensateurs √† double couche √©lectrique), con√ßus pour assurer la bonne ex√©cution du module processeur sur un microcontr√¥leur ARM fonctionnant sous Linux Debian standard. <br><a name="habracut"></a><br>  Le probl√®me est survenu devant votre humble serviteur sous les formes suivantes: vous devez √©teindre correctement le syst√®me d'exploitation Linux (ex√©cut√© sur la solution int√©gr√©e) lorsque l'alimentation externe est coup√©e.  Cette alimentation a √©t√© fournie √† partir d'un port USB 2.0 standard vers un bo√Ætier-box pr√©c√©demment fabriqu√© via au moins un connecteur USB-B standard.  L'utilisateur inexp√©riment√© de cet appareil a pr√©f√©r√© retirer le c√¢ble USB ringard, en suivant le principe "UnPlug-NoPlay-NoProblem".  Il est clair qu'une solution embarqu√©e sans disques durs et avec une m√©moire virtuelle mise √† z√©ro lors de la configuration r√©siste √† de tels cas de force majeure, mais quelques milliers d'heures d'utilisation ont montr√© qu'elle ne fonctionne pas toujours ¬´sans probl√®me¬ª. <br><br>  J'ai d√ª plisser mon cerveau et entrer dans une transe cr√©ative.  En sortant de la transe, le premier moyen possible de r√©soudre le probl√®me s'est mat√©rialis√© - le psychologique, qui semblait au premier abord le plus attractif.  La ligne de pens√©e √©tait approximativement la suivante - pourquoi l'utilisateur ordinaire secoue-t-il un b√¢ton coll√© dans le port USB avec une main in√©branlable?  Probablement parce que ni lui-m√™me ni ses connaissances les plus proches n'ont ainsi perdu leur th√®se, leur m√©moire ou leur rapport annuel.  Pourquoi le m√™me utilisateur n'a pas tir√© un c√¢ble d'imprimante d'une imprimante qui fonctionnait √† l'√©poque d'Ona?  Probablement parce qu'il a vu ou entendu des l√®vres de quelqu'un comment il a d√ª acheter un nouveau MB ou Centronics sur ISA (PCI).  Je ne veux pas (du mot en g√©n√©ral) que ma bo√Æte ait √©t√© retir√©e sans m√©nagement.  Que faut-il faire pour cela?  Correct, d√©finissez le comportement utilisateur requis. <br><br>  J'ai d√ª secouer les comp√©tences des circuits et du tra√ßage, et la prochaine version de la bo√Æte a obtenu une LED RGB et un bouton sur le panneau avant, ainsi qu'un signal pi√©zo-√©lectrique avec un timbre m√©chant √† l'int√©rieur.  Un programme simple a d√©termin√© si l'arr√™t extr√™me s'est d√©roul√© correctement.  Si elle √©tait incorrecte et que l'inconduite de l'utilisateur √©tait la premi√®re sur sa m√©moire flash, l'action de contr√¥le a suivi: au lieu que l'indicateur plaise en jaune et vert, la bo√Æte a clignot√© avec un ≈ìil coupant rouge et a cruellement cri√© quelques minutes avant de se calmer et de commencer √† charger.  La rechute √©tait punissable de cinq minutes, une bruy√®re encore plus vile et une ligne dans le manuel que la bo√Æte bloqu√©e en raison d'un arr√™t incorrect r√©p√©t√© est supprim√©e de la garantie, ici. <br><br>  Vous savez, la m√©thode s'est av√©r√©e √©tonnamment efficace.  Mais ici, le cher client a exprim√© le souhait qu'avant de d√©connecter le bo√Ætier, il informe toujours le serveur qu'il prenait du temps sur les lieux.  Maintenant, certains, mais une source d'√©nergie √©tait n√©cessaire.  Le cerveau de la prochaine transe cr√©ative est revenu avec la pens√©e: une batterie au lithium-polym√®re est notre tout!  La pens√©e commune a ajout√© beaucoup de scepticisme √† cette pens√©e: je ne voulais pas vraiment charger la batterie chaque fois que je l'allumais, car le nombre de d√©charges de charge est une ressource consomm√©e, ainsi que le sujet de la tromperie cynique des fabricants de batteries de clients innocents.  Ne pas charger √† chaque fois que vous l'allumez, mais lorsqu'il se d√©charge?  Il est donc n√©cessaire de cl√¥turer tout le jardin, d'√©talonner la batterie, de mesurer la tension avec une bonne pr√©cision.  En g√©n√©ral, ceci et cela, puis le Samsung Galaxy est entr√© en sc√®ne avec ses batteries incendiaires.  Imaginant un incendie √† l'endroit o√π la bo√Æte devait se tenir, j'ai d√ª agiter volontairement un sabre et arr√™ter la douloureuse d√©lib√©ration de la deuxi√®me id√©e. <br><br>  Entrant en transe pour la troisi√®me fois, un g√©nie cr√©atif a mis au jour des ionistors.  Et quoi, √ßa ne semble pas mal.  La capacit√© est en farads, le nombre de cycles de charge-d√©charge n'est pas limit√©, pour ainsi dire, le volt n'est vraiment pas suffisant - 2,7 maximum par cellule, et ils ne sont pas tr√®s en cascade.  Il n'y avait d√©j√† rien √† m√©diter sur le manque d'options, et encore une fois, j'ai d√ª m'attaquer aux circuits avec la trace. <br><br>  La recherche dans les vastes √©tendues d'Internet a apport√© quelques prises et, pendant un moment de r√©flexion, il a √©t√© d√©cid√© de s'arr√™ter sur le microcircuit LTC3110 lin√©aire.  Pour l'avenir, je dirai que quelques autres options ont √©t√© test√©es, mais pas particuli√®rement avec succ√®s.  Si le lecteur est int√©ress√© par les d√©tails du choix - vous √™tes les bienvenus en PM.  Parmi les options disponibles, le LTC3110 contient presque tout ce dont vous avez besoin pour construire une source d'alimentation de secours sur les ionistors: <br>  - il dispose d'un convertisseur √©l√©vateur, ce qui rend le concepteur non particuli√®rement limit√© dans le choix de la tension d'alimentation; <br>  - ce convertisseur utilise une inductance pour le stockage d'√©nergie, ce qui augmente consid√©rablement le rendement et permet de donner quelques amp√®res √† la charge; <br>  - il est possible de limiter le courant consomm√© pendant la charge dans la plage de 125mA - 2A, ce qui est particuli√®rement important lorsqu'il est aliment√© par USB; <br>  - il y a un circuit int√©gr√© pour l'√©quilibrage individuel des ionistors connect√©s en s√©rie pour augmenter la puissance stock√©e et la fiabilit√©; <br>  - la puce est √©quip√©e de fils indiquant le degr√© de charge des ionistors; <br>  - et, pour le dessert, il existe un comparateur suppl√©mentaire dont les seuils sont fix√©s par l'utilisateur. <br><br>  Pour plus de d√©tails et des exemples d'applications, j'envoie le curieux Reader √† la fiche technique sur le microcircuit, le tout-puissant Google avec le sort "LTC3110 pdf" pour vous aider. <br><br>  En th√©orie, pour construire un micro-onduleur fonctionnel, le LTC3110 lui-m√™me doit ajouter un circuit qui alimente le bo√Ætier en mode normal, s'il y a une connexion √† une cl√© USB fonctionnelle.  L'IC ST1S10PHR a √©t√© choisi pour ce r√¥le honorable, dont la disposition sans pr√©tention et le prix bas sont connus et test√©s depuis longtemps.  J'ai √©galement d√ª ajouter une cl√© qui coupe le circuit d'alimentation des principaux consommateurs lors de la charge initiale des ionistors.  Cette cl√© vous permet de r√©soudre deux probl√®mes: d'une part, le temps de charge initial est r√©duit (puisque presque tout ce qui est consomm√© par USB va aux ionistors), et d'autre part, il √©limine la possibilit√© d√©sagr√©able de panne d'√©lectricit√© lorsque l'onduleur est tellement sous-charg√© que l'approvisionnement en √©nergie n'est pas encore suffisant pour le bon arr√™t.  De plus, le ¬´d√©marrage √©lev√©¬ª des ionistors compl√®tement charg√©s permet au circuit de consommer parfois (mais pas tr√®s souvent) plus de courant que ce que le port USB peut donner - le d√©ficit sera reconstitu√© par les ionistors.  Une telle situation peut survenir, par exemple, lors de l'enregistrement d'un grand bloc d'informations sur un lecteur flash USB volumineux aliment√© avec la bo√Æte. <br><br>  Je pense que la partie introductive peut √™tre compl√©t√©e √† ce sujet et passer √† un programme de travail sp√©cifique. <br><br><img src="https://habrastorage.org/files/249/ae5/0b7/249ae50b7dff4c188249bbb255dc9b05.GIF" alt="image"><br><br>  Voici √† quoi ressemble le circuit micro-UPS des ionistors. <br><br>  L'alimentation est fournie par le port USB 2.0 (coin sup√©rieur gauche du circuit).  Sur DA1, selon le sch√©ma recommand√©, un convertisseur abaisseur 5V -&gt; 3,3V est assembl√© √† partir d'une fiche technique.  Sa seule caract√©ristique est un filtre suppl√©mentaire de sonnerie haute fr√©quence sur L2 et C7.  Si vous le souhaitez, ces √©l√©ments peuvent √™tre exclus.  Les r√©sistances R3 ... R5 sont utilis√©es pour la d√©charge d'urgence des ionistors avant le transport, par exemple, ou avant d'installer l'ensemble de la carte dans son ensemble, sinon la source d'alimentation reste dessus et suffisamment puissante pour br√ªler quoi que ce soit.  Les r√©sistances de d√©charge sont connect√©es ou d√©connect√©es par le cavalier SA1.  VT1, C16, R17 et R18 - la cl√© pour alimenter les principaux consommateurs, elle a d√©j√† √©t√© mentionn√©e ci-dessus et devra ajouter quelques mots ci-dessous.  Tout le reste est le harnais LTC3110 standard de la fiche technique. <br><br>  3V3SBY est la puissance de veille du circuit de commande, dans la bo√Æte il est impl√©ment√© sur le CPLD EPM240T100 d'Altera, mais rien ne l'emp√™che d'√™tre ex√©cut√© sur un microcontr√¥leur ou une logique discr√®te.  Le 3V3 est l'alimentation principale du coffret r√©serv√© par UPS.  Les informations sur l'√©tat des micro-onduleurs sont affich√©es sur PWRFAIL, BATFULL et BATLOW avec des noms explicites.  PWRFAIL est activ√© en cas de perte d'alimentation USB, BATFULL indique que la charge atteint le niveau de 95% (5,2 V), BATLOW affiche une diminution du niveau de charge √† 40% (2,1 V).  Si vous le souhaitez, ce niveau peut √™tre ajust√© en s√©lectionnant R6 et R7, guid√© par la fiche technique.  Malheureusement, une telle astuce ne fonctionne pas avec le niveau BATFULL - elle est martel√©e dans le circuit int√©gr√© avec des clous. <br><br>  Le micro-onduleur contr√¥le deux signaux: PWRON et BATOFF.  PWRON met sous tension, BATOFF √©teint l'onduleur dans son ensemble. <br><br>  La logique g√©n√©rale du fonctionnement du micro-onduleur est la suivante: <br><br><ol><li>  dans l'√©tat initial, C8 et C9 sont compl√®tement d√©charg√©s, le cavalier SA1 en position gauche, l'alimentation USB 5V n'est pas fournie; </li><li>  l'appareil est branch√© sur un port USB-B 2.0; </li><li>  le convertisseur sur DA1 commence √† fournir du courant √† la ligne 3V3SBY, alimentant le circuit de commande sur CPLD, qui, √† son tour, ouvre la cl√© VT1, supprimant le signal PWRON;  en outre, le circuit de commande supprime le signal BATOFF, y compris DA2; </li><li>  DA2 commence √† charger les ionistors;  lors de la charge, le signal BATLOW est d√©sactiv√© (√† 2,1 V), puis BATFULL est activ√© (√† 5,2 V sur les ionistors); </li><li>  l'apparition du signal BATFULL, le circuit de contr√¥le consid√®re que le micro-onduleur est pr√™t √† fonctionner et allume VT1, alimentant le circuit principal;  Dans le m√™me temps, DA2 continue de surveiller les ionistors, et lorsque la charge tombe en dessous de 95%, il commence √† se charger;  la connexion de VT1 √† la broche RSENS DA2 garantit qu'un tel courant est pris pour recharger qu'il ne d√©passe pas la limite USB, en tenant compte du circuit principal consomm√©;  si la consommation du circuit principal d√©passe cette limite, la d√©charge des ionistors commencera √† compenser les d√©penses inutiles; </li><li>  lors de la d√©connexion de l'USB 5V, la ligne PWRFAIL est activ√©e, permettant au dispositif de contr√¥le de savoir que la source externe a disparu;  le circuit de commande g√©n√®re une demande d'interruption du processeur ARM pour ex√©cuter le script d'arr√™t correct;  pendant tout ce temps, l'alimentation est fournie par DA2; </li><li>  √† la fin de la proc√©dure d'arr√™t, ARM √©met un signal que tout est pr√™t pour l'extinction, et le circuit de commande d√©finit BATOFF, d√©sactivant DA2;  dans cet √©tat, le bo√Ætier est situ√© avant que le 5V USB soit aliment√© (voir point 1 √† l'exception de la charge r√©siduelle sur C8 et C9); </li><li>  si ARM a beaucoup h√©sit√© et n'a pas pu tout fermer jusqu'au signal BATLOW, le circuit devra √™tre mis hors tension par la force. </li></ol><br>  Si vous le souhaitez, il est facile d'organiser toute autre logique de contr√¥le de micro-onduleur, par exemple, en augmentant le niveau d'allumage BATLOW pour cent √† 60% (en s√©lectionnant R6 et R7), utilisez-le comme signal d'arr√™t, en vous d√©connectant de force de la d√©charge compl√®te C8 et C9. <br><br>  Au final, passez rapidement en revue les param√®tres configurables du circuit.  R1 et R2 d√©terminent la tension de sortie de DA1, une autre tension peut n√©cessiter le remplacement de C1, C2, C4-C6 et L1.  Les cotes de C8 et C9 d√©terminent uniquement les temps de charge et de d√©charge de l'onduleur, j'ai personnellement essay√© de 4,7 √† 100 Farads, th√©oriquement il n'y a pas de restrictions.  R6 et R7 d√©terminent le niveau d'activation de BATLOW.  La tension de la charge maximale des ionistors d√©pend du rapport R8 / R9.  R11 d√©termine le courant consomm√© par 5V USB, √† la r√©sistance indiqu√©e, le circuit consomme 0,5A.  Le rapport R12 / R14 d√©finit un niveau de chute de 5V USB, qui sera d√©fini comme une panne de courant (PWRFAIL).  R15 / R16 d√©termine la tension de sortie de DA2 en mode d√©charge. <br><br>  Les signaux de sortie du LTC3110 sont r√©alis√©s selon le sch√©ma "drain ouvert" afin de ne pas √™tre li√©s √† une tension d'alimentation sp√©cifique.  Dans mon circuit, les r√©sistances de pull-up pour elles sont impliqu√©es dans CPLD, ce n'est pas un probl√®me de les utiliser dans n'importe quel microcontr√¥leur moderne.  Eh bien, si vous d√©cidez d'assembler un circuit de commande sur K155, vous devez vous occuper des r√©sistances vous-m√™me. <br><br>  Quelques mots sur le C16.  Acqu√©rir ces connaissances m'a pris le plus de temps sur la carte prototype UPS.  Apr√®s tout, quel est le probl√®me?  Dans la fiche technique, le noir en anglais indique que si vous voulez que la somme du courant consomm√© par le circuit principal et du courant de charge des ionistors ne d√©passe pas la limite fix√©e par R11, veuillez alimenter le circuit principal √† partir de la sortie RSENS.  OK, d'accord.  Et puis plus int√©ressant.  Puisque votre circuit peut avoir n'importe quoi, jusqu'√† un court-circuit (court-circuit, c'est un court-circuit, il est court-circuit√©), pr√©cise la fiche technique, le LTC3110 est √©quip√© d'un circuit de protection sp√©cial.  OK, tr√®s bien.  Et maintenant pour la partie amusante.  Nous lisons la fiche technique plus loin: et pour que le sch√©ma de protection ne se trompe pas, veuillez fournir la capacit√© totale de la ligne √©lectrique PAS PLUS, Karl, 10 microFarads.  Dingo ... Pour tout sur tout, et ne vous refusez rien.  En effet, toute charge sup√©rieure √† 10uF lors de la connexion des coins ... Ne vous y trompez pas, Basurman.  J'ai d√ª faire un l√©ger retard dans la tonalit√© sur VT1, ce qui donne du C16.  Je comprends que pendant un certain temps, VT1 ne sera pas dans le mode cl√©, mais entre le ciel et la terre (dans le sens, entre VCC et GND), ce qui n'est pas g√©nial du tout.  Mais au moins √ßa marche.  Tel est le ¬´nouveau hawa¬ª.  Pour les fanatiques de la puret√© des modes cl√©s, j'ajouterai que j'ai essay√© de ne pas mettre C16, mais une inductance de 1,5 ŒºH en s√©rie avec VT1 - tout fonctionne tr√®s bien. <br><br>  Ci-dessous est une image d'une carte de circuit imprim√© avec le circuit d√©crit, bien s√ªr, la num√©rotation des composants diff√®re de celle indiqu√©e sur le sch√©ma de circuit - elle est transversale pour la bo√Æte enti√®re. <br><br><img src="https://habrastorage.org/files/ca6/497/465/ca6497465973465483dabf323d12be70.jpg" alt="image"><br><br>  Si vous avez des questions - s'il vous pla√Æt. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr402243/">https://habr.com/ru/post/fr402243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr402233/index.html">Nous overclockons le routeur JTAG</a></li>
<li><a href="../fr402235/index.html">Des feuilles de route d√©taill√©es sont n√©cessaires pour les voitures intelligentes, pas pour les personnes</a></li>
<li><a href="../fr402237/index.html">Pourquoi Intel Mobileye?</a></li>
<li><a href="../fr402239/index.html">R√©seau religieux</a></li>
<li><a href="../fr402241/index.html">CONTROLLINO PLC compatible Arduino, partie 1</a></li>
<li><a href="../fr402245/index.html">Les pr√©paratifs pour le lancement du premier cargo chinois ont atteint la ligne d'arriv√©e</a></li>
<li><a href="../fr402247/index.html">Conseils d'impression Epson</a></li>
<li><a href="../fr402249/index.html">Astell & Kern AK70 - Pocket Media Harvester pour les m√©lomanes</a></li>
<li><a href="../fr402251/index.html">La premi√®re ville priv√©e de Russie. 3e partie</a></li>
<li><a href="../fr402253/index.html">La puissance des r√©seaux naturels est en exc√®s de boucles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>