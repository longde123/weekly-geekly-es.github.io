<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⌨️ 🔔 👩🏿‍🔧 备份文件和SQL数据库1C（在云中并加密） 👺 🍖 🌿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我想分享使用Effector Saver将文件和SQL 1C数据库备份到本地，网络和云存储（使用Google Drive示例）的经验。 

 该软件支付：2500卢布。 
 过渡到新版本（从3到4）的费用为：1250₽。 

 我为一位朋友写了说明，但我认为它将对您中的一个派上用场。 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>备份文件和SQL数据库1C（在云中并加密）</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474944/"> 在本文中，我想分享使用Effector Saver将文件和SQL 1C数据库备份到本地，网络和云存储（使用Google Drive示例）的经验。 <br><br> 该软件支付：2500卢布。 <br> 过渡到新版本（从3到4）的费用为：1250₽。 <br><br> 我为一位朋友写了说明，但我认为它将对您中的一个派上用场。 <br><br> 和往常一样，在评论中，您将教我一些新的知识=） <br><br> 指令的末尾是一个显示任务速度的日志示例。 <br><br>  <b>目的：</b> <br> 按计划自动创建加密备份，并向邮件发送错误报告。 <br><a name="habracut"></a><br>  <b>逻辑备份：</b> <br><br><ul><li> 每日最后30件（保质期1个月） </li><li> 每月第一天持续24个（保质期2年） </li><li> 每年2月1日，最后10件（保质期10年） </li><li> 备份从备份帐户下上传到备份存储（本地或网络） </li><li> 备份上传到Goole Drive云（可能使用其自己的OAuth ID客户端/机密） </li><li> 电子邮件错误报告 </li></ul><br>  <b>一点解释</b> <br><br><ul><li> 本手册作为现成的使用示例提供，可以并且应该适应您的需求。 </li><li> 任务可以同时运行，因为 支持并行任务，这大大减少了备份时间。 </li><li>根据任务执行额外的复制，即 复制已经创建的最后一个备份。 例如，如果要在10号执行附加复制，并且从10号开始对选定任务的备份以错误结束（并且我们没有干预），则该附加复制将为所选任务的上一次成功备份复制一个副本，在我们的示例中为9号。 </li><li> 在该程序中，您可以使用.dt文件形式的1C工具配置数据库的卸载，并自动锁定/解锁数据库并弹出用户。 在本手册中，此方法不被视为备份.dt格式的不可靠方法。 </li></ul><br>  <b>1.安装和设置</b> <br> 安装，运行。 <br>  -工具&gt;选项 <br><br><ul><li> 自动加载 <br>  <u>作为Windows服务运行（服务器）</u> <br> 备用用户，您的密码 <br><br><div class="spoiler">  <b class="spoiler_title">备份用户的说明，该用户使用单独的帐户</b> <div class="spoiler_text"><blockquote> 对于备份，我认为创建和使用单独的帐户（例如备份）很重要。 它可以是本地和域记帐。 <br> 应该将管理员访问备份存储的权限配置为读取，并且仅允许记帐备份写入。 这样可以保护您的备份免受许多危险（坏头，病毒）的伤害。 而且，如果您需要对备份存储进行任何更改，则始终可以给自己临时访问权限，或者代表备份帐户运行任何资源管理器（例如Total Commander）以获得对存储的完全访问权限。 </blockquote><br></div></div></li><li> 座席参数 <br>  <u>允许流任务同时工作</u> ：5 <br> 我们从服务器功率和通道速度（用于上传到云）中选择Internet <br>  <u>使用指定的临时文件目录</u> ： <br>  \\ NAS \备份\ Temp <br><br><div class="spoiler">  <b class="spoiler_title">网络路径说明</b> <div class="spoiler_text"><blockquote> 希望使用此程序将网络文件夹放在计算机上。 实际上，对我们来说，它将是一个本地文件夹（如果速度允许，则为任何其他网络路径）。 <br> 对Temp文件夹（临时文件目录）的访问应为： <br><br><ol><li> 用于备份写 </li><li> 从中运行MS SQL Server服务进行写入的记帐 </li><li> 管理员阅读 </li></ol><br> 不幸的是，该程序在设置SQL数据库备份时不会向用户报告其功能。 她认为SQL Server与她在同一台计算机上。 创建SQL数据库的备份后，临时文件夹的路径将从字面上传递到SQL Server，并且SQL Server将备份上传到其本地临时文件夹。 之后，他无法在其临时文件夹中找到备份，并抛出错误。 <br><br> 为了解决此限制，我们选择临时文件夹的网络路径。 然后，SQL Server将接收网络路径，并将在该地址卸载备份。 <br><br> 在未来的版本中，开发人员承诺考虑添加SQL备份任务的设置，在该设置中可以指定要卸载的网络路径，而不必将常规路径更改为临时文件夹。 </blockquote></div></div></li><li> 经理选项 <br> 如果不需要的用户可以访问该程序，请设置密码。 </li><li> 存档文件 <br>  <u>结束档案名称的选项</u> ：yyyy.mm.dd_hh.nn.ss <br> 对于没有空格的美学和名称（旧习惯） </li><li> 办公室 <br>  <u>云中的OAuth应用程序数据-更新ClientID / ClientSecret数据</u> <br><br><div class="spoiler">  <b class="spoiler_title">这里没有必要进行更改，但是与往常一样，有一个小的BUT</b> <div class="spoiler_text"><blockquote> 最近，由于超出OAuth限制，我在将备份上传到云时收到错误。 该错误只有一次，开发人员已解决此问题，但为什么要再次等待它。 我决定将我的OAuth放在Google云端硬盘上，然后再解决它。 <br> 有关如何获取您的客户ID和机密的图片的说明，请参见以下<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">网址</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//github.com/Cloudbox/Cloudbox/wiki/Google-Drive-API-Client-ID-and-Client-Secret</a> </blockquote></div></div></li></ul><br>  <b>2.准备</b> <br>  -工具&gt;存储管理&gt;创建 <br><ul><li>  <u>本地/网络文件夹</u> ： <br> 这里的一切都清楚了，按照我们的备份逻辑（在本文开头），为方便起见，我们创建了三个存储库 <br>  \\ NAS \备份\ Everyday <br>  \\ NAS \备份\ EveryMonth <br>  \\ NAS \备份\每年 <br></li><li>  <u>Google云端硬盘</u> ： <br> 创建与Google Cloud驱动器的连接。 <br> 让我们根据逻辑命名：Everyday <br> 单击<u>授权</u>按钮，输入用户名/密码，准备好。 <br><br><div class="spoiler">  <b class="spoiler_title">如果在服务器或另一台计算机上远程配置它</b> <div class="spoiler_text"><blockquote> 然后，您可以通过其他方式执行授权。 我们关闭登录和密码输入窗口-出现授权错误-单击“ <u>用户模式”</u>按钮，然后单击“ <u>获取确认码”</u>链接，授权链接将在浏览器中打开。 将链接复制到计算机，登录到计算机，确认访问权限，获取密钥，然后将其复制回<u>用户模式下</u>的“ <u>应用程序授权”</u>窗口<u>中</u>的字段，然后单击“确定”。 </blockquote></div></div><br> 同样，选择云中文件夹的路径： <br> 备份/每天 <br><br> 我们通过复制为创建每月和每年的副本提供额外的云存储（创建&gt;复制） <br> 结果，我们得到了3个云存储： <br> 每天（Google云端硬盘） <br> 每月（Google云端硬盘） <br> 每年（Google云端硬碟） <br> 这样就完成了<u>仓库管理</u>设置。 </li></ul><br>  <b>3.创建备份任务</b> <br><br>  <b>3.1。</b>  <b>任务&gt;添加任务&gt;备份文件和数据库（SQL）</b> <br><ul><li> 关键参数 <br>  <u>在存档中包含SQL数据库的备份</u> （例如，Microsoft SQL Server） <br></li><li>  Microsoft SQL基础 <br> 我们注册所有详细信息。 <br> 我们检查TCP 1433端口是否在MS SQL服务器上打开。 <br> 点击： <u>检查</u> <br></li><li> 档案储存 <br>  -添加存储<u>\\ NAS \备份\ Everyday</u> <br>  <u>自动删除过时的备份</u> ：30 <br>  - <u>每天</u>添加存储<u>（Google云端硬盘）</u> <br>  <u>自动删除过时的备份</u> ：30 <br></li><li> 存档文件 <br>  <u>存档文件</u>名：数据库名 <br>  <u>档案名称结尾</u> ：yyyy.mm.dd_hh.nn.ss <br> 存档 <br>  <u>格式</u> ：7z <br>  <u>压缩</u> ：无压缩 <br><br><div class="spoiler">  <b class="spoiler_title">为什么不压缩？</b> <div class="spoiler_text"><blockquote> 备份SQL数据库时，应考虑2个选项 <br><br>  1.使用SQL Server工具压缩数据库。  -快速，但压缩比7z差。 <br> 如果选择此选项，则需要： <br>  -选择：无压缩（因为压缩已压缩的.bak文件无用） <br>  -在MS SQL Server的属性中<u>包括</u> ：数据库选项&gt;压缩备份。 <br><br>  2.使用7z进行数据库压缩-速度较慢，但​​压缩效果优于SQL。 <br> 如果选择此选项，则需要： <br>  -选择：最大压缩 <br>  -在MS SQL Server的属性中， <u>禁用</u> ：数据库参数&gt;压缩备份。 <br><br> 在SQL备份中，我使用第一个选项，尽管它压缩得更糟，但是卸载要在几分钟（甚至几秒钟）内完成。 但是第二种选择可能会持续数小时。 <br><br> 在该程序的未来版本中，开发人员承诺考虑将压缩MS SQL数据库的选项添加到任务的属性中，以免遇到MS SQL服务器的属性。 </blockquote></div></div><br>  <u>加密档案</u> <br>  <u>加密文件名</u> <br> 设置密码（写下来，如果您忘记了，将无法还原备份） <br></li><li> 启动时间表： <br>  <u>按计划运行</u> ：启用 <br> 每日03:00 </li><li> 中止任务：启用 <br>  2小时  0分钟 </li></ul><br>  <b>3.2。</b>  <b>任务&gt;添加任务&gt;备份文件和数据库（文件）</b> <br><ul><li> 关键参数 <br>  <u>在存档中包含文件</u> <br></li><li> 档案 <br>  <u>文件</u>的路径：选择1C文件库所在的文件夹的路径，例如“ D：\ Bases” <br> 如果我们要备份子目录中的所有数据库，请选择： <br>  <u>保存文件的名称，目录...</u> ： <br>  1Cv8.1CD <br>  <u>包括子目录（递归）</u> <br><br> 如果要备份子目录中的选定数据库，请选择： <br>  <u>保存文件的名称，目录...</u> ： <br> 布\ 1Cv8.1CD <br> 贸易\ 1Cv8.1CD <br></li><li> 档案储存 <br>  -添加存储<u>\\ NAS \备份\ Everyday</u> <br>  <u>自动删除过时的备份</u> ：30 <br>  - <u>每天</u>添加存储<u>（Google云端硬盘）</u> <br>  <u>自动删除过时的备份</u> ：30 <br></li><li> 存档文件 <br>  <u>存档文件</u>名：数据库名 <br>  <u>档案名称结尾</u> ：yyyy.mm.dd_hh.nn.ss <br> 存档 <br>  <u>格式</u> ：7z <br>  <u>压缩</u>最大 <br>  <u>加密档案</u> <br>  <u>加密文件名</u> <br> 设置密码（写下来，如果您忘记了，将无法还原备份） <br></li><li> 启动时间表： <br>  <u>按计划运行</u> ：启用 <br> 每日03:00 <br></li><li> 中止任务：启用 <br>  2小时  0分钟 </li></ul><br> 我们设置了每日备份的主要任务，然后转到其他 <br><br>  <b>4.任务&gt;添加任务&gt;附加复制</b> <br><ul><li> 关键参数 <br>  <u>备份任务-来源</u> ：选择所需任务 <br>  <u>存储...来源</u> ：选择存储\\ NAS \备份\ Everyday <br></li><li> 档案储存 <br>  -添加存储<u>\\ NAS \备份\ EveryMonth</u> <br>  <u>自动删除过时的备份</u> ：24 <br>  -添加存储<u>EveryMonth（Google云端硬盘）</u> <br>  <u>自动删除过时的备份</u> ：24 <br></li><li> 存档文件 <br>  <u>存档文件</u>名：数据库名 <br>  <u>档案名称结尾</u> ：yyyy.mm.dd_hh.nn.ss <br> 存档 <br>  <u>格式</u> ：7z <br>  <u>压缩</u> ：无压缩 <br>  <u>加密档案</u> <br>  <u>加密文件名</u> <br> 设置密码（写下来，如果您忘记了，将无法还原备份） <br></li><li> 启动时间表： <br>  <u>按计划运行</u> ：启用 <br> 每月一次 所有月份均为第一天。 <br>  05:00 <br></li><li> 中止任务：启用 <br>  2小时  0分钟 <br></li></ul><br> 以此类推，我们<u>为年度计划</u>创建“ <u>附加复制”</u>任务，以提高速度，复制上一个每月任务，并更改其中的名称，存储和时间表 <br><ul><li> 档案储存 <br>  -添加存储<u>\\ NAS \备份\每年</u> <br>  <u>自动删除过时的备份</u> ：12 <br>  - <u>每年</u>添加存储<u>（Google云端硬盘）</u> <br>  <u>自动删除过时的备份</u> ：12 <br></li><li> 启动时间表： <br>  <u>按计划运行</u> ：启用 <br> 每月一次  2月1日（年关闭） <br>  05:00 <br></li></ul><br> 我们配置了其他备份任务，然后继续通过电子邮件生成报告 <br><br>  <b>5.任务&gt;添加任务&gt;发送报告</b> <br><ul><li> 关键参数 <br>  <u>天数</u> ：：1 <br></li><li> 我们选择所有任务，为所有我们选择记录过滤器：错误日志记录 <br></li><li> 邮件选项 <br> 填写邮件的详细信息。 发送报告的位置和主题。 <br></li><li> 启动时间表： <br>  <u>按计划运行</u> ：启用 <br> 日报 <br>  07:00 <br></li></ul><br> 仍然需要依次运行所有任务并检查错误。 <br><br>  <b>重达52GB（mdf）的MS SQL数据库的备份日志示例：</b> <br> <code>=========================================== <br> : Base1 <br>  :       <br> : SRVTS0 <br> : 4.5 / 2 <br> :  ,   <br> : 11.11.2019 4:01:08 <br> : 11.11.2019 5:13:57 <br> :    <br> =========================================== <br> 11.11.2019 4:01:08 -   MSSQL  "Base1" ... <br> 11.11.2019 4:01:08 - SQL Server version 11 <br> 11.11.2019 4:22:15 -  <br> 11.11.2019 4:22:15 -    ... <br> 11.11.2019 4:22:15 -  7z,  , c   <br> 11.11.2019 4:26:50 - 1  , 0   <br> 11.11.2019 4:26:50 -  <br> 11.11.2019 4:26:52 -   5,41 GB   "EveryDay (Google )" ... <br> 11.11.2019 4:26:54 -  "Base1_2019.11.11_04.26.52.7z" 5,41 GB (1  1) <br> 11.11.2019 5:13:57 -    <br> 11.11.2019 4:26:52 -   5,41 GB   "\\NAS\Backup\EveryDay" ... <br> 11.11.2019 4:26:52 -  "Base1_2019.11.11_04.26.52.7z" 5,41 GB (1  1) <br> 11.11.2019 4:28:13 -    <br></code> <br> 从日志中可以看出，同时下载到存储和云。 <br>  27分钟后，到保管库的备份已完成。 从任务开始1小时12分钟后，它被上传到云中。 <br> 假设同时同时又执行了4个数据库备份任务，其大小分别为38GB，28GB，6GB和5GB（mdf）。 <br> 所有任务同时在4:00开始，并在5:15:00之前成功完成。 <br><br>  <b>结论：</b> <br><br> 当然，除了本文已经描述的那些缺陷以外，还有一些细微的缺陷： <br><br><ul><li> 无法以文本文件（即文本文件，而不是mdb等）的形式导出和导入设置和任务，以便您可以轻松打开和编辑 </li><li>  OAuth设置没有可视化保存，它始终为空并且不清楚是否已配置 </li><li> 无法快速打开/关闭任务（您需要打开每个任务并按照时间表进行操作）。 尽管主窗口直观地要求双击复选标记。 </li></ul><br><blockquote> 但总的来说，我对结果感到非常满意。 我发现该程序非常有用。 <br><br> 写关于您的备份算法的信息，这些算法可能会对您有很大帮助，并且可能对其他人有用。 <br></blockquote>  UPD1：感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">Filex</a> ，添加了有关软件成本的信息 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN474944/">https://habr.com/ru/post/zh-CN474944/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN474924/index.html">如何成为一名好经理？ 填补管理技能空白的4种方法</a></li>
<li><a href="../zh-CN474928/index.html">学习遵循Vivaldi浏览器</a></li>
<li><a href="../zh-CN474930/index.html">Meetup潜在客户：获取流媒体</a></li>
<li><a href="../zh-CN474936/index.html">15个用于创建，存储和管理链接（布尔）的出色工具</a></li>
<li><a href="../zh-CN474942/index.html">VMworld 2019第二天：处理，安全和一些新公告</a></li>
<li><a href="../zh-CN474948/index.html">“ Orlan”或我们的“ Orlan”与“ IBM”是否有前景</a></li>
<li><a href="../zh-CN474950/index.html">Artem Svetlov：“每天在工作中，我都会看到OSM如何帮助各种公司”</a></li>
<li><a href="../zh-CN474954/index.html">具有动态结构的二进制机器学习算法</a></li>
<li><a href="../zh-CN474956/index.html">没有追逐的美国动作片是什么？ 托比·加里奇（Toby Galicki）和他的60秒</a></li>
<li><a href="../zh-CN474958/index.html">Zadroth的注释：万能框架</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>