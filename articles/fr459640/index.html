<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï° üèª üßë‚Äçü§ù‚Äçüßë Documents en tant que code. Partie 1: automatiser la mise √† jour ‚ôåÔ∏è üóª üçñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans les grands projets, compos√©s de dizaines et de centaines de services en interaction, une approche de la documentation en tant que code - des docu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Documents en tant que code. Partie 1: automatiser la mise √† jour</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/youla/blog/459640/"><p><img src="https://habrastorage.org/webt/cw/mu/zp/cwmuzpbeunmmybhxtwlffemf01k.gif"></p><br><p>  Dans les grands projets, compos√©s de dizaines et de centaines de services en interaction, une approche de la documentation en tant que code - des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documents en tant que code</a> - devient de plus en plus obligatoire. </p><br><p>  Je montrerai comment appliquer cette philosophie dans les r√©alit√©s du service class√©, ou plut√¥t, je partirai de la premi√®re √©tape de sa mise en ≈ìuvre: l'automatisation de la mise √† jour des donn√©es dans la documentation. </p><a name="habracut"></a><br><h2 id="nabor-instrumentov">  Kit d'outils </h2><br><p>  Le principe de la ¬´documentation en tant que code¬ª implique l'utilisation des m√™mes outils lors de l'√©criture de la documentation que lors de la cr√©ation de code: langages de balisage de texte, syst√®mes de contr√¥le de version, r√©vision de code et auto-tests.  L'objectif principal: cr√©er des conditions permettant √† toute l'√©quipe de travailler ensemble sur le r√©sultat final - une base de connaissances compl√®te et des instructions pour l'utilisation des services de produits individuels.  Ensuite, je parlerai des outils sp√©cifiques que nous avons choisis pour r√©soudre ce probl√®me. </p><br><p>  En tant que langage de balisage de texte, nous avons d√©cid√© d'utiliser le plus universel - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">reStructuredText</a> .  En plus d'un grand nombre de directives qui fournissent toutes les fonctions de base pour structurer le texte, ce langage prend en charge les principaux formats finaux, y compris le HTML n√©cessaire √† notre projet. </p><br><p>  Les fichiers sont convertis de .rst en .html √† l'aide du g√©n√©rateur de documentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sphinx</a> .  Il vous permet de cr√©er des sites statiques pour lesquels vous pouvez cr√©er le v√¥tre ou utiliser des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">th√®mes</a> pr√™ts √† l'emploi.  Notre projet utilise deux th√®mes pr√™ts √† l'emploi - le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">th√®me stanford et le th√®me</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bootstrap</a> .  Le second contient des sous-th√®mes qui vous permettent de d√©finir diff√©rents sch√©mas de couleurs pour les √©l√©ments d'interface cl√©s. </p><br><p>  Pour un acc√®s pratique et rapide √† la version actuelle de la documentation, nous utilisons un site statique h√©berg√© par une machine virtuelle accessible depuis le r√©seau local de l'√©quipe de d√©veloppement. </p><br><p>  Les fichiers source du projet sont stock√©s dans le r√©f√©rentiel Bitbucket et le site est g√©n√©r√© uniquement √† partir des fichiers contenus dans la branche principale.  La mise √† jour des donn√©es n'est possible que par pull-request, ce qui vous permet de v√©rifier toutes les nouvelles sections de la documentation avant leur publication dans le domaine public. </p><br><p>  √âtant donn√© qu'entre l'ach√®vement d'une nouvelle section de la documentation et son envoi sur le site, il est n√©cessaire de v√©rifier son contenu, le processus cl√© dans toute la cha√Æne est le processus de construction du site et de mise √† jour des donn√©es sur l'h√©bergeur.  Cette proc√©dure doit √™tre r√©p√©t√©e √† chaque fois apr√®s la fusion de la demande d'extraction avec la mise √† jour avec la branche principale du projet. </p><br><p><img src="https://habrastorage.org/webt/z3/ua/e9/z3uae9eyv-lj3sipqmirpbpoony.png"></p><br><p>  La mise en ≈ìuvre de cette logique permet √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> - un syst√®me d'int√©gration continue de d√©veloppement, dans notre cas - de la documentation.  Je vais vous en dire plus sur les param√®tres dans les sections: </p><br><ol><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ajout d'un nouveau n≈ìud √† Jenkins</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Description de Jenkinsfile</a></em> </li><li>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Int√©gration de Jenkins et Bitbucket</a></em> </li></ol><br><h2 id="dobavlenie-novogo-uzla-v-jenkins">  Ajout d'un nouveau n≈ìud √† Jenkins </h2><br><p>  Pour cr√©er et mettre √† jour la documentation sur le site, vous devez enregistrer une machine pr√©par√©e √† l'avance en tant qu'agent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> pour cela. </p><br><h4 id="podgotovka-mashiny">  Pr√©paration de la machine </h4><br><p> Selon les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exigences de Jenkins</a> , JDK ou JRE doit √™tre install√© sur tous les composants inclus dans le syst√®me, y compris la machine principale et tous les n≈ìuds d'agent enregistr√©s.  Dans notre cas, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">JDK 8</a> sera utilis√©, pour l'installation dont il suffit d'ex√©cuter la commande: </p><br><pre><code class="plaintext hljs">sudo apt-get -y install java-1.8.0-openjdk git</code> </pre> <br><p>  La machine principale se connecte √† l'agent pour effectuer les t√¢ches qui lui sont attribu√©es.  Pour ce faire, vous devez cr√©er un utilisateur sur l'agent sous lequel toutes les op√©rations seront effectu√©es et dans lequel tous les fichiers g√©n√©r√©s par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> seront stock√©s dans le dossier de base.  Sur les syst√®mes Linux, ex√©cutez simplement la commande: </p><br><pre> <code class="plaintext hljs">sudo adduser jenkins \--shell /bin/bash su jenkins</code> </pre> <br><p>  Pour √©tablir une connexion entre la machine ma√Ætre et l'agent, vous devez configurer SSH et ajouter les cl√©s d'autorisation n√©cessaires.  Nous g√©n√©rerons les cl√©s sur l'agent, apr√®s quoi nous ajouterons la cl√© publique au fichier <code>authorized_keys</code> pour l'utilisateur <em>jenkins</em> . </p><br><p>  Nous allons construire le site avec la documentation dans un conteneur Docker en utilisant une image <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python</a> pr√™te √† l'emploi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">: 3.7</a> .  Suivez les instructions de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle</a> pour installer Docker sur l'agent.  Pour terminer le processus d'installation, vous devez vous reconnecter √† l'agent.  V√©rifiez l'installation en ex√©cutant la commande qui charge l'image de test: </p><br><pre> <code class="plaintext hljs">docker run hello-world</code> </pre> <br><p>  Pour ne pas avoir √† ex√©cuter les commandes Docker au nom du superutilisateur (sudo), il suffit d'ajouter le groupe docker utilisateur cr√©√© lors de l'√©tape d'installation, au nom duquel les commandes seront ex√©cut√©es. </p><br><pre> <code class="plaintext hljs">sudo usermod -aG docker $USER</code> </pre> <br><h4 id="konfiguraciya-novogo-uzla-v-jenkins">  Configuration du nouveau n≈ìud Jenkins </h4><br><p>  √âtant donn√© que la connexion √† l'agent n√©cessite une autorisation, vous devez ajouter les informations d'identification appropri√©es dans les param√®tres Jenkins.  Des instructions d√©taill√©es sur la fa√ßon de proc√©der sur les machines Windows sont fournies dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle Jenkins</a> . </p><br><blockquote>  IMPORTANT: L'identifiant sp√©cifi√© dans la section <em>Configurer Jenkins</em> -&gt; <em>G√©rer les environnements de g√©n√©ration</em> -&gt; <strong>Nom du n≈ìud</strong> -&gt; <em>Configurer</em> dans le param√®tre <strong>Tags</strong> est utilis√© dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkinsfile</a> pour indiquer l'agent sur lequel toutes les op√©rations seront effectu√©es. </blockquote><br><h2 id="opisanie-jenkinsfile">  Description de Jenkinsfile </h2><br><p>  La racine du r√©f√©rentiel de projet contient le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichier Jenkins</a> , qui contient des instructions pour: </p><br><ul><li>  Pr√©paration de l'environnement de g√©n√©ration et installation des d√©pendances </li><li>  Cr√©er un site avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sphinx</a> </li><li>  mise √† jour des informations sur l'h√¥te. </li></ul><br><p>  Les instructions sont d√©finies √† l'aide de directives sp√©ciales, dont l'application sera examin√©e plus loin sur l'exemple du fichier utilis√© dans le projet. </p><br><h4 id="ukazanie-agenta">  Indication de l'agent </h4><br><p>  Au d√©but du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichier Jenkins,</a> sp√©cifiez le libell√© de l'agent dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> , sur lequel toutes les op√©rations seront effectu√©es.  Pour ce faire, utilisez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">directive agent</a> : </p><br><pre> <code class="plaintext hljs">agent { label '-' }</code> </pre> <br><h4 id="podgotovka-sredy">  Pr√©paration de l'environnement </h4><br><p>  Pour ex√©cuter la commande sphinx-build site build, vous devez d√©finir des variables d'environnement dans lesquelles les chemins de donn√©es r√©els seront stock√©s.  De plus, pour mettre √† jour les informations sur l'h√¥te, vous devez sp√©cifier √† l'avance les chemins o√π les donn√©es du site avec la documentation sont stock√©es.  La <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">directive environnement</a> vous permet d'affecter ces valeurs √† des variables: </p><br><pre> <code class="plaintext hljs">environment { SPHINX_DIR = '.' //,    Sphinx BUILD_DIR = 'project_home_built' //    SOURCE_DIR = 'project_home_source' //   .rst  .md  DEPLOY_HOST = 'username@127.1.1.0:/var/www/html/' //@IP__:__ }</code> </pre> <br><h4 id="osnovnye-deystviya">  Actions principales </h4><br><p>  Les principales instructions qui seront ex√©cut√©es dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkinsfile</a> sont contenues dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">directive stages</a> , qui comprend les diff√©rentes √©tapes d√©crites <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">par les directives stage</a> .  Un exemple simple d'un pipeline CI en trois √©tapes: </p><br><pre> <code class="plaintext hljs">pipeline { agent any stages { stage('Build') { steps { echo 'Building..' } } stage('Test') { steps { echo 'Testing..' } } stage('Deploy') { steps { echo 'Deploying....' } } } }</code> </pre> <br><h4 id="zapusk-konteynera-docker-i-ustanovka-zavisimostey">  Lancer le conteneur Docker et installer les d√©pendances </h4><br><p>  Tout d'abord, ex√©cutez le conteneur Docker avec l'image <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python</a> termin√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">: 3.7</a> .  Pour ce faire, utilisez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commande docker run</a> avec les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">indicateurs --rm</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">-i</a> .  Effectuez ensuite les √©tapes suivantes: </p><br><ul><li>  installez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python virtualenv</a> ; </li><li>  cr√©er et activer un nouvel environnement virtuel; </li><li>  y installer toutes les d√©pendances n√©cessaires r√©pertori√©es dans le fichier <br>  requirements.txt, qui est stock√© √† la racine du r√©f√©rentiel de projet. </li></ul><br><pre> <code class="plaintext hljs">stage('Install Dependencies') { steps { sh ''' docker run --rm -i python:3.7 python3 -m pip install --user --upgrade pip python3 -m pip install --user virtualenv python3 -m virtualenv pyenv . pyenv/bin/activate pip install -r \${SPHINX\_DIR}/requirements.txt ''' } }</code> </pre> <br><h4 id="sborka-sayta-s-dokumentaciey">  Cr√©er un site avec de la documentation </h4><br><p>  Construisons maintenant un site.  Pour ce faire, ex√©cutez la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commande sphinx-build</a> avec les indicateurs suivants: </p><br><p>  <code>-q</code> : enregistre uniquement les avertissements et les erreurs; <br>  <code>-w</code> : √©crire un journal dans le fichier sp√©cifi√© apr√®s l'indicateur; <br>  <code>-b</code> : nom du constructeur du site; <br>  <code>-d</code> : sp√©cifiez le r√©pertoire de stockage des fichiers mis en cache - pickles doctree. </p><br><p>  Avant de d√©marrer l'assembly, √† l'aide de la <code>rm -rf</code> supprimez l'assembly de site et les journaux pr√©c√©dents.  En cas d'erreur √† l'une des √©tapes, le journal d'ex√©cution de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">construction de sphinx</a> appara√Ætra dans la console <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> . </p><br><pre> <code class="plaintext hljs">stage('Build') { steps { // clear out old files sh 'rm -rf ${BUILD_DIR}' sh 'rm -f ${SPHINX_DIR}/sphinx-build.log' sh ''' ${WORKSPACE}/pyenv/bin/sphinx-build -q -w ${SPHINX_DIR}/sphinx-build.log \ -b html \ -d ${BUILD_DIR}/doctrees ${SOURCE\_DIR} ${BUILD\_DIR} ''' } post { failure { sh 'cat ${SPHINX_DIR}sphinx-build.log' } } }</code> </pre> <br><h4 id="obnovlenie-sayta-na-hoste">  Mise √† jour du site h√¥te </h4><br><p>  Enfin, nous mettrons √† jour les informations sur l'h√¥te desservant le site avec la documentation produit disponible dans l'environnement local.  Dans l'impl√©mentation actuelle, l'h√¥te est la m√™me machine virtuelle qui est enregistr√©e en tant qu'agent Jenkins pour la t√¢che d'assemblage et de mise √† jour de la documentation. </p><br><p>  En tant qu'outil de synchronisation, nous utilisons l'utilitaire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rsync</a> .  Pour que cela fonctionne correctement, il est n√©cessaire de configurer une connexion SSH entre le conteneur Docker, dans lequel se trouvait le site avec la documentation, et l'h√¥te. </p><br><p>  Afin de configurer la connexion SSH √† l'aide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkinsfile</a> , les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugins suivants</a> doivent √™tre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">install√©s</a> dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> : </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSH Agent Plugin</a> - vous permet d'utiliser l'√©tape <code>sshagent</code> dans les scripts pour fournir les informations d'identification du formulaire <em>nom d'utilisateur / cl√©</em> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SSH Credentials Plugin</a> - vous permet d'enregistrer les informations d'identification du formulaire <em>nom d'utilisateur / cl√©</em> dans les param√®tres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> . </li></ol><br><p>  Apr√®s avoir install√© les plugins, vous devez sp√©cifier les informations d'identification actuelles pour vous connecter √† l'h√¥te en remplissant le formulaire dans la section <strong>Informations d'identification</strong> : </p><br><ul><li>  <strong>ID</strong> : identifiant qui sera utilis√© dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkinsfile</a> √† l'√©tape <code>sshagent</code> pour indiquer des informations d'identification sp√©cifiques ( <code>docs-deployer</code> ); </li><li>  <strong>Nom d'utilisateur</strong> : nom d'utilisateur sous lequel les op√©rations de mise √† jour des donn√©es du site seront effectu√©es (l'utilisateur doit avoir un <strong><em>acc√®s en √©criture au</em></strong> dossier <code>/var/html</code> de l'h√¥te); </li><li>  <strong>Cl√© priv√©e</strong> : une cl√© priv√©e pour acc√©der √† l'h√¥te; </li><li>  <strong>Phrase secr√®te</strong> : mot de passe de la cl√©, s'il a √©t√© d√©fini lors de la g√©n√©ration. </li></ul><br><p>  Vous trouverez ci-dessous le code de script qui se connecte via SSH et met √† jour les informations sur l'h√¥te √† l'aide des variables syst√®me sp√©cifi√©es au stade de la pr√©paration de l'environnement avec les chemins d'acc√®s aux donn√©es n√©cessaires.  Le r√©sultat de la commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rsync</a> est √©crit dans le journal, qui sera affich√© dans la console <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> en cas d'erreurs de synchronisation. </p><br><pre> <code class="plaintext hljs">stage('Deploy') { steps { sshagent(credentials: ['docs-deployer']) { sh ''' #!/bin/bash rm -f ${SPHINX_DIR}/rsync.log RSYNCOPT=(-aze 'ssh -o StrictHostKeyChecking=no') rsync "${RSYNCOPT[@]}" \ --delete \ ${BUILD_DIR_CI} ${DEPLOY_HOST}/ ''' } } post { failure { sh 'cat ${SPHINX_DIR}/rsync.log' } } }</code> </pre> <br><h2 id="integraciya-jenkins-i-bitbucket">  Int√©gration de Jenkins et Bitbucket </h2><br><p>  Il existe de nombreuses fa√ßons d'organiser l'interaction de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bitbucket</a> , mais dans notre projet, nous avons d√©cid√© d'utiliser le plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Builds param√©tr√© pour Jenkins</a> .  La documentation officielle contient des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instructions</a> d√©taill√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pour l'installation du</a> plugin, ainsi que les param√®tres qui doivent √™tre sp√©cifi√©s pour les deux syst√®mes.  Pour travailler avec ce plugin, vous devez cr√©er un utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> et g√©n√©rer un jeton sp√©cial pour lui qui permettra √† cet utilisateur de se connecter au syst√®me. </p><br><h4 id="sozdanie-polzovatelya-i-api-tokena">  Cr√©ation d'un jeton utilisateur et API </h4><br><p>  Pour cr√©er un nouvel utilisateur dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> , acc√©dez √† <em>Param√®tres Jenkins</em> -&gt; <em>Gestion des utilisateurs</em> -&gt; <em>Cr√©er un utilisateur</em> et remplissez toutes les informations d'identification n√©cessaires dans le formulaire. </p><br><p>  Le m√©canisme d'authentification qui permet √† des scripts ou applications tiers d'utiliser l'API Jenkins sans r√©ellement transmettre le mot de passe utilisateur est un jeton API sp√©cial qui peut √™tre g√©n√©r√© pour chaque utilisateur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> .  Pour ce faire: </p><br><ul><li>  connectez-vous √† la console de gestion en utilisant les d√©tails de l'utilisateur cr√©√© pr√©c√©demment; </li><li>  allez dans <em>Configurer Jenkins</em> -&gt; <em>Gestion des utilisateurs</em> ; </li><li>  cliquez sur l'ic√¥ne d'engrenage √† droite du nom d'utilisateur sous lequel ils sont autoris√©s dans le syst√®me; </li><li>  recherchez <em>l'API Token</em> dans la liste des param√®tres et cliquez sur le bouton <em>Ajouter un nouveau jeton</em> ; </li><li>  dans le champ qui appara√Æt, sp√©cifiez l'identifiant du token API et cliquez sur le bouton <em>G√©n√©rer</em> ; </li><li>  en suivant l'invite √† l'√©cran, copiez et enregistrez le jeton d'API g√©n√©r√©. </li></ul><br><p>  Maintenant, dans les param√®tres du serveur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Bitbucket</a> , vous pouvez sp√©cifier l'utilisateur par d√©faut pour se connecter √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jenkins</a> . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Si auparavant, le processus comportait plusieurs √©tapes: </p><br><ul><li>  T√©l√©chargez la mise √† jour dans le r√©f√©rentiel </li><li>  attendre la confirmation de l'exactitude; </li><li>  cr√©er un site Web avec de la documentation; </li><li>  mettre √† jour les informations sur l'h√¥te; </li></ul><br><p>  il suffit maintenant de cliquer sur un bouton Fusionner dans Bitbucket.  Si, apr√®s v√©rification, il n'est pas n√©cessaire d'apporter des modifications aux fichiers source, la version actuelle de la documentation est mise √† jour imm√©diatement apr√®s avoir confirm√© l'exactitude des donn√©es. </p><br><p>  Cela simplifie consid√©rablement la t√¢che du r√©dacteur technique, lui √©vitant un grand nombre d'actions manuelles, et les chefs de projet disposent d'un outil pratique pour suivre les ajouts de documentation et les commentaires. </p><br><p>  L'automatisation de ce processus est la premi√®re √©tape de la construction d'une infrastructure de gestion de la documentation.  √Ä l'avenir, nous pr√©voyons d'ajouter des tests automatiques qui v√©rifieront l'exactitude des liens externes utilis√©s dans la documentation, et souhaitons √©galement cr√©er des objets d'interface interactifs qui sont int√©gr√©s dans des th√®mes pr√™ts √† l'emploi pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sphinx</a> . </p><br><p>  Merci √† ceux qui ont lu ceci pour votre attention, nous continuerons bient√¥t √† partager les d√©tails de la cr√©ation de la documentation dans notre projet! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459640/">https://habr.com/ru/post/fr459640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459624/index.html">Drones militaires</a></li>
<li><a href="../fr459626/index.html">Windows Notification Facility: la surface d'attaque la plus non document√©e</a></li>
<li><a href="../fr459628/index.html">L'Open Invention Network compte plus de trois mille licenci√©s - qu'est-ce que cela signifie pour les logiciels open source</a></li>
<li><a href="../fr459630/index.html">Tic Tac Toe Partie 2: Annuler / R√©tablir sans √©tat</a></li>
<li><a href="../fr459638/index.html">Cr√©ation d'une base de connaissances mondiale sur les batteries</a></li>
<li><a href="../fr459642/index.html">Acc√®s s√©curis√© aux champs d'enregistrement en C ++ sans sacrifier l'efficacit√© (en utilisant CortexM comme exemple)</a></li>
<li><a href="../fr459644/index.html">Gradateurs LED</a></li>
<li><a href="../fr459648/index.html">Tout devrait bien se passer dans l'analyseur: √† la fois fonctionnalit√© et interface ... Nous explorons la nouvelle interface Solar appScreener 3.1</a></li>
<li><a href="../fr459650/index.html">Comment ne pas perdre d'argent dans la bo√Æte noire: m√©thodes de test de facturation</a></li>
<li><a href="../fr459652/index.html">Approche de test de r√©gression automatis√©e</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>