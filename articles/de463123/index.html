<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçã üè≥Ô∏è üßëüèΩ‚Äçü§ù‚Äçüßëüèº Assembler-Codegenerator-Bibliothek f√ºr AVR-Mikrocontroller. Teil 3 ‚ÜïÔ∏è ü•Ä ‚ôåÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚Üê Teil 2. Erste Schritte 
 Teil 4. Peripherieger√§te programmieren und Interrupts behandeln ‚Üí 
 Assembler Code Generator Library f√ºr AVR-Mikrocontrolle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Assembler-Codegenerator-Bibliothek f√ºr AVR-Mikrocontroller. Teil 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463123/"><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">‚Üê Teil 2. Erste Schritte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teil 4. Peripherieger√§te programmieren und Interrupts behandeln ‚Üí</a> </p><br><h2 id="biblioteka-generatora-assemblernogo-koda-dlya-mikrokontrollerov-avr">  Assembler Code Generator Library f√ºr AVR-Mikrocontroller </h2><br><h3 id="chast-3-kosvennaya-adresaciya-i-upravlenie-potokom-ispolneniya">  Teil 3. Indirekte Adressierung und Flusskontrolle </h3><br><p>  Im vorherigen Teil haben wir uns ausf√ºhrlich mit der Arbeit mit 8-Bit-Registervariablen befasst.  Wenn Sie den vorherigen Beitrag verpasst haben, empfehle ich Ihnen, ihn zu lesen.  Dort finden Sie einen Link zur Bibliothek, um die Beispiele im Artikel selbst auszuprobieren.  F√ºr diejenigen, die die Bibliothek fr√ºher heruntergeladen haben, empfehle ich das Herunterladen der neuesten Version, da die Bibliothek st√§ndig aktualisiert wird und einige Beispiele in der alten Version der Bibliothek m√∂glicherweise nicht funktionieren. </p><a name="habracut"></a><br><p>  Leider reichen die Bittiefen der zuvor betrachteten Registervariablen eindeutig nicht aus, um als Speicherzeiger verwendet zu werden.  Bevor wir direkt mit der Diskussion der Zeiger fortfahren, betrachten wir daher eine andere Klasse der Datenbeschreibung.  Die meisten Befehle in der AVR-Mega-Architektur sind so konzipiert, dass sie nur mit Registeroperanden funktionieren, d. H. Beide Operanden und das Ergebnis sind 8 Bit gro√ü.  Es gibt jedoch eine Reihe von Operationen, bei denen zwei nacheinander angeordnete ROZ-Register als ein einziges 16-Bit-Register betrachtet werden.  Es gibt nur wenige solcher Operationen, und sie konzentrieren sich haupts√§chlich auf die Arbeit mit Zeigern. </p><br><p>  Aus Sicht der Syntax der Bibliothek entspricht die Arbeit mit einem Registerpaar fast der Arbeit mit einer Registervariablen.  Stellen Sie sich ein kleines Beispiel vor, in dem wir versuchen, mit einem Registerpaar zu arbeiten.  Um hier und unten Platz zu sparen, geben wir das Ergebnis der Ausf√ºhrung nur dann an, wenn bestimmte Merkmale der Codegenerierung erl√§utert werden m√ºssen. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dr1 = m.DREG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dr2 = m.DREG(); dr1.Load(<span class="hljs-number"><span class="hljs-number">0xAA55</span></span>); dr2.Load(<span class="hljs-number"><span class="hljs-number">0x55AA</span></span>); dr1++; dr1--; dr1 += <span class="hljs-number"><span class="hljs-number">0x100</span></span>; dr1 += dr2; dr2 *= dr1; dr2 /= dr1; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  In diesem Beispiel haben wir mit dem Befehl DREG () zwei 2-Byte-Variablen deklariert, die sich in Registerpaaren befinden.  Mit den folgenden Befehlen haben wir ihnen den Anfangswert zugewiesen und eine Reihe von arithmetischen Operationen ausgef√ºhrt.  Wie Sie dem Beispiel entnehmen k√∂nnen, entspricht die Syntax f√ºr die Arbeit mit einem Registerpaar weitgehend der f√ºr die Arbeit mit einem regul√§ren Register.  Ein Registerpaar kann auch als eine Variable betrachtet werden, die aus zwei unabh√§ngigen Registern besteht.  Auf das Register wird als Satz von zwei 8-Bit-Registern √ºber die <em>High-</em> Eigenschaft f√ºr den Zugriff auf die oberen 8 Bits als 8-Bit-Register und die <em>Low-</em> Eigenschaft f√ºr den Zugriff auf die unteren 8 Bits zugegriffen.  Der Code sieht folgenderma√üen aus </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dr1 = m.DREG(); dr1.Load(<span class="hljs-number"><span class="hljs-number">0xAA55</span></span>); dr1.Low--; dr1.High += dr1.Low; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Wie Sie dem Beispiel entnehmen k√∂nnen, k√∂nnen wir mit <em>High</em> und <em>Low</em> als unabh√§ngige Registervariablen arbeiten, einschlie√ülich der Ausf√ºhrung verschiedener arithmetischer und logischer Operationen zwischen ihnen. </p><br><p>  Nachdem wir Variablen mit doppelter L√§nge herausgefunden haben, k√∂nnen wir beschreiben, wie mit Variablen im Speicher gearbeitet wird.  In der Bibliothek k√∂nnen Sie mit 8, 16-Bit-Variablen und Arrays von Bytes beliebiger L√§nge arbeiten.  Betrachten Sie ein Beispiel f√ºr die Zuweisung von Speicherplatz f√ºr Variablen im RAM. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt = m.BYTE(); <span class="hljs-comment"><span class="hljs-comment">//8-    var wd = m.WORD(); //16-    var arr = m.ARRAY(16); //  16  var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Mal sehen, was passiert ist. </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0001</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0000</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 1</span></span></code> </pre> <br><p>  Im Abschnitt Datendefinition haben wir eine Speicherzuordnung.  Beachten Sie, dass sich die Zuordnungsreihenfolge von der Deklaration von Variablen unterscheidet.  Das ist kein Zufall.  Die Zuweisung des Speichers f√ºr Variablen erfolgt nach dem Sortieren in absteigender Reihenfolge nach den folgenden Kriterien (in absteigender Reihenfolge der Wichtigkeit). Das maximale Divisor-Vielfache vom Grad 2 ‚Üí Die Gr√∂√üe des zugewiesenen Speichers.  Dies bedeutet, dass, wenn wir 4 Arrays mit einer Gr√∂√üe von 64, 48, 40 und 16 Bytes zuweisen m√∂chten, die Zuordnungsreihenfolge unabh√§ngig von der Deklarationsreihenfolge folgenderma√üen aussieht: </p><br><p>  L√§nge 64 - Maximale Divisor-Vielfache von Grad 2 = 64 <br>  L√§nge 48 - Maximale Divisor-Vielfache von Grad 2 = 16 <br>  L√§nge 16 - Maximales Divisor-Vielfaches von Grad 2 = 16 <br>  L√§nge 40 - Maximale Divisor-Vielfache von Grad 2 = 8 <br>  Dies geschieht, um die Steuerung der Grenzen des Arrays zu vereinfachen. <br>  und reduzieren Sie die Gr√∂√üe des Codes in Operationen mit Zeigern.  Wir k√∂nnen keine Operationen mit Variablen im Speicher direkt ausf√ºhren, daher steht uns nur das Lesen / Schreiben zum Registrieren von Variablen zur Verf√ºgung.  Der einfachste Weg, mit Variablen im Speicher zu arbeiten, ist die direkte Adressierung. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt = m.BYTE(); <span class="hljs-comment"><span class="hljs-comment">// 8-    var rr = m.REG(); //    rr.Load(0xAA); //  rr   0xAA rr.Mstore(bt); //     rr.Clear(); //  rr.Mload(bt); //    var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  In diesem Beispiel haben wir eine Variable im Speicher und eine Registervariable deklariert.  Danach haben wir der Variablen den Wert 0x55 zugewiesen und ihn in die Variable im Speicher geschrieben.  Dann gel√∂scht und wieder hergestellt. </p><br><p>  Um mit Array-Elementen zu arbeiten, verwenden wir die folgende Syntax </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = m.ARRAY(<span class="hljs-number"><span class="hljs-number">10</span></span>); rr.MLoad(arr[<span class="hljs-number"><span class="hljs-number">5</span></span>]);</code> </pre> <br><p>  Die Nummerierung der Elemente im Array beginnt mit 0. Somit wird im obigen Beispiel der Wert 6 des Array-Elements in die Zelle rr geschrieben. </p><br><p>  Jetzt k√∂nnen Sie zur indirekten Adressierung wechseln.  Die Bibliothek hat einen eigenen Datentyp f√ºr einen Zeiger auf den RAM-Speicher - <em>MEMPtr</em> .  Mal sehen, wie wir es nutzen k√∂nnen.  Wir √§ndern unser vorheriges Beispiel so, dass die Arbeit mit der Variablen im Speicher √ºber den Zeiger ausgef√ºhrt wird. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt1 = m.BYTE(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt2 = m.BYTE(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.MEMPTR(); <span class="hljs-comment"><span class="hljs-comment">//  ptr ptr.Load(bt1); //ptr   bt1 rr.Load(0xAA); // rr - 0xAA ptr.MStore(rr); //  bt1 0xAA rr.Load(0x55); // rr - 0x55 ptr.Load(bt2); //ptr   bt2 ptr.MStore(rr); //  bt2 0x55 ptr.Load(bt1); //ptr   bt1 ptr.MLoad(rr); //  rr  0xAA var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Aus dem Text ist ersichtlich, dass wir zuerst den <em>ptr-Zeiger</em> deklariert und dann Schreib- und Leseoperationen damit ausgef√ºhrt haben.  Zus√§tzlich zur M√∂glichkeit, die Lese- / Schreibadresse im Befehl w√§hrend der Ausf√ºhrung zu √§ndern, vereinfacht die Verwendung des Zeigers die Arbeit mit Arrays und kombiniert die Lese- / Schreiboperation mit dem Inkrementieren / Dekrementieren des Zeigers.  Schauen wir uns ein Programm an, das ein Array mit einem bestimmten Wert f√ºllen kann. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bt1 = m.ARRAY(<span class="hljs-number"><span class="hljs-number">4</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   4  var rr = m.REG(); var ptr = m.MEMPTR(); ptr.Load(bt1.Label); //ptr   bt1 rr.Load(0xAA); // rr - 0xAA ptr.MStoreInc(rr); //  bt1 0xAA ptr.MStoreInc(rr); //  bt1+1 0xAA ptr.MStoreInc(rr); //  bt1+2 0xAA ptr.MStoreInc(rr); //  bt1+3 0xAA rr.Clear(); rr.MLoad(bt1[2]); //  rr 3-   var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  In diesem Beispiel haben wir die M√∂glichkeit genutzt, einen Zeiger beim Schreiben in den Speicher zu erh√∂hen. <br>  Als n√§chstes gehen wir zur F√§higkeit der Bibliothek √ºber, den Befehlsfluss zu steuern.  Wenn es einfacher ist, wie man bedingte und bedingungslose Spr√ºnge und Schleifen mithilfe der Bibliothek programmiert.  Der einfachste Weg, dies zu verwalten, ist die Verwendung von Beschriftungsnavigationsbefehlen.  Beschriftungen in einem Programm werden auf zwei verschiedene Arten deklariert.  Das erste ist, dass wir mit dem <em>AVRASM.Label-</em> Team ein Label f√ºr die zuk√ºnftige Verwendung erstellen, es aber nicht in den Programmcode einf√ºgen.  Diese Methode wird verwendet, um Vorw√§rtsspr√ºnge zu erstellen, dh in F√§llen, in denen der Sprungbefehl vor der Beschriftung stehen muss.  Um die Beschriftung an der gew√ºnschten Stelle des Assembler-Codes festzulegen, m√ºssen Sie den Befehl <em>AVRASM.newLabel ([Variable der zuvor erstellten Beschriftung]) ausf√ºhren</em> .  Um zur√ºck zu gehen, k√∂nnen Sie eine einfachere Syntax verwenden, indem Sie eine Bezeichnung <em>festlegen</em> und ihren Wert einer Variablen mit einem Befehl <em>AVRASM.newLabel ()</em> ohne Parameter <em>zuweisen</em> . </p><br><p>  Die einfachste Art des √úbergangs ist ein bedingungsloser √úbergang.  Um es aufzurufen, verwenden wir den <em>Befehl GO ([jump_mark]]</em> .  Mal sehen, wie es mit einem Beispiel aussieht. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = m.REG(); <span class="hljs-comment"><span class="hljs-comment">//  var lbl1 = AVRASM.Label;//        m.GO(lbl1); r++; //    r++; AVRASM.NewLabel(lbl1);//  //  var lbl2 = AVRASM.NewLabel();//    r--; //    r--; m.GO(lbl2); var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Bedingte √úberg√§nge haben mehr Kontrolle √ºber den Ausf√ºhrungsfluss.  Ihr Verhalten h√§ngt vom Status der Operationsflags ab, und dies erm√∂glicht es, den Operationsfluss abh√§ngig vom Ergebnis ihrer Ausf√ºhrung zu steuern.  Die Bibliothek verwendet die <em>IF-</em> Funktion, um einen Befehlsblock zu beschreiben, der nur unter bestimmten Bedingungen ausgef√ºhrt werden sollte.  Schauen wir uns ein Beispiel an. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr2 = m.REG(); rr1.Load(<span class="hljs-number"><span class="hljs-number">0x22</span></span>); rr2.Load(<span class="hljs-number"><span class="hljs-number">0x33</span></span>); m.IF(rr1 == rr2, () =&gt; { AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" - ,  "</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Da die Syntax des <em>IF-</em> Befehls nicht ganz bekannt ist, sollten Sie sie genauer betrachten.  Das erste Argument hier ist die √úbergangsbedingung.  Das Folgende ist die Methode, in der der Codeblock platziert wird, die ausgef√ºhrt werden sollte, wenn die Bedingung erf√ºllt ist.  Eine Variante der Funktion ist die F√§higkeit, einen alternativen Zweig zu beschreiben, d. H. Einen Codeblock, der ausgef√ºhrt werden muss, wenn die Bedingung nicht erf√ºllt ist.  Zus√§tzlich k√∂nnen Sie auf die Funktion <em>AVRASM.Comment () achten</em> , mit der wir dem Ausgabe-Assembler Kommentare hinzuf√ºgen k√∂nnen. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr2 = m.REG(); rr1.Load(<span class="hljs-number"><span class="hljs-number">0x22</span></span>); rr2.Load(<span class="hljs-number"><span class="hljs-number">0x33</span></span>); m.IF(rr1 == rr2, () =&gt; { AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" - ,  "</span></span>); },()=&gt; { AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" - ,   "</span></span>); }); AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">" "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  Das Ergebnis in diesem Fall sieht wie folgt aus </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r21</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,34 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function">,51 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brne</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function"> ;---  - ,   --- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xjmp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0004</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">: ;---  - ,    --- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0004</span></span></span><span class="hljs-function">: ;---   --- .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span></span></code> </pre> <br><p>  Die vorhergehenden Beispiele zeigen eine bedingte Verzweigungsoption, bei der ein Vergleichsbefehl zum Bestimmen der Verzweigungsbedingungen verwendet wird.  In einigen F√§llen ist dies nicht erforderlich, da die √úbergangsbedingungen durch den Status der Flags nach der letzten ausgef√ºhrten Operation bestimmt werden sollten.  Die folgende Syntax wird f√ºr solche F√§lle bereitgestellt. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); rr1.Load(<span class="hljs-number"><span class="hljs-number">0x22</span></span>); rr1--; m.IFEMPTY(() =&gt;AVRASM.Comment(<span class="hljs-string"><span class="hljs-string">",    0"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = AVRASM.Text(m);</code> </pre> <br><p>  In diesem Beispiel √ºberpr√ºft die <em>IFEMPTY-</em> Funktion den Status des Z-Flags nach einem Inkrement und f√ºhrt den Code des bedingten Blocks aus, wenn er 0 erreicht. <br>  Am flexibelsten in Bezug auf die Verwendung kann die <em>LOOP-</em> Funktion betrachtet werden.  Es dient zur bequemen Beschreibung von Programmzyklen.  Betrachten Sie ihre Unterschrift </p><br><pre> <code class="cs hljs">LOOP(Register iter, Action&lt;Register, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; Condition, Action&lt;Register, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; body)</code> </pre> <br><p>  Der Parameter <em>iter</em> weist eine Registervariable zu, die als Iterator in einer Schleife verwendet werden kann.  Der zweite Parameter enth√§lt einen Codeblock, der die Bedingungen f√ºr das Verlassen der Schleife beschreibt.  Der zugewiesene Iterator und die Startbezeichnung der zur√ºckzugebenden Schleife werden an diesen Codeblock √ºbergeben.  Der letzte Parameter wird verwendet, um den Codeblock des Hauptk√∂rpers der Schleife zu beschreiben.  Das einfachste Beispiel f√ºr die Verwendung der <em>LOOP-</em> Funktion ist eine Stub-Schleife, <em>dh</em> eine Endlosschleife, um zur gleichen Zeile zu springen.  Die Syntax lautet in diesem Fall wie folgt </p><br><pre> <code class="cs hljs">m.LOOP(m.TempL, (r, l) =&gt; m.GO(l), (r,l) =&gt; { });</code> </pre> <br><p>  Das Kompilierungsergebnis ist unten angegeben. </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">L0002: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xjmp</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span></span></code> </pre> <br><p>  Kehren wir zu unserem Beispiel des F√ºllens eines Arrays mit einem bestimmten Wert zur√ºck und √§ndern Sie ihn so, dass das F√ºllen in einer Schleife ausgef√ºhrt wird </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr1 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rr2 = m.REG(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = m.ARRAY(<span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.MEMPTR(); ptr.Load(arr[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-comment"><span class="hljs-comment">//     rr2.Load(16); //    rr1.Load(0xAA); //   m.LOOP(rr2, (r, l) =&gt; //rr2     . { r--; //   m.IFNOTEMPTY(l); // ,   }, (r,l) =&gt; ptr.MStoreInc(rr1)); //   var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  Der Ausgabecode sieht in diesem Fall wie folgt aus </p><br><pre> <code class="dos hljs"><span class="hljs-function"><span class="hljs-function">RESET: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">high</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPH</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">low</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RAMEND</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">out</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SPL</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r16</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r20</span></span></span><span class="hljs-function"> .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DEF</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">r21</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YL</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LOW</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">+0) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YH</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HIGH</span></span></span><span class="hljs-function">(</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">+0) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function">,16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ldi</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function">,170 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0003</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">st</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Y</span></span></span><span class="hljs-function">+,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0000</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dec</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">R0001</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brne</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0003</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0004</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DSEG</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">L0002</span></span></span><span class="hljs-function">: .</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BYTE</span></span></span><span class="hljs-function"> 16</span></span></code> </pre> <br><p>  Eine andere M√∂glichkeit, √úberg√§nge zu organisieren, sind indirekt adressierte √úberg√§nge.  Das f√ºr sie am n√§chsten liegende Analogon in Hochsprachen ist ein Zeiger auf eine Funktion.  Der Zeiger zeigt in diesem Fall nicht auf den RAM-Speicher, sondern auf den Programmcode.  Da AVR √ºber eine Harvard-Architektur verf√ºgt und einen eigenen Befehlssatz f√ºr den Zugriff auf den Programmspeicher verwendet, wird ROMPtr anstelle von MEMPtr wie oben beschrieben als Zeiger verwendet.  Der Anwendungsfall f√ºr indirekt adressierte √úberg√§nge kann durch das folgende Beispiel veranschaulicht werden. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block1 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block2 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block3 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.ROMPTR(); ptr.Load(block1); <span class="hljs-comment"><span class="hljs-comment">//     var loop = AVRASM.NewLabel(); AVRASM.Comment("   "); m.GOIndirect(ptr); //   ,     AVRASM.NewLabel(block1); AVRASM.Comment("  1"); ptr.Load(block2); m.GO(loop); AVRASM.NewLabel(block2); AVRASM.Comment("  2"); ptr.Load(block3); m.GO(loop); AVRASM.NewLabel(block3); AVRASM.Comment("  3"); ptr.Load(block1); m.GO(loop); var t = AVRASM.Text(m);</span></span></code> </pre> <br><p>  In diesem Beispiel haben wir 3 Befehlsbl√∂cke.  Nach Abschluss jedes Blocks wird die Steuerung zur√ºck an den indirekt adressierten Verzweigungsbefehl √ºbertragen.  Da wir am Ende des Befehlsblocks den √úbergangsvektor jedes Mal auf einen neuen Block setzen, sieht die Ausf√ºhrung wie Block1 ‚Üí Block2 ‚Üí Block3 ‚Üí Block1 ... usw. in einem Kreis aus.  Dieser Befehl erm√∂glicht zusammen mit bedingten Verzweigungsbefehlen einfache und bequeme Mittel der Sprache, um solche ziemlich komplexen Algorithmen wie eine Zustandsmaschine zu beschreiben. </p><br><p>  Eine komplexere Version eines indirekt adressierten Zweigs ist der Befehl <em>SWITCH</em> .  Es wird kein Zeiger auf eine √úbergangsbezeichnung f√ºr den √úbergang verwendet, sondern ein Zeiger auf eine Variable im Speicher, in dem die Adresse der √úbergangsbezeichnung gespeichert ist. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Mega328(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block1 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block2 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> block3 = AVRASM.Label; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr = m.ARRAY(<span class="hljs-number"><span class="hljs-number">6</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ptr = m.MEMPTR(); <span class="hljs-comment"><span class="hljs-comment">//    m.Temp.Load(block1); m.Temp.Store(arr[0]); m.Temp.Load(block2); m.Temp.Store(arr[2]); m.Temp.Load(block3); m.Temp.Store(arr[4]); ptr.Load(arr[0]); //     var loop = AVRASM.NewLabel(); m.SWITCH(ptr); //   ,     AVRASM.NewLabel(block1); AVRASM.Comment("  1"); ptr.Load(arr[2]); //       m.GO(loop); AVRASM.NewLabel(block2); AVRASM.Comment("  2"); m.Temp.Load(block3); ptr.MStore(m.Temp); //       m.GO(loop); AVRASM.NewLabel(block3); AVRASM.Comment("  3"); ptr.Load(arr[0]); //       m.GO(loop);</span></span></code> </pre> <br><p>  In diesem Beispiel lautet die √úbergangssequenz wie folgt: Block1 ‚Üí Block2 ‚Üí Block3 ‚Üí Block1 ‚Üí Block3 ‚Üí Block1 ‚Üí Block3 ‚Üí Block1 ... Wir konnten einen Algorithmus implementieren, bei dem die Block2-Befehle nur im ersten Zyklus ausgef√ºhrt werden. </p><br><p>  Im n√§chsten Teil des Beitrags werden wir uns mit der Arbeit mit Peripherieger√§ten, der Implementierung von Interrupts, Routinen und vielem mehr befassen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463123/">https://habr.com/ru/post/de463123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463107/index.html">ShIoTiny: kleine Automatisierung, das Internet der Dinge oder ‚Äûsechs Monate vor den Ferien‚Äú</a></li>
<li><a href="../de463113/index.html">Daten und Modelle Versionskontrolle im Computer Vision-Meetup</a></li>
<li><a href="../de463115/index.html">Das T√ºrproblem im Shooter-Design</a></li>
<li><a href="../de463117/index.html">Vorladen in PHP 7.4</a></li>
<li><a href="../de463121/index.html">Wir essen den Elefanten in Teilen. Beispiel f√ºr eine Strategie zur √úberwachung des Anwendungszustands</a></li>
<li><a href="../de463125/index.html">OOP in Bildern</a></li>
<li><a href="../de463127/index.html">USV-√úberwachung. Teil Zwei - Analytics automatisieren</a></li>
<li><a href="../de463135/index.html">In welchen L√§ndern ist es rentabel, 2019 IT-Unternehmen zu registrieren?</a></li>
<li><a href="../de463137/index.html">Selbst wenn Sie ein Spieledesigner sein m√∂chten, wird Ihnen niemand beibringen, wie</a></li>
<li><a href="../de463141/index.html">Habr Weekly # 13 / Unter der Bedrohung von 1,5 Millionen Nutzern eines Dating-Dienstes, Medusa-Untersuchung, Dekan der Russen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>