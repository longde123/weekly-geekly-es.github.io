<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ⓜ️ 🕐 🍂 在JavaScript中使用时区 🚏 👣 🧛🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="最近，我正在执行将时区添加到团队维护的JS日历库中的任务。 我很清楚JavaScript中对无用时区的支持，但是我希望抽象现有数据对象将使解决大多数困难变得容易。 

 但是，我的梦想破灭了。 当我深入研究任务时，我意识到用这种语言处理时区确实很困难。 与简单地使用复杂的操作（日历功能）格式化时间显...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在JavaScript中使用时区</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/438286/"><img src="https://habrastorage.org/getpro/habr/post_images/540/5d5/588/5405d55887909032bc8016afe3f65796.jpg"><br><br> 最近，我正在执行将时区添加到团队维护的JS日历库中的任务。 我很清楚JavaScript中对无用时区的支持，但是我希望抽象现有数据对象将使解决大多数困难变得容易。 <br><br> 但是，我的梦想破灭了。 当我深入研究任务时，我意识到用这种语言处理时区确实很困难。 与简单地使用复杂的操作（日历功能）格式化时间显示和计算日期相比，实现更复杂的功能极其困难。 我在解决这个问题上获得了宝贵的经验，这带来了新的困难。 <br><br> 在本文中，我想讨论一下我遇到的问题以及如何解决。 在编写文本时，我意识到所有困难的原因是我对时区主题的理解不足。 鉴于这种认识，我建议首先详细讨论定义和标准，然后再继续使用JavaScript。 <br><a name="habracut"></a><br><h2> 什么是时区？ </h2><br> 时区是使用政府设置的相同本地时间的地理区域。 许多国家/地区完全与任何特定时区相关，在俄罗斯和美国等大州的领土上，使用了多个时区。 奇怪的是，尽管中国也足够大，但它只接受一个时区。 有时，当该国西部地区的日出开始于上午10点左右时，这会导致一些奇怪的情况。 <br><br><h2>  GMT，UTC和偏移 </h2><br><h4> 格林尼治标准时间 </h4><br> 韩国当地时间指定为<code>GMT+09:00</code> 。  GMT代表格林威治标准时间（GMT），即英国格林威治皇家天文台的时钟。 它位于本初子午线上。  GMT系统的无线电信号于1924年2月5日开始广播，并于1972年1月1日成为世界标准。 <br><br><h4> 世界标准时间 </h4><br> 许多人认为GMT和UTC是同一件事，经常将它们用作可互换的系统。 但这是一个错误。  UTC系统出现在1972年，是一种补偿地球自转影响的方法。 该系统基于国际原子时间，该时间由铯原子的电磁振动频率计算得出。 换句话说，UTC是GMT的更准确替代。 尽管两个系统之间的实时差异很小，但对于软件开发人员而言，最好依靠UTC。 <br><br> 一个有趣的事实：当仍在开发UTC时，在英语国家中建议将其称为CUT（世界协调时间），而在法语国家中则建议将其称为TUC（Temps Universal Coordonn）。 但是，所有营地都无法获胜，他们同意将这两个提议的选项（C，T和U）拼写为系统UTC。 <br><br><h4> 偏移量 </h4><br>  <code>UTC+09:00</code> <code>+09:00</code> <code>UTC+09:00</code>表示本地时间比标准UTC时间早9小时。 也就是说，在韩国晚上9点时，是UTC地区的中午。 标准UTC时间与本地时间之间的时差称为“偏移”，表示为正值或负值： <code>+09:00</code> ， <code>-03:00</code>等。 <br><br> 在许多国家/地区，习惯上给您的时区起唯一的名称。 例如，韩国的时区称为KST（韩国标准时间），其偏移量表示为<code>KST = UTC+09:00</code> 。 但是，偏移量<code>+09:00</code>不仅在韩国使用，而且在日本，印度尼西亚和许多其他国家中也使用，因此，偏移量和皮带之间的关系不是表示为1：1，而是表示为1：N。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处</a>提供了<code>+09:00</code>偏移的国家/地区列表。 <br><br> 某些胶印不仅工作数小时。 例如，在朝鲜，标准时间是<code>+08:30</code> ，而在澳大利亚，某些地区使用的是<code>+8:45</code> ， <code>+8:45</code> <code>+09:30</code>和<code>+10:30</code> 。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a>是UTC偏移的完整列表。 <br><br><h2> 时区==偏移量？ </h2><br> 就像我说的，我们使用时区名称（KST，JST），它们的偏移量可以互换使用，而无需区分它们。 但是，考虑同时发生的时间和特定区域的移动将是错误的。 有以下几个原因： <br><br><h4> 夏令时（DST） </h4><br> 在某些国家/地区，这个名词未知，但是在许多州，主要是在欧洲，实行夏令时。 为此，采用国际标准时间DST-夏令时。 这意味着夏天将时钟比标准时间提前一小时。 <br><br> 例如，加利福尼亚在冬季使用PST（太平洋标准时间），在冬季使用PDT（太平洋夏令时间， <code>UTC-07:00</code> ）。 在美国和加拿大，术语太平洋时间（PT，Pacific Time）用于使用两个时区的地区。 <br><br> 夏季时间什么时候开始和结束？ 这一切都取决于国家。 例如，在2006年之前的美国和加拿大，从4月第一个星期日的凌晨2点到10月的最后一个星期日的凌晨12点使用DST。 从2007年开始，夏季时间开始从3月第二个星期日的2个晚上到11月第一个星期日的2个晚上。 在欧洲，不同国家/地区会根据每个时区逐步使用DST。 <br><br><h4> 时区在变化吗？ </h4><br> 每个国家/地区都会确定要使用的时区，因此当地时间可能会因政治和/或经济原因而改变。 例如，在美国，由于乔治·W·布什（George W. Bush）于2005年发起了能源政策，DST的边界在2007年发生了变化。 埃及和俄罗斯曾经改用夏令时，但自2011年起便放弃了。 <br><br> 在某些情况下，政府不仅可以更改夏令时，还可以更改标准时间。 例如，较早的萨摩亚使用偏移量<code>UTC-10:00</code> ，但是后来由于与澳大利亚和新西兰的<code>UTC+14:00</code> ，他们改用<code>UTC+14:00</code>来减少贸易损失。 据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">世界各地的报纸</a>报道，这一决定导致该国全天丧命-2011年12月30日。 <br><br> 在荷兰，自1909年以来一直使用<code>+0:19:32.13</code>的偏移量，自1937年以来该国家将其偏移量设置为<code>+00:20</code> ，而从1940年更改为<code>+01:00</code> ，此后主要时间并未更改。 <br><br><h2> 时区1：N偏移 </h2><br> 因此，时区可以具有一个或多个偏移量。 哪个时间可以作为标准时间，取决于特定国家/地区当前的政治和/或经济原因。 <br><br> 在日常生活中，除非您尝试根据某些规则将这些数据系统化，否则这不会造成任何麻烦。 想象一下，您想使用某种偏差在智能手机上设置标准时间。 如果您居住在实行夏令时的地区，那么您的智能手机应该确切地知道何时来回旅行。 也就是说，您需要在一个时区（例如，太平洋时间）中建立标准时间与夏令时之间的关系。 <br><br> 但这不能通过几个简单的规则来完成。 例如，在2007年美国更改DST的开始和结束时，应该在2006年5月31日使用PDT（ <code>-07:00</code> ）作为标准时间，在2007年3月31日使用PDT（ <code>-08:00</code> ）作为标准时间。 事实证明，要引用特定时区，您需要了解时区更改的全部历史记录或夏令时规则的更改日期。 <br><br> 您可以说：“纽约时区是PST（ <code>-08:00</code> ）。” 但是，需要澄清一下：“纽约的当前时区是PST。” 而且，为了准确地实现系统，您需要使用更准确的表达式。 忘记术语“时区”。 您必须说：“现在在纽约，标准时间是PST。” <br><br> 那么，应该使用什么代替偏移来确定特定区域的时区？ 该区域的名称。 更准确地说，您应该在一个时区中将它们均等转换为夏令时和标准时间的那些地区分组。 您可以使用诸如PT（太平洋时间）之类的名称，但是它们仅结合当前的标准时间和夏令时，而不必考虑所有历史变化。 此外，由于PT仅在美国和加拿大流通，因此您需要依赖信誉良好的组织的既定标准来确保软件的通用性。 <br><br><h2>  IANA时区数据库 </h2><br> 我必须承认，有关时区的信息是数据库，而不是一组规则，因为该信息应包含所有相关的历史变化。 有几个标准数据库设计用于解决与时区有关的任务。 最常用的是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IANA时区数据库</a> ，通常称为tz数据库（或tzdata）。 该数据库包含有关全球标准时间和夏令时变化的历史数据。 此外，它经过组织，以便可以检查所有历史数据并确保从Unix时间（ <code>1970.01/01 00:00:00</code> ）开始的时间是准确的。 尽管您甚至可以在1970年之前在数据库中找到信息，但不能保证其准确性。 <br><br> 命名约定使用区域/位置规则。 大陆或海洋的名称（亚洲，美洲，太平洋）通常用作区域，主要城市的名称（首尔，纽约）用作位置。 原因是城市的寿命通常比国家长。 例如，韩国的时区为<code>Asia/Seoul</code> ，日本为<code>Asia/Tokyo</code> 。 尽管两个国家/地区使用相同的<code>UTC+09:00</code>偏移量，但是它们的本地时间却有所不同，因此将它们划分为不同的时区。 <br><br>  IANA基地由许多开发人员和历史社区组成。 最新发现的历史数据会立即输入其中，并且会更新当前策略，因此，当今的数据库可以被视为最可靠的数据源。 而且，许多Unix系统（包括Linux和MacOS）以及许多流行的编程语言（包括Java和PHP）都在后台使用它。 <br><br> 请注意，Windows使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Microsoft数据库</a> 。 但是，它在历史数据方面是不准确的，并且仅由Microsoft本身支持。 因此，该基础不如IANA基础可靠。 <br><br><h2>  JavaScript和IANA </h2><br> 与时区相关的功能是通过JavaScript突然实现的。 默认情况下，该语言使用当前区域传送带（更准确地说，是在OS安装期间选择的传送带），并且无法更改它。 此外，即使JavaScript中的数据库标准规范也含糊不清，如果您决定处理ES2015规范，您自己会理解这一点。 关于本地时区和夏令时的可用性，只有几句含糊的陈述。 例如，DST定义如下： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ECMAScript 2015-夏令时调整</a> 。 <br><br><blockquote> 这是与实现有关的算法，它使用最佳的可用时区信息来确定DaylightSavingTA（t）本地夏时制设置，以毫秒为单位进行计算。  ECMAScript实现应帮助您更好地确定本地夏令时设置。 </blockquote><br> 看起来他们只是在说：“伙计们，请尝试使其正常工作。” 除其他外，您必须解决与不同浏览器的兼容性问题。 您说：“真是一团糟！”然后阅读以下行： <br><br><blockquote> 注意：我们建议您在实现中使用IANA时区数据库<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http://www.iana.org/time-zones/</a>中的信息。 </blockquote><br> 是的  ECMA规范为您提供了使用IANA数据库的毫不客气的建议，因为JavaScript没有特殊的标准数据库。 结果，不同的浏览器使用它们自己的时区操作来计算时间，这些时区通常彼此不兼容。 后来，在ECMA中，对于国际API，添加了使用ECMA-402 <code>Intl.DateTimeFormat</code>格式的IANA数据的选项。 但是，此选项的可靠性远不如其他编程语言中的类似选项可靠。 <br><br><h2> 服务器-客户端环境中的时区 </h2><br> 考虑一个简单的场景：我们需要确定时区。 假设我们创建了一个处理时间信息的日历。 当客户端环境中的用户在注册窗口中输入日期和时间时，该日期将传输到服务器并存储在数据库中。 然后，客户端从服务器接收时间表中注册的日期，以显示在屏幕上。 <br><br> 在这里，您需要决定一些事情。 如果某些访问服务器的客户端位于不同的时区怎么办？ 日程安排中的活动已于2017年3月10日在纽约的23.30处注册，应在2017年3月10日的9.30处显示。 为了使服务器能够为来自不同时区的客户端提供服务，存储在其上的日程表必须包含不依赖于时区的绝对值。 每个服务器都有自己的存储此类值的方法，这个问题超出了本文的范围，因为一切都取决于特定的服务器或数据库。 通常，应以基于单个偏移量的值形式（通常为UTC）或包含有关客户端环境时区信息的值形式来显示从客户端传输到服务器的日期和时间。 <br><br> 通常，此类数据以UTC格式或符合<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ISO-8601</a>标准的带偏移信息的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Unix时间</a>传输。 如果在我们的示例中，我们将2017年3月10日的Seoul 21.30转换为Unix时间，那么我们将获得整数值<code>1489113000</code> 。 并且以ISO-8601格式，字符串值是<code>2017–03–10T11:30:00+09:00</code> 。 <br><br> 如果您在浏览器环境中使用JavaScript，则必须如上所述转换输入的值，然后将其转换回以匹配用户的时区。 有必要解决这两个问题。 从编程语言的角度来看，第一个操作称为“解析”，第二个操作称为“格式化”。 现在，让我们看看这是如何在JavaScript中完成的。 <br><br> 即使在使用Node.js的服务器环境中使用JS时，也可能需要解析从客户端接收的数据。 但是，由于服务器和数据库的时区通常是同步的，并且格式已分配给客户端，因此在浏览器环境中，您需要确定几个因素。 我将进一步解释浏览器环境。 <br><br><h2>  JavaScript日期对象 </h2><br> 使用<code>Date</code>对象可以解决涉及给定时间或指定时间工作的任务。 这是ECMAScript中定义的本机对象，例如<code>Array</code>或<code>Function</code> 。 也就是说，在大多数情况下，它是使用C ++之类的本机代码实现的。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MDN文档</a>中对API进行了详细<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">说明</a> 。  Java的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">java.util.Date</a>类对该对象有很大的影响，因此它继承了一些不良的属性，例如可变数据的特征以及从零开始的月份。 <br><br> 在后台，JavaScript <code>Date</code>对象使用Unix-time格式的绝对值与时间一起使用。 但是诸如<code>parse()</code> ， <code>getHour()</code> ， <code>setHour()</code>类的构造函数和方法和其他方法会受客户端所在时区（更确切地说，是运行浏览器的OS中指定的区域）的影响。 因此，如果您直接使用用户输入的数据创建<code>Date</code>对象，则客户的本地时区将反映在该数据中。 <br><br> 正如我提到的，JavaScript没有提供任何方式来随意更改时区。 因此，我们假设我们可以直接使用浏览器中指定的时区值。 <br><br><h2> 使用用户输入创建日期对象 </h2><br> 让我们回到第一个例子。 假设用户于2017年3月11日在其设备上的首尔时间输入11.30。此数据被保存为五个数字：2017、2、11、11和30-分别为年，月，日，小时和分钟（因为月从0开始，因此该值应为3-1 = 2）。 使用构造函数，您可以轻松创建<code>Date</code>对象： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); d1.toString(); <span class="hljs-comment"><span class="hljs-comment">// Sat Mar 11 2017 11:30:00 GMT+0900 (KST)</span></span></code> </pre> <br> 如果查看<code>d1.toString()</code>返回的值，您会看到创建的对象的绝对值在2017年3月11日为11:00，它是使用<code>+09:00</code> （KST）混合计算的。 <br><br> 您可以在构造函数中使用字符串数据。 如果将它们应用于<code>Date</code> ，则对象在内部调用<code>Date.parse()</code>并<code>Date.parse()</code>正确的值。 此功能支持<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC2888</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ISO-8601</a>规范。 但是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MDN文档Date.parse（）</a>表示，此方法返回的值取决于浏览器，并且字符串类型的格式可能会影响确切的最终值。 因此，最好不要使用此方法。 例如，在Safari和Internet Explorer中，像<code>2015–10–12 12:00:00</code>这样的字符串值将返回<code>NaN</code> ，而在Chrome和Firefox中，它将返回本地时区。 在某些情况下，将返回基于UTC的值。 <br><br><h2> 使用服务器数据创建日期对象 </h2><br> 假设您要从服务器接收数据。 如果它们采用数字Unix时间形式，那么您可以简单地使用构造函数来创建<code>Date</code>对象。 我还没有提到，当<code>Date</code>构造函数将单个值作为单个参数接收时，它将以毫秒为单位计算Unix时间值（注意：JS以毫秒为单位计算Unix时间。这意味着第二个值必须乘以1000）。 当执行以下代码时，我们得到与上一个示例相同的值： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>); d1.toString(); <span class="hljs-comment"><span class="hljs-comment">// Sat Mar 11 2017 11:30:00 GMT+0900 (KST)</span></span></code> </pre> <br> 并且如果不是使用Unix-time而是使用字符串类型ISO-8601？ 如前所述， <code>Date.parse()</code>方法变得不可靠，最好不要使用它。 但是，从ECMAScript 5开始，可以在Internet Explorer 9.0和更高版本的<code>Date</code>构造函数中使用ISO-8601格式的字符串构造。 <br><br> 如果您使用的不是最新的浏览器，请确保<code>Z</code>位于值的末尾。 没有它，您的旧浏览器可以根据本地时间而不是UTC来解释值。 这是Internet Explorer 10中的示例用法： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-string"><span class="hljs-string">'2017-03-11T11:30:00'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-string"><span class="hljs-string">'2017-03-11T11:30:00Z'</span></span>); d1.toString(); <span class="hljs-comment"><span class="hljs-comment">// "Sat Mar 11 11:30:00 UTC+0900 2017" d2.toString(); // "Sat Mar 11 20:30:00 UTC+0900 2017"</span></span></code> </pre> <br> 根据规范，在两种情况下均应获得相同的值。 但是它们是不同的。 在更高版本的浏览器中，值将相同。 为避免此问题，如果没有时区信息，请始终在行末添加<code>Z</code> <br><br><h2> 创建要传递给服务器的日期 </h2><br> 现在，您可以使用先前创建的<code>Date</code> ，根据本地时区自由检索或添加时间。 仅在处理结束时，别忘了在将数据返回服务器之前将其转换为以前的格式。 <br><br> 如果这是Unix时间，则可以使用<code>getTime()</code>方法（不要忘记毫秒）。 <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); d1.getTime(); <span class="hljs-comment"><span class="hljs-comment">// 1489199400000</span></span></code> </pre> <br> 那么ISO-8601格式的字符串值呢？ 正如我所说，Internet Explorer 9.0及更高版本支持ECMAScript 5，而更高版本则支持ISO-8601。 因此，使用<code>toISOString()</code>或<code>toJSON()</code>方法，可以在ISO-8601中创建一个字符串（ <code>toJSON()</code>可用于<code>JSON.stringify()</code>等递归调用）。 除了处理无效数据时，这两种方法给出的结果相同： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> d1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">2017</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); d1.toISOString(); <span class="hljs-comment"><span class="hljs-comment">// "2017-03-11T02:30:00.000Z" d1.toJSON(); // "2017-03-11T02:30:00.000Z" const d2 = new Date('Hello'); d2.toISOString(); // Error: Invalid Date d2.toJSON(); // null</span></span></code> </pre> <br> 您可以使用<code>toGMTString()</code>或<code>toUTCString()</code>方法创建UTC字符串。 这将导致一个符合<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC-1123的值</a> 。 <br><br>  <code>Date</code>对象包括<code>toString()</code> ， <code>toLocaleString()</code>及其扩展方法。 但是它们没什么用，因为它们主要用于根据本地时区返回字符串，并且返回的值取决于浏览器和OS。 <br><br><h2> 更改您的当地时区 </h2><br> 如您所见，JS中提供了某种时区支持。              ?           ?      , JS       .         ,         .   .  ,   . <br><br>      .       .     11.30 11  2017       - .     Unix-    ,  -   <code>-05:00</code> .    ,       . <br><br>       <code>getTimeZoneOffset()</code> .   API  JavaScript,        .        : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seoul = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>); seoul.getTimeZoneOffset(); <span class="hljs-comment"><span class="hljs-comment">// -540</span></span></code> </pre> <br>  <code>-540</code> ,     540   .    ,      ( <code>+09:00</code> ).  , ,    .          -,   <code>60 * 5 = 300</code> .   <code>840</code>       <code>Date</code> .     <code>getXX</code>       .       : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatDate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">date</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> date.getFullYear() + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + (date.getMonth() + <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + date.getDate() + <span class="hljs-string"><span class="hljs-string">' '</span></span> + date.getHours() + <span class="hljs-string"><span class="hljs-string">':'</span></span> + date.getMinutes(); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seoul = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ny = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span> - (<span class="hljs-number"><span class="hljs-number">840</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>)); formatDate(seoul); <span class="hljs-comment"><span class="hljs-comment">// 2017/3/11 11:30 formatDate(ny); // 2017/3/10 21:30</span></span></code> </pre> <br> <code>formatDate()</code>              -. ,    .        ,      ?  , .   ,      —   ,     .                ( ). <br><br><h2>      </h2><br>       ,     . ,       -,      11  15 .    <code>setDate()</code>   <code>Date</code> ,    ,    . <br><br><pre> <code class="javascript hljs">ny.setDate(<span class="hljs-number"><span class="hljs-number">15</span></span>); formatDate(ny); <span class="hljs-comment"><span class="hljs-comment">// 2017/3/15 21:30</span></span></code> </pre> <br>  ,    .  ,      ?   ,       <code>getTime()</code>  <code>getISOString()</code> .     ,      . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> time = ny.getTime() + (<span class="hljs-number"><span class="hljs-number">840</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1489631400000</span></span></code> </pre> <br>   ,      ,         .             <code>Date</code>   ? 不行    <code>Date</code>        11-  15-,   4  ( <code>24 * 4 * 60 * 60 * 1000</code> ).      -     10-  15-,    5  ( <code>24* 5 * 60 * 60 * 1000</code> ).             . <br><br>     .     ,     .   -     12 ,   15  2017  <code>-04:00</code> ,   <code>-05:00</code> .      ,    780 ,   60  ,   . <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> time = ny.getTime() + (<span class="hljs-number"><span class="hljs-number">780</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span> * <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1489627800000</span></span></code> </pre> <br>   ,        -      ,         . <br><br>  ,                .    ,    ,   ,       .       ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="> IANA</a> . <br><br>         ,         <code>Date</code>      ,        .  ,   .         ,        .    .        JS    .     . <br><br><h2> Moment Timezone </h2><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Moment</a> —  JavaScript-,   .    API     ,        .       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Moment Timezone</a> ,     .     IANA        API,         . <br><br>           .  ,         .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . <br><br> ,  Moment Timezone: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> seoul = moment(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>).tz(<span class="hljs-string"><span class="hljs-string">'Asia/Seoul'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ny = moment(<span class="hljs-number"><span class="hljs-number">1489199400000</span></span>).tz(<span class="hljs-string"><span class="hljs-string">'America/New_York'</span></span>); seoul.format(); <span class="hljs-comment"><span class="hljs-comment">// 2017-03-11T11:30:00+09:00 ny.format(); // 2017-03-10T21:30:00-05:00 seoul.date(15).format(); // 2017-03-15T11:30:00+09:00 ny.date(15).format(); // 2017-03-15T21:30:00-04:00</span></span></code> </pre> <br>  <code>seoul</code>  ,   <code>ny</code>   <code>-05:00</code>  <code>-04:00</code> .     <code>format()</code> ,      ISO-8601,     .       . <br><br><h2> 结论 </h2><br>   API  ,   JavaScript,     .          ,         API,   Internet Explorer 9  .     ,     .                  ,     <code>getTimezoneOffset()</code> .        ,     .     Moment Timezone. <br><br>     ,   ,   .      :  .   ,    ,    ,   .      ,      JavaScript    .   ,      . <br><br><h2>   </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Pluralsight: Date and Time Fundamentals</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wikipedia: timezone</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wikipedia: DST</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wikipedia: Unix Time</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Wikipedia: ISO-8601</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">IANA timezone Database</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Microsoft Daylight Saving Time &amp; Time Zone Blog</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">MDN: Date API</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">java.util.Date API</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Moment Timezone</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC-1123</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RFC2888</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438286/">https://habr.com/ru/post/zh-CN438286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438270/index.html">在Mail.ru组爱Kubernetes：2月14日</a></li>
<li><a href="../zh-CN438272/index.html">我们如何从山洞发送短信</a></li>
<li><a href="../zh-CN438274/index.html">IT中“有毒人格”的定义</a></li>
<li><a href="../zh-CN438278/index.html">教孩子编程</a></li>
<li><a href="../zh-CN438280/index.html">在Django中“删除”对象</a></li>
<li><a href="../zh-CN438288/index.html">无所畏惧的保护。 Rust的内存安全性</a></li>
<li><a href="../zh-CN438290/index.html">GGJ-2019的事后分析：如何获得成功，但仍能使游戏成为现实</a></li>
<li><a href="../zh-CN438292/index.html">使用HomePod，Raspberry Pi和Node.js的公寓自动化</a></li>
<li><a href="../zh-CN438294/index.html">在PUBG比赛中查找抽搐彩带</a></li>
<li><a href="../zh-CN438296/index.html">OpenSceneGraph：插件系统</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>