<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óæÔ∏è ‚ùé ü§∏üèΩ R√©plication crois√©e entre PostgreSQL et MySQL üî≥ üöÑ üë©üèΩ‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je d√©crirai la r√©plication crois√©e entre PostgreSQL et MySQL, ainsi que les m√©thodes de configuration de la r√©plication crois√©e entre ces deux serveur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©plication crois√©e entre PostgreSQL et MySQL</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/467313/"><p><img src="https://habrastorage.org/webt/ze/m9/h6/zem9h6cpvow7junwu4saxpddvpa.jpeg"></p><br><p>  Je d√©crirai la r√©plication crois√©e entre PostgreSQL et MySQL, ainsi que les m√©thodes de configuration de la r√©plication crois√©e entre ces deux serveurs de base de donn√©es.  En r√®gle g√©n√©rale, les bases de donn√©es de r√©plication crois√©e sont appel√©es homog√®nes, et il s'agit d'une m√©thode pratique pour passer d'un serveur de bases de donn√©es relationnelles √† un autre. </p><br><p>  Les bases de donn√©es PostgreSQL et MySQL sont consid√©r√©es comme relationnelles, mais avec des extensions suppl√©mentaires, elles offrent des fonctionnalit√©s NoSQL.  Ici, nous allons discuter de la r√©plication entre PostgreSQL et MySQL, en termes de SGBD relationnel. </p><br><p>  Nous ne d√©crirons pas toute la cuisine int√©rieure, seulement les principes de base, afin que vous ayez une id√©e de la fa√ßon de configurer la r√©plication entre les serveurs de base de donn√©es, les avantages, les limitations et les sc√©narios d'utilisation. </p><a name="habracut"></a><br><p>  En r√®gle g√©n√©rale, la r√©plication entre deux serveurs de base de donn√©es identiques est effectu√©e soit en mode binaire, soit par le biais de requ√™tes entre le n≈ìud ma√Ætre (c'est l'√©diteur, ma√Ætre ou actif) et l'esclave (abonn√©, en attente ou passif).  Le but de la r√©plication est de fournir une copie en temps r√©el de la base de donn√©es ma√Ætre c√¥t√© esclave.  Dans ce cas, les donn√©es sont transf√©r√©es du ma√Ætre √† l'esclave, c'est-√†-dire de l'actif au passif, car la r√©plication n'est effectu√©e que dans un sens.  Mais vous pouvez configurer la r√©plication entre deux bases de donn√©es dans les deux sens, de sorte que les donn√©es soient transf√©r√©es de l'esclave au ma√Ætre dans la configuration active-active.  Tout cela, y compris la r√©plication en cascade, √©ventuellement entre deux serveurs de base de donn√©es identiques ou plus. La configuration active-active ou active-passive d√©pend du besoin, de la disponibilit√© de ces fonctionnalit√©s dans la configuration initiale ou de l'utilisation de solutions de configuration externes et de compromis existants. . </p><br><p> La configuration d√©crite est possible entre diff√©rents serveurs de base de donn√©es.  Le serveur peut √™tre configur√© pour recevoir des donn√©es r√©pliqu√©es d'un autre serveur de base de donn√©es et toujours enregistrer des instantan√©s en temps r√©el des donn√©es r√©pliqu√©es.  MySQL et PostgreSQL proposent la plupart de ces configurations seules ou avec des extensions tierces, y compris des m√©thodes de journal binaire, des verrous de disque et des m√©thodes bas√©es sur des instructions et des cha√Ænes. </p><br><p>  La r√©plication crois√©e entre MySQL et PostgreSQL est n√©cessaire pour une migration unique d'un serveur de base de donn√©es √† un autre.  Ces bases de donn√©es utilisent des protocoles diff√©rents, elles ne peuvent donc pas √™tre connect√©es directement.  Pour √©tablir l'√©change de donn√©es, vous pouvez utiliser un outil open source externe, par exemple pg_chameleon. </p><br><h3 id="chto-takoe-pg_chameleon">  Qu'est-ce que pg_chameleon </h3><br><p>  pg_chameleon est un syst√®me de r√©plication de MySQL vers PostgreSQL en Python 3. Il utilise la biblioth√®que open source mysql-replication, √©galement en Python.  Les images de cha√Æne sont extraites des tables MySQL et stock√©es en tant qu'objets JSONB dans la base de donn√©es PostgreSQL, puis d√©chiffr√©es par la fonction pl / pgsql et lues dans la base de donn√©es PostgreSQL. </p><br><h3 id="vozmozhnosti-pg_chameleon">  Fonctionnalit√©s de Pg_chameleon </h3><br><p>  Plusieurs sch√©mas MySQL du m√™me cluster peuvent √™tre r√©pliqu√©s vers la m√™me base de donn√©es cible PostgreSQL avec une configuration un-√†-plusieurs <br>  Les noms des sch√©mas source et cible ne peuvent pas correspondre. <br>  Les donn√©es de r√©plication peuvent √™tre r√©cup√©r√©es √† partir d'une r√©plique MySQL en cascade. <br>  Les tables qui ne peuvent pas se r√©pliquer ou g√©n√©rer des erreurs sont exclues. <br>  Chaque fonction de r√©plication est contr√¥l√©e par des d√©mons. <br>  Contr√¥le √† l'aide de param√®tres et de fichiers de configuration bas√©s sur YAML. </p><br><h3 id="primer">  Exemple </h3><br><div class="scrollable-table"><table><thead><tr><th>  H√¥te </th><th>  vm1 </th><th>  vm2 </th></tr></thead><tbody><tr><td>  <strong>Version du syst√®me d'exploitation</strong> </td><td>  CentOS Linux 7.6 x86_64 </td><td>  CentOS Linux 7.5 x86_64 </td></tr><tr><td>  <strong>Version du serveur DB</strong> </td><td>  MySQL 5.7.26 </td><td>  PostgreSQL 10.5 </td></tr><tr><td>  <strong>Port DB</strong> </td><td>  3306 </td><td>  5433 </td></tr><tr><td>  <strong>Adresse IP</strong> </td><td>  192.168.56.102 </td><td>  192.168.56.106 </td></tr></tbody></table></div><br><p>  Pour commencer, pr√©parez tous les composants n√©cessaires √† l'installation de pg_chameleon.  Dans cet exemple, Python 3.6.8 est install√©, ce qui cr√©e un environnement virtuel et l'active. </p><br><pre><code class="plaintext hljs">$&gt; wget https://www.python.org/ftp/python/3.6.8/Python-3.6.8.tar.xz $&gt; tar -xJf Python-3.6.8.tar.xz $&gt; cd Python-3.6.8 $&gt; ./configure --enable-optimizations $&gt; make altinstall</code> </pre> <br><p>  Apr√®s avoir correctement install√© Python3.6, vous devez remplir les autres conditions requises, par exemple, cr√©er et activer un environnement virtuel.  De plus, le module pip est mis √† jour vers la derni√®re version et est utilis√© pour installer pg_chameleon.  Dans les commandes ci-dessous, pg_chameleon 2.0.9 est intentionnellement install√©, bien que la derni√®re version soit 2.0.10.  Ceci est n√©cessaire pour √©viter de nouveaux bogues dans la version mise √† jour. </p><br><pre> <code class="plaintext hljs">$&gt; python3.6 -m venv venv $&gt; source venv/bin/activate (venv) $&gt; pip install pip --upgrade (venv) $&gt; pip install pg_chameleon==2.0.9</code> </pre> <br><p>  Ensuite, nous appelons pg_chameleon (cam√©l√©on est une commande) avec l'argument set_configuration_files pour activer pg_chameleon et cr√©er des r√©pertoires et des fichiers de configuration par d√©faut. </p><br><pre> <code class="plaintext hljs">(venv) $&gt; chameleon set_configuration_files creating directory /root/.pg_chameleon creating directory /root/.pg_chameleon/configuration/ creating directory /root/.pg_chameleon/logs/ creating directory /root/.pg_chameleon/pid/ copying configuration example in /root/.pg_chameleon/configuration//config-example.yml</code> </pre> <br><p>  Nous cr√©ons maintenant une copie de config-example.yml en tant que default.yml afin qu'il devienne le fichier de configuration par d√©faut.  Un exemple de fichier de configuration pour cet exemple est pr√©sent√© ci-dessous. </p><br><pre> <code class="plaintext hljs">$&gt; cat default.yml --- #global settings pid_dir: '~/.pg_chameleon/pid/' log_dir: '~/.pg_chameleon/logs/' log_dest: file log_level: info log_days_keep: 10 rollbar_key: '' rollbar_env: '' # type_override allows the user to override the default type conversion into a different one. type_override: "tinyint(1)": override_to: boolean override_tables: - "*" #postgres destination connection pg_conn: host: "192.168.56.106" port: "5433" user: "usr_replica" password: "pass123" database: "db_replica" charset: "utf8" sources: mysql: db_conn: host: "192.168.56.102" port: "3306" user: "usr_replica" password: "pass123" charset: 'utf8' connect_timeout: 10 schema_mappings: world_x: pgworld_x limit_tables: # - delphis_mediterranea.foo skip_tables: # - delphis_mediterranea.bar grant_select_to: - usr_readonly lock_timeout: "120s" my_server_id: 100 replica_batch_size: 10000 replay_max_rows: 10000 batch_retention: '1 day' copy_max_memory: "300M" copy_mode: 'file' out_dir: /tmp sleep_loop: 1 on_error_replay: continue on_error_read: continue auto_maintenance: "disabled" gtid_enable: No type: mysql skip_events: insert: - delphis_mediterranea.foo #skips inserts on the table delphis_mediterranea.foo delete: - delphis_mediterranea #skips deletes on schema delphis_mediterranea update:</code> </pre> <br><p>  Le fichier de configuration dans cet exemple est un exemple de fichier avec pg_chameleon avec des modifications mineures en fonction des environnements source et cible, et ce qui suit est un aper√ßu des diff√©rentes sections du fichier de configuration. </p><br><p>  Dans le fichier de configuration default.yml, il y a une section de param√®tres globaux o√π vous pouvez contr√¥ler des param√®tres tels que l'emplacement du fichier de verrouillage, l'emplacement des journaux, la p√©riode de stockage des journaux, etc. La section suivante est la section de remplacement de type, o√π l'ensemble est sp√©cifi√© r√®gles pour remplacer les types lors de la r√©plication.  L'exemple par d√©faut utilise une r√®gle de red√©finition de type qui convertit tinyint (1) en valeur bool√©enne.  Dans la section suivante, nous indiquons les d√©tails de la connexion √† la base de donn√©es cible.  Dans notre cas, il s'agit d'une base de donn√©es PostgreSQL d√©sign√©e comme pg_conn.  Dans la derni√®re section, nous indiquons les donn√©es source, c'est-√†-dire les param√®tres de connexion de la base de donn√©es source, le sch√©ma de mappage des bases de donn√©es source et cible, les tables √† ignorer, le d√©lai d'expiration, la m√©moire et la taille du paquet.  Notez que ¬´sources¬ª est indiqu√© au pluriel, c'est-√†-dire que nous pouvons ajouter plusieurs bases de donn√©es source pour la m√™me cible pour configurer la configuration plusieurs-√†-un. </p><br><p>  La base de donn√©es world_x de l'exemple contient 4 tables avec des lignes que la communaut√© MySQL propose pour l'exemple.  Il peut √™tre t√©l√©charg√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  La base de donn√©es exemple se pr√©sente sous la forme de tar et d'une archive compress√©e avec des instructions pour cr√©er et importer des cha√Ænes. </p><br><p>  Un utilisateur sp√©cial est cr√©√© dans les bases de donn√©es MySQL et PostgreSQL avec le m√™me nom usr_replica.  Dans MySQL, il dispose de droits suppl√©mentaires pour lire toutes les tables r√©pliqu√©es. </p><br><pre> <code class="plaintext hljs">mysql&gt; CREATE USER usr_replica ; mysql&gt; SET PASSWORD FOR usr_replica='pass123'; mysql&gt; GRANT ALL ON world_x.* TO 'usr_replica'; mysql&gt; GRANT RELOAD ON *.* to 'usr_replica'; mysql&gt; GRANT REPLICATION CLIENT ON *.* to 'usr_replica'; mysql&gt; GRANT REPLICATION SLAVE ON *.* to 'usr_replica'; mysql&gt; FLUSH PRIVILEGES;</code> </pre> <br><p>  C√¥t√© PostgreSQL, la base de donn√©es db_replica est cr√©√©e, qui acceptera les modifications de la base de donn√©es MySQL.  L'utilisateur usr_replica de PostgreSQL est automatiquement configur√© en tant que propri√©taire de deux sch√©mas pgworld_x et sch_chameleon qui contiennent des tables r√©pliqu√©es r√©elles et des tables avec des r√©pertoires de r√©plication respectivement.  L'argument create_replica_schema est responsable de la configuration automatique, comme vous le verrez ci-dessous. </p><br><pre> <code class="plaintext hljs">postgres=# CREATE USER usr_replica WITH PASSWORD 'pass123'; CREATE ROLE postgres=# CREATE DATABASE db_replica WITH OWNER usr_replica; CREATE DATABASE</code> </pre> <br><p>  La base de donn√©es MySQL est configur√©e avec quelques modifications pour la pr√©parer √† la r√©plication, comme indiqu√© ci-dessous.  Vous devrez red√©marrer le serveur de base de donn√©es pour que les modifications prennent effet. </p><br><pre> <code class="plaintext hljs">$&gt; vi /etc/my.cnf binlog_format= ROW binlog_row_image=FULL log-bin = mysql-bin server-id = 1</code> </pre> <br><p>  Maintenant, il est important de v√©rifier la connexion aux deux serveurs de base de donn√©es afin qu'il n'y ait aucun probl√®me lors de l'ex√©cution des commandes pg_chameleon. </p><br><p>  Sur le n≈ìud PostgreSQL: </p><br><pre> <code class="plaintext hljs">$&gt; mysql -u usr_replica -Ap'admin123' -h 192.168.56.102 -D world_x</code> </pre> <br><p>  Sur le n≈ìud MySQL: </p><br><pre> <code class="plaintext hljs">$&gt; psql -p 5433 -U usr_replica -h 192.168.56.106 db_replica</code> </pre> <br><p>  Les trois commandes pg_chameleon (cam√©l√©on) suivantes pr√©parent l'environnement, ajoutent la source et initialisent la r√©plique.  L'argument create_replica_schema dans pg_chameleon cr√©e le sch√©ma par d√©faut (sch_chameleon) et le sch√©ma de r√©plication (pgworld_x) dans la base de donn√©es PostgreSQL, comme nous l'avons d√©j√† dit.  L'argument add_source ajoute la base de donn√©es d'origine √† la configuration en lisant le fichier de configuration (default.yml), et dans notre cas c'est mysql, et init_replica initialise la configuration en fonction des param√®tres du fichier de configuration. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon create_replica_schema --debug $&gt; chameleon add_source --config default --source mysql --debug $&gt; chameleon init_replica --config default --source mysql --debug</code> </pre> <br><p>  La sortie de ces trois commandes indique √©videmment leur ex√©cution r√©ussie.  Tous les plantages ou erreurs de syntaxe sont indiqu√©s dans des messages simples et clairs avec des conseils de d√©pannage. </p><br><p>  Enfin, d√©marrez la r√©plication avec start_replica et obtenez un message de r√©ussite. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon start_replica --config default --source mysql output: Starting the replica process for source mysql</code> </pre> <br><p>  L'√©tat de la r√©plication peut √™tre demand√© √† l'aide de l'argument show_status et les erreurs peuvent √™tre affich√©es √† l'aide de l'argument show_errors. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©sultat.</a> </p><br><p>  Comme nous l'avons dit pr√©c√©demment, chaque fonction de r√©plication est contr√¥l√©e par des d√©mons.  Pour les visualiser, nous interrogeons la table de processus avec la commande Linux ps, comme indiqu√© ci-dessous. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©sultat.</a> </p><br><p>  La r√©plication n'est pas consid√©r√©e comme configur√©e tant que nous ne l'avons pas test√©e en temps r√©el, comme illustr√© ci-dessous.  Nous cr√©ons une table, ins√©rons quelques enregistrements dans la base de donn√©es MySQL et appelons l'argument sync_tables dans pg_chameleon pour mettre √† jour les d√©mons et r√©pliquer la table avec les enregistrements dans la base de donn√©es PostgreSQL. </p><br><pre> <code class="plaintext hljs">mysql&gt; create table t1 (n1 int primary key, n2 varchar(10)); Query OK, 0 rows affected (0.01 sec) mysql&gt; insert into t1 values (1,'one'); Query OK, 1 row affected (0.00 sec) mysql&gt; insert into t1 values (2,'two'); Query OK, 1 row affected (0.00 sec)</code> </pre> <br><pre> <code class="plaintext hljs">$&gt; chameleon sync_tables --tables world_x.t1 --config default --source mysql Sync tables process for source mysql started.</code> </pre> <br><p>  Pour confirmer les r√©sultats du test, nous interrogeons la table √† partir de la base de donn√©es PostgreSQL et affichons les lignes. </p><br><pre> <code class="plaintext hljs">$&gt; psql -p 5433 -U usr_replica -d db_replica -c "select * from pgworld_x.t1"; n1 | n2 ----+------- 1 | one 2 | two</code> </pre> <br><p>  Si nous effectuons la migration, les commandes pg_chameleon suivantes seront sa fin.  Les commandes doivent √™tre ex√©cut√©es apr√®s avoir v√©rifi√© que les lignes de toutes les tables cibles ont √©t√© r√©pliqu√©es, et le r√©sultat sera une base de donn√©es PostgreSQL soigneusement migr√©e sans r√©f√©rence √† la base de donn√©es ou au sch√©ma de r√©plication d'origine (sch_chameleon). </p><br><pre> <code class="plaintext hljs">$&gt; chameleon stop_replica --config default --source mysql $&gt; chameleon detach_replica --config default --source mysql --debug</code> </pre> <br><p>  Si vous le souhaitez, les commandes suivantes peuvent supprimer le sch√©ma de configuration et de r√©plication d'origine. </p><br><pre> <code class="plaintext hljs">$&gt; chameleon drop_source --config default --source mysql --debug $&gt; chameleon drop_replica_schema --config default --source mysql --debug</code> </pre> <br><h3 id="preimuschestva-pg_chameleon">  Avantages de pg_chameleon </h3><br><p>  Installation et configuration faciles. <br>  D√©pannage et d√©tection d'anomalies pratiques avec des messages d'erreur clairs. <br>  Vous pouvez ajouter des tables sp√©ciales suppl√©mentaires √† la r√©plication apr√®s l'initialisation sans modifier le reste de la configuration. <br>  Vous pouvez configurer plusieurs bases de donn√©es source pour une cible, ce qui est tr√®s pratique si vous combinez des donn√©es d'une ou plusieurs bases de donn√©es MySQL dans une base de donn√©es PostgreSQL. <br>  Vous ne pouvez pas r√©pliquer les tables s√©lectionn√©es. </p><br><h3 id="nedostatki-pg_chameleon">  Inconv√©nients de pg_chameleon </h3><br><p>  Pris en charge uniquement avec MySQL 5.5 et sup√©rieur comme source et PostgreSQL 9.5 et sup√©rieur comme base de donn√©es cible. <br>  Chaque table doit avoir une cl√© primaire ou unique, sinon les tables sont initialis√©es dans le processus init_replica, mais pas r√©pliqu√©es. <br>  R√©plication unidirectionnelle - uniquement de MySQL vers PostgreSQL.  Par cons√©quent, il ne convient que pour le sch√©ma actif-passif. <br>  Seule la base de donn√©es MySQL peut √™tre la source, et la prise en charge de la base de donn√©es PostgreSQL car la source est uniquement exp√©rimentale et avec des limitations (en savoir plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ) </p><br><h3 id="itogi-po-pg_chameleon">  R√©sultats Pg_chameleon </h3><br><p>  La m√©thode de r√©plication dans pg_chameleon est id√©ale pour migrer une base de donn√©es de MySQL vers PostgreSQL.  Un inconv√©nient majeur est que la r√©plication n'est qu'√† sens unique, il est donc peu probable que les experts en bases de donn√©es veuillent l'utiliser pour autre chose que la migration.  Mais le probl√®me de la r√©plication unidirectionnelle peut √™tre r√©solu par un autre outil open source - SymmetricDS. </p><br><p>  En savoir plus dans la documentation officielle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Vous trouverez de l'aide sur la ligne de commande <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://pgchameleon.org/documents/usage.html&amp;usg=ALkJrhhiEXG0GKpBR1DfJpxD1GJRHlszug#">ici</a> . </p><br><h3 id="obzor-symmetricds">  Pr√©sentation de SymmetricDS </h3><br><p>  SymmetricDS est un outil open source qui r√©plique n'importe quelle base de donn√©es vers n'importe quelle autre base de donn√©es commune: Oracle, MongoDB, PostgreSQL, MySQL, SQL Server, MariaDB, DB2, Sybase, Greenplum, Informix, H2, Firebird et d'autres instances de base de donn√©es cloud, par exemple Redshift et Azure, etc. Fonctions disponibles: synchronisation des bases de donn√©es et des fichiers, r√©plication de plusieurs bases de donn√©es de premier plan, synchronisation filtr√©e, conversion et autres.  Il s'agit d'un outil Java et n√©cessite une version standard de JRE ou JDK (version 8.0 ou sup√©rieure).  Ici, vous pouvez enregistrer les modifications de donn√©es sur les d√©clencheurs dans la base de donn√©es source et les envoyer √† la base de donn√©es cible correspondante sous forme de paquets. </p><br><h3 id="vozmozhnosti-symmetricds">  Fonctionnalit√©s de SymmetricDS </h3><br><p>  L'outil est ind√©pendant de la plate-forme, c'est-√†-dire que deux bases de donn√©es diff√©rentes ou plus peuvent √©changer des donn√©es. <br>  Les bases de donn√©es relationnelles sont synchronis√©es en √©crivant les modifications de donn√©es et les bases de donn√©es bas√©es sur le syst√®me de fichiers utilisent la synchronisation des fichiers. <br>  R√©plication bidirectionnelle √† l'aide des m√©thodes Push et Pull bas√©es sur un ensemble de r√®gles. <br>  La transmission de donn√©es est possible sur des r√©seaux s√©curis√©s et des r√©seaux √† faible bande passante. <br>  R√©cup√©ration automatique lorsque les n≈ìuds reprennent apr√®s une panne et r√©solution automatique des conflits. <br>  API d'extension compatibles et puissantes dans le cloud. </p><br><h3 id="primer-1">  Exemple </h3><br><p>  SymmetricDS peut √™tre configur√© de deux mani√®res: <br>  Un n≈ìud ma√Ætre (parent) qui coordonne de mani√®re centrale la r√©plication des donn√©es entre deux n≈ìuds esclaves (enfants) et l'√©change de donn√©es entre les n≈ìuds enfants est effectu√© uniquement via le parent. <br>  Le n≈ìud actif (n≈ìud 1) peut √©changer des donn√©es pour la r√©plication avec un autre n≈ìud actif (n≈ìud 2) sans interm√©diaire. </p><br><p>  Dans les deux cas, les donn√©es sont √©chang√©es via Push and Pull.  Dans cet exemple, nous allons examiner la configuration active-active.  D√©crivez l'architecture enti√®re trop longtemps, alors consultez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide</a> pour en savoir plus sur SymmetricDS. </p><br><p>  L'installation de SymmetricDS est tr√®s simple: t√©l√©chargez ici la version open source du fichier zip et extrayez-la o√π vous voulez.  Le tableau ci-dessous fournit des informations sur l'emplacement d'installation et la version de SymmetricDS dans cet exemple, ainsi que les versions de base de donn√©es, les versions Linux, les adresses IP et les ports pour les deux n≈ìuds. </p><br><div class="scrollable-table"><table><thead><tr><th>  H√¥te </th><th>  vm1 </th><th>  vm2 </th></tr></thead><tbody><tr><td>  <strong>Version du syst√®me d'exploitation</strong> </td><td>  CentOS Linux 7.6 x86_64 </td><td>  CentOS Linux 7.6 x86_64 </td></tr><tr><td>  <strong>Version du serveur DB</strong> </td><td>  MySQL 5.7.26 </td><td>  PostgreSQL 10.5 </td></tr><tr><td>  <strong>Port DB</strong> </td><td>  3306 </td><td>  5832 </td></tr><tr><td>  <strong>Adresse IP</strong> </td><td>  192.168.1.107 </td><td>  192.168.1.112 </td></tr><tr><td>  <strong>Version SymmetricDS</strong> </td><td>  SymmetricDS 3.9 </td><td>  SymmetricDS 3.9 </td></tr><tr><td>  <strong>Chemin d'installation de SymmetricDS</strong> </td><td>  /usr/local/symmetric-server-3.9.20 </td><td>  /usr/local/symmetric-server-3.9.20 </td></tr><tr><td>  <strong>Nom du n≈ìud SymmetricDS</strong> </td><td>  corp-000 </td><td>  store-001 </td></tr></tbody></table></div><br><p>  Ici, nous installons SymmetricDS dans /usr/local/symmetric-server-3.9.20, et diff√©rents sous-r√©pertoires et fichiers seront stock√©s l√†.  Nous nous int√©ressons aux exemples de r√©pertoires imbriqu√©s et aux moteurs.  Le r√©pertoire d'exemples contient des exemples de fichiers de configuration avec des propri√©t√©s d'h√¥te, ainsi que des exemples de scripts SQL pour d√©marrer rapidement la d√©monstration. </p><br><p>  Dans le r√©pertoire des exemples, nous voyons trois fichiers de configuration avec les propri√©t√©s du n≈ìud - le nom montre la nature du n≈ìud dans un sch√©ma particulier. </p><br><pre> <code class="plaintext hljs">corp-000.properties store-001.properties store-002.properties</code> </pre> <br><p>  SymmetricDS poss√®de tous les fichiers de configuration n√©cessaires pour un diagramme de base √† 3 n≈ìuds (option 1), et les m√™mes fichiers peuvent √™tre utilis√©s pour un diagramme √† 2 n≈ìuds (option 2).  Copiez le fichier de configuration souhait√© depuis le r√©pertoire des exemples vers les moteurs de l'h√¥te vm1.  Il se pr√©sente comme ceci: </p><br><pre> <code class="plaintext hljs">$&gt; cat engines/corp-000.properties engine.name=corp-000 db.driver=com.mysql.jdbc.Driver db.url=jdbc:mysql://192.168.1.107:3306/replica_db?autoReconnect=true&amp;useSSL=false db.user=root db.password=admin123 registration.url= sync.url=http://192.168.1.107:31415/sync/corp-000 group.id=corp external.id=000</code> </pre> <br><p>  Ce n≈ìud dans la configuration SymmetricDS est appel√© corp-000 et la connexion √† la base de donn√©es est trait√©e par le pilote mysql jdbc, qui utilise la cha√Æne de connexion sp√©cifi√©e ci-dessus et les informations de connexion.  Nous nous connectons √† la base de donn√©es replica_db et des tables seront cr√©√©es lors de la cr√©ation du sch√©ma.  sync.url affiche le site de communication avec le n≈ìud pour la synchronisation. </p><br><p>  Le noeud 2 sur l'h√¥te vm2 est configur√© en tant que magasin-001 et le reste est sp√©cifi√© dans le fichier node.properties ci-dessous.  Le n≈ìud store-001 ex√©cute la base de donn√©es PostgreSQL et pgdb_replica est la base de donn√©es pour la r√©plication.  registration.url permet √† l'h√¥te vm2 de contacter l'h√¥te vm1 et d'en obtenir les d√©tails de configuration. </p><br><pre> <code class="plaintext hljs">$&gt; cat engines/store-001.properties engine.name=store-001 db.driver=org.postgresql.Driver db.url=jdbc:postgresql://192.168.1.112:5832/pgdb_replica db.user=postgres db.password=admin123 registration.url=http://192.168.1.107:31415/sync/corp-000 group.id=store external.id=001</code> </pre> <br><p>  L'exemple pr√©configur√© de SymmetricDS contient des options pour configurer la r√©plication bidirectionnelle entre deux serveurs de base de donn√©es (deux n≈ìuds).  Les √©tapes ci-dessous sont effectu√©es sur l'h√¥te vm1 (corp-000), ce qui cr√©era un exemple de sch√©ma avec 4 tables.  Ensuite, l'ex√©cution de create-sym-tables avec la commande symadmin cr√©e des tables de r√©pertoire o√π les r√®gles et la direction de r√©plication entre les n≈ìuds seront stock√©es.  Enfin, des exemples de donn√©es sont charg√©s dans les tables. </p><br><pre> <code class="plaintext hljs">vm1$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm1$&gt; ./dbimport --engine corp-000 --format XML create_sample.xml vm1$&gt; ./symadmin --engine corp-000 create-sym-tables vm1$&gt; ./dbimport --engine corp-000 insert_sample.sql</code> </pre> <br><p>  Dans l'exemple, les tables item et item_selling_price sont automatiquement configur√©es pour la r√©plication de corp-000 vers store-001, et les tables de vente (sale_transaction et sale_return_line_item) sont automatiquement configur√©es pour la r√©plication de store-001 vers corp-000.  Cr√©ez maintenant le sch√©ma dans la base de donn√©es PostgreSQL sur l'h√¥te vm2 (store-001) pour le pr√©parer √† recevoir des donn√©es de corp-000. </p><br><pre> <code class="plaintext hljs">vm2$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm2$&gt; ./dbimport --engine store-001 --format XML create_sample.xml</code> </pre> <br><p>  Assurez-vous de v√©rifier que la base de donn√©es MySQL sur vm1 contient des exemples de tables et des tables de r√©pertoires SymmetricDS.  Notez que les tables syst√®me SymmetricDS (avec le pr√©fixe sym_) ne sont d√©sormais disponibles que sur l'h√¥te corp-000, car l√†, nous avons ex√©cut√© la commande create-sym-tables et g√©rons la r√©plication.  Et dans la base de donn√©es sur le n≈ìud store-001, il n'y aura que 4 exemples de tables sans donn√©es. </p><br><p>  C‚Äôest tout.  L'environnement est pr√™t √† ex√©cuter des processus de serveur sym sur les deux n≈ìuds, comme illustr√© ci-dessous. </p><br><pre> <code class="plaintext hljs">vm1$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm1$&gt; sym 2&gt;&amp;1 &amp;</code> </pre> <br><p>  Les entr√©es de journal sont envoy√©es au fichier journal d'arri√®re-plan (symmetric.log) dans le dossier journal du r√©pertoire o√π SymmetricDS est install√©, ainsi qu'√† la sortie standard.  Le serveur sym peut maintenant √™tre lanc√© sur le n≈ìud store-001. </p><br><pre> <code class="plaintext hljs">vm2$&gt; cd /usr/local/symmetric-server-3.9.20/bin vm2$&gt; sym 2&gt;&amp;1 &amp;</code> </pre> <br><p>  Si vous ex√©cutez le processus du serveur sym sur l'h√¥te vm2, il cr√©era √©galement les tables de catalogue SymmetricDS dans la base de donn√©es PostgreSQL.  Si vous ex√©cutez le processus du serveur sym sur les deux n≈ìuds, ils se coordonnent pour r√©pliquer les donn√©es de corp-000 vers store-001.  Si apr√®s quelques secondes nous interrogeons les 4 tables des deux c√¥t√©s, nous verrons que la r√©plication est r√©ussie.  Ou vous pouvez envoyer le bootstrap vers store-001 √† partir de corp-000 avec la commande suivante. </p><br><pre> <code class="plaintext hljs">vm1$&gt; ./symadmin --engine corp-000 reload-node 001</code> </pre> <br><p>  √Ä ce stade, un nouvel enregistrement est ins√©r√© dans la table des √©l√©ments de la base de donn√©es MySQL sur l'h√¥te corp-000 (h√¥te: vm1), et vous pouvez v√©rifier sa r√©plication dans la base de donn√©es PostgreSQL sur l'h√¥te magasin-001 (h√¥te: vm2).  Nous voyons une op√©ration Pull pour d√©placer les donn√©es de corp-000 vers store-001. </p><br><pre> <code class="plaintext hljs">mysql&gt; insert into item values ('22000002','Jelly Bean'); Query OK, 1 row affected (0.00 sec)</code> </pre> <br><pre> <code class="plaintext hljs">vm2$&gt; psql -p 5832 -U postgres pgdb_replica -c "select * from item" item_id | name ----------+----------- 11000001 | Yummy Gum 22000002 | Jelly Bean (2 rows)</code> </pre> <br><p>  Pour effectuer une op√©ration Push pour d√©placer des donn√©es de store-001 vers corp-000, ins√©rez un enregistrement dans la table sale_transaction et v√©rifiez que la r√©plication est termin√©e. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">R√©sultat.</a> </p><br><p>  Nous constatons une configuration r√©ussie de la r√©plication bidirectionnelle d'exemples de tables entre les bases de donn√©es MySQL et PostgreSQL.  Pour configurer la r√©plication pour les nouvelles tables d'utilisateurs, proc√©dez comme suit:  Nous cr√©ons la table t1 √† titre d'exemple et configurons les r√®gles pour sa r√©plication comme suit.  Nous configurons donc uniquement la r√©plication de corp-000 vers store-001. </p><br><pre> <code class="plaintext hljs">mysql&gt; create table t1 (no integer); Query OK, 0 rows affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_channel (channel_id,create_time,last_update_time) values ('t1',current_timestamp,current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_trigger (trigger_id, source_table_name,channel_id, last_update_time, create_time) values ('t1', 't1', 't1', current_timestamp, current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><pre> <code class="plaintext hljs">mysql&gt; insert into sym_trigger_router (trigger_id, router_id, Initial_load_order, create_time,last_update_time) values ('t1', 'corp-2-store-1', 1, current_timestamp,current_timestamp); Query OK, 1 row affected (0.01 sec)</code> </pre> <br><p>  Ensuite, la configuration est notifi√©e de la modification du sch√©ma, c'est-√†-dire de l'ajout d'une nouvelle table √† l'aide de la commande symadmin avec l'argument sync-triggers, qui recr√©e les d√©clencheurs pour correspondre aux d√©finitions de table.  Send-schema est ex√©cut√© pour envoyer les modifications de sch√©ma au n≈ìud store-001 et la r√©plication de table t1 est configur√©e. </p><br><pre> <code class="plaintext hljs">vm1$&gt; ./symadmin -e corp-000 --node=001 sync-triggers vm1$&gt; ./symadmin send-schema -e corp-000 --node=001 t1</code> </pre> <br><h3 id="preimuschestva-symmetricds">  Avantages de SymmetricDS </h3><br><p>  Installation et configuration faciles, y compris un ensemble de fichiers pr√™ts √† l'emploi avec des param√®tres pour cr√©er un circuit √† trois ou deux n≈ìuds. <br>  Bases de donn√©es multiplateformes et ind√©pendance des plates-formes, y compris les serveurs, les ordinateurs portables et les appareils mobiles. <br>  R√©pliquez n'importe quelle base de donn√©es vers n'importe quelle autre base de donn√©es localement, dans un WAN ou dans le cloud. <br>  La capacit√© de travailler de mani√®re optimale avec quelques bases de donn√©es ou plusieurs milliers pour une r√©plication facile. <br>  Version payante avec une interface graphique et un excellent support. </p><br><h3 id="nedostatki-symmetricds">  Inconv√©nients de SymmetricDS </h3><br><p>  Il est n√©cessaire de d√©terminer manuellement les r√®gles et le sens de la r√©plication via les instructions SQL sur la ligne de commande pour charger les tables de r√©pertoire, ce qui n'est pas pratique. <br>  La configuration de nombreuses tables pour la r√©plication peut √™tre fastidieuse si vous n'utilisez pas de scripts pour cr√©er des instructions SQL qui d√©finissent les r√®gles et la direction de la r√©plication. <br>  Trop d'informations sont entr√©es dans les journaux, et parfois vous devez nettoyer le fichier journal afin qu'il ne prenne pas trop de place. </p><br><h3 id="itogi-po-symmetricds">  R√©sum√© SymmetricDS </h3><br><p>  SymmetricDS vous permet de configurer la r√©plication bidirectionnelle entre deux, trois, voire plusieurs milliers de n≈ìuds pour r√©pliquer et synchroniser les fichiers.  Il s'agit d'un outil unique qui effectue ind√©pendamment de nombreuses t√¢ches, par exemple, la r√©cup√©ration automatique des donn√©es apr√®s un long temps d'arr√™t sur un n≈ìud, l'√©change s√©curis√© et efficace de donn√©es entre les n≈ìuds via HTTPS, la gestion automatique des conflits bas√©e sur un ensemble de r√®gles, etc. SymmetricDS se r√©plique entre toutes les bases de donn√©es, par cons√©quent, il peut √™tre utilis√© pour une vari√©t√© de sc√©narios, y compris la migration, la mise √† niveau, la distribution, le filtrage et la conversion de donn√©es entre plates-formes. </p><br><p>  L'√©chantillon est bas√© sur le Guide de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©marrage</a> rapide SymmetricDS officiel.  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">guide de l'utilisateur</a> d√©taille divers concepts li√©s √† la configuration de la r√©plication √† l'aide de SymmetricDS. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr467313/">https://habr.com/ru/post/fr467313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr467295/index.html">La liaison de vue tant attendue sur Android</a></li>
<li><a href="../fr467299/index.html">Concepts: simplifier l'impl√©mentation des classes d'utilitaires STD</a></li>
<li><a href="../fr467301/index.html">Comment fonctionne l'IA dans Hitman (2016)</a></li>
<li><a href="../fr467303/index.html">L'histoire du plus jeune programmeur PSB: le hackathon est devenu la porte de la banque</a></li>
<li><a href="../fr467305/index.html">Quand la ville est intelligente: l'exp√©rience des m√©galopoles</a></li>
<li><a href="../fr467317/index.html">Comment SoftBank a aval√© le monde</a></li>
<li><a href="../fr467323/index.html">Pr√©sentation des fonctionnalit√©s de programmation du microcontr√¥leur Qt Creator 4.10 et QBS 1.14</a></li>
<li><a href="../fr467327/index.html">Comment je suis devenu programmeur √† 35 ans</a></li>
<li><a href="../fr467329/index.html">Les meilleurs produits partent de vrais probl√®mes: Intercom sur les t√¢ches √† faire. partie 1</a></li>
<li><a href="../fr467331/index.html">Vendre + une belle boutique en ligne sur WordPress pour 269 $ "√† partir de z√©ro" - notre exp√©rience</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>