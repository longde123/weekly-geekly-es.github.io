<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚕 💵 ✨ Berhenti mengeluarkan sesuatu yang lain sebagai kebocoran memori 🧑🏾 🗯️ 🙆</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sampai saat ini, banyak artikel telah ditulis yang Anda harus berhenti berlangganan dari RxJS yang dapat diobservasi, jika tidak akan terjadi kebocora...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Berhenti mengeluarkan sesuatu yang lain sebagai kebocoran memori</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479732/"><p> Sampai saat ini, <a href="https://medium.com/alexonozor/angular-rxjs-please-always-unsubscribe-86ca55ba7f12" rel="nofollow">banyak</a> <a href="https://habr.com/ru/post/351338/">artikel</a> telah ditulis yang <a href="https://medium.com/ngx/why-do-you-need-unsubscribe-ee0c62b5d21f" rel="nofollow">Anda harus berhenti berlangganan</a> dari RxJS yang dapat diobservasi, jika tidak akan terjadi <strong>kebocoran memori</strong> .  Bagi sebagian besar pembaca artikel-artikel semacam itu, peraturan perusahaan "ditandatangani? - ditandatangani!"  Namun, sayangnya, sering dalam artikel seperti itu informasi terdistorsi atau sesuatu tidak dinegosiasikan, dan bahkan lebih buruk ketika konsep diganti.  Kami akan membicarakan ini. </p><br><p><img src="https://habrastorage.org/webt/oa/f5/pf/oaf5pfujlesdzjavtjopl6z4_gi.jpeg"></p><a name="habracut"></a><br><p>  Ambil contoh artikel ini: <a href="https://medium.com/ngx/why-do-you-need-unsubscribe-ee0c62b5d21f" rel="nofollow">https://medium.com/ngx/why-do-you-need-unsubscribe-ee0c62b5d21f</a> </p><br><p><img src="https://habrastorage.org/webt/n2/av/hm/n2avhmxwuemrtc0tvv7noyhl2za.png"></p><br><p>  Ketika mereka mengatakan kepada saya tentang "peluang <strong>potensial</strong> untuk mendapatkan regresi dalam kinerja," saya langsung memikirkan <a href="http://optimization.guide/" rel="nofollow">optimasi prematur</a> . </p><br><p><img src="https://habrastorage.org/webt/on/__/rg/on__rgsm7admmp7p1u9t2gok4mu.png"></p><br><p><img src="https://habrastorage.org/webt/hw/rz/rw/hwrzrwkwlzlxmdhi3d2uusuj7sa.png"></p><br><p>  Kami terus membaca artikel oleh pria dengan nama panggilan <strong>Reactive Fox</strong> : <br><img src="https://habrastorage.org/webt/fn/6j/qn/fn6jqnrypjv7e1zo_v9kg43jkv4.png"></p><br><p><img src="https://habrastorage.org/webt/ue/w2/mg/uew2mga3qjig9rint74jn7i0q0q.png"></p><br><p>  Selanjutnya ada informasi dan tips yang bermanfaat.  Saya setuju bahwa Anda harus selalu berhenti berlangganan dari <strong>aliran tak berujung di RxJS</strong> .  Tapi saya hanya fokus pada informasi yang berbahaya (menurut saya). <br><img src="https://habrastorage.org/webt/e1/ep/rz/e1eprzkk7depkecysfapwnlmhkc.png"></p><br><p>  Wow ... terjebak dengan kengerian.  Intimidasi yang tidak berdasar (tanpa metrik, angka ...) pada saat ini telah mengarah pada fakta bahwa untuk sejumlah besar front-endor, kurangnya berhenti berlangganan seperti kain merah untuk seekor banteng.  Ketika mereka menemukan ini, mereka tidak lagi melihat apa pun di sekitar kecuali kain ini. <br><img src="https://habrastorage.org/webt/1i/-o/c_/1i-oc_a48-jwxjp7xyfgofkajpe.jpeg"></p><br><p>  Penulis artikel itu bahkan membuat aplikasi demo, di mana ia mencoba membuktikan pikirannya: <br>  <a href="https://stackblitz.com/edit/why-you-have-to-unsubscribe-from-observable-material" rel="nofollow">https://stackblitz.com/edit/why-you-have-to-unsubscribe-from-observable-material</a> </p><br><p>  Memang, pada stand-nya Anda dapat melihat bagaimana prosesor bekerja tidak perlu (ketika saya tidak mengklik apa pun) dan bagaimana konsumsi memori meningkat (perubahan kecil): </p><br><p> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/lm/4r/p_/lm4rp_3sl0zqb11rf5dsufwdole.png"></a> </p><br><p>  Sebagai konfirmasi fakta bahwa Anda <strong>selalu</strong> perlu berhenti berlangganan dari permintaan <strong>HttpClient yang Dapat</strong> Diobservasi, ia menambahkan interseptor permintaan yang menampilkan "masih hidup ... masih hidup ... masih hidup ..." di konsol: <br><img src="https://habrastorage.org/webt/cs/m-/tz/csm-tzst2fx6prkarqwx_dfc_k4.png"><br>  Yaitu  orang menyadap aliran terakhir, menjadikannya <strong>tak terbatas</strong> (jika terjadi kesalahan, permintaan diulang, tetapi kesalahan selalu terjadi) dan memberikan ini sebagai bukti bahwa Anda harus berhenti berlangganan dari yang terakhir. </p><br><p>  <strong>StackBlitz</strong> tidak terlalu cocok untuk mengukur kinerja aplikasi  ada sinkronisasi otomatis selama peningkatan dan membutuhkan sumber daya.  Jadi saya membuat aplikasi pengujian saya: <a href="https://github.com/andchir/test-angular-app" rel="nofollow">https://github.com/andchir/test-angular-app</a> </p><br><p>  Ada dua jendela di sana.  Ketika Anda membuka masing-masing, permintaan dikirim ke <strong>action.php</strong> , di mana ada penundaan 3 detik sebagai imitasi dari operasi yang sangat intensif sumber daya.  <strong>Action.php</strong> juga <strong>mencatat</strong> semua permintaan ke file <strong>log.txt</strong> . </p><br><div class="spoiler">  <b class="spoiler_title">Kode Action.php</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> header(<span class="hljs-string"><span class="hljs-string">'Content-Type: application/json'</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logging</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($str, $fileName = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'log.txt'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_array($str)) { $str = json_encode($str); } $rootPath = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span>; $logFilePath = $rootPath . DIRECTORY_SEPARATOR . $fileName; $options = [ <span class="hljs-string"><span class="hljs-string">'max_log_size'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">200</span></span> * <span class="hljs-number"><span class="hljs-number">1024</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_dir(dirname($logFilePath))) { mkdir(dirname($logFilePath)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_exists($logFilePath) &amp;&amp; filesize($logFilePath) &gt;= $options[<span class="hljs-string"><span class="hljs-string">'max_log_size'</span></span>]) { unlink($logFilePath); } $fp = fopen( $logFilePath, <span class="hljs-string"><span class="hljs-string">'a'</span></span> ); $dateFormat = <span class="hljs-string"><span class="hljs-string">'d/m/YH:i:s'</span></span>; $str = PHP_EOL . PHP_EOL . date($dateFormat) . PHP_EOL . $str; fwrite( $fp, $str ); fclose( $fp ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } $actionName = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]) &amp;&amp; !is_array($_GET[<span class="hljs-string"><span class="hljs-string">'a'</span></span>]) ? $_GET[<span class="hljs-string"><span class="hljs-string">'a'</span></span>] : <span class="hljs-string"><span class="hljs-string">'1'</span></span>; logging(<span class="hljs-string"><span class="hljs-string">"STARTED-{$actionName}"</span></span>); sleep(<span class="hljs-number"><span class="hljs-number">3</span></span>);<span class="hljs-comment"><span class="hljs-comment">// Very resource-intensive operation that takes 3 seconds logging("COMPLETED-{$actionName}"); echo json_encode([ 'success' =&gt; true, 'data' =&gt; ['name' =&gt; 'test', 'title' =&gt; 'This is a test'] ]);</span></span></code> </pre> </div></div><br><p>  Tapi pertama-tama, terjadi penyimpangan kecil.  Pada gambar di bawah (dapat diklik), Anda dapat melihat contoh sederhana tentang cara kerja pengumpul sampah JavaScript di browser Chrome.  PUSH terjadi, tetapi setTimeout tidak menghentikan pengumpul sampah dari membersihkan memori. <br> <a href="" rel="nofollow"><img src="https://habrastorage.org/webt/ly/r0/1w/lyr01wmysa9pphmphoj8aa39aaq.png"></a> </p><br><p>  Jangan lupa untuk memanggil pengumpul sampah dengan satu sentuhan tombol saat Anda bereksperimen. <br><img src="https://habrastorage.org/webt/ir/k4/j4/irk4j4izd09-npb06n2zysccpum.png"></p><br><p>  Mari kembali ke aplikasi pengujian saya.  Berikut ini kode untuk kedua windows: </p><br><div class="spoiler">  <b class="spoiler_title">Kode BadModalComponent</b> <div class="spoiler_text"><pre> <code class="javascript hljs">@Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-bad-modal'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./bad-modal.component.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./bad-modal.component.css'</span></span>], <span class="hljs-attr"><span class="hljs-attr">providers</span></span>: [HttpClient] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BadModalComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-class"> </span></span>{ loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; largeData: number[] = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000000</span></span></span></span></span><span class="hljs-function">)).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">destroyed$</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Subject</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function">&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> private http: HttpClient, private bsModalRef: BsModalRef </span></span></span><span class="hljs-function">) { } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ngOnInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function"> { // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">For</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">example</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">only</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">not</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">production</span></span></span><span class="hljs-function">. </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loading</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subscription</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">http</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'/action.php?a=2'</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pipe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> takeUntil(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params">.destroyed$</span></span></span><span class="hljs-function">), </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">catchError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err</span></span></span><span class="hljs-function">) =&gt;</span></span> throwError(err.message)), finalize(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'FINALIZE'</span></span>)) ) .subscribe({ <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'LOADED'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = res; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, error); }, <span class="hljs-attr"><span class="hljs-attr">complete</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'COMPLETED'</span></span>); } }); } close(event?: MouseEvent): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event) { event.preventDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bsModalRef.hide(); } ngOnDestroy() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'DESTROY'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroyed$.next(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.destroyed$.complete(); } }</code> </pre> </div></div><br><p>  Seperti yang Anda lihat, ada yang berhenti berlangganan (takeUntil).  Segalanya seperti yang disarankan oleh "guru" itu.  Ada juga array yang besar. </p><br><div class="spoiler">  <b class="spoiler_title">GoodModalComponent Code</b> <div class="spoiler_text"><pre> <code class="javascript hljs">@Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'app-good-modal'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./good-modal.component.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./good-modal.component.css'</span></span>] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GoodModalComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnDestroy</span></span></span><span class="hljs-class"> </span></span>{ loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; largeData: number[] = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">Array</span></span></span></span><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1000000</span></span></span></span></span><span class="hljs-function">)).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span></span><span class="hljs-function">); </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">constructor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> private http: HttpClient, private bsModalRef: BsModalRef </span></span></span><span class="hljs-function">) { } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ngOnInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loadData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function"> { // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">For</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">example</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">only</span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">not</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">for</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">production</span></span></span><span class="hljs-function">. </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">loading</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">true</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">const</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">subscription</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">this</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">http</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">get</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DataInterface</span></span></span><span class="hljs-function">&gt;(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'/action.php?a=1'</span></span></span></span></span><span class="hljs-function">).</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">pipe</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> catchError((err</span></span></span><span class="hljs-function">) =&gt;</span></span> throwError(err.message)), finalize(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'FINALIZE'</span></span>)) ) .subscribe({ <span class="hljs-attr"><span class="hljs-attr">next</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'LOADED'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.data = res; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.loading = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'ERROR - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, error); }, <span class="hljs-attr"><span class="hljs-attr">complete</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(subscription.closed ? <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS CLOSED'</span></span> : <span class="hljs-string"><span class="hljs-string">'COMPLETED - SUBSCRIPTION IS NOT CLOSED!'</span></span>); }, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'COMPLETED'</span></span>); } }); } close(event?: MouseEvent): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event) { event.preventDefault(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bsModalRef.hide(); } ngOnDestroy() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'DESTROY'</span></span>); } }</code> </pre> </div></div><br><p>  Ada properti yang sama persis dengan array besar, tetapi tidak ada berhenti berlangganan.  Dan ini tidak menghentikan saya untuk menyebut jendela ini jendela yang bagus.  Kenapa - nanti. </p><br><p>  Tonton videonya: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jQ5qLosbnOY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Seperti yang Anda lihat, dalam kedua kasus, setelah beralih ke komponen kedua, pengumpul sampah berhasil mengembalikan memori ke nilai normal.  Ya, orang dapat memungkinkannya untuk menghapus memori juga setelah menutup jendela, tetapi dalam percobaan kami ini tidak penting.  Ternyata "guru" itu salah ketika dia berkata: </p><br><blockquote>  Misalnya, Anda mengajukan permintaan, tetapi ketika jawabannya belum tiba dari backend, Anda akan menghancurkan komponen itu sebagai tidak perlu, maka <strong>langganan Anda akan menyimpan tautan ke komponen tersebut</strong> , sehingga berpotensi menyebabkan kebocoran memori. </blockquote><p>  Ya, dia berbicara tentang kebocoran <strong>"potensial"</strong> .  Tapi, jika alirannya terbatas, maka tidak akan ada kebocoran memori. </p><br><p>  Saya melihat seruan marah dari "guru" tersebut.  Mereka pasti akan memberi tahu kami sesuatu seperti: <em>"ok, tidak ada kebocoran memori, tetapi dengan <strong>berhenti berlangganan</strong> kami juga <strong>membatalkan permintaan</strong> , yang berarti kami akan yakin bahwa tidak ada kode yang akan dieksekusi lagi setelah menerima respons dari server</em> . <em>"</em>  Pertama, saya tidak mengatakan bahwa berhenti berlangganan <strong>selalu</strong> buruk, saya hanya mengatakan bahwa Anda <strong>mengganti konsep</strong> .  Ya, fakta bahwa setelah jawabannya tiba beberapa operasi yang lebih tidak berguna akan dilakukan adalah buruk, tetapi <strong>Anda hanya dapat melindungi diri dari kebocoran memori nyata dengan berhenti berlangganan</strong> (dalam hal ini), dan Anda dapat melindungi diri dari <strong>efek lain yang tidak diinginkan</strong> <strong>dengan cara lain</strong> .  Tidak perlu mengintimidasi pembaca dan memaksakan gaya penulisan kode mereka sendiri pada mereka. </p><br><p>  Apakah kita selalu perlu membatalkan permintaan jika pengguna berubah pikiran?  Tidak selalu!  Jangan lupa bahwa Anda membatalkan permintaan, <strong>tetapi Anda tidak membatalkan operasi di server</strong> .  Bayangkan bahwa seorang pengguna telah membuka komponen, sesuatu telah dimuat untuk waktu yang lama dan dia beralih ke komponen lain.  Mungkin saja <strong>server dimuat dan tidak mengatasi</strong> semua permintaan dan operasi.  Dalam hal ini, pengguna dapat dengan cepat menyodok semua tautan di navigasi dan membuat <strong>beban yang lebih besar di server</strong> , karena <strong>permintaan tidak berhenti di sisi server</strong> (dalam kebanyakan kasus). </p><br><p>  Tonton video berikut: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uAEka7a5_eA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Saya membuat pengguna menunggu jawaban.  Dalam kebanyakan kasus, jawabannya akan datang dengan cepat dan pengguna tidak akan mengalami ketidaknyamanan.  <strong>Tetapi dengan cara ini, kami akan menyelamatkan server dari melakukan operasi berat yang berulang, jika ada.</strong> </p><br><p>  Ringkasan: </p><br><ul><li>  Saya tidak mengatakan bahwa <strong>Anda</strong> tidak perlu berhenti berlangganan dari permintaan HttpClient RxJS.  Saya hanya mengatakan bahwa ada saat-saat ini tidak perlu.  Tidak perlu mengganti konsep.  Jika Anda berbicara tentang kebocoran memori, tunjukkan kebocoran ini.  Bukan <strong>console.log</strong> Anda yang tak ada habisnya, yaitu kebocoran.  Apa memori diukur?  Apa waktu operasi diukur?  Inilah yang perlu ditunjukkan. </li><li>  Saya tidak menyebut solusi saya, yang saya terapkan dalam aplikasi tes, "peluru perak".  <strong>Sebaliknya, saya mendesak fronttender untuk diberi lebih banyak kebebasan.</strong>  Biarkan dia memutuskan bagaimana menulis kodenya.  Tidak perlu mengintimidasi dia dan memaksakan gaya perkembangannya sendiri. </li><li>  Saya menentang fanatisme dan optimisasi prematur.  Saya sudah terlalu banyak melihat ini belakangan ini. </li><li>  Browser memiliki metode yang lebih canggih untuk menemukan kebocoran memori daripada yang saya tunjukkan.  Saya pikir dalam kasus saya penerapan metode sederhana ini sudah cukup.  Tapi saya sarankan Anda membiasakan diri dengan topik secara lebih rinci, misalnya, dalam artikel ini: <a href="https://habr.com/ru/post/309318/">https://habr.com/en/post/309318/</a> . </li></ul><br><p>  <strong>UPD # 1</strong> <br>  Saat ini, pos merosot selama hampir satu hari.  Awalnya dia pergi ke pro dan kontra, kemudian penilaian berhenti di nol.  Ini berarti bahwa audiensi dibagi persis menjadi dua kubu.  Saya tidak tahu apakah ini baik atau buruk. </p><br><p>  <strong>UPD # 2</strong> <br>  Dalam komentar, Jet Fox muncul (penulis artikel sedang dianalisis).  Awalnya dia mengucapkan terima kasih, dia sangat sopan.  Tetapi, melihat kepasifan penonton, dia mulai menekan.  Sampai pada titik ia <a href="https://habr.com/ru/post/479732/">menulis</a> bahwa saya harus meminta maaf.  Yaitu  dia berbohong (berbaring dengan bingkai kuning di atas), dan saya harus minta maaf. <br>  Pada awalnya saya berpikir bahwa pencegat aliran dengan pengulangan tak berujung (well, 2-3 pengulangan), yang ia tulis dalam aplikasi demo-nya, hanya untuk tes dan memberi informasi.  Tetapi ternyata dia <a href="https://habr.com/ru/post/479732/">menganggapnya</a> sebagai contoh dari kehidupan.  Yaitu  untuk memblokir tombol jendela - <a href="https://habr.com/ru/post/479732/">tidak mungkin</a> .  Dan untuk menciptakan pencegat seperti itu, melanggar prinsip-prinsip SOLID, melanggar modularitas aplikasi (modul dan komponen harus independen satu sama lain), membiarkan tes unit unit Anda (komponen, layanan) melalui hutan - Anda bisa.  Bayangkan situasinya: Anda menulis sebuah komponen, menulis unit test untuknya.  Dan kemudian Fox seperti itu muncul, menambahkan pencegat serupa ke aplikasi Anda, dan tes Anda menjadi tidak berguna.  Lalu dia masih berkata kepada Anda, "Mengapa Anda tidak memperkirakan bahwa saya mungkin ingin menambahkan pencegat seperti itu. Ya, perbaiki kode Anda."  Mungkin ini mungkin menjadi kenyataan di timnya, tapi saya tidak berpikir ini harus didorong atau ditutup-tutupi. </p><br><p>  <strong>UPD # 3</strong> <br>  Komentar sebagian besar membahas langganan dan berhenti berlangganan.  Apakah posting disebut "Berhenti Berlangganan Jahat"?  Tidak.  Saya tidak menyarankan Anda untuk berhenti berlangganan.  Lakukan seperti yang Anda lakukan sebelumnya.  Tetapi Anda harus mengerti mengapa Anda melakukan ini.  Berhenti berlangganan bukan optimasi prematur.  Tetapi, dengan melangkah di jalur perlindungan terhadap potensi ancaman (sebagaimana penulis artikel di bawah analisis memanggil kami), Anda dapat melewati batas.  Kemudian kode Anda bisa menjadi kelebihan beban dan sulit untuk dipelihara. <br>  Artikel ini adalah tentang fanatisme, yang mengarah pada distribusi informasi yang tidak diverifikasi.  Dalam beberapa kasus, perlu dikaitkan dengan tidak adanya berhenti berlangganan secara lebih tenang (Anda perlu memahami dengan jelas apakah ada masalah dalam kasus tertentu). </p><br><p>  <strong>UPD # 4</strong> </p><br><blockquote>  Sebaliknya, saya mendesak fronttender untuk diberi lebih banyak kebebasan.  Biarkan dia memutuskan bagaimana menulis kodenya. </blockquote><p>  Di sini Anda perlu mengklarifikasi.  Saya untuk standar.  Tetapi standar dapat ditetapkan oleh penulis perpustakaan atau timnya, sementara ini tidak (dalam dokumentasi dan secara resmi).  Sebagai contoh, dokumentasi kerangka kerja Symfony memiliki bagian <a href="https://symfony.com/doc/current/best_practices.html" rel="nofollow">Praktik terbaik</a> .  Jika itu sama dalam dokumentasi RxJS dan itu akan mengatakan "ditandatangani-berhenti berlangganan", saya tidak akan memiliki keinginan untuk berdebat dengannya. </p><br><p>  <strong>UPD # 5</strong> <br>  Komentar penting dengan jawaban dari orang-orang terkemuka: <br>  <a href="https://habr.com/ru/post/479732/">https://habr.com/en/post/479732/#comment_21012620</a> <br>  Rekomendasi untuk memenuhi <strong>kontrak "ditandatangani-berhenti berlangganan"</strong> dari pengembang RxJS <strong>ada</strong> , tetapi secara tidak resmi. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id479732/">https://habr.com/ru/post/id479732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id479716/index.html">SuperApp "pertama di dunia" lainnya</a></li>
<li><a href="../id479718/index.html">Membangun aplikasi lingkungan arduino menggunakan CI github</a></li>
<li><a href="../id479724/index.html">Tru hacker sudah berakhir</a></li>
<li><a href="../id479726/index.html">Vladimir alias wowik: "OpenStreetMap membutuhkan ide yang tidak dapat direalisasikan dalam sistem lain"</a></li>
<li><a href="../id479728/index.html">Bagaimana cara mengatur startup yang sukses?</a></li>
<li><a href="../id479736/index.html">Kamera atau laser</a></li>
<li><a href="../id479738/index.html">Seperti Youtube dan Instagram: internasionalisasi dan pelokalan aplikasi Python</a></li>
<li><a href="../id479742/index.html">Halaman belakang - jaring layanan otomatis di atas infrastruktur multi-cloud dan hybrid</a></li>
<li><a href="../id479744/index.html">Manajemen Memori Python: Sedikit Tentang Fragmentasi Memori</a></li>
<li><a href="../id479746/index.html">Perangkat lunak perusahaan membuat karyawan Anda lebih dingin. Apakah kamu membutuhkannya?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>