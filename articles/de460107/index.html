<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐎 👩🏽‍🤝‍👩🏼 🔦 ISPsystem, verzeihen und auf Wiedersehen! Warum und wie wir unser Server Control Panel geschrieben haben 👨🏽‍🔬 🤹 ⛏️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Wir sind „Hosting Technologies“ und haben vor 5 Jahren VDSina gestartet - das erste speziell für Entwickler entwickelte VDS- Hosting. Wir bemüh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ISPsystem, verzeihen und auf Wiedersehen! Warum und wie wir unser Server Control Panel geschrieben haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vdsina/blog/460107/"><img src="https://habrastorage.org/webt/af/l8/yk/afl8yk6hovufiwx1ml-8cwcgaoy.png" alt="Bild"><br><br>  Hallo!  Wir sind „Hosting Technologies“ und haben vor 5 Jahren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VDSina</a> gestartet - das erste speziell für Entwickler entwickelte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VDS-</a> Hosting.  Wir bemühen uns, es bequem zu machen, wie DigitalOcean, aber mit russischer Unterstützung, Zahlungsmethoden und Servern in Russland.  DigitalOcean ist jedoch nicht nur Zuverlässigkeit und Preis, sondern auch ein Service. <br><br>  Software von ISPsystem erwies sich als ein Seil, das uns auf dem Weg zu einem coolen Service die Hände gebunden hat.  Vor drei Jahren haben wir das Billmanager-Abrechnungs- und VMmanager-Server-Control-Panel verwendet und schnell erkannt, dass es ohne unser eigenes Panel fast unmöglich ist, einen guten Service zu bieten. <br><a name="habracut"></a><br><br><h2>  Wie ISPsystem die Benutzerfreundlichkeit tötete </h2><br>  <b>Bugs</b> <br><br>  Wir konnten den Fehler nicht selbst beheben - jedes Mal mussten wir in die Unterstützung eines anderen schreiben und warten.  Die Lösung eines Problems erforderte die Antwort eines Drittunternehmens. <br><br>  Die ISP-Systemunterstützung reagierte normal, aber die Korrekturen erfolgten nur in wenigen Versionen und nicht immer und nicht in allen.  Manchmal wurden kritische Fehler mehrere Wochen lang behoben.  Wir mussten Kunden beruhigen, uns entschuldigen und darauf warten, dass ISPsystem den Fehler behebt. <br><br>  <b>Ausfallzeitbedrohung</b> <br><br>  Aktualisierungen können zu unvorhersehbaren Ausfallzeiten führen, die neue Fehler hervorrufen. <br><br>  Jedes Update war eine Lotterie: Es war notwendig, die Abrechnung abzudecken und den Göttern der Updates Opfer zu bringen - ein paar Mal verursachte das Update eine Ausfallzeit von 10-15 Minuten.  Zu diesem Zeitpunkt wurden unsere Administratoren vor unseren Augen grau - wir wussten nie, wie lange Ausfallzeiten dauern würden, und konnten nicht vorhersagen, wann ISPsystem ein neues Update veröffentlichen würde. <br><br>  In der fünften Generation wurde Billmanager besser, aber um Zugriff auf die erforderlichen Funktionen zu erhalten, musste ich eine Beta installieren, die bereits jede Woche aktualisiert wurde.  Wenn etwas kaputt ging, mussten Sie ausländischen Entwicklern Zugriff gewähren, damit sie etwas korrigierten. <br><br>  <b>Unbequeme Panel-Schnittstelle</b> <br><br>  Alles wurde in verschiedene Panels unterteilt und von verschiedenen Orten aus gesteuert.  Beispielsweise zahlten Clients über Billmanager und mussten VDS in VMManager neu starten oder neu installieren.  Unsere Mitarbeiter mussten auch zwischen Fenstern wechseln, um dem Client zu helfen, die Auslastung seines Servers zu überprüfen oder festzustellen, welches Betriebssystem er verwendet. <br><br>  Eine solche Schnittstelle braucht Zeit - sowohl unsere als auch unsere Kunden.  Über jede Bequemlichkeit wie DigitalOcean steht in einer solchen Situation keine Frage. <br><br>  <b>Kurze Lebenszyklen mit häufigen API-Updates</b> <br><br>  Wir haben unsere eigenen Plugins geschrieben - zum Beispiel ein Plugin mit zusätzlichen Zahlungsmethoden, die nicht in VMManager enthalten sind. <br><br>  In den letzten Jahren hatte VMManager einen relativ kurzen Lebenszyklus, und in neuen Versionen konnten sich die Namen von Variablen oder Funktionen in der API willkürlich ändern - dies hat unsere Plugins beschädigt.  Die Unterstützung für ältere Versionen wurde schnell minimiert und musste aktualisiert werden. <br><br>  <b>Sie können nicht ändern</b> <br><br>  Genauer gesagt, aber äußerst ineffizient.  Durch Lizenzbeschränkungen können Sie keine Änderungen an der Quelle vornehmen. Sie können nur Plugins schreiben.  Das Maximum an Plugins sind einige Menüpunkte, ein Schritt-für-Schritt-Assistent.  Das ISP-System ist auf Vielseitigkeit ausgelegt, und wir brauchten spezielle Lösungen. <br><br>  Die Entscheidung, Ihr Panel zu schreiben, ist also gereift.  Wir setzen uns Ziele: <br><br><ul><li> Reagieren Sie schnell auf Fehler und Bugs und beheben Sie diese selbst, ohne dass der Client warten muss. </li><li>  Ändern Sie die Schnittstelle frei an Arbeitsprozesse und Kundenbedürfnisse. </li><li>  Verbessern Sie die Benutzerfreundlichkeit durch ein klares und verständliches Design. </li></ul><br>  Und sie begannen mit der Entwicklung. <br><br><h2>  Neue Panel-Architektur </h2><br>  Wir haben ein autarkes Entwicklungsteam, deshalb haben wir das Panel selbst geschrieben. <br>  Die Hauptarbeit wurde von drei Ingenieuren geleistet - der technische Direktor Sergey entwickelte die Architektur und schrieb den Serveragenten, Alexey übernahm die Abrechnung, und unser Frontend Artysh sammelte das Frontend. <br><br><h3>  Schritt 1. Server Agent </h3><br><br>  Ein Server-Agent ist ein Python-Webserver, der die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">libvirt-</a> Bibliothek verwaltet, die wiederum den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Qemu-kvm-Hypervisor verwaltet</a> . <br><br>  Der Agent verwaltet alle Dienste auf dem Server: Erstellen, Stoppen, Deinstallieren von vds, Installieren von Betriebssystemen, Ändern von Einstellungen usw. über die libvirt-Bibliothek.  Zum Zeitpunkt der Veröffentlichung sind dies mehr als vierzig verschiedene Funktionen, die wir je nach Aufgabe und Bedürfnissen des Kunden ergänzen. <br><br>  Im Prinzip konnte libvirt direkt über die Abrechnung verwaltet werden, es war jedoch zu viel zusätzlicher Code erforderlich, und wir haben beschlossen, diese Funktionen zwischen dem Agenten und der Abrechnung zu verteilen. Die Abrechnung stellt einfach Anforderungen an den Agenten über die JSON-API. <br><br>  Der Agent ist das erste, was wir gemacht haben, da er keine Schnittstelle benötigte und direkt von der Serverkonsole aus getestet werden konnte. <br><br>  <b>Was der Server-Agent uns gegeben hat: Es wurde</b> eine Ebene angezeigt, die das Leben für alle vereinfacht. Die Abrechnung muss nicht eine ganze Reihe von Befehlen senden, sondern nur eine Anfrage stellen.  Der Agent erledigt alles, was Sie benötigen: Weisen Sie beispielsweise Speicherplatz und RAM zu. <br><br><h3>  Schritt 2. Abrechnung </h3><br>  Für unseren Entwickler Alex war dies nicht das erste Control Panel - Alex war lange Zeit im Hosting, daher verstand er im Allgemeinen, was der Client brauchte und was der Hoster brauchte. <br><br>  Wir nennen die Abrechnung zwischen uns ein „Control Panel“: Es enthält nicht nur Geld und Dienstleistungen, sondern auch deren Verwaltung, Kundenbetreuung und vieles mehr. <br><br>  Um von der ISPSystem-Software zu wechseln, mussten die vorherigen Funktionen für Kunden vollständig beibehalten, alle finanziellen Benutzeraktionen von der alten Abrechnung auf die neue sowie alle Dienste und Kommunikationen zwischen ihnen übertragen werden.  Wir haben untersucht, was in dem aktuellen Produkt enthalten ist, und dann die Entscheidungen der Wettbewerber, hauptsächlich DO und Vultr.  Wir haben uns die Nachteile und Vorteile angesehen und Feedback von Leuten gesammelt, die mit alten Produkten von ISPsystem gearbeitet haben. <br><br>  Bei der neuen Abrechnung wurden zwei Stapel verwendet: klassisches PHP, MySQL (und in Zukunft ist ein Wechsel zu PostgreSQL geplant), Yii2 als Framework im Backend und VueJS im Frontend.  Stacks arbeiten unabhängig voneinander, werden von verschiedenen Personen entwickelt und kommunizieren über die JSON-API.  Für die Entwicklung verwenden wir damals und heute <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PHPStorm</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">WebStorm</a> von JetBrains und lieben sie sehr (Leute, hallo!) <br><br>  Das Panel ist nach dem modularen Prinzip aufgebaut: Zahlungssystemmodule, Domain-Registrar-Modul oder beispielsweise SSL-Zertifikat-Modul.  Sie können ganz einfach eine neue Funktion hinzufügen oder die alte entfernen.  Der Grundstein für die Expansion wurde architektonisch gelegt, auch in entgegengesetzter Richtung, "zum Eisen". <br><img src="https://habrastorage.org/webt/b-/v7/7u/b-v77ugcsfi0zhdm3bbriq2oxsu.png" alt="Bild"><br>  <b>Was wir haben</b> : ein Control Panel, über das wir die volle Kontrolle haben.  Jetzt werden Fehler in Stunden und nicht in Wochen behoben, und neue Funktionen werden auf Kundenwunsch und nicht auf Anfrage von ISPSystem implementiert. <br><br><h3>  Schritt 3. Schnittstelle </h3><br><img src="https://habrastorage.org/webt/9i/n0/b2/9in0b2skk3doxpelwvckx7ebmei.png" alt="Bild"><br>  Die Schnittstelle ist unsere Team-Idee. <br><br>  Zuerst haben wir uns angesehen, was passieren würde, wenn wir ein Add-On über die ISPsystem-API erstellen würden, ohne etwas an der Benutzeroberfläche dramatisch zu ändern.  Es stellte sich als mittelmäßig heraus und wir beschlossen, alles von Grund auf neu zu machen. <br><br>  Wir glaubten, dass die Hauptsache darin bestand, die Benutzeroberfläche logisch zu gestalten, mit einem klaren und minimalistischen Design, und dann würden wir ein schönes Panel erhalten.  Die Anordnung der Elemente wurde in Megaplan erörtert, und die Benutzeroberfläche, die Benutzer jetzt im Control Panel sehen, wird nach und nach geboren. <br><br>  Das erste Abrechnungsseiten-Design erschien, da wir bereits Zahlungs-Plugins für ISPsystem erstellt haben. <br><br>  <b>Frontend</b> <br><br>  Sie beschlossen, das Panel zu einer SPA-Anwendung zu machen - ressourcenschonend und mit schnellem Laden von Daten.  Unser Front-End Artysh hat beschlossen, es auf Vue zu schreiben - zu diesem Zeitpunkt war Vue gerade erschienen.  Wir gingen davon aus, dass sich das Framework wie React dynamisch entwickeln wird, nach einiger Zeit wird die Vue-Community wachsen und ein Meer von Bibliotheken erscheinen.  Wir haben es auf Vue installiert und es nicht bereut - jetzt dauert das Hinzufügen neuer Funktionen, die bereits im Backend programmiert wurden, nur wenig Zeit.  Wir werden Ihnen in einem separaten Artikel mehr über die Frontend-Panels erzählen. <br><br>  <b>Kommunikation des Frontends mit dem Backend</b> <br><br>  Das Frontend war durch Pushies mit dem Backend verbunden.  Ich musste schwitzen und meinen eigenen Handler schreiben, aber jetzt werden die Informationen auf der Seite fast sofort aktualisiert. <br><br>  <b>Was ist passiert:</b> Die Panel-Oberfläche ist einfacher geworden.  Wir haben es anpassungsfähig gemacht, und durch schnelles Laden kann es auch von Mobiltelefonen in den letzten Minuten vor dem Start verwendet werden, ohne dass eine separate Anwendung für die Arbeit mit dem Panel installiert werden muss. <br><br><h3>  Schritt 4. Test- und Migrationsschema </h3><br>  Als alles begann und die ersten Tests bestanden, stellte sich die Frage nach der Migration.  Zunächst haben wir die Abrechnung eingerichtet und begonnen, die Arbeit mit dem Serveragenten zu testen. <br><br>  Dann schrieben sie ein einfaches Skript, das die Datenbank von der alten auf die neue Abrechnung überträgt. <br><br>  Ich musste buchstäblich alles testen und überprüfen, da die Daten aus den drei alten Datenbanken in eine neue Datenbank eingegossen wurden: Billmanager, VMmanager und IPmanager Manager.  Vielleicht ist die Testmigration das Schwierigste, auf das wir bei der Entwicklung eines neuen Panels gestoßen sind. <br><br>  Nach einer erneuten Überprüfung haben wir die alte Abrechnung vertuscht.  Die endgültige Datenmigration war ein sehr besorgniserregender Moment, aber Gott sei Dank war sie in wenigen Minuten und ohne erkennbare Probleme abgeschlossen.  Es gab kleinere Fehler, die wir in einer Woche behoben haben.  Die Hauptzeit wurde durch Testen der Ereignisse benötigt. <br><br>  Dann haben wir Briefe an Kunden mit der Adresse des neuen Panels und der Abrechnung verschickt und eine Weiterleitung vorgenommen. <br><br>  <b>Fazit:</b> <b>ES LEBT!</b> <br><br><h2>  Glücklich </h2><br>  Von den ersten Stunden unserer Software an haben wir alle Freuden des Übergangs gespürt.  Der Code gehörte vollständig uns und hatte eine praktische Architektur. Die Benutzeroberfläche war sauber und logisch. <br><img src="https://habrastorage.org/webt/7a/hv/is/7ahvis7zx-1m4pcouleavsqbldo.png" alt="Bild"><br>  <i>Die erste Überprüfung nach dem Start eines neuen Panels</i> <br><br>  Wir haben den Übergangsprozess im Dezember, am Vorabend des neuen Jahres 2017, begonnen, als die geringste Belastung bestand, um den Kunden den Übergang zu erleichtern - fast niemand arbeitet am Vorabend der Feiertage. <br><br>  Die Hauptsache, die wir während des Übergangs zu unserem System erhalten haben (zusätzlich zu allgemeiner Zuverlässigkeit und Bequemlichkeit), ist die Fähigkeit, wichtige Kunden schnell um Funktionen zu erweitern - um ihr Gesicht und nicht ihr Arsch zu sein. <br><br><h3>  Was weiter? </h3><br>  Wir wachsen, die Datenmenge, Kunden, Kundendaten wächst.  Ein Memcached Server und zwei Warteschlangenmanager mit unterschiedlichen Aufgaben mussten dem Backend hinzugefügt werden.  Es gibt Caching und Warteschlangen am Frontend. <br><br>  Natürlich hatten wir noch Abenteuer, als wir das Produkt entwickelten und komplizierten, zum Beispiel als wir HighLoad hinzufügten. <br><br>  Im nächsten Artikel erfahren Sie, wie der Hi-CPU-Tarif eingeführt wurde: über Hardware, Software, welche Aufgaben wir gelöst haben und was wir getan haben. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/ud/xv/wf/udxvwfcz80j3nug11rxaguqelww.png"><br></a> <br><h3>  Abonnieren Sie unseren Instagram-Entwickler </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/e5/as/-l/e5as-ltfnotkemk2dsqngygimra.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460107/">https://habr.com/ru/post/de460107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460091/index.html">Direkter Druck auf T-Shirts mit Epson SureColor SC - F und sein Unterschied zu Siebdruck, Abziehbild und Sublimation</a></li>
<li><a href="../de460095/index.html">Auf gitlab.com wurde ein Verbot für Fork DeepNude verhängt</a></li>
<li><a href="../de460097/index.html">Die Matrix bietet Ihnen: einen Überblick über Projekte mit MITRE ATT & CK</a></li>
<li><a href="../de460099/index.html">Anwendung des automatischen maschinellen Lernens auf neuronale Netze mit Transformatorarchitektur</a></li>
<li><a href="../de460101/index.html">Cookie-basierter XSS-Betrieb | $ 2300 Bug Bounty Geschichte</a></li>
<li><a href="../de460109/index.html">Winkel: Wenn Sie die Anwendung sehen müssen, das Backend jedoch noch nicht fertig ist</a></li>
<li><a href="../de460111/index.html">Aktualisierte Version von SAP Business One 9.3: Was hat sich geändert?</a></li>
<li><a href="../de460113/index.html">Ein paar Geschichten aus dem Leben von JSOC CERT oder Unbanal Forensics</a></li>
<li><a href="../de460115/index.html">Zehn Jahre Programmierung in Erlang</a></li>
<li><a href="../de460117/index.html">Sind die größten Kunden in Russland ein großer Jackpot oder Kopfschmerzen? AGIMA Erfahrung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>