<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤸🏼 ↕️ 🥣 Lazarus - einfache Animation mit der TImageFragment-Komponente 👲 📱 ⬜️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anstelle des Vorworts 
 In meinem kürzlich erschienenen Lazarus- Artikel - Schreiben einer Komponente für Sprite-Animationen - habe ich den Prozess zu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lazarus - einfache Animation mit der TImageFragment-Komponente</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439732/"><h6>  Anstelle des Vorworts </h6><br>  In meinem kürzlich erschienenen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lazarus-</a> Artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">- Schreiben einer Komponente für Sprite-Animationen - habe</a> ich den Prozess zum Erstellen einer einfachen <b>TImageFragment-</b> Komponente beschrieben, mit der Sie ein bestimmtes Fragment eines Bildes anzeigen können. <br><br>  In diesem Artikel möchte ich das ausgewählte Thema fortsetzen und zeigen, wie einfach es ist, mithilfe dieser Komponente Animationen von Sprites in der <b>Lazarus-</b> Entwicklungsumgebung ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offizielle Website</a> ) zu erstellen. <br><br>  Bei diesem Ansatz werden einzelne Animationsrahmen in verschiedenen Projektionen auf demselben Bild platziert, und die Komponente zum Anzeigen des Sprites zeigt nur ein ausgewähltes Fragment dieses Bildes unter Verwendung der Eigenschaften <b>OffsetX</b> und <b>OffsetY</b> (Versatz der oberen linken Ecke des <b>Bildfragments</b> horizontal und vertikal). <br><br>  Viele dieser vorgefertigten Bilder finden Sie im Web - zum Beispiel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier auf dieser Website</a> . <a name="habracut"></a><br><br><h6>  Wählen Sie das Bild aus (und bereiten Sie es vor) </h6><br>  Für mein Beispiel habe ich dieses Bild ausgewählt: <br><img src="https://habrastorage.org/getpro/habr/post_images/909/e6e/661/909e6e661a0a47541735e88ce1adcb00.png"><br>  - sehr ausdrucksstark schlägt dieser Phönixvogel mit den Flügeln. <br><br>  Wie Sie sehen können, enthält jede Zeile 4 Frames für jede der 4 Projektionen.  Wenn Sie nur <b>OffsetX ändern</b> , können Sie den Vogel mit den Flügeln <b>schlagen</b> lassen. Um die Projektion zu ändern, reicht es aus, nur <b>OffsetY</b> zu ändern.  Diese Trennung von Frames durch Linien vereinfacht die Programmierung von Animationen erheblich. <br><br>  Die Größe dieses Bildes beträgt 384 x 384 und die Größe jedes Rahmens beträgt 96 x 96.  Leider hat uns die direkte Verwendung dieses Bildes mit Artefakten verärgert: Einige Frames des Bildes sind so platziert, dass ihre Kanten auf benachbarte Frames fallen, und während der Animation blinken gelbe Striche an den Rändern des Sprites. <br><br>  Um diese Mängel zu beheben, habe ich den kostenlosen plattformübergreifenden grafischen Editor <b>GIMP</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offizielle Seite</a> ) verwendet.  Alles, was getan werden musste, war, die hervorstehenden Pixel der Bilder an den Stellen zu entfernen, an denen sie auf den angrenzenden Rahmen fielen. <br><br>  Die korrigierte Datei sieht folgendermaßen aus: <br><br><img src="https://habrastorage.org/webt/vw/_a/44/vw_a44kabb9dlcz4ituzz2zumdi.png"><br><br>  - Mit bloßem Auge sind die Unterschiede unsichtbar, aber die zweite Option funktioniert ohne Artefakte. <br><br><h6>  Erstellen Sie ein neues Projekt </h6><br>  1. Erstellen Sie ein neues Projekt vom Typ „Anwendung“. <br><br>  Standardmäßig erstellt die IDE ein Projekt mit dem Namen "project1", das sofort ein Programmmodul mit dem Namen "unit1" erstellt, eine Klasse mit dem Namen "TForm1" beschreibt und eine Instanz mit dem Namen "Form1" deklariert. <br><br>  Im Allgemeinen weist die IDE beim Erstellen neuer Objekte ihnen ähnliche Namen zu, die aus dem Namen des Objekttyps und der Seriennummer bestehen.  Ich halte es für einen guten Stil, alle diese Objekte umzubenennen und ihnen aussagekräftige Namen zu geben, die die Rolle oder den Zweck des Objekts widerspiegeln. <br><br>  Unser Projekt heißt also nicht "Projekt1", sondern "Phoenix" - entsprechend dem Namen des ausgewählten Sprites. <br><br>  2. Speichern Sie unser neues Projekt. <br><br>  Es ist ratsam, jedes Projekt in einem separaten Verzeichnis mit einem Namen zu speichern, der dem Namen des Projekts entspricht.  Beim Speichern geben wir das zu speichernde Verzeichnis an (ggf. erstellen wir es genau dort), dann den Namen der Projektdatei und den Dateinamen des Programmmoduls.  Ich habe den Ordner „Phoenix“ erstellt und dort die Projektdatei („Phoenix.lpi“ anstelle der vorgeschlagenen „project1.lpi“) und die Programmmoduldatei („UnitMain.pas“ anstelle der vorgeschlagenen „unit1.pas“) gespeichert. <br><br><div class="spoiler">  <b class="spoiler_title">Charakterfall Nuance</b> <div class="spoiler_text">  Die Lazarus-Version für Windows führt den Dateinamen des Programmmoduls in Kleinbuchstaben: "unitmain.pas", aber der Programmname des Moduls behält die ursprüngliche Groß- und Kleinschreibung der Zeichen bei: "unit UnitMain;".  Dies ist bei der Projektdatei nicht der Fall, da der Dateiname den ursprünglichen Fall von Zeichen beibehält. </div></div><br>  3. Benennen Sie das Formular um und ändern Sie den Titel. <br><br>  Das neu erstellte Formular mit dem Namen "Form1" ( <b>Name-</b> Eigenschaft) ist eine Instanz der Klasse "TForm1" und enthält den Titel "Form1" ( <b>Caption-</b> Eigenschaft).  Ändern Sie die <b>Name-</b> Eigenschaft des Formulars in "FormMain", und der Klassenname ändert sich in "TFormMain". <br><br>  Ändern Sie die <b>Caption-</b> Eigenschaft in "Phoenix", sodass der Projekttitel im Fenstertitel angezeigt wird. <br><br>  4. Als Ergebnis habe ich den folgenden Text des Moduls unitmain.pas erhalten: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre> <br><br>  5. Kompilieren Sie das Projekt, führen Sie es aus (Taste &lt;F9&gt;): <br><br><img src="https://habrastorage.org/webt/v_/el/0s/v_el0s_ntalmovtpfkso3j-gqau.png"><br><br><h6>  Setzen Sie das Sprite auf das Formular </h6><br>  Angenommen, Sie haben bereits die <b>TImageFragment-</b> Komponente <b>installiert</b> , die in meinem vorherigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lazarus-</a> Artikel beschrieben wurde. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir schreiben eine Komponente für die Sprite-Animation</a> , wählen die Registerkarte "Spiel" in der Komponentenpalette aus und fügen dem Formular die Komponente "TImageFragment" hinzu. <br><br>  Laden Sie mit der <b>Picture-</b> Eigenschaft ein Bild (eine feste Version des Phoenix-Vogels) in die Komponente.  Darüber hinaus ändern wir auch die folgenden Eigenschaften des neuen Objekts: <br><br><ul><li>  Setzen Sie die Eigenschaften <b>Höhe</b> und <b>Breite</b> auf 96 </li><li>  Setzen Sie die Eigenschaften <b>Links</b> und <b>Oben</b> auf 0 (praktisch für den Abgleich mit meinen Screenshots). </li><li>  <b>Die</b> Namenseigenschaft wird von "ImageFragment1" in ein einfaches und verständliches "Sprite" geändert. </li></ul><br>  Wenn alles richtig gemacht wurde, zeigt die Komponente den ersten Frame des Bildes: <br><img src="https://habrastorage.org/webt/br/zp/g2/brzpg25qbgjlrsoy20akjhdeox4.png"><br><br>  Der Text des <b>UnitMain-</b> Moduls wird geringfügig geändert: <br>  - Das <b>ImageFragment-</b> Modul wird dem <b>Verwendungsabschnitt</b> hinzugefügt <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ImageFragment;</code> </pre><br>  - In der Klassendeklaration wird ein neues Objekt angezeigt <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br><h6>  Animation hinzufügen - Flügelklappen </h6><br>  1. Fügen Sie dem <b>Formular</b> eine neue Komponente der <b>TTimer-</b> Klasse hinzu. <br><br>  Diese Komponente befindet sich auf der Registerkarte „System“ der Komponentenpalette.  Sie können es an einer beliebigen Stelle im Formular platzieren, da es in einer laufenden Anwendung nicht angezeigt wird. <br><br>  2. Benennen Sie das hinzugefügte Objekt um. <br><br>  Das neue Objekt erhält automatisch den Namen "Timer1", aber wir benennen es in "TimerLive" um.  Es ist oft zweckmäßig, Objekten solche Namen zu geben, die aus zwei Teilen bestehen: Der erste spiegelt die Klasse des Objekts wider und der zweite spiegelt seinen Zweck wider. <br><br>  3. Ändern Sie die <b>Interval-</b> Eigenschaft von 1000 in 100. <br><br>  Lassen Sie die Frames dieser Animation alle 100 Millisekunden, dh 10 Mal pro Sekunde, einander ersetzen.  In Zukunft kann diese Eigenschaft geändert werden, um die Spannweite zu verlangsamen oder zu beschleunigen - nach Ermessen des Programmierers. <br><br>  4. Fügen Sie einen OnTimer-Ereignishandler hinzu. <br><br>  Der einfachste Weg, dies zu tun, besteht darin, auf das Symbol des neuen <b>TimerLive-</b> Objekts zu <b>doppelklicken</b> .  Als Ergebnis dieser Aktion fügt die IDE selbst der Formularklassendeklaration eine neue Prozedur hinzu, eine Verknüpfung zu dieser Prozedur mit den Objekteigenschaften, und der Hauptteil der neuen Prozedur wird dem <b>Implementierungsabschnitt</b> hinzugefügt (und der Cursor wird innerhalb dieser neuen Prozedur zwischen den <b>Schlüsselwörtern</b> <b>begin</b> und <b>end platziert</b> ). <br><br>  5. Fügen Sie der neuen Prozedur eine Codezeile hinzu. <br><br><pre> <code class="delphi hljs"> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>;</code> </pre><br>  Als Ergebnis dieser Aktionen sollte die Klassendeklaration ungefähr so ​​aussehen: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Und die neue Prozedur - der <b>OnTimer-</b> Ereignishandler sollte <b>ungefähr</b> so aussehen: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Nach dem Kompilieren und Ausführen der Anwendung können Sie beobachten, wie der Phoenix-Vogel mit den Flügeln schlägt. <br><br>  Dies liegt daran, dass der Timer-Ereignishandler alle 100 Millisekunden zyklisch den Versatz des angezeigten Fragments ändert und der ausgewählte Frame horizontal verschoben wird und nacheinander 4 Frames der obersten Zeile des geladenen Bildes anzeigt.  Die <b>Mod-</b> Operation - den Rest der Teilung erhalten - verhindert, dass der Versatz über die Bildgröße hinausgeht, und infolgedessen folgt auf den 4. Frame erneut der 1. Frame. <br><br><h6>  Fügen Sie eine Sprite-Bewegung um das Fenster hinzu </h6><br>  1. Fügen Sie das <b>Mathematikmodul</b> zum <b>Verwendungsabschnitt hinzu</b> <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math;</code> </pre><br>  2. Fügen Sie der Klassendeklaration eine neue Variable und Konstante hinzu. <br><br>  <b>Fügen</b> Sie eine Variable vom Typ <b>TPoint</b> hinzu, um den Vektor zum Verschieben des Sprites im Fenster zu <b>speichern</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint;</code> </pre><br>  An derselben Stelle deklarieren wir eine Konstante zur Definition des Geschwindigkeitsmoduls <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>;</code> </pre><br>  3. Fügen Sie dem <b>Formular eine</b> weitere Komponente der <b>TTimer-</b> Klasse hinzu. <br><br>  Ich erinnere Sie daran: Diese Komponente befindet sich auf der Registerkarte „System“ der Komponentenpalette. <br><br>  Das neue Objekt erhält automatisch wieder den Namen "Timer1" und wir benennen ihn um - diesmal in "TimerMove".  Der Zweck des zweiten Timers besteht darin, die Bewegung des Sprites zu steuern.  Ich habe nicht beide Prozesse (Animation und Bewegung) an denselben Timer gebunden, sodass jeder Timer separat eingestellt werden konnte - zum Beispiel, um die Häufigkeit von Flügelschwüngen zu verlangsamen, ohne die Bewegung zu verlangsamen, und so weiter. <br><br>  4. Ändern Sie die <b>Interval-</b> Eigenschaft von 1000 in 100. <br><br>  Lassen Sie diesen Timer auch alle 100 Millisekunden, dh 10 Mal pro Sekunde, auslösen.  In Zukunft kann diese Eigenschaft auch geändert werden, um die Häufigkeit des Renderns der Bewegung des Sprites zu verlangsamen oder zu beschleunigen. <br><br>  5. Fügen Sie einen <b>OnTimer-</b> Ereignishandler hinzu. <br><br>  Zur Abwechslung schlage ich diesmal vor, dies durch Doppelklicken gegenüber dem <b>OnTimer-</b> Ereignis auf der Registerkarte "Ereignisse" des neuen <b>TimerMove-</b> Objekts zu <b>tun</b> .  Als letztes Ergebnis dieser Aktion fügt die IDE selbst der Formularklassendeklaration eine neue Prozedur hinzu, eine Verknüpfung zu dieser Prozedur mit den Objekteigenschaften, und der Hauptteil der neuen Prozedur wird dem <b>Implementierungsabschnitt</b> hinzugefügt (und der Cursor wird innerhalb dieser neuen Prozedur zwischen den Schlüsseln platziert Wörter <b>beginnen</b> und <b>enden</b> ). <br><br>  6. Fügen Sie der neuen Prozedur zwei Codezeilen hinzu. <br><br><pre> <code class="delphi hljs"> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y));</code> </pre><br>  Die Verwendung der Funktionen Max () und Min () verhindert, dass das Sprite das Formular (das Hauptanwendungsfenster) verlässt. <br>  Für die Verwendung dieser Funktionen haben wir das <b>Math-</b> Modul mit dem <b>Verwendungsabschnitt verbunden</b> . <br><br>  7. Fügen Sie einen <b>OnKeyPress-</b> Ereignishandler hinzu. <br><br>  Wählen Sie das Formular aus (klicken Sie auf das graue Rechteck des Fensterlayouts außerhalb aller hinzugefügten Komponenten) und auf der Registerkarte Ereignisse finden Sie das <b>OnKeyPress-</b> Ereignis.  Durch Doppelklick auf den leeren Wert des Ereignishandlers erstellen wir eine neue Prozedur und weisen sie zu - den Ereignishandler. <br><br>  8. Fügen Sie der neuen Prozedur einige Codezeilen hinzu. <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  Als Ergebnis dieser Aktionen sollte die Klassendeklaration ungefähr so ​​aussehen: <br><br><pre> <code class="delphi hljs"> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Und die neuen Verfahren - <b>OnTimer-</b> und <b>OnKeyPress-</b> Ereignishandler sollten <b>ungefähr</b> so aussehen: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  Nach dem Kompilieren und Ausführen der Anwendung können Sie den Phoenix-Vogel mit den Tasten „a“, „w“, „s“, „d“ über den Bildschirm bewegen und mit der Leertaste anhalten. <br><br><h6>  Wir verwenden verschiedene Projektionen des Sprites </h6><br>  Fügen Sie den folgenden Code am Ende der Prozedur <b>TFormMain.FormKeyPress hinzu</b> <br><br><pre> <code class="delphi hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  Durch Ändern der <b>OffsetY-</b> Eigenschaft in Abhängigkeit vom Verschiebungsvektor wird das Bild in Bewegungsrichtung gedreht. <br><br><div class="spoiler">  <b class="spoiler_title">Alle UnitMain-Modultext</b> <div class="spoiler_text"><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">unit</span></span> UnitMain; <span class="hljs-meta"><span class="hljs-meta">{$mode objfpc}</span></span><span class="hljs-meta"><span class="hljs-meta">{$H+}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Classes, SysUtils, FileUtil, Forms, Controls, Graphics, Dialogs, ExtCtrls, ImageFragment, Math; <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-title"><span class="hljs-title">TFormMain</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) Sprite: TImageFragment; TimerMove: TTimer; TimerLive: TTimer; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FVector: TPoint; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Speed = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> FormMain: TFormMain; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-meta"><span class="hljs-meta">{$R *.lfm}</span></span> <span class="hljs-comment"><span class="hljs-comment">{ TFormMain }</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerLiveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.OffsetX := (Sprite.OffsetX + <span class="hljs-number"><span class="hljs-number">96</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">mod</span></span> <span class="hljs-number"><span class="hljs-number">384</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TimerMoveTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Sprite.Left := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Width - Sprite.Width, Sprite.Left + FVector.x)); Sprite.Top := Max(<span class="hljs-number"><span class="hljs-number">0</span></span>, Min(Height - Sprite.Height, Sprite.Top + FVector.y)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TFormMain</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormKeyPress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Key: char)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'a'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(-Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'d'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(Speed, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'w'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, -Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">'s'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, Speed) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> Key = <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> FVector := TPoint.Create(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">96</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">192</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FVector.y &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">288</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Sprite.OffsetY := <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre></div></div><br><h6>  Anstelle eines Nachwortes </h6><br>  Dieses einfache Beispiel beansprucht keine hohen Bewertungen für Geschwindigkeit oder Benutzerfreundlichkeit.  Wenn jemand, wie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Artikel</a> , in den Kommentaren mitteilen möchte, dass die Animation falsch ausgeführt werden muss - begrüßen Sie, schreiben Sie Ihren Artikel.  In diesem Artikel geht es darum, wie Sie Animationen in mehreren Codezeilen erstellen können, ohne spezielle Bibliotheken zu verwenden, praktisch „auf dem Knie“.  Diese Methode wurde in der Praxis getestet und funktioniert wirklich. Bevor Sie kritisieren und „minus“, lesen Sie bitte noch einmal, worum es in diesem Artikel geht und warum. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de439732/">https://habr.com/ru/post/de439732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de439722/index.html">Auswirkungen von SVG-Filtern. Teil 2. Gliederungstext mit feMorphology</a></li>
<li><a href="../de439724/index.html">Überblick über AI & ML-Lösungen im Jahr 2018 und Prognosen für 2019: Teil 2 - Tools und Bibliotheken, AutoML, RL, Ethik in AI</a></li>
<li><a href="../de439726/index.html">Lock-in: wahr oder fiktiv?</a></li>
<li><a href="../de439728/index.html">Konfigurieren Sie die vollständige und separate Sicherung und Wiederherstellung von Zimbra OSE ohne Verwendung von Zextras</a></li>
<li><a href="../de439730/index.html">Organisation des Reduzierers durch eine Standardklasse</a></li>
<li><a href="../de439734/index.html">Bereitstellung von Kubernetes auf dem Desktop in wenigen Minuten mit MicroK8s</a></li>
<li><a href="../de439736/index.html">IPSec VPN-Verbindung zwischen MikroTik und Kerio Control</a></li>
<li><a href="../de439738/index.html">Auf der Suche nach der Schaltfläche "Gut machen". Zyxel im Netzwerk kleiner und mittlerer Unternehmen</a></li>
<li><a href="../de439742/index.html">Zulassung zum Masterstudiengang JetBrains an der ITMO University</a></li>
<li><a href="../de439744/index.html">Forscher vom MIT entwickelten eine „Rectenna“, die Wi-Fi-Signale in Elektrizität umwandelt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>