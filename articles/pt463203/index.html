<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§™ğŸ½ ğŸŒ¥ï¸ ğŸ“˜ O pesado fardo do tempo. RelatÃ³rio Yandex sobre erros comuns no trabalho com o tempo ğŸ¤¾ ğŸ‘¨ğŸ¼â€ğŸ¨ ğŸ¤·ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No cÃ³digo de vÃ¡rios projetos, muitas vezes Ã© preciso operar dentro do prazo - por exemplo, para vincular a lÃ³gica do usuÃ¡rio do aplicativo ao horÃ¡rio ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O pesado fardo do tempo. RelatÃ³rio Yandex sobre erros comuns no trabalho com o tempo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/463203/"> No cÃ³digo de vÃ¡rios projetos, muitas vezes Ã© preciso operar dentro do prazo - por exemplo, para vincular a lÃ³gica do usuÃ¡rio do aplicativo ao horÃ¡rio atual.  Victor Khomyakov, Victor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">-homyakov,</a> desenvolvedor sÃªnior de interface, descreveu os erros tÃ­picos que encontrou em projetos em Java, C # e JavaScript de vÃ¡rios autores.  Eles enfrentaram as mesmas tarefas: obter a data e hora atuais, medir intervalos ou executar cÃ³digo de forma assÃ­ncrona. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/na/mz/ir/namzirvbhnouwgv9_d4qv2xubbw.jpeg"></a> <br><br>  - Antes da Yandex, trabalhei em outras empresas de alimentos.  Isso nÃ£o Ã© como um freelancer - eu escrevi, passei e esqueci.  Demora muito tempo para trabalhar com uma base de cÃ³digo.  Na verdade, eu assisti, li, escrevi muito cÃ³digo em diferentes idiomas e vi muitas coisas interessantes.  Como resultado, nasci o tema desta histÃ³ria. <br><br><a name="habracut"></a>  Por exemplo, vi que em diferentes projetos em diferentes idiomas surgem tarefas iguais ou muito semelhantes - trabalhando com data, hora.  AlÃ©m desse trabalho, ele pode ser operaÃ§Ãµes pop-up no cÃ³digo com objetos de data e hora. <br><br><img src="https://habrastorage.org/webt/6t/72/sz/6t72szwcjb1qeuqxrka34otqyqu.jpeg"><br><br>  Acontece que, independentemente de vocÃª ser o front-end ou back-end, vocÃª tem tarefas semelhantes para trabalhar com cÃ³digo assÃ­ncrono.  Se vocÃª estiver no back-end, essas sÃ£o consultas ao banco de dados, chamadas remotas.  Se o front-end - vocÃª naturalmente tem AJAX.  Pessoas diferentes em projetos diferentes resolvem esses problemas quase da mesma maneira, essa Ã© a essÃªncia do homem.  Com uma tarefa semelhante, vocÃª toma uma decisÃ£o semelhante, independentemente do idioma que pensa.  E Ã© lÃ³gico que, ao mesmo tempo, vocÃª - nÃ³s, eu - cometamos erros muito semelhantes. <br><br>  Sobre o que eu quero falar no final?  Sobre esses padrÃµes repetidos que ocorrem independentemente do idioma em que vocÃª escreve, erros fÃ¡ceis de cometer e como nÃ£o fazÃª-los. <br><br>  A primeira parte Ã© dedicada, de fato, ao tempo.  Como vocÃª sabe, o tempo se move.  Exemplo: vocÃª precisa escrever um relatÃ³rio para ontem, para o Ãºltimo dia inteiro.  VocÃª faz uma solicitaÃ§Ã£o ao banco de dados, precisa obter todos os registros cuja data Ã© maior ou igual a ontem e menor que hoje.  Ou seja, vocÃª comeÃ§a a partir da data "hoje menos um dia" e atÃ© a data de hoje, sem incluÃ­-la. <br><br><img src="https://habrastorage.org/webt/vs/uv/2e/vsuv2eoscmtsccq9me53z1ewlx4.jpeg"><br><br>  De maneira linear, vocÃª, em geral, escreve o cÃ³digo.  Data de inÃ­cio - hoje menos um dia, data de tÃ©rmino - hoje.  Parece que tudo funciona, mas exatamente Ã  meia-noite vocÃª tem uma coisa estranha.  A sua data de inÃ­cio estÃ¡ aqui.  Data de inÃ­cio menos um dia - acontece isso.  Depois disso, por algum motivo, a data final do relatÃ³rio Ã© completamente diferente. <br><br><img src="https://habrastorage.org/webt/s7/8b/yq/s78byqfcjbyziwbvnofbrm5zzcu.jpeg"><br><br>  VocÃª, ou melhor, seu chefe, recebe um relatÃ³rio por dois dias em vez de um.  O gerente tÃ©cnico e o gerente vÃªm, reclamam e oferecem educadamente que vocÃª mude para outra equipe em seis meses. <br><br><img src="https://habrastorage.org/webt/c3/tp/om/c3tpom_hfq_dgh6qkmbmbi8ygwu.jpeg"><br><br>  Mas entÃ£o vocÃª Ã© enriquecido com novos conhecimentos.  VocÃª entende que o tempo nÃ£o pÃ¡ra.  Ou seja, chamando Date.now () duas vezes ou obtÃ©m novo Date (), vocÃª nÃ£o espera obter o mesmo valor.  Ã€s vezes pode ser o mesmo, mas pode nÃ£o ser o mesmo.  Portanto, se vocÃª tiver um mÃ©todo, qualquer parte da lÃ³gica, provavelmente haverÃ¡ apenas uma chamada para Date.now () ou a obtenÃ§Ã£o de nova Date (), o ponto atual no tempo. <br><br>  Ou vamos por outro lado: no fluxo de processamento de dados, todos os valores relacionados por significado - o inÃ­cio e o final do relatÃ³rio - devem ser calculados estritamente a partir de um objeto.  NÃ£o de dois similares, por exemplo, mas de exatamente um.  VocÃª Ã© enriquecido com esse novo conhecimento, muda para uma nova equipe.  LÃ¡, as pessoas estÃ£o mais preocupadas com a velocidade e o desempenho do cÃ³digo. <br><br><img src="https://habrastorage.org/webt/mr/qh/bf/mrqhbf7xune8sjfofoe9vnzjnn4.jpeg"><br><br>  E vocÃª pode sobrepor o cÃ³digo ao log, para medir quanto tempo leva uma operaÃ§Ã£o.  Se esta Ã© uma operaÃ§Ã£o difÃ­cil, Ã© importante que nÃ£o diminua a velocidade do cliente.  Se vocÃª escrever algo no back-end, no Node, tambÃ©m Ã© uma transaÃ§Ã£o difÃ­cil, e eles perguntarÃ£o: "Escreva no log quanto tempo leva e calcularemos como nossos clientes se comportam dependendo do agente do usuÃ¡rio". <br><br>  Em seguida, dois novos chefes chegam atÃ© vocÃª e mostram uma entrada no log, onde vocÃª repentinamente registra tempos negativos.  E eles tambÃ©m oferecem educadamente que vocÃª mude para outra equipe em seis meses. <br><br><img src="https://habrastorage.org/webt/36/y7/bh/36y7bhc9hjrkcj0nwuozz5-xhsg.jpeg"><br><br>  VocÃª ganha um conhecimento valioso de que, de fato, os mÃ©todos para obter a data e a hora que vocÃª usa - eles apenas mostram o que vocÃª tem no relÃ³gio do sistema operacional.  Nem garantem mudanÃ§as uniformes.  Ou seja, no seu segundo tempo real, o seu Date.now () pode pular por um segundo e um pouco mais - um pouco menos.  E, em princÃ­pio, eles geralmente nÃ£o garantem a monotonia da mudanÃ§a.  Ou seja, como neste exemplo, ele pode diminuir repentinamente, o valor de Date.now () pode diminuir repentinamente. <br><br>  Qual o motivo?  SincronizaÃ§Ã£o em tempo.  Em sistemas semelhantes ao Linux, existe o daemon NTP, que sincroniza o relÃ³gio do seu sistema operacional com o relÃ³gio exato na Internet.  E se vocÃª tiver algum atraso ou vantagem, ele pode desacelerar artificialmente ou acelerar o relÃ³gio, ou se vocÃª tiver um intervalo de tempo muito grande, ele entenderÃ¡ que nÃ£o conseguirÃ¡ acertar o tempo certo com passos discretos e apenas com um salto. muda isso.  Como resultado, vocÃª obtÃ©m uma lacuna nas leituras do seu relÃ³gio. <br><br>  Ou vocÃª pode complicar bastante: o prÃ³prio usuÃ¡rio, que tem controle sobre o relÃ³gio, ele tambÃ©m pode querer apenas mudar o relÃ³gio.  Ele realmente queria.  E nÃ£o temos o direito de detÃª-lo.  E nos logs, temos pausas.  E, consequentemente, uma soluÃ§Ã£o para esse problema tambÃ©m jÃ¡ existe.  Ã‰ simples: existem fornecedores de tempo.  Se vocÃª estiver em um navegador, entÃ£o Ã© performance.now (), se vocÃª estiver escrevendo no Node, haverÃ¡ um timer de alta resoluÃ§Ã£o, que, ambos, tÃªm essas propriedades de uniformidade e monotonia.  Ou seja, esses fornecedores de carimbos de data / hora, eles sempre aumentam e, ao mesmo tempo, de maneira uniforme em um segundo do tempo real. <br><br><img src="https://habrastorage.org/webt/h6/ul/c5/h6ulc5xuufzdzxy3mjvzykkergg.jpeg"><br><br>  O back-end tem o mesmo problema.  NÃ£o importa qual idioma vocÃª escreve.  Por exemplo, vocÃª pode procurar por um relÃ³gio consistente e monÃ³tono, e o problema Ã© o mesmo, no qual quase todos os idiomas sÃ£o apresentados.  Existe o mesmo problema no Rust.  HÃ¡ tambÃ©m a dor de um programador que estÃ¡ em Python, em Java e em outras linguagens.  Nessas lÃ­nguas, as pessoas tambÃ©m pisaram em um ancinho, esse problema Ã© conhecido, existe uma soluÃ§Ã£o.  Por exemplo, para Java, hÃ¡ uma chamada que tem as mesmas propriedades de uniformidade e monotonia. <br><br>  Se vocÃª tem um sistema distribuÃ­do, microsserviÃ§os modernos, por exemplo, ainda Ã© mais complicado.  Existem N serviÃ§os diferentes em N mÃ¡quinas diferentes, o relÃ³gio no qual, em geral, nunca pode convergir para uma indicaÃ§Ã£o em princÃ­pio; nÃ£o hÃ¡ nada que esperar. <br><br>  E se vocÃª tiver um problema ao registrar aÃ§Ãµes, poderÃ¡ registrar apenas um vetor de tempo.  Acontece que vocÃª registra N vezes de N sistemas envolvidos no processamento de uma solicitaÃ§Ã£o.  Ou basta ir ao contador de abstratos, que simplesmente aumenta: 1, 2, 3, 4, 5, ele apenas funciona de maneira uniforme em cada mÃ¡quina com esta operaÃ§Ã£o.  E vocÃª escreve esses contadores para vincular todos esses estÃ¡gios de processamento de suas solicitaÃ§Ãµes em mÃ¡quinas diferentes e para entender melhor quando, o que acontece, em que sequÃªncia. <br><br>  TambÃ©m nÃ£o se esqueÃ§a: se vocÃª Ã© front-end ou back-end, que trabalha com o front-end em estreita conexÃ£o, nosso front-end mais back-end tambÃ©m Ã© um sistema distribuÃ­do.  E se vocÃª tambÃ©m estiver interessado em algum tipo de sessÃ£o difÃ­cil do trabalho do cliente, tente tambÃ©m, primeiro, nÃ£o confundir, quando vocÃª olhar nos logs, a que horas vocÃª vÃª: â€œaqui estÃ¡ o registro de que essa operaÃ§Ã£o ocorreu tantas vezes "- vocÃª vÃª a hora do servidor ou a hora do cliente?"  E, em segundo lugar, tente coletar os dois momentos, porque, como eu disse, os tempos podem ir em direÃ§Ãµes diferentes. <br><br>  Chega de tempo.  A segunda parte Ã© mais irregular. <br><br><img src="https://habrastorage.org/webt/l-/qb/6_/l-qb6_jajxvvpdtl-zjoqnv8buw.jpeg"><br><br>  Aqui estÃ¡ um exemplo.  Existe um elemento de interface muito Ãºtil quando o usuÃ¡rio nÃ£o sabe exatamente o que deseja.  Isso Ã© chamado de sugestÃ£o ou preenchimento automÃ¡tico.  Podemos dizer a ele opÃ§Ãµes para continuar a solicitaÃ§Ã£o.  Ou seja, para o usuÃ¡rio, esse Ã© um benefÃ­cio muito grande.  Ã‰ muito mais conveniente para ele trabalhar quando lhe mostramos imediatamente que sabemos o que podemos recrutar ainda mais. <br><br>  Mas, infelizmente, se tivermos uma rede um pouco lenta ou se o back-end, que fornece respostas, opÃ§Ãµes de continuaÃ§Ã£o, diminuir, podemos obter efeitos tÃ£o interessantes.  O usuÃ¡rio digita, digita, entÃ£o a resposta correta vem, nÃ³s a vemos, e entÃ£o tudo quebra.  Por alguma razÃ£o, nÃ£o estamos vendo o que querÃ­amos ver.  Aqui vemos a resposta correta e imediatamente algumas bobagens para algum tipo de estado intermediÃ¡rio.  Mais uma vez, pura dor e sofrimento.  Nossos chefes vÃªm atÃ© nÃ³s e nos pedem para corrigir esse bug. <br><br><img src="https://habrastorage.org/webt/m9/or/5k/m9or5ke01ifxiy_u3peyvcgnpeg.jpeg"><br><br>  ComeÃ§amos a entender.  O que nÃ³s ganhamos?  Quando o usuÃ¡rio digita seu texto, obtemos a geraÃ§Ã£o de solicitaÃ§Ãµes assÃ­ncronas sequenciais.  Ou seja, o que ele conseguiu digitar, enviamos para o back-end.  Ele disca ainda mais, enviamos uma segunda solicitaÃ§Ã£o para o back-end e ninguÃ©m nunca nos garantiu que nossos retornos de chamada serÃ£o chamados exatamente na mesma sequÃªncia. <br><br><img src="https://habrastorage.org/webt/j7/g2/5x/j7g25x0vqaoqeaisui8_cygciuk.jpeg"><br><br>  Essas sÃ£o as possÃ­veis opÃ§Ãµes de consulta e retorno de chamada.  O mais Ã³bvio, quando escrevemos, pensamos: eles enviaram a primeira solicitaÃ§Ã£o, receberam a primeira resposta, enviaram a segunda solicitaÃ§Ã£o, receberam a resposta.  Se o usuÃ¡rio digitar muito rapidamente, podemos pensar na segunda opÃ§Ã£o que conseguimos enviar a primeira solicitaÃ§Ã£o, o usuÃ¡rio conseguiu digitar algo antes de receber a primeira resposta.  EntÃ£o veio a primeira resposta, a segunda resposta.  E aqui estÃ¡ o que vimos no vÃ­deo: quando a sugestÃ£o nÃ£o funcionou corretamente, esta Ã© a terceira opÃ§Ã£o, que muitas vezes Ã© esquecida, de que ninguÃ©m garante a ordem das respostas, em geral. <br><br><img src="https://habrastorage.org/webt/_x/n1/9w/_xn19w1mud_c-xro52pcybgtacs.jpeg"><br><br>  E nos fornecedores front-end, esse problema Ã© muito comum se vocÃª estiver desenvolvendo interfaces.  Em particular, o exemplo com sugere, com preenchimento automÃ¡tico, que acabamos de ver.  Ou seja, hÃ¡ um fluxo de solicitaÃ§Ãµes e um fluxo de respostas chegando de forma assÃ­ncrona. <br><br>  Se vocÃª tiver guias.  Levante as mÃ£os, quem no GitHub fez pelo menos uma solicitaÃ§Ã£o de recebimento?  VocÃª lembra que, aliÃ¡s, a interface com guias Ã© baseada, ou seja, hÃ¡ uma guia onde hÃ¡ uma sequÃªncia de comentÃ¡rios, hÃ¡ uma guia com confirmaÃ§Ãµes e hÃ¡ uma guia com o prÃ³prio cÃ³digo.  Essa Ã© uma interface com guias.  E se vocÃª alternar para uma guia vizinha, seu conteÃºdo serÃ¡ carregado de forma assÃ­ncrona pela primeira vez. <br><br>  Se vocÃª clicar rapidamente em guias diferentes, pode ser que vocÃª as tenha ativado e vocÃª verÃ¡ o carregamento do conteÃºdo piscando.  E, no final, nÃ£o Ã© fato que vocÃª verÃ¡ o conteÃºdo da guia correta; se estiver correto, Ã© claro, nÃ£o escreva o seu. <br><br>  Por exemplo, se vocÃª tiver uma loja, se arrastar rapidamente as mercadorias para a cesta.  Um usuÃ¡rio rÃ¡pido e perspicaz arrastou dez mercadorias e, em seguida, vÃª como seu preÃ§o estÃ¡ piscando e, relativamente falando, 100 rublos, 10 rublos, 50 rublos, 75 rublos e para em um rublo.  Ele nÃ£o acredita em vocÃª, pensa que vocÃª escreve mal, quer enganÃ¡-lo e sai de sua loja sem comprar nada. <br><br>  Um exemplo  Se vocÃª tem algum tipo de scrum ou kanban ou qualquer outra coisa e usa placas eletrÃ´nicas para arrastar e soltar cartÃµes, provavelmente perdeu os cartÃµes pelo menos uma vez quando os arrastou e soltou-os na coluna errada.  Isso aconteceu?  Obviamente, vocÃª se segura, agarra-o imediatamente e arrasta-o para onde deveria estar.  Nesse caso, vocÃª gera rapidamente duas consultas.  E em sistemas diferentes, existem bugs que surgem logo depois disso.  VocÃª arrastou-o para a coluna correta - a resposta para a primeira solicitaÃ§Ã£o chega e o cartÃ£o novamente salta para a coluna onde vocÃª o transferiu.  Acontece muito feio. <br><br><img src="https://habrastorage.org/webt/ss/v-/um/ssv-um8sifk1wwoisjwjtaikwc0.jpeg"><br><br>  Qual Ã© a moral?  Suponha que vocÃª tenha uma fonte do mesmo tipo de solicitaÃ§Ã£o.  Se possÃ­vel, se a prÃ³xima solicitaÃ§Ã£o chegar, interrompa todas as solicitaÃ§Ãµes incompletas para nÃ£o desperdiÃ§ar recursos, para que o back-end saiba - vocÃª nÃ£o precisa mais disso. <br><br>  Assim, ao processar respostas, vocÃª tambÃ©m controla tudo.  E se uma resposta chegar a uma solicitaÃ§Ã£o anterior da qual vocÃª nÃ£o precisa, vocÃª tambÃ©m a ignorarÃ¡ explicitamente. <br><br><img src="https://habrastorage.org/webt/cy/f5/2d/cyf52drbcswd_tva97qt3wrujtg.jpeg"><br><br>  Consequentemente, o problema existe hÃ¡ muito tempo e a soluÃ§Ã£o tambÃ©m jÃ¡ existe.  Por exemplo, na biblioteca RxJS.  Este Ã© diretamente um exemplo da documentaÃ§Ã£o, OlÃ¡, mundo, como escrever o preenchimento automÃ¡tico correto.  Logo que sai da caixa, hÃ¡ um desrespeito Ã s respostas a solicitaÃ§Ãµes incorretas mais antigas. <br><br><img src="https://habrastorage.org/webt/k5/fu/n0/k5fun031njwsqo4jllunepiuqli.jpeg"><br><br>  Se vocÃª escreve no Redux e no Redux-Saga, tambÃ©m existe, em geral, e tudo tambÃ©m estÃ¡ escrito na documentaÃ§Ã£o.  Mas lÃ¡ estÃ¡ profundamente enterrado, e claramente nÃ£o se diz que Ã© um bug e nÃ³s o corrigimos assim.  Apenas uma descriÃ§Ã£o Ã©. <br><br>  Como passamos ao React, vamos nos aproximar dele. <br><br><img src="https://habrastorage.org/webt/a7/an/w-/a7anw-a_ssygckkmxzmolykeau8.jpeg"><br><br>  Este Ã© um pedaÃ§o de cÃ³digo real que tÃ­nhamos em nosso repositÃ³rio.  AlguÃ©m desenha cartas conosco.  E, por favor, quando vocÃª obtiver um mapa, Ã© muito recomendÃ¡vel mostrar uma marca no local onde o usuÃ¡rio estÃ¡ localizado.  Mas tudo isso estÃ¡ acontecendo no navegador.  Ou seja, se vocÃª tiver a geolocalizaÃ§Ã£o ativada, poderemos obter suas coordenadas e indicar diretamente onde vocÃª estÃ¡ no mapa. <br><br>  Se a geolocalizaÃ§Ã£o nÃ£o for permitida ou se ocorrer algum tipo de erro, Ã© aconselhÃ¡vel mostrar algum tipo de dado com um erro.  Ou seja, aqui mostramos o dado, que nÃ£o conseguimos mostrar onde vocÃª estÃ¡, cara, e depois de trÃªs segundos o removemos, esse dado.  VocÃª conseguiu ler, provavelmente.  AlÃ©m disso, um objeto em movimento, como um dado retrÃ¡til e desaparecendo, atrai imediatamente a atenÃ§Ã£o e vocÃª notarÃ¡ imediatamente, lerÃ¡. <br><br>  Mas se vocÃª observar cuidadosamente o que acontece nesse cÃ³digo, alteramos o estado do nosso componente apÃ³s trÃªs segundos no tempo.  Tudo pode acontecer nesses trÃªs segundos.  Se o usuÃ¡rio puder fechar este cartÃ£o por um longo perÃ­odo de tempo e seu componente for desmontado, limpe seu estado. <br><br><img src="https://habrastorage.org/webt/bh/lp/x_/bhlpx_dihsf2ls_0cppixopyhfk.jpeg"><br><br>  Assim, vocÃª atira na perna e atira em uma trajetÃ³ria balÃ­stica, que terminarÃ¡ em trÃªs segundos.  E o que deve ser feito?  NÃ£o esqueÃ§a que, se vocÃª fizer essas operaÃ§Ãµes pendentes, poderÃ¡ limpÃ¡-las corretamente com desmontagem.  E em outras estruturas com outros mÃ©todos de ciclo de vida, o mesmo Ã© lÃ³gico.  Quando vocÃª tem algum tipo de destruiÃ§Ã£o, destruiÃ§Ã£o, outra coisa, desmonte, vocÃª deve se lembrar corretamente de limpar essas coisas. <br><br><img src="https://habrastorage.org/webt/qw/xh/5o/qwxh5oamlezktvcvte5oa-dow_0.jpeg"><br><br>  De onde no navegador seu cÃ³digo pode ser adiado?  Existem coisas como acelerador e debounce.  Eles setTimeout, setInterval, algo que eu jÃ¡ mostrei.  Ainda existe requestAnimationFrame, ainda hÃ¡ requestIdleCallback.  E solicitaÃ§Ãµes AJAX tambÃ©m - os retornos de chamada de solicitaÃ§Ã£o AJAX podem ser chamados adiados.  NÃ£o se esqueÃ§a deles tambÃ©m, eles tambÃ©m precisam ser limpos. <br><br><img src="https://habrastorage.org/webt/13/vj/fi/13vjfi_winr86dmuuwt2rrxv0lq.jpeg"><br><br>  E se mergulharmos ainda mais um nÃ­vel, entenderemos que inicialmente todo o problema Ã© abstraÃ­do para que tenhamos algum tipo de componente com algum tipo de ciclo de vida e adiamos a chamada.  Criamos dentro de um objeto de vida longa, que tem uma vida Ãºtil mais longa que a original.  Ou seja, existem dois objetos com um ciclo de vida incompatÃ­vel, com uma vida Ãºtil incompatÃ­vel.  E a partir disso dois bugs fluem imediatamente. <br><br>  O primeiro Ã© o que temos agora: um objeto de longa duraÃ§Ã£o mantÃ©m um link para sua funÃ§Ã£o e o chama, embora vocÃª jÃ¡ tenha morrido.  E o segundo Ã© o vazamento de memÃ³ria associada.  Ou seja, novamente, um objeto de longa duraÃ§Ã£o mantÃ©m um link para o seu cÃ³digo e nÃ£o permite que ele seja limpo e coletado da memÃ³ria. <br><br>  A terceira parte Ã© o oposto da segunda.  Ela, pelo contrÃ¡rio, Ã© sobre sincronizaÃ§Ã£o. <br><br><img src="https://habrastorage.org/webt/_e/ug/7p/_eug7prdbbmnkh0bypu1h8f64as.jpeg"><br><br>  HÃ¡, como sempre, uma cadeia de promessas - entÃ£o, entÃ£o, entÃ£o algo lÃ¡.  E neste cÃ³digo, se vocÃª olhar, se escrever de maneira correta, se for um apoiador ou tiver ouvido pelo menos sobre a abordagem funcional, sobre funÃ§Ãµes puras, sobre a ausÃªncia de efeitos colaterais, poderÃ¡ entender que algo pode ser feito nesse cÃ³digo acelerar. <br><br>  Como essas duas solicitaÃ§Ãµes sÃ£o assÃ­ncronas, elas sÃ£o claramente independentes uma da outra.  Se vocÃª nÃ£o tiver certeza disso, significa que vocÃª estÃ¡ escrevendo algo errado, ou seja, aÃ­ obviamente vocÃª tem algum tipo de efeito colateral, um estado global e assim por diante.  Se vocÃª escreve bem, isso imediatamente se torna aparente para vocÃª.  A propÃ³sito, aqui estÃ¡ um claro lucro da pureza da funÃ§Ã£o, da falta de efeitos colaterais.  Porque aqui, ao ler este cÃ³digo, vocÃª entende que eles podem ser paralelos.  Eles sÃ£o independentes um do outro.  E, em geral, eles podem atÃ© ser trocados, provavelmente. <br><br><img src="https://habrastorage.org/webt/82/bm/g8/82bmg8vj0qjb2vhwr2_vrr0olue.jpeg"><br><br>  Isso Ã© feito assim.  Executamos duas consultas em paralelo, esperamos que elas terminem e, em seguida, executamos o cÃ³digo a seguir.  Ou seja, lucro em quÃª?  No fato de que, primeiramente, nosso cÃ³digo roda mais rÃ¡pido, nÃ£o esperamos que uma solicitaÃ§Ã£o inicie a segunda.  E nÃ³s cairemos mais rÃ¡pido.  Se houver um erro na segunda solicitaÃ§Ã£o, nÃ£o perderemos tempo aguardando a execuÃ§Ã£o da primeira solicitaÃ§Ã£o para cair imediatamente na segunda. <br><br><img src="https://habrastorage.org/webt/mh/uw/ve/mhuwvecacjcdubinn7cbonc9et0.jpeg"><br><br>  Para ser completo, o que mais temos na API Promise?  Aqui estÃ¡ Promise.all (), que executa todas as solicitaÃ§Ãµes em paralelo e aguarda a execuÃ§Ã£o.  HÃ¡ Promise.race (), que estÃ¡ aguardando o primeiro deles ter Ãªxito.  E, em geral, nÃ£o hÃ¡ mais nada na API padrÃ£o. <br><br><img src="https://habrastorage.org/webt/oh/dc/j_/ohdcj_thprjxpwq0v-7jovrqxq0.jpeg"><br><br>  JÃ¡ entendemos que, se houver um problema, alguÃ©m jÃ¡ o resolveu para nÃ³s.  Existe uma biblioteca Async que possui uma seleÃ§Ã£o bastante rica para gerenciar tarefas assÃ­ncronas.  Existem mÃ©todos para executar tarefas assÃ­ncronas em paralelo.  Existem mÃ©todos para executar seqÃ¼encialmente um apÃ³s o outro.  Existem mÃ©todos para organizar iteradores assÃ­ncronos.  Ou seja, vocÃª sabe que possui, por exemplo, uma matriz na qual pode executar forEach ().  Mas se vocÃª precisar chamar uma funÃ§Ã£o assÃ­ncrona em forEach (), vocÃª terÃ¡ um problema imediatamente e recusarÃ¡ o forEach () e escreverÃ¡ algo por conta prÃ³pria ou usarÃ¡ uma biblioteca pronta para usar as mesmas coisas assÃ­ncronas.  VocÃª entende, chame map () com algum tipo de iterador assÃ­ncrono, chame forEach () - jÃ¡ estÃ¡ na caixa. <br><br><img src="https://habrastorage.org/webt/cj/11/88/cj1188ljs2zlifjl11asukrwtk8.jpeg"><br><br>  Outra alternativa Ã© a biblioteca bluebird.  Existe, como eles chamam, o Promise.any () correto.  , ,     :    N , N - ,      ,  . ,    ,    .      . <br><br>    Promise.race(),  ,  promise ,  , ,  .       .   Promise.any() â€”   reject.         .   reject ,   resolve ,     ,     .                .         promise â€” ,   . <br><br>          ,    map, reduce, each, filter  .   API    ,   Async JS,    .     promise  .  ,     ,     ,    promise.  . <br><br>    promise?     ,  async/await. <br><br><img src="https://habrastorage.org/webt/sk/g8/yk/skg8ykh4v7whmiodqt56tt2h_qy.jpeg"><br><br>       .    .   .     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Â«Â»</a> .     ,   webdriver.  ,   ,       - ,      .       .      .       webdriver. <br><br>        ,  await.      .   ,    - .    await,        â€”  ,         ,   !        . <br><br><img src="https://habrastorage.org/webt/3q/qa/dy/3qqadyikzcuaokpg9xfephpstbg.jpeg"><br><br>       â€” Promise.all().     ,      await. <br><br><img src="https://habrastorage.org/webt/jd/c8/-6/jdc8-6d3yw-_jpvwujdwoaxhx9m.jpeg"><br><br> : await  ,   then  .       ,      . <br><br>  ,    .  :       await,        , â€” ,        . <br><br>   ,   ,   : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Promise</a>  Mozilla Developer Network. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Async</a>  GitHub. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Bluebird</a> . </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RxJS 4</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RxJS 5+</a> . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Monotonic Clocks in Windows and POSIX</a> â€”        ,  Windows   POSIX- . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  ,  ntpd  ,   ,        . </li></ul><br>     , -,        : <br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="></a>  ,  -   NTP daemon       Hadoop. </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  Cloudflare DNS</a> ,    -  , -  . </li><li>   Â«Â» <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">  </a> .        .              ,    ,   . </li></ul><br>      ?   ,     â€” Lodash, RxJS  . .    ,   .   ,   -   .   .      â€”   , ,     .   . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463203/">https://habr.com/ru/post/pt463203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463185/index.html">QuÃ£o poderosos terremotos bolivianos descobriram montanhas a uma profundidade de 660 quilÃ´metros no subsolo</a></li>
<li><a href="../pt463189/index.html">Sobre o anonimato na Internet, a vida e sua relatividade</a></li>
<li><a href="../pt463193/index.html">Converta imagens em preto e branco em grÃ¡ficos ASCII usando decomposiÃ§Ã£o de matriz nÃ£o negativa</a></li>
<li><a href="../pt463195/index.html">O que estÃ¡ acontecendo com a Internet Tele2</a></li>
<li><a href="../pt463197/index.html">Blazor + MVVM = Silverlight ataca porque o mal antigo Ã© invencÃ­vel</a></li>
<li><a href="../pt463205/index.html">Inicialmente inoperante: como sobreviver com um laptop no Windows 10 e uma unidade de 32 gigabytes</a></li>
<li><a href="../pt463207/index.html">Desenvolvimento Chatbot (telegrama + youtube)</a></li>
<li><a href="../pt463213/index.html">Conceitos errados para desenvolvedores iniciantes em C #. Tentando responder a perguntas padrÃ£o</a></li>
<li><a href="../pt463215/index.html">Engenheiros e arquitetos jÃ¡ estÃ£o projetando assentamentos lunares</a></li>
<li><a href="../pt463221/index.html">Watching the Sun: 5 tipos de gadgets, de US $ 5 a US $ 5.000</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>