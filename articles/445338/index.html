<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚥 😱 🔽 Servidor DHCP + Mysql en Python 🚡 🧕🏿 🤹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El propósito de este proyecto fue: 



- Aprendizaje de DHCP a través de una red IPv4 
- Python de aprendizaje (un poco más que desde cero;)) 
- reemp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Servidor DHCP + Mysql en Python</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445338/"><img src="https://habrastorage.org/webt/ju/n4/fb/jun4fbrj-eabxfgou112uxc5lac.png"><br><br>  El propósito de este proyecto fue: <br><br><ul><li>  Aprendizaje de DHCP a través de una red IPv4 </li><li>  Python de aprendizaje (un poco más que desde cero;)) </li><li>  reemplazando el servidor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DB2DHCP</a> (mi fork), el original <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> , que es cada vez más difícil de ensamblar bajo el nuevo sistema operativo.  Sí, y no me gusta que el binario, que no es posible "cambiar en este momento" </li><li>  obtener un servidor DHCP que funcione con la capacidad de seleccionar la dirección IP del suscriptor por mac del suscriptor o un grupo de conmutadores mac + puerto (Opción 82) </li><li>  escribiendo otra bicicleta (¡Oh! este es mi pasatiempo favorito) </li><li>  obtener Lyuli sobre su estrabismo en Habrahabr (o mejor invitación);) </li></ul><br>  Resultado: funciona;) Probado en FreeBSD y Ubuntu OS.  Teóricamente, se le puede pedir al código que funcione bajo cualquier sistema operativo, porque  No hay enlaces específicos en el código. <br>  Precaución  Mucho más lejos. <br><a name="habracut"></a><br>  Enlace al repositorio para que los fanáticos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"toquen vivos"</a> . <br><br>  El proceso de instalación, configuración y uso del resultado del "estudio del hardware" es mucho más bajo, y luego una pequeña teoría sobre el protocolo DHCP.  Para mi  Y para la historia;) <br><br><h1>  Un poco de teoría </h1><br><h2>  ¿Qué es el DHCP? </h2><br>  Este es un protocolo de red que permite que un dispositivo encuentre su dirección IP (bueno, otros parámetros como una puerta de enlace, DNS, etc.) desde un servidor DHCP.  Los paquetes se intercambian a través de UDP.  El principio general de funcionamiento del dispositivo cuando se solicitan parámetros de red es el siguiente: <br><br><ol><li>  El dispositivo (cliente) envía una solicitud de difusión UDP (DHCPDISCOVER) a través de la red con la solicitud "Bueno, alguien, dame una dirección IP".  Y generalmente (pero no siempre) la solicitud es del puerto 68 (fuente), y el destino es el puerto 67 (destino).  Algunos dispositivos también envían paquetes desde el puerto 67.  Dentro del paquete DHCPDISCOVER, se incluye la dirección MAC del dispositivo cliente. </li><li>  Todos los servidores DHCP ubicados en la red (y puede haber varios) forman el dispositivo que envió a DHCPDISCOVER una oración DHCPOFFER con configuraciones de red, y también la transmite a través de la red.  La identificación a quién está destinado este paquete va a la dirección MAC del cliente proporcionada anteriormente en la solicitud DHCPDISCOVER. </li><li>  El cliente recibe paquetes con ofertas de configuraciones de red, selecciona los más atractivos (los criterios pueden ser diferentes, por ejemplo, en el momento de la entrega de paquetes, el número de rutas intermedias) y hace que el servidor DHCP "solicite oficialmente" DHCPREQUEST con configuraciones de red.  En este caso, el paquete va a un servidor DHCP específico. </li><li>  El servidor que recibió DHCPREQUEST envía un paquete DHCPACK en el que una vez más enumera la configuración de red para este cliente </li></ol><br><img src="https://habrastorage.org/webt/ki/vj/cn/kivjcno-qcqpx8jgqxra1rnspvi.png"><br><br>  Además, hay paquetes DHCPINFORM que provienen del cliente y cuyo propósito es informar al servidor DHCP que el "cliente está vivo" y utiliza la configuración de red emitida.  En la implementación de este servidor, estos paquetes se ignoran. <br><br><h2>  Formato de paquete </h2><br><br>  En general, la trama del paquete Ethernet se ve así: <br><br><img src="https://habrastorage.org/webt/x6/uj/n0/x6ujn0ood0nch96zosj6ldkjt4s.png"><br><br>  En nuestro caso, solo consideraremos los datos directamente del contenido del paquete UDP, sin los encabezados del protocolo de capa OSI, es decir, la estructura DHCP: <br><br><h3>  DHCPDISCOVER </h3><br>  Entonces, el proceso para obtener la dirección IP del dispositivo comienza con el hecho de que el cliente DHCP envía una solicitud de transmisión desde el puerto 68 al 255.255.255.255:67.  En este paquete, el cliente incluye su dirección MAC, así como lo que quiere recibir del servidor DHCP.  La estructura del paquete se describe en la tabla a continuación. <br><br><div class="spoiler">  <b class="spoiler_title">Tabla de estructura de paquetes DHCPDISCOVER</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posición del paquete </td><td align="left">  Nombre del valor </td><td align="right">  Ejemplo </td><td align="center">  Sumisión </td><td align="center">  Byte </td><td align="left">  Explicación </td></tr><tr><td align="right">  1 </td><td align="left">  Solicitud de arranque </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de mensaje  1 - solicitud del cliente al servidor, 2 - respuesta del servidor al cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de dirección de hardware, en este protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Longitud de adrees de hardware </td><td align="right">  6 6 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Longitud de la dirección MAC del dispositivo </td></tr><tr><td align="right">  4 4 </td><td align="left">  Lúpulo </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Numero de rutas intermedias </td></tr><tr><td align="right">  5 5 </td><td align="left">  ID de transacción </td><td align="right">  23: cf: de: 1d </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Identificador único de la transacción.  Generado por el cliente al comienzo de la operación de solicitud. </td></tr><tr><td align="right">  7 7 </td><td align="left">  Segundo transcurrido </td><td align="right">  0 0 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Tiempo en segundos desde el inicio del proceso de obtención de la dirección. </td></tr><tr><td align="right">  9 9 </td><td align="left">  Banderas de Bootp </td><td align="right">  0 0 </td><td align="center">  Maleficio </td><td align="right">  2 </td><td align="left">  Algunas banderas que se pueden configurar como una indicación de los parámetros del protocolo </td></tr><tr><td align="right">  11 </td><td align="left">  Dirección IP del cliente </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del cliente (si la hay) </td></tr><tr><td align="right">  15 </td><td align="left">  La dirección IP de su cliente </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP propuesta por el servidor (si existe) </td></tr><tr><td align="right">  19 </td><td align="left">  Siguiente dirección IP del servidor </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del servidor (si se conoce) </td></tr><tr><td align="right">  23 </td><td align="left">  Dirección IP del agente de retransmisión </td><td align="right">  172.16.114.41 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del agente de retransmisión (por ejemplo, un conmutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Dirección MAC del cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Maleficio </td><td align="right">  6 6 </td><td align="left">  Dirección MAC del remitente del paquete (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Relleno de dirección de hardware del cliente </td><td align="right"></td><td align="center">  Maleficio </td><td align="right">  10 </td><td align="left">  Lugar reservado  Generalmente ceros </td></tr><tr><td align="right">  41 </td><td align="left">  Nombre de host del servidor </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  64 </td><td align="left">  El nombre del servidor DHCP.  Generalmente no se transmite </td></tr><tr><td align="right">  105 </td><td align="left">  Nombre del archivo de arranque </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  128 </td><td align="left">  El nombre del archivo en el servidor utilizado por las estaciones sin disco durante el arranque </td></tr><tr><td align="right">  235 </td><td align="left">  Galleta mágica </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  El número "mágico", por el cual incl.  puede determinar que este paquete pertenece al protocolo DHCP </td></tr><tr><td colspan="7" align="center">  Opciones de DHCP.  Puede ir en cualquier orden </td></tr><tr><td align="right">  236 </td><td align="left">  Numero de opcion </td><td align="right">  53 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción 53 que especifica el tipo de paquete DHCP <br><br>  1 - DHCPDISCOVER <br>  3 - DHCPREQUEST <br>  2 - DHCPOFFER <br>  5 - DHCPACK <br>  8 - DHCPINFORM </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  50 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  ¿Qué dirección IP desea recibir el cliente? </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  172.16.134.61 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  55 </td><td align="center"></td><td align="right">  1 </td><td rowspan="3" align="left">  Los parámetros de red solicitados por el cliente.  La composición puede ser diferente <br><br>  01 - Máscara de red <br>  03 - Gateway <br>  06 - DNS <br>  oc - nombre de host <br>  0f - nombre de dominio de red <br>  1c - dirección de la solicitud de difusión (Broadcast) <br>  42 - Nombre del servidor TFTP <br>  79 - Ruta estática sin clase </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  8 </td><td align="center"></td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01: 03: 06: 0c: 0f: 1c: 42: 79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  82 </td><td align="center">  Dic </td><td align="left"></td><td rowspan="3" align="left">  Opción 82, en la que se transmiten la dirección MAC del dispositivo repetidor y algunos valores adicionales. <br><br>  Muy a menudo, el puerto del conmutador en el que se ejecuta el cliente final de DHCP. Las opciones adicionales están "integradas" en esta opción. El primer byte es el número de la "subopción", el segundo es su longitud y luego su valor. <br><br>  En este caso, en la opción 82, las subopciones están anidadas: <br>  ID de circuito del agente = 00: 04: 00: 01: 00: 04, donde los dos últimos bytes son el puerto del cliente DHCP del que proviene la solicitud <br><br>  ID remoto del agente = 00: 06: c8: be: 19: 93: 11: 48 - Dirección MAC del dispositivo de retransmisión DHCP </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  18 años </td><td align="center">  Dic </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01:06 <br>  00: 04: 00: 01: 00: 04 <br>  02:08 <br>  00: 06: c8: be: 19: 93: 11: 48 </td><td align="center">  Maleficio </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Fin del paquete </td><td align="right">  255 </td><td align="center">  Dic </td><td align="right">  1 </td><td align="left">  255 simboliza el final del paquete </td></tr></tbody></table><br></div></div><br><h3>  DHCPOFFER </h3><br>  Tan pronto como el servidor recibe el paquete DHCPDISCOVER y si ve que puede ofrecerle al cliente algo del pedido, entonces forma una respuesta: DHCPOFFER.  La respuesta se envía al puerto "de donde vino", Broadcast, porque  en este momento, el cliente aún no tiene una dirección IP, por lo tanto, puede recibir un paquete solo si se envía difusión.  El cliente reconoce que es un paquete para él por MAC en su dirección dentro del paquete, así como el número de transacción que genera al momento de la creación del primer paquete. <br><br><div class="spoiler">  <b class="spoiler_title">Tabla de estructura de paquetes DHCPOFFER</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posición del paquete </td><td align="left">  Nombre del valor (común) </td><td align="right">  Ejemplo </td><td align="center">  Sumisión </td><td align="center">  Byte </td><td align="left">  Explicación </td></tr><tr><td align="right">  1 </td><td align="left">  Solicitud de arranque </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de mensaje  1 - solicitud del cliente al servidor, 2 - respuesta del servidor al cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de dirección de hardware, en este protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Longitud de adrees de hardware </td><td align="right">  6 6 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Longitud de la dirección MAC del dispositivo </td></tr><tr><td align="right">  4 4 </td><td align="left">  Lúpulo </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Numero de rutas intermedias </td></tr><tr><td align="right">  5 5 </td><td align="left">  ID de transacción </td><td align="right">  23: cf: de: 1d </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Identificador único de la transacción.  Generado por el cliente al comienzo de la operación de solicitud. </td></tr><tr><td align="right">  7 7 </td><td align="left">  Segundo transcurrido </td><td align="right">  0 0 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Tiempo en segundos desde el inicio del proceso de obtención de la dirección. </td></tr><tr><td align="right">  9 9 </td><td align="left">  Banderas de Bootp </td><td align="right">  0 0 </td><td align="center">  Maleficio </td><td align="right">  2 </td><td align="left">  Algunas banderas que se pueden configurar como una indicación de los parámetros del protocolo.  En este caso, 0 significa el tipo de solicitud Unicast </td></tr><tr><td align="right">  11 </td><td align="left">  Dirección IP del cliente </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del cliente (si la hay) </td></tr><tr><td align="right">  15 </td><td align="left">  La dirección IP de su cliente </td><td align="right">  172.16.134.61 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP propuesta por el servidor (si existe) </td></tr><tr><td align="right">  19 </td><td align="left">  Siguiente dirección IP del servidor </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del servidor (si se conoce) </td></tr><tr><td align="right">  23 </td><td align="left">  Dirección IP del agente de retransmisión </td><td align="right">  172.16.114.41 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del agente de retransmisión (por ejemplo, un conmutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Dirección MAC del cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Maleficio </td><td align="right">  6 6 </td><td align="left">  Dirección MAC del remitente del paquete (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Relleno de dirección de hardware del cliente </td><td align="right"></td><td align="center">  Maleficio </td><td align="right">  10 </td><td align="left">  Lugar reservado  Generalmente ceros </td></tr><tr><td align="right">  41 </td><td align="left">  Nombre de host del servidor </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  64 </td><td align="left">  El nombre del servidor DHCP.  Generalmente no se transmite </td></tr><tr><td align="right">  105 </td><td align="left">  Nombre del archivo de arranque </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  128 </td><td align="left">  El nombre del archivo en el servidor utilizado por las estaciones sin disco durante el arranque </td></tr><tr><td align="right">  235 </td><td align="left">  Galleta mágica </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  El número "mágico", por el cual incl.  puede determinar que este paquete pertenece al protocolo DHCP </td></tr><tr><td colspan="6" align="center">  Opciones de DHCP.  Puede ir en cualquier orden </td></tr><tr><td align="right">  236 </td><td align="left">  Numero de opcion </td><td align="right">  53 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción 53 que especifica el tipo de paquete DHCP 2 - DHCPOFFER </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  2 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción que ofrece la máscara de red del cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  255.255.224.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  3 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción que ofrece la puerta de enlace predeterminada del cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  172.16.12.1 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  6 6 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción que ofrece DHCP al cliente DNS </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  8.8.8.8 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  51 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  La vida útil de los parámetros de red emitidos en segundos, después de lo cual el cliente DHCP debe solicitarlos nuevamente </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  86400 </td><td align="center">  Dic </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  82 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción 82, repite lo que vino en DHCPDISCOVER </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  18 años </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dic </td><td align="right">  18 años </td></tr><tr><td align="left"></td><td align="left">  Fin del paquete </td><td align="right">  255 </td><td align="center">  Dic </td><td align="right">  1 </td><td align="left">  255 simboliza el final del paquete </td></tr></tbody></table><br></div></div><br><h3>  DHCPREQUEST </h3><br>  Después de que el cliente recibe DHCPOFFER, forma un paquete con una solicitud de parámetros de red, no a todos los servidores DHCP de la red, sino solo a uno específico, cuya propuesta DHCPOFFER le gustó más.  Los criterios para "me gusta" pueden ser diferentes y dependen de la implementación del cliente DHCP.  El destinatario de la solicitud se indica utilizando la dirección MAC del servidor DHCP.  Además, el cliente puede enviar el paquete DHCPREQUEST sin formar DHCPDISCOVER anteriormente, si la dirección IP del servidor se recibió anteriormente. <br><br><div class="spoiler">  <b class="spoiler_title">Tabla de estructura de paquetes DHCPREQUEST</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posición del paquete </td><td align="left">  Nombre del valor (común) </td><td align="right">  Ejemplo </td><td align="center">  Sumisión </td><td align="center">  Byte </td><td align="left">  Explicación </td></tr><tr><td align="right">  1 </td><td align="left">  Solicitud de arranque </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de mensaje  1 - solicitud del cliente al servidor, 2 - respuesta del servidor al cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de dirección de hardware, en este protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Longitud de adrees de hardware </td><td align="right">  6 6 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Longitud de la dirección MAC del dispositivo </td></tr><tr><td align="right">  4 4 </td><td align="left">  Lúpulo </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Numero de rutas intermedias </td></tr><tr><td align="right">  5 5 </td><td align="left">  ID de transacción </td><td align="right">  23: cf: de: 1d </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Identificador único de la transacción.  Generado por el cliente al comienzo de la operación de solicitud. </td></tr><tr><td align="right">  7 7 </td><td align="left">  Segundo transcurrido </td><td align="right">  0 0 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Tiempo en segundos desde el inicio del proceso de obtención de la dirección. </td></tr><tr><td align="right">  9 9 </td><td align="left">  Banderas de Bootp </td><td align="right">  8000 </td><td align="center">  Maleficio </td><td align="right">  2 </td><td align="left">  Algunas banderas que se pueden configurar como una indicación de los parámetros del protocolo.  En este caso, "Broadcast" </td></tr><tr><td align="right">  11 </td><td align="left">  Dirección IP del cliente </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del cliente (si la hay) </td></tr><tr><td align="right">  15 </td><td align="left">  La dirección IP de su cliente </td><td align="right">  172.16.134.61 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP propuesta por el servidor (si existe) </td></tr><tr><td align="right">  19 </td><td align="left">  Siguiente dirección IP del servidor </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del servidor (si se conoce) </td></tr><tr><td align="right">  23 </td><td align="left">  Dirección IP del agente de retransmisión </td><td align="right">  172.16.114.41 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del agente de retransmisión (por ejemplo, un conmutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Dirección MAC del cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Maleficio </td><td align="right">  6 6 </td><td align="left">  Dirección MAC del remitente del paquete (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Relleno de dirección de hardware del cliente </td><td align="right"></td><td align="center">  Maleficio </td><td align="right">  10 </td><td align="left">  Lugar reservado  Generalmente ceros </td></tr><tr><td align="right">  41 </td><td align="left">  Nombre de host del servidor </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  64 </td><td align="left">  El nombre del servidor DHCP.  Generalmente no se transmite </td></tr><tr><td align="right">  105 </td><td align="left">  Nombre del archivo de arranque </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  128 </td><td align="left">  El nombre del archivo en el servidor utilizado por las estaciones sin disco durante el arranque </td></tr><tr><td align="right">  235 </td><td align="left">  Galleta mágica </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  El número "mágico", por el cual incl.  puede determinar que este paquete pertenece al protocolo DHCP </td></tr><tr><td colspan="6" align="center">  Opciones de DHCP.  Puede ir en cualquier orden </td></tr><tr><td align="right">  236 </td><td align="left">  Numero de opcion </td><td align="right">  53 </td><td align="center">  Dic </td><td align="right">  3 </td><td rowspan="3" align="left">  Opción 53 que especifica el tipo de paquete DHCP 3 - DHCPREQUEST </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  3 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  61 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  ID de cliente: 01 (para Ehernet) + dirección MAC del cliente </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  7 7 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01: 2c: ab: 25: ff: 72: a6 </td><td align="center">  Maleficio </td><td align="right">  7 7 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  60 60 </td><td align="center">  Dic </td><td align="left"></td><td rowspan="3" align="left">  "Identificador de clase de proveedor".  En mi caso, se informa la versión del cliente DHCP.  Quizás otros dispositivos devuelvan algo más.  Windows, por ejemplo, informa MSFT 5.0 </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  11 </td><td align="center">  Dic </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  udhcp 0.9.8 </td><td align="center">  Cadena </td><td align="left"></td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  55 </td><td align="center"></td><td align="right">  1 </td><td rowspan="3" align="left">  Los parámetros de red solicitados por el cliente.  La composición puede ser diferente <br><br>  01 - Máscara de red <br>  03 - Gateway <br>  06 - DNS <br>  oc - nombre de host <br>  0f - nombre de dominio de red <br>  1c - dirección de la solicitud de difusión (Broadcast) <br>  42 - Nombre del servidor TFTP <br>  79 - Ruta estática sin clase </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  8 </td><td align="center"></td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01: 03: 06: 0c: 0f: 1c: 42: 79 </td><td align="center"></td><td align="right">  8 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  82 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción 82, repite lo que vino en DHCPDISCOVER </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  18 años </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dic </td><td align="right">  18 años </td></tr><tr><td align="left"></td><td align="left">  Fin del paquete </td><td align="right">  255 </td><td align="center">  Dic </td><td align="right">  1 </td><td align="left">  255 simboliza el final del paquete </td></tr></tbody></table><br></div></div><br><h3>  DHCPACK </h3><br>  Como confirmación del hecho de que "sí, es su dirección IP, y no se la daré a nadie más" desde el servidor DHCP, hay un paquete en formato DHCPACK del servidor al cliente.  Es lo mismo que el resto de los paquetes enviados transmitidos.  Aunque, en el siguiente código del servidor DHCP implementado en Python, por si acaso, duplico cualquier solicitud de transmisión enviando un paquete a una IP de cliente específica, si ya se conoce.  Además, al servidor DHCP no le importa en absoluto si el paquete DHCPACK ha llegado al cliente.  Si el cliente no recibe DHCPACK, luego de un tiempo simplemente repite DHCPREQUEST <br><br><div class="spoiler">  <b class="spoiler_title">Tabla de estructura de paquetes DHCPACK</b> <div class="spoiler_text"><table border="1"><tbody><tr><td align="left">  Posición del paquete </td><td align="left">  Nombre del valor (común) </td><td align="right">  Ejemplo </td><td align="center">  Sumisión </td><td align="center">  Byte </td><td align="left">  Explicación </td></tr><tr><td align="right">  1 </td><td align="left">  Solicitud de arranque </td><td align="right">  2 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de mensaje  1 - solicitud del cliente al servidor, 2 - respuesta del servidor al cliente </td></tr><tr><td align="right">  2 </td><td align="left">  Tipo de hardware </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Tipo de dirección de hardware, en este protocolo 1 - MAC </td></tr><tr><td align="right">  3 </td><td align="left">  Longitud de adrees de hardware </td><td align="right">  6 6 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Longitud de la dirección MAC del dispositivo </td></tr><tr><td align="right">  4 4 </td><td align="left">  Lúpulo </td><td align="right">  1 </td><td align="center">  Maleficio </td><td align="right">  1 </td><td align="left">  Numero de rutas intermedias </td></tr><tr><td align="right">  5 5 </td><td align="left">  ID de transacción </td><td align="right">  23: cf: de: 1d </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Identificador único de la transacción.  Generado por el cliente al comienzo de la operación de solicitud. </td></tr><tr><td align="right">  7 7 </td><td align="left">  Segundo transcurrido </td><td align="right">  0 0 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  Tiempo en segundos desde el inicio del proceso de obtención de la dirección. </td></tr><tr><td align="right">  9 9 </td><td align="left">  Banderas de Bootp </td><td align="right">  8000 </td><td align="center">  Maleficio </td><td align="right">  2 </td><td align="left">  Algunas banderas que se pueden configurar como una indicación de los parámetros del protocolo.  En este caso, "Broadcast" </td></tr><tr><td align="right">  11 </td><td align="left">  Dirección IP del cliente </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del cliente (si la hay) </td></tr><tr><td align="right">  15 </td><td align="left">  La dirección IP de su cliente </td><td align="right">  172.16.134.61 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP propuesta por el servidor (si existe) </td></tr><tr><td align="right">  19 </td><td align="left">  Siguiente dirección IP del servidor </td><td align="right">  0.0.0.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del servidor (si se conoce) </td></tr><tr><td align="right">  23 </td><td align="left">  Dirección IP del agente de retransmisión </td><td align="right">  172.16.114.41 </td><td align="center">  Cadena </td><td align="right">  4 4 </td><td align="left">  Dirección IP del agente de retransmisión (por ejemplo, un conmutador) </td></tr><tr><td align="right">  27 </td><td align="left">  Dirección MAC del cliente </td><td align="right">  14: d6: 4d: a7: c9: 55 </td><td align="center">  Maleficio </td><td align="right">  6 6 </td><td align="left">  Dirección MAC del remitente del paquete (cliente) </td></tr><tr><td align="right">  31 </td><td align="left">  Relleno de dirección de hardware del cliente </td><td align="right"></td><td align="center">  Maleficio </td><td align="right">  10 </td><td align="left">  Lugar reservado  Generalmente ceros </td></tr><tr><td align="right">  41 </td><td align="left">  Nombre de host del servidor </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  64 </td><td align="left">  El nombre del servidor DHCP.  Generalmente no se transmite </td></tr><tr><td align="right">  105 </td><td align="left">  Nombre del archivo de arranque </td><td align="right"></td><td align="center">  Cadena </td><td align="right">  128 </td><td align="left">  El nombre del archivo en el servidor utilizado por las estaciones sin disco durante el arranque </td></tr><tr><td align="right">  235 </td><td align="left">  Galleta mágica </td><td align="right">  63: 82: 53: 63 </td><td align="center">  Maleficio </td><td align="right">  4 4 </td><td align="left">  El número "mágico", por el cual incl.  puede determinar que este paquete pertenece al protocolo DHCP </td></tr><tr><td colspan="6" align="center">  Opciones de DHCP.  Puede ir en cualquier orden </td></tr><tr><td align="right">  236 </td><td align="left">  Numero de opcion </td><td align="right">  53 </td><td align="center">  Dic </td><td align="right">  3 </td><td rowspan="3" align="left">  Opción 53 que especifica el tipo de paquete DHCP 5 - DHCPACK </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  5 5 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  1 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción que ofrece la máscara de red del cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  255.255.224.0 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  3 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción que ofrece la puerta de enlace predeterminada del cliente DHCP </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  172.16.12.1 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  6 6 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción que ofrece DHCP al cliente DNS </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  8.8.8.8 </td><td align="center">  Cadena </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  51 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  La vida útil de los parámetros de red emitidos en segundos, después de lo cual el cliente DHCP debe solicitarlos nuevamente </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  4 4 </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  86400 </td><td align="center">  Dic </td><td align="right">  4 4 </td></tr><tr><td align="left"></td><td align="left">  Numero de opcion </td><td align="right">  82 </td><td align="center">  Dic </td><td align="right">  1 </td><td rowspan="3" align="left">  Opción 82, repite lo que vino en DHCPDISCOVER </td></tr><tr><td align="left"></td><td align="left">  Longitud de la opción </td><td align="right">  18 años </td><td align="center">  Dic </td><td align="right">  1 </td></tr><tr><td align="left"></td><td align="left">  Valor de la opción </td><td align="right">  01: 08: 00: 06: 00 <br>  01: 01: 00: 00: 01 <br>  02: 06: 00: 03: 0f <br>  26: 4d: ec </td><td align="center">  Dic </td><td align="right">  18 años </td></tr><tr><td align="left"></td><td align="left">  Fin del paquete </td><td align="right">  255 </td><td align="center">  Dic </td><td align="right">  1 </td><td align="left">  255 simboliza el final del paquete </td></tr></tbody></table><br></div></div><br><br><h1>  Instalación </h1><br>  La instalación en realidad consiste en instalar los módulos de Python necesarios para el trabajo.  Se supone que MySQL ya está instalado y configurado. <br><br><h2>  Freebsd </h2><br><pre>  paquete instalar python3
 python3 -m surepip
 pip3 instalar mysql-connector </pre><br><h2>  Ubuntu </h2><br><pre>  sudo apt-get install python3
 sudo apt-get install pip3
 sudo pip3 install mysql-connector </pre><br>  Creamos la base de datos MySQL, rellenamos el volcado pydhcp.sql, configuramos el archivo de configuración. <br><br><h1>  Configuracion </h1><br>  Todas las configuraciones del servidor están en el formato de archivo xml.  Archivo de referencia: <br><br><pre>  &lt;? xml version = "1.0"?&gt;
 &lt;config&gt;
     &lt;dhcpserver&gt;
	 &lt;host&gt; 0.0.0.0 &lt;/host&gt;
         &lt;broadcast&gt; 255.255.255.255 &lt;/broadcast&gt;
         &lt;DHCPServer&gt; 192.168.0.71 &lt;/DHCPServer&gt;
	 &lt;LeaseTime&gt; 8600 &lt;/LeaseTime&gt;
	 &lt;ThreadLimit&gt; 1 &lt;/ThreadLimit&gt;
         &lt;defaultMask&gt; 255.255.255.0 &lt;/defaultMask&gt;
         &lt;defaultRouter&gt; 192.168.0.1 &lt;/defaultRouter&gt;
         &lt;defaultDNS&gt; 8.8.8.8 &lt;/defaultDNS&gt;
     &lt;/dhcpserver&gt;
     &lt;mysql&gt;
         &lt;host&gt; localhost &lt;/host&gt;
	 &lt;username&gt; prueba &lt;/username&gt;
	 &lt;password&gt; prueba &lt;/password&gt;
	 &lt;basename&gt; pydhcp &lt;/basename&gt;
     &lt;/mysql&gt;
     &lt;opciones&gt;
        &lt;option&gt; option_82_hex: sw_port1: 20:22 &lt;/option&gt;       
        &lt;option&gt; option_82_hex: sw_port2: 16:18 &lt;/option&gt;       
        &lt;option&gt; option_82_hex: sw_mac: 26: 40 &lt;/option&gt;
     &lt;/options&gt;    
     &lt;consulta&gt;
         &lt;offer_count&gt; 3 &lt;/offer_count&gt;
	 &lt;offer_1&gt; seleccione ip, máscara, enrutador, dns de los usuarios donde upper (mac) = upper ('{option_82_AgentRemoteId_hex}') y upper (port) = upper ('{option_82_AgentCircuitId_port_hex}') &lt;/offer_1&gt;
         &lt;offer_2&gt; seleccione ip, máscara, enrutador, dns de los usuarios donde upper (mac) = upper ('{sw_mac}') y upper (port) = upper ('{sw_port2}') &lt;/offer_2&gt;
         &lt;offer_3&gt; seleccione ip, máscara, enrutador, dns de los usuarios donde upper (mac) = upper ('{ClientMacAddress}') &lt;/offer_3&gt;
	 &lt;history_sql&gt; insertar en el historial (id, dt, mac, ip, comment) valores (nulo, ahora (), '{ClientMacAddress}', '{RequestedIpAddress}', 'DHCPACK / INFORM') &lt;/history_sql&gt;
     &lt;/query&gt;
 &lt;/config&gt; </pre><br>  Ahora con más detalle en las etiquetas: <br><br>  La sección dhcpserver describe la configuración básica para iniciar el servidor, a saber: <br><ul><li>  host: qué dirección IP está escuchando el servidor en el puerto 67 </li><li>  broadcast: qué ip es una difusión para DHCPOFFER y DHCPACK </li><li>  DHCPServer: ¿cuál es la ip del servidor DHCP? </li><li>  Tiempo de arrendamiento de LeaseTime de la dirección IP emitida </li><li>  ThreadLimit: cuántos subprocesos se ejecutan simultáneamente para procesar paquetes UDP entrantes en el puerto 67. Se supone que esto ayudará en proyectos altamente cargados;) </li><li>  defaultMask, defaultRouter, defaultDNS: lo que se ofrece al suscriptor de forma predeterminada si se encuentra IP en la base de datos, pero no se especifican parámetros adicionales para él </li></ul><br>  Sección Mysql: <br><br>  host, nombre de usuario, contraseña, nombre base: todo habla por sí mismo.  Estructura de base de datos de muestra publicada en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> <br><br>  Sección de consulta: Esta sección describe las solicitudes de OFERTA / ACK: <br><br><ul><li>  offer_count: el número de líneas con solicitudes que devuelven un resultado de la forma ip, máscara, enrutador, dns </li><li>  offer_n es la cadena de consulta.  Si la devolución está vacía, se ejecuta la siguiente solicitud de oferta </li><li>  history_sql: solicitud de escritura, por ejemplo, al "historial de autorizaciones" por suscriptor </li></ul><br>  Cualquier variable de la sección de opciones u opciones del protocolo DHCP puede participar en las solicitudes. <br><br>  Opciones de sección.  Aquí ya es más interesante.  Aquí podemos crear variables que podemos usar más adelante en la sección de consulta. <br><br>  Por ejemplo: <br><br><pre><code class="plaintext hljs">option_82_hex:sw_port1:20:22</code> </pre> <br>  , esta línea es el comando para tomar toda la línea que vino en la solicitud DHCP de la opción 82, en formato hexadecimal, en el rango de 20 a 22 bytes, inclusive, y ponerla en la nueva variable sw_port1 (el puerto del conmutador de donde vino la solicitud) <br><br><pre> <code class="plaintext hljs">option_82_hex:sw_mac:26:40</code> </pre> <br>  , defina la variable sw_mac, tomando hex del rango 26:40 <br><br>  Puede ver todas las opciones posibles que se pueden usar en las consultas iniciando el servidor con el modificador -d.  Veremos algo como este registro: <br><br><pre>  - el paquete DHCPINFORM llegó en el puerto 67, desde 0025224ad764, b '\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a', ('172.30.114.25', 68)
 {'ClientMacAddress': '0025224ad764',
  'ClientMacAddressByte': b '\ x00% "J \ xd7d',
  'HType': 'Ethernet',
  'HostName': b '\ x91 \ xa5 \ xe0 \ xa3 \ xa5 \ xa9- \ x8f \ x8a',
  'ReqListDNS': verdadero,
  'ReqListDomainName': verdadero,
  'ReqListPerfowmRouterDiscover': verdadero,
  'ReqListRouter': verdadero,
  'ReqListStaticRoute': verdadero,
  'ReqListSubnetMask': verdadero,
  'ReqListVendorSpecInfo': 43,
  'RequestedIpAddress': '0.0.0.0',
  'Proveedor': b'MSFT 5.0 ',
  'chaddr': '0025224ad764',
  'ciaddr': '172.30.128.13',
  'flags': b '\ x00 \ x00',
  'giaddr': '172.30.114.25',
  'gpoz': 308,
  'hlen': 6,
  'lúpulo': 1,
  'htype': 'MAC',
  'magic_cookie': b'c \ x82Sc ',
  'op': 'DHCPINFORM',
  'option12': 12,
  'option53': 53,
  'option55': 55,
  'option60': 60,
  'option61': 61,
  'option82': 82,
  'option_82_byte': b '\ x12 \ x01 \ x06 \ x00 \ x04 \ x00 \ x01 \ x00 \ x06 \ x02 \ x08 \ x00'
                    b '\ x06 \ x00 \ x1eX \ x9e \ xb2 \ xad',
  'option_82_hex': '12010600040001000602080006001e589eb2ad',
  'option_82_len': 18,
  'option_82_str': "b '\\ x12 \\ x01 \\ x06 \\ x00 \\ x04 \\ x00 \\ x01 \\ x00 \\ x06 \\ x02 \\ x08 \\ x00 \\ x06 \\ x00 \ \ x1eX \\ x9e \\ xb2 \\ xad '",
  'resultado': falso,
  'segundos': 768,
  'siaddr': '0.0.0.0',
  'sw_mac': '001e589eb2ad',
  'sw_port1': '06',
  'xidbyte': b '&lt;\ x89} \ x8c',
  'xidhex': '3c897d8c',
  'yiaddr': '0.0.0.0'} </pre><br>  En consecuencia, podemos ajustar cualquier variable en {} y se usará en la consulta SQL. <br><br>  Capturemos para el historial que el cliente recibió la dirección IP: <br><br><img src="https://habrastorage.org/webt/mc/le/bu/mclebuj5du2u4mjtlaf9-a2ibo0.png"><br><br><img src="https://habrastorage.org/webt/eo/1q/lt/eo1qltnt_1ewtf0uwkenwywme3m.png"><br><br><h1>  Inicio del servidor </h1><br>  ./pydhcpdb.py -d -c config.xml <br><br>  - d modo de salida a la consola DEBUG <br>  - archivo de configuración c &lt;nombre de archivo&gt; <br><br><h1>  Debriefing </h1><br>  Y ahora más sobre la implementación del servidor en Python.  Esto es un dolor  Python fue estudiado sobre la marcha.  Muchos momentos se hacen al estilo de: "wow, de alguna manera hice lo que funciona".  No está optimizado en absoluto, y se dejó en esta forma principalmente debido a la pequeña experiencia de desarrollo en python.  Me detendré en los momentos más interesantes de la implementación del servidor en el "código". <br><br><h2>  Analizador de archivos de configuración XML </h2><br>  Se utiliza el módulo estándar de Python xml.dom.  Parece ser simple, pero durante la implementación hubo una notable falta de documentación sensible y ejemplos en la red usando este módulo. <br><br><pre>  tree = minidom.parse (gconfig ["config_file"])
     mconfig = tree.getElementsByTagName ("mysql")
     para elem en mconfig:        
         gconfig ["mysql_host"] = elem.getElementsByTagName ("host") [0] .firstChild.data      
         gconfig ["mysql_username"] = elem.getElementsByTagName ("nombre de usuario") [0] .firstChild.data      
         gconfig ["mysql_password"] = elem.getElementsByTagName ("contraseña") [0] .firstChild.data      
         gconfig ["mysql_basename"] = elem.getElementsByTagName ("basename") [0] .firstChild.data      
     dconfig = tree.getElementsByTagName ("dhcpserver")
     para elem en dconfig:        
         gconfig ["broadcast"] = elem.getElementsByTagName ("broadcast") [0] .firstChild.data      
         gconfig ["dhcp_host"] = elem.getElementsByTagName ("host") [0] .firstChild.data      
         gconfig ["dhcp_LeaseTime"] = elem.getElementsByTagName ("LeaseTime") [0] .firstChild.data      
         gconfig ["dhcp_ThreadLimit"] = int (elem.getElementsByTagName ("ThreadLimit") [0] .firstChild.data)              
         gconfig ["dhcp_Server"] = elem.getElementsByTagName ("DHCPServer") [0] .firstChild.data              
         gconfig ["dhcp_defaultMask"] = elem.getElementsByTagName ("defaultMask") [0] .firstChild.data              
         gconfig ["dhcp_defaultRouter"] = elem.getElementsByTagName ("defaultRouter") [0] .firstChild.data              
         gconfig ["dhcp_defaultDNS"] = elem.getElementsByTagName ("defaultDNS") [0] .firstChild.data              
     qconfig = tree.getElementsByTagName ("consulta")
     para elem en qconfig:  
         gconfig ["offer_count"] = elem.getElementsByTagName ("offer_count") [0] .firstChild.data                          
         para num en rango (int (gconfig ["offer_count"])):
             gconfig ["oferta _" + str (num + 1)] = elem.getElementsByTagName ("oferta _" + str (num + 1)) [0] .firstChild.data      
         gconfig ["history_sql"] = elem.getElementsByTagName ("history_sql") [0] .firstChild.data                          
     opciones = tree.getElementsByTagName ("opciones")       
     para elem en opciones:          
         nodo = elem.getElementsByTagName ("opción")
         para opciones en nodo:
             optionsMod.append (options.firstChild.data) </pre><br><h2>  Multithreading </h2><br>  Curiosamente, el multihilo en Python se implementa de manera muy clara y simple. <br><br><pre>  def PacketWork (datos, addr): 
 ...
 # implementación del análisis del paquete recibido y la respuesta
 ...


 mientras cierto:
     datos, addr = udp_socket.recvfrom (1024) # espera el paquete UDP
     thread = threading.Thread (target = PacketWork, args = (data, addr,)). start () # tal como vino - ejecuta la función PacketWork definida anteriormente en segundo plano con parámetros
     while threading.active_count ()&gt; gconfig ["dhcp_ThreadLimit"]:
        time.sleep (1) # si el número de subprocesos ya en ejecución es mayor que en la configuración, espere hasta que se reduzcan </pre><br><br><h2>  Recibir / enviar paquete DHCP </h2><br>  Para interceptar paquetes UDP que llegan a través de la tarjeta de red, debe "elevar" el socket: <br><pre>  udp_socket = socket.socket (socket.AF_INET, socket.SOCK_DGRAM, socket.IPPROTO_UDP)
 udp_socket.bind ((gconfig ["dhcp_host"], 67)) </pre><br>  donde están las banderas: <br><br><ul><li>  AF_INET: significa que el formato de la dirección será IP: puerto.  Quizás AF_UNIX, donde la dirección viene dada por el nombre del archivo. </li><li>  SOCK_DGRAM: significa que no estamos aceptando un "paquete sin procesar", sino que ya pasamos a través de un firewall y con un paquete parcialmente cortado.  Es decir  obtenemos solo el paquete UDP sin el componente "físico" del envoltorio de paquetes UDP.  Si usa el indicador SOCK_RAW, también necesitará analizar este "contenedor". </li></ul><br>  Enviar un paquete puede ser como una transmisión: <br><br><pre>  udp_socket.setsockopt (socket.SOL_SOCKET, socket.SO_BROADCAST, 1) # cambia el socket al modo Broadcast
                     rz = udp_socket.sendto (packetack, (gconfig ["broadcast"], 68)) </pre><br>  y a la dirección "de dónde vino el paquete": <br><pre>  udp_socket.setsockopt (socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # cambia el socket al modo "muchos oyentes"
                         rz = udp_socket.sendto (packetack, addr) </pre><br>  donde SOL_SOCKET significa "nivel de protocolo" para configurar opciones, <br><br>  La opción SO_BROADCAST es que el paquete de casco Broadcast <br><br>  La opción SO_REUSEADDR cambia el socket al modo de escucha múltiple.  En teoría, es innecesario en este caso, pero en uno de los servidores de FreeBSD que probé, el código no funcionó sin esta opción. <br><br><h2>  Análisis de paquetes DHCP </h2><br>  Aquí es donde realmente me gustó Python.  Resulta de la "caja" que le permite tratar con bastante facilidad el código de bytes.  Permitiendo que sea muy simple traducir a valores decimales, cadenas y hexadecimales, es decir  lo que realmente necesitamos para entender la estructura del paquete.  Entonces, por ejemplo, puede obtener un rango de bytes en HEX y solo bytes: <br><br><pre>  res ["xidhex"] = datos [4: 8] .hex ()
     res ["xidbyte"] = datos [4: 8] </pre><br>  , empaquetar bytes en una estructura: <br><br><pre>  res ["flags"] = paquete ('BB', datos [10], datos [11]) </pre><br>  Obtenga IP de la estructura: <br><br><pre>  res ["ciaddr"] = socket.inet_ntoa (paquete ('BBBB', datos [12], datos [13], datos [14], datos [15])); </pre><br><br>  Y viceversa: <br><br><pre>  res = res + socket.inet_pton (socket.AF_INET, gconfig ["dhcp_Server"]) </pre><br>  Eso es todo;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/445338/">https://habr.com/ru/post/445338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445326/index.html">Despiadada automatización. Corte del director</a></li>
<li><a href="../445328/index.html">Repensar la robótica infantil</a></li>
<li><a href="../445330/index.html">Criptografía en Java. Clase de firma</a></li>
<li><a href="../445334/index.html">Tenemos DevOps Vamos a despedir a todos los probadores</a></li>
<li><a href="../445336/index.html">FlexiRemap® vs RAID</a></li>
<li><a href="../445340/index.html">Aumente la seguridad de la red utilizando un analizador en la nube</a></li>
<li><a href="../445344/index.html">Plataforma de comunicaciones unificadas OpenVox</a></li>
<li><a href="../445346/index.html">Cómo escribir una API incorrecta</a></li>
<li><a href="../445348/index.html">SNA Hackathon 2019: Simplify Architecture - Simplify Features</a></li>
<li><a href="../445350/index.html">Sonata: servidor de aprovisionamiento SIP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>