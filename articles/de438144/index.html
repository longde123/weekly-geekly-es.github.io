<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🛌 ▫️ 🏆 Wie wir die Arbeit mit den Konfigurationsparametern des Frontalsystems beschleunigt haben 🤭 💬 👩🏿‍⚕️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo Habr! Mein Name ist Sergey Lezhnin, ich bin ein leitender Architekt in Sbertekh. Eine der Richtungen meiner Arbeit ist das Unified Frontal Syste...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie wir die Arbeit mit den Konfigurationsparametern des Frontalsystems beschleunigt haben</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/438144/">  Hallo Habr!  Mein Name ist Sergey Lezhnin, ich bin ein leitender Architekt in Sbertekh.  Eine der Richtungen meiner Arbeit ist das Unified Frontal System.  Dieses System verfügt über einen Konfigurationsparameter-Verwaltungsdienst.  Es wird von vielen Benutzern, Diensten und Anwendungen verwendet, was eine hohe Leistung erfordert.  In diesem Beitrag werde ich erläutern, wie sich dieser Dienst von der ersten, einfachsten bis zur aktuellen Version entwickelt hat und warum wir schließlich die gesamte Architektur um 180 Grad bereitgestellt haben. <br><br><img src="https://habrastorage.org/webt/pk/zu/rp/pkzurprn4lbofwkn2dfrayv34di.jpeg"><br><a name="habracut"></a><br>  Hier haben wir begonnen - dies ist die erste Implementierung des Parameterverwaltungsdienstes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9b3/251/771/9b3251771f856c6f1c7234e042c3a2c3.png"><br><br>  Der Client fordert vom Dienst Konfigurationsparameter an.  Der Dienst übersetzt die Anforderung in die Datenbank, empfängt eine Antwort und gibt sie an den Client zurück.  Gleichzeitig können Administratoren Parameter über ihren separaten Dienst verwalten: neue Werte hinzufügen, aktuelle ändern. <br><br>  Dieser Ansatz hat einen Vorteil - Einfachheit.  Es gibt mehr Nachteile, obwohl sie alle miteinander verbunden sind: <br><br><ul><li>  häufiger Zugriff auf Speicher über das Netzwerk, <br></li><li>  hoher Wettbewerb um den Zugriff auf die Datenbank (wir haben sie auf einem Knoten), <br></li><li>  schlechte Leistung. <br></li></ul><br>  Um die Lasttests zu bestehen, musste diese Architektur die Last nicht mehr bereitstellen als die, die durch direkten Zugriff auf die Datenbank erfolgt.  Infolgedessen wurde der Lasttest dieser Schaltung nicht bestanden. <br><br>  Die zweite Phase: Wir haben beschlossen, die Daten auf der Serviceseite zwischenzuspeichern. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e7c/51d/867/e7c51d8670edf3a14e641c5158c40975.png"><br><br>  Hier werden die Daten bei der Anforderung zunächst in den gemeinsam genutzten Cache geladen und bei den nächsten Anforderungen aus dem Cache zurückgegeben.  Der Dienstadministrator verwaltet die Daten nicht nur, sondern markiert sie auch im Cache, damit sie bei Änderungen aktualisiert werden. <br><br>  Deshalb haben wir die Anzahl der Zugriffe auf das Repository reduziert.  Gleichzeitig stellte sich die Datensynchronisation als einfach heraus, da der Administratordienst Zugriff auf den Cache im Speicher hat und das Zurücksetzen steuert.  Wenn andererseits ein Netzwerkfehler auftritt, kann der Client keine Daten empfangen.  Im Allgemeinen ist die Logik zum Abrufen von Daten kompliziert: Wenn sich keine Daten im Cache befinden, müssen Sie sie aus der Datenbank abrufen, in den Cache stellen und erst dann zurückgeben.  Notwendigkeit, sich weiterzuentwickeln. <br><br>  Die dritte Entwicklungsstufe ist das clientseitige Zwischenspeichern von Daten: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc7/c76/873/cc7c76873ed1f3ea9524e244f04f4e1e.png"><br><br>  Der Client verfügt über eine Shell für den Zugriff auf den Dienst (das „Client-Modul“), die den lokalen Datencache verbirgt.  Befinden sich die angeforderten Daten beim Anfordern nicht im Cache, wird der Dienst aufgerufen.  Der Dienst fordert Parameter aus der Datenbank an und gibt sie zurück.  Im Vergleich zum vorherigen Schema ist die Caching-Verwaltung hier kompliziert.  Um die Parameter zurückzusetzen, muss der Service Kunden benachrichtigen, dass sich diese Parameter geändert haben. <br><br>  In dieser Architektur reduzieren wir die Anzahl der Aufrufe des Dienstes und der Datenbank.  Wenn der Parameter bereits angefordert wurde, kehrt er zum Client zurück, ohne auf das Netzwerk zuzugreifen, selbst wenn der Dienst oder die Datenbank nicht verfügbar ist.  Andererseits ist das große Minus, dass die Logik des Datenaustauschs mit dem Client kompliziert ist. Sie müssen ihn zusätzlich über einen Dienst benachrichtigen - beispielsweise über eine Nachrichtenwarteschlange.  Der Client muss das Thema abonnieren, er erhält Benachrichtigungen über die Änderung von Parametern und in seinem Cache muss der Client diese zurücksetzen, um neue Werte zu erhalten.  Ziemlich kompliziertes Schema. <br><br>  Schließlich kommen wir im Moment zur letzten Etappe.  Dabei haben uns die im Reactive Manifesto formulierten Grundprinzipien geholfen. <br><br><ul><li>  Reaktionsschnell: Das System reagiert so schnell wie möglich. <br></li><li>  Ausfallsicher: Das System reagiert auch im Fehlerfall weiter. <br></li><li>  Elastisch: Das System verwendet Ressourcen entsprechend der Last. <br></li><li>  Nachrichtengesteuert: Bietet Asynchronität und kostenloses Messaging zwischen Systemkomponenten. <br></li></ul><br>  Das diesem Ansatz entsprechende Schema erwies sich als recht einfach: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1e/302/480/f1e3024800a86896bd690104311ad134.png"><br><br>  Das allgemeine Prinzip lautet: Der Client abonniert den Konfigurationsparameter, und wenn sich seine Werte ändern, benachrichtigt der Server den Client darüber.  Das obige Schema ist leicht vereinfacht: Es spiegelt nicht wider, dass ein Client, wenn er sich anmeldet, initialisieren und den Anfangswert erhalten muss.  Aber dann ist da noch die Hauptsache: Die Pfeile haben die Richtung geändert.  Früher hat ein Client oder Cache aktiv einen Dienst für Datenänderungen angefordert, jetzt sendet der Dienst selbst Ereignisse zu Datenänderungen und diese werden vom Client aktualisiert. <br><br>  Diese Architektur hat mehrere wichtige Vorteile.  Die Anzahl der Anrufe an den Dienst und den Speicher wird reduziert, da der Client dies nicht aktiv anfordert.  Tatsächlich tritt der Aufruf für jeden gewünschten Parameter nur einmal auf, wenn er abonniert wird.  Dann erhält der Client bereits einfach einen Änderungsstrom.  Die Datenverfügbarkeit steigt, da der Client immer einen Wert hat - er wird zwischengespeichert.  Im Allgemeinen ist dieses Schema zum Austausch von Parametern recht einfach. <br><br>  Der einzige Nachteil dieser Architektur ist die Unsicherheit bei der Dateninitialisierung.  Bis zur ersten Aktualisierung durch Abonnement bleibt der Parameterwert undefiniert.  Dies kann jedoch behoben werden, indem die Standardparameterwerte des Clients festgelegt werden, die beim ersten Update durch die tatsächlichen Werte ersetzt werden. <br><br><h2>  Technologieauswahl </h2><br>  Nachdem wir das Programm genehmigt hatten, begannen wir mit der Suche nach Produkten für seine Implementierung.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wählen Sie</a> zwischen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vertx.io</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Akka.io</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Spring Boot</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f62/9fe/d44/f629fed442892d5b43a6466e73e4c288.png"><br><br>  Die Tabelle fasst die Merkmale zusammen, die uns interessieren.  Vertx und Akka haben Schauspieler, und Sping Boot hat eine Microservice-Bibliothek, die im Wesentlichen den Schauspielern nahe steht.  Ähnliches gilt für die Reaktivität: Spring Boot verfügt über eine eigene WebFlux-Bibliothek, die dieselben Funktionen implementiert.  Wir haben die Helligkeit ungefähr innerhalb der Tabelle geschätzt.  In Bezug auf Sprachen wird Vertx von den drei Optionen als polyglott angesehen: Es unterstützt Java, Scala, Kotlin und JavaScript.  Akka hat Scala und Java;  Kotlin kann wahrscheinlich auch verwendet werden, aber es gibt keine direkte Unterstützung.  Der Frühling hat Java, Kotlin und Groovy. <br><br>  Infolgedessen gewann Vertx.  Übrigens haben sie auf der JUG-Konferenz viel über ihn gesprochen, und tatsächlich nutzen es viele Unternehmen.  Hier ist ein Screenshot von der Entwicklerseite: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cfd/5e1/927/cfd5e19271c2d28809e43208b4566237.png"><br><br>  Auf Vertx.io lautet das Implementierungsschema unserer Lösung wie folgt: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f63/ab8/99f/f63ab899fb017bf113925eedce617632.png"><br><br>  Wir haben uns entschieden, die Parameter nicht in der Datenbank, sondern im Git-Repository zu speichern.  Wir können diese relativ langsame Datenquelle sehr gut nutzen, da der Client keine Parameter aktiv anfordert und die Anzahl der Treffer reduziert wird. <br><br>  Ein Reader (Verticle) liest Daten aus dem Git-Repository in den Speicher der Anwendung, um den Benutzerzugriff auf die Daten zu beschleunigen.  Dies ist beispielsweise beim Abonnieren von Parametern wichtig.  Darüber hinaus verarbeitet der Leser Aktualisierungen - liest die Daten erneut und markiert sie, ersetzt die alten Daten durch neue. <br><br>  Event Bus ist ein Vertx-Dienst, der Ereignisse zwischen Vertikalen sowie über Bridges sendet.  Einschließlich durch die Websocket-Brücke, die in diesem Fall verwendet wird.  Wenn Parameteränderungsereignisse eintreffen, sendet der Ereignisbus sie an den Client. <br><br>  Schließlich wird hier auf der Clientseite ein einfacher Webclient implementiert, der Ereignisse (Parameteränderungen) abonniert und diese Änderungen auf den Seiten anzeigt. <br><br><h2>  Wie funktioniert es? </h2><br>  Wir zeigen, wie alles über eine Webanwendung funktioniert. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VaBtM07AN9Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Wir starten die Anwendungsseite im Browser.  Wir abonnieren wichtige Datenänderungen.  Dann gehen wir zur Projektseite im lokalen GitLab, ändern die Daten im JSON-Format und speichern sie im Repository.  Die Anwendung zeigt die entsprechende Änderung an, die wir benötigt haben. <br><br>  Das ist alles.  Sie finden den Quellcode der Demo in meinem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Git-Repository</a> und stellen Fragen in den Kommentaren. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438144/">https://habr.com/ru/post/de438144/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438132/index.html">GOSINT - eine Open Source-Lösung zur Verwaltung von Kompromissindikatoren (IoC)</a></li>
<li><a href="../de438134/index.html">Installation von CCTV-Systemen: schöne und unglückliche Geschichten mit Kameras</a></li>
<li><a href="../de438136/index.html">Zustimmung zur Datenverarbeitung der DSGVO: detaillierte Analyse</a></li>
<li><a href="../de438138/index.html">Anatomie der Falken</a></li>
<li><a href="../de438142/index.html">Moderne Automobilindustrie. Elektroautos - Störung</a></li>
<li><a href="../de438146/index.html">Wir setzen die Zeilen in die Vorlagenparameter</a></li>
<li><a href="../de438148/index.html">Google muss sich teilen</a></li>
<li><a href="../de438150/index.html">Wie man eine Menge einzigartiger Turnschuhe in China herstellt</a></li>
<li><a href="../de438152/index.html">"Ich kann Ihnen über die Schmerzen erzählen, die jeder iOS-Entwickler im Arsch hat" - 10 Fragen an einen Entwickler, Folge 2</a></li>
<li><a href="../de438158/index.html">US-Datenbroker verkaufen Standortdaten ohne Zustimmung des Benutzers - ihre Arbeit wird reguliert</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>