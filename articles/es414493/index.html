<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≥üèø #‚É£ üÜö C√≥mo escribir un contrato inteligente para ICO en 5 minutos üë©üèæ‚Äçü§ù‚Äçüë®üèª üë®üèª‚Äçüé® üë¶üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! En este art√≠culo, le dir√© c√≥mo lanzar un contrato inteligente de recolecci√≥n de dinero para su ICO en Ethereum en 5 minutos y varios com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo escribir un contrato inteligente para ICO en 5 minutos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414493/"><img src="https://habrastorage.org/webt/rv/6d/_c/rv6d_cyxk3ix-su6le9q4lyqntc.png"><br><br>  Hola a todos!  En este art√≠culo, le dir√© c√≥mo lanzar un contrato inteligente de recolecci√≥n de dinero para su ICO en Ethereum en 5 minutos y varios comandos en la terminal.  Este ensayo potencialmente le ahorrar√° decenas de miles de d√≥lares estadounidenses, ya que cualquier programador, y no un programador tambi√©n, podr√° lanzar un contrato inteligente auditado y seguro (en lugar de pagar $ 15,000 - $ 75,000 para el desarrollo).  En resumen, puede enviar dinero a este contrato inteligente y recibir tokens ERC20 por √©l.  Se puede decir que este art√≠culo es una recopilaci√≥n de toda la experiencia que obtuve al lanzar un ICO para mi proyecto. <br><br>  En Internet, estos suyos ya est√°n llenos de art√≠culos sobre contratos inteligentes, pero tan pronto como comienza a escribir uno, se da cuenta de que la informaci√≥n se repite en todas partes, y simplemente no hay tutoriales sobre c√≥mo enga√±ar a su ERC20, o ya est√°n desactualizados.  Por cierto, para que este art√≠culo siga siendo relevante, intentar√© indicar los lugares potenciales donde puede quedar obsoleto (y c√≥mo solucionarlo).  Vamos! <br><a name="habracut"></a><br><h2>  Solidez </h2><br>  Este es el nombre del idioma principal que el equipo de k√©fir desarroll√≥ para lanzar contratos inteligentes.  Si usted es un programador, simplemente revise la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n del lenguaje</a> , es indecentemente simple.  Por cierto, lo hicieron simple para que fuera m√°s dif√≠cil cometer un error al escribir un contrato inteligente.  As√≠ que <b>absolutamente cualquier</b> programador, al menos en el nivel junior, podr√° resolverlo.  <b>No tiene absolutamente ning√∫n</b> sentido pagar grandes cantidades de dinero a los desarrolladores que conocen la solidez: ser√° un orden de magnitud m√°s barato capacitar a un desarrollador existente. <br><br><h2>  Contratos inteligentes </h2><br>  ... y todo lo que necesitas saber sobre ellos.  Omita esta secci√≥n si no es un programador.  Un contrato inteligente es una pieza de c√≥digo.  En principio, esta es una clase de solidez (OOP, s√≠), que tiene dos tipos de funciones: cambia de estado y no cambia de estado.  Bueno, para ejecutar funciones en un contrato inteligente simplemente envi√°ndole k√©fir, debe marcar esta funci√≥n como <code>payable</code> . <br><br>  State es un almac√©n de datos, blockchain, EPT.  Los contratos pueden cambiar la cadena de bloques (estado, almacenamiento), pero para cambiar la cadena de bloques debe pagar el k√©fir a los mineros.  La forma en que compartir√°n el k√©fir no se analizar√° en el marco de este art√≠culo.  El pago a los mineros por ejecutar c√≥digo de cambio de estado se llama Gas.  Si alguien de afuera arroja k√©fir a la direcci√≥n de un contrato inteligente con una llamada a una funci√≥n marcada como <code>payable</code> pero no marcada como <code>Constant</code> , <code>View</code> o <code>Pure</code> , entonces la cantidad requerida de k√©fir para el pago a los mineros se deducir√° de la cantidad enviada.  Por lo general, en los tokens ERC20, estas son funciones que entregan el remitente del token para k√©fir o transfieren tokens de un titular de tokens a otro. <br><br>  Y si marca una funci√≥n en el contrato con las palabras <code>Constant</code> o <code>View</code> (significan lo mismo, solo le permiten leer el estado) o <code>Pure</code> (lo mismo, ni siquiera lee el estado), ¬°ni siquiera tendr√° que gastar k√©fir en la ejecuci√≥n de esta funci√≥n!  Incluso dir√© m√°s que estas funciones no necesitan ser llamadas por transacciones, despu√©s de todo, cualquier cliente de yogurt puede ejecutarlas te√≥ricamente en casa, y ya nadie necesita saber sobre esto (despu√©s de todo, nada est√° escrito en la cadena de bloques). <br><br>  Y hay dos cosas importantes en la solidez: herencia m√∫ltiple y modificadores de funci√≥n.  Tambi√©n necesitas saber sobre ellos. <br><br>  El primero: los contratos justos se pueden heredar simult√°neamente de varias clases, como <code>TimedCrowdsale</code> , <code>CappedCrowdsale</code> , <code>MintedCrowdsale</code> , <code>Ownable</code> , mientras que las funciones de los constructores tambi√©n se lanzan una tras otra, pero lo explicar√© m√°s adelante como ejemplo. <br><br>  El segundo es la capacidad de crear funciones que luego se insertar√°n en otras funciones.  Es como una simple encapsulaci√≥n, solo un poco m√°s flexible: es literalmente <b>una plantilla de</b> funci√≥n.  Cuando crea un modificador, escribe el car√°cter especial <code>_</code> donde se refiere al c√≥digo de una funci√≥n que usa este modificador.  Es decir, los modificadores no son solo funcionalidades encapsuladas que devuelven un valor;  Esta es una plantilla de funci√≥n cuando el c√≥digo de un modificador se inserta literalmente en una funci√≥n utilizando este modificador. <br><br>  Pasemos a practicar. <br><br><h2>  Ambiente de cocina </h2><br>  Si no sabe qu√© es Terminal, lea <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este art√≠culo aqu√≠</a> .  Si est√° en Windows, configure una Terminal a trav√©s de WLS.  Si ya est√° familiarizado con la Terminal, continuemos.  Adem√°s, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√≥ngase</a> inmediatamente Node.js: ser√° necesario para los pr√≥ximos pasos.  Es mejor instalar LTS, pero, de hecho, no importa cu√°l de las versiones modernas del nodo instalar. <br><br>  Lo primero que instalamos e iniciamos inmediatamente el proceso de sincronizaci√≥n de bloques es <code>geth</code> .  En resumen, esta es una utilidad escrita en Go que nos permitir√° ejecutar el nodo ether en la computadora local y conectarnos a las redes de prueba y reales.  Puede realizar la instalaci√≥n a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">trav√©s de instaladores</a> , pero le recomiendo que se <code>geth</code> inmediatamente en la Terminal, como se describe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Puede verificar si sus est√°ndares <code>geth</code> est√°n <code>geth</code> ejecutando el comando en la Terminal: <br><br><pre> <code class="bash hljs">geth version</code> </pre> <br>  Si te escupi√≥ la versi√≥n geth: todo est√° calado, contin√∫a el tutorial.  Si no, mal, correcto;  parece que tendr√° que hacer el amor con la Terminal y su sistema operativo, pero esta no es la primera vez que se da cuenta.  C√≥mo instalar geth, ejecuta el comando en la Terminal: <br><br><pre> <code class="bash hljs">geth --testnet console</code> </pre> <br>  Esto iniciar√° el proceso de sincronizaci√≥n de su nodo con el servidor de prueba, cuyos bloques se pueden ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Puede verificar si sincroniz√≥ con la red en la consola <code>geth</code> : <br><br><pre> <code class="bash hljs">eth.blockNumber <span class="hljs-comment"><span class="hljs-comment">#  0 ‚Äî     eth.syncing #     false,    </span></span></code> </pre> <br>  El proceso de sincronizaci√≥n me llev√≥ de 1 a 4 horas, ¬øcu√°ndo?  Adem√°s, adem√°s de la sincronizaci√≥n de bloques, tambi√©n tendr√° que esperar la sincronizaci√≥n de estado, que a menudo es m√°s larga que la sincronizaci√≥n de bloques.  Tambi√©n puede usar los <code>geth</code> con el indicador <code>--light</code> - luego la sincronizaci√≥n dura de unos segundos a un minuto y a√∫n puede implementar contratos. <br><br>  Bien, instalamos la primera utilidad, pon la siguiente.  Necesitamos poner un an√°logo de <code>geth</code> , solo una simulaci√≥n de blockchain muy local: <code>testrpc</code> .  S√≠, tenemos <b>3 blockchains</b> : <br><br><ul><li>  <code>testrpc</code> - simulaci√≥n local de blockchain;  r√°pido, pero falso y almacenado solo en su m√°quina </li><li>  <code>geth --testnet</code> ya es una verdadera cadena de bloques, pero no perder√° dinero donde puede obtener k√©fir y probar todo <code>geth --testnet</code> gratis </li><li>  <code>geth</code> - mainnet, main, blockchain real, k√©fir real;  todo de una manera adulta, los errores aqu√≠ son las p√©rdidas de k√©fir real </li></ul><br>  En consecuencia, comenzaremos el contrato de prueba con <code>testrpc</code> , luego lo instalaremos en <code>geth --testnet</code> , y luego lo descargaremos directamente en <code>geth</code> . <br><br>  Ponemos <code>testrpc</code> ejecutando el siguiente comando: <br><br><pre> <code class="bash hljs">npm install -g ethereumjs-testrpc</code> </pre> <br>  Bueno, o se eleva inmediatamente con una trufa, ya que ahora <code>testrpc</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bajo el ala de la trufa</a> y se llama <code>ganache-cli</code> .  Aunque el diablo lo sabe, todo funcion√≥ <code>testrpc</code> con vainilla <code>testrpc</code> .  Y si funciona, no lo toques, como me ense√±aron en la academia intergal√°ctica.  Tambi√©n puede ejecutarlo para verificar la instalaci√≥n registrando <code>truffle</code> en la consola, pero el blockchain de prueba ya est√° sincronizado con nosotros, no lo molestemos. <br><br>  Bueno, ¬ødescubriste las cadenas de bloques?  ¬øAhora hay nodos y la prueba est√° incluso sincronizada?  Ponemos una pr√°ctica utilidad para trabajar con contratos inteligentes en k√©fir - <code>truffle</code> , con el siguiente comando: <br><br><pre> <code class="bash hljs">npm install -g truffle truffle version <span class="hljs-comment"><span class="hljs-comment">#  ,  ,  </span></span></code> </pre> <br>  Truffle es una herramienta que le permite mantener contratos inteligentes en diferentes archivos, importar otros archivos y tambi√©n compila su c√≥digo de contrato inteligente en un c√≥digo de bytes grande (ilegible por una persona), encuentra autom√°ticamente su <code>geth</code> localmente ejecutable (prueba y real ) o <code>testrpc</code> , implemente su contrato inteligente en esta red.  Adem√°s, verifica el c√≥digo de su contrato inteligente en busca de errores y las transacciones recientemente completadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tambi√©n ayudan a depurar</a> .  Masthead, en resumen. <br><br>  En esta etapa, deber√≠a haber instalado: <code>testrpc</code> , <code>geth</code> , <code>testrpc</code> ; si falta algo de esto o la versi√≥n no se escupe en la consola a pedido, corr√≠jala;  de lo contrario no tendr√° √©xito. <br><br><blockquote>  Adem√°s, lanc√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">script bash</a> simple que instalar√° todo por ti.  Llamado as√≠: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">source</span></span> &lt;(curl -s https://raw.githubusercontent.com/backmeupplz/eth-installer/master/install.sh)</code> </pre> <br>  - pero a√∫n no lo he probado, as√≠ que no estoy seguro de su rendimiento.  Sin embargo, me complacer√° recibir solicitudes. </blockquote><br><h2>  Contrato de Figash </h2><br>  Todo ya ha sido inventado y escrito para ti, eso est√° bien.  Un peque√±o golpe ser√° todo lo mismo, pero intentar√© minimizarlo para ti.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Utilizaremos los contratos ERC20 listos para usar de OpenZeppelin</a> : este es ahora el est√°ndar de la industria, han pasado la auditor√≠a y, de hecho, todos usan su c√≥digo.  Muchas gracias por tu contribuci√≥n al c√≥digo abierto. <br><br>  Haga el <code>cd</code> en una carpeta segura y luego escriba: <br><br><pre> <code class="bash hljs">mkdir contract &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> contract</code> </pre> <br>  En esta carpeta trabajaremos.  Cree un trozo aqu√≠ para nuestro contrato inteligente: <br><br><pre> <code class="bash hljs">truffle init</code> </pre> <br>  Tropezar, claramente.  Ahora tenemos dos carpetas muy importantes en las que escalaremos: <code>contracts</code> y <code>migrations</code> .  El primero es el c√≥digo de nuestros contratos, el segundo es el c√≥digo de trufa para saber qu√© hacer al implementar contratos en la cadena de bloques. <br><br>  A continuaci√≥n, necesitamos tomar el c√≥digo de contrato inteligente actual de npm y, de hecho, comenzar el proyecto en s√≠: <br><br><pre> <code class="bash hljs">npm init -y <span class="hljs-comment"><span class="hljs-comment">#     ( -y) npm install -E openzeppelin-solidity #       ( -E)</span></span></code> </pre> <br>  Bueno, el c√≥digo de contratos inteligentes de OpenZeppelin est√° en nuestro bolsillo en la carpeta <code>node_modules/openzeppelin-solidity/contracts</code> .  Ahora vamos a la carpeta principal de <code>contracts</code> , eliminamos todos los archivos y agregamos los archivos <code>MyToken.sol</code> y <code>MyCrowdsale.sol</code> ; naturalmente, nombrar√° sus contratos de manera diferente.  El primero ser√° un contrato para nuestro Token ERC20, y el segundo ser√° un contrato de nuestro ICO, que aceptar√° k√©fir y distribuir√° <code>MyToken</code> personas.  Este art√≠culo puede estar desactualizado, pero siempre puede ver c√≥mo OpenZeppelin sugiere que cree contratos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en su repositorio</a> .  As√≠ es como se ver√° <code>MyToken.sol</code> : <br><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Imports import "../node_modules/openzeppelin-solidity/contracts/token/ERC20/MintableToken.sol"; // Main token smart contract contract MyToken is MintableToken { string public constant name = "My Token"; string public constant symbol = "MTKN"; uint8 public constant decimals = 18; }</span></span></code> </pre> <br>  Agradable: ¬°tienes un contrato inteligente de tu propio token (solo cambia los nombres en las constantes)!  Puedes ver qu√© <code>MintableToken</code> herencia hay de <code>MintableToken</code> , pero all√≠ todo es lo m√°s simple posible.  Este es un token que se puede emitir (del ingl√©s "Mint" - para acu√±ar), y solo el propietario tiene derecho a emitirlo, ya que el <code>MintableToken</code> tambi√©n se hereda de <code>Ownable</code> .  Adem√°s, <code>MintableToken</code> tambi√©n hereda de clases de tokens ERC20 escritos por OpenZeppelin, en los que se implementa la interfaz ERC20: <br><br><pre> <code class="javascript hljs">contract ERC20Basic { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">totalSupply</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">balanceOf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address who</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transfer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address to, uint256 value</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">bool</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">event</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Transfer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">address indexed from, address indexed to, uint256 value</span></span></span><span class="hljs-function">); }</span></span></code> </pre> <br>  S√≠, aqu√≠ tienes toda la interfaz ERC20.  ¬øEs dificil?  No lo creo  Le da la oportunidad de ver cu√°ntos tokens se emitieron, verificar el saldo de la direcci√≥n y transferir los tokens a otra direcci√≥n escupiendo un evento de transferencia para clientes de k√©fir ligero en la red.  Y todo esto lo obtienes gratis en tu <code>MyToken.sol</code> gracias al trabajo de OpenZeppelin: son geniales. <br><br>  Y ahora pasemos a la parte principal de nuestra ICO: ¬°debemos aceptar el k√©fir y entregar <code>MyToken</code> !  As√≠ se <code>MyCrowdsale.sol</code> su <code>MyCrowdsale.sol</code> : <br><br><pre> <code class="javascript hljs">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.23</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Imports import "../node_modules/openzeppelin-solidity/contracts/crowdsale/emission/MintedCrowdsale.sol"; import "../node_modules/openzeppelin-solidity/contracts/crowdsale/distribution/RefundableCrowdsale.sol"; import "../node_modules/openzeppelin-solidity/contracts/crowdsale/validation/CappedCrowdsale.sol"; import "../node_modules/openzeppelin-solidity/contracts/token/ERC20/MintableToken.sol"; contract MyCrowdsale is CappedCrowdsale, RefundableCrowdsale, MintedCrowdsale { constructor( uint256 _openingTime, uint256 _closingTime, uint256 _rate, address _wallet, uint256 _cap, MintableToken _token, uint256 _goal ) public Crowdsale(_rate, _wallet, _token) CappedCrowdsale(_cap) TimedCrowdsale(_openingTime, _closingTime) RefundableCrowdsale(_goal) { //   ,  ,    // ,     require(_goal &lt;= _cap); } }</span></span></code> </pre><br>  As√≠ que, ¬øqu√© pasa con nosotros?  ¬øQu√©, muchachos, contratos inteligentes?  Nuestra venta p√∫blica de tokens hereda tres de las propiedades m√°s populares: tiene un l√≠mite m√°ximo, que ya no se puede recolectar;  tapa blanda, que no recoge los √©steres que se devuelven;  momento del comienzo y fin de la venta de tokens.  De hecho, ¬øqu√© m√°s se necesita para la felicidad? <br><br>  Programadores, noten c√≥mo los constructores de m√∫ltiples clases de herencia est√°n organizados en una fila y obtienen argumentos del constructor principal de <code>MyCrowdsale</code> .  Adem√°s, comprobamos que la tecla fija es m√°s alta que la tecla programable: ¬°Ales Gut!  Adem√°s, no se <code>MyCrowdsale</code> par√°metros <code>MyCrowdsale</code> en el constructor <code>MyCrowdsale</code> : los pasaremos en la etapa de implementaci√≥n del contrato en la trufa. <br><br>  Eso es todo: tiene contratos listos para usar de su propio token ERC20 e incluso un contrato inteligente ICO, que se configura de acuerdo con su deseo y entrega sus tokens para k√©fir.  Adem√°s, es compatible con todas las billeteras ERC20, ¬°un error!  Pasemos a las pruebas manuales y la implementaci√≥n. <br><br><h2>  Migraciones </h2><br>  Como dije antes, probaremos secuencialmente en tres redes blockchain, pero el proceso de prueba con bol√≠grafos siempre ser√° el mismo.  Comencemos con <code>testrpc</code> , luego pasemos a <code>geth --testnet</code> y continuemos con <code>geth</code> .  Faros de Sou, acabamos de escribir el c√≥digo, intentemos compilarlo.  En la carpeta del proyecto, escriba: <br><br><pre> <code class="bash hljs">truffle compile</code> </pre> <br>  Si todo se compil√≥ sin problemas, ver√° la <code>build</code> , que contendr√° el krakozyab para la trufa para que pueda incrustar el c√≥digo de bytes de sus contratos inteligentes en la cadena de bloques.  Antes de implementar contratos inteligentes, debemos decirle a la trufa qu√© hacer en absoluto.  El despliegue de trufas de los contratos inteligentes se llama migraci√≥n, bueno, sigamos con esta terminolog√≠a.  Vaya a <code>migrations/1_initial_migration.js</code> y c√°mbielo de la siguiente manera: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> token = artifacts.require(<span class="hljs-string"><span class="hljs-string">"../contracts/MyToken.sol"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> crowdsale = artifacts.require(<span class="hljs-string"><span class="hljs-string">"../contracts/MyCrowdsale.sol"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">deployer, network, accounts</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> openingTime = <span class="hljs-number"><span class="hljs-number">1514764800</span></span>; <span class="hljs-comment"><span class="hljs-comment">// 15  2018 const closingTime = 1561939200; // 1  2019 const rate = new web3.BigNumber(1); // 1   1  const wallet = '0x281055afc982d96fab65b3a49cac8b878184cb16'; // - const cap = 200 * 1000000; //  const goal = 100 * 1000000; //  return deployer .then(() =&gt; { return deployer.deploy(token); }) .then(() =&gt; { return deployer.deploy( crowdsale, openingTime, closingTime, rate, wallet, cap, token.address, goal ); }) .then(() =&gt; { // Crowdsale    var tokenContract = web3.eth.contract(token.abi).at(token.address); web3.eth.defaultAccount = web3.eth.accounts[0]; tokenContract.transferOwnership(crowdsale.address); }); };</span></span></code> </pre> <br>  Este es el mismo archivo que utilizar√° la trufa para desplegar contratos.  Entonces, ¬øqu√© estamos haciendo aqu√≠?  Primero, solicitamos <code>MyToken</code> y <code>MyCrowdsale</code> compilados.  Despu√©s, establecemos las constantes con todos los argumentos de nuestro ICO: establecemos las horas de inicio y finalizaci√≥n;  cu√°ntas fichas recibir√°n las personas por 1 vey de k√©fir (0.000000000000000001 eth = 1 wei; establecer <code>decimals</code> indica cu√°ntas √≥rdenes se necesitan para obtener 1 de sus fichas reci√©n hechas);  billetera, donde vendr√° el k√©fir obtenido de la venta;  tapa dura y tapa blanda.  Tenga en cuenta que el tiempo de <code>openingTime</code> siempre debe ser posterior al momento del bloqueo actual en la cadena de bloques; de lo contrario, su contrato inteligente no se bloquear√° debido a la verificaci√≥n de la condici√≥n en <code>TimedCrowdsale</code> .  Pis√© este rastrillo, y las transacciones fallidas no se pueden debitar en absoluto.  Cambie estas constantes como desee. <br><br>  El siguiente paso es precisamente el despliegue de contratos inteligentes.  Nada interesante aqu√≠: tenemos un objeto de despliegue que despliega artefactos de contratos inteligentes y pasa argumentos all√≠.  Tenga en cuenta que MyToken se <code>MyToken</code> primero, y solo luego <code>MyCrowdsale</code> , y la direcci√≥n del primero se pasa en el segundo como argumento. <br><br>  Entonces, lo m√°s interesante es sobre lo que no escriben ni en la documentaci√≥n ni en los libros.  Cuando crea un <code>MyToken</code> desde una billetera, esta billetera se convierte en el propietario de <code>MyToken</code> en la superclase <code>Ownable</code> ; lo mismo ocurre con <code>MyCrowdsale</code> .  Si profundizas en el <code>MintableToken</code> , puedes ver que solo el <code>Owner</code> puede acu√±ar monedas.  ¬øY qui√©n es el due√±o de <code>MyToken</code> ?  As√≠ es: la direcci√≥n que lo molest√≥.  ¬øY qui√©n enviar√° solicitudes para acu√±ar monedas?  Correcto: contrato inteligente <code>MyCrowdsale</code> .  Perm√≠tame recordarle que la direcci√≥n que cre√≥ <code>MyToken</code> y <code>MyCrowdsale</code> son dos direcciones diferentes. <br><br>  Por lo tanto, estamos agregando el tercer paso de implementaci√≥n no ortodoxo, donde la direcci√≥n que ha desafiado los contratos ( <code>web3.eth.accounts[0]</code> ) llama a la funci√≥n <code>transferOwnership</code> en el contrato <code>MyToken</code> que <code>MyCrowdsale</code> propietario de <code>MyToken</code> y pueda acu√±ar monedas.  Y <code>MyCrowdsale</code> todav√≠a est√° bajo la propiedad de <code>web3.eth.accounts[0]</code> , por lo que todo est√° incluido. <br><br><blockquote>  Nota sobre <code>web3.eth.accounts[0]</code> : cuando implemente un contrato inteligente, aseg√∫rese de que geth o testrpc tengan la billetera correcta en <code>web3.eth.accounts[0]</code> : no pierda la clave privada, aunque esto no le hace da√±o, pero de repente el due√±o tendr√° que hacer algo m√°s tarde, pero ¬øla clave ya no est√°? </blockquote><blockquote>  En <code>testrpc</code> , como regla, las cuentas se crean inmediatamente al inicio y se desbloquean de inmediato;  sin embargo, en una prueba y en una cadena de bloques de aire real, vale la pena crear una cuenta a trav√©s de <code>personal.newAccount()</code> , luego reponga esta direcci√≥n a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Faucet</a> en la cadena de bloques de prueba o k√©fir real en la cadena de bloques real.  No pierdas tu contrase√±a y claves privadas. </blockquote><blockquote>  Adem√°s, puede agregar una billetera existente a sus cuentas llamando a <code>web3.personal.importRawKey('pvt_key', 'password')</code> , pero para esto necesita llamar a <code>geth</code> con el par√°metro adicional <code>--rpcapi="db,eth,net,web3,personal,web3"</code> .  Creo que lo resolver√°s. </blockquote><br><h2>  Pruebas e implementaci√≥n </h2><br>  S√≠, los contratos est√°n listos, las migraciones est√°n escritas, solo queda desplegar y verificar.  Tanto <code>geth</code> (test y real) como <code>testrpc</code> administran de la misma manera a trav√©s de la <code>truffle console</code> , por lo que describir√© el m√©todo de verificaci√≥n para <code>testrpc</code> y simplemente le dir√© c√≥mo habilitar <code>geth</code> despu√©s.  Y as√≠, lanzamos la prueba blockchain de k√©fir local: <br><br><pre> <code class="bash hljs">testrpc</code> </pre> <br>  Um ... eso es todo.  Simula la cadena de bloques de k√©fir localmente. <br><br><blockquote>  Y para implementar en la cadena de prueba ether blockchain, en lugar de este comando, obtendr√° <code>geth --testnet --rpc</code> .  Y para implementar en la cadena de bloques real de ether, simplemente <code>geth --rpc</code> .  La bandera <code>--rpc</code> necesaria para que la trufa pueda conectarse.  Los siguientes pasos de implementaci√≥n y prueba son m√°s o menos los mismos para los tres tipos de blockchain.  Lo √∫nico es que despu√©s de ejecutar la prueba o la cadena de bloques real a trav√©s de <code>geth</code> , comenzar√° a sincronizar los bloques, y esto puede demorar hasta 4-5 horas en una buena conexi√≥n a Internet.  Una observaci√≥n sobre esto fue al comienzo del art√≠culo.  Antes de implementar contratos inteligentes, recomiendo esperar la sincronizaci√≥n completa.  Adem√°s, la cadena de bloques pesa en la regi√≥n de 60-100 gigabytes, as√≠ que prepare el espacio en disco para esto. </blockquote><blockquote>  Adem√°s, tambi√©n aseg√∫rese de que <code>web3.eth.accounts[0]</code> desbloqueado.  Por lo general, puede registrar <code>testrpc</code> en la consola, que se abre inmediatamente, o en una ventana de Terminal separada en la consola, que se abre a trav√©s de <code>geth console</code> : <code>eth.unlockAccount(eth.accounts[0], ",    ", 24*3600)</code> - esto desbloquear√° su cuenta, lo que deber√≠a crear un contrato inteligente </blockquote><br>  Ahora abra una nueva ventana de Terminal (no <code>testrpc</code> , deber√≠a funcionar) y escr√≠bala en la carpeta del proyecto: <br><br><pre> <code class="bash hljs">truffle migrate --reset</code> </pre> <br>  Este comando m√°gico compilar√° un contrato inteligente (es decir, no necesita escribir una <code>truffle compile</code> cada vez) y lo implementar√° en el micro servidor blockchain que se encuentra abierto localmente.  Vale la pena se√±alar que si <code>testrpc</code> hace esto instant√°neamente, entonces la prueba y las cadenas de bloques reales incluir√°n la transacci√≥n en los siguientes bloques mucho m√°s tiempo.  Despu√©s de eso, debes escupir algo como esto en la consola: <br><br><pre> <code class="bash hljs">Using network <span class="hljs-string"><span class="hljs-string">'development'</span></span>. Running migration: 1_initial_migration.js Running step... Replacing MyToken... ... 0x86a7090b0a279f8befc95b38fa8bee6918df30928dda0a3c48416454e2082b65 MyToken: 0x2dc35f255e56f06bd2935f5a49a0033548d85477 Replacing MyCrowdsale... ... 0xf0aab5d550f363478ac426dc2aff570302a576282c6c2c4e91205a7a3dea5d72 MyCrowdsale: 0xaac611907f12d5ebe89648d6459c1c81eca78151 ... 0x459303aa0b79be2dc2c8041dd48493f2d0e109fac19588f50c0ac664f34c7e30 Saving artifacts...</code> </pre> <br>  Creo que ya se dio cuenta de que la consola le dio las direcciones de los contratos inteligentes <code>MyToken</code> y <code>MyCrowdsale</code> .  Eso es todo!  El contrato inteligente est√° incrustado en la cadena de bloques cuyo micro servidor ha abierto.  Solo queda verificar que los tokens se distribuyan realmente a los usuarios que env√≠an k√©fir al contrato inteligente <code>MyCrowdsale</code> .  Escribimos lo siguiente en la Terminal para ingresar a la consola de trufa: <br><br><pre> <code class="bash hljs">truffle console</code> </pre> <br>  Escribimos lo siguiente en la trufa ahora (sin comentarios solamente): <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   - t="0x2dc35f255e56f06bd2935f5a49a0033548d85477" //     MyToken ="0xaac611907f12d5ebe89648d6459c1c81eca78151" //     MyCrowdsale //   - token=MyToken.at(t) crowdsale=MyCrowdsale.at(c) //       account=web3.eth.accounts[0] // ,      token.balanceOf(account) //   0 //    - web3.eth.sendTransaction({from: account, to:c, value: web3.toWei(0.1, 'ether'), gas: 900000})</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En el caso de, </font></font><code>testrpc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puede verificar inmediatamente el saldo de nuestra billetera nuevamente, pero en el caso de la prueba y la cadena de bloques real, debe esperar hasta que nuestra transacci√≥n se incluya en el bloque, generalmente cuando esto sucede, la trufa le da el n√∫mero de transacci√≥n. Has esperado? Verifique nuevamente nuestro saldo en </font></font><code>MyToken</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ,      token.balanceOf(account) //    </span></span></code> </pre> <br>  Eso es todo!<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primero pruebe su contrato </font></font><code>testrpc</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, luego </font></font><code>geth --testnet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, luego despliegue </font></font><code>geth</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. ¬°As√≠ que lanzaste tu propio ICO! Y no ten√≠a que gastar decenas de kilobaks para auditor√≠a y lanzamiento. Enredar con lo que los chicos de OpenZeppelin nos proporcionaron es realmente muy dif√≠cil. Y cuando lo usas </font></font><code>truffle</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as√≠ es como el desarrollo solidario generalmente se convierte en un cuento de hadas. Bueno, excepto en los casos en que las transacciones se invierten durante la ejecuci√≥n de un contrato inteligente, debuta en el infierno. Pero la depuraci√≥n de los contratos inteligentes es realmente digna de un art√≠culo separado.</font></font><br><br><h2>  Conclusi√≥n </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Muchas gracias por leer hasta el final de este art√≠culo! Si logr√© ahorrarle tiempo o dinero, o si aprendi√≥ algo nuevo de este art√≠culo, entonces me alegrar√© mucho. Tambi√©n le agradecer√≠a que comparta este art√≠culo con sus amigos o conocidos que quieran llevar a cabo una ICO: ahorre $ 75,000 para los subprogramadores que extraen dinero del mercado criptogr√°fico como par√°sitos, copiando las mismas 25 l√≠neas de c√≥digo . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬°Buena suerte en el desarrollo de contratos inteligentes! ¬øA√∫n tienes preguntas? Te pregunto en los comentarios. Estar√© encantado de responder todo y tratar de ayudar con los problemas.</font></font><br><br><h2>  Bono </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero, ¬øqu√© sucede si desea cambiar la l√≥gica por la cual se considera el precio de compra de los tokens? </font><font style="vertical-align: inherit;">Por supuesto, puede cambiarlo correctamente </font></font><code>rate</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o usar una de las clases de contratos de OpenZeppelin, pero ¬øqu√© pasa si quiere algo a√∫n m√°s pervertido? </font><font style="vertical-align: inherit;">En un contrato inteligente, puede anular la funci√≥n de la </font></font><code>getTokenAmount</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">siguiente manera:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getTokenAmount</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256 _weiAmount</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (block.timestamp &lt; <span class="hljs-number"><span class="hljs-number">1533081600</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// August 1st, 2018 rate = rate * 4; } else if (block.timestamp &lt; 1546300800) { // January 1st, 2019 rate = rate * 2; } return _weiAmount.mul(rate); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En general, esto puede hacer que el precio de la ficha dependa del momento de la compra: cuanto m√°s se adentre en el bosque, m√°s caras ser√°n las fichas. </font><font style="vertical-align: inherit;">No tenga miedo de experimentar y reescribir algunas de las caracter√≠sticas de los contratos inteligentes: ¬°es divertido!</font></font><br><br><img src="https://habrastorage.org/webt/3a/mp/lk/3amplkx2fhpeplqauietmgshkc8.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414493/">https://habr.com/ru/post/es414493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414481/index.html">Prueba PHP del viernes: algunas aventuras del programador Brad, una secuencia extra√±a y premios</a></li>
<li><a href="../es414483/index.html">Escriba Safe SQL en Kotlin</a></li>
<li><a href="../es414485/index.html">GNMT, falla √©pica o sutilezas de la traducci√≥n autom√°tica</a></li>
<li><a href="../es414487/index.html">Un representante raro del tipo de fuerza bruta: la historia de un ataque</a></li>
<li><a href="../es414489/index.html">Estados Unidos planea abordar seriamente el tema de los desechos espaciales</a></li>
<li><a href="../es414495/index.html">toString: genial y terrible</a></li>
<li><a href="../es414497/index.html">Consulo UI API de la idea al prototipo</a></li>
<li><a href="../es414499/index.html">Informe del Club de Roma 2018, Cap√≠tulo 1.1.3: ‚ÄúUn mundo vac√≠o versus una paz plena‚Äù</a></li>
<li><a href="../es414501/index.html">Informe del Club de Roma 2018, Cap√≠tulo 3.11: ‚ÄúReformas del sector financiero‚Äù</a></li>
<li><a href="../es414503/index.html">Intel NUC Hades Canyon con AMD Vega Graphics: ¬øVR o no VR?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>