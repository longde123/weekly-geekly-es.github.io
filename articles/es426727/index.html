<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî¨ üóΩ üòó EME? Cdm? DRM? CENC? IDK! Lo que necesitas para hacer tu propio reproductor de video en un navegador üßïüèø üëßüèΩ üë®üèø‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬øQu√© significan todas estas abreviaturas? ¬øQu√© se necesita para desarrollar un reproductor de c√≥digo abierto para ver videos de Amazon, Sky y otras pl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>EME? Cdm? DRM? CENC? IDK! Lo que necesitas para hacer tu propio reproductor de video en un navegador</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/426727/">  ¬øQu√© significan todas estas abreviaturas?  ¬øQu√© se necesita para desarrollar un reproductor de c√≥digo abierto para ver videos de Amazon, Sky y otras plataformas y ver videos de cualquier proveedor?  Sebastian Golasch habl√≥ sobre c√≥mo se lleva a cabo el proceso de transmisi√≥n de video en la conferencia HolyJS 2018 Piter.  Bajo el corte - video y traducci√≥n de su informe. <br><br><img src="https://habrastorage.org/webt/et/to/7c/etto7cv1khykp68gwreip_8rfy4.jpeg"><br><br>  <i>Sebastian Golasch es actualmente desarrollador en Deutsche Telekom.</i>  <i>Trabaj√≥ con Java y PHP durante mucho tiempo, y luego cambi√≥ a JS, Python y Rust.</i>  <i>Durante los √∫ltimos siete a√±os, ha estado trabajando en la plataforma patentada de la casa inteligente Qivicon.</i> <br><br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3Y3R_snaDDc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2>  Un poco sobre la historia de la transmisi√≥n de video </h2><br>  Primero, veamos la historia de la web, ya que hemos pasado de QuickTime a Netflix en 25 a√±os.  Todo comenz√≥ en los a√±os 90 cuando Apple invent√≥ QuickTime.  Su uso en Internet comenz√≥ en 1993-1994.  En ese momento, el reproductor pod√≠a reproducir video con una resoluci√≥n de 156 √ó 116 p√≠xeles y una frecuencia de 10 FPS, sin aceleraci√≥n de hardware (utilizando solo recursos del procesador).  Este formato se centr√≥ en una conexi√≥n de acceso telef√≥nico de 9600 baudios: 9600 bps, incluida informaci√≥n general. <br><br>  Era la √©poca del navegador Netscape.  El video en el navegador no se ve√≠a muy bien, porque no era nativo de la web.  Para la reproducci√≥n, utilizamos software externo (el mismo QuickTime) con su propia interfaz, que se visualiz√≥ en el navegador utilizando la etiqueta de inserci√≥n. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/664/455/137/664455137979de92508841f0d3ceaafa.png"><br><br>  La situaci√≥n mejor√≥ un poco cuando Macromedia lanz√≥ Shockwave Player (despu√©s de la adquisici√≥n de Macromedia por Adobe, se hizo conocido como Adobe Flash Player).  La primera versi√≥n de Shockwave Player se lanz√≥ en 1997, pero la reproducci√≥n de video apareci√≥ solo en 2002. <br><br>  Utilizaron el c√≥dec Sorenson Spark, tambi√©n conocido como H.263.  Se ha optimizado para resoluciones peque√±as y tama√±os de archivo peque√±os.  ¬øQu√© significa esto?  Por ejemplo, un video de 43 segundos que se us√≥ para probar el Shockwave Player pesaba solo 560 KB.  Por supuesto, no ser√≠a muy agradable ver una pel√≠cula con esta calidad, pero la tecnolog√≠a en s√≠ era interesante para ese momento.  Sin embargo, como en el caso de QuickTime, para que Shockwave Player funcionara en el navegador, se requer√≠a software adicional.  Este reproductor ten√≠a muchos problemas de seguridad, pero lo m√°s importante es que el video segu√≠a siendo un complemento del navegador. <br><br>  En 2007, Microsoft lanz√≥ Silverlight, que recuerda un poco a Flash.  No profundizaremos, pero todas estas soluciones ten√≠an algo en com√∫n: una caja negra.  Todos los jugadores funcionaban como un complemento de navegador, y no ten√≠as idea de lo que estaba sucediendo dentro. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84b/418/52e/84b41852efd2fb39dbea144b2e898dfe.png"><br><br>
<h2>  Elemento &lt; <code>Video/</code> &gt; </h2><br>  En 2007, Opera propuso usar la etiqueta &lt; <code>Video/</code> &gt;, es decir, hacer videos nativos en un navegador.  Lo usamos hoy.  Es f√°cil y conveniente, y cualquier video no solo se puede ver, sino tambi√©n descargar.  E incluso si no queremos permitir la descarga de videos, no podemos prohibir la descarga al navegador.  Lo m√°ximo es hacer que la descarga del video sea m√°s dif√≠cil. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cac/3be/693/cac3be693c7a3328062521d828c12c38.png"><br><br>  La <code>&lt;Video/&gt;</code> es exactamente lo contrario del cuadro negro, y ver el c√≥digo fuente es muy simple. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca1/f23/708/ca1f237081ed5a6a9e648b65e05ea7a1.png"><br><br><h2>  DRM </h2><br>  Sin embargo, no puede hacer clic derecho en un video en Netflix y seleccionar "Guardar como".  La raz√≥n de esto es DRM (Gesti√≥n de restricciones digitales).  Esta no es una sola tecnolog√≠a o una sola aplicaci√≥n que realiza cualquier tarea.  Este es un t√©rmino general para conceptos tales como: <br><br><ul><li>  Autenticaci√≥n y cifrado de usuario </li><li>  Cifrado basado en contenido </li><li>  Definici√≥n de derechos y aplicaci√≥n de restricciones. </li><li>  Comentarios y actualizaci√≥n </li><li>  Control de salida y protecci√≥n de enlace </li><li>  Examen y seguimiento de intrusos. </li><li>  Gesti√≥n de claves y licencias. </li></ul><br>  Para comprender qu√© es DRM, necesitamos estudiar su ecosistema, es decir, determinar qu√© compa√±√≠as est√°n involucradas.  Esto es: <br><br><ul><li>  <b>Los propietarios de contenido</b> est√°n en la cima del ecosistema.  Por ejemplo, Disney, MGM o FIFA.  Estas empresas producen contenido y tienen derechos sobre √©l. </li><li>  <b>Los n√∫cleos DRM</b> son compa√±√≠as que proporcionan tecnolog√≠a DRM (por ejemplo, Google, Apple, Microsoft, etc.). Actualmente, existen entre 7 y 8 tecnolog√≠as DRM de diferentes compa√±√≠as. </li><li>  <b>Proveedores de servicios</b> : desarrolle un software de servidor que codifique el video. </li><li>  <b>Navegadores</b> que en realidad son jugadores. </li><li>  <b>Los proveedores de contenido</b> son empresas como Netflix, Amazon, Sky, etc. Por regla general, no poseen los derechos sobre el contenido, lo licencian y lo distribuyen. </li><li>  <b>Los proveedores de chips / dispositivos</b> tambi√©n est√°n involucrados en el ecosistema, porque DRM no es solo tecnolog√≠a de software.  Algunas compa√±√≠as (principalmente chinas) est√°n desarrollando chips que codifican y decodifican video. </li></ul><br>  ¬øAlguna vez se ha preguntado por qu√© cuando ve un video en Netflix en un navegador no tiene una resoluci√≥n muy alta (SD), pero si ve el mismo video en un Apple TV o Android TV Box, el mismo contenido se reproduce en Full HD o en 4K?  DRM tambi√©n es responsable de esto.  El hecho es que los fabricantes siempre temen que los piratas roben contenido.  Por lo tanto, cuanto menos seguro sea el entorno en el que se realiza la decodificaci√≥n de video, peor calidad se mostrar√° al usuario.  Por ejemplo, si la decodificaci√≥n se realiza mediante programaci√≥n (por ejemplo, en Chrome o Firefox), el video se muestra con la peor calidad.  En un entorno donde se utilizan capacidades de hardware para la decodificaci√≥n (por ejemplo, si Android usa una GPU), las posibilidades de copia ilegal de contenido son menores, y aqu√≠ la calidad de reproducci√≥n es mayor.  Finalmente, el entorno m√°s seguro es completamente hardware (Apple TV o Android TV Box), donde la decodificaci√≥n y reproducci√≥n se realizan sin involucrar al software. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f9/4fb/1bb/9f94fb1bb7c1fa9d31a02d2bf62950f0.png"><br><br>  Pero si hablamos de navegadores, la decodificaci√≥n en ellos casi siempre se realiza mediante software.  Diferentes navegadores usan diferentes sistemas para DRM.  Chrome y Firefox usan Widevine.  Esta empresa es propiedad de Google y licencia sus aplicaciones DRM.  Por lo tanto, para la decodificaci√≥n, Firefox descarga la biblioteca DRM de Google.  En el navegador puede ver de d√≥nde proviene la descarga. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca9/49d/015/ca949d015734b50c36e8594b8f5a4370.png"><br><br>  Apple usa su propio sistema FairPlay, que fue creado cuando la compa√±√≠a present√≥ el primer iPhone y iPad.  Microsoft tambi√©n usa su propio desarrollo llamado PlayReady, que est√° integrado en Windows.  En otros casos, Widevine se usa con mayor frecuencia.  Este sistema existe tanto como una aplicaci√≥n como una soluci√≥n de hardware: chips que decodifican video. <br><br><h2>  Cdm </h2><br>  La abreviatura CDM significa M√≥dulo de descifrado de contenido.  Esta es una pieza de software o hardware que puede funcionar de varias maneras: <br><br><ul><li>  Descifre el video, despu√©s de lo cual se representa en el navegador con la etiqueta &lt;Video /&gt;. </li><li>  Descifre y decodifique el video, y luego transfiera los cuadros sin procesar del video para su reproducci√≥n al navegador. </li><li>  Descifre y decodifique el video y luego transfiera los cuadros sin formato del video para reproducirlos con la GPU. </li></ul><br>  A pesar del soporte de la GPU, la segunda opci√≥n se usa con mayor frecuencia (al menos cuando se trata de Chrome y Firefox). <br><br><h2>  Decodificaci√≥n y decodificaci√≥n de capas en el navegador </h2><br>  Entonces, ¬øc√≥mo funciona todo junto?  Para comprender esto, mire las capas de decodificaci√≥n y descifrado en el navegador.  Se dividen en: <br><br><ul><li>  Aplicaci√≥n JavaScript: le dice a la computadora qu√© video voy a ver. </li><li>  Un navegador es un reproductor que reproduce contenido de video. </li><li>  M√≥dulo de descifrado de contenido. </li><li>  La gesti√≥n de derechos digitales tiene que ver con la decodificaci√≥n de video (no pude encontrar una notaci√≥n mejor, as√≠ que lo llam√© as√≠). </li><li>  Tiempo de ejecuci√≥n confiable. </li><li>  En este caso, los dos primeros componentes son un reproductor DRM, el m√≥dulo de descifrado de contenido es un cliente DRM y los dos √∫ltimos componentes son el n√∫cleo DRM. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b2b/7da/87b/b2b7da87bf7b3b92ef4004f4d4b97800.png"><br><br>  Lo que sucede cuando reproduce un video en un navegador se muestra en la imagen a continuaci√≥n.  Ella, por supuesto, es un poco confusa: hay muchas flechas y colores.  Lo examinar√© paso a paso, utilizando casos reales para aclararlo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1e/982/bb7/b1e982bb7fe74fa39f08b00264987409.png"><br><br>  Usaremos Netflix como ejemplo.  Escrib√≠ una aplicaci√≥n de depuraci√≥n. <br><br>  Comenc√© con d√≥nde, creo, cada uno de ustedes comenzar√≠a: mir√© las solicitudes que hace Netflix cuando comienzo un video, y vi una gran cantidad de registros. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b04/913/8d7/b049138d7a4da37f5b9b6c5e4da88bf3.png"><br><br>  Sin embargo, si deja solo los que realmente se necesitan para reproducir el video, resulta que solo hay tres de ellos: manifiesto, licencia y el primer fragmento del video. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/381/e12/a9f/381e12a9f194014ae19501e4e9ada763.png"><br><br>  El reproductor de Netflix est√° escrito en JavaScript y contiene m√°s de 76,000 l√≠neas de c√≥digo, y, por supuesto, no puedo analizarlo por completo.  Pero me gustar√≠a mostrar las partes principales que son necesarias para reproducir videos protegidos. <br><br>  Comenzaremos con la plantilla: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ba/205/e6f/9ba205e6f022e4a99ffa373372c99047.png"><br><br><h2>  EME </h2><br>  Pero antes de profundizar en las funciones, debemos familiarizarnos con otra tecnolog√≠a: EME (Extensiones de medios cifrados, extensiones de medios cifrados).  Esta tecnolog√≠a no realiza descifrado y decodificaci√≥n, es solo una API de navegador.  EME sirve como interfaz para CDM, para KeySystem, para un servidor con licencia y para un servidor donde se almacena el contenido. <br><br>  Entonces, comencemos con getKeySystemConfig. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e68/179/765/e68179765d8d942b41efd0a05fb51cd4.png"><br><br>  Debe tenerse en cuenta que depende del proveedor, por lo que la configuraci√≥n que presento aqu√≠ funciona para Netflix, pero no funciona, por ejemplo, para Amazon. <br><br>  En esta configuraci√≥n, debemos decirle al sistema de fondo qu√© nivel de tiempo de ejecuci√≥n confiable podemos ofrecer.  Esto puede ser una decodificaci√≥n de hardware segura o una decodificaci√≥n de software segura.  Es decir, le estamos diciendo al sistema qu√© hardware y software se utilizar√° para la reproducci√≥n.  Y eso determinar√° la calidad del contenido. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0f/071/1dd/c0f0711ddf9da278d6ab4c23ff31f75c.png"><br><br>  Despu√©s de config config, mira crear un MediaKeySystem inicial. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99a/62b/ccb/99a62bccbf59fc6c893db5b34b3e3c91.png"><br><br>  Aqu√≠ es donde comienza la interacci√≥n con el m√≥dulo de descifrado de contenido.  Debe informar a la API qu√© sistema DRM y KeySystem utilizamos.  En nuestro caso, esto es Widevine. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e31/ff8/416/e31ff841688a7f78547c02723c31c11c.png"><br><br>  El siguiente paso es opcional para todos los sistemas, pero es necesario para Netflix.  Nuevamente, su necesidad depende del proveedor.  Necesitamos aplicar un certificado de servidor a nuestras mediaKeys.  Los certificados de servidor son texto sin formato en un archivo Netflix Cadmium.js que se puede copiar f√°cilmente.  Y cuando lo aplicamos a mediaKeys, toda comunicaci√≥n entre el servidor con la licencia y nuestro navegador se vuelve segura gracias al uso de este certificado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3c/601/dd1/d3c601dd109f2a67e84efe69ca76ba6a.png"><br><br>  Cuando se hace esto, debemos recurrir al elemento original del video y decir: ‚ÄúOk, este es el sistema clave que queremos usar, y esta es la etiqueta de video hola.  D√©janos unirte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/797/6cf/3ce/7976cf3ce8dacf000547d40084d16d22.png"><br><br>  Y aqu√≠ est√° la √∫ltima funci√≥n que necesita para configurar el sistema de video. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/107/ce0/fa0/107ce0fa0c047fd77218983652e0aa89.png"><br><br>  Esta es una sesi√≥n DRM, o MediaKeySession.  Estos son solo los datos que van del proveedor al m√≥dulo de descifrado que firma las solicitudes con ellos.  Estos datos tambi√©n son texto sin formato, que est√° oculto detr√°s de varias funciones en el archivo del reproductor de Netflix, desde donde los copi√©. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed7/3a4/0a3/ed73a40a370d7744f55590fc9e23efa5.png"><br><br>  Cuando llamamos a create.Session en el objeto mediaKeys, necesitamos decir qu√© video admitimos.  En este caso, es mp4.  Esto nos devuelve al contexto de mensajer√≠a con nuestro sistema CDM.  Tambi√©n necesitamos que Netflix aplique el certificado del servidor base64 en cada formulario, pero toda esta configuraci√≥n en la sesi√≥n de creaci√≥n se proporciona nuevamente dependiendo del sistema DRM. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b24/8ff/e27/b248ffe2709055f4eadc33eab77df455.png"><br><br>  La √∫ltima funci√≥n aqu√≠ abajo: keySession.generateRequest crea una solicitud de licencia en segundo plano.  O CDM est√° creando una solicitud de licencia en segundo plano.  En otras palabras, se trata de datos binarios sin formato que debemos enviar al servidor con licencia para obtener una licencia v√°lida a cambio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/43c/798/16e/43c79816e9006b0668d58555887017b7.png"><br><br>  Aqu√≠ cenc es de inter√©s.  Es un est√°ndar de encriptaci√≥n ISO que define un esquema de seguridad para video mp4.  En WebM, esto se llama de manera diferente, pero la funci√≥n realiza lo mismo. <br><br>  handleMessage es la interfaz EventListener que configuramos.  Cuando el evento de mensaje genera un evento en keySession, sabemos que estamos listos para obtener una licencia del servidor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ef/93b/e85/4ef93be85d1d8535408a1abed9ca9ec6.png"><br><br>  Y en esta devoluci√≥n de llamada solo recibimos una solicitud a un servidor con una licencia que proporciona algunos datos binarios (tambi√©n pueden diferir seg√∫n el proveedor).  Utilizamos estos datos para actualizar la sesi√≥n actual agregando una licencia.  Es decir, tan pronto como recibimos una licencia v√°lida del servidor, nuestro CDM sabe que podemos decodificar y descifrar el video. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/779/ef3/ea9/779ef3ea918671d1c4a2d2df8d9c404d.png"><br><br>  Si aplicamos esto al siguiente diagrama, obtenemos esto: queremos reproducir el video, y la aplicaci√≥n de JavaScript dice: ‚Äú¬°Hola, navegador!  ¬°Quiero reproducir el video! "  - luego utiliza Extensiones de medios cifrados y realiza una solicitud de Licencia de funciones en Widevine CDM para obtener una licencia.  Luego, esta solicitud se devuelve al navegador, y podemos cambiarla por una licencia v√°lida en el servidor de licencias, y luego debemos transferir esta licencia nuevamente a CDM.  Este proceso se mostr√≥ en el c√≥digo anterior. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a98/e80/622/a98e806221a4f2533f0155c8425a36b4.png"><br><br>  Pero tenga en cuenta que a√∫n no hemos perdido un segundo del video, y todos tenemos que hacer esto para poder reproducir algunos videos en el futuro. <br><br><h2>  MSE </h2><br>  Y otra tecnolog√≠a que necesitamos investigar es MSE (Media Source Extensions).  Puede llamarse la media hermana de EME (Extensiones de medios cifrados).  Esta tambi√©n es una API de navegador, y no tiene nada que ver con DRM.  Lo veo como una interfaz de programaci√≥n para &lt; <code>Video/</code> &gt; Src.  Utiliz√°ndolo, puede crear flujos binarios en JavaScript y aplicar fragmentos de video al elemento &lt; <code>Video/</code> &gt;.  Por lo tanto, gracias a ello, la fuente de la etiqueta &lt; <code>Video/</code> &gt; se vuelve din√°mica. <br><br>  Entonces, podemos usar las extensiones para fuentes multimedia, instanciar y acceder al video, y luego descargar los fragmentos de video en partes y aplicarlos a la etiqueta &lt; <code>Video/</code> &gt;. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a1/8f5/99f/0a18f599f2422bc047ad16d71f32f9af.png"><br><br>  El punto es que cuando ves un video de dos horas, no quieres esperar hasta que est√© completamente cargado.  En cambio, lo corta en trozos peque√±os que var√≠an en tama√±o desde aproximadamente 30 segundos a 2 minutos y los aplica al elemento &lt; <code>Video/</code> &gt; uno a la vez. <br><br>  Una vez que nuestro b√∫fer MediaSource est√© listo y vinculado al elemento &lt; <code>Video/</code> &gt;, podemos agregar un SourceBuffer.  Debemos decirle nuevamente qu√© formato de video y qu√© c√≥decs usamos, y luego se crear√°. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/49a/d01/b0f/49ad01b0fcb2745fd0243c9bd4cf0972.png"><br><br>  Finalmente, ahora podemos obtener fragmentos individuales y enviarlos en nuestro SourceBuffer utilizando el m√©todo de agregar al elemento &lt;Video /&gt;, recibiendo un video creado din√°micamente.  Tambi√©n se puede usar para otros casos de uso en los que las personas pueden combinar de forma independiente diferentes elementos del video, creando sus propios videos, pero no me gustar√≠a profundizar demasiado en √©l. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d5/687/bc3/9d5687bc390e405b84977c99420abb4b.png"><br><br>  As√≠ que este es casi el √∫ltimo paso que debemos dar.  Tiene una red de distribuci√≥n, tiene fragmentos y luego el navegador env√≠a los fragmentos cifrados y comprimidos al CDM, donde se realiza el descifrado y, posiblemente, la decodificaci√≥n.  Luego, los fragmentos descifrados y sin comprimir se env√≠an de vuelta al navegador, donde se visualizan y muestran. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/498/2d0/8a6/4982d08a6ee484ab5de56fb3cdb6d247.png"><br><br><h2>  Manifiesto </h2><br>  Pero hay un punto m√°s.  ¬øC√≥mo sabemos qu√© fragmentos necesitamos descargar, de d√≥nde descargarlos y cu√°ndo?  Y esta es la √∫ltima parte, la solicitud que falta del manifiesto.  Cuando consultamos Netflix para un manifiesto, necesita muchos datos.  Si solo queremos reproducir un video, nos importa qu√© sistema DRM usamos, qu√© video queremos ver (Netflix ID, que se puede copiar desde la URL) y los perfiles.  Los perfiles determinan en qu√© resoluci√≥n recibimos el video, y tambi√©n en qu√© idioma recibimos las pistas de audio, en qu√© formato (est√©reo, Dolby Digital, etc.), si usamos subt√≠tulos, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daf/b78/506/dafb7850664c7b2baba6894add61a79a.png"><br><br><h2>  MPEG-DASH </h2><br>  El formato de manifiesto m√°s utilizado es MPEG-DASH.  Es cierto que Apple usa un formato diferente: HSL, que en apariencia se asemeja a una lista de archivos en el viejo reproductor Winamp.  Pero Widevine y Microsoft usan exactamente MPEG-DASH.  Se basa en XML y define todo: duraci√≥n, tama√±o del b√∫fer, tipos de contenido, cu√°ndo se cargan los fragmentos, fragmentos para diferentes resoluciones, as√≠ como el cambio de velocidad de bits adaptable.  Esto √∫ltimo significa que si un usuario, por ejemplo, mira un video y, al mismo tiempo, la velocidad de descarga disminuye, la reproducci√≥n no se detiene, pero la calidad del video simplemente se deteriora.  Esto se debe al hecho de que el manifiesto define las mismas partes para diferentes resoluciones, tienen la misma duraci√≥n y los mismos √≠ndices.  Por lo tanto, si la velocidad de descarga disminuye, el navegador simplemente puede cambiar a una transmisi√≥n con una resoluci√≥n m√°s baja sin pausar la descarga y sin almacenar en b√∫fer los datos. <br><br>  As√≠ es como se ve el manifiesto para Guardianes de la Galaxia.  En √©l podemos ver que a diferentes velocidades de descarga, las personas recibir√°n videos con diferente calidad, as√≠ como el hecho de que hay pistas de audio para personas con discapacidad auditiva.  Tambi√©n detalla los subt√≠tulos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/785/a96/a6f/785a96a6fa6b13ed57bd6f5518f36fa1.png"><br><br>  Tenemos una duraci√≥n y una indicaci√≥n del tiempo desde el cual comenzar la reproducci√≥n.  Esta funci√≥n se usa, por ejemplo, cuando interrumpe la visualizaci√≥n y luego vuelve al video nuevamente, comenzando desde donde lo dej√≥. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcc/349/b4c/dcc349b4c9b4a4eabfa26da95511185d.png"><br><br>  Tambi√©n hay robustez nuevamente, que dice: este fragmento solo se puede perder si su sistema cumple con los requisitos.  En este caso, se trata de decodificaci√≥n de hardware: c√≥decs seguros de hardware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a76/7c2/248/a767c224876945a69441fe4314114319.png"><br><br>  Para la misma parte del video, puede determinar cualquier cantidad de fragmentos con diferentes resoluciones. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fa/202/d19/9fa202d1922b5e6d9aabb5a22f359d49.png"><br><br>  Y luego obtienes la URL para cargar el fragmento, y el par√°metro de rango muestra el rango de valores en milisegundos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/35e/325/93c/35e32593c77c1c7b242ce0141e8b6fd3.png"><br><br>  Esta es la √∫ltima parte.  A veces tambi√©n obtienes un manifiesto de la CDN.  Algunos proveedores tienen un servidor separado para la entrega de fragmentos, pero la mayor√≠a de las veces provienen de la misma m√°quina que la funcionalidad de manifiesto.  Cuando descargamos el manifiesto, sabemos qu√© fragmentos necesitamos descargar, podemos enviar una solicitud de fragmentos y luego descifrar y decodificar desde CDM. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/2e5/47d/8262e547d950d80ec737263c795ddab9.png"><br><br>  En general, eso es todo.  Todo lo dicho anteriormente es suficiente para desarrollar un reproductor de c√≥digo abierto para ver videos de Amazon, Sky y otras plataformas y ver videos de casi cualquier proveedor. <br><br><h2>  Msl </h2><br>  Netflix consider√≥ que val√≠a la pena agregar un cifrado de mensaje adicional entre el navegador y el servidor.  Lo llamaron la "capa de seguridad de mensajes", la capa de seguridad de mensajes o MSL.  No hace nada directamente con el video, es solo una capa adicional de cifrado.  Una de las razones para implementar MSL es que HTTPS no es lo suficientemente seguro.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MSL</a> , por otro lado, es de c√≥digo abierto, por lo que siempre puede ver c√≥mo funciona.  Aqu√≠ no voy a profundizar en este tema, y ‚Äã‚Äãsi est√° interesado, siempre puede encontrar informaci√≥n sobre por qu√© Netflix hace MSL en su blog.  GitHub tiene documentaci√≥n detallada sobre su implementaci√≥n e implementaciones de trabajo en Java. <br><br>  Tambi√©n hay una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">implementaci√≥n de Python</a> que escribimos con amigos.  Hasta donde s√©, este es el √∫nico cliente de c√≥digo abierto que funciona para Netflix.  Trabaja con Kodi Media Center.  Para la visualizaci√≥n, puede usar VLC Player o cualquier otro software adecuado. <br><br><h2>  Y de nuevo la "caja negra" </h2><br>  Entonces, viste lo que necesit√°bamos para implementar todo esto, y con qu√© frecuencia mencion√© CDM: el "recuadro negro" que se descarga de Google.  Por lo tanto, de nuevo devolvimos el video a la "caja negra".  El hermoso elemento &lt;Video /&gt; est√° nuevamente oculto para nosotros.  Hemos agregado software de terceros que nos ayuda, pero que al mismo tiempo est√° cerrado y que no podemos administrar.  Puede hacer muchas cosas discretas: seguimiento, an√°lisis, env√≠o de datos ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ef/e10/72c/7efe1072c1d1d1390451a08ba3897f33.png"><br><br>  Esto es lo que Tim Berners Lee dijo sobre esto: <i>"Entonces, en general, es importante mantener EME como un entorno en l√≠nea relativamente seguro donde se pueden ver pel√≠culas, as√≠ como el m√°s conveniente y que lo hace parte del discurso interconectado de la humanidad".</i> <br><br>  Pero hay otras opiniones al respecto.  En particular, de la Electronic Frontiers Foundation, que antes del advenimiento de DRM era miembro del W3C.  Esto es lo que dicen: <i>‚ÄúEn 2013, EFF se decepcion√≥ al saber que el W3C se hizo cargo del proyecto de estandarizaci√≥n de EME: extensiones de medios cifrados.</i>  <i>De hecho, estamos hablando de una API cuya √∫nica funci√≥n era proporcionar a DRM un papel de liderazgo en el ecosistema del navegador.</i>  <i>Continuaremos luchando para garantizar que Internet sea gratuito y abierto.</i>  <i>"Continuaremos demandando al gobierno de los Estados Unidos para derogar las leyes que hacen que la GRD sea tan t√≥xica, y continuaremos luchando al nivel de la ley global".</i> <br><br>  Es dif√≠cil para m√≠ decir c√≥mo relacionarme con esto.   ,       ,      ,      .   ,     Netflix,     . ,        ,         . <br><br><blockquote>   , 24-25 ,    <b>HolyJS 2018 Moscow</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´The Universal Serial Web¬ª</a> :     WebUSB,    USB-  .     -,    . <br><br> PS  1-      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . ,     ‚Äî  50%   . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426727/">https://habr.com/ru/post/es426727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426717/index.html">La ilusi√≥n del enga√±o: una ilusi√≥n √≥ptica visual basada en pron√≥sticos retro</a></li>
<li><a href="../es426719/index.html">Hackathon sobre Data Science en SIBUR: c√≥mo fue</a></li>
<li><a href="../es426721/index.html">Evitar fallas durante el desarrollo del producto: 10 consejos de Rookee</a></li>
<li><a href="../es426723/index.html">Microsoft y sus socios esperan crear una c√°psula del tiempo en la luna</a></li>
<li><a href="../es426725/index.html">C√≥mo hacer cosas cuando no tienes ganas de hacerlas</a></li>
<li><a href="../es426729/index.html">TypeScript School of Magic: Gen√©ricos y extensi√≥n de tipos</a></li>
<li><a href="../es426731/index.html">CSS: caracter√≠sticas interesantes de border-radius</a></li>
<li><a href="../es426733/index.html">El hierro no fallar√°. C√≥mo preparo docenas de servidores por d√≠a para la batalla</a></li>
<li><a href="../es426735/index.html">Bienvenido a JETHACK Hackathon</a></li>
<li><a href="../es426737/index.html">Brevemente sobre la arquitectura de los procesadores neurom√≥rficos: una mirada al interior</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>