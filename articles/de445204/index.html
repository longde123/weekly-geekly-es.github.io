<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüíº üçã üò± Stream-Konvertierung von Firebird 2.5-Datenbanken in das ODS12-Format (Firebird 3.0) ‚ÜñÔ∏è üà∑Ô∏è üöø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jede Version von Firebird hat eine eigene Version des Formats der Datenbankdatentr√§gerstrukturen - O (n) D (isk) S (Struktur). Vor Version 2.5 einschl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Stream-Konvertierung von Firebird 2.5-Datenbanken in das ODS12-Format (Firebird 3.0)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/445204/">  Jede Version von Firebird hat eine eigene Version des Formats der Datenbankdatentr√§gerstrukturen - O (n) D (isk) S (Struktur).  Vor Version 2.5 einschlie√ülich konnte die Firebird-Engine mit ODS fr√ºherer Versionen arbeiten, dh Datenbanken aus √§lteren Versionen wurden von der neuen Version ge√∂ffnet und arbeiteten im Kompatibilit√§tsmodus, aber die Firebird 3.0-Engine funktioniert nur mit einer Datenbank in ihrer eigenen ODS-Version 12.0. <br><br>  Um zu 3.0 zu wechseln, muss die Datenbank von 2.5 per Backup / Restore in ein neues Format konvertiert werden.  Nat√ºrlich nehmen wir an, dass die Datenbank zuvor f√ºr die Konvertierung vorbereitet wurde - d. H.  Metadaten und Anforderungen wurden auf Kompatibilit√§t mit Firebird 3.0 getestet. <br><br>  Wenn Sie dem Standardansatz folgen, bedeutet dies, dass Sie auf Version 2.5 sichern, dann 3.0 installieren und eine Wiederherstellung durchf√ºhren m√ºssen.  Dieses Verfahren ist akzeptabel, wenn gen√ºgend Zeit vorhanden ist. Wenn Sie jedoch gro√üe Datenbanken migrieren oder wenn mehrere Dutzend Datenbanken migriert werden und die Zeit knapp wird, k√∂nnen Sie die Stream-Konvertierung verwenden, die 30-40% schneller ist.  Wie genau dies zu tun ist (unter Windows und unter Linux), lesen Sie unter der Katze. <br><a name="habracut"></a><br>  Die allgemeine Idee ist, dass wir zur Beschleunigung die Pipeline verwenden: <br><br><pre><code class="plaintext hljs">gbak -b ‚Ä¶ 25 stdout | gbak -c ‚Ä¶ stdin 30</code> </pre> <br>  Gbak ab 2.5 generiert ein Backup in einem linearen Format und sendet es an stdout, das gbak ab 3.0 sofort √ºber stdin aufnimmt und eine neue Datenbank erstellt. <br><br>  Es ist erforderlich, eine solche Pipeline mithilfe der lokalen (Datei-) Zugriffsmethode zu organisieren, da der Netzwerkzugriff (auch √ºber localhost) den Prozess erheblich verlangsamt. <br><br>  Nachfolgend sehen wir uns die Details f√ºr Windows und Linux an. <br><br>  <b>Windows</b> <br><br>  Im Fall von Windows ist es am einfachsten, einen vollst√§ndig autonomen Build von Firebird zu erstellen.  Nehmen Sie dazu das <a href="">Firebird 2.5-Einbettungsarchiv</a> , benennen Sie fbemded.dll in fbclient.dll um, f√ºgen Sie die Dienstprogramme gbak.exe aus dem ‚Äû√ºblichen‚Äú 2.5-Archiv und (optional) isql.exe hinzu. <br><br>  Firebird 3.0 verwendet eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einzelne Baugruppe</a> und erfordert keine √Ñnderungen. <br><br>  Die kleinste Option (f√ºr die keine Installation von VS2008 / VS2010-Laufzeitbibliotheken auf dem Zielsystem erforderlich ist) enth√§lt die folgenden Dateien: <br><br><pre> <code class="plaintext hljs">25/gbak.exe 25/fbclient.dll 25/firebird.conf 25/firebird.log 25/firebird.msg 25/ib_util.dll 25/icudt30.dll 25/icuin30.dll 25/icuuc30.dll 25/Microsoft.VC80.CRT.manifest 25/msvcp80.dll 25/msvcr80.dll 30/fbclient.dll 30/firebird.conf 30/firebird.msg 30/gbak.exe 30/ib_util.dll 30/icudt52.dll 30/icudt52l.dat 30/icuin52.dll 30/icuuc52.dll 30/msvcp100.dll 30/msvcr100.dll 30/intl/fbintl.conf 30/intl/fbintl.dll 30/plugins/engine12.dll</code> </pre> <br>  Ein erfahrener Administrator kann feststellen, dass intl / fbintl.dll und intl / fbintl.conf nicht in 2.5 enthalten sind.  Dies ist richtig, da gbak kein Verbindungszeichen verwendet oder Daten zwischen Zeichen konvertiert. Auf der "empfangenden" Seite von Firebird 3.0 werden diese Dateien jedoch beim Erstellen von Indizes ben√∂tigt. <br><br>  In firebird.conf empfiehlt Firebird 3.0 das Hinzuf√ºgen von: <br><br><pre> <code class="plaintext hljs">MaxUnflushedWrites = -1 MaxUnflushedWriteTime = -1</code> </pre> <br>  Es ist auch ratsam, unterschiedliche IpcName-Werte f√ºr 2.5 und 3.0 festzulegen. <br><br>  Bei der Auswahl der Werte anderer Parameter geht firebird.conf von einer einfachen √úberlegung aus: In der Daten√ºbertragungsphase f√ºhrt gbak in einem Prozess 2.5 aus, und in dem anderen 3.0 wird dann 2.5 beendet und 3.0 beginnt mit der Erstellung von Indizes. <br><br>  Um die Erstellung von Indizes in 3.0 zu beschleunigen, wird empfohlen, den TempCacheLimit-Parameter auf ~ 40% RAM zu erh√∂hen (wenn es sich nat√ºrlich um einen dedizierten Server handelt). <br><br>  Wenn der Server beispielsweise √ºber 16 GB RAM verf√ºgt, k√∂nnen Sie dies tun <br><br><pre> <code class="plaintext hljs">TempCacheLimit=6G</code> </pre> <br>  <i>Dieser Wert kann nat√ºrlich nur f√ºr 64-Bit-Firebird 3 festgelegt werden, da kein 32-Bit-Prozess mehr als 2 Gigabyte Speicher zuweisen kann.</i> <br><br>  Bei 2.5 muss dieser Parameter nicht ge√§ndert werden - er darf bereits nicht mehr als 2 Gigabyte betragen und hat keinen Einfluss auf die Geschwindigkeit w√§hrend der Sicherung. <br><br>  Bevor Sie den Vorgang ausf√ºhren, m√ºssen Sie √ºberpr√ºfen, ob der <code>gstat -h databasename</code> im Datenbankheader auf 0 gesetzt ist (Befehl <code>gstat -h databasename</code> , siehe Zeile Seitenpuffer). <br><br>  Wenn der Cache explizit im Datenbankheader angegeben wird, √ºberschreibt er die Werte aus firebird.conf (und database.conf in 3.0). Bei unzureichend gro√üen Werten kann dies zu einem √ºberm√§√üigen Speicherverbrauch f√ºhren und zum Swap f√ºhren. <br><br>  Kopieren Sie anschlie√üend die Dateien auf das Zielsystem. <br><br>  Die Konvertierung erfolgt nach dem Beenden des Firebird 2.5-Dienstes "System" in der Befehlszeile mit zunehmenden Berechtigungen f√ºr den lokalen Administrator (Beispiel): <br><br><pre> <code class="plaintext hljs">set ISC_USER= "25/gbak" -z -b -g -v -st t -y 25.log 25 stdout|^ "30/gbak" -z -c -v -st t -y 30.log stdin 30</code> </pre> <br>  In diesem Beispiel wird in Anf√ºhrungszeichen "gerade schr√§g" verwendet (g√ºltiger "Unix-Stil"), und "Hut" ("^") entgeht dem Zeilenvorschubzeichen, was bei der Eingabe langer Befehle praktisch ist.  Die Option -st (atus) wurde in Firebird 2.5.8 angezeigt und erm√∂glicht es Ihnen, Daten zur Betriebszeit des gbak-Prozesses in das Protokoll zu schreiben (Einzelheiten finden Sie in der Dokumentation). <br><br>  <b>Linux</b> <br><br>  Unter Linux h√§ngt Firebird 3 von der Tommath-Bibliothek ab.  In CentOS (RHEL) befindet sich diese Bibliothek im Epel-Repository, in Ubuntu (Debian) im System-Repository. <br><br>  F√ºr CentOS m√ºssen Sie zuerst das Epel-Repository verbinden und erst dann <br><br><pre> <code class="plaintext hljs">yum install libtommath</code> </pre> <br>  Ubuntu muss keine zus√§tzlichen Repositorys verbinden, aber verschiedene Versionen von Paketen sind auf Ubuntu 16 und Ubuntu 18 installiert - libtommath0 bzw. libtommath1. <br><br>  Firebird 3.0 sucht nach tommath.so.0 und f√ºr Ubuntu 18 muss zus√§tzlich ein Link (Symlink) von tommath.so.0 zu tommath.so.1 erstellt werden.  Dazu m√ºssen Sie zuerst tommath.so.1 finden. <br><br>  Der Suchpfad in Ubuntu lautet <code>/usr/lib/x86_64-linux-gnu/</code> , in anderen Debian-basierten Distributionen kann er jedoch anders sein. <br><br>  Das zweite Problem ist, dass es vor Firebird 3.0.1 einschlie√ülich keine einfache M√∂glichkeit gab, zwei verschiedene Versionen des Servers zu installieren.  Die Option "Kompilieren aus dem Quellcode mit dem gew√ºnschten Pr√§fix" wird aufgrund ihrer relativen Komplexit√§t nicht ber√ºcksichtigt. <br><br>  F√ºr Firebird 3.0.2 und h√∂her sind ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Build mit ‚Äìenable-binreloc</a> und eine separate Installationsoption (-path path) implementiert. <br><br>  Angenommen, die tommath-Bibliothek und gegebenenfalls der Symlink f√ºr tommath.so.0 wurden dem System hinzugef√ºgt, k√∂nnen Sie die tats√§chliche (zum Zeitpunkt dieses Schreibens) Firebird 3.0.4-Distribution hinzuf√ºgen, z. B. / opt / fb3: <br><br><pre> <code class="plaintext hljs">./install.sh -path /opt/fb3</code> </pre> <br>  Danach k√∂nnen Sie den Firebird-Systemdienst beenden und die Streaming-Konvertierung starten. <br><br>  <i>Wenn Sie Firebird stoppen, sollten Sie ber√ºcksichtigen, dass Firebid 2.5-Prozesse im klassischen Modus normalerweise xinetd starten. Daher ist es entweder erforderlich, den Firebird-Dienst f√ºr xinetd zu deaktivieren oder xinetd vollst√§ndig zu stoppen.</i> <br><br>  In firebird.conf f√ºr 3.0 unter Linux m√ºssen Sie keine MaxUnflushed-Parameter festlegen (diese funktionieren nur unter Windows) und die Firebird 2.5-Einstellungen √§ndern. <br><br>  Unter Linux entspricht der lokale (Datei-) Zugriff von Firebird 2.5 nicht der eingebetteten Version f√ºr Windows - Server 2.5 funktioniert im gbak-Prozess (ohne den Netzwerkteil), aber die Zugriffsrechte werden anhand der Benutzerbasis √ºberpr√ºft, was bedeutet, dass nicht nur eine Anmeldung, sondern auch ein Kennwort erfolgt :: <br><br><pre> <code class="plaintext hljs">export ISC_USER=username ISC_PASSWORD=password /opt/firebird/bin/gbak -b ‚Ä¶ 25 stdout\ |/opt/fb3/bin/gbak -c ‚Ä¶ stdin 30</code> </pre> <br>  Nach erfolgreicher Konvertierung m√ºssen Sie zuerst den "zus√§tzlichen" Firebird 3.0 und dann den "Haupt" Firebird 2.5 entfernen und erst danach eine Neuinstallation von Firebird 3.0 durchf√ºhren - am besten vom regul√§ren tar.gz-Installationsprogramm und nicht √ºber die Repositorys, weil  Die Version in den Repositorys kann verz√∂gert sein. <br><br>  Nachdem Sie die Linux-Datenbank wiederhergestellt und neu installiert haben, m√ºssen Sie au√üerdem √ºberpr√ºfen, ob die neue Datenbank den Eigent√ºmer des Firebird-Benutzers hat. <br><br>  Ist dies nicht der Fall, muss das Problem behoben werden <br><br><pre> <code class="plaintext hljs">chown firebird.firebird database</code> </pre> <br>  <b>Zusammenfassung</b> <br><br>  Neben der Zeit- und Speicherplatzersparnis bietet die Stream-Konvertierung einen weiteren wichtigen Vorteil: Die Datenbankkonvertierung erfolgt ohne L√∂schen des vorhandenen Firebird 2.5. Dies vereinfacht das Rollback erheblich, wenn die Konvertierung nicht erfolgreich ist (meistens aufgrund von Speicherplatzmangel oder einem unerwarteten Neustart w√§hrend des Migrationsprozesses). <br><br>  Die Zeitersparnis beruht auf der Tatsache, dass die "klassische" Konvertierung "Sicherungszeit" plus "Wiederherstellungszeit" ist.  Die Wiederherstellung besteht aus zwei Teilen: Lesen von Daten aus einer Sicherungsdatei und Erstellen eines Index. <br><br>  Bei der Streaming-Konvertierung wird die Gesamtzeit als "Sicherungszeit plus f√ºnf bis zehn Prozent" und "Indexerstellungszeit" ermittelt. <br><br>  Die spezifischen Ergebnisse h√§ngen von der Struktur der Datenbank ab, aber im Durchschnitt entspricht die Wiederherstellungszeit ungef√§hr der doppelten Sicherungszeit.  Wenn wir also die Sicherungszeit pro Einheit nehmen, dann "klassische Konvertierung" - drei Zeiteinheiten, Fluss - zwei Zeiteinheiten.  Eine Erh√∂hung von TempCacheLimit hilft auch, die Zeit zu verk√ºrzen. <br><br>  Im Allgemeinen k√∂nnen Sie durch die Stream-Konvertierung in der Praxis 30-40% der Zeit eines alternativen Backups und Restaurants sparen. <br><br>  <b>Fragen?</b> <br><br>  Bitte schreiben Sie alle Fragen in die Kommentare oder senden Sie sie an den Autor der Methodik und Mitautor dieses Artikels - Vasily Sidorov, den f√ºhrenden Systemingenieur von iBase, bei bs at ibase ru. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de445204/">https://habr.com/ru/post/de445204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de445194/index.html">10 Konzepte f√ºr einen Designer im Jahr 2019</a></li>
<li><a href="../de445196/index.html">Kubernetes 1.14: √úberblick √ºber wichtige Innovationen</a></li>
<li><a href="../de445198/index.html">Cmus Console Player f√ºr Linux</a></li>
<li><a href="../de445200/index.html">Internetprovider bitten das Kommunikationsministerium, sie ohne Vertrag in ihre H√§user zu lassen</a></li>
<li><a href="../de445202/index.html">Happy Potter und der Orden von CSS</a></li>
<li><a href="../de445206/index.html">Reduzieren Sie Ausfallzeiten beim Upgrade von Zimbra</a></li>
<li><a href="../de445208/index.html">Reifegrad der Unternehmens-IT</a></li>
<li><a href="../de445210/index.html">Kryptow√§hrungskolonie</a></li>
<li><a href="../de445212/index.html">NetBIOS in den H√§nden eines Hackers</a></li>
<li><a href="../de445214/index.html">Wir pumpen React Hooks mit FRP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>