<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèº ‚òùüèø üôç Fazendo o MacBook Pro 2018 T2 funcionar com o ArchLinux (dualboot) üç° üà∏ üëê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Houve muito hype sobre o fato de que, devido ao novo chip T2, √© imposs√≠vel instalar o linux no novo MacBook 2018 com uma barra de toque. Com o passar ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Fazendo o MacBook Pro 2018 T2 funcionar com o ArchLinux (dualboot)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472106/"> Houve muito hype sobre o fato de que, devido ao novo chip T2, √© imposs√≠vel instalar o linux no novo MacBook 2018 com uma barra de toque.  Com o passar do tempo, e at√© o final de 2019, desenvolvedores de terceiros implementaram v√°rios drivers e patches de kernel para interagir com o chip T2.  O driver principal para os modelos MacBook 2018 e mais recentes implementa o trabalho do VHCI (a opera√ß√£o do toque / teclado / etc.), bem como o funcionamento do som. <br><br>  O projeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mbp2018-bridge-drv</a> est√° dividido em 3 componentes principais: <br><br><ul><li>  BCE (Buffer Copy Engine) - estabelece o principal canal de comunica√ß√£o com o T2.  O VHCI e o √°udio requerem esse componente. </li><li>  VHCI √© um controlador de host virtual USB;  teclado, mouse e outros componentes do sistema s√£o fornecidos por este componente (outros drivers usam esse controlador host para fornecer mais funcionalidades. </li><li>  √Åudio - driver para interface de √°udio T2, atualmente apenas a sa√≠da de √°udio pelos alto-falantes internos do MacBook √© suportada </li></ul><a name="habracut"></a><br>  O segundo projeto √© chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">macbook12-spi-driver</a> , e implementa a possibilidade do driver de entrada para o teclado, SPI trackpad, touchbar para MacBook Pro no final de 2016 e posterior.  Alguns drivers para o teclado / trackpad agora est√£o inclu√≠dos no kernel, come√ßando com a vers√£o 5.3. <br><br>  Tamb√©m foi implementado suporte para dispositivos como wi-fi, touchpad etc. usando patches do kernel.  Atualmente a vers√£o do kernel √© <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">5.3.5-1</a></b> <br><br><h4>  O que funciona no momento </h4><br><ol><li>  NVMe </li><li>  Teclado </li><li>  USB-C (Thunderbolt n√£o foi testado, quando o m√≥dulo √© carregado automaticamente, ele suspende o sistema firmemente) </li><li>  Barra de toque (com a capacidade de ativar as teclas Fn, luz de fundo, ESC, etc.) </li><li>  Som (apenas alto-falantes embutidos) </li><li>  M√≥dulo Wi-Fi (via brcmfmac e somente atrav√©s do iw) </li><li>  DisplayPort via USB-C </li><li>  Sensores </li><li>  Suspender / retomar (parcialmente) </li><li>  etc .. </li></ol><br>  Este tutorial √© aplic√°vel aos macbookpro15.1 e macbookpro15.2.  O artigo foi retirado de um github em ingl√™s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">daqui</a> .  Nem todo este artigo funcionou, ent√£o tive que procurar uma solu√ß√£o por conta pr√≥pria. <br><br><h4>  O que voc√™ precisa instalar </h4><br><ul><li>  USB-C Adaptador de dock USB (pelo menos tr√™s entradas USB para conectar um mouse, teclado, modem USB ou telefone no modo de compartilhamento).  Isso √© necess√°rio apenas nos est√°gios iniciais da instala√ß√£o. </li><li>  Teclado USB </li><li>  Unidade flash USB / USB-C com pelo menos 4 GB </li></ul><br><h2>  1. Desative a proibi√ß√£o de baixar de m√≠dia externa </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://support.apple.com/en-us/HT208330</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.ninjastik.com/support/2018-macbook-pro-boot-from-usb/</a> <br><br><h2>  2. Aloque espa√ßo livre usando o Utilit√°rio de Disco </h2><br>  Por conveni√™ncia, aloquei imediatamente 30 GB no disco, formatando-o para exfat no pr√≥prio Utilit√°rio de Disco.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Particionando um disco f√≠sico em parti√ß√µes do Utilit√°rio de Disco</a> . <br><br><h2>  3. Forme uma imagem iso </h2><br>  <b>Op√ß√µes:</b> <br><br><ol><li>  Voc√™ pode seguir o caminho simples e baixar a imagem finalizada com o kernel 5.3.5-1 e os patches do <a href="">link</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aunali1</a> <a href="">para a imagem finalizada</a> </li><li>  Crie uma imagem voc√™ mesmo atrav√©s do archlive (voc√™ precisa de um sistema com distribui√ß√£o arca) <br><br>  Instalar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">archiso</a> <br><br><pre><code class="bash hljs">pacman -S archiso</code> </pre> <br><pre> <code class="bash hljs">cp -r /usr/share/archiso/configs/releng/ archlive <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> archlive</code> </pre><br>  Adicione o reposit√≥rio ao pacman.conf: <br><br><pre> <code class="bash hljs">[mbp] Server = https://packages.aunali1.com/archlinux/<span class="hljs-variable"><span class="hljs-variable">$repo</span></span>/<span class="hljs-variable"><span class="hljs-variable">$arch</span></span></code> </pre><br>  Ignore o kernel original no pacman.conf: <br><br><pre> <code class="plaintext hljs">IgnorePkg = linux linux-headers</code> </pre><br>  Adicione os pacotes necess√°rios, no final adicionamos o kernel linux-mbp e linux-mbp-headers <br><br><pre> <code class="plaintext hljs">... wvdial xl2tpd linux-mbp linux-mbp-headers</code> </pre><br>  Altere o script para funcionar no modo interativo (substitua pacstrap -C por pacstrap -i -C): <br><br><pre> <code class="bash hljs">sudo nano /usr/bin/mkarchiso</code> </pre> <br><pre> <code class="plaintext hljs"># Install desired packages to airootfs _pacman () { _msg_info "Installing packages to '${work_dir}/airootfs/'..." if [[ "${quiet}" = "y" ]]; then pacstrap -i -C "${pacman_conf}" -c -G -M "${work_dir}/airootfs" $* &amp;&gt; /dev/null else pacstrap -i -C "${pacman_conf}" -c -G -M "${work_dir}/airootfs" $* fi _msg_info "Packages installed successfully!" }</code> </pre> <br>  Formamos uma imagem: <br><br><pre> <code class="bash hljs">sudo ./build.sh -v</code> </pre> <br>  Pressione Y para pular os pacotes ignorados e, em seguida, escreva a imagem iso na unidade flash USB: <br><br><pre> <code class="bash hljs">sudo dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=out/archlinux*.iso of=/dev/sdb bs=1M</code> </pre> <br></li></ol><br><h2>  4. Primeira inicializa√ß√£o </h2><br>  Reinicie com a unidade flash inserida e o teclado.  Pressione as op√ß√µes quando a ma√ß√£ aparecer, selecione EFI BOOT. <br><br>  Em seguida, voc√™ precisa pressionar a tecla "e" e escrever <b>module_blacklist = thunderbolt</b> no final da linha de comando.  Se isso n√£o for feito, o sistema poder√° n√£o inicializar e o erro Thunderbolt ICM falhar√°. <br><br>  Usando o fdisk / cfdisk, encontramos nossa parti√ß√£o (eu tenho a nvme0n1p4), formata e instala o arch.  Voc√™ pode usar as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instru√ß√µes oficiais</a> ou de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">terceiros</a> . <br><br>  N√≥s n√£o criamos a parti√ß√£o de inicializa√ß√£o, vamos escrever o carregador de inicializa√ß√£o em <b>/ dev / nvme0n1p1</b> <br>  Ap√≥s o ambiente em / mnt estar totalmente formado e antes de mudar para o arch-chroot, escrevemos: <br><br><pre> <code class="bash hljs">mount /dev/nvme0n1p1 /mnt/boot arch-chroot /mnt /bin/bash</code> </pre><br>  Adicione ao /etc/pacman.conf: <br><br><pre> <code class="bash hljs">[mbp] Server = https://packages.aunali1.com/archlinux/<span class="hljs-variable"><span class="hljs-variable">$repo</span></span>/<span class="hljs-variable"><span class="hljs-variable">$arch</span></span></code> </pre><br>  Instale o kernel: <br><br><pre> <code class="bash hljs">sudo pacman -S linux-mbp linux-mbp-headers sudo mkinitcpio -p linux-mbp</code> </pre><br>  Coloque thunderbolt e applesmc em /etc/modprobe.d/blacklist.conf <br><br><pre> <code class="plaintext hljs">blacklist thunderbolt blacklist applesmc</code> </pre><br><h3>  Teclado, barra de toque, etc </h3><br>  Instale yay: <br><br><pre> <code class="bash hljs">sudo pacman -S git gcc make fakeroot binutils git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://aur.archlinux.org/yay.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> yay makepkg -si</code> </pre><br>  Instale os m√≥dulos para a barra de toque: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> --branch mbp15 https://github.com/roadrunner2/macbook12-spi-driver.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> macbook12-spi-driver make install</code> </pre><br>  Adicione m√≥dulos ao carregamento autom√°tico: /etc/modules-load.d/apple.conf <br><br><pre> <code class="plaintext hljs">industrialio_triggered_buffer apple-ibridge apple-ib-tb apple-ib-als</code> </pre><br>  Instale os m√≥dulos do kernel para o teclado.  O reposit√≥rio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">anuali1</a> possui um pacote pronto, chamado <b>apple-bce-dkms-git</b> .  Para instal√°-lo, escreva no console: <br><br><pre> <code class="bash hljs">pacman -S apple-bce-dkms-git</code> </pre> <br>  Nesse caso, o m√≥dulo do kernel ser√° chamado <b>apple-bce</b> .  No caso de auto-montagem, √© chamado <b>bce</b> .  Portanto, se voc√™ deseja registrar o m√≥dulo na se√ß√£o MODULES no arquivo mkinicpio.conf, n√£o esque√ßa de qual m√≥dulo voc√™ instalou. <br><br>  Montagem manual: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/MCMrARM/mbp2018-bridge-drv.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mbp2018-bridge-drv make cp bce.ko /usr/lib/modules/extramodules-mbp/bce.ko</code> </pre><br>  Adicione o m√≥dulo bce ou apple-bce ao carregamento autom√°tico: /etc/modules-load.d/bce.conf <br><br><pre> <code class="bash hljs">bce</code> </pre> <br>  Se voc√™ deseja usar os bot√µes Fn por padr√£o, no arquivo /etc/modprobe.d/apple-tb.conf, escrevemos: <br><br><pre> <code class="plaintext hljs">options apple-ib-tb fnmode=2</code> </pre> <br>  Atualizando o kernel e o initramfs. <br><br><pre> <code class="bash hljs">mkinitcpio -p linux-mbp</code> </pre><br>  Instale o iwd: <br><br><pre> <code class="bash hljs">sudo pacman -S networkmanager iwd</code> </pre> <br><h2>  5. Carregador de Inicializa√ß√£o </h2><br>  Uma vez dentro do chroot, todos os pacotes principais est√£o instalados, voc√™ pode prosseguir com a instala√ß√£o do gerenciador de inicializa√ß√£o. <br><br>  Eu nunca consegui fazer o grub trabalhar.  Em uma unidade USB externa, o grub √© inicializado, mas quando voc√™ tenta registr√°-lo no nvme via <blockquote>  grub-install --target = x86_64-efi --efi-directory = / boot --bootloader-id = grub </blockquote>  o sistema entrou em p√¢nico no kernel e, ap√≥s a reinicializa√ß√£o, um novo item por meio de op√ß√µes n√£o apareceu.  N√£o encontrei nenhuma solu√ß√£o intelig√≠vel para esse problema e, portanto, decidi tentar implementar a inicializa√ß√£o usando o systemd-boot. <br><br><ol><li>  Lan√ßamos <br><br><pre> <code class="bash hljs">bootctl --path=/boot install</code> </pre> <br>  e voe para o p√¢nico do kernel.  Desligue o MacBook, ligue-o novamente, clique em op√ß√µes (n√£o desative o hub usb-c com o teclado) </li><li>  Verifique se um novo registro EFI BOOT apareceu al√©m do dispositivo externo </li><li>  Selecionamos a inicializa√ß√£o em uma unidade USB externa, como durante a primeira instala√ß√£o (n√£o esque√ßa de escrever module_blacklist = thunderbolt) </li><li>  Montamos nosso disco e entramos no ambiente atrav√©s do arch-chroot </li></ol><br><pre> <code class="bash hljs">mount /dev/nvme0n1p4 /mnt mount /dev/nvme0n1p1 /mnt/boot arch-chroot /mnt</code> </pre><br>  Se for necess√°rio que o teclado funcione at√© que o sistema esteja totalmente carregado (isso √© necess√°rio se a criptografia luks / dm-crypt for usada), escrevemos no arquivo /etc/mkinicpio.conf na se√ß√£o MODULES: <br><br><pre> <code class="plaintext hljs">MODULES=(ext4 applespi intel_lpss_pci spi_pxa2xx_platform bce)</code> </pre><br>  Atualizando o kernel e o initramfs. <br><br><pre> <code class="bash hljs">mkinicpio -p linux-mbp</code> </pre><br><h4>  Configurar systemd-boot </h4><br>  Editamos o arquivo /boot/loader/loader.conf, exclu√≠mos tudo dentro dele e adicionamos o seguinte: <br><br><pre> <code class="plaintext hljs">default arch timeout 5 editor 1</code> </pre><br>  V√° para a pasta / boot / loader / inputs, crie o arquivo arch.conf e escreva: <br><br><pre> <code class="plaintext hljs">title arch linux /vmlinuz-linux-mbp initrd /initramfs-linux-mbp.img options root=/dev/&lt;b&gt;nvme0n1p4&lt;/b&gt; rw pcie_ports=compat</code> </pre><br>  Se voc√™ usou luks e lvm, ent√£o <br><br><pre> <code class="plaintext hljs">options cryptdevice=/dev/&lt;b&gt;nvme0n1p4&lt;/b&gt;:luks root=/dev/mapper/vz0-root rw pcie_ports=compat</code> </pre><br>  Reinicie no MacOS. <br><br><h2>  6. configura√ß√£o de Wi-fi </h2><br>  Como se viu, o MacOS armazena os arquivos de firmware do adaptador wi-fi na pasta <b>/ usr / share / firmware / wifi</b> , e voc√™ pode retir√°-los de l√° na forma de blobs e aliment√°-los no m√≥dulo do kernel brcmfmac.  Para descobrir exatamente quais arquivos o seu adaptador usa, abra o terminal no MacOS e escreva: <br><br><pre> <code class="bash hljs">ioreg -l | grep C-4364</code> </pre> <br>  Temos uma lista longa.  Precisamos apenas de arquivos da se√ß√£o <b>RequestedFiles</b> : <br><br><pre> <code class="plaintext hljs">"RequestedFiles" = ({"Firmware"="&lt;b&gt;C-4364__s-B2/maui.trx&lt;/b&gt;","TxCap"="C-4364__s-B2/maui-X3.txcb","Regulatory"="C-4364__s-B2/&lt;b&gt;maui-X3.clmb&lt;/b&gt;","NVRAM"="C-4364__s-B2/&lt;b&gt;P-maui-X3_M-HRPN_V-m__m-7.7.txt&lt;/b&gt;"})</code> </pre><br>  No seu caso, os nomes dos arquivos podem ser diferentes.  Copie-os da pasta / usr / share / firmware / wifi para a unidade flash USB e renomeie-a para a seguinte exibi√ß√£o: <br><br><pre> <code class="plaintext hljs"> maui.trx -&gt; brcmfmac4364-pcie.bin maui-X3.clmb -&gt; brcmfmac4364-pcie.clm_blob P-maui-X3_M-HRPN_V-m__m-7.7.txt -&gt; brcmfmac4364-pcie.Apple Inc.-&lt;b&gt;MacBookPro15,2.txt&lt;/b&gt;</code> </pre><br>  Nesse caso, o √∫ltimo arquivo de texto cont√©m o nome do modelo, se o modelo n√£o for macbookpro15,2, ser√° necess√°rio renomear esse arquivo de acordo com o modelo do macbook. <br><br>  Reinicie em arco. <br><br>  Copie arquivos da unidade flash USB para a pasta / lib / firmware / brcm / <br><br><pre> <code class="bash hljs">sudo cp brcmfmac4364-pcie.bin /lib/firmware/brcm/ sudo cp brcmfmac4364-pcie.clm_blob /lib/firmware/brcm/ sudo cp <span class="hljs-string"><span class="hljs-string">'brcmfmac4364-pcie.Apple Inc.-&lt;b&gt;MacBookPro15,2.txt'</span></span> /lib/firmware/brcm/</code> </pre><br>  Verifique a sa√∫de do m√≥dulo: <br><br><pre> <code class="bash hljs">rmmod brcmfmac modprobe brcmfmac</code> </pre><br>  Garantimos que a interface de rede apare√ßa atrav√©s do ifconfig / ip. <br>  Configurar wifi via <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">iwctl</a> <br><br>  <b>Aten√ß√£o</b>  <b>Via netctl, nmcli, etc.</b>  <b>a interface n√£o funciona, apenas atrav√©s do iwd.</b> <br><br>  Fazendo o NetworkManager usar o iwd.  Para fazer isso, crie o arquivo /etc/NetworkManager/NetworkManager.conf e escreva: <br><br><pre> <code class="plaintext hljs">[device] wifi.backend=iwd</code> </pre><br>  Iniciando o servi√ßo NetworkManager <br><br><pre> <code class="bash hljs">sudo systemctl start NetworkManager.service sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> NetworkManager.service</code> </pre><br><h2>  7. Som </h2><br>  Para emitir som, voc√™ deve instalar o pulseaudio: <br><br><pre> <code class="bash hljs">sudo pacman -S pulseaudio</code> </pre><br>  Baixe tr√™s arquivos: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">91-pulseaudio-custom.rules</a> </li><li>  <a href="">apple-t2.conf</a> </li><li>  <a href="">AppleT2.conf</a> </li></ul><br>  Mova-os: <br><br><pre> <code class="plaintext hljs"> /usr/share/alsa/cards/AppleT2.conf /usr/share/pulseaudio/alsa-mixer/profile-sets/apple-t2.conf /usr/lib/udev/rules.d/91-pulseaudio-custom.rules</code> </pre> <br><h2>  8. Suspender / Continuar </h2><br>  No momento, <b>16/10/2019</b> , voc√™ deve escolher o som ou suspender / retomar.  Estamos aguardando o autor do m√≥dulo bce concluir a funcionalidade. <br><br>  Para criar um m√≥dulo com suporte para susped / resume, voc√™ deve fazer o seguinte: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/MCMrARM/mbp2018-bridge-drv.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> mbp2018-bridge-drv git checkout <span class="hljs-built_in"><span class="hljs-built_in">suspend</span></span> make cp bce.ko /usr/lib/modules/extramodules-mbp/bce.ko modprobe bce</code> </pre><br>  Se voc√™ instalou o m√≥dulo apple-bce pronto a partir do reposit√≥rio anuali1, voc√™ deve primeiro remov√™-lo e, em seguida, coletar e instalar o m√≥dulo bce com suporte ao modo de suspens√£o. <br><br>  Al√©m disso, voc√™ precisa adicionar o m√≥dulo applesmc √† lista negra (se voc√™ n√£o tiver feito isso antes) e verifique se <b>pcie_ports = compat foi</b> adicionado ao /boot/loader/entries/arch.conf na linha de op√ß√µes no final. <br><br>  No momento, o driver da barra de toque trava quando voc√™ entra no modo de suspens√£o, e o driver do raio √†s vezes suspende o sistema por mais de 30 segundos e, ao reiniciar, por v√°rios minutos.  Isso pode ser corrigido baixando automaticamente os m√≥dulos com problemas. <br><br>  Crie o script <b>/lib/systemd/system-sleep/rmmod.sh</b> : <br><br><pre> <code class="plaintext hljs">#!/bin/sh if [ "${1}" == "pre" ]; then rmmod thunderbolt rmmod apple_ib_tb elif [ "${1}" == "post" ]; then modprobe apple_ib_tb modprobe thunderbolt fi</code> </pre><br>  Torne execut√°vel: <br><br><pre> <code class="bash hljs">sudo chmod +x /lib/systemd/system-sleep/rmmod.sh</code> </pre> <br>  Por enquanto √© tudo.  O resultado √© um sistema totalmente funcional, com exce√ß√£o de algumas nuances com suspens√£o / retomada.  Nenhuma falha e p√¢nico do kernel foram observados por v√°rios dias em atividade.  Espero que, no futuro pr√≥ximo, o autor do m√≥dulo bce o finalize e tenhamos suporte total para suspender / retomar e som. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt472106/">https://habr.com/ru/post/pt472106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt472092/index.html">Fun√ß√µes PHP inseguras</a></li>
<li><a href="../pt472094/index.html">Delegados e eventos em C #</a></li>
<li><a href="../pt472096/index.html">O clicker Android inscreve usu√°rios em servi√ßos pagos</a></li>
<li><a href="../pt472100/index.html">Shchyry ucraniano Dunno ou Como Kiev n√£o adivinhou</a></li>
<li><a href="../pt472104/index.html">Habr Weekly # 23 / Voando no espa√ßo e na mente, a Microsoft enterra o Windows Phone, o legado da Matrix, os jogos de papel</a></li>
<li><a href="../pt472110/index.html">Passamos o desafio RegexPlay 100%</a></li>
<li><a href="../pt472112/index.html">Chatbot no barato</a></li>
<li><a href="../pt472114/index.html">Consola de jogos e jogos "fa√ßa voc√™ mesmo". Little Game Engine + ESPboy</a></li>
<li><a href="../pt472118/index.html">Como a American Zoom na China bloqueou</a></li>
<li><a href="../pt472120/index.html">Conceito de Navega√ß√£o em Campo Adaptativo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>