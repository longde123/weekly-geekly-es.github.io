<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸšµğŸ½ ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ½ ğŸ‘²ğŸ¼ Kami memuat profil Habr atau bagaimana 189 permintaan pada halaman memberikan pengaruh ğŸ¶ â¡ï¸ ğŸ’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa waktu lalu, saya menjadi tertarik dengan kinerja situs web, pengunduhan unduhan, dan sejenisnya. Dan sekarang, sekali lagi pergi ke Habr, say...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami memuat profil Habr atau bagaimana 189 permintaan pada halaman memberikan pengaruh</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454444/"><p><img src="https://habrastorage.org/webt/dg/5m/ab/dg5mabkefi6xhfiovvydhay2fkw.jpeg" alt="Ambil jus ceri kental"></p><br><p>  Beberapa waktu lalu, saya menjadi tertarik dengan kinerja situs web, pengunduhan unduhan, dan sejenisnya.  Dan sekarang, sekali lagi pergi ke Habr, saya berpikir bahwa saya terbiasa melihat pemuatan sumber daya yang lebih cepat sebagai sesuatu yang diberikan, bahkan tanpa memikirkan bagaimana hal ini dicapai.  Oleh karena itu, saya memutuskan untuk menggabungkan bisnis dengan kesenangan - untuk melihat bagaimana keadaan dengan kinerja Habr dan solusi teknis apa yang dibuat untuk mengoptimalkannya. </p><br><p>  Bagi mereka yang tertarik mengetahui apa yang telah dilakukan sehingga kami menerima konten secepat mungkin dan bagaimana unduhan Habr dari Argentina terlihat seperti - tolong, di bawah kucing. </p><a name="habracut"></a><br><h2 id="podgotovka">  Persiapan </h2><br><p>  Kami membutuhkan versi baru Chrome / Canary yang bekerja dalam mode anonim (pastikan semua ekstensi dimatikan).  Juga, di Developer Console (Developer Tools - F12), di tab jaringan, Anda harus mengatur flag cache yang dinonaktifkan, karena  <strong>Kami hanya akan membuat profil boot pertama, sementara belum ada sumber di cache.</strong> </p><br><h2 id="etap-pervyy---po-verham">  Tahap Satu - "Lantai Atas" </h2><br><p>  Tujuan utama dari bagian ini adalah untuk berkenalan dengan situs secara keseluruhan, untuk memahami strukturnya dan mencari tahu sumber daya spesifik apa yang dibutuhkan. </p><br><p>  Kami membuka alat pengembang, buka tab jaringan, buka situs dan di bagian paling bawah tab kami melihat statistik penggunaan jaringan: </p><br><p><img src="https://habrastorage.org/webt/ni/fs/yb/nifsybxewz18qswerh5jubfsn1a.png" alt="Dan cap ibu putih."></p><br><p>  Seluruh situs dimuat dalam 2,02 detik, yang tampak hebat (mengingat beban Habr).  Acara <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">DomContentLoaded</a> (selanjutnya hanya DCL) umumnya muncul dalam 1,01 detik yang terlihat lebih baik.  Dengan semua ini, situs ini membuat 189 permintaan dan memuat 9,6MB sumber daya.  Ini memberi tahu kita bahwa tim Habra jenius (mungkin juga), dan artikel tersebut harus diselesaikan di sini (dan minta mereka untuk minum kopi dan kue), atau ingat bahwa saya memiliki saluran 100 Mb / s dan Core I7 .  Yaitu  Anda perlu sedikit lebih dekat dengan kenyataan dan setidaknya membatasi lebar saluran. </p><br><p>  Kami mengaktifkan mode Fast 3G dan melihat lagi: </p><br><p><img src="https://habrastorage.org/webt/bp/ov/lk/bpovlkvte1ojvmuamwcoki4uniq.png" alt="Tuangkan jus ke jubah dengan lembut -"></p><br><p>  DCL memburuk menjadi 3,48 detik, yang masih bisa diterima.  Namun akhirnya situs tersebut dimuat dalam atheistik 54,76 detik.  Sekarang semuanya logis - Anda tidak bisa hanya mengunduh dan mengunduh hampir 10 megabita ketika koneksi Anda lemah.  Kemungkinan besar, orang-orang melakukan pekerjaan yang baik untuk menunjukkan kepada kami konten secepat mungkin (ini dibuktikan oleh fakta bahwa bahkan dalam mode fast3g DCL muncul cukup cepat), dan semua yang tidak kritis dibiarkan dimuat di latar belakang.  Kami akan memeriksanya sedikit nanti, dan sekarang mari kita lihat mengapa kami memuat begitu lama.  Urutkan semua permintaan berdasarkan waktu buka: </p><br><p><img src="https://habrastorage.org/webt/el/jv/uc/eljvucnzbn0d83cd2konxv8ff-8.png" alt="Tempat akan muncul."><br>  <a href="">Diklik</a> </p><br><p>  Gambar (top-7) dimuat paling lama dan satu file JavaScript adalah prebid.js.  Jika kita melihat ukurannya, kita dapat mengasumsikan bahwa ini adalah alasan tepatnya untuk loading yang lambat. </p><br><div class="spoiler">  <b class="spoiler_title">Tentang asumsi</b> <div class="spoiler_text"><p>  Dengan asumsi Anda harus sangat berhati-hati.  Misalnya, pemuatan sumber daya yang lama dapat disebabkan tidak hanya oleh ukuran file, tetapi juga, misalnya, masalah dengan DNS, beban penyimpanan puncak, atau cache server dingin.  Oleh karena itu, asumsi yang tidak terverifikasi dapat menyebabkan Anda membuang waktu untuk menyelesaikan masalah yang bahkan tidak ada. </p></div></div><br><p>  Melihat statistik ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">TTFB</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">0,610</a> ms, memuat: 40 000 ms), kita dapat menyimpulkan bahwa asumsi kami sangat mungkin.  Mari kita kagumi TOP 1 kita (png, 1560X780, 24bit): </p><br><p><img src="https://habrastorage.org/webt/61/ts/aj/61tsajb8gnvzqjaw0cg-mqdj32e.png" alt="Sekarang tidak ada tempat"></p><br><p>  Bahkan, masalah dengan gambar terutama masalah lalu lintas kami dengan Anda.  Gambar (tidak seperti gaya dan skrip) tidak memblokir perenderan halaman web, dan oleh karena itu, meskipun ada kelas berat seperti itu (bisa lebih buruk, mereka melihatnya), ini hampir tidak mempengaruhi kinerja.  Meskipun, tentu saja, optimasi ke arah ini (misalnya, transcoding ke jpeg2000 atau webp, atau pemuatan progresif tidak akan berlebihan). </p><br><div class="spoiler">  <b class="spoiler_title">Tentang gambar</b> <div class="spoiler_text"><p>  Seperti yang saya tulis di atas, gambar tidak memblokir rendering halaman.  Tetapi mereka menggunakan kumpulan koneksi kami, dan di http 1.x jumlah mereka terbatas, dan dengan http 2.x dan Chrome juga, tidak semuanya semulus yang saya dengar.  Oleh karena itu, bahkan di sini ada kemungkinan bahwa beberapa gambar dapat memperlambat pemuatan skrip sinkron, dan pada gilirannya, sudah akan berhenti membuat halaman.  Selain itu, memuat gambar juga dapat menyebabkan penghitungan ulang tata letak, sehingga memperlambat proses rendering.  Jika kita melihat marka Habr, hampir semua tag img memiliki lebar dan tinggi.  Ini menghilangkan kebutuhan untuk reflow untuk secara positif mempengaruhi kinerja unduhan.  Anda dapat membaca lebih lanjut tentang ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p></div></div><br><p>  Mari kita lihat sumber daya apa yang menarik Habr - kita akan membahas jenis dan mengurutkannya berdasarkan waktu muat.  Mari kita mulai dengan JavaScript </p><br><h3 id="javascript">  Javascript </h3><br><div class="spoiler">  <b class="spoiler_title">Tentang javascript</b> <div class="spoiler_text"><p>  JavaScript memiliki beberapa masalah dalam hal kinerja situs.  Pertama (semua orang tahu tentang ini untuk waktu yang lama), js sinkron memblokir rendering halaman lebih lanjut.  Yaitu  sampai kami menerima dan menjalankan JavaScript kami, browser akan menunggu (sebenarnya tidak cukup, browser, terutama Chrome, dapat mengoptimalkan, tapi ini adalah cerita lain) dan tidak akan membuat konten lebih lanjut.  Menggunakan skrip sinkron di kepala, kami menunda saat ketika pengguna melihat setidaknya sesuatu (bahkan teks).  Oleh karena itu, semua orang mencoba untuk melempar Js di akhir halaman atau bahkan membuatnya tidak sinkron.  Ini berfungsi, tetapi tidak menyelesaikan masalah kedua yang membawa kita fakta bahwa JavaScript masih merupakan bahasa scripting.  Oleh karena itu, peramban tidak cukup hanya dengan mengunduhnya - browser juga harus "dipahami".  Dan di sini, ternyata ini adalah masalah, karena prosesor yang lemah (misalnya, di ponsel atau netbook murah, atau bahkan laptop yang bagus dalam mode kinerja terbatas) melakukannya perlahan, menghalangi utas utama!  Di bawah ini adalah contoh bagaimana skrip iklan asinkron memasuki bagian penting dari Habr render dan meskipun sedikit, tetapi masih merusak kinerjanya.  Jika ada yang tertarik, ada artikel yang sangat (sangat, sangat) bagus tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">topik ini.</a> </p></div></div><br><p>  Script Habr memuat banyak - 1,1 MB (dan ini sudah dalam bentuk terjepit) untuk 40 permintaan.  Ini sangat penting, masih kembali kepada kita dan kita perlu melakukan sesuatu.  Urutkan skrip kami "dengan air terjun."  Tugas kami adalah menemukan skrip yang dimuat SEBELUM garis biru, karena mereka (kemungkinan besar) yang mencegah kami membuat situs secepat mungkin. </p><br><p><img src="https://habrastorage.org/webt/0m/8g/u4/0m8gu4f9s-odx2kf7xg8jiweuke.png" alt="Di jubah ibuku"><br>  <a href="">Diklik</a> </p><br><p>  Kami membuka html yang diberikan Habr (penting untuk melihat jawabannya, karena html terakhir akan terlihat berbeda) dan memeriksa daftarnya.  Seperti yang Anda lihat - jQuery, raven.js, advertise.js dan adriver.js dimuat secara sinkron langsung dari tag kepala (mis. Mereka memblokir semuanya sama sekali).  Gpt dan penerbit dimuat dari kepala tetapi sudah tidak sinkron (mis. Mereka tidak memblokir apa pun, peramban akan membuat laman lebih jauh saat memuat).  Vendor, Main dan Math, checklogin dimuat di bagian akhir, tetapi secara sinkron (mis. Teks sudah ada di sana, kita bisa membacanya, tetapi DCL tidak akan muncul sampai mereka memuat).  Sisanya tidak muncul dalam jawaban awal - mereka ditambahkan secara dinamis, tetapi ini adalah topik lain. </p><br><p>  Jadi, kami menemukan skrip yang entah bagaimana memengaruhi seberapa cepat kami melihat teks pada halaman.  Ini adalah kandidat pertama untuk optimasi.  Idealnya, mereka harus dibuat tidak sinkron atau ditempatkan serendah mungkin untuk memungkinkan browser memberikan konten untuk kita.  Namun, yang ideal tidak dapat dicapai, karena kemungkinan besar ada skrip lain di situs yang bergantung pada jQuery yang sama.  Keinginan untuk mengunduh gagak sesegera mungkin - perpustakaan untuk melacak berbagai kesalahan yang terjadi pada klien, juga dapat dipahami.  Tetapi advertise.js dan adriver.js sudah menjadi kandidat nyata untuk setidaknya pindah ke bawah halaman, dan sebagai maksimum juga dalam mode asinkron.  Kisah serupa dengan gpt dan penerbit.  Ya, mereka dimuat secara tidak sinkron, tetapi, bagaimanapun, mereka dapat (dan akan) mengganggu kita saat memuat.  Karena itu, mereka juga dapat dikirim ke bagian paling bawah halaman.  Selain itu, Anda dapat mencoba menggunakan atribut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Resource Hints</a> - preload / prefetch / dns-prefetch untuk memberi tahu browser apa yang harus dimuat terlebih dahulu.  Ngomong-ngomong, saya menyarankan Anda untuk membaca tentang Petunjuk Sumber Daya - alat yang sangat menarik, meskipun dengan dukungan yang terbatas (sejauh ini). </p><br><p>  Sekarang urutkan daftar berdasarkan ukuran file: </p><br><p><img src="https://habrastorage.org/webt/r-/om/kq/r-omkqj5qrslwffj42o5eogv_3s.png" alt="Jubah harus diselipkan utuh"><br>  https://github.com/Drag13/articles/blob/habrformance/habrformance/scripts.PNG </p><br><p>  Kami melihat skrip yang memuat dua kali (pubads).  Kami juga memperhatikan bahwa prebid.js diambil dari folder not-for-prod </p><br><p><img src="https://habrastorage.org/webt/4e/su/7w/4esu7wsvwdpgmbw8nscc_sqcgmo.png" alt="Dalam jus ceri kental."></p><br><p>  Untuk menghapus nurani kami, kami memeriksa bahwa semua skrip diperkecil.  Tiba-tiba, skrip check-login.js dan adriver.js tidak dikecilkan.  Terutama senang dengan konten yang terakhir: </p><br><p><img src="https://habrastorage.org/webt/6q/nv/q8/6qnvq8dimcd_5m3w77mr3mkjlea.png" alt="Ambil cap ibu ceri"></p><br><p>  Dan dengan skrip Anda dapat mengakhiri sementara. </p><br><h3 id="stili">  Gaya </h3><br><div class="spoiler">  <b class="spoiler_title">Tentang gaya</b> <div class="spoiler_text"><p>  Dengan gaya, semuanya juga tidak begitu sederhana.  Pertama, memuat gaya secara sinkron juga memblokir utas utama (meskipun mereka diuraikan dengan cepat, lebih cepat dari JavaScript).  Dan kedua, semuanya sedikit lebih rumit.  Mengapa browser membutuhkan CSS?  Untuk membangun <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CSSOM</a> .  Apa yang bisa dilakukan JavaScript dengan CSS?  Itu benar - ubah.  Dan apa yang akan terjadi jika CSSOM belum dibangun, dan js sudah mencoba mengubah sesuatu di sana?  Jawabannya adalah siapa yang tahu.  Karena itu, browser menunda eksekusi JavaScript hingga CSSOM dihitung.  Seperti yang ditulis dengan benar di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel</a> lain yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sangat bermanfaat</a> - tanpa CSS = tanpa JavaScript.  Oleh karena itu, memuat CSS memblokir eksekusi JS. </p></div></div><br><p>  Berikut adalah gaya yang dimuat Habr: </p><br><p><img src="https://habrastorage.org/webt/nm/6y/a7/nm6ya7qcp1bdqcp5sl2fiingrp8.png" alt="Dan secangkir susu."><br>  <a href="">Diklik</a> </p><br><p>  Seperti yang Anda lihat, hanya ada tiga, dengan yang kedua dan ketiga dimuat dalam bingkai yang terpisah, jadi kami abaikan.  Tetapi set gaya pertama sangat penting untuk seluruh situs.  Dan kami mengunduhnya untuk waktu yang sangat lama.  Mengapa  Pertama, mereka menunggu lama untuk tanggapan dari server (TTFB 570 ms, kami akan kembali ke sana di bagian ketiga), dan kedua, 713 ms dimuat untuk waktu yang lama.  Apa yang bisa dilakukan di sini.  Yang pertama dan paling sederhana adalah mencoba menambahkan atribut preload.  Ini akan meminta browser untuk mulai memuat CSS sedini mungkin.  Opsi kedua adalah untuk menyoroti CSS kritis dan menanamkannya langsung ke halaman web, dan memuat sisanya secara sinkron (atau bahkan tidak sinkron).  Ini akan menyebabkan peningkatan ukuran halaman (tapi itu tidak kecil dan + 5kb tidak akan merusak apa pun) dan kemungkinan redraw dari tata letak (kehilangan waktu), tetapi Anda dapat mencoba. </p><br><p>  Saya bahkan tidak akan menampilkan font.  Itu ada di sana sendiri, meskipun untuk beberapa alasan itu dimuat langsung dari server Habr bukan CDN (dan kemungkinan besar karena suatu alasan).  Tapi saya akan mengucapkan terima kasih untuk kenyataan bahwa hanya ada satu font. </p><br><p>  Pada ini, bagian ikhtisar analisis situs dapat dianggap selesai.  Saatnya masuk lebih dalam. </p><br><h2 id="etap-vtoroy---ruchnoy-rezhim">  Tahap Dua - "Mode Manual" </h2><br><p>  Pada tahap terakhir kami melihat <em>bahwa</em> Habr memuat.  Sekarang kita akan melihat <em>bagaimana</em> ini diterjemahkan. </p><br><p>  Buka tab profiling.  Kami memeriksa apa perlambatan fast3g (kemudian jalankan lagi tanpa batasan) dan jalankan.  Pertama-tama, kami tertarik pada semua yang terjadi sebelum acara <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">First contentful paint (FCP)</a> , dan, untuk berjaga-jaga, DCL.  Kami memilih area dari awal pemuatan ke FCP dan melihat diagram terakhir. </p><br><p><img src="https://habrastorage.org/webt/1s/nb/qi/1snbqidqssgm4mxoulzysms7swu.png" alt="Tuang susu dengan rapi -"></p><br><p>  Semuanya terjadi cukup cepat - 2,161 detik sebelum FCP (lebih cepat, tetapi tampaknya ada sesuatu yang berubah), tetapi seperti yang Anda lihat, sebagian besar waktu browser tidak digunakan.  Muatan hanya memakan waktu 14% dari waktu (sekitar 310 ms).  Idealnya, utas peramban utama berjalan terus menerus - parsing html, CSS, mengeksekusi JS.  Dan di sini - tidak ada.  Mengapa  Karena browser tidak ada hubungannya.  Ingat kami mengurangi lalu lintas?  Peramban telah mengirim permintaan dan sekarang tinggal menunggu sampai selesai.  Jika kita membuka diagram proses jaringan (yang paling atas) semuanya akan segera menjadi jelas. </p><br><p><img src="https://habrastorage.org/webt/uf/1-/gt/uf1-gt0kx7rkdpd9tzeod3hv99o.png" alt="Tempat akan muncul."><br>  <a href="">Diklik</a> </p><br><p>  Pada 2029, browser melihat main.bundle.css, mengirim permintaan untuk menerimanya dan mulai menunggu.  Pada saat ini, prescanner (smart chrome, dapat berjalan di depan) menemukan bahwa ada skrip sinkron di bawah ini dan tanpa menunggu css tiba, ia mengirim permintaan untuk skrip.  Kemudian beriklan dan adriver dimuat (tetapi kami ingat bahwa sementara CSSOM tidak dibuat, Anda tidak dapat menyentuh JS), sehingga browser mengabaikannya.  Setelah itu, gpt dan gagak dimuat, tetapi CSS masih memuat, jadi mereka juga diabaikan.  Akhirnya, CSS dimuat, yang diurai browser dalam 12 ms dan segera pergi untuk mem-parsing JS yang tertanam di halaman.  Kemudian browser kembali "tertidur" di hampir 150 ms menunggu jQuery.min.js.  Dan setelah itu saya sudah mulai bekerja dengan serius - Saya menemukan jQuery yang dimuat (20 ms), mem-parsing raven.js (4 ms), mem-parsing hampir seluruh halaman (36 ms), menceritakan gaya (28 ms), menghitung tata letak (78 ms + 8 ms) dan, akhirnya, selama ~ 6 ms, kami mengecat halamannya.  Di sini kami mendapat FCP.  Selanjutnya, kita parsing halaman, parsing skrip - halo kepada siapa pun (publishertag.js, gpt.js yang masuk ke utas utama sebelum DCL), bermain-main dengan gaya sedikit (yang menyebabkan sedikit kehilangan waktu karena perhitungan ulang tata letak) dan mulai menunggu vendor. bundle.js.  Untuk menunggu vendor, kami hampir menghabiskan 1100 ms lagi.  Benar, secara paralel dengan itu, kami juga memuat main.bundle.js (yang, kebetulan, boot lebih cepat), jadi tidak semuanya buruk.  Kemudian semuanya berjalan dengan baik lagi.  Kami parsing vendor, parsing bundel utama, parsing Math.Jax, dan akhirnya parsing halaman dan mendapat DCL.  Benar, beberapa jenis handler bekerja di sana yang pada I7 saya menghentikan utas utama pada 80 ms (yaitu situs tersebut tampaknya membeku pada 80 ms).  Sekarang kita hampir tidak melihat ini, tetapi pada prosesor yang lemah, secara teoritis, itu bisa terlihat. Jika Anda melihat ini setelah konten diberikan, ini adalah kesempatan untuk memeriksa JS. </p><br><p>  Apa yang bisa saya katakan.  Lagi-lagi, terlepas dari kenyataan bahwa itu terlihat cukup bagus.  Masalah utama disampaikan kepada kami: </p><br><ul><li>  Peramban sederhana yang besar (termasuk karena ketidakseimbangan buatan antara daya komputasi komputer dan lebar saluran, tetapi ini juga merupakan skenario yang cukup valid) </li><li>  Pemuatan CSS lama yang menunda kerja dengan js kritis </li><li>  Pemuatan sinkron jQuery, vendor, dan bundel utama yang menghentikan tampilan konten. </li></ul><br><p>  Apa yang bisa kita lakukan dengan ini sudah kita bahas: </p><br><ul><li>  Coba tambahkan atribut preload untuk CSS dan mungkin beberapa JS </li><li>  Kurangi atau sebaris CSS </li><li>  Cobalah untuk membuang skrip secara umum dari pemuatan sinkron (setidaknya beberapa) </li></ul><br><p>  Sekarang mari kita ulangi hal yang sama tanpa batasan pada lebar saluran.  Gambar sudah jauh lebih baik: 0,452 detik untuk FMP, yang paling sederhana!  13 md.  DCL - 953 ms, sederhana 15 ms.  Seperti inilah unduhan impian saya.  Itulah yang terjadi karena saya membuka tab baru dan tidak menghapus caching.  Mari kita coba hal yang sama, tetapi tanpa cache: </p><br><p><img src="https://habrastorage.org/webt/g5/ji/5q/g5ji5qscsjud50jdqkoazqoxsga.png" alt="Sekarang tidak ada tempat"></p><br><p>  Semuanya juga cukup baik, FCP / FMP - 1689, payload 45%.  Omong-omong, menyesuaikan beban hingga 100% juga buruk, karena mesin yang lebih lemah akan kelebihan beban.  Jadi lebih baik memiliki cadangan untuk waktu henti.  Tapi, di sini secara tak terduga banyak waktu dihabiskan untuk Rendering - 400 ms untuk FMP.  Dari jumlah tersebut, 200 ms masuk ke perhitungan ulang gaya dan perhitungan kembali tata letak. </p><br><p>  Ngomong-ngomong, poin menarik lainnya.  Ingat skrip iklan - gpt.js dan publishertag.js yang disebutkan di bagian pertama?  Sekarang Anda dapat melihat bahwa meskipun tidak sinkron, mereka mampu (walaupun sedikit) merusak statistik kami.  Ini terjadi karena eksekusi skrip asinkron dilakukan sesuai dengan kesiapan skrip itu sendiri.  Yaitu  ini dapat terjadi kapan saja, termasuk sebelum FCP / DCL, yang terjadi pada 3309. </p><br><p>  Jadi, kami melakukan pembongkaran manual.  Sudah waktunya untuk mengungkap otomatisasi. </p><br><h2 id="etap-tretiy---s-etogo-nado-bylo-nachinat">  Tahap Tiga - â€œKami harus mulai dari iniâ€ </h2><br><div class="spoiler">  <b class="spoiler_title">Tentang pertanian kolektif</b> <div class="spoiler_text"><p>  Saya pikir semua orang mengerti bahwa penelitian ini sangat sewenang-wenang.  Setidaknya, karena sepanjang waktu ketika saya menguji artikel baru muncul, beban di server dan beban di tulang punggung jaringan berubah.  Dengan cara yang baik, Anda perlu menggunakan server khusus di mana tidak ada yang akan menulis apa pun, meniru beban yang relevan dengan penundaan yang relevan, dan hanya kemudian membuat profil sesuatu.  Jika tidak, Anda dapat membuat beberapa asumsi, (misalnya, tentang perlunya menambahkan atribut preload pada CSS), menambahkannya, menyebarkannya ke produksi, dan kemudian ternyata beban selama pengujian meningkat tajam dan server memberi kami gaya yang sama 500 ms nanti.  Dan ternyata preload itu buruk - itu hanya membuat segalanya lebih buruk.  Dan penulisnya adalah lobak terakhir.  Selain itu, pembuatan profil secara manual (seperti pada bagian kedua), hingga Anda menjalankan semua alat otomatis dan menyelesaikan masalah yang ditemukan di sana, juga tidak masuk akal, karena setelah perubahan pertama Anda gambar akan berubah. </p><br><p>  Karena itu, sebelum melakukan percobaan, kita memerlukan lingkungan yang paling stabil.  Kali ini  Yang kedua - Anda seharusnya tidak masuk terlalu dalam (misalnya, membuat profil) sejak awal.  Mulai alat otomatis pertama, biarkan mereka bekerja untuk Anda.  Kumpulkan laporan, lihat apa yang bisa dilakukan sebaik mungkin dalam waktu minimal.  Coba lakukan itu.  Jika memungkinkan, Anda mungkin sudah cukup.  Sebagai contoh, css.bundle Anda memiliki berat 100kb, tetapi pada kenyataannya Anda membutuhkan 45kb (omong-omong, situasi sebenarnya: mereka mengambil seluruh bootstrap, tetapi hanya grid yang diperlukan).  Mereka mengurangi ukuran gaya dan memenangkan setengah detik praktis tanpa biaya.  Ini dua.  Selalu periksa ulang.  Tampak bahwa gaya disatukan, semuanya harus menjadi lebih baik, tetapi akan menjadi lebih buruk.  Mengapa  Dan karena dalam gaya gambar base64 50kb, dan halaman kami hanya memuat 200kb sumber daya.  Ingatlah bahwa tidak ada peluru perak dan skrip universal.  Ini tiga.  Dan yang terakhir, bahkan jika itu bertentangan dengan kalimat sebelumnya.  Jika Anda tidak memiliki situs yang rumit, cukup pantau TTFB (masalah server), ukuran sumber daya yang diunduh (halo ke logo sebesar 2MB) dan jangan berikan akses ke Google Pengelola Tag, siapa pun.  Kemungkinan besar ini sudah cukup. </p></div></div><br><p>  Kami tidak akan melangkah jauh, di Alat Pengembang yang sama, membuka tab audit dan meluncurkan LightHouse (LH) dengan pengaturan berikut: desktop, hanya kinerja, tidak ada pembatasan, penyimpanan yang jelas.  Setelah menunggu sedikit (jangan meninggalkan halaman di mana audit sedang dilakukan dan tidak melakukan hal yang lebih baik) kami mendapatkan angka fantastis (bahkan dengan cache dinonaktifkan) </p><br><p><img src="https://habrastorage.org/webt/cg/cu/rc/cgcurczrbd7r4xhjqrtqgw-pj5s.png" alt="Di jubah ibuku"></p><br><p>  Bahkan bagi saya tampaknya mereka secara khusus disesuaikan dengan angka-angka ini. </p><br><p>  Namun, LH masih mengeluhkan: </p><br><ul><li>  Format gambar yang ketinggalan jaman (disarankan menggunakan webp, jpeg2000, dll) </li><li>  DOM node â€“    : 2533,   1500. </li><li>    </li><li>     â€”     23  </li><li>  document.write </li></ul><br><p>   .     (), DOM â€”      node (-),      (  ),   document.write-  writer ( -    ) </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p>    (       )   .    ,  ,  , .  ,   ,      .       CSS, â€”      ,   ,      JavaScript. ,        ,     .                       . </p></div></div><br><p>     ,       fast3g , ,      ( I7,  celeron): </p><br><p><img src="https://habrastorage.org/webt/td/ei/3j/tdei3jxtwbcvda5csqvvmgz2tua.png" alt="Jubah harus diselipkan utuh"></p><br><p>      ( FCP   3500 ms, FMP 5.7): </p><br><ul><li>   ,   . LH    next-gen  ,  ,   ,     11   </li><li>      .       adriver.js  advertise.js  50 ,     . </li><li>    CSS    ,    5kb  45kb. </li><li>      main thread.           JavaScript â€” (8.5   script evaluation   2186 ms   raven.js).   ? </li></ul><br><p>     ?         .    -    .  : </p><br><ul><li>   </li><li>   DOM </li><li>   JavaScript   </li></ul><br><p>    ,        ,         (,  raven.js). </p><br><p>  ,      ,       â€” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">webpagetest.org</a> </p><br><p>    â€”   ,  ,  .        â€”     ,      .   ,    .   ,    ,   . ,       ,      ,   â€”  -. </p><br><p>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://habr.com</a> ( ru/en ). </p><br><p><img src="https://habrastorage.org/webt/qz/hb/gn/qzhbgnvpgll4xbdlvejmvfzpndm.png" alt="Dalam wajan dengan susu."></p><br><p> ( ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="></a> ) </p><br><p>    .     ( )    DNS (500 ms   ),     , ssl   .   ,    1150 ms    c      (    ). ,     (    habrastorage). </p><br><p>      main.bundle.css. ,     dr.habracdn.net ,     dns lookup â€” 36 ms (     400 ms).  SSL negotiation 606 ms,  TTFB 601 ms,   .    .       DCL â€” 4100 ms   ,   . </p><br><p>     image analysis , ,        .  -      PNG  1.4,   webp + downscaling ( ,   ) â€” 17.7 KB.  ,       ,     png  154.          . ,  : </p><br><ul><li>         (   ,        , ..    ). </li><li>   .   ,    . </li><li>  TTFB (webpagetest    F  ) â€”     </li><li>       ,       (         ) </li></ul><br><h2 id="vyvody">  Kesimpulan </h2><br><p>      .     : </p><br><p>  : </p><br><ul><li>  TTFB   500 ms      ( <strong></strong> dns, ssl  initial connection) </li><li>  habrastorage </li></ul><br><p>  : </p><br><ul><li>    </li><li>   DOM-a </li><li>       </li></ul><br><p>  , ,      .      ,     ,    . ,   SPA,       ,    JS   â€”    .     .       //,           </p><br><h2 id="poleznye-ssylki">   </h2><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   </a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Webpagetest</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">  webpagetest</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   1</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">   2</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="> FCP</a> </li></ul><br><p>  PS.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya minta maaf untuk sejumlah besar Anglicisms (terutama untuk tata letak) dan untuk Longrid. </font><font style="vertical-align: inherit;">Tapi tanpa mereka, ini sangat sulit, dan semua bagian ini 1, 2, 3, saya sudah bosan dengan pesanan.</font></font></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id454444/">https://habr.com/ru/post/id454444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id454432/index.html">Menghibur Arkeologi: Panduan Gaya R Di Bawah Kaca Pembesar</a></li>
<li><a href="../id454434/index.html">PDA (Pocket Travel Computer): Circuitry GPS logger</a></li>
<li><a href="../id454436/index.html">Petty Petty Joy # 1: loguru</a></li>
<li><a href="../id454440/index.html">Petty Little Fun # 2: Starlette</a></li>
<li><a href="../id454442/index.html">Cara memilih jaringan proxy untuk bisnis Anda: 3 tips praktis</a></li>
<li><a href="../id454446/index.html">Apa yang baru di C # 8?</a></li>
<li><a href="../id454450/index.html">Bagaimana Edison menemukan nirkabel dan tidak mengerti apa-apa</a></li>
<li><a href="../id454452/index.html">Kami menampilkan konten pada gambar yang dikenali berdasarkan aturan tertentu</a></li>
<li><a href="../id454456/index.html">Pelatihan Cisco 200-125 CCNA v3.0. Hari 7. FAQ</a></li>
<li><a href="../id454458/index.html">Pengujian metamorf: mengapa hampir tidak ada yang tahu tentang teknik yang menjanjikan ini</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>