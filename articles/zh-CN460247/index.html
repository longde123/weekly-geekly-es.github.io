<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ™ğŸ» â¿ ğŸ¡ ELFsçš„é£Ÿè°± ğŸ§•ğŸ¿ ğŸ¤·ğŸ½ â³</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¿„è¯­ä¸­ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨ELFæ–‡ä»¶ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶å’Œå¯é“¾æ¥æ ¼å¼-Linuxå’Œè®¸å¤šUnixç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸»è¦æ ¼å¼ï¼‰çš„ä¿¡æ¯ä¸è¶³ã€‚ æˆ‘ä»¬å¹¶ä¸å£°ç§°å®Œå…¨æ¶µç›–ä¸ç²¾çµåˆä½œçš„æ‰€æœ‰å¯èƒ½æƒ…å†µï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¿™äº›ä¿¡æ¯ä»¥å‚è€ƒä¹¦å’Œç¨‹åºå‘˜å’Œé€†å‘å·¥ç¨‹å¸ˆçš„é£Ÿè°±é›†çš„å½¢å¼æœ‰ç”¨ã€‚ 


 å¯ä»¥ç†è§£ï¼ŒåŸºæœ¬çš„è¯»è€…éƒ½å¯¹ELFæ ¼å¼å¾ˆç†Ÿæ‚‰ï¼ˆå¦åˆ™ï¼Œæˆ‘ä»¬æ¨...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ELFsçš„é£Ÿè°±</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/inforion/blog/460247/"><p><img src="https://habrastorage.org/webt/xk/e_/v6/xke_v6gzyavn2y7zh5skzlm3op0.jpeg" alt="å›¾ç‰‡"></p><br><p> åœ¨ä¿„è¯­ä¸­ï¼Œå…³äºå¦‚ä½•ä½¿ç”¨ELFæ–‡ä»¶ï¼ˆå¯æ‰§è¡Œæ–‡ä»¶å’Œå¯é“¾æ¥æ ¼å¼-Linuxå’Œè®¸å¤šUnixç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä¸»è¦æ ¼å¼ï¼‰çš„ä¿¡æ¯ä¸è¶³ã€‚ æˆ‘ä»¬å¹¶ä¸å£°ç§°å®Œå…¨æ¶µç›–ä¸ç²¾çµåˆä½œçš„æ‰€æœ‰å¯èƒ½æƒ…å†µï¼Œä½†æˆ‘ä»¬å¸Œæœ›è¿™äº›ä¿¡æ¯ä»¥å‚è€ƒä¹¦å’Œç¨‹åºå‘˜å’Œé€†å‘å·¥ç¨‹å¸ˆçš„é£Ÿè°±é›†çš„å½¢å¼æœ‰ç”¨ã€‚ </p><br><p> å¯ä»¥ç†è§£ï¼ŒåŸºæœ¬çš„è¯»è€…éƒ½å¯¹ELFæ ¼å¼å¾ˆç†Ÿæ‚‰ï¼ˆå¦åˆ™ï¼Œæˆ‘ä»¬æ¨èç³»åˆ—æ–‡ç« <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Executable and Linkable Format 101</a> ï¼‰ã€‚ </p><br><p> å‰Šå‡éƒ¨åˆ†å°†åˆ—å‡ºå·¥ä½œå·¥å…·ï¼Œæè¿°çš„è¯»å–å…ƒä¿¡æ¯ï¼Œä¿®æ”¹ï¼ŒéªŒè¯å’Œ <del> ç¹æ®– </del> åˆ›å»ºç²¾çµï¼Œä»¥åŠä¸æœ‰ç”¨ææ–™çš„é“¾æ¥ã€‚ </p><a name="habracut"></a><br><blockquote>  â€œæˆ‘ä¹Ÿæ˜¯ä¸€ä¸ªå°ç²¾çµâ€¦â€¦çº¢è‰²çš„è“è‰²â€¦â€¦ç²¾çµéå¸¸æœ‰è€å¿ƒâ€¦â€¦è“è‰²çš„çº¢è‰²â€¦â€¦æˆ‘ä»¬æ˜¯ç²¾çµï¼..çº¢è‰²çš„è“è‰²â€¦â€¦åªæœ‰é­”æœ¯å¸¦æ¥çš„éº»çƒ¦â€¦â€¦ <br>  ï¼ˆcï¼‰æœ¬å’Œéœåˆ©å°ç‹å›½ </blockquote><br><h1 id="instrumenty"> å·¥å…· </h1><br><p> åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¤ºä¾‹å¯ä»¥åœ¨Linuxå’ŒWindowsä¸Šè¿è¡Œã€‚ </p><br><p> åœ¨é£Ÿè°±ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å·¥å…·ï¼š </p><br><ul><li>  binutilsé›†ä¸­çš„å®ç”¨ç¨‹åºï¼ˆobjcopyï¼Œobjdumpï¼Œreadelfï¼Œstripï¼‰ï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é›·è¾¾2æ¡†æ¶</a> ; </li><li> æ”¯æŒæ–‡ä»¶æ¨¡æ¿çš„åå…­è¿›åˆ¶ç¼–è¾‘å™¨ï¼ˆç¤ºä¾‹æ˜¾ç¤º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">010Editor</a> ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä¾‹å¦‚free <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Veles</a> ï¼‰ï¼› </li><li>  Pythonå’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LIEF</a>åº“ï¼› </li><li> å…¶ä»–å®ç”¨ç¨‹åºï¼ˆé“¾æ¥åœ¨é…æ–¹ä¸­ï¼‰ã€‚ </li></ul><br><h1 id="testovye-elfy"> æµ‹è¯•ç²¾çµ </h1><br><p> ä½œä¸ºâ€œå®éªŒâ€ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨nutcake <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">çš„PieIsMyFavä»»åŠ¡ä¸­</a>å…³äºcrackmes.oneçš„<em>ç®€å•</em> ELFæ–‡ä»¶ï¼Œä½†æ˜¯ä»»ä½•â€œ elvenâ€å®¶æ—çš„ä»£è¡¨éƒ½å¯ä»¥ä½¿ç”¨ã€‚ å¦‚æœæœªåœ¨å…¬å…±é¢†åŸŸä¸­æ‰¾åˆ°å…·æœ‰æ‰€éœ€ç‰¹å¾çš„å®Œæˆæ–‡ä»¶ï¼Œåˆ™å°†æä¾›åˆ›å»ºæ­¤ç±»elfçš„æ–¹æ³•ã€‚ </p><br><p> ä¹Ÿå¯ä»¥åœ¨é“¾æ¥ä¸Šæ‰¾åˆ°å…è´¹ç²¾çµï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸åŒå¹³å°çš„ç²¾çµçš„ä¾‹å­</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é›·è¾¾2çš„æµ‹è¯•ç²¾çµ</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Githubä¸Šçš„ElfHacksé¡¹ç›®</a> -ç²¾é€‰å…·æœ‰ä¸åŒè®¾ç½®çš„å°ç²¾çµï¼› </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€‚ç”¨äºUnix / Linuxçš„Crackme-</a>ä½†è¯·è®°ä½ï¼Œæ­¤å¤„å¯èƒ½ä¼šé‡åˆ°æ£˜æ‰‹çš„ç¤ºä¾‹ã€‚ </li></ul><br><h1 id="chtenie-poluchenie-informacii"> é˜…è¯»ï¼Œè·å–ä¿¡æ¯ </h1><br><h2 id="tip-fayla-zagolovok-sekcii"> æ–‡ä»¶ç±»å‹ï¼Œæ ‡é¢˜ï¼Œéƒ¨åˆ† </h2><br><p> æ ¹æ®ä»»åŠ¡ï¼Œå¯èƒ½ä¼šæ¶‰åŠä»¥ä¸‹å†…å®¹ï¼š </p><br><ul><li> æ–‡ä»¶ç±»å‹ï¼ˆDYN-åº“ï¼ŒEXEC-å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒRELOC-å¯é“¾æ¥ï¼‰ï¼› </li><li> ç›®æ ‡ä½“ç³»ç»“æ„ï¼ˆE_MACHINE-x86_64ï¼Œx86ï¼ŒARMç­‰ï¼‰ï¼› </li><li> åº”ç”¨ç¨‹åºå…¥å£ç‚¹ï¼ˆEntry Pointï¼‰ï¼› </li><li> éƒ¨åˆ†ä¿¡æ¯ã€‚ </li></ul><br><h3 id="010editor">  010ç¼–è¾‘ </h3><br><p> HEXç¼–è¾‘å™¨010Editoræä¾›äº†æ¨¡æ¿ç³»ç»Ÿã€‚ å¯¹äºELFæ–‡ä»¶ï¼Œè¯¥æ¨¡æ¿ç§°ä¸º<em>ELF.bt</em> ï¼Œè¿™å¾ˆå¥‡æ€ªï¼Œå®ƒä½äºâ€œ <em>å¯æ‰§è¡Œæ–‡ä»¶â€</em>ç±»åˆ«ä¸­ï¼ˆèœå•æ¨¡æ¿-â€œå¯æ‰§è¡Œæ–‡ä»¶â€ï¼‰ã€‚ <br> ä¾‹å¦‚ï¼Œæ„Ÿå…´è¶£çš„å¯èƒ½æ˜¯å¯æ‰§è¡Œæ–‡ä»¶çš„å…¥å£ç‚¹ï¼ˆå…¥å£ç‚¹ï¼‰ï¼ˆè®°å½•åœ¨æ–‡ä»¶å¤´ä¸­ï¼‰ã€‚ </p><br><p><img src="https://habrastorage.org/webt/uz/f4/i6/uzf4i6yhfy9epat61pd4uolvegw.png" alt="å›¾ç‰‡"></p><br><h3 id="readelf">  Readelf </h3><br><p>  readelfå®ç”¨ç¨‹åºå¯ä»¥è¢«è§†ä¸ºè·å–æœ‰å…³ELFæ–‡ä»¶ä¿¡æ¯çš„äº‹å®ä¸Šçš„æ ‡å‡†ã€‚ </p><br><ul><li> è¯»å–æ–‡ä»¶å¤´ï¼š <br><pre><code class="bash hljs">$ readelf -h simple</code> </pre> </li></ul><br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><pre> <code class="markdown hljs">ELF Header: Magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 Class: ELF64 Data: 2's complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ABI Version: 0 Type: DYN (Shared object file) Machine: Advanced Micro Devices X86-64 Version: 0x1 Entry point address: 0x1070 Start of program headers: 64 (bytes into file) Start of section headers: 14800 (bytes into file) Flags: 0x0 Size of this header: 64 (bytes) Size of program headers: 56 (bytes) Number of program headers: 11 Size of section headers: 64 (bytes) Number of section headers: 30 Section header string table index: 29</code> </pre> </div></div><br><ul><li> é˜…è¯»æœ‰å…³æ®µå’ŒèŠ‚çš„ä¿¡æ¯ï¼š <br><pre> <code class="bash hljs">$ readelf -l -W simple</code> </pre> </li></ul><br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><p> ä¸ºäº†æé«˜å¯è¯»æ€§ï¼Œåœ°å€è¢«è½¬æ¢ä¸º32ä½æ ¼å¼ï¼š </p><br><pre> <code class="markdown hljs">Elf file type is DYN (Shared object file) Entry point 0x1070 There are 11 program headers, starting at offset 64 Program Headers: Type Offset VirtAddr PhysAddr FileSiz MemSiz Flg Align PHDR 0x000040 0x00000040 0x00000040 0x000268 0x000268 R 0x8 INTERP 0x0002a8 0x000002a8 0x000002a8 0x00001c 0x00001c R 0x1 [Requesting program interpreter: /lib64/ld-linux-x86-64.so.2] LOAD 0x000000 0x00000000 0x00000000 0x0005f8 0x0005f8 R 0x1000 LOAD 0x001000 0x00001000 0x00001000 0x00026d 0x00026d RE 0x1000 LOAD 0x002000 0x00002000 0x00002000 0x0001b8 0x0001b8 R 0x1000 LOAD 0x002de8 0x00003de8 0x00003de8 0x000258 0x000260 RW 0x1000 DYNAMIC 0x002df8 0x00003df8 0x00003df8 0x0001e0 0x0001e0 RW 0x8 NOTE 0x0002c4 0x000002c4 0x000002c4 0x000044 0x000044 R 0x4 GNU<span class="hljs-emphasis"><span class="hljs-emphasis">_EH_</span></span>FRAME 0x002070 0x00002070 0x00002070 0x00003c 0x00003c R 0x4 GNU<span class="hljs-emphasis"><span class="hljs-emphasis">_STACK 0x000000 0x00000000 0x00000000 0x000000 0x000000 RW 0x10 GNU_</span></span>RELRO 0x002de8 0x00003de8 0x00003de8 0x000218 0x000218 R 0x1 Section to Segment mapping: Segment Sections... 00 01 .interp 02 .interp .note.ABI-tag .note.gnu.build-id .gnu.hash .dynsym .dynstr .gnu.version .gnu.version<span class="hljs-emphasis"><span class="hljs-emphasis">_r .rela.dyn .rela.plt 03 .init .plt .plt.got .text .fini 04 .rodata .eh_</span></span>frame<span class="hljs-emphasis"><span class="hljs-emphasis">_hdr .eh_</span></span>frame 05 .init<span class="hljs-emphasis"><span class="hljs-emphasis">_array .fini_</span></span>array .dynamic .got .got.plt .data .bss 06 .dynamic 07 .note.ABI-tag .note.gnu.build-id 08 .eh<span class="hljs-emphasis"><span class="hljs-emphasis">_frame_</span></span>hdr 09 10 .init<span class="hljs-emphasis"><span class="hljs-emphasis">_array .fini_</span></span>array .dynamic .got</code> </pre> </div></div><br><ul><li> é˜…è¯»éƒ¨åˆ†ä¿¡æ¯ï¼š <br><pre> <code class="bash hljs">$ readelf -S -W simple</code> </pre> </li></ul><br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><p> ä¸ºäº†æé«˜å¯è¯»æ€§ï¼Œåœ°å€è¢«è½¬æ¢ä¸º32ä½æ ¼å¼ï¼š </p><br><pre> <code class="markdown hljs">There are 30 section headers, starting at offset 0x39d0: Section Headers: [Nr] Name Type Address Off Size ES Flg Lk Inf Al [ 0] NULL 00000000 000000 000000 00 0 0 0 [ 1] .interp PROGBITS 000002a8 0002a8 00001c 00 A 0 0 1 [ 2] .note.ABI-tag NOTE 000002c4 0002c4 000020 00 A 0 0 4 [ 3] .note.gnu.build-id NOTE 000002e4 0002e4 000024 00 A 0 0 4 [ 4] .gnu.hash GNU<span class="hljs-emphasis"><span class="hljs-emphasis">_HASH 00000308 000308 000024 00 A 5 0 8 [ 5] .dynsym DYNSYM 00000330 000330 0000d8 18 A 6 1 8 [ 6] .dynstr STRTAB 00000408 000408 0000a2 00 A 0 0 1 [ 7] .gnu.version VERSYM 000004aa 0004aa 000012 02 A 5 0 2 [ 8] .gnu.version_</span></span>r VERNEED 000004c0 0004c0 000030 00 A 6 1 8 [ 9] .rela.dyn RELA 000004f0 0004f0 0000c0 18 A 5 0 8 [10] .rela.plt RELA 000005b0 0005b0 000048 18 AI 5 23 8 [11] .init PROGBITS 00001000 001000 000017 00 AX 0 0 4 [12] .plt PROGBITS 00001020 001020 000040 10 AX 0 0 16 [13] .plt.got PROGBITS 00001060 001060 000008 08 AX 0 0 8 [14] .text PROGBITS 00001070 001070 0001f2 00 AX 0 0 16 [15] .fini PROGBITS 00001264 001264 000009 00 AX 0 0 4 [16] .rodata PROGBITS 00002000 002000 000070 00 A 0 0 8 [17] .eh<span class="hljs-emphasis"><span class="hljs-emphasis">_frame_</span></span>hdr PROGBITS 00002070 002070 00003c 00 A 0 0 4 [18] .eh<span class="hljs-emphasis"><span class="hljs-emphasis">_frame PROGBITS 000020b0 0020b0 000108 00 A 0 0 8 [19] .init_</span></span>array INIT<span class="hljs-emphasis"><span class="hljs-emphasis">_ARRAY 00003de8 002de8 000008 08 WA 0 0 8 [20] .fini_</span></span>array FINI_ARRAY 00003df0 002df0 000008 08 WA 0 0 8 [21] .dynamic DYNAMIC 00003df8 002df8 0001e0 10 WA 6 0 8 [22] .got PROGBITS 00003fd8 002fd8 000028 08 WA 0 0 8 [23] .got.plt PROGBITS 00004000 003000 000030 08 WA 0 0 8 [24] .data PROGBITS 00004030 003030 000010 00 WA 0 0 8 [25] .bss NOBITS 00004040 003040 000008 00 WA 0 0 1 [26] .comment PROGBITS 00000000 003040 00001c 01 MS 0 0 1 [27] .symtab SYMTAB 00000000 003060 000630 18 28 44 8 [28] .strtab STRTAB 00000000 003690 000232 00 0 0 1 [29] .shstrtab STRTAB 00000000 0038c2 000107 00 0 0 1 Key to Flags: W (write), A (alloc), X (execute), M (merge), S (strings), l (large) I (info), L (link order), G (group), T (TLS), E (exclude), x (unknown) O (extra OS processing required) o (OS specific), p (processor specific)</code> </pre> </div></div><br><ul><li> è¯»å–ç¬¦å·ä¿¡æ¯ï¼š <br><pre> <code class="bash hljs">$ readelf -s -W simple</code> </pre> </li></ul><br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><p> ä¸ºäº†ç¼©çŸ­å¯è¯»æ€§ï¼Œè¾“å‡ºè¢«ç¼©çŸ­ï¼š </p><br><pre> <code class="markdown hljs">Symbol table '.dynsym' contains 9 entries: Num: Value Size Type Bind Vis Ndx Name 0: 00000000 0 NOTYPE LOCAL DEFAULT UND 1: 00000000 0 NOTYPE WEAK DEFAULT UND <span class="hljs-emphasis"><span class="hljs-emphasis">_ITM_</span></span>deregisterTMCloneTable 2: 00000000 0 FUNC GLOBAL DEFAULT UND puts@GLIBC<span class="hljs-emphasis"><span class="hljs-emphasis">_2.2.5 (2) 3: 00000000 0 FUNC GLOBAL DEFAULT UND printf@GLIBC_</span></span>2.2.5 (2) 4: 00000000 0 FUNC GLOBAL DEFAULT UND <span class="hljs-strong"><span class="hljs-strong">__libc_start_main@GLIBC_2.2.5 (2) 5: 00000000 0 NOTYPE WEAK DEFAULT UND __</span></span>gmon<span class="hljs-emphasis"><span class="hljs-emphasis">_start_</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_ 6: 00000000 0 FUNC GLOBAL DEFAULT UND _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_isoc99_</span></span>scanf@GLIBC<span class="hljs-emphasis"><span class="hljs-emphasis">_2.7 (3) 7: 00000000 0 NOTYPE WEAK DEFAULT UND _</span></span>ITM<span class="hljs-emphasis"><span class="hljs-emphasis">_registerTMCloneTable 8: 00000000 0 FUNC WEAK DEFAULT UND _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_cxa_</span></span>finalize@GLIBC<span class="hljs-emphasis"><span class="hljs-emphasis">_2.2.5 (2) Symbol table '.symtab' contains 66 entries: Num: Value Size Type Bind Vis Ndx Name 0: 00000000 0 NOTYPE LOCAL DEFAULT UND 1: 000002a8 0 SECTION LOCAL DEFAULT 1 2: 000002c4 0 SECTION LOCAL DEFAULT 2 3: 000002e4 0 SECTION LOCAL DEFAULT 3 4: 00000308 0 SECTION LOCAL DEFAULT 4 5: 00000330 0 SECTION LOCAL DEFAULT 5 6: 00000408 0 SECTION LOCAL DEFAULT 6 7: 000004aa 0 SECTION LOCAL DEFAULT 7 .... 26: 00000000 0 SECTION LOCAL DEFAULT 26 27: 00000000 0 FILE LOCAL DEFAULT ABS crtstuff.c 28: 000010a0 0 FUNC LOCAL DEFAULT 14 deregister_</span></span>tm<span class="hljs-emphasis"><span class="hljs-emphasis">_clones 29: 000010d0 0 FUNC LOCAL DEFAULT 14 register_</span></span>tm<span class="hljs-emphasis"><span class="hljs-emphasis">_clones 30: 00001110 0 FUNC LOCAL DEFAULT 14 _</span></span><span class="hljs-emphasis"><span class="hljs-emphasis">_do_</span></span>global<span class="hljs-emphasis"><span class="hljs-emphasis">_dtors_</span></span>aux 31: 00004040 1 OBJECT LOCAL DEFAULT 25 completed.7389 ....</code> </pre> </div></div><br><p> éœ€è¦<code>-W</code>é€‰é¡¹ä»¥å¢åŠ æ§åˆ¶å°è¾“å‡ºçš„å®½åº¦ï¼ˆé»˜è®¤ä¸º80ä¸ªå­—ç¬¦ï¼‰ã€‚ </p><br><h3 id="lief"> åˆ—å¤« </h3><br><p> æ‚¨å¯ä»¥ä½¿ç”¨Pythonä»£ç å’ŒLIEFåº“ï¼ˆä¸ä»…ä¸ºPythonæä¾›APIï¼‰è¯»å–æ ‡é¢˜å’ŒèŠ‚ä¿¡æ¯ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple.elf"</span></span>) header = binary.header print(<span class="hljs-string"><span class="hljs-string">"Entry point: %08x"</span></span> % header.entrypoint) print(<span class="hljs-string"><span class="hljs-string">"Architecture: "</span></span>, header.machine_type) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> section <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> binary.sections: print(<span class="hljs-string"><span class="hljs-string">"Section %s - size: %s bytes"</span></span> % (section.name, section.size)</code> </pre> <br><h2 id="informaciya-o-kompilyatore"> ç¼–è¯‘å™¨ä¿¡æ¯ </h2><br><p> æœ‰å…³ç¼–è¯‘å™¨å’Œæ„å»ºçš„ä¿¡æ¯ï¼Œè¯·å‚è§<code>.comment</code>å’Œ<code>.note</code> ã€‚ </p><br><h3 id="objdump">  objdump </h3><br><pre> <code class="bash hljs">$ objdump -s --section .comment simple</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><pre> <code class="markdown hljs">simple: file format elf64-x86-64 Contents of section .comment: 0000 4743433a 20284465 6269616e 20382e32 GCC: (Debian 8.2 0010 2e302d39 2920382e 322e3000 .0-9) 8.2.0.</code> </pre> </div></div><br><h3 id="readelf-1">  Readelf </h3><br><pre> <code class="bash hljs">$ readelf -p .comment simple</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><pre> <code class="markdown hljs">String dump of section '.comment': [ 0] GCC: (Debian 8.2.0-9) 8.2.0</code> </pre> </div></div><br><pre> <code class="bash hljs">$ readelf -n simple</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><pre> <code class="markdown hljs">Displaying notes found at file offset 0x000002c4 with length 0x00000020: Owner Data size Description GNU 0x00000010 NT<span class="hljs-emphasis"><span class="hljs-emphasis">_GNU_</span></span>ABI<span class="hljs-emphasis"><span class="hljs-emphasis">_TAG (ABI version tag) OS: Linux, ABI: 3.2.0 Displaying notes found at file offset 0x000002e4 with length 0x00000024: Owner Data size Description GNU 0x00000014 NT_</span></span>GNU<span class="hljs-emphasis"><span class="hljs-emphasis">_BUILD_</span></span>ID (unique build ID bitstring) Build ID: dae0509e4edb79719a65af37962b74e4cf2a8c2e</code> </pre> </div></div><br><h3 id="lief-1"> åˆ—å¤« </h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple"</span></span>) comment = binary.get_section(<span class="hljs-string"><span class="hljs-string">".comment"</span></span>) print(<span class="hljs-string"><span class="hljs-string">"Comment: "</span></span>, bytes(comment.content))</code> </pre><br><h2 id="ya-vychislyu-tebya-po-rpath"> æˆ‘å°†é€šè¿‡...è®¡ç®—æ‚¨ </h2><br><p> ç²¾çµå¯ä»¥ä¿å­˜æŸ¥æ‰¾åŠ¨æ€è¿æ¥çš„åº“çš„è·¯å¾„ã€‚ ä¸ºäº†åœ¨å¯åŠ¨åº”ç”¨ç¨‹åºä¹‹å‰ä¸è®¾ç½®ç³»ç»Ÿå˜é‡<code>LD_LIBRARY_PATH</code> ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°å°†æ­¤è·¯å¾„â€œåµŒå…¥â€åˆ°ELFæ–‡ä»¶ä¸­ã€‚ </p><br><p> ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨<code>.dynamic</code>èŠ‚ä¸­ç±»å‹ä¸º<code>DT_RPATH</code>æˆ–<code>DT_RUNPATH</code> ï¼ˆè¯·å‚è§æ–‡æ¡£ä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œè¿è¡Œæ—¶é“¾æ¥ç¨‹åºæœç´¢</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç›®å½•â€ä¸€ç« </a> ï¼‰ã€‚ </p><br><p>  <strong>å°å¿ƒï¼Œå¹´è½»çš„å¼€å‘äººå‘˜ï¼Œè¯·ä¸è¦â€œæ²‰ç¡â€æ‚¨çš„é¡¹ç›®ç›®å½•ï¼</strong> </p><br><h3 id="kak-poyavlyaetsya-rpath">  RPATHå¦‚ä½•å‡ºç°ï¼Ÿ </h3><br><p> åœ¨elfä¸­å‡ºç°RPATHè®°å½•çš„ä¸»è¦åŸå› æ˜¯ç”¨äºæœç´¢åŠ¨æ€åº“çš„é“¾æ¥å™¨<code>-rpath</code>é€‰é¡¹ã€‚ åƒè¿™æ ·ï¼š </p><br><pre> <code class="bash hljs">$ gcc -L./lib -Wall -Wl,-rpath=/run/media/pablo/disk1/projects/cheat_sheets/ELF/lib/ -o test_rpath.elf bubble_main.c -lbubble</code> </pre> <br><p> è¯¥å‘½ä»¤å°†åœ¨<code>.dynamic</code>èŠ‚ä¸­åˆ›å»ºä¸€ä¸ªRPATHè®°å½•ï¼Œå…¶å€¼æ˜¯<code>/run/media/pablo/disk1/projects/cheat_sheets/ELF/lib/</code> ã€‚ </p><br><h3 id="readelf-2">  Readelf </h3><br><p> æ‚¨å¯ä»¥ä»<code>.dynamic</code>éƒ¨åˆ†ï¼ˆå…¶ä¸­åŒ…å«RPATHï¼‰æŸ¥çœ‹å…ƒç´ ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="bash hljs">$ readelf -d test_rpath.elf</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">å›¢é˜Ÿæˆç»©</b> <div class="spoiler_text"><p> ä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œè¯¥å‘½ä»¤çš„ç»“æœè¢«å‡å°‘ï¼š </p><br><pre> <code class="markdown hljs">Dynamic section at offset 0x2dd8 contains 28 entries: Tag Type Name/Value 0x0000000000000001 (NEEDED) Shared library: [libbubble.so] 0x0000000000000001 (NEEDED) Shared library: [libc.so.6] 0x000000000000000f (RPATH) Library rpath: [/run/media/pablo/disk1/projects/cheat_sheets/ELF/lib/] 0x000000000000000c (INIT) 0x1000 0x000000000000000d (FINI) 0x11c8 ....</code> </pre> </div></div><br><h3 id="lief-2"> åˆ—å¤« </h3><br><p> ä½¿ç”¨LIEFåº“ï¼Œæ‚¨è¿˜å¯ä»¥è¯»å–elfä¸­çš„RPATHè®°å½•ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> lief.ELF <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DYNAMIC_TAGS elf = lief.parse(<span class="hljs-string"><span class="hljs-string">"test_rpath.elf"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> elf.has(DYNAMIC_TAGS.RPATH): rpath = next(filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x.tag == DYNAMIC_TAGS.RPATH, elf.dynamic_entries)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> path <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rpath.paths: print(path) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">"No RPATH in ELF"</span></span>)</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†è§£æœ‰å…³.dynamicéƒ¨åˆ†çš„ä¿¡æ¯</a> </p><br><h2 id="proverka-elfa-na-bezopasnost"> æ£€æŸ¥ç²¾çµçš„å®‰å…¨æ€§ </h2><br><p> è‡ª2011å¹´ä»¥æ¥ï¼Œç ”ç©¶äººå‘˜Tobias Kleinï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">A Bug Hunter's Diaryçš„ä½œè€…</a> ï¼‰çš„å®‰å…¨æ£€æŸ¥è„šæœ¬<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">checksec.sh</a>å°šæœªæ›´æ–°ã€‚ è¯¥ELFæ–‡ä»¶è„šæœ¬æ£€æŸ¥é€‰é¡¹RelROï¼ˆåªè¯»é‡å®šä½ï¼‰ï¼ŒNXï¼ˆéå¯æ‰§è¡Œå †æ ˆï¼‰ï¼Œå †æ ˆCanariesï¼ŒPIEï¼ˆä½ç½®ç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶ï¼‰çš„å¯ç”¨æ€§ï¼Œå¹¶ä½¿ç”¨readelfå®ç”¨ç¨‹åºè¿›è¡Œå·¥ä½œã€‚ </p><br><h3 id="lief-3"> åˆ—å¤« </h3><br><p> æ‚¨å¯ä»¥åœ¨ <del> è†å…³èŠ‚ </del>  Pythonå’ŒLIEFï¼ˆæ¯”ç¥–å…ˆçŸ­ä¸€äº›ï¼Œå¹¶å¸¦æœ‰å¯¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ†å¼€ä»£ç </a>é€‰é¡¹çš„é™„åŠ éªŒè¯ï¼‰ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> lief.ELF <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DYNAMIC_TAGS, SEGMENT_TYPES <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filecheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function">:</span></span> binary = lief.parse(filename) <span class="hljs-comment"><span class="hljs-comment"># check RELRO if binary.has(SEGMENT_TYPES.GNU_RELRO): print("+ Full RELRO") if binary.has(DYNAMIC_TAGS.BIND_NOW) else print("~ Partial RELRO") else: print("- No RELRO") # check for stack canary support print("+ Canary found") if binary.has_symbol("__stack_chk_fail") else print("- No canary found") # check for NX support (check X-flag for GNU_STACK-segment) print("+ NX enabled") if binary.has_nx else print("- NX disabled") # check for PIE support print("+ PIE enabled") if binary.is_pie else print("- No PIE") # check for rpath / run path print("+ RPATH") if binary.has(DYNAMIC_TAGS.RPATH) else print("- No RPATH") print("+ RUNPATH")if binary.has(DYNAMIC_TAGS.RUNPATH) else print("- No RUNPATH") # check separate-code option if set(binary.get_section('.text').segments) == set(binary.get_section('.rodata').segments): print("- Not Separated Code Sections") else: print("+ Separated Code Sections") filecheck('test_rpath.elf')</span></span></code> </pre> <br><h3 id="radare2"> æ‹‰è¾¾é›·2 </h3><br><p> æ„Ÿè°¢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">dukebarman</a>é¢å¤–ä½¿ç”¨Radare2æ˜¾ç¤ºç±»ä¼¼äº<em>checksecçš„</em>ä¿¡æ¯ï¼š </p><br><pre> <code class="bash hljs">&gt; r2 -ci~pic,canary,nx,crypto,stripped,static,relocs test_stack_proteck</code> </pre> <br><h2 id="syroy-kod-iz-elfa-binary-from-elf">  Elfçš„åŸå§‹ä»£ç ï¼ˆELFçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ </h2><br><p> åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ELFç»“æ„å½¢å¼çš„â€œç²¾çµæœè£…â€ï¼Œè€Œä»…éœ€è¦â€œè£¸â€å¯æ‰§è¡Œåº”ç”¨ç¨‹åºä»£ç ã€‚ </p><br><h3 id="objcopy">  objcopy </h3><br><p> ç¼–å†™å›ºä»¶çš„äººå‘˜å¯èƒ½ç†Ÿæ‚‰ä½¿ç”¨<em>objcopy</em> ï¼š </p><br><pre> <code class="bash hljs">$ objcopy -O binary -S -g simple.elf simple.bin</code> </pre> <br><ul><li>  <code>-S</code>åˆ é™¤å­—ç¬¦ä¿¡æ¯ï¼› </li><li>  <code>-g</code>åˆ é™¤è°ƒè¯•ä¿¡æ¯ã€‚ </li></ul><br><h3 id="lief-4"> åˆ—å¤« </h3><br><p> æ²¡é­”æœ¯ åªéœ€è·å–å·²åŠ è½½éƒ¨åˆ†çš„å†…å®¹å¹¶æ ¹æ®å®ƒä»¬åˆ›å»ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> lief.ELF <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SECTION_FLAGS, SECTION_TYPES binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"test"</span></span>) end_addr = <span class="hljs-number"><span class="hljs-number">0</span></span> data = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> section <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x.has(SECTION_FLAGS.ALLOC) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> x.type != SECTION_TYPES.NOBITS, binary.sections): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> &lt; end_addr &lt; section.virtual_address: align_bytes = <span class="hljs-string"><span class="hljs-string">b'\x00'</span></span> * (section.virtual_address - end_addr) data.append(align_bytes) data.append(bytes(section.content)) end_addr = section.virtual_address + section.size <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(<span class="hljs-string"><span class="hljs-string">'test.lief.bin'</span></span>, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> d_bytes <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> data: f.write(d_bytes)</code> </pre> <br><h2 id="mangled---demangled-imena-funkciy"> æ‹¼å‡‘-æ‹†è§£å‡½æ•°åç§° </h2><br><p> åœ¨ä½¿ç”¨C ++ä»£ç åˆ›å»ºçš„ELFä¸­ï¼Œå¯¹å‡½æ•°åç§°è¿›è¡Œä¿®é¥°ï¼ˆä¿®é¥°ï¼‰ä»¥ç®€åŒ–å¯¹ç›¸åº”ç±»å‡½æ•°çš„æœç´¢ã€‚ ä½†æ˜¯ï¼Œåœ¨åˆ†æä¸­è¯»å–æ­¤ç±»åç§°ä¸æ˜¯å¾ˆæ–¹ä¾¿ã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æµ‹è¯•ç²¾çµ</a> </p><br><h3 id="nm"> çº³ç±³ </h3><br><p> è¦ä»¥æ˜“äºç†è§£çš„å½¢å¼è¡¨ç¤ºåç§°ï¼Œå¯ä»¥ä½¿ç”¨binutilsé›†ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">nm</a>å®ç”¨ç¨‹åºï¼š </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#        $ nm -D demangle-test-cpp ... U _Unwind_Resume U _ZdlPv U _Znwm U _ZSt17__throw_bad_allocv U _ZSt20__throw_length_errorPKc #        $ nm -D --demangle demangle-test-cpp ... U _Unwind_Resume U operator delete(void*) U operator new(unsigned long) U std::__throw_bad_alloc() U std::__throw_length_error(char const*)</span></span></code> </pre> <br><h3 id="lief-5"> åˆ—å¤« </h3><br><p> ä½¿ç”¨LIEFåº“ä»¥åˆ†è§£å½¢å¼æ˜¾ç¤ºç¬¦å·åç§°ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"demangle-test-cpp"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> symb <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> binary.symbols: print(symb.name, symb.demangled_name)</code> </pre> <br><h1 id="sborka-zapis-modifikaciya-elfa"> ç²¾çµçš„ç»„è£…ï¼Œè®°å½•ï¼Œä¿®æ”¹ </h1><br><h2 id="elf-bez-metainformacii"> æ²¡æœ‰å…ƒä¿¡æ¯çš„ç²¾çµ </h2><br><p> åœ¨å°†åº”ç”¨ç¨‹åºè°ƒè¯•å¹¶å‘å¸ƒåˆ°é‡å¤–ç¯å¢ƒä¹‹åï¼Œåˆ é™¤å…ƒä¿¡æ¯æ˜¯æœ‰æ„ä¹‰çš„ï¼š </p><br><ul><li> è°ƒè¯•éƒ¨åˆ†-åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ— ç”¨ï¼› </li><li> å˜é‡å’Œå‡½æ•°çš„åç§°-ç»å¯¹ä¸ä¼šå½±å“æœ€ç»ˆç”¨æˆ·ï¼ˆä½¿åå‘æ“ä½œç¨å¾®å¤æ‚åŒ–ï¼‰ï¼› </li><li> èŠ‚è¡¨-ç»å¯¹ä¸éœ€è¦è¿è¡Œè¯¥åº”ç”¨ç¨‹åºï¼ˆç¼ºå°‘å®ƒä¼šä½¿åå‘æ“ä½œç¨å¾®å¤æ‚åŒ–ï¼‰ã€‚ </li></ul><br><h2 id="udalenie-simvolnoy-informacii"> åˆ é™¤è§’è‰²ä¿¡æ¯ </h2><br><p> å­—ç¬¦ä¿¡æ¯æ˜¯å¯¹è±¡å’ŒåŠŸèƒ½çš„åç§°ã€‚ æ²¡æœ‰å®ƒï¼Œåº”ç”¨ç¨‹åºçš„åå‘æ“ä½œå°†å˜å¾—æ›´åŠ å¤æ‚ã€‚ </p><br><h3 id="strip"> å‰¥ç¦» </h3><br><p> åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨binutilsé›†ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">strip</a>å®ç”¨ç¨‹åºã€‚ è¦åˆ é™¤æ‰€æœ‰å­—ç¬¦ä¿¡æ¯ï¼Œåªéœ€è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š </p><br><ul><li> å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶ï¼š <br><pre> <code class="bash hljs">$ strip -s simple</code> </pre> </li><li> å¯¹äºåŠ¨æ€åº“ï¼š <br><pre> <code class="bash hljs">$ strip --strip-unneeded libsimple.so</code> </pre> </li></ul><br><h3 id="sstrip"> å¸¦çŠ¶ </h3><br><p> è¦ä»”ç»†åˆ é™¤å­—ç¬¦ä¿¡æ¯ï¼ˆæ–‡ä»¶æœ«å°¾åŒ…æ‹¬ä¸å¿…è¦çš„é›¶å­—èŠ‚ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ELFkickerså¥—ä»¶ä¸­</a>çš„sstripå®ç”¨ç¨‹åºã€‚ è¦åˆ é™¤æ‰€æœ‰å­—ç¬¦ä¿¡æ¯ï¼Œåªéœ€è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š </p><br><pre> <code class="bash hljs">$ sstrip -z simple</code> </pre> <br><h3 id="lief-6"> åˆ—å¤« </h3><br><p> ä½¿ç”¨LIEFåº“ï¼Œæ‚¨è¿˜å¯ä»¥è¿›è¡Œå¿«é€Ÿå‰¥ç¦»ï¼ˆç¬¦å·è¡¨å·²åˆ é™¤<code>.symtab</code>èŠ‚ï¼‰ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple"</span></span>) binary.strip() binary.write(<span class="hljs-string"><span class="hljs-string">"simple.stripped"</span></span>)</code> </pre> <br><h2 id="udalenie-tablicy-sekciy"> åˆ é™¤åˆ†åŒºè¡¨ </h2><br><p> å¦‚ä¸Šæ‰€è¿°ï¼ŒèŠ‚è¡¨çš„å­˜åœ¨/ä¸å­˜åœ¨ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ“ä½œã€‚ ä½†æ˜¯åŒæ—¶ï¼Œå¦‚æœæ²¡æœ‰èŠ‚è¡¨ï¼Œåº”ç”¨ç¨‹åºçš„åå‘æ“ä½œå°†å˜å¾—æ›´åŠ å¤æ‚ã€‚ <br> æˆ‘ä»¬å°†ä½¿ç”¨Pythonä¸‹çš„LIEFåº“ä»¥åŠ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ é™¤èŠ‚è¡¨</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¤ºä¾‹</a> ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple"</span></span>) binary.header.numberof_sections = <span class="hljs-number"><span class="hljs-number">0</span></span> binary.header.section_header_offset = <span class="hljs-number"><span class="hljs-number">0</span></span> binary.write(<span class="hljs-string"><span class="hljs-string">"simple.modified"</span></span>)</code> </pre> <br><h2 id="izmenenie-i-udalenie-rpath"> ä¿®æ”¹å’Œåˆ é™¤RPATH </h2><br><h3 id="chrpath-patchelf">  chrpathï¼ŒPatchELF </h3><br><p> è¦åœ¨Linuxä¸‹æ›´æ”¹RPATHï¼Œå¯ä»¥ä½¿ç”¨<em>chrpath</em>å®ç”¨ç¨‹åºï¼ˆåœ¨å¤§å¤šæ•°å‘è¡Œç‰ˆä¸­éƒ½å¯ç”¨ï¼‰æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PatchELF</a> ã€‚ </p><br><ul><li><p> æ›´æ”¹RPATHï¼š </p><br><pre> <code class="bash hljs">$ chrpath -r /opt/my-libs/lib:/foo/lib test_rpath.elf</code> </pre> <br><p> æˆ– </p><br><pre> <code class="bash hljs">$ patchelf --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-rpath /opt/my-libs/lib:/foo/lib test_rpath.elf</code> </pre> <br></li><li><p> åˆ é™¤RPATHï¼š </p><br><pre> <code class="bash hljs">$ chrpath -d test_rpath.elf</code> </pre> <br><p> æˆ– </p><br><pre> <code class="bash hljs">$ patchelf --shrink-rpath test_rpath.elf</code> </pre> <br></li></ul><br><h3 id="lief-7"> åˆ—å¤« </h3><br><p>  LIEFåº“è¿˜å…è®¸æ‚¨ä¿®æ”¹å’Œåˆ é™¤RPATHè®°å½•ã€‚ </p><br><ul><li><p> æ›´æ”¹RPATHï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"test_rpath.elf"</span></span>) rpath = next(filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x.tag == lief.ELF.DYNAMIC_TAGS.RPATH, binary.dynamic_entries)) rpath.paths = [<span class="hljs-string"><span class="hljs-string">"/opt/my-lib/here"</span></span>] binary.write(<span class="hljs-string"><span class="hljs-string">"test_rpath.patched"</span></span>)</code> </pre> <br></li><li><p> åˆ é™¤RPATHï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"test_rpath.elf"</span></span>) binary.remove(lief.ELF.DYNAMIC_TAGS.RPATH) binary.write(<span class="hljs-string"><span class="hljs-string">"test_rpath.patched"</span></span>)</code> </pre> <br></li></ul><br><h2 id="obfuskaciya-simvolnoy-informacii"> è§’è‰²ä¿¡æ¯æ··æ·† </h2><br><p> è¦ä½¿åº”ç”¨ç¨‹åºå¤æ‚åŒ–ï¼Œå¯ä»¥ä¿å­˜ç¬¦å·ä¿¡æ¯ï¼Œä½†ä¼šä½¿å¯¹è±¡åç§°æ··ä¹±ã€‚ æˆ‘ä»¬ä½¿ç”¨<em>sevebçš„</em>æ¥è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">crackme01</a>çš„å°ç²¾çµ<em>crackme01_32bit</em>ä½œä¸ºæµ‹è¯•<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯¹è±¡</a> ã€‚ </p><br><p>  LIEFåº“ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¤ºä¾‹çš„</a>ç®€åŒ–ç‰ˆæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"crackme01_32bit"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, symb <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(binary.static_symbols): symb.name = <span class="hljs-string"><span class="hljs-string">"zzz_%d"</span></span> % i binary.write(<span class="hljs-string"><span class="hljs-string">"crackme01_32bit.obfuscated"</span></span>)</code> </pre> <br><p> ç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°ï¼š </p><br><pre> <code class="bash hljs">$ readelf -s crackme01_32bit.obfuscated ... Symbol table <span class="hljs-string"><span class="hljs-string">'.symtab'</span></span> contains 78 entries: Num: Value Size Type Bind Vis Ndx Name 0: 00000000 0 NOTYPE LOCAL DEFAULT UND zzz_0 1: 08048154 0 SECTION LOCAL DEFAULT 1 zzz_1 2: 08048168 0 SECTION LOCAL DEFAULT 2 zzz_2 3: 08048188 0 SECTION LOCAL DEFAULT 3 zzz_3 4: 080481ac 0 SECTION LOCAL DEFAULT 4 zzz_4 5: 080481d0 0 SECTION LOCAL DEFAULT 5 zzz_5 6: 080482b0 0 SECTION LOCAL DEFAULT 6 zzz_6 7: 0804835a 0 SECTION LOCAL DEFAULT 7 zzz_7 8: 08048378 0 SECTION LOCAL DEFAULT 8 zzz_8 9: 080483b8 0 SECTION LOCAL DEFAULT 9 zzz_9 10: 080483c8 0 SECTION LOCAL DEFAULT 10 zzz_10 ...</code> </pre> <br><h2 id="podmena-funkciy-cherez-pltgot"> é€šè¿‡PLT / GOTè¿›è¡ŒåŠŸèƒ½æ›¿æ¢ </h2><br><p> ä¹Ÿç§°ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ELF PLTæ„ŸæŸ“</a> ã€‚ </p><br><p> ä¸ºäº†ä¸è¿›è¡Œå¤åˆ¶ç²˜è´´ï¼Œåªéœ€åœ¨ä¸»é¢˜ä¸Šä¿ç•™é“¾æ¥ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…±äº«ELFåº“ä¸­çš„å‡½æ•°é‡å®šå‘</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç”¨LIEFæ„ŸæŸ“plt</a> </li></ul><br><h2 id="izmenit-tochku-vhoda"> æ›´æ”¹å…¥å£ç‚¹ </h2><br><p> åœ¨åˆ›å»ºè¡¥ä¸ç¨‹åºï¼Œå®‰è£…æŒ‚é’©å’Œå…¶ä»–åŠ¨æ€å·¥å…·æˆ–è°ƒç”¨éšè—åŠŸèƒ½æ—¶ï¼Œå®ƒå¾ˆæœ‰ç”¨ã€‚ ä½œä¸ºå®éªŒï¼Œæˆ‘ä»¬ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">sevebçš„crackme01</a>çš„å°ç²¾çµ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">crackme01_32bit</a> </p><br><h3 id="radare2-1"> é›·è¾¾2 </h3><br><p>  radare2ä»¥è®°å½•æ¨¡å¼ï¼ˆé€‰é¡¹<code>-w</code> ï¼‰å¯åŠ¨-å°†å¯¹åŸå§‹æ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼š </p><br><pre> <code class="bash hljs">$ ./crackme01_32bit Please enter the secret number: ^C $ r2 -w -nn crackme01_32bit [0x00000000]&gt; .pf.elf_header.entry=0x0804860D [0x00000000]&gt; q $ ./crackme01_32bit Nope.</code> </pre> <br><h3 id="lief-8"> åˆ—å¤« </h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"crackme01_32bit"</span></span>) header = binary.header header.entrypoint = <span class="hljs-number"><span class="hljs-number">0x0804860D</span></span> binary.write(<span class="hljs-string"><span class="hljs-string">"crackme01_32bit.patched"</span></span>)</code> </pre> <br><h2 id="patching-koda"> ä»£ç è¡¥ä¸ </h2><br><p> ä½œä¸ºä¸€ä¸ªç®€å•çš„æµ‹è¯•ï¼Œå°†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">novn91çš„crackmepalä¸crackä¸€èµ·ä½¿ç”¨</a> ã€‚ ä¸å¸¦å‚æ•°å¯åŠ¨æ—¶ï¼Œç¨‹åºæ˜¾ç¤ºï¼š </p><br><pre> <code class="bash hljs">$ ./crackmeMario usage &lt;password&gt;</code> </pre> <br><p> ä½¿ç”¨ä»»æ„å­—ç¬¦ä¸²å‚æ•°å¯åŠ¨æ—¶ï¼Œå®ƒæ˜¾ç¤ºï¼š </p><br><pre> <code class="bash hljs">./crackmeMario qwerty try again pal.</code> </pre> <br><p> æˆ‘ä»¬å°†æ‰“è¡¥ä¸ï¼Œä»¥ä¾¿ç¨‹åºåœ¨å¯åŠ¨æ—¶ç«‹å³æ˜¾ç¤ºæ¶ˆæ¯â€œå¥½å·¥ä½œï¼ ç°åœ¨æ³¨å†Œæˆ‘ï¼â€ </p><br><h3 id="radare2-2"> é›·è¾¾2 </h3><br><p>  Radee2å¯ä»¥ä¿®è¡¥å…¶æ”¯æŒçš„ä»»ä½•æ ¼å¼ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨æ–‡æœ¬æ ¼å¼æè¿°è¡¥ä¸ï¼š </p><br><pre> <code class="plaintext hljs"># Rapatch for https://crackmes.one/crackme/5ccecc7e33c5d4419da559b3 !echo Patching crackme 0x115D : jmp 0x1226</code> </pre> <br><p> æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åº”ç”¨æ­¤ç±»è¡¥ä¸ï¼š </p><br><pre> <code class="bash hljs">$ r2 -P patch.txt crackmeMario</code> </pre> <br><p> é˜…è¯»æœ‰å…³é€šè¿‡radare2ä¿®è¡¥ä»£ç çš„ä¿¡æ¯ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨Radare2è¿›è¡ŒäºŒè¿›åˆ¶ä¿®è¡¥</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Radare2æ¢ç´¢ã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ•™ç¨‹1-ç®€å•è¡¥ä¸</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é›¶åœ°çº¿ï¼šç¬¬3-2éƒ¨åˆ†-é€†å‘å·¥ç¨‹-ä½¿ç”¨Radare2ä¿®è¡¥äºŒè¿›åˆ¶æ–‡ä»¶-ARM64</a> </li></ul><br><h3 id="lief-9"> åˆ—å¤« </h3><br><p>  LIEFå…è®¸æ‚¨åœ¨æŒ‡å®šçš„è™šæ‹Ÿåœ°å€å¤„ä¿®è¡¥elfï¼ˆè¦†ç›–å­—èŠ‚ï¼‰ã€‚ è¡¥ä¸å¯ä»¥æ˜¯å­—èŠ‚æ•°ç»„çš„å½¢å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•´æ•°å€¼ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"crackmeMario"</span></span>) binary.patch_address(<span class="hljs-number"><span class="hljs-number">0x115D</span></span>, bytearray(<span class="hljs-string"><span class="hljs-string">b"\xe9\xc4\x00\x00\x00"</span></span>)) binary.write(<span class="hljs-string"><span class="hljs-string">"crackmeMario.patched"</span></span>)</code> </pre> <br><p> åº”ç”¨è¡¥ä¸åï¼Œç¨‹åºå°†è¾“å‡ºï¼š </p><br><pre> <code class="bash hljs">$ ./crackmeMario.patched good job! now keygen me!</code> </pre> <br><h2 id="dobavit-sekciyu-v-elf"> å°†éƒ¨åˆ†æ·»åŠ åˆ°ELF </h2><br><h3 id="objcopy-1">  objcopy </h3><br><p>  <em>objcopy</em>å…è®¸æ‚¨æ·»åŠ ä¸€ä¸ªéƒ¨åˆ†ï¼Œä½†æ˜¯è¯¥éƒ¨åˆ†å°†ä¸å±äºä»»ä½•æ®µï¼Œå¹¶ä¸”åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ä¸ä¼šè¢«åŠ è½½åˆ°RAMä¸­ï¼š </p><br><pre> <code class="bash hljs">$ objcopy --add-section .testme=data.zip \ --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-section-flags .testme=alloc,contents,load,<span class="hljs-built_in"><span class="hljs-built_in">readonly</span></span> \ --change-section-address .testme=0x08777777 \ simple simple.patched.elf</code> </pre> <br><h3 id="lief-10"> åˆ—å¤« </h3><br><p>  LIEFåº“å…è®¸æ‚¨å‘ç°æœ‰çš„ELFä¸­æ·»åŠ æ–°èŠ‚åŠå…¶å¯¹åº”çš„æ®µï¼ˆloading <strong><code>loaded=True</code></strong>æ ‡å¿—ï¼‰ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple"</span></span>) data = bytearray(<span class="hljs-string"><span class="hljs-string">b"\xFF"</span></span> * <span class="hljs-number"><span class="hljs-number">16</span></span>) section = lief.ELF.Section(<span class="hljs-string"><span class="hljs-string">".testme"</span></span>, lief.ELF.SECTION_TYPES.PROGBITS) section += lief.ELF.SECTION_FLAGS.EXECINSTR section += lief.ELF.SECTION_FLAGS.ALLOC section.content = data binary.add(section, loaded=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) binary.write(<span class="hljs-string"><span class="hljs-string">"simple.testme.lief"</span></span>)</code> </pre> <br><h2 id="izmenit-sekciyu"> å˜æ›´ç§‘ </h2><br><h3 id="objcopy-2">  objcopy </h3><br><p>  <em>objcopy</em>å…è®¸<em>æ‚¨</em>ç”¨æ–‡ä»¶ä¸­çš„æ•°æ®æ›¿æ¢èŠ‚çš„å†…å®¹ï¼Œä»¥åŠæ›´æ”¹èŠ‚çš„è™šæ‹Ÿåœ°å€å’Œæ ‡å¿—ï¼š </p><br><pre> <code class="bash hljs">$ objcopy --update-section .testme=patch.bin \ --change-section-address .testme=0x08999999 simple simple.testme.elf</code> </pre> <br><h3 id="lief-11"> åˆ—å¤« </h3><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple"</span></span>) data = bytearray(<span class="hljs-string"><span class="hljs-string">b"\xFF"</span></span> * <span class="hljs-number"><span class="hljs-number">17</span></span>) section = binary.get_section(<span class="hljs-string"><span class="hljs-string">".text"</span></span>) section.content = data binary.write(<span class="hljs-string"><span class="hljs-string">"simple.patched"</span></span>)</code> </pre> <br><h2 id="udalit-sekciyu"> åˆ é™¤éƒ¨åˆ† </h2><br><h3 id="objcopy-3">  objcopy </h3><br><p>  <em>objcopy</em>å…è®¸<em>æ‚¨</em>é€šè¿‡åç§°åˆ é™¤ç‰¹å®šéƒ¨åˆ†ï¼š </p><br><pre> <code class="bash hljs">$ objcopy --remove-section .testme simple.testme.elf simple.no_testme.elf</code> </pre> <br><h3 id="lief-12"> åˆ—å¤« </h3><br><p> ä½¿ç”¨LIEFåº“åˆ é™¤éƒ¨åˆ†çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"simple.testme.elf"</span></span>) binary.remove_section(<span class="hljs-string"><span class="hljs-string">".testme"</span></span>) binary.write(<span class="hljs-string"><span class="hljs-string">"simple.no_testme"</span></span>)</code> </pre> <br><h2 id="elf-konteyner"> ç²¾çµå®¹å™¨ </h2><br><p> è¯¥é£Ÿè°±çš„çµæ„Ÿæ¥è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gremlinså’ŒELFé­”æœ¯ï¼šå¦‚æœELFæ–‡ä»¶æ˜¯å®¹å™¨ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</a>  ã€‚ è¿˜æœ‰ä¸€äº›å…³äºSolarisçš„elfwrapå®ç”¨ç¨‹åºçš„æ‰‹å†Œï¼Œå®ƒå…è®¸æ‚¨ä»ä»»æ„æ•°æ®åˆ›å»ºELFæ–‡ä»¶ï¼Œå¹¶ä¸”ELFæ ¼å¼ä»…ç”¨ä½œå®¹å™¨ã€‚ </p><br><p> è®©æˆ‘ä»¬å°è¯•åœ¨Pythonå’ŒLIEFä¸­æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚ <br> ä¸å¹¸çš„æ˜¯ï¼Œç›®å‰ï¼ŒLIEFåº“æ— æ³•ä»å¤´å¼€å§‹åˆ›å»ºelfæ–‡ä»¶ï¼Œå› æ­¤æ‚¨éœ€è¦æä¾›å¸®åŠ©-åˆ›å»ºä¸€ä¸ªç©ºçš„ELFæ¨¡æ¿ï¼š </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> | gcc -m32 -fpic -o empty.o -c -xc - $ gcc -m32 -shared -o libempty.so empty.o</code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤æ¨¡æ¿æ¥å¡«å……æ•°æ®ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"libempty.so"</span></span>) filename = <span class="hljs-string"><span class="hljs-string">"crackme.zip"</span></span> data = open(filename, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>).read() <span class="hljs-comment"><span class="hljs-comment"># Add section with zip-archive as content section = lief.ELF.Section() section.content = data section.name = ".%s"%filename binary.add(section, loaded=True) # Add symbol as a reference to zip-archive symb = lief.ELF.Symbol() symb.type = lief.ELF.SYMBOL_TYPES.OBJECT symb.binding = lief.ELF.SYMBOL_BINDINGS.GLOBAL symb.size = len(data) symb.name = filename symb.value = section.virtual_address binary.add_static_symbol(symb) binary.write("libdata.crackme.container")</span></span></code> </pre> <br><h2 id="elf-s-pricepom"> ç²¾çµâ€œå¸¦æ‹–è½¦â€ </h2><br><p>  ELFæ ¼å¼ä¸å¯¹æ–‡ä»¶ä¸­çš„æ•°æ®æ–½åŠ é™åˆ¶ï¼Œä½†ä¸å±äºä»»ä½•æ®µã€‚ å› æ­¤ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°†å­˜å‚¨åœ¨ELFç»“æ„ä¹‹åã€‚ è¿™æ˜¯åœ¨è¿è¡Œæ—¶ä¸ä¼šåŠ è½½åˆ°RAMä¸­çš„å†…å®¹ï¼Œä½†æ˜¯ä¼šè¢«å†™å…¥ç£ç›˜ï¼Œå¹¶ä¸”éšæ—¶å¯ä»¥ä»ç£ç›˜è¯»å–ã€‚ </p><br><ul><li>  <em>IDA Proåœ¨åˆ†ææ—¶ä¸ä¼šè€ƒè™‘æ­¤æ•°æ®</em> </li></ul><br><p>  <em>å¸¦é¢„å‘Šç‰‡çš„æ–‡ä»¶ç»“æ„ç¤ºä¾‹</em> <br><img src="https://habrastorage.org/webt/rr/br/sk/rrbrsktjs_p8l7fmdfq7t4mejns.jpeg" alt="å›¾ç‰‡"></p><br><h3 id="radare2-3"> é›·è¾¾2 </h3><br><p> å¯ä»¥é€šè¿‡æ¯”è¾ƒå®é™…æ–‡ä»¶å¤§å°å’Œè®¡ç®—æ–‡ä»¶å¤§å°æ¥ç¡®å®šæ˜¯å¦å­˜åœ¨â€œé¢„å‘Šç‰‡â€ï¼š </p><br><pre> <code class="bash hljs">$ radare2 test.elf [0x00001040]&gt; ?v <span class="hljs-variable"><span class="hljs-variable">$s</span></span> 0x40c1 [0x00001040]&gt; iZ 14699</code> </pre> <br><h3 id="readelf-3">  Readelf </h3><br><p>  <em>readelf</em>ä¸ä¼šæ˜¾ç¤ºæœ‰å…³â€œé¢„å‘Šç‰‡â€çš„ä¿¡æ¯ï¼Œä½†æ˜¯å¯ä»¥æ‰‹åŠ¨è®¡ç®—ï¼š </p><br><pre> <code class="bash hljs">$ ls -l test.elf <span class="hljs-comment"><span class="hljs-comment">#   16577  $ readelf -h test.elf Start of section headers e_shoff 14704 Size of section headers e_shentsize 64 Number of section headers e_shnum 29 #  ELF-: e_shoff + ( e_shentsize * e_shnum ) = 16560</span></span></code> </pre> <br><h3 id="lief-13"> åˆ—å¤« </h3><br><p>  LIEFåº“ä½¿æ‚¨æ—¢å¯ä»¥æ£€æŸ¥â€œé¢„å‘Šç‰‡â€çš„å­˜åœ¨ï¼Œä¹Ÿå¯ä»¥æ·»åŠ å®ƒã€‚ ä½¿ç”¨LIEFï¼Œä¸€åˆ‡çœ‹èµ·æ¥éƒ½éå¸¸ç®€æ´ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lief binary = lief.parse(<span class="hljs-string"><span class="hljs-string">"test"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># check if overlay exists print('ELF has overlay data') if binary.has_overlay else print("No overlay data") # add overlay data to ELF data = bytearray(b'\xFF'*17) binary.overlay = data binary.write('test.overlay')</span></span></code> </pre> <br><h2 id="elf-iz-pustoty-elf-from-scratch"> è™šç©ºç²¾çµï¼ˆä»å¤´å¼€å§‹çš„ELFï¼‰ </h2><br><p> åœ¨Internetä¸Šï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ç”¨äºâ€œæ‰‹åŠ¨â€åˆ›å»ºELFæ–‡ä»¶çš„é¡¹ç›®ï¼Œè€Œæ— éœ€ä½¿ç”¨é€šç”¨åç§°ä¸ºâ€œ ELF from scratchâ€çš„ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Githubé¡¹ç›®</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°ç²¾çµä»é›¶å¼€å§‹çš„</a>æ–‡ç«  </li><li>  LIEFåº“å­˜å‚¨åº“ä¸­çš„Elf_from_scratchåˆ†æ”¯ </li></ul><br><p> ç†Ÿæ‚‰è¿™äº›é¡¹ç›®ä¼šå¯¹ELFæ ¼å¼çš„å¸æ”¶äº§ç”Ÿæœ‰ç›Šçš„å½±å“ã€‚ </p><br><h2 id="samyy-malenkiy-elf"> æœ€å°çš„ç²¾çµ </h2><br><p> åœ¨æ–‡ç« ä¸­ä»‹ç»äº†å°†ç²¾çµå¤§å°æœ€å°åŒ–çš„æœ‰è¶£å®éªŒï¼š </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³äºä¸ºLinuxåˆ›å»ºçœŸæ­£çš„ELFå¯æ‰§è¡Œæ–‡ä»¶çš„æ—‹é£æ•™ç¨‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³äºä¸ºLinuxåˆ›å»ºè¿‘ä¼¼çš„ELFå¯æ‰§è¡Œæ–‡ä»¶çš„æ—‹é£æ•™ç¨‹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ELFæ ¼å¼çš„ç®€çº¦ç¨‹åº</a> </li></ul><br><p> ç®€è€Œè¨€ä¹‹ï¼Œæ“ä½œç³»ç»Ÿä¸­çš„elfåŠ è½½ç¨‹åºä¸ä¼šä½¿ç”¨æ‰€æœ‰æ ‡å¤´å­—æ®µå’Œæ®µè¡¨ï¼Œå¹¶ä¸”ä¸€äº›æœ€å°‘çš„å¯æ‰§è¡Œä»£ç å¯ä»¥ç›´æ¥æ”¾åœ¨ELFæ ‡å¤´ç»“æ„ä¸­ï¼ˆè¯¥ä»£ç æ‘˜è‡ªç¬¬ä¸€ç¯‡æ–‡ç« ï¼‰ï¼š </p><br><pre> <code class="plaintext hljs">; tiny.asm BITS 32 org 0x00010000 db 0x7F, "ELF" ; e_ident dd 1 ; p_type dd 0 ; p_offset dd $$ ; p_vaddr dw 2 ; e_type ; p_paddr dw 3 ; e_machine dd _start ; e_version ; p_filesz dd _start ; e_entry ; p_memsz dd 4 ; e_phoff ; p_flags _start: mov bl, 42 ; e_shoff ; p_align xor eax, eax inc eax ; e_flags int 0x80 db 0 dw 0x34 ; e_ehsize dw 0x20 ; e_phentsize db 1 ; e_phnum ; e_shentsize ; e_shnum ; e_shstrndx filesize equ $ - $$</code> </pre> <br><p> ç»„è£…å¹¶è·å¾—å¤§å°ä¸º... <strong>45å­—èŠ‚</strong>çš„ELFï¼š </p><br><pre> <code class="bash hljs"> $ nasm -f bin -o a.out tiny.asm $ chmod +x a.out $ ./a.out ; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> $? 42 $ wc -c a.out 45 a.out</code> </pre> <br><h2 id="elf-po-shablonu"> æ¨¡å¼ç²¾çµ </h2><br><p> è¦ä½¿ç”¨LIEFåº“åˆ›å»ºä¸€ä¸ªelfï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼ˆè¯·å‚è§é…æ–¹â€œ Elf-containerâ€ï¼‰ï¼š </p><br><ul><li> ä»¥ç®€å•çš„ELFæ–‡ä»¶ä¸ºæ¨¡æ¿ï¼› </li><li> æ›¿æ¢èŠ‚çš„å†…å®¹ï¼Œæ·»åŠ æ–°èŠ‚ï¼› </li><li> é…ç½®å¿…è¦çš„å‚æ•°ï¼ˆå…¥å£ç‚¹ï¼Œæ ‡å¿—ï¼‰ã€‚ </li></ul><br><h1 id="vmesto-zaklyucheniya"> è€Œä¸æ˜¯ç»“è®º </h1><br><p> åœ¨æ–‡ç« ä¸­æ·»åŠ å†…å®¹åï¼Œæˆ‘ä»¬å‘ç°å®ƒå®é™…ä¸Šå°±åƒæ˜¯LIEFåº“çš„é¢‚æ­Œã€‚ ä½†è¿™æ˜¯æ²¡æœ‰è®¡åˆ’çš„-æˆ‘æƒ³å±•ç¤ºå¦‚ä½•ä½¿ç”¨å…¶ä»–å·¥å…·å¤„ç†ELFæ–‡ä»¶ã€‚ </p><br><p> å½“ç„¶ï¼Œè¿™é‡Œæœ‰æˆ–æ²¡æœ‰éœ€è¦çš„è„šæœ¬-åœ¨æ³¨é‡Šä¸­å†™ä¸€ä¸‹ã€‚ </p><br><h1 id="ssylki-i-literatura"> å‚è€ƒæ–‡çŒ® </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ELFæ ¼å¼è§„æ ¼</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Oracleåº“ä¸­çš„å¦ä¸€ç§æ ¼å¼è§„èŒƒ</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨radare2å¤„ç†ELF</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LIEFåº“æ–‡æ¡£</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">LIEFåº“ç¤ºä¾‹</a> </li><li> æœ¬ä¹¦â€œå®ç”¨çš„äºŒè¿›åˆ¶åˆ†æâ€ï¼Œä¸¹å°¼æ–¯Â·å®‰å¾·é‡Œæ–¯ï¼ˆDennis Andriesseï¼‰ </li><li> å­¦ä¹ LinuxäºŒè¿›åˆ¶åˆ†æï¼Œä½œè€…ï¼šRyanâ€œ elfmasterâ€ O'Neill </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460247/">https://habr.com/ru/post/zh-CN460247/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460231/index.html">OpenGear-ä½¿ç”¨å¸¦å¤–ç®¡ç†çš„æ§åˆ¶å°æœåŠ¡å™¨å‡å°‘ä¸šåŠ¡åœæœºæ—¶é—´</a></li>
<li><a href="../zh-CN460233/index.html">æ¸¸æˆâ€œåŸå¸‚ï¼šå¤©é™…çº¿â€è¯æ˜æ˜¯å›¾çµå®Œå¤‡çš„ï¼šæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª4ä½åŠ æ³•å™¨</a></li>
<li><a href="../zh-CN460237/index.html">eBayéª—å­ï¼ˆä¸€ä¸ªä½œå¼Šæ•…äº‹ï¼‰</a></li>
<li><a href="../zh-CN460239/index.html">å¦‚ä½•å®Œå…¨å…è´¹åœ¨å®¶ä¸­è·å–NextGen Firewall</a></li>
<li><a href="../zh-CN460241/index.html">åœ°ç‹±è¿˜æ˜¯é«˜æ°´ï¼šä¿„ç½—æ–¯ç§‘æ™®æ–‡å­¦å²</a></li>
<li><a href="../zh-CN460249/index.html">ç”¨pwnable.kr 07è§£å†³ä»»åŠ¡-è¾“å…¥ã€‚ äº†è§£pwntools</a></li>
<li><a href="../zh-CN460251/index.html">äººä¸ºçš„æ„šè ¢ï¼šå¯¹æˆ‘æ²¡æœ‰å¸®åŠ©çš„æœºå™¨äºº</a></li>
<li><a href="../zh-CN460253/index.html">æé«˜è¯­éŸ³åŠ©æ‰‹æŠ€èƒ½çš„10ä¸ªç†ç”±</a></li>
<li><a href="../zh-CN460255/index.html">Node.jsä¸Šçš„åé—¨ç¨‹åºï¼šä¸ºä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•å·¥ä½œ</a></li>
<li><a href="../zh-CN460257/index.html">ä¸–ç•Œæ‚¨å¥½ï¼ æ·±å…¥æµ¸å…¥ç»ˆç«¯</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>