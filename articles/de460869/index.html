<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•ã üë©üèª‚Äçüè´ üìÑ Echtzeit-Objekterkennung unter iOS mit YOLOv3 üì∑ üëì üïí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo allerseits! 

 In diesem Artikel schreiben wir ein kleines Programm zur L√∂sung des Problems der Objekterkennung und -erkennung (Objekterkennung)...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Echtzeit-Objekterkennung unter iOS mit YOLOv3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460869/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gr/ah/g9/grahg9mh7movhc2fcbn7m-yfoxu.png"></div><br>  Hallo allerseits! <br><br>  In diesem Artikel schreiben wir ein kleines Programm zur L√∂sung des Problems der Objekterkennung und -erkennung (Objekterkennung) in Echtzeit.  Das Programm wird in der Programmiersprache Swift f√ºr die iOS-Plattform geschrieben.  Um Objekte zu erkennen, verwenden wir ein Faltungsnetzwerk mit einer Architektur namens YOLOv3.  In diesem Artikel erfahren Sie, wie Sie mit dem CoreML-Framework in iOS mit neuronalen Netzen arbeiten, wie Sie das YOLOv3-Netzwerk verstehen und wie Sie die Ausgaben dieses Netzwerks verwenden und verarbeiten.  Wir werden auch die Funktionsweise des Programms √ºberpr√ºfen und verschiedene Varianten von YOLOv3 vergleichen: YOLOv3-tiny und YOLOv3-416. <br><br>  Quellen werden am Ende des Artikels verf√ºgbar sein, sodass jeder den Betrieb des neuronalen Netzwerks auf seinem Ger√§t testen kann. <br><a name="habracut"></a><br><h2>  Objekterkennung </h2><br>  Zun√§chst werden wir kurz verstehen, welche Aufgabe das Erkennen von Objekten (Objekterkennung) im Bild hat und welche Werkzeuge heute daf√ºr verwendet werden.  Ich verstehe, dass viele mit diesem Thema ziemlich vertraut sind, aber ich erlaube mir trotzdem, ein wenig dar√ºber zu erz√§hlen. <br><br>  Nun werden viele Aufgaben im Bereich der Bildverarbeitung mit Hilfe von Faltungs-Neuronalen Netzen (Convolutional Neural Networks), im Folgenden CNN, gel√∂st.  Aufgrund ihrer Struktur extrahieren sie gut Merkmale aus dem Bild.  CNNs werden bei der Klassifizierung, Erkennung, Segmentierung und vielen anderen verwendet. <br><br>  Beliebte CNN-Architekturen zur Objekterkennung: <br><br><ul><li>  <b>R-CNN.</b>  Wir k√∂nnen das erste Modell sagen, das dieses Problem l√∂st.  Funktioniert wie ein normaler Bildklassifizierer.  Verschiedene Bereiche des Bildes werden dem Netzwerkeingang zugef√ºhrt und Vorhersagen f√ºr sie gemacht.  Sehr langsam, da ein einzelnes Bild mehrere tausend Mal ausgef√ºhrt wird. </li><li>  <b>Schnelles R-CNN.</b>  Eine verbesserte und schnellere Version von R-CNN arbeitet nach einem √§hnlichen Prinzip, aber zuerst wird das gesamte Bild der CNN-Eingabe zugef√ºhrt, dann werden Regionen aus der empfangenen internen Darstellung erzeugt.  Aber immer noch ziemlich langsam f√ºr Echtzeitaufgaben. </li><li>  <b>Schnelleres R-CNN.</b>  Der Hauptunterschied zu den vorherigen besteht darin, dass anstelle des selektiven Suchalgorithmus ein neuronales Netzwerk verwendet wird, um Regionen auszuw√§hlen, um sie zu ‚Äûmerken‚Äú. </li><li>  <b>YOLO.</b>  Ein v√∂llig anderes Funktionsprinzip als die vorherigen verwendet √ºberhaupt keine Regionen.  Am schnellsten.  Weitere Details dazu werden im Artikel besprochen. </li><li>  <b>SSD</b>  Es √§hnelt im Prinzip YOLO, verwendet jedoch VGG16 als Netzwerk zum Extrahieren von Funktionen.  Auch ziemlich schnell und f√ºr Echtzeitarbeit geeignet. </li><li>  <b>Feature Pyramid Networks (FPN).</b>  Ein anderer Netzwerktyp wie der Single Shot Detector ist aufgrund der Merkmale der Merkmalsextraktion besser als die SSD kleine Objekte erkennt. </li><li>  <b>RetinaNet.</b>  Es verwendet eine Kombination aus FPN + ResNet und bietet dank einer speziellen Fehlerfunktion (Fokusverlust) eine h√∂here Genauigkeit. </li></ul><br>  In diesem Artikel verwenden wir die YOLO-Architektur, n√§mlich die neueste Modifikation, YOLOv3. <br><br><h2>  Warum YOLO? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/fy/lq/i4fylqlbpgsp-mu3w6k96zd5e1u.jpeg"></div><br><br>  YOLO oder You Only Look Once ist die sehr beliebte Architektur von CNN, mit der mehrere Objekte in einem Bild erkannt werden.  Ausf√ºhrlichere Informationen dazu finden Sie auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offiziellen Website</a> . An derselben Stelle finden Sie Ver√∂ffentlichungen, in denen die Theorie und die mathematische Komponente dieses Netzwerks sowie der Prozess seiner Ausbildung ausf√ºhrlich beschrieben werden. <br><br>  Das Hauptmerkmal dieser Architektur im Vergleich zu anderen ist, dass die meisten Systeme CNN mehrmals auf verschiedene Bereiche des Bildes anwenden, in YOLO wird CNN einmal auf das gesamte Bild gleichzeitig angewendet.  Das Netzwerk unterteilt das Bild in eine Art Raster und sagt Begrenzungsrahmen und die Wahrscheinlichkeit voraus, dass f√ºr jeden Abschnitt ein gew√ºnschtes Objekt vorhanden ist. <br><br>  Der Vorteil dieses Ansatzes besteht darin, dass das Netzwerk das gesamte Bild auf einmal betrachtet und den Kontext bei der Erkennung und Erkennung eines Objekts ber√ºcksichtigt.  YOLO ist au√üerdem 1000-mal schneller als R-CNN und etwa 100-mal schneller als Fast R-CNN.  In diesem Artikel werden wir ein Netzwerk auf einem mobilen Ger√§t f√ºr die Online-Verarbeitung starten. Dies ist also die wichtigste Qualit√§t f√ºr uns. <br><br>  Weitere Informationen zum Vergleichen von Architekturen finden Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br><h4>  YOLOv3 </h4><br>  YOLOv3 ist eine erweiterte Version der YOLO-Architektur.  Es besteht aus 106 Faltungsschichten und erkennt kleine Objekte besser als sein Vorg√§nger YOLOv2.  Das Hauptmerkmal von YOLOv3 ist, dass sich am Ausgang drei Ebenen befinden, von denen jede Objekte unterschiedlicher Gr√∂√üe erkennt. <br>  Das Bild unten zeigt den schematischen Aufbau: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/rf/_j/clrf_jqzkt1qfszivfchhxkujv4.png"></div><br><br>  <b>YOLOv3-tiny</b> - Eine beschnittene Version der YOLOv3-Architektur besteht aus weniger Ebenen (es gibt nur 2 Ausgabeebenen).  Es sagt kleinere Objekte schlechter voraus und ist f√ºr kleine Datens√§tze gedacht.  Aufgrund der abgeschnittenen Struktur belegen die Netzwerkgewichte jedoch wenig Speicher (~ 35 MB) und erzeugen h√∂here FPS.  Daher ist eine solche Architektur f√ºr die Verwendung auf einem mobilen Ger√§t vorzuziehen. <br><br><h2>  Wir schreiben ein Programm zur Objekterkennung </h2><br>  Der lustige Teil beginnt! <br><br>  Erstellen wir eine Anwendung, die mithilfe der Kamera des Telefons verschiedene Objekte im Bild in Echtzeit erkennt.  Der gesamte Code wird in der Programmiersprache Swift 4.2 geschrieben und auf einem iOS-Ger√§t ausgef√ºhrt. <br><br>  In diesem Tutorial nehmen wir ein fertiges Netzwerk mit Skalen, die auf einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">COCO-</a> Datensatz vorab trainiert wurden.  Es pr√§sentiert 80 verschiedene Klassen.  Daher kann unser Neuron 80 verschiedene Objekte erkennen. <br><br><h4>  Von Darknet zu CoreML </h4><br>  Die urspr√ºngliche YOLOv3-Architektur wird mithilfe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Darknet-</a> Frameworks implementiert. <br><br>  Unter iOS gibt es ab Version 11.0 eine wunderbare <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CoreML-</a> Bibliothek, mit der Sie Modelle f√ºr maschinelles Lernen direkt auf dem Ger√§t ausf√ºhren k√∂nnen.  Es gibt jedoch eine Einschr√§nkung: Das <b>Programm kann nur auf einem Ger√§t mit iOS 11 und h√∂her ausgef√ºhrt werden.</b> <br><br>  Das Problem ist, dass CoreML nur das spezifische Format des <i>.coreml-</i> Modells versteht.  F√ºr die meisten g√§ngigen Bibliotheken wie Tensorflow, Keras oder XGBoost ist die direkte Konvertierung in das CoreML-Format m√∂glich.  Aber f√ºr Darknet gibt es keine solche M√∂glichkeit.  Um das gespeicherte und trainierte Modell von Darknet in CoreML zu konvertieren, k√∂nnen Sie verschiedene Optionen verwenden, z. B. Darknet in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ONNX speichern</a> und dann von ONNX in CoreML konvertieren. <br><br>  Wir werden einen einfacheren Weg verwenden und die Keras-Implementierung von YOLOv3 verwenden.  Der Aktionsalgorithmus lautet wie folgt: Laden Sie die Darknet-Gewichte in das Keras-Modell, speichern Sie sie im Keras-Format und konvertieren Sie sie direkt in CoreML. <br><br><ol><li>  <b>Laden Sie Darknet herunter.</b>  Laden Sie hier die Dateien des trainierten Darknet-YOLOv3-Modells herunter.  In diesem Artikel werde ich zwei Architekturen verwenden: YOLOv3-416 und YOLOv3-tiny.  Wir ben√∂tigen sowohl cfg- als auch weight-Dateien. </li><li>  <b>Von Darknet nach Keras.</b>  Klonen Sie zuerst das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> , wechseln Sie in den Repo-Ordner und f√ºhren Sie den folgenden Befehl aus: <br><br><pre><code class="bash hljs">python convert.py yolov3.cfg yolov3.weights yolo.h5</code> </pre> <br>  Dabei haben yolov3.cfg und yolov3.weights Darknet-Dateien heruntergeladen.  Daher sollten wir eine Datei mit der Erweiterung <i>.h5 haben</i> - dies ist das gespeicherte YOLOv3-Modell im Keras-Format. </li><li>  <b>Von Keras zu CoreML.</b>  Der letzte Schritt blieb.  Um das Modell in CoreML zu konvertieren, m√ºssen Sie das Python-Skript ausf√ºhren (Sie m√ºssen zuerst die Coremltools-Bibliothek f√ºr Python installieren): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> coremltools coreml_model = coremltools.converters.keras.convert( <span class="hljs-string"><span class="hljs-string">'yolo.h5'</span></span>, input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, image_input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, input_name_shape_dict={<span class="hljs-string"><span class="hljs-string">'image'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]}, <span class="hljs-comment"><span class="hljs-comment">#      image_scale=1/255.) coreml_model.input_description['image'] = 'Input image' coreml_model.save('yolo.mlmodel')</span></span></code> </pre> </li></ol><br>  Die oben beschriebenen Schritte m√ºssen f√ºr die beiden Modelle YOLOv3-416 und YOLOv3-tiny ausgef√ºhrt werden. <br>  Als wir das alles gemacht haben, haben wir zwei Dateien: yolo.mlmodel und yolo-tiny.mlmodel.  Jetzt k√∂nnen Sie den Code der Anwendung selbst schreiben. <br><br><h4>  Erstellen einer iOS-App </h4><br>  Ich werde nicht den gesamten Anwendungscode beschreiben. Sie k√∂nnen ihn im Repository sehen. Ein Link dazu wird am Ende des Artikels angegeben.  Lassen Sie mich nur sagen, dass wir drei UIViewController-a haben: OnlineViewController, PhotoViewController und SettingsViewController.  Die erste ist die Ausgabe der Kamera und die Online-Erkennung von Objekten f√ºr jedes Bild.  Im zweiten Schritt k√∂nnen Sie ein Foto aufnehmen oder ein Bild aus der Galerie ausw√§hlen und das Netzwerk anhand dieser Bilder testen.  Die dritte enth√§lt die Einstellungen. Sie k√∂nnen das YOLOv3-416- oder YOLOv3-winzige Modell sowie die Schwellenwerte IoU (Schnittpunkt √ºber Vereinigung) und Objektvertrauen (die Wahrscheinlichkeit, dass sich ein Objekt im aktuellen Bildabschnitt befindet) ausw√§hlen. <br><br>  <b>Laden von Modellen in CoreML</b> <br><br>  Nachdem wir das trainierte Modell vom Darknet-Format in CoreML konvertiert haben, haben wir eine Datei mit der Erweiterung <i>.mlmodel</i> .  In meinem Fall habe ich zwei Dateien erstellt: <i>yolo.mlmodel</i> und <i>yolo-tiny.mlmodel</i> f√ºr die Modelle YOLOv3-416 und YOLOv3-tiny.  Jetzt k√∂nnen Sie diese Dateien in ein Projekt in Xcode laden. <br><br>  Wir erstellen die ModelProvider-Klasse, in der das aktuelle Modell und die Methoden zum asynchronen Aufrufen des neuronalen Netzwerks zur Ausf√ºhrung gespeichert werden.  Das Modell wird folgenderma√üen geladen: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: YOLOType)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">YOLO</span></span>(type: type) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assertionFailure</span></span>(<span class="hljs-string"><span class="hljs-string">"error creating model"</span></span>) } }</code> </pre><br>  Die YOLO-Klasse ist direkt f√ºr das Laden von <i>.mlmodel-</i> Dateien und die Verarbeitung von Modellausgaben verantwortlich.  Modelldateien herunterladen: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url: <span class="hljs-type"><span class="hljs-type">URL?</span></span> = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.type = type <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_Tiny: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo-tiny"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = tiny_anchors <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_416: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = anchors_416 } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> modelURL = url <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelFileNotFound } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">MLModel</span></span>(contentsOf: modelURL) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelCreationError }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Vollst√§ndiger ModelProvider-Code.</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CoreML protocol ModelProviderDelegate: class { func show(predictions: [YOLO.Prediction]?, stat: ModelProvider.Statistics, error: YOLOError?) } @available(macOS 10.13, iOS 11.0, tvOS 11.0, watchOS 4.0, *) class ModelProvider { struct Statistics { var timeForFrame: Float var fps: Float } static let shared = ModelProvider(modelType: Settings.shared.modelType) var model: YOLO! weak var delegate: ModelProviderDelegate? var predicted = 0 var timeOfFirstFrameInSecond = CACurrentMediaTime() init(modelType type: YOLOType) { loadModel(type: type) } func reloadModel(type: YOLOType) { loadModel(type: type) } private func loadModel(type: YOLOType) { do { self.model = try YOLO(type: type) } catch { assertionFailure("error creating model") } } func predict(frame: UIImage) { DispatchQueue.global().async { do { let startTime = CACurrentMediaTime() let predictions = try self.model.predict(frame: frame) let elapsed = CACurrentMediaTime() - startTime self.showResultOnMain(predictions: predictions, elapsed: Float(elapsed), error: nil) } catch let error as YOLOError { self.showResultOnMain(predictions: nil, elapsed: -1, error: error) } catch { self.showResultOnMain(predictions: nil, elapsed: -1, error: YOLOError.unknownError) } } } private func showResultOnMain(predictions: [YOLO.Prediction]?, elapsed: Float, error: YOLOError?) { if let delegate = self.delegate { DispatchQueue.main.async { let fps = self.measureFPS() delegate.show(predictions: predictions, stat: ModelProvider.Statistics(timeForFrame: elapsed, fps: fps), error: error) } } } private func measureFPS() -&gt; Float { predicted += 1 let elapsed = CACurrentMediaTime() - timeOfFirstFrameInSecond let currentFPSDelivered = Double(predicted) / elapsed if elapsed &gt; 1 { predicted = 0 timeOfFirstFrameInSecond = CACurrentMediaTime() } return Float(currentFPSDelivered) } }</code> </pre><br></div></div><br>  <b>Ausgangsverarbeitung f√ºr neuronale Netze</b> <br><br>  Lassen Sie uns nun herausfinden, wie die Ausgaben des neuronalen Netzwerks verarbeitet und die entsprechenden Begrenzungsrahmen abgerufen werden.  Wenn Sie in Xcode eine Modelldatei ausw√§hlen, k√∂nnen Sie sehen, was diese sind, und die Ausgabeebenen anzeigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m_/3b/vz/m_3bvzkroynfyfkpv1fal-ydf_k.png"></div><br>  <i>Ein- und Ausstieg YOLOv3-tiny.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0l/nl/hy/0lnlhydblax7trhpzdte8bojc0y.png"></div><br>  <i>Ein- und Ausgang YOLOv3-416.</i> <br><br>  Wie Sie im obigen Bild sehen k√∂nnen, haben wir drei f√ºr YOLOv3-416 und zwei f√ºr YOLOv3-winzige Ausgabeebenen, in denen jeweils Begrenzungsrahmen f√ºr verschiedene Objekte vorhergesagt werden. <br>  In diesem Fall handelt es sich um ein regul√§res Array von Zahlen. Lassen Sie uns herausfinden, wie es analysiert wird. <br><br>  Das YOLOv3-Modell verwendet drei Ebenen als Ausgabe, um das Bild in ein anderes Gitter zu unterteilen. Die Zellengr√∂√üen dieser Gitter haben die folgenden Werte: 8, 16 und 32. Angenommen, wir haben ein Bild mit einer Gr√∂√üe von 416 x 416 Pixel am Eingang, dann haben die Ausgabematrizen (Gitter) eine Gr√∂√üe von 52 x 52 26 √ó 26 und 13 √ó 13 (416/8 = 52, 416/16 = 26 und 416/32 = 13).  Im Fall von YOLOv3-tiny ist alles gleich, aber anstelle von drei Gittern haben wir zwei: 16 und 32, dh Matrizen mit den Abmessungen 26x26 und 13x13. <br><br>  Nach dem Starten des geladenen CoreML-Modells erhalten wir zwei (oder drei) Objekte der MLMultiArray-Klasse in der Ausgabe.  Wenn Sie sich die Formeigenschaft dieser Objekte ansehen, sehen Sie das folgende Bild (f√ºr YOLOv3-tiny): <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mo stretchy=&quot;false&quot;>[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>26</mn><mo>,</mo><mn>26</mn><mo stretchy=&quot;false&quot;>]</mo><mspace linebreak=&quot;newline&quot; /><mo stretchy=&quot;false&quot;>[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>13</mn><mo>,</mo><mn>13</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="6.033ex" viewBox="0 -832 33095.6 2597.7" role="img" focusable="false" style="vertical-align: -4.101ex; max-width: 638px;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(13126,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-5D" x="6563" y="0"></use></g><g transform="translate(13126,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-5D" x="6563" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mo stretchy="false">[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>26</mn><mo>,</mo><mn>26</mn><mo stretchy="false">]</mo><mspace linebreak="newline"></mspace><mo stretchy="false">[</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>255</mn><mo>,</mo><mn>13</mn><mo>,</mo><mn>13</mn><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> [1, 1, 255, 26, 26] \\ [1, 1, 255, 13, 13] </script></p><br>  Wie erwartet betr√§gt die Dimension der Matrizen 26x26 und 13x13. Aber was bedeutet die Zahl 255?  Wie bereits erw√§hnt, sind die Ausgabeebenen 52 x 52, 26 x 26 und 13 x 13 Matrizen.  Tatsache ist, dass jedes Element dieser Matrix keine Zahl ist, sondern ein Vektor.  Das hei√üt, die Ausgabeschicht ist eine dreidimensionale Matrix.  Dieser Vektor hat die Dimension B x (5 + C), wobei B die Anzahl der Begrenzungsrahmen in der Zelle ist, C die Anzahl der Klassen.  Woher kommt die Nummer 5?  Der Grund ist folgender: F√ºr jede Box-a ist die Wahrscheinlichkeit, dass ein Objekt (Objektvertrauen) vorhergesagt wird, eine Zahl, und die verbleibenden vier sind x, y, Breite und H√∂he f√ºr die vorhergesagte Box-a.  Die folgende Abbildung zeigt eine schematische Darstellung dieses Vektors: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3d/j3/rl/3dj3rlk_te-4x-pthae9mreq7k0.png"></div><br>  <i>Schematische Darstellung der Ausgabeebene (Feature Map).</i> <br><br>  F√ºr unser in 80 Klassen trainiertes Netzwerk werden f√ºr jede Zelle des Partitionsgitters 3 Begrenzungsrahmen a vorhergesagt - 80 Klassenwahrscheinlichkeiten + Objektvertrauen + 4 Zahlen, die f√ºr die Position und Gr√∂√üe dieses Felds a verantwortlich sind.  Gesamt: 3 x (5 + 80) = 255. <br><br>  Um diese Werte aus der MLMultiArray-Klasse abzurufen, ist es besser, einen Rohzeiger auf ein Datenarray und eine Adressarithmetik zu verwenden: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-comment"><span class="hljs-comment">//    if out.strides.count &lt; 3 { throw YOLOError.strideOutOfBounds } let channelStride = out.strides[out.strides.count-3].intValue let yStride = out.strides[out.strides.count-2].intValue let xStride = out.strides[out.strides.count-1].intValue func offset(ch: Int, x: Int, y: Int) -&gt; Int { //     return ch * channelStride + y * yStride + x * xStride }</span></span></code> </pre><br>  Jetzt m√ºssen Sie einen Vektor mit 255 Elementen verarbeiten.  F√ºr jede Box ben√∂tigen Sie eine Wahrscheinlichkeitsverteilung f√ºr 80 Klassen. Dies k√∂nnen Sie mit der Softmax-Funktion tun. <br><br><div class="spoiler">  <b class="spoiler_title">Was ist Softmax?</b> <div class="spoiler_text">  Funktion konvertiert einen Vektor <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mi>x</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.354ex" height="2.074ex" viewBox="0 -772.3 4027.5 892.8" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="3455" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> \ mathbb x </script>  Dimension K in einen Vektor der gleichen Dimension, wobei jede Koordinate <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><msub><mi>x</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.154ex" height="2.349ex" viewBox="0 -772.3 4371.8 1011.3" role="img" focusable="false" aria-hidden="true" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-62" x="3025" y="0"></use><g transform="translate(3455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="809" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>m</mi><mi>a</mi><mi>t</mi><mi>h</mi><mi>b</mi><mi>b</mi><msub><mi>x</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb x_i </script>  Der resultierende Vektor wird durch eine reelle Zahl im Intervall [0,1] dargestellt und die Summe der Koordinaten ist 1. <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;sigma&amp;#xA0;(\&amp;#xA0;mathbb&amp;#xA0;{x})&amp;#xA0;_&amp;#xA0;i&amp;#xA0;=&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{e&amp;#xA0;^&amp;#xA0;{x_i}}&amp;#xA0;{\&amp;#xA0;sum_&amp;#xA0;{k&amp;#xA0;=&amp;#xA0;1}&amp;#xA0;^&amp;#xA0;{K}&amp;#xA0;{e&amp;#xA0;^&amp;#xA0;{x_k}}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;sigma&nbsp;(\&nbsp;mathbb&nbsp;{x})&nbsp;_&nbsp;i&nbsp;=&nbsp;\&nbsp;frac&nbsp;{e&nbsp;^&nbsp;{x_i}}&nbsp;{\&nbsp;sum_&nbsp;{k&nbsp;=&nbsp;1}&nbsp;^&nbsp;{K}&nbsp;{e&nbsp;^&nbsp;{x_k}}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;sigma&nbsp;(\&nbsp;mathbb&nbsp;{x})&nbsp;_&nbsp;i&nbsp;=&nbsp;\&nbsp;frac&nbsp;{e&nbsp;^&nbsp;{x_i}}&nbsp;{\&nbsp;sum_&nbsp;{k&nbsp;=&nbsp;1}&nbsp;^&nbsp;{K}&nbsp;{e&nbsp;^&nbsp;{x_k}}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> \ sigma (\ mathbb {x}) _ i = \ frac {e ^ {x_i}} {\ sum_ {k = 1} ^ {K} {e ^ {x_k}} </script></p>  wobei K die Dimension des Vektors ist. <br></div></div><br>  Softmax-Funktion bei Swift: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">softmax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Float])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> len = vDSP_Length(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> = <span class="hljs-type"><span class="hljs-type">Int32</span></span>(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) vvexpf(&amp;x, x, &amp;<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum: <span class="hljs-type"><span class="hljs-type">Float</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> vDSP_sve(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, len) vDSP_vsdiv(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, &amp;x, <span class="hljs-number"><span class="hljs-number">1</span></span>, len) }</code> </pre><br>  Um die Koordinaten und Gr√∂√üen des Begrenzungsrahmens a zu erhalten, m√ºssen Sie die folgenden Formeln verwenden: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>x</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><msub><mi>c</mi><mi>x</mi></msub><mspace linebreak=&quot;newline&quot; /><mi>y</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mo stretchy=&quot;false&quot;>)</mo><mo>+</mo><msub><mi>c</mi><mi>y</mi></msub><mspace linebreak=&quot;newline&quot; /><mi>w</mi><mo>=</mo><msub><mi>p</mi><mi>w</mi></msub><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>w</mi></mrow></msup><mspace linebreak=&quot;newline&quot; /><mi>h</mi><mo>=</mo><msub><mi>p</mi><mi>h</mi></msub><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>h</mi></mrow></msup></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="13.262ex" viewBox="0 -832 33095.6 5710.1" role="img" focusable="false" style="vertical-align: -11.33ex; max-width: 638px;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(11502,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-3D" x="850" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-73" x="2156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="2626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-67" x="2971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6D" x="3452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="4330" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-28" x="4860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="5499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="6076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="6605" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="6967" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-29" x="7539" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2B" x="8151" y="0"></use><g transform="translate(9152,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="613" y="-213"></use></g></g><g transform="translate(11604,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-3D" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-73" x="2081" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="2551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-67" x="2896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6D" x="3377" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="4255" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-28" x="4785" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="5424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="6001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="6530" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-79" x="6892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-29" x="7389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2B" x="8001" y="0"></use><g transform="translate(9002,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-79" x="613" y="-213"></use></g></g><g transform="translate(13787,-3064)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-3D" x="994" y="0"></use><g transform="translate(2050,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-77" x="712" y="-213"></use></g><g transform="translate(3160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="930" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-77" x="1821" y="0"></use></g></g></g><g transform="translate(13956,-4593)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-3D" x="854" y="0"></use><g transform="translate(1910,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="712" y="-213"></use></g><g transform="translate(2921,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="930" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1459" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="1821" y="0"></use></g></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>x</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>c</mi><mi>x</mi></msub><mspace linebreak="newline"></mspace><mi>y</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><msub><mi>c</mi><mi>y</mi></msub><mspace linebreak="newline"></mspace><mi>w</mi><mo>=</mo><msub><mi>p</mi><mi>w</mi></msub><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>w</mi></mrow></msup><mspace linebreak="newline"></mspace><mi>h</mi><mo>=</mo><msub><mi>p</mi><mi>h</mi></msub><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>h</mi></mrow></msup></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> x = \ sigma (\ hat x) + c_x \\ y = \ sigma (\ hat y) + c_y \\ w = p_we ^ {\ hat w} \\ h = p_he ^ {\ hat h} </script></p><br>  wo <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>x</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>w</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>h</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="24.546ex" height="2.419ex" viewBox="0 -780.1 10568.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1356" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="1717" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="2290" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="2985" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="3561" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="4091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-79" x="4452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="4950" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="5645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="6221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="6751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-77" x="7112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="7829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="8524" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="9101" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="9630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="9992" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>x</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>y</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>w</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>h</mi><mi>a</mi><mi>t</mi><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ hat x, \ hat y, \ hat w, \ hat h </script>  - vorhergesagte x-, y-Koordinaten, Breite bzw. H√∂he <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.999ex" height="2.66ex" viewBox="0 -832 4305 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="3343" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-29" x="3915" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-7"> \ sigma (x) </script>  Ist die Sigmoidfunktion und <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>w</mi></msub><mo>,</mo><msub><mi>p</mi><mi>h</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.05ex" height="1.817ex" viewBox="-38.5 -520.7 2605 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-77" x="712" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-2C" x="1110" y="0"></use><g transform="translate(1555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="712" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>w</mi></msub><mo>,</mo><msub><mi>p</mi><mi>h</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-8"> p_w, p_h </script>  - Werte von Ankern (Ankern) f√ºr drei Kisten.  Diese Werte werden w√§hrend des Trainings ermittelt und in der Datei Helpers.swift festgelegt: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> anchors1: [<span class="hljs-type"><span class="hljs-type">Float</span></span>] = [<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">198</span></span>, <span class="hljs-number"><span class="hljs-number">373</span></span>,<span class="hljs-number"><span class="hljs-number">326</span></span>] <span class="hljs-comment"><span class="hljs-comment">//     let anchors2: [Float] = [30,61, 62,45, 59,119] //     let anchors3: [Float] = [10,13, 16,30, 33,23] //    </span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/zf/pv/ngzfpvvch8bhnkdapz6url5ok-w.png"></div><br>  <i>Schematische Darstellung der Berechnung der Position eines Begrenzungsrahmens.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Vollst√§ndiger Code f√ºr die Verarbeitung von Ausgabeebenen.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(output out: MLMultiArray, name: String)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> predictions = [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>]() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> grid = out.shape[out.shape.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gridSize = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.inputSize / <span class="hljs-type"><span class="hljs-type">Float</span></span>(grid) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> classesCount = labels.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(out.shape) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.strideOutOfBounds } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> channelStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">3</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> yStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ch: Int, x: Int, y: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch * channelStride + y * yStride + x * xStride } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> box_i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.boxesPerCell { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boxOffset = box_i * (classesCount + <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbx = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bby = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">1</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbw = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">2</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbh = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">3</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidence = sigmoid(<span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">4</span></span>, x: x, y: y)])) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidence &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x_pos = (sigmoid(bbx) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(x)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y_pos = (sigmoid(bby) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(y)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> width = exp(bbw) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = exp(bbh) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i + <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-number"><span class="hljs-number">80</span></span> { classes[<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>] = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, x: x, y: y)]) } softmax(&amp;classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (detectedClass, bestClassScore) = argmax(classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidenceInClass = bestClassScore * confidence <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidenceInClass &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } predictions.append(<span class="hljs-type"><span class="hljs-type">Prediction</span></span>(classIndex: detectedClass, score: confidenceInClass, rect: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(x_pos - width / <span class="hljs-number"><span class="hljs-number">2</span></span>), y: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(y_pos - height / <span class="hljs-number"><span class="hljs-number">2</span></span>), width: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(width), height: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(height)))) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> predictions }</code> </pre><br></div></div><br>  <b>Nicht maximale Unterdr√ºckung</b> <br><br>  Sobald Sie die Koordinaten und Gr√∂√üen der Begrenzungsrahmen und die entsprechenden Wahrscheinlichkeiten f√ºr alle im Bild gefundenen Objekte erhalten haben, k√∂nnen Sie beginnen, sie √ºber das Bild zu zeichnen.  Aber es gibt ein Problem!  Eine solche Situation kann auftreten, wenn f√ºr ein Objekt mehrere Boxen mit ziemlich hohen Wahrscheinlichkeiten vorhergesagt werden.  Was ist in diesem Fall zu tun?  Hier hilft uns ein ziemlich einfacher Algorithmus namens Nicht maximale Unterdr√ºckung. <br><br>  Der Algorithmus ist wie folgt: <br><br><ol><li>  Wir suchen einen Begrenzungsrahmen mit der h√∂chsten Wahrscheinlichkeit, zum Objekt zu geh√∂ren. </li><li>  Wir durchlaufen alle Begrenzungsrahmen, die ebenfalls zu diesem Objekt geh√∂ren. </li><li>  Wir l√∂schen sie, wenn Intersection over Union (IoU) mit dem ersten Begrenzungsrahmen gr√∂√üer als der angegebene Schwellenwert ist. </li></ol><br>  IoU wird nach einer einfachen Formel berechnet: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>I</mi><mi>o</mi><mi>U</mi></mrow><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>S</mi><mi>c</mi><mi>h</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>n</mi><mi>k</mi><mi>t</mi></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>A</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>z</mi><mi>i</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="60.799ex" height="2.419ex" viewBox="0 -780.1 26177.1 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6F" x="504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-55" x="990" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMAIN-3D" x="4047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-66" x="5353" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-72" x="5904" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="6355" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-63" x="6885" y="0"></use><g transform="translate(7318,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-63" x="645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="1079" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6E" x="1655" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="2256" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="2601" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="2963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-70" x="3324" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-75" x="3828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6E" x="4400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6B" x="5001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="5522" y="0"></use></g></g><g transform="translate(15214,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-41" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-73" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-73" x="1220" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6F" x="1689" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-7A" x="2175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="2643" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-61" x="2989" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-74" x="3518" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="3880" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6F" x="4225" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-6E" x="4711" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-73" x="5311" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-62" x="5781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="6210" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-72" x="6677" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-65" x="7128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-69" x="7595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-63" x="7940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhhIBnDd_JogIqG5OKv8axjAWdguBw#MJMATHI-68" x="8374" y="0"></use></g></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>I</mi><mi>o</mi><mi>U</mi></mrow><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>S</mi><mi>c</mi><mi>h</mi><mi>n</mi><mi>i</mi><mi>t</mi><mi>t</mi><mi>p</mi><mi>u</mi><mi>n</mi><mi>k</mi><mi>t</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>t</mi><mi>e</mi><mi>x</mi><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><mi>A</mi><mi>s</mi><mi>s</mi><mi>o</mi><mi>z</mi><mi>i</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>e</mi><mi>i</mi><mi>c</mi><mi>h</mi></mrow></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> \ text {IoU} = \ frac {\ text {Schnittpunkt}} {\ text {Assoziationsbereich}} </script></p><div class="spoiler">  <b class="spoiler_title">Berechnung der IoU.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IOU</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: CGRect, b: CGRect)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Float</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaA = a.width * a.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaA &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaB = b.width * b.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaB &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersection = a.intersection(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersectionArea = intersection.width * intersection.height <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Float</span></span>(intersectionArea / (areaA + areaB - intersectionArea)) }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Nicht maximale Unterdr√ºckung.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonMaxSuppression</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(boxes: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Prediction], threshold: Float)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> i &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> j &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> iou = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.<span class="hljs-type"><span class="hljs-type">IOU</span></span>(a: boxes[i].rect, b: boxes[j].rect) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> iou &gt; threshold { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].score &gt; boxes[j].score { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: j) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: i) j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } i += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre><br></div></div><br>  Danach kann die direkte Arbeit mit den Ergebnissen der Vorhersage des neuronalen Netzwerks als abgeschlossen betrachtet werden.  Als N√§chstes m√ºssen Sie Funktionen und Klassen schreiben, um das Filmmaterial von der Kamera abzurufen, das Bild auf dem Bildschirm anzuzeigen und die vorhergesagten Begrenzungsrahmen zu rendern.  Ich werde diesen Code nicht in diesem Artikel beschreiben, aber er kann im Repository angezeigt werden. <br><br>  Erw√§hnenswert ist auch, dass ich bei der Verarbeitung von Online-Bildern eine kleine Gl√§ttung der Begrenzungsrahmen hinzugef√ºgt habe. In diesem Fall handelt es sich um die √ºbliche Mittelung der Position und Gr√∂√üe des vorhergesagten Quadrats √ºber die letzten 30 Bilder. <br><br><h4>  Programm testen </h4><br>  Jetzt testen wir die Anwendung. <br><br>  Ich m√∂chte Sie noch einmal daran erinnern: Die Anwendung enth√§lt drei ViewController, einen zum Verarbeiten von Fotos oder Schnappsch√ºssen, einen zum Verarbeiten eines Online-Videostreams und einen dritten zum Einrichten des Netzwerks. <br><br>  Beginnen wir mit dem dritten.  Darin k√∂nnen Sie eines von zwei Modellen YOLOv3-tiny oder YOLOv3-416 ausw√§hlen, den Vertrauensschwellenwert und den IoU-Schwellenwert ausw√§hlen und das Online-Anti-Aliasing aktivieren oder deaktivieren. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/zq/tz/sbzqtzy6hai51objkormfzvtbuq.jpeg"></div><br>  Nun wollen wir sehen, wie das trainierte Neuron mit realen Bildern arbeitet. Dazu machen wir ein Foto aus der Galerie und leiten es durch das Netzwerk.  Das Bild unten zeigt die Ergebnisse von YOLOv3-tiny mit unterschiedlichen Einstellungen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/j3/fj/nrj3fjpw0yvxgl2cigujbcb-1p4.png"></div><br>  <i>Verschiedene Betriebsarten von YOLOv3-tiny.</i>  <i>Das linke Bild zeigt die √ºbliche Betriebsart.</i>  <i>In der Mitte - der Schwellenwert IoU = 1, d.h.</i>  <i>als ob die Nicht-Max-Unterdr√ºckung fehlt.</i>  <i>Rechts ist eine niedrige Schwelle des Objektvertrauens, d.h.</i>  <i>Alle m√∂glichen Begrenzungsrahmen werden angezeigt.</i> <br><br>  Das Folgende ist das Ergebnis von YOLOv3-416.  M√∂glicherweise stellen Sie fest, dass im Vergleich zu YOLOv3-tiny die resultierenden Frames korrekter sind und kleinere Objekte im Bild erkannt werden, was der Arbeit der dritten Ausgabeebene entspricht. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/nj/xq/wcnjxqeygnuriffqpatmtvevyfo.png"></div><br>  <i>Bildverarbeitung mit YOLOv3-416.</i> <br><br>  Wenn der Online-Betriebsmodus aktiviert war, wurde jeder Frame verarbeitet und eine Vorhersage daf√ºr gemacht. Es wurden <b>Tests auf dem iPhone XS durchgef√ºhrt,</b> sodass das Ergebnis f√ºr beide Netzwerkoptionen durchaus akzeptabel war.  <b>YOLOv3-tiny erzeugt durchschnittlich 30 - 32 fps, YOLOv3-416 - 23 bis 25 fps.</b>  Das Ger√§t, auf dem es getestet wurde, ist sehr produktiv, daher k√∂nnen die Ergebnisse bei fr√ºheren Modellen abweichen. In diesem Fall ist es nat√ºrlich vorzuziehen, YOLOv3-tiny zu verwenden.  Ein weiterer wichtiger Punkt: yolo-tiny.mlmodel (YOLOv3-tiny) ben√∂tigt ungef√§hr 35 MB, w√§hrend yolo.mlmodel (YOLOv3 -16) ungef√§hr 250 MB wiegt, was einen sehr signifikanten Unterschied darstellt. <br><br><h2>  Fazit </h2><br>  Als Ergebnis wurde eine iOS-Anwendung geschrieben, die mit Hilfe eines neuronalen Netzwerks Objekte im Bild erkennen kann.  Wir haben gesehen, wie man mit der CoreML-Bibliothek arbeitet und wie man damit verschiedene vorab trainierte Modelle ausf√ºhrt (man kann √ºbrigens auch damit trainieren).  Das Objekterkennungsproblem wurde mithilfe des YOLOv3-Netzwerks gel√∂st.  Auf dem iPhone XS kann dieses Netzwerk (YOLOv3-tiny) Bilder mit einer Frequenz von ~ 30 Bildern pro Sekunde verarbeiten, was f√ºr den Echtzeitbetrieb v√∂llig ausreicht. <br><br>  Der vollst√§ndige Anwendungscode kann auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> angezeigt werden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de460869/">https://habr.com/ru/post/de460869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de460859/index.html">IThink # 3 Konferenz in Kharkov - basierend auf WWDC 2019</a></li>
<li><a href="../de460861/index.html">JavaScript lexikalischer Umfang und Abschluss</a></li>
<li><a href="../de460863/index.html">Details zum Cloudflare-Absturz 2. Juli 2019</a></li>
<li><a href="../de460865/index.html">Menschen auf dem Mond. Quellen</a></li>
<li><a href="../de460867/index.html">Sourcery zur automatischen Konvertierung in Realm-Objektstrukturen</a></li>
<li><a href="../de460873/index.html">Warum Turok: Dinosaur Hunter f√ºr N64 seiner Zeit um Jahre voraus ist</a></li>
<li><a href="../de460875/index.html">Wie wir bei QIWI zu einem gemeinsamen Interaktionsstil zwischen View und ViewModel innerhalb von MVVM gekommen sind</a></li>
<li><a href="../de460877/index.html">Kubernetes-Adventure Dailymotion: Aufbau einer Infrastruktur in den Clouds + vor Ort</a></li>
<li><a href="../de460879/index.html">DUMP Kazan 2019 - Tatarstan Entwicklerkonferenz. Wir akzeptieren Bewerbungen f√ºr Berichte</a></li>
<li><a href="../de460881/index.html">Schwierigkeiten bei der Anwendung von OCR-Technologien in DLP-Systemen oder wie wir OCR vorbereiten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>