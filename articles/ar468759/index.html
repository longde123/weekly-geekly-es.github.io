<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ง โบ๏ธ ๐ฎ ุญูู [[trivial_abi]] ูู ููุงูุฌ ๐ฉ๐ผโ๐ฌ ๐ฉโ๐ฉโ๐ง ๐ค๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฃุฎูุฑูุง ุ ูุชุจุช ููุดูุฑูุง ุนู [[trivial_abi]]! 

 ูุฐู ููุฒุฉ ุฎุงุตุฉ ุฌุฏูุฏุฉ ูู Clang trunk ุ ุฌุฏูุฏุฉ ุงุนุชุจุงุฑูุง ูู ูุจุฑุงูุฑ 2018. ูุฐุง ููุญู ุจุงุฆุน ููุบุฉ C ++ ุ ููู ููุณ C +...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุญูู [[trivial_abi]] ูู ููุงูุฌ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468759/" style=";text-align:right;direction:rtl">  ุฃุฎูุฑูุง ุ ูุชุจุช ููุดูุฑูุง ุนู [[trivial_abi]]! <br><br>  ูุฐู ููุฒุฉ ุฎุงุตุฉ ุฌุฏูุฏุฉ ูู Clang trunk ุ ุฌุฏูุฏุฉ ุงุนุชุจุงุฑูุง ูู ูุจุฑุงูุฑ 2018. ูุฐุง ููุญู ุจุงุฆุน ููุบุฉ C ++ ุ ููู ููุณ C ++ ููุงุณู ุ ููู ุบูุฑ ูุฏุนูู ูู ุตูุฏูู ุงูุฎููุฌ ุ ููุง ุชูุฌุฏ ุงูุชุฑุงุญุงุช ูุดุทุฉ ูู WG21 ูุฅุฏุฑุงุฌูุง ูู ูุนูุงุฑ C ++ ุ ุนูู ุญุฏ ุนููู. <br><br><img src="https://habrastorage.org/webt/ie/do/9e/iedo9ep8gzdeliscehwljy0clnq.jpeg"><br><br>  ูู ุฃุดุงุฑู ูู ุชูููุฐ ูุฐู ุงูููุฒุฉ.  ููุฏ ุฃูููุช ูุธุฑุฉ ุนูู ุงูุชุตุญูุญุงุช ุงูููุฌูุฏุฉ ูู ุงููุงุฆูุฉ ุงูุจุฑูุฏูุฉ ูู cfe-commits ูุฃุดุงุฏุช ุจุตูุช ุจููุณู.  ููู ูุฐู ููุฒุฉ ุฑุงุฆุนุฉ ุฃุนุชูุฏ ุฃูู ูุฌุจ ุนูู ุงูุฌููุน ูุนุฑูุชูุง. <br><a name="habracut"></a><br>  ูุฐูู ุ ุฃูู ูุง ุณูุจุฏุฃ ุจู: ูุฐู ููุณุช ุณูุฉ ููุงุณูุฉ ุ ููุง ูุฏุนู ุฌุฐุน Clang ุงูุฅููุงุก ุงูููุงุณู ููุณูุฉ [[trivial_abi]] ูู ุฃุฌููุง.  ุจุฏูุงู ูู ุฐูู ุ ูุฌุจ ุนููู ูุชุงุจุชูุง ุจุงูุฃุณููุจ ุงููุฏูู ุ ููุง ูู ููุถุญ ุฃุฏูุงู: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs">__attribute__((trivial_abi)) __attribute__((__trivial_abi__)) [[clang::trivial_abi]]</code> </pre> <br>  ููุธุฑูุง ูุฃู ูุฐู ุณูุฉ ุ ูุฅู ุงููุญูู ุงูุจุฑูุฌู ูููู ุตุนุจ ุงูุฅุฑุถุงุก ุฌุฏูุง ุญูู ุงูููุงู ุงูุฐู ุชููู ุจูุตูู ุ ูุงูุตูุช ุจุดูู ุณูุจู ุจููุฉ ุฅุฐุง ููุช ุจูุตูู ูู ุงูููุงู ุงูุฎุทุฃ (ุญูุซ ูุชู ุชุฌุงูู ุงูุณูุงุช ุบูุฑ ุงููุนุชุฑู ุจูุง ุจุจุณุงุทุฉ ุฏูู ุฑุณุงุฆู).  ูุฐุง ููุณ ุฎุทุฃ ุ ูุฐู ููุฒุฉ.  ุจูุงุก ุงูุฌููุฉ ุงูุตุญูุญ ูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TRIVIAL_ABI __attribute__((trivial_abi)) class TRIVIAL_ABI Widget { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// ... };</span></span></span></span></code> </pre> <br><br><h3 style=";text-align:right;direction:rtl">  ูุง ุงููุดููุฉ ูู ูุฐุง ุญูุ </h3><br><br>  ุฃุชุฐูุฑ ูุดุงุฑูุชู ุจุชุงุฑูุฎ 04/17/2018 ุญูุซ ุนุฑุถุช ูุณุฎุชูู ูู ุงููุตูุ <br><br><blockquote style=";text-align:right;direction:rtl">  ุชูุฑูุจุง.  perev: ูุธุฑูุง ูุฃู ููุดูุฑ 4/17/2018 ูุญุชูู ุนูู ุญุฌู ุตุบูุฑ ุ ูู ุฃูู ุจูุดุฑู ุจุดูู ูููุตู ุ ููููู ุฃุฏุฑุฌุชู ููุง ุฃุณูู ุงูููุณุฏ. <br></blockquote><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุธููุฉ ูู 04/17/2018</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><h3 style=";text-align:right;direction:rtl">  ุนููุจ ุงูููููุฏูู ุชุงููุฉ ูุฏุงุก ุงููุฏูุฑุฉ </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฑุงุฌุน ูุงุฆูุฉ ุงููุฑุงุณูุงุช ุงูููุชุฑุญุฉ ูู C ++.</a>  ุฃู ูู ุงููุธููุชูู ุ foo ุฃู bar ุ ุณุชุญุตู ุนูู ุฃูุถู ุฑูุฒ ุชู ุฅูุดุงุคู ุจูุงุณุทุฉ ุงููุชุฑุฌูุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value; ~Integer() {} <span class="hljs-comment"><span class="hljs-comment">// deliberately non-trivial }; void foo(std::vector&lt;int&gt;&amp; v) { v.back() *= 0xDEADBEEF; v.pop_back(); } void bar(std::vector&lt;Integer&gt;&amp; v) { v.back().value *= 0xDEADBEEF; v.pop_back(); }</span></span></code> </pre><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฑุฌูุฉ</a> ูุน GCC ู libstdc ++.  ุชุฎููู ุตุญูุญุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">foo: movq <span class="hljs-number"><span class="hljs-number">8</span></span>(%rdi), %rax imull $<span class="hljs-number"><span class="hljs-number">-559038737</span></span>, <span class="hljs-number"><span class="hljs-number">-4</span></span>(%rax), %edx subq $<span class="hljs-number"><span class="hljs-number">4</span></span>, %rax movl %edx, (%rax) movq %rax, <span class="hljs-number"><span class="hljs-number">8</span></span>(%rdi) ret bar: subq $<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>(%rdi) ret</code> </pre> <br><br>  ุฅููู ูุง ูุญุฏุซ ููุง: ุชุชูุชุน ุฏูู ูุฌูุณ ุงูุชุนุงูู ุงูุฎููุฌู ุจุฐูุงุก ูุงูู ูููู ุฃูู ุนูุฏ ุจุฏุก ุชุดุบูู ุฃุฏุงุฉ ุชุฏููุฑ ูููุทูุฉ ุงูุฐุงูุฑุฉ ุ ููุชูู ุนูุฑูุง ุ ูุชููู ุฌููุน ุงูุฅุฏุฎุงูุงุช ุงูุณุงุจูุฉ ุฅูู ููุทูุฉ ุงูุฐุงูุฑุฉ ูุฐู "ููุชุฉ".  ููู ุฏูู ูุฌูุณ ุงูุชุนุงูู ุงูุฎููุฌู ุฃูุถูุง ุฐููุฉ ุจูุง ูููู ูููู ุฃู ุงููุฏูุฑ ุงูุชุงูู (ูุซู ุงููุฏูุฑ ุงูุฒุงุฆู ~ int ()) ูุง ููุนู ุดูุฆูุง ููุง ููุชุฌ ุฃู ุขุซุงุฑ. <br><br>  ูุฐูู ุ ุชุณุชุฏุนู ุงูุฏุงูุฉ ุงูุดุฑูุท pop_back ุ ุงูุฐู ูุนูู ~ Integer () ุ ููุง ูุฌุนู vec.back () ููุชูุง ุ ููุฒูู GCC ุงูุถุฑุจ ุชูุงููุง ุจูุงุณุทุฉ 0xDEADBEEF. <br><br>  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูุฅู foo ุชุณุชุฏุนู pop_back ุ ุงูุชู ุชุทูู ~ int () ุงููุฏูุฑุฉ ุงูุฒุงุฆูุฉ (ูููููุง ุชุฎุทู ุงูููุงููุฉ ุจุงููุงูู ุ ููู ูุง ุชูุนู ุฐูู) ุ ุชุฑู ุฏูู ูุฌูุณ ุงูุชุนุงูู ุงูุฎููุฌู ุฃููุง ูุงุฑุบุฉ ูุชูุณู.  ูุฐูู ุ ูุง ูุฑู GCC ุฃู vec.back () ููุช ููุง ูุฒูู ุงูุถุฑุจ ุจูุงุณุทุฉ 0xDEADBEEF. <br><br>  ูุญุฏุซ ูุฐุง ููุฏูุฑุฉ ุชุงููุฉ ุ ูููู ููุณ ููุฏูุฑุฉ ุฒุงุฆูุฉ ูุซู ~ int ().  ุงุณุชุจุฏุงู ~ Integer () {} ุจู ~ Integer () = ุงูุชุฑุงุถู ุ  ูุงูุธุฑ ููู ุธูุฑ ุงูุชุนููู ุงูุฎุงุทุฆ ูุฑุฉ ุฃุฎุฑู! <br></div></div><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value; ~Foo() = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>; <span class="hljs-comment"><span class="hljs-comment">// trivial }; struct Bar { int value; ~Bar() {} // deliberately non-trivial };</span></span></code> </pre> <br>  ูู ูุฐุง ุงูููุดูุฑ ุ ูุชู ุฅุนุทุงุก ุงูููุฏ ุงูุฐู ูุงู ููู ุงููุชุฑุฌู ุจุฅูุดุงุก ููุฏ ูู Foo ุฃุณูุฃ ูู Bar.  ูุฌุฏุฑ ููุงูุดุฉ ุณุจุจ ูุฐุง ุงูุฃูุฑ ุบูุฑ ูุชููุน.  ูุชููุน ุงููุจุฑูุฌูู ุจุดูู ุญุฏุณู ุฃู ุชููู ุงูุดูุฑุฉ "ุงูุชุงููุฉ" ุฃูุถู ูู ุงูุดูุฑุฉ "ุบูุฑ ุงูุชุงููุฉ".  ูุฐุง ูู ุงูุญุงู ูู ูุนุธู ุงูุญุงูุงุช.  ุนูู ูุฌู ุงูุฎุตูุต ุ ูุฐุง ูู ุงูุญุงู ุนูุฏ ุฅุฌุฑุงุก ููุงููุฉ ุฏุงูุฉ ุฃู ุงูุนูุฏุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">incr</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">) {</span></span> obj.value += <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj; }</code> </pre> <br>  incr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">compiles</a> ุฅูู ุงูุชุนูููุฉ ุงูุจุฑูุฌูุฉ ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">leal <span class="hljs-number"><span class="hljs-number">1</span></span>(%rdi), %eax retq</code> </pre> <br>  (leal ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฃูุฑ</a> x86 ุงูุฐู ูุนูู "add.") ูุฑู ุฃู obj ุงููููู ูู 4 ุจุงูุช ูุชู ุชูุฑูุฑู ุฅูู incr ูู ุณุฌููช edi ุ ููุถูู 1 ุฅูู ูููุชู ููุนูุฏู ุฅูููช eax.  ุฃุฑุจุน ุจุงูุช ูู ุงูุฅุฏุฎุงู ุ ุฃุฑุจุนุฉ ุจุงูุช ูู ุงูุฅุฎุฑุงุฌ ุ ุณููุฉ ูุจุณูุทุฉ. <br><br>  ุงูุขู ุฏุนูุง ููุธุฑ ุฅูู incr (ุงูุญุงูุฉ ูุน ูุฏูุฑุฉ ุบูุฑ ุชุงููุฉ). <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">movl (%rsi), %eax addl $<span class="hljs-number"><span class="hljs-number">1</span></span>, %eax movl %eax, (%rsi) movl %eax, (%rdi) movq %rdi, %rax retq</code> </pre> <br>  ููุง ุ ูุง ูุชู ุชูุฑูุฑ obj ูู ุงูุณุฌู ุ ุนูู ุงูุฑุบู ูู ุญูููุฉ ุฃูู ููุง ููุณ 4 ุจุงูุช ูุน ููุณ ุฏูุงูุงุช.  ููุง ูุชู ุชูุฑูุฑ obj ูุฅุนุงุฏุชู ุฅูู ุงูุนููุงู.  ููุง ุงููุชุตู ูุญุชูุธ ุจุจุนุถ ุงููุณุงุญุฉ ููููุฉ ุงูุฅุฑุฌุงุน ูููุฑุฑ ููุง ูุคุดุฑูุง ุฅูู ูุฐู ุงููุณุงุญุฉ ุจุงูู rdi ุ ููุนุทููุง ุงููุชุตู ูุคุดุฑูุง ููููุฉ ุงูุฅุฑุฌุงุน obj ูู ุงูุณุฌู ุงูุชุงูู ูููุณุงุฆุทูช rsi.  ูููู ุจุงุณุชุฎุฑุงุฌ ุงููููุฉ ูู (ูช rsi) ุ ูุถูู 1 ุ ููุญูุธูุง ูุฑุฉ ุฃุฎุฑู ุฅูู (ูช rsi) ูุชุญุฏูุซ ูููุฉ obj ููุณูุง ุ ุซู (ุชุงููุฉ) ูุณุฎ 4 ุจุงูุช ูู obj ุฅูู ุงููุชุญุฉ ููุญุตูู ุนูู ูููุฉ ุงูุฅุฑุฌุงุน ุงููุดุงุฑ ุฅูููุง ุจูุงุณุทุฉูช rdi.  ุฃุฎูุฑูุง ุ ูููู ุจูุณุฎ ุงููุคุดุฑ ุงูุฃุตูู ุงูุฐู ุชู ุชูุฑูุฑู ุจูุงุณุทุฉ ุงููุชุตู ูููช rdi ุฅูููช rax ุ ูุธุฑูุง ูุฃู ูุณุชูุฏ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ABI x86-64</a> (ุงูุตูุญุฉ 22) ูุฎุจุฑูุง ุจุฐูู. <br><br>  ุงูุณุจุจ ูู ุฃู Bar ูุฎุชูู ุชูุงููุง ุนู Foo ูุฃู Bar ูุฏูู ูุฏูุฑ ุบูุฑ ุจุฏููู ุ ูููุต <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">x 86-64 ABI</a> (ุงูุตูุญุฉ 19) ุนูู ูุฌู ุงูุชุญุฏูุฏ: <br><br><blockquote style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุงุฆู C ++ ูู ูููุดุฆ ูุณุฎุฉ ุบูุฑ ุจุฏููู ุฃู ููุฏููุฑ ุบูุฑ ุชุงูู ุ ูุชู ุชูุฑูุฑู ุนุจุฑ ุงุฑุชุจุงุท ุบูุฑ ูุฑุฆู (ูุชู ุงุณุชุจุฏุงู ุงููุงุฆู ุจูุคุดุฑ [...] ูู ูุงุฆูุฉ ุงููุนููุงุช) </blockquote><br>  ุชุนุฑูู ูุซููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Itanium C ++ ABI</a> ุงูุฃุญุฏุซ ูุง ููู: <br><blockquote style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ููุน ุงููุนููุฉ ุบูุฑ ุจุฏููู ูุบุฑุถ ุงูููุงููุฉ ุ ูุฌุจ ุนูู ุงููุชุตู ุชุฎุตูุต ููุงู ูุคูุช ูุชูุฑูุฑ ุฑุงุจุท ุฅูู ูุฐุง ุงูููุงู ุงููุคูุช: <br>  [...] <br>  ูุนุชุจุฑ ุงูููุน ุบูุฑ ุถุฑูุฑู ูุบุฑุถ ุงูุงุชุตุงู ุฅุฐุง: <br><br>  ุฃูู ูุญุชูู ุนูู ูููุดุฆ ูุณุฎ ุบูุฑ ุจุฏููู ุ ุฃู ูููุดุฆ ูุชุญุฑู ุ ุฃู ููุฏูููุฑ ุ ุฃู ูุชู ุญุฐู ูู ูููุดุฆุงุช ุงูููู ูุงููุณุฎ ุงูุฎุงุตุฉ ุจู. </blockquote><br>  ููุฐุง ูุง ููุณุฑ ูู ุดูุก: ุดุฑูุท ูุฏูู ุชูููุฏ ุฑูุฒ ุงููููุฑุฉ ูุฃูู ูุชู ุชูุฑูุฑู ูู ุฎูุงู ุฑุงุจุท ุบูุฑ ูุฑุฆู.  ูุชู ุฅุฑุณุงูู ุนุจุฑ ุงุฑุชุจุงุท ุบูุฑ ูุฑุฆู ููุฐ ุญุฏูุซ ูุฌููุนุฉ ุบูุฑ ูุญุธูุธุฉ ูู ุญุงูุชูู ูุณุชููุชูู: <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชููู ูุซููุฉ ABI ุฅู ุงููุงุฆูุงุช ุฐุงุช ุงูุชุฏููุฑ ุบูุฑ ุงูุชุงูู ูุชู ุชูุฑูุฑูุง ุนุจุฑ ุฑูุงุจุท ุบูุฑ ูุฑุฆูุฉ </li><li style=";text-align:right;direction:rtl">  ุดุฑูุท ูุฏูู ุงููุฏูุฑุฉ ุบูุฑ ุชุงููุฉ. </li></ul><br>  ูุฐุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุฌ</a> ููุงุณููู: ุงูููุทุฉ ุงูุฃููู ูู ุงููุฑุถูุฉ ุงูุฑุฆูุณูุฉ ุ ูุงูุซุงููุฉ ุฎุงุตุฉ.  ูุชูุฌุฉ ูุฐูู ุ ูุชู ุฅุฑุณุงู ุดุฑูุท ุนุจุฑ ุฑุงุจุท ุบูุฑ ูุฑุฆู. <br><br>  ุฏุน ุดุฎุตูุง ูุนุทููุง ูุฎุทุทูุง ููุธููุง <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุงููุงุณ ูููุช </li><li style=";text-align:right;direction:rtl">  ุณูุฑุงุท ุฑุฌู. </li><li style=";text-align:right;direction:rtl">  ูุจุงูุชุงูู ุ ูุฅู ุณูุฑุงุท ูููุช. </li></ul><br><br>  ุฅุฐุง ููุง ูุฑูุฏ ุฏุญุถ ุงูุงุณุชูุชุงุฌ "ุณูุฑุงุท ูููุช" ุ ููุฌุจ ุนูููุง ุฏุญุถ ุฃุญุฏ ุงููุจุงูู: ุฅูุง ูุฏุญุถ ุงูุดูุก ุงูุฑุฆูุณู (ุฑุจูุง ุจุนุถ ุงููุงุณ ููุณูุง ุจุดุฑ) ุ ุฃู ูุฏุญุถ ุงููุทุงุน ุงูุฎุงุต (ุฑุจูุง ุณูุฑุงุท ููุณ ุดุฎุตูุง). <br><br>  ููู ูุชู ุชูุฑูุฑ Bar ูู ุณุฌู (ูุซู Foo) ุ ูุฌุจ ุฃู ูููุฏ ุฃุญุฏ ุงูููุฑุชูู.  ูุณุงุฑ C ++ ุงูููุงุณู ูู ุฅุนุทุงุก Bar ูุฏูุฑุฉ ุชุงููุฉ ุ ูุชุฏููุฑ ุงููุฑุถูุฉ ุงูุฎุงุตุฉ.  ูููู ููุงู ุทุฑููุฉ ุฃุฎุฑู! <br><br><h3 style=";text-align:right;direction:rtl">  ููู [[trivial_abi]] ูุญู ุงููุดููุฉ </h3><br>  ุณูุฉ ููุงูุฌ ุงูุฌุฏูุฏุฉ ุชุฏูุฑ ุงููุฑุถูุฉ ุงูุฑุฆูุณูุฉ.  ููุชุฏ Clang ูุณุชูุฏ ABI ููุง ููู: <br><blockquote style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ููุน ุงููุนููุฉ ุบูุฑ ุจุฏููู ูุบุฑุถ ุงูููุงููุฉ ุ ูุฌุจ ุนูู ุงููุชุตู ุชุฎุตูุต ููุงู ูุคูุช ูุชูุฑูุฑ ุฑุงุจุท ุฅูู ูุฐุง ุงูููุงู ุงููุคูุช: <br>  [...] <br>  ููุนุชุจุฑ ุงูููุน ุบูุฑ ุถุฑูุฑู ูุบุฑุถ ุงูููุงููุฉ ุฅุฐุง ุชู ูุถุน ุนูุงูุฉ ุนููู [[trivial_abi]] ู: <br>  ุฃูู ูุญุชูู ุนูู ูููุดุฆ ูุณุฎ ุบูุฑ ุจุฏููู ุ ุฃู ูููุดุฆ ูุชุญุฑู ุ ุฃู ููุฏูููุฑ ุ ุฃู ูุชู ุญุฐู ูู ูููุดุฆุงุช ุงูููู ูุงููุณุฎ ุงูุฎุงุตุฉ ุจู. <br></blockquote><br>  ุญุชู ูู ูุงูุช ุงููุฆุฉ ุฐุงุช ุงูููุดุฆ ุงููุชุญุฑู ุบูุฑ ุงููุฏุฑูุณ ุฃู ุงููุฏูุฑ ูููู ุงุนุชุจุงุฑูุง ุชุงููุฉ ูุบุฑุถ ุงูููุงููุฉ ุ ุฅุฐุง ุชู ุชุนููููุง ุนูู ุฃููุง [[trivial_abi]]. <br><br>  ุญุชู ุงูุขู ุ ุจุงุณุชุฎุฏุงู Clang ุ ูููููุง ูุชุงุจุฉ ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TRIVIAL_ABI __attribute__((trivial_abi)) struct TRIVIAL_ABI Baz { int value; ~Baz() {} </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// deliberately non-trivial };</span></span></span></span></code> </pre> <br>  ุชุฑุฌูุฉ incr &lt;Baz&gt; ุ ูุงุญุตู ุนูู ููุณ ุงูุฑูุฒ ูู incr &lt;Foo&gt;! <br><h3 style=";text-align:right;direction:rtl">  ุชุญุฐูุฑ ุฑูู 1: [[trivial_abi]] ูู ุจุนุถ ุงูุฃุญูุงู ูุง ููุนู ุดูุฆูุง </h3><br>  ุขูู ุฃู ูุชููู ูู ุชุตููุน ุฃุบููุฉ "ุชุงููุฉ ูุฃุบุฑุงุถ ุงูุงุชุตุงู" ุนูู ุฃููุงุน ุงูููุชุจุงุช ุงูููุงุณูุฉ ุ ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">D</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRIVIAL_ABI</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trivial_unique_ptr</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;T, D&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;T, D&gt;::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>; };</code> </pre> <br>  ููุฃุณู ุ ูุฐุง ูุง ูุนูู.  ุฅุฐุง ูุงู ูุฏู ุตูู ุฃู ูุฆุฉ ุฃุณุงุณูุฉ ุฃู ุญููู ุบูุฑ ุซุงุจุชุฉ "ุบูุฑ ุชุงููุฉ ูุบุฑุถ ุงูุงุณุชุฏุนุงุก" ุ ูุฅู ุงูุชุฏุงุฏ Clang ุจุงูุตูุบุฉ ุงูุชู ุชูุช ูุชุงุจุชูุง ุจูุง ุงูุขู ูุฌุนู ุตูู "ุบูุฑ ุจุฏููู" ุ ููู ูููู ููุณูุฉ ุฃู ุชุฃุซูุฑ.  (ูุง ูุชู ุฅุตุฏุงุฑ ุฑุณุงุฆู ุชุดุฎูุตูุฉ. ูุฐุง ูุนูู ุฃูู ููููู ุงุณุชุฎุฏุงู [[trivial_abi]] ูู ูุงูุจ ุงููุตู ูุตูุฉ ุงุฎุชูุงุฑูุฉ ุ ูุณูููู ุงููุตู "ุชุงูููุง ูุดุฑูุทูุง" ุ ููู ุฃูุฑ ูููุฏ ูู ุจุนุถ ุงูุฃุญูุงู. ุงูุนูุจ ุ ุจุงูุทุจุน ุ ูู ุฃูู ููููู ูู ุจุชูููุฒ ุงููุฆุฉ ุนูู ุฃููุง ุชุงููุฉ ุ ุซู ุงุจุญุซ ุนู ุงููุญูู ุงูุจุฑูุฌู ุฅุตูุงุญูุง ุจูุฏูุก.) <br><br>  ูุชู ุชุฌุงูู ุงูุณูุฉ ุจุฏูู ุฑุณุงุฆู ุฅุฐุง ูุงู ููุตูู ูุฆุฉ ุฃุณุงุณูุฉ ุงูุชุฑุงุถูุฉ ุ ุฃู ูุธุงุฆู ุงูุชุฑุงุถูุฉ.  ูู ูุฐู ุงูุญุงูุงุช ุ ูุฏ ูุง ููุงุณุจ ุงูุณุฌู ุ ููุง ุฃุนุฑู ูุง ุงูุฐู ุชุฑูุฏ ุงูุญุตูู ุนููู ุจุชูุฑูุฑู ุจุงููููุฉ ุ ูููู ุฑุจูุง ุชุนุฑู. <br><br>  ุญุณุจ ุนููู ุ ุงูุทุฑููุฉ ุงููุญูุฏุฉ ูุงุณุชุฎุฏุงู TRIVIAL_ABI ูู "ุฃููุงุน ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ ุงูููุงุณูุฉ" ูุซู &lt;T&gt; ู unique_ptr &lt;T&gt; ู shared_ptr &lt;T&gt; ุงูุงุฎุชูุงุฑูุฉ ูู <br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุจุชูููุฐูุง ุจููุณู ูู ููุทุฉ ุงูุตูุฑ ูุชุทุจูู ุงูุณูุฉ ุ ุฃู </li><li style=";text-align:right;direction:rtl">  ุงูุชุญู ูุณุฎุชู ุงููุญููุฉ ูู libc ++ ูุฃุฏุฎู ุงูุณูุฉ ููุงู ุจูุฏูู </li></ul><br>  (ูู ุนุงูู ุงููุตุงุฏุฑ ุงูููุชูุญุฉ ุ ููุชุง ุงูุทุฑููุชูู ูุชุดุงุจูุชุงู ุจุดูู ุฃุณุงุณู) <br><br><h3 style=";text-align:right;direction:rtl">  ุชุญุฐูุฑ ุฑูู 2: ูุณุคูููุฉ ุงููุฏูุฑ </h3><br>  ูู ุงููุซุงู ูุน Foo / Bar ุ ูุญุชูู ุงููุตู ุนูู ุฃุฏุงุฉ ุฅุชูุงู ูุงุฑุบุฉ.  ุงุณูุญ ููุง ุฃู ูููู ููุตููุง ูู ุงููุงูุน ูุฏูุฑ ูุง ูุธูุฑ ูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Up1</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value; Up1(Up1&amp;&amp; u) : value(u.value) { u.value = <span class="hljs-number"><span class="hljs-number">0</span></span>; } ~Up1() { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(<span class="hljs-string"><span class="hljs-string">"destroyed"</span></span>); } };</code> </pre> <br>  ูุฌุจ ุฃู ูููู ูุฐุง ูุฃููููุง ูู ุ ููุฐุง ูุฑูุฏ ูู ููุนู &lt;int&gt; ุ ูุจุณุท ุฅูู ุงูุญุฏ ุงูุฃูุตู ุ ูุน ุทุจุงุนุฉ ุงูุฑุณุงูุฉ ุนูุฏ ุญุฐููุง. <br><br>  ุจุฏูู TRIVIAL_ABI ุ ูุจุฏู incr &lt;Up1&gt; ููุฃูู incr &lt;Bar&gt;: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">movl (%rsi), %eax addl $<span class="hljs-number"><span class="hljs-number">1</span></span>, %eax movl %eax, (%rdi) movl $<span class="hljs-number"><span class="hljs-number">0</span></span>, (%rsi) movq %rdi, %rax retq</code> </pre> <br><br>  ูุน TRIVIAL_ABI ุ ูุจุฏู incr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃูุจุฑ ูุฃูุซุฑ ุฑุนุจุง</a> ! <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">pushq %rbx leal <span class="hljs-number"><span class="hljs-number">1</span></span>(%rdi), %ebx movl $.L.str, %edi callq <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span> movl %ebx, %eax popq %rbx retq</code> </pre> <br><br>  ูู ุงุชูุงููุฉ ุงูุงุชุตุงู ุงูุชูููุฏูุฉ ุ ูุชู ุฏุงุฆููุง ุชูุฑูุฑ ุงูุฃููุงุน ุฐุงุช ุงูุชุฏููุฑ ุบูุฑ ุงูุชุงูู ุจูุงุณุทุฉ ุฑุงุจุท ุบูุฑ ูุฑุฆู ุ ููุง ูุนูู ุฃู ุฌุงูุจ ุงูุชููู (incr ูู ูุฐู ุงูุญุงูุฉ) ููุจู ุฏุงุฆููุง ูุคุดุฑ ุฅูู ูุงุฆู ูุนููุฉ ุฏูู ุงูุชูุงู ูุฐุง ุงููุงุฆู.  ุงููุงุฆู ููููู ูููุชุตู ุ ููุง ูุฌุนู ุงูุนูู ูุนูู! <br><br>  ุนูุฏูุง ูุชู ุชูุฑูุฑ ููุน ูุน [[trivial_abi]] ูู ุงูุณุฌูุงุช ุ ูุฅููุง ูููู ุฃุณุงุณูุง ุจุนูู ูุณุฎุฉ ูู ูุงุฆู ุงููุนููุฉ. <br><br>  ูุธุฑูุง ูุฃู ุงูุฅุตุฏุงุฑ x86-64 ูุญุชูู ุนูู ุณุฌู ูุงุญุฏ ููุท ูุฅุฑุฌุงุนู (ุชุตููู) ุ ูุฅู ุงููุธููุฉ ุงูุชู ุชู ุงุณุชุฏุนุงุคูุง ููุณ ููุง ุทุฑููุฉ ูุฅุฑุฌุงุน ุงููุงุฆู ูู ุงูููุงูุฉ.  ูุฌุจ ุฃู ุชุฃุฎุฐ ุงููุธููุฉ ุงููุทููุจุฉ ููููุฉ ุงููุงุฆู ุงูุฐู ุงูุชูููุง ุฅููู!  ูุฐุง ูุนูู ุฃู ุงูุฏุงูุฉ ุงูุชู ุชู ุงุณุชุฏุนุงุคูุง ูุฌุจ ุงุณุชุฏุนุงุก destructor ูููุงุฆู ุงููุนููุฉ ุนูุฏ ุงูุงูุชูุงุก. <br><br>  ูู ุงููุซุงู ุงูุณุงุจู ุ Foo / Bar / Baz ุ ูุณูู ุงููุฏูุฑ ุ ูููู ูุงู ูุงุฑุบูุง ุ ููู ููุงุญุธู.  ุงูุขู ูู incr &lt;Up2&gt; ุ ูุฑู ุฑูุฒูุง ุฅุถุงูููุง ุชู ุฅูุดุงุคู ุจูุงุณุทุฉ destructor ุนูู ุฌุงูุจ ุงููุธููุฉ ุงููุฏุนูุฉ. <br><br>  ูููู ุงูุชุฑุงุถ ุฃูู ูุฏ ูุชู ุฅูุดุงุก ูุฐุง ุงูุฑูุฒ ุงูุฅุถุงูู ูู ุจุนุถ ุญุงูุงุช ุงููุณุชุฎุฏู.  ูููู ุ ุนูู ุงูุนูุณ ูู ุฐูู ุ ูุฅู ุฏุนูุฉ ุงููุฏูุฑ ูุง ุชุธูุฑ ูู ุฃู ููุงู!  ูุชู ุงุณุชุฏุนุงุก in inc ูุฃูู <i>ูุง</i> ูุชู ุงุณุชุฏุนุงุก ูู ูุธููุฉ ุงูุงุณุชุฏุนุงุก.  ูุจุดูู ุนุงู ุ ุณูุชู ููุงุฒูุฉ ุงูุณุนุฑ ูุงูููุงุฆุฏ. <br><br><h3 style=";text-align:right;direction:rtl">  ุชุญุฐูุฑ ุฑูู 3: ุฃูุฑ ุงููุฏูุฑ </h3><br>  ุณูุชู ุงุณุชุฏุนุงุก destructor ููุนููุฉ ูุน ABI ุชุงููุฉ ูู ุฎูุงู ูุธููุฉ ุชุณูู ุ ูููุณ ูุงุญุฏ ุงุณุชุฏุนุงุก (ุชุญุฐูุฑ ุฑูู 2).  ูุดูุฑ ุฑูุชุดุงุฑุฏ ุณููุซ ุฅูู ุฃู ูุฐุง ูุนูู ุฃูู ูุนูู ุฃูู ูู ูุชู ุงุณุชุฏุนุงุคู ุจุงูุชุฑุชูุจ ุงูุฐู ููุฌุฏ ุจู ูุฏูุฑุงุช ุงููุนููุงุช ุงูุฃุฎุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRIVIAL_ABI</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alpha</span></span></span><span class="hljs-class"> {</span></span> alpha() { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(<span class="hljs-string"><span class="hljs-string">"alpha constructed"</span></span>); } ~alpha() { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(<span class="hljs-string"><span class="hljs-string">"alpha destroyed"</span></span>); } }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">beta</span></span></span><span class="hljs-class"> {</span></span> beta() { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(<span class="hljs-string"><span class="hljs-string">"beta constructed"</span></span>); } ~beta() { <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>(<span class="hljs-string"><span class="hljs-string">"beta destroyed"</span></span>); } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(alpha, beta)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ foo(alpha{}, beta{}); }</code> </pre> <br>  ูุทุจุน ูุฐุง ุงูุฑูุฒ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">alpha constructed beta constructed alpha destroyed beta destroyed</code> </pre> <br>  ุนูุฏูุง ูุชู ุชุนุฑูู TRIVIAL_ABI ุนูู ุฃูู [[clang :: trivial_abi]] ุ ูุฅูู ูุทุจุน: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">alpha constructed beta constructed beta destroyed alpha destroyed</code> </pre> <br><h3 style=";text-align:right;direction:rtl">  ุงูุนูุงูุฉ ูุน ูุงุฆู "relocatable" / "move-relocates" </h3><br>  ูุง ุนูุงูุฉ ... ุ ูุงูุ <br><br>  ููุง ุชุฑูู ุ ูุง ุชูุฌุฏ ูุชุทูุจุงุช ูุฃู ูููู ูููุฆุฉ [[trivial_abi]] ุฃู ุฏูุงูุงุช ูุญุฏุฏุฉ ูููุดุฆ ูุชุญุฑู ุฃู ููุฏูููุฑ ุฃู ูููุดุฆ ุงูุชุฑุงุถู.  ูู ุงููุญุชูู ุฃู ูุชู ููู ุฃู ูุฆุฉ ูุนููุฉ ุจุดูู ุชุงูู ุ ูุฐูู ุจุจุณุงุทุฉ ูุฃู ูุนุธู ุงููุฆุงุช ูุงุจูุฉ ููุงูุชูุงู ุจุดูู ุชุงูู. <br><br>  ูููููุง ุจุจุณุงุทุฉ ุฅูุดุงุก ูุฆุฉ offset_ptr ุจุญูุซ ูุง ูููู ููููุง ุจุณูููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TRIVIAL_ABI</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">offset_ptr</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">intptr_t</span></span> value_; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: offset_ptr(T *p) : value_((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)p - (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {} offset_ptr(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offset_ptr&amp; rhs) : value_((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)rhs.get() - (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {} <span class="hljs-function"><span class="hljs-function">T *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T *)((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> + value_); } offset_ptr&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offset_ptr&amp; rhs) { value_ = ((<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)rhs.get() - (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } offset_ptr&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+=(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> diff) { value_ += (diff * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (T)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ offset_ptr&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; top = &amp;a[<span class="hljs-number"><span class="hljs-number">4</span></span>]; top = incr(top); assert(top.get() == &amp;a[<span class="hljs-number"><span class="hljs-number">5</span></span>]); }</code> </pre> <br>  <a href="">ููุง ูู ุฑูุฒ ูุงููุฉ.</a> <br>  ุนูุฏูุง ูุชู ุชุนุฑูู TRIVIAL_ABI ุ ูุฌุชุงุฒ ุฌุฐุน Clang ูุฐุง ุงูุงุฎุชุจุงุฑ ูู -O0 ู -O1 ุ ูููู ุนูุฏ -O2 (ุฃู ุจูุฌุฑุฏ ูุญุงููุฉ ุฅุฌุฑุงุก ููุงููุงุช ุฅูู trivial_offset_ptr :: operator + = ูููุดุฆ ุงููุณุฎ) ุ ูุฅูู ูุชุนุทู ุนูุฏ ุงูุชุฃููุฏ. <br><br>  ูุฐูู ุชุญุฐูุฑ ูุงุญุฏ ุขุฎุฑ.  ุฅุฐุง ูุงู ููุนู ููุนู ุดูุฆูุง ูุฌููููุง ูุน ูุฐุง ุงููุคุดุฑ ุ ูุฑุจูุง ูู ุชุฑุบุจ ูู ุชูุฑูุฑู ูู ุงูุณุฌูุงุช. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูุฉ 37319</a> ุ ูู ุงููุงูุน ุ ุทูุจ ูุซุงุฆู.  ูู ูุฐู ุงูุญุงูุฉ ุ ุงุชุถุญ ุฃูู ูุง ุชูุฌุฏ ุทุฑููุฉ ูุฌุนู ุงูุดูุฑุฉ ุชุนูู ุจุงูุทุฑููุฉ ุงูุชู ูุฑูุฏูุง ุงููุจุฑูุฌ.  ูููู ุฃู ูููุฉ value_ ูุฌุจ ุฃู ุชุนุชูุฏ ุนูู ูููุฉ ูุฐุง ุงููุคุดุฑ ุ ูููู ุนูู ุงูุญุฏ ุงููุงุตู ุจูู ุงูุงุณุชุฏุนุงุก ูุงููุธุงุฆู ุงูุชู ุชู ุงุณุชุฏุนุงุคูุง ุ ูููู ุงููุงุฆู ูู ุงูุณุฌูุงุช ููุง ููุฌุฏ ูุคุดุฑ ูู!  ูุฐูู ุ ุชููู ุฏุงูุฉ ุงูุงุณุชุฏุนุงุก ุจุงููุชุงุจุฉ ุฅูู ุงูุฐุงูุฑุฉ ุ ูุชูุฑูุฑ ูุฐุง ุงููุคุดุฑ ูุฑุฉ ุฃุฎุฑู ุ ูููู ููุจุบู ุฃู ุชุญุณุจ ุงูุฏุงูุฉ ุงูููุทูููุจุฉ ุงููููุฉ ุงูุตุญูุญุฉ ูู ุฃุฌู ูุชุงุจุชูุง ุนูู value_ุ  ุฑุจูุง ูู ุงูุฃูุถู ุฃู ูุณุฃู ููู ูุนูู ุญุชู ูู OOุ  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฌุจ ุฃู ูุง ูุนูู ูุฐุง ุงูุฑูุฒ ุนูู ุงูุฅุทูุงู.</a> <br><br>  ูุฐุง ุ ุฅุฐุง ููุช ุชุฑูุฏ ุงุณุชุฎุฏุงู [[trivial_abi]] ุ ููุฌุจ ุนููู ุชุฌูุจ ูุธุงุฆู ุงูุฃุนุถุงุก (ููุณุช ุฎุงุตุฉ ูุญุณุจ ุ ุจู ูุฃูุถุงู ุจุดูู ุนุงู) ุงูุชู ุชุนุชูุฏ ุงุนุชูุงุฏูุง ูุจูุฑูุง ุนูู ุนููุงู ุงููุงุฆู (ูุน ุจุนุถ ุงููุนุงูู ุบูุฑ ุงููุญุฏุฏุฉ ูููููุฉ "ุฃุณุงุณู"). <br><br>  ุจุดูู ุญุฏุณู ุ ุนูุฏูุง ูุชู ุชุนููู ูุฆุฉ ุนูู ุฃููุง [[trivial_abi]] ุ ูููุง ููุช ุชุชููุน ุงููุณุฎ ุ ููููู ุงูุญุตูู ุนูู ูุณุฎุฉ ุจุงูุฅุถุงูุฉ ุฅูู memcpy.  ูุจุงููุซู ุ ุนูุฏูุง ุชุชููุน ุชุญุฑููุง ุ ููููู ุจุงููุนู ุงูุญุตูู ุนูู ุงูุฎุทูุฉ ุจุงูุฅุถุงูุฉ ุฅูู memcpy. <br><br>  ุนูุฏูุง ูููู ุงูููุน "ูุงุจูุงู ููููู ุจุดูู ุชุงูู" (ููุง ูู ูุญุฏุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">C ++ ุงูุขู</a> ) ุ ุซู ูู ุฃู ููุช ุชุชููุน ููู ุงููุณุฎ ูุงูุชุฏููุฑ ุ ููููู ุจุงููุนู ุงูุญุตูู ุนูู memcpy.  ูุจุงููุซู ุ ุนูุฏูุง ุชุชููุน ุงููุฒูุญ ูุงูุฏูุงุฑ ุ ููููู ูู ุงููุงูุน ุงูุญุตูู ุนูู memcpy.  ูู ุงููุงูุน ุ ุณุชููุฏ ุงูููุงููุงุช ุฅูู ุงููุธุงุฆู ุงูุฎุงุตุฉ ุฅุฐุง ุชุญุฏุซูุง ุนู "ููู ุชุงูู" ุ ูููู ุนูุฏูุง ูููู ููุตูู [[trivial_abi]] ุณูุฉ ูู ููุงูุฌ ุ ูุง ุชุถูุน ุงูููุงููุงุช.  ููููู ููุท ุงูุญุตูู ุนูู (ููุง ูุงู) memcpy ุจุงูุฅุถุงูุฉ ุฅูู ุงูููุงููุงุช ุงูุชู ุชุชููุนูุง.  ูุฐุง (ููุน ูู) memcpy ูู ุงูุณุนุฑ ุงูุฐู ุชุฏูุนู ููุงุจู ุงุชูุงููุฉ ุชุณุฌูู ููุงููุงุช ุฃุณุฑุน. <br><br><h3 style=";text-align:right;direction:rtl">  ุฑูุงุจุท ููุฒูุฏ ูู ุงููุฑุงุกุฉ: </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุคุดุฑ ุชุฑุงุจุท cfe-dev ูู ุฃููุฑุง ูุงุชุงูุงูุง ูู ููููุจุฑ 2017</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู ุงูุฑุณููุฉ ููุงูุฌ</a> <br>  <a href="">ูุญุฏุฉ ุงูุงุฎุชุจุงุฑุงุช ู trivial_abi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฎุทุฃ 37319: ุฑุจูุง ูุง ูุนูู trivial_offset_ptr</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar468759/">https://habr.com/ru/post/ar468759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar468741/index.html">ุงูุฅูุชุฑูุช ูู ุงููุฏููุฉ ุงูุฐููุฉ</a></li>
<li><a href="../ar468747/index.html">ููู ูุถูุช ุงูุตูู ุนูู VK</a></li>
<li><a href="../ar468749/index.html">ุฃุญุฏุงุซ Android LiveData</a></li>
<li><a href="../ar468753/index.html">ููู ุฃุนูู - ุตุฏูู ููุฅูุณุงู (ูุฒุงุฑุฉ ุงูุตุญุฉ ููุณุช ุนูู ุญู)</a></li>
<li><a href="../ar468757/index.html">ุงุชุตุงู MySQL ุจุนุฏ ุงูุฎุทุฃ 1040: ุงููุซูุฑ ูู ุงูุงุชุตุงูุงุช</a></li>
<li><a href="../ar468761/index.html">ุญู ุงููุดุงูู ูุน pwnable.kr 24 - ุชุณุฌูู ุฏุฎูู ุจุณูุท. ูููุฉ ุงูุฅุทุงุฑ ุชุฑุงูุจ</a></li>
<li><a href="../ar468765/index.html">ุฃูููุฉ ุชุฃููุฏ ุฃูุงูุฑ ุงูุชุญูู ุจุงุณุชุฎุฏุงู Delimobile ููุซุงู</a></li>
<li><a href="../ar468767/index.html">ุฃูุนุงุจ ุฎุดุจูุฉ ุ ุงูุฌุฒุก ุงูุซุงูู - 1986-1988</a></li>
<li><a href="../ar468769/index.html">ูุฒุงูููู ููุฑูุง ุนูู ุงููุถุจุงู 6 ุ ูุงูุงุณุชุดุงุฑุงุช ูุฃูุซุฑ ูู ุฐูู</a></li>
<li><a href="../ar468773/index.html">ุดุฑูุฉ ุงูุทุงูุฉ ุงูููุฏูุฉ NTPC ุชุจูู ุญุฏููุฉ ุดูุณูุฉ ุจููุฉ 5000 ููุฌุงูุงุช</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>