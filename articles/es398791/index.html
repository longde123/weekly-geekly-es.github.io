<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèº üíÜüèº üêë Balada de transferencia de datos ü¶â üóúÔ∏è üë©üèø‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En las primeras l√≠neas de mi hemorragia de texto quiero decir lo siguiente: se ha escrito mucho sobre esto, escribir√© mi visi√≥n. Las interfaces est√°nd...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Balada de transferencia de datos</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/398791/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En las primeras l√≠neas de mi hemorragia de texto quiero decir lo siguiente: se ha escrito mucho sobre esto, escribir√© mi visi√≥n. </font><font style="vertical-align: inherit;">Las interfaces est√°ndar para transmitir informaci√≥n son excelentes, pero para mis necesidades no proporcionan suficiente transferencia de datos satisfactoria (bueno, o casi). </font><font style="vertical-align: inherit;">Intentar√© hacer algunas adiciones para llevar esto al estado que m√°s me convenga.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hay 2 o m√°s dispositivos a una distancia suficientemente grande (1-100 metros) entre los cuales se deben transmitir los datos. Despu√©s de examinar algunas interfaces (rs232 / 422/485, I2C, Ethernet), llegu√© a la conclusi√≥n de que tampoco garantizan una transferencia de datos inequ√≠voca, tampoco me gustaron muchos cables, no dieron una respuesta de que la informaci√≥n fuera aceptada. Decid√≠ tomar la interfaz RS485 como base: puede ir muy lejos de sus ventajas, 2 cables, puede conectar un mont√≥n de dispositivos al mismo tiempo, es simple, (UART) est√° en casi cualquier controlador.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 En mi caso, el esquema cl√°sico 1 que lidera al resto de los esclavos es adecuado para m√≠. El algoritmo de mensajer√≠a es el siguiente: los datos se transmiten en ciclos de intercambio, un ciclo de intercambio consiste en un mensaje que se transmite del maestro al esclavo, en respuesta el maestro recibe el mensaje del esclavo, todos los dem√°s est√°n en silencio. Sobre la misma base, implemente una solicitud de datos desde un dispositivo esclavo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e4e/48e/048/e4e48e048a5e4cd08723865418a0e25a.png" alt="imagen"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un ciclo de intercambio.</font></font></em><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para satisfacer mis necesidades de transferencia de datos, necesito resolver solo dos preguntas. Pregunta uno: la comprobaci√≥n del byte transmitido se basa en la interfaz RS-485 en s√≠ misma, pero no garantiza un byte transmitido confiablemente: si se encuentra un byte en la interfaz, se elimina de los datos recibidos, pero a√∫n es posible transferir el byte incorrecto, si ha cambiado (se ha da√±ado) ) un n√∫mero par de bits en un byte. es decir Se requiere una verificaci√≥n del n√∫mero de bytes transmitidos y la validez de bytes en los datos transmitidos. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Pregunta dos: recibir un mensaje de respuesta al transmitido. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Sobre la primera pregunta: se propone este esquema: el byte inicial, el byte del n√∫mero de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 caracteres transmitidos en todo el mensaje, algo m√°s, el byte de suma de comprobaci√≥n (BCS), el byte final.</font></font><br>
 <br>
<img src="https://habrastorage.org/files/a00/e71/e60/a00e71e60f3a40d1affd859b411afe89.png" alt="imagen"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: el byte de suma de verificaci√≥n debe considerarse el m√≥dulo 2.</font></font></em><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Seg√∫n el esquema propuesto, se puede juzgar que si la respuesta no regres√≥, entonces el seguidor no est√° disponible. En este caso, las opciones son posibles cuando un mensaje da√±ado llega al seguidor y √©l no responde, o el mensaje llega a √©l y env√≠a la respuesta, pero la respuesta sale mal y el l√≠der la ignora.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para corregir esto, se acept√≥: si la respuesta no llega (o no es confiable), repita (el n√∫mero de veces sin locura) repita el ciclo de intercambio actual. El siguiente error puede ocurrir aqu√≠. Supongamos que enviamos un comando dici√©ndole al dispositivo que necesita subir el volumen en +1 unidad. Cuando el mensaje llega al esclavo, ejecuta el comando para subir el volumen y env√≠a la respuesta "ok, hice lo que quer√≠a", pero puede resultar que la respuesta salga mal y el presentador no entiende que el comando ya se ha ejecutado, y env√≠a el mensaje nuevamente. Como resultado, al recibir un comando en el lado esclavo, el volumen ya ser√° agregado por +2 unidades. Para evitar este fen√≥meno, se acostumbra introducir un identificador (NS - n√∫mero de mensaje) de la diferencia del mensaje. Si el n√∫mero del mensaje se repite, entonces este es un mensaje repetido y el comando especificado no necesita ejecutarse,pero solo env√≠e el mensaje de respuesta anterior.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n ingreso 2 par√°metros m√°s aqu√≠: este es el n√∫mero (c√≥digo) del dispositivo al que se transmiten los datos y el n√∫mero (subc√≥digo) que indica qu√© comando debe ejecutarse (o qu√© datos est√°n dentro del mensaje). </font></font><br>
 <br>
<img src="https://habrastorage.org/files/2ca/3d8/226/2ca3d82263eb48e6a0b566ba824c917a.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, lo pondr√© todo junto y pasar√© por el algoritmo, utilizando el ejemplo de aumentar el umbral del rel√© en 5 grados cent√≠grados y tomar la temperatura actual del esclavo durante 1 ciclo de intercambio: </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
genero los datos transmitidos desde el maestro: </font></font><br>
<br>
<img src="https://habrastorage.org/files/c7a/172/c23/c7a172c23c3d4a9886481ce1c052304a.PNG" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cuando se recibe el mensaje, el esclavo mira 2 bytes, donde es el n√∫mero de bytes enviados, si el n√∫mero de bytes enviados es igual al n√∫mero recibido, entonces el mensaje no ha perdido bytes, entonces miramos el byte inicial (car√°cter) si = '$', y tambi√©n el byte final (car√°cter) si = ' # '- este es un mensaje de viajar al esclavo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inmediatamente considerar√© las posibles opciones de mensaje del maestro al esclavo con errores en los bytes iniciales y finales, as√≠ como la opci√≥n con un error en el n√∫mero de bytes en el mensaje. </font><font style="vertical-align: inherit;">Har√© una reserva de inmediato de 3 valores de par√°metros que considerar√© correctos 2 y 3, es decir </font><font style="vertical-align: inherit;">si 2 par√°metros de 3 posibles coinciden, considero que el mensaje es v√°lido.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. byte de inicio = '$', n√∫mero de bytes recibidos = 7 (n√∫mero de bytes enviados = 7), el byte final no es igual a '#'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2. el byte inicial no es igual a '$', el n√∫mero de bytes recibidos = 7 (el n√∫mero de bytes enviados = 7), el byte final = '#'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 3. byte de inicio = '$', n√∫mero de bytes recibidos = 7 (n√∫mero de bytes enviados = 7, n√∫mero de bytes no es igual a 7), byte final = '#'.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, calculamos la suma de verificaci√≥n de los 3 bytes restantes (bytes 3, 4, 5), si coincide con el BCS, continuamos analizando los datos, buscamos este dispositivo para estos datos y qu√© se debe hacer en √©l, en nuestro caso el c√≥digo esclavo es 55 y el subc√≥digo 2 dice sobre la necesidad de agregar otros 5 grados al umbral del rel√© y en el mensaje de respuesta para enviar los datos de temperatura actuales. Verifico el NS si no es igual al n√∫mero de mensaje anterior, luego ejecuto el comando y agrego 5 grados al valor actual del umbral del rel√©. Si son iguales (NS), entonces no realizo las acciones indicadas, luego procedo a la formaci√≥n de un mensaje de respuesta.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
aplicaci√≥n del esquema ['$'] [n√∫mero de bytes enviados / recibidos] [...] ['#'] - con una alta probabilidad garantiza que tal combinaci√≥n no se podr√° encontrar en los datos transmitidos y provocar√° un mensaje falso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Formo los datos transmitidos desde el esclavo en funci√≥n del mensaje recibido:</font></font><br>
<br>
<img src="https://habrastorage.org/files/f0e/f6a/e05/f0ef6ae05be5437daf087ce6681ea795.PNG" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El principio de procesamiento es el siguiente: mire 2 bytes donde se encuentra el n√∫mero de bytes enviados, si el n√∫mero de bytes enviados es igual al n√∫mero de bytes recibidos y tambi√©n el byte inicial = '@' y el byte final = '&amp;' - este es un mensaje del esclavo al maestro. Si es necesario, uso el mecanismo 2 de 3, similar al descrito anteriormente solo para el mensaje de respuesta (para los caracteres '@' y '&amp;'). Al recibir este mensaje, el host analiza los 9 bytes de la suma de verificaci√≥n (del 3 al 11), si la suma de verificaci√≥n coincide, los datos en el mensaje se consideran confiables y el an√°lisis de datos contin√∫a. Si el c√≥digo, el subc√≥digo y el NS de los mensajes enviados y recibidos coinciden, continuamos analizando la respuesta al mensaje enviado por el host. El siguiente es el an√°lisis de los datos recibidos,en mi caso, en el sexto byte, un valor de 1 significa que el comando para aumentar 5 grados hasta el umbral del rel√© fue exitoso, los 5 bytes restantes indican las lecturas de temperatura actuales; el s√©ptimo byte es una bandera que indica la confiabilidad de la temperatura transmitida (es decir, Estoy considerando la opci√≥n de que el esclavo est√° encendido y responde, pero el sensor puede no funcionar) y 4 bytes de valores de temperatura de flotaci√≥n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El uso de 2 caracteres de prueba al principio y al final de un mensaje con una alta probabilidad garantiza que, en caso de error, no confunda los mensajes del esclavo y el maestro. Adem√°s, los datos aleatorios (no aleatorios) en el canal no estropear√°n el intercambio. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Un poco sobre la transmisi√≥n de datos del esclavo al esclavo, y un mensaje centralizado a todos los esclavos del maestro.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Primero, el √∫ltimo: la transmisi√≥n del maestro por el esclavo se lleva a cabo asignando el c√≥digo de dispositivo 255, que le dice al esclavo que este es un mensaje centralizado, luego solo queda resolver el problema de los subc√≥digos comunes, tambi√©n es posible agrupar por c√≥digos de dispositivo, es decir asignar el c√≥digo de dispositivo 254 y 3 o 4 dispositivos recibir√°n un mensaje usando este c√≥digo; el resto lo ignorar√°, naturalmente, la parte de enviar respuestas de esclavos no deber√≠a funcionar aqu√≠, es decir ¬°no est√° garantizado que los seguidores hayan aceptado inequ√≠vocamente estos mensajes!</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 El esclavo env√≠a informaci√≥n sobre la transmisi√≥n de datos al esclavo, implementado por el maestro env√≠a un mensaje al esclavo (esclavo1) desde el cual se debe enviar informaci√≥n al otro esclavo (esclavo2), el esclavo1 env√≠a una respuesta al maestro mientras el esclavo2 escucha esta respuesta tomando los datos para s√≠ mismo. De nuevo, no hay garant√≠a de una entrega inequ√≠voca de mensajes de esclavo1 a esclavo2, ¬°esto debe tenerse en cuenta! </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√∫mero de capacidades de interfaz de dispositivos te√≥ricamente conectados alrededor de 250, comandos / tipos de datos de hasta 248 para cada dispositivo, la longitud de la informaci√≥n √∫til en el mensaje es de hasta 250 bytes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hable acerca de las trampas:</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Toda la transferencia de datos est√° dise√±ada para funcionar a tiempo, es decir se deben observar ciertos retrasos entre mensajes. Tambi√©n le recomiendo que haga un retraso fijo entre el mensaje enviado por el maestro y la respuesta del esclavo para que el esclavo pueda generar datos y transmitirlos por completo al canal. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 El momento de organizar las respuestas del esclavo tambi√©n es importante, puede suceder que el esclavo est√© ocupado y tenga varios mensajes de datos en su canal a la vez, debe evitar las respuestas a mensajes obsoletos (porque el l√≠der ya no los espera) ignor√°ndolos, ejecutando comandos de solo los √∫ltimos mensajes y dale una respuesta.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Por separado, me gustar√≠a resaltar el problema de la sincronizaci√≥n de dispositivos por tiempo: debe tenerse en cuenta que la sincronizaci√≥n de tiempo del esclavo al recibir un mensaje requiere tener en cuenta el retraso de tiempo para enviar datos al canal (a una velocidad de 9600, se transmitir√° un mensaje de 10 bytes durante aproximadamente 11 ms) y el momento en que se activa la interrupci√≥n al final recibir datos en el lado esclavo, si no hay interrupci√≥n, vale la pena considerar el momento de verificar la llegada de datos en el b√∫fer del dispositivo, etc. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tambi√©n vale la pena se√±alar que reenviar un ciclo de mensajes tambi√©n agrega matices, recomiendo usar el env√≠o de mensajes sin repeticiones para la sincronizaci√≥n de tiempo y componer mensajes con un nuevo NS. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tengo dudas de que descubr√≠ algo nuevo aqu√≠, ¬°todo esto se utiliza en alguna parte en diferentes interfaces! </font><font style="vertical-align: inherit;">Con la mano ligera del autor de este garabato y la aplicaci√≥n de este protocolo en mis desarrollos, quiero dar el nombre a este protocolo de transferencia de datos "SRDB2".</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es398791/">https://habr.com/ru/post/es398791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es398781/index.html">Depuraci√≥n inal√°mbrica STM32</a></li>
<li><a href="../es398783/index.html">Paquete de servicios de seguridad de red y utilidad oidcalc</a></li>
<li><a href="../es398785/index.html">En el fondo del Golfo de M√©xico se encontr√≥ un lago venenoso.</a></li>
<li><a href="../es398787/index.html">En un suburbio de Mosc√∫ usando una impresora 3D en 20 horas para construir una casa</a></li>
<li><a href="../es398789/index.html">La red neuronal predice la primera impresi√≥n de una persona por su cara.</a></li>
<li><a href="../es398793/index.html">¬øUn bol√≠grafo para una computadora o una computadora para un bol√≠grafo?</a></li>
<li><a href="../es398795/index.html">Soluciones educativas LEGO Education. ¬øQu√© pueden crecer tus hijos?</a></li>
<li><a href="../es398797/index.html">EA Games and Origin prohibi√≥ todo un pa√≠s debido a las sanciones de EE. UU.</a></li>
<li><a href="../es398801/index.html">Mundo de huellas eternas</a></li>
<li><a href="../es398803/index.html">11.11: cuna para ventas flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>