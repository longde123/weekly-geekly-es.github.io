<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤±ğŸ¾ â—»ï¸ ğŸ™ğŸ» Pengaturan CARA-ke / Jaringan dan VLAN pada server Hetzner dan Mikrotik khusus ğŸ¯ ğŸš£ğŸ¼ ğŸ¤´ğŸ¾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dihadapkan dengan pertanyaan dan jeda, sejumlah besar dokumentasi mencoba mensistematisasikan dan menuliskan apa yang Anda pelajari agar dapat menging...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengaturan CARA-ke / Jaringan dan VLAN pada server Hetzner dan Mikrotik khusus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481290/"><p>  Dihadapkan dengan pertanyaan dan jeda, sejumlah besar dokumentasi mencoba mensistematisasikan dan menuliskan apa yang Anda pelajari agar dapat mengingat dengan lebih baik.  Dan juga membuat instruksi tentang masalah ini agar tidak berjalan jauh-jauh lagi. </p><br><p>  Dokumentasi sumber dalam jumlah besar di <a href="https://forum.proxmox.com/" rel="nofollow">https://forum.proxmox.com</a> <a href="https://wiki.hetzner.de/" rel="nofollow">https://wiki.hetzner.de</a> </p><a name="habracut"></a><br><h2 id="postanovka-zadachi">  Pernyataan masalah </h2><br><p>  Klien ingin menggabungkan beberapa server yang disewa ke dalam satu jaringan untuk menghilangkan kebutuhan untuk membayar beberapa subnet tambahan, menggantung semua peternakannya untuk router, menetapkan alamat lokal di dalamnya, dan melindungi dirinya dengan firewall.  Sehingga semua lalu lintas layanan berjalan di dalam VLAN.  Plus, pindahkan virtualochki dari satu server lama ke yang baru dan menolaknya, tingkatkan perangkat keras lama yang digunakan dan pada saat yang sama pindah ke Proxmox yang baru. </p><br><p>  Awalnya, klien memiliki 5 server, masing-masing dengan subnet tambahan, alamat pertama dari subnet yang dialokasikan ditugaskan ke jembatan tambahan di Proxmox </p><br><p><img src="https://habrastorage.org/webt/_z/fi/qo/_zfiqosgko8zksksazh9rlhhu-e.png"></p><br><p>  Pada saat yang sama, VM bekerja pada Windows dan mereka telah mengkonfigurasi alamat 85.xx177 / 29 dengan gate 85.xx176 <br>  Dan dalam nada yang sama, semua 5 server dengan mesin virtual mereka dikonfigurasi. </p><br><p>  Sangat lucu bahwa konfigurasi ini salah dalam mengatur jaringan, pada prinsipnya, untuk menggunakan alamat jaringan untuk node pertama dan juga untuk gateway.  Jika Anda mencoba mendapatkan konfigurasi seperti itu di mesin virtual di Ubuntu, jaringan tidak berfungsi. <br></p><br><h2 id="realizaciya">  Implementasi </h2><br><ul><li>  Kami membuat vSwitch di antarmuka, menetapkan VlanID ke dalamnya, menambahkan vSwitch ini ke semua server yang kami butuhkan. </li></ul><br><p><img src="https://habrastorage.org/webt/vf/lm/1e/vflm1eo8gfnba8ds_8_pgpmmcp8.png"></p><br><ul><li>  Kami membuat server uji sehingga Anda dapat mengonfigurasi dan bergerak tanpa masalah. </li></ul><br><p>  Kami menaikkan chr virtual pertama sesuai dengan <strong><a href="https://wiki.mikrotik.com/wiki/Manual:CHR_ProxMox_installation" rel="nofollow">instruksi untuk proxmox</a></strong> . </p><br><p>  Jika Anda menggunakan skrip di atas, perhatikan bahwa keberadaan direktori -d / root / temp diperiksa di awal, dan jika tidak, direktori / home / root / temp dibuat, namun, pekerjaan lebih lanjut dilanjutkan dengan direktori / root / temp.  Skrip perlu diperbaiki untuk membuat direktori yang sesuai. </p><br><ul><li>  Siapkan jaringan untuk Proxmox. </li></ul><br><p><img src="https://habrastorage.org/webt/8p/pc/if/8ppcifybz-syafd8zbc0hoqmghg.png"></p><br><p>  Tambahkan subinterface dengan nomor VLAN, menunjukkan bahwa pengaturan alamat akan terjadi pada jembatan menggunakan manual inet.  <strong>PENTING</strong>  Anda tidak dapat mengonfigurasi alamat IP pada antarmuka yang kemudian akan Anda sertakan di jembatan, bagaimana ini akan bekerja, dan apakah ada yang tahu atau tidak sama sekali. </p><br><p>  Setelah korespondensi dengan dukungan Hetzner, menjadi jelas bahwa mereka tidak dapat menambahkan poppy tambahan untuk subnet serta untuk alamat khusus.  <u>Artinya, Anda tidak dapat menyertakan antarmuka lokal di server dan antarmuka mesin virtual CHR kami di jembatan.</u>  Hetzner mengirimkan pemberitahuan yang meminta agar poppy tambahan dihapus.  Kami menghapus jembatan vmbr0 dan menetapkan alamat langsung ke antarmuka eno1. </p><br><p>  Selanjutnya, kita membuat jembatan vmbr1 - dan menggantungkannya pada alamat sewenang-wenang, yang akan menjadi titik akhir rute kita dari CHR, dan juga menunjukkan dengan perintah tambahan rute ke jaringan tambahan kami, yang dipesan di Hetzner untuk server ini melalui jembatan ini.  Menambahkan rute akan berfungsi saat antarmuka naik. </p><br><p>  Jembatan kedua akan menjadi antarmuka kami untuk lalu lintas lokal, menambahkan alamat untuk mendapatkan konektivitas antara server Proxmox yang berbeda di jaringan lokal tanpa akses ke Internet dan menentukan sinterinterface eno1.4000, yang dialokasikan untuk VlanID kami, sebagai port. <br>  Selama penyetelan awal, Anda menemukan tip yang dapat Anda instal paket ifupdown2 untuk Proxmox tambahan, dan Anda tidak dapat sepenuhnya me-restart server ketika mengubah antarmuka jaringan.  Namun, ini hanya khas untuk pengaturan awal, dan saat menggunakan jembatan dan menyiapkan mesin yang sudah virtual, Anda mengalami masalah kegagalan jaringan pada mesin virtual.  Terlepas dari kenyataan bahwa Anda memperbaiki, misalnya, antarmuka vmbr2, dan ketika menerapkan konfigurasi, jaringan sudah jatuh pada semua antarmuka internal dan tidak naik sampai server benar-benar dimulai kembali.  ifdown &amp;&amp; ifup tidak membantu.  Jika ada yang punya solusi, saya akan berterima kasih. </p><br><p>  Antarmuka terkonfigurasi pertama pada server tetap operasional dan dapat diakses. </p><br><ul><li><p>  Alokasi alamat untuk CHR agar tidak kehilangan alamat dari kumpulan <br>  Kumpulan alamat yang dikeluarkan Hetzner terlihat sangat aneh untuk seorang networker, kira-kira seperti ini: </p><br><p><img src="https://habrastorage.org/webt/bo/1i/2i/bo1i2iqkuifjfw0j8eo8rlklczo.png"></p><br></li></ul><br><p>  Yang aneh adalah bahwa gerbang menyarankan menggunakan alamat server fisik Anda sendiri. </p><br><p>  Versi klasik yang ditawarkan oleh Hetzner sendiri ditunjukkan dalam pernyataan masalah dan diimplementasikan oleh klien secara mandiri.  Dalam opsi ini, klien kehilangan alamat pertama ke alamat jaringan, alamat kedua di jembatan proxmox dan itu juga akan menjadi gateway, dan alamat terakhir untuk siaran.  Alamat IPv4 tidak mubazir.  Jika Anda secara langsung mencoba mendaftarkan alamat IP 136.x.x.177 / 29 dan gateway untuk 0.0.0.0/0 148.x.x.165 pada CHR, Anda dapat melakukan ini, namun, gateway tidak akan terhubung langsung dan karenanya tidak dapat dijangkau. </p><br><p><img src="https://habrastorage.org/webt/61/6c/tl/616ctlgp2pr4vc7-emkoid3sybc.png"></p><br><p>  Anda dapat keluar dari situasi ini jika Anda menggunakan 32 jaringan untuk setiap alamat dan menentukan alamat yang kami butuhkan, yang bisa berupa apa saja, sebagai nama jaringan.  Ternyata analog dari koneksi point-to-point. </p><br><p><img src="https://habrastorage.org/webt/kt/lp/bh/ktlpbh2jgzuk4mp1t34ja_6zloq.png"></p><br><p>  Dalam hal ini, gateway tentu saja akan tersedia, dan semuanya akan berfungsi sesuai kebutuhan. <br>  Perlu diingat bahwa dalam konfigurasi seperti itu tidak disarankan untuk menggunakan aturan masquerade SRC-NAT, karena alamat keluaran akan sedikit berbeda, tetapi lebih tepat untuk menentukan tindakan: src-NAT dan alamat spesifik dari mana Anda akan melepaskan klien. </p><br><ul><li>  Dan akhirnya. <br>  Untuk memblokir akses ke Proxmox sendiri dari Internet, gunakan alat bawaan: ada firewall yang sangat baik. </li></ul><br><p><img src="https://habrastorage.org/webt/s3/3b/wo/s33bwousnhfvvvsqpqsmvdghuxo.png"></p><br><p>  Anda tidak boleh menggunakan firewall yang ditawarkan oleh hetzner agar tidak bingung di lokasi pengaturan.  Selain itu, hetzner akan bertindak pada semua jaringan, termasuk yang terhubung ke CHR dan untuk membuka dan meneruskan port, akan perlu untuk membukanya di antarmuka web penyedia juga. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481290/">https://habr.com/ru/post/id481290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481276/index.html">Bagaimana saya membuat YP dan kompiler saya selama 12 tahun</a></li>
<li><a href="../id481280/index.html">Bagaimana kami mempersiapkan tahap kualifikasi CTFZone-2020</a></li>
<li><a href="../id481282/index.html">Nilai ide itu dan bagaimana mengubahnya menjadi sebuah konsep: alat perancang permainan</a></li>
<li><a href="../id481286/index.html">Dapatkan di atas meja! Kantor hal-hal kecil yang bukan hal kecil sama sekali</a></li>
<li><a href="../id481288/index.html">Redux Toolkit sebagai Alat untuk Pengembangan Redux yang Efektif</a></li>
<li><a href="../id481294/index.html">10 alat otomatisasi pengujian perangkat lunak terbaik</a></li>
<li><a href="../id481296/index.html">Cara menulis kode yang akan digunakan kembali</a></li>
<li><a href="../id481302/index.html">"Tentang, ya, bukan cluster" atau karena kami mengimpor DBMS</a></li>
<li><a href="../id481304/index.html">Sortir Bendera Amerika</a></li>
<li><a href="../id481306/index.html">Memperkenalkan werf 1.0 stable: apa yang harus dilakukan GitOps dengan status, dan rencana</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>