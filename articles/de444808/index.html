<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶Ñ ü§òüèø ü§¶üèø Automatische Kanarieneins√§tze mit Flagger und Istio üè§ üßû üßöüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die CD wird als Entwicklungspraxis f√ºr Unternehmenssoftware anerkannt und ist das Ergebnis einer nat√ºrlichen Weiterentwicklung etablierter CI-Prinzipi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatische Kanarieneins√§tze mit Flagger und Istio</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/444808/"><p><img src="https://habrastorage.org/webt/ol/eo/lt/oleoltogrvhcuhjuil5zmvmbpxi.png"></p><br><p>  Die CD wird als Entwicklungspraxis f√ºr Unternehmenssoftware anerkannt und ist das Ergebnis einer nat√ºrlichen Weiterentwicklung etablierter CI-Prinzipien.  CD kommt jedoch immer noch eher selten vor, m√∂glicherweise aufgrund der Komplexit√§t der Verwaltung und der Angst vor nicht erfolgreichen Bereitstellungen, die sich auf die Systemverf√ºgbarkeit auswirken. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flagger</a> ist ein Open-Source-Kubernetes-Betreiber, der verwirrende Beziehungen beseitigen soll.  Es automatisiert die F√∂rderung kanarischer Bereitstellungen mithilfe von Istio-Verkehrsvers√§tzen und Prometheus-Metriken, um das Anwendungsverhalten w√§hrend des verwalteten Rollouts zu analysieren. </p><br><p>  Im Folgenden finden Sie eine schrittweise Anleitung zum Konfigurieren und Verwenden von Flagger in der Google Kubernetes Engine (GKE). </p><a name="habracut"></a><br><h3 id="nastroyka-klastera-kubernetes">  Konfigurieren Sie den Kubernetes-Cluster </h3><br><p>  Sie erstellen zun√§chst einen GKE-Cluster mit einem Istio-Add-In (wenn Sie kein GCP-Konto haben, k√∂nnen Sie sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> registrieren, um kostenlose Credits zu erhalten). </p><br><p> Melden Sie sich bei Google Cloud an, erstellen Sie ein Projekt und aktivieren Sie die Abrechnung.  Installieren Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Befehlszeilenprogramm gcloud</a> und <code>gcloud init</code> Ihr Projekt mit <code>gcloud init</code> . </p><br><p>  <code>PROJECT_ID</code> Sie das Standardprojekt, den Berechnungsbereich und die Zone fest (ersetzen Sie <code>PROJECT_ID</code> durch Ihr Projekt): </p><br><pre> <code class="plaintext hljs">gcloud config set project PROJECT_ID gcloud config set compute/region us-central1 gcloud config set compute/zone us-central1-a</code> </pre> <br><p>  Aktivieren Sie den GKE-Dienst und erstellen Sie einen Cluster mit HPA- und Istio-Add-Ons: </p><br><pre> <code class="plaintext hljs">gcloud services enable container.googleapis.com K8S_VERSION=$(gcloud beta container get-server-config --format=json | jq -r '.validMasterVersions[0]') gcloud beta container clusters create istio \ --cluster-version=${K8S_VERSION} \ --zone=us-central1-a \ --num-nodes=2 \ --machine-type=n1-standard-2 \ --disk-size=30 \ --enable-autorepair \ --no-enable-cloud-logging \ --no-enable-cloud-monitoring \ --addons=HorizontalPodAutoscaling,Istio \ --istio-config=auth=MTLS_PERMISSIVE</code> </pre> <br><p>  Mit dem obigen Befehl wird ein Standardknotenpool erstellt, der zwei VMs <code>n1-standard-2</code> (vCPU: 2, RAM 7,5 GB, Festplatte: 30 GB).  Im Idealfall lohnt es sich, Istio-Komponenten von ihren Workloads zu isolieren. Es gibt jedoch keine einfache M√∂glichkeit, Istio-Pods in einem dedizierten Knotenpool auszuf√ºhren.  Istio-Manifeste gelten als schreibgesch√ºtzt, und GKE macht alle √Ñnderungen r√ºckg√§ngig, z. B. das Binden an einen Knoten oder das Trennen von einem Herd. </p><br><p>  Anmeldeinformationen f√ºr <code>kubectl</code> : </p><br><pre> <code class="plaintext hljs">gcloud container clusters get-credentials istio</code> </pre> <br><p>  Erstellen Sie die Clusteradministrator-Rollenbindung: </p><br><pre> <code class="plaintext hljs">kubectl create clusterrolebinding "cluster-admin-$(whoami)" \ --clusterrole=cluster-admin \ --user="$(gcloud config get-value core/account)"</code> </pre> <br><p>  Installieren Sie das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Helm-</a> Befehlszeilentool: </p><br><pre> <code class="plaintext hljs">brew install kubernetes-helm</code> </pre> <br><p>  Homebrew 2.0 ist jetzt auch f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Linux</a> verf√ºgbar. </p><br><p>  Erstellen Sie ein Dienstkonto und eine Clusterrollenbindung f√ºr Tiller: </p><br><pre> <code class="plaintext hljs">kubectl -n kube-system create sa tiller &amp;&amp; \ kubectl create clusterrolebinding tiller-cluster-rule \ --clusterrole=cluster-admin \ --serviceaccount=kube-system:tiller</code> </pre> <br><p>  Erweitern Sie Tiller im <code>kube-system</code> des <code>kube-system</code> : </p><br><pre> <code class="plaintext hljs">helm init --service-account tiller</code> </pre> <br><p>  Sie sollten die Verwendung von SSL zwischen Helm und Tiller in Betracht ziehen.  Weitere Informationen zum Sichern einer Helm-Installation finden Sie unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">docs.helm.sh</a> </p><br><p>  Einstellungen best√§tigen: </p><br><pre> <code class="plaintext hljs">kubectl -n istio-system get svc</code> </pre> <br><p>  Nach einigen Sekunden sollte GCP eine externe IP-Adresse f√ºr den Dienst <code>istio-ingressgateway</code> . </p><br><h3 id="nastroyka-vhodnogo-shlyuza-istio">  Istio Input Gateway Setup </h3><br><p>  Erstellen Sie eine statische IP-Adresse namens <code>istio-gateway</code> mit der IP-Adresse des Istio-Gateways: </p><br><pre> <code class="plaintext hljs">export GATEWAY_IP=$(kubectl -n istio-system get svc/istio-ingressgateway -ojson | jq -r .status.loadBalancer.ingress[0].ip) gcloud compute addresses create istio-gateway --addresses ${GATEWAY_IP} --region us-central1</code> </pre> <br><p>  Jetzt ben√∂tigen Sie eine Internetdomain und Zugriff auf Ihren DNS-Registrar.  F√ºgen Sie zwei A-Eintr√§ge hinzu (ersetzen Sie <code>example.com</code> durch Ihre Domain): </p><br><pre> <code class="plaintext hljs">istio.example.com A ${GATEWAY_IP} *.istio.example.com A ${GATEWAY_IP}</code> </pre> <br><p>  Stellen Sie sicher, dass der DNS-Platzhalter funktioniert: </p><br><pre> <code class="plaintext hljs">watch host test.istio.example.com</code> </pre> <br><p>  Erstellen Sie ein gemeinsames Istio-Gateway, um Dienste au√üerhalb des Dienstnetzes √ºber HTTP bereitzustellen: </p><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: Gateway metadata: name: public-gateway namespace: istio-system spec: selector: istio: ingressgateway servers: - port: number: 80 name: http protocol: HTTP hosts: - "*"</code> </pre> <br><p>  Speichern Sie die oben genannte Ressource als public-gateway.yaml und wenden Sie sie dann an: </p><br><pre> <code class="plaintext hljs">kubectl apply -f ./public-gateway.yaml</code> </pre> <br><p>  Kein Produktionssystem sollte ohne SSL Dienste im Internet bereitstellen.  Lesen Sie die Flagger GKE- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation,</a> um das Istio-Gateway mit Cert-Manager, CloudDNS und Let's Encrypt zu sch√ºtzen. </p><br><h3 id="ustanovka-flagger">  Flagger-Installation </h3><br><p>  Das GKE Istio-Add-In enth√§lt nicht die Prometheus-Instanz, mit der der Istio-Telemetriedienst bereinigt wird.  Da Flagger Istio-HTTP-Metriken verwendet, um eine Kanarienanalyse durchzuf√ºhren, m√ºssen Sie die folgende Prometheus-Konfiguration bereitstellen, die der mit dem offiziellen Istio-Helm-Schema gelieferten √§hnelt. </p><br><pre> <code class="plaintext hljs">REPO=https://raw.githubusercontent.com/stefanprodan/flagger/master kubectl apply -f ${REPO}/artifacts/gke/istio-prometheus.yaml</code> </pre> <br><p>  F√ºgen Sie das Flagger Helm-Repository hinzu: </p><br><pre> <code class="plaintext hljs">helm repo add flagger https://flagger.app</code> </pre> <br><p>  Erweitern Sie Flagger im <code>istio-system</code> des istio-Systems, <code>istio-system</code> Slack-Benachrichtigungen aktivieren: </p><br><pre> <code class="plaintext hljs">helm upgrade -i flagger flagger/flagger \ --namespace=istio-system \ --set metricsServer=http://prometheus.istio-system:9090 \ --set slack.url=https://hooks.slack.com/services/YOUR-WEBHOOK-ID \ --set slack.channel=general \ --set slack.user=flagger</code> </pre> <br><p>  Sie k√∂nnen Flagger in einem beliebigen Namespace installieren, wenn es √ºber Port 9090 mit dem Istio Prometheus-Dienst kommunizieren kann. </p><br><p>  Flagger verf√ºgt √ºber ein Grafana-Dashboard f√ºr die Kanarienvogelanalyse.  Installieren Sie Grafana im <code>istio-system</code> : </p><br><pre> <code class="plaintext hljs">helm upgrade -i flagger-grafana flagger/grafana \ --namespace=istio-system \ --set url=http://prometheus.istio-system:9090 \ --set user=admin \ --set password=change-me</code> </pre> <br><p>  Erweitern Sie Grafana √ºber ein offenes Gateway, indem Sie einen virtuellen Dienst erstellen (ersetzen Sie <code>example.com</code> durch Ihre Domain): </p><br><pre> <code class="plaintext hljs">apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: grafana namespace: istio-system spec: hosts: - "grafana.istio.example.com" gateways: - public-gateway.istio-system.svc.cluster.local http: - route: - destination: host: flagger-grafana</code> </pre> <br><p>  Speichern Sie die oben genannte Ressource als grafana-virtual-service.yaml und wenden Sie sie dann an: </p><br><pre> <code class="plaintext hljs">kubectl apply -f ./grafana-virtual-service.yaml</code> </pre> <br><p>  Wenn Sie in einem Browser zu <code>http://grafana.istio.example.com</code> gehen, sollten Sie zur Grafana-Anmeldeseite weitergeleitet werden. </p><br><h3 id="deploy-veb-prilozheniy-s-flagger">  Bereitstellung von Webanwendungen mit Flagger </h3><br><p>  Flagger stellt Kubernetes bereit und erstellt bei Bedarf die horizontale automatische Skalierung (HPA). Anschlie√üend werden eine Reihe von Objekten erstellt (Kubernetes-Bereitstellungen, ClusterIP-Dienste und virtuelle Istio-Dienste).  Diese Objekte √∂ffnen die Anwendung im Service-Mesh und verwalten die Kanarienanalyse und -werbung. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/la/cg/h5/lacgh59saaxevwtpgoiby77xe7u.png"></a> </p><br><p>  Erstellen Sie einen Test-Namespace mit aktivierter Istio Sidecar-Implementierung: </p><br><pre> <code class="plaintext hljs">REPO=https://raw.githubusercontent.com/stefanprodan/flagger/master kubectl apply -f ${REPO}/artifacts/namespaces/test.yaml</code> </pre> <br><p>  Erstellen Sie ein automatisches horizontales Skalierungswerkzeug f√ºr Bereitstellung und Herd: </p><br><pre> <code class="plaintext hljs">kubectl apply -f ${REPO}/artifacts/canaries/deployment.yaml kubectl apply -f ${REPO}/artifacts/canaries/hpa.yaml</code> </pre> <br><p>  Stellen Sie einen Testladeservice bereit, um w√§hrend der Kanarienanalyse Datenverkehr zu generieren: </p><br><pre> <code class="plaintext hljs">helm upgrade -i flagger-loadtester flagger/loadtester \ --namepace=test</code> </pre> <br><p>  Erstellen Sie eine benutzerdefinierte kanarische Ressource (ersetzen Sie <code>example.com</code> durch Ihre Domain): </p><br><pre> <code class="plaintext hljs">apiVersion: flagger.app/v1alpha3 kind: Canary metadata: name: podinfo namespace: test spec: targetRef: apiVersion: apps/v1 kind: Deployment name: podinfo progressDeadlineSeconds: 60 autoscalerRef: apiVersion: autoscaling/v2beta1 kind: HorizontalPodAutoscaler name: podinfo service: port: 9898 gateways: - public-gateway.istio-system.svc.cluster.local hosts: - app.istio.example.com canaryAnalysis: interval: 30s threshold: 10 maxWeight: 50 stepWeight: 5 metrics: - name: istio_requests_total threshold: 99 interval: 30s - name: istio_request_duration_seconds_bucket threshold: 500 interval: 30s webhooks: - name: load-test url: http://flagger-loadtester.test/ timeout: 5s metadata: cmd: "hey -z 1m -q 10 -c 2 http://podinfo.test:9898/"</code> </pre> <br><p>  Speichern Sie die oben genannte Ressource als podinfo-canary.yaml und wenden Sie sie dann an: </p><br><pre> <code class="plaintext hljs">kubectl apply -f ./podinfo-canary.yaml</code> </pre> <br><p>  Die obige Analyse wird bei Erfolg innerhalb von f√ºnf Minuten durchgef√ºhrt, wobei die HTTP-Metriken jede halbe Minute √ºberpr√ºft werden.  Sie k√∂nnen die Mindestzeit festlegen, die erforderlich ist, um eine kanarische Bereitstellung zu √ºberpr√ºfen und zu f√∂rdern, indem Sie die folgende Formel verwenden: <code>interval * (maxWeight / stepWeight)</code> .  Kanarische CRD-Felder sind <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> dokumentiert. </p><br><p>  In wenigen Sekunden erstellt Flagger kanarische Objekte: </p><br><pre> <code class="plaintext hljs"># applied deployment.apps/podinfo horizontalpodautoscaler.autoscaling/podinfo canary.flagger.app/podinfo # generated deployment.apps/podinfo-primary horizontalpodautoscaler.autoscaling/podinfo-primary service/podinfo service/podinfo-canary service/podinfo-primary virtualservice.networking.istio.io/podinfo</code> </pre> <br><p>  √ñffnen Sie einen Browser und gehen Sie zu <code>app.istio.example.com</code> . Die Versionsnummer der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Demo-Anwendung</a> sollte <code>app.istio.example.com</code> . </p><br><h3 id="avtomaticheskiy-canary-analiz-i-prodvizhenie">  Automatische Kanarienanalyse und Promotion </h3><br><p>  Flagger implementiert einen Regelkreis, der den Verkehr schrittweise auf den Kanarienvogel verlagert, w√§hrend wichtige Leistungsindikatoren gemessen werden, z. B. die Erfolgsrate von HTTP-Anforderungen, die durchschnittliche Dauer von Anforderungen und die Leistung des Herdes.  Basierend auf der Analyse wird der KPI-Kanarienvogel weiterentwickelt oder unterbrochen, und die Analyseergebnisse werden in Slack ver√∂ffentlicht. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/bw/85/ua/bw85uavib13od3yhfyv7yaqbdmo.png"></a> </p><br><p>  Die kanarische Bereitstellung beginnt, wenn sich eines der folgenden Objekte √§ndert: </p><br><ul><li>  Stellen Sie PodSpec bereit (Container-Image, Befehl, Ports, Umgebung usw.) </li><li>  ConfigMaps werden als Volumes bereitgestellt oder in Umgebungsvariablen konvertiert </li><li>  Geheimnisse werden als Volumes bereitgestellt oder in Umgebungsvariablen konvertiert </li></ul><br><p>  Starten einer kanarischen Bereitstellung beim Aktualisieren eines Container-Images: </p><br><pre> <code class="plaintext hljs">kubectl -n test set image deployment/podinfo \ podinfod=quay.io/stefanprodan/podinfo:1.4.1</code> </pre> <br><p>  Flagger stellt fest, dass sich die Bereitstellungsversion ge√§ndert hat, und beginnt mit der Analyse: </p><br><pre> <code class="plaintext hljs">kubectl -n test describe canary/podinfo Events: New revision detected podinfo.test Scaling up podinfo.test Waiting for podinfo.test rollout to finish: 0 of 1 updated replicas are available Advance podinfo.test canary weight 5 Advance podinfo.test canary weight 10 Advance podinfo.test canary weight 15 Advance podinfo.test canary weight 20 Advance podinfo.test canary weight 25 Advance podinfo.test canary weight 30 Advance podinfo.test canary weight 35 Advance podinfo.test canary weight 40 Advance podinfo.test canary weight 45 Advance podinfo.test canary weight 50 Copying podinfo.test template spec to podinfo-primary.test Waiting for podinfo-primary.test rollout to finish: 1 of 2 updated replicas are available Promotion completed! Scaling down podinfo.test</code> </pre> <br><p>  W√§hrend der Analyse k√∂nnen kanarische Ergebnisse mit Grafana verfolgt werden: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/so/xr/cr/soxrcrt3wvsgtnbwpukfwbzityy.png"></a> </p><br><p>  Bitte beachten Sie: Wenn w√§hrend der kanarischen Analyse neue √Ñnderungen an der Bereitstellung vorgenommen werden, startet Flagger die Analysephase neu. </p><br><p>  Erstellen Sie eine Liste aller "Kanarienv√∂gel" in Ihrem Cluster: </p><br><pre> <code class="plaintext hljs">watch kubectl get canaries --all-namespaces NAMESPACE NAME STATUS WEIGHT LASTTRANSITIONTIME test podinfo Progressing 15 2019-01-16T14:05:07Z prod frontend Succeeded 0 2019-01-15T16:15:07Z prod backend Failed 0 2019-01-14T17:05:07Z</code> </pre> <br><p>  Wenn Sie Slack-Benachrichtigungen aktiviert haben, erhalten Sie die folgenden Meldungen: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/xx/0v/cn/xx0vcnpcarb8nb3xivkmfz_6pfw.png"></a> </p><br><h3 id="avtomaticheskiy-otkat">  Auto Rollback </h3><br><p>  W√§hrend der Kanarienanalyse k√∂nnen Sie synthetische HTTP 500-Fehler und eine hohe Antwortverz√∂gerung generieren, um zu √ºberpr√ºfen, ob Flagger die Bereitstellung stoppt. </p><br><p>  Erstellen Sie ein Test-Sub und f√ºhren Sie die folgenden Schritte aus: </p><br><pre> <code class="plaintext hljs">kubectl -n test run tester \ --image=quay.io/stefanprodan/podinfo:1.2.1 \ -- ./podinfo --port=9898 kubectl -n test exec -it tester-xx-xx sh</code> </pre> <br><p>  HTTP 500-Fehlergenerierung: </p><br><pre> <code class="plaintext hljs">watch curl http://podinfo-canary:9898/status/500</code> </pre> <br><p>  Verz√∂gerungsgenerierung: </p><br><pre> <code class="plaintext hljs">watch curl http://podinfo-canary:9898/delay/1</code> </pre> <br><p>  Wenn die Anzahl der nicht erfolgreichen √úberpr√ºfungen den Schwellenwert erreicht, wird der Datenverkehr zur√ºck zum prim√§ren Kanal geleitet, Canary wird auf Null skaliert und die Bereitstellung wird als nicht erfolgreich markiert. </p><br><p>  Kanarische Fehler und Verz√∂gerungsspitzen werden als Kubernetes-Ereignisse protokolliert und von Flagger im JSON-Format aufgezeichnet: </p><br><pre> <code class="plaintext hljs">kubectl -n istio-system logs deployment/flagger -f | jq .msg Starting canary deployment for podinfo.test Advance podinfo.test canary weight 5 Advance podinfo.test canary weight 10 Advance podinfo.test canary weight 15 Halt podinfo.test advancement success rate 69.17% &lt; 99% Halt podinfo.test advancement success rate 61.39% &lt; 99% Halt podinfo.test advancement success rate 55.06% &lt; 99% Halt podinfo.test advancement success rate 47.00% &lt; 99% Halt podinfo.test advancement success rate 37.00% &lt; 99% Halt podinfo.test advancement request duration 1.515s &gt; 500ms Halt podinfo.test advancement request duration 1.600s &gt; 500ms Halt podinfo.test advancement request duration 1.915s &gt; 500ms Halt podinfo.test advancement request duration 2.050s &gt; 500ms Halt podinfo.test advancement request duration 2.515s &gt; 500ms Rolling back podinfo.test failed checks threshold reached 10 Canary failed! Scaling down podinfo.test</code> </pre> <br><p>  Wenn Sie Slack-Benachrichtigungen aktiviert haben, erhalten Sie eine Nachricht, wenn die Frist erreicht ist oder wenn die maximale Anzahl fehlgeschlagener √úberpr√ºfungen w√§hrend der Analyse erreicht ist: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/wo/te/dq/wotedqdhoxxyhjug_lcuy57wno0.png"></a> </p><br><h3 id="v-zaklyuchenie">  Abschlie√üend </h3><br><p>  Das Starten eines Service-Meshs wie Istio zus√§tzlich zu Kubernetes bietet automatische Metriken, Protokolle und Protokolle. Die Bereitstellung von Workloads h√§ngt jedoch weiterhin von externen Tools ab.  Flagger versucht dies zu √§ndern, indem es die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">progressiven Bereitstellungsfunktionen</a> von Istio hinzuf√ºgt. </p><br><p>  Flagger ist mit jeder Kubernetes CI / CD-L√∂sung kompatibel. Die Kanarienanalyse kann mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Webhooks</a> problemlos erweitert werden, um Systemintegrations- / Abnahmetests, Stresstests oder andere Benutzertests durchzuf√ºhren.  Da Flagger deklarativ ist und auf Kubernetes-Ereignisse reagiert, kann es in GitOps-Pipelines mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weave Flux</a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">JenkinsX verwendet werden</a> .  Wenn Sie JenkinsX verwenden, k√∂nnen Sie Flagger mit jx-Add-Ons installieren. </p><br><p>  Flagger wird von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weaveworks unterst√ºtzt</a> und bietet kanarische Bereitstellungen f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weave Cloud</a> .  Das Projekt wird auf GKE, EX und Bare Metal mit Kubeadm getestet. </p><br><p>  Wenn Sie Vorschl√§ge zur Verbesserung von Flagger haben, senden Sie bitte eine Frage oder PR an GitHub unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stefanprodan / flagger</a> .  Beitr√§ge sind herzlich willkommen! </p><br><p>  Vielen Dank, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ray Tsang</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444808/">https://habr.com/ru/post/de444808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444796/index.html">Traktor-Reverse Engineering: So beschleunigen Sie den Messvorgang um die H√§lfte</a></li>
<li><a href="../de444798/index.html">√úberblick √ºber den Frontend-Bereich auf der DUMP-Konferenz: Frontend-Entwicklung in ihrer Gesamtheit</a></li>
<li><a href="../de444800/index.html">Open Source verdient kein Geld, weil es nicht daf√ºr geschaffen wurde</a></li>
<li><a href="../de444804/index.html">BTC-e-B√∂rsenbetreiber bittet um Auslieferung an Russland</a></li>
<li><a href="../de444806/index.html">Moira nimmt an Google Summer of Code 2019 teil</a></li>
<li><a href="../de444810/index.html">Prozessoren und Marketing in der Computertechnologie</a></li>
<li><a href="../de444814/index.html">Kryptographie in Java. Klassenchiffre</a></li>
<li><a href="../de444816/index.html">DIY Zimmerei: Erwartungen und Realit√§t</a></li>
<li><a href="../de444818/index.html">Citymobil - ein Leitfaden f√ºr Startups zur Erh√∂hung der Stabilit√§t bei Wachstum. Teil 1</a></li>
<li><a href="../de444820/index.html">Mockdown: Der schnellste Weg, um Wireframes zu erstellen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>