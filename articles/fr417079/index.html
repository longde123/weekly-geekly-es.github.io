<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëâüèº üòÄ ü§∂üèº Gestionnaire de packages pour Kubernetes - Helm: Past, Present, Future ‚öñÔ∏è ü§ê ü•ò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Remarque perev. : Avec cet article, nous ouvrons une s√©rie de publications sur le gestionnaire de paquets pour Kubernetes, que nous utilisons activeme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gestionnaire de packages pour Kubernetes - Helm: Past, Present, Future</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/417079/">  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: Avec cet article, nous ouvrons une s√©rie de publications sur le gestionnaire de paquets pour Kubernetes, que nous utilisons activement dans le travail quotidien, - Helm.</i>  <i>L'auteur original du mat√©riel est Matt Butcher, l'un des fondateurs du projet Helm, travaillant sur des projets Open Source chez Microsoft et √©crivant 8 livres techniques (en particulier, ¬´Go in Practice¬ª).</i>  <i>Cependant, l'article est compl√©t√© par nos commentaires (parfois √©tendus), et sera bient√¥t d√©velopp√© avec de nouvelles notes sur Helm avec un accent plus pratique.</i>  <i><b>MISE √Ä JOUR</b> (09/03/2018): la suite est sortie - " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Connaissance pratique avec le gestionnaire de paquets pour Kubernetes - Helm</a> ".</i> <br><br><img src="https://habrastorage.org/webt/ff/1x/js/ff1xjsnvdlnfinirlwb-0p42tlo.png"><br><br>  En juin, Helm est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pass√©</a> du statut de chef de projet de Kubernetes √† la Cloud Native Computing Foundation (CNCF).  La CNCF devient l'organisation m√®re des meilleurs outils natifs du cloud open source.  Par cons√©quent, c'est un grand honneur pour Helm de faire partie d'une telle fondation.  Et notre premier projet d'envergure sous les auspices de la CNCF est v√©ritablement d'envergure: nous cr√©ons Helm 3. <a name="habracut"></a><br><br><h2>  Une br√®ve histoire de Helm </h2><br>  Helm est apparu √† l'origine comme un projet Deis Open Source.  Il a √©t√© calqu√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Homebrew</a> <i>(le gestionnaire de paquets pour macOS - <b>environ Transl.</b> )</i> , Et la t√¢che que Helm 1 avait √©tait une occasion facilit√©e pour les utilisateurs d'installer rapidement leurs premi√®res charges de travail sur Kubernetes.  L'annonce officielle de Helm a eu lieu lors de la premi√®re conf√©rence KubeCon San Francisco en 2015. <br><br>  <i><b>Remarque</b></i>  <i><b>trans.:</b> √Ä partir de la premi√®re version, qui s'appelait dm (Deployment Manager), la syntaxe YAML a √©t√© choisie pour d√©crire les ressources Kubernetes, et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®les Jinja</a> et les scripts Python √©taient pris en charge lors de l'√©criture des configurations.</i> <br><br>  <i>Un mod√®le d'application Web simple pourrait ressembler √† ceci:</i> <br><br><div class="spoiler">  <b class="spoiler_title">Yaml</b> <div class="spoiler_text"><pre><code class="plaintext hljs">resources: - name: frontend type: github.com/kubernetes/application-dm-templates/common/replicatedservice:v1 properties: service_port: 80 container_port: 80 external_service: true replicas: 3 image: gcr.io/google_containers/example-guestbook-php-redis:v3 - name: redis type: github.com/kubernetes/application-dm-templates/storage/redis:v1 properties: null</code> </pre> </div></div><br>  <i>Lors de la description des composants de l'application d√©ploy√©e, le nom, le mod√®le utilis√© ainsi que les param√®tres n√©cessaires de ce mod√®le sont indiqu√©s.</i>  <i>Dans l'exemple ci-dessus, les <code>redis</code> <code>frontend</code> et <code>redis</code> utilisent des mod√®les du r√©f√©rentiel officiel.</i> <br><br>  <i>D√©j√† dans cette version, vous pouvez utiliser les ressources d'une base de connaissances commune, cr√©er vos propres r√©f√©rentiels de mod√®les et cr√©er des applications complexes en raison des param√®tres et de l'imbrication des mod√®les.</i> <br><br>  <i>L'architecture de Helm 1 se compose de trois composants.</i>  <i>Le diagramme suivant illustre la relation entre eux:</i> <br><br><img src="https://habrastorage.org/webt/66/f8/l_/66f8l_blo_rfzohvo1wpobchuzg.png"><br><br><ol><li>  <i><code>Manager</code> remplit la fonction d'un serveur Web (la communication avec les clients se fait via l'API REST), g√®re les d√©ploiements dans le cluster Kubernetes et est utilis√© comme entrep√¥t de donn√©es.</i> </li><li>  <i>Le composant <code>expandybird</code> apporte des configurations utilisateur sous une forme plate, c'est-√†-dire</i>  <i>applique les mod√®les Jinja et ex√©cute les scripts Python.</i> </li><li>  <i>Apr√®s avoir re√ßu une configuration plate, <code>resourcifier</code> effectue les appels n√©cessaires √† kubectl et renvoie les messages d'√©tat et d'erreur, le cas √©ch√©ant, au <code>manager</code> .</i> </li></ol><br>  <i>Pour comprendre les capacit√©s de la premi√®re version de Helm, je vais vous aider sur la commande <code>dm</code></i> : <div class="spoiler">  <b class="spoiler_title">Aide sortie de dm</b> <div class="spoiler_text"><pre> <code class="bash hljs">Usage: ./dm [&lt;flags&gt;] &lt;<span class="hljs-built_in"><span class="hljs-built_in">command</span></span>&gt; [(&lt;template-name&gt; | &lt;deployment-name&gt; | (&lt;configuration&gt; [&lt;import1&gt;...&lt;importN&gt;]))] Commands: expand Expands the supplied configuration(s) deploy Deploys the named template or the supplied configuration(s) list Lists the deployments <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the cluster get Retrieves the supplied deployment manifest Lists manifests <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deployment or retrieves the supplied manifest <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the form (deployment[/manifest]) delete Deletes the supplied deployment update Updates a deployment using the supplied configuration(s) deployed-types Lists the types deployed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the cluster deployed-instances Lists the instances of the named <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> deployed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the cluster templates Lists the templates <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a given template registry (specified with --registry) registries Lists the registries available describe Describes the named template <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a given template registry getcredential Gets the named credential used by a registry setcredential Sets a credential used by a registry createregistry Creates a registry that holds charts Flags: -apitoken string Github api token that overrides GITHUB_API_TOKEN environment variable -binary string Path to template expansion binary (default <span class="hljs-string"><span class="hljs-string">"../expandybird/expansion/expansion.py"</span></span>) -httptest.serve string <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> non-empty, httptest.NewServer serves on this address and blocks -name string Name of deployment, used <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deploy and update commands (defaults to template name) -password string Github password that overrides GITHUB_PASSWORD environment variable -properties string Properties to use when deploying a template (eg, --properties k1=v1,k2=v2) -regex string Regular expression to filter the templates listed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> a template registry -registry string Registry name (default <span class="hljs-string"><span class="hljs-string">"application-dm-templates"</span></span>) -registryfile string File containing registry specification -service string URL <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> deployment manager (default <span class="hljs-string"><span class="hljs-string">"http://localhost:8001/api/v1/proxy/namespaces/dm/services/manager-service:manager"</span></span>) -serviceaccount string Service account file containing JWT token -stdin Reads a configuration from the standard input -timeout int Time <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> seconds to <span class="hljs-built_in"><span class="hljs-built_in">wait</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> response (default 20) -username string Github user name that overrides GITHUB_USERNAME environment variable --stdin requires a file name and either the file contents or a tar archive containing the named file. a tar archive may include any additional files referenced directly or indirectly by the named file.</code> </pre></div></div><br>  <i>Et maintenant, revenons au texte original sur l'histoire de Helm ...</i> <br><br>  Quelques mois plus tard, nous nous sommes associ√©s √† l'√©quipe Kubernetes Deployment Manager de Google et avons commenc√© √† travailler sur Helm 2. L'objectif √©tait de garder Helm facile √† utiliser en ajoutant les √©l√©ments suivants: <br><br><ol><li>  mod√®les de graphiques <i>(¬´graphique¬ª - un analogue d'un package dans l'√©cosyst√®me Helm - <b>traduction approximative</b> )</i> pour la personnalisation; </li><li>  gestion de cluster pour les √©quipes; </li><li>  d√©p√¥t de cartes complet; </li><li>  format de package stable et sign√©; </li><li>  engagement fort envers le versioning s√©mantique et le maintien de la compatibilit√© descendante d'une version √† l'autre </li></ol><br>  Pour atteindre ces objectifs, une deuxi√®me composante a √©t√© ajout√©e √† l'√©cosyst√®me Helm.  Il est devenu le cluster Tiller interne, qui a fourni l'installation des cartes Helm et leur gestion. <br><br>  <i><b>Remarque</b></i>  <i><b>perev.:</b> Ainsi, dans la deuxi√®me version de Helm, le seul composant restant dans le cluster est responsable du cycle de vie de l'installation ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">version</a> ) et la pr√©paration de la configuration est soumise au client Helm.</i> <br><br>  <i>Si le red√©marrage du cluster lors de l'utilisation de la premi√®re version de Helm entra√Ænait une perte compl√®te des donn√©es de service (car elles √©taient stock√©es dans la RAM), alors dans Helm 2 toutes les donn√©es sont stock√©es dans <code>ConfigMaps</code> , c'est-√†-dire</i>  <i>ressources √† l'int√©rieur de Kubernetes.</i>  <i>Une autre √©tape importante a √©t√© la transition d'une API synchrone (o√π chaque requ√™te bloquait) √† l'utilisation de gRPC asynchrone.</i> <br><br>  Depuis le lancement de Helm 2 en 2016, le projet Kubernetes a connu une croissance explosive et de nouvelles opportunit√©s importantes.  Le contr√¥le d'acc√®s bas√© sur les r√¥les (RBAC) a √©t√© ajout√©.  De nombreux nouveaux types de ressources sont introduits.  Ressources tierces invent√©es (d√©finitions de ressources personnalis√©es, CRD).  Et surtout, il existe des meilleures pratiques.  En passant par tous ces changements, Helm a continu√© de r√©pondre aux besoins des utilisateurs de Kubernetes.  Mais il est devenu clair pour nous qu'il √©tait temps d'y apporter des changements majeurs afin que les besoins de cet √©cosyst√®me en d√©veloppement continuent d'√™tre satisfaits. <br><br>  Nous sommes donc arriv√©s √† Helm 3. Ensuite, je vais parler de certaines des innovations pr√©sent√©es dans la feuille de route du projet. <br><br><h2>  Salutations Lua </h2><br>  Dans Helm 2, nous avons introduit des mod√®les.  Au d√©but du d√©veloppement de Helm 2, nous avons pris en charge Go, les mod√®les Jinja, le code Python propre et nous avions m√™me un prototype de prise en charge de ksonnet.  Mais la pr√©sence de nombreux moteurs de mod√®les a pos√© plus de probl√®mes qu'elle n'en a r√©solu.  Par cons√©quent, nous sommes arriv√©s au point d'en choisir un. <br><br>  Les mod√®les Go ont quatre avantages: <br><br><ol><li>  la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">est int√©gr√©e √† Go</a> ; </li><li>  les mod√®les sont ex√©cut√©s dans un environnement sandbox strictement limit√©; </li><li>  nous pourrions ins√©rer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des fonctions et des objets arbitraires</a> dans le moteur; </li><li>  ils ont bien travaill√© avec YAML. </li></ol><br>  Bien que nous ayons conserv√© l'interface dans Helm pour prendre en charge d'autres moteurs de mod√®les, les mod√®les Go sont devenus notre standard par d√©faut.  Et les quelques ann√©es d'exp√©rience suivantes ont montr√© comment les ing√©nieurs de nombreuses entreprises ont cr√©√© des milliers de graphiques √† l'aide de mod√®les Go. <br><br>  Et nous avons appris leurs d√©ceptions: <br><br><ol><li>  La syntaxe est difficile √† lire et mal document√©e. </li><li>  Les probl√®mes de langue, tels que les variables immuables, les types de donn√©es complexes et les r√®gles de visibilit√© restrictives, ont transform√© des choses simples en des choses complexes. </li><li>  L'incapacit√© √† d√©finir des fonctions dans les mod√®les a rendu la cr√©ation de biblioth√®ques r√©utilisables encore plus difficile. </li></ol><br>  Plus important encore, en utilisant le langage de mod√®le, nous avons ¬´tronqu√©¬ª les objets Kubernetes √† leur repr√©sentation lin√©aire.  (En d'autres termes, les d√©veloppeurs de mod√®les devaient g√©rer les ressources Kubernetes en tant que documents texte au format YAML.) <br><br><h2>  Travailler sur des objets, pas sur des morceaux de YAML </h2><br>  Maintes et maintes fois, nous avons entendu des utilisateurs une demande pour la possibilit√© d'inspecter et de modifier les ressources Kubernetes en tant qu'objets, pas de cha√Ænes.  Dans le m√™me temps, ils √©taient convaincus que quel que soit le mode de mise en ≈ìuvre que nous choisissions pour cela, il devrait √™tre facile √† apprendre et bien entretenu dans l'√©cosyst√®me. <br><br>  Apr√®s des mois de recherche, nous avons d√©cid√© de fournir un langage de script int√©gr√© qui peut √™tre emball√© dans un bac √† sable et personnalis√©.  Parmi les 20 premi√®res langues, un seul candidat satisfaisait aux exigences: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lua</a> . <br><br>  En 1993, un groupe d'ing√©nieurs informatiques br√©siliens a cr√©√© un langage de script l√©ger pour l'int√©gration dans leurs outils.  Lua a une syntaxe simple, elle est largement prise en charge et figure depuis longtemps dans la liste des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">20 meilleures langues</a> .  Il est pris en charge par l'EDI et les √©diteurs de texte, il existe de nombreux manuels et tutoriels.  Sur un tel √©cosyst√®me existant, nous souhaitons d√©velopper notre solution. <br><br>  Notre travail sur Helm Lua est encore au stade de la preuve conceptuelle, et nous nous attendons √† une syntaxe √† la fois famili√®re et flexible.  En comparant les anciennes et les nouvelles approches, vous pouvez voir o√π nous allons. <br><br>  Voici <a href="">un exemple</a> de mod√®le de foyer avec Alpine dans Helm 2: <br><br><pre> <code class="plaintext hljs">apiVersion: v1 kind: Pod metadata: name: {{ template "alpine.fullname" . }} labels: heritage: {{ .Release.Service }} release: {{ .Release.Name }} chart: {{ .Chart.Name }}-{{ .Chart.Version }} app: {{ template "alpine.name" . }} spec: restartPolicy: {{ .Values.restartPolicy }} containers: - name: waiter image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}" imagePullPolicy: {{ .Values.image.pullPolicy }} command: ["/bin/sleep", "9000"]</code> </pre> <br>  Dans ce mod√®le simple, vous pouvez imm√©diatement voir toutes les directives de mod√®le int√©gr√©es, telles que <code>{{ .Chart.Name }}</code> . <br><br>  Et voici la d√©finition du m√™me foyer dans la version pr√©liminaire du code Lua: <br><br><pre> <code class="lua hljs">unction create_alpine_pod(_) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pod = { apiVersion = <span class="hljs-string"><span class="hljs-string">"v1"</span></span>, kind = <span class="hljs-string"><span class="hljs-string">"Pod"</span></span>, metadata = { name = alpine_fullname(_), labels = { heritage = _.Release.Service <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"helm"</span></span>, release = _.Release.Name, chart = _.Chart.Name .. <span class="hljs-string"><span class="hljs-string">"-"</span></span> .. _.Chart.Version, app = alpine_name(_) } }, spec = { restartPolicy = _.Values.restartPolicy, containers = { { name = waiter, image = _.Values.image.repository .. <span class="hljs-string"><span class="hljs-string">":"</span></span> .. _.Values.image.tag, imagePullPolicy = _.Values.image.pullPolicy, command = { <span class="hljs-string"><span class="hljs-string">"/bin/sleep"</span></span>, <span class="hljs-string"><span class="hljs-string">"9000"</span></span> } } } } } _.resources.add(pod) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Il n'est pas n√©cessaire de regarder chaque ligne de cet exemple pour comprendre ce qui se passe.  Il est imm√©diatement √©vident que dans le code, il est d√©fini sous.  Mais au lieu d'utiliser des cha√Ænes YAML avec des directives de mod√®le int√©gr√©es, nous le d√©finissons comme un objet dans Lua. <br><br><h2>  Raccourcissons ce code </h2><br>  √âtant donn√© que nous travaillons directement avec des objets (au lieu de manipuler une grande quantit√© de texte), nous pouvons tirer pleinement parti des scripts.  Les opportunit√©s de cr√©er des biblioth√®ques partag√©es qui apparaissent ici semblent vraiment attrayantes.  Et nous esp√©rons qu'en introduisant des biblioth√®ques sp√©cialis√©es (ou en permettant √† la communaut√© de les cr√©er), nous pourrons r√©duire le code ci-dessus √† quelque chose comme ceci: <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> pods = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"mylib.pods"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_alpine_pod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_)</span></span></span></span> myPod = pods.new(<span class="hljs-string"><span class="hljs-string">"alpine:3.7"</span></span>, _) myPod.spec.restartPolicy = <span class="hljs-string"><span class="hljs-string">"Always"</span></span> <span class="hljs-comment"><span class="hljs-comment">-- set any other properties _.Manifests.add(myPod) end</span></span></code> </pre> <br>  Dans cet exemple, nous utilisons la possibilit√© de travailler avec la d√©finition d'une ressource en tant qu'objet, ce qui est facile √† d√©finir des propri√©t√©s, tout en conservant la concision et la lisibilit√© du code. <br><br><h2>  Mod√®les ... Lua ... Pourquoi pas tous ensemble? </h2><br>  Bien que les mod√®les ne soient pas si merveilleux pour toutes les t√¢ches, ils pr√©sentent n√©anmoins certains avantages.  Templates in Go est une technologie stable avec une base d'utilisateurs √©tablie et de nombreux graphiques existants.  De nombreux d√©veloppeurs de graphiques pr√©tendent aimer √©crire des mod√®les.  Par cons√©quent, nous n'allons pas supprimer la prise en charge des mod√®les. <br><br>  Au lieu de cela, nous voulons autoriser l'utilisation simultan√©e des mod√®les et de Lua.  Les scripts Lua auront acc√®s aux mod√®les Helm avant et apr√®s leur rendu, ce qui permettra aux d√©veloppeurs de graphiques avanc√©s d'effectuer des transformations complexes sur les graphiques existants, tout en conservant la possibilit√© simple de cr√©er des graphiques Helm avec des mod√®les. <br><br>  Nous sommes tr√®s encourag√©s par le support des scripts sur Lua, mais en m√™me temps nous nous d√©barrassons d'une partie importante de l'architecture Helm ... <br><br><h2>  Dire au revoir √† Tiller </h2><br>  Pendant le d√©veloppement de Helm 2, nous avons introduit Tiller en tant que composant d'int√©gration avec Deployment Manager.  Tiller a jou√© un r√¥le important pour les √©quipes travaillant sur le m√™me cluster: il a permis d'interagir avec le m√™me ensemble de versions pour de nombreux administrateurs diff√©rents. <br><br>  Cependant, Tiller a agi comme un serveur sudo g√©ant, accordant un large √©ventail de droits √† tous ceux qui ont acc√®s √† Tiller.  Et notre sch√©ma d'installation par d√©faut √©tait une configuration permissive.  Par cons√©quent, les ing√©nieurs DevOps et SRE ont d√ª apprendre les √©tapes suppl√©mentaires pour installer Tiller dans des clusters multi-locataires. <br><br>  De plus, avec l'av√®nement de CRD, nous ne pouvions plus compter de mani√®re fiable sur Tiller pour maintenir l'√©tat ou fonctionner comme un hub central pour les informations de publication de Helm.  Nous ne pouvions stocker ces informations que dans des entr√©es distinctes dans Kubernetes. <br><br>  L'objectif principal de Tiller peut √™tre atteint sans Tiller lui-m√™me.  Par cons√©quent, l'une des premi√®res d√©cisions prises pendant la phase de planification de Helm 3 a √©t√© d'abandonner compl√®tement Tiller. <br><br><h2>  Am√©lioration de la s√©curit√© </h2><br>  Sans Tiller, le mod√®le de s√©curit√© Helm est radicalement simplifi√©.  L'authentification des utilisateurs est d√©l√©gu√©e par Kubernetes.  Et l'autorisation aussi.  Les droits Helm sont d√©finis comme des droits Kubernetes (via RBAC), et les administrateurs de cluster peuvent restreindre les droits Helm √† tout niveau de d√©tail requis. <br><br><h2>  Versions, versions de versions et stockage d'√©tat </h2><br>  En l'absence de Tiller, pour maintenir l'√©tat des diff√©rentes versions au sein du cluster, nous avons besoin d'une nouvelle fa√ßon pour tous les clients d'interagir (sur la gestion des versions). <br><br>  Pour ce faire, nous avons introduit deux nouvelles entr√©es: <br><br><ol><li>  <code>Release</code> - pour une installation sp√©cifique d'un graphique particulier.  Si nous ex√©cutons <code>helm install my-wordpress stable/wordpress</code> , une version appel√©e <code>my-wordpress</code> sera cr√©√©e et maintenue tout au long de la vie de cette installation WordPress. </li><li>  <code>ReleaseVersion</code> - chaque fois que vous mettez √† jour le graphique Helm, vous devez consid√©rer ce qui a chang√© et si le changement a r√©ussi.  <code>ReleaseVersion</code> li√©e √† une version et stocke uniquement les enregistrements contenant des informations sur la mise √† jour, la <code>ReleaseVersion</code> et la suppression.  Lorsque nous ex√©cutons <code>helm upgrade my-wordpress stable/wordpress</code> , l'objet <code>Release</code> origine reste le m√™me, mais un objet <code>ReleaseVersion</code> enfant <code>ReleaseVersion</code> avec des informations sur l'op√©ration de mise √† jour. </li></ol><br>  <code>Releases</code> et <code>Releases</code> <code>ReleaseVersions</code> seront stock√©es dans les m√™mes espaces de noms que les objets du graphique. <br><br>  Gr√¢ce √† ces fonctionnalit√©s, les √©quipes d'utilisateurs Helm pourront suivre les enregistrements des installations Helm dans le cluster sans avoir besoin de Tiller. <br><br><h2>  Mais attendez, ce n'est pas tout! </h2><br>  Dans cet article, j'ai essay√© de parler de certains des changements majeurs dans Helm 3. Cependant, cette liste n'est pas du tout compl√®te.  <a href="">Le plan Helm 3</a> comprend <a href="">√©galement d'</a> autres modifications, telles que des am√©liorations du format de graphique, des am√©liorations de performances pour les r√©f√©rentiels de graphiques et un nouveau syst√®me d'√©v√©nements que les d√©veloppeurs de graphiques peuvent utiliser.  Nous cr√©ons √©galement Eric Raymond appel√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">arch√©ologie du code en</a> nettoyant la base de code et en mettant √† jour les composants qui ont perdu de leur pertinence au cours des trois derni√®res ann√©es. <br><br>  <i><b>Remarque</b></i>  <i><b>perev.</b></i>  <i>: C'est un paradoxe, mais le gestionnaire de packages Helm 2, lorsque l' <code>install</code> ou la <code>upgrade</code> r√©ussie, c'est-√†-dire</i>  <i>avoir une version en √©tat de <code>success</code> ne garantit pas que les ressources d'application ont √©t√© d√©ploy√©es avec succ√®s (par exemple, il n'y a pas d'erreurs comme <code>ImagePullError</code> ).</i>  <i>Peut-√™tre que le nouveau mod√®le d'√©v√©nement vous permettra d'ajouter des crochets suppl√©mentaires pour les ressources et de mieux contr√¥ler le processus de d√©ploiement - nous le saurons bient√¥t.</i> <br><br>  Avec l'accession de Helm √† CNCF, non seulement Helm 3, mais aussi le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chart Museum</a> , le merveilleux utilitaire de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">test de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cartes, le r√©f√©rentiel de cartes officiel</a> et d'autres projets sous les auspices de Helm √† CNCF nous inspirent.  Nous sommes convaincus qu'une bonne gestion des packages pour Kubernetes est tout aussi importante pour l'√©cosyst√®me natif du cloud que les bons gestionnaires de packages pour Linux. <br><br><h2>  PS du traducteur </h2><br>  Lisez aussi dans notre blog: <br><br><ul><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une introduction pratique au gestionnaire de paquets pour Kubernetes - Helm</a> ¬ª; </li><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pratique avec dapp.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 2. D√©ploiement d'images Docker dans Kubernetes √† l'aide de Helm</a> "; </li><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©er et installer des applications dans Kubernetes √† l'aide de dapp et GitLab CI</a> ¬ª; </li><li>  ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Meilleures pratiques CI / CD avec Kubernetes et GitLab</a> ¬ª <i>(revue et rapport vid√©o)</i> ; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Notre exp√©rience avec Kubernetes dans les petits projets</a> " <i>(reportage vid√©o, qui comprend une introduction au dispositif technique Kubernetes).</i> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417079/">https://habr.com/ru/post/fr417079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417065/index.html">Splunk How-to, ou comment et o√π apprendre Splunk</a></li>
<li><a href="../fr417069/index.html">Encore une fois √† propos d'OpenSSL</a></li>
<li><a href="../fr417071/index.html">Vendredi PHP: Webinaires Skillbox gratuits</a></li>
<li><a href="../fr417073/index.html">Uber Mobile Developer Day</a></li>
<li><a href="../fr417075/index.html">API de peinture CSS</a></li>
<li><a href="../fr417081/index.html">Nord, volont√©, espoir, pays sans fronti√®res, ou comment les projets sont r√©alis√©s dans des conditions sib√©riennes s√©v√®res</a></li>
<li><a href="../fr417083/index.html">Fortes charges de la Coupe du monde 2018</a></li>
<li><a href="../fr417085/index.html">Les navigateurs coupent le son dans votre application WebRTC. Arr√™te quoi?</a></li>
<li><a href="../fr417087/index.html">HPE Digitize 2018: √©v√©nement et diffusion en direct</a></li>
<li><a href="../fr417089/index.html">Ordinateur quantique: un photon pour tout gouverner</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>