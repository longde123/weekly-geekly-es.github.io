<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµüèø üíá üì∑ Teil 3: Linux fast von einer SD-Karte auf RocketChip laden üì• üßõüèº üôÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im vorherigen Teil wurde ein mehr oder weniger funktionierender Speichercontroller implementiert, oder vielmehr ein Wrapper √ºber IP Core von Quartus, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Teil 3: Linux fast von einer SD-Karte auf RocketChip laden</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458482/"><p><img src="https://habrastorage.org/webt/4j/fu/lu/4jfulumeapi32exqv7d6vnseaho.png" width="45%" align="left">  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Teil</a> wurde ein mehr oder weniger funktionierender Speichercontroller implementiert, oder vielmehr ein Wrapper √ºber IP Core von Quartus, einem Adapter f√ºr TileLink.  Heute sehen Sie unter der √úberschrift ‚ÄûWir portieren RocketChip mit einem Cyclone auf ein wenig bekanntes chinesisches Motherboard‚Äú eine funktionierende Konsole.  Der Prozess zog sich ein wenig hin: Ich dachte bereits, ich w√ºrde Linux schnell starten und weitermachen, aber es war nicht da.  In diesem Teil m√∂chte ich den Prozess des Startens von U-Boot-, BBL- und sch√ºchternen Linux-Kernel-Initialisierungsversuchen untersuchen.  Aber es gibt eine Konsole - U-Boot-ovsky, die ziemlich fortgeschritten ist und viel von dem bietet, was Sie von einer vollwertigen Konsole erwarten. </p><br><p> In der Hardware wird eine √ºber SPI angeschlossene SD-Karte sowie UART hinzugef√ºgt.  Im Softwareteil wird BootROM von <code>xip</code> auf <code>sdboot</code> und tats√§chlich werden die folgenden <code>sdboot</code> (auf der SD-Karte) hinzugef√ºgt. </p><a name="habracut"></a><br><h2 id="dopilivanie-apparatnoy-chasti">  Doping der Hardware </h2><br><p>  Die Aufgabe: Sie m√ºssen zum "gro√üen" Kern wechseln und den UART (von Raspberry) und den SD-Adapter verbinden (es wurde eine Art Catalex-Karte mit sechs Pins verwendet: GND, VCC, MISO, MOSI, SCK, CS). </p><br><p>  Im Prinzip war alles ganz einfach.  Aber bevor ich das merkte, wurde ich ein wenig hin und her geworfen: Nach dem vorherigen Mal entschied ich, dass Sie wieder nur etwas wie <code>HasPeripheryUART</code> in das <code>System</code> mischen m√ºssen (und die Implementierung entsprechend), dasselbe f√ºr die SD-Karte - und das war's wird bereit sein.  Dann habe ich mich entschlossen zu sehen, wie es in einem ‚Äûseri√∂sen‚Äú Design implementiert wurde.  Was haben wir aus Ernst gemacht?  Arty passt anscheinend nicht - das Monster bleibt <code>unleahshed.DevKitConfigs</code> .  Und pl√∂tzlich stellte sich heraus, dass es √ºberall √úberlagerungen gab, die durch die Parameter durch Schl√ºssel hinzugef√ºgt wurden.  Ich denke, dass dies wahrscheinlich sehr flexibel und konfigurierbar ist, aber ich m√∂chte zun√§chst etwas anfangen ... <em>Aber Sie haben nicht die gleichen, nur einfacheren Kr√ºcken? ..</em> Dann bin ich auf <code>vera.iofpga.FPGAChip</code> f√ºr FPGAs Microsemi und <del>  sofort in Anf√ºhrungszeichen gezogen </del>  Ich habe versucht, meine Implementierung analog durchzuf√ºhren. Der Vorteil hierbei ist mehr oder weniger das gesamte "Motherboard-Layout" in einer Datei. </p><br><p>  Es stellte sich heraus, dass Sie <code>System.scala</code> nur Zeilen hinzuf√ºgen <code>System.scala</code> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">System</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketSubsystem</span></span></span><span class="hljs-class"> ... </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripherySPI</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryUART</span></span></span><span class="hljs-class"> ... </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> tlclock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FixedClockResource</span></span>(<span class="hljs-string"><span class="hljs-string">"tlclk"</span></span>, p(<span class="hljs-type"><span class="hljs-type">DevKitFPGAFrequencyKey</span></span>)) ... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SystemModule</span></span></span><span class="hljs-class">[+</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">L</span></span></span><span class="hljs-class"> &lt;: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">System</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">L</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RocketSubsystemModuleImp</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">_outer</span></span></span><span class="hljs-class">) ... </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryUARTModuleImp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasPeripheryGPIOModuleImp</span></span></span><span class="hljs-class"> ...</span></span></code> </pre> <br><p>  Eine Zeile im Hauptteil der <code>System</code> Klasse f√ºgt der dts-Datei Informationen √ºber die H√§ufigkeit hinzu, mit der dieser Teil unseres SoC arbeitet.  Soweit ich wei√ü, ist DTS / DTB ein statisches Analogon der Plug-and-Play-Technologie f√ºr eingebettete Ger√§te: Der dts-description-Baum wird in eine bin√§re dtb-Datei kompiliert und vom Loader an den Kernel √ºbertragen, damit die Hardware ordnungsgem√§√ü konfiguriert werden kann.  Interessanterweise ist ohne eine Zeile mit <code>tlclock</code> alles perfekt synthetisiert, aber es funktioniert nicht, um BootROM zu kompilieren (ich werde Sie daran erinnern, dass es jetzt <code>sdboot</code> ) - w√§hrend der Kompilierung wird die dts-Datei analysiert und ein Header mit dem <code>TL_CLK</code> Makro erstellt, f√ºr das Frequenzteiler korrekt konfiguriert werden k√∂nnen externe Schnittstellen. </p><br><p>  Sie m√ºssen auch die ‚ÄûVerkabelung‚Äú leicht reparieren: </p><br><p>  <strong>Platform.scala:</strong> </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlatformIO</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">implicit val p: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Parameters</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bundle</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">// UART io.uart_tx := sys.uart(0).txd sys.uart(0).rxd := RegNext(RegNext(io.uart_rx)) // SD card io.sd_cs := sys.spi(0).cs(0) io.sd_sck := sys.spi(0).sck io.sd_mosi := sys.spi(0).dq(0).o sys.spi(0).dq(0).i := false.B sys.spi(0).dq(1).i := RegNext(RegNext(io.sd_miso)) sys.spi(0).dq(2).i := false.B sys.spi(0).dq(3).i := false.B }</span></span></code> </pre> <br><p>  Offen gesagt wurden Registerketten einfach analog zu einigen anderen Stellen im Quellcode hinzugef√ºgt.  H√∂chstwahrscheinlich sollten sie vor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Metastabilit√§t</a> sch√ºtzen.  Vielleicht haben <em>einige</em> Bl√∂cke bereits einen eigenen Schutz, aber zuerst m√∂chte ich zumindest "auf hohem Niveau" laufen.  Eine interessantere Frage f√ºr mich ist, warum MISO und MOSI an unterschiedlichen <code>dq</code> h√§ngen.  Ich habe die Antwort immer noch nicht gefunden, aber es scheint, dass der Rest des Codes auf eine solche Verbindung setzt. </p><br><p>  Physikalisch habe ich gerade die Konstruktionsschlussfolgerungen den losen Kontakten am Block zugewiesen und den Spannungsauswahl-Jumper auf 3,3 V umgestellt. </p><br><div class="spoiler">  <b class="spoiler_title">SD-Adapter</b> <div class="spoiler_text"><p>  Blick von oben: </p><br><img src="https://habrastorage.org/webt/su/zf/q4/suzfq4lwejcelmwt3rpk5w_min0.jpeg"><br><p>  Ansicht von unten: </p><br><img src="https://habrastorage.org/webt/y0/__/qq/y0__qqavfhkikpsorvmzqhbamlw.jpeg"></div></div><br><h2 id="otladka-programmnoy-chasti-instrumenty">  Debuggen des Software-Teils: Tools </h2><br><p>  Lassen Sie uns zun√§chst √ºber die verf√ºgbaren Debugging-Tools und ihre Einschr√§nkungen sprechen. </p><br><h3 id="minicom">  Minicom </h3><br><p>  Zuerst m√ºssen wir irgendwie lesen, was der Bootloader und der Kernel ausgeben.  Dazu ben√∂tigen wir unter Linux (in diesem Fall unter RaspberryPi) das Minicom-Programm.  Im Allgemeinen ist jedes Programm zum Arbeiten mit einer seriellen Schnittstelle geeignet. </p><br><p>  Beachten Sie, dass beim Start der Name des <code>-D /dev/ttyS0</code> nach der Option <code>-D</code> als <code>-D /dev/ttyS0</code> angegeben werden muss.  Nun, die wichtigsten Informationen: Verwenden Sie zum Beenden <code>Ctrl-A, X</code>  Ich hatte wirklich einen Fall, in dem diese Kombination nicht funktionierte - dann kann man einfach <code>killall -KILL minicom</code> aus einer benachbarten SSH-Sitzung sagen. </p><br><p>  Es gibt noch eine andere Funktion.  Insbesondere gibt es zwei UARTs auf RaspberryPi, und beide Ports k√∂nnen bereits f√ºr etwas angepasst werden: einer f√ºr Bluetooth, √ºber den anderen wird die Kernelkonsole standardm√§√üig angezeigt.  Gl√ºcklicherweise kann dieses Verhalten <a href="">gem√§√ü diesem Handbuch</a> neu konfiguriert <a href="">werden</a> . </p><br><h3 id="perepisyvanie-pamyati">  Speicher umschreiben </h3><br><p>  Beim Debuggen musste ich zum Testen der Hypothese manchmal <em>den Bootloader</em> (sorry) direkt vom Host in den RAM <em>laden</em> .  Vielleicht kann dies direkt von GDB aus erfolgen, aber am Ende ging ich den einfachen Weg: Ich kopierte die erforderliche Datei nach Raspberry, schickte auch Port 4444 (Telnet von OpenOCD) √ºber SSH und verwendete den Befehl <code>load_image</code> .  Wenn Sie es ausf√ºhren, scheint alles eingefroren zu sein, aber in Wirklichkeit <em>"schl√§ft es nicht, es blinkt nur langsam"</em> : Es l√§dt die Datei, es macht es nur mit einer Geschwindigkeit von ein paar Kilobyte pro Sekunde. </p><br><h3 id="osobennosti-ustanovki-breakpoint-ov">  Funktionen zum Installieren von Haltepunkten </h3><br><p>  Wahrscheinlich mussten viele beim Debuggen regul√§rer Programme nicht dar√ºber nachdenken, aber Haltepunkte werden nicht immer in der Hardware festgelegt.  Manchmal erfordert das Setzen eines Haltepunkts das vor√ºbergehende Schreiben einer speziellen Anweisung an die richtige Stelle <strong>direkt im Maschinencode</strong> .  So funktionierte beispielsweise mein Standardbefehl <code>b</code> in GDB.  Folgendes folgt daraus: </p><br><ul><li>  Sie k√∂nnen keinen Punkt in BootROM einf√ºgen, da ROM </li><li>  Sie k√∂nnen einen Haltepunkt f√ºr den von der SD-Karte in den RAM geladenen Code festlegen, m√ºssen jedoch warten, bis er geladen ist.  Andernfalls schreiben wir keinen Code neu, aber der Loader schreibt unseren Haltepunkt neu </li></ul><br><p>  Ich bin sicher, dass Sie explizit nach der Verwendung von Hardware-Haltepunkten fragen k√∂nnen, aber es gibt trotzdem eine begrenzte Anzahl davon. </p><br><h3 id="bystraya-podmena-bootrom">  Schneller BootROM-Austausch </h3><br><p>  In der Anfangsphase des Debuggens besteht h√§ufig der Wunsch, BootROM zu reparieren und es erneut zu versuchen.  Es gibt jedoch ein Problem: BootROM ist Teil des in das FPGA geladenen Designs, und seine Synthese dauert einige Minuten (und dies geschieht, nachdem das BootROM-Image selbst fast sofort aus C und Assembler kompiliert wurde ...).  Gl√ºcklicherweise ist tats√§chlich alles <strong>viel schneller</strong> : Die Abfolge der Aktionen ist wie folgt: </p><br><ul><li>  bootrom.mif neu generieren (Ich habe zu MIF anstelle von HEX gewechselt, weil ich mit HEX immer einige Probleme hatte und MIF das native Alter-Format ist.) </li><li>  in Quartus sagen <code>Processing -&gt; Update Memory Initialization File</code> </li><li>  Geben Sie in Assembler (in der linken Spalte von Tasks) den Befehl Start erneut ein </li></ul><br><p>  F√ºr alles √ºber alles - ein paar zehn Sekunden. </p><br><h2 id="podgotovka-sd-karty">  SD-Kartenvorbereitung </h2><br><p>  Hier ist alles relativ einfach, aber Sie m√ºssen geduldig sein und √ºber etwa 14 GB Festplattenspeicher verf√ºgen: </p><br><pre> <code class="plaintext hljs">git clone https://github.com/sifive/freedom-u-sdk git submodule update --recursive --init make</code> </pre> <br><p>  Dann m√ºssen Sie eine saubere SD-Karte einlegen, die keine ben√∂tigte SD-Karte enth√§lt, und diese ausf√ºhren </p><br><pre> <code class="plaintext hljs">sudo make DISK=/dev/sdX format-boot-loader</code> </pre> <br><p>  ... wobei <code>sdX</code> das der Karte zugewiesene Ger√§t ist.  <strong>ACHTUNG: Die Daten auf der Karte werden gel√∂scht, √ºberschrieben und generell!</strong>  Es lohnt sich kaum, die gesamte Assembly unter <code>sudo</code> , da dann alle Assembly-Artefakte im Besitz von <code>root</code> sind und die Assembly die <code>sudo</code> Zeit unter <code>sudo</code> werden muss. </p><br><p>  Das Ergebnis ist eine in GPT markierte Karte mit vier Abschnitten, von denen einer FAT mit <code>uEnv.txt</code> und ein herunterladbares Bild im FIT-Format ist (es enth√§lt mehrere Teilbilder mit jeweils einer eigenen Download-Adresse). Der andere Abschnitt ist leer und soll in Ext4 formatiert sein f√ºr Linux.  Zwei weitere Abschnitte sind <em>kryptisch</em> : U-Boot lebt auf einem (sein Offset ist, wie ich es verstehe, in BootROM verkabelt), auf dem anderen scheint es, dass seine Umgebungsvariablen leben, aber ich benutze sie noch nicht. </p><br><h2 id="uroven-pervyy-bootrom">  Stufe Eins, BootROM </h2><br><p>  Volksweisheit sagt: "Wenn es beim Programmieren T√§nze mit einem Tamburin gibt, dann in der Elektronik - auch mit einem Feuerl√∂scher."  Es ist nicht einmal so, dass ich, als ich das Board fast verbrannt h√§tte, entschieden habe, dass "Nun, GND ist der gleiche niedrige Pegel" <em>(anscheinend w√ºrde der Widerstand immer noch nicht schaden ...).</em> Es geht mehr um die Tatsache, dass wenn Von dort wachsen keine H√§nde, und die Elektronik bringt immer wieder √úberraschungen: Als ich den Stecker auf die Platine gel√∂tet habe, konnte ich die Kontakte immer noch nicht normal aufl√∂sen. Das Video zeigt, wie sich das Lot direkt √ºber die Verbindung verteilt. Tragen Sie einfach den L√∂tkolben auf. Ich habe ihn "ausgel√∂scht". jedenfalls.  Nun, vielleicht war das Lot nicht f√ºr die Temperatur des L√∂tkolbens geeignet, vielleicht etwas anderes ... Als ich sah, dass ich bereits ein Dutzend Kontakte hatte, spuckte ich im Allgemeinen aus und begann zu debuggen.  Und dann begann eine <em>mysteri√∂se</em> Sache: Ich habe RX / TX von UART aus verbunden, ich lade die Firmware - sie schreibt </p><br><pre> <code class="plaintext hljs">INIT CMD0 ERROR</code> </pre> <br><p>  Nun, alles ist logisch - ich habe das SD-Kartenmodul nicht angeschlossen.  Wir beheben die Situation, laden die Firmware ... und schweigen ... Was ich gerade nicht ge√§ndert habe, und der Sarg √∂ffnete sich gerade: Einer der Modulausg√§nge musste mit VCC verbunden werden.  In meinem Fall unterst√ºtzte das Modul 5 V f√ºr die Stromversorgung. Ohne nachzudenken, steckte ich einen Draht vom Modul auf die gegen√ºberliegende Seite der Platine.  Infolgedessen verdrehte sich der schief gel√∂tete Stecker und der <strong>UART-Kontakt ging einfach verloren.</strong>  <em>facepalm.jpg</em> Im Allgemeinen "gibt ein schlechter Kopf den Beinen keine Ruhe" und krumme H√§nde - dem Kopf ... </p><br><p>  Am Ende sah ich die lang erwarteten bei Minicom </p><br><pre> <code class="plaintext hljs">INIT CMD0 CMD8 ACMD41 CMD58 CMD16 CMD18 LOADING /</code> </pre> <br><p>  Au√üerdem, <del>  es bewegt sich </del>  Die Ladeanzeige dreht sich.  Ich erinnere mich direkt an die Schuljahre und den gem√§chlichen Start von MinuetOS von einer Diskette.  Es sei denn, der Antrieb schleift. </p><br><p>  Das Problem ist, dass nach der BOOT-Nachricht nichts passiert.  Es ist also Zeit, eine Verbindung √ºber OpenOCD auf Raspberry und GDB auf dem Host herzustellen und zu sehen, was es ist. </p><br><p>  Erstens zeigte die Verbindung mit GDB sofort, dass <code>$pc</code> (Programmz√§hler, Adresse des aktuellen Befehls) auf <code>0x0</code> fliegt - dies geschieht wahrscheinlich nach einem Mehrfachfehler.  Daher f√ºgen wir unmittelbar nach der Ausgabe der <code>BOOT</code> Nachricht eine Endlosschleife hinzu.  <em>Dies wird ihn f√ºr eine kurze Zeit verz√∂gern ...</em> </p><br><pre> <code class="diff hljs">diff --git a/bootrom/sdboot/sd.cb/bootrom/sdboot/sd.c index c6b5ede..bca1b7f 100644 --- a/bootrom/sdboot/sd.c +++ b/bootrom/sdboot/sd.c @@ -224,6 +224,8 @@ int main(void) kputs("BOOT"); + while(*(volatile char *)0x10000){} + __asm__ __volatile__ ("fence.i" : : : "memory"); return 0; }</code> </pre> <br><p>  Solch kniffliger Code wird "aus Gr√ºnden der Zuverl√§ssigkeit" verwendet: Ich habe irgendwo geh√∂rt, dass eine Endlosschleife anscheinend ein undefiniertes Verhalten ist, und hier ist es unwahrscheinlich, dass der Compiler dies err√§t (ich erinnere mich, dass sich BootROM bei <code>0x10000</code> ). </p><br><p><img src="https://habrastorage.org/webt/wj/xw/a9/wjxwa9m9hqoghtvy79zsbysctr0.png" alt="Es gibt einen Debugger, keine Quelle"></p><br><p>  Es scheint, aber was noch zu erwarten ist - eine harte Einbettung, welche Art von Quelle gibt es.  Aber schlie√ülich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hat der</a> Autor in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Artikel</a> den Code debuggt ... Krex-fex-pex: </p><br><pre> <code class="plaintext hljs">(gdb) file builds/zeowaa-e115/sdboot.elf A program is being debugged already. Are you sure you want to change the file? (y or n) y Reading symbols from builds/zeowaa-e115/sdboot.elf...done.</code> </pre> <br><p><img src="https://habrastorage.org/webt/ya/08/zp/ya08zpufla55qz02j5fhwcoijy4.png" alt="Es gibt Quellcodes!"></p><br><p>  Nur m√ºssen Sie nicht die MIF-Datei und nicht bin laden, sondern die Originalversion im ELF-Format. </p><br><p>  Nun, mit dem n-ten Versuch, die Adresse zu erraten, an der die Ausf√ºhrung fortgesetzt wird (dies ist ein weiterer Grund, warum der Compiler nicht h√§tte erraten sollen, dass die Schleife unendlich ist).  Das Team </p><br><pre> <code class="plaintext hljs">set variable $pc=0xADDR</code> </pre> <br><p>  Mit dieser Option k√∂nnen Sie den Wert des Registers unterwegs √§ndern (in diesem Fall die Adresse des aktuellen Befehls).  Mit seiner Hilfe k√∂nnen Sie die im Speicher (und in den Speicherregistern) aufgezeichneten Werte √§ndern. </p><br><p>  Am Ende kam ich zu dem Schluss (nicht sicher, ob es korrekt ist), dass wir ein "SD-Karten-Image des falschen Systems" haben und nicht zum Anfang der heruntergeladenen Daten gehen m√ºssen, sondern zu <code>0x89800</code> Bytes weiter: </p><br><pre> <code class="diff hljs">diff --git a/bootrom/sdboot/head.S b/bootrom/sdboot/head.S index 14fa740..2a6c944 100644 --- a/bootrom/sdboot/head.S +++ b/bootrom/sdboot/head.S @@ -13,7 +13,7 @@ _prog_start: smp_resume(s1, s2) csrr a0, mhartid la a1, dtb - li s1, PAYLOAD_DEST + li s1, (PAYLOAD_DEST + 0x89800) jr s1 .section .rodata</code> </pre> <br><p>  M√∂glicherweise wurde dies auch durch die Tatsache beeinflusst, dass ich keine unn√∂tige 4-GB-Karte zur Hand hatte. Ich nahm sie auf 2 GB und ersetzte sie im Makefile durch <code>DEMO_END=11718750</code> durch <code>DEMO_END=3078900</code> (suchen Sie nicht nach der Bedeutung im spezifischen Wert - sie existiert nicht, gerade jetzt wird das Bild platziert auf die Karte). </p><br><h2 id="uroven-vtoroy-u-boot">  Stufe zwei, U-Boot </h2><br><p>  Jetzt "fallen" wir immer noch, aber wir sind bereits unter der Adresse <code>0x0000000080089a84</code> .  Hier muss ich zugeben: Tats√§chlich geht die Pr√§sentation nicht "mit allen Stopps", sondern wird teilweise "nach" geschrieben. Daher habe ich hier bereits die richtige dtb-Datei aus unserem SoC <code>CONFIG_SYS_TEXT_BASE=0x80089800</code> Variable <code>CONFIG_SYS_TEXT_BASE=0x80089800</code> in den <code>HiFive_U-Boot</code> <code>CONFIG_SYS_TEXT_BASE=0x80089800</code> <code>HiFive_U-Boot</code> (anstelle von <code>0x08000000</code> ), sodass die Download-Adresse mit der tats√§chlichen √ºbereinstimmt.  Jetzt herunterladen <del>  Karte der n√§chsten Ebene </del>  ein anderes Bild: </p><br><pre> <code class="plaintext hljs">(gdb) file ../freedom-u-sdk/work/HiFive_U-Boot/u-boot (gdb) tui en</code> </pre> <br><p>  Und wir sehen: </p><br><pre> <code class="plaintext hljs"> ‚îÇ304 /* ‚îÇ ‚îÇ305 * trap entry ‚îÇ ‚îÇ306 */ ‚îÇ ‚îÇ307 trap_entry: ‚îÇ ‚îÇ308 addi sp, sp, -32*REGBYTES ‚îÇ &gt;‚îÇ309 SREG x1, 1*REGBYTES(sp) ‚îÇ ‚îÇ310 SREG x2, 2*REGBYTES(sp) ‚îÇ ‚îÇ311 SREG x3, 3*REGBYTES(sp) ‚îÇ</code> </pre> <br><p>  Und wir springen zwischen den Zeilen 308 und 309. Und es ist nicht √ºberraschend, da <code>$sp</code> den Wert <code>0xfffffffe31cdc0a0</code> enth√§lt.  <code>trap_entry</code> l√§uft es aufgrund von Zeile 307 auch st√§ndig weg. Daher werden wir versuchen, einen Haltepunkt f√ºr <code>trap_entry</code> und dann erneut zu <code>0x80089800</code> (U-Boot-Einstiegspunkt) zu wechseln, und wir hoffen, dass vor dem √úbergang nicht die richtige Einstellung der Register erforderlich ist ... Es scheint zu funktionieren: </p><br><pre> <code class="plaintext hljs">(gdb) b trap_entry Breakpoint 1 at 0x80089a80: file /hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot/arch/riscv/cpu/HiFive/start.S, line 308. (gdb) set variable $pc=0x80089800 (gdb) c Continuing. Breakpoint 1, trap_entry () at /hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot/arch/riscv/cpu/HiFive/start.S:308 (gdb) p/x $sp $4 = 0x81cf950</code> </pre> <br><p>  So lala, der Stapelzeiger, sagen wir unverbl√ºmt: Er zeigt im Allgemeinen √ºber den RAM hinaus (es sei denn, wir haben nat√ºrlich noch eine Adress√ºbersetzung, aber hoffen wir auf eine einfache Option). </p><br><p>  Versuchen wir, den Zeiger durch <code>0x881cf950</code> zu ersetzen.  Als Ergebnis kommen wir zu der Tatsache, dass <code>handle_trap</code> aufgerufen und aufgerufen wird, w√§hrend <code>_exit_trap</code> mit dem Argument <code>epc=2148315240</code> (in Dezimalzahl) <code>epc=2148315240</code> : </p><br><pre> <code class="plaintext hljs">(gdb) x/10i 2148315240 0x800cb068 &lt;strnlen+12&gt;: lbu a4,0(a5) 0x800cb06c &lt;strnlen+16&gt;: bnez a4,0x800cb078 &lt;strnlen+28&gt; 0x800cb070 &lt;strnlen+20&gt;: sub a0,a5,a0 0x800cb074 &lt;strnlen+24&gt;: ret 0x800cb078 &lt;strnlen+28&gt;: addi a5,a5,1 0x800cb07c &lt;strnlen+32&gt;: j 0x800cb064 &lt;strnlen+8&gt; 0x800cb080 &lt;strdup&gt;: addi sp,sp,-32 0x800cb084 &lt;strdup+4&gt;: sd s0,16(sp) 0x800cb088 &lt;strdup+8&gt;: sd ra,24(sp) 0x800cb08c &lt;strdup+12&gt;: li s0,0</code> </pre> <br><p>  Wir setzen den Haltepunkt auf <code>strnlen</code> , fahren fort und sehen: </p><br><pre> <code class="plaintext hljs">(gdb) bt #0 strnlen (s=s@entry=0x10060000 "", count=18446744073709551615) at lib/string.c:283 #1 0x00000000800cc14c in string (buf=buf@entry=0x881cbd4c "", end=end@entry=0x881cc15c "", s=0x10060000 "", field_width=&lt;optimized out&gt;, precision=&lt;optimized out&gt;, flags=&lt;optimized out&gt;) at lib/vsprintf.c:265 #2 0x00000000800cc63c in vsnprintf_internal (buf=buf@entry=0x881cbd38 "exception code: 5 , ", size=size@entry=1060, fmt=0x800d446e "s , epc %08x , ra %08lx\n", fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n", args=0x881cc1a0, args@entry=0x881cc188) at lib/vsprintf.c:619 #3 0x00000000800cca54 in vsnprintf (buf=buf@entry=0x881cbd38 "exception code: 5 , ", size=size@entry=1060, fmt=fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n", args=args@entry=0x881cc188) at lib/vsprintf.c:710 #4 0x00000000800cca68 in vscnprintf (buf=buf@entry=0x881cbd38 "exception code: 5 , ", size=size@entry=1060, fmt=fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n", args=args@entry=0x881cc188) at lib/vsprintf.c:717 #5 0x00000000800ccb50 in printf (fmt=fmt@entry=0x800d4458 "exception code: %d , %s , epc %08x , ra %08lx\n") at lib/vsprintf.c:792 #6 0x000000008008a9f0 in _exit_trap (regs=&lt;optimized out&gt;, epc=2148315240, code=&lt;optimized out&gt;) at arch/riscv/lib/interrupts.c:92 #7 handle_trap (mcause=&lt;optimized out&gt;, epc=&lt;optimized out&gt;, regs=&lt;optimized out&gt;) at arch/riscv/lib/interrupts.c:55 #8 0x0000000080089b10 in trap_entry () at /hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot/arch/riscv/cpu/HiFive/start.S:343 Backtrace stopped: frame did not save the PC</code> </pre> <br><p>  Es scheint, dass <code>_exit_trap</code> Debugging-Informationen zu der aufgetretenen Ausnahme geben m√∂chte, <em>dies schl√§gt jedoch fehl</em> .  Etwas mit unserem Quellcode wird also nicht mehr angezeigt.  <code>set directories ../freedom-u-sdk/HiFive_U-Boot/</code> Oh!  Jetzt angezeigt! </p><br><p>  F√ºhren Sie es erneut aus und sehen Sie auf dem Stack-Trace die Ursache des urspr√ºnglichen Problems, das den ersten Fehler verursacht hat ( <code>mcause == 5</code> ).  Wenn ich richtig verstehe, was <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> auf Seite 37 geschrieben steht, bedeutet diese Ausnahme einen <code>Load access fault</code> .  Der Grund ist anscheinend, weil hier </p><br><p>  <strong>arch / riscv / cpu / HiFive / start.S:</strong> </p><br><pre> <code class="plaintext hljs">call_board_init_f: li t0, -16 li t1, CONFIG_SYS_INIT_SP_ADDR and sp, t1, t0 /* force 16 byte alignment */ #ifdef CONFIG_DEBUG_UART jal debug_uart_init #endif call_board_init_f_0: mv a0, sp jal board_init_f_alloc_reserve mv sp, a0 jal board_init_f_init_reserve mv a0, zero /* a0 &lt;-- boot_flags = 0 */ la t5, board_init_f jr t5 /* jump to board_init_f() */</code> </pre><br><p>  <code>$sp</code> hat den gleichen falschen Wert und innerhalb von <code>board_init_f_init_reserve</code> tritt ein Fehler auf.  Das scheint der Schuldige zu sein: eine Variable mit dem expliziten Namen <code>CONFIG_SYS_INIT_SP_ADDR</code> .  Es ist in der Datei <code>HiFive_U-Boot/include/configs/HiFive-U540.h</code> .  Irgendwann dachte ich sogar, oder beenden Sie den Bootloader f√ºr den Prozessor - vielleicht ist es einfacher, den Prozessor leicht zu reparieren?  Aber dann sah ich, dass es eher wie ein Artefakt aus den nicht vollst√§ndig <code>#if 0</code> Einstellungen f√ºr eine andere Speicherkonfiguration war, und Sie k√∂nnen versuchen, dies zu tun: </p><br><pre> <code class="diff hljs">diff --git a/include/configs/HiFive-U540.hb/include/configs/HiFive-U540.h index ca89383..245542c 100644 --- a/include/configs/HiFive-U540.h +++ b/include/configs/HiFive-U540.h @@ -65,12 +65,9 @@ #define CONFIG_SYS_SDRAM_BASE PHYS_SDRAM_0 #endif #if 1 -/*#define CONFIG_NR_DRAM_BANKS 1*/ +#define CONFIG_NR_DRAM_BANKS 1 #define PHYS_SDRAM_0 0x80000000 /* SDRAM Bank #1 */ -#define PHYS_SDRAM_1 \ - (PHYS_SDRAM_0 + PHYS_SDRAM_0_SIZE) /* SDRAM Bank #2 */ -#define PHYS_SDRAM_0_SIZE 0x80000000 /* 2 GB */ -#define PHYS_SDRAM_1_SIZE 0x10000000 /* 256 MB */ +#define PHYS_SDRAM_0_SIZE 0x40000000 /* 1 GB */ #define CONFIG_SYS_SDRAM_BASE PHYS_SDRAM_0 #endif /* @@ -81,7 +78,7 @@ #define CONSOLE_ARG "console=ttyS0,115200\0" /* Init Stack Pointer */ -#define CONFIG_SYS_INIT_SP_ADDR (0x08000000 + 0x001D0000 - \ +#define CONFIG_SYS_INIT_SP_ADDR (0x80000000 + 0x001D0000 - \ GENERATED_GBL_DATA_SIZE) #define CONFIG_SYS_LOAD_ADDR 0xa0000000 /* partway up SDRAM */</code> </pre> <br><p>  Irgendwann die Menge <del>  Kr√ºcken </del>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">technologische Verbindungselemente</a> erreichten einen kritischen Punkt.  Nach ein wenig Qual kam ich zu der Notwendigkeit, den richtigen Port auf meinem Board zu machen.  Dazu m√ºssen Sie eine bestimmte Anzahl von Dateien f√ºr unsere Konfiguration kopieren und korrigieren. </p><br><div class="spoiler">  <b class="spoiler_title">Nun, ungef√§hr hier ist ein kleiner Tisch</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">trosinenko@trosinenko-pc:/hdd/trosinenko/fpga/freedom-u-sdk/HiFive_U-Boot$ git show --name-status commit 39cd67d59c16ac87b46b51ac1fb58f16f1eb1048 (HEAD -&gt; zeowaa-1gb) Author: Anatoly Trosinenko &lt;anatoly.trosinenko@gmail.com&gt; Date: Tue Jul 2 17:13:16 2019 +0300 Initial support for Zeowaa A-E115FB board M arch/riscv/Kconfig A arch/riscv/cpu/zeowaa-1gb/Makefile A arch/riscv/cpu/zeowaa-1gb/cpu.c A arch/riscv/cpu/zeowaa-1gb/start.S A arch/riscv/cpu/zeowaa-1gb/timer.c A arch/riscv/cpu/zeowaa-1gb/u-boot.lds M arch/riscv/dts/Makefile A arch/riscv/dts/zeowaa-1gb.dts A board/Zeowaa/zeowaa-1gb/Kconfig A board/Zeowaa/zeowaa-1gb/MAINTAINERS A board/Zeowaa/zeowaa-1gb/Makefile A board/Zeowaa/zeowaa-1gb/Zeowaa-A-E115FB.c A configs/zeowaa-1gb_defconfig A include/configs/zeowaa-1gb.h</code> </pre> <br><p>  Details finden Sie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Repository</a> . </p></div></div><br><p>  Wie sich herausstellte, haben auf dieser SiFive-Karte die Register einiger Ger√§te unterschiedliche Adressen.  Es stellte sich auch heraus, dass U-Boot durch den Kconfig-Mechanismus konfiguriert wird, der bereits aus dem Linux-Kernel bekannt ist. Sie k√∂nnen beispielsweise den Befehl <code>make menuconfig</code> , und Sie sehen eine praktische <code>make menuconfig</code> mit Parameterbeschreibungen in <code>?</code>  usw.  Nachdem ich die Beschreibung der dritten Karte aus den Beschreibungen der beiden Karten ausgeblendet und von dort aus alle erb√§rmlichen PLL-Rekonfigurationen verworfen hatte (anscheinend h√§ngt dies irgendwie mit der PCIe-Steuerung vom Host-Computer zusammen, aber dies ist nicht korrekt), bekam ich eine Firmware, die, wenn das Wetter auf dem Mars stimmt Es gab mir eine UART-Nachricht dar√ºber, von welchem ‚Äã‚ÄãCommit-Hash es gesammelt wurde und wie viel DRAM ich habe (aber ich habe diese Informationen auch im Header registriert). </p><br><p>  Es ist schade, dass das Board danach normalerweise nicht mehr mit dem Prozessor-JTAG reagiert und das Booten von der SD-Karte in meiner Konfiguration leider nicht schnell ist.  Andererseits zeigte BootROM manchmal die Meldung an, dass <code>ERROR</code> nicht booten konnte, und U-Boot tauchte sofort auf.  Damals d√§mmerte es mir: Anscheinend ist der Speicher nach dem Neustart des Bitstreams im FPGA nicht ausgefranst, es hat keine Zeit, sich ‚Äûaufzurei√üen‚Äú usw.  Kurz gesagt, Sie k√∂nnen einfach, wenn <code>LOADING /</code> message angezeigt wird, eine Verbindung mit einem Debugger und einer Befehlssatzvariablen <code>set variable $pc=0x80089800</code> und diese lange Last umgehen (nat√ºrlich unter der Annahme, dass sie zuletzt ziemlich fr√ºh <code>set variable $pc=0x80089800</code> wurde und keine Zeit √ºber dem urspr√ºnglichen Code hatte herunterladen). </p><br><p>  √úbrigens, und es ist im Allgemeinen normal, dass der Prozessor vollst√§ndig h√§ngt und der JTAG-Debugger mit Nachrichten keine Verbindung herstellen kann </p><br><pre> <code class="plaintext hljs">Error: unable to halt hart 0 Error: dmcontrol=0x80000001 Error: dmstatus =0x00030c82</code> </pre> <br><p>  Also warte!  Ich habe es schon gesehen!  √Ñhnliches passiert mit dem TileLink-Deadlock, aber irgendwie vertraue ich dem Autor des Speichercontrollers nicht - ich habe es selbst geschrieben ... Pl√∂tzlich, nach dem allerersten erfolgreichen Wiederaufbau des Prozessors nach der Bearbeitung des Controllers, sah ich: </p><br><pre> <code class="plaintext hljs">INIT CMD0 CMD8 ACMD41 CMD58 CMD16 CMD18 LOADING BOOT U-Boot 2018.09-g39cd67d-dirty (Jul 03 2019 - 13:50:33 +0300) DRAM: 1 GiB MMC: BEFORE LOAD ENVBEFORE FDTCONTROLADDRBEFORE LOADADDRIn: serial Out: serial Err: serial Hit any key to stop autoboot: 3</code> </pre> <br><p>      <code>In: serial</code>    ‚Äî       ,      environment.  , ¬´    ¬ª?          !  :  U-Boot      2^24   SD-, ,    <del>   </del>  ,      ,        ,   ELF-,    .  : ,       ,     . </p><br><p> ,    ? ,    -  ... </p><br><pre> <code class="plaintext hljs">(gdb) x/x 0x0200bff8 0x200bff8: 0x00000000</code> </pre> <br><p>  ,    ? </p><br><pre> <code class="plaintext hljs">(gdb) set variable *0x0200bff8=310000000 (gdb) c</code> </pre> <br><p>  Dann: </p><br><pre> <code class="plaintext hljs">Hit any key to stop autoboot: 0 MMC_SPI: 0 at 0:1 hz 20000000 mode 0</code> </pre> <br><p> :   . , -        : </p><br><p> <strong>HiFive_U-Boot/cmd/bootmenu.c:</strong> </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bootmenu_loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct bootmenu_data *menu, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">enum</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bootmenu_key *key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *esc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!tstc()) { WATCHDOG_RESET(); mdelay(<span class="hljs-number"><span class="hljs-number">10</span></span>); } c = getc(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (*esc) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* First char of ANSI escape sequence '\e' */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'\e'</span></span>) { *esc = <span class="hljs-number"><span class="hljs-number">1</span></span>; *key = KEY_NONE; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-comment"><span class="hljs-comment">/* Second char of ANSI '[' */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-string"><span class="hljs-string">'['</span></span>) { ...</code> </pre> <br><p>  <abbr title="   ,   ,    , . ">  </abbr> ,    :      : </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">DTSTimebase</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br><p> ‚Ä¶   ,      ¬´   ‚Äî  0¬ª.   <code>WithNBigCores</code>      1MHz (, ,      U-Boot).   , ,   :    ,  25MHz!     .   ¬´¬ª ... </p><br><pre> <code class="plaintext hljs">Hit any key to stop autoboot: 0 MMC_SPI: 0 at 0:1 hz 20000000 mode 0 ## Unknown partition table type 0 libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND ** No partition table - mmc 0 ** ## Info: input data size = 34 = 0x22 Running uEnv.txt boot2... ## Error: "boot2" not defined HiFive-Unleashed #</code> </pre> <br><p>    ! ,  , , ,   <code>mmc_spi 1 10000000 0; mmc part</code> ,   SPI  20MHz  10MHz.  Warum? ,       20MHz,      . ,   , ,    ,  :      (  ‚Äî  25MHz)  ,           .   ,    115200Hz UART-   ,  ,     25000000  20000000  1, ..     25MHz. ,   ,    , ,  -  (   )‚Ä¶  ,      ‚Äî  , , . 25MHz ‚Äî    Core i9. </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">HiFive-Unleashed # env edit mmcsetup edit: mmc_spi 1 10000000 0; mmc part HiFive-Unleashed # boot MMC_SPI: 1 at 0:1 hz 10000000 mode 0 Partition Map for MMC device 0 -- Partition Type: EFI Part Start LBA End LBA Name Attributes Type GUID Partition GUID 1 0x00000800 0x0000ffde "Vfat Boot" attrs: 0x0000000000000000 type: ebd0a0a2-b9e5-4433-87c0-68b6b72699c7 type: data guid: 76bd71fd-1694-4ff3-8197-bfa81699c2fb 2 0x00040800 0x002efaf4 "root" attrs: 0x0000000000000000 type: 0fc63daf-8483-4772-8e79-3d69d8477de4 type: linux guid: 9f3adcc5-440c-4772-b7b7-283124f38bf3 3 0x0000044c 0x000007e4 "uboot" attrs: 0x0000000000000000 type: 5b193300-fc78-40cd-8002-e86c45580b47 guid: bb349257-0694-4e0f-9932-c801b4d76fa3 4 0x00000400 0x0000044b "uboot-env" attrs: 0x0000000000000000 type: a09354ac-cd63-11e8-9aff-70b3d592f0fa guid: 4db442d0-2109-435f-b858-be69629e7dbf libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND 2376 bytes read in 0 ms Running uEnv.txt boot2... 15332118 bytes read in 0 ms ## Loading kernel from FIT Image at 90000000 ... Using 'config-1' configuration Trying 'bbl' kernel subimage Description: BBL/SBI/riscv-pk Type: Kernel Image Compression: uncompressed Data Start: 0x900000d4 Data Size: 74266 Bytes = 72.5 KiB Architecture: RISC-V OS: Linux Load Address: 0x80000000 Entry Point: 0x80000000 Hash algo: sha256 Hash value: 28972571467c4ad0cf08a81d9cf92b9dffc5a7cb2e0cd12fdbb3216cf1f19cbd Verifying Hash Integrity ... sha256+ OK ## Loading fdt from FIT Image at 90000000 ... Using 'config-1' configuration Trying 'fdt' fdt subimage Description: unavailable Type: Flat Device Tree Compression: uncompressed Data Start: 0x90e9d31c Data Size: 6911 Bytes = 6.7 KiB Architecture: RISC-V Load Address: 0x81f00000 Hash algo: sha256 Hash value: 10b0244a5a9205357772ea1c4e135a4f882409262176d8c7191238cff65bb3a8 Verifying Hash Integrity ... sha256+ OK Loading fdt from 0x90e9d31c to 0x81f00000 Booting using the fdt blob at 0x81f00000 ## Loading loadables from FIT Image at 90000000 ... Trying 'kernel' loadables subimage Description: Linux kernel Type: Kernel Image Compression: uncompressed Data Start: 0x900123e8 Data Size: 10781356 Bytes = 10.3 MiB Architecture: RISC-V OS: Linux Load Address: 0x80200000 Entry Point: unavailable Hash algo: sha256 Hash value: 72a9847164f4efb2ac9bae736f86efe7e3772ab1f01ae275e427e2a5389c84f0 Verifying Hash Integrity ... sha256+ OK Loading loadables from 0x900123e8 to 0x80200000 ## Loading loadables from FIT Image at 90000000 ... Trying 'ramdisk' loadables subimage Description: buildroot initramfs Type: RAMDisk Image Compression: gzip compressed Data Start: 0x90a5a780 Data Size: 4467411 Bytes = 4.3 MiB Architecture: RISC-V OS: Linux Load Address: 0x82000000 Entry Point: unavailable Hash algo: sha256 Hash value: 883dfd33ca047e3ac10d5667ffdef7b8005cac58b95055c2c2beda44bec49bd0 Verifying Hash Integrity ... sha256+ OK Loading loadables from 0x90a5a780 to 0x82000000</code> </pre> </div></div><br><p> ,     ,     .      .  mcause ,      <code>$pc</code>   <code>si</code>   <code>trap_entry</code> .    U-Boot     mcause = 0..4,      .     ,  ,    ,  :    <code>conf/rvboot-fit.txt</code> : </p><br><pre> <code class="plaintext hljs">fitfile=image.fit # below much match what's in FIT (ugha)</code> </pre> <br><p>  ,     ,      ,   ,  <code>SIF0</code> ‚Äî  <abbr title="   ,   "> -  PCIe</abbr> : </p><br><pre> <code class="diff hljs"><span class="hljs-deletion"><span class="hljs-deletion">-bootargs=console=ttySIF0,921600 debug +bootargs=console=ttyS0,125200 debug</span></span></code> </pre> <br><p>        SHA-256  MD5:     ( ,  ),    ,         MD5 ‚Äî  .  Was ist das Ergebnis?        (    ),   : </p><br><pre> <code class="plaintext hljs">... Verifying Hash Integrity ... md5+ OK Loading loadables from 0x90a5a758 to 0x82000000 libfdt fdt_check_header(): FDT_ERR_BADMAGIC chosen { linux,initrd-end = &lt;0x00000000 0x83000000&gt;; linux,initrd-start = &lt;0x00000000 0x82000000&gt;; riscv,kernel-end = &lt;0x00000000 0x80a00000&gt;; riscv,kernel-start = &lt;0x00000000 0x80200000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; }; libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND chosen { linux,initrd-end = &lt;0x00000000 0x83000000&gt;; linux,initrd-start = &lt;0x00000000 0x82000000&gt;; riscv,kernel-end = &lt;0x00000000 0x80a00000&gt;; riscv,kernel-start = &lt;0x00000000 0x80200000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; }; Loading Kernel Image ... OK Booting kernel in 3</code> </pre> <br><p>     ... </p><br><pre> <code class="plaintext hljs">(gdb) x/x 0x0200bff8 0x200bff8: 0x00000000</code> </pre> <br><p> , ,     ,     ,  . , ,  ,         ,  : </p><br><pre> <code class="plaintext hljs">0x00000000bff6dbb0 in ?? () (gdb) set variable *0x0200bff8=1000000 (gdb) c Continuing. ^C Program received signal SIGINT, Interrupt. 0x00000000bff6dbb0 in ?? () (gdb) set variable *0x0200bff8=2000000 (gdb) c Continuing. ^C Program received signal SIGINT, Interrupt. 0x00000000bff6dbb0 in ?? () (gdb) set variable *0x0200bff8=3000000 (gdb) c Continuing.</code> </pre> <br><p>  ... </p><br><pre> <code class="plaintext hljs"> Loading Kernel Image ... OK Booting kernel in 3 2 1 0 ## Starting application at 0x80000000 ...</code> </pre> <br><p>  ,     ‚Äî  , ,     ! </p><br><p>        -  </p><br><pre> <code class="plaintext hljs">0000000080001c20 &lt;poweroff&gt;: 80001c20: 1141 addi sp,sp,-16 80001c22: e022 sd s0,0(sp) 80001c24: 842a mv s0,a0 80001c26: 00005517 auipc a0,0x5 80001c2a: 0ca50513 addi a0,a0,202 # 80006cf0 &lt;softfloat_countLeadingZeros8+0x558&gt; 80001c2e: e406 sd ra,8(sp) 80001c30: f7fff0ef jal ra,80001bae &lt;printm&gt; 80001c34: 8522 mv a0,s0 80001c36: 267000ef jal ra,8000269c &lt;finisher_exit&gt; 80001c3a: 00010797 auipc a5,0x10 80001c3e: 41e78793 addi a5,a5,1054 # 80012058 &lt;htif&gt; 80001c42: 639c ld a5,0(a5) 80001c44: c399 beqz a5,80001c4a &lt;poweroff+0x2a&gt; 80001c46: 72c000ef jal ra,80002372 &lt;htif_poweroff&gt; 80001c4a: 45a1 li a1,8 80001c4c: 4501 li a0,0 80001c4e: dc7ff0ef jal ra,80001a14 &lt;send_ipi_many&gt; 80001c52: 10500073 wfi 80001c56: bff5 j 80001c52 &lt;poweroff+0x32&gt;</code> </pre> <br><p>   Berkeley Boot Loader.       <code>htif</code> ‚Äî host interface,   tethered-  (      ARM), -  standalone. ,      ,  ,     : </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">poweroff</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint16_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code)</span></span></span><span class="hljs-function"> </span></span>{ printm(<span class="hljs-string"><span class="hljs-string">"Power off\r\n"</span></span>); finisher_exit(code); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (htif) { htif_poweroff(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { send_ipi_many(<span class="hljs-number"><span class="hljs-number">0</span></span>, IPI_HALT); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">asm</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volatile</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"wfi\n"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; } } }</code> </pre> <br><h2 id="kvest-zapusti-chasy"> :   </h2><br><p>    CLINT    </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rtcTick = <span class="hljs-type"><span class="hljs-type">Bool</span></span>(<span class="hljs-type"><span class="hljs-type">INPUT</span></span>) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> time = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, width = timeWidth)) when (io.rtcTick) { time := time + <span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre> <br><p>    RTC,    MockAON,     : ¬´,     ? ? !¬ª      ,       ,       <code>System.scala</code> : </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> rtcDivider = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-comment"><span class="hljs-comment">//      16,   :) val mhzInt = p(DevKitFPGAFrequencyKey).toInt // ,      rtcDivider := Mux(rtcDivider === (mhzInt - 1).U, 0.U, rtcDivider + 1.U) outer.clintOpt.foreach { clint =&gt; clint.module.io.rtcTick := rtcDivider === 0.U }</span></span></code> </pre> <br><h2 id="probirayas-k-linux-kernel">   Linux kernel </h2><br><p>           ,    : </p><br><p> BBL   FDT   <code>0xF0000000</code> ,     !   ,  ‚Ä¶   <strong>HiFive_U-Boot/arch/riscv/lib/boot.c</strong> ,   <code>0x81F00000</code> ,     U-Boot. </p><br><p>  BBL ,   .      <code>mem_prop</code> ,   <strong>riscv-pk/machine/fdt.c</strong> :   ,     fdt ram  <code>device_type = "memory"</code> ‚Äî , ,     ,      ‚Äî       . </p><br><p>     (   ,   ): </p><br><pre> <code class="plaintext hljs">This is bbl's dummy_payload. To boot a real kernel, reconfigure bbl with the flag --with-payload=PATH, then rebuild bbl. Alternatively, bbl can be used in firmware-only mode by adding device-tree nodes for an external payload and use QEMU's -bios and -kernel options.</code> </pre> <br><p> ,      <code>riscv,kernel-start</code>  <code>riscv,kernel-end</code>  DTB,   .  <code>query_chosen</code> ,  BBL   32- ,     <code>&lt;0x0 0xADDR&gt;</code> ,   , ,  .    <code>chosen</code> </p><br><pre> <code class="plaintext hljs">chosen { #address-cells = &lt;1&gt;; #size-cells = &lt;0&gt;; ... }</code> </pre> <br><p>    : <abbr title="   ">  <code>0x0</code>  </abbr> . </p><br><p>  100500       ,   : </p><br><div class="spoiler">  <b class="spoiler_title">Versteckter Text</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> Verifying Hash Integrity ... md5+ OK Loading loadables from 0x90a5a758 to 0x82000000 libfdt fdt_check_header(): FDT_ERR_BADMAGIC chosen { linux,initrd-end = &lt;0x83000000&gt;; linux,initrd-start = &lt;0x82000000&gt;; riscv,kernel-end = &lt;0x80a00000&gt;; riscv,kernel-start = &lt;0x80200000&gt;; #address-cells = &lt;0x00000001&gt;; #size-cells = &lt;0x00000000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; stdout-path = "uart0:38400n8"; }; libfdt fdt_path_offset() returned FDT_ERR_NOTFOUND chosen { linux,initrd-end = &lt;0x83000000&gt;; linux,initrd-start = &lt;0x82000000&gt;; riscv,kernel-end = &lt;0x80a00000&gt;; riscv,kernel-start = &lt;0x80200000&gt;; #address-cells = &lt;0x00000001&gt;; #size-cells = &lt;0x00000000&gt;; bootargs = "debug console=tty0 console=ttyS0,125200 root=/dev/mmcblk0p2 rootwait"; stdout-path = "uart0:38400n8"; }; Loading Kernel Image ... OK Booting kernel in 3 2 1 0 ## Starting application at 0x80000000 ... bbl loader SIFIVE, INC. 5555555555555555555555555 5555 5555 5555 5555 5555 5555 5555 5555555555555555555555 5555 555555555555555555555555 5555 5555 5555 5555 5555 5555 5555555555555555555555555555 55555 55555 555555555 55555 55555 55555 55555 55555 5 55555 55555 55555 55555 55555 55555 55555 55555 55555 55555 55555 555555555 55555 5 SiFive RISC-V Core IP [ 0.000000] OF: fdt: Ignoring memory range 0x80000000 - 0x80200000 [ 0.000000] Linux version 4.19.0-sifive-1+ (trosinenko@trosinenko-pc) (gcc version 8.3.0 (Buildroot 2019.02-07449-g4eddd28f99)) #1 SMP Wed Jul 3 21:29:21 MSK 2019 [ 0.000000] bootconsole [early0] enabled [ 0.000000] Initial ramdisk at: 0x(____ptrval____) (16777216 bytes) [ 0.000000] Zone ranges: [ 0.000000] DMA32 [mem 0x0000000080200000-0x00000000bfffffff] [ 0.000000] Normal [mem 0x00000000c0000000-0x00000bffffffffff] [ 0.000000] Movable zone start for each node [ 0.000000] Early memory node ranges [ 0.000000] node 0: [mem 0x0000000080200000-0x00000000bfffffff] [ 0.000000] Initmem setup node 0 [mem 0x0000000080200000-0x00000000bfffffff] [ 0.000000] On node 0 totalpages: 261632 [ 0.000000] DMA32 zone: 3577 pages used for memmap [ 0.000000] DMA32 zone: 0 pages reserved [ 0.000000] DMA32 zone: 261632 pages, LIFO batch:63 [ 0.000000] software IO TLB: mapped [mem 0xbb1fc000-0xbf1fc000] (64MB)</code> </pre> </div></div><br><p> (  BBL,       ‚Äî ). </p><br><p>  ,  ,  ,   RocketChip     JTAG   trap-   ‚Äî      . </p><br><pre> <code class="plaintext hljs">Program received signal SIGTRAP, Trace/breakpoint trap. 0xffffffe0000024ca in ?? () (gdb) bt #0 0xffffffe0000024ca in ?? () Backtrace stopped: previous frame identical to this frame (corrupt stack?) (gdb) file work/linux/vmlinux A program is being debugged already. Are you sure you want to change the file? (y or n) y Reading symbols from work/linux/vmlinux...done. (gdb) bt #0 0xffffffe0000024ca in setup_smp () at /hdd/trosinenko/fpga/freedom-u-sdk/linux/arch/riscv/kernel/smpboot.c:75 #1 0x0000000000000000 in ?? () Backtrace stopped: frame did not save the PC</code> </pre> <br><p> <strong>freedom-u-sdk/linux/arch/riscv/kernel/smpboot.c:</strong> </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __<span class="hljs-function"><span class="hljs-function">init </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup_smp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">device_node</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dn</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NULL</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hart; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> found_boot_cpu = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cpuid = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((dn = of_find_node_by_type(dn, <span class="hljs-string"><span class="hljs-string">"cpu"</span></span>))) { hart = riscv_of_processor_hartid(dn); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hart &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hart == cpuid_to_hartid_map(<span class="hljs-number"><span class="hljs-number">0</span></span>)) { BUG_ON(found_boot_cpu); found_boot_cpu = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } cpuid_to_hartid_map(cpuid) = hart; set_cpu_possible(cpuid, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); set_cpu_present(cpuid, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); cpuid++; } BUG_ON(!found_boot_cpu); <span class="hljs-comment"><span class="hljs-comment">// &lt;    }</span></span></code> </pre> <br><p>     , <em>CPU not found, running software emulation</em> .    running.     . </p><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* The lucky hart to first increment this variable will boot the other cores */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">atomic_t</span></span> hart_lottery; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> boot_cpu_hartid;</code> </pre> <br><p>    <strong>linux/arch/riscv/kernel/setup.c</strong> ‚Äî       .  ,   -  ,     ... </p><br><p>         . </p><br><p>  Fortsetzung folgt.       ,   ,      singlestep-. </p><br><p>    ( ): <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://asciinema.org/a/h22F5eCMXYF9n7n89CY6NJNEi.svg" alt="asciicast"></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de458482/">https://habr.com/ru/post/de458482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de458464/index.html">3 km Gigabit-Verbindung auf Lasermodems</a></li>
<li><a href="../de458468/index.html">Wie f√ºhre ich ein beeindruckendes Kanban-StandUp-Meeting durch?</a></li>
<li><a href="../de458470/index.html">Texturierung oder was Sie wissen m√ºssen, um ein Oberfl√§chenk√ºnstler zu werden. Teil 2. Masken und Texturen</a></li>
<li><a href="../de458472/index.html">Erstellung einer Gebietsbewertung nach der Methode der thermischen Potentiale unter Verwendung offener Daten</a></li>
<li><a href="../de458474/index.html">Beste Berichte mit HighLoad ++ 2018</a></li>
<li><a href="../de458486/index.html">Geheimnisse der Arbeit mit Stoff im Spiel Alan Wake</a></li>
<li><a href="../de458488/index.html">Data Science Digest (Juli 2019)</a></li>
<li><a href="../de458490/index.html">Halten Sie das Lenkrad fest ... Unser Projekt zur √úberwachung des Fahrerzustands</a></li>
<li><a href="../de458492/index.html">‚ÄûWir haben immer an Wettbewerb und das Recht geglaubt, einen Benutzer auszuw√§hlen‚Äú ¬© Yandex</a></li>
<li><a href="../de458494/index.html">Ein praktisches Beispiel f√ºr die Verwendung der Renderfunktionen von Vue: Erstellen eines typografischen Rasters f√ºr ein Entwurfssystem</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>