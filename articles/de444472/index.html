<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëàüèø üòø üìá Emulieren von Amazon-Webdiensten in einem JVM-Prozess. Vermeiden Sie Roskomnadzor und beschleunigen Sie die Entwicklung und das Testen ü§ö ‚è≤Ô∏è üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Warum m√ºssen Sie m√∂glicherweise die Amazon-Webdienstinfrastruktur emulieren? 

 Zuallererst spart es - spart Zeit f√ºr Entwicklung und Debugging und wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Emulieren von Amazon-Webdiensten in einem JVM-Prozess. Vermeiden Sie Roskomnadzor und beschleunigen Sie die Entwicklung und das Testen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444472/"> Warum m√ºssen Sie m√∂glicherweise die Amazon-Webdienstinfrastruktur emulieren? <br><br>  Zuallererst spart es - spart Zeit f√ºr Entwicklung und Debugging und was ebenso wichtig ist - spart Geld aus dem Projektbudget.  Es ist klar, dass der Emulator nicht zu 100% mit der urspr√ºnglichen Umgebung identisch ist, die wir emulieren m√∂chten.  Um jedoch die Entwicklung und Automatisierung des Prozesses zu beschleunigen, sollten die vorhandenen √Ñhnlichkeiten ausreichen.  Das aktuellste Ereignis im Jahr 2018 mit AWS war die Sperrung der IP-Adressen von AWS-Subnetzen in Russland durch IP-Anbieter.  Diese Sperren wirkten sich auf unsere Infrastruktur in der Amazon Cloud aus.  Wenn Sie die AWS-Technologie verwenden und das Projekt in dieser Cloud platzieren m√∂chten, zahlt sich die Emulation f√ºr Entwicklung und Test mehr als aus. <br><br><img src="https://habrastorage.org/webt/jz/ty/k7/jztyk798xcq9yqietemgy-6133m.png"><br><br>  In der Ver√∂ffentlichung werde ich Ihnen erkl√§ren, wie wir es geschafft haben, einen solchen Trick mit den Diensten S3, SQS, RDS PostgreSQL und Redshift zu erreichen, als wir ein vorhandenes Data Warehouse √ºber viele Jahre auf AWS migriert haben. <br><a name="habracut"></a><br>  Dies ist nur ein Teil meines letztj√§hrigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Meetings</a> auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Karte</a> , das den Themen von AWS- und Java-Hubs entspricht.  Der zweite Teil bezieht sich auf PostgreSQL-, Redshift- und Spaltendatenbanken. Die Textversion kann in den entsprechenden Hubs ver√∂ffentlicht werden. Videos und Folien befinden sich auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">der Konferenzwebsite</a> . <br><br>  Bei der Entwicklung einer Anwendung f√ºr AWS w√§hrend des Blockierens von AWS-Subnetzen hat das Team diese bei der t√§glichen Entwicklung neuer Funktionen praktisch nicht bemerkt.  Tests haben auch funktioniert und Sie k√∂nnen die Anwendung debuggen.  Und nur beim Versuch, die Anwendungsprotokolle in Logentries zu betrachten, wurden Metriken in SignalFX oder Datenanalysen in Redshift / PostgreSQL RDS entt√§uscht - die Dienste waren nicht √ºber das Netzwerk des russischen Anbieters verf√ºgbar.  Die AWS-Emulation hat uns dabei geholfen, dies nicht zu bemerken und viel gr√∂√üere Verz√∂gerungen bei der Arbeit mit der Amazon Cloud √ºber ein VPN-Netzwerk zu vermeiden. <br><br>  Jeder Cloud-Anbieter ‚Äûunter der Haube‚Äú hat viele Drachen und Sie sollten sich nicht der Werbung hingeben.  Sie m√ºssen verstehen, warum dies alles f√ºr den Dienstanbieter erforderlich ist.  Nat√ºrlich hat die vorhandene Infrastruktur von Amazon, Microsoft und Google Vorteile.  Und wenn sie Ihnen sagen, dass alles nur getan wird, um Ihnen die Entwicklung zu erleichtern, versuchen sie h√∂chstwahrscheinlich, Sie auf Ihre Nadel zu setzen und die erste Dosis kostenlos zu geben.  Damit sie sp√§ter nicht von der Infrastruktur und der spezifischen Technologie abkommen.  Daher werden wir versuchen, eine Lieferantenbindung zu vermeiden.  Es ist klar, dass es nicht immer m√∂glich ist, von bestimmten Entscheidungen vollst√§ndig zu abstrahieren, und ich denke, dass es ziemlich oft m√∂glich ist, fast 90% in einem Projekt zu abstrahieren.  Die verbleibenden 10% des Projekts, die an einen Anbieter von Technologien gebunden sind, die sehr wichtig sind, optimieren entweder die Anwendungsleistung oder die einzigartigen Funktionen, die es sonst nirgendwo gibt.  Sie sollten sich immer an die Vor- und Nachteile von Technologien erinnern und sich so gut wie m√∂glich sch√ºtzen und sich nicht auf eine bestimmte API eines Cloud-Infrastrukturanbieters "setzen". <br><br>  Amazon schreibt √ºber die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nachrichtenverarbeitung</a> auf seiner Website.  Das Wesen und die Abstraktion von Nachrichtenaustauschtechnologien sind √ºberall gleich, obwohl es Nuancen gibt - Nachrichten, die durch Warteschlangen oder durch Themen geleitet werden.  Daher empfiehlt AWS die Verwendung des bereitgestellten und verwalteten Apache ActiveMQ zum Migrieren von Anwendungen von einem vorhandenen Messaging-Broker und f√ºr neue Amazon SQS / SNS-Anwendungen.  Dies ist ein Beispiel f√ºr die Bindung an die eigene API anstelle der standardisierten JMS-API und der Protokolle AMQP, MMQT, STOMP.  Es ist klar, dass dieser Anbieter mit seiner L√∂sung m√∂glicherweise eine h√∂here Leistung aufweist, Skalierbarkeit unterst√ºtzt usw.  Wenn Sie aus meiner Sicht ihre Bibliotheken und keine standardisierten APIs verwenden, gibt es viel mehr Probleme. <br><br>  AWS verf√ºgt √ºber eine Redshift-Datenbank.  Es ist eine verteilte Datenbank mit einer massiven parallelen Architektur.  Sie k√∂nnen eine gro√üe Menge Ihrer Daten in Tabellen auf mehreren Redshft-Sites in Amazon hochladen und analytische Abfragen f√ºr gro√üe Datenmengen durchf√ºhren.  Dies ist kein OLTP-System, bei dem es wichtig ist, dass Sie kleine Anforderungen f√ºr eine kleine Anzahl von Datens√§tzen h√§ufig genug mit ACID-Garantien ausf√ºhren.  Bei der Arbeit mit Redshift wird davon ausgegangen, dass Sie nicht viele Abfragen pro Zeiteinheit haben, diese jedoch Aggregate f√ºr eine sehr gro√üe Datenmenge lesen k√∂nnen.  Dieses System wird vom Anbieter so positioniert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, dass Ihr</a> Data Warehouse (Warehouse) auf AWS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">aktualisiert wird</a> und ein einfaches Laden der Daten versprochen wird.  Welches ist √ºberhaupt nicht wahr. <br><br>  Ein Auszug aus der Dokumentation dar√ºber, welche <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Typen</a> Amazon Redshift <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unterst√ºtzt</a> .  Es ist ein eher d√ºrftiger Satz, und wenn Sie etwas zum Speichern und Verarbeiten von Daten ben√∂tigen, die hier nicht aufgef√ºhrt sind, wird es f√ºr Sie schwierig sein, zu arbeiten.  Zum Beispiel eine GUID. <br><br>  Frage aus der Halle: "Und JSON?" <br><br>  - JSON kann nur als VARCHAR geschrieben werden und es gibt verschiedene Funktionen f√ºr die Arbeit mit JSON. <br>  Kommentar des Publikums: "Postgres hat normale JSON-Unterst√ºtzung." <br><br>  - Ja, es unterst√ºtzt diese Art von Daten und Funktionen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redshift basiert jedoch</a> auf PostgreSQL 8.0.2.  Es gab ein ParAccel-Projekt. Wenn ich mich nicht irre, ist diese Technologie von 2005 eine Abzweigung von Postgres, die einen Scheduler f√ºr verteilte Anforderungen hat, der auf einer massiv parallelen Architektur basiert.  5-6 Jahre vergingen und dieses Projekt wurde f√ºr die Amazon Web Servces-Plattform lizenziert und Redshift genannt.  Etwas wurde aus dem urspr√ºnglichen Postgres entfernt, viel wurde hinzugef√ºgt.  Sie f√ºgten hinzu, dass im Zusammenhang mit der Authentifizierung / Autorisierung in AWS mit Rollen die Sicherheit in Amazon einwandfrei funktioniert.  Wenn Sie beispielsweise eine Verbindung von Redshift zu einer anderen Datenbank mithilfe einer fremden Datenquelle herstellen m√ºssen, werden Sie diese nicht finden.  Es gibt keine Funktionen f√ºr die Arbeit mit XML, Funktionen f√ºr die zweimalige Arbeit mit JSON, die falsch berechnet wurden. <br><br>  Versuchen Sie beim Entwickeln einer Anwendung, sich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nicht auf bestimmte Implementierungen zu verlassen,</a> und der Anwendungscode h√§ngt nur von Abstraktionen ab.  Sie k√∂nnen diese Fassaden und Abstraktionen selbst erstellen, aber in diesem Fall gibt es viele vorgefertigte Bibliotheken - Fassaden.  Welche den Code von bestimmten Implementierungen, von bestimmten Frameworks abstrahieren. Es ist klar, dass sie m√∂glicherweise nicht alle Funktionen als ‚Äûgemeinsamer Nenner‚Äú f√ºr Technologien unterst√ºtzen.  Es ist besser, Software zu entwickeln, die auf Abstraktionen basiert, um das Testen zu vereinfachen. <br><br>  Um AWS zu emulieren, werde ich zwei Optionen erw√§hnen.  Das erste ist ehrlicher und korrekter, aber es funktioniert langsamer.  Der zweite ist schmutzig und schnell.  Ich erz√§hle Ihnen von der Hack-Option - wir versuchen, die gesamte Infrastruktur in einem Prozess zu erstellen - die Tests und die plattform√ºbergreifende Option funktionieren schneller bei der Arbeit unter Windows (wo Docker nicht immer Geld mit Ihnen verdienen kann). <br><br>  Die erste Methode ist perfekt, wenn Sie unter Linux / Macos entwickeln und Docker haben. Es ist besser, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">atlassian localstack zu verwenden</a> .  Es ist praktisch, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Testcontainer</a> zu verwenden, um localstack in die JVM zu integrieren. <br><br>  Was mich davon abgehalten hat, Lockalstack in Docker f√ºr das Projekt zu verwenden, war, dass die Entwicklung unter Windows erfolgte und niemand f√ºr die Alpha-Version von Docker b√ºrgte, als dieses Projekt gestartet wurde ... Es ist auch m√∂glich, dass sie in keinem Unternehmen, das es ernst meint, eine virtuelle Maschine mit Linux und Docker installieren d√ºrfen zur Informationssicherheit.  Ich spreche nicht davon, in einer sicheren Umgebung in Investmentbanken zu arbeiten und fast alle Verkehrsfirewalls dort zu verbieten. <br><br>  Betrachten wir Optionen zum Emulieren von Simple Storage S3.  Dies ist kein gew√∂hnliches Amazon-Dateisystem, sondern ein verteilter Objektspeicher.  In dem Sie Ihre Daten als BLOB ablegen, ohne die M√∂glichkeit der √Ñnderung und Hinzuf√ºgung von Daten.  Es gibt √§hnliche vollwertige verteilte Lager anderer Hersteller.  Mit dem verteilten Ceph-Objektspeicher k√∂nnen Sie beispielsweise mit seiner Funktionalit√§t mithilfe des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">S3-REST-Protokolls</a> und des vorhandenen Clients mit minimalen √Ñnderungen arbeiten.  Dies ist jedoch eine ziemlich schwere L√∂sung f√ºr die Entwicklung und das Testen von Java-Anwendungen. <br><br>  Ein schnelleres und geeigneteres Projekt ist die Java-Bibliothek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">s3proxy</a> .  Es emuliert das S3-REST-Protokoll und √ºbersetzt es in die entsprechenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">jcloud-</a> API-Aufrufe. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Au√üerdem</a> k√∂nnen Sie viele Implementierungen zum echten Lesen und Speichern von Daten verwenden.  Es kann Anrufe an die Google App Engine-API, die Microsoft Azure-API, senden. F√ºr Tests ist es jedoch bequemer, jcloud-Transientenspeicher im RAM zu verwenden.  Es ist auch erforderlich, die Version des Authentifizierungsprotokolls AWS S3 zu konfigurieren und die Schl√ºssel- und Geheimwerte anzugeben. Au√üerdem muss der Endpunkt konfiguriert werden - der Port und die Schnittstelle, die dieser S3-Proxy √ºberwacht.  Dementsprechend sollte Ihr Code, der den AWS SDK-Client verwendet, in Tests mit dem S3 AWS-Endpunkt und nicht mit der AWS-Region verbunden werden.  Denken Sie auch hier daran, dass s3proxy nicht alle Funktionen der S3-API unterst√ºtzt, aber alle unsere Verwendungsszenarien perfekt emulieren!  Selbst das mehrteilige Hochladen gro√üer Dateien wird von s3proxy unterst√ºtzt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a85/65d/9ce/a8565d9ceabaa944dfc993c88e00d738.png"></div><br><br>  Amazon Simple Queue Service ist ein Warteschlangendienst.  Es gibt einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elasticmq-</a> Warteschlangendienst, der in Scala geschrieben ist und Ihrer Anwendung mithilfe des Amazon SQS-Protokolls pr√§sentiert werden kann.  Ich habe es im Projekt nicht verwendet, daher werde ich den Initialisierungscode geben und den Informationen der Entwickler vertrauen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7eb/11d/adf/7eb11dadfac303746ecc755fccee6384.png"></div><br><br>  Im Projekt bin ich in die andere Richtung gegangen und der Code h√§ngt von den Spring-JMS-Abstraktionen von JmsTemplate und JmsListener ab. Die Projektabh√§ngigkeiten geben den JMS-Treiber f√ºr SQS com.amazonaws an: amazon-sqs-java-messaging-lib.  Dies betrifft den Hauptanwendungscode. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/08d/3ca/64b/08d3ca64b9c7f355cc3661ce692768ae.png"></div><br><br>  In Tests verbinden wir Artemis-jms-server als eingebetteten JMS-Server f√ºr Tests, und im Test Spring-Kontext verwenden wir anstelle der SQS-Verbindungsfactory die Artemis-Verbindungsfactory.  Artemis ist die n√§chste Version von Apache ActiveMQ, einer vollwertigen, modernen Message Oriented Middleware - nicht nur eine Testl√∂sung.  Vielleicht werden wir in Zukunft nicht nur in Autotests eingesetzt.  Durch die Verwendung von JMS-Abstraktionen in Verbindung mit Spring haben wir sowohl den Anwendungscode als auch die M√∂glichkeit zum einfachen Testen vereinfacht.  Sie m√ºssen nur die Abh√§ngigkeiten org.springframework.boot: spring-boot-startup-artemis und org.apache.activemq: artemis-jms-server hinzuf√ºgen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/245/a8f/d3c/245a8fd3c8cb56a4b6fa460018d48f94.png"></div><br><br>  In einigen Tests kann PostgreSQL emuliert werden, indem es durch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">H2Database ersetzt wird</a> .  Dies funktioniert, wenn die Tests nicht akzeptiert werden und keine spezifischen PG-Funktionen verwenden.  Gleichzeitig kann H2 eine Teilmenge des PostgreSQL-Wire-Protokolls ohne Unterst√ºtzung f√ºr Datentypen und Funktionen emulieren.  In unserem Projekt verwenden wir Foreing Data Wrapper, daher funktioniert diese Methode bei uns nicht. <br><br>  Sie k√∂nnen echtes PostgreSQL ausf√ºhren.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">postgresql-embedded</a> l√§dt die eigentliche Distribution bzw. das Archiv mit Bin√§rdateien f√ºr die Plattform, auf der wir laufen, herunter und entpackt sie.  Unter Linux unter tempfs im RAM und unter Windows in% TEMP% wird der Postgresql-Serverprozess gestartet, die Servereinstellungen und Datenbankparameter werden konfiguriert.  Aufgrund der Distributionsverteilungsfunktionen funktionieren √§ltere Versionen als PG 11 unter Linux nicht.  F√ºr mich selbst habe ich eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wrapper-Bibliothek erstellt</a> , mit der Sie PostgreSQL-Bin√§rassemblys nicht nur von einem HTTP-Server, sondern auch vom Maven-Repository abrufen k√∂nnen.  Dies kann sehr n√ºtzlich sein, wenn Sie in isolierten Netzwerken arbeiten und auf einem CI-Server ohne Internetzugang aufbauen.  Ein weiterer Vorteil bei der Arbeit mit meinem Wrapper ist die Annotation der CDI-Komponente, wodurch die Verwendung der Komponente beispielsweise im Spring-Kontext vereinfacht wird.  Die Implementierung der AutoClosable-Serverschnittstelle erfolgte fr√ºher als im urspr√ºnglichen Projekt.  Sie m√ºssen nicht daran denken, den Server zu stoppen. Er wird gestoppt, wenn der Spring-Kontext automatisch geschlossen wird. <br><br>  Beim Start k√∂nnen Sie eine Datenbank basierend auf Skripten erstellen und den Spring-Kontext durch entsprechende Eigenschaften erg√§nzen.  Wir erstellen jetzt ein Datenbankschema mithilfe von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Flyway-</a> Skripten, um das Datenbankschema zu migrieren. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Diese</a> werden jedes Mal gestartet, wenn die Datenbank in Tests erstellt wird. <br><br>  Um die Daten nach dem Ausf√ºhren der Tests zu √ºberpr√ºfen, verwenden wir die Bibliothek spring-test-dbunit.  In Anmerkungen zu den Testmethoden geben wir an, mit welchen Uploads der Status der Datenbank verglichen werden soll.  Dadurch m√ºssen Sie keinen Code schreiben, um mit dbunit arbeiten zu k√∂nnen. Sie m√ºssen lediglich den Bibliothekslistener zum Testcode hinzuf√ºgen.  Sie k√∂nnen angeben, in welcher Reihenfolge die Daten aus den Tabellen nach Abschluss der Testmethode gel√∂scht werden, wenn der Datenbankkontext zwischen den Tests wiederverwendet wird.  Im Jahr 2019 gibt es einen moderneren Ansatz f√ºr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datenbankfahrer</a> , der mit junit5 arbeitet.  Ein Anwendungsbeispiel sehen Sie beispielsweise <a href="">hier</a> . <br><br>  Das Schwierigste war, Amazon Redshift zu emulieren.  Es gibt ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Redshift-Fake-Driver-</a> Projekt. Das Projekt konzentriert sich auf die Emulation des Ladens von Batchdaten in die Analysedatenbank von AWS.  Im Protokollemulator jdbc: postgresqlredshift sind die Befehle COPY, UNLOAD implementiert, alle anderen Befehle werden an den regul√§ren JDBC-PostgreSQL-Treiber delegiert. <br><br>  Daher funktionieren die Tests nicht auf die gleiche Weise wie in Redshift, der Aktualisierungsoperation, bei der eine andere Tabelle als Datenquelle f√ºr die Aktualisierung verwendet wird (die Syntax unterscheidet sich in Redshift und PostgreSQL 9+. Ich habe auch eine unterschiedliche Interpretation des Zeilenzitats in SQL-Befehlen zwischen diesen Datenbanken festgestellt. <br><br>  Aufgrund der Architektur einer echten Redshift-Datenbank ist das Einf√ºgen, Aktualisieren und L√∂schen von Daten in Bezug auf E / A ziemlich langsam und ‚Äûteuer‚Äú.  Es ist m√∂glich, Daten mit akzeptabler Leistung nur in gro√üen "Paketen" einzuf√ºgen, und mit dem Befehl COPY k√∂nnen Sie nur Daten aus einem verteilten S3-Dateisystem herunterladen.  Dieser Befehl in der Datenbank unterst√ºtzt verschiedene Datenformate AVRO, CSV, JSON, Parkett, ORC und TXT.  Das Emulatorprojekt konzentriert sich auf CSV, TXT, JSON. <br><br>  Um Redshift in den Tests zu emulieren, m√ºssen Sie die PostgreSQL-Datenbank wie zuvor beschrieben starten und die Emulation des S3-Repositorys ausf√ºhren. Wenn Sie eine Verbindung zum Postgres herstellen, m√ºssen Sie lediglich den Redshift-Fake-Treiber im Klassenpfad hinzuf√ºgen und die Treiberklasse jp.ne.opt.redshiftfake.postgres angeben. FakePostgresqlDriver.  Danach k√∂nnen Sie das Datenbankschema auf demselben Flyway migrieren, und dbunit ist bereits mit dem Vergleichen von Daten nach dem Ausf√ºhren der Tests vertraut. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/17e/d0b/20a/17ed0b20a1e7bb4f4205747122a22a70.png"></div><br><br>  Ich frage mich, wie viele Leser AWS und Redshift in ihrer Arbeit verwenden.  Schreiben Sie in den Kommentaren √ºber Ihre Erfahrungen. <br><br>  Mit nur Open Source-Projekten konnte das Team die Entwicklung in der AWS-Umgebung beschleunigen, Geld aus dem Projektbudget sparen und das Team nicht daran hindern, zu arbeiten, wenn AWS-Subnetze von Roskomnadzor blockiert wurden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444472/">https://habr.com/ru/post/de444472/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444462/index.html">Testen des Samsung Galaxy S10 - Wann holen Smartphones Kameras ein?</a></li>
<li><a href="../de444464/index.html">Eine andere M√∂glichkeit, Ihr Bein mit std :: thread zu schie√üen</a></li>
<li><a href="../de444466/index.html">Leider sind alle Ihre Datenbanken im Besitz von Google. Google-Pr√§sentation auf der Game Development Conference 2019, Stadia Project</a></li>
<li><a href="../de444468/index.html">Nvidia Neural Network verwandelt einfache Skizzen in wundersch√∂ne Landschaften</a></li>
<li><a href="../de444470/index.html">20 Gewohnheiten f√ºr die Aufmerksamkeitshygiene: Umgang mit Technologie, aber nicht zulassen, dass sie sich Zeit und Aufmerksamkeit nehmen</a></li>
<li><a href="../de444474/index.html">Bau der Kommunikationslinie Sachalin-Kuril. Segero Tour - Seilbahn</a></li>
<li><a href="../de444476/index.html">Wettbewerb von RUSNANO: Nehmen Sie an einem Online-Kurs √ºber moderne Mikroelektronik teil, dann an einer praktischen Tour mit FPGAs, und erhalten Sie einen Preis</a></li>
<li><a href="../de444480/index.html">So reduzieren Sie das Gewicht eines Flugzeugstrukturelements um ein Drittel</a></li>
<li><a href="../de444482/index.html">Was bl√§st das Ged√§chtnis in Ruby auf?</a></li>
<li><a href="../de444484/index.html">Sch√§tzung der Bedingungen f√ºr die Aufgabenentwicklung und das Testen (nicht erforderlich)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>