<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙆🏻 ☁️ 🎲 Die ganze Wahrheit über RTOS. Artikel Nr. 31. Diagnose und Fehlerprüfung RTOS 🧐 👰 👨🏾‍🚀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Die Fehlerbehandlung ist bei Betriebssystemen, die für eingebettete Systemanwendungen entwickelt wurden, nicht die häufigste. Dies ist ein unvermeidba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Die ganze Wahrheit über RTOS. Artikel Nr. 31. Diagnose und Fehlerprüfung RTOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463403/"><img src="https://habrastorage.org/webt/ot/7b/f6/ot7bf602l2thhfxphukcduobth8.jpeg"><br><br>  Die Fehlerbehandlung ist bei Betriebssystemen, die für eingebettete Systemanwendungen entwickelt wurden, nicht die häufigste.  Dies ist ein unvermeidbares Ergebnis begrenzter Ressourcen, da alle eingebetteten Systeme bestimmte Einschränkungen aufweisen.  Und nur eine kleine Anzahl solcher Systeme kann sich wie Desktop-Systeme verhalten, dh dem Benutzer die Möglichkeit bieten, bei außergewöhnlichen Ereignissen Aktionen auszuwählen. <br><br>  In Nucleus SE gibt es im Allgemeinen drei Arten der Fehlerprüfung: <br><ul><li>  Mittel zum Überprüfen des Zustands der ausgewählten Konfiguration, um sicherzustellen, dass die ausgewählten Parameter nicht zu Fehlern führen; </li><li>  optional enthaltener Code zur Überprüfung des Laufzeitverhaltens; </li><li>  Bestimmte API-Funktionen, die zur Entwicklung zuverlässigerer Codes beitragen. </li></ul><br>  All dies wird in diesem Artikel zusammen mit einigen Ideen zur Diagnose durch den Benutzer erörtert. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Frühere Artikel in der Reihe:</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 30.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Initialisierungs- und Startverfahren für Nucleus SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 29.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Unterbrechungen in Nucleus SE</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 28.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Software-Timer</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 27.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Systemzeit</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 26.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kanäle: Nebendienstleistungen und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 25.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Datenkanäle: Einführung und Basisdienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 24.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warteschlangen: Nebendienstleistungen und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 23.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Warteschlangen: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 22.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postfächer: Nebendienstleistungen und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 21.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Postfächer: Einführung und Basisdienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 20.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semaphoren: Nebendienstleistungen und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 19.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semaphoren: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 18.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ereignisflag-Gruppen: Hilfsdienste und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 17.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ereignisflag-Gruppen: Einführung und Basisdienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Signale</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherpartitionen: Dienste und Datenstrukturen</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Speicherbereiche: Einführung und Grundversorgung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel Nr. 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabendatenstrukturen und nicht unterstützte API-Aufrufe</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstleistungen für die Arbeit mit Aufgaben</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben: Konfiguration und Einführung in die API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler: Erweiterte Funktionen und Kontexterhaltung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Scheduler: Implementierung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nucleus SE: Internes Design und Bereitstellung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nucleus SE: Einführung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Andere RTOS-Dienste</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgabeninteraktion und Synchronisation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben, Kontextwechsel und Interrupts</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aufgaben und Planung</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTOS: Struktur und Echtzeitmodus</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RTOS: Einführung.</a> <br></div></div><br><br><h2>  Überprüfen Sie die Einstellungen </h2><br>  Nucleus SE wurde mit dem Fokus auf eine hohe Benutzerkonfigurierbarkeit entwickelt, um die bestmögliche Nutzung der verfügbaren Ressourcen zu gewährleisten.  Eine solche Konfigurierbarkeit ist eine komplexe Aufgabe, da die Anzahl der möglichen Parameter und die gegenseitigen Abhängigkeiten zwischen ihnen sehr groß sind.  Wie in vielen vorherigen Artikeln angegeben, werden die meisten Benutzerschritte zum Konfigurieren von Nucleus SE mithilfe der Direktiven <b>#define</b> in der Datei <b>nuse_config.h ausgeführt</b> . <br><br>  Um Konfigurationsfehler zu identifizieren, enthält die Datei <b>nuse_config.c</b> bis <b>#include</b> die Datei <b>nuse_config_check.h</b> , die Integritätsprüfungen für die Direktiven <b>#define durchführt</b> .  Das Folgende ist ein Ausschnitt aus dieser Datei: <br><pre><code class="plaintext hljs">/*** Tasks and task control ***/ #if NUSE_TASK_NUMBER &lt; 1 || NUSE_TASK_NUMBER &gt; 16 #error NUSE: invalid number of tasks - must be 1-16 #endif #if NUSE_TASK_RELINQUISH &amp;&amp; (NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER) #error NUSE: NUSE_Task_Relinquish() selected - not valid with priority scheduler #endif #if NUSE_TASK_RESUME &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: NUSE_Task_Resume() selected - task suspend not enabled #endif #if NUSE_TASK_SUSPEND &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: NUSE_Task_Suspend() selected - task suspend not enabled #endif #if NUSE_INITIAL_TASK_STATE_SUPPORT &amp;&amp; !NUSE_SUSPEND_ENABLE #error NUSE: Initial task state enabled - task suspend not enabled #endif /*** Partition pools ***/ #if NUSE_PARTITION_POOL_NUMBER &gt; 16 #error NUSE: invalid number of partition pools - must be 0-16 #endif #if NUSE_PARTITION_POOL_NUMBER == 0 #if NUSE_PARTITION_ALLOCATE #error NUSE: NUSE_Partition_Allocate() enabled – no partition pools configured #endif #if NUSE_PARTITION_DEALLOCATE #error NUSE: NUSE_Partition_Deallocate() enabled – no partition pools configured #endif #if NUSE_PARTITION_POOL_INFORMATION #error NUSE: NUSE_Partition_Pool_Information() enabled – no partition pools configured #endif #endif</code> </pre> <br>  Der obige Code führt die folgenden Überprüfungen durch: <br><ul><li>  Überprüfen Sie, ob mindestens eine, aber nicht mehr als 16 Aufgaben konfiguriert sind. </li><li>  Bestätigung, dass die ausgewählten API-Funktionen mit dem ausgewählten Scheduler und anderen angegebenen Parametern kompatibel sind; </li><li>  Überprüfung, dass nicht mehr als 16 Instanzen anderer Kernelobjekte erstellt wurden; </li><li>  Bestätigung, dass API-Funktionen für nicht deklarierte Objekte nicht ausgewählt wurden. </li><li>  Sicherstellen, dass die API-Funktionen für Signale und Systemzeit nicht verwendet werden, wenn die Unterstützung für diese Dienste deaktiviert ist; </li><li>  Überprüfung des ausgewählten Schedulertyps und der zugehörigen Parameter. </li></ul><br>  In allen Fällen führt die Erkennung von Fehlern zur Ausführung der Direktive <b>#error</b> bei der Kompilierung.  Dies führt normalerweise dazu, dass die Kompilierung gestoppt wird und die entsprechende Meldung angezeigt wird. <br><br>  Diese Datei garantiert nicht die Unmöglichkeit, eine falsche Konfiguration / Konfiguration zu erstellen, macht sie jedoch sehr unwahrscheinlich. <br><br><h2>  API-Einstellungen überprüfen </h2><br>  Wie Nucleus RTOS kann Nucleus SE Code einschließen, um die Parameter des Aufrufs von API-Funktionen zur Laufzeit zu überprüfen.  Normalerweise wird dies nur beim ersten Debuggen und Testen verwendet, da im endgültigen Programmcode ein übermäßiger Speicherverbrauch unerwünscht ist. <br><br>  Die Parameterprüfung wird aktiviert, indem der Parameter <b>NUSE_API_PARAMETER_CHECKING</b> in der Datei <b>nuse_config.h</b> auf <b>TRUE gesetzt wird</b> .  Dies führt zur Kompilierung des erforderlichen zusätzlichen Codes.  Das folgende Beispiel zeigt die Überprüfung der Parameter einer API-Funktion: <br><pre> <code class="plaintext hljs">STATUS NUSE_Mailbox_Send(NUSE_MAILBOX mailbox, ADDR *message, U8 suspend) { STATUS return_value; #if NUSE_API_PARAMETER_CHECKING if (mailbox &gt;= NUSE_MAILBOX_NUMBER) { return NUSE_INVALID_MAILBOX; } if (message == NULL) { return NUSE_INVALID_POINTER; } #if NUSE_BLOCKING_ENABLE if ((suspend != NUSE_NO_SUSPEND) &amp;&amp; (suspend != NUSE_SUSPEND)) { return NUSE_INVALID_SUSPEND; } #else if (suspend != NUSE_NO_SUSPEND) { return NUSE_INVALID_SUSPEND; } #endif #endif</code> </pre><br>  Eine solche Überprüfung der Parameter kann dazu führen, dass der API-Aufruf einen Fehlercode ausgibt.  Es ist ein negativer Wert der Form <b>NUSE_INVALID_xxx</b> (z. B. <b>NUSE_INVALID_POINTER</b> ). In der Datei <b>nuse_codes.h</b> ist ein vollständiger Satz von Definitionen enthalten. <br><br>  Um Fehlerwerte zu verarbeiten, kann ein zusätzlicher Anwendungscode (möglicherweise mithilfe der bedingten Kompilierung erstellt) hinzugefügt werden. Um diese zu erkennen, ist es jedoch besser, die Datenüberwachungstools moderner Firmware-Debugger zu verwenden. <br><br>  Das Überprüfen der Parameter führt zu einem zusätzlichen Speicherverbrauch (zusätzlicher Code) und beeinträchtigt die Leistung des Codes. Daher wirkt sich seine Verwendung auf das gesamte System aus.  Da der gesamte Quellcode von Nucleus SE dem Entwickler zur Verfügung steht, kann die Überprüfung und das Debuggen des endgültigen Anwendungscodes manuell durchgeführt werden, wenn absolute Genauigkeit erforderlich ist. <br><br><h2>  Überprüfen des Taskstapels </h2><br>  Bis der Run to Completion Scheduler verwendet wird, bietet Nucleus SE die Möglichkeit, den Task-Stack zu überprüfen. Dieser ähnelt einer ähnlichen Funktion in Nucleus RTOS und zeigt den verbleibenden Speicherplatz auf dem Stack an.  Dieser API-Dienstprogrammaufruf ( <b>NUSE_Task_Check_Stack ()</b> ) wurde in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">früheren Artikel</a> (Nr. 12) ausführlich beschrieben.  Einige Ideen zum Überprüfen auf Stapelfehler finden Sie weiter unten in diesem Artikel im Abschnitt Benutzerdefinierte Diagnose. <br><br><h2>  Versionsinformationen </h2><br>  Nucleus RTOS und Nucleus SE verfügen über eine API-Funktion, die einfach Kernel-Versions- / Build-Informationen zurückgibt. <br><br><h3>  Nucleus RTOS API-Aufruf </h3><br>  Prototyp eines Serviceabrufs: <br>  CHAR * NU_Release_Information (VOID); <br><br>  Parameter: keine. <br><br>  Rückgabewert: <br>  Zeiger auf eine Zeichenfolge mit Versionsinformationen, die mit einem Null-Byte enden. <br><br><h3>  Nucleus SE API-Aufruf </h3><br>  Dieser API-Aufruf unterstützt die Kernfunktionalität der Nucleus RTOS-API. <br><br>  Prototyp eines Serviceabrufs: <br>  char * NUSE_Release_Information (void); <br><br>  Parameter: keine. <br><br>  Rückgabewert: <br>  Zeiger auf eine Zeichenfolge mit Versionsinformationen, die mit einem Null-Byte enden. <br><br><h3>  Rufen Sie an, um Informationen zur Nucleus SE-Baugruppe zu erhalten </h3><br>  Die Implementierung dieses API-Aufrufs ist ziemlich einfach.  Ein Zeiger wird auf die konstante Zeile <b>NUSE_Release_Info zurückgegeben</b> , die in der Datei <b>nuse_globals.c</b> deklariert und initialisiert <b>wird</b> . <br><br>  Diese Linie hat die Form Nucleus SE - <b>Xyymmmdd</b> , wobei: <br>  <b>X</b> - Build Status: <b>A</b> = Alpha;  <b>B</b> = Beta;  <b>R</b> = Freigabe <br>  <b>JJ</b> - Erscheinungsjahr <br>  <b>mm</b> - Veröffentlichungsmonat <br>  <b>dd</b> - Veröffentlichungstag <br><br><h2>  Nucleus RTOS-kompatibel </h2><br>  Nucleus RTOS bietet optionale Unterstützung für Geschichtsmagazine.  Der Kernel zeichnet die Details verschiedener Systemaktionen auf.  Es gibt API-Funktionen, mit denen Programme: <br><ul><li>  Protokollierung aktivieren / deaktivieren; </li><li>  einen Journaleintrag erstellen; </li><li>  Holen Sie sich einen Journaleintrag. </li></ul><br>  Diese Funktion wird in Nucleus SE nicht unterstützt. <br><br>  Nucleus RTOS verfügt außerdem über mehrere Fehlerverwaltungsmakros, mit denen Sie keine Fehlerbestätigungen (ASSERT) durchführen und benutzerdefinierte Funktionen für kritische Fehler aufrufen können.  Sie sind optional in der Betriebssystembaugruppe enthalten.  Nucleus SE unterstützt diese Funktionalität nicht. <br><br><h3>  Benutzerdiagnose </h3><br>  Bisher haben wir uns in diesem Artikel mit den von Nucleus SE selbst bereitgestellten Diagnose- und Fehlerprüfungswerkzeugen befasst.  Nun lohnt es sich zu erklären, wie die vom Benutzer festgelegten oder anwendungsorientierten Diagnosetools mithilfe der vom Kernel bereitgestellten Tools und / oder unseres Wissens über seine interne Struktur und Implementierung implementiert werden können <br><br><h3>  Anwendungsspezifische Diagnose </h3><br>  In fast jeder Anwendung können Sie zusätzlichen Code hinzufügen, um die Integrität zur Laufzeit zu überprüfen.  Der Multitasking-Kern macht es einfach und unkompliziert, eine spezielle Aufgabe für diesen Job zu erstellen.  Offensichtlich werden wir in diesem Artikel nicht zu ungewöhnliche Diagnosefälle betrachten, sondern einige allgemeine Ideen. <br><br><h3>  Speicherprüfungen </h3><br>  Offensichtlich ist ein ordnungsgemäßer Speicherbetrieb entscheidend für die Integrität eines Prozessorsystems.  Es ist nicht weniger offensichtlich, dass Sie bei einem kritischen Fehler nicht nur die Diagnose, sondern das gesamte Softwareprodukt als Ganzes ausführen können ( <i>Anmerkung des Übersetzers: Dies ist übrigens genau der Fall, den wir im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel „Fake Blue Pill“ untersucht haben</a></i> ).  Es gibt jedoch Situationen, in denen ein bestimmter Fehler auftritt, der Anlass zur Sorge gibt, die Codeausführung jedoch nicht beeinträchtigt.  Gedächtnistests sind ein ziemlich kompliziertes Thema, das den Rahmen dieses Artikels sprengt, daher werde ich nur einige allgemeine Ideen geben. <br><br>  Die zwei häufigsten Fehler, die im RAM auftreten, sind: <br><ul><li>  "Sticky Bits", wenn das Bit einen Wert von 0 oder 1 hat, der nicht geändert werden kann; </li><li>  "Übersprechen", wenn benachbarte Bits sich gegenseitig stören. </li></ul><br>  Beide Fehler können überprüft werden, indem nacheinander bestimmte Testmuster in jeden RAM-Bereich geschrieben und gelesen werden.  Einige Überprüfungen können nur beim Start durchgeführt werden, noch bevor der Stapel gebildet wurde ( <i>Anmerkung des Übersetzers: In dem oben erwähnten Artikel stellte sich heraus, dass es die erste Verwendung des Stapels war, die alles auf einmal zerstörte</i> ).  Zum Beispiel eine "laufende Einheit" -Prüfung, bei der jedem Speicherbit der Wert Eins zugewiesen wird und alle anderen Bits überprüft werden, um sicherzustellen, dass sie gleich Null sind.  Während des Betriebs können andere bitweise Testmuster durchgeführt werden, vorausgesetzt, während der RAM-Bereich beschädigt ist, erfolgt keine Kontextumschaltung.  Die Verwendung der Restriktionsmakros für kritische Abschnitte von <b>Nucleus SE NUSE_CS_Enter ()</b> und <b>NUSE_CS_Exit ()</b> ist recht einfach und skalierbar. <br><br>  Verschiedene Arten von ROMs sind ebenfalls anfällig für periodische Fehler, aber es gibt nicht viele Tools, um sie zu überprüfen.  Hier kann eine Prüfsumme hilfreich sein, die nach dem Zusammenstellen des Codes berechnet wird.  Diese Überprüfung kann zur Startzeit und möglicherweise zur Laufzeit durchgeführt werden. <br><br>  Ein Fehler in der Speicheradressierungslogik kann sowohl ROM als auch RAM betreffen.  Sie können eine spezielle Prüfung für diesen Fehler entwickeln, die jedoch höchstwahrscheinlich im Rahmen der oben beschriebenen Prüfungen erkannt wird. <br><br><h3>  Peripheriegeräte testen </h3><br>  Neben der CPU können auch Peripherieschaltungen fehleranfällig sein.  Dies ist natürlich von System zu System sehr unterschiedlich. Bei den meisten Geräten gibt es jedoch verschiedene Möglichkeiten, ihre Integrität mithilfe von Diagnosesoftware zu überprüfen.  Beispielsweise kann ein Kommunikationskanal einen Loopback-Überprüfungsmodus haben, in dem alle in den Kanal kommenden Daten sofort zurückgegeben werden. <br><br><h3>  Watchdog-Service </h3><br>  Eingebettete Entwickler verwenden häufig einen Watchdog.  Dies ist ein Peripheriegerät, das entweder die CPU unterbricht und auf eine Antwort wartet oder (bevorzugter) einen regelmäßigen Zugriff von der Software erfordert.  In beiden Fällen ist ein häufiges Ergebnis eines Watchdog-Timers ein System-Reset. <br><br>  Die effektive Verwendung eines Watchdogs in einer Multitasking-Umgebung ist ein komplexes Problem.  Wenn Sie eine Aufgabe erstellen, die regelmäßig darauf zugreift (Watchdog-Timer), wird bestätigt, dass diese bestimmte Aufgabe funktioniert.  Eine mögliche Lösung könnte die Implementierung der „Dispatcher-Aufgabe“ sein.  Ein Beispiel für eine solche Aufgabe wird unten angegeben. <br><br><h3>  Stapelüberlaufprüfung </h3><br>  Wenn Sie den Run to Completion Scheduler nicht verwenden, wird für jede Aufgabe in der Nucleus SE-Anwendung ein Stapel erstellt.  Die Integrität dieser Stapel ist sehr wichtig, aber die RAM-Größe ist wahrscheinlich begrenzt. Daher ist es wichtig, die Anwendungsgröße optimal zu gestalten.  Die statische Vorhersage der Anforderungen für den Stapel jeder Aufgabe ist möglich, aber sehr schwierig.  Der Stapel sollte groß genug sein, um selbst die am meisten verschachtelten Funktionen sowie den anspruchsvollsten Interrupt-Handler zu unterstützen.  Ein einfacherer Ansatz zur Lösung dieses Problems wäre die Verwendung umfassender Laufzeitprüfungen. <br><br>  Im Allgemeinen gibt es zwei Ansätze zur Stapelüberprüfung.  Wenn Sie einen ausgeklügelten Debugger für eingebettete Software verwenden, können die Grenzen des Stapels überwacht und alle Verstöße erkannt werden.  Die <b>Position</b> und Größe der Nucleus SE-Stapel sind in den globalen ROM-Datenstrukturen verfügbar: <b>NUSE_Task_Stack_Base []</b> und <b>NUSE_Task_Stack_Size []</b> . <br><br>  Eine Alternative ist das Testen der Laufzeit.  Ein üblicher Ansatz besteht darin, "Schutzwörter" am Ende jedes Stapels zu verwenden, normalerweise das erste Element jedes Bereichs der Stapeldaten.  Diese Wörter werden mit einem erkannten Wert ungleich Null initialisiert.  Die Service- / Diagnoseaufgabe prüft dann, ob sich diese Wörter geändert haben, und führt die entsprechenden Aktionen aus.  Das Mischen des Sicherheitsworts bedeutet nicht, dass der Stapel voll ist, sondern zeigt an, dass dies bald geschehen wird.  Daher funktioniert die Software möglicherweise weiterhin. Möglicherweise müssen Sie Korrekturmaßnahmen ergreifen oder dem Benutzer einen Fehler melden. <br><br><h3>  Supervisor-Aufgabe </h3><br>  Trotz der Tatsache, dass Nucleus SE keine der 16 möglichen Aufgaben für seine eigenen Bedürfnisse reserviert, kann der Benutzer eine Aufgabe für die Diagnose auswählen.  Dies kann eine Aufgabe mit niedriger Priorität sein, die einfach eine beliebige „freie“ Prozessorzeit verwendet, oder es kann eine Aufgabe mit hoher Priorität sein, die regelmäßig über einen kurzen Zeitraum ausgeführt wird, um sicherzustellen, dass die Diagnose regelmäßig durchgeführt wird. <br><br>  Das Folgende ist ein Beispiel dafür, wie eine ähnliche Aufgabe funktionieren könnte. <br><br>  Die Signalflags der Dispatcher-Task werden verwendet, um den Betrieb von sechs kritischen System-Tasks zu verfolgen.  Jede dieser Aufgaben verwendet ein bestimmtes Flag (von Bit 0 bis Bit 5) und sollte es regelmäßig setzen.  Die Dispatcher-Task setzt alle Flags zurück und pausiert dann ihre Arbeit für einen bestimmten Zeitraum.  Wenn sie die Arbeit wieder aufnimmt, erwartet sie, dass alle sechs Aufgaben durch Setzen des entsprechenden Flags "überprüft" werden, und sucht dann nach einer genauen Übereinstimmung mit dem Wert von <b>b00111111</b> (aus der Datei <b>nuse_binary.h</b> ).  Wenn alles den Anforderungen entspricht, werden die Flags zurückgesetzt und erneut angehalten.  Wenn nicht, wird die Routine zur Behandlung kritischer Fehler aufgerufen, die beispielsweise das System neu starten kann. <br><br>  In einer alternativen Implementierung könnten Gruppen von Ereignisflags verwendet werden.  Dies ist sinnvoll, wenn die Signale nicht an anderer Stelle in der Anwendung verwendet werden (andernfalls führt dies zu einer übermäßigen Verwendung des Arbeitsspeichers durch alle Aufgaben) und insbesondere, wenn die Ereignisflags für andere Zwecke verwendet werden. <br><br><h2>  Rückverfolgung und Profilerstellung </h2><br>  Trotz der Tatsache, dass viele moderne Embedded-Software-Debugger einen hohen Grad an Anpassung aufweisen und für die Arbeit mit RTOS verwendet werden können, kann das Debuggen einer Multithread-Anwendung immer noch schwierig sein.  Ein weit verbreiteter Ansatz ist das Post-Execution-Profiling, bei dem der Code (RTOS) implementiert wird, damit eine detaillierte Prüfung seiner Arbeit im Nachhinein analysiert werden kann.  Typischerweise umfasst die Implementierung eines solchen Dienstes zwei Komponenten: <br><ol><li>  Dem RTOS wird ein zusätzlicher Code hinzugefügt, um Aktionen zu protokollieren.  In der Regel wird es in Präprozessoranweisungen eingeschlossen, um die bedingte Kompilierung zu verwenden.  Dieser Code zeichnet mehrere Informationsbytes auf, wenn ein wichtiges Ereignis eintritt (z. B. Aufrufen einer API-Funktion oder Wechseln des Kontexts).  Zu diesen Informationen können gehören: <br><ul><li>  aktuelle Adresse (PC); </li><li>  ID der aktuellen Aufgabe (Index); </li><li>  Indizes anderer verwendeter Objekte; </li><li>  Code, der der ausgeführten Operation entspricht. </li></ul><br></li><li>  Die Aufgabe, die zum Entladen des Profilinformationspuffers in einen externen Speicher zugewiesen wird, normalerweise auf den Hostcomputer. </li></ol><br>  Die Analyse der so erhaltenen Daten erfordert ebenfalls einige Arbeit, ist jedoch nicht komplizierter als die Verwendung einer normalen Excel-Tabelle. <br><br>  Im nächsten Artikel werden wir die Kompatibilität von Nucleus SE und Nucleus RTOS im Detail untersuchen. <br><br>  <b>Über den Autor:</b> Colin Walls ist seit über dreißig Jahren in der Elektronikindustrie tätig und widmet sich die meiste Zeit der Firmware.  Heute ist er Firmware-Ingenieur bei Mentor Embedded (einer Abteilung von Mentor Graphics).  Colin Walls spricht häufig auf Konferenzen und Seminaren, Autor zahlreicher technischer Artikel und zweier Bücher über Firmware.  Lebt in Großbritannien.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Colins</a> professioneller <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Blog</a> , E-Mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de463403/">https://habr.com/ru/post/de463403/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de463391/index.html">Wie man jeden heiratet (ein-, zwei- und dreigeschlechtliche Ehe) aus mathematischer Sicht und warum Männer immer gewinnen</a></li>
<li><a href="../de463393/index.html">Ist Ihr Unternehmen eine Familie oder eine Sportmannschaft?</a></li>
<li><a href="../de463397/index.html">Devisenmarkt und Financial Engineering im Mittelalter</a></li>
<li><a href="../de463399/index.html">Einführung in 3CX 16 Update 3 Alpha - Erweiterte DNS- und Mobile Client-Wiederverbindung</a></li>
<li><a href="../de463401/index.html">Neapel nach Rom: Neue AMD EPYC-CPUs</a></li>
<li><a href="../de463405/index.html">Die zweite Entwicklungsstufe (Handyspiel), was, wann und warum</a></li>
<li><a href="../de463411/index.html">Arbeiten Sie nicht in schlechten Projekten</a></li>
<li><a href="../de463415/index.html">Sicherheitswoche 33: interessant mit Black Hat / DEF CON 2019</a></li>
<li><a href="../de463417/index.html">Portierung des Betriebssystems auf Aarch64</a></li>
<li><a href="../de463419/index.html">Digitale Veranstaltungen in Moskau vom 12. bis 18. August</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>