<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå∫ ü§∏üèº üë≠ Aplikasi web di Kotlin + Spring Boot + Vue.js (add-on) üßôüèª üßú üö£üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, penghuni Habr yang terkasih! 

 Sesuai namanya, artikel ini adalah tambahan untuk aplikasi Web yang ditulis sebelumnya di Kotlin + Spri...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aplikasi web di Kotlin + Spring Boot + Vue.js (add-on)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482222/">  Selamat siang, penghuni Habr yang terkasih! <br><br>  Sesuai namanya, artikel ini adalah tambahan untuk <a href="https://habr.com/ru/post/467161/">aplikasi Web yang</a> ditulis sebelumnya <a href="https://habr.com/ru/post/467161/">di Kotlin + Spring Boot + Vue.js</a> , yang memungkinkan kita untuk meningkatkan kerangka aplikasi masa depan dan membuatnya lebih mudah untuk bekerja dengannya. <br><a name="habracut"></a><br>  Sebelum memulai cerita, izinkan saya mengucapkan terima kasih kepada semua orang yang berkomentar di artikel sebelumnya. <br><br><h3>  Isi </h3><br><ul><li>  <a href="https://habr.com/ru/post/482222/">Pengaturan CI / CD (Heroku)</a> </li><li>  <a href="https://habr.com/ru/post/482222/">Perlindungan Bot (reCAPTCHA)</a> </li><li>  <a href="https://habr.com/ru/post/482222/">Pengiriman email</a> </li><li>  <a href="https://habr.com/ru/post/482222/">Migrasi Gradle</a> </li><li>  <a href="https://habr.com/ru/post/482222/">Menyimpan Token JWT di Cookie</a> </li><li>  <a href="https://habr.com/ru/post/482222/">Konfirmasi Pendaftaran Email</a> </li><li>  <a href="https://habr.com/ru/post/482222/">Tautan yang bermanfaat</a> </li></ul><br><a name="cicd"></a><br><h2>  Pengaturan CI / CD (Heroku) </h2><br>  Pertimbangkan implementasi integrasi dan pengiriman berkelanjutan menggunakan platform <a href="https://www.heroku.com/" rel="nofollow">Heroku</a> cloud PaaS sebagai contoh. <br><br>  Hal pertama yang perlu kita lakukan adalah meletakkan kode aplikasi di repositori di <a href="https://github.com/" rel="nofollow">GitHub</a> .  Agar tidak ada yang berlebihan dalam repositori, saya merekomendasikan konten berikut dari file <i>.gitignore</i> : <br><br><div class="spoiler">  <b class="spoiler_title">.gitignore</b> <div class="spoiler_text"><pre><code class="plaintext hljs">*.class # Help # backend/*.md # Package Files # *.jar *.war *.ear # Eclipse # .settings .project .classpath .studio target # NetBeans # backend/nbproject/private/ backend/nbbuild/ backend/dist/ backend/nbdist/ backend/.nb-gradle/ backend/build/ # Apple # .DS_Store # Intellij # .idea *.iml *.log # logback logback.out.xml backend/src/main/resources/public/ backend/target backend/.mvn backend/mvnw frontend/dist/ frontend/node/ frontend/node_modules/ frontend/npm-debug.log frontend/target !.mvn/wrapper/maven-wrapper.jar</code> </pre> <br></div></div><br>  <u>Penting:</u> sebelum Anda mulai bekerja dengan Heroku, tambahkan file bernama <i>Procfile</i> (tanpa ekstensi apa pun) ke direktori root dengan baris: <br>  <code>web: java -Dserver.port=$PORT -jar backend/target/backend-0.0.1-SNAPSHOT.jar</code> , di mana <i>backend-0.0.1-SNAPSHOT.jar</i> adalah nama file JAR <i>rakitan</i> .  Dan pastikan untuk <u>melakukan komit dan dorong</u> . <br><br>  <u>Catatan:</u> Anda juga dapat menambahkan file travis.yaml ke direktori root untuk mengurangi waktu pembuatan dan penerapan aplikasi di Heroku: <br><br><div class="spoiler">  <b class="spoiler_title">travis.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">language: java jdk: - oraclejdk8 script: mvn clean install jacoco:report coveralls:report cache: directories: - node_modules</code> </pre> <br></div></div><br>  Lalu: <br><br>  <b># 1</b> Mendaftar di <a href="https://www.heroku.com/" rel="nofollow">Heroku</a> . <br><br>  <b># 2</b> Buat aplikasi baru: <br><br><div class="spoiler">  <b class="spoiler_title">Buat aplikasi baru</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/u3/ml/bx/u3mlbx0w2ho3uezsrl75nyse2m4.png"><br></div></div><br>  <b># 3</b> Heroku memungkinkan Anda untuk menghubungkan sumber daya tambahan ke aplikasi, misalnya, database PostreSQL.  Untuk melakukan ini, lakukan: <i>Aplikasi -&gt; Sumber Daya -&gt; Pengaya -&gt; Heroku Postgres</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Postoku Heroku</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/k5/l8/ht/k5l8htgji3kaxmqyznbdqhyeuki.png"><br></div></div><br>  <b># 4</b> Pilih paket: <br><br><div class="spoiler">  <b class="spoiler_title">Rencanakan pemilihan</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/id/jv/vd/idjvvdwyyk9ou_wbes00mxvfdac.png"><br></div></div><br>  <b># 5</b> Sekarang Anda dapat melihat sumber daya yang terhubung: <br><br><div class="spoiler">  <b class="spoiler_title">Sumber Daya Terhubung</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/l2/mx/mf/l2mxmf3itjef2-1lpiwmltrtadq.png"><br></div></div><br>  <b># 6</b> Lihatlah kredensial, mereka akan diperlukan untuk mengatur variabel lingkungan: <i>Pengaturan -&gt; Lihat Kredensial</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Lihat kredensial</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gh/xl/v9/ghxlv99r9m2mgrr6ceemgpn-hjg.png"><br></div></div><br>  <b># 7</b> Atur variabel lingkungan: <i>Aplikasi -&gt; Pengaturan -&gt; Reveal Config Vars</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Variabel lingkungan</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xr/uj/q8/xrujq8lynqi6kqoqtqiklpwbaxu.png"><br></div></div><br>  <b># 8</b> Atur variabel lingkungan untuk koneksi dalam format berikut: <br><br><pre> <code class="plaintext hljs">SPRING_DATASOURCE_URL = jdbc:postgresql://&lt;i&gt;hostname:port&lt;/i&gt;/&lt;i&gt;db_name&lt;/i&gt; SPRING_DATASOURCE_USERNAME = &lt;i&gt;username&lt;/i&gt; SPRING_DATASOURCE_PASSWORD = &lt;i&gt;password&lt;/i&gt;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Seperti apa bentuknya</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/me/jr/ne/mejrnecja54rgwchq6peumbc6w0.png"><br></div></div><br>  <b># 9</b> Buat semua tabel yang diperlukan di database baru. <br><br>  <b># 10</b> File application.properties, masing-masing, akan terlihat seperti ini: <br><br><div class="spoiler">  <b class="spoiler_title">properti aplikasi</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">spring.datasource.url=${SPRING_DATASOURCE_URL} spring.datasource.username=${SPRING_DATASOURCE_USERNAME} spring.datasource.password=${SPRING_DATASOURCE_PASSWORD} spring.jpa.generate-ddl=true spring.jpa.properties.hibernate.temp.use_jdbc_metadata_defaults = false spring.jpa.database-platform=org.hibernate.dialect.PostgreSQL9Dialect spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true</code> </pre><br></div></div><br>  <b># 11</b> Buat <i>pipa baru</i> - <i>Buat pipa baru</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Buat pipa baru</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dh/sg/wb/dhsgwbhgaz9arzl4lgwkdoykeda.png"><br></div></div><br>  <b># 12</b> Metode penyebaran - <i>GitHub</i> (klik <i>Sambungkan ke GitHub</i> dan ikuti instruksi di jendela baru). <br><br>  <b># 13</b> <i>Aktifkan Penyebaran Otomatis</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Aktifkan Penyebaran Otomatis</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8e/fb/ui/8efbuinhnr0y1j7eggqkhbjae2s.png"><br></div></div><br>  <b># 14</b> Deploy Manual - Klik <i>Deploy Branch</i> untuk penerapan pertama.  Tepat di browser Anda akan melihat output dari baris perintah. <br><br><div class="spoiler">  <b class="spoiler_title">Penyebaran manual</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/7i/5m/tz/7i5mtzam___vhonxjbtuogrg-ay.png"><br></div></div><br>  <b># 15</b> Klik <i>View</i> setelah bangunan berhasil untuk membuka aplikasi yang digunakan: <br><br><div class="spoiler">  <b class="spoiler_title">Lihat</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cp/p-/fr/cpp-frnkeudluh4bm1ir-f4oi10.png"><br></div></div><br><a name="recaptcha"></a><br><h2>  Perlindungan Bot (reCAPTCHA) </h2><br>  Langkah pertama untuk mengaktifkan verifikasi reCAPTCHA di aplikasi kami adalah membuat reCAPTCH baru di <a href="https://www.google.com/recaptcha/intro/v3.html" rel="nofollow">panel admin Google</a> .  Di sana kami membuat situs baru (Tambah situs baru / Buat) dan atur pengaturan berikut: <br><br><div class="spoiler">  <b class="spoiler_title">Pengaturan ReCAPTCHA</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/xi/eh/rp/xiehrpgngjvxqvd1dq-4wp5gfqc.png"><br></div></div><br>  Di bagian <i>Domain</i> , Anda harus menentukan selain alamat tempat aplikasi akan hidup, Anda harus menentukan <code>localhost</code> , sehingga selama debugging Anda menghindari masalah dalam bentuk ketidakmampuan untuk masuk ke aplikasi Anda. <br><br>  <b>Backend</b> <br><br>  Simpan <i>kunci situs</i> dan <i>kunci rahasia</i> ... <br><br><div class="spoiler">  <b class="spoiler_title">kunci situs / kunci rahasia</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hs/re/-t/hsre-ttxpgbhgau9q4fsvtdqxq0.png"><br></div></div><br>  ... lalu untuk menetapkan mereka ke variabel lingkungan, dan nama variabel, pada gilirannya, untuk menetapkan ke properti <i>application.properties</i> baru: <br><br><pre> <code class="plaintext hljs">google.recaptcha.key.site=${GOOGLE_RECAPTCHA_KEY_SITE} google.recaptcha.key.secret=${GOOGLE_RECAPTCHA_KEY_SECRET}</code> </pre><br>  Tambahkan dependensi baru di <i>pom.xml</i> untuk verifikasi di sisi Google token reCAPTCHA yang akan dikirimkan klien kepada kami: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.mashape.unirest<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>unirest-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.4.9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Sekarang adalah waktu untuk memperbarui entitas yang kami gunakan untuk mengotorisasi dan mendaftarkan pengguna dengan menambahkan bidang string ke mereka untuk token reCAPTCHA yang sama: <br><br><div class="spoiler">  <b class="spoiler_title">LoginUser.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.fasterxml.jackson.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.JsonProperty <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.Serializable <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginUser</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Serializable { @JsonProperty</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"username"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"password"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"recapctha_token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recaptchaToken: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() {} <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(username: String, password: String, recaptchaToken: String) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.username = username <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.recaptchaToken = recaptchaToken } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">1764970284520387975L</span></span> } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">NewUser.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.fasterxml.jackson.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.JsonProperty <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.Serializable <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewUser</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Serializable { @JsonProperty</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"username"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> username: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"firstName"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> firstName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"lastName"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lastName: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"email"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> email: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"password"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> password: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@JsonProperty(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"recapctha_token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> recaptchaToken: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() {} <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(username: String, firstName: String, lastName: String, email: String, password: String, recaptchaToken: String) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.username = username <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.firstName = firstName <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lastName = lastName <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.email = email <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password = password <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.recaptchaToken = recaptchaToken } <span class="hljs-keyword"><span class="hljs-keyword">companion</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> serialVersionUID = -<span class="hljs-number"><span class="hljs-number">1764970284520387975L</span></span> } }</code> </pre><br></div></div><br>  Tambahkan layanan kecil yang akan menyiarkan token reCAPTCHA ke layanan Google khusus dan informasikan sebagai tanggapan apakah token tersebut lolos verifikasi: <br><br><div class="spoiler">  <b class="spoiler_title">ReCaptchaService.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Service <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.client.RestOperations <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Autowired <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mashape.unirest.http.HttpResponse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mashape.unirest.http.JsonNode <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.mashape.unirest.http.Unirest <span class="hljs-meta"><span class="hljs-meta">@Service(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"captchaService"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReCaptchaService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> BASE_VERIFY_URL: String = <span class="hljs-string"><span class="hljs-string">"https://www.google.com/recaptcha/api/siteverify"</span></span> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> restTemplate: RestOperations? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${google.recaptcha.key.site}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keySite: String <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${google.recaptcha.key.secret}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keySecret: String <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateCaptcha</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url: String = String.format(BASE_VERIFY_URL + <span class="hljs-string"><span class="hljs-string">"?secret=%s&amp;response=%s"</span></span>, keySecret, token) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jsonResponse: HttpResponse&lt;JsonNode&gt; = Unirest.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(url) .header(<span class="hljs-string"><span class="hljs-string">"accept"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>).queryString(<span class="hljs-string"><span class="hljs-string">"apiKey"</span></span>, <span class="hljs-string"><span class="hljs-string">"123"</span></span>) .asJson() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (jsonResponse.getStatus() == <span class="hljs-number"><span class="hljs-number">200</span></span>) } }</code> </pre><br></div></div><br>  Layanan ini harus digunakan dalam pengontrol registrasi dan otorisasi pengguna: <br><br><div class="spoiler">  <b class="spoiler_title">AuthController.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.ReCaptchaService ‚Ä¶ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> captchaService: ReCaptchaService ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(loginRequest.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>]... ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(newUser.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>...</code> </pre><br></div></div><br>  <b>Frontend</b> <br><br>  Langkah pertama adalah menginstal dan menyimpan paket <code>reCAPTHA</code> : <br><br><pre> <code class="plaintext hljs">$ npm install --save vue-recaptcha</code> </pre> <br>  Kemudian sambungkan ke skrip di <i>index.html</i> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.google.com/recaptcha/api.js onload=vueRecaptchaApiLoaded&amp;render=explicit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">async</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Tambahkan captcha ke ruang kosong di halaman: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vue-recaptcha</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"recaptcha"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"invisible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:sitekey</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sitekey"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">verify</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onCapthcaVerified"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expired</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onCaptchaExpired"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  Dan tombol untuk tindakan target (otorisasi atau registrasi) sekarang akan memanggil metode validasi: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-on:click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"validateCaptcha"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">variant</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b-button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Tambahkan ketergantungan ke komponen: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VueRecaptcha <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'vue-recaptcha'</span></span></code> </pre> <br>  Edit <i>ekspor standar</i> : <br><br><pre> <code class="javascript hljs">components: { VueRecaptcha }, ‚Ä¶ data() { ‚Ä¶ siteKey: <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">  </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">i</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ‚Ä¶ }</code> </pre><br>  Dan tambahkan metode baru: <br><br><ul><li>  <code>validateCaptcha()</code> - yang dipanggil dengan mengklik tombol </li><li>  <code>onCapthcaVerified(recaptchaToken)  onCaptchaExpired()</code> - yang captcha sendiri memanggil </li></ul><br><div class="spoiler">  <b class="spoiler_title">Metode baru</b> <div class="spoiler_text"><pre> <code class="javascript hljs">validateCaptcha() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$refs.recaptcha.execute() }, onCapthcaVerified(recaptchaToken) { AXIOS.post(<span class="hljs-string"><span class="hljs-string">`/auth/signin`</span></span>, {<span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$data.username, <span class="hljs-string"><span class="hljs-string">'password'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$data.password, <span class="hljs-string"><span class="hljs-string">'recapctha_token'</span></span>: recaptchaToken}) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$store.dispatch(<span class="hljs-string"><span class="hljs-string">'login'</span></span>, {<span class="hljs-string"><span class="hljs-string">'token'</span></span>: response.data.accessToken, <span class="hljs-string"><span class="hljs-string">'roles'</span></span>: response.data.authorities, <span class="hljs-string"><span class="hljs-string">'username'</span></span>: response.data.username}); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$router.push(<span class="hljs-string"><span class="hljs-string">'/home'</span></span>) }, error =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showAlert(error.response.data.message); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showAlert(<span class="hljs-string"><span class="hljs-string">'Server error. Please, report this error website owners'</span></span>); }) }, onCaptchaExpired() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$refs.recaptcha.reset() }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Hasil</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/m0/rc/w9/m0rcw9xjgqjqpgiuwdib16_mur8.png"><br></div></div><br><a name="email"></a><br><h2>  Pengiriman email </h2><br>  Pertimbangkan kemungkinan pengiriman surat ke aplikasi kami melalui server surat publik, seperti Google atau Mail.ru. <br><br>  Langkah pertama, masing-masing, adalah membuat akun di server surat yang dipilih, jika belum. <br><br>  Langkah kedua kita perlu menambahkan dependensi berikut di <i>pom.xml</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Ketergantungan</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-mail<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-thymeleaf<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>commons-io<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>commons-io<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Anda juga perlu menambahkan properti baru ke <i>application.properties</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Properti SMTP</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">spring.mail.host=${SMTP_MAIL_HOST} spring.mail.port=${SMTP_MAIL_PORT} spring.mail.username=${SMTP_MAIL_USERNAME} spring.mail.password=${SMTP_MAIL_PASSWORD} spring.mail.properties.mail.smtp.auth=true spring.mail.properties.mail.smtp.starttls.enable=true spring.mail.properties.mail.smtp.ssl.enable=true spring.mail.properties.mail.smtp.connectiontimeout=5000 spring.mail.properties.mail.smtp.timeout=5000 spring.mail.properties.mail.smtp.writetimeout=5000</code> </pre><br></div></div><br>  Anda dapat menentukan pengaturan SMTP di sini: <a href="https://support.google.com/mail/answer/7126229%3Fhl%3Dru" rel="nofollow">Google</a> dan <a href="https://help.mail.ru/mail-help/mailer/popsmtp" rel="nofollow">Mail.ru</a> <br><br>  Buat antarmuka tempat kami mendeklarasikan beberapa metode: <br><br><ul><li>  Untuk mengirim pesan teks biasa </li><li>  Untuk mengirim email HTML </li><li>  Untuk mengirim email menggunakan templat </li></ul><br><div class="spoiler">  <b class="spoiler_title">EmailService.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.email <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.SimpleMailMessage <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmailService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessageUsingTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, params:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MutableMap</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt;)</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHtmlMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, htmlMsg: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> }</code> </pre><br></div></div><br>  Sekarang mari kita buat implementasi dari antarmuka ini - layanan pengiriman email: <br><br><div class="spoiler">  <b class="spoiler_title">EmailServiceImpl.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.email <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Autowired <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.core.io.FileSystemResource <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.MailException <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.SimpleMailMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.javamail.JavaMailSender <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.mail.javamail.MimeMessageHelper <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.thymeleaf.spring5.SpringTemplateEngine <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.thymeleaf.context.Context <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.File <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.mail.MessagingException <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.mail.internet.MimeMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.apache.commons.io.IOUtils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.core.env.Environment <span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmailServiceImpl</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmailService { @Value</span></span></span></span>(<span class="hljs-string"><span class="hljs-string">"\${spring.mail.username}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sender: String <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> environment: Environment <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailSender: JavaMailSender? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templateEngine: SpringTemplateEngine <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, text: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = SimpleMailMessage() message.setTo(to) message.setFrom(sender) message.setSubject(subject) message.setText(text) emailSender!!.send(message) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (exception: MailException) { exception.printStackTrace() } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleMessageUsingTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, template: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, params:</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MutableMap</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = emailSender!!.createMimeMessage() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = MimeMessageHelper(message, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context: Context = Context() context.setVariables(params) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> html: String = templateEngine.process(template, context) helper.setTo(to) helper.setFrom(sender) helper.setText(html, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) helper.setSubject(subject) emailSender!!.send(message) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHtmlMessage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, subject: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, htmlMsg: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> message = emailSender!!.createMimeMessage() message.setContent(htmlMsg, <span class="hljs-string"><span class="hljs-string">"text/html"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> helper = MimeMessageHelper(message, <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) helper.setTo(to) helper.setFrom(sender) helper.setSubject(subject) emailSender!!.send(message) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (exception: MailException) { exception.printStackTrace() } } }</code> </pre><br></div></div><br><ul><li>  Kami menggunakan JavaMailSender yang dikonfigurasi secara otomatis oleh Spring untuk mengirim email </li><li>  Mengirim surat biasa sangat sederhana - Anda hanya perlu menambahkan teks ke badan surat dan mengirimkannya </li><li>  Email HTML didefinisikan sebagai pesan Mime Type, dan isinya sebagai <code>text/html</code> </li><li>  Untuk memproses template pesan HTML, kami menggunakan Spring Template Engine </li></ul><br>  Mari kita membuat template sederhana untuk menulis menggunakan kerangka <a href="https://www.thymeleaf.org/" rel="nofollow">Thymeleaf</a> dengan menempatkannya di <i>src / main / resources / templates /</i> : <br><br><div class="spoiler">  <b class="spoiler_title">emailTemplate.html</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/1999/xhtml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:th</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.thymeleaf.org"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Hello<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-family: Arial, Helvetica, sans-serif;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Hello!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"margin-top: 20px; margin-bottom: 30px; margin-left: 20px;"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Hello, dear: <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">th:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${addresseeName}"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">th:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${signatureImage}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"200px;"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Elemen perubahan templat (dalam kasus kami, nama penerima dan jalur gambar untuk tanda tangan) dinyatakan menggunakan placeholder. <br><br>  Sekarang buat atau perbarui pengontrol yang akan mengirim surat: <br><br><div class="spoiler">  <b class="spoiler_title">BackendController.kt</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.email.EmailServiceImpl <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.web.response.ResponseMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.ResponseEntity <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.HttpStatus ‚Ä¶ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailService: EmailService <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${spring.mail.username}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> addressee: String ‚Ä¶ <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/sendSimpleEmail"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@PreAuthorize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasRole('USER')"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendSimpleEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { emailService.sendSimpleMessage(addressee, <span class="hljs-string"><span class="hljs-string">"Simple Email"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello! This is simple email"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Error while sending message"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email has been sent"</span></span>), HttpStatus.OK) } <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/sendTemplateEmail"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@PreAuthorize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasRole('USER')"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendTemplateEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> params:MutableMap&lt;String, Any&gt; = mutableMapOf() params[<span class="hljs-string"><span class="hljs-string">"addresseeName"</span></span>] = addressee params[<span class="hljs-string"><span class="hljs-string">"signatureImage"</span></span>] = <span class="hljs-string"><span class="hljs-string">"https://coderlook.com/wp-content/uploads/2019/07/spring-by-pivotal.png"</span></span> emailService.sendSimpleMessageUsingTemplate(addressee, <span class="hljs-string"><span class="hljs-string">"Template Email"</span></span>, <span class="hljs-string"><span class="hljs-string">"emailTemplate"</span></span>, params) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Error while sending message"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email has been sent"</span></span>), HttpStatus.OK) } <span class="hljs-meta"><span class="hljs-meta">@GetMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/sendHtmlEmail"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@PreAuthorize(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"hasRole('USER')"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendHtmlEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { emailService.sendHtmlMessage(addressee, <span class="hljs-string"><span class="hljs-string">"HTML Email"</span></span>, <span class="hljs-string"><span class="hljs-string">"&lt;h1&gt;Hello!&lt;/h1&gt;&lt;p&gt;This is HTML email&lt;/p&gt;"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e: Exception) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Error while sending message"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email has been sent"</span></span>), HttpStatus.OK) }</code> </pre><br></div></div><br>  <u>Catatan:</u> Untuk memastikan semuanya bekerja, pertama kami akan mengirim surat kepada diri kami sendiri. <br><br>  Selain itu, untuk memastikan semuanya bekerja, kita dapat membuat antarmuka web sederhana yang hanya akan menarik metode layanan web: <br><br><div class="spoiler">  <b class="spoiler_title">Email.vue</b> <div class="spoiler_text"><pre> <code class="javascript hljs">&lt;template&gt; &lt;div id="email"&gt; &lt;b-button v-on:click="sendSimpleMessage" variant="primary"&gt;Simple Email&lt;/b-button&gt;&lt;br/&gt; &lt;b-button v-on:click="sendEmailUsingTemplate" variant="primary"&gt;Template Email&lt;/b-button&gt;&lt;br/&gt; &lt;b-button v-on:click="sendHTMLEmail" variant="primary"&gt;HTML Email&lt;/b-button&gt;&lt;br/&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import {AXIOS} from './http-common' export default { name: 'EmailPage', data() { return { counter: 0, username: '', header: {'Authorization': 'Bearer ' + this.$store.getters.getToken} } }, methods: { sendSimpleMessage() { AXIOS.get('/sendSimpleEmail', { headers: this.$data.header }) .then(response =&gt; { console.log(response); alert("OK"); }) .catch(error =&gt; { console.log('ERROR: ' + error.response.data); }) }, sendEmailUsingTemplate() { AXIOS.get('/sendTemplateEmail', { headers: this.$data.header }) .then(response =&gt; { console.log(response); alert("OK") }) .catch(error =&gt; { console.log('ERROR: ' + error.response.data); }) }, sendHTMLEmail() { AXIOS.get('/sendHtmlEmail', { headers: this.$data.header }) .then(response =&gt; { console.log(response); alert("OK") }) .catch(error =&gt; { console.log('ERROR: ' + error.response.data); }) } } } &lt;/script&gt; &lt;style&gt; #email { margin-left: 38%; margin-top: 50px; } button { width: 150px; } &lt;/style&gt;</code> </pre><br></div></div><br>  <u>Catatan:</u> jangan lupa untuk memperbarui <code>router.js</code> dan menambahkan tautan ke <code>App.vue</code> navigasi <code>App.vue</code> jika Anda membuat komponen baru. <br><br><a name="gradle"></a><br><h2>  Migrasi Gradle </h2><br>  Saya akan mengklarifikasi segera: jika item ini dianggap sebagai peningkatan, biarkan semua orang memutuskan untuk proyeknya sendiri.  Kami hanya melihat bagaimana melakukan ini. <br><br>  Secara umum, Anda dapat menggunakan <a href="http://www.rationaljava.com/2016/02/moving-from-maven-to-gradle-in-under-5.html" rel="nofollow">Pindah dari Maven ke Gradle dalam waktu kurang dari 5 menit</a> , tetapi hasilnya tidak sesuai dengan harapan.  Saya masih merekomendasikan melakukan migrasi secara manual, tidak akan memakan waktu lebih lama. <br><br>  Hal pertama yang perlu kita lakukan adalah <a href="https://gradle.org/install/" rel="nofollow">menginstal Gradle</a> . <br><br>  Maka kita perlu melakukan prosedur berikut untuk kedua subproyek - <code>backend</code> dan <code>fronted</code> : <br><br>  <b># 1</b> Hapus file Maven - <i>pom.xml</i> , <i>.mvn</i> . <br><br>  <b># 2</b> Dalam direktori sub proyek, jalankan gradle init dan jawab pertanyaan: <br><br><ul><li>  <i>Pilih jenis proyek untuk menghasilkan:</i> <b>dasar</b> </li><li>  <i>Pilih bahasa implementasi:</i> <b>Kotlin</b> </li><li>  <i>Pilih skrip bangun DSL:</i> <b>Kotlin</b> (karena kami sedang menulis proyek di Kotlin) </li></ul><br>  <b># 3</b> Hapus <i>settings.gradle.kts</i> - file ini hanya diperlukan untuk proyek root. <br><br>  <b># 4</b> Jalankan <code>gradle wrapper</code> . <br><br>  Sekarang mari kita beralih ke proyek root kami.  Untuk itu, Anda harus mengikuti langkah 1, 2 dan 4 yang dijelaskan di atas untuk sub-proyek - semuanya sama <u>kecuali menghapus <i>settings.gradle.kts</i></u> . <br><br>  Konfigurasi build untuk proyek <i>backend</i> akan terlihat seperti ini: <br><br><div class="spoiler">  <b class="spoiler_title">build.gradle.kts</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jetbrains.kotlin.gradle.tasks.KotlinCompile plugins { id(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot"</span></span>) version <span class="hljs-string"><span class="hljs-string">"2.1.3.RELEASE"</span></span> id(<span class="hljs-string"><span class="hljs-string">"io.spring.dependency-management"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.0.8.RELEASE"</span></span> kotlin(<span class="hljs-string"><span class="hljs-string">"jvm"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.3.50"</span></span> kotlin(<span class="hljs-string"><span class="hljs-string">"plugin.spring"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.3.50"</span></span> id(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin.plugin.jpa"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.3.50"</span></span> } group = <span class="hljs-string"><span class="hljs-string">"com.kotlin-spring-vue"</span></span> version = <span class="hljs-string"><span class="hljs-string">"0.0.1-SNAPSHOT"</span></span> java.sourceCompatibility = JavaVersion.VERSION_1_8 repositories { mavenCentral() maven { url = uri(<span class="hljs-string"><span class="hljs-string">"https://plugins.gradle.org/m2/"</span></span>) } } dependencies { runtimeOnly(project(<span class="hljs-string"><span class="hljs-string">":frontend"</span></span>)) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-actuator:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-web:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-data-jpa:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-mail:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-security:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.postgresql:postgresql:42.2.5"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-thymeleaf:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"commons-io:commons-io:2.4"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"io.jsonwebtoken:jjwt:0.9.0"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"io.jsonwebtoken:jjwt-api:0.10.6"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"com.mashape.unirest:unirest-java:1.4.9"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"com.fasterxml.jackson.module:jackson-module-kotlin:2.9.8"</span></span>) runtimeOnly(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-devtools:2.1.3.RELEASE"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-reflect"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib-jdk8"</span></span>) implementation(<span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-noarg:1.3.50"</span></span>) testImplementation(<span class="hljs-string"><span class="hljs-string">"org.springframework.boot:spring-boot-starter-test"</span></span>) { exclude(group = <span class="hljs-string"><span class="hljs-string">"org.junit.vintage"</span></span>, module = <span class="hljs-string"><span class="hljs-string">"junit-vintage-engine"</span></span>) } } tasks.withType&lt;KotlinCompile&gt; { kotlinOptions { freeCompilerArgs = listOf(<span class="hljs-string"><span class="hljs-string">"-Xjsr305=strict"</span></span>) jvmTarget = <span class="hljs-string"><span class="hljs-string">"1.8"</span></span> } }</code> </pre><br></div></div><br><ul><li>  Semua plugin Kotlin dan Spring yang diperlukan harus ditentukan. </li><li>  Jangan lupa tentang plugin <i>org.jetbrains.kotlin.plugin.jpa</i> - perlu terhubung ke database </li><li>  Dalam dependensi, Anda harus menentukan <code>runtimeOnly(project(":frontend"))</code> - kita perlu membangun proyek <i>frontend</i> terlebih dahulu </li></ul><br>  Membangun konfigurasi untuk proyek <i>frontend</i> : <br><br><div class="spoiler">  <b class="spoiler_title">build.gradle.kts</b> <div class="spoiler_text"><pre> <code class="kotlin hljs">plugins { id(<span class="hljs-string"><span class="hljs-string">"org.siouan.frontend"</span></span>) version <span class="hljs-string"><span class="hljs-string">"1.2.1"</span></span> id(<span class="hljs-string"><span class="hljs-string">"java"</span></span>) } group = <span class="hljs-string"><span class="hljs-string">"com.kotlin-spring-vue"</span></span> version = <span class="hljs-string"><span class="hljs-string">"0.0.1-SNAPSHOT"</span></span> java { targetCompatibility = JavaVersion.VERSION_1_8 } buildscript { repositories { mavenCentral() maven { url = uri(<span class="hljs-string"><span class="hljs-string">"https://plugins.gradle.org/m2/"</span></span>) } } } frontend { nodeVersion.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"10.16.0"</span></span>) cleanScript.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"run clean"</span></span>) installScript.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"install"</span></span>) assembleScript.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">"run build"</span></span>) } tasks.named(<span class="hljs-string"><span class="hljs-string">"jar"</span></span>, Jar::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) </span></span>{ dependsOn(<span class="hljs-string"><span class="hljs-string">"assembleFrontend"</span></span>) from(<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$buildDir</span></span></span><span class="hljs-string">/dist"</span></span>) into(<span class="hljs-string"><span class="hljs-string">"static"</span></span>) }</code> </pre><br></div></div><br><ul><li>  Dalam contoh saya, plugin <code>org.siouan.frontend</code> digunakan untuk membangun proyek </li><li>  Di bagian <code>frontend {...}</code> harus menunjukkan versi Node.js, serta perintah yang menjalankan skrip pembersihan, instalasi dan perakitan yang ditentukan dalam <code>package.json</code> </li><li>  Sekarang kita kemas sub proyek frontend kita menjadi file JAR dan menggunakannya sebagai dependensi ( <code>runtimeOnly(project(":frontend"))</code> di <i>backend</i> ), jadi kita perlu menggambarkan tugas yang menyalin file dari direktori assembly ke <i>/ publik</i> dan membuat file jar </li></ul><br>  <u>Catatan:</u> <br><br><ul><li>  Edit <code>vue.config.js</code> , ubah direktori <i>build</i> menjadi <i>build / dist</i> . </li><li>  Dalam file <i>skrip build</i> <code>package.json</code> , tentukan <i>build</i> <code>vue-cli-service build</code> atau pastikan itu ditentukan </li></ul><br>  File settings.gradle.kts dalam proyek root harus berisi kode berikut: ... <br><br><pre> <code class="kotlin hljs">rootProject.name = <span class="hljs-string"><span class="hljs-string">"demo"</span></span> include(<span class="hljs-string"><span class="hljs-string">":frontend"</span></span>, <span class="hljs-string"><span class="hljs-string">":backend"</span></span>)</code> </pre><br>  ... adalah nama proyek dan sub-proyek. <br><br>  Dan sekarang kita dapat membangun proyek dengan menjalankan perintah: <code>./gradlew build</code> <br><br>  <u>Catatan:</u> jika untuk placeholder ditentukan dalam <i>application.properties</i> (misalnya, <code>${SPRING_DATASOURCE_URL}</code> ) tidak ada variabel lingkungan yang sesuai, perakitan akan gagal.  Untuk menghindarinya, gunakan <code><b>/gradlew build -x</b></code> <br><br>  Anda dapat memeriksa struktur proyek menggunakan perintah <code>gradle -q projects</code> , hasilnya akan terlihat mirip dengan ini: <br><br><pre> <code class="plaintext hljs">Root project 'demo' +--- Project ':backend' \--- Project ':frontend'</code> </pre> <br>  Dan akhirnya, untuk menjalankan aplikasi, Anda harus menjalankan <code>./gradlew bootRun</code> . <br><br><h4>  .gitignore </h4><br>  File dan folder berikut harus ditambahkan ke file <i>.gitignore</i> : <br><br><ul><li>  backend / build / </li><li>  frontend / bangun / </li><li>  membangun </li><li>  .gradle </li></ul><br>  <u>Penting:</u> Anda tidak harus menambahkan file <code>gradlew</code> ke <i>.gitignore</i> - tidak ada yang berbahaya di dalamnya, tetapi mereka diperlukan untuk perakitan yang sukses di server jauh. <br><br><h4>  Penempatan di Heroku </h4><br>  Mari kita lihat perubahan yang perlu kita lakukan agar aplikasi dapat digunakan dengan aman ke Heroku. <br><br>  <b>Procfile # 1</b> <br><br>  Kita perlu bertanya pada Heroku instruksi baru untuk meluncurkan aplikasi: <br><br><pre> <code class="plaintext hljs">web: java -Dserver.port=$PORT -jar backend/build/libs/backend-0.0.1-SNAPSHOT.jar</code> </pre> <br>  <b>Variabel lingkungan # 2</b> <br><br>  Heroku dapat membuat kembali jenis aplikasi (misalnya, aplikasi Spring Boot) dan mengikuti instruksi perakitan yang sesuai.  Tetapi aplikasi kami (proyek root) tidak terlihat seperti aplikasi Spring Boot untuk Heroku.  Jika kita meninggalkan semuanya apa adanya, Heroku akan meminta kita untuk menentukan <code>stage</code> .  Jujur, saya tidak tahu di mana jalan ini berakhir, karena saya tidak mengikutinya.  Lebih mudah untuk mendefinisikan variabel <code>GRADLE_TASK</code> dengan nilai <code>build</code> : <br><br><img src="https://habrastorage.org/webt/5j/xz/o2/5jxzo2ukto8lyakkxajjg5rrvtg.png"><br><br>  <b># 3 reCAPTCHA</b> <br><br>  Saat menempatkan aplikasi di domain baru, jangan lupa untuk memperbarui captcha, variabel lingkungan <code>GOOGLE_RECAPTCHA_KEY_SITE</code> dan <code>GOOGLE_RECAPTCHA_KEY_SECRET</code> , serta memperbarui Kunci Situs di subproyek frontend. <br><br><a name="cookies"></a><br><h2>  Menyimpan Token JWT di Cookie </h2><br>  Pertama-tama, saya sangat menyarankan Anda membaca artikel <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/" rel="nofollow">Harap Berhenti Menggunakan Penyimpanan Lokal</a> , terutama <i>Mengapa Penyimpanan Lokal Tidak Aman dan Anda Tidak Harus Menggunakannya untuk Menyimpan</i> bagian <i>Data Sensitif</i> . <br><br>  Mari kita lihat bagaimana Anda dapat menyimpan token JWT di tempat yang lebih aman - cookie di bendera <code>httpOnly</code> , yang tidak tersedia untuk dibaca / diubah menggunakan JavaScript. <br><br>  <b># 1</b> Menghapus semua logika terkait JWT dari frontend: <br>  Karena token masih tidak dapat diakses dengan JavaScript dengan metode penyimpanan baru, Anda dapat dengan aman menghapus semua referensi dari sub-proyek kami. <br><br>  Tetapi peran pengguna tanpa referensi ke data lain adalah informasi yang tidak begitu penting, masih dapat disimpan di Penyimpanan Lokal dan ditentukan apakah pengguna berwenang atau tidak, tergantung pada apakah peran ini didefinisikan. <br><br><div class="spoiler">  <b class="spoiler_title">store / index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vue <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'vue'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Vuex <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'vuex'</span></span>; Vue.use(Vuex); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> state = { <span class="hljs-attr"><span class="hljs-attr">role</span></span>: localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'user-name'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">authorities</span></span>: localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'authorities'</span></span>) || <span class="hljs-string"><span class="hljs-string">''</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> getters = { <span class="hljs-attr"><span class="hljs-attr">isAuthenticated</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.role != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; state.role != <span class="hljs-string"><span class="hljs-string">''</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">isAdmin</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.role === <span class="hljs-string"><span class="hljs-string">'admin'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">getUsername</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.username; }, <span class="hljs-attr"><span class="hljs-attr">getAuthorities</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.authorities; } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mutations = { <span class="hljs-attr"><span class="hljs-attr">auth_login</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, user</span></span></span><span class="hljs-function">) =&gt;</span></span> { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-name'</span></span>, user.username); localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-authorities'</span></span>, user.roles); state.username = user.username; state.authorities = user.roles; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isUser = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isAdmin = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; user.roles.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user.roles[i].authority === <span class="hljs-string"><span class="hljs-string">'ROLE_USER'</span></span>) { isUser = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user.roles[i].authority === <span class="hljs-string"><span class="hljs-string">'ROLE_ADMIN'</span></span>) { isAdmin = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isUser) { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>, <span class="hljs-string"><span class="hljs-string">'user'</span></span>); state.role = <span class="hljs-string"><span class="hljs-string">'user'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isAdmin) { localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>, <span class="hljs-string"><span class="hljs-string">'admin'</span></span>); state.role = <span class="hljs-string"><span class="hljs-string">'admin'</span></span>; } }, <span class="hljs-attr"><span class="hljs-attr">auth_logout</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { state.token = <span class="hljs-string"><span class="hljs-string">''</span></span>; state.role = <span class="hljs-string"><span class="hljs-string">''</span></span>; state.username = <span class="hljs-string"><span class="hljs-string">''</span></span>; state.authorities = []; localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'user-role'</span></span>); localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'user-name'</span></span>); localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'user-authorities'</span></span>); } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> actions = { <span class="hljs-attr"><span class="hljs-attr">login</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context, user</span></span></span><span class="hljs-function">) =&gt;</span></span> { context.commit(<span class="hljs-string"><span class="hljs-string">'auth_login'</span></span>, user) }, <span class="hljs-attr"><span class="hljs-attr">logout</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function">) =&gt;</span></span> { context.commit(<span class="hljs-string"><span class="hljs-string">'auth_logout'</span></span>); } }; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vuex.Store({ state, getters, mutations, actions });</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berhati-hatilah saat refactoring </font></font><code>store/index.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: jika otorisasi dan deauthorisasi tidak berfungsi dengan benar, pesan kesalahan akan terus-menerus masuk ke konsol. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kembalikan JWT sebagai cookie di pengontrol otorisasi ( </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bukan di badan respons</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthController.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.authCookieName}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCookieName: String <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.isCookieSecure}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isCookieSecure: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-meta"><span class="hljs-meta">@PostMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/signin"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authenticateUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Valid</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestBody</span></span></span></span><span class="hljs-function"><span class="hljs-params"> loginRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoginUser</span></span></span></span><span class="hljs-function"><span class="hljs-params">, response: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpServletResponse</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userCandidate: Optional &lt;User&gt; = userRepository.findByUsername(loginRequest.username!!) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(loginRequest.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userCandidate.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User = userCandidate.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authentication = authenticationManager.authenticate( UsernamePasswordAuthenticationToken(loginRequest.username, loginRequest.password)) SecurityContextHolder.getContext().setAuthentication(authentication) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jwt: String = jwtProvider.generateJwtToken(user.username!!) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cookie: Cookie = Cookie(authCookieName, jwt) cookie.maxAge = jwtProvider.jwtExpiration!! cookie.secure = isCookieSecure cookie.isHttpOnly = <span class="hljs-literal"><span class="hljs-literal">true</span></span> cookie.path = <span class="hljs-string"><span class="hljs-string">"/"</span></span> response.addCookie(cookie) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authorities: List&lt;GrantedAuthority&gt; = user.roles!!.stream().map({ role -&gt; SimpleGrantedAuthority(role.name)}).collect(Collectors.toList&lt;GrantedAuthority&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity.ok(SuccessfulSigninResponse(user.username, authorities)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"User not found!"</span></span>), HttpStatus.BAD_REQUEST) } }</code> </pre><br></div></div><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penting</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : Silakan dicatat bahwa saya menempatkan pilihan </font></font><code>authCookieName</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>isCookieSecure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">di </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application.properties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - mengirimkan cookies untuk bendera </font></font><code>secure</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hanya dapat https, yang membuatnya sangat sulit untuk debug dengan localhost. </font><font style="vertical-align: inherit;">TETAPI dalam produksi, tentu saja, lebih baik menggunakan cookie dengan bendera ini. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu, disarankan untuk tanggapan controller untuk menggunakan entitas tanpa bidang khusus untuk JWT. </font><font style="vertical-align: inherit;">Pembaruan </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 3</font></font></b><font style="vertical-align: inherit;"></font><code>JwtAuthTokenFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami dulu mengambil token dari header permintaan, sekarang kami mengambilnya dari cookie:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JwtAuthTokenFilter.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.authCookieName}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCookieName: String ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getJwt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpServletRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String? { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (cookie <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request.cookies) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookie.name == authCookieName) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cookie.value } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> }</code> </pre><br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mengaktifkan </font></font><a href="https://ru.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORS</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jika dalam artikel saya sebelumnya Anda masih bisa dengan tenang melewati pertanyaan ini, sekarang akan aneh untuk melindungi token JWT tanpa harus mengaktifkan CORS di sisi backend. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anda dapat memperbaikinya dengan mengedit </font></font><code>WebSecurityConfig.kt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WebSecurityConfig.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corsConfigurationSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: CorsConfigurationSource { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> configuration = CorsConfiguration() configuration.allowedOrigins = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"http://localhost:8080"</span></span>, <span class="hljs-string"><span class="hljs-string">"http://localhost:8081"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://kotlin-spring-vue-gradle-demo.herokuapp.com"</span></span>) configuration.allowedHeaders = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"*"</span></span>) configuration.allowedMethods = Arrays.asList(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"POST"</span></span>, <span class="hljs-string"><span class="hljs-string">"PUT"</span></span>, <span class="hljs-string"><span class="hljs-string">"DELETE"</span></span>, <span class="hljs-string"><span class="hljs-string">"OPTIONS"</span></span>) configuration.allowCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span> configuration.maxAge = <span class="hljs-number"><span class="hljs-number">3600</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> source = UrlBasedCorsConfigurationSource() source.registerCorsConfiguration(<span class="hljs-string"><span class="hljs-string">"/**"</span></span>, configuration) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source } <span class="hljs-meta"><span class="hljs-meta">@Throws(Exception::class)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(http: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpSecurity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { http .cors().and() .csrf().disable().authorizeRequests() .antMatchers(<span class="hljs-string"><span class="hljs-string">"/**"</span></span>).permitAll() .anyRequest().authenticated() .and() .exceptionHandling().authenticationEntryPoint(unauthorizedHandler).and() .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS) http.addFilterBefore(authenticationJwtTokenFilter(), UsernamePasswordAuthenticationFilter::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headers</span></span></span></span>().cacheControl().disable() }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dan sekarang Anda dapat menghapus semua anotasi </font></font><code>@CrossOrigin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dari pengontrol. </font></font><br><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penting:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AllowCredentials</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> diperlukan untuk mengirim permintaan dari frontend. </font><font style="vertical-align: inherit;">Baca lebih lanjut tentang ini di </font></font><a href="https://stackoverflow.com/questions/45004354/when-should-i-really-set-access-control-allow-credentials-to-true-in-my-resp" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Memperbarui tajuk di sisi front-end:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-commons.js</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AXIOS = axios.create({ <span class="hljs-attr"><span class="hljs-attr">baseURL</span></span>: <span class="hljs-string"><span class="hljs-string">`/api`</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>: [<span class="hljs-string"><span class="hljs-string">'http://localhost:8080'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://localhost:8081'</span></span>, <span class="hljs-string"><span class="hljs-string">'https://kotlin-spring-vue-gradle-demo.herokuapp.com'</span></span>], <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>: <span class="hljs-string"><span class="hljs-string">'GET,POST,DELETE,PUT,OPTIONS'</span></span>, <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>: <span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } })</code> </pre><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Periksa </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mari kita coba masuk ke aplikasi dengan masuk dari host yang tidak ada dalam daftar yang diizinkan </font></font><code>WebSecurityConfig.kt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Untuk melakukan ini, jalankan backend di port </font></font><code>8080</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dan frontend, misalnya, aktif </font></font><code>8082</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan coba masuk:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sw/ce/hk/swcehkifaph10nqjveh17sv1w88.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Permintaan otorisasi ditolak oleh kebijakan CORS. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang mari kita lihat bagaimana flag cookies bekerja secara umum </font></font><code>httpOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Untuk melakukan ini, mari kita pergi, misalnya, ke situs </font></font><a href="https://kotlinlang.org/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://kotlinlang.org</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan jalankan di konsol browser:</font></font><br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/4o/s7/ct/4os7ctztsejgbzclio8ci8nloky.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Non- </font></font><code>httpOnly</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cookie yang terkait dengan situs ini </font><font style="vertical-align: inherit;">akan muncul di konsol </font><font style="vertical-align: inherit;">, yang, seperti yang kita lihat, dapat diakses melalui JavaScript. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang mari kita masuk ke aplikasi kita, </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">login</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (sehingga browser </font><font style="vertical-align: inherit;">menyimpan cookie </font><font style="vertical-align: inherit;">dengan JWT) dan ulangi hal yang sama:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/fh/_b/zh/fh_bzh9ytv6rf_xn40fjf3c83ag.png"><br></div></div><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Catatan:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> metode penyimpanan token JWT ini lebih andal daripada menggunakan Penyimpanan Lokal, tetapi Anda harus memahami bahwa ini bukan obat mujarab.</font></font><br><br><a name="confirmation"></a><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Konfirmasi Pendaftaran Email </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Algoritma singkat untuk melakukan tugas ini adalah sebagai berikut: </font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Untuk semua pengguna baru, atribut </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dalam database diatur ke</font></font><code>false</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Token string dihasilkan dari karakter arbitrer, yang akan berfungsi sebagai kunci untuk mengonfirmasi pendaftaran </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Token dikirimkan kepada pengguna melalui pos sebagai bagian dari tautan </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atribut </font></font><code>isEnabled</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disetel ke </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> jika pengguna mengikuti tautan untuk periode waktu yang ditentukan.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang pertimbangkan proses ini secara lebih rinci. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kami membutuhkan meja untuk menyimpan token untuk mengonfirmasi pendaftaran:</font></font><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> public.verification_token ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, token <span class="hljs-built_in"><span class="hljs-built_in">character</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varying</span></span>, expiry_date <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, user_id <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">ALTER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> public.verification_token <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> verification_token_users_fk <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (user_id) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> public.users (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">MATCH</span></span> SIMPLE <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Dan, karenanya, entitas baru untuk pemetaan objek-relasional ...: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerificationToken.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.jpa <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.sql.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Calendar <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"verification_token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationToken</span></span></span></span>( <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> id: <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>? = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"token"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"expiry_date"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> expiryDate: Date, <span class="hljs-meta"><span class="hljs-meta">@OneToOne(targetEntity = User::class, fetch = FetchType.EAGER, cascade = [CascadeType.PERSIST])</span></span> <span class="hljs-meta"><span class="hljs-meta">@JoinColumn(nullable = false, name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user_id"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User ) { <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(token: String?, user: User) : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>, token, calculateExpiryDate(<span class="hljs-number"><span class="hljs-number">1440</span></span>), user) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculateExpiryDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(expiryTimeInMinutes: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Date { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cal = Calendar.getInstance() cal.time = Timestamp(cal.time.time) cal.add(Calendar.MINUTE, expiryTimeInMinutes) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Date(cal.time.time) }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ... dan repositori: </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VerificationTokenRepository.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.repository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.jpa.VerificationToken <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>.jpa.repository.JpaRepository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.* <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VerificationTokenRepository</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">VerificationToken, Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Optional&lt;VerificationToken&gt; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang kita perlu mengimplementasikan alat untuk mengelola token - membuat, memverifikasi dan mengirim melalui email. </font><font style="vertical-align: inherit;">Untuk melakukan ini, kami memodifikasi </font></font><code>UserDetailsServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan menambahkan metode untuk membuat dan memverifikasi token:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserDetailsServiceImpl.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createVerificationTokenForUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">, user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { tokenRepository.save(VerificationToken(token, user)) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validateVerificationToken</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> verificationToken: Optional&lt;VerificationToken&gt; = tokenRepository.findByToken(token) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (verificationToken.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User = verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().user <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cal: Calendar = Calendar.getInstance() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().expiryDate.time - cal.time.time) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { tokenRepository.delete(verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN_EXPIRED } user.enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> tokenRepository.delete(verificationToken.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()) userRepository.save(user) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN_VALID } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TOKEN_INVALID } }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang tambahkan metode untuk mengirim email dengan tautan konfirmasi ke </font></font><code>EmailServiceImpl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EmailServiceImpl.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"> <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${host.url}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hostUrl: String <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userDetailsService: UserDetailsServiceImpl ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendRegistrationConfirmationEmail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">User</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> token = UUID.randomUUID().toString() userDetailsService.createVerificationTokenForUser(token, user) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> link = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$hostUrl</span></span></span><span class="hljs-string">/?token=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$token</span></span></span><span class="hljs-string">&amp;confirmRegistration=true"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> msg = <span class="hljs-string"><span class="hljs-string">"&lt;p&gt;Please, follow the link to complete your registration:&lt;/p&gt;&lt;p&gt;&lt;a href=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$link</span></span></span><span class="hljs-string">\"&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$link</span></span></span><span class="hljs-string">&lt;/a&gt;&lt;/p&gt;"</span></span> user.email?.let{sendHtmlMessage(user.email!!, <span class="hljs-string"><span class="hljs-string">"KSVG APP: Registration Confirmation"</span></span>, msg)} }</code> </pre><br></div></div><br>  <u>Catatan:</u> <br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya akan merekomendasikan menyimpan URL host di </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application.properties</font></font></i> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Di tautan kami, kami meneruskan dua parameter GET ( </font></font><code>token</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan </font></font><code>confirmRegistration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) ke alamat tempat aplikasi tersebut digunakan. </font><font style="vertical-align: inherit;">Nanti saya akan jelaskan kenapa.</font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Kami memodifikasi pengontrol pendaftaran sebagai berikut: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Semua pengguna baru akan menetapkan nilai </font></font><code>false</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">untuk bidang tersebut</font></font><code>isEnabled</code> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Setelah membuat akun baru, kami akan mengirim email untuk mengonfirmasi pendaftaran </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Buat pengontrol validasi token yang terpisah </font></font></li><li> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penting:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> selama otorisasi kami akan memeriksa apakah akun diverifikasi:</font></font></li></ul><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AuthController.kt</font></font></b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.kotlinspringvue.backend.controller <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.email.EmailService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.validation.Valid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Collectors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Autowired <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.HttpStatus <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.http.ResponseEntity <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.authentication.AuthenticationManager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.core.context.SecurityContextHolder <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.crypto.password.PasswordEncoder <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.core.GrantedAuthority <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.security.core.authority.SimpleGrantedAuthority <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.ui.Model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.model.LoginUser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.model.NewUser <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.web.response.SuccessfulSigninResponse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.web.response.ResponseMessage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.jpa.User <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.repository.UserRepository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.repository.RoleRepository <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.jwt.JwtProvider <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.ReCaptchaService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsService <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.Value <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.context.ApplicationEventPublisher <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.bind.<span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span>.* <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.web.context.request.WebRequest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.UnsupportedEncodingException <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.Cookie <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServletRequest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.HttpServletResponse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsServiceImpl.Companion.TOKEN_VALID <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsServiceImpl.Companion.TOKEN_INVALID <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.kotlinspringvue.backend.service.UserDetailsServiceImpl.Companion.TOKEN_EXPIRED <span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/api/auth"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthController</span></span></span></span>() { <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.authCookieName}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authCookieName: String <span class="hljs-meta"><span class="hljs-meta">@Value(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"\${ksvg.app.isCookieSecure}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isCookieSecure: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authenticationManager: AuthenticationManager <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userRepository: UserRepository <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> roleRepository: RoleRepository <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> encoder: PasswordEncoder <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jwtProvider: JwtProvider <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> captchaService: ReCaptchaService <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> userService: UserDetailsService <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lateinit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> emailService: EmailService <span class="hljs-meta"><span class="hljs-meta">@PostMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/signin"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">authenticateUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Valid</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestBody</span></span></span></span><span class="hljs-function"><span class="hljs-params"> loginRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">LoginUser</span></span></span></span><span class="hljs-function"><span class="hljs-params">, response: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">HttpServletResponse</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userCandidate: Optional &lt;User&gt; = userRepository.findByUsername(loginRequest.username!!) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(loginRequest.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userCandidate.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> user: User = userCandidate.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!user.enabled) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Account is not verified yet! Please, follow the link in the confirmation email."</span></span>), HttpStatus.UNAUTHORIZED) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authentication = authenticationManager.authenticate( UsernamePasswordAuthenticationToken(loginRequest.username, loginRequest.password)) SecurityContextHolder.getContext().setAuthentication(authentication) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jwt: String = jwtProvider.generateJwtToken(user.username!!) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cookie: Cookie = Cookie(authCookieName, jwt) cookie.maxAge = jwtProvider.jwtExpiration!! cookie.secure = isCookieSecure cookie.isHttpOnly = <span class="hljs-literal"><span class="hljs-literal">true</span></span> cookie.path = <span class="hljs-string"><span class="hljs-string">"/"</span></span> response.addCookie(cookie) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> authorities: List&lt;GrantedAuthority&gt; = user.roles!!.stream().map({ role -&gt; SimpleGrantedAuthority(role.name)}).collect(Collectors.toList&lt;GrantedAuthority&gt;()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity.ok(SuccessfulSigninResponse(user.username, authorities)) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"User not found!"</span></span>), HttpStatus.BAD_REQUEST) } } <span class="hljs-meta"><span class="hljs-meta">@PostMapping(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/signup"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@Valid</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-meta"><span class="hljs-function"><span class="hljs-params"><span class="hljs-meta">@RequestBody</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newUser: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">NewUser</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: ResponseEntity&lt;*&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> userCandidate: Optional &lt;User&gt; = userRepository.findByUsername(newUser.username!!) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!captchaService.validateCaptcha(newUser.recaptchaToken!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Validation failed (ReCaptcha v2)"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!userCandidate.isPresent) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (usernameExists(newUser.username!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Username is already taken!"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (emailExists(newUser.email!!)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ResponseEntity(ResponseMessage(<span class="hljs-string"><span class="hljs-string">"Email is already in use!"</span></span>), HttpStatus.BAD_REQUEST) } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Creating user's account val user = User( 0, newUser.username!!, newUser.firstName!!, newUser.lastName!!, newUser.email!!, encoder.encode(newUser.password), false ) user.roles = Arrays.asList(roleRepository.findByName("ROLE_USER")) val registeredUser = userRepository.save(user) emailService.sendRegistrationConfirmationEmail(registeredUser) } catch (e: Exception) { return ResponseEntity(ResponseMessage("Server error. Please, contact site owner"), HttpStatus.SERVICE_UNAVAILABLE) } return ResponseEntity(ResponseMessage("Please, follow the link in the confirmation email to complete the registration."), HttpStatus.OK) } else { return ResponseEntity(ResponseMessage("User already exists!"), HttpStatus.BAD_REQUEST) } } @PostMapping("/registrationConfirm") @CrossOrigin(origins = ["*"]) @Throws(UnsupportedEncodingException::class) fun confirmRegistration(request: HttpServletRequest, model: Model, @RequestParam("token") token: String): ResponseEntity&lt;*&gt; { when(userService.validateVerificationToken(token)) { TOKEN_VALID -&gt; return ResponseEntity.ok(ResponseMessage("Registration confirmed")) TOKEN_INVALID -&gt; return ResponseEntity(ResponseMessage("Token is invalid!"), HttpStatus.BAD_REQUEST) TOKEN_EXPIRED -&gt; return ResponseEntity(ResponseMessage("Token is invalid!"), HttpStatus.UNAUTHORIZED) } return ResponseEntity(ResponseMessage("Server error. Please, contact site owner"), HttpStatus.SERVICE_UNAVAILABLE) } @PostMapping("/logout") fun logout(response: HttpServletResponse): ResponseEntity&lt;*&gt; { val cookie: Cookie = Cookie(authCookieName, null) cookie.maxAge = 0 cookie.secure = isCookieSecure cookie.isHttpOnly = true cookie.path = "/" response.addCookie(cookie) return ResponseEntity.ok(ResponseMessage("Successfully logged")) } private fun emailExists(email: String): Boolean { return userRepository.findByUsername(email).isPresent } private fun usernameExists(username: String): Boolean { return userRepository.findByUsername(username).isPresent } }</span></span></code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekarang mari kita bekerja di frontend: </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Buat komponen </font></font><code>RegistrationConfirmPage.vue</code> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tambahkan jalur baru </font></font><code>router.js</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dengan parameter </font></font><code>:token</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'/registration-confirm/:token'</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'RegistrationConfirmPage'</span></span>, <span class="hljs-attr"><span class="hljs-attr">component</span></span>: RegistrationConfirmPage }</code> </pre><br> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pembaruan </font><b><font style="vertical-align: inherit;"># 3</font></b></font><code>SignUp.vue</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - setelah berhasil mengirim data dari formulir, kami akan memberi tahu mereka bahwa untuk menyelesaikan pendaftaran, Anda harus mengikuti tautan dalam surat itu. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 4 </font></font></b> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Penting:</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sayangnya, kami tidak dapat memberikan tautan tetap ke komponen terpisah yang akan memvalidasi token dan melaporkan keberhasilan atau kegagalan. </font><font style="vertical-align: inherit;">Tautan dengan garis miring semuanya akan membawa kita ke halaman asli aplikasi. </font><font style="vertical-align: inherit;">Tetapi kami dapat memberi tahu aplikasi kami tentang perlunya mengonfirmasi pendaftaran menggunakan parameter GET yang dikirimkan </font></font><code>confirmRegistration</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">methods: { confirmRegistration() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$route.query.confirmRegistration === <span class="hljs-string"><span class="hljs-string">'true'</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$route.query.token != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$router.push({<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'RegistrationConfirmPage'</span></span>, <span class="hljs-attr"><span class="hljs-attr">params</span></span>: { <span class="hljs-attr"><span class="hljs-attr">token</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$route.query.token}}); } }, ... mounted() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.confirmRegistration(); }</code> </pre><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 5</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mari kita buat komponen yang melakukan validasi token dan melaporkan hasil validasi:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RegistrasiConfirmPage.vue</font></font></b> <div class="spoiler_text"><pre> <code class="javascript hljs">&lt;template&gt; &lt;div id="registration-confirm"&gt; &lt;div class="confirm-form"&gt; &lt;b-card title="Confirmation" tag="article" style="max-width: 20rem;" class="mb-2" &gt; &lt;div v-if="isSuccess"&gt; &lt;p class="success"&gt;Account is successfully verified!&lt;/p&gt; &lt;router-link to="/login"&gt; &lt;b-button variant="primary"&gt;Login&lt;/b-button&gt; &lt;/router-link&gt; &lt;/div&gt; &lt;div v-if="isError"&gt; &lt;p class="fail"&gt;Verification failed:&lt;/p&gt; &lt;p&gt;{{ errorMessage }}&lt;/p&gt; &lt;/div&gt; &lt;/b-card&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import {AXIOS} from './http-common' export default { name: 'RegistrationConfirmPage', data() { return { isSuccess: false, isError: false, errorMessage: '' } }, methods: { executeVerification() { AXIOS.post(`/auth/registrationConfirm`, null, {params: { 'token': this.$route.params.token}}) .then(response =&gt; { this.isSuccess = true; console.log(response); }, error =&gt; { this.isError = true; this.errorMessage = error.response.data.message; }) .catch(e =&gt; { console.log(e); this.errorMessage = 'Server error. Please, report this error website owners'; }) } }, mounted() { this.executeVerification(); } } &lt;/script&gt; &lt;style scoped&gt; .confirm-form { margin-left: 38%; margin-top: 50px; } .success { color: green; } .fail { color: red; } &lt;/style&gt;</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hasil</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0n/vj/os/0nvjosmit-f6n538uae6rsvwujo.png"><br></div></div><br><h3>  Alih-alih sebuah kesimpulan </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai kesimpulan dari materi ini, saya ingin melakukan penyimpangan dan mengatakan bahwa konsep aplikasi yang dibahas dalam artikel ini dan sebelumnya tidak baru pada saat penulisan. </font><font style="vertical-align: inherit;">Tugas dengan cepat membuat tumpukan penuh aplikasi pada musim semi Boot menggunakan yang modern JavaScript-kerangka sudut / Bereaksi / Vue.js elegan memecahkan </font></font><a href="https://www.jhipster.tech/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hipster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Namun, ide-ide yang dijelaskan dalam artikel ini dapat diimplementasikan bahkan menggunakan JHipster, jadi saya berharap para pembaca yang datang ke tempat ini akan menemukan bahan ini berguna bahkan sebagai bahan pertimbangan.</font></font><br><br><a name="links"></a><br><h2>  Tautan yang bermanfaat </h2><br><ul><li> <a href="https://github.com/DrLeprechaun/kotlin-spring-vue" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repositori GitHub (hingga langkah "Migrasikan ke Tingkat")</font></font></a> </li><li> <a href="https://github.com/DrLeprechaun/kotlin-spring-vue-gradle" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Repositori GitHub (setelah langkah "Migrasikan ke Tingkat")</font></font></a> </li><li> <a href="https://kotlin-spring-vue-demo.herokuapp.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplikasi (hingga langkah "Migrasikan ke Tingkat")</font></font></a> </li><li> <a href="https://kotlin-spring-vue-gradle-demo.herokuapp.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aplikasi (setelah langkah "Migrasi ke Gradle")</font></font></a> </li><li> <a href="https://vaadimblog.blogspot.com/p/kotlin-spring-boot-vuejs.html" rel="nofollow">  ,   ,    </a> </li><li> <a href="https://itnext.io/how-to-use-google-recaptcha-with-vuejs-7756244400da" rel="nofollow">How to use Google reCaptcha with Vuejs</a> </li><li> <a href="https://vuejsexamples.com/google-recaptcha-component-for-vue-js/" rel="nofollow">Google ReCAPTCHA component for Vue.js</a> </li><li> <a href="https://www.baeldung.com/spring-email" rel="nofollow">Guide to Spring Email</a> </li><li> <a href="https://medium.com/%40raviswapna1/send-email-using-spring-boot-and-thymeleaf-b0f62786bd8e" rel="nofollow">Send Email using Spring Boot and Thymeleaf</a> </li><li> <a href="https://docs.gradle.org/5.6.3/userguide/migrating_from_maven.html" rel="nofollow">Migrating Builds From Apache Maven</a> </li><li> <a href="https://guides.gradle.org/migrating-build-logic-from-groovy-to-kotlin/" rel="nofollow">Migrating build logic from Groovy to Kotlin</a> </li><li> <a href="https://ordina-jworks.github.io/architecture/2018/10/12/spring-boot-angular-gradle.html" rel="nofollow">Integrate Angular in Spring Boot Using Gradle</a> </li><li> <a href="https://devcenter.heroku.com/articles/getting-started-with-gradle-on-heroku" rel="nofollow">Getting Started with Gradle on Heroku</a> </li><li> <a href="https://devcenter.heroku.com/articles/deploying-gradle-apps-on-heroku" rel="nofollow">Deploying Gradle Apps on Heroku</a> </li><li> <a href="https://devcenter.heroku.com/articles/deploying-gradle-apps-on-heroku" rel="nofollow">Deploying multi-project builds</a> </li><li> <a href="https://www.rdegges.com/2018/please-stop-using-local-storage/" rel="nofollow">Please Stop Using Local Storage</a> </li><li> <a href="https://medium.com/%40jcbaey/authentication-in-spa-reactjs-and-vuejs-the-right-way-e4a9ac5cd9a3" rel="nofollow">Authentication in SPA (ReactJS and VueJS) the right way</a> </li><li> <a href="https://www.ninjadevcorner.com/2018/09/stateless-authentication-jwt-secure-spring-boot-rest-api.html" rel="nofollow">Stateless Authentication using JWT to secure a Spring Boot REST API</a> </li><li> <a href="https://www.baeldung.com/registration-verify-user-by-email" rel="nofollow">Registration ‚Äì Activate a New Account by Email</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id482222/">https://habr.com/ru/post/id482222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id482208/index.html">Hadiah yang membuat Anda melewatkan Tahun Baru</a></li>
<li><a href="../id482212/index.html">Bicara tentang ... keju?</a></li>
<li><a href="../id482216/index.html">23 respons terhadap depresi dari psikiater profesional Maxim Malyavin (dpmmax)</a></li>
<li><a href="../id482218/index.html">Java Digest untuk tanggal 27 Desember</a></li>
<li><a href="../id482220/index.html">Lokalisasi penanda Aruco</a></li>
<li><a href="../id482224/index.html">Ketika seorang desainer perlu menjadi programmer kecil</a></li>
<li><a href="../id482228/index.html">Kami menulis "kalkulator" dalam C #. Bagian I. Perhitungan nilai, turunan, penyederhanaan, dan angsa lainnya</a></li>
<li><a href="../id482230/index.html">Pertempuran server WEB. Bagian 2 - skenario HTTPS yang realistis:</a></li>
<li><a href="../id482232/index.html">StackOverflow lebih dari sekadar repositori jawaban untuk pertanyaan bodoh</a></li>
<li><a href="../id482234/index.html">Pemodelan digital ke analog dan campuran dalam PADS Professional</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>