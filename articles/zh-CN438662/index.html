<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎳 📼 🧝🏿 我爱上模糊的那一天 🎖️ 🚶🏽 ☣️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在2007年，我为Freelancer空间模拟器编写了两个修改工具 。 游戏资源以“二进制INI”或“ BINI”格式存储。 可能是出于性能考虑选择了二进制格式：此类文件的加载和读取速度比INI格式的任意文本更快。 

 大多数游戏内容都可以直接从这些文件中进行编辑，更改名称，产品价格，航天器统计数...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我爱上模糊的那一天</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438662/">在2007年，我为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Freelancer</a>空间模拟器编写了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">两个</a>修改<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">工具</a> 。 游戏资源以“二进制INI”或“ BINI”格式存储。 可能是出于性能考虑选择了二进制格式：此类文件的加载和读取速度比INI格式的任意文本更快。 <br><br> 大多数游戏内容都可以直接从这些文件中进行编辑，更改名称，产品价格，航天器统计数据，甚至添加新飞船。 二进制文件很难直接修改，因此自然的方法是将它们转换为文本INI，在文本编辑器中进行更改，然后转换回BINI格式并替换游戏目录中的文件。 <br><a name="habracut"></a><br> 我没有分析BINI格式，也不是第一个学习如何编辑它们的人。 但是我不喜欢现有的工具，而且我对它们应该如何工作有自己的看法。 我喜欢Unix风格的界面，尽管游戏本身可以在Windows上运行。 <br><br> 那时，我才熟悉<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">yacc</a> （实际上是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bison</a> ）和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">lex</a> （实际上是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">flex</a> ）以及Autoconf工具，因此我完全使用了它们。 在实践中尝试这些实用程序很有趣，尽管我刻苦地模仿了其他开源项目，却不明白为什么用这种方式完成了所有事情。 由于使用了yacc / lex和配置脚本的创建，因此需要一个完整的类Unix系统。 这些在程序的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">原始版本中</a>都是可见<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的</a> 。 <br><br> 事实证明该项目非常成功：我本人也成功使用了这些工具，它们出现在Freelancer改装的不同系列中。 <br><br><h1> 重构 </h1><br> 在2018年中，我回到了这个项目。 您是否曾经想到过您的旧代码：您甚至想到了什么？ 我的INI格式变得比原来更严格和严格，二进制文件以可疑的方式记录，并且汇编甚至无法正常工作。 <br><br> 凭借十年的丰富经验，我确信我现在会更好地编写这些工具。 我几天后就做到了，从头开始重写它们。 现在，此新代码位于Github的主线程中。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我喜欢使一切都尽可能简单</a> ，因此我摆脱了autoconf的支持，转而使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">更简单，更可移植的Makefile</a> 。 没有更多的yacc或lex，但是解析器是手工编写的。 仅使用适当的可移植C语言，其结果是如此简单，以至于我使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Visual Studio中的</a>一个短命令<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">来</a>组装项目，因此实际上不需要Makefile。 如果用<code>typedef</code>替换<code>stdint.h</code> ，甚至可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在DOS下构建和运行binitools</a> 。 <br><br> 新版本更快，更紧凑，更清洁，更容易。 相对于INI输入，它要灵活得多，因此更易于使用。 但这真的正确吗？ <br><br><h1> 模糊测试 </h1><br> 多年来，我一直对<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">模糊测试</a>很感兴趣，尤其是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">afl</a> （美国模糊lop）。 但是，尽管他测试了我经常使用的一些工具，但他从未掌握过它。 但是，至少在我放弃之前，模糊测试并没有发现任何值得注意的事情。 我测试了JSON库，由于某种原因也没有找到任何东西。 很明显，我的JSON解析器不太可靠，对吧？ 但是模糊测试什么也没有。  （事实证明，我的JSON库非常可靠，这在很大程度上要感谢社区的努力！） <br><br> 但是现在我有了一个相对较新的INI解析器。 尽管它可以成功分析并正确组装游戏中的原始BINI文件集，但其功能尚未经过<i>真正的</i>测试。 当然，在这里模糊测试会发现一些东西。 此外，您无需编写任何一行即可在此代码上运行afl。 默认工具与标准输入配合使用，这是理想的选择。 <br><br> 假设您已经安装了必要的工具（make，gcc，afl），这就是binitools模糊启动的方式： <br><br><pre> <code class="bash hljs">$ make CC=afl-gcc $ mkdir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> out $ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'[x]'</span></span> &gt; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>/empty $ afl-fuzz -i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> -o out -- ./bini</code> </pre> <br>  <code>bini</code>实用程序在输入处接受INI并发出BINI，因此检查它比反向<code>unbini</code>过程更有趣。 由于<code>unbini</code>分析的是相对简单的二进制数据，因此（可能）模糊测试器无需寻找。 但是，以防万一，我还是检查了一下。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/483/089/6dc/4830896dc68da2e5559c899429235f95.png"><br><br> 在此示例中，我将默认编译器更改为afl（ <code>CC=afl-gcc</code> ）的GCC shell。 这里afl在后台调用GCC，但它向二进制文件添加了自己的工具包。 当进行模糊测试时， <code>afl-fuzz</code>使用此工具包来监视程序的执行路径。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">afl文档</a>说明了技术细节。 <br><br> 我还通过在输入目录中放置一个最小的工作示例（它为afl设定了起点）来创建输入和输出目录。 启动时，它会改变输入数据队列并监视程序执行期间的更改。 输出目录包含结果，更重要的是，包含导致唯一执行路径的输入数据主体。 换句话说，许多输入在模糊器输出处进行处理，检查许多不同的边界情况。 <br><br> 最有趣和可怕的结果是程序完全崩溃。 当我第一次启动binitools的模糊器时， <code>bini</code>出现了<i>许多</i>此类崩溃。 在几分钟之内，afl在我的程序中发现了许多细微而有趣的错误，这非常有用。  Fazzer甚至发现了一个不太可能<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的过时指针错误，它</a>检查了各种内存分配的不同顺序。 这个特定的错误是一个转折点，使我意识到模糊的价值。 <br><br> 并非所有发现的错误都导致失败。 我还研究了输出，查看哪些输入产生了成功的结果，哪些没有取得成功，并观察了程序如何处理各种极端情况。 她拒绝了我认为可以处理的一些意见。 反之亦然，她处理了一些我认为不正确的数据，并以一种意想不到的方式为我解释了一些数据。 因此，即使在修复了程序崩溃的错误之后，我仍然更改了解析器设置以修复这些不愉快的情况。 <br><br><h1> 创建一个测试套件 </h1><br> 修复了模糊器检测到的所有错误并在所有边界情况下调整了解析器后，我就从模糊器数据包中进行了一系列测试-尽管不是直接进行的。 <br><br> 首先，我并行运行了模糊器-这个过程在afl文档中进行了说明-因此我得到了很多冗余输入。 冗余是指输入不同但执行路径相同。 幸运的是，afl有一个可以处理此问题的工具： <code>afl-cmin</code> ，它是使外壳最小化的工具。 它消除了不必要的输入。 <br><br> 其次，这些输入中的许多输入都比调用其唯一执行路径所需的时间更长。  <code>afl-tmin</code> ，一种减少了测试用例的测试用例最小化器，在<code>afl-tmin</code>了帮助作用。 <br><br> 我分离了有效输入和无效输入-并在存储库中对其进行了检查。 看看基于单个最小输入<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的模糊器发明的</a>所有这些愚蠢的入口： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">有效输入</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">输入无效</a> </li></ul><br> 实际上，这里的解析器被冻结在一个状态中，并且通过一组测试来确保特定的构建以<i>非常</i>特定的方式运行。 这对于确保其他编译器在其他平台上生成的程序集的输出行为相同时特别有用。 我的测试套件甚至在Dietlibc库中检测到错误，因为binitools链接后未通过测试。 如果必须对解析器进行不重要的更改，那么从本质上讲，您将不得不放弃当前的测试集并重新开始，这样afl将为新的解析器生成一个全新的主体。 <br><br> 当然，模糊已将自身确立为一项强大的技术。 他发现了许多我自己无法发现的错误。 从那时起，我开始更熟练地使用它来测试其他程序-而不仅仅是我的程序-并且发现了许多新的错误。 现在，fuzzer在我的开发套件中的工具中占据了永久的位置。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN438662/">https://habr.com/ru/post/zh-CN438662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN438648/index.html">BI系统的比较（Tableau，Power BI，Oracle，Qlik）</a></li>
<li><a href="../zh-CN438650/index.html">火箭9M729。 关于INF条约“违反者”的几句话</a></li>
<li><a href="../zh-CN438652/index.html">Portabelization IDA</a></li>
<li><a href="../zh-CN438654/index.html">OpenSceneGraph：与Qt框架集成</a></li>
<li><a href="../zh-CN438658/index.html">如何学习学习</a></li>
<li><a href="../zh-CN438664/index.html">Swift编译器设备。 第二部分</a></li>
<li><a href="../zh-CN438666/index.html">经理与程序员</a></li>
<li><a href="../zh-CN438668/index.html">“寻找能够驱动的故事”：关于播客，编辑工作和媒体职业的播客</a></li>
<li><a href="../zh-CN438670/index.html">攻击者利用YouTube版权警示向作者勒索金钱</a></li>
<li><a href="../zh-CN438672/index.html">Wi-Fi名称和密码中的UTF-8编码（表情符号）</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>