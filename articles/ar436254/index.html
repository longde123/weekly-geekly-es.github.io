<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧑🏿‍🤝‍🧑🏻 🤾🏻 👨🏽 روبوت لـ Starcraft في Rust أو C أو أي لغة أخرى 👨‍👨‍👧‍👧 🖐️ 🤱🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ستاركرافت: الحضنة الحرب . هذه اللعبة تعني الكثير بالنسبة لي! وبالنسبة للكثيرين منكم ، أعتقد ذلك. كثيرًا ، أتساءل ما إذا كان يجب عليّ أن أقدم رابطًا لص...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>روبوت لـ Starcraft في Rust أو C أو أي لغة أخرى</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436254/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/qv/fa/ex/qvfaexsnkzmckmwrt_spqmc7nr4.png" align="left"><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ستاركرافت: الحضنة الحرب</a> .  هذه اللعبة تعني الكثير بالنسبة لي!  وبالنسبة للكثيرين منكم ، أعتقد ذلك.  كثيرًا ، أتساءل ما إذا كان يجب عليّ أن أقدم رابطًا لصفحتها على ويكيبيديا أم لا. </p><br><p style=";text-align:right;direction:rtl">  مرة واحدة أرسلني <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">هالت</a> وعرضت أن أتعلم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الصدأ</a> .  مثل أي شخص عادي ، قررنا أن نبدأ <del>  مرحبا العالم </del>  كتابة مكتبة حيوية لنظام التشغيل Windows يمكن تحميلها في مساحة عناوين StarCraft وإدارة الوحدات. </p><br><p style=";text-align:right;direction:rtl">  سوف تصف المقالة التالية عملية البحث عن حلول واستخدام التقنيات والتقنيات التي تتيح لك معرفة أشياء جديدة عن Rust ونظامها البيئي.  قد تكون أيضًا مصدر إلهام لتطبيق الروبوت باستخدام لغتك المفضلة ، سواء كانت C أو C ++ أو Ruby أو Python ، إلخ. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  بالتأكيد يستحق الاستماع إلى ترنيمة كوريا الجنوبية أثناء قراءة هذا المقال: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ستاركرافت OST</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><iframe width="560" height="315" src="https://www.youtube.com/embed/pNt0iVG2VOA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><br><h2 id="bwapi" style=";text-align:right;direction:rtl">  بوابي </h2><br><p style=";text-align:right;direction:rtl">  هذه اللعبة عمرها 20 عامًا تقريبًا.  وما زالت <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">شعبية</a> .  استقطبت البطولات حشودًا من الناس في الولايات المتحدة الأمريكية حتى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">في عام 2017</a> حيث وقعت معركة أسياد جايدونج وبيسو.  بالإضافة إلى لاعبين <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">بشريين</a> ، تشارك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الآلات التي لا روح لها</a> في معارك SC!  وهذا ممكن بسبب <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BWAPI</a> .  المزيد من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الروابط</a> المفيدة. </p><br><p style=";text-align:right;direction:rtl">  لأكثر من عقد الآن ، كان هناك مجتمع من مطوري الروبوت حول هذه اللعبة.  عشاق خلق الروبوتات والمشاركة في مختلف البطولات.  الكثير منهم يدرسون الذكاء الاصطناعي والتعلم الآلي.  يستخدم BWAPI من قبل الجامعات لتدريب طلابهم.  حتى أن هناك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">قناة نشل</a> تبث مثل هذه المباريات. </p><br><p style=";text-align:right;direction:rtl">  لذلك ، قام فريق من المعجبين بعكس اتجاه Starcraft الخلفي قبل عدة سنوات وقام بتطوير واجهة برمجة تطبيقات في C ++ ، والتي تتيح لك إنشاء روبوتات ، وجعل الحقن في عملية اللعبة والسيطرة على البشر البائسين. </p><br><p style=";text-align:right;direction:rtl">  كما يحدث في كثير من الأحيان ، من قبل <del>  بناء منزل ، فمن الضروري أن الألغام خام ، وصياغة الأدوات </del>  إنشاء الروبوت ، تحتاج إلى تطبيق API.  ماذا روست لديها لهذا العرض؟ </p><br><h2 id="ffi" style=";text-align:right;direction:rtl">  Ffi </h2><br><p style=";text-align:right;direction:rtl">  الأمر بسيط للغاية للعمل مع لغات أخرى من Rust.  هناك <abbr title="وظيفة واجهة الخارجية">FFI</abbr> لهذا الغرض.  اسمحوا لي أن أقدم لكم مقتطفات قصيرة من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الوثائق</a> . </p><br><p style=";text-align:right;direction:rtl">  تخيل أن لدينا مكتبة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">سريعة</a> ، تحتوي على ملف رأس <a href="">snappy-ch</a> ، والذي يحتوي على إعلانات الوظائف. </p><br><p style=";text-align:right;direction:rtl">  دعونا إنشاء مشروع باستخدام <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">البضائع</a> . </p><br><pre style=";text-align:right;direction:rtl"><code class="bash hljs">$ cargo new --bin snappy Created binary (application) `snappy` project $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> snappy snappy$ tree . ├── Cargo.toml └── src └── main.rs 1 directory, 2 files</code> </pre> <br><p style=";text-align:right;direction:rtl">  أنشأ Cargo بنية ملفات قياسية للمشروع. </p><br><p style=";text-align:right;direction:rtl">  في <code>Cargo.toml</code> نحدد التبعية لـ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">libc</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[dependencies] libc = "0.2"</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>src/main.rs</code> ملف <code>src/main.rs</code> كما يلي: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-comment"><span class="hljs-comment">// To import C types, in our case for size_t use libc::size_t; #[link(name = "snappy")] // Specify the name of the library for linking the function extern { // We write the declaration of the function which we want to import // in C the declaration looks like this: // size_t snappy_max_compressed_length(size_t source_length); fn snappy_max_compressed_length(source_length: size_t) -&gt; size_t; } fn main() { let x = unsafe { snappy_max_compressed_length(100) }; println!("max compressed length of a 100 byte buffer: {}", x); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لنقم ببناء وتشغيل المشروع: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">snappy$ cargo build ... snappy$ cargo run Finished dev [unoptimized + debuginfo] target(s) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.02s Running `target/debug/snappy` max compressed length of a 100 byte buffer: 148</code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكنك الاتصال <code>cargo run</code> فقط ، والذي يستدعي <code>cargo build</code> قبل التشغيل.  خيار آخر هو بناء المشروع واستدعاء ثنائي مباشرة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">snappy$ ./target/debug/snappy max compressed length of a 100 byte buffer: 148</code> </pre> <br><p style=";text-align:right;direction:rtl">  إذا تم تثبيت مكتبة snappy ، فسيتم تجميع الرمز (بالنسبة إلى Ubuntu ، يجب عليك تثبيت حزمة libsnappy-dev). </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">snappy$ ldd target/debug/snappy ... libsnappy.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libsnappy.so.1 (0x00007f8de07cf000)</code> </pre> <br><p style=";text-align:right;direction:rtl">  كما ترون ، لدينا ثنائي يرتبط بالمكتبة المشتركة libsnappy.  إن استدعاء <code>snappy_max_compressed_length</code> في الكود الخاص بنا هو استدعاء دالة من هذه المكتبة. </p><br><h2 id="rust-bindgen" style=";text-align:right;direction:rtl">  الصدأ bindgen </h2><br><p style=";text-align:right;direction:rtl">  سيكون من الرائع أن نتمكن من إنشاء FFI الخاص بنا تلقائيًا.  لحسن الحظ ، هناك أداة مساعدة تسمى <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">rust-bindgen</a> في صندوق أدوات مدمن Rust.  وهو قادر على إنشاء روابط FFI إلى مكتبات C (وبعض C ++). </p><br><p style=";text-align:right;direction:rtl">  التثبيت: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ cargo install bindgen</code> </pre> <br><p style=";text-align:right;direction:rtl">  ما الذي يبدو عليه <strong>الصدأ</strong> ؟  نأخذ ملفات رأس C / C ++ ، <strong>ونشير</strong> الأداة المساعدة <strong>bindgen</strong> إليها ، ويتم إنشاء الإخراج الذي نحصل عليه كود Rust مع الإعلانات الصحيحة للسماح لنا باستخدام بنيات ووظائف C.  إليك ما يولد <code>bindgen</code> لـ <code>bindgen</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs">$ bindgen /usr/include/snappy-ch | grep -C <span class="hljs-number"><span class="hljs-number">1</span></span> snappy_max_compressed_length <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">snappy_max_compressed_length</span></span></span></span>(source_length: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  اتضح أن bindgen لا يمكنه التعامل مع رؤوس BWAPI ، مما يولد أطنانًا من التعليمات البرمجية غير القابلة للاستخدام (بسبب وظائف الأعضاء الافتراضية ، std :: string في واجهة برمجة تطبيقات عامة ، إلخ).  الشيء هو أن BWAPI هو مكتوب في C ++.  من الصعب استخدام C ++ بشكل عام حتى من مشاريع C ++.  بمجرد تجميع المكتبة ، من الأفضل ربطها بالرابط نفسه (نفس الإصدار) ، يجب تحليل ملفات الرأس باستخدام نفس المحول البرمجي (نفس الإصدار).  كل هذه العوامل قد تؤثر على النتيجة.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مانجلينج</a> على سبيل المثال ، والتي لا تزال <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">لا يمكن تنفيذها دون أخطاء</a> في جنو الخليج.  هذه العوامل مهمة لدرجة أنه حتى <abbr title="إطار اختبار C ++ من Google">gtest</abbr> لم يستطع التغلب عليها.  وفي <a href="">الوثائق</a> تقول: من الأفضل بناء gtest كجزء من المشروع بواسطة نفس المترجم ونفس الرابط. </p><br><h2 id="bwapi-c" style=";text-align:right;direction:rtl">  بوابى </h2><br><p style=";text-align:right;direction:rtl">  C هي اللغة المشتركة لهندسة البرمجيات.  إذا كان rust-bindgen يعمل جيدًا للغة C ، فلماذا لا يتم تطبيق BWAPI لـ C ، ثم استخدام API الخاص به؟  فكرة جيدة! </p><br><p style=";text-align:right;direction:rtl">  نعم ، إنها فكرة جيدة إلى أن تنظر إلى الدواخل في BWAPI وترى عدد الفئات والطرق التي يجب أن تطبقها.  لا سيما جميع هذه تخطيطات الذاكرة ، رموز asm ، تصحيح الذاكرة و "أهوال" أخرى ليس لدينا وقت ل.  من الضروري استخدام الحل الحالي بالكامل. </p><br><p style=";text-align:right;direction:rtl">  لكننا بحاجة بطريقة ما للتغلب على وظائف mangling ، و C ++ ، والميراث ، والأعضاء الافتراضية. </p><br><p style=";text-align:right;direction:rtl">  في C ++ ، هناك أداتان قويتان سنستخدمهما لحل مشكلتنا: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مؤشرات مبهمة</a> و <code>extern "C"</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>extern "C" {}</code> يسمح رمز C ++ "قناع" نفسه تحت C. يجعل من الممكن إنشاء أسماء الوظائف دون mangling. </p><br><p style=";text-align:right;direction:rtl">  تسمح لنا المؤشرات غير الشفافة بمسح الكتابة وإنشاء مؤشر إلى "نوع ما" دون توفير تطبيقه.  نظرًا لأن هذا مجرد إعلان من نوع ما ، فمن المستحيل استخدام هذا النوع حسب القيمة ، يمكنك استخدامه فقط عن طريق المؤشر. </p><br><p style=";text-align:right;direction:rtl">  دعنا نتخيل أن لدينا رمز C ++: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> cpp { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> bar; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>-&gt;bar; } }; } <span class="hljs-comment"><span class="hljs-comment">// namespace cpp</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  يمكننا تحويلها إلى عنوان C: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">extern "C" { typedef struct Foo_ Foo; // Opaque pointer to Foo // call cpp::Foo::get_bar int Foo_get_bar(Foo* self); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  وهنا الجزء C ++ الذي سيكون الرابط بين الرأس C وتطبيق C ++: </p><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo_get_bar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Foo* self)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// cast the opaque pointer to the certain cpp::Foo and call the method ::get_bar return reinterpret_cast&lt;cpp::Foo*&gt;(self)-&gt;get_bar(); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ليس كل أساليب الطبقات كان لا بد من معالجتها بهذه الطريقة.  في BWAPI ، هناك فئات يمكنك تنفيذها بنفسك باستخدام حقول هذه الهياكل ، على سبيل المثال <code>typedef struct Position { int x; int y; } Position;</code> <code>typedef struct Position { int x; int y; } Position;</code>  وطرق مثل <code>Position::get_distance</code> . </p><br><p style=";text-align:right;direction:rtl">  كانت هناك فصول كان علي معالجتها بطريقة خاصة.  على سبيل المثال ، يجب أن يكون AIModule مؤشرًا إلى فئة C ++ مع مجموعة محددة من وظائف الأعضاء الافتراضية.  ومع ذلك ، هنا هو <a href="">رأس</a> <a href="">وتنفيذ</a> . </p><br><p style=";text-align:right;direction:rtl">  لذلك ، بعد عدة أشهر من العمل الشاق ، <strong>554</strong> طريقة وعشرات الفصول ، <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">وُلدت</a> مكتبة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BWAPI-C التي تضم عدة</a> منصات ، والتي تتيح لك <a href="">إنشاء روبوتات في C.</a>  كان المنتج الثانوي هو إمكانية التجميع التبادلي والقدرة على تنفيذ واجهة برمجة التطبيقات (API) بأي لغة أخرى تدعم FFI واتفاقية استدعاء cdecl. </p><br><p style=";text-align:right;direction:rtl">  إذا كنت تكتب مكتبة ، من فضلك ، اكتب واجهة برمجة التطبيقات في C. </p><br><p style=";text-align:right;direction:rtl">  أهم ميزة في BWAPI-C هي أوسع تكامل ممكن مع لغات البرمجة الأخرى.  <code>Python</code> ، <code>Ruby</code> ، <code>Rust</code> ، <code>PHP</code> ، <code>Java</code> والعديد من الآخرين قادرون على العمل مع سي ، لذلك إذا تمكنت من التغلب على العقبات وتنفيذ الأغلفة الخاصة ، يمكنك أيضًا كتابة روبوت بمساعدتهم. </p><br><h2 id="writing-a-bot-in-c" style=";text-align:right;direction:rtl">  كتابة روبوت في C </h2><br><p style=";text-align:right;direction:rtl">  يصف هذا الجزء المبادئ العامة للتنظيم الداخلي لوحدات Starcraft. </p><br><p style=";text-align:right;direction:rtl">  هناك نوعان من السير: الوحدة والعميل.  دعونا نلقي نظرة على مثال لكتابة وحدة نمطية. </p><br><p style=";text-align:right;direction:rtl">  الوحدة هي مكتبة ديناميكية.  يمكن الاطلاع <a href="">هنا على</a> المبدأ العام لتحميل المكتبات الديناميكية.  يجب أن الوحدة النمطية تصدير 2 وظائف: <code>newAIModule</code> و <code>gameInit</code> . </p><br><p style=";text-align:right;direction:rtl">  <code>gameInit</code> سهل.  تسمى هذه الوظيفة لتمرير مؤشر إلى لعبة الحالية.  يعد هذا المؤشر مهمًا جدًا ، نظرًا لوجود متغير ثابت عام في براري BWAPI ، والذي يُستخدم في بعض أقسام الكود.  دعنا نصف <code>gameInit</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">DLLEXPORT void gameInit(void* game) { BWAPIC_setGame(game); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>newAIModule</code> قليلا أكثر تعقيدا.  يجب أن تُرجع المؤشر إلى فئة C ++ ، والتي تحتوي على جدول طرق ظاهري به أسماء مثل على <strong>XXXXX</strong> والتي تسمى في بعض أحداث اللعبة.  دعنا نعلن هيكل الوحدة: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">typedef struct ExampleAIModule { const AIModule_vtable* vtable_; const char* name; } ExampleAIModule;</code> </pre> <br><p style=";text-align:right;direction:rtl">  يجب أن يكون الحقل الأول مؤشرًا إلى جدول الطريقة (إنه نوع من السحر).  هنا وظيفة <code>newAIModule</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">DLLEXPORT void* newAIModule() { ExampleAIModule* const module = (ExampleAIModule*) malloc( sizeof(ExampleAIModule) ); module-&gt;name = "ExampleAIModule"; module-&gt;vtable_ = &amp;module_vtable; return createAIModuleWrapper( (AIModule*) module ); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>createAIModuleWrapper</code> هي خدعة سحرية أخرى تحول المؤشر C إلى المؤشر إلى فئة C ++ مع <del>  طرق افتراضية </del>  وظائف الأعضاء. </p><br><p style=";text-align:right;direction:rtl">  <code>module_vtable</code> هو متغير ثابت في جدول الطريقة ، وتملأ قيم الطريقة مع مؤشرات إلى الوظائف العالمية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">static AIModule_vtable module_vtable = { onStart, onEnd, onFrame, onSendText, onReceiveText, onPlayerLeft, onNukeDetect, onUnitDiscover, onUnitEvade, onUnitShow, onUnitHide, onUnitCreate, onUnitDestroy, onUnitMorph, onUnitRenegade, onSaveGame, onUnitComplete }; void onEnd(AIModule* module, bool isWinner) { } void onFrame(AIModule* module) {} void onSendText(AIModule* module, const char* text) {} void onReceiveText(AIModule* module, Player* player, const char* text) {} void onPlayerLeft(AIModule* module, Player* player) {} void onNukeDetect(AIModule* module, Position target) {} void onUnitDiscover(AIModule* module, Unit* unit) {} void onUnitEvade(AIModule* module, Unit* unit) {} void onUnitShow(AIModule* module, Unit* unit) {} void onUnitHide(AIModule* module, Unit* unit) {} void onUnitCreate(AIModule* module, Unit* unit) {} void onUnitDestroy(AIModule* module, Unit* unit) {} void onUnitMorph(AIModule* module, Unit* unit) {} void onUnitRenegade(AIModule* module, Unit* unit) {} void onSaveGame(AIModule* module, const char* gameName) {} void onUnitComplete(AIModule* module, Unit* unit) {}</code> </pre> <br><p style=";text-align:right;direction:rtl">  إذا نظرت إلى اسم الدالات وتواقيعها ، فسيكون ذلك واضحًا تحت أي ظروف وبأي حجج تحتاج إلى تسميتها.  على <a href="">سبيل المثال</a> أنا جعلت جميع الوظائف فارغة ، باستثناء </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">void onStart(AIModule* module) { ExampleAIModule* self = (ExampleAIModule*) module; Game* game = BWAPIC_getGame(); Game_sendText(game, "Hello from bwapi-c!"); Game_sendText(game, "My name is %s", self-&gt;name); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  وتسمى هذه الوظيفة عند تشغيل اللعبة.  الوسيطة هي مؤشر إلى الوحدة النمطية الحالية.  يُرجع <code>BWAPIC_getGame</code> إلى اللعبة ، والذي قمنا بتعيينه باستخدام مكالمة إلى <code>BWAPIC_setGame</code> .  لذلك ، دعونا نعرض مثالًا عمليًا على تجميع وحدة نمطية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">bwapi-c/example$ tree . ├── BWAPIC.dll └── Dll.c 0 directories, 2 files bwapi-c/example$ i686-w64-mingw32-gcc -mabi=ms -shared -o Dll.dll Dll.c -I../include -L. -lBWAPIC bwapi-c/example$ cp Dll.dll ~/Starcraft/bwapi-data/ bwapi-c/example$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  اضغط على الأزرار وقم بتشغيل اللعبة.  يمكن العثور على مزيد من المعلومات حول التجميع والتنفيذ على موقع الويب <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BWAPI</a> وفي <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BWAPI-C</a> . </p><br><p style=";text-align:right;direction:rtl">  نتيجة الوحدة: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cw/a-/41/cwa-41ihsyva-pj2stpef1xjn2g.png" alt="الصورة"></p><br><p style=";text-align:right;direction:rtl">  يمكنك العثور على مثال أكثر تعقيدًا لوحدة توضح كيفية التعامل مع التكرارات وإدارة الوحدة والبحث المعدني وإخراج الإحصاءات في <a href="">bwapi-c / example / Dll.c.</a> </p><br><h2 id="bwapi-sys" style=";text-align:right;direction:rtl">  bwapi-sys </h2><br><p style=";text-align:right;direction:rtl">  يوجد في نظام Rust النظام البيئي <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">طريقة معينة</a> لتسمية الحزم التي ترتبط بالمكتبات الأصلية.  أي حزمة foo-sys تنفذ وظيفتين مهمتين: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  الروابط مع المكتبة المحلية libfoo ؛ </li><li style=";text-align:right;direction:rtl">  يوفر إعلانات للوظائف من مكتبة libfoo.  لكن التصريحات فقط!  لا يتم توفير التجريدات عالية المستوى في صناديق * -sys. </li></ul><br><p style=";text-align:right;direction:rtl">  لكي تتمكن الحزمة * -sys من الارتباط بنجاح ، يجب عليك إخبار البضائع <a href="">للبحث</a> عن المكتبة الأصلية و / أو <a href="">إنشاء</a> المكتبة من المصادر. </p><br><p style=";text-align:right;direction:rtl">  لكي توفر الحزمة * -sys تصريحات ، يجب عليك إما كتابتها بنفسك أو إنشاءها باستخدام bindgen.  مرة أخرى bindgen.  محاولة رقم اثنين =) </p><br><p style=";text-align:right;direction:rtl">  جيل الربط سهل للغاية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">bindgen BWAPI.h -o lib.rs \ --opaque-type <span class="hljs-string"><span class="hljs-string">".+_"</span></span> \ --blacklist-type <span class="hljs-string"><span class="hljs-string">"std.*|__.+|.+_$|Game_v(Send|Print|Draw).*|va_list|.+_t$"</span></span> \ --no-layout-tests \ --no-derive-debug \ --raw-line <span class="hljs-string"><span class="hljs-string">"#![allow(improper_ctypes, non_snake_case)]"</span></span> \ -- -I../submodules/bwapi-c/include sed -i -r -- <span class="hljs-string"><span class="hljs-string">'s/.+\s+(.+)_;/pub struct \1;/'</span></span> lib.rs</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>BWAPI.h</code> هو ملف يحتوي على كافة رؤوس C من BWAPI-C. </p><br><p style=";text-align:right;direction:rtl">  على سبيل المثال ، أنشأ bindgen بالفعل مثل هذه الإعلانات للوظائف المذكورة أعلاه: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">/// BWAPIC_setGame must be called from gameInit to initialize BWAPI::BroodwarPtr pub fn BWAPIC_setGame(game: *mut Game); } extern "C" { pub fn BWAPIC_getGame() -&gt; *mut Game; }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  هناك استراتيجيتان: تخزين الكود الذي تم إنشاؤه في المستودع ، وإنشاء الكود على الطاير أثناء الإنشاء.  كلا النهجين لهما مزايا <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">وعيوب</a> . </p><br><p style=";text-align:right;direction:rtl">  سعيد لمقابلتك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bwapi-sys</a> .  خطوة واحدة أكثر قليلا لهدفنا. </p><br><p style=";text-align:right;direction:rtl">  هل تتذكر أنه في وقت سابق كنت أتحدث عن منصة مشتركة؟  انضم <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">nlinker</a> للمشروع ونفذ استراتيجية الماكرة.  إذا كان المضيف الهدف هو Windows ، فقم بتنزيل BWAPIC المجمعة بالفعل من GitHub.  وبالنسبة للأهداف المتبقية ، نقوم بتجميع BWAPI-C من مصادر OpenBW (سأخبرك بذلك لاحقًا). </p><br><h2 id="bwapi-rs" style=";text-align:right;direction:rtl">  bwapi-rs </h2><br><p style=";text-align:right;direction:rtl">  الآن لدينا الارتباطات ويمكننا تحديد التجريدات عالية المستوى.  لدينا نوعان للعمل مع: القيم الخالصة والمؤشرات غير الشفافة. </p><br><p style=";text-align:right;direction:rtl">  كل شيء بسيط مع القيم الخالصة.  لنأخذ الألوان كمثال.  نحتاج إلى تسهيل استخدامه من كود Rust لاستخدام الألوان بطريقة مريحة وطبيعية: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs">game.draw_line(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>), (<span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">40</span></span>), Color::Red); ^^^</code> </pre> <br><p style=";text-align:right;direction:rtl">  لذلك ، من أجل الاستخدام المريح ، سيكون من الضروري تحديد التعداد باستخدام <a href="">ثوابت</a> C ++ ولكن أيضًا اصطلاحي لـ Rust ، وتحديد طرق تحويله في bwapi_sys :: Color باستخدام std :: convert :: From: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// FFI version #[repr(C)] #[derive(Copy, Clone)] pub struct Color { pub color: ::std::os::raw::c_int, } // Idiomatic version #[derive(PartialEq, PartialOrd, Copy, Clone)] pub enum Color { Black = 0, Brown = 19, ...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  من أجل راحتك ، يمكنك استخدام صندوق <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">التعداد-البدائي</a> . </p><br><p style=";text-align:right;direction:rtl">  كما أنها سهلة الاستخدام مؤشرات مبهمة.  <a href="">لنستخدم</a> نمط <a href="">Newtype</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Player</span></span></span></span>(*<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> sys::Player);</code> </pre> <br><p style=";text-align:right;direction:rtl">  هذا يعني أن "المشغل" عبارة عن نوع من الهياكل مع حقل خاص - مؤشر خام غير شفاف من C. وهنا يمكنك تعريف "المشغل :: اللون: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Player { <span class="hljs-comment"><span class="hljs-comment">// so the method is declared Player::getColor in bwapi-sys //extern "C" { // pub fn Player_getColor(self_: *mut Player) -&gt; Color; //} pub fn color(&amp;self) -&gt; Color { // bwapi_sys::Player_getColor - wrapper function from BWAPI-C // self.0 - opaque pointer let color = unsafe { bwapi_sys::Player_getColor(self.0) }; color.into() // cast bwapi_sys::Color -&gt; Color } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  الآن يمكننا أن نكتب أول بوت لدينا في Rust! </p><br><h2 id="creating-a-bot-in-rust" style=";text-align:right;direction:rtl">  خلق روبوت في الصدأ </h2><br><p style=";text-align:right;direction:rtl">  كدليل على المفهوم ، سيكون الروبوت مشابهًا للعداد المعروف: المهمة بأكملها هي توظيف العمال وجمع المعادن. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/hx/r_/jm/hxr_jmj2fbsitx-tfw96p2pa2tu.png" alt="كوريا الشمالية"></p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ww/gf/lr/wwgflrekcnxtv75thaurrwcm0g8.png" alt="كوريا الجنوبية"></p><br><p style=";text-align:right;direction:rtl">  لنبدأ بالوظائف المطلوبة <code>gameInit</code> و <code>newAIModule</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gameInit</span></span></span></span>(game: *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void) { bwapi_sys::BWAPIC_setGame(game <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> bwapi_sys::Game); } <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newAIModule</span></span></span></span>() -&gt; *<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> void { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> module = ExampleAIModule { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(<span class="hljs-string"><span class="hljs-string">"ExampleAIModule"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = wrap_handler(<span class="hljs-built_in"><span class="hljs-built_in">Box</span></span>::new(module)); result }</code> </pre> <br><p style=";text-align:right;direction:rtl">  <code>#[no_mangle]</code> ينفذ نفس الوظيفة <code>extern "C"</code> في C ++.  <code>wrap_handler</code> كل السحر داخل <code>wrap_handler</code> ، مع استبدال جدول الوظائف الافتراضية وفئة "إخفاء" C ++. </p><br><p style=";text-align:right;direction:rtl">  إن تعريفات هيكل الوحدة أبسط وأسرع من C: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExampleAIModule</span></span></span></span> { name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, }</code> </pre> <br><p style=";text-align:right;direction:rtl">  دعنا نضيف طريقتين لتقديم الإحصاءات وإعطاء الأوامر: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">draw_stat</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> game = Game::get(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message = <span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Frame {}"</span></span>, game.frame_count()); game.draw_text(CoordinateType::Screen, (<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), &amp;message); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">give_orders</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> player = Game::get().self_player(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> unit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> player.units() { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> unit.get_type() { UnitType::Terran_SCV | UnitType::Zerg_Drone | UnitType::Protoss_Probe =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !unit.is_idle() { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> unit.is_carrying_gas() || unit.is_carrying_minerals() { unit.return_cargo(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Some</span></span>(mineral) = Game::get() .minerals() .min_by_key(|m| unit.distance_to(m)) { <span class="hljs-comment"><span class="hljs-comment">// WE REQUIRE MORE MINERALS unit.right_click(&amp;mineral, false); } } UnitType::Terran_Command_Center =&gt; { unit.train(UnitType::Terran_SCV); } UnitType::Protoss_Nexus =&gt; { unit.train(UnitType::Protoss_Probe); } UnitType::Zerg_Hatchery | UnitType::Zerg_Lair | UnitType::Zerg_Hive =&gt; { unit.train(UnitType::Zerg_Drone); } _ =&gt; {} }; } } }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  لتحويل نوع ExampleAIModule إلى وحدة نمطية حقيقية ، يلزمك أن تجعله يستجيب إلى أحداث <strong>onXXXX</strong> .  للقيام بذلك ، تحتاج إلى تطبيق نوع EventHandler ، وهو تمثيلي للجدول الظاهري AIModule_vtable من C: </p><br><pre style=";text-align:right;direction:rtl"> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> EventHandler <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ExampleAIModule { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_start</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { Game::get().send_text(&amp;<span class="hljs-built_in"><span class="hljs-built_in">format!</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello from Rust! My name is {}"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.name)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_end</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _is_winner: <span class="hljs-built_in"><span class="hljs-built_in">bool</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_frame</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.draw_stat(); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.give_orders(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_receive_text</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player, _text: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_player_left</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _player: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Player) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_nuke_detect</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _target: Position) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_discover</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_evade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_show</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_hide</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_create</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_destroy</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_morph</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_renegade</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_save_game</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _game_name: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_unit_complete</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, _unit: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Unit) {} }</code> </pre> <br><p style=";text-align:right;direction:rtl">  يعد إنشاء الوحدة النمطية وتشغيلها بسيطًا مثل C: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">bwapi-rs$ cargo build --example dll --target=i686-pc-windows-gnu bwapi-rs$ cp ./target/i686-pc-windows-gnu/debug/examples/dll.dll ~/Starcraft/bwapi-data/Dll.dll bwapi-rs$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/Starcraft/bwapi-data/ Starcraft$ wine bwheadless.exe -e StarCraft.exe -l bwapi-data/BWAPI.dll --headful ... ... ...</code> </pre> <br><p style=";text-align:right;direction:rtl">  وفيديو العمل: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rACbnWpI01M" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="openbw" style=";text-align:right;direction:rtl">  Openbw </h2><br><p style=";text-align:right;direction:rtl">  ذهب هؤلاء الرجال إلى أبعد من ذلك.  قرروا كتابة نسخة مفتوحة المصدر من SC: BW!  وهم جيدون في ذلك.  كان أحد أهدافهم هو تطبيق صور عالية الدقة ، ولكن SC: Remastered كانت أمامهم = (في هذه اللحظة ، يمكنك استخدام واجهة برمجة التطبيقات الخاصة بهم لكتابة الروبوتات (نعم ، أيضًا في C ++) ، ولكن الميزة الأكثر إثارة هي القدرة على عرض الاعادة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">مباشرة في متصفحك</a> . </p><br><h2 id="conclusion" style=";text-align:right;direction:rtl">  الخاتمة </h2><br><p style=";text-align:right;direction:rtl">  كانت هناك مشكلة لم يتم حلها في التنفيذ: نحن لا نتحكم في المراجع لتكون فريدة من نوعها ، وبالتالي فإن وجود <code>&amp;mut</code> و <code>&amp;</code> في نفس المنطقة سيؤدي إلى سلوك غير محدد عند تعديل الكائن.  نوع من المتاعب.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">حاول</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">هالت</a> تنفيذ الارتباطات الاصطلاحية ، لكنه لم ينجح في إيجاد حل.  وأيضًا إذا كنت ترغب في إكمال هذه المهمة ، يجب عليك "تفريغ" واجهة برمجة تطبيقات C ++ بعناية ووضع تصفيات <code>const</code> بشكل صحيح. </p><br><p style=";text-align:right;direction:rtl">  لقد استمتعت حقًا بالعمل في هذا المشروع ، وشاهدت عمليات إعادة التوزيع وانغمست بشدة في الجو.  حققت هذه اللعبة ent دنت في الكون.  لا يمكن أن تحظى أي لعبة بشعبية مع SC: BW ، وكان تأثيرها على un 정치 에게 غير وارد.  يحظى اللاعبون المؤيدون للاعبين في كوريا بشعبية كبيرة مثل البث الدرامي الكوري في أوقات الذروة.  또한، 한국 에서 프로 게이머 라면 군대 의 특별한 육군 에 입대 입대 수 수 수. </p><br><p style=";text-align:right;direction:rtl">  تحيا ستار كرافت! </p><br><h2 id="links" style=";text-align:right;direction:rtl">  الروابط </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">رديت</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bwapi-rs</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bwapi-sys</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bwapi-c</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">bwapi</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">openbw</a> </li></ul><br><hr><br><p style=";text-align:right;direction:rtl">  شكرا جزيلا لستيف كلابنيك لمساعدتي في مراجعة المقال. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar436254/">https://habr.com/ru/post/ar436254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar436242/index.html">YOLO ومنهجيات فضفاضة أخرى</a></li>
<li><a href="../ar436244/index.html">البروفيسور لورانس الدماغ الجديد</a></li>
<li><a href="../ar436246/index.html">هندسة السيارات الحديثة - 02. أطروحة حول نظام التشغيل</a></li>
<li><a href="../ar436248/index.html">مرشح كالمان</a></li>
<li><a href="../ar436250/index.html">مصاصي الدماء يخرجون عن السياق أو لماذا يفشلون دائمًا</a></li>
<li><a href="../ar436256/index.html">الحصول على وظيفة في ألمانيا سيكون أسهل</a></li>
<li><a href="../ar436260/index.html">أخطاء الشركات الناشئة ومخاطرها في تسجيل براءات الاختراع الخاصة بها</a></li>
<li><a href="../ar436262/index.html">* تأجيل التحديث "القسطنطينية" بسبب ثغرة أمنية محتملة وجدت في اللحظة الأخيرة</a></li>
<li><a href="../ar436264/index.html">مستودعات أحادية: من فضلك لا (الجزء 2)</a></li>
<li><a href="../ar436266/index.html">التحجيم المدقع في بابا JDK</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>