<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ£Ô∏è üéÇ üëç Testen von SQL Server-Code mit tSQLt üòÉ üòÑ üíò</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zu Ihrer Information: Dieser Artikel ist eine erweiterte Version meines Vortrags an den SQA Days # 25. 

 Aufgrund meiner Erfahrung mit Kollegen kann ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Testen von SQL Server-Code mit tSQLt</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/465567/">  <i>Zu Ihrer Information: Dieser Artikel ist eine erweiterte Version meines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vortrags</a> an den SQA Days # 25.</i> <br><br>  Aufgrund meiner Erfahrung mit Kollegen kann ich feststellen: Das Testen von DB-Code ist keine weit verbreitete Praxis.  Dies kann m√∂glicherweise gef√§hrlich sein.  Die DB-Logik wird von Menschen wie jeder andere "√ºbliche" Code geschrieben.  Es kann also zu Fehlern kommen, die negative Folgen f√ºr ein Produkt, ein Unternehmen oder Benutzer haben k√∂nnen.  Unabh√§ngig davon, ob es sich um gespeicherte Prozeduren handelt, die das Backend unterst√ºtzen, oder um ETL-modifizierende Daten in einem Warehouse - es besteht immer ein Risiko, und Tests helfen, diese zu verringern.  Ich m√∂chte Ihnen sagen, was tSQLt ist und wie es uns hilft, DB-Code zu testen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2e/-h/nx/2e-hnxb3bddbq3ck_8vi4jwah8i.jpeg"></div><a name="habracut"></a><br><h1>  Der Kontext </h1><br>  Es gibt ein gro√ües Lager mit SQL Server, das verschiedene Daten zu klinischen Studien enth√§lt.  Es wird aus verschiedenen Quellen (haupts√§chlich dokumentenorientierte Datenbanken) gef√ºllt.  Viele ETLs transformieren bei vielen Gelegenheiten Daten innerhalb des Lagers.  Diese Daten k√∂nnen in kleinere DBs geladen werden, um von Webanwendungen verwendet zu werden, die auf kleine spezifische Aufgaben ausgerichtet sind.  Einige Kunden des Kunden baten darum, APIs f√ºr ihre Anforderungen zu implementieren.  Solche APIs verwenden h√§ufig gespeicherte Prozeduren und unterschiedliche Abfragen. <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/iw/vu/rz/iwvurz8sbflhuz3mkj39ipf9rag.png"></div><br>  Im Allgemeinen gibt es auf der DBMS-Seite eine ziemlich gro√üe Menge an Code. <br><br><h1>  Warum brauchen wir das? </h1><br>  Wie Sie der Einf√ºhrung entnehmen k√∂nnen, ist DB-Code Teil des Anwendungscodes und kann auch Fehler enthalten. <br><br>  Ich denke, viele von uns kennen Boehms Kurve: Die Behebung von Fehlern ist sp√§ter im Prozess immer teurer.  Ein Fehler, der in einem fr√ºheren Entwicklungsstadium gemacht und in einem sp√§teren lokalisiert wurde, kann mehr kosten.  Dies liegt an der Notwendigkeit, viele Zwischenschritte (Codierung, Komponententests, Integrationstests, Systemtests usw.) zweimal durchzuf√ºhren: zum Debuggen und zum Zur√ºcksetzen des Codes in die Phase, in der er gefunden wurde.  Dieser Effekt gilt auch f√ºr den Lagerfall.  Wenn bei einer ETL-Prozedur ein Fehler auftritt und die Daten mehrmals ge√§ndert werden, m√ºssen wir: <br><br><ol><li>  F√ºhren Sie alle Datenumwandlungsschritte zur√ºck zur Ursache des Problems </li><li>  Beheben Sie das Problem </li><li>  leiten Sie die richtigen Daten erneut ab (zus√§tzliche manuelle √Ñnderungen k√∂nnen erforderlich sein) </li><li>  Stellen Sie sicher, dass keine anderen durch den Fehler verursachten Daten besch√§digt sind. </li></ol><br>  Vergessen Sie nicht, dass wir kein Stofftier verkaufen.  Ein Fehler in Bereichen wie klinischen Studien kann nicht nur das Gesch√§ft, sondern auch die menschliche Gesundheit sch√§digen. <br><br><h1>  Wie teste ich? </h1><br>  Da es sich um Codetests handelt, meinen wir Unit- und Integrationstests.  Diese Dinge wiederholen sich sehr oft und implizieren eine anhaltende Regression.  Genau genommen werden solche Tests niemals manuell durchgef√ºhrt (naja, mit Ausnahme einiger Einzelf√§lle wahrscheinlich). <br><br>  Netter Bonus: Tests k√∂nnen unterst√ºtzende Materialien f√ºr die Codedokumentation sein.  Beispielsweise k√∂nnen Anforderungen folgenderma√üen aussehen (anklickbar): <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/fh/af/xb/fhafxb5yph-tgvy2zhka9jfcvmk.png"></a> </div><br>  XLS-Datei, 2 Spalten mit Anforderungen + fragmentierte zus√§tzliche Informationen in anderen Spalten + verwirrendes Markup.  Es kann schwierig sein, die urspr√ºnglichen W√ºnsche bei Bedarf wiederherzustellen.  Tests k√∂nnen dabei helfen, Implementierungsnuancen aufzuzeichnen.  Nat√ºrlich sollten sie nicht als Ersatz f√ºr die Dokumentation betrachtet werden. <br><br>  Leider nimmt die Testkomplexit√§t mit zunehmender Codekomplexit√§t zu, sodass dieser Effekt gegl√§ttet werden kann. <br><br>  Tests k√∂nnen eine zus√§tzliche Sicherheitsschicht gegen spontane Zusammenf√ºhrungen sein.  CI-Autotests helfen bei diesem Problem aufgrund ihres Formalismus. <br><br>  Wenn wir uns also f√ºr die Automatisierung entschieden haben, m√ºssen wir ein Werkzeug daf√ºr ausw√§hlen. <br><br><h1>  Was zum Testen verwenden? </h1><br>  Beim Testen von DB-Code sehe ich zwei Ans√§tze: SQL-basiert (wenn ein Tool direkt in DBMS funktioniert) und nicht SQL-basiert.  Hier sind die Hauptunterschiede, die ich gefunden habe: <br><div class="scrollable-table"><table><tbody><tr><th>  SQL-basiert <br></th><th>  Nicht mit SQL betrieben <br></th></tr><tr><td>  Erfordert die Installation von DB-Objekten <br></td><td>  Erfordert die Installation externer (in Bezug auf DB) Tools <br></td></tr><tr><td>  Tests sind unabh√§ngig von Technologien, die au√üerhalb der DB verwendet werden <br></td><td>  Tests k√∂nnen von Technologien abh√§ngen, die au√üerhalb der Datenbank verwendet werden <br></td></tr><tr><td>  Das Framework ist immer nur einem DBMS zugeordnet <br></td><td>  Framework unterst√ºtzt h√§ufig mehrere DBMS <br></td></tr><tr><td>  DBMS-Kenntnisse sind die einzige Voraussetzung f√ºr das Schreiben von Tests.  Manuelle Tester oder DBA k√∂nnen verwendet werden <br></td><td>  F√ºr das Schreiben von Tests sind zus√§tzliche Kenntnisse der Programmiersprachen oder -technologien erforderlich.  Oft wird die Hilfe eines Entwicklers ben√∂tigt <br></td></tr><tr><td>  Die Ausf√ºhrung auf DBMS-Ebene erm√∂glicht die Verwendung erweiterter F√§lschungen und Zusicherungen. <br></td><td>  Die Ausf√ºhrung au√üerhalb eines DBMS kann die Funktionen des Tools einschr√§nken <br></td></tr></tbody></table></div>  Im Fall von SQL Server haben wir mehrere M√∂glichkeiten: <br><div class="scrollable-table"><table><tbody><tr><th colspan="6" align="center">  Allgemeine Informationen </th></tr><tr><th>  Name </th><th>  Ansatz </th><th>  Architektur </th><th>  Sprache / Plattform </th><th>  Testet die Sprache </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-SQL + CLR </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-sql </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-sql </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  SQL-basiert </td><td>  xEinheit </td><td>  T-sql </td><td>  T-sql </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  Nicht mit SQL betrieben </td><td>  Fitnessess </td><td>  C # / Java </td><td>  Wiki-Abschlag </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  Nicht mit SQL betrieben </td><td>  RSpec (BDD-orientiert) </td><td>  Ruby </td><td>  Ruby </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  Nicht mit SQL betrieben </td><td>  xEinheit </td><td>  N / a </td><td>  N / a </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><th colspan="4" align="center">  Termine </th></tr><tr><th>  Name </th><th>  Erster Auftritt </th><th>  Sp√§testes Commit </th><th>  Neueste Version </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  2007-07-27 </td><td>  07/07/2019 </td><td>  31.01.2016 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  2006-12-16 (0,9) <br>  2007-07-21 (0,91 rc1) </td><td>  26.04.2008 (GitHub) </td><td>  04/09/2011 (SourceForge) </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  2003-03-12 </td><td>  2003-03-12 </td><td>  2003-03-12 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  02-03-2009 (v1.0) </td><td>  N / a </td><td>  30-03-2012 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  12-01-2009 </td><td>  10-09-2018 </td><td>  15.08.2015 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  23.06.2011 </td><td>  12-12-2018 </td><td>  12-12-2018 </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  N / a </td><td>  N / a </td><td>  N / a </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><th colspan="7" align="center">  Eigenschaften </th></tr><tr><th>  Name </th><th>  CLR ist nicht erforderlich </th><th>  XML-Ausgabe </th><th>  Tests in getrennten Transaktionen </th><th>  F√§lschungen </th><th>  Fehlerbehandlungsroutinen </th><th>  Behauptungen </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  - - </td><td>  + </td><td>  + </td><td>  + </td><td>  + </td><td>  Hervorragend </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  + </td><td>  - - </td><td>  + </td><td>  - - </td><td>  - - </td><td>  Fehlgeschlagen </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  + </td><td>  - - </td><td>  - - </td><td>  - - </td><td>  - - </td><td>  Unterdurchschnittlich </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  + </td><td>  + </td><td>  + (optional) </td><td>  - - </td><td>  + </td><td>  Hervorragend </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  + </td><td>  - - </td><td>  + (optional) </td><td>  - - </td><td>  + </td><td>  Sehr gut;  nuanciert </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  + </td><td>  - - </td><td>  + (optional) </td><td>  - - </td><td>  - - </td><td>  Sehr gut;  nuanciert </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  + </td><td>  + </td><td>  N / a </td><td>  N / a </td><td>  N / a </td><td>  Ausgezeichnet;  nuanciert </td></tr></tbody></table></div><div class="scrollable-table"><table><tbody><tr><th colspan="3" align="center">  Andere </th></tr><tr><th>  Name </th><th>  Dokumentation </th><th>  Gemeinschaft </th></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">tSQLt</a> </td><td>  Ausgezeichnet;  nuanciert </td><td>  Hervorragend </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">TSQLUnit</a> </td><td>  Unterdurchschnittlich </td><td>  Unterdurchschnittlich </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utTSQL</a> </td><td>  Hervorragend </td><td>  Unterdurchschnittlich </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tst</a> </td><td>  Hervorragend </td><td>  Unterdurchschnittlich </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dbfit</a> </td><td>  Hervorragend </td><td>  Durchschnitt </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fauler</a> </td><td>  Hervorragend </td><td>  Durchschnitt </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">NUnit</a> usw. </td><td>  Hervorragend </td><td>  Hervorragend </td></tr></tbody></table></div>  Die Skala "Ausgezeichnet - Fehlgeschlagen" ist subjektiv, leider ist es schwierig, einen Weg zu finden. <br><br>  "Erster Auftritt" - das fr√ºheste Datum des Framework-Auftretens, das ich finden konnte - die fr√ºheste Ver√∂ffentlichung oder Verpflichtung. <br><br>  Wie Sie sehen, wurden SQL-basierte Alternativen vor langer Zeit aufgegeben, und tSQLt ist das einzige derzeit unterst√ºtzte Produkt.  Au√üerdem gewinnt tSQLt funktional.  Das einzige ist, dass TST eine etwas umfangreichere Reihe von Behauptungen aufweist als tSQLt.  Ich bezweifle jedoch, dass dies alle Nachteile √ºberwiegen kann. <br><br>  Die tSQLt-Dokumentation weist einige Nuancen auf, die ich sp√§ter beschreiben werde. <br><br>  In der Welt ohne SQL sind die Dinge nicht so klar.  Alternativen entwickeln sich, wenn auch nicht superaktiv.  DbFit ist ein ziemlich interessantes Tool, das auf dem FitNesse-Framework basiert.  Dies impliziert die Verwendung von Wiki-Markups zum Schreiben von Tests.  Slacker ist ebenfalls interessant: F√ºr DB-Code-Tests wird ein BDD-Ansatz empfohlen. <br><br>  Ich sollte √ºber Behauptungen in nicht SQL-basierten L√∂sungen sprechen.  Auf den ersten Blick ist die Anzahl der Behauptungen geringer, und wir k√∂nnen denken, dass solche Tools schlechter sind.  Wir sollten jedoch bedenken, dass sie sich grundlegend von tSQLt unterscheiden. Daher ist ein solcher oberfl√§chlicher Blick falsch. <br><br>  Die letzte Zeile - "NUnit, etc."  - ist eher eine Erinnerung.  Mit Hilfe zus√§tzlicher Bibliotheken k√∂nnen viele √ºbliche Unit-Testing-Frameworks auf den DB-Code angewendet werden.  Es gibt viele N / A in dieser Zeile, da diese Zeile tats√§chlich mehrere Werkzeuge enth√§lt.  Dies ist die Quelle f√ºr "Nuancen" in der Spalte "Zusicherungen". Verschiedene Tools k√∂nnen unterschiedliche Mengen bereitstellen, und es gibt keine Garantie daf√ºr, dass alle Zusicherungen auf DB angewendet werden k√∂nnen. <br><br>  Als weitere interessante Messgr√∂√üe k√∂nnen wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google-Trends</a> ber√ºcksichtigen. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ud/2u/km/ud2ukmcoyjvstvhcu2taegpib34.png"></div><br>  Nuancen: <br><br><ol><li>  Ich habe mich entschieden, Slacker nicht einzuschlie√üen, da dieser Name verschiedene Bedeutungen haben kann (und Abfragen wie "Slacker Framework" sind in der Grafik kaum zu sehen). </li><li>  Nur aus Neugier (und weil ein Slot leer blieb) habe ich den TST-Trend hinzugef√ºgt.  Aber es zeigt uns kaum das wirkliche Bild, weil es eine Abk√ºrzung ist, die auch verschiedene Dinge bedeuten kann. </li><li>  Ich habe NUnit und seine Analoga nicht aufgenommen.  Diese Tools sind Frameworks f√ºr "√ºbliche" Codetests, daher sind ihre Trends f√ºr unseren Kontext nicht beschreibend. </li></ol><br>  Wie Sie sehen k√∂nnen, ist tSQLt das am besten durchsuchbare Tool in der Liste.  Ein weiteres (weniger) beliebtes Tool ist DbFit.  Andere Tools sind nur begrenzt beliebt. <br><br>  Im Gro√üen und Ganzen k√∂nnen wir sehen, dass tSQLt vor dem Hintergrund leuchtet. <br><br><h1>  Was ist tSQLt? </h1><br>  Es ist leicht zu erraten, dass tSQLt ein SQL-basiertes Unit-Testing-Framework ist.  Die offizielle Website ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://tsqlt.org</a> . <br><br>  Es wird versprochen, dass tSQLt SQL Server ab 2005 SP2 unterst√ºtzt.  Ich habe solche fr√ºhen Revisionen nicht √ºberpr√ºft, aber ich sehe keine Probleme mit 2012 auf unserem Dev-Server und 2017 auf meinem lokalen Computer. <br><br>  Open Source, Apache 2.0-Lizenz, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verf√ºgbar auf GitHub</a> .  Wie √ºblich k√∂nnen wir in kommerziellen Projekten kostenlos Beitr√§ge leisten, Beitr√§ge leisten und, was noch wichtiger ist, keine Angst vor Spyware in CLR haben. <br><br><h1>  Mechanik </h1><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/1v/kx/wi/1vkxwixwjyna756vsce7uhwqzw0.png"></div><br>  Testf√§lle sind gespeicherte Prozeduren.  Sie k√∂nnen zu Testklassen kombiniert werden (Testsuite in xUnit-Terminologie). <br><br>  Testklassen sind nichts anderes als DB-Schemata.  tSQLt erfordert, sie bei der NewTestClass-Prozedur zu registrieren, die einer speziellen Tabelle Testklassen hinzuf√ºgt. <br><br>  Es ist m√∂glich, eine SetUp-Prozedur zu bestimmen.  Diese Prozedur wird vor jedem einzelnen Testfall ausgef√ºhrt. <br><br>  Teardown-Verfahren nach Testfalllauf ist nicht erforderlich.  Jeder Testfall mit seinem SetUp wird in einer separaten Transaktion ausgef√ºhrt, die nach der Ergebniserfassung zur√ºckgesetzt wird.  Es ist sehr praktisch, hat aber einige negative Konsequenzen - ich werde sie etwas sp√§ter beschreiben. <br><br>  Das Framework erm√∂glicht das Ausf√ºhren von Testf√§llen nacheinander, die gesamten Testklassen auf einmal oder sogar alle registrierten Testklassen mit einem einzigen Befehl. <br><br><h1>  Funktionen und Beispiele </h1><br>  Da ich den offiziellen Leitfaden nicht wiederholen m√∂chte, werde ich anhand von Beispielen die tSQLt-Funktionen zeigen. <br><br>  <i>Haftungsausschluss:</i> <br><br><ul><li>  <i>Beispiele werden vereinfacht</i> </li><li>  <i>Der urspr√ºngliche Code geh√∂rt nicht ganz mir - er ist eher eine kollektive Kreation</i> </li><li>  <i>Beispiel 2 wird von mir fiktionalisiert, um Funktionen vollst√§ndiger zu demonstrieren.</i> </li></ul><br><h3>  Beispiel 1: CsvSql </h3><br>  Das Folgende wurde auf Anfrage eines Kunden des Kunden implementiert.  In Nvarchar (MAX) -Feldern sind SQL-Abfragen gespeichert.  F√ºr die Anzeige wird eine minimale Benutzeroberfl√§che erstellt.  Durch diese Abfragen generierte Ergebnismengen werden im Backend zum weiteren Erstellen als CSV-Dateien verwendet.  Die CSV-Dateien k√∂nnen durch einen API-Aufruf angefordert werden. <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/5q/mu/oy/5qmuoyyjjvlphk79jt-xtawwjn8.png"></div><br>  Ergebniss√§tze sind gro√ü und enthalten eine gro√üe Anzahl von Spalten.  Ein hypothetisches Beispiel f√ºr eine solche Ergebnismenge: <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/dg/50/bb/dg50bbx25qaw6ycwpfqcsfj5kyk.png"></div><br>  Diese Ergebnismenge repr√§sentiert Daten aus klinischen Studien.  Schauen wir uns die Berechnung von [ClinicsNum] genauer an.  Wir haben 2 Tabellen: [Studie] und [Klinik]. <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/qo/mu/n-/qomun-gdbdl05teniypbtzi8jio.png"></div><br>  Es gibt eine FK: [Klinik]. [TrialID] -&gt; [Trial]. [TrialID].  Offensichtlich reicht es aus, COUNT (*) zu verwenden, um eine Reihe von Kliniken abzuleiten: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">COUNT</span></span>(*), ...  <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> dbo.Trial  <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> dbo.Clinic    <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> Trial.ID = Clinic.TrialID  <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Trial.Name = @trialName  <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> ...</code> </pre> <br>  Wie k√∂nnen wir eine solche Abfrage testen?  Verwenden wir zun√§chst stub FakeTable, was unsere weitere Arbeit erheblich erleichtert. <br><br><pre> <code class="plaintext hljs">EXEC tSQLt.FakeTable 'dbo.Trial'; EXEC tSQLt.FakeTable 'dbo.Clinic';</code> </pre> <br>  FakeTable macht eine einfache Sache - benennt alte Tabellen um und erstellt neue mit demselben Namen.  Dieselben Namen, dieselben Spalten, jedoch ohne Einschr√§nkungen und Ausl√∂ser. <br><br>  Wir brauchen das, weil: <br><br><ol><li>  Die Test-DB kann einige Daten enthalten, die einen ordnungsgem√§√üen Testlauf verhindern k√∂nnen.  Mit FakeTable k√∂nnen wir uns nicht auf sie verlassen. </li><li>  Normalerweise m√ºssen wir zu Testzwecken nur wenige Spalten f√ºllen.  Die Tabelle kann viele davon enthalten, h√§ufig mit Einschr√§nkungen und Triggern.  Wir erleichtern das sp√§tere Einf√ºgen von Daten - wir f√ºgen nur die f√ºr die Testinformationen erforderlichen Informationen ein, um den Test so minimalistisch wie m√∂glich zu halten. </li><li>  Es werden keine unerw√ºnschten Triggerl√§ufe ausgef√ºhrt, sodass wir uns keine Gedanken √ºber Nachwirkungen machen m√ºssen. </li></ol><br>  Dann f√ºgen wir die erforderlichen Testdaten ein: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.Trial ([<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>], [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,   <span class="hljs-string"><span class="hljs-string">'Valerian'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.Clinic ([<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span>], [TrialID], [<span class="hljs-keyword"><span class="hljs-keyword">Name</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,   <span class="hljs-number"><span class="hljs-number">1</span></span>,        <span class="hljs-string"><span class="hljs-string">'Clinic1'</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>,   <span class="hljs-number"><span class="hljs-number">1</span></span>,        <span class="hljs-string"><span class="hljs-string">'Clinic2'</span></span>);</code> </pre> <br>  Wir leiten die Abfrage aus der Datenbank ab, erstellen eine [Ist] -Tabelle und f√ºllen sie mit dem Ergebnis <br>  aus der Abfrage festgelegt. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @sqlStatement <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>) = (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> actual ([TrialID], ...); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> actual EXEC sp_executesql @sqlStatement, ...</code> </pre> <br>  Jetzt f√ºllen wir [Erwartet] - unsere erwarteten Werte: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> expected (   ClinicsNum <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> expected <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Ich m√∂chte Ihre Aufmerksamkeit darauf lenken, dass wir nur eine Spalte in der Tabelle [Erwartet] haben, obwohl wir den vollst√§ndigen Satz in der Spalte [Tats√§chlich] haben. <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/webt/qd/gx/ga/qdgxgaqr4cjp2eayoz0eycjs8cg.png"></div><br>  Dies ist auf eine n√ºtzliche Funktion der AssertEqualsTable-Prozedur zur√ºckzuf√ºhren, die wir zur √úberpr√ºfung der Werte verwenden werden. <br><br><pre> <code class="sql hljs">EXEC tSQLt.AssertEqualsTable   'expected',   'actual',   'incorrect number of clinics';</code> </pre> <br>  Es werden nur die Spalten verglichen, die in beiden Tabellen dargestellt sind.  In unserem Fall ist dies sehr praktisch, da die zu testende Abfrage viele Spalten zur√ºckgibt, die jeweils mit einer ziemlich komplizierten Logik verbunden sind.  Wir m√∂chten keine Testf√§lle aufblasen, daher hilft diese Funktion wirklich.  Nat√ºrlich ist diese Funktion ein zweischneidiges Schwert.  Wenn [Ist] √ºber SELECT TOP 0 gef√ºllt ist und an einer Stelle eine unerwartete Spalte angezeigt wird, wird dies in einem solchen Testfall nicht erfasst.  Sie m√ºssen zus√§tzliche Schecks ausstellen, um dies abzudecken. <br><br><h3>  AssertEqualsTable-Doppelprozeduren </h3><br>  Es ist erw√§hnenswert, dass tSQLt zwei Prozeduren wie AssertEqualsTable enth√§lt.  Dies sind AssertEqualsTableSchema und AssertResultSetsHaveSameMetaData.  Der erste Vorgang entspricht dem von AssertEqualsTable, jedoch f√ºr die Metadaten der Tabellen.  Der zweite macht dasselbe, jedoch f√ºr die Metadaten der Ergebnismengen. <br><br><h3>  Beispiel 2: Einschr√§nkungen </h3><br>  Das vorige Beispiel hat uns gezeigt, wie wir Einschr√§nkungen entfernen k√∂nnen.  Aber was ist, wenn wir sie √ºberpr√ºfen m√ºssen?  Technisch gesehen sind Einschr√§nkungen ebenfalls Teil der Logik und k√∂nnen als Kandidat f√ºr die Abdeckung durch Tests angesehen werden. <br><br>  Betrachten Sie die Situation aus dem vorherigen Beispiel.  2 Tabellen - [Studie] und [Klinik];  [TrialID] FK: <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/webt/-8/zu/v3/-8zuv3clqoo3ygm9wko5hpibc90.png"></div><br>  Versuchen wir, einen Testfall zu schreiben, um ihn zu √ºberpr√ºfen.  Zun√§chst f√§lschen wir wie im vorherigen Fall die Tabellen: <br><br><pre> <code class="sql hljs">EXEC tSQLt.FakeTable '[dbo].[Trial]' EXEC tSQLt.FakeTable '[dbo].[Clinic]'</code> </pre> <br>  Das Ziel ist das gleiche - unn√∂tige Grenzen loszuwerden.  Wir wollen isolierte Kontrollen ohne √ºberm√§√üigen Aufwand. <br><br>  Als N√§chstes geben wir die Einschr√§nkung zur√ºck, die wir mit ApplyConstraint testen m√∂chten: <br><br><pre> <code class="sql hljs">EXEC tSQLt.ApplyConstraint   '[dbo].[Clinic]',   'Trial_FK';</code> </pre> <br>  Jetzt haben wir eine Konfiguration f√ºr die Pr√ºfung.  Die √úberpr√ºfung selbst ist, dass der Versuch, Daten einzuf√ºgen, eine Ausnahme verursacht.  F√ºr das Bestehen des Testfalls m√ºssen wir diese Ausnahme abfangen.  Exception-Handler ExpectException kann helfen. <br><br><pre> <code class="sql hljs">EXEC tSQLt.ExpectException   @ExpectedMessage = 'The <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> conflicted...<span class="hljs-string"><span class="hljs-string">',   @ExpectedSeverity = 16,   @ExpectedState = 0;</span></span></code> </pre> <br>  Wir k√∂nnen versuchen, nicht einf√ºgbare Elemente nach der Handlereinstellung einzuf√ºgen. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> [dbo].[Clinic] ([TrialID])   <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Die Ausnahme wurde abgefangen.  Test bestanden. <br><br><h3>  ApplyConstraint-Doppelverfahren </h3><br>  Die von tSQLt-Autoren vorgeschlagene Methode zum Testen von Triggern √§hnelt dem Testen von Einschr√§nkungen.  Wir k√∂nnen die ApplyTrigger-Prozedur verwenden, um den Trigger an die Tabelle zur√ºckzugeben.  Danach l√§uft alles wie im obigen Beispiel - starten Sie den Trigger, √ºberpr√ºfen Sie das Ergebnis. <br><br><h3>  ExpectNoException - das Antonyme der ExpectException </h3><br>  Es gibt eine ExpectNoException-Prozedur f√ºr die F√§lle, in denen keine Ausnahme auftreten darf.  Es funktioniert genauso wie ExpectException, au√üer dass der Test im Falle einer Ausnahme fehlschl√§gt. <br><br><h3>  Beispiel 3: Semaphor </h3><br>  Es gibt einige gespeicherte Prozeduren und Windows-Dienste.  Der Beginn ihrer Ausf√ºhrung kann durch verschiedene √§u√üere Ereignisse verursacht werden.  Die Reihenfolge ihrer Ausf√ºhrung ist jedoch festgelegt.  Daher ist es erforderlich, die Zugriffssteuerung auf der DB-Seite zu implementieren - d. H. Ein Semaphor.  In unserem Fall ist das Semaphor eine Gruppe gespeicherter Prozeduren, die zusammenarbeiten. <br><br>  Schauen wir uns eine Prozedur innerhalb des Semaphors an.  Wir haben 2 Tabellen - [Process] und [ProcStatus]: <br><br><div style="text-align:center;"><img width="80%" height="80%" src="https://habrastorage.org/webt/-m/hz/8-/-mhz8-fm_n1w7njpryiv8z3epiw.png"></div><br>  Die Tabelle [Prozess] enth√§lt eine Liste der Prozesse, die zur Ausf√ºhrung zugelassen sind.  [ProcStatus] enth√§lt offensichtlich die Liste der Status des Prozesses aus der vorherigen Tabelle. <br><br>  Was macht unser Verfahren?  Zun√§chst werden die folgenden √úberpr√ºfungen durchgef√ºhrt: <br><br><ol><li>  Wir haben einen Prozessnamen als einen der Eingabeparameter der Prozedur √ºbergeben.  Dieser Name wird im Feld [Name] der Tabelle [Prozess] gesucht. </li><li>  Wenn der Name des Prozesses gefunden wurde, √ºberpr√ºft er das Flag [IsRunable] der Tabelle [Process]. </li><li>  Wenn das Flag eingeschaltet ist, k√∂nnen wir davon ausgehen, dass der Prozess ausgef√ºhrt werden kann.  Die letzte √úberpr√ºfung erfolgt in der Tabelle [ProcStatus].  Wir m√ºssen sicherstellen, dass der Prozess derzeit nicht ausgef√ºhrt wird. Dies bedeutet, dass keine Datens√§tze √ºber den Prozess mit dem Status "InProg" in der Tabelle [ProcStatus] vorhanden sind. </li></ol><br>  Wenn alles in Ordnung ist und alle Pr√ºfungen bestanden wurden, f√ºgen wir der Tabelle [ProcStatus] einen neuen Datensatz √ºber unseren Prozess mit dem Status "InProg" hinzu.  Die ID dieses neuen Datensatzes wird mit dem Ausgabeparameter ProcStatusId zur√ºckgegeben. <br><br>  Wenn etwas schief gelaufen ist, erwarten wir Folgendes: <br><br><ol><li>  Eine E-Mail an einen Systemadministrator wird gesendet. </li><li>  ProcStatusId = -1 wird zur√ºckgegeben. </li><li>  Es wurden keine neuen [ProcStatus] -Datens√§tze hinzugef√ºgt. </li></ol><br>  Erstellen wir einen Testfall zum √úberpr√ºfen des Falls von Prozessabwesenheit in der Tabelle [Prozess]. <br><br>  Wir verwenden wieder FakeTable.  Es ist hier nicht so kritisch, aber es kann praktisch sein, weil: <br><br><ol><li>  Es ist garantiert, dass keine Daten vorhanden sind, die die Ausf√ºhrung des Testfalls st√∂ren k√∂nnten. </li><li>  Die weitere √úberpr√ºfung der Abwesenheit neuer [ProcStatus] -Datens√§tze wird vereinfacht. </li></ol><br><pre> <code class="sql hljs">EXEC tSQLt.FakeTable 'dbo.Process'; EXEC tSQLt.FakeTable 'dbo.ProcStatus';</code> </pre> <br>  Es gibt eine [SendEmail] -Prozedur, deren Name f√ºr sich selbst spricht.  Wir m√ºssen seinen Anruf entgegennehmen.  tSQLt schl√§gt vor, daf√ºr SpyProcedure-Mock zu verwenden. <br><br><pre> <code class="plaintext hljs">EXEC tSQLt.SpyProcedure 'dbo.SendEmail'</code> </pre> <br>  SpyProcedure f√ºhrt Folgendes aus: <br><br><ol><li>  Erstellt eine Tabelle mit einem Namen, der wie [dbo] aussieht. [ProcedureName_SpyProcedureLog] </li><li>  Ersetzt genau wie FakeTable die urspr√ºngliche Prozedur durch eine automatisch generierte Prozedur mit demselben Namen, jedoch mit darin enthaltener Protokollierungslogik.  Bei Bedarf k√∂nnen Sie der generierten Prozedur auch Ihre eigene Logik hinzuf√ºgen. </li></ol><br>  Es ist nicht schwer zu erraten, dass Protokolle in der Tabelle [dbo]. [SendEmail_SpyProcedureLog] aufgezeichnet werden.  Diese Tabelle enth√§lt eine Spalte [_ID_] f√ºr die Sequenznummern der Anrufe.  Nachfolgende Spalten werden nach Parametern benannt, die an die Prozedur √ºbergeben und zum Sammeln verwendet werden, sodass auch die Werte der Parameter √ºberpr√ºft werden k√∂nnen. <br><br><div style="text-align:center;"><img width="75%" height="75%" src="https://habrastorage.org/webt/ko/gh/4h/kogh4hgcdsxagldk2bmdcfrptzi.png"></div><br>  Das Letzte, was wir vor dem Semaphoraufruf tun m√ºssen, ist, eine Variable zum Speichern des [ProcStatusId] -Werts zu erstellen (genauer gesagt -1, da der Datensatz nicht hinzugef√ºgt wird). <br><br><pre> <code class="plaintext hljs">DECLARE @ProcStatusId BIGINT;</code> </pre> <br>  Wir nennen das Semaphor: <br><br><pre> <code class="plaintext hljs">EXEC dbo.[Semaphore_JobStarter]   'SomeProcess',   @ProcStatusId OUTPUT; -- here we get -1</code> </pre> <br>  Jetzt haben wir alle Daten, die f√ºr die Pr√ºfungen ben√∂tigt werden.  Beginnen wir mit der √úberpr√ºfung <br>  dass die Nachricht gesendet wurde. <br><br><pre> <code class="plaintext hljs">IF NOT EXISTS (   SELECT *   FROM dbo.SendEmail_SpyProcedureLog) EXEC tSQLt.Fail 'SendEmail has not been run.';</code> </pre> <br>  In diesem Fall √ºberpr√ºfen wir nicht die √ºbergebenen Parameter und testen nur die Tatsache des Sendens.  Ich m√∂chte Ihre Aufmerksamkeit auf das Fail-Verfahren lenken.  Es erm√∂glicht uns, einen Testfall "offiziell" nicht zu bestehen.  Wenn Sie eine anspruchsvolle Konstruktion erstellen m√ºssen, kann Fail helfen. <br><br>  Jetzt √ºberpr√ºfen wir das Fehlen von Datens√§tzen in der Tabelle [ProcStatus] mit der AssertEmptyTable-Prozedur. <br><br><pre> <code class="plaintext hljs">EXEC tSQLt.AssertEmptyTable 'dbo.ProcStatus';</code> </pre> <br>  Hier hat uns FakeTable geholfen, das wir am Anfang verwendet haben.  Damit k√∂nnen wir eine leere Tabelle erwarten und mit einer einzigen Codezeile testen.  Die richtige M√∂glichkeit, dies ohne Tabellenf√§lschung zu √ºberpr√ºfen, besteht darin, die Anzahl der Zeilen vor und nach der Ausf√ºhrung der Prozedur zu vergleichen. Dies w√ºrde mehr Aktionen erfordern. <br><br>  Wir k√∂nnen die ProcStatusId = -1-Gleichheit leicht mit AssertEquals √ºberpr√ºfen. <br><br><pre> <code class="sql hljs">EXEC tSQLt.AssertEquals   -1,       @ProcStatusId,       'Wrong ProcStatusId.';</code> </pre> <br>  AssertEquals ist minimalistisch.  Es werden nur 2 Werte verglichen, nichts Au√üergew√∂hnliches. <br><br><h3>  AssertEquals Doppelprozeduren </h3><br>  Wir haben die folgenden Verfahren zum Wertevergleich: <br><br><ul><li>  AssertEquals </li><li>  AssertNotEquals </li><li>  AssertEqualsString </li><li>  Assertike </li></ul><br>  Die Namen sind selbsterkl√§rend, denke ich.  Das einzige Verfahren, das ich hervorheben m√∂chte, ist AssertEqualsString.  Dies ist das Verfahren zur √úberpr√ºfung von Zeichenfolgenwerten.  Warum brauchen wir ein weiteres Verfahren, wenn wir die universellen AssertEquals ber√ºcksichtigen?  Die Sache ist, AssertEquals / AssertNotEquals / AssertLike arbeiten mit dem Typ SQL_VARIANT.  NVARCHAR (MAX) ist in SQL_VARIANT nicht enthalten, daher mussten tSQLt-Entwickler eine zus√§tzliche Prozedur durchf√ºhren. <br><br><h3>  Gef√§lschte Funktion </h3><br>  Auf Knopfdruck k√∂nnen wir FakeFunction eine Prozedur aufrufen, die SpyProcedure √§hnelt.  Diese F√§lschung erm√∂glicht es, jede Funktion durch eine einfachere zu ersetzen.  Da SQL Server-Funktionen wie eine Zahnpastatube funktionieren (das Ergebnis wird durch das einzige ‚ÄûLoch‚Äú zur√ºckgegeben), ist es technisch unm√∂glich, eine Protokollierungsfunktion zu implementieren.  Der Austausch der inneren Logik ist der einzige verf√ºgbare Weg. <br><br><h1>  Fallstricke </h1><br>  Ich m√∂chte Ihnen einige Fallstricke erl√§utern, denen Sie bei der Verwendung von tSQLt begegnen k√∂nnen.  In diesem Fall bedeuten "Fallstricke" einige Probleme, die durch SQL Server-Einschr√§nkungen verursacht werden und / oder von Framework-Entwicklern nicht behoben werden k√∂nnen. <br><br><h3>  Rollback und Dooming von Transaktionen </h3><br>  Das erste und Hauptproblem unseres Teams ist das Rollback und Dooming von Transaktionen.  SQL Server kann verschachtelte Transaktionen nicht separat zur√ºcksetzen.  Es werden immer alle Transaktionen bis zum √§u√üersten zur√ºckgesetzt.  Wenn man bedenkt, dass tSQLt jeden Test in eine separate Transaktion einschlie√üt, kann dies zu einem Problem werden, da ein Rollback innerhalb einer gespeicherten Prozedur einen Testlauf mit einem nicht beschreibenden Ausf√ºhrungsfehler unterbrechen kann. <br><br>  Um dieses Problem zu umgehen, verwenden wir Sicherungspunkte.  Die Idee ist einfach.  Zu Beginn pr√ºfen wir, ob wir uns in einer Transaktion befinden oder nicht.  Wenn ja, nehmen wir an, dass es sich um eine tSQLt-Transaktion handelt, und setzen einen Sicherungspunkt, sodass wir bei Bedarf darauf zur√ºckgreifen k√∂nnen.  Wenn nein, starten wir eine neue Transaktion.  Tats√§chlich erlauben wir kein Verschachteln. <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/bu/ih/vl/buihvlf1ffnwuzbotecbqtev09o.png"></div><br>  Das Problem wird durch das Scheitern von Transaktionen kompliziert - es kann passieren, wenn eine Ausnahme ausgel√∂st wurde.  Eine zum Scheitern verurteilte Transaktion kann nicht festgeschrieben und auf einen Sicherungspunkt zur√ºckgesetzt werden. Daher m√ºssen wir sie erneut auf die √§u√üerste Transaktion zur√ºcksetzen. <br><br>  In Anbetracht der oben beschriebenen Punkte m√ºssen wir die folgende Struktur verwenden: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @isNestedTransaction <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> =   <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> @@trancount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'false'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY   <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @isNestedTransaction = <span class="hljs-string"><span class="hljs-string">'false'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">SAVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> SavepointName;       <span class="hljs-comment"><span class="hljs-comment">-- something useful   IF @isNestedTransaction = 'false'   COMMIT TRANSACTION; END TRY BEGIN CATCH   DECLARE @isCommitable BIT =       CASE WHEN XACT_STATE() = 1           THEN 'true'           ELSE 'false'   END;   IF @isCommitable = 'true' AND @isNestedTransaction = 'true'       ROLLBACK TRANSACTION SavepointName;   ELSE       ROLLBACK;   THROW; END CATCH;</span></span></code> </pre> <br>  Lassen Sie uns den Code St√ºck f√ºr St√ºck √ºberpr√ºfen.  Zuerst m√ºssen wir feststellen, ob wir uns in einer Transaktion befinden oder nicht. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @isNestedTransaction <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> =   <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> @@trancount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'false'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre> <br>  Nach dem Ableiten des @ isNestedTransaction-Flags k√∂nnen wir den TRY-Block starten und je nach Situation einen Sicherungspunkt festlegen oder eine Transaktion starten. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY   <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @isNestedTransaction = <span class="hljs-string"><span class="hljs-string">'false'</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span>       <span class="hljs-keyword"><span class="hljs-keyword">SAVE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> SavepointName;       <span class="hljs-comment"><span class="hljs-comment">-- something useful</span></span></code> </pre> <br>  Nachdem wir etwas N√ºtzliches getan haben, schreiben wir die Ergebnisse fest, wenn es sich um einen "echten" Prozedurlauf handelt. <br><br><pre> <code class="sql hljs">       <span class="hljs-comment"><span class="hljs-comment">-- something useful   IF @isNestedTransaction = 'false'   COMMIT TRANSACTION; END TRY</span></span></code> </pre> <br>  Wenn es sich um einen Testfall handelt, m√ºssen wir nat√ºrlich nichts festlegen.  tSQLt setzt die √Ñnderungen am Ende automatisch zur√ºck. <br><br>  Wenn etwas schief gelaufen ist und wir in den CATCH-Block gelangen, m√ºssen wir feststellen, ob die Transaktion festgeschrieben werden kann oder nicht. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> CATCH   <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @isCommitable <span class="hljs-built_in"><span class="hljs-built_in">BIT</span></span> =       <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> XACT_STATE() = <span class="hljs-number"><span class="hljs-number">1</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>           <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-string"><span class="hljs-string">'false'</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">END</span></span>;</code> </pre> <br>  Wir k√∂nnen nur dann zum Sicherungspunkt zur√ºckkehren, wenn: <br><br><ol><li>  Die Transaktion ist festschreibbar </li><li>  Es ist ein Testlauf, daher ist ein Sicherungspunkt vorhanden. </li></ol><br>  In allen anderen F√§llen m√ºssen wir die gesamte Transaktion zur√ºcksetzen. <br><br><pre> <code class="sql hljs">   IF @isCommitable = 'true' AND @isNestedTransaction = 'true'       <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRANSACTION</span></span> SavepointName;   ELSE       <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>;   THROW; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> CATCH;</code> </pre> <br>  Ja, leider erhalten wir immer noch den Ausf√ºhrungsfehler, wenn wir w√§hrend eines Testlaufs den nicht festschreibbaren Transaktionsstatus erreicht haben. <br><br><h3>  Faketable und das Fremdschl√ºsselproblem </h3><br>  Sehen wir uns die bekannten Tabellen [Test] und [Klinik] an <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/fy/k7/nm/fyk7nmhfha_fnezignyxclpflay.png"></div><br>  Wir erinnern uns an [TrialID] FK.  Welches Problem kann es verursachen?  In den obigen Beispielen haben wir FakeTable auf beide Tabellen angewendet.  Wenn wir es nur auf einem von ihnen verwenden, erreichen wir das folgende Setup: <br><br><div style="text-align:center;"><img width="85%" height="85%" src="https://habrastorage.org/webt/og/to/3-/ogto3-drjheieblpi1_gsyup4hs.png"></div><br>  Ein Versuch, einen Datensatz in [Clinic] einzuf√ºgen, kann daher fehlschlagen, selbst wenn wir Daten in der gef√§lschten Version von [Trial] vorbereitet haben. <br><br><pre> <code class="sql hljs">[dbo].[Test_FK_Problem] failed: (Error) The <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">statement</span></span> conflicted <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> <span class="hljs-string"><span class="hljs-string">"Trial_Fk"</span></span>. The conflict occurred <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-string"><span class="hljs-string">"HabrDemo"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">"dbo.tSQLt_tempobject_ba8f36353f7a44f6a9176a7d1db02493"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-string"><span class="hljs-string">'TrialID'</span></span>.[<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]{Test_FK_Problem,<span class="hljs-number"><span class="hljs-number">14</span></span>}</code> </pre> <br>  Fazit: Alle oder keine vort√§uschen.  Falls keine vorhanden ist, sollten Sie nat√ºrlich eine Datenbank mit allen erforderlichen Testdaten vorbereiten. <br><br><h3>  SpyProcedure zu Systemprozeduren </h3><br>  Leider k√∂nnen wir Systemprozeduren nicht ausspionieren: <br><br><pre> <code class="sql hljs">[HabrDemo].[test_test] failed: (Error) Cannot <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> SpyProcedure <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> sys.sp_help because the <span class="hljs-keyword"><span class="hljs-keyword">procedure</span></span> does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exist[<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>] {tSQLt.Private_ValidateProcedureCanBeUsedWithSpyProcedure,<span class="hljs-number"><span class="hljs-number">7</span></span>}</code> </pre> <br>  Im Semaphor-Beispiel haben wir Aufrufe der Prozedur [SendEmail] verfolgt, die von unseren Entwicklern erstellt wurde.  In diesem Fall war es nicht nur durch Testen erforderlich.  Es war erforderlich, eine separate Prozedur zu erstellen, da vor dem Senden einige Daten vorbereitet werden m√ºssen.  Sie sollten jedoch mental darauf vorbereitet sein, ein Interlayer-Verfahren zu schreiben, um die Testziele zu erreichen. <br><br><h1>  Vorteile </h1><br><h3>  Schnelle Installation </h3><br>  Die tSQLt-Installation besteht aus 2 Schritten und dauert ca. 2 Minuten.  Sie m√ºssen CLR aktivieren, wenn es derzeit nicht aktiv ist, und ein einzelnes SQL-Skript ausf√ºhren.  Das ist alles: Jetzt k√∂nnen Sie Ihre erste Testklasse hinzuf√ºgen und Testf√§lle schreiben. <br><br><h3>  Schnelles Lernen </h3><br>  tSQLt ist leicht zu erlernen.  Es hat etwas mehr als einen Arbeitstag gedauert.  Ich habe Kollegen gefragt und es scheint ungef√§hr 1 Arbeitstag f√ºr andere zu dauern.  Ich bezweifle, dass es viel l√§nger dauern kann. <br><br><h3>  Schnelle CI-Integration </h3><br>  Die Einrichtung der CI-Integration f√ºr unser Projekt dauerte ca. 2 Stunden.  Die Zeit kann nat√ºrlich variieren, aber es ist im Allgemeinen kein Problem und es kann schnell erledigt werden. <br><br><h3>  Eine breite Palette von Instrumenten </h3><br>  Es ist subjektiv, aber meiner Meinung nach ist die tSQLt-Funktionalit√§t reichhaltig und der L√∂wenanteil der Bed√ºrfnisse kann dadurch abgedeckt werden.  Wenn dies nicht ausreicht, k√∂nnen Sie das Fail-Verfahren immer f√ºr seltene und anspruchsvolle F√§lle verwenden. <br><br><h3>  Bequeme Dokumentation </h3><br>  Offizielle F√ºhrer sind bequem und konsistent.  Sie k√∂nnen die Verwendung von tSQLt in kurzer Zeit leicht verstehen, selbst wenn es Ihr erstes Unit-Test-Tool ist. <br><br><h3>  Ausgabe l√∂schen </h3><br>  Die Testausgabe kann in einem illustrativen Textformat erfolgen: <br><br><pre> <code class="plaintext hljs">[tSQLtDemo].[test_error_messages] failed: (Failure) Expected an error to be raised. [tSQLtDemo].[test_tables_comparison] failed: (Failure) useful and descriptive error message Unexpected/missing resultset rows! |_m_|Column1|Column2| +---+-------+-------+ |&lt; |2 |Value2 | |= |1 |Value1 | |= |3 |Value3 | |&gt; |2 |Value3 | +----------------------+ |Test Execution Summary| +----------------------+ |No|Test Case Name |Dur(ms)|Result | +--+------------------------------------+-------+-------+ |1 |[tSQLtDemo].[test_constraint] | 83|Success| |2 |[tSQLtDemo].[test_trial_view] | 83|Success| |3 |[tSQLtDemo].[test_error_messages] | 127|Failure| |4 |[tSQLtDemo].[test_tables_comparison]| 147|Failure| ----------------------------------------------------------------------------- Msg 50000, Level 16, State 10, Line 1 Test Case Summary: 4 test case(s) executed, 2 succeeded, 2 failed, 0 errored. -----------------------------------------------------------------------------</code> </pre><br>  Es kann auch aus der Datenbank abgeleitet werden (anklickbar) ... <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/-f/83/la/-f83lajcz1mfcnkhtttz45b0x3g.png"></a> </div><br>  ... oder auch als XML. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuites</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuite</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tests</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">errors</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">failures</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">timestamp</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2019-06-22T16:46:06"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.433"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hostname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"BLAHBLAHBLAH\SQL2017"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLt"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test_constraint"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.097"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test_error_messages"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.153"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">failure</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">message</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Expected an error to be raised."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLt.Fail"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testcase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">classname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"tSQLtDemo"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"test_trial_view"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0.156"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system-out</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">system-err</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuite</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">testsuites</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Das letzte Format erm√∂glicht eine problemlose CI-Integration.  Insbesondere verwenden wir tSQLt zusammen mit Atlassian Bamboo. <br><br><h3>  Unterst√ºtzung von redgate </h3><br>  Als einer der Profis kann ich die Unterst√ºtzung eines der gr√∂√üten DBA-Tool-Anbieter nennen - RedGate.  Das SQL Server Management Studio-Plugin mit dem Namen SQL Test funktioniert von Anfang an mit tSQLt.  Dar√ºber hinaus hilft RedGate dem Hauptentwickler von tSQLt mit der Dev-Umgebung, so seine Worte in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Google-Gruppen</a> . <br><br><h1>  Nachteile </h1><br><h3>  Keine tempor√§ren Tische f√§lschen </h3><br>  tSQLt erlaubt keine gef√§lschten tempor√§ren Tabellen.  Gedanken, im Bedarfsfall k√∂nnen Sie ein inoffizielles Addon verwenden.  Leider funktioniert dieses Addon nur mit SQL Server 2016+. <br><br><h3>  Arbeiten Sie mit √§u√üeren DBs </h3><br>  tSQLt wurde entwickelt, um mit dem Code in derselben Datenbank zu arbeiten, in der das Framework installiert ist.  Daher kann es unm√∂glich sein, es mit einer √§u√üeren Datenbank zu verwenden.  Zumindest funktionieren F√§lschungen nicht. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [tSQLtDemo].[test_outer_db] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [AdventureWorks2017].[Person].[<span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>]   EXEC tSQLt.FakeTable <span class="hljs-string"><span class="hljs-string">'[AdventureWorks2017].[Person].[Password]'</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">10</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [AdventureWorks2017].[Person].[<span class="hljs-keyword"><span class="hljs-keyword">Password</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ga/au/ny/gaaunygdr124sssxhonbb2s0b_0.png"></div><br>  Es sieht so aus, als ob Behauptungen funktionieren, aber ihre Verarbeitbarkeit ist nat√ºrlich nicht garantiert. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> [tSQLtDemo].[test_outer_db_assertions] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP <span class="hljs-number"><span class="hljs-number">1</span></span> *   <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#Actual   FROM [AdventureWorks2017].[Person].[Password]   SELECT *   INTO #Expected   FROM (          SELECT 'bE3XiWw=' AS [PasswordSalt]   ) expectedresult;   EXEC tSQLt.AssertEqualsTable '#Expected', '#Actual', 'The salt is not salty'; END</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/dk/ow/cgdkowych69imevqmbirkkgsniq.png"></div><br><h3>  Dokumentationsfehler </h3><br>  Obwohl ich oben erw√§hnt habe, dass die Anleitungen bequem und konsistent sind, weist die Dokumentation einige Probleme auf.  Es enth√§lt veraltete Teile. <br><br>  Beispiel 1. In der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kurzanleitung wird vorgeschlagen</a> , das Framework von SourceForge herunterzuladen. <br>  Sie sind von SourceForge <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bis 2015</a> umgezogen. <br><br>  Beispiel 2. Das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ApplyConstraint-Handbuch</a> verwendet ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">umfangreiches</a> Design mit der Fail-Prozedur in einem Ausnahmebeispiel.  Dies kann mit ExpectException durch einfachen und klaren Code ersetzt werden. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PROCEDURE</span></span> ConstraintTests.[<span class="hljs-keyword"><span class="hljs-keyword">test</span></span> ReferencingTable_ReferencedTable_FK prevents <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> orphaned <span class="hljs-keyword"><span class="hljs-keyword">rows</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> EXEC tSQLt.FakeTable <span class="hljs-string"><span class="hljs-string">'dbo.ReferencedTable'</span></span>; EXEC tSQLt.FakeTable 'dbo.ReferencingTable'; EXEC tSQLt.ApplyConstraint 'dbo.ReferencingTable','ReferencingTable_ReferencedTable_FK'; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> @ErrorMessage <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @ErrorMessage = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* [NB] Why don't we use ExceptException below? */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> TRY <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> dbo.ReferencingTable ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, ReferencedTableId ) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span> ) ; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> TRY <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> CATCH <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> @ErrorMessage = ERROR_MESSAGE(); <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> CATCH <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> @ErrorMessage <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%ReferencingTable_ReferencedTable_FK%'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> EXEC tSQLt.Fail <span class="hljs-string"><span class="hljs-string">'Expected error message containing ''ReferencingTable_ReferencedTable_FK'' but got: '''</span></span>,@ErrorMessage,<span class="hljs-string"><span class="hljs-string">'''!'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GO</span></span></code> </pre><br>  Und das wird erwartet wegen ... <br><br><h3>  Teilweise Aufgabe </h3><br>  Von Anfang 2016 bis Juni 2019 gab es eine l√§ngere Entwicklungspause. Ja, leider wird dieses Tool teilweise aufgegeben.  Die Entwicklung hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">laut GitHub</a> 2019 langsam begonnen.  Obwohl offizielle Google Groups <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Thread haben,</a> in dem Sebastian, der Hauptentwickler von tSQLt, nach der Zukunft des Projekts gefragt wurde.  Die letzte Frage wurde am 2. M√§rz 2019 ohne Antwort gestellt. <br><br><h3>  SQL Server 2017-Problem </h3><br>  Die Installation von tSQLt erfordert m√∂glicherweise einige zus√§tzliche Aktionen, wenn Sie SQL Server 2017 verwenden. Microsoft hat in dieser Version die erste Sicherheits√§nderung seit 2012 implementiert.  Das Flag "CLR strikte Sicherheit" auf Serverebene wurde hinzugef√ºgt.  Dieses Flag verbietet die Erstellung von nicht signierten Assemblys (sogar SAFE).  Eine ausf√ºhrliche Beschreibung verdient einen separaten Artikel (und zum Gl√ºck haben wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bereits</a> einen guten; siehe auch die folgenden Artikel in der Reihenfolge. Seien Sie nur mental darauf vorbereitet. <br><br>  Nat√ºrlich k√∂nnte ich dieses Problem den "Fallstricken" zuschreiben, aber dieses Problem kann von den tSQLt-Entwicklern behoben werden.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Das GitHub-Problem wurde bereits behoben</a> .  Es wurde jedoch seit Oktober 2017 nicht mehr gel√∂st. <br><br><h1>  Alternativen (¬±) f√ºr andere DBMS </h1><br>  tSQLt ist nicht einzigartig.  Obwohl Sie es aufgrund von CLR- und T-SQL-Nuancen nicht in anderen DBMS verwenden k√∂nnen, finden Sie dennoch etwas √Ñhnliches.  Es ist erw√§hnenswert, dass diese Alternativen tSQLt nicht sehr nahe kommen, also meine ich einen SQL-basierten Ansatz. <br><br>  Beispielsweise k√∂nnen PostgreSQL-Benutzer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pgTAP</a> ausprobieren.  Es ist ein gut entwickeltes und aktiv entwickeltes Tool, das natives PL / pgSQL f√ºr Tests und das TAP-Ausgabeformat verwendet.  Das √§hnliche Tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MyTap</a> kann Ihnen bei Tests unter MySQL helfen.  Dieses Framework ist etwas weniger funktional als pgTAP, kann aber dennoch n√ºtzlich sein.  Und es befindet sich auch in der aktiven Entwicklung.  Wenn Sie ein zufriedener Oracle-Benutzer sind, haben Sie die M√∂glichkeit, das sehr leistungsstarke Tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">utPLSQL zu verwenden</a> .  Es entwickelt sich sehr aktiv und bietet eine Vielzahl von Funktionen. <br><br><h1>  Fazit </h1><br>  Ich wollte 2 Ideen vermitteln: <br><br>  Das erste: die N√ºtzlichkeit des DB-Code-Testens.  Es ist nicht wichtig, ob Sie SQL Server, Oracle, MySQL oder etwas anderes verwenden.  Wenn Ihre Datenbank nicht getestete Logik enth√§lt, gehen Sie Risiken ein.  Wie alle anderen Fehler in allen anderen Codes k√∂nnen DB-Code-Fehler das Produkt und das Unternehmen, das es bereitstellt, besch√§digen. <br><br>  Das zweite: die Werkzeugauswahl.  F√ºr diejenigen, die mit SQL Server arbeiten, verdient tSQLt, auch wenn es kein 100% iger Gewinner ist, sicherlich Aufmerksamkeit.  Trotz langsamer Entwicklung und einiger Probleme ist dies immer noch ein praktischer Rahmen, der Ihre Arbeit erheblich erleichtern k√∂nnte. <br><br><div class="spoiler">  <b class="spoiler_title">Quellen, die mir geholfen haben (nicht ersch√∂pfende Liste)</b> <div class="spoiler_text">  DbFit - Automatisierte Open Source-Datenbanktests: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://www.methodsandtools.com/tools/dbfit.php</a> <br><br>  DbFit-Dokumentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://dbfit.github.io/dbfit/docs/</a> <br><br>  Slacker-Wiki: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/vassilvk/slacker/wiki</a> <br><br>  TST-Dokumentation: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://archive.codeplex.com/projects/TST/4e04e281-9f35-4891-809a-15f09d304f4e</a> <br><br>  NUnit-Zusicherungen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/nunit/docs/wiki/Assertions</a> <br><br>  utTSQL-Code: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://sourceforge.net/p/uttsql/code/HEAD/tree/</a> <br><br>  Junit Class Assert: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://junit.org/junit4/javadoc/latest/org/junit/Assert.html</a> <br><br>  pgTap: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://pgtap.org/</a> <br><br>  utPLSQL: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://utplsql.org/</a> <br><br>  MyTap: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/hepabolu/mytap</a> <br><br>  tSQLt Google-Gruppen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://groups.google.com/forum/#!forum/tsqlt</a> <br><br>  Offizielle tSQLt-Website: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://tsqlt.org/</a> <br><br>  tSQLt GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/tSQLt-org/tSQLt</a> <br><br>  Google-Trends: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://bit.ly/2x7BQL6</a> <br><br>  So rollen Sie eine Transaktion beim Testen mit tSQLt zur√ºck: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://stackoverflow.com/questions/8973138/how-to-rollback-a-transaction-when-testing-using-tsqlt</a> <br><br>  Was sind die Vor- und Nachteile des manuellen Komponententests gegen√ºber dem automatisierten Komponententest? <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Https://stackoverflow.com/questions/2948337/what-are-the-pros-and-cons-of-manual-unit-testing-against -die-automatisierten-Einheitentests # 2948354</a> <br><br>  Das Gute, das Schlechte und das Ugle ¬Ø e ¬Ø: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://sqlquantumleap.com/2017/08/07/sqlclr-vs-sql-server-2017-part-1-clr-strict-security/</a> <br><br>  Rex Black, Erik Van Veenendal, Dorothy Graham, Grundlagen des Softwaretests, Dritte Ausgabe, 2012 Cengage Learning EMEA <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465567/">https://habr.com/ru/post/de465567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465551/index.html">September IT Events Digest (Teil 1)</a></li>
<li><a href="../de465553/index.html">Programmiersprache √ú. Einf√ºhrung, Motivation zu schaffen, Ziele</a></li>
<li><a href="../de465555/index.html">12 Soft Skills, die IT-Projektmanager unaufhaltsam machen</a></li>
<li><a href="../de465557/index.html">Produktentwicklungsfristen</a></li>
<li><a href="../de465561/index.html">Was ich von einem f√ºhrenden Programmierer gelernt habe</a></li>
<li><a href="../de465569/index.html">Entwicklungskarte f√ºr mobile Entwickler</a></li>
<li><a href="../de465571/index.html">Wie man M√§nnerzigaretten f√ºr Frauen verkauft und Wilde dazu bringt, sich selbst zu sch√ºtzen: Texter, die es k√∂nnten</a></li>
<li><a href="../de465573/index.html">Die ganze Kraft von IntelliJ IDEA am Beispiel einer Sprache (in Bildern)</a></li>
<li><a href="../de465575/index.html">Vergleichsoperationen in C ++ 20</a></li>
<li><a href="../de465577/index.html">Neue Arten der Mikromarkierung f√ºr erweiterte interaktive Snippets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>