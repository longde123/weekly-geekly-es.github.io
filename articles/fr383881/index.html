<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤮 👩‍🍳 👩‍🔧 Configuration sans fil de l'ESP8266 dans le firmware DeviceHive v 0.3 ♨️ 💃 👨🏾‍🌾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonnes nouvelles tout le monde! Une nouvelle version du firmware DeviceHive pour ESP8266 a été publiée. Nous avons implémenté la prise en charge des i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Configuration sans fil de l'ESP8266 dans le firmware DeviceHive v 0.3</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataart/blog/383881/"><img src="https://habrastorage.org/files/6e0/1c9/a9a/6e01c9a9af6745269204157d895e2599.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bonnes nouvelles tout le monde! </font><font style="vertical-align: inherit;">Une </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nouvelle version du</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> firmware DeviceHive pour ESP8266 a été publiée. </font><font style="vertical-align: inherit;">Nous avons implémenté la prise en charge des interfaces les plus populaires pour la connexion d'appareils: GPIO, ADC, PWM, UART, I2C, SPI, 1 fil. </font><font style="vertical-align: inherit;">Vous pouvez désormais facilement connecter des appareils dotés de ces interfaces à notre service cloud. </font><font style="vertical-align: inherit;">Et surtout - la possibilité de configurer sans fil le firmware est apparue (voir la capture d'écran ci-dessous). </font><font style="vertical-align: inherit;">Nous en parlerons aujourd'hui.</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/7bf/d1b/409/7bfd1b4092d1457fab6be46e45e5e4a4.png"></div><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Triple RESET, ou "Allons-y!" </font></font></b></h5><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lors de la création d'appareils IoT avec une connexion sans fil, vous pouvez souvent rencontrer un problème désagréable: la configuration de l'appareil pour l'utilisateur final n'est pas aussi simple qu'il y paraît. </font><font style="vertical-align: inherit;">Ces appareils ne sont généralement pas équipés d'un écran et d'un clavier, de sorte que la configuration des paramètres initiaux (données du réseau Wi-Fi, par exemple) ne fonctionnera pas sans un câble approprié et un logiciel spécialisé. </font><font style="vertical-align: inherit;">Nous avons essayé de résoudre ce problème dans la nouvelle version du firmware.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Maintenant, tout est extrêmement simple à configurer: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• l'appareil redémarre trois fois (avec un intervalle ne dépassant pas 3 secondes), après quoi il se transforme en point d'accès Wi-Fi; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• vous vous connectez à ce point et entrez dans le navigateur tous les paramètres nécessaires; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
• après avoir appliqué les paramètres, l'appareil redémarre automatiquement déjà avec les nouveaux paramètres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De cette façon, les deux problèmes sont résolus en même temps - vous n'aurez besoin ni de câbles ni de logiciels spéciaux. Outre le navigateur ... mais avez-vous un navigateur? Le bouton RESET est le plus souvent situé directement sur le corps de l'appareil, en appuyant trois fois devrait être assez simple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De plus, dans les systèmes d'exploitation mobiles modernes, vous n'avez même pas besoin d'ouvrir un navigateur, car la plupart d'entre eux prennent en charge l'authentification par portail captif. </font><font style="vertical-align: inherit;">Sur les appareils Apple, la page de saisie des données s'ouvre automatiquement. </font><font style="vertical-align: inherit;">Android affichera une notification en cliquant sur lequel, vous vous retrouverez sur cette page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dans la vidéo ci-dessous, vous pouvez voir comment tout fonctionne avec le nouveau firmware et l'appareil Android.</font></font><br>
<br>
<iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://www.youtube.com/embed/2J98YDpbJKo%3Ffeature%3Doembed&amp;usg=ALkJrhiF94YTMTEdhG5clQY_9txQbHSGvQ" frameborder="0" allowfullscreen=""></iframe><br>
<br>
<h5><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fais le toi-même</font></font></b></h5><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voyons comment fonctionne un tel système de configuration, car il peut être mis en œuvre pour tout autre appareil sans fil avec Wi-Fi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour commencer, nous augmentons le réseau Wi-Fi habituel. Dans ce document, nous créons un serveur DHCP qui distribuera les adresses IP aux appareils connectés. Mais en tant que serveur DNS, il transmet l'adresse IP du DNS «rusé». L'astuce est que la même adresse IP du serveur HTTP avec lequel nous pouvons configurer l'appareil sera toujours renvoyée à tous les enregistrements de requête DNS «A». Dans le cas d'ESP8266, les serveurs DHCP, DNS et HTTP fonctionnent directement sur la puce. Dans une version très basique, cela suffit - en ouvrant n'importe quelle page du navigateur, nous verrons la page des paramètres. Mais, pour être beau, vous pouvez forcer les appareils qui prennent en charge l'authentification du portail à afficher une notification sur la nécessité de saisir des données.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'authentification du portail est généralement utilisée pour saisir des données et / ou afficher un accord d'utilisation dans un hôtel, un hôtel et d'autres points d'accès Wi-Fi. Nous utilisons cette technique pour afficher notre page. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Android lors de la connexion à un réseau Wi-Fi essaiera d'accéder à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clients3.google.com/generate_204</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Les appareils Apple tentent de se connecter à </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">captive.apple.com</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après y avoir envoyé une demande, vous recevrez une réponse du formulaire:</font></font><br>
<br>
<pre><code class="bash hljs">$ curl http://clients3.google.com/generate_204 -i<font></font>
HTTP/1.1 204 No Content<font></font>
Content-Length: 0<font></font>
Date: Mon, 07 Sep 2015 14:58:21 GMT<font></font>
Server: GFE/2.0<font></font>
<font></font>
<font></font>
$ curl http://captive.apple.com -i<font></font>
HTTP/1.1 200 OK<font></font>
Content-Type: text/html<font></font>
Content-Length: 68<font></font>
Date: Mon, 07 Sep 2015 15:00:32 GMT<font></font>
Connection: keep-alive<font></font>
<font></font>
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;Success&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;Success&lt;/BODY&gt;&lt;/HTML&gt;<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, en réponse à une demande HTTP, ils renvoient une réponse avec le statut 2xx. Grâce à ces demandes, les appareils déterminent s'ils sont connectés à Internet. Pour implémenter l'authentification du portail, en réponse à ces demandes (ou simplement à toutes les demandes à l'exception de celles qui nous intéressent), envoyez une réponse avec le code 302 Déplacé temporairement et indiquez le champ Emplacement avec notre adresse dans l'en-tête, c'est-à-dire que la réponse devrait être quelque chose comme ceci:</font></font><br>
<br>
<pre><code class="bash hljs">HTTP/1.1 302 Moved Temporarily<font></font>
Content-Length: 0<font></font>
Location: http://example.com<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Après avoir reçu cette réponse, les appareils comprendront qu'il est nécessaire d'afficher la page des paramètres à l'adresse spécifiée - les appareils Apple ouvriront cette page à l'écran eux-mêmes et Android affichera une notification. </font><font style="vertical-align: inherit;">Dans les systèmes d'exploitation sans prise en charge de l'authentification du portail, il suffit d'écrire dans la barre d'adresse du navigateur toute adresse commençant par «http: //» - le navigateur ouvrira la page des paramètres. </font><font style="vertical-align: inherit;">Dans le même temps, vous ne tromperez pas l'utilisateur, car l'adresse de la page avec les paramètres sera affichée dans la barre d'adresse. </font><font style="vertical-align: inherit;">Dans le firmware pour ESP8266, nous utilisons l'adresse </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devicehive.config</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nous espérons que tout cela vous sera utile. </font><font style="vertical-align: inherit;">Bonne chance pour créer vos propres solutions IoT! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Publié par Nikolai Khabarov, développeur principal embarqué</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr383881/">https://habr.com/ru/post/fr383881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr383867/index.html">Le sexe en réalité virtuelle est en route: les jouets sont prêts (18+)</a></li>
<li><a href="../fr383871/index.html">Smartphone DEXP Ixion ML2 5 ”: une batterie puissante pour un record de 5 200 mAh, un écran HD et une semaine d'autonomie</a></li>
<li><a href="../fr383873/index.html">L'impression 3D de métaux utilise un système laser et une robotique avancée</a></li>
<li><a href="../fr383875/index.html">HTML5-версия StarCraft</a></li>
<li><a href="../fr383877/index.html">Nous imprimons des images en utilisant Arduino</a></li>
<li><a href="../fr383885/index.html">Comment faire une découverte scientifique sans quitter la maison?</a></li>
<li><a href="../fr383891/index.html">Steve Wozniak a finalement aimé le film sur Steve Jobs avec Michael Fassbender dans le rôle-titre</a></li>
<li><a href="../fr383893/index.html">Mars amateur rovers compétitions en Pologne</a></li>
<li><a href="../fr383895/index.html">Courte critique de la tablette ASUS ZenPad C 7.0</a></li>
<li><a href="../fr383897/index.html">Smartphone pour les voyageurs SONY Z3 Dual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>