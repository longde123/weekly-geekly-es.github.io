<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏑 🎭 🍴 Beschleunigung instagram.com. Teil 3 🙌 🧔🏾 📝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Heute veröffentlichen wir eine Übersetzung des dritten Teils einer Reihe von Materialien über Acceleration instagram.com. Im ersten Teil haben wir übe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Beschleunigung instagram.com. Teil 3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/472336/">  Heute veröffentlichen wir eine Übersetzung des dritten Teils einer Reihe von Materialien über Acceleration instagram.com.  Im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ersten Teil haben</a> wir über das Vorladen von Daten gesprochen, im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zweiten</a> über das Senden von Daten an den Client auf Initiative des Servers.  Hier geht es um Caching. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/qd/4b/rj/qd4brjd95sxpyklmib8eva8qdg0.jpeg"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Die Arbeit beginnt mit einem Cache</font> </h2><br>  Wir senden bereits Daten an die Client-Anwendung und tun dies so früh wie möglich beim Laden der Seite.  Dies bedeutet, dass der einzige schnellere Weg zur Bereitstellung von Daten ein Schritt ist, bei dem überhaupt keine Schritte erforderlich sind, um Informationen vom Client anzufordern oder auf Initiative des Servers an den Client zu senden.  Dies kann mit diesem Ansatz zur Seitenbildung erfolgen, bei dem der Cache in den Vordergrund tritt.  Dies bedeutet jedoch, dass wir dem Benutzer, wenn auch nur sehr kurz, veraltete Informationen anzeigen müssen.  Bei diesem Ansatz zeigen wir dem Benutzer nach dem Laden der Seite sofort eine zwischengespeicherte Kopie seines Feeds und seiner Storys. Sobald die neuesten Daten verfügbar sind, ersetzen wir diese durch solche Daten. <br><br>  Wir verwenden Redux, um den Status von instagram.com zu verwalten.  Infolgedessen sieht der Gesamtimplementierungsplan des obigen Schemas so aus.  Wir speichern eine Teilmenge des Redux-Repositorys auf dem Client in der indexedDB-Tabelle und füllen dieses Repository beim ersten Laden der Seite.  Das Arbeiten mit indexedDB, das Herunterladen von Daten vom Server und die Benutzerinteraktion mit der Seite sind jedoch asynchrone Prozesse.  Infolgedessen können Probleme auftreten.  Sie bestehen in der Tatsache, dass der Benutzer mit dem alten zwischengespeicherten Status arbeitet und wir die Aktionen des Benutzers auf den neuen Status anwenden müssen, wenn er vom Server empfangen wird. <br><br>  Wenn wir beispielsweise die Standardmechanismen für die Arbeit mit dem Cache verwenden, kann das folgende Problem auftreten.  Wir beginnen mit dem parallelen Laden von Daten aus dem Cache und aus dem Netzwerk.  Da die Daten aus dem Cache schneller bereit sind als die Netzwerkdaten, zeigen wir sie dem Benutzer.  Der Benutzer mag dann beispielsweise den Beitrag, aber nachdem die Antwort des Servers, die die neuesten Informationen enthält, beim Client eingeht, überschreiben diese Informationen die Informationen über den gewünschten Beitrag.  In diesen neuen Daten gibt es keine Informationen darüber, wie der Benutzer die zwischengespeicherte Version des Beitrags festgelegt hat.  So sieht es aus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fd/f4f/af6/8fdf4faf67a6ac65a830f169ffda3eea.png"></div><br>  <i><font color="#999999">Race-Status, der auftritt, wenn ein Benutzer mit zwischengespeicherten Daten interagiert (Redux-Aktionen werden grün hervorgehoben, Status ist grau)</font></i> <br><br>  Um dieses Problem zu lösen, mussten wir den zwischengespeicherten Status entsprechend den Aktionen des Benutzers ändern und Informationen zu diesen Aktionen speichern, damit wir sie vom Server auf den neuen Status anwenden können.  Wenn Sie jemals Git oder ein anderes Versionskontrollsystem verwendet haben, kommt Ihnen diese Aufgabe möglicherweise bekannt vor.  Angenommen, der zwischengespeicherte Status des Bandes ist der lokale Repository-Zweig, und die Serverantwort mit den neuesten Daten ist der Hauptzweig.  Wenn ja, können wir sagen, dass wir die Verschiebungsoperation ausführen möchten, dh wir möchten die in einem Zweig aufgezeichneten Änderungen (z. B. Likes, Kommentare usw.) übernehmen und auf einen anderen anwenden. <br><br>  Diese Idee führt uns zu folgender Systemarchitektur: <br><br><ul><li>  Wenn die Seite geladen wird, senden wir eine Anfrage an den Server, um neue Daten herunterzuladen (oder warten, bis sie auf Initiative des Servers gesendet werden). </li><li>  Erstellen Sie eine Zwischenstufe (inszeniert) des Redux-Status. </li><li>  Während des Wartens auf Daten vom Server speichern wir die übermittelten Aktionen. </li><li>  Nachdem wir Daten vom Server empfangen haben, führen wir Aktionen mit den neuen Daten aus und spielen die gespeicherten Aktionen für die neuen Daten ab und wenden sie auf den Zwischenzustand an. </li><li>  Danach übernehmen wir die Änderungen und ersetzen den aktuellen Status durch einen Zwischenstatus. </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/071/126/855/0711268557c8b0c303c6ce81fd452dee.png"></div><br>  <i><font color="#999999">Lösen eines Problems, das durch eine Rennbedingung verursacht wurde, unter Verwendung eines Zwischenzustands (Redux-Aktionen werden grün hervorgehoben, Status ist grau)</font></i> <br><br>  Dank des Zwischenzustands können wir alle vorhandenen Reduzierstücke wiederverwenden.  Auf diese Weise können Sie außerdem einen Zwischenstatus (der die neuesten Daten enthält) getrennt vom aktuellen Status speichern.  Und da die Arbeit mit dem Zwischenzustand mit Redux implementiert wird, reicht es aus, Aktionen zu senden, um diesen Zustand zu verwenden! <br><br><h2>  <font color="#3AC1EF">API</font> </h2><br>  Die Zwischenzustands-API besteht aus zwei Hauptfunktionen.  Dies ist <code>stagingAction</code> und <code>stagingCommit</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stagingAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">    key: string,    promise: Promise&lt;Action&gt;, </span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsyncAction</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Action</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stagingCommit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">key: string</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsyncAction</span></span></span><span class="hljs-function">&lt;</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">State</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Action</span></span></span><span class="hljs-function">&gt;</span></span></code> </pre> <br>  Es gibt dort mehrere andere Funktionen, zum Beispiel zum Abbrechen von Änderungen und zum Behandeln von Grenzfällen, aber wir werden sie hier nicht berücksichtigen. <br><br>  Die Funktion <code>stagingAction</code> akzeptiert ein Versprechen, das in ein Ereignis aufgelöst wird, das an einen Zwischenzustand gesendet werden muss.  Diese Funktion initialisiert einen Zwischenzustand und überwacht die Aktionen, die seit ihrer Initialisierung gesendet wurden.  Wenn wir dies mit Versionskontrollsystemen vergleichen, stellt sich heraus, dass es sich um die Erstellung einer lokalen Niederlassung handelt.  Die laufenden Aktionen werden in die Warteschlange gestellt und auf den Zwischenstatus angewendet, nachdem neue Daten eingegangen sind. <br><br>  Die Funktion <code>stagingCommit</code> ersetzt den aktuellen Status durch einen Zwischenstatus.  Wenn erwartet wird, dass einige asynchrone Vorgänge abgeschlossen sind, die in einem Zwischenzustand ausgeführt werden, wartet das System außerdem, bis diese Vorgänge abgeschlossen sind, bevor sie ersetzt werden.  Dies ähnelt dem Verschiebungsvorgang, wenn lokale Änderungen (von dem Zweig, in dem der Cache gespeichert ist) auf den Hauptzweig angewendet werden (zusätzlich zu den vom Server empfangenen neuen Daten), was dazu führt, dass die lokale Version des Status aktuell ist. <br><br>  Um das Arbeitssystem mit einem Zwischenzustand zu ermöglichen, haben wir den Root-Reduzierer in die Extender-Funktionen des Reduzierers eingewickelt.  Es verarbeitet die Aktion <code>stagingCommit</code> und wendet zuvor gespeicherte Aktionen auf den neuen Status an.  Um all dies zu nutzen, müssen wir nur Aktionen senden, und alles andere wird automatisch erledigt.  Wenn wir beispielsweise ein neues Band laden und seine Daten in einen Zwischenzustand versetzen möchten, können wir Folgendes tun: <br><br><pre> <code class="plaintext hljs">function fetchAndStageFeed() {    return stagingAction(        'feed',        (async () =&gt; {            const {data} = await fetchFeedTimeline();            return {                type: FEED_LOADED,                ...data,            };        })(),    ); } //          store.dispatch(fetchAndStageFeed()); //   ,    stagingCommit, //      'feed' //      store.dispatch(stagingCommit('feed'));</code> </pre> <br>  Die Verwendung eines Rendering-Ansatzes für den Feed und die Storys, bei denen der Cache im Vordergrund steht, hat die Materialausgabe um 2,5% bzw. 11% beschleunigt.  Dies trug außerdem dazu bei, dass die Webversion des Systems in der Wahrnehmung der Benutzer den Instagram-Clients für iOS und Android näher kam. <br><br>  <b>Liebe Leser!</b>  Verwenden Sie Ansätze, um das Caching bei der Arbeit an Ihren Projekten zu optimieren? <br><br><div style="text-align:center;"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/webt/-o/2e/tu/-o2etuqogwhmdnmysb9_vivc9v4.png"></a> </div><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472336/">https://habr.com/ru/post/de472336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de472314/index.html">Ich mag Pappleute</a></li>
<li><a href="../de472318/index.html">Verteilte Rückverfolgung in Istio</a></li>
<li><a href="../de472320/index.html">Interview mit Zabbix: 12 offene Antworten</a></li>
<li><a href="../de472326/index.html">Unsere Raumfahrtindustrie ... Und wenn Sie die Probleme der Branche aus der Perspektive eines Geeks betrachten?</a></li>
<li><a href="../de472334/index.html">Leben durch Gutscheine oder wie wir die Arbeit der sozialen Dienste optimieren</a></li>
<li><a href="../de472338/index.html">Wer ist der JavaScript-Killer?</a></li>
<li><a href="../de472340/index.html">Hat GraphQL in der HTTP / 2-Ära an Relevanz verloren?</a></li>
<li><a href="../de472344/index.html">Zwei "Gefährten" oder Bürgerkrieg Phlogiston</a></li>
<li><a href="../de472350/index.html">Wie Methodius zu Anna wurde: die Erfahrung, Sprachnachrichten-Klassifikatoren zu entwickeln und zu starten. Teil 1</a></li>
<li><a href="../de472352/index.html">TechnoText, Folge II. Wir erzählen, wie die Autoren von Habr an Artikeln leben und arbeiten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>