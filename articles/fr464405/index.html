<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÉüèª üöî ‚õ™Ô∏è Python comme cas ultime de C ++. Partie 2/2 üçç üï° ü•í</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä suivre. Commencer en Python comme cas ultime de C ++. Partie 1/2 ". 
 Variables et types de donn√©es 


 Maintenant que nous avons enfin compris les ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Python comme cas ultime de C ++. Partie 2/2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464405/"><p>  √Ä suivre.  Commencer en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Python comme cas ultime de C ++.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partie 1/2</a> ". </p><br><h1>  Variables et types de donn√©es </h1><br><p>  Maintenant que nous avons enfin compris les math√©matiques, d√©cidons quelles variables doivent signifier dans notre langue. </p><br><p>  En C ++, un programmeur a le choix: utiliser des variables automatiques plac√©es sur la pile ou conserver des valeurs dans la m√©moire de donn√©es du programme, en ne pla√ßant que des pointeurs vers ces valeurs sur la pile.  Et si nous choisissons une seule de ces options pour Python? </p><br><p>  Bien s√ªr, nous ne pouvons pas toujours utiliser uniquement les valeurs des variables, car les grandes structures de donn√©es ne tiendront pas sur la pile, ou leur mouvement constant sur la pile cr√©era des probl√®mes de performances.  Par cons√©quent, nous n'utiliserons que des pointeurs en Python.  Cela simplifiera conceptuellement la langue. </p><a name="habracut"></a><br><p>  Donc l'expression </p><br><pre><code class="python hljs">a = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  signifiera que nous avons cr√©√© un objet ¬´3¬ª dans la m√©moire de donn√©es du programme (le soi-disant ¬´tas¬ª) et fait du nom ¬´a¬ª une r√©f√©rence √† lui.  Et l'expression </p><br><pre> <code class="python hljs">b = a</code> </pre> <br><p>  dans ce cas, cela signifie que nous avons forc√© la variable ¬´b¬ª √† faire r√©f√©rence au m√™me objet en m√©moire auquel ¬´a¬ª fait r√©f√©rence, en d'autres termes, nous avons copi√© le pointeur. </p><br><p>  Si tout est un pointeur, combien de types de liste devons-nous impl√©menter dans notre langage?  Bien s√ªr, un seul est une liste de pointeurs!  Vous pouvez l'utiliser pour stocker des entiers, des cha√Ænes, d'autres listes, peu importe - apr√®s tout, ce sont des pointeurs. </p><br><p>  Combien de types de tables de hachage devons-nous impl√©menter?  (En Python, ce type est appel√© "dictionnaire" - <code>dict</code> .) Un!  Laissez-le associer des pointeurs aux cl√©s avec des pointeurs aux valeurs. </p><br><p>  Ainsi, nous n'avons pas besoin d'impl√©menter dans notre langage une grande partie de la sp√©cification C ++ - les mod√®les, car nous effectuons toutes les op√©rations sur les objets, et les objets sont toujours accessibles par pointeur.  Bien s√ªr, les programmes √©crits en Python n'ont pas √† se limiter √† travailler avec des pointeurs: il existe des biblioth√®ques comme NumPy qui aident les scientifiques √† travailler avec des tableaux de donn√©es en m√©moire, comme ils le feraient avec Fortran.  Mais la base du langage - des expressions comme ¬´a = 3¬ª - fonctionne toujours avec des pointeurs. </p><br><p>  Le concept de ¬´tout est un pointeur¬ª simplifie √©galement la composition des types √† la limite.  Vous voulez une liste de dictionnaires?  Il suffit de cr√©er une liste et d'y mettre des dictionnaires!  Vous n'avez pas besoin de demander la permission √† Python, vous n'avez pas besoin de d√©clarer des types suppl√©mentaires, tout fonctionne hors de la bo√Æte. </p><br><p>  Mais que faire si nous voulons utiliser des objets compos√©s comme cl√©s?  La cl√© du dictionnaire doit avoir une valeur immuable, sinon comment rechercher des valeurs par elle?  Les listes sont sujettes √† modification, elles ne peuvent donc pas √™tre utilis√©es √† ce titre.  Pour de telles situations, Python a un type de donn√©es qui, comme une liste, est une s√©quence d'objets, mais, contrairement √† une liste, cette s√©quence ne change pas.  Ce type est appel√© tuple ou <code>tuple</code> (prononc√© ¬´tuple¬ª ou ¬´tuple¬ª). </p><br><p>  Les tuples en Python r√©solvent un probl√®me de langage de script de longue date.  Si vous n'√™tes pas impressionn√© par cette fonctionnalit√©, vous n'avez probablement jamais essay√© d'utiliser des langages de script pour un travail s√©rieux avec les donn√©es, dans lequel vous ne pouvez utiliser que des cha√Ænes ou uniquement des types primitifs comme cl√© dans les tables de hachage. </p><br><p>  Une autre possibilit√© que les tuples nous donnent est de renvoyer plusieurs valeurs d'une fonction sans avoir √† d√©clarer des types de donn√©es suppl√©mentaires pour cela, comme vous devez le faire en C et C ++.  De plus, pour faciliter l'utilisation de cette fonctionnalit√©, l'op√©rateur d'affectation √©tait dot√© de la possibilit√© de d√©compresser automatiquement les tuples dans des variables distinctes. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_address</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> host, port host, port = get_address()</code> </pre> <br><p>  Le d√©ballage a plusieurs effets secondaires utiles, par exemple, l'√©change de valeurs variables peut √™tre √©crit comme suit: </p><br><pre> <code class="python hljs">x, y = y, x</code> </pre> <br><p>  Tout est un pointeur, ce qui signifie que les fonctions et les types de donn√©es peuvent √™tre utilis√©s comme donn√©es.  Si vous connaissez le livre ¬´Design Patterns¬ª des auteurs de ¬´The Gang of Four¬ª, vous devez vous souvenir des m√©thodes complexes et d√©routantes qu'il propose afin de param√©trer le choix du type d'objet cr√©√© par votre programme au moment de l'ex√©cution.  En effet, dans de nombreux langages de programmation, c'est difficile √† faire!  En Python, toutes ces difficult√©s disparaissent, car nous savons qu'une fonction peut renvoyer un type de donn√©es, que les fonctions et les types de donn√©es ne sont que des liens et que les liens peuvent √™tre stock√©s, par exemple, dans des dictionnaires.  Cela simplifie la t√¢che √† la limite. </p><br><p>  David Wheeler a d√©clar√©: "Tous les probl√®mes de programmation sont r√©solus en cr√©ant un niveau suppl√©mentaire d'indirection."  L'utilisation de liens en Python est le niveau d'indirection qui a √©t√© traditionnellement utilis√© pour r√©soudre de nombreux probl√®mes dans de nombreux langages, y compris C ++.  Mais s'il est utilis√© explicitement l√†-bas, ce qui entra√Æne une complication des programmes, alors en Python, il est utilis√© implicitement, uniform√©ment en ce qui concerne les donn√©es de tous types, et est convivial. </p><br><p>  Mais si tout est un lien, √† quoi se r√©f√®rent ces liens?  Les langages comme C ++ ont plusieurs types.  Laissons en Python un seul type de donn√©es - un objet!  Les sp√©cialistes dans le domaine de la th√©orie des types secouent la t√™te de mani√®re d√©sapprobatrice, mais je pense qu'un seul type de donn√©es source, dont d√©rivent tous les autres types dans la langue, est une bonne id√©e qui garantit l'uniformit√© de la langue et sa facilit√© d'utilisation. </p><br><p>  Pour des contenus de m√©moire sp√©cifiques, diverses impl√©mentations Python (PyPy, Jython ou MicroPython) peuvent g√©rer la m√©moire de diff√©rentes mani√®res.  Mais afin de mieux comprendre comment la simplicit√© et l'uniformit√© de Python sont impl√©ment√©es, pour former le mod√®le mental correct, il est pr√©f√©rable de se tourner vers l'impl√©mentation de r√©f√©rence Python en C appel√©e CPython, que nous pouvons t√©l√©charger sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python.org</a> . </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ob_type</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* followed by object's data */</span></span> }</code> </pre> <br><p>  Ce que nous verrons dans le code source CPython est une structure qui se compose d'un pointeur vers des informations sur le type d'une variable donn√©e et une charge utile qui d√©finit la valeur sp√©cifique de la variable. </p><br><p>  Comment fonctionnent les informations de type?  Examinons √† nouveau le code source de CPython. </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> getattrfunc tp_getattr; setattrfunc tp_setattr; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> newfunc tp_new; freefunc tp_free; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> binaryfunc nb_add; binaryfunc nb_subtract; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> richcmpfunc tp_richcompare; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>  Nous voyons des pointeurs vers des fonctions qui fournissent toutes les op√©rations possibles pour un type donn√©: addition, soustraction, comparaison, acc√®s aux attributs, indexation, d√©coupage, etc. Ces op√©rations savent travailler avec la charge utile qui se trouve en m√©moire sous un pointeur pour taper des informations, que ce soit un entier, une cha√Æne ou un objet d'un type cr√©√© par l'utilisateur. </p><br><p>  Ceci est radicalement diff√©rent de C et C ++, dans lequel les informations de type sont associ√©es aux noms et non aux valeurs des variables.  En Python, tous les noms sont associ√©s √† des liens.  La valeur par r√©f√©rence, quant √† elle, est de type.  C'est l'essence m√™me des langages dynamiques. </p><br><p>  Pour r√©aliser toutes les fonctionnalit√©s du langage, il nous suffit de d√©finir deux op√©rations sur les liens.  L'une des plus √©videntes est la copie.  Lorsque nous attribuons une valeur √† une variable, un emplacement dans un dictionnaire ou un attribut d'un objet, nous copions les liens.  Il s'agit d'une op√©ration simple, rapide et totalement s√ªre: la copie de liens ne modifie pas le contenu de l'objet. </p><br><p>  La deuxi√®me op√©ration est un appel de fonction ou de m√©thode.  Comme nous l'avons montr√© ci-dessus, un programme Python ne peut interagir avec la m√©moire qu'√† travers des m√©thodes impl√©ment√©es dans des objets int√©gr√©s.  Par cons√©quent, il ne peut pas provoquer une erreur li√©e √† un acc√®s √† la m√©moire. </p><br><p>  Vous pouvez avoir une question: si toutes les variables contiennent des r√©f√©rences, comment puis-je prot√©ger la valeur d'une variable contre les changements en la transmettant √† la fonction en tant que param√®tre? </p><br><pre> <code class="python hljs">n = <span class="hljs-number"><span class="hljs-number">3</span></span> some_function(n) <span class="hljs-comment"><span class="hljs-comment"># Q: I just passed a pointer! # Could some_function() have changed ‚Äú3‚Äù?</span></span></code> </pre> <br><p>  La r√©ponse est que les types simples en Python sont immuables: ils n'impl√©mentent tout simplement pas la m√©thode responsable de la modification de leur valeur.  L'immuable (immuable) <code>int</code> , <code>float</code> , <code>tuple</code> ou <code>str</code> fournit dans des langages comme "tout est un pointeur" le m√™me effet s√©mantique que les variables automatiques fournissent en C. </p><br><p>  Les types et les m√©thodes unifi√©s simplifient autant que possible l'utilisation de la programmation g√©n√©ralis√©e ou des g√©n√©riques.  Les fonctions <code>min()</code> , <code>max()</code> , <code>sum()</code> et similaires sont int√©gr√©es, il n'est pas n√©cessaire de les importer.  Et ils fonctionnent avec tous les types de donn√©es dans lesquels des op√©rations de comparaison pour <code>min()</code> et <code>max()</code> sont impl√©ment√©es, des ajouts pour <code>sum()</code> , etc. </p><br><h1>  Cr√©er des objets </h1><br><p>  Nous avons d√©couvert en termes g√©n√©raux comment les objets devaient se comporter.  Nous allons maintenant d√©terminer comment nous allons les cr√©er.  C'est une question de syntaxe de langage.  C ++ prend en charge au moins trois fa√ßons de cr√©er un objet: </p><br><ol><li>  Automatique, en d√©clarant une variable de cette classe: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">my_class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg)</span></span></span></span>;</code> </pre> </li><li>  Utilisation du <code>new</code> op√©rateur: <br><pre> <code class="cpp hljs">my_class *c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> my_class(arg);</code> </pre> </li><li>  Factory, en appelant une fonction arbitraire qui retourne un pointeur: <br><pre> <code class="cpp hljs">my_class *c = my_factory(arg);</code> </pre> </li></ol><br><p>  Comme vous l'avez probablement d√©j√† devin√©, apr√®s avoir √©tudi√© la fa√ßon de penser des cr√©ateurs de Python dans les exemples ci-dessus, nous devons maintenant en choisir un. </p><br><p>  Du m√™me livre, The Gangs of Four, nous avons appris qu'une usine est le moyen le plus flexible et universel de cr√©er des objets.  Par cons√©quent, seule cette m√©thode est impl√©ment√©e en Python. </p><br><p>  En plus de l'universalit√©, cette m√©thode est bonne en ce que vous n'avez pas besoin de surcharger le langage avec une syntaxe inutile pour le garantir: un appel de fonction est d√©j√† impl√©ment√© dans notre langage, et une fabrique n'est rien de plus qu'une fonction. </p><br><p>  Une autre r√®gle pour cr√©er des objets en Python est la suivante: tout type de donn√©es est sa propre fabrique.  Bien s√ªr, vous pouvez √©crire n'importe quel nombre d'usines personnalis√©es suppl√©mentaires (qui seront des fonctions ou des m√©thodes ordinaires, bien s√ªr), mais la r√®gle g√©n√©rale restera valide: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Let's make type objects # their own type's factories! c = MyClass() i = int('7') f = float(length) s = str(bytes)</span></span></code> </pre> <br><p>  Tous les types sont appel√©s objets et tous renvoient des valeurs de leur type, d√©termin√©es par les arguments pass√©s dans l'appel. </p><br><p>  Ainsi, en utilisant uniquement la syntaxe de base du langage, toutes les manipulations lors de la cr√©ation d'objets, telles que les mod√®les ¬´Arena¬ª ou ¬´Adaptive¬ª, peuvent √™tre encapsul√©es, car une autre excellente id√©e emprunt√©e au C ++ est que le type lui-m√™me d√©termine comment cela se passe. engendrer ses objets, comment le <code>new</code> op√©rateur travaille pour lui. </p><br><h1>  Et NULL? </h1><br><p>  La gestion d'un pointeur nul ajoute de la complexit√© au programme, nous interdisons donc NULL.  La syntaxe Python rend impossible la cr√©ation d'un pointeur nul.  Deux op√©rations √©l√©mentaires sur les pointeurs, dont nous avons parl√© plus haut, sont d√©finies de telle mani√®re que toute variable pointe vers un objet. </p><br><p>  En cons√©quence, l'utilisateur ne peut pas utiliser Python pour cr√©er une erreur li√©e √† un acc√®s √† la m√©moire, telle qu'une erreur de segmentation ou hors des limites de la m√©moire tampon.  En d'autres termes, les programmes Python ne sont pas affect√©s par les deux types de vuln√©rabilit√©s les plus dangereux qui menacent la s√©curit√© d'Internet au cours des 20 derni√®res ann√©es. </p><br><p>  Vous pouvez demander: ¬´Si la structure des op√©rations sur les objets est inchang√©e, comme nous l'avons vu pr√©c√©demment, alors comment les utilisateurs cr√©eront-ils leurs propres classes, avec des m√©thodes et des attributs non r√©pertori√©s dans cette structure?¬ª </p><br><p>  La magie r√©side dans le fait que pour les classes personnalis√©es Python a une "pr√©paration" tr√®s simple avec un petit nombre de m√©thodes impl√©ment√©es.  Voici les plus importants: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> {</span></span> getattrfunc tr_getattr; setattrfunc tr_setattr; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> newfunc tp_new; <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre> <br><p>  <code>tp_new()</code> cr√©e une table de hachage pour la classe utilisateur, la m√™me que pour le type <code>dict</code> .  <code>tp_getattr()</code> extrait quelque chose de cette table de hachage, et <code>tp_setattr()</code> , au contraire, y met quelque chose.  Ainsi, la capacit√© des classes arbitraires √† stocker des m√©thodes et des attributs n'est pas fournie au niveau des structures du langage C, mais √† un niveau sup√©rieur - une table de hachage.  (Bien s√ªr, √† l'exception de certains cas li√©s √† l'optimisation des performances.) </p><br><h1>  Modificateurs d'acc√®s </h1><br><p>  Que faisons-nous de toutes ces r√®gles et concepts qui sont construits autour de mots-cl√©s C ++ <code>private</code> et <code>protected</code> ?  Python, √©tant un langage de script, n'en a pas besoin.  Nous avons d√©j√† des parties ¬´prot√©g√©es¬ª du langage - ce sont des donn√©es de types int√©gr√©s.  En aucun cas, Python ne permettra √† un programme, par exemple, de manipuler les bits d'un nombre √† virgule flottante!  Ce niveau d'encapsulation est suffisant pour maintenir l'int√©grit√© de la langue elle-m√™me.  Nous, les cr√©ateurs de Python, pensons que l'int√©grit√© du langage est le seul bon pr√©texte pour cacher des informations.  Toutes les autres structures et donn√©es de programme utilisateur sont consid√©r√©es comme publiques. </p><br><p>  Vous pouvez √©crire un trait de soulignement ( <code>_</code> ) au d√©but d'un nom d'attribut de classe pour avertir un coll√®gue: vous ne devez pas vous fier √† cet attribut.  Mais le reste de Python a appris les le√ßons du d√©but des ann√©es 90: alors beaucoup pensaient que la principale raison pour laquelle nous √©crivons des programmes gonfl√©s, illisibles et bogu√©s est le manque de variables priv√©es.  Je pense que les 20 prochaines ann√©es ont convaincu tout le monde dans l'industrie de la programmation: les variables priv√©es ne sont pas les seules, et loin d'√™tre le rem√®de le plus efficace pour les programmes gonfl√©s et bogu√©s.  Par cons√©quent, les cr√©ateurs de Python ont d√©cid√© de ne m√™me pas se soucier des variables priv√©es et, comme vous pouvez le voir, elles n'ont pas √©chou√©. </p><br><h1>  Gestion de la m√©moire </h1><br><p>  Qu'advient-il de nos objets, nombres et cha√Ænes √† un niveau inf√©rieur?  Comment sont-ils stock√©s en m√©moire exactement, comment CPython leur fournit-il un acc√®s partag√©, quand et dans quelles conditions sont-ils d√©truits? </p><br><p>  Et dans ce cas, nous avons choisi la fa√ßon la plus g√©n√©rale, pr√©visible et productive de travailler avec la m√©moire: du c√¥t√© du programme C, tous nos objets sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des pointeurs partag√©s</a> . </p><br><p>  Compte tenu de ces connaissances, les structures de donn√©es que nous avons examin√©es pr√©c√©demment dans la section ¬´Variables et types de donn√©es¬ª devraient √™tre compl√©t√©es comme suit: </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> Py_ssize_t ob_refcnt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typeobject</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ob_type</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* followed by object's data */</span></span> } }</code> </pre> <br><p>  Ainsi, chaque objet en Python (nous entendons l'impl√©mentation de CPython, bien s√ªr) a son propre compteur de r√©f√©rence.  Une fois qu'il devient nul, l'objet peut √™tre supprim√©. </p><br><p>  Le m√©canisme de comptage de liens ne repose pas sur des calculs ou des processus d'arri√®re-plan suppl√©mentaires - un objet peut √™tre d√©truit instantan√©ment.  De plus, il fournit une localisation √©lev√©e des donn√©es: souvent, la m√©moire recommence √† √™tre utilis√©e imm√©diatement apr√®s avoir √©t√© lib√©r√©e.  L'objet qui vient d'√™tre d√©truit a probablement √©t√© utilis√© r√©cemment, ce qui signifie qu'il se trouvait dans le cache du processeur.  Par cons√©quent, l'objet nouvellement cr√©√© restera dans le cache.  Ces deux facteurs - simplicit√© et localit√© - font du comptage de liens un moyen tr√®s productif de collecte des ordures. </p><br><p>  (En raison du fait que les objets dans les programmes r√©els se r√©f√®rent souvent les uns aux autres, le compteur de r√©f√©rence ne peut pas, dans certains cas, tomber √† z√©ro m√™me lorsque les objets ne sont plus utilis√©s dans le programme. Par cons√©quent, CPython dispose √©galement d'un deuxi√®me m√©canisme de r√©cup√©ration de place - un arri√®re-plan, bas√© sur sur des g√©n√©rations d'objets - <em>environ transl.</em> ) </p><br><h1>  Erreurs de d√©veloppeur Python </h1><br><p>  Nous avons essay√© de d√©velopper un langage qui serait assez simple pour les d√©butants, mais aussi assez attractif pour les professionnels.  Dans le m√™me temps, nous n'avons pas pu √©viter les erreurs de compr√©hension et d'utilisation des outils que nous avons nous-m√™mes cr√©√©s. </p><br><p>  Python 2, en raison de l'inertie de la pens√©e associ√©e aux langages de script, a essay√© de convertir les types de cha√Ænes, comme le ferait un langage avec un typage faible.  Si vous essayez de combiner une cha√Æne d'octets avec une cha√Æne en Unicode, l'interpr√©teur convertit implicitement la cha√Æne d'octets en Unicode √† l'aide de la table de code disponible sur le syst√®me et pr√©sente le r√©sultat en Unicode: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">'byte string '</span></span> + <span class="hljs-string"><span class="hljs-string">u'unicode string'</span></span> <span class="hljs-string"><span class="hljs-string">u'byte string unicode string'</span></span></code> </pre> <br><p>  En cons√©quence, certains sites Web ont tr√®s bien fonctionn√© lorsque leurs utilisateurs utilisaient l'anglais, mais ils ont produit des erreurs cryptiques lors de l'utilisation de caract√®res d'autres alphabets. </p><br><p>  Ce bug de conception de langage a √©t√© corrig√© dans Python 3: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-string"><span class="hljs-string">b'byte string '</span></span> + <span class="hljs-string"><span class="hljs-string">u'unicode string'</span></span> TypeError: can<span class="hljs-string"><span class="hljs-string">'t concat bytes to str</span></span></code> </pre> <br><p>  Une erreur similaire dans Python 2 √©tait li√©e au tri ¬´na√Øf¬ª des listes constitu√©es d'√©l√©ments incomparables: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sorted([<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]) [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-string"><span class="hljs-string">'b'</span></span>]</code> </pre> <br><p>  Dans ce cas, Python 3 indique clairement √† l'utilisateur qu'il essaie de faire quelque chose de peu significatif: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sorted([<span class="hljs-string"><span class="hljs-string">'b'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'a'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>]) TypeError: unorderable types: int() &lt; str()</code> </pre> <br><h1>  Abus </h1><br><p>  Les utilisateurs abusent parfois de la nature dynamique du langage Python, puis, dans les ann√©es 90, lorsque les meilleures pratiques n'√©taient pas encore largement connues, cela arrivait particuli√®rement souvent: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, host, port)</span></span></span><span class="hljs-function">:</span></span> self.host = host self.port = port</code> </pre> <br><p>  "Mais ce n'est pas optimal!"  - Certains ont dit: - ¬´Et si le port ne diff√®re pas de la valeur par d√©faut?  Quoi qu'il en soit, nous d√©pensons un attribut de classe entier sur son stockage! ¬ª  Et le r√©sultat est quelque chose comme </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, host, port=None)</span></span></span><span class="hljs-function">:</span></span> self.host = host <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> port <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-comment"><span class="hljs-comment"># so terrible self.port = port</span></span></code> </pre> <br><p>  Ainsi, des objets du m√™me type apparaissent dans le programme, qui ne peuvent cependant pas √™tre exploit√©s de mani√®re uniforme, car certains ont un certain attribut, d'autres pas!  Et nous ne pouvons pas toucher cet attribut sans v√©rifier sa pr√©sence √† l'avance: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># code was forced to use introspection # (terrible!) if hasattr(addr, 'port'): print(addr.port)</span></span></code> </pre> <br><p>  Actuellement, l'abondance de <code>hasattr()</code> , <code>isinstance()</code> et d'autres introspections est un signe certain de mauvais code, et il est consid√©r√© comme la meilleure pratique de rendre les attributs toujours pr√©sents dans l'objet.  Cela fournit une syntaxe plus simple lors de l'acc√®s: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># today's best practice: # every atribute always present if addr.port is not None: print(addr.port)</span></span></code> </pre> <br><p>  Ainsi, les premi√®res exp√©riences avec des attributs ajout√©s et supprim√©s dynamiquement se sont termin√©es, et maintenant nous regardons les classes en Python de la m√™me mani√®re qu'en C ++. </p><br><p>  Une autre mauvaise habitude du d√©but de Python √©tait l'utilisation de fonctions dans lesquelles un argument peut avoir des types compl√®tement diff√©rents.  Par exemple, vous pourriez penser qu'il pourrait √™tre trop difficile pour l'utilisateur de cr√©er une liste de noms de colonnes √† chaque fois, et vous devriez lui permettre de les passer √©galement sur une seule ligne, o√π les noms des colonnes individuelles sont s√©par√©s, disons, par une virgule: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Dataframe</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, columns)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(columns, str): columns = columns.split(<span class="hljs-string"><span class="hljs-string">','</span></span>) self.columns = columns</code> </pre> <br><p>  Mais cette approche peut donner lieu √† des probl√®mes.  Par exemple, que se passe-t-il si un utilisateur nous donne accidentellement une ligne qui n'est pas destin√©e √† √™tre utilis√©e comme une liste de noms de colonnes?  Ou si le nom de la colonne doit contenir une virgule? </p><br><p>  De plus, un tel code est plus difficile √† maintenir, √† d√©boguer et surtout √† tester: dans les tests, il peut √™tre possible de v√©rifier uniquement l'un des deux types que nous prenons en charge, mais la couverture sera toujours de 100% et nous ne testerons pas l'autre type. </p><br><p>  En cons√©quence, nous sommes arriv√©s √† la conclusion que Python permet √† l'utilisateur de passer des arguments de n'importe quel type √† des fonctions, mais la plupart d'entre eux dans la plupart des situations utiliseront une fonction de la m√™me mani√®re qu'en C: lui passer un argument du m√™me type. </p><br><p>  La n√©cessit√© d'utiliser <code>eval()</code> dans un programme est consid√©r√©e comme un mauvais calcul architectural explicite.  Tr√®s probablement, vous n'avez tout simplement pas compris comment faire la m√™me chose d'une mani√®re normale.     ‚àí ,      Jupyter notebook  -       ‚àí  <code>eval()</code>  ,      Python   ! ,     C++    . </p><br><p>     ,  ( <code>getattr()</code> , <code>hasattr()</code> , <code>isinstance()</code> )          .   ,   ,   ,      ,       : , ,  , ! </p><br><h1>   </h1><br><p>      :     ,           . 20             ,   C++  Python.   ,     ,    .         . </p><br><p>        ,    <code>shared_ptr</code>  TensorFlow   2016  2018 . </p><br><p> TensorFlow ‚àí       C++-,         Python- ( C++ ‚àí     TensorFlow, ). </p><br><p><img src="https://habrastorage.org/webt/dm/1g/zo/dm1gzovjtl2qbda7muz5wjzzjhq.png" alt="image"></p><br><p>         TensorFlow,  <code>shared_ptr</code> ,     .     ,     . </p><br><p>      C++?       .    ,   ?     ,     ,  C++  Python! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr464405/">https://habr.com/ru/post/fr464405/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr464391/index.html">10 rapports int√©ressants de conf√©rences de hackers</a></li>
<li><a href="../fr464393/index.html">Comment trouver des cours de programmation et quelles sont les garanties d'emploi</a></li>
<li><a href="../fr464395/index.html">Al√©atoire bas√© sur RSA Blockchain</a></li>
<li><a href="../fr464399/index.html">Web scraping in R, Part 2. Acc√©l√©rer le processus avec le calcul parall√®le et l'utilisation du package Rcrawler</a></li>
<li><a href="../fr464403/index.html">Comment ex√©cuter un projet Java sur un ex√©cuteur de shell lors de la transmission √† un r√©f√©rentiel GitLab</a></li>
<li><a href="../fr464407/index.html">Fonctionnement des plus grands syst√®mes de vid√©osurveillance au monde</a></li>
<li><a href="../fr464409/index.html">Comment la politique du 19e si√®cle a affect√© les emplacements des centres de donn√©es aujourd'hui</a></li>
<li><a href="../fr464411/index.html">PVS-Studio: moteur de progr√®s</a></li>
<li><a href="../fr464413/index.html">PVS-Studio - moteur de progr√®s</a></li>
<li><a href="../fr464415/index.html">Nouveau service d'indices pour rechercher hh.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>