<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçø ‚ò∫Ô∏è ü¶Ä Nous √©crivons le chargeur FPGA dans LabVIEW. Partie 1 üßò üßìüèø üï∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La plupart des programmeurs "normaux", pour le moins, ont une attitude ambigu√´ envers la technologie LabVIEW . Ici, vous pouvez argumenter longtemps e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nous √©crivons le chargeur FPGA dans LabVIEW. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427529/"><img src="https://habrastorage.org/webt/2m/nu/6l/2mnu6ljkhtj-pydr_chsebgpp_i.jpeg"><br><p><br>  La plupart des programmeurs "normaux", pour le moins, ont une attitude ambigu√´ envers la technologie <strong>LabVIEW</strong> .  Ici, vous pouvez argumenter longtemps et en vain.  La situation est aggrav√©e par le fait qu'il existe de nombreux exemples de programmes LabVIEW sur le r√©seau, mais ils sont tous orient√©s vers un d√©butant et se r√©sument √† ¬´oh, regardez comme c'est simple, connectez la torsion √† l'indicateur, tournez le bouton, les changements de chiffres¬ª, ou au mieux, au graphique du cycle un nombre al√©atoire ou sinus est affich√©, tout cela est accompagn√© d'une interface furieuse sous la forme de commutateurs √† bascule g√©ants, de boutons rotatifs et d'indicateurs de cadran.  Personnellement, cette approche de simplification consciente m'agace.  Dans une courte s√©rie d'articles, j'essaierai de pr√©senter au lecteur le processus de d√©veloppement de logiciels d'application chez LabVIEW.  Afin de ne pas consacrer beaucoup de temps au sujet, nous utiliserons l'algorithme d√©taill√© pour t√©l√©charger le fichier de configuration sur le FPGA via FTDI en mode MPSSE ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">T√©l√©chargement de la configuration sur le FPGA via USB ou d√©montage FTDI MPSSE</a> ).  Dans cet article, je montrerai comment impl√©menter le m√™me chargeur FPGA, mais en langage LabVIEW. </p><a name="habracut"></a><br><p>  Comme mentionn√© ci-dessus, l'algorithme de chargement FPGA en mode Serial Passive (SP) et le principe de fonctionnement FTDI sont bien d√©crits dans l'article pr√©c√©dent.  Je ne vais pas me r√©p√©ter.  Nous pensons que l'algorithme est test√© et reconnu comme apte.  Et oui, supposons que le lecteur soit au moins superficiellement familier avec le concept LabVIEW et qu'il connaisse bien la programmation classique. </p><br><p>  Bien que le processus de cr√©ation d'un chargeur de d√©marrage ne prenne pas beaucoup de temps, la description du processus n'a pas r√©ussi √† tenir dans le volume d'un article, il y aura donc une petite s√©rie.  √âtant donn√© que la phase d'exp√©rimentation est d√©j√† termin√©e et que je suis confiant dans l'op√©rabilit√© de l'algorithme, je vais me permettre de commencer le d√©veloppement √† partir de l'interface utilisateur.  Dans le premier article, nous allons cr√©er l'interface utilisateur du chargeur et impl√©menter la structure du programme.  Dans la seconde - via la dll du pilote FTDI, nous impl√©mentons le chargement du fichier * .rbf dans le FPGA. </p><br><p>  Pour la productivit√© de la conversation, il n'est pas superflu de rappeler la terminologie adopt√©e dans LabVIEW.  Dans LabVIEW, le programme d'application est appel√© Instrument virtuel, √©galement connu sous le nom de VI, √©galement appel√© Instrument virtuel ou VI pour faire court.  Le VP a deux ¬´c√¥t√©s¬ª: le panneau avant, o√π se trouvent les commandes et les indicateurs, et le sch√©ma fonctionnel (sch√©ma fonctionnel), o√π ces √©l√©ments sont interconnect√©s et les fonctions et les flux de traitement des donn√©es sont mis en ≈ìuvre.  En r√®gle g√©n√©rale, un VP a une structure hi√©rarchique; tous les VP d'un VP de niveau sup√©rieur sont g√©n√©ralement appel√©s un sous-appareil ou un sous-VI. </p><br><h2 id="interfeys-polzovatelya">  Interface utilisateur </h2><br><p>  Notre application devrait charger le fichier de configuration dans le FPGA.  Dans le m√™me temps, nous voulons dire que plusieurs FTDI peuvent √™tre connect√©s √† un ordinateur en m√™me temps, et certains d'entre eux peuvent potentiellement √™tre utilis√©s pour configurer des FPGA.  Je sugg√®re de faire un choix de p√©riph√©rique dans la liste d√©roulante, en s√©lectionnant un fichier via un bouton avec une sortie de chemin.  Pour d√©marrer le t√©l√©chargement, ajoutez le bouton "programme".  Une LED virtuelle indiquera l'√©tat de l'op√©ration.  Lancez LabVIEW. </p><br><p>  Ajoutez les √©l√©ments requis au panneau avant (panneau avant).  J'utiliserai le style "Silver" pour le VP.  La figure ci-dessous montre le r√©sultat, tous les √©l√©ments dans leur √©tat d'origine.  Par nom, si n√©cessaire, ils sont assez faciles √† trouver dans la palette. </p><br><img src="https://habrastorage.org/webt/qq/os/bt/qqosbtkepb8n5fe2l3_qnz309q8.png"><br><p><br>  Nous √©ditons des √©l√©ments: nous transf√©rons, √©tirons, nous ajoutons des inscriptions - nous apportons au formulaire requis.  Ici, en fait, la main du concepteur est requise, mais comme j'ai pu: </p><br><img src="https://habrastorage.org/webt/wd/sp/iz/wdspizcngovsuygvcmkofpnepjw.png"><br><p><br>  Et le diagramme: </p><br><img src="https://habrastorage.org/webt/l0/g_/hi/l0g_hij_xwkzm3n-sfrqe6pfypg.png"><br><p><br>  J'attire votre attention.  Chaque √©l√©ment a deux propri√©t√©s qui d√©terminent le nom - Label et l√©gende. </p><br><img src="https://habrastorage.org/webt/pi/xi/r9/pixir9kcyslk2iscflmbtfxtpmq.png"><br><p><br>  La premi√®re propri√©t√© d√©finit le nom de l'√©l√©ment, sous ce nom, il sera affich√© sur le diagramme.  L'√©tiquette, contrairement √† Caption, ne peut pas √™tre modifi√©e pendant l'ex√©cution du VI.  En relation avec cette fonctionnalit√©, je vous recommande de masquer l'√©tiquette dans vos VIs sur le panneau avant et d'afficher la l√©gende.  Pour Label, trouvez un nom significatif, sous forme de variable dans un langage de programmation classique, de pr√©f√©rence dans une disposition latine.  Pour Caption, nous allons introduire un nom √† caract√®re humain, il peut √™tre assez long, inclure des espaces et, si n√©cessaire, en russe.  En utilisant LabVIEW, vous pouvez personnaliser la police d'affichage de la l√©gende.  Je dois dire que personne ne nous oblige √† jouer avec Caption: toute inscription peut √™tre faite directement sur <abbr title="Face avant">FP</abbr> dans n'importe quel endroit libre. </p><br><p> Nous impl√©mentons l'op√©ration VP selon le sch√©ma classique: Boucle While et gestionnaire d'√©v√©nements.  Ajoutez une boucle <code>While</code> (Programmation -&gt; Structures -&gt; Boucle While) au diagramme et une structure de gestionnaire d'√©v√©nements (Programmation -&gt; Structures -&gt; Structure d'√©v√©nement). </p><br><div class="spoiler">  <b class="spoiler_title">Aide succincte sur la structure des √©v√©nements</b> <div class="spoiler_text"><p>  La structure attend que l'√©v√©nement se produise, puis le gestionnaire correspondant s'ex√©cute.  La structure des √©v√©nements a un ou plusieurs sous-diagrammes - des gestionnaires d'√©v√©nements, les soi-disant cas, dont l'un est ex√©cut√© lorsqu'un √©v√©nement se produit.  √Ä l'aide du terminal dans le coin sup√©rieur gauche, vous pouvez sp√©cifier le nombre de millisecondes pendant lesquelles la structure attend un √©v√©nement.  Si pendant ce temps aucun √©v√©nement ne s'est produit, le sous-diagramme ¬´Timeout¬ª sera ex√©cut√©.  La valeur par d√©faut est moins 1, ce qui signifie que le d√©lai d'expiration n'expire jamais. </p><br><img src="https://habrastorage.org/webt/ol/qj/uo/olqjuooy0reae8un_fyw5bs2l78.png"><br><br><ol><li>  L'√©tiquette de s√©lection d'√©v√©nement indique les √©v√©nements qui d√©clenchent le cas actuel.  Pour afficher d'autres gestionnaires, vous pouvez cliquer sur la fl√®che vers le bas √† c√¥t√© du nom de l'√©v√©nement. </li><li>  Le terminal de <code>timeout</code> d√©finit le nombre de millisecondes √† attendre pour un √©v√©nement.  Si la valeur est diff√©rente de -1, le sous-diagramme Timeout doit √™tre impl√©ment√©. </li><li>  Un terminal pour saisir des √©v√©nements dynamiques.  Ce terminal n'est pas affich√© par d√©faut.  Pour l'afficher, s√©lectionnez "Afficher les terminaux d'√©v√©nements dynamiques" dans le menu contextuel. </li><li>  Noeud de donn√©es d'√©v√©nement.  Lorsqu'un √©v√©nement se produit, LabVIEW g√©n√®re des donn√©es associ√©es √† cet √©v√©nement.  Ce n≈ìud fournit ces donn√©es au gestionnaire.  Vous pouvez utiliser la souris pour redimensionner le n≈ìud verticalement et s√©lectionner les √©l√©ments n√©cessaires.  Certaines donn√©es, telles que <code>Type</code> et <code>Time</code> , sont communes √† tous les √©v√©nements, d'autres, telles que <code>Char</code> et <code>VKey</code> , d√©pendent du type d'√©v√©nement configur√©. </li><li>  Le n≈ìud de filtre d'√©v√©nements d√©finit les donn√©es d'√©v√©nements que vous pouvez modifier avant que l'interface utilisateur traite ces donn√©es.  Ce n≈ìud est affich√© uniquement dans les gestionnaires dans lesquels le filtrage est disponible.  Vous pouvez connecter et modifier des √©l√©ments du n≈ìud de donn√©es d'√©v√©nement au n≈ìud de filtre d'√©v√©nement.  Vous pouvez √©galement modifier ces √©v√©nements en connectant les nouvelles valeurs aux terminaux du n≈ìud.  Puis-je annuler compl√®tement la r√©action de l'interface √† l'√©v√©nement si je soumets <code>true</code> au terminal <code>Discard?</code>  .  Si vous ne connectez pas la valeur √† l'√©l√©ment de filtre, cet √©l√©ment de donn√©es reste inchang√©. </li><li>  Comme la structure <code>Case</code> , la structure d'√©v√©nement prend en charge les tunnels.  Si vous ajoutez un tunnel dans un cas, il sera automatiquement cr√©√© pour chaque gestionnaire.  Cependant, par d√©faut, il n'est pas n√©cessaire de connecter les tunnels de sortie de la structure d'√©v√©nements dans chaque gestionnaire.  Tous les tunnels non connect√©s utilisent la valeur par d√©faut pour le type de donn√©es de tunnel.  Cela peut potentiellement conduire √† des erreurs difficiles √† d√©tecter.  Vous pouvez renvoyer le mode dans lequel le tunnel doit √™tre c√¢bl√© dans tous les gestionnaires, pour cela, s√©lectionnez "Utiliser par d√©faut si non c√¢bl√©" dans le menu contextuel. </li></ol></div></div><br><p>  Tout d'abord, nous nous occuperons de la fin du cycle et de la sortie du programme.  La fa√ßon la plus simple est d'ajouter un bouton d'arr√™t, ce qui arr√™tera le cycle, mais, √† mon avis, il est habituel de terminer le programme avec une croix rouge dans le coin sup√©rieur de la fen√™tre. <br>  Ajoutez le gestionnaire appropri√© √† la <code>Event Structure</code> .  Dans le menu contextuel, s√©lectionnez "Ajouter un cas d'√©v√©nement".  Comme source de l'√©v√©nement, s√©lectionnez "Ce VI", l'√©v√©nement indique "Panel Close?" </p><br><div class="spoiler">  <b class="spoiler_title">Modifier les √©v√©nements</b> <div class="spoiler_text"><p> <a href=""><img src="https://habrastorage.org/webt/bt/xo/qv/btxoqvdb2l67eohk78xrvwnhgcg.png"></a> <br>  <em>Image cliquable</em> </p></div></div><br><p>  Veuillez noter que si vous s√©lectionnez "Panel Close" (sans question), cet √©v√©nement est sans filtre, il ne peut pas √™tre annul√©.  Et si avec une question, alors lorsque vous cliquez sur la croix, nous pouvons prendre le contr√¥le et terminer correctement et ind√©pendamment le programme.  Dans le "Panel Close?"  √† travers le tunnel, nous connectons la constante bool√©enne <code>true</code> avec le terminal pour arr√™ter la <code>while</code> .  Saisissez "Ignorer?"  servent √©galement <code>true</code> . </p><br><p>  Maintenant, il n'y a pas de nuance √©vidente: si le VI actuel est lanc√© non pas dans l'environnement LabVIEW, mais sous la forme d'une application compil√©e, cliquer sur la croix ne ferme pas la fen√™tre, mais arr√™te l'application, dont nous n'avons pas besoin.  Pour r√©soudre ce probl√®me, apr√®s l'ach√®vement du cycle principal, nous v√©rifierons si nous sommes dans l'environnement de d√©veloppement ou en mode programme, si nous sommes toujours en mode programme, puis nous mettrons fin √† l'application.  Afin de comprendre o√π le VI actuel s'ex√©cute, utilisez le n≈ìud de propri√©t√© (Programmation -&gt; Contr√¥le d'application -&gt; N≈ìud de propri√©t√©).  Ce n≈ìud permet d'acc√©der aux propri√©t√©s d'un objet par r√©f√©rence √† cet objet.  Dans ce cas, nous devrions obtenir un lien vers l'ensemble de l'application dans son ensemble.  S√©lectionnez la constante <code>VI Server Reference</code> dans la m√™me palette.  Une fois la constante d√©finie sur le diagramme, vous devez changer son type en <code>This Application</code> (bouton gauche de la souris).  Nous connectons le lien r√©sultant avec le n≈ìud de propri√©t√©.  S√©lectionnez la propri√©t√© <code>Application:Kind Property</code> - renvoie le type du syst√®me LabVIEW dans lequel le VI actuel s'ex√©cute.  Nous connectons la sortie de la propri√©t√© √† la structure de cas, ajoutons le cas "Run Time System", o√π nous terminons l'application ( <code>Quit LabVIEW</code> ).  Pour que ce bloc soit ex√©cut√© apr√®s le cycle, et non avant, nous connectons l' <code>error in</code> borne d'entr√©e au cycle √† travers le tunnel. </p><br><p> <a href=""><img width="720" src="https://habrastorage.org/webt/il/nm/ty/ilnmtyv89c3yv-nogcksavitbnu.png"></a> <br>  <em>Image cliquable</em> </p><br><p>  Maintenant, lorsque vous d√©marrez le programme, vous pouvez l'arr√™ter en cliquant sur la croix de la fen√™tre.  Le programme lanc√© ressemble √† ceci: </p><br><img src="https://habrastorage.org/webt/pv/9e/za/pv9ezax9jrro78shza6coogtu_4.png"><br><p><br>  √Ä mon avis, beaucoup de superflu.  Allez dans les propri√©t√©s du VI (menu Fichier -&gt; Propri√©t√©s du VI), s√©lectionnez la cat√©gorie "Apparence de la fen√™tre", d√©finissez Personnalis√©. </p><br><p>  D√©sactivez l'affichage du menu (il reste en mode √©dition), d√©sactivez la barre de d√©filement, masquez la barre d'outils lorsque l'application est en cours d'ex√©cution (Afficher la barre d'outils lors de l'ex√©cution).  Nous interdisons le redimensionnement de la fen√™tre, nous permettons de minimiser et de minimiser la fen√™tre.  C'est mieux: </p><br><img src="https://habrastorage.org/webt/a9/mg/u-/a9mgu-7km4wqkzj_rgdmc4mgfse.png"><br><p><br>  Bien s√ªr, cela vaudrait la peine de supprimer l'inscription "National Instruments. Logiciel d'√©valuation LabVIEW", mais je ne veux pas encore acheter une licence pour un ordinateur personnel, nous allons accepter l'inscription et g√©rer la p√©riode d'essai de 45 jours. </p><br><p>  Naturellement, vous pouvez ajuster la couleur d'arri√®re-plan et chaque √©l√©ment, choisir des polices, mais je ne suis pas designer, mais quelque chose me dit que je ne ferai qu'empirer les choses. </p><br><h2 id="spisok-priborov">  Liste des instruments </h2><br><p>  Le VP doit proposer √† l'utilisateur une liste des p√©riph√©riques connect√©s √† l'ordinateur qui conviennent au micrologiciel FPGA afin que l'utilisateur puisse s√©lectionner celui qui lui convient.  Dans la biblioth√®que FTD2XX, les fonctions <code>FT_CreateDeviceInfoList</code> et <code>FT_GetDeviceInfoDetail</code> sont pr√©vues √† cet effet.  Comme indiqu√© dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> , les biblioth√®ques de pilotes peuvent √™tre utilis√©es pour utiliser l'API FTD2XX.  LabVIEW dispose d'un m√©canisme pratique pour interagir avec les biblioth√®ques dynamiques - le n≈ìud Appeler le n≈ìud de fonction de biblioth√®que, vous pouvez le trouver dans la palette "Connectivit√© -&gt; Biblioth√®ques et ex√©cutables".  Le n≈ìud d'appel de fonction doit √™tre configur√©: tout d'abord, sp√©cifiez le chemin d'acc√®s √† la DLL (l'onglet "Fonction"), apr√®s quoi le syst√®me analyse la biblioth√®que et propose de s√©lectionner le nom de la fonction dans la liste "Nom de la fonction" - s√©lectionnez <code>FT_CreateDeviceInfoList</code> , convention d'appel - s√©lectionnez <strong>stdcall (WINAPI)</strong> .  Deuxi√®mement, dans l'onglet "Param√®tres", vous devez entrer une liste de param√®tres de fonction, o√π le premier √©l√©ment de la liste est la valeur de retour.  Ici, il serait bon de garder √† l'esprit la documentation de l'API ou le fichier d'en-t√™te.  Lorsque vous d√©finissez des param√®tres dans la zone "Prototype de fonction", le prototype de la fonction import√©e s'affiche.  Lorsque la signature de la documentation correspond au prototype configur√©, cliquez sur OK. </p><br><p>  Supposons que l'analyse doit √™tre effectu√©e une fois par seconde.  Nous pla√ßons le n≈ìud d'appel dans la structure du gestionnaire d'√©v√©nements sur l'onglet "Timeout", d√©finissons le temps d'attente √† 1000 ms.  Nous ajoutons des indicateurs aux broches du n≈ìud, et si tout est fait correctement, alors au d√©marrage du VI, le nombre d'appareils connect√©s avec FTDI devrait √™tre affich√©: </p><br><div class="spoiler">  <b class="spoiler_title">Panneau avant et sch√©ma fonctionnel</b> <div class="spoiler_text"><p> <a href=""><img width="720" src="https://habrastorage.org/webt/sc/pg/fr/scpgfrpwkg3gi5hepnez6b8l_nc.png"></a> <br>  <em>Image cliquable</em> </p><br><img src="https://habrastorage.org/webt/v7/cy/fu/v7cyfuon36rdj3wxlwoaotzt_2c.png"></div></div><br><p>  De m√™me, cr√©ez un n≈ìud pour la fonction <code>FT_GetDeviceInfoDetail</code> .  Le prototype de la fonction est: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">FTD2XX_API FT_STATUS WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FT_GetDeviceInfoDetail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( DWORD dwIndex, LPDWORD lpdwFlags, LPDWORD lpdwType, LPDWORD lpdwID, LPDWORD lpdwLocId, LPVOID lpSerialNumber, LPVOID lpDescription, FT_HAN</span></span></span></span></code> </pre> <br><p>  Lors de la description des param√®tres, il convient de noter que <code>lpdwFlags</code> , <code>lpdwType</code> , <code>lpdwID</code> , <code>lpdwLocId</code> sont pass√©s en tant que pointeurs vers <code>uint32</code> .  Les param√®tres <code>lpSerialNumber</code> et <code>lpDescription</code> sont l'essence des cha√Ænes d'octets (tableaux de caract√®res avec un terminateur nul).  Les param√®tres de ce type dans le n≈ìud d'appel peuvent √™tre d√©cor√©s de diff√©rentes mani√®res, vous pouvez les entrer dans un tableau de mots de 8 bits, mais je pense qu'il est plus pratique d'indiquer imm√©diatement qu'il s'agit d'une cha√Æne et de d√©finir la taille attendue.  Dans ce cas, la sortie sera imm√©diatement une ligne ¬´labyrinthe¬ª valide et aucune transformation suppl√©mentaire ne sera requise. </p><br><img src="https://habrastorage.org/webt/zi/n8/8t/zin88t8hl5je5csuxcq7l_bbk9c.png"><br><p>  Fonction de biblioth√®que d'appels </p><br><p>  Cette fonction renvoie des informations par le <code>dwIndex</code> s√©rie <code>dwIndex</code> .  Si plusieurs FTDI sont connect√©s √† l'ordinateur, pour lire les informations de chaque convertisseur, la fonction doit √™tre appel√©e en boucle.  Le nombre d'it√©rations de la boucle nous sera donn√© par la fonction pr√©c√©dente <code>FT_CreateDeviceInfoList</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Panneau avant et sch√©ma fonctionnel</b> <div class="spoiler_text"><p> <a href=""><img width="720" src="https://habrastorage.org/webt/sr/2a/gq/sr2agqtusiwcn3tcttwqbncllgk.png"></a> <br>  <em>Image cliquable</em> </p><br><img src="https://habrastorage.org/webt/t9/dg/tl/t9dgtlw3lapeklhbi4y3tzca0lm.png"></div></div><br><p>  Il y a une caract√©ristique d√©sagr√©able: tous les ports du n≈ìud d'appel doivent √™tre connect√©s au moins d'un c√¥t√©.  Par cons√©quent, un tunnel est cr√©√© dans la boucle pour les terminaux de sortie que nous n'allons pas utiliser. </p><br><p>  <code>Types</code> tableau de <code>Types</code> contient des types de puce FTDI, nous en avons besoin afin de limiter le choix √† ceux qui prennent en charge MPSSE et peuvent potentiellement √™tre utilis√©s pour la programmation FPGA.  Cependant, fonctionner avec des "nombres magiques" n'est pas pratique - je propose d'organiser les types FTDI sous forme d' <code>enum</code> .  De plus, une telle <code>enum</code> d√©j√† dans le fichier d'en-t√™te ftd2xx.h.  Dans LabVIEW, vous pouvez utiliser deux contr√¥les pour cr√©er une √©num√©ration: l'anneau de texte et l'√©num√©ration elle-m√™me.  Les deux contiennent des listes de cha√Ænes avec des valeurs num√©riques entre lesquelles vous pouvez basculer.  La principale diff√©rence est que "Enum" n√©cessite que les valeurs num√©riques soient des nombres entiers cons√©cutifs, tandis que "Text Ring" a plus de libert√© - vous pouvez sp√©cifier n'importe quelle valeur. </p><br><div class="spoiler">  <b class="spoiler_title">Enum.</b>  <b class="spoiler_title">La cr√©ation</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v9/ye/ik/v9yeik6iwgvetbpoa2wcf9b0kn8.png"><br><p>  <em>Nous entrons manuellement les valeurs, c'est dommage qu'il n'y ait pas de fonction pour importer l' <code>enum</code> de C</em> </p><br><img src="https://habrastorage.org/webt/en/jd/4r/enjd4rvd8snxw6fhtstrinlcvey.png"><br><p>  <em>Sur le panneau avant, cet indicateur ressemble √† ceci</em> </p><br><img src="https://habrastorage.org/webt/yc/t6/er/yct6erqkpta8o-a4mnp7vfbty7w.png"><br><p>  <em>S√©lection d'une valeur par un clic gauche</em> </p></div></div><br><p>  Afin de lier et de synchroniser toutes les futures instances de la liste cr√©√©e, il est pratique d'utiliser le "Make Type Def".  (s√©lection via le menu contextuel de l'√©l√©ment).  Par cons√©quent, un type de donn√©es personnalis√© sera cr√©√©.  Le nouveau type est plac√© dans un fichier s√©par√© avec l'extension * .ctl.  La modification de ce fichier modifiera toutes les instances de cet √©l√©ment.  Je pense que cela ne vaut pas la peine d'expliquer √† quel point cela peut √™tre pratique.  L'acc√®s au fichier de d√©finition peut √™tre obtenu √† partir du menu contextuel de l'instance en s√©lectionnant "Open Type Def", dans le m√™me menu, vous devez faire attention aux √©l√©ments "Auto-Update from Type Def".  et "Se d√©connecter du type Def". </p><br><p>  Nous changeons l'indicateur <code>Types</code> en un tableau d'indicateurs du <code>FTDI Type</code> et par cons√©quent, lorsque le VI d√©marre, le type du convertisseur connect√© est affich√©: </p><br><img src="https://habrastorage.org/webt/zy/07/zy/zy07zy2phqs7mc_q8a4hur1hunw.png"><br><p>  <em>Trois appareils trouv√©s</em> </p><br><p>  Il est facile de remarquer que la fonctionnalit√© du code r√©sultant dans le cas "Timeout" est termin√©e, il peut donc √™tre d√©plac√© vers un sous-VI distinct.  S√©lectionnez les √©l√©ments que nous voulons transf√©rer vers le sous-appareil et s√©lectionnez "Cr√©er un sous-VI" dans le menu principal Modifier. </p><br><div class="spoiler">  <b class="spoiler_title">sch√©ma fonctionnel avec sous-instrument cr√©√©</b> <div class="spoiler_text"><p>  Tous les indicateurs sont rest√©s et un nouveau VI avec une ic√¥ne standard a √©t√© form√© √† la place des n≈ìuds d'appel. <br> <a href=""><img src="https://habrastorage.org/webt/wz/oo/ba/wzoobavcvisx9kmmntke3m_2pxe.png"></a> <br>  <em>Image cliquable</em> </p></div></div><br><p>  Double-cliquez sur le nouveau sous-VI pour ouvrir sa fen√™tre d'√©dition.  Tout d'abord, nous l'enregistrons et donnons un nom significatif, par exemple, "FT_GetDeviceInfo".  Configurez les bornes d'E / S.  Pour ce faire, utilisez le volet Connecteur: </p><br><img src="https://habrastorage.org/webt/1e/fs/gw/1efsgw6lcoaoauj-qguyus4fbn4.png"><br><p>  Le panneau est un ensemble de bornes correspondant aux commandes et indicateurs VI. </p><br><p>  Si vous s√©lectionnez un terminal sur le panneau de connexion, l'√©l√©ment correspondant sur le panneau avant est mis en surbrillance.  Si vous s√©lectionnez un terminal vide, puis cliquez sur un √©l√©ment sur le panneau avant, l'√©l√©ment sera attach√© au terminal, mais avant cela, il ne doit pas √™tre affect√© √† un autre terminal.  Dans le menu contextuel, vous pouvez individuellement ou pour tous √† la fois d√©connecter les bornes des √©l√©ments, vous pouvez changer le motif du panneau dans son ensemble. </p><br><p>  Je n'aime pas la fa√ßon dont les terminaux ont √©t√© attribu√©s lors de la cr√©ation du sous-VI actuel. Je s√©lectionne donc "D√©connecter tous les terminaux" et je le marque manuellement.  Je recommande de placer les bornes d'entr√©e sur la gauche et la sortie sur la droite, l'entr√©e en option peut √™tre plac√©e en haut et la sortie en option en bas.  Cela garantira une bonne lisibilit√© du code et un bon ordre visuel dans le diagramme. </p><br><p>  Pour contr√¥ler les erreurs, cr√©ez deux √©l√©ments suppl√©mentaires, <code>Error in</code> et <code>Error out</code> .  Le sujet de contr√¥le d'erreurs de LabVIEW est tr√®s √©tendu et d√©passe le cadre de cet article, nous allons donc nous limiter √† un minimum d'explications et respecter le principe "do as I".  Ainsi, nous cr√©ons deux terminaux pour les erreurs - entr√©e et sortie. </p><br><div class="spoiler">  <b class="spoiler_title">Il est pratique de les cr√©er √† l'aide du menu contextuel</b> <div class="spoiler_text"><p>  Cliquez avec le bouton droit sur le terminal d'erreur de n'importe quel n≈ìud: </p><br><img src="https://habrastorage.org/webt/ul/ew/re/ulewre7rct2swn34bhqejv3kg24.png"></div></div><br><p>  Dans LabVIEW, il est habituel de placer la borne d'entr√©e de l'erreur sur le panneau de connexion en bas √† gauche et la borne de sortie en bas √† droite. </p><br><p>  Il sera plus pratique de combiner la sortie dans une structure.  Pour la sortie, nous allons cr√©er deux tableaux: le premier tableau contiendra tous les p√©riph√©riques FTDI trouv√©s, le second tableau contiendra uniquement ceux qui peuvent MPSSE et th√©oriquement peuvent √™tre utilis√©s pour configurer les FPGA. </p><br><p>  La touche finale lors de la cr√©ation d'un sous-instrument consiste √† configurer l'ic√¥ne.  Un double-clic sur l'ic√¥ne dans le coin sup√©rieur droit de la fen√™tre lance l'√©diteur.  Nous essayons de cr√©er une sorte d'image significative qui nous permet d'interpr√©ter sans ambigu√Øt√© le but de l'appareil dans le diagramme. </p><br><div class="spoiler">  <b class="spoiler_title">FT_GetDeviceInfo.vi</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/l1/hy/sd/l1hysdhgshztti7xczw7tjmbex0.png"><br><p>  <em>Face avant</em> </p><br><img src="https://habrastorage.org/webt/a4/ba/5w/a4ba5wwquuv-coxuxpxzjo8xwio.png"><br><p>  <em>Sch√©ma fonctionnel</em> </p><br><p>  Et voici √† quoi ressemble le cas ¬´Timeout¬ª apr√®s avoir mis les choses en ordre: <br> <a href=""><img src="https://habrastorage.org/webt/ea/yu/6d/eayu6ddx32eq_easysclsqqp7pg.png"></a> <br>  <em>Image cliquable</em> </p></div></div><br><p>  Jusqu'√† pr√©sent, la liste d√©roulante avec le nom "S√©lectionnez un appareil" √©tait vide, nous avons maintenant les donn√©es pour le remplir.  Nous cr√©ons un n≈ìud de propri√©t√© pour la liste avec la propri√©t√© "Strings []" (menu contextuel -&gt; Cr√©er -&gt; N≈ìud de propri√©t√© -&gt; Strings []).  Toute propri√©t√© est accessible en √©criture et en lecture; le mode actuel est s√©lectionn√© dans le menu contextuel du n≈ìud de propri√©t√©.  Lors de la cr√©ation d'un n≈ìud par d√©faut, les propri√©t√©s sont configur√©es pour lire.  Changer pour √©crire: "Changer pour √©crire". </p><br><p>  Dans le tableau de structures, s√©lectionnez le tableau avec la description et alimentez-le dans <code>Strings[]</code> .  Vous pouvez s√©lectionner un tableau √† l'aide de la <code>For Loop</code> . </p><br><p>  Apr√®s avoir d√©marr√© le VI, en appuyant sur le bouton gauche de l'√©l√©ment "S√©lectionner un p√©riph√©rique", vous pouvez sp√©cifier le p√©riph√©rique √† configurer.  Dans ce cas, la liste des appareils est mise √† jour deux fois par seconde.  Bien s√ªr, il ne serait possible de mettre √† jour la propri√©t√© que si la liste a √©t√© mise √† jour, mais jusqu'√† pr√©sent, cela entra√Ænera un encombrement inutile du diagramme. </p><br><div class="spoiler">  <b class="spoiler_title">Que s'est-il pass√©?</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/_t/gh/i7/_tghi7fjgo0hhb6thtdcosvfp1m.png"><br><p>  <em>Face avant</em> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/x6/wo/3v/x6wo3v0sqbdvwzhksbg4kghoeho.png"></a> <br>  <em>Image cliquable</em> </p><br><p>  Plus t√¥t, j'ai oubli√© de mentionner une fonctionnalit√© int√©ressante, la boucle For n'a pas √† sp√©cifier explicitement le nombre d'it√©rations, il suffit de cr√©er un tunnel d'entr√©e du tableau et la boucle s'ex√©cutera pour chaque √©l√©ment, ce comportement ressemble √† la <strong><code>foreach</code></strong> en C ++ 11.  Cependant, vous devez √™tre prudent lorsque plusieurs baies arrivent √† l'entr√©e de boucle. </p></div></div><br><p>  Dans la structure de l'√©v√©nement, ajoutez un gestionnaire pour appuyer sur le bouton "programme".  Bien que nous n'ayons pas de VI charg√© de charger le fichier dans le FPGA, nous allons cr√©er un "stub" de sous-p√©riph√©rique.  Supposons qu'il prenne le chemin vers le fichier de configuration et le descripteur FTDI en entr√©e, et selon les r√©sultats de l'op√©ration, il renvoie l'√©tat du micrologiciel: r√©ussi ou non.  Et pour le rendre plus int√©ressant pour tester l'interface du programme, nous allons rendre ce statut al√©atoire. </p><br><div class="spoiler">  <b class="spoiler_title">Stub FT_MPSSE_SP_FPGA.vi</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gy/xl/qf/gyxlqf-hzbjik3667nmzga5bf6g.png"><br><p>  <em>Face avant</em> </p><br><img src="https://habrastorage.org/webt/f_/qz/kw/f_qzkwjrp7nqvo9yfgl0o9ovidw.png"><br><p>  <em>Sch√©ma fonctionnel</em> </p></div></div><br><p>  Nous passerons le descripteur FTDI √† l'entr√©e de stub via la propri√©t√© list (menu contextuel -&gt; Cr√©er -&gt; N≈ìud de propri√©t√© -&gt; Texte en anneau -&gt; Texte), pour transf√©rer le chemin du fichier vers l'√©l√©ment "Chemin du fichier", cr√©er une variable locale (menu contextuel -&gt; Cr√©er -&gt; Local Variable) et r√©glez-le sur lecture (Change To Read).  Et connectez la sortie d'√©tat directement √† l'indicateur d' <code>Status</code> .  Le bouton <code>Programm</code> est gliss√© dans le gestionnaire d'√©v√©nements.  Il est recommand√© de placer les √©l√©ments sur lesquels l'√©v√©nement est configur√© dans les gestionnaires - maintenant un double-clic sur cet √©l√©ment sur le panneau avant affichera non seulement l'√©l√©ment correspondant dans le diagramme, mais √©galement le gestionnaire d'√©v√©nements associ√© √† cet √©l√©ment. </p><br><p>  Maintenant, en appuyant sur le bouton "Program", l'indicateur devient vert (succ√®s) ou vert fonc√© (non succ√®s).  Pas trop clair.  Dans les propri√©t√©s de l'indicateur, changez la couleur "Off" en rouge.  C‚Äôest mieux.  Si l'indicateur est vert, alors on peut dire que le FPGA sur le p√©riph√©rique s√©lectionn√© est configur√© par un fichier, dont le chemin est indiqu√© dans la fen√™tre: </p><br><img src="https://habrastorage.org/webt/wl/le/re/wllerexz4zkxjzemfyspv_3yyoo.png"><br><p>  <em>Face avant</em> </p><br><p>  Mais cette d√©claration devient fausse si nous avons modifi√© le fichier ou s√©lectionn√© un autre p√©riph√©rique.  Dans le m√™me temps, nous ne pouvons pas colorer l'indicateur en rouge, car aucune erreur de programmation ne s'est produite.  Dans le cas d'un changement de fichier ou de p√©riph√©rique, il convient de souligner que la valeur de l'indicateur n'est pas pertinente - assombrissez-la.  Pour cela, vous pouvez utiliser la propri√©t√© Indicateur <code>Disabled</code> .  Cette propri√©t√© peut prendre trois valeurs: <code>Enabled</code> - affichage normal, l'utilisateur peut contr√¥ler l'objet;  <code>Disabled</code> - l'objet est affich√© sur le panneau avant comme d'habitude, mais l'utilisateur ne peut pas contr√¥ler l'objet;  <code>Disabled and Grayed Out</code> - l'objet est affich√© sur le panneau avant assombri et l'utilisateur ne peut pas contr√¥ler l'objet. </p><br><p>  Nous cr√©ons des gestionnaires d'√©v√©nements pour la <code>Devices list</code> et le <code>File Path</code> , et dans ceux-ci, nous assombrissons l'indicateur d'√©tat et dans le gestionnaire, nous attribuons le bouton "Programme" √† la propri√©t√© <code>Enabled</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Qu'est-il arriv√©?</b> <div class="spoiler_text"><p> <a href=""><img src="https://habrastorage.org/webt/59/xl/da/59xldabidafiphelnavil1h3iue.png"></a> <br>  <em>Gestionnaire "Programm": changement de valeur.</em> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/i4/xm/sx/i4xmsxdxklfiusfqfamtyqxpoog.png"></a> <br>  <em>Gestionnaire de liste de p√©riph√©riques: changement de valeur</em> </p><br><img src="https://habrastorage.org/webt/w3/58/dn/w358dn13xtxn61o6o5frte7-gsk.png"><br><p>  <em>Voici √† quoi ressemble l'indicateur assombri</em> </p></div></div><br><p>  Rendons la recherche du fichier de configuration plus pratique pour l'utilisateur - nous allons configurer la fen√™tre d'affichage des fichiers.  Nous allons dans les propri√©t√©s de l'√©l√©ment <code>File Path</code> , sur l'onglet "Browse Options", remplissons Prompt, Pattern Label, sp√©cifions le filtre de type de fichier (Pattern) et le nom du bouton (Button Text). </p><br><div class="spoiler">  <b class="spoiler_title">Fen√™tre de s√©lection des fichiers</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vf/i2/yc/vfi2ycpuj_lhydbcp1jebbjb0ni.png"><br><p>  <em>Seuls les fichiers rbf sont affich√©s</em> </p><br><img src="https://habrastorage.org/webt/1-/w3/e8/1-w3e8dg3uauxccfq8-buzrs75y.png"></div></div><br><p>  La cr√©ation d'une interface utilisateur peut √™tre consid√©r√©e comme termin√©e. </p><br><img src="https://habrastorage.org/webt/tm/5w/oq/tm5woq3kwnfgmo38klp_5qxenug.png"><br><p>  <em>Lancer le chargeur de d√©marrage</em> </p><br><h2 id="s-chem-poznakomilis-segodnya">  Qu'avez-vous rencontr√© aujourd'hui? </h2><br><p>  Dans cet article, comme exemple de cr√©ation d'une application fonctionnellement compl√®te avec une interface minimaliste, j'ai essay√© de montrer diff√©rentes approches pour travailler dans LabVIEW. </p><br><p>  En cons√©quence, nous avons abord√© ces points: </p><br><ul><li>  D√©finition des propri√©t√©s de l'appliance virtuelle.       . </li><li>   :   . </li><li>    . </li><li>  . </li><li>    dll. </li><li>    . </li></ul><br><p>         API FTD2XX   MPSSE.     . </p><br><h2 id="materialy-po-teme">    </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">     USB   FTDI MPSSE</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">labview_mpsse</a> .   . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> .    </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Software Application Development D2XX Programmer's Guide</a> .   API D2XX. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr427529/">https://habr.com/ru/post/fr427529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr427519/index.html">@Kubernetes Meetup at Mail.Ru Group: le 29 octobre et toujours</a></li>
<li><a href="../fr427521/index.html">Prix ‚Äã‚Äãr√©volutionnaire 2019. Annonce des laur√©ats des prix scientifiques Milner, Brin et Zuckerberg.</a></li>
<li><a href="../fr427523/index.html">Succ√®s de couverture</a></li>
<li><a href="../fr427525/index.html">Intel Core 9th Gen en chiffres et benchmarks</a></li>
<li><a href="../fr427527/index.html">10 astuces pour un tableau de bord avanc√© dans Splunk. 2e partie</a></li>
<li><a href="../fr427531/index.html">De la Sib√©rie √† Chypre et vice versa - l'histoire d'un √©migr√© rat√©</a></li>
<li><a href="../fr427533/index.html">Montres intelligentes qui ne n√©cessitent pas de charge. Y en a-t-il beaucoup?</a></li>
<li><a href="../fr427535/index.html">Nous lan√ßons un choix collectif de solutions</a></li>
<li><a href="../fr427537/index.html">Comment devenir un chef de produit performant: des cours o√π vous √™tes form√© en ce moment</a></li>
<li><a href="../fr427539/index.html">La derni√®re fois que l'Europe r√®gle l'heure pour l'hiver</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>