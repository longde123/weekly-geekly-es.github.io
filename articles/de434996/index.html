<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéá üêù ü§üüèΩ Wie ich den Standort √ºber die VK-API freigegeben habe üßîüèø üë©üèæ‚Äçüîß üíä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="K√ºrzlich habe ich mich entschlossen, die Idee zu implementieren, wie ein Standort √ºber die VK-API mit Freunden im Echtzeitmodus geteilt werden kann. D...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie ich den Standort √ºber die VK-API freigegeben habe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434996/">  K√ºrzlich habe ich mich entschlossen, die Idee zu implementieren, wie ein Standort √ºber die VK-API mit Freunden im Echtzeitmodus geteilt werden kann.  Die Ausgabe war eine plattform√ºbergreifende Qt-Anwendung f√ºr iOS / Android, eine Webanwendung f√ºr VKontakte und einige Pull-Anfragen f√ºr die VK-API.  In diesem Artikel m√∂chte ich einige nicht offensichtliche Implementierungspunkte mitteilen, die f√ºr jemanden von Interesse sein k√∂nnen.  Also, interessiert bitte nach Katze fragen. <br><a name="habracut"></a><br><h3>  Warum brauchte ich es √ºberhaupt? </h3><br>  Fr√ºher oder sp√§ter werden Kinder erwachsen.  Banale Wahrheit.  Also sagte meine zehnj√§hrige Tochter eines Tages: "Papa, nimm mich nicht mehr mit dem Auto, ich m√∂chte alleine zur Schule gehen!"  Nun, dann fand ich die Forderung fair, bat um eine zweiw√∂chige Nachfrist und begann mit den Vorbereitungen. <br><br>  Da ich Erfahrung im Schreiben von Anwendungen habe und meine Tochter als Vorbereitung st√§ndig in der Tasche des iPhone SE herumtr√§gt, wurde beschlossen, schnell eine Anwendung zu schreiben, die zeigt, wo sich die Tochter in diesem bestimmten Moment befindet.  Ja, ich wei√ü, dass es jetzt viele solcher Anwendungen gibt (sogar √§hnliche Funktionen wurden k√ºrzlich in Google Maps ver√∂ffentlicht), und es war m√∂glich, eine vorgefertigte L√∂sung zu verwenden, aber ich war daran interessiert, etwas Eigenes zu schreiben. <br><br><h3>  Warum VKontakte? </h3><br>  Da ich nicht mit der Verarbeitung und Speicherung der (m√∂glicherweise m√∂glichen) personenbezogenen Daten anderer Personen auf meinen Ger√§ten in Verbindung treten m√∂chte, habe ich mir √ºberlegt, wie ich auf meinen eigenen Serverteil verzichten soll.  Und dann d√§mmerte es mir - schlie√ülich gibt es so ein Monster wie VKontakte!  Es ist modisch, leistungsstark und mit seiner entwickelten API, und vor allem haben alle unsere Kinder lange darin gesessen und waren eng (ich kann nicht sagen, dass es mir gefallen hat, aber es ist eine Realit√§t).  Aber zum Teufel, Holmes, wie kann ich Standortdaten einf√ºgen, damit sie erstens nicht dort angezeigt werden, wo sie nicht erforderlich sind, und zweitens, damit Sie den Zugriff auf diese Daten steuern k√∂nnen, damit die schlechten Pedobirs zu ihnen gelangen nicht dort angekommen? <br><br>  Notizen kamen zur Rettung.  Ja, die gleichen Wikipedia-Notizen, die einst (Ger√ºchten zufolge) sehr beliebt waren und jetzt im Stift sind, haben gr√∂√ütenteils aufgeh√∂rt, in den B√§ndern zu blinken, und sind in einen separaten Bereich der Website verschoben, den Sie bei einer lahmen Ziege nicht erreichen k√∂nnen.  Sie k√∂nnen beliebige Textdaten in sie einf√ºgen, aber die Hauptsache ist, dass ihnen Zugriffslisten zugewiesen werden k√∂nnen, in denen Personen und Gruppen aufgelistet sind, die diesen Hinweis sehen und kommentieren k√∂nnen. <br><br>  Das allgemeine Schema der Anwendung in meinen Augen sah folgenderma√üen aus: <br><br><ul><li>  Erstellen Sie eine Liste von Freunden, mit denen Sie Standortdaten teilen m√∂chten (ich habe sie "Vertrauensw√ºrdige Freunde" genannt). </li><li>  Wir erstellen eine Notiz mit einem bestimmten Namen, erteilen das Recht, sie in der obigen Liste anzuzeigen, notieren die Standortdaten dort und aktualisieren sie regelm√§√üig. </li><li>  Wir durchsuchen regelm√§√üig die Liste der vertrauensw√ºrdigen Freunde und pr√ºfen, ob sie auch eine Notiz mit diesem bestimmten Namen haben. Wenn dies der Fall ist, versuchen wir, Daten √ºber den Standort des Freundes aus dessen Inhalten zu extrahieren. Wenn dies erfolgreich ist, zeigen wir sie auf der Karte an. </li><li>  ??? </li><li>  GEWINN! </li></ul><br>  Es gibt also eine Idee, es liegt an der kleinen Sache, sie zu realisieren. <br><br><h3>  iOS </h3><br>  Da ihre Tochter das iPhone verwendet, war es logisch, mit der Implementierung mit der iOS-Version zu beginnen.  Im Hinblick auf die plattform√ºbergreifende Nutzung wurde Qt als Framework ausgew√§hlt, da ich es schon lange kenne, und die gute alte Open Street Map, f√ºr die es ein Plugin in Qt Location gibt, wurde als Engine f√ºr die Karte ausgew√§hlt.  Da die Anwendung urspr√ºnglich als Open Source erstellt wurde, haben mich die Lizenzbeschr√§nkungen von Qt nicht erschreckt. <br><br>  Die GUI wurde in QML geschrieben, um mit VK zu arbeiten. Ich habe das regul√§re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VK iOS SDK</a> verbunden und verwendet. Es ist in Objective-C geschrieben, sodass die Integration keine Probleme verursachte.  Die Arbeit im Hintergrund unter iOS wird √ºber den Significant Change Location Service implementiert.  Um den Energieverbrauch zu senken, √ºberwacht die Anwendung die Aktivit√§t von Bewegungen. Wenn sie versteht, dass eine Person lange Zeit an ungef√§hr einem Ort sitzt (z. B. zur Schule oder ins B√ºro gekommen ist), verringert sie die erforderliche Genauigkeit bei der Bestimmung der Geolokalisierung und zwingt das Betriebssystem, auf weniger energieintensive Methoden zur Bestimmung zu wechseln (wie) in der Regel auf Zellt√ºrmen).  Wenn die Anwendung versteht, dass sich die Person aktiv bewegt, steigt die Genauigkeit wieder an. <br><br>  Der vollst√§ndige Quellcode f√ºr die iOS-Version ist auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> verf√ºgbar.  Hier sind einige nicht offensichtliche Punkte, auf die ich im Implementierungsprozess gesto√üen bin: <br><br>  <b>√úberschreiben von NSApplicationDelegate-Methoden in einer Qt-Anwendung</b> <br><br>  F√ºr das VKontakte iOS SDK m√ºssen einige seiner Funktionen in der Anwendung aufgerufen werden: didFinishLaunchingWithOptions: und application: openURL: options: Methoden.  Vor einer Version von Qt (meiner Meinung nach vor 5.11) war es ausreichend, eine Kategorie f√ºr QIOSApplicationDelegate wie folgt zu erstellen: <br><br><pre><code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QIOSApplicationDelegate</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIResponder</span></span></span><span class="hljs-class"> &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationDelegate</span></span></span><span class="hljs-class">&gt; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QIOSApplicationDelegate</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QIOSApplicationDelegateVKGeoCategory</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QIOSApplicationDelegate</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QIOSApplicationDelegateVKGeoCategory</span></span></span><span class="hljs-class">) - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BOOL</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplication</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">didFinishLaunchingWithOptions</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">launchOptions</span></span></span><span class="hljs-class"> </span></span>{ [...] } - (<span class="hljs-built_in"><span class="hljs-built_in">BOOL</span></span>)application:(<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> *)application openURL:(<span class="hljs-built_in"><span class="hljs-built_in">NSURL</span></span> *)url options:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">UIApplicationOpenURLOptionsKey</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>&gt; *)options { [...] } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span></code> </pre> <br>  In neueren Versionen von Qt verf√ºgt QIOSApplicationDelegate jedoch bereits √ºber eine Implementierung der Anwendung: openURL: options :, sodass die Option mit Kategorien nicht mehr ausgef√ºhrt wird.  Ich musste einen Erben von QIOSApplicationDelegate erstellen und einen Delegaten √ºber setDelegate zuweisen: <br><br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKGeoApplicationDelegate</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QIOSApplicationDelegate</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKGeoApplicationDelegate</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BOOL</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplication</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">openURL</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSURL</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">options</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplicationOpenURLOptionsKey</span></span></span><span class="hljs-class">,</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">&gt; *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">options</span></span></span><span class="hljs-class"> </span></span>{ [...] } <span class="hljs-keyword"><span class="hljs-keyword">@end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> InitializeVKGeoApplicationDelegate() { [[<span class="hljs-built_in"><span class="hljs-built_in">UIApplication</span></span> sharedApplication] setDelegate:[[VKGeoApplicationDelegate alloc] init]]; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *argv[]) { [...] InitializeVKGeoApplicationDelegate(); [...] }</code> </pre><br>  <b>Fehlerbehandlung von VKRequest</b> <br><br>  Angesichts der Tatsache, dass VKRequest bei einem Fehler einen leeren (leeren) NSError zur√ºckgegeben hat.  Ich habe einen Patch erstellt, der den vorherigen Patch von jemandem patcht und eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anfrage f√ºr</a> diesen Patch abruft, aber er h√§ngt immer noch in nicht √ºberpr√ºften Patches. <br><br><h3>  Android </h3><br>  Das Folgende war die Version f√ºr Android.  Der GUI-Code wurde von iOS fast vollst√§ndig wiederverwendet, um mit dem VK zu interagieren. Das regul√§re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">VK-Android-SDK</a> wurde erneut verwendet. Die Interaktion erfolgt √ºber das JNI. Die Arbeit im Hintergrund wird gem√§√ü den Google-Covenants f√ºr solche Anwendungen implementiert - n√§mlich √ºber den Foreground Service.  Nat√ºrlich ist auch die Logik zur Reduzierung des Energieverbrauchs implementiert, die der in iOS verwendeten √§hnelt. <br><br>  Der vollst√§ndige Satz des Quellcodes f√ºr die Android-Version ist wieder auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> verf√ºgbar. Hier sind einige nicht offensichtliche Punkte, auf die ich bei der Implementierung dieser Version gesto√üen bin: <br><br>  <b>So erstellen Sie einen Android-Dienst auf Qt</b> <br><br>  Um einen Dienst in Qt 5.10 zu erstellen, wurde die QAndroidService-Klasse angezeigt, die anstelle von QGuiApplication verwendet werden sollte.  Sie k√∂nnen separate .so f√ºr Aktivit√§t und Service kompilieren oder eine .so f√ºr alles verwenden. Damit der Code versteht, in welchem ‚Äã‚ÄãModus er funktioniert, k√∂nnen Sie diesen Modus √ºber die Befehlszeilentaste angeben. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".VKGeoService"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.app.arguments"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-service"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-function"><span class="hljs-function">QGuiApplication </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">app</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argc, argv)</span></span></span></span>; [...] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; QString(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]) == <span class="hljs-string"><span class="hljs-string">"-service"</span></span>) { QAndroidService app(argc, argv); [...] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre><br>  <b>Seltsame "baumelnde" Aktivit√§t in onDestroy ()</b> <br><br>  Bei der Implementierung des Dienstes wurde ein lustiges Problem deutlich: QtActivity ‚Äûhing‚Äú irgendwo im Darm seines onDestroy (), abh√§ngig von der Verf√ºgbarkeit eines funktionierenden Vordergrunddienstes.  Anscheinend erwartet Qt nicht, dass nach Abschluss der Aktivit√§t noch etwas von der Anwendung √ºbrig bleibt.  Das Problem wurde gel√∂st, indem Aktivit√§t und Service √ºber verschiedene Prozesse verteilt wurden, indem android: process im Manifest verwendet wurde: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".VKGeoService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:process</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">":VKGeoService"</span></span></span><span class="hljs-tag">&gt;</span></span> [...] <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  und Festnageln des Prozesses, in dem die Aktivit√§t ausgef√ºhrt wird, in einem √ºberschriebenen onDestroy (): <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ [...] <span class="hljs-comment"><span class="hljs-comment">/* * This call hangs when foreground service is running, * so we just kill activity process instead (service * is running in a different process). * * super.onDestroy(); */</span></span> Process.killProcess(Process.myPid()); }</code> </pre><br>  Ja, Lint schw√∂rt st√§ndig darauf, aber wie ich anders damit umgehen soll, ist mir noch nicht klar, aber QTBUG mit PoC zu diesem Thema in die H√§nde zu bekommen, bringt noch nichts. <br><br>  <b>UPDATE</b> : In Qt 5.12.3 (m√∂glicherweise etwas fr√ºher - ich habe es nicht √ºberpr√ºft) wurde der Fehler beim Aufh√§ngen von QtActivity.onDestroy () behoben, als der Dienst gestartet wurde. Diese Problemumgehung wird nicht mehr ben√∂tigt. <br><br>  <b>Fehlender errorBlock-Aufruf beim Abbrechen von VKBatchRequest</b> <br><br>  Ich verwende h√§ufig Batch-Anforderungen, um das Laden von VKontakte-Servern zu erleichtern. Unter Android (unter iOS funktioniert alles einwandfrei) ist ein Problem aufgetreten, wenn VKBatchRequest abgebrochen wurde und errorBlocks nicht f√ºr stornierte Anforderungen aufgerufen wurden.  Ich habe dieses Problem in der lokalen Version der Bibliothek behoben, den entsprechenden Patch und die entsprechende <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Pull-Anforderung f√ºr</a> diesen Patch gestellt, aber es h√§ngt immer noch in den nicht √ºberpr√ºften. <br><br><h3>  Fazit </h3><br>  Die iOS-Version von Apple konnte problemlos in den App Store gestellt werden und ist dort immer noch verf√ºgbar. Die Android-Version lebte einige Zeit bei Google Play, bis die Google Play-Richtlinie versch√§rft wurde (es wurde vorgeschrieben, dass Anwendungen, die die Geolokalisierung verfolgen, explizit sein sollten f√ºr Familien- oder Firmenzwecke bestimmt), wonach meine Bewerbung dort sicher blockiert wurde.  Zu meinem Berufungsversuch erkl√§rte ein verantwortungsbewusster Google-Mitarbeiter (oder vielleicht war es ein Bot, jetzt ist es nicht so offensichtlich, wer Ihre Fragen genau beantwortet) unerbittlich: "Nun, diese Anwendung darf NICHT NUR f√ºr die Verfolgung von Familien oder Unternehmen verwendet werden." , zu dem ich nichts zu streiten finden konnte - tats√§chlich kann man mit einem Hammer nicht nur N√§gel h√§mmern, sondern auch die K√∂pfe schlagen ... Ich habe die Android-Version in Yandex.Store und Amazon Appstore sowie als APK auf der Projektwebsite platziert. <br><br>  Ich w√ºrde mich freuen, wenn diese Anwendung f√ºr jemanden als visuelle Hilfe n√ºtzlich w√§re, um einige nicht offensichtliche Momente beim Schreiben einer Qt-Anwendung f√ºr iOS / Android zu verdeutlichen, insbesondere solche, die sich auf die Implementierung des Android-Dienstes auf Qt beziehen (diese Funktionalit√§t ist relativ neu, Beispiele f√ºr die Implementierung, wie viel Ich wei√ü nicht so viel).  Gerne beantworte ich auch Fragen in den Kommentaren, falls vorhanden. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434996/">https://habr.com/ru/post/de434996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434982/index.html">Perspektive: MultiClet S1</a></li>
<li><a href="../de434984/index.html">Warum ich Eloquent ORM hasse</a></li>
<li><a href="../de434986/index.html">Grundlegende Konzepte der Standard-C ++ - Bibliothek</a></li>
<li><a href="../de434992/index.html">IDA Pro aktualisieren. Debugger f√ºr Sega Mega Drive (Teil 1)</a></li>
<li><a href="../de434994/index.html">Android: Erstellen dynamischer Produktaromen und Signieren von Konfigurationen</a></li>
<li><a href="../de434998/index.html">Ein weiterer Artikel zur Auswahl eines Smartphones</a></li>
<li><a href="../de435002/index.html">IDA Pro aktualisieren. Debugger f√ºr Sega Mega Drive (Teil 2)</a></li>
<li><a href="../de435006/index.html">Wo und wie machen Kernreaktoren</a></li>
<li><a href="../de435010/index.html">Digitale Texte: Eine Mega-Auswahl an Songs und Clips √ºber Programmierung und Programmierer</a></li>
<li><a href="../de435012/index.html">Das erste Videospiel f√ºr Alice oder Sprachassistent als Gamecontroller</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>