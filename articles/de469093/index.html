<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆🏻 🏇🏾 🙏🏽 Vergleich weniger populärer und nicht sehr CLI-Bibliotheken: Cliff, Plac, Plumbum und andere (Teil 2) 🕚 ➕ 🐇</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Python-Ökosystem gibt es viele Pakete für CLI-Anwendungen, sowohl beliebte wie Click als auch weniger. Die häufigsten wurden in einem früheren Arti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Vergleich weniger populärer und nicht sehr CLI-Bibliotheken: Cliff, Plac, Plumbum und andere (Teil 2)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469093/">  Im Python-Ökosystem gibt es viele Pakete für CLI-Anwendungen, sowohl beliebte wie Click als auch weniger.  Die häufigsten wurden in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">früheren Artikel</a> berücksichtigt, aber wenig bekannte, aber nicht weniger interessante werden hier gezeigt. <br><br><img src="https://habrastorage.org/webt/ab/ah/vg/abahvganodu2saybc-pqmdls4ea.png"><br><a name="habracut"></a><br>  Wie im ersten Teil wird für jede Bibliothek in Python 3.7 ein Konsolenskript für die todolib-Bibliothek geschrieben.  Darüber hinaus wird für jede Implementierung ein trivialer Test mit diesen Fixtures geschrieben: <br><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture(autouse=True) def db(monkeypatch): """ monkeypatch         ,         """ value = {"tasks": []} monkeypatch.setattr(todolib.TodoApp, "save", lambda _: ...) monkeypatch.setattr(todolib.TodoApp, "get_db", lambda _: value) return value @pytest.yield_fixture(autouse=True) def check(db): """      """ yield assert db["tasks"] and db["tasks"][0]["title"] == "test" # ,      EXPECTED = "Task 'test' created with number 1.\n"</span></span></code> </pre> <br>  Der gesamte Quellcode ist in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">diesem Repository</a> verfügbar. <br><br><h2>  Klippe </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Dokumentation</a> <br>  Viele haben von OpenStack gehört, einer Open Source-Plattform für IaaS.  Das meiste davon ist in Python geschrieben, einschließlich Konsolendienstprogrammen, die die CLI-Funktionalität seit langer Zeit wiederholen.  Dies wurde fortgesetzt, bis Cliff oder das Command Line Interface Formulation Framework als gemeinsames Framework angezeigt wurde.  Damit kombinierten Openstack-Entwickler Pakete wie Python-Novaclient, Python-Swiftclient und Python-Keystoneclient in einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Openstack-</a> Programm. <br><br>  <b>Teams</b> <br>  Der Ansatz zum Deklarieren von Befehlen ähnelt Cement und Cleo: Argparse als Parameterparser, und die Befehle selbst werden durch die Vererbung der Command-Klasse erstellt.  Gleichzeitig gibt es kleine Erweiterungen für die Command-Klasse, z. B. Lister, die die Daten unabhängig formatieren. <br><br><div class="spoiler">  <b class="spoiler_title">Quellcode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cliff <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> command <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cliff.lister <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Lister <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(command.Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Command with a parser shortcut."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_parser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, prog_name)</span></span></span><span class="hljs-function">:</span></span> parser = super().get_parser(prog_name) self.extend_parser(parser) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> parser <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend_parser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parser)</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Add</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Add new task."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend_parser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parser)</span></span></span><span class="hljs-function">:</span></span> parser.add_argument(<span class="hljs-string"><span class="hljs-string">"title"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Task title"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">take_action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parsed_args)</span></span></span><span class="hljs-function">:</span></span> task = self.app.todoapp.add_task(parsed_args.title) print(task, <span class="hljs-string"><span class="hljs-string">"created with number"</span></span>, task.number, end=<span class="hljs-string"><span class="hljs-string">".\n"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Show</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Lister, Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Show current tasks."""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">extend_parser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parser)</span></span></span><span class="hljs-function">:</span></span> parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--show-done"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Include done tasks"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">take_action</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parsed_args)</span></span></span><span class="hljs-function">:</span></span> tasks = self.app.todoapp.list_tasks(show_done=parsed_args.show_done) <span class="hljs-comment"><span class="hljs-comment">#     'there is no todos'   #      return ( ("Number", "Title", "Status"), [[task.number, task.title, "" if task.done else "✘"] for task in tasks], ) class Done(Command): """Mark task as done.""" def extend_parser(self, parser): parser.add_argument("number", type=int, help="Task number") def take_action(self, parsed_args): task = self.app.todoapp.task_done(number=parsed_args.number) print(task, "marked as done.") #   Done    class Remove(Done): """Remove task from the list.""" def take_action(self, parsed_args): task = self.app.todoapp.remove_task(number=parsed_args.number) print(task, "removed from the list.")</span></span></code> </pre><br></div></div><br>  <b>Anwendung und Haupt</b> <br><br>  Die Anwendungsklasse verfügt <i>über die Methoden</i> <i>initialize_app</i> und <i>clean_up</i> . In unserem Fall initialisieren sie die Anwendung und speichern die Daten. <br><br><div class="spoiler">  <b class="spoiler_title">Quellcode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cliff <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> cliff.commandmanager <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CommandManager <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> todolib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TodoApp, __version__ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(app.App)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#   add_command, CommandManager  #    setuptools entrypoint manager = CommandManager("todo_cliff") manager.add_command("add", Add) manager.add_command("show", Show) manager.add_command("done", Done) manager.add_command("remove", Remove) super().__init__( description="Todo notes on cliff", version=__version__, command_manager=manager, deferred_help=True, ) self.todoapp = None def initialize_app(self, argv): self.todoapp = TodoApp.fromenv() def clean_up(self, cmd, result, err): self.todoapp.save() def main(args=sys.argv[1:]) -&gt; int: app = App() return app.run(argv=args)</span></span></code> </pre><br></div></div><br>  <b>Arbeitsbeispiele</b> <br><br><pre> <code class="bash hljs">igor$ ./todo_cliff.py add <span class="hljs-string"><span class="hljs-string">"sell the old laptop"</span></span> Using database file /home/igor/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/todoapp/db.json Task <span class="hljs-string"><span class="hljs-string">'sell the old laptop'</span></span> created with number 0. Saving database to a file /home/igor/.<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/share/todoapp/db.json</code> </pre><br>  Abmelden!  Und wenn Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unter die Haube</a> schauen, können Sie sehen, dass es auf clevere Weise gemacht wurde: Informationen in stdout und Warnung / Fehler in stderr und, falls erforderlich, durch das Flag <i>--quiet</i> deaktiviert. <br><br><pre> <code class="bash hljs">igor$ ./todo_cliff.py -q show +--------+----------------------+--------+ | Number | Title | Status | +--------+----------------------+--------+ | 1 | sell the old laptop | ✘ | +--------+----------------------+--------+</code> </pre><br>  Wie bereits erwähnt, formatiert Lister die Daten, aber die Tabelle ist nicht beschränkt auf: <br><br><pre> <code class="bash hljs">igor$ ./todo_cliff.py -q show -f json --noindent [{<span class="hljs-string"><span class="hljs-string">"Number"</span></span>: 0, <span class="hljs-string"><span class="hljs-string">"Title"</span></span>: <span class="hljs-string"><span class="hljs-string">"sell old laptop"</span></span>, <span class="hljs-string"><span class="hljs-string">"Status"</span></span>: <span class="hljs-string"><span class="hljs-string">"\u2718"</span></span>}]</code> </pre><br>  Neben json und table stehen yaml und csv zur Verfügung. <br><br>  Es gibt auch eine versteckte Standardspur: <br><br><pre> <code class="bash hljs">igor$ ./todo_cliff.py -q remove 3 No such task.</code> </pre><br>  Eine weitere verfügbare REPL- und Fuzzy-Suche, auch bekannt als <i>Fuzzy-Suche</i> : <br><br><pre> <code class="bash hljs">igor$ ./todo_cliff.py -q (todo_cliff) <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> Shell commands (<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> %topic%): =================================== <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-built_in"><span class="hljs-built_in">history</span></span> py quit shell <span class="hljs-built_in"><span class="hljs-built_in">unalias</span></span> edit <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> load pyscript <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> shortcuts Application commands (<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> %topic%): ========================================= add complete <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> remove show (todo_cliff) whow todo_cliff: <span class="hljs-string"><span class="hljs-string">'whow'</span></span> is not a todo_cliff <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>. See <span class="hljs-string"><span class="hljs-string">'todo_cliff --help'</span></span>. Did you mean one of these? show</code> </pre><br>  <b>Testen</b> <br><br>  Es ist ganz einfach: Ein App-Objekt wird erstellt und run () wird ebenfalls aufgerufen, wodurch ein Exit-Code zurückgegeben wird. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_cliff</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capsys)</span></span></span><span class="hljs-function">:</span></span> app = todo_cliff.App() code = app.run([<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"test"</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> code == <span class="hljs-number"><span class="hljs-number">0</span></span> out, _ = capsys.readouterr() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> out == EXPECTED</code> </pre><br>  <b>Dafür und dagegen</b> <br><br>  Vorteile: <br><br><ul><li>  Verschiedene Annehmlichkeiten sofort einsatzbereit; </li><li>  Entwickelt von OpenStack; </li><li>  Interaktiver Modus; </li><li>  Erweiterbarkeit durch <i>setuptools entrypoint</i> und CommandHook; </li><li>  Sphinx-Plugin für die automatische Dokumentation zu CLI; </li><li>  Befehlsabschluss (nur Bash); </li></ul><br>  Nachteile: <br><br><ul><li>  Eine kleine Dokumentation, die im Wesentlichen aus einem detaillierten, aber einzelnen Beispiel besteht; </li></ul><br>  Ein weiterer Fehler wurde festgestellt: Im Falle eines Fehlers beim Ausblenden des Stack-Trace ist der Exit-Code immer Null. <br><br><h2>  Plac </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Dokumentation</a> <br><br>  Auf den ersten Blick scheint Plac so etwas wie Feuer zu sein, aber <i>in Wirklichkeit ist</i> es wie Feuer, das das gleiche Argument und vieles mehr unter der Haube verbirgt. <br><br>  Plac folgt unter Berufung auf die Dokumentation: "Das alte Prinzip der Computerwelt: <i>Programme sollten nur gewöhnliche Fälle lösen und das Einfache sollte einfach bleiben und der Komplex gleichzeitig erreichbar sein</i> ."  Der Autor des Frameworks verwendet Python seit mehr als neun Jahren und hat es mit der Erwartung geschrieben, „99,9% der Aufgaben“ zu lösen. <br><br>  <b>Befehle und main</b> <br><br>  Aufmerksamkeit für Anmerkungen in der show- und done-Methode: So analysiert Plac die Parameter- bzw. Argumenthilfe. <br><br><div class="spoiler">  <b class="spoiler_title">Quellcode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> plac <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> todolib <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodoInterface</span></span></span><span class="hljs-class">:</span></span> commands = <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"show"</span></span>, <span class="hljs-string"><span class="hljs-string">"done"</span></span>, <span class="hljs-string"><span class="hljs-string">"remove"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.app = todolib.TodoApp.fromenv() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__exit__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, exc_type, exc_val, exc_tb)</span></span></span><span class="hljs-function">:</span></span> self.app.save() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, task)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Add new task. """</span></span> task = self.app.add_task(title=task) print(task, <span class="hljs-string"><span class="hljs-string">"created with number"</span></span>, task.number, end=<span class="hljs-string"><span class="hljs-string">".\n"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, show_done: plac.Annotation</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"Include done tasks"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">, kind=</span></span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-string">"flag"</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Show current tasks. """</span></span> self.app.print_tasks(show_done=show_done) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">done</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, number: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Task number"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Mark task as done. """</span></span> task = self.app.task_done(number=int(number)) print(task, <span class="hljs-string"><span class="hljs-string">"marked as done."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, number: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"Task number"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Remove task from the list. """</span></span> task = self.app.remove_task(number=int(number)) print(task, <span class="hljs-string"><span class="hljs-string">"removed from the list."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: plac.Interpreter.call(TodoInterface)</code> </pre><br></div></div><br>  <b>Testen</b> <br><br>  Das Testen des Exit-Codes Plac ist leider nicht möglich.  Aber das Testen selbst ist real: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_plac</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capsys)</span></span></span><span class="hljs-function">:</span></span> plac.Interpreter.call(todo_plac.TodoInterface, arglist=[<span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"test"</span></span>]) out, _ = capsys.readouterr() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> out == EXPECTED</code> </pre><br>  <b>Dafür und dagegen</b> <br><br>  Vorteile: <br><br><ul><li>  Einfache Verwendung; </li><li>  Interaktiver Modus mit Readline-Unterstützung; </li><li>  Stabile API </li><li>  Hervorragende Dokumentation; </li></ul><br>  Das Interessanteste an Plac ist jedoch im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">fortgeschrittenen Gebrauch</a> verborgen: <br><br><ul><li>  Ausführung mehrerer Befehle in Threads und Unterprozessen; </li><li>  Paralleles Rechnen; </li><li>  Telnet-Server; </li></ul><br>  Nachteile: <br><br><ul><li>  Sie können den Exit-Code nicht testen. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schlechtes</a> Projektleben. </li></ul><br><h2>  Plumbum </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Dokumentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CLI-Dokumentation</a> <br>  Plumbum ist in der Tat kein so wenig bekanntes Framework - fast 2000 Sterne, und es gibt etwas zu lieben, da es grob gesagt die UNIX-Shell-Syntax implementiert.  Nun, mit Zusatzstoffen: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> plumbum <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> local &gt;&gt;&gt; output = local[<span class="hljs-string"><span class="hljs-string">"ls"</span></span>]() &gt;&gt;&gt; output.split(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>)[:<span class="hljs-number"><span class="hljs-number">3</span></span>] [<span class="hljs-string"><span class="hljs-string">'console_examples.egg-info'</span></span>, <span class="hljs-string"><span class="hljs-string">'__pycache__'</span></span>, <span class="hljs-string"><span class="hljs-string">'readme.md'</span></span>] <span class="hljs-comment"><span class="hljs-comment">#  plumbum     cmd,      &gt;&gt;&gt; from plumbum.cmd import rm, ls, grep, wc &gt;&gt;&gt; rm["-r", "console_examples.egg-info"]() '' &gt;&gt;&gt; chain = ls["-a"] | grep["-v", "\\.py"] | wc["-l"] &gt;&gt;&gt; chain() '11\n'</span></span></code> </pre><br>  <b>Befehle und main</b> <br><br>  Plumbum hat auch Tools für die CLI, und um nicht zu sagen, dass sie nur eine Ergänzung sind: Es gibt Nargs, Befehle und Farben: <br><br><div class="spoiler">  <b class="spoiler_title">Quellcode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> plumbum <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cli, colors <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(cli.Application)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Todo notes on plumbum."""</span></span> VERSION = todolib.__version__ verbosity = cli.CountOf(<span class="hljs-string"><span class="hljs-string">"-v"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Increase verbosity"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args: print(colors.red | <span class="hljs-string"><span class="hljs-string">f"Unknown command: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{args[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">0</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]!r}</span></span></span><span class="hljs-string">."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.nested_command: <span class="hljs-comment"><span class="hljs-comment"># will be ``None`` if no sub-command follows print(colors.red | "No command given.") return 1 class Command(cli.Application): """Command with todoapp object""" def __init__(self, executable): super().__init__(executable) self.todoapp = todolib.TodoApp.fromenv() atexit.register(self.todoapp.save) def log_task(self, task, msg): print("Task", colors.green | task.title, msg, end=".\n") @App.subcommand("add") class Add(Command): """Add new task""" def main(self, task): task = self.todoapp.add_task(title=task) self.log_task(task, "added to the list") @App.subcommand("show") class Show(Command): """Show current tasks""" show_done = cli.Flag("--show-done", help="Include done tasks") def main(self): self.todoapp.print_tasks(self.show_done) @App.subcommand("done") class Done(Command): """Mark task as done""" def main(self, number: int): task = self.todoapp.task_done(number) self.log_task(task, "marked as done") @App.subcommand("remove") class Remove(Command): """Remove task from the list""" def main(self, number: int): task = self.todoapp.remove_task(number) self.log_task(task, "removed from the list.") if __name__ == '__main__': App.run()</span></span></code> </pre><br></div></div><br>  <b>Testen</b> <br><br>  Das Testen von Anwendungen auf Plumbum unterscheidet sich von anderen, außer dass die Notwendigkeit besteht, auch den Namen der Anwendung zu übergeben, d. H.  erstes Argument: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_plumbum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capsys)</span></span></span><span class="hljs-function">:</span></span> _, code = todo_plumbum.App.run([<span class="hljs-string"><span class="hljs-string">"todo_plumbum"</span></span>, <span class="hljs-string"><span class="hljs-string">"add"</span></span>, <span class="hljs-string"><span class="hljs-string">"test"</span></span>], exit=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> code == <span class="hljs-number"><span class="hljs-number">0</span></span> out, _ = capsys.readouterr() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> out == <span class="hljs-string"><span class="hljs-string">"Task test created with number 0.\n"</span></span></code> </pre><br>  <b>Dafür und dagegen</b> <br><br>  Vorteile: <br><br><ul><li>  Hervorragendes Toolkit für die Arbeit mit externen Teams; </li><li>  Unterstützung für Stile und Farben; </li><li>  Stabile API </li><li>  Aktives Leben des Projekts; </li></ul><br>  Es wurden keine Mängel festgestellt. <br><br><h2>  cmd2 </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Dokumentation</a> <br><br>  Zunächst ist cmd2 eine Erweiterung über <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">cmd</a> aus der Standardbibliothek. <br>  d.h.  Es ist für interaktive Anwendungen vorgesehen.  Trotzdem ist es in der Überprüfung enthalten, da es auch für den normalen CLI-Modus konfiguriert werden kann. <br><br>  <b>Befehle und main</b> <br><br>  cmd2 erfordert die Einhaltung einer bestimmten Regel: Befehle sollten mit dem Präfix <i>do_ beginnen</i> , ansonsten ist alles klar: <br><br><div class="spoiler">  <b class="spoiler_title">interaktiver Modus</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cmd2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> todolib <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(cmd2.Cmd)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.todoapp = todolib.TodoApp.fromenv() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__exit__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, exc_type, exc_val, exc_tb)</span></span></span><span class="hljs-function">:</span></span> self.todoapp.save() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, title)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Add new task."""</span></span> task = self.todoapp.add_task(str(title)) self.poutput(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task}</span></span></span><span class="hljs-string"> created with number </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task.number}</span></span></span><span class="hljs-string">."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, show_done)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Show current tasks."""</span></span> self.todoapp.print_tasks(bool(show_done)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_done</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, number)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Mark task as done."""</span></span> task = self.todoapp.task_done(int(number)) self.poutput(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task}</span></span></span><span class="hljs-string"> marked as done."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, number)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Remove task from the list."""</span></span> task = self.todoapp.remove_task(int(number)) self.poutput(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task}</span></span></span><span class="hljs-string"> removed from the list."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(**kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> App(**kwargs) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> app: app.cmdloop() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">nicht interaktiver Modus</b> <div class="spoiler_text">  Der normale Modus erfordert etwas mehr Bewegung. <br><br>  Sie müssen beispielsweise zu argparse zurückkehren und die Logik für den Fall schreiben, dass das Skript ohne Parameter aufgerufen wird.  Und jetzt bekommen die Befehle <i>argparse.Namespace</i> . <br><br>  Der Parser stammt aus dem Argparse-Beispiel mit kleinen Ergänzungen - jetzt sind Unterparser Attribute des HauptargumentParser. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cmd2 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> todo_argparse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> get_parser parser = get_parser(progname=<span class="hljs-string"><span class="hljs-string">"todo_cmd2_cli"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(cmd2.Cmd)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, **kwargs)</span></span></span><span class="hljs-function">:</span></span> super().__init__(**kwargs) self.todoapp = todolib.TodoApp.fromenv() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__exit__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, exc_type, exc_val, exc_tb)</span></span></span><span class="hljs-function">:</span></span> self.todoapp.save() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Add new task."""</span></span> task = self.todoapp.add_task(args.title) self.poutput(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task}</span></span></span><span class="hljs-string"> created with number </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task.number}</span></span></span><span class="hljs-string">."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Show current tasks."""</span></span> self.todoapp.print_tasks(args.show_done) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_done</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Mark task as done."""</span></span> task = self.todoapp.task_done(args.number) self.poutput(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task}</span></span></span><span class="hljs-string"> marked as done."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Remove task from the list."""</span></span> task = self.todoapp.remove_task(args.number) self.poutput(<span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task}</span></span></span><span class="hljs-string"> removed from the list."</span></span>) parser.add.set_defaults(func=do_add) parser.show.set_defaults(func=do_show) parser.done.set_defaults(func=do_done) parser.remove.set_defaults(func=do_remove) @cmd2.with_argparser(parser) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_base</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, args)</span></span></span><span class="hljs-function">:</span></span> func = getattr(args, <span class="hljs-string"><span class="hljs-string">"func"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> func: func(self, args) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print(<span class="hljs-string"><span class="hljs-string">"No command provided."</span></span>) print(<span class="hljs-string"><span class="hljs-string">"Call with --help to get available commands."</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argv=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> App() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> app: app.do_base(argv <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>:]) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre><br></div></div><br>  <b>Testen</b> <br><br>  <i>Es wird nur ein interaktives Skript getestet.</i> <br><br>  Da das Testen interaktiver Anwendungen eine große Anzahl von Personal- und Zeitressourcen erfordert, haben cmd2-Entwickler versucht, dieses Problem mithilfe von <i>Transkriptionen</i> zu lösen - Textdateien mit Beispielen für Eingabe und erwartete Ausgabe.  Zum Beispiel: <br><br><pre> <code class="plaintext hljs">(Cmd) add test Task 'test' created with number 0.</code> </pre><br>  Daher muss lediglich die Liste der Dateien mit Transkriptionen an die <i>App übertragen werden</i> : <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_cmd2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> todo_cmd2.main(transcript_files=[<span class="hljs-string"><span class="hljs-string">"tests/transcript.txt"</span></span>])</code> </pre><br>  <b>Dafür und dagegen</b> <br><br>  Vorteile: <br><br><ul><li>  Gute API für interaktive Anwendungen; </li><li>  In den letzten Jahren aktiv weiterentwickelt; </li><li>  Ein origineller Testansatz; </li><li>  Gute Dokumentation. </li></ul><br>  Nachteile: <br><br><ul><li>  Erfordert Argparse und zusätzlichen Code beim Schreiben nicht interaktiver Anwendungen. </li><li>  Instabile API; </li><li>  An einigen Stellen ist die Dokumentation leer. </li></ul><br><h2>  Bonus: Urwid </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Die Dokumentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tutorial</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Programmbeispiele</a> <br><br>  Urwid ist ein Framework aus einer etwas anderen Welt - von Flüchen und npyscreen, d. H. Von der Konsolen- / Terminal-Benutzeroberfläche.  Trotzdem wird es als Bonus in die Bewertung aufgenommen, da es meiner Meinung nach Beachtung verdient. <br><br>  <b>App und Teams</b> <br><br>  Urwid verfügt über eine große Anzahl von Widgets, jedoch nicht über Konzepte wie ein Fenster oder einfache Tools für den Zugriff auf benachbarte Widgets.  Wenn Sie also ein schönes Ergebnis erzielen möchten, müssen Sie sorgfältig überlegen und / oder andere Pakete verwenden. Andernfalls müssen Sie Daten in den Attributen der Schaltflächen wie hier übertragen: <br><br><div class="spoiler">  <b class="spoiler_title">Quellcode</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urwid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> urwid <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Button <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> todolib <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(urwid.WidgetPlaceholder)</span></span></span><span class="hljs-class">:</span></span> max_box_levels = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__(urwid.SolidFill()) self.todoapp = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.box_level = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__enter__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.todoapp = todolib.TodoApp.fromenv() self.new_menu( <span class="hljs-string"><span class="hljs-string">"Todo notes on urwid"</span></span>, <span class="hljs-comment"><span class="hljs-comment">#       ,  #      Button("New task", on_press=add), Button("List tasks", on_press=list_tasks), ) return self def __exit__(self, exc_type, exc_val, exc_tb): self.todoapp.save() def new_menu(self, title, *items): self.new_box(menu(title, *items)) def new_box(self, widget): self.box_level += 1 # overlay      , #     LineBox    self.original_widget = urwid.Overlay( # LineBox  unicode-    self.original_widget, align="center", width=30, valign="middle", height=10, ) def popup(self, text): self.new_menu(text, Button("To menu", on_press=lambda _: self.pop(levels=2))) def keypress(self, size, key): if key != "esc": super().keypress(size, key=key) elif self.box_level &gt; 0: self.pop() def pop(self, levels=1): for _ in range(levels): self.original_widget = self.original_widget[0] self.box_level -= levels if self.box_level == 0: raise urwid.ExitMainLoop()</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Teams</b> <div class="spoiler_text"><pre> <code class="python hljs">app = App() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">menu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(title, *items)</span></span></span><span class="hljs-function"> -&gt; urwid.ListBox:</span></span> body = [urwid.Text(title), urwid.Divider()] body.extend(items) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> urwid.ListBox(urwid.SimpleFocusListWalker(body)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(button)</span></span></span><span class="hljs-function">:</span></span> edit = urwid.Edit(<span class="hljs-string"><span class="hljs-string">"Title: "</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(button)</span></span></span><span class="hljs-function">:</span></span> text = edit.edit_text app.todoapp.add_task(text) app.popup(<span class="hljs-string"><span class="hljs-string">"Task added"</span></span>) app.new_menu(<span class="hljs-string"><span class="hljs-string">"New task"</span></span>, edit, Button(<span class="hljs-string"><span class="hljs-string">"Add"</span></span>, on_press=handle)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">list_tasks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(button)</span></span></span><span class="hljs-function">:</span></span> tasks = app.todoapp.list_tasks(show_done=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) buttons = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> task <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tasks: status = <span class="hljs-string"><span class="hljs-string">"done"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> task.done <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-string"><span class="hljs-string">"not done"</span></span> text = <span class="hljs-string"><span class="hljs-string">f"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{task.title}</span></span></span><span class="hljs-string"> [</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{status}</span></span></span><span class="hljs-string">]"</span></span> <span class="hljs-comment"><span class="hljs-comment">#         button = Button(text, on_press=task_actions, user_data=task.number) buttons.append(button) app.new_menu("Task list", *buttons) def task_actions(button, number): def done(button, number): app.todoapp.task_done(number) app.popup("Task marked as done.") def remove(button, number): app.todoapp.remove_task(number) app.popup("Task removed from the list.") btn_done = Button("Mark as done", on_press=done, user_data=number) btn_remove = Button("Remove from the list", on_press=remove, user_data=number) app.new_menu("Actions", btn_done, btn_remove)</span></span></code> </pre><br></div></div><br>  <b>Haupt</b> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> app: urwid.MainLoop(app).run() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre><br>  <b>Dafür und dagegen</b> <br><br>  Vorteile: <br><br><ul><li>  Hervorragende API zum Schreiben verschiedener TUI-Anwendungen; </li><li>  Lange Entwicklungsgeschichte (seit 2010) und stabile API; </li><li>  Kompetente Architektur; </li><li>  Gute Dokumentation, es gibt Beispiele. </li></ul><br>  Nachteile: <br><br><ul><li>  Wie zu testen ist unklar.  Es fallen <i>mir</i> nur die <i>tmux-Sendeschlüssel ein</i> . </li><li>  Nicht informative Fehler, wenn Widgets nicht richtig angeordnet sind. </li></ul><br><h2>  * * * </h2><br>  Cliff ist Cleo und Cement sehr ähnlich und eignet sich im Allgemeinen für große Projekte. <br><br>  Ich persönlich würde es nicht wagen, Plac zu verwenden, aber ich empfehle, den Quellcode zu lesen. <br><br>  Plumbum verfügt über ein praktisches CLI-Toolkit und eine brillante API zum Ausführen anderer Befehle. Wenn Sie also Shell-Skripte in Python neu schreiben, benötigen Sie diese. <br>  cmd2 eignet sich gut als Basis für interaktive Anwendungen und für diejenigen, die vom Standard-cmd migrieren möchten. <br><br>  Und Urwid bietet schöne und benutzerfreundliche Konsolenanwendungen. <br><br>  Die folgenden Pakete wurden nicht in die Überprüfung einbezogen: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Aioconsole</a> - kein nicht interaktiver Modus; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pyCLI</a> - keine Unterstützung für Unterbefehle; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Clint</a> - keine Unterstützung für Unterbefehle, Repository im Archiv; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kommandozeile</a> - es ist zu alt (letzte Veröffentlichung im Jahr 2009) und uninteressant; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">CLIArgs</a> - alt (letzte Veröffentlichung im Jahr 2010) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">opterator</a> - relativ alt (letzte Veröffentlichung im Jahr 2015) </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469093/">https://habr.com/ru/post/de469093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469075/index.html">Grokay DLR</a></li>
<li><a href="../de469077/index.html">Microsofts neuer Python-Kurs [auf Englisch]</a></li>
<li><a href="../de469079/index.html">Python in Visual Studio Code: September-Erweiterungsupdate</a></li>
<li><a href="../de469085/index.html">Wir nehmen die Software aus dem passwortgeschützten Mikrocontroller Renesas M16C heraus</a></li>
<li><a href="../de469087/index.html">MVCC in PostgreSQL-2. Gabeln, Dateien, Seiten</a></li>
<li><a href="../de469095/index.html">ML.NET- und Model Builder-Updates veröffentlicht: Was ist neu?</a></li>
<li><a href="../de469097/index.html">CentOS 8 Webserver mit PHP7, Node.js und Redis</a></li>
<li><a href="../de469099/index.html">Testaufgaben beim Interview des Entwicklers - macht das Sinn?</a></li>
<li><a href="../de469101/index.html">Englisch lernen: wie man lernt, als Muttersprachler zu sprechen</a></li>
<li><a href="../de469109/index.html">Holzspielzeug, Teil Drei - 1989</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>