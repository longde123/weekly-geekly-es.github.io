<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👸🏻 ▫️ 🏻 Panduan VRRP di MikroTik 🥈 🐻 🚱</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saat ini MikroTik tidak memiliki solusi atau protokol yang dapat ditumpuk untuk sinkronisasi perangkat keras dan penggantian perangkat. Tidak banyak s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Panduan VRRP di MikroTik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420163/"><p>  Saat ini MikroTik tidak memiliki solusi atau protokol yang dapat ditumpuk untuk sinkronisasi perangkat keras dan penggantian perangkat.  Tidak banyak solusi dengan beberapa saluran listrik.  Oleh karena itu, jika Anda memiliki tugas untuk membuat redundansi perangkat keras, maka MikroTik memiliki opsi yang sangat, sangat sedikit (dan mereka tidak akan berfungsi seperti yang mereka inginkan), salah satunya adalah vrrp. </p><a name="habracut"></a><br><p>  <strong>Apa yang Anda maksud tentang VRRP</strong> </p><br><p>  <strong>VRRP</strong> (Virtual Router Redundancy Protocol) adalah standar terbuka untuk menggabungkan sekelompok router menjadi satu router virtual untuk meningkatkan ketersediaan.  Wikipedia mengatakan "gateway default", tetapi sebenarnya itu bisa berupa router apa pun. </p><br><p>  MikroTik mendukung dua versi protokol vrrp (v2 dan v3), dalam 3 versi ada dukungan untuk IPv6, tetapi otentikasi tidak berfungsi (setidaknya ada tertulis di wiki). </p><br><p>  Saat membuat antarmuka vrrp, Anda harus menentukan ID untuk router virtual (VRID), itu bisa mengambil nilai 0-255.  Satu router nyata dapat menjadi bagian dari beberapa router virtual VRRP. </p><br><p>  Setiap router di VRID harus diatur ke Prioritas.  Router dengan prioritas tertinggi akan dipilih sebagai master dan menjadi pemegang ip virtual (alamat di mana perangkat lain di jaringan akan berkomunikasi dengan router). </p><br><p>  Master router sekali per detik (dapat diubah) mengirim pesan tentang aktivitasnya ke alamat multicast 224.0.0.18 (IPv6: FF02: 0: 0: 0: 0: 0: 0: 12) 00: 00: 5E ditentukan sebagai penerima mac: 00: 01: XX (IPv6: 00: 00: 5E: 00: 02: XX), di mana XX adalah representasi heksadesimal dari VRID. </p><br><p>  Virtual IP - alamat router virtual, yang dikonfigurasi pada antarmuka vrrp. </p><br><p>  Router virtual dapat memiliki lebih dari dua router, sementara standar terbuka dan, secara teori, Anda dapat menggunakan peralatan dari vendor yang berbeda. </p><br><p>  <strong>Beberapa komentar lagi</strong> </p><br><p>  VRRP tidak bertanggung jawab untuk menyinkronkan konfigurasi atau status koneksi.  Selain itu, MikroTik tidak memiliki alat bawaan untuk fungsi seperti itu.  Anda dapat menangkap perubahan yang dikuasai melalui log, membuat file dengan bagian yang diubah, menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">fetch untuk</a> mengirim file ke cadangan, yang akan memeriksa file dengan timer dan menjalankannya.  Atau gunakan server-pihak ketiga, yang sehari sekali akan membandingkan konfigurasi dan mengunggah perubahan ke cadangan, tetapi semua ini di luar ruang lingkup vrrp. </p><br><p>  Aplikasi utama dari skema yang diuraikan di bawah ini adalah penggunaan dua (atau lebih) router yang ditenagai dari saluran listrik (independen) yang berbeda dengan switching yang mulus jika terjadi masalah pada salah satu saluran. </p><br><p>  <strong>Skema 1. Reservasi dengan dua penyedia</strong> <br><img src="https://habrastorage.org/webt/xa/z-/th/xaz-the94olttyi207vwskacubk.png"></p><br><p>  Konfigurasi awal master MikrotTik: </p><br><pre><code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">master</span></span></code> </pre> <br><p>  Konfigurasi awal Cadangan Mikrotik: </p><br><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">2.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span></code> </pre> <br><p>  Menambahkan vrrp ke vrrp-master: </p><br><p>  [Antarmuka] -&gt; [VRRP] -&gt; [+] <br>  nama: vrrp100 (mungkin) <br>  antarmuka: eth2-lan <br>  VRID: 100 <br>  Prioritas: 150 <br>  Auth: ah <br>  Lulus: testvrrp <br>  Versi: 2 </p><br><p>  VRRP berjalan pada antarmuka LAN, jadi masuk akal untuk mengatur otentikasi untuk melindungi terhadap sabotase. </p><br><p>  Menambahkan ip layanan: <br>  [IP] -&gt; [Alamat] -&gt; [+] <br>  antarmuka: eth2-vrrp <br>  alamat: 10.10.10.1/32 </p><br><p>  <i>Dalam konfigurasi ini, sejak itu tidak perlu menggunakan / 32 alamat</i>  <i>alamat subnet yang berfungsi dan alamat layanan vrrp tidak berpotongan.</i>  <i>Saat menggunakan alamat dari subnet yang berfungsi (misalnya, 192.168.100.251 - master; 192.168.100.252 - cadangan) penggunaan / 32 adalah prasyarat, jika tidak, Anda mungkin memiliki rute ECMP ke subnet lan dan semuanya akan bekerja dengan sangat buruk.</i> <br></p><p>  Jika layanan dan alamat asli cocok, ada fitur lain.  Router di mana ip virtual akan dikonfigurasi pada antarmuka nyata, terlepas dari prioritas, dianggap sebagai master. </p><br><p>  Menambahkan ip yang berfungsi: </p><br><p>  <i>IP virtual dalam terminologi VRRP.</i> <br>  [IP] -&gt; [Alamat] -&gt; [+] <br>  antarmuka: vrrp100-lan <br>  alamat: 192.168.100.1/24 </p><br><p><img src="https://habrastorage.org/webt/10/wl/i9/10wli9mcs0j5ebxbxa6eusnq3js.jpeg"></p><br><p>  Opsi konsol: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp100-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">150</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp100-lan</code> </pre> <br><p>  Menambahkan vrrp ke cadangan vrrp: </p><br><p>  [Antarmuka] -&gt; [VRRP] -&gt; [+] <br>  nama: vrrp100-lan <br>  antarmuka: eth2-vrrp <br>  VRID: 100 <br>  Prioritas: 100 (lebih rendah dari master) <br>  Mode preemption: off <br>  Auth: ah <br>  Lulus: testvrrp <br>  Versi: 2 </p><br><p>  Mode preemption - pengaturan untuk router cadangan.  Jika diaktifkan, router tidak akan mengembalikan kontrol ke router dengan prioritas tinggi, ketika muncul di jaringan. </p><br><p>  Menambahkan ip layanan: </p><br><p>  [IP] -&gt; [Alamat] -&gt; [+] <br>  antarmuka: eth2-vrrp <br>  alamat: 10.10.10.2/32 </p><br><p>  Menambahkan ip yang berfungsi: </p><br><p>  [IP] -&gt; [Alamat] -&gt; [+] <br>  antarmuka: vrrp100-lan <br>  alamat: 192.168.100.1/24 <br><img src="https://habrastorage.org/webt/wq/dq/op/wqdqopvvuacrjdn_hqygqdtyxu8.jpeg"></p><br><p>  Opsi konsol: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp100-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">100</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> preemption-mode=no /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp100-lan</code> </pre> <br><p>  Setelah konfigurasi, koordinasi akan terjadi - router akan bertukar halo dan memutuskan prioritas mana yang lebih tinggi. <br>  Status master-Vrrp ([R] unning, [M] aster) </p><br><p><img src="https://habrastorage.org/webt/6o/xr/bw/6oxrbwwozoqgl97bjdpjma-_q_0.png"></p><br><p>  Status vrrp-backup ([B] ackup) </p><br><p><img src="https://habrastorage.org/webt/bf/3u/-r/bf3u-rt8m0h9w-jsl8rfvctch4u.png"></p><br><p>  <i>Di atas, saya mencoba untuk menamai antarmuka sejelas mungkin sehingga tidak ada kebingungan saat menambahkan aturan firewall, dll. Antarmuka vrrp100-lan bertanggung jawab untuk jaringan lokal.</i>  <i>Antarmuka eth2-vrrp bertanggung jawab atas lalu lintas vrrp teknis.</i>  <i>Jika vlan digunakan pada antarmuka LAN, maka vlan harus dikonfigurasi pada antarmuka vrrp.</i> </p><br><p>  <strong>Skema 2. Reservasi dan penyeimbangan dengan partisipasi dua penyedia</strong> <br><img src="https://habrastorage.org/webt/ok/r9/he/okr9hexpkaylgbrmbuzjekk2zjm.png"></p><br><p>  Skema sebelumnya berfungsi dengan baik, tetapi salah satu penyedia menggantung di udara dan hampir tidak pernah digunakan, Anda dapat memperbaiki situasi menggunakan beberapa rute default di jaringan.  Anda dapat mendistribusikan berbagai router default kepada pengguna yang menggunakan dhcp, atau dengan mengendarainya dengan statis.  Bagaimanapun, konfigurasi tidak fleksibel.  Tetapi contoh ini menunjukkan pengoperasian router di beberapa router vrrp virtual dengan baik. </p><br><p>  Kami mengambil skema sebelumnya sebagai dasar dan menambahkan antarmuka vrrp tambahan. </p><br><p>  Pada vrrp-master: </p><br><p><img src="https://habrastorage.org/webt/jw/k4/_a/jwk4_aaz2rudwec3cr9dowqdcj0.png"></p><br><p>  Opsi konsol: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp200-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">100</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">200</span></span> preemption-mode=no /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp200-lan</code> </pre> <br><p>  Pada cadangan-vrrp: </p><br><p><img src="https://habrastorage.org/webt/p4/np/jf/p4npjfg-odyhv85o4zcdfrkwaug.png"></p><br><p>  Opsi konsol: </p><br><pre> <code class="hljs cs">/<span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">vrrp</span></span> <span class="hljs-title"><span class="hljs-title">add</span></span> <span class="hljs-title"><span class="hljs-title">authentication</span></span>=ah <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp name=vrrp200-lan password=testvrrp priority=<span class="hljs-number"><span class="hljs-number">150</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">200</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp200-lan</code> </pre> <br><p>  <i>Karena itu tidak sepenuhnya tepat untuk menggunakan master / cadangan terminologi</i>  <i>sekarang kedua router secara bersamaan keduanya terkait dengan vrid yang berbeda.</i> </p><br><p>  Hasil untuk vrrp-master: </p><br><p><img src="https://habrastorage.org/webt/yh/ce/4w/yhce4wc5hbqmckikv10oe--qdoq.png"></p><br><p>  Hasil untuk cadangan vrrp: </p><br><p><img src="https://habrastorage.org/webt/ny/cv/wp/nycvwpaauqxeq7oxegvhcoytvv8.png"></p><br><p>  <strong>Skema 3. Reservasi dengan partisipasi satu penyedia</strong> <br><img src="https://habrastorage.org/webt/53/yp/9y/53yp9yyhao4y6lipd9ixpqqlpdq.png"></p><br><p>  Konfigurasi Master MikroTik Pendahuluan: </p><br><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">master</span></span></code> </pre> <br><p>  Konfigurasi awal Cadangan Mikrotik: </p><br><pre> <code class="hljs sql">/interface ethernet <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether1 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth1-wan disabled=yes <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> [ find <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=ether2 ] <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=eth2-vrrp /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth1-wan /ip route <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> distance=<span class="hljs-number"><span class="hljs-number">1</span></span> gateway=<span class="hljs-number"><span class="hljs-number">1.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> <span class="hljs-keyword"><span class="hljs-keyword">identity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=vrrp-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span></code> </pre> <br><p>  Penting: pada cadangan mikrotik vrrp, antarmuka eth1-wan dinonaktifkan secara default. </p><br><p>  Konfigurasi dasar VRRP mirip dengan kasus dengan dua penyedia. </p><br><p>  Konfigurasi vrrp-master: </p><br><p>  Dengan vrrp, semuanya mirip. </p><br><p><img src="https://habrastorage.org/webt/s5/7z/sv/s57zsvr5e-htlz2hii1aizsfr_a.png"></p><br><p>  Tetapi skrip tambahan muncul di [Sistem] -&gt; [Penjadwal], yang, ketika dimuat, menonaktifkan antarmuka lemah selama beberapa detik.  Ini menghindari tabrakan (jika mac telah diubah ke cadangan) atau larangan switch operator. </p><br><p><img src="https://habrastorage.org/webt/qa/io/o5/qaioo5kg_y_syjbcv1ertotdbjs.png"></p><br><p>  Opsi konsol: </p><br><pre> <code class="hljs pgsql">/interface vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication=ah interface=eth2-vrrp <span class="hljs-type"><span class="hljs-type">name</span></span>=vrrp100-lan <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>=testvrrp priority=<span class="hljs-number"><span class="hljs-number">150</span></span> version=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> interface=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> interface=vrrp100-lan /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> scheduler <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>=wan-<span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-event="/interface set eth1-wan disabled=yes\r\ \n:delay 3\r\ \n/interface set eth1-wan disabled=no" <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>=ftp,reboot,<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>,test,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,sniff,sensitive,romon <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>-<span class="hljs-type"><span class="hljs-type">time</span></span>=startup</code> </pre> <br><p>  Mengkonfigurasi cadangan-vrrp: </p><br><p>  Semuanya serupa, tetapi tindakan muncul di skrip vrrp untuk mengganti status eth1-wan. </p><br><p><img src="https://habrastorage.org/webt/w5/7e/ty/w57etyygcudn9qqhzxskte-zzfk.png"></p><br><p>  Dan sheduller ditambahkan, yang menonaktifkan eth1-wan saat boot (jika perlu, vrrp akan menyalakannya sendiri). </p><br><p><img src="https://habrastorage.org/webt/_9/tj/d1/_9tjd1imej5fdwqepyods39o9hi.png"></p><br><p>  Opsi konsol: </p><br><pre> <code class="hljs sql">/interface vrrp add authentication=ah interface=eth2-vrrp name=vrrp100-lan on-<span class="hljs-keyword"><span class="hljs-keyword">backup</span></span>=<span class="hljs-string"><span class="hljs-string">"/interface set eth1-wan disabled=yes\r\ \n"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">master</span></span>=<span class="hljs-string"><span class="hljs-string">"/interface set eth1-wan disabled=no"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>=testvrrp preemption-<span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>=<span class="hljs-number"><span class="hljs-number">2</span></span> vrid=<span class="hljs-number"><span class="hljs-number">100</span></span> /ip address <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">10.10</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=eth2-vrrp <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> address=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span>=vrrp100-lan /<span class="hljs-keyword"><span class="hljs-keyword">system</span></span> scheduler <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>=wan-<span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>=<span class="hljs-string"><span class="hljs-string">"/interface set eth1-wan disabled=yes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">ftp</span></span>,reboot,<span class="hljs-keyword"><span class="hljs-keyword">read</span></span>,write,<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,sniff,sensitive,romon <span class="hljs-keyword"><span class="hljs-keyword">start</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">time</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">startup</span></span></code> </pre> <br><p>  <i>Jika penyedia membatasi akses ke mac, maka jangan lupa untuk mengubahnya pada antarmuka router cadangan.</i> </p><br><p>  Dalam skema ini, kami memiliki titik lemah - saklar di depan antarmuka yang lemah.  Dimungkinkan untuk setuju dengan penyedia bahwa itu akan menuntun Anda dua kabel dan mereka akan terhubung ke segmen jaringan yang berbeda dengan penerusan vlan, dll.  Atau ... letakkan <a href="">tee pasif</a> , tetapi ini adalah pornografi yang mengerikan dan di awal setiap router akan ada beberapa tabrakan, tetapi ini fungsional (jika Anda tidak mengaktifkan eth1-wan pada router cadangan dengan tangan Anda). </p><br><p>  Dan tentu saja, Anda dapat menggunakan vrrp pada antarmuka wan (jika pengaturannya statis), tetapi kemudian pemasangan sakelar tambahan, atau negosiasi dengan penyedia tidak dapat dihindari. </p><br><p>  <strong>Skema 4. Reservasi dengan partisipasi salah satu penyedia WISP</strong> <br><img src="https://habrastorage.org/webt/mf/w_/wf/mfw_wftbhb8ewsnepmsebq1egze.png"></p><br><p>  Tampaknya bagi Anda bahwa vrrp adalah kesalahpahaman yang aneh bahwa Anda tidak dapat berpikir untuk menggunakan di luar laboratorium tanpa kruk.  Bahkan, ada satu skema, sangat mirip dengan yang sebelumnya, tetapi dibangun di atas jembatan nirkabel. </p><br><p>  Penyedia memiliki ap-jembatan (lebih disukai dengan area cakupan luas).  Di sisi klien, ada dua pelat (misalnya, SXT dengan satu eter) yang ditempatkan di tiang yang berbeda (atau sudut bangunan), yang didukung oleh saluran listrik yang berbeda, tetapi menyediakan akses Internet untuk subnet yang sama. </p><br><p>  Pengaturannya benar-benar mirip dengan skema sebelumnya, hanya antarmuka wan yang akan menjadi wlan1, dan antarmuka lan eter1.  Pelat dapat dikonfigurasi sebagai statis mungkin, dan semua lalu lintas dapat dikontrol pada perangkat tambahan di belakangnya.  Ini adalah skema anti-perusak yang sepenuhnya berfungsi, tanpa interaksi tambahan dengan penyedia. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420163/">https://habr.com/ru/post/id420163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420153/index.html">Pencetakan 3D bagian kompleks yang terbuat dari ABS dan PLA dengan banyak dukungan</a></li>
<li><a href="../id420155/index.html">Intel Datacenter SSD. Volume besar dan nama baru</a></li>
<li><a href="../id420157/index.html">Pemodelan Fungsional SJ-meetup Menggunakan Kasus Penggunaan</a></li>
<li><a href="../id420159/index.html">Layanan Web Docking dalam R dan Python</a></li>
<li><a href="../id420161/index.html">1.500 publikasi, permainan captcha untuk programmer dan otak yang rusak: 10 tahun ke blog kami</a></li>
<li><a href="../id420167/index.html">MBLT DEV 2018: kenaikan harga dan pembicara baru</a></li>
<li><a href="../id420171/index.html">ICO 2.0 dan tokenization bisnis</a></li>
<li><a href="../id420173/index.html">Arsitektur IoT - tampilan pertama di bawah tenda</a></li>
<li><a href="../id420175/index.html">Vanessa-Automation adalah alat dokumentasi mandiri untuk solusi terapan pada platform 1C: Enterprise. Bioskop dan BDD</a></li>
<li><a href="../id420177/index.html">Konferensi Peretas DEFCON. Speed ​​Hacks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>