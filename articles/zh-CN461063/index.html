<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧗🏼 🤾🏽 👰🏿 R与Microsoft SQL Server和其他DBMS上的数据库的交互 🎪 🔄 🈁</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="由于大部分业务信息都存储在数据库中。 无论使用哪种编程语言，都必须对它们执行各种操作。 


 在本文中，我将讨论在R中使用数据库的两个接口。大多数示例演示了如何使用Microsoft SQL Server，但是，所有代码示例都将与其他数据库一起使用，例如：MySQL，PostgreSQL，SQLi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R与Microsoft SQL Server和其他DBMS上的数据库的交互</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461063/"><p> 由于大部分业务信息都存储在数据库中。 无论使用哪种编程语言，都必须对它们执行各种操作。 </p><br><p> 在本文中，我将讨论在R中使用数据库的两个接口。大多数示例演示了如何使用Microsoft SQL Server，但是，所有代码示例都将与其他数据库一起使用，例如：MySQL，PostgreSQL，SQLite，ClickHouse ，Google BigQuery等。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/925/a23/786/925a23786a89917d9a314a793545cbb1.jpg" alt="图片"></p><a name="habracut"></a><br><h1 id="soderzhanie"> 目录内容 </h1><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">所需软件</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DBI软件包</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">基本DBI功能列表</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">数据库连接</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用odbc包连接到Microsoft SQL Server的示例</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用RMSSQL包连接到Microsoft SQL Server的示例</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何在R脚本中隐藏数据库密码</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">创建表并写入数据库</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">从DBMS读取数据</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DBMS（DML）中的数据处理</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">DBMS中的事务</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RODBC套件</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RODBC软件包的主要功能</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">使用RODBC的示例</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">交易性</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">结论</a> </li></ul><br><h1 id="trebuemoe-programmnoe-obespechenie"> 所需软件 </h1><br><p> 为了重复使用本文中描述的使用DBMS的所有示例，您将需要下面列出的以下免费软件： </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">语言R</a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">RStudio</a>开发环境； </li><li> 数据库管理系统，可供选择： <br>  3.1。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Microsoft SQL服务器</a> <br>  3.2。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的MySQL</a> <br>  3.3。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PostgreSQL的</a> </li></ol><br><h1 id="paket-dbi">  DBI软件包 </h1><br><p> <code>DBI</code>软件包是与R中的数据库进行交互的最流行，最方便的方法。 </p><br><p>  <code>DBI</code>为您提供了一组可以用来管理数据库的功能。 但是，要连接到数据库，您需要安装其他软件包，这些软件包是各种数据库管理系统（DBMS）的驱动程序。 </p><br><h3 id="spisok-osnovnyh-funkciy-dbi"> 基本DBI功能列表 </h3><br><ul><li>  <code>dbConnect</code>与数据库的连接； </li><li>  <code>dbWriteTable</code>将表写入数据库； </li><li>  <code>dbReadTable</code>从数据库加载表； </li><li>  <code>dbGetQuery</code>加载查询执行的结果； </li><li>  <code>dbSendQuery</code>向数据库发送查询； </li><li>  <code>dbFetch</code>从结果集中提取元素； </li><li>  <code>dbExecute</code>执行更新/删除/向表中插入数据的请求； </li><li>  <code>dbGetInfo</code>请求有关请求或连接结果的信息； </li><li>  <code>dbListFields</code>请求表字段列表； </li><li>  <code>dbListTables</code>查询数据库表列表； </li><li>  <code>dbExistsTable</code>检查数据库中是否存在表； </li><li>  <code>dbRemoveTable</code>从数据库中删除表； </li><li>  <code>dbDisconnect</code>与数据库断开连接。 </li></ul><br><h3 id="podklyuchenie-k-bazam-dannyh"> 数据库连接 </h3><br><p> 要与数据库进行交互，必须首先连接到它们。 根据您计划使用的DBMS，您将需要一个额外的软件包，下面是最常用的软件包的列表。 </p><br><ul><li>  <code>odbc</code>通过ODBC接口进行连接的驱动程序； </li><li>  <code>RSQLite</code> -SQLite驱动程序； </li><li>  <code>RMySQL</code> / <code>RMariaDB</code> -MySQL和MariaDB的驱动程序； </li><li>  <code>RPostgreSQL</code> - <code>RPostgreSQL</code>驱动程序； </li><li>  <code>bigrquery</code> -Google BigQuery的驱动程序； </li><li>  <code>RClickhouse</code> / <code>clickhouse</code> - <code>clickhouse</code>驱动程序； </li><li>  <code>RMSSQL</code>用于Microsoft SQL Server（MS SQL）的驱动程序， <em>在撰写本文时仅在GitHub上提供</em> 。 </li></ul><br><p>  <code>DBI</code>软件包是基本R软件包随附的，但是必须使用<code>install.packages(" ")</code>命令<code>install.packages(" ")</code>安装作为数据库驱动程序的软件包。 </p><br><p> 要从GitHub安装软件包，您还需要其他软件包<code>devtools</code> 。 例如， <code>RMSSQL</code>软件包当前未发布在主R软件包存储库中，请使用以下代码进行安装： </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><h4 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-odbc"> 使用odbc包连接到Microsoft SQL Server的示例 </h4><br><p> 在R会话中使用任何软件包之前，必须首先使用<code>library(" ")</code>函数<code>library(" ")</code>进行连接。 </p><br><p> 我并非没有理由选择Microsoft SQL Server作为主要的DBMS，它将提供本文中的大多数示例。 事实是，这是一个相当流行的数据库，但与此同时，它仍然没有用于从CRAN上发布的R连接的驱动程序。 </p><br><p> 但是幸运的是，SQL Server与几乎所有其他数据库一样，都具有用于连接的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ODBC</a> （英语开放数据库连接）接口。 有许多软件包可通过R中的ODBC接口连接到DBMS。 首先，我们将研究通过<code>odbc</code>包进行连接。 </p><br><div class="spoiler">  <b class="spoiler_title">通过odbc接口轻松连接数据库</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   odbc install.packages("odbc") #   library(odbc) #   MS SQL con &lt;- dbConnect(drv = odbc(), Driver = "SQL Server", Server = "localhost", Database = "mybase", UID = "my_username", PWD = "my_password", Port = 1433)</code> </pre> </div></div><br><p> 在<code>dbConnect()</code>函数中，您需要传递该函数作为<em>drv</em>的第一个参数，该函数是用于连接到DBMS的驱动程序（ <code>odbc()</code> ）。 通常将此类功能与DBMS称为相同功能，并且随附有作为<code>DBI</code>驱动程序的软件包。 </p><br><p> 接下来，您需要列出连接参数。 要通过ODBC连接到MS SQL，必须指定以下参数： </p><br><ul><li> 驱动程序-ODBC驱动程序的名称； </li><li> 服务器-SQL服务器的IP地址； </li><li> 数据库-要连接的数据库的名称； </li><li>  UID-数据库用户名； </li><li>  PWD-密码； </li><li> 端口-与SQL Server连接的端口，默认端口为1433。 </li></ul><br><p>  Windows附带有用于连接到Microsoft SQL Server的ODBC驱动程序，但它的名称可能不同。 您可以在ODBC数据源管理器中查看已安装驱动程序的列表。 您可以通过以下方式在Windows 10中启动数据源管理员： </p><br><ul><li>  32位版本： <code>%systemdrive%\Windows\SysWoW64\Odbcad32.exe</code> </li><li>  64位版本： <code>%systemdrive%\Windows\System32\Odbcad32.exe</code> </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6c/816/934/c6c816934a70e2386a4547d7626d515f.png"></p><br><p> 您还可以使用<code>odbcListDrivers()</code>函数获得PC上安装的所有驱动程序的列表。 </p><br><pre> <code class="plaintext hljs"> name attribute value &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 SQL Server APILevel 2 2 SQL Server ConnectFunctions YYY 3 SQL Server CPTimeout 60 4 SQL Server DriverODBCVer 03.50 5 SQL Server FileUsage 0 6 SQL Server SQLLevel 1 7 SQL Server UsageCount 1 8 MySQL ODBC 5.3 ANSI Driver UsageCount 1 9 MySQL ODBC 5.3 Unicode Driver UsageCount 1 10 Simba ODBC Driver for Google BigQuery Description Simba ODBC Driver for Google BigQuery2.0 # ... with 50 more rows</code> </pre> <br><p> 您可以通过以下链接下载其他DBMS的ODBC驱动程序： </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的MySQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PostgreSQL的</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">谷歌bigquery</a> </li></ul><br><p> 对于各种DBMS，用于连接的参数名称可能不同，例如： </p><br><ul><li>  PostgreSQL / MySQL / MariaDB-用户，密码，主机，端口，dbname; </li><li>  GoogleBigQuery-项目，数据集； </li><li>  ClickHouse-用户，密码，数据库，端口，主机； </li></ul><br><p> 使用ODBC数据源管理员，您可以运行向导来创建ODBC数据源。 为此，只需打开管理员，转到“自定义DSN”选项卡，然后单击“添加...”按钮。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9ae/e92/ba3/9aee92ba30bdc8de811623aae1fb58fa.png"></p><br><p> 使用管理员创建数据源时，请给它命名DSN（数据源名称）。 </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b03/a0c/a7c/b03a0ca7c90fa0d5bddccb53575563a3.png"></p><br><p> 在上面的示例中，我们使用DSN“ my_test_source”创建了一个数据源。 现在，我们可以使用此源连接到Microsoft SQL Server，而无需在代码中指定其他连接参数。 </p><br><div class="spoiler">  <b class="spoiler_title">使用DSN通过odbc接口连接到数据库</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password")</code> </pre> </div></div><br><p> 您可以使用<code>odbcListDataSources()</code>函数查看在PC上创建的所有ODBC数据源的名称。 </p><br><pre> <code class="plaintext hljs"> name description &lt;chr&gt; &lt;chr&gt; 1 BQ Simba ODBC Driver for Google BigQuery 2 BQ_main Simba ODBC Driver for Google BigQuery 3 BQ ODBC Simba ODBC Driver for Google BigQuery 4 OLX Simba ODBC Driver for Google BigQuery 5 Multicharts Simba ODBC Driver for Google BigQuery 6 PostgreSQL35W PostgreSQL Unicode(x64) 7 hillel_bq Simba ODBC Driver for Google BigQuery 8 blog_bq Simba ODBC Driver for Google BigQuery 9 MyClientMSSQL SQL Server 10 local_mssql SQL Server 11 MSSQL_localhost SQL Server 12 my_test_source SQL Server 13 Google BigQuery Simba ODBC Driver for Google BigQuery</code> </pre> <br><h3 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-rmssql"> 使用RMSSQL包连接到Microsoft SQL Server的示例 </h3><br><p>  <code>RMSSQL</code>不在CRAN上发布，因此您可以使用<code>devtools</code>软件包从GitHub安装它。 </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">使用DBI RMSSQL驱动程序的连接示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    library(RJDBC) library(RMSSQL) library(DBI) #  RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase")</code> </pre> </div></div><br><p> 在大多数情况下，使用<code>DBI</code>包处理数据库时，将以这种方式进行连接。 即 安装所需的驱动程序包之一，将<code>dbConnect</code>函数作为<em>drv</em>参数的值传递，该驱动程序函数用于连接到所需的DBMS。 </p><br><div class="spoiler">  <b class="spoiler_title">连接到MySQL，PostgreSQL，SQLite和BigQuery的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   MySQL library(RMySQL) con &lt;- dbConnect(MySQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   SQLite library(RSQLite) # connection or create base con &lt;- dbConnect(drv = SQLite(), "localhost.db") #   Google BigQuery library(bigrquery) con &lt;- dbConnect(drv = bigquery(), project = "my_proj_id", dataset = "dataset_name")</code> </pre> </div></div><br><h3 id="kak-skryt-paroli-ot-bazy-dannyh-v-r-skriptah"> 如何在R脚本中隐藏数据库密码 </h3><br><p> 上面，我给出了一些示例，可用于连接到任何数据库，但是它们有一个缺点，这种形式将所有数据库访问（包括密码）都以文本形式存储在脚本本身中。 </p><br><p> 如果所有脚本都在PC上本地部署和运行，并且同时受密码保护，那么很可能不会出现问题。 但是，如果您与同一台服务器上的某人一起工作，那么将数据库中的密码存储在脚本文本中并不是最佳解决方案。 </p><br><p> 每个操作系统都有一个用于管理凭据的实用程序。 例如，在Windows上，这是凭据管理器。 您可以将用于通过<code>keyring</code>包连接到数据库的密码添加到此存储中。 该软件包是跨平台的，以上示例可在任何操作系统上运行，至少在Windows，MacOS和Linux上适用。 </p><br><pre> <code class="plaintext hljs"># install.packages("keyring") #   library(keyring) library(RMSSQL) #   key_set_with_value(service = "mssql", username = "my_username", password = "my_password") #   RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = key_get("mssql", "my_username"), dbname = "mybase")</code> </pre> <br><p> 即 使用<code>key_set_with_value()</code>函数，可以将密码添加到凭据存储中，然后使用<code>key_get()</code>请求密码，只有将其添加到存储中的用户才能请求密码。 使用<code>keyring</code>您不仅可以存储数据库中的密码<code>keyring</code>还可以存储任何服务中的密码以及使用API​​时的授权令牌。 </p><br><h3 id="sozdanie-tablic-i-zapis-v-bazu-dannyh"> 创建表并写入数据库 </h3><br><p> 写入数据库是通过<code>dbWriteTable()</code>函数执行的。 </p><br><p>  <code>dbWriteTable()</code>函数的参数： </p><br><p>  <em>必填参数为粗体，斜体为可选</em> </p><br><ul><li>  <code>dbConnect</code>使用<code>dbConnect</code>函数创建的DBMS连接对象； </li><li>  <strong>name</strong> -DBMS中要写入数据的表的名称； </li><li>  <strong>value</strong> -R中的表（data.frame / data.table / tibble_frame类的对象），该表中的数据将被写入DBMS； </li><li>  <em>row.names-</em>将具有行号的row_names列添加到表中， <em>默认为FALSE</em> 。 </li><li>  <em>overwrite-</em>如果DBMS中已经存在具有<em>name</em>参数中指定名称的表，则覆盖该表； <em>默认值为FALSE</em> ；否则<em>为false</em> 。 </li><li>  <em>append-</em>如果DBMS中已经存在具有在<em>name</em>参数中指定的<em>名称</em>的表，则追加数据； <em>默认值为FALSE</em> ；否则<em>为false</em> 。 </li><li>  <em>field.types-</em>接受命名向量，并在写入DBMS时在每个字段中设置数据类型， <em>默认为NULL</em> ； </li><li>  <em>临时</em> -允许您在DBMS中创建临时表，直到断开与数据库的连接为止，这些表才可用； <em>默认值为FALSE</em> 。 </li></ul><br><div class="spoiler">  <b class="spoiler_title">通过DBI将数据写入DBMS的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #     DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     iris,         R  iris dbWriteTable(conn = con, name = "iris", value = iris) #     dbDisconnect(con)</code> </pre> </div></div><br><p> 要查看数据库中的表，请使用<code>dbListTables()</code>函数，删除表<code>dbRemoveTable()</code> </p><br><div class="spoiler">  <b class="spoiler_title">查询表列表并从DBMS删除表的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #    dbListTables(con) #   iris dbRemoveTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="chtenie-dannyh-iz-subd"> 从DBMS读取数据 </h3><br><p> 使用<code>DBI</code>您可以查询整个表或执行SQL查询的结果。  <code>dbReadTable()</code>和<code>dbGetQuery()</code>函数用于执行这些操作。 </p><br><div class="spoiler">  <b class="spoiler_title">从DBMS查询虹膜表的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   iris   iris dbiris &lt;- dbReadTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">从DBMS加载SQL执行结果的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     setosa &lt;- dbGetQuery(con, "SELECT * FROM iris WHERE Species = 'setosa'") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="manipulirovanie-dannymi-v-subd-dml">  DBMS（DML）中的数据处理 </h3><br><p> 上面<code>dbGetQuery()</code>的<code>dbGetQuery()</code>函数专门用于查询数据样本（SELECT）。 </p><br><p> 对于诸如UPDATE，INSERT，DELETE之类的数据操作操作， <code>DBI</code>存在<code>dbExecute()</code>函数。 </p><br><div class="spoiler">  <b class="spoiler_title">在DBMS中处理数据的示例代码</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   (INSERT) dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   (UPDATE) dbExecute(con, "UPDATE iris SET [Species] = 'old_value' WHERE row_names = 51") #     (DELETE) dbExecute(con, "DELETE FROM iris WHERE row_names = 51") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="tranzakcii-v-subd">  DBMS中的事务 </h3><br><blockquote> 事务是顺序的读写操作。 事务的结尾可以是保存更改（提交，提交）或取消更改（回滚，回滚）。 关于数据库，事务是一系列查询，被视为单个查询。 </blockquote><p>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">引用文章“交易及其控制机制”</a></em> </p><br><p> 事务将几个SQL语句封装在一个基本单元中。 在<code>DBI</code>事务的开始由<code>dbBegin()</code>启动，然后由<code>dbCommit()</code>确认或由<code>dbRollback()</code>取消。 在任何情况下，DBMS都保证：将所有语句或全部语句都不应用于数据。 </p><br><p> 例如，在交易过程中，让我们向虹膜表添加51行，然后将<em>Sepal.Width</em>值更改为5行，并从表中删除43行。 </p><br><div class="spoiler">  <b class="spoiler_title">交易代码示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbCommit(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5 8.0 1.4 0.2 setosa # 2 51 7 3.2 4.7 1.4 versicolor # 3 51 5 3.3 1.7 0.3 new_values</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">交易取消代码示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbRollback(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor</code> </pre> </div></div><br><h1 id="paket-rodbc">  RODBC套件 </h1><br><p>  <code>RODBC</code>软件包提供了一个独立的接口，用于通过ODBC接口连接和使用DBMS。 </p><br><p>  <code>RODBC</code>不兼容<code>DBI</code> ，即 您不能在<code>DBI</code>软件包提供的函数中使用使用<code>RODBC</code>创建的连接对象。 </p><br><h3 id="osnovnye-funkcii-paketa-rodbc">  RODBC软件包的主要功能 </h3><br><ul><li>  <code>odbcConnect</code>通过DSN连接到DBMS； </li><li>  <code>odbcDriverConnect</code>通过连接字符串连接到数据库； </li><li>  <code>sqlQuery</code>将查询发送到DBMS，并获取其执行结果。 支持任何类型的查询：SELECT，UPDATE，INSERT，DELETE。 </li><li>  <code>sqlFetch</code>从DBMS获取整个表； </li><li>  <code>sqlTables</code>获取数据库中表的列表。 </li><li>  <code>sqlSave</code>在数据库中创建一个新表，或向现有表中添加新数据； </li><li>  <code>sqlUpdate</code>更新DBMS中已经存在的表中的数据； </li><li>  <code>sqlDrop</code>删除DBMS中的表； </li><li>  <code>odbcClose</code>终止与DBMS的连接。 </li></ul><br><h3 id="primer-raboty-s-rodbc"> 使用RODBC的示例 </h3><br><p> 在我看来， <code>RODBC</code>功能不如<code>DBI</code> ，但它具有使用DBMS所需的所有必要功能。 </p><br><div class="spoiler">  <b class="spoiler_title">通过RODBC与DBMS交互的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   con_string &lt;- odbcDriverConnect(connection = "Driver=SQL Server;Server=localhost;Database=mybase;UID=my_username;PWD=my_password;Port=1433") #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #     iris sqlSave(con_dsn, dat = iris, tablename = "iris", append = TRUE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #   sqlDrop(con_dsn, sqtable = "iris") #     odbcCloseAll()</code> </pre> </div></div><br><h1 id="tranzakcionnost"> 交易性 </h1><br><p> 默认情况下， <code>RODBC</code>事务性处于关闭状态。 交易管理由两个功能执行。 </p><br><ul><li>  <code>odbcSetAutoCommit</code>在正常和事务DBMS操作模式之间切换； </li><li>  <code>odbcEndTran</code>确认或取消交易。 </li></ul><br><p>  <code>odbcSetAutoCommit</code>函数使用<em>autoCommit</em>参数打开和关闭事务模式。 </p><br><div class="spoiler">  <b class="spoiler_title">在RODBC中以事务模式工作的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #    odbcSetAutoCommit(con_dsn, autoCommit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #   odbcEndTran(con_dsn, commit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   odbcEndTran(con_dsn, commit = TRUE) #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     odbcClose(con_dsn)</code> </pre> </div></div><br><h1 id="zaklyuchenie"> 结论 </h1><br><p> 本文介绍的使用R， <code>DBI</code>和<code>RODBC</code>语言处理数据库的两种方法非常通用，几乎可以与任何DBMS一起使用。 </p><br><p> 不同DBMS之间的唯一操作区别是连接过程。 对于大多数流行的DBMS，有单独的程序包是驱动程序。 对于其余的DBMS，必须使用<code>odbc</code>或<code>RODBC</code>通过ODBC接口配置连接。 不管您选择了哪种DBMS，其他所有操作都将保持不变。 根据正在使用的DBMS支持的SQL方言，发送SQL查询是一个例外。 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN461063/">https://habr.com/ru/post/zh-CN461063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN461053/index.html">我们将在线地图连接到智能手机上的导航器。 第2部分-矢量卡</a></li>
<li><a href="../zh-CN461055/index.html">Rekko Challenge 2019：怎么样</a></li>
<li><a href="../zh-CN461057/index.html">有关游戏开发的电报频道</a></li>
<li><a href="../zh-CN461059/index.html">为电影迷编写一个Android应用-第1部分（原型设计）</a></li>
<li><a href="../zh-CN461061/index.html">镁合金，双晶界和偏析</a></li>
<li><a href="../zh-CN461067/index.html">您应该在2019年准备的工作面试中的前65个SQL问题。 第一部分</a></li>
<li><a href="../zh-CN461069/index.html">诺贝尔户外IP摄像机：Ivideon视频监控系统的测试，技术和功能</a></li>
<li><a href="../zh-CN461071/index.html">针对建筑商的B2B服务示例优化数据库查询</a></li>
<li><a href="../zh-CN461073/index.html">我们将在线地图连接到智能手机上的导航器。 第3部分-天桥涡轮增压</a></li>
<li><a href="../zh-CN461075/index.html">商业智能。 IT对象，组件，工具</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>