<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙄 🛐 😌 Récupération de données à partir de tables XtraDB sans fichier de structure à l'aide de l'analyse d'octets du fichier ibd 👨🏾 ⬆️ 🔈</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Contexte 


 Il se trouve que le serveur a été attaqué par un virus rançongiciel qui, par un "coup de chance", a partiellement mis de côté les fichier...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Récupération de données à partir de tables XtraDB sans fichier de structure à l'aide de l'analyse d'octets du fichier ibd</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453368/"><p><img src="https://habrastorage.org/getpro/habr/post_images/03c/9b3/e38/03c9b3e38fcb18bd367a89bfe4703e44.png" alt="image"></p><br><h3 id="predystoriya">  Contexte </h3><br><p>  Il se trouve que le serveur a été attaqué par un virus rançongiciel qui, par un "coup de chance", a partiellement mis de côté les fichiers .ibd (fichiers de données brutes des tables innodb), mais a complètement chiffré les fichiers .fpm (fichiers de structure).  En même temps, .idb pourrait être divisé en: </p><br><ul><li>  sous réserve de récupération au moyen d'outils et de guides standard.  Pour de tels cas, il y a un excellent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> ; </li><li>  tables partiellement cryptées.  La plupart du temps, ce sont de grandes tables sur lesquelles (si j'ai bien compris), les attaquants n'avaient pas assez de RAM pour un cryptage complet; </li><li>  Eh bien, des tables entièrement cryptées qui ne peuvent pas être récupérées. <a name="habracut"></a></li></ul><br><p>  Il a été possible de déterminer à quelle option appartiennent les tables en ouvrant dans n'importe quel éditeur de texte sous l'encodage souhaité (dans mon cas c'est UTF8) et en regardant simplement le fichier pour la présence de champs de texte, par exemple: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/174/210/7be/1742107bed20737a14746a046ae1f560.png" alt="image"></p><br><p>  De plus, au début du fichier, vous pouvez observer un grand nombre de 0 octets, et les virus qui utilisent l'algorithme de chiffrement par blocs (le plus courant) les affectent généralement. <br><img src="https://habrastorage.org/getpro/habr/post_images/22b/5bc/3e3/22b5bc3e34d8165ce204c646389297ec.png" alt="image"></p><br><p>  Dans mon cas, les attaquants à la fin de chaque fichier chiffré ont laissé une chaîne de 4 octets (1, 0, 0, 0), ce qui a simplifié la tâche.  Un script était suffisant pour rechercher des fichiers non infectés: </p><cut text=""></cut><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">opened</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(path)</span></span></span><span class="hljs-function">:</span></span> files = os.listdir(path) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> files: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(path + f): <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> path + f <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> full_path <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> opened(<span class="hljs-string"><span class="hljs-string">"C:\\some\\path"</span></span>): file = open(full_path, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>) last_string = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> file: last_string = line file.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (last_string[len(last_string) <span class="hljs-number"><span class="hljs-number">-4</span></span>:len(last_string)]) != (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>): print(full_path)</code> </pre> <cut></cut><br><p>  Il s'est donc avéré trouver des fichiers appartenant au premier type.  Le second implique un manuel long, mais déjà trouvé suffisait.  Tout irait bien, mais vous devez connaître la <strong>structure absolument exacte</strong> et (bien sûr) il y avait un tel cas que je devais travailler avec une table qui changeait fréquemment.  Personne ne se souvenait si le type de champ changeait ou si une nouvelle colonne était ajoutée. </p><br><p>  Malheureusement, Debri City n'a pas pu aider avec cette affaire, donc cet article est en cours de rédaction. </p><br><h3 id="blizhe-k-delu">  Aller droit au but </h3><br><p>  Il y a une structure de table d'il y a 3 mois qui ne coïncide pas avec celle actuelle (peut-être un champ, mais peut-être plus).  Structure du tableau: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`table_1`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`date`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`description`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TEXT</span></span> , <span class="hljs-string"><span class="hljs-string">`id_point`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`id_user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`date_start`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`date_finish`</span></span> DATETIME , <span class="hljs-string"><span class="hljs-string">`photo`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">`id_client`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">11</span></span>), <span class="hljs-string"><span class="hljs-string">`status`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-string"><span class="hljs-string">`lead__time`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">TIME</span></span> , <span class="hljs-string"><span class="hljs-string">`sendstatus`</span></span> TINYINT (<span class="hljs-number"><span class="hljs-number">4</span></span>) );</code> </pre> <br><p>  dans ce cas, vous devez extraire: </p><br><ul><li>  <code>id_point</code> INT (11); </li><li>  <code>id_user</code> INT (11); </li><li>  <code>date_start</code> DATETIME; </li><li>  <code>date_finish</code> DATETIME. </li></ul><br><p>  Pour la récupération, une analyse d'octets du fichier .ibd est utilisée, suivie de leur traduction sous une forme plus lisible.  Étant donné que pour trouver ce qui est nécessaire, il nous suffit d'analyser des types de données tels que int et datatime, seuls ils seront décrits dans l'article, mais parfois ils se référeront également à d'autres types de données, ce qui peut aider dans d'autres incidents similaires. </p><br><p>  <strong>Problème 1</strong> : les champs avec les types DATETIME et TEXT avaient une valeur NULL, et ils sont simplement ignorés dans le fichier, pour cette raison, il n'a pas été possible de déterminer la structure de récupération dans mon cas.  Dans les nouvelles colonnes, la valeur par défaut était nulle et certaines des transactions pouvaient être perdues en raison du paramètre innodb_flush_log_at_trx_commit = 0, donc du temps supplémentaire devait être consacré à déterminer la structure. </p><br><p>  <strong>Problème 2</strong> : il convient de noter que les lignes supprimées via DELETE seront toutes exactement dans le fichier ibd, mais leur structure ne sera pas mise à jour avec ALTER TABLE.  Par conséquent, la structure des données peut varier du début du fichier à sa fin.  Si vous utilisez souvent OPTIMIZE TABLE, il est peu probable que vous rencontriez un problème similaire. </p><br><p>  <strong>Veuillez noter</strong> que la version du SGBD affecte la façon dont les données sont stockées, et cet exemple peut ne pas fonctionner pour les autres versions principales.  Dans mon cas, la version Windows mariadb 10.1.24 a été utilisée.  De plus, bien que dans mariadb vous travailliez avec des tables InnoDB, il s'agit en fait de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">XtraDB</a> , ce qui exclut l'applicabilité de la méthode avec InnoDB mysql. </p><br><h3 id="analiz-fayla">  Analyse de fichiers </h3><br><p>  En python, le type de données <a href="">bytes ()</a> affiche les données en Unicode au lieu de l'ensemble habituel de nombres.  Bien que vous puissiez considérer le fichier sous cette forme, mais pour plus de commodité, vous pouvez convertir les octets en une forme numérique en traduisant le tableau d'octets en un tableau normal (liste (exemple_arbre_array)).  Dans tous les cas, les deux méthodes sont utiles pour l'analyse. </p><br><p>  Après avoir consulté plusieurs fichiers ibd, vous pouvez trouver les éléments suivants: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d5d/2d6/512/d5d2d6512bd39fcb0d8d9764e23a5d91.png" alt="image"></p><br><p>  De plus, si vous divisez le fichier par ces mots-clés, vous obtiendrez principalement des blocs de données plats.  Nous utiliserons infimum comme diviseur. </p><br><pre> <code class="python hljs">table = table.split(<span class="hljs-string"><span class="hljs-string">"infimum"</span></span>.encode())</code> </pre> <br><p>  Une observation intéressante, pour les tables avec une petite quantité de données, entre infimum et supremum, il y a un pointeur sur le nombre de lignes dans le bloc. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c74/8f3/ec1/c748f3ec108e8bec2dec0c71c2ef2911.png" alt="image">  - table de test avec 1ère rangée </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d89/f17/970/d89f179703c5e18456efcaaed194d8ee.png" alt="image">  - table de test avec 2 rangées </p><br><p>  Le tableau de la table de lignes [0] peut être ignoré.  Après l'avoir regardé, je ne pouvais toujours pas trouver les données brutes des tableaux.  Très probablement, ce bloc est utilisé pour stocker les index et les clés. <br>  En commençant par le tableau [1] et en le traduisant en un tableau numérique, vous pouvez déjà remarquer certains modèles, à savoir: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cf0/48f/44d/cf048f44d77573d0261cf58d79c8ee8b.png" alt="image"></p><br><p>  Ce sont des valeurs int stockées dans une chaîne.  Le premier octet indique si le nombre est positif ou négatif.  Dans mon cas, tous les chiffres sont positifs.  À partir des 3 octets restants, vous pouvez déterminer le nombre à l'aide de la fonction suivante.  Script: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_int</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val: str)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># example '128, 1, 2, 3' val = [int(v) for v in val.split(", ")] result_int = val[1]*256**2 + val[2]*256*1 + val[3] return result_int</span></span></code> </pre> <br><p>  Par exemple, <em>128, 0, 0, 1 = 1</em> ou <em>128, 0, 75, 108 = 19308</em> . <br>  La table avait une clé primaire avec incrémentation automatique, et ici vous pouvez également la trouver </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b3f/43b/70b/b3f43b70b07f22365ecef4b92934335b.png" alt="image"></p><br><p>  En comparant les données des tables de test, il a été révélé que l'objet DATETIME se compose de 5 octets, en commençant par 153 (indiquant probablement des intervalles annuels).  Étant donné que la plage DATTIME est de '1000-01-01' à '9999-12-31', je pense que le nombre d'octets peut varier, mais dans mon cas, les données tombent entre 2016 et 2019, nous supposons donc que 5 octets suffisent . </p><br><p>  Pour déterminer le temps sans secondes, les fonctions suivantes ont été écrites.  Script: </p><br><pre> <code class="python hljs">day_ = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x % <span class="hljs-number"><span class="hljs-number">64</span></span> // <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-comment"><span class="hljs-comment"># {x,x,X,x,x } def hour_(x1, x2): # {x,x,X1,X2,x} if x1 % 2 == 0: return x2 // 16 elif x1 % 2 == 1: return x2 // 16 + 16 else: raise ValueError min_ = lambda x1, x2: (x1 % 16) * 4 + (x2 // 64) # {x,x,x,X1,X2}</span></span></code> </pre> <cut></cut><br><p>  Pendant un an et un mois, il n'a pas été possible d'écrire une fonction de travail saine, j'ai donc dû coder en dur.  Script: </p><br><pre> <code class="python hljs">ym_list = {<span class="hljs-string"><span class="hljs-string">'2016, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 152, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 153, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 154, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2016, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 155, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 156, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 157, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2017, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 158, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 159, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 160, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2018, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 161, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 162, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 163, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2019, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 164, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 1'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 2'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 3'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 165, 192'</span></span>,<span class="hljs-string"><span class="hljs-string">'2020, 4'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 5'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 64'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 6'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 1, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 7'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 166, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 8'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 9'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 64'</span></span>,<span class="hljs-string"><span class="hljs-string">'2020, 10'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 128'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 11'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 167, 192'</span></span>, <span class="hljs-string"><span class="hljs-string">'2020, 12'</span></span>: <span class="hljs-string"><span class="hljs-string">'153, 168, 0'</span></span>} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">year_month</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x1, x2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># {x,X,X,x,x } for key, value in ym_list.items(): key = [int(k) for k in key.replace("'", "").split(", ")] value = [int(v) for v in value.split(", ")] if x1 == value[1] and x2 // 64 == value[2] // 64: return key return 0, 0</span></span></code> </pre> <br><p>  Je suis sûr que si vous passez n le nombre de fois, alors ce malentendu peut être corrigé. <br>  Ensuite, la fonction renvoie un objet datetime à partir d'une chaîne.  Script: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_data_time</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val:str)</span></span></span><span class="hljs-function">:</span></span> val = [int(v) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> val.split(<span class="hljs-string"><span class="hljs-string">", "</span></span>)] day = day_(val[<span class="hljs-number"><span class="hljs-number">2</span></span>]) hour = hour_(val[<span class="hljs-number"><span class="hljs-number">2</span></span>], val[<span class="hljs-number"><span class="hljs-number">3</span></span>]) minutes = min_(val[<span class="hljs-number"><span class="hljs-number">3</span></span>], val[<span class="hljs-number"><span class="hljs-number">4</span></span>]) year, month = year_month(val[<span class="hljs-number"><span class="hljs-number">1</span></span>], val[<span class="hljs-number"><span class="hljs-number">2</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> datetime(year, month, day, hour, minutes)</code> </pre> <cut></cut><br><p>  Il était possible de détecter des valeurs fréquemment répétées de int, int, datetime, datetime <img src="https://habrastorage.org/getpro/habr/post_images/a2a/054/0dd/a2a0540dd230dc92ac1d8e6a5cfcdf51.png" alt="image">  Il semble que c'est ce dont vous avez besoin.  De plus, une telle séquence n'est pas répétée deux fois par ligne. </p><br><p>  En utilisant une expression régulière, nous trouvons les données nécessaires: </p><br><pre> <code class="python hljs">fined = re.findall(<span class="hljs-string"><span class="hljs-string">r'128, \d*, \d*, \d*, 128, \d*, \d*, \d*, 153, 1[6,5,4,3]\d, \d*, \d*, \d*, 153, 1[6,5,4,3]\d, \d*, \d*, \d*'</span></span>, int_array)</code> </pre> <br><p>  Veuillez noter que lors de la recherche de cette expression, il ne sera pas possible de déterminer des valeurs NULL dans les champs requis, mais dans mon cas, ce n'est pas critique.  Après avoir parcouru le trouvé.  Script: </p><br><pre> <code class="python hljs">result = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> val <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fined: pre_result = [] bd_int = re.findall(<span class="hljs-string"><span class="hljs-string">r"128, \d*, \d*, \d*"</span></span>, val) bd_date= re.findall(<span class="hljs-string"><span class="hljs-string">r"(153, 1[6,5,4,3]\d, \d*, \d*, \d*)"</span></span>, val) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> it <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bd_int: pre_result.append(find_int(bd_int[it])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bd <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bd_date: pre_result.append(find_data_time(bd)) result.append(pre_result)</code> </pre> <br><p>  En fait, tout, les données du tableau de résultats, ce sont les données dont nous avons besoin.  ### PS. ### <br>  Je comprends que cette méthode ne convient pas à tout le monde, mais l'objectif principal de l'article est d'inciter à l'action plutôt que de résoudre tous vos problèmes.  Je pense que la solution la plus correcte serait de commencer à étudier le code source de <a href="">mariadb</a> lui-même, mais en raison du temps limité, la méthode actuelle semblait la plus rapide. </p><br><p>  Dans certains cas, après avoir analysé le fichier, vous pouvez déterminer la structure approximative et restaurer l'une des méthodes standard à partir des liens ci-dessus.  Ce sera beaucoup plus correct et causera moins de problèmes. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453368/">https://habr.com/ru/post/fr453368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453356/index.html">Tendances actuelles et recommandations sur l'agglomération des grandes institutions financières</a></li>
<li><a href="../fr453360/index.html">Ville sans embouteillage</a></li>
<li><a href="../fr453362/index.html">HabraConf # 1 - Vers l'arrière pour le backend</a></li>
<li><a href="../fr453364/index.html">Une histoire de déploiement qui a tout affecté</a></li>
<li><a href="../fr453366/index.html">Comment utiliser les virgules en anglais: 15 règles et exemples d'erreur</a></li>
<li><a href="../fr453370/index.html">Confrontation 2019: Jet Security Team a pris la première place en défense</a></li>
<li><a href="../fr453374/index.html">Les 10 meilleurs fournisseurs d'API et de SDK de chat, d'appel audio et vidéo pour les entreprises</a></li>
<li><a href="../fr453376/index.html">Comment perdre son temps et ses ressources SSD en vain? Facile et simple</a></li>
<li><a href="../fr453380/index.html">Guerre mondiale avec des voitures personnelles: MaaS parcourt la planète</a></li>
<li><a href="../fr453382/index.html">Comment créer une mise en cache hautement personnalisable dans un projet et éviter à vos collègues d'écrire le même type de code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>