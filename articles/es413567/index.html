<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òùüèΩ ‚úíÔ∏è üëÜüèø Comenzando con microservicios en Spring Boot ‚úäüèæ ü§æ üê¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 

 En este art√≠culo, demostraremos los componentes b√°sicos para crear microservicios RESTful utilizando el registro de servicios Consul,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comenzando con microservicios en Spring Boot</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/413567/">  Hola a todos! <br><br>  En este art√≠culo, demostraremos los componentes b√°sicos para crear microservicios RESTful utilizando el registro de servicios Consul, Spring Boot para todos los andamios, inyecci√≥n de dependencias, Maven para ensamblaje, as√≠ como Spring REST y la API Java RESTful Jersey / JaxRS. <br><br>  Las principales ventajas de los microservicios: <br><br><ul><li>  Los microservicios ayudan a aflojar su c√≥digo </li></ul><br><ul><li>  Los microservicios permiten que diferentes equipos trabajen en componentes peque√±os utilizando tecnolog√≠as independientes, proporcionando una implementaci√≥n m√°s segura y frecuente. Spring Boot admite diversas implementaciones para crear una API REST </li></ul><br><ul><li>  El descubrimiento y la llamada de servicios no dependen de la plataforma de servicios. </li></ul><br><ul><li>  Swagger crea una s√≥lida documentaci√≥n de API e interfaz de llamadas </li></ul><br>  Si a√∫n no est√° utilizando microservicios, no ha logrado ingresar a la fase de seguidores tempranos en la curva de percepci√≥n de la tecnolog√≠a, y probablemente sea el momento adecuado para comenzar. <br><br><img src="https://habrastorage.org/webt/o_/ze/uu/o_zeuux9s9xpxbxjvitgdmiqox4.png"><a name="habracut"></a><br><br>  En las √∫ltimas dos d√©cadas, la empresa se ha vuelto muy flexible en nuestro proceso SDLC, pero nuestras aplicaciones, por regla general, siguen siendo monol√≠ticas, con enormes frascos que admiten todas las diversas API y versiones en el mercado.  Pero en la actualidad, existe el deseo de m√°s procesos Lean, DevOps, y la funcionalidad se est√° volviendo "sin servidor".  Refactorizar a microservicios puede reducir el enredo de c√≥digo y recursos, hacer que los ensamblajes sean m√°s peque√±os, las versiones son m√°s seguras y las API son m√°s estables. <br><br>  En este art√≠culo, crearemos una aplicaci√≥n simple de gesti√≥n de cartera de bolsa a la que los clientes pueden llamar para evaluar su cartera de acciones (valores y valores de acciones).  El microservicio de cartera recuperar√° la cartera del cliente, la enviar√° al microservicio de fijaci√≥n de precios para aplicar los precios m√°s recientes y luego devolver√° la cartera totalmente valorada y subtotalizada, demostrando todo esto mediante una llamada de descanso. <br><br><img src="https://habrastorage.org/webt/qe/ea/aw/qeeaawb8mapjtsibfyw3nro_ue8.png"><br><br>  Antes de comenzar a trabajar en la creaci√≥n de nuestros microservicios, preparemos nuestro entorno configurando Consul. <br><br><h3>  Descargar Consul </h3><br>  Utilizaremos Hashicorp Consul para descubrir servicios, as√≠ que vaya a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">www.consul.io/downloads.html</a> y descargue Consul para Windows, Linux, Mac, etc.  Esto le proporcionar√° un archivo ejecutable que debe agregar a su ruta. <br><br><h3>  Lanzar c√≥nsul </h3><br>  En el s√≠mbolo del sistema, iniciando Consul en modo dev: <br><br><pre><code class="bash hljs">consul agent -dev</code> </pre> <br>  Para verificar que se est√° ejecutando, vaya a su navegador y acceda a la interfaz de c√≥nsul <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8500</a> .  Si todo va bien, el c√≥nsul debe informar que est√° vivo y bien.  Al hacer clic en el servicio de c√≥nsul (a la izquierda), recibir√° informaci√≥n adicional (a la derecha). <br><br><img src="https://habrastorage.org/webt/9p/4m/2t/9p4m2taqogtv6ahb3dnpmvvt2oc.png"><br><br>  Si en este momento hay alg√∫n problema, aseg√∫rese de agregar Consul a la ruta de ejecuci√≥n, y los puertos 8500 y 8600 est√°n disponibles. <br><br><h3>  Crear una aplicaci√≥n SpringBoot </h3><br>  Utilizaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Spring Initializr</a> , que est√° integrado en la mayor√≠a de los IDE, para construir nuestras aplicaciones SpringBoot.  Las capturas de pantalla a continuaci√≥n usan IntelliJ IDEA. <br><br>  Seleccione "Archivo / Nuevo proyecto" para abrir una nueva plantilla de proyecto y luego "Spring Initializr". <br><br><img src="https://habrastorage.org/webt/xb/j5/3t/xbj53tf_bfr5dauohwqmv9gkdmm.png"><br><br>  En general, puede configurar el andamiaje sin un IDE completando un formulario en l√≠nea a trav√©s de la p√°gina web SpringBoot Initializr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">start.spring.io</a> , que crear√° un archivo zip para su proyecto vac√≠o, listo para descargar. <br><br>  Haga clic en "Siguiente" y complete los metadatos del proyecto.  Use la siguiente configuraci√≥n: <br><br><img src="https://habrastorage.org/webt/l0/_p/zk/l0_pzkpsppbplfrusj7suogqmyk.png"><br><br>  Haga clic en "Siguiente" para seleccionar las dependencias y escriba "Jersey" y "Consul Discovery" en la b√∫squeda de dependencias.  Agregue estas dependencias: <br><br><img src="https://habrastorage.org/webt/jt/t8/l8/jtt8l89pauvzyu_oo_riav_na4e.png"><br><br>  Haga clic en "Siguiente" para indicar el nombre del proyecto y su ubicaci√≥n.  Mantenga el nombre predeterminado "cartera" y especifique la ubicaci√≥n preferida del proyecto, luego haga clic en "finalizar" para crear y abrir el proyecto: <br><br><img src="https://habrastorage.org/webt/un/xl/gh/unxlgh-ufplppxqhuyfyfdoug5g.png"><br><br>  Podemos usar el application.properties generado, pero SpringBoot tambi√©n reconoce el formato YAML, que es un poco m√°s f√°cil de visualizar, as√≠ que cambiemos el nombre a application.yml. <br><br>  Llamamos al microservicio "portfolio-service".  Podemos especificar un puerto o usar el puerto 0 para que la aplicaci√≥n use un puerto disponible.  En nuestro caso, utilizaremos 57116. Si aloja este servicio como un contenedor Docker, puede asignarlo a cualquier puerto que seleccione.  Asigne un nombre a la aplicaci√≥n y especifique nuestro puerto agregando lo siguiente a nuestra application.yml: <br><br><pre> <code class="bash hljs">spring: application: name: portfolio-service server: port: 57116</code> </pre><br>  Para que nuestro servicio est√© disponible, agregue anotaciones a nuestra clase de aplicaci√≥n SpringBoot.  Abra la aplicaci√≥n PortfolioApplication y agregue @EnableDiscoveryClient encima de la declaraci√≥n de clase. <br><br>  Confirmar las importaciones.  La clase deber√≠a verse as√≠: <br><br><pre> <code class="bash hljs">package com.restms.demo.portfolio; import org.springframework.cloud.client.discovery.EnableDiscoveryClient; . . . @SpringBootApplication @EnableDiscoveryClient public class PortfolioApplication { public static void main(String[] args) { SpringApplication.run(PortfolioApplication.class, args); } }</code> </pre><br>  (Para demostrar c√≥mo los microservicios pueden consistir en plataformas independientes, usaremos Jersey para este servicio y Spring REST para el pr√≥ximo). <br>  Para configurar el servicio web RESTful en Jersey, necesitamos especificar la clase de configuraci√≥n ResourceConfig.  Agregue la clase JerseyConfig (para demostraci√≥n, la guardaremos en el mismo paquete que nuestra clase de aplicaci√≥n).  Deber√≠a verse as√≠, m√°s el paquete correcto e importar: <br><br><pre> <code class="bash hljs">@Configuration @ApplicationPath(<span class="hljs-string"><span class="hljs-string">"portfolios"</span></span>) public class JerseyConfig extends ResourceConfig { public <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JerseyConfig</span></span></span></span>() { register(PortfolioImpl.class); } }</code> </pre><br>  Tenga en cuenta que hereda de ResourceConfig para designarlo como una clase de configuraci√≥n Jersey.  El atributo @ApplicationPath ("portafolios") define el contexto de la llamada, lo que significa que las llamadas deben comenzar con el elemento de ruta "portfolioios".  (Si lo omite, el contexto predeterminado es "/"). <br><br>  La clase PortfolioImpl atender√° dos solicitudes: portafolios / customer / {customer-id} devuelve todos los portafolios y portafolios / customer / {customer-id} / portfolio / {portfolio-id} devuelve un portfolio.  Una cartera consta de un conjunto de tickers y el n√∫mero de acciones que posee ese ticker.  (Para demostraci√≥n, hay tres clientes con identificadores 0, 1 y 2, cada uno de los cuales tiene tres carteras con identificadores 0, 1 y 2). <br><br>  Su IDE le pedir√° que cree PortfolioImpl;  hazlo ahora.  Para demostrarlo, agr√©guelo al mismo paquete.  Ingrese el c√≥digo a continuaci√≥n y confirme todas las importaciones: <br><br><pre> <code class="bash hljs">@Component @Path(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) public class PortfolioImpl implements InitializingBean { private Object[][][][] clientPortfolios; @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) // a portfolio consists of an array of arrays, each containing an array of // stock ticker and associated shares public Object[][][] getPortfolios(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> clientPortfolios[customerId]; } @GET @Path(<span class="hljs-string"><span class="hljs-string">"customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) @Produces(MediaType.APPLICATION_JSON) public Object[][] getPortfolio(@PathParam(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) int customerId, @PathParam(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) int portfolioId) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> getPortfolios(customerId)[portfolioId]; } @Override public void afterPropertiesSet() throws Exception { Object[][][][] clientPortfolios = { { // 3 customers, 3 portfolios each {new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 10201}, new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 20400}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 38892}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"KO"</span></span>, 12449}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 23454}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 45344}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"WMT"</span></span>, 39583}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 95867}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 384756}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"GE"</span></span>, 38475}, new Object[]{<span class="hljs-string"><span class="hljs-string">"MCD"</span></span>, 12395}, new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 91234}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"VZ"</span></span>, 22342}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 385432}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 23432}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"IBM"</span></span>, 18343}, new Object[]{<span class="hljs-string"><span class="hljs-string">"DIS"</span></span>, 45673}, new Object[]{<span class="hljs-string"><span class="hljs-string">"AAPL"</span></span>, 23456}}, }, { {new Object[]{<span class="hljs-string"><span class="hljs-string">"AXP"</span></span>, 34543}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 55322}, new Object[]{<span class="hljs-string"><span class="hljs-string">"NKE"</span></span>, 45642}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"CVX"</span></span>, 44332}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JPM"</span></span>, 12453}, new Object[]{<span class="hljs-string"><span class="hljs-string">"JNJ"</span></span>, 45433}}, {new Object[]{<span class="hljs-string"><span class="hljs-string">"MRK"</span></span>, 32346}, new Object[]{<span class="hljs-string"><span class="hljs-string">"UTX"</span></span>, 46532}, new Object[]{<span class="hljs-string"><span class="hljs-string">"TRV"</span></span>, 45663}}, } }; this.clientPortfolios = clientPortfolios; } }</code> </pre><br>  La anotaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Componente</a> designa esto como la clase del componente Spring y lo proporciona como un punto final.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Las</a> anotaciones de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ruta</a> sobre la declaraci√≥n de clase declaran que se accede a la clase a trav√©s del elemento de ruta "/", y dos llamadas api compatibles est√°n disponibles a trav√©s de portafolios / customer / {customer-id} y portafolios / customer / {customer-id} / portfolio / {portfolio- id}, como vemos en las anotaciones del m√©todo.  Tenga en cuenta que la ruta ("/") es la predeterminada, pero la dejamos como referencia.  Los m√©todos se designan como HTTP GET a trav√©s de @GETannotation.  Nuestro m√©todo est√° dise√±ado para devolver una matriz y anotado para devolver Json, por lo que devuelve una matriz Json.  Observe c√≥mo se usan las anotaciones de par√°metros de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ruta</a> en la firma del m√©todo para extraer los par√°metros mostrados de las consultas mostradas. <br><br>  (Para nuestra demostraci√≥n, devolvemos valores codificados. Por supuesto, en la pr√°ctica, la implementaci√≥n consultar√° la base de datos u otro servicio o fuente de datos en lugar del c√≥digo r√≠gido). <br>  Ahora cree un proyecto y ejec√∫telo.  Si usa IntelliJ, crear√° un ejecutable predeterminado, as√≠ que simplemente haga clic en la flecha verde "ejecutar".  Tambi√©n puedes usar <br><br><pre> <code class="bash hljs">mvn spring-boot:run</code> </pre> <br>  O puede realizar la instalaci√≥n de Maven y ejecutar la aplicaci√≥n usando java -jar, apuntando al jar generado en el directorio de destino: <br><br><pre> <code class="bash hljs">java -jar target\portfolio-0.0.1-SNAPSHOT.jar</code> </pre> <br>  Ahora deber√≠amos ver este servicio en Consul, as√≠ que volvamos a nuestro navegador, descargue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 8500 / ui / # / dc1 / services</a> (o actual√≠celo si ya est√° all√≠). <br><br><img src="https://habrastorage.org/webt/bs/ab/2v/bsab2vs-dswpzy7nmpevmtphdma.png"><br><br>  Hmm, vemos nuestro servicio all√≠, pero se muestra como fallido.  Esto se debe a que C√≥nsul espera una se√±al de latido ‚Äúsaludable‚Äù de nuestro servicio. <br>  Para generar se√±ales de latido, podemos agregar una dependencia del servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Spring Actuator</a> al pom de nuestra aplicaci√≥n. <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt;</code> </pre><br>  Mientras estamos en pom, tenga en cuenta que hay un conflicto de versiones con Jersey entre el titular C√≥nsul y el titular de Jersey.  Para suavizar esto, designe al abridor de Jersey como la primera adicci√≥n. <br><br>  Su pom ahora debe contener las siguientes dependencias: <br><br><pre> <code class="bash hljs">&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jersey&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt; &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;</code> </pre><br>  Al reiniciar C√≥nsul, el servicio de Portafolio muestra uno feliz: <br><br><img src="https://habrastorage.org/webt/uf/oq/qr/ufoqqrtcnxnlwazqy-ozrp1lceo.png"><br><br>  Ahora en el servicio de cartera hay dos nodos de transmisi√≥n: uno de ellos es nuestra implementaci√≥n del servicio de cartera y el otro es el latido del coraz√≥n. <br><br>  Verifiquemos el puerto que ha sido asignado.  Puede ver eso en el resultado de la aplicaci√≥n: <br><br><pre> <code class="bash hljs">INFO 19792 --- [ main] sbcetTomcatEmbeddedServletContainer : Tomcat started on port(s): 57116 (http)</code> </pre> <br>  Tambi√©n puede ver el puerto directamente en la interfaz de usuario de Consul.  Haga clic en ‚Äúservicio al cliente‚Äù, luego seleccione el enlace ‚ÄúComprobar enlace de servicio al cliente‚Äù, que muestra el puerto de servicio, en este caso 57116. <br><br><img src="https://habrastorage.org/webt/s_/up/ce/s_upceczzu0xupqioariurhawz8.png"><br><br>  Solicite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 57116 / portfolios / customer / 1 / portfolio / 2</a> y ver√° la matriz json [["IBM", 18343], ["DIS", 45673], ["AAPL", 23456]] <br><br>  ¬°Nuestro primer microservicio est√° abierto para los negocios! <br><br><h3>  Servicio de precios </h3><br>  A continuaci√≥n, crearemos nuestro servicio de precios, esta vez usando Spring RestController en lugar de Jersey. <br><br>  El servicio de fijaci√≥n de precios aceptar√° el identificador de cliente y el identificador de cartera como par√°metros y utilizar√° RestTemplate para solicitar servicios de cartera, recibir tickers y acciones, y devolver los precios actuales.  (No necesito decirte que estos valores son noticias falsas, ¬°as√≠ que no los uses para tomar decisiones comerciales!) <br><br>  Cree un nuevo proyecto utilizando la siguiente informaci√≥n: <br><br><img src="https://habrastorage.org/webt/gz/sy/sm/gzsysm7_cgynyxucuhgrcfoxhbs.png"><br><br>  Esta vez, seleccione las dependencias Web, Disco Discovery y Actuator: <br><br><img src="https://habrastorage.org/webt/1l/ke/ov/1lkeovxzix2pxqwmodb2efdw-zu.png"><br><br>  Deje el nombre predeterminado del proyecto "fijaci√≥n de precios" y cree un proyecto en el directorio que elija. <br><br>  Esta vez usaremos application.properties en lugar de application.yml. <br>  Establezca el nombre y el puerto en application.properties como: <br><br><pre> <code class="bash hljs">spring.application.name=pricing server.port=57216</code> </pre> <br>  Anote la aplicaci√≥n de precios con @EnableDiscoveryClient.  La clase deber√≠a verse as√≠, m√°s el paquete y la importaci√≥n. <br><br><pre> <code class="bash hljs">@SpringBootApplication @EnableDiscoveryClient public class PricingApplication { public static void main(String[] args) { SpringApplication.run(PricingApplication.class, args); } }</code> </pre><br>  Luego crearemos la clase PricingEndpoint.  Aqu√≠ dar√© un ejemplo m√°s detallado, ya que muestra varias funciones importantes, incluido el descubrimiento de servicios (b√∫squeda de servicios de cartera) y el uso de RestTemplate para la consulta: <br><br><pre> <code class="bash hljs">@RestController @RequestMapping(<span class="hljs-string"><span class="hljs-string">"/pricing"</span></span>) public class PricingEndpoint implements InitializingBean { @Autowired DiscoveryClient client; Map&lt;String, Double&gt; pricingMap = new HashMap&lt;&gt;(); RestTemplate restTemplate = new RestTemplate(); @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio( @PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId) { List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream() .findFirst() .orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>)); String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId); // query <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the portfolios, returned as an array of List // of size 2, containing a ticker and a position (<span class="hljs-comment"><span class="hljs-comment"># of shares) Object[] portfolio = restTemplate.getForObject(url, Object[].class); // Look up the share prices, and return a list of Strings, formatted as // ticker, shares, price, total List&lt;String&gt; collect = Arrays.stream(portfolio).map(position -&gt; { String ticker = ((List&lt;String&gt;) position).get(0); int shares = ((List&lt;Integer&gt;) position).get(1); double price = getPrice(ticker); double total = shares * price; return String.format("%s %d %f %f", ticker, shares, price, total); }).collect(Collectors.toList()); return collect; } private double getPrice(String ticker) { return pricingMap.get(ticker); } @Override public void afterPropertiesSet() throws Exception { pricingMap.put("MMM",201.81); pricingMap.put("AXP",85.11); pricingMap.put("AAPL",161.04); pricingMap.put("BA",236.32); pricingMap.put("CAT",118.02); pricingMap.put("CVX",111.31); pricingMap.put("CSCO",31.7); pricingMap.put("KO",46.00); pricingMap.put("DIS",101.92); pricingMap.put("XOM",78.7); pricingMap.put("GE",24.9); pricingMap.put("GS",217.62); pricingMap.put("HD",155.82); pricingMap.put("IBM",144.29); pricingMap.put("INTC",35.66); pricingMap.put("JNJ",130.8); pricingMap.put("JPM",89.75); pricingMap.put("MCD",159.81); pricingMap.put("MRK",63.89); pricingMap.put("MSFT",73.65); pricingMap.put("NKE",52.78); pricingMap.put("PFE",33.92); pricingMap.put("PG",92.79); pricingMap.put("TRV",117.00); pricingMap.put("UTX",110.12); pricingMap.put("UNH",198.00); pricingMap.put("VZ",47.05); pricingMap.put("V",103.34); pricingMap.put("WMT", 80.05); } }</span></span></code> </pre><br>  Para encontrar un servicio de cartera, necesitamos tener acceso a DiscoveryClient.  Es f√°cil de obtener con la anotaci√≥n @Autowired de Spring. <br><br><pre> <code class="bash hljs">@Autowired DiscoveryClient client;</code> </pre><br>  Esta instancia de DiscoveryClient se usa para buscar el servicio en la llamada: <br><br><pre> <code class="bash hljs">List&lt;ServiceInstance&gt; instances = client.getInstances(<span class="hljs-string"><span class="hljs-string">"portfolio-service"</span></span>); ServiceInstance instance = instances.stream().findFirst().orElseThrow(() -&gt; new RuntimeException(<span class="hljs-string"><span class="hljs-string">"not found"</span></span>));</code> </pre><br>  Despu√©s de encontrar el servicio, podemos usarlo para cumplir con nuestra solicitud, que redactamos de acuerdo con la llamada API creada en nuestro servicio de cartera. <br><br><pre> <code class="bash hljs">String url = String.format(<span class="hljs-string"><span class="hljs-string">"%s/portfolios/customer/%d/portfolio/%d"</span></span>, instance.getUri(), customerId, portfolioId);</code> </pre><br>  Finalmente, usamos RestTemplate para ejecutar nuestra solicitud GET. <br><br><pre> <code class="bash hljs">Object[] portfolio = restTemplate.getForObject(url, Object[].class);</code> </pre> <br>  Tenga en cuenta que para los controladores Rest (as√≠ como para Spring MVC Request Controller), las variables de ruta se recuperan utilizando la anotaci√≥n de Variable de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">ruta</a> , a diferencia de Jersey, que, como vimos, usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Path</a> Param. <br><br>  Esto concluye nuestros precios con Spring RestController. <br><br><h3>  La documentaci√≥n </h3><br>  Resolvimos todos estos problemas para crear nuestros microservicios, pero no traer√°n suficientes beneficios si no le damos al mundo conocimiento sobre c√≥mo usarlos. <br><br>  Para hacer esto, utilizamos la herramienta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Swagger</a> conveniente y f√°cil de usar, que no solo documenta nuestras llamadas API, sino que tambi√©n proporciona un cliente web conveniente para llamarlas. <br><br>  Primero, especifiquemos Swagger en nuestro pom: <br><br><pre> <code class="bash hljs">&lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.springfox&lt;/groupId&gt; &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt; &lt;version&gt;2.7.0&lt;/version&gt; &lt;/dependency&gt;</code> </pre><br>  Luego tenemos que decirle a Swagger cu√°l de nuestras clases queremos documentar.  Presentemos la nueva clase SwaggerConfig que contiene la especificaci√≥n Swagger. <br><br><pre> <code class="bash hljs">@Configuration @EnableSwagger2 public class SwaggerConfig { @Bean public Docket <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> new Docket(DocumentationType.SWAGGER_2) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.regex(<span class="hljs-string"><span class="hljs-string">"/pricing.*"</span></span>)) .build(); } }</code> </pre><br>  Veamos qu√© hace esta clase.  Primero, designamos esto como una configuraci√≥n Swagger con la anotaci√≥n @ EnableSwagger2. <br><br>  Luego creamos un componente Docket que le dice a Swagger qu√© API deben mostrarse.  En el ejemplo anterior, le dijimos a Swagger que demostrara cualquier camino que comience con "/ price".  Una alternativa ser√≠a especificar clases para documentaci√≥n, y no para rutas: <br><br><pre> <code class="bash hljs">.apis(RequestHandlerSelectors.basePackage(<span class="hljs-string"><span class="hljs-string">"com.restms.demo"</span></span>)) .paths(PathSelectors.any())</code> </pre><br>  Reinicie el microservicio de precios y llame al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http: // localhost: 57216 / swagger-ui.html</a> desde el navegador <br><br><img src="https://habrastorage.org/webt/8x/0k/gk/8x0kgk8hxs_dpijzolsmxk8rdva.png"><br><br>  Haga clic en Lista de operaciones para ver las operaciones de servicio en detalle. <br>  Haga clic en Expandir operaciones para crear una solicitud basada en el formulario.  Establezca algunos par√°metros, haga clic en "¬°Pru√©belo!"  y espera la respuesta: <br><br><img src="https://habrastorage.org/webt/rf/0_/iu/rf0_ius_kz3fljd74-aaqhzwsia.png"><br><br>  Puede agregar muchos m√°s colores agregando anotaciones Swagger a sus m√©todos. <br>  Por ejemplo, decore el m√©todo PricingImpl.getPricedPortfolio existente utilizando la anotaci√≥n @ApiOperation, como se muestra a continuaci√≥n: <br><br><pre> <code class="bash hljs">@ApiOperation(value = <span class="hljs-string"><span class="hljs-string">"Retrieves a fully priced portfolio"</span></span>, notes = <span class="hljs-string"><span class="hljs-string">"Retrieves fully priced portfolio given customer id and portfolio id"</span></span>) @GetMapping(<span class="hljs-string"><span class="hljs-string">"/customer/{customer-id}/portfolio/{portfolio-id}"</span></span>) public List&lt;String&gt; getPricedPortfolio(@PathVariable(<span class="hljs-string"><span class="hljs-string">"customer-id"</span></span>) Integer customerId, @PathVariable(<span class="hljs-string"><span class="hljs-string">"portfolio-id"</span></span>) Integer portfolioId)</code> </pre> <br>  Vuelva a cargar y actualice swagger-ui para ver la nueva documentaci√≥n actualizada: <br><br><img src="https://habrastorage.org/webt/1z/vy/bj/1zvybjvfyh6zmjxd7gahn5_tlyi.png"><br><br>  Y eso no es todo lo que puede hacer con Swagger, as√≠ que consulte la documentaci√≥n. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Yuri Dvorzhetsky</a> , profesor de nuestro curso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"Desarrollador en Spring Framework",</a> le contar√° m√°s sobre el trabajo de Spring Boot: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zgd9SfSxO0Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><i>Art√≠culo original</i></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es413567/">https://habr.com/ru/post/es413567/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es413557/index.html">NewSQL: SQL no va a ninguna parte</a></li>
<li><a href="../es413559/index.html">Degradaci√≥n web o c√≥mo hacer que la web sea legible por humanos</a></li>
<li><a href="../es413561/index.html">Velocidad de √°rbol de expresi√≥n de Linq compilada</a></li>
<li><a href="../es413563/index.html">4 formas de importar un paquete en Go</a></li>
<li><a href="../es413565/index.html">An√°lisis de pirateo de Kubernetes - puerta trasera a trav√©s de kubelet</a></li>
<li><a href="../es413569/index.html">Desmontaje de bater√≠as de iones de litio 18650 de f√°brica</a></li>
<li><a href="../es413571/index.html">N√∫mero 25: capacitaci√≥n en TI: problemas y desaf√≠os actuales de las principales empresas</a></li>
<li><a href="../es413575/index.html">BricsCAD Shape - CAD en 3D gratuito de Bricsys</a></li>
<li><a href="../es413577/index.html">[Anuncio] Hubs para la competencia en CodinGame.com en siete ciudades de Rusia</a></li>
<li><a href="../es413579/index.html">Hablaremos sobre la descomposici√≥n del c√≥digo: programaci√≥n contextual</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>