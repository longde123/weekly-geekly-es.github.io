<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏆 🧑🏿‍🤝‍🧑🏿 🍘 Bagaimana BGP Bekerja 👩🏻‍✈️ 🔈 📎</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hari ini kita melihat protokol BGP. Kami tidak akan berbicara lama mengapa itu dan mengapa itu digunakan sebagai satu-satunya protokol. Cukup banyak i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana BGP Bekerja</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450814/">  Hari ini kita melihat protokol BGP.  Kami tidak akan berbicara lama mengapa itu dan mengapa itu digunakan sebagai satu-satunya protokol.  Cukup banyak informasi mengenai hal ini, misalnya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Jadi apa itu BGP?  BGP adalah protokol routing dinamis yang merupakan satu-satunya protokol EGP (External Gateway Protocol).  Protokol ini digunakan untuk membangun perutean di Internet.  Pertimbangkan bagaimana lingkungan antara dua router BGP dibangun. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3fa/da6/dd3/3fada6dd3c41923367af475da9b0ae10.jpg" alt="Gambar saya"></a> <br>  Pertimbangkan lingkungan antara Router1 dan Router3.  Kami akan mengonfigurasinya menggunakan perintah berikut: <a name="habracut"></a><br><pre><code class="plaintext hljs">router bgp 10 network 192.168.12.0 network 192.168.13.0 neighbor 192.168.13.3 remote-as 10 router bgp 10 network 192.168.13.0 network 192.168.24.0 neighbor 192.168.13.1 remote-as 10</code> </pre> <br>  Lingkungan dalam satu sistem otonom adalah AS 10. Setelah memasukkan data pada router, misalnya pada Router1, router ini mencoba mengatur hubungan lingkungan dengan Router3.  Keadaan awal ketika tidak ada yang terjadi disebut <b>Idle</b> .  Segera setelah bgp dikonfigurasi pada Router1, ia akan mulai mendengarkan port TCP 179 - ia akan masuk ke status <b>Connect</b> , dan ketika mencoba untuk membuka sesi dengan Router3, itu akan masuk ke status <b>aktif</b> . <br><br>  Setelah sesi dibuat antara Router1 dan Router3, pertukaran pesan terbuka berlangsung.  Ketika pesan ini dikirim oleh Router1, maka keadaan ini akan disebut <b>Open Sent</b> .  Dan ketika menerima pesan Terbuka dari Router3, itu akan masuk ke status <b>Buka Konfirmasi</b> .  Pertimbangkan pos Terbuka secara lebih rinci: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d9d/231/607/d9d2316070de22049a24da6d86cecb2b.jpg" alt="Gambar saya"></a> <br>  Pesan ini menyampaikan informasi tentang protokol BGP yang digunakan router.  Dengan bertukar pesan terbuka, Router1 dan Router3 mengkomunikasikan informasi tentang pengaturan mereka satu sama lain.  Parameter berikut dilewatkan: <br><blockquote><ul><li>  <b>Versi</b> : ini termasuk versi BGP yang digunakan router.  Versi BGP saat ini adalah versi 4 yang dijelaskan dalam RFC 4271. Dua router BGP akan mencoba untuk menegosiasikan versi yang kompatibel, ketika ada ketidaksesuaian maka tidak akan ada sesi BGP. </li><li>  <b>AS saya</b> : ini termasuk nomor AS dari router BGP, router harus menyetujui nomor AS dan juga menentukan apakah mereka akan menjalankan iBGP atau eBGP. </li><li>  <b>Waktu Tunggu</b> : jika BGP tidak menerima keepalive atau memperbarui pesan dari pihak lain selama durasi waktu tunggu maka akan menyatakan pihak lain 'mati' dan itu akan menghancurkan sesi BGP.  Secara default waktu penahanan diatur ke 180 detik pada router Cisco IOS, pesan keepalive dikirim setiap 60 detik.  Kedua router harus menyetujui waktu tunggu atau tidak akan ada sesi BGP. </li><li>  <b>BGP Identifier</b> : ini adalah ID router BGP lokal yang dipilih seperti OSPF: <br><ul><li>  Gunakan ID router yang dikonfigurasikan secara manual dengan perintah router-id bgp. </li><li>  Gunakan alamat IP tertinggi pada antarmuka loopback. </li><li>  Gunakan alamat IP tertinggi pada antarmuka fisik. </li></ul></li><li>  <b>Parameter Opsional</b> : di sini Anda akan menemukan beberapa kemampuan opsional dari router BGP.  Bidang ini telah ditambahkan sehingga fitur baru dapat ditambahkan ke BGP tanpa harus membuat versi baru. Hal-hal yang mungkin Anda temukan di sini adalah: <br><br><ul><li>  dukungan untuk MP-BGP (Multi Protocol BGP). </li><li>  dukungan untuk Refresh Rute. </li><li>  dukungan untuk nomor AS 4-oktet. </li></ul></li></ul></blockquote>  Untuk membangun lingkungan, syarat-syarat berikut harus dipenuhi: <br><br><ul><li>  Nomor versi.  Versi saat ini 4. </li><li>  Nomor AS harus cocok dengan yang Anda konfigurasikan <b>tetangga 192.168.13.3 remote-as 10</b> . </li><li>  ID router harus berbeda dari tetangga. </li></ul><br>  Jika salah satu parameter tidak memenuhi kondisi ini, router akan mengirim pesan <b>Pemberitahuan yang</b> mengindikasikan kesalahan.  Setelah mengirim dan menerima pesan Terbuka, hubungan lingkungan memasuki kondisi <b>ESTABLISHED</b> .  Setelah itu, router dapat bertukar informasi tentang rute dan melakukan ini menggunakan <b>Perbarui</b> pesan.  Berikut adalah pesan Pembaruan yang mengirim Router1 ke Router3: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/853/f42/1f0/853f421f0a69f407c5ae4eae3423240c.jpg" alt="Gambar saya"></a> <br><br>  Di sini menunjukkan jaringan yang dilaporkan oleh atribut Router1 dan Path, yang analog dengan metrik.  Kami akan berbicara tentang atribut Path secara lebih rinci.  Juga, pesan keepalive ditransmisikan dalam sesi TCP.  Mereka dikirimkan, secara default, setiap 60 detik.  Ini adalah Timer Keepalive.  Jika pesan Keepalive tidak diterima selama Hold Timer, ini berarti kehilangan komunikasi dengan tetangga.  Secara default, ini sama dengan - 180 detik. <br><br>  Piring yang berguna: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/853/f42/1f0/853f421f0a69f407c5ae4eae3423240c.jpg" alt="Gambar saya"></a> <br><br>  Tampaknya telah mengetahui bagaimana router saling mengirimkan informasi, sekarang mari kita coba mencari tahu logika protokol BGP. <br><br>  Untuk mengiklankan rute ke tabel BGP, seperti pada protokol IGP, perintah jaringan digunakan, tetapi logika operasinya berbeda.  Jika dalam IGP, setelah menentukan rute dalam perintah jaringan, IGP melihat antarmuka mana yang termasuk dalam subnet ini dan memasukkannya dalam tabelnya, maka perintah jaringan dalam BGP terlihat di tabel routing dan mencari kecocokan yang <b>tepat</b> dengan rute pada perintah jaringan.  Jika ini ditemukan, rute ini akan jatuh ke dalam tabel BGP. <br><blockquote>  Cari rute di tabel perutean IP router saat ini yang sama persis dengan parameter dari perintah jaringan;  jika rute IP ada, masukkan NLRI yang setara ke dalam tabel BGP lokal. </blockquote>  Sekarang kita akan menaikkan BGP ke semua yang tersisa dan melihat bagaimana rute dipilih dalam satu AS.  Setelah router BGP menerima rute dari tetangga, pemilihan rute optimal dimulai.  Di sini Anda perlu memahami tetangga seperti apa - internal dan eksternal.  Apakah router konfigurasi mengerti jika tetangga yang dikonfigurasi internal atau eksternal?  Jika dalam tim: <br><br><pre> <code class="plaintext hljs">neighbor 192.168.13.3 remote-as 10</code> </pre> <br>  sebagai parameter remote-as, AS ditentukan, yang dikonfigurasikan pada router itu sendiri dengan perintah router bgp 10. Rute yang berasal dari AS internal dianggap internal, dan rute dari AS eksternal adalah eksternal.  Dan sehubungan dengan masing-masing, logika berbeda untuk menerima dan mengirim karya.  Pertimbangkan topologi berikut: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/cea/5f8/2b0/cea5f82b050662b2632cab01f3de8e24.jpg" alt="Gambar saya"></a> <br><br>  Setiap router memiliki antarmuka loopback yang dikonfigurasi dengan ip: xxxx 255.255.255.0 - di mana x adalah jumlah router.  Pada Router9 kami memiliki antarmuka loopback dengan alamat - 9.9.9.9 255.255.255.0.  Kami akan mengumumkannya di BGP dan melihat bagaimana itu didistribusikan.  Rute ini akan dikirim ke Router8 dan Router12.  Dengan Router8, rute ini akan menuju ke Router6, tetapi pada Router5 tidak akan berada di tabel routing.  Juga, pada Router12 rute ini akan masuk ke dalam tabel, tetapi pada Router11 tidak akan baik.  Mari kita coba mencari tahu.  Pertimbangkan data dan parameter apa yang sedang dikirim oleh Router9 ke tetangganya, melaporkan rute ini.  Paket di bawah ini akan dikirim dari Router9 ke Router8. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5e7/80b/ca0/5e780bca084e8f42dab14d03f62723b6.jpg" alt="Gambar saya"></a> <br>  Informasi rute terdiri dari atribut Path. <br><br>  Atribut path dibagi menjadi 4 kategori: <br><br><ol><li>  <b>Wajib dikenal</b> - Semua router BGP harus mengenali atribut ini.  Harus ada di semua pembaruan. </li><li>  <b>Discretionary terkenal</b> - Semua router BGP harus mengenali atribut ini.  Mereka mungkin hadir dalam pembaruan, tetapi kehadiran mereka tidak perlu. </li><li>  <b>Transitif opsional</b> - mungkin tidak dikenali oleh semua implementasi BGP.  Jika router tidak mengenali atribut, itu menandai pembaruan sebagai parsial dan mengirimkannya lebih jauh ke tetangga, menjaga atribut yang tidak dikenal. </li><li>  <b>Opsional non-transitif</b> - mungkin tidak dikenali oleh semua implementasi BGP.  Jika router tidak mengenali atribut, maka atribut tersebut diabaikan dan dibuang selama transmisi ke tetangga. </li></ol><br>  Contoh atribut BGP: <br><br><ul><li>  <b>Wajib terkenal</b> : <br><ul><li>  Jalur sistem otonom </li><li>  Hop selanjutnya </li><li>  Asal </li></ul><br></li><li>  <b>Discretionary terkenal</b> : <br><ul><li>  Preferensi lokal </li><li>  Agregat atom </li></ul></li><li>  <b>Transitif opsional</b> : <br><ul><li>  Agregator </li><li>  Komunitas </li></ul></li><li>  <b>Opsional non-transitif</b> : <br><ul><li>  Multi-exit diskriminator (MED) </li><li>  ID Penggagas </li><li>  Daftar kelompok </li></ul></li></ul><br>  Dalam hal ini, kita akan tertarik pada Origin, Next-hop, AS Path.  Karena rute melewati antara Router8 dan Router9, yaitu, di dalam AS yang sama, itu dianggap internal dan kami akan memperhatikan Asal. <br><br>  Atribut Asal - menunjukkan bagaimana rute diterima dalam pembaruan.  Nilai atribut yang mungkin: <br><br><ul><li>  0 - IGP: NLRI diperoleh di dalam sistem otonom asli; </li><li>  1 - EGP: NLRI dipelajari oleh Exterior Gateway Protocol (EGP).  Pendahulu BGP, tidak digunakan </li><li>  2 - Tidak Lengkap: NLRI dipelajari dengan cara lain </li></ul><br>  Dalam kasus kami, seperti dapat dilihat dari paket, itu adalah 0. Ketika rute ini ditransmisikan ke Router12, maka kode ini akan memiliki kode - 1. <br><br>  Selanjutnya, Next-hop.  Atribut Next-hop <br><br><ul><li>  Ini adalah alamat IP router eBGP yang dilaluinya jalur menuju jaringan tujuan. </li><li>  Atribut berubah ketika awalan dilewatkan ke AS lain. </li></ul><br>  Dalam kasus iBGP, yaitu, di dalam satu AS, Next-hop akan ditunjukkan orang yang belajar atau memberi tahu tentang rute ini.  Dalam kasus kami, ini akan menjadi 192.168.89.9.  Tetapi ketika akan mentransfer rute ini dari Router8 ke Router6, Router8 akan mengubahnya dan menggantinya dengan miliknya.  Berikutnya-hop adalah - 192.168.68.8.  Ini membawa kita ke dua aturan: <br><br><ol><li>  Jika router melewati rute ke tetangga internal, maka router tidak mengubah parameter Next-hop. </li><li>  Jika router mengirim rute ke tetangga eksternal, itu akan mengubah Next-hop ke ip dari antarmuka dari mana router ini mengirim. </li></ol><br>  Ini mengarahkan kita untuk memahami masalah pertama - Mengapa tidak akan ada rute dalam tabel routing pada Router5 dan Router11.  Mari kita pertimbangkan lebih detail.  Jadi, Router6 menerima informasi rute 9.9.9.0/24 dan dengan aman menambahkannya ke tabel routing: <br><br><pre> <code class="plaintext hljs">Router6#show ip route bgp Codes: L - local, C - connected, S - static, R - RIP, M - mobile, B - BGP D - EIGRP, EX - EIGRP external, O - OSPF, IA - OSPF inter area N1 - OSPF NSSA external type 1, N2 - OSPF NSSA external type 2 E1 - OSPF external type 1, E2 - OSPF external type 2 i - IS-IS, su - IS-IS summary, L1 - IS-IS level-1, L2 - IS-IS level-2 ia - IS-IS inter area, * - candidate default, U - per-user static route o - ODR, P - periodic downloaded static route, H - NHRP, l - LISP a - application route + - replicated route, % - next hop override, p - overrides from PfR Gateway of last resort is not set 9.0.0.0/24 is subnetted, 1 subnets B 9.9.9.0 [20/0] via 192.168.68.8, 00:38:25</code> </pre> <br>  Sekarang Router6 melewati rute Router5 dan tidak mengubah aturan Next-hop pertama.  Yaitu, Router5 harus menambahkan <b>9.9.9.0 [20/0] melalui 192.168.68.8</b> , tetapi ia tidak memiliki rute ke 192.168.68.8 dan karenanya rute ini tidak akan ditambahkan, meskipun informasi tentang rute ini akan disimpan dalam tabel BGP: <br><br><pre> <code class="plaintext hljs">&lt;b&gt;Router5#show ip bgp BGP table version is 1, local router ID is 5.5.5.5 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path * i 9.9.9.0/24 192.168.68.8 0 100 0 45 i&lt;/b&gt;</code> </pre> <br>  Situasi yang sama akan terjadi antara Router11-Router12.  Untuk menghindari situasi seperti itu, perlu untuk mengkonfigurasi sehingga Router6 atau Router12, melewati rute ke tetangga internal mereka, mengganti alamat IP mereka sebagai Next-hop.  Ini dilakukan dengan menggunakan perintah: <br><br><pre> <code class="plaintext hljs">neighbor 192.168.56.5 next-hop-self</code> </pre> <br>  Setelah perintah ini, Router6 akan mengirim pesan Pembaruan, di mana untuk rute sebagai Next-hop ip dari antarmuka Gi0 / 0 dari Router6 akan ditunjukkan - 192.168.56.6, setelah itu rute ini sudah akan berada di tabel routing. <br><br>  Mari kita pergi dan melihat apakah rute ini muncul di Router7 dan Router10.  Ini tidak akan muncul di tabel routing dan kita mungkin berpikir bahwa masalahnya seperti pada yang pertama dengan parameter Next-hop, tetapi jika kita melihat output dari perintah show ip bgp, kita akan melihat bahwa rute di sana tidak diterima bahkan dengan Next-hop yang salah, yang berarti bahwa rute itu bahkan tidak ditransmisikan.  Dan ini akan menuntun kita ke keberadaan aturan lain: <br><blockquote>  Rute yang diterima dari tetangga internal tidak ditransfer ke tetangga internal lainnya. </blockquote>  Karena Router5 menerima rute dari Router6, itu tidak akan dikirimkan ke tetangga internal lainnya.  Agar pemindahan dapat terjadi, Anda harus mengonfigurasi fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Route Reflector</a> , atau mengonfigurasi hubungan lingkungan yang sepenuhnya terhubung (Full Mesh), yaitu, Router5-7 masing-masing akan menjadi tetangga bagi masing-masing.  Kami akan menggunakan Reflektor Rute dalam hal ini.  Di Router5, Anda harus menggunakan perintah ini: <br><br><pre> <code class="plaintext hljs">neighbor 192.168.57.7 route-reflector-client</code> </pre> <br>  Route-Reflector mengubah perilaku BGP saat mentransmisikan rute ke tetangga internal.  Jika tetangga internal ditetapkan sebagai <b>rute-reflektor-klien</b> , maka rute internal akan diumumkan kepada klien ini. <br><br>  Apakah rute tidak muncul di Router7?  Jangan lupa tentang Next-hop juga.  Setelah manipulasi ini, rute juga harus di Router7, tetapi ini tidak terjadi.  Ini membawa kita ke aturan lain: <br><blockquote>  Aturan next-hop hanya berfungsi untuk rute eksternal.  Untuk rute internal, atribut next-hop tidak diganti. </blockquote><br>  Dan kami mendapatkan situasi di mana Anda perlu membuat lingkungan menggunakan routing statis atau IGP untuk menginformasikan router tentang semua rute di dalam AS.  Kami akan mendaftarkan rute statis pada Router6 dan Router7 dan setelah itu kami akan mendapatkan rute yang diinginkan di tabel router.  Di AS 678, kami akan bertindak sedikit berbeda - kami akan menulis rute statis untuk 192.168.112.0/24 pada Router10 dan 192.168.110.0/24 pada Router12.  Selanjutnya, kami membangun hubungan lingkungan antara Router10 dan Router12.  Kami juga mengkonfigurasi Router12 untuk mengirim next-hop untuk Router10: <br><br><pre> <code class="plaintext hljs">neighbor 192.168.110.10 next-hop-self</code> </pre> <br>  Hasilnya adalah bahwa Router10 akan menerima rute 9.9.9.0/24, itu akan diterima dari Router7 dan Router12.  Mari kita lihat pilihan apa yang dibuat Router10: <br><br><pre> <code class="plaintext hljs">Router10#show ip bgp BGP table version is 3, local router ID is 6.6.6.6 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path *&gt;i 9.9.9.0/24 192.168.112.12 0 100 0 45 i 192.168.107.7 0 123 45 i</code> </pre> <br>  Seperti yang dapat kita lihat, dua rute dan panah (&gt;) berarti bahwa rute melalui 192.168.112.12 dipilih. <br>  Mari kita lihat bagaimana proses pemilihan rute berlangsung: <br><br><ol><li>  Pertama-tama, setelah menerima rute, ketersediaan Next-hopnya diperiksa.  Itulah sebabnya, ketika kami menerima rute di Router5 tanpa mengatur Next-hop-self, rute ini tidak diajukan lebih lanjut untuk diproses. </li><li>  Berikutnya adalah parameter Berat.  Parameter ini bukan Atribut Path (PA) dan tidak dikirim dalam pesan BGP.  Ini dikonfigurasi secara lokal pada setiap router dan hanya digunakan untuk memanipulasi pemilihan rute pada router itu sendiri.  Pertimbangkan sebuah contoh.  Ditampilkan di atas bahwa Router10 memilih rute untuk 9.9.9.0/24 melalui Router12 (192.168.112.12).  Untuk mengubah parameter Wieght, Anda dapat menggunakan rute-peta untuk mengatur rute tertentu, atau menetapkan bobot untuk tetangganya menggunakan perintah: <br><br><pre> <code class="plaintext hljs"> neighbor 192.168.107.7 weight 200</code> </pre> <br>  Sekarang semua rute dari tetangga ini akan memiliki bobot seperti itu.  Mari kita lihat bagaimana pilihan perubahan rute setelah manipulasi ini: <br><br><pre> <code class="plaintext hljs">Router10#show bgp *Mar 2 11:58:13.956: %SYS-5-CONFIG_I: Configured from console by console BGP table version is 2, local router ID is 6.6.6.6 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path *&gt; 9.9.9.0/24 192.168.107.7 200 123 45 i * i 192.168.112.12 0 100 0 45 i</code> </pre> <br>  Seperti yang Anda lihat, rute melalui Router7 sekarang dipilih, tetapi ini tidak akan berpengaruh pada router lain. </li><li>  Di tempat ketiga yang kami miliki - Preferensi Lokal.  Parameter ini adalah atribut discretionary terkenal, yang berarti bahwa keberadaannya adalah opsional.  Parameter ini hanya valid dalam satu AS dan memengaruhi pilihan jalur hanya untuk tetangga internal.  Itu sebabnya, itu hanya dikirim dalam Perbarui pesan yang ditujukan untuk tetangga internal.  Dalam Perbarui pesan untuk tetangga eksternal tidak ada.  Karena itu, ia ditugaskan ke diskresioner terkenal.  Mari kita coba terapkan di Router5.  Pada Router5, kita harus memiliki dua rute untuk 9.9.9.0/24 - satu melalui Router6 dan yang kedua melalui Router7. <br><br>  Kami melihat: <br><br><pre> <code class="plaintext hljs">Router5#show bgp BGP table version is 2, local router ID is 5.5.5.5 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path *&gt;i 9.9.9.0/24 192.168.56.6 0 100 0 45 i</code> </pre> <br>  Tetapi karena Anda dapat melihat satu rute melalui Router6.  Dan di mana rute melalui Router7?  Mungkin itu bahkan tidak ada di Router7?  Kami melihat: <br><br><pre> <code class="plaintext hljs">Router#show bgp BGP table version is 10, local router ID is 7.7.7.7 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path *&gt;i 9.9.9.0/24 192.168.56.6 0 100 0 45 i 192.168.107.10 0 678 45 i</code> </pre> <br>  Aneh, semuanya tampak teratur.  Mengapa tidak ditransmisikan ke Router5?  Masalahnya adalah bahwa BGP memiliki aturan: <br><blockquote>  Router hanya mentransmisikan rute yang digunakannya sendiri. </blockquote><br>  Router7 menggunakan rute melalui Router5, sehingga rute melalui Router10 tidak akan dikirimkan.  Kembali ke preferensi lokal.  Mari kita atur Preferensi Lokal pada Router7 dan lihat bagaimana Router5 merespons ini: <br><br><pre> <code class="plaintext hljs">route-map BGP permit 10 match ip address 10 set local-preference 250 access-list 10 permit any router bgp 123 neighbor 192.168.107.10 route-map BGP in&lt;/b&gt;</code> </pre> <br>  Jadi, kami membuat peta rute tempat semua rute jatuh dan memberi tahu Router7 untuk mengubah parameter Preferensi Lokal menjadi 250 setelah menerima, secara default 100. Kami melihat apa yang terjadi pada Router5: <br><br><pre> <code class="plaintext hljs">Router5#show bgp BGP table version is 8, local router ID is 5.5.5.5 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path *&gt;i 9.9.9.0/24 192.168.57.7 0 250 0 678 45 i</code> </pre> <br>  Seperti yang kita lihat sekarang, Router5 lebih memilih rute melalui Router7.  Gambar yang sama akan berada di Router6, meskipun lebih menguntungkan baginya untuk memilih rute melalui Router8.  Kami juga menambahkan bahwa perubahan dalam parameter ini memerlukan restart lingkungan untuk perubahan berlaku.  Baca di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Dengan Preferensi Lokal diurutkan.  Pergi ke parameter berikutnya. </li><li>  Preferensi rute dengan parameter Next-hop 0.0.0.0, mis. Rute lokal atau gabungan.  Setelah memasukkan perintah jaringan, rute ini secara otomatis ditetapkan parameter Berat sama dengan maksimum - 32678: <br><br><pre> <code class="plaintext hljs">Router#show bgp BGP table version is 2, local router ID is 9.9.9.9 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path *&gt; 9.9.9.0/24 0.0.0.0 0 32768 i</code> </pre> </li><li>  Jalur terpendek melalui AS.  Parameter AS_Path terpendek dipilih.  Semakin sedikit rute yang dilewati, semakin baik.  Pertimbangkan rute ke 9.9.9.0/24 di Router10: <br><br><pre> <code class="plaintext hljs">Router10#show bgp BGP table version is 2, local router ID is 6.6.6.6 Status codes: s suppressed, d damped, h history, * valid, &gt; best, i - internal, r RIB-failure, S Stale, m multipath, b backup-path, f RT-Filter, x best-external, a additional-path, c RIB-compressed, Origin codes: i - IGP, e - EGP, ? - incomplete RPKI validation codes: V valid, I invalid, N Not found Network Next Hop Metric LocPrf Weight Path * 9.9.9.0/24 192.168.107.7 0 123 45 i *&gt;i 192.168.112.12 0 100 0 45 i</code> </pre> <br>  Seperti yang Anda lihat, Router10 memilih rute melalui 192.168.112.12 karena parameter AS_Path hanya berisi 45 untuk rute ini, dan 123 dan 45 dalam kasus lain. </li><li>  Parameter selanjutnya adalah Asal.  Apakah IGP (rute yang diperoleh menggunakan BGP) lebih baik dari EGP (rute yang diperoleh dengan menggunakan BGP pendahulunya, sekarang tidak digunakan), dan EGP lebih baik daripada Tidak Lengkap?  (diterima dengan cara lain, misalnya, dengan redistribusi). </li><li>  Parameter selanjutnya adalah MED.  Kami memiliki Wieght, yang hanya berfungsi secara lokal di router.  Ada Preferensi Lokal yang hanya berfungsi dalam satu sistem otonom.  Seperti yang Anda duga, MED adalah parameter yang akan dikirim antara sistem otonom.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel yang</a> sangat bagus tentang opsi ini. </li></ol><br>  Lebih banyak atribut tidak akan digunakan, tetapi jika dua rute memiliki atribut yang sama, maka aturan berikut digunakan: <br><br><ol><li>  Pilih jalur melalui tetangga IGP terdekat. </li><li>  Pilih rute tertua untuk jalur eBGP. </li><li>  Pilih jalur melalui tetangga dengan ID router BGP terendah. </li><li>  Pilih jalur melalui tetangga dengan alamat IP terendah. </li></ol><br>  <b>Sekarang pertimbangkan masalah konvergensi BGP.</b> <br><br>  Mari kita lihat apa yang terjadi jika, misalnya, Router6 kehilangan rute 9.9.9.0/24 melalui Router9.  Matikan antarmuka Gi0 / 1 Router6, yang segera memahami bahwa sesi BGP dengan Router8 terputus dan tetangga hilang, yang berarti bahwa rute yang diterima darinya tidak valid.  Router6 segera mengirim pesan Pembaruan yang menunjukkan jaringan 9.9.9.0/24 di bidang Rute yang Ditarik.  Segera setelah Router5 menerima pesan serupa, kirim ke Router7.  Tetapi karena Router7 memiliki rute melalui Router10, itu akan segera mengirim Pembaruan dengan rute baru sebagai tanggapan.  Jika jatuh tetangga tidak dapat dideteksi oleh keadaan antarmuka, maka Anda harus menunggu Hold Timer untuk memicu. <br><br>  <b>Konfederasi.</b> <br><br>  Jika Anda ingat, maka kami berbicara tentang fakta bahwa Anda sering harus menggunakan topologi yang terhubung sepenuhnya.  Dengan sejumlah besar router dalam satu AS, ini dapat menyebabkan masalah besar, untuk menghindari ini perlu menggunakan konfederasi.  Satu AS dibagi menjadi beberapa sub-AS, yang memungkinkannya untuk bekerja tanpa persyaratan topologi yang terhubung sepenuhnya. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d55/6a8/741/d556a874120b70319381332cdddf739b.jpg" alt="Gambar saya"></a> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Berikut ini tautan ke </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lab</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ini </font><font style="vertical-align: inherit;">, dan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> konfigurasi untuk GNS3. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sebagai contoh, dengan topologi ini, kita harus menghubungkan semua router di AS 2345 satu sama lain, tetapi menggunakan Konfederasi, kita dapat membangun hubungan lingkungan hanya antara router yang terhubung langsung satu sama lain. Mari kita bicarakan ini secara rinci. Jika kita hanya memiliki AS 2345, maka </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">laForge akan</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mendapatkan pawai dari </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Picard untuk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> memberi tahu </font><b><font style="vertical-align: inherit;">router </font></b></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Worf-nya</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tetapi mereka tidak akan memberi tahu </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crusher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tentang hal itu </font><font style="vertical-align: inherit;">. Juga, rute yang router itu sendiri rasprastranyaet </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Laforge</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tidak akan ditransfer </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crusher</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atau</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Terburuk</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , atau </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Data</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Saya harus mengatur Route-Reflector atau hubungan lingkungan yang sepenuhnya terhubung. </font><font style="vertical-align: inherit;">Dengan memecah satu AS 2345 menjadi 4 sub-ASs (2,3,4,5) untuk setiap router, kita berakhir dengan logika operasi yang berbeda. </font><font style="vertical-align: inherit;">Semuanya dijelaskan dengan sempurna di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumber:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Routing dan Switching CCIE v5.0 Panduan Cert Resmi, Volume 2, Edisi Kelima, Narbik Kocharians, Terry Vinson. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situs web </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xgu.ru</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Situs </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNS3Vault</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id450814/">https://habr.com/ru/post/id450814/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id450802/index.html">Pemadaman warisan</a></li>
<li><a href="../id450804/index.html">Pencetakan logam 3D di industri otomotif: mulai dari yang kecil</a></li>
<li><a href="../id450806/index.html">Ketika variabel lingkungan mempercepat proses hingga 40 kali</a></li>
<li><a href="../id450810/index.html">7 cara teratas untuk dengan cepat memeriksa kompetensi spesialis TI sebelum wawancara</a></li>
<li><a href="../id450812/index.html">PSR-14 - acara utama dalam PHP</a></li>
<li><a href="../id450816/index.html">Tajuk HTTP untuk pengembang yang bertanggung jawab</a></li>
<li><a href="../id450818/index.html">Dari Latensi Ceph Tinggi ke Patch Kernel dengan eBPF / BCC</a></li>
<li><a href="../id450820/index.html">Komite program FrontendConf: kerangka kerja, cakrawala, pengalaman dunia dan misi konferensi</a></li>
<li><a href="../id450822/index.html">Kerangka kerja yang hilang</a></li>
<li><a href="../id450824/index.html">Keadaan css</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>