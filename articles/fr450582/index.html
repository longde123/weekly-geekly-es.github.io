<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèº‚Äçü§ù‚Äçüë®üèΩ ‚õπüèª üßïüèæ Principes PIM üßìüèª üë∏üèΩ üë®üèª‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le protocole PIM est un ensemble de protocoles pour transmettre la multidiffusion sur un r√©seau entre des routeurs. Les relations de voisinage sont √©t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Principes PIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450582/"> Le protocole PIM est un ensemble de protocoles pour transmettre la multidiffusion sur un r√©seau entre des routeurs.  Les relations de voisinage sont √©tablies de la m√™me mani√®re que dans le cas des protocoles de routage dynamique.  PIMv2 envoie des messages Hello toutes les 30 secondes √† l'adresse de multidiffusion r√©serv√©e 224.0.0.13 (All-PIM-Routers).  Le message contient des temporisations de mise en attente - g√©n√©ralement 3,5 * Hello Timer, soit 105 secondes par d√©faut. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e67/8a0/1fc/e678a01fc7879ecf22bc6f9a3825f9a6.jpg" alt="Mon image"></a> <br>  PIM utilise deux modes de fonctionnement principaux: le mode dense et le mode clairsem√©.  Commen√ßons par le mode dense. <a name="habracut"></a><br>  <b>Arbres de distribution bas√©s sur la source.</b> <br>  Il est conseill√© d'utiliser le mode en mode dense dans le cas d'un grand nombre de clients de divers groupes de multidiffusion.  Lorsqu'un routeur re√ßoit du trafic multicast, la premi√®re chose qu'il fait est de le v√©rifier pour la r√®gle RPF.  RPF - cette r√®gle est utilis√©e pour v√©rifier la source d'une multidiffusion avec une table de routage unicast.  Il est n√©cessaire que le trafic soit arriv√© √† l'interface derri√®re laquelle cet h√¥te est cach√© selon la version de la table de routage unicast.  Ce m√©canisme r√©sout le probl√®me de l'occurrence de boucle pendant la transmission multicast. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6cd/08c/fb6/6cd08cfb6842680447d56860334af52c.png" alt="Mon image"></a> <br>  R3 du message de multidiffusion reconna√Ætra la source de la multidiffusion (source IP) et v√©rifiera les deux flux de R1 et R2 de sa table de monodiffusion.  Le flux de l'interface indiqu√©e par la table (R1 √† R3) sera transmis plus loin, et le flux de R2 sera abandonn√©, car pour arriver √† la source de la multidiffusion, il est n√©cessaire d'envoyer des paquets via S0 / 1. <br>  La question est, que se passe-t-il si vous avez deux itin√©raires √©quivalents avec la m√™me m√©trique?  Dans ce cas, le routeur choisira le tron√ßon suivant pour ces routes.  Qui a une adresse IP plus √©lev√©e, il a gagn√©.  Si vous devez modifier ce comportement, vous pouvez utiliser ECMP.  Plus de d√©tails <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Apr√®s avoir v√©rifi√© la r√®gle RPF, le routeur envoie un paquet de multidiffusion √† tous ses voisins PIM, √† l'exception de celui de qui le paquet a √©t√© re√ßu.  D'autres routeurs PIM r√©p√®tent ce processus.  Le chemin que le paquet de multidiffusion a transmis de la source aux destinataires finaux forme un arbre appel√© - arbre de distribution bas√© sur la source, arbre du chemin le plus court (SPT), arbre source.  Trois noms diff√©rents, choisissez-en un. <br>  Comment r√©soudre le probl√®me avec le fait que certains routeurs n'ont pas abandonn√© de flux de multidiffusion et qu'il n'y a personne √† qui l'envoyer et que le routeur de niveau sup√©rieur l'envoie.  Pour cela, le m√©canisme Prune a √©t√© invent√©. <br>  <b>Message de taille.</b> <br>  Par exemple, R2 continuera d'envoyer la multidiffusion R3, bien que R3 selon la r√®gle de RPF le supprime.  Pourquoi charger la cha√Æne?  R3 envoie un message d'√©lagage PIM et R2, √† la r√©ception de ce message, supprime l'interface S0 / 1 de la liste des interfaces sortantes pour ce flux, la liste des interfaces √† partir desquelles ce trafic doit √™tre envoy√©. <br><blockquote>  Voici une d√©finition plus formelle d'un message PIM Prune: <br>  Le message PIM Prune est envoy√© par un routeur √† un second routeur pour que le second routeur supprime la liaison sur laquelle le Prune est re√ßu d'un SPT particulier (S, G). </blockquote><br>  Apr√®s avoir re√ßu le message Prune, R2 r√®gle la minuterie Prune sur 3 minutes.  Apr√®s trois minutes, il recommence √† envoyer du trafic jusqu'√† ce qu'il re√ßoive le prochain message Prune.  C'est dans PIMv1. <br>  Et dans PIMv2, le temporisateur de rafra√Æchissement d'√©tat est ajout√© (par d√©faut 60 secondes).  D√®s qu'un message Prune a √©t√© envoy√© depuis R3, ce temporisateur d√©marre sur R3.  Apr√®s l'expiration de ce temporisateur, R3 enverra un message d'actualisation d'√©tat qui r√©initialisera le temporisateur d'√©lagage de 3 minutes √† R2 pour ce groupe. <br>  Raisons pour envoyer un message Prune: <br><ul><li>  Lorsqu'un paquet de multidiffusion a √©chou√© une v√©rification RPF. </li><li>  Lorsqu'il n'y a aucun client connect√© localement qui a demand√© un groupe de multidiffusion (jointure IGMP) et qu'il n'y a aucun voisin PIM √† qui le trafic de multidiffusion (interface non-√©lagage) peut √™tre envoy√©. </li></ul><br>  <b>Message de greffe.</b> <br>  Imaginez que R3 ne voulait pas de trafic de R2, a envoy√© Prune et a re√ßu la multidiffusion de R1.  Mais tout √† coup, le canal est tomb√© entre R1-R3 et R3 a √©t√© laiss√© sans multidiffusion.  Vous pouvez attendre 3 minutes jusqu'√† ce que Prune Timer expire sur R2.  3 minutes pour attendre longtemps, afin de ne pas attendre, vous devez envoyer un message qui affiche instantan√©ment cette interface S0 / 1 sur R2 √† partir de l'√©tat √©lagu√©.  Ce message sera un message Graft.  Apr√®s avoir re√ßu le message Graft, R2 enverra un Graft-ACK en r√©ponse. <br>  <b>Prune Override.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/bc7/1d0/e9f/bc71d0e9f81b292e75d4a016a9b657ef.png" alt="Mon image"></a> <br>  Regardons ce sch√©ma.  R1 diffuse la multidiffusion dans un segment avec deux routeurs.  R3 re√ßoit et diffuse le trafic, R2 re√ßoit, mais il n'a personne pour diffuser le trafic.  Il envoie un message Prune √† R1 dans ce segment.  R1 devrait supprimer Fa0 / 0 de la liste et arr√™ter la diffusion dans ce segment, mais qu'adviendra-t-il de R3?  Et R3 est dans le m√™me segment, il a √©galement re√ßu ce message de Prune et a r√©alis√© la trag√©die de la situation.  Avant que R1 arr√™te la diffusion, il r√®gle la minuterie sur 3 secondes et arr√™te la diffusion apr√®s 3 secondes.  3 secondes - juste autant de temps pour R3, afin de ne pas perdre votre multidiffusion.  Par cons√©quent, R3, d√®s que possible, envoie un message Pim Join pour ce groupe et R1 ne pense plus √† arr√™ter la diffusion.  Rejoignez les articles ci-dessous. <br>  <b>Affirmer le message.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f1d/9d1/d68/f1d9d1d6855fdc188deb28c75bde2d0d.png" alt="Mon image"></a> <br>  Imaginez cette situation: deux routeurs diffusent sur le m√™me r√©seau √† la fois.  Ils re√ßoivent le m√™me flux de la source et les deux le diffusent sur le m√™me r√©seau derri√®re l'interface e0.  Par cons√©quent, ils doivent d√©terminer qui sera le seul diffuseur unique pour ce r√©seau.  Des messages d'assertion sont utilis√©s √† cet effet.  Lorsque R2 et R3 d√©tectent la duplication du trafic de multidiffusion, c'est-√†-dire la multidiffusion qu'ils diffusent sur R2 et R3, qu'ils diffusent eux-m√™mes, les routeurs comprennent que quelque chose ne va pas ici.  Dans ce cas, les routeurs envoient des messages d'assertion, qui incluent la distance administrative et la m√©trique de route par laquelle la source de multidiffusion est atteinte - 10.1.1.10.  Le gagnant est d√©termin√© comme suit: <br><ol><li>  Celui avec AD inf√©rieur. </li><li>  Si AD est √©gal, alors qui a la m√©trique inf√©rieure. </li><li>  S'il y a √©galit√©, alors celui avec une IP plus √©lev√©e dans le r√©seau vers lequel ils diffusent cette multidiffusion. </li></ol><br>  Gagner ce vote, le routeur devient le routeur d√©sign√©.  Pim Hello est √©galement utilis√© pour s√©lectionner DR.  Au d√©but de l'article, un message PIM Hello a √©t√© affich√©, vous pouvez remarquer le champ DR.  Le gagnant est celui avec une adresse IP plus √©lev√©e sur ce lien. <br>  Assiette utile: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3de/e1a/c84/3dee1ac8448b1fceaa9f1972eff802b7.png" alt="Mon image"></a> <br>  <b>Table MROUTE.</b> <br>  Apr√®s l'examen initial du fonctionnement du protocole PIM, nous devons trouver comment travailler avec la table de routage de multidiffusion.  La table mroute stocke des informations sur les flux demand√©s par les clients et sur les flux provenant des serveurs de multidiffusion. <br>  Par exemple, lors de la r√©ception d'un rapport d'adh√©sion IGMP ou d'une jointure PIM sur une interface, une entr√©e du type (*, G) est ajout√©e √† la table de routage: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/3ed/52c/afd3ed52cef0f9f105a0b58dff18edee.jpg" alt="Mon image"></a> <br>  Cette entr√©e signifie qu'une demande de trafic a √©t√© re√ßue avec l'adresse 238.38.38.38.  L'indicateur DC signifie que la multidiffusion fonctionnera en mode dense et C signifie que le destinataire est directement connect√© au routeur, c'est-√†-dire que le routeur a re√ßu le rapport d'adh√©sion IGMP et la jointure PIM. <br>  S'il y a un enregistrement comme (S, G) signifie que nous avons un flux de multidiffusion: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a78/cf2/332/a78cf23325ddc6e0c3d65322340d7ff6.jpg" alt="Mon image"></a> <br>  Dans le champ S - 192.168.1.11, nous avons enregistr√© l'adresse IP de la source multicast, elle sera v√©rifi√©e par la r√®gle RPF.  En cas de probl√®me, la premi√®re chose √† faire est de v√©rifier la table Unicast pour l'itin√©raire vers la source.  Dans le champ Interface entrante, indique l'interface √† laquelle la multidiffusion arrive.  Dans la table de routage unicast, la route vers la source doit se r√©f√©rer √† l'interface sp√©cifi√©e ici.  L'interface sortante indique o√π la multidiffusion sera redirig√©e.  S'il est vide, il n'y a eu aucune demande pour ce trafic vers le routeur.  Vous trouverez plus d'informations sur tous les drapeaux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  <b>Mode PIM clairsem√©.</b> <br>  La strat√©gie en mode clairsem√© est l'oppos√© du mode dense.  Lorsque le mode clairsem√© re√ßoit du trafic de multidiffusion, il n'enverra le trafic que via les interfaces o√π il y a eu des demandes pour ce flux, par exemple, les messages Pim Join ou IGMP Report demandant ce trafic. <br>  √âl√©ments similaires pour SM et DM: <br><ul><li>  Les relations de voisinage se construisent de la m√™me mani√®re que dans PIM DM. </li><li>  La r√®gle RPF fonctionne. </li><li>  Le choix de DR est similaire. </li><li>  Le moteur Prune Overrides et les messages Assert sont similaires. </li></ul><br>  Pour contr√¥ler qui a besoin o√π, o√π et quel trafic de multidiffusion est n√©cessaire sur le r√©seau, un centre d'information commun est n√©cessaire.  Un tel centre, nous aurons Rendezvous Point (RP).  Toute personne qui souhaite une sorte de trafic de multidiffusion ou quelqu'un a commenc√© √† recevoir du trafic de multidiffusion de la source, puis il l'envoie au RP. <br>  Lorsque le RP re√ßoit du trafic de multidiffusion, il l'enverra aux routeurs qui ont pr√©c√©demment demand√© ce trafic. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/025/d45/651/025d4565117dce5f8da07609c823c63e.jpg" alt="Mon image"></a> <br>  Imaginez une telle topologie o√π RP est R3.  D√®s que R1 re√ßoit du trafic de S1, il encapsule ce paquet de multidiffusion dans un message de registre PIM unicast et l'envoie √† RP.  Comment sait-il qui est RP?  Dans ce cas, il est configur√© de mani√®re statique, et nous parlerons de l'optimisation RP dynamique plus tard. <br><blockquote>  ip pim rp-address 3.3.3.3 </blockquote><br>  RP va regarder - y avait-il des informations de quelqu'un qui aimerait recevoir ce trafic?  Supposons que ce ne soit pas le cas.  Ensuite, RP enverra √† R1 un message PIM Register-Stop, ce qui signifie que personne n'a besoin de cette multidiffusion, l'enregistrement est refus√©.  R1 n'enverra pas de multidiffusion.  Mais la source de multidiffusion l'enverra, donc R1, apr√®s avoir re√ßu Register-Stop, d√©marrera le temporisateur de suppression de registre, qui est de 60 secondes.  5 secondes avant l'expiration du temporisateur, R1 enverra un message de registre vide avec un bit de registre nul (c'est-√†-dire sans paquet de multidiffusion encapsul√©) du c√¥t√© RP.  RP √† son tour agira comme ceci: <br><ul><li>  S'il n'y avait pas et aucun destinataire, il r√©pondra par un message Register-Stop. </li><li>  Si les destinataires sont apparus, il ne lui r√©pondra en aucune fa√ßon.  R1, n'ayant pas re√ßu de refus d'enregistrement dans les 5 secondes, sera ravi et enverra √† Register un message avec la multidiffusion encapsul√©e √† RP. </li></ul><br>  Alors que la multidiffusion atteint le RP, elle semble √™tre r√©gl√©e, essayons maintenant de r√©pondre √† la question de savoir comment le RP achemine le trafic vers les destinataires.  Ici, vous devez introduire un nouveau concept - l'arbre du chemin racine (RPT).  Un RPT est un arbre dont la racine dans le RP cro√Æt vers les destinataires se ramifiant sur chaque routeur PIM-SM.  RP le cr√©e en recevant des messages PIM Join et ajoute une nouvelle branche √† l'arborescence.  Et il en va de m√™me pour chaque routeur en aval.  La r√®gle g√©n√©rale ressemble √† ceci: <br><ul><li>  Lorsqu'un routeur PIM-SM re√ßoit un message PIM Join sur n'importe quelle interface, √† l'exception de l'interface derri√®re laquelle le RP est masqu√©, il ajoute une nouvelle branche √† l'arborescence. </li><li>  Une branche est √©galement ajout√©e lorsque le routeur PIM-SM re√ßoit un rapport d'appartenance IGMP d'un h√¥te directement connect√©. </li></ul><br>  Imaginez que nous ayons un client de multidiffusion sur le routeur R5 pour le groupe 228.8.8.8.  D√®s que R5 re√ßoit un rapport d'appartenance IGMP de l'h√¥te, R5 envoie une jointure PIM en direction de RP, et il ajoute lui-m√™me une interface regardant l'h√¥te dans l'arborescence.  Ensuite, R4 re√ßoit une jointure PIM de R5, ajoute l'interface Gi0 / 1 √† l'arborescence et envoie la jointure PIM en direction de RP.  Enfin, RP (R3) re√ßoit une jointure PIM et ajoute Gi0 / 0 √† l'arborescence.  Ainsi, l'enregistrement du destinataire de multidiffusion est obtenu.  Nous construisons un arbre avec la racine R3-Gi0 / 0 ‚Üí R4-Gi0 / 1 ‚Üí R5-Gi0 / 0. <br>  Apr√®s cela, PIM Join sera envoy√© √† R1 et R1 commencera √† envoyer du trafic de multidiffusion.  Il est important de noter que si l'h√¥te a demand√© du trafic avant le d√©but de la diffusion multidiffusion, le RP n'enverra pas de jointure PIM et n'enverra rien du tout au c√¥t√© R1. <br>  Si soudainement pendant qu'une multidiffusion est envoy√©e, l'h√¥te cesse de vouloir la recevoir, d√®s que le RP re√ßoit PIM Prune sur l'interface Gi0 / 0, alors il envoie imm√©diatement le PIM Register-Stop directement √† R1, puis le message PIM Prune via l'interface Gi0 / 1.  L'arr√™t du registre PIM est envoy√© par monodiffusion √† l'adresse √† partir de laquelle le registre PIM est arriv√©. <br>  Comme nous l'avons dit pr√©c√©demment, d√®s que le routeur envoie une jointure PIM √† un autre, par exemple, R5 sur R4, alors une entr√©e est ajout√©e √† R4: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9f7/730/678/9f7730678743efb4e9670d18fcd54525.jpg" alt="Mon image"></a> <br>  Et le minuteur d√©marre que pour r√©initialiser ce minuteur, R5 doit constamment PIM Join messages constamment, sinon R4 sera exclu de la liste sortante.  R5 enverra tous les 60 messages PIM Join. <br>  <b>Commutation d'arbre sur le chemin le plus court.</b> <br>  Nous allons ajouter une interface entre R1 et R5, voir comment le trafic circulera avec cette topologie. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/113/eb0/afd113eb01e7deda4c389fbb1a02060a.jpg" alt="Mon image"></a> <br>  Disons que le trafic a √©t√© envoy√© et re√ßu selon l'ancien sch√©ma R1-R2-R3-R4-R5 et ici nous avons connect√© et configur√© l'interface entre R1 et R5. <br>  Tout d'abord, nous devons reconstruire la table de routage unicast sur R5 et maintenant le r√©seau 192.168.1.0/24 est atteint via l'interface R5 Gi0 / 2.  Maintenant, lorsque R5 re√ßoit une multidiffusion sur l'interface Gi0 / 1, il comprend que la r√®gle RPF n'est pas satisfaite et il serait plus logique de recevoir une multidiffusion sur Gi0 / 2.  Il doit se d√©connecter du RPT et construire une arborescence plus courte appel√©e la Shortest-Path Tree (SPT).  Pour ce faire, via Gi0 / 2, il envoie une jointure PIM √† R1 et R1 commence √©galement √† envoyer des multidiffusions via Gi0 / 2.  Maintenant, R5 doit se d√©sinscrire du RPT, afin de ne pas obtenir deux copies.  Pour ce faire, il envoie un message Prune indiquant l'adresse IP de la source et ins√©rant un bit sp√©cial - RPT-bit.  Cela signifie que je n'ai pas besoin d'envoyer de trafic, j'ai un meilleur arbre ici.  Le RP envoie √©galement des messages du c√¥t√© R1 PIM Prune, mais n'envoie pas de message Register-Stop.  Autre caract√©ristique: R5 enverra d√©sormais constamment PIM Prune √† RP, car R1 continue d'envoyer PIM Register √† RP toutes les minutes.  RP jusqu'√† ce que de nouvelles personnes souhaitent que ce trafic le refuse.  R5 informe le RP qu'il continue de recevoir la multidiffusion via SPT. <br>  <b>Recherche RP dynamique.</b> <b><br></b>  <b>Auto-RP</b> <br>  Cette technologie est propri√©taire de Cisco et n'est pas particuli√®rement populaire, mais toujours vivante.  Auto-RP comprend deux √©tapes principales: <br>  1) RP envoie des messages RP-Announce √† l'adresse r√©serv√©e - 224.0.1.39, se d√©clarant RP pour tous ou pour certains groupes.  Ce message est envoy√© toutes les minutes. <br>  2) Un agent de mappage RP est requis qui enverra des messages RP-Discovery indiquant pour quels groupes quel RP √©couter.  C'est √† partir de ce message que les routeurs PIM ordinaires d√©termineront eux-m√™mes le RP.  L'agent de mappage peut √™tre le routeur RP lui-m√™me ou tout routeur PIM distinct.  RP-Discovery est envoy√© √† l'adresse 224.0.1.40 avec un minuteur d'une minute. <br>  Regardons le processus plus en d√©tail: <br>  D√©finissez R3 comme RP: <br><blockquote>  ip pim send-rp-announce loopback 0 port√©e 10 </blockquote><br>  R2 comme agent de mappage: <br><blockquote>  ip pim send-rp-discovery loopback 0 port√©e 10 </blockquote><br>  Et sur tous les autres, nous nous attendrons √† RP via Auto-RP: <br><blockquote>  √©couteur autorp ip pim </blockquote><br>  Une fois que nous aurons configur√© R3, il commencera √† envoyer RP-Announce: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/aae/ae2/565/aaeae25659fbacd4ba49ae4c5486f46f.jpg" alt="Mon image"></a> <br>  Et R2, apr√®s avoir configur√© l'agent de mappage, il attendra le message RP-Announce.  Ce n'est que lorsqu'il trouve au moins un RP qu'il commencera √† envoyer RP-Discovery: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fb8/e44/7c2/fb8e447c26e33ecda18cb82c5f05c938.jpg" alt="Mon image"></a> <br>  Ainsi, d√®s que les routeurs r√©guliers (√©couteur RP PIM) recevront ce message, ils sauront o√π chercher le RP. <br>  L'un des principaux probl√®mes d'Auto-RP est que pour recevoir les messages RP-Announce et RP-Discovery, vous devez envoyer PIM Join aux adresses 224.0.1.39-40 et pour envoyer, vous devez savoir o√π se trouve le RP.  Le probl√®me classique du poulet et des ≈ìufs.  Pour r√©soudre ce probl√®me, le PIM Sparse-Dense-Mode a √©t√© invent√©.  Si le routeur ne conna√Æt pas RP, alors il fonctionne en mode dense, s'il le sait, alors en mode clairsem√©.  Lorsque PIM Sparse-mode et la commande ip pim autorp listener sont configur√©s sur les interfaces des routeurs ordinaires, le routeur fonctionnera en mode dense uniquement pour le protocole multicast directement Auto-RP (224.0.1.39-40). <br>  <b>Routeur BootStrap (BSR).</b> <br>  Cette fonction fonctionne de mani√®re similaire √† Auto-RP.  Chaque RP envoie un message d'agent de mappage, qui recueille des informations de mappage puis en informe tous les autres routeurs.  Nous d√©crivons le processus de mani√®re similaire √† Auto-RP: <br>  1) Une fois que nous avons configur√© R3 en tant que candidat pour √™tre RP, la commande: <br><blockquote>  ip pim rp-candidate loopback 0 </blockquote><br>  Que R3 ne fasse rien, afin de commencer √† envoyer des messages sp√©ciaux, il a besoin, pour commencer, de trouver un agent de mappage.  Ainsi, nous passons √† la deuxi√®me √©tape. <br>  2) Configurez R2 comme agent de mappage: <br><blockquote>  ip pim bsr-candidate loopback 0 </blockquote><br>  R2 commence √† envoyer des messages d'amor√ßage PIM, o√π il s'indique comme agent de mappage: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/729/3a4/ad1/7293a4ad164ed8342ff42ceffee9a32b.jpg" alt="Mon image"></a> <br>  Ce message est envoy√© √† l'adresse 224.0.013, que le protocole PIM utilise pour ses autres messages.  Il les envoie dans toutes les directions et donc il n'y a pas de probl√®me de poulet et d'oeufs, comme c'√©tait le cas en Auto-RP. <br>  3) D√®s que le RP re√ßoit un message du BSR du routeur, il enverra imm√©diatement un message unicast √† l'adresse du BSR du routeur: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5ed/217/8c1/5ed2178c151886f79c1e6197b9b5385b.jpg" alt="Mon image"></a> <br>  Apr√®s cela, lorsque le BSR re√ßoit des informations sur le RP, il les envoie avec la multidiffusion √† l'adresse 224.0.0.13, que tous les routeurs PIM √©coutent.  Par cons√©quent, il n'y a pas d'analogue de la commande <i>ip pim autorp listener</i> pour les routeurs ordinaires dans BSR. <br>  <b>Anycast RP avec MSDP (Multicast Source Discovery Protocol).</b> <br>  Auto-RP et BSR nous permettent de r√©partir la charge sur le RP comme suit: Chaque groupe de multidiffusion n'a qu'un seul RP actif.  Il ne fonctionnera pas pour rendre la distribution de charge pour un groupe de multidiffusion multiple RP.  MSDP le fait en √©mettant aux routeurs RP la m√™me adresse IP avec un masque de 255.255.255.255.  MSDP reconna√Æt les informations en utilisant l'une des m√©thodes: statique, Auto-RP ou BSR. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/406/51a/032/40651a032dadaaf6e0c51cbf06c3fbf3.png" alt="Mon image"></a> <br>  Dans l'image, nous avons une configuration Auto-RP avec MSDP.  Les deux RP sont configur√©s avec l'adresse IP 172.16.1.1/32 sur l'interface Loopback 1 et sont utilis√©s pour tous les groupes.  Lorsque RP-Announce, les deux routeurs parlent d'eux-m√™mes, se r√©f√©rant √† cette adresse.  Apr√®s avoir re√ßu des informations, l'agent de mappage Auto-RP envoie RP-Discovery sur le RP avec l'adresse 172.16.1.1/32.  √Ä propos du r√©seau 172.16.1.1/32, nous indiquons aux routeurs utilisant IGP et, respectivement.  Ainsi, les routeurs PIM demandent ou enregistrent des flux du RP indiqu√© comme prochain bond sur la route vers le r√©seau 172.16.1.1/32.  Le protocole MSDP lui-m√™me est con√ßu pour que les RP eux-m√™mes √©changent des messages d'informations de multidiffusion. <br>  Consid√©rez la topologie suivante: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/2ba/f2d/dc4/2baf2ddc4deb54ebb671a6fb52282a41.jpg" alt="Mon image"></a> <br>  Switch6 diffuse le trafic √† l'adresse 238.38.38.38 et jusqu'√† pr√©sent, seul le RP-R1 en a connaissance.  Ici, Switch7 et Switch8 ont demand√© ce groupe.  Les routeurs R5 et R4 enverront PIM Join √† R1 et R3, respectivement.  Pourquoi?  La route jusqu'au 13.13.13.13 sur R5 fera r√©f√©rence √† R1 selon la m√©trique IGP, comme sur R4. <br>  RP-R1 conna√Æt le flux et commence √† le diffuser en direction de R5, mais R4 n'en sait rien, car R1 ne l'enverra pas.  Par cons√©quent, MSDP est requis.  Nous le configurons sur R1 et R5: <br><blockquote>  ip msdp peer 3.3.3.3 connect-source Loopback1 sur R1 </blockquote><br><blockquote>  ip msdp peer 1.1.1.1 connect-source Loopback3 sur R3 </blockquote><br>  Ils l√®veront une session entre eux et √† la r√©ception de n'importe quel flux le rapporteront √† leur voisin RP. <br>  RP-R1 d√®s qu'il re√ßoit le flux de Switch6, il enverra imm√©diatement Unicast MSDP Source-Active un message contenant des informations comme (S, G) - des informations sur la source et la destination de la multidiffusion.  Maintenant, lorsque RP-R3 saura qu'une source telle que Switch6, il enverra une jointure PIM vers Switch6 lors de la r√©ception d'une demande de R4 pour ce flux, en √©tant guid√© par la table de routage.  Par cons√©quent, R1 ayant re√ßu une telle jointure PIM, commencera √† envoyer du trafic vers RP-R3. <br>  MSDP s'ex√©cute sur TCP, les RP s'envoient des messages persistants pour v√©rifier la viabilit√©.  La minuterie est de 60 secondes. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fonction de division des homologues MSDP en diff√©rents domaines reste incompr√©hensible, car les messages Keepalive et SA n'indiquent pas l'appartenance √† un domaine. </font><font style="vertical-align: inherit;">De plus, dans cette topologie, la configuration a √©t√© test√©e avec l'indication de divers domaines - il n'y avait aucune diff√©rence de fonctionnement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si quelqu'un peut clarifier, lire avec plaisir dans les commentaires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur ce, je pense que pour terminer l'article. </font><font style="vertical-align: inherit;">Vous trouverez ci-dessous des documents et des liens utiles qui ont √©t√© utilis√©s:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CCIE Routing and Switching v5.0 Official Cert Guide, Volume 2, Fifth Edition, Narbik Kocharians, Terry Vinson. </font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des r√©seaux pour les plus petits. </font><font style="vertical-align: inherit;">Partie neuf. </font><font style="vertical-align: inherit;">Multidiffusion</font></font></a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450582/">https://habr.com/ru/post/fr450582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450568/index.html">Chaque poison a son propre antidote. Comment √©conomiser ou au moins essayer (mise √† jour: √† propos des antidotes contre les empoisonnements domestiques)</a></li>
<li><a href="../fr450572/index.html">Samba DC en tant que deuxi√®me contr√¥leur dans le domaine AD de Windows 2012R2 et dossiers itin√©rants pour les clients sous Windows et Linux</a></li>
<li><a href="../fr450574/index.html">Cr√©er un jeu web .io multijoueur</a></li>
<li><a href="../fr450576/index.html">De nouvelles r√®gles pour l'anonymat des messagers</a></li>
<li><a href="../fr450578/index.html">Qu'entend-on dans l'air? Nous recevons et d√©codons les signaux les plus int√©ressants. Partie 2, VHF</a></li>
<li><a href="../fr450586/index.html">Fish Redux - Nouvelle biblioth√®que Redux pour Flutter</a></li>
<li><a href="../fr450592/index.html">En Allemagne, le co√ªt du voyage en voiture √©lectrique peut √™tre plus √©lev√© qu'en voiture diesel</a></li>
<li><a href="../fr450594/index.html">Chiffres pairs de Fibonacci</a></li>
<li><a href="../fr450596/index.html">11. Check Point Getting Started R80.20. Politique de pr√©vention des menaces</a></li>
<li><a href="../fr450598/index.html">√Ä propos de la "pluie jaune" et de "l'agent orange"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>