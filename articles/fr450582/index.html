<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🤝‍👨🏽 ⛹🏻 🧕🏾 Principes PIM 🧓🏻 👸🏽 👨🏻‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le protocole PIM est un ensemble de protocoles pour transmettre la multidiffusion sur un réseau entre des routeurs. Les relations de voisinage sont ét...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Principes PIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450582/"> Le protocole PIM est un ensemble de protocoles pour transmettre la multidiffusion sur un réseau entre des routeurs.  Les relations de voisinage sont établies de la même manière que dans le cas des protocoles de routage dynamique.  PIMv2 envoie des messages Hello toutes les 30 secondes à l'adresse de multidiffusion réservée 224.0.0.13 (All-PIM-Routers).  Le message contient des temporisations de mise en attente - généralement 3,5 * Hello Timer, soit 105 secondes par défaut. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e67/8a0/1fc/e678a01fc7879ecf22bc6f9a3825f9a6.jpg" alt="Mon image"></a> <br>  PIM utilise deux modes de fonctionnement principaux: le mode dense et le mode clairsemé.  Commençons par le mode dense. <a name="habracut"></a><br>  <b>Arbres de distribution basés sur la source.</b> <br>  Il est conseillé d'utiliser le mode en mode dense dans le cas d'un grand nombre de clients de divers groupes de multidiffusion.  Lorsqu'un routeur reçoit du trafic multicast, la première chose qu'il fait est de le vérifier pour la règle RPF.  RPF - cette règle est utilisée pour vérifier la source d'une multidiffusion avec une table de routage unicast.  Il est nécessaire que le trafic soit arrivé à l'interface derrière laquelle cet hôte est caché selon la version de la table de routage unicast.  Ce mécanisme résout le problème de l'occurrence de boucle pendant la transmission multicast. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6cd/08c/fb6/6cd08cfb6842680447d56860334af52c.png" alt="Mon image"></a> <br>  R3 du message de multidiffusion reconnaîtra la source de la multidiffusion (source IP) et vérifiera les deux flux de R1 et R2 de sa table de monodiffusion.  Le flux de l'interface indiquée par la table (R1 à R3) sera transmis plus loin, et le flux de R2 sera abandonné, car pour arriver à la source de la multidiffusion, il est nécessaire d'envoyer des paquets via S0 / 1. <br>  La question est, que se passe-t-il si vous avez deux itinéraires équivalents avec la même métrique?  Dans ce cas, le routeur choisira le tronçon suivant pour ces routes.  Qui a une adresse IP plus élevée, il a gagné.  Si vous devez modifier ce comportement, vous pouvez utiliser ECMP.  Plus de détails <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  Après avoir vérifié la règle RPF, le routeur envoie un paquet de multidiffusion à tous ses voisins PIM, à l'exception de celui de qui le paquet a été reçu.  D'autres routeurs PIM répètent ce processus.  Le chemin que le paquet de multidiffusion a transmis de la source aux destinataires finaux forme un arbre appelé - arbre de distribution basé sur la source, arbre du chemin le plus court (SPT), arbre source.  Trois noms différents, choisissez-en un. <br>  Comment résoudre le problème avec le fait que certains routeurs n'ont pas abandonné de flux de multidiffusion et qu'il n'y a personne à qui l'envoyer et que le routeur de niveau supérieur l'envoie.  Pour cela, le mécanisme Prune a été inventé. <br>  <b>Message de taille.</b> <br>  Par exemple, R2 continuera d'envoyer la multidiffusion R3, bien que R3 selon la règle de RPF le supprime.  Pourquoi charger la chaîne?  R3 envoie un message d'élagage PIM et R2, à la réception de ce message, supprime l'interface S0 / 1 de la liste des interfaces sortantes pour ce flux, la liste des interfaces à partir desquelles ce trafic doit être envoyé. <br><blockquote>  Voici une définition plus formelle d'un message PIM Prune: <br>  Le message PIM Prune est envoyé par un routeur à un second routeur pour que le second routeur supprime la liaison sur laquelle le Prune est reçu d'un SPT particulier (S, G). </blockquote><br>  Après avoir reçu le message Prune, R2 règle la minuterie Prune sur 3 minutes.  Après trois minutes, il recommence à envoyer du trafic jusqu'à ce qu'il reçoive le prochain message Prune.  C'est dans PIMv1. <br>  Et dans PIMv2, le temporisateur de rafraîchissement d'état est ajouté (par défaut 60 secondes).  Dès qu'un message Prune a été envoyé depuis R3, ce temporisateur démarre sur R3.  Après l'expiration de ce temporisateur, R3 enverra un message d'actualisation d'état qui réinitialisera le temporisateur d'élagage de 3 minutes à R2 pour ce groupe. <br>  Raisons pour envoyer un message Prune: <br><ul><li>  Lorsqu'un paquet de multidiffusion a échoué une vérification RPF. </li><li>  Lorsqu'il n'y a aucun client connecté localement qui a demandé un groupe de multidiffusion (jointure IGMP) et qu'il n'y a aucun voisin PIM à qui le trafic de multidiffusion (interface non-élagage) peut être envoyé. </li></ul><br>  <b>Message de greffe.</b> <br>  Imaginez que R3 ne voulait pas de trafic de R2, a envoyé Prune et a reçu la multidiffusion de R1.  Mais tout à coup, le canal est tombé entre R1-R3 et R3 a été laissé sans multidiffusion.  Vous pouvez attendre 3 minutes jusqu'à ce que Prune Timer expire sur R2.  3 minutes pour attendre longtemps, afin de ne pas attendre, vous devez envoyer un message qui affiche instantanément cette interface S0 / 1 sur R2 à partir de l'état élagué.  Ce message sera un message Graft.  Après avoir reçu le message Graft, R2 enverra un Graft-ACK en réponse. <br>  <b>Prune Override.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/bc7/1d0/e9f/bc71d0e9f81b292e75d4a016a9b657ef.png" alt="Mon image"></a> <br>  Regardons ce schéma.  R1 diffuse la multidiffusion dans un segment avec deux routeurs.  R3 reçoit et diffuse le trafic, R2 reçoit, mais il n'a personne pour diffuser le trafic.  Il envoie un message Prune à R1 dans ce segment.  R1 devrait supprimer Fa0 / 0 de la liste et arrêter la diffusion dans ce segment, mais qu'adviendra-t-il de R3?  Et R3 est dans le même segment, il a également reçu ce message de Prune et a réalisé la tragédie de la situation.  Avant que R1 arrête la diffusion, il règle la minuterie sur 3 secondes et arrête la diffusion après 3 secondes.  3 secondes - juste autant de temps pour R3, afin de ne pas perdre votre multidiffusion.  Par conséquent, R3, dès que possible, envoie un message Pim Join pour ce groupe et R1 ne pense plus à arrêter la diffusion.  Rejoignez les articles ci-dessous. <br>  <b>Affirmer le message.</b> <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f1d/9d1/d68/f1d9d1d6855fdc188deb28c75bde2d0d.png" alt="Mon image"></a> <br>  Imaginez cette situation: deux routeurs diffusent sur le même réseau à la fois.  Ils reçoivent le même flux de la source et les deux le diffusent sur le même réseau derrière l'interface e0.  Par conséquent, ils doivent déterminer qui sera le seul diffuseur unique pour ce réseau.  Des messages d'assertion sont utilisés à cet effet.  Lorsque R2 et R3 détectent la duplication du trafic de multidiffusion, c'est-à-dire la multidiffusion qu'ils diffusent sur R2 et R3, qu'ils diffusent eux-mêmes, les routeurs comprennent que quelque chose ne va pas ici.  Dans ce cas, les routeurs envoient des messages d'assertion, qui incluent la distance administrative et la métrique de route par laquelle la source de multidiffusion est atteinte - 10.1.1.10.  Le gagnant est déterminé comme suit: <br><ol><li>  Celui avec AD inférieur. </li><li>  Si AD est égal, alors qui a la métrique inférieure. </li><li>  S'il y a égalité, alors celui avec une IP plus élevée dans le réseau vers lequel ils diffusent cette multidiffusion. </li></ol><br>  Gagner ce vote, le routeur devient le routeur désigné.  Pim Hello est également utilisé pour sélectionner DR.  Au début de l'article, un message PIM Hello a été affiché, vous pouvez remarquer le champ DR.  Le gagnant est celui avec une adresse IP plus élevée sur ce lien. <br>  Assiette utile: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/3de/e1a/c84/3dee1ac8448b1fceaa9f1972eff802b7.png" alt="Mon image"></a> <br>  <b>Table MROUTE.</b> <br>  Après l'examen initial du fonctionnement du protocole PIM, nous devons trouver comment travailler avec la table de routage de multidiffusion.  La table mroute stocke des informations sur les flux demandés par les clients et sur les flux provenant des serveurs de multidiffusion. <br>  Par exemple, lors de la réception d'un rapport d'adhésion IGMP ou d'une jointure PIM sur une interface, une entrée du type (*, G) est ajoutée à la table de routage: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/3ed/52c/afd3ed52cef0f9f105a0b58dff18edee.jpg" alt="Mon image"></a> <br>  Cette entrée signifie qu'une demande de trafic a été reçue avec l'adresse 238.38.38.38.  L'indicateur DC signifie que la multidiffusion fonctionnera en mode dense et C signifie que le destinataire est directement connecté au routeur, c'est-à-dire que le routeur a reçu le rapport d'adhésion IGMP et la jointure PIM. <br>  S'il y a un enregistrement comme (S, G) signifie que nous avons un flux de multidiffusion: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a78/cf2/332/a78cf23325ddc6e0c3d65322340d7ff6.jpg" alt="Mon image"></a> <br>  Dans le champ S - 192.168.1.11, nous avons enregistré l'adresse IP de la source multicast, elle sera vérifiée par la règle RPF.  En cas de problème, la première chose à faire est de vérifier la table Unicast pour l'itinéraire vers la source.  Dans le champ Interface entrante, indique l'interface à laquelle la multidiffusion arrive.  Dans la table de routage unicast, la route vers la source doit se référer à l'interface spécifiée ici.  L'interface sortante indique où la multidiffusion sera redirigée.  S'il est vide, il n'y a eu aucune demande pour ce trafic vers le routeur.  Vous trouverez plus d'informations sur tous les drapeaux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br>  <b>Mode PIM clairsemé.</b> <br>  La stratégie en mode clairsemé est l'opposé du mode dense.  Lorsque le mode clairsemé reçoit du trafic de multidiffusion, il n'enverra le trafic que via les interfaces où il y a eu des demandes pour ce flux, par exemple, les messages Pim Join ou IGMP Report demandant ce trafic. <br>  Éléments similaires pour SM et DM: <br><ul><li>  Les relations de voisinage se construisent de la même manière que dans PIM DM. </li><li>  La règle RPF fonctionne. </li><li>  Le choix de DR est similaire. </li><li>  Le moteur Prune Overrides et les messages Assert sont similaires. </li></ul><br>  Pour contrôler qui a besoin où, où et quel trafic de multidiffusion est nécessaire sur le réseau, un centre d'information commun est nécessaire.  Un tel centre, nous aurons Rendezvous Point (RP).  Toute personne qui souhaite une sorte de trafic de multidiffusion ou quelqu'un a commencé à recevoir du trafic de multidiffusion de la source, puis il l'envoie au RP. <br>  Lorsque le RP reçoit du trafic de multidiffusion, il l'enverra aux routeurs qui ont précédemment demandé ce trafic. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/025/d45/651/025d4565117dce5f8da07609c823c63e.jpg" alt="Mon image"></a> <br>  Imaginez une telle topologie où RP est R3.  Dès que R1 reçoit du trafic de S1, il encapsule ce paquet de multidiffusion dans un message de registre PIM unicast et l'envoie à RP.  Comment sait-il qui est RP?  Dans ce cas, il est configuré de manière statique, et nous parlerons de l'optimisation RP dynamique plus tard. <br><blockquote>  ip pim rp-address 3.3.3.3 </blockquote><br>  RP va regarder - y avait-il des informations de quelqu'un qui aimerait recevoir ce trafic?  Supposons que ce ne soit pas le cas.  Ensuite, RP enverra à R1 un message PIM Register-Stop, ce qui signifie que personne n'a besoin de cette multidiffusion, l'enregistrement est refusé.  R1 n'enverra pas de multidiffusion.  Mais la source de multidiffusion l'enverra, donc R1, après avoir reçu Register-Stop, démarrera le temporisateur de suppression de registre, qui est de 60 secondes.  5 secondes avant l'expiration du temporisateur, R1 enverra un message de registre vide avec un bit de registre nul (c'est-à-dire sans paquet de multidiffusion encapsulé) du côté RP.  RP à son tour agira comme ceci: <br><ul><li>  S'il n'y avait pas et aucun destinataire, il répondra par un message Register-Stop. </li><li>  Si les destinataires sont apparus, il ne lui répondra en aucune façon.  R1, n'ayant pas reçu de refus d'enregistrement dans les 5 secondes, sera ravi et enverra à Register un message avec la multidiffusion encapsulée à RP. </li></ul><br>  Alors que la multidiffusion atteint le RP, elle semble être réglée, essayons maintenant de répondre à la question de savoir comment le RP achemine le trafic vers les destinataires.  Ici, vous devez introduire un nouveau concept - l'arbre du chemin racine (RPT).  Un RPT est un arbre dont la racine dans le RP croît vers les destinataires se ramifiant sur chaque routeur PIM-SM.  RP le crée en recevant des messages PIM Join et ajoute une nouvelle branche à l'arborescence.  Et il en va de même pour chaque routeur en aval.  La règle générale ressemble à ceci: <br><ul><li>  Lorsqu'un routeur PIM-SM reçoit un message PIM Join sur n'importe quelle interface, à l'exception de l'interface derrière laquelle le RP est masqué, il ajoute une nouvelle branche à l'arborescence. </li><li>  Une branche est également ajoutée lorsque le routeur PIM-SM reçoit un rapport d'appartenance IGMP d'un hôte directement connecté. </li></ul><br>  Imaginez que nous ayons un client de multidiffusion sur le routeur R5 pour le groupe 228.8.8.8.  Dès que R5 reçoit un rapport d'appartenance IGMP de l'hôte, R5 envoie une jointure PIM en direction de RP, et il ajoute lui-même une interface regardant l'hôte dans l'arborescence.  Ensuite, R4 reçoit une jointure PIM de R5, ajoute l'interface Gi0 / 1 à l'arborescence et envoie la jointure PIM en direction de RP.  Enfin, RP (R3) reçoit une jointure PIM et ajoute Gi0 / 0 à l'arborescence.  Ainsi, l'enregistrement du destinataire de multidiffusion est obtenu.  Nous construisons un arbre avec la racine R3-Gi0 / 0 → R4-Gi0 / 1 → R5-Gi0 / 0. <br>  Après cela, PIM Join sera envoyé à R1 et R1 commencera à envoyer du trafic de multidiffusion.  Il est important de noter que si l'hôte a demandé du trafic avant le début de la diffusion multidiffusion, le RP n'enverra pas de jointure PIM et n'enverra rien du tout au côté R1. <br>  Si soudainement pendant qu'une multidiffusion est envoyée, l'hôte cesse de vouloir la recevoir, dès que le RP reçoit PIM Prune sur l'interface Gi0 / 0, alors il envoie immédiatement le PIM Register-Stop directement à R1, puis le message PIM Prune via l'interface Gi0 / 1.  L'arrêt du registre PIM est envoyé par monodiffusion à l'adresse à partir de laquelle le registre PIM est arrivé. <br>  Comme nous l'avons dit précédemment, dès que le routeur envoie une jointure PIM à un autre, par exemple, R5 sur R4, alors une entrée est ajoutée à R4: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9f7/730/678/9f7730678743efb4e9670d18fcd54525.jpg" alt="Mon image"></a> <br>  Et le minuteur démarre que pour réinitialiser ce minuteur, R5 doit constamment PIM Join messages constamment, sinon R4 sera exclu de la liste sortante.  R5 enverra tous les 60 messages PIM Join. <br>  <b>Commutation d'arbre sur le chemin le plus court.</b> <br>  Nous allons ajouter une interface entre R1 et R5, voir comment le trafic circulera avec cette topologie. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/afd/113/eb0/afd113eb01e7deda4c389fbb1a02060a.jpg" alt="Mon image"></a> <br>  Disons que le trafic a été envoyé et reçu selon l'ancien schéma R1-R2-R3-R4-R5 et ici nous avons connecté et configuré l'interface entre R1 et R5. <br>  Tout d'abord, nous devons reconstruire la table de routage unicast sur R5 et maintenant le réseau 192.168.1.0/24 est atteint via l'interface R5 Gi0 / 2.  Maintenant, lorsque R5 reçoit une multidiffusion sur l'interface Gi0 / 1, il comprend que la règle RPF n'est pas satisfaite et il serait plus logique de recevoir une multidiffusion sur Gi0 / 2.  Il doit se déconnecter du RPT et construire une arborescence plus courte appelée la Shortest-Path Tree (SPT).  Pour ce faire, via Gi0 / 2, il envoie une jointure PIM à R1 et R1 commence également à envoyer des multidiffusions via Gi0 / 2.  Maintenant, R5 doit se désinscrire du RPT, afin de ne pas obtenir deux copies.  Pour ce faire, il envoie un message Prune indiquant l'adresse IP de la source et insérant un bit spécial - RPT-bit.  Cela signifie que je n'ai pas besoin d'envoyer de trafic, j'ai un meilleur arbre ici.  Le RP envoie également des messages du côté R1 PIM Prune, mais n'envoie pas de message Register-Stop.  Autre caractéristique: R5 enverra désormais constamment PIM Prune à RP, car R1 continue d'envoyer PIM Register à RP toutes les minutes.  RP jusqu'à ce que de nouvelles personnes souhaitent que ce trafic le refuse.  R5 informe le RP qu'il continue de recevoir la multidiffusion via SPT. <br>  <b>Recherche RP dynamique.</b> <b><br></b>  <b>Auto-RP</b> <br>  Cette technologie est propriétaire de Cisco et n'est pas particulièrement populaire, mais toujours vivante.  Auto-RP comprend deux étapes principales: <br>  1) RP envoie des messages RP-Announce à l'adresse réservée - 224.0.1.39, se déclarant RP pour tous ou pour certains groupes.  Ce message est envoyé toutes les minutes. <br>  2) Un agent de mappage RP est requis qui enverra des messages RP-Discovery indiquant pour quels groupes quel RP écouter.  C'est à partir de ce message que les routeurs PIM ordinaires détermineront eux-mêmes le RP.  L'agent de mappage peut être le routeur RP lui-même ou tout routeur PIM distinct.  RP-Discovery est envoyé à l'adresse 224.0.1.40 avec un minuteur d'une minute. <br>  Regardons le processus plus en détail: <br>  Définissez R3 comme RP: <br><blockquote>  ip pim send-rp-announce loopback 0 portée 10 </blockquote><br>  R2 comme agent de mappage: <br><blockquote>  ip pim send-rp-discovery loopback 0 portée 10 </blockquote><br>  Et sur tous les autres, nous nous attendrons à RP via Auto-RP: <br><blockquote>  écouteur autorp ip pim </blockquote><br>  Une fois que nous aurons configuré R3, il commencera à envoyer RP-Announce: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/aae/ae2/565/aaeae25659fbacd4ba49ae4c5486f46f.jpg" alt="Mon image"></a> <br>  Et R2, après avoir configuré l'agent de mappage, il attendra le message RP-Announce.  Ce n'est que lorsqu'il trouve au moins un RP qu'il commencera à envoyer RP-Discovery: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fb8/e44/7c2/fb8e447c26e33ecda18cb82c5f05c938.jpg" alt="Mon image"></a> <br>  Ainsi, dès que les routeurs réguliers (écouteur RP PIM) recevront ce message, ils sauront où chercher le RP. <br>  L'un des principaux problèmes d'Auto-RP est que pour recevoir les messages RP-Announce et RP-Discovery, vous devez envoyer PIM Join aux adresses 224.0.1.39-40 et pour envoyer, vous devez savoir où se trouve le RP.  Le problème classique du poulet et des œufs.  Pour résoudre ce problème, le PIM Sparse-Dense-Mode a été inventé.  Si le routeur ne connaît pas RP, alors il fonctionne en mode dense, s'il le sait, alors en mode clairsemé.  Lorsque PIM Sparse-mode et la commande ip pim autorp listener sont configurés sur les interfaces des routeurs ordinaires, le routeur fonctionnera en mode dense uniquement pour le protocole multicast directement Auto-RP (224.0.1.39-40). <br>  <b>Routeur BootStrap (BSR).</b> <br>  Cette fonction fonctionne de manière similaire à Auto-RP.  Chaque RP envoie un message d'agent de mappage, qui recueille des informations de mappage puis en informe tous les autres routeurs.  Nous décrivons le processus de manière similaire à Auto-RP: <br>  1) Une fois que nous avons configuré R3 en tant que candidat pour être RP, la commande: <br><blockquote>  ip pim rp-candidate loopback 0 </blockquote><br>  Que R3 ne fasse rien, afin de commencer à envoyer des messages spéciaux, il a besoin, pour commencer, de trouver un agent de mappage.  Ainsi, nous passons à la deuxième étape. <br>  2) Configurez R2 comme agent de mappage: <br><blockquote>  ip pim bsr-candidate loopback 0 </blockquote><br>  R2 commence à envoyer des messages d'amorçage PIM, où il s'indique comme agent de mappage: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/729/3a4/ad1/7293a4ad164ed8342ff42ceffee9a32b.jpg" alt="Mon image"></a> <br>  Ce message est envoyé à l'adresse 224.0.013, que le protocole PIM utilise pour ses autres messages.  Il les envoie dans toutes les directions et donc il n'y a pas de problème de poulet et d'oeufs, comme c'était le cas en Auto-RP. <br>  3) Dès que le RP reçoit un message du BSR du routeur, il enverra immédiatement un message unicast à l'adresse du BSR du routeur: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5ed/217/8c1/5ed2178c151886f79c1e6197b9b5385b.jpg" alt="Mon image"></a> <br>  Après cela, lorsque le BSR reçoit des informations sur le RP, il les envoie avec la multidiffusion à l'adresse 224.0.0.13, que tous les routeurs PIM écoutent.  Par conséquent, il n'y a pas d'analogue de la commande <i>ip pim autorp listener</i> pour les routeurs ordinaires dans BSR. <br>  <b>Anycast RP avec MSDP (Multicast Source Discovery Protocol).</b> <br>  Auto-RP et BSR nous permettent de répartir la charge sur le RP comme suit: Chaque groupe de multidiffusion n'a qu'un seul RP actif.  Il ne fonctionnera pas pour rendre la distribution de charge pour un groupe de multidiffusion multiple RP.  MSDP le fait en émettant aux routeurs RP la même adresse IP avec un masque de 255.255.255.255.  MSDP reconnaît les informations en utilisant l'une des méthodes: statique, Auto-RP ou BSR. <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/406/51a/032/40651a032dadaaf6e0c51cbf06c3fbf3.png" alt="Mon image"></a> <br>  Dans l'image, nous avons une configuration Auto-RP avec MSDP.  Les deux RP sont configurés avec l'adresse IP 172.16.1.1/32 sur l'interface Loopback 1 et sont utilisés pour tous les groupes.  Lorsque RP-Announce, les deux routeurs parlent d'eux-mêmes, se référant à cette adresse.  Après avoir reçu des informations, l'agent de mappage Auto-RP envoie RP-Discovery sur le RP avec l'adresse 172.16.1.1/32.  À propos du réseau 172.16.1.1/32, nous indiquons aux routeurs utilisant IGP et, respectivement.  Ainsi, les routeurs PIM demandent ou enregistrent des flux du RP indiqué comme prochain bond sur la route vers le réseau 172.16.1.1/32.  Le protocole MSDP lui-même est conçu pour que les RP eux-mêmes échangent des messages d'informations de multidiffusion. <br>  Considérez la topologie suivante: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/2ba/f2d/dc4/2baf2ddc4deb54ebb671a6fb52282a41.jpg" alt="Mon image"></a> <br>  Switch6 diffuse le trafic à l'adresse 238.38.38.38 et jusqu'à présent, seul le RP-R1 en a connaissance.  Ici, Switch7 et Switch8 ont demandé ce groupe.  Les routeurs R5 et R4 enverront PIM Join à R1 et R3, respectivement.  Pourquoi?  La route jusqu'au 13.13.13.13 sur R5 fera référence à R1 selon la métrique IGP, comme sur R4. <br>  RP-R1 connaît le flux et commence à le diffuser en direction de R5, mais R4 n'en sait rien, car R1 ne l'enverra pas.  Par conséquent, MSDP est requis.  Nous le configurons sur R1 et R5: <br><blockquote>  ip msdp peer 3.3.3.3 connect-source Loopback1 sur R1 </blockquote><br><blockquote>  ip msdp peer 1.1.1.1 connect-source Loopback3 sur R3 </blockquote><br>  Ils lèveront une session entre eux et à la réception de n'importe quel flux le rapporteront à leur voisin RP. <br>  RP-R1 dès qu'il reçoit le flux de Switch6, il enverra immédiatement Unicast MSDP Source-Active un message contenant des informations comme (S, G) - des informations sur la source et la destination de la multidiffusion.  Maintenant, lorsque RP-R3 saura qu'une source telle que Switch6, il enverra une jointure PIM vers Switch6 lors de la réception d'une demande de R4 pour ce flux, en étant guidé par la table de routage.  Par conséquent, R1 ayant reçu une telle jointure PIM, commencera à envoyer du trafic vers RP-R3. <br>  MSDP s'exécute sur TCP, les RP s'envoient des messages persistants pour vérifier la viabilité.  La minuterie est de 60 secondes. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La fonction de division des homologues MSDP en différents domaines reste incompréhensible, car les messages Keepalive et SA n'indiquent pas l'appartenance à un domaine. </font><font style="vertical-align: inherit;">De plus, dans cette topologie, la configuration a été testée avec l'indication de divers domaines - il n'y avait aucune différence de fonctionnement. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si quelqu'un peut clarifier, lire avec plaisir dans les commentaires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sur ce, je pense que pour terminer l'article. </font><font style="vertical-align: inherit;">Vous trouverez ci-dessous des documents et des liens utiles qui ont été utilisés:</font></font><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> CCIE Routing and Switching v5.0 Official Cert Guide, Volume 2, Fifth Edition, Narbik Kocharians, Terry Vinson. </font></font></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Des réseaux pour les plus petits. </font><font style="vertical-align: inherit;">Partie neuf. </font><font style="vertical-align: inherit;">Multidiffusion</font></font></a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr450582/">https://habr.com/ru/post/fr450582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr450568/index.html">Chaque poison a son propre antidote. Comment économiser ou au moins essayer (mise à jour: à propos des antidotes contre les empoisonnements domestiques)</a></li>
<li><a href="../fr450572/index.html">Samba DC en tant que deuxième contrôleur dans le domaine AD de Windows 2012R2 et dossiers itinérants pour les clients sous Windows et Linux</a></li>
<li><a href="../fr450574/index.html">Créer un jeu web .io multijoueur</a></li>
<li><a href="../fr450576/index.html">De nouvelles règles pour l'anonymat des messagers</a></li>
<li><a href="../fr450578/index.html">Qu'entend-on dans l'air? Nous recevons et décodons les signaux les plus intéressants. Partie 2, VHF</a></li>
<li><a href="../fr450586/index.html">Fish Redux - Nouvelle bibliothèque Redux pour Flutter</a></li>
<li><a href="../fr450592/index.html">En Allemagne, le coût du voyage en voiture électrique peut être plus élevé qu'en voiture diesel</a></li>
<li><a href="../fr450594/index.html">Chiffres pairs de Fibonacci</a></li>
<li><a href="../fr450596/index.html">11. Check Point Getting Started R80.20. Politique de prévention des menaces</a></li>
<li><a href="../fr450598/index.html">À propos de la "pluie jaune" et de "l'agent orange"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>