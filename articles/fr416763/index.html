<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÜüèø üëåüèø üë®üèΩ‚Äçüè´ Puppet Salt Chef Ensemble: comparez Ansible, SaltStack, Chef et Puppet üéπ üíù üë©üèΩ‚Äçü§ù‚Äçüë©üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous parlerons de ce qu'est le SCM et raconterons quelques histoires √† travers le prisme dont nous consid√©rerons Ansible, SaltStack, Chef...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Puppet Salt Chef Ensemble: comparez Ansible, SaltStack, Chef et Puppet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416763/">  Aujourd'hui, nous parlerons de ce qu'est le SCM et raconterons quelques histoires √† travers le prisme dont nous consid√©rerons Ansible, SaltStack, Chef et Puppet, en choisissant la meilleure option pour une t√¢che sp√©cifique. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3xA2SggKQKo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Le mat√©riel est bas√© sur la transcription d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport d'Andrei Filatov</a> , ing√©nieur syst√®me en chef chez EPAM Systems, de notre conf√©rence d'octobre DevOops 2017. <br><a name="habracut"></a><br><h2>  Qu'est-ce que le SCM et avec quoi mange-t-il? </h2><br><img src="https://habrastorage.org/webt/hc/qk/qz/hcqkqz63ox1qwcu5qrfc08hkg7o.jpeg"><br><br>  Qu'est-ce que le SCM?  Tout d'abord, c'est une chose qui permet √† notre infrastructure de l'√©tat A d'ex√©cuter l'√©tat B en ex√©cutant du code. De nombreux d√©veloppeurs qui ne sont pas des ing√©nieurs DevOps dans la pratique pensent que quelque chose se passe d'une mani√®re ¬´automatique¬ª. sur les infrastructures. <br><br>  La m√©thode "automatique" nous impl√©mente SCM (System Configuration Management).  √Ä quoi √ßa sert?  Principalement pour construire des infrastructures reproductibles et coh√©rentes.  SCM √©tend bien les processus CI / CD.  Puisqu'il s'agit de code, il peut √™tre stock√© dans n'importe quel syst√®me de contr√¥le de version: Git, Mercurial.  Il est assez simple √† d√©velopper et √† maintenir. <br><br>  La derni√®re est un cycle d'automatisation ferm√©: tout peut √™tre fait automatiquement, de la cr√©ation de l'infrastructure au d√©ploiement et au d√©ploiement du code. <br><br><h2>  Qu'est-ce que SCM: Ansible </h2><br><img src="https://habrastorage.org/webt/w8/kg/5z/w8kg5z-9n6uy-eva2x5ofgeiuig.jpeg"><br><br>  Consid√©rez nos candidats.  Le premier est Ansible.  Il a une architecture sans agent, si nous parlons d'une version open source, il est √©crit en Python, il a une DSL de type Yaml, il est facilement extensible gr√¢ce aux modules √©crits en Python, il est tr√®s simple et l√©ger.  Ansible a le seuil d'entr√©e le plus bas - vous pouvez enseigner √† n'importe qui. <br><br>  Il y a de l'exp√©rience lorsqu'une personne, ne connaissant pas Python, ne connaissant rien au SCM, est entr√©e dans Ansible en seulement deux jours et a d√©j√† commenc√© √† faire quelque chose. <br>  Ci-dessous, un exemple de ChatOps: un notifiant dans Slack.  Le code Ansible qui a vu Yaml n'a rien de nouveau. <br><br><pre><code class="hljs pgsql">- block: - <span class="hljs-type"><span class="hljs-type">name</span></span>: "SlackNotify : Deploy Start" local_action: module: slack token: "{{ slack_url }}" attachments: - title: "Deploy to {{ inventory_hostname }} has been Started" <span class="hljs-type"><span class="hljs-type">text</span></span>: "&lt;!here&gt; :point_up_2:" color: "#551a8b" - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: configure.yml tags: - configure - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: remote-<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span>.yml tags: - remote - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: assets.yml</code> </pre> <br><hr><br><h2>  Qu'est-ce que SCM: Chef </h2><br><img src="https://habrastorage.org/webt/wi/kr/bd/wikrbdzapzntbjimi4ns5jw2bm0.jpeg"><br><br>  Chef est une architecture client-serveur, il y a un serveur Chef et un client Chef.  La configuration bas√©e sur la recherche, √©crite en Ruby, a Ruby DSL.  Par cons√©quent, dans vos livres de recettes et recettes, vous pouvez utiliser toute la puissance de Ruby, mais je ne vous conseille pas de le faire.  Chef poss√®de une √©norme communaut√© et le plus grand ensemble d'outils parmi tous les SCM.  Voici √† quoi ressemble le code Chef, c'est le d√©ploiement de Jetty. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># # Cookbook Name:: dg-app-edl # Recipe::fe # node.normal[:jetty][:home] = "/usr/share/jetty" node.normal[:jetty][:group] = "deploy" include_recipe "dg-auth::deploy" include_recipe "newrelic::repository" include_recipe "newrelic::server-monitor" include_recipe "dg-jetty::jetty9" include_recipe "newrelic::java-agent" directory "edl" do action :create owner group "deploy" mode "0775" path "/usr/share/where/edl" recursive true end</span></span></code> </pre><br><hr><br><h2>  Qu'est-ce que SCM: SaltStack </h2><br><img src="https://habrastorage.org/webt/um/dp/qa/umdpqavcnru1d40qd-bncyclmx8.jpeg"><br><br>  SaltStack poss√®de √† la fois une architecture sans agent qui fonctionne en mode push avec Salt-SSH et une architecture client-serveur lorsqu'il y a Salt-master et Salt-minion.  L'accent est mis sur l'automatisation en temps r√©el, l'ex√©cution parall√®le pr√™te √† l'emploi de tous les processus et √©crite en Python.  √âgalement un langage de type Yaml, le code est tr√®s similaire √† Ansible. <br><br><pre> <code class="hljs mel">#ntp-packages: pkg.installed: - pkgs: - ntp - ntpdate #/etc/ntp.conf: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>: - managed - <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>: salt:<span class="hljs-comment"><span class="hljs-comment">//common/ntpd/ntp.conf - template: jinja - mode: 644 #/etc/sysconfig/ntpd: file: - managed - source: salt://common/ntpd/ntpd - template: jinja - mode: 644 #ntp-service: service.running: - name: ntpd</span></span></code> </pre><br><hr><br><h2>  Qu'est-ce que SCM: Puppet </h2><br><img src="https://habrastorage.org/webt/iz/-3/ac/iz-3acdxp8hdgg-lxxk_lp8oilq.jpeg"><br><br>  Le dernier de nos soumissionnaires est Puppet.  Il a √©galement une architecture client-serveur, comme Chef, la configuration n'est pas bas√©e sur la recherche, mais sur les "faits" qui viennent avec le Puppet-master, √©crit en Ruby, a un DSL de type Ruby.  Mais les gars de Puppet ne sont pas autoris√©s √† utiliser du code Ruby pur dans leurs manifestes.  C'est √† la fois un plus et un moins.  Voici √† quoi ressemble le code manifeste Puppet: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> { '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::server</span></span></span><span class="hljs-class">' : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">root_password</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">password</span></span></span><span class="hljs-class">' } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ ['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test2</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test3</span></span></span><span class="hljs-class">']: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utf8</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">require</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Class</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::server</span></span></span><span class="hljs-class">'], } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test4</span></span></span><span class="hljs-class">': </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">latin1</span></span></span><span class="hljs-class">', } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test5</span></span></span><span class="hljs-class">': </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binary</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">collate</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binary</span></span></span><span class="hljs-class">', }</span></span></code> </pre><br><h2>  SCM en pratique </h2><br><h3>  SaltStack dans un environnement d√©militaris√© </h3><br>  Tout d'abord, je voudrais partager un projet qui a √©t√© √©crit sur SaltStack.  C'est notre projet pr√©c√©dent et la douleur la plus fra√Æche, et la douleur la plus fra√Æche est toujours la plus douloureuse.  Notre client est engag√© dans le stockage de donn√©es - c'est la production de serveurs de fer pour stocker des donn√©es sur GPFS, GlusterFS, mais des constructions personnalis√©es.  Il nous a confi√© les t√¢ches suivantes: <br><br><ol><li>  Cr√©ation d'un programme d'installation USB / DVD.  Vous devez cr√©er un support √† partir duquel tout est install√©.  Cela se fait pour les clients clients qui vivent dans des zones ferm√©es, o√π les serveurs n'ont g√©n√©ralement pas Internet.  Nous devons emballer dans un ISO, envoyer aux ing√©nieurs de terrain qui d√©ploieront tout le n√©cessaire sur site. <br></li><li>  D√©ployez un cluster de produits.  Les clients ont plusieurs gros produits, il faut pouvoir les d√©ployer en mode cluster. <br></li><li>  Gestion, configuration et maintenance du cluster √† l'aide de l'utilitaire CLI.  Notre cadre devrait aider les ing√©nieurs de terrain √† g√©rer le cluster. <br></li></ol><br>  Le client avait plusieurs exigences.  Tout d'abord, il poss√®de une √©norme expertise Python, en fait uniquement des d√©veloppeurs C et Python.  Le client a imm√©diatement d√©clar√©: ¬´Nous voulons SaltStack¬ª, ne laissant aucun choix. <br><br>  √Ä quoi sommes-nous confront√©s?  Le client a plusieurs produits dans l'installation, tous doivent √™tre avec Salt-Masters.  Mais nous sommes confront√©s au probl√®me de la mise √† l'√©chelle de la configuration Multi-Master.  Par exemple, dans NODE Info (le statut d'un serveur sp√©cifique), nous avons s√©lectionn√© des millisecondes avec une configuration √† deux ma√Ætres, des secondes avec trois ma√Ætres et avec cinq, nous n'avons jamais attendu la fin de l'op√©ration.  MultiMaster est une bonne fonctionnalit√©, mais il ne s'adapte pas bien. <br><br>  Le deuxi√®me probl√®me que nous avons rencontr√© √©tait le travail d'√©quipe: SaltStack a Runner et Module.  Le module est une extension qui fonctionne sur Salt Minion, c√¥t√© machine.  Runner s'ex√©cute c√¥t√© serveur.  Nous avons souvent eu des batailles: que faire Runner et que faire des modules. <br><br>  Ensuite, nous sommes tomb√©s sur une petite surprise de cache.mine: <br><br><pre> <code class="python hljs">ime = ImeActions() id = __grains__[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> id == ime.master_id: ret = __salt__[<span class="hljs-string"><span class="hljs-string">'mine.get'</span></span>](id, <span class="hljs-string"><span class="hljs-string">'ime_actions.make_bfs_uuid'</span></span>) ime_dict = ret.get(id, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ime_dict: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: result = __salt__[<span class="hljs-string"><span class="hljs-string">'mine.send'</span></span>](<span class="hljs-string"><span class="hljs-string">'ime_actions.make_bfs_uuid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exeption, e: log.error(<span class="hljs-string"><span class="hljs-string">"Failed to generate uuid: {0}."</span></span>.format(str(e))) result = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:</code> </pre><br>  Nous avons un utilitaire qui est √©crit en C. Nous l'ex√©cutons, il g√©n√®re un ID al√©atoire.  Il doit √™tre unique parmi tous les participants du cluster, respectivement, nous devons le faire une fois sur le ma√Ætre, puis le r√©partir entre les machines.  Nous avons utilis√© cache.mine pour cela.  En fait, il ne conna√Æt pas de red√©marrage. <br><br><img src="https://habrastorage.org/webt/g1/n6/bo/g1n6boipselezqysof41glvfa5s.jpeg"><br><br>  "Condition de course."  La parall√©lisation est bonne, mais dans la configuration de base, state.orchestrate entre dans state.sls s'ex√©cute si de longs processus se produisent.  √Ä l'expiration du d√©lai, il estime que l'√âtat est d√©j√† termin√©, bien qu'il soit toujours en cours d'ex√©cution, et essaie de d√©marrer le suivant.  Une erreur se produit.  Et ce probl√®me n'est pas encore r√©solu. <br><br><img src="https://habrastorage.org/webt/uq/s5/wb/uqs5wbeqhfc8o22yr9mwck3fcbg.jpeg"><br>  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">regarder GitHub</a> . <br><br>  Que pourrions-nous utiliser en plus de SaltStack? <br><br><h3>  SaltStack dans un environnement DMZ </h3><br><img src="https://habrastorage.org/webt/ze/k6/me/zek6meak3aivzorfh7rsgf4e9na.jpeg"><br><br><ul><li>  DMZ  Le chef est super, Puppet aussi.  Et avec Ansible, le probl√®me est - s'il n'y a pas de tour - il n'y a aucun moyen de d√©marrer la configuration en mode Pull √† partir de nos n≈ìuds, ce qui doit √™tre fait dans la zone d√©militaris√©e. <br></li><li>  Framework pour CLI (en Python).  Chef et Puppet ne conviennent pas tr√®s bien, mais si vous n'avez aucune restriction pour utiliser uniquement Python, vous pouvez √©crire en Ruby et utiliser les API Chef ou Puppet.  La bo√Æte √† outils Ansible ne prend pas en charge cela. <br></li><li>  Gestion des clusters.  Chef est bien adapt√© √† la gestion des clusters, Puppet aussi, et Ansible a √©t√© initialement √©crit pour g√©rer les clusters sur Amazon. <br></li></ul><br><h3>  Chef dans un environnement vaste et dynamique </h3><br>  Le client a eu pour t√¢che de consolider toutes les ressources dans un seul cloud - c'√©tait Openstack.  Avant cela, tout √©tait dispers√©: quelque chose sur le Rackspace Cloud, quelque chose sur des serveurs d√©di√©s ou leurs centres de donn√©es priv√©s. <br><br>  Ils souhaitaient une gestion des ressources enti√®rement dynamique, et aussi pour que leurs applications puissent s'ajouter de la capacit√© si n√©cessaire.  Autrement dit, nous avons besoin d'une infrastructure dynamique compl√®te et d'un environnement enti√®rement dynamique de haut en bas. <br><br>  Pour construire correctement le processus du CD, vous avez besoin d'un environnement enti√®rement automatis√©.  Nous avons cr√©√© SDLC - Software Development Lifecycle pour eux, et l'avons appliqu√©, y compris pour SCM.  Ils passent des tests d'int√©gration non seulement des applications, mais aussi des infrastructures. <br><br>  En cons√©quence, lorsque quelque chose ne va pas chez nous, nous, comme les gars de Netflix, devrions √™tre capables de tuer les ressources d√©fectueuses et de restaurer les travailleurs frais et garantis √† leur place. <br><br>  Quels probl√®mes avons-nous rencontr√©s: <br><br><ol><li>  C'√©tait en 2013, utilis√© Chef 10, dans lequel une recherche lente.  Nous avons commenc√© la recherche, faisant le tour de toutes les voitures, et cela a pris une √©ternit√©.  Nous avons essay√© de r√©soudre le probl√®me avec la convention de d√©nomination, ainsi que la s√©lection et la recherche de fqdn.  Cela a r√©duit la port√©e de la recherche, raison pour laquelle elle a √©t√© acc√©l√©r√©e. <br><br>  Mais certaines op√©rations doivent √™tre effectu√©es sur l'ensemble de l'environnement.  En cons√©quence, la recherche a √©t√© ex√©cut√©e une fois au tout d√©but, le r√©sultat a √©t√© stock√© dans l'attribut et √† l'aide de Ruby, nous avons filtr√© les r√©sultats: nous avons analys√© les √©l√©ments dont nous avions besoin et fait ce qui √©tait n√©cessaire. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !Chef::Config[<span class="hljs-symbol"><span class="hljs-symbol">:solo</span></span>] search(<span class="hljs-symbol"><span class="hljs-symbol">:node</span></span>, <span class="hljs-string"><span class="hljs-string">"fqdn:*metro-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:env</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">-mongodb*"</span></span>).each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|mongo|</span></span> @mongodbs &lt;&lt; mongo.fqdn <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> @mongodbs = [<span class="hljs-string"><span class="hljs-string">"lvs-metro-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:env</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">-mongodb3001.qa.example.com"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Conclusion: utilisez les conventions de d√©nomination, ex√©cutez la recherche une fois, utilisez Ruby pour filtrer les r√©sultats souhait√©s. <br></li><li>  L'utilisation de "node.save" n'est pas s√ªre, soyez prudent et prudent.  Nous avons rencontr√© ce probl√®me lors du d√©ploiement de clusters MySQL et utilis√© node.save dans la recette sur un n≈ìud MySQL incompl√®tement configur√©.  Et au moment de la mise √† l'√©chelle, certaines applications ont donn√© une erreur de 500.  Il s'est av√©r√© que nous sauvegardions le n≈ìud au mauvais moment: il va au serveur Chef, l√†, le client Chef sur l'interface utilisateur r√©cup√®re un nouveau n≈ìud qui n'a pas √©t√© configur√© avant le mode de fonctionnement. <br></li><li>  Le manque de "splay" peut tuer le serveur du chef.  Splay est un param√®tre client Chef qui vous permet de d√©finir la plage lorsque le client se rend sur le serveur pour configuration.  Avec une charge √©lev√©e, lorsque vous devez d√©ployer plusieurs n≈ìuds en m√™me temps, cela ne tuera pas le serveur. <br></li></ol><br>  Que pouvons-nous utiliser √† la place du chef? <br><br><img src="https://habrastorage.org/webt/0w/xx/rm/0wxxrmdr90fpnyppzwoumgkbmai.jpeg"><br><br><ul><li>  Provisionnement dynamique  SaltStack est parfait car il a SaltCloud qui s'int√®gre parfaitement n'importe o√π.  Puppet a des fonctionnalit√©s similaires, mais il n'est disponible que dans Puppet Enterprise, pour de l'argent.  Ansible est bien adapt√© si l'entreprise "vit" en Amazonie, sinon autre chose - vous pouvez l'associer √† des alternatives, mais ce n'est pas si pratique. <br></li><li>  SDLC.  Chef a tout, de la cuisine de test au choix des outils pour les tests d'int√©gration.  SaltStack a tous les outils Python disponibles, maintenant Puppet a tout.  Ansible a une sp√©cification de r√¥le, vous pouvez utiliser la cuisine de test du chef, mais ce n'est pas un outil natif. <br></li><li>  Remplacement des ressources.  Tout va bien dans Chef, dans SaltStack vous pouvez terminer SaltCloud √† l'√©tat souhait√©, dans Puppet, les outils ne sont que dans la version Enterprise, et Ansible ne fonctionne bien qu'avec Amazon. <br></li></ul><br><h3>  EPAM Private Cloud avec Chef </h3><br>  Un an et demi avant l'av√®nement d'AWS OpsWorks, nous voulions cr√©er une Amazon CloudFormation avanc√©e en int√©grant Chef afin que les ressources soient non seulement d√©ploy√©es, mais √©galement configur√©es. <br><br>  La deuxi√®me t√¢che globale consiste √† cr√©er un catalogue de services afin que les clients et les utilisateurs puissent utiliser la CLI pour d√©ployer une pile LAMP compl√®tement pr√™te √† l'emploi, par exemple. <br><br><img src="https://habrastorage.org/webt/a4/cy/f6/a4cyf6ep8anoudzr6ydh7as2yrg.jpeg"><br><br>  Nous avons choisi Chef, mais le projet devait prendre en charge diff√©rents SCM.  Nous avons commenc√© avec le Chef-Server int√©gr√©, et les utilisateurs pouvaient √©galement utiliser leur propre Chef-Server, qui est h√©berg√© quelque part avec eux.  Autrement dit, nous n'avons pas eu acc√®s aux ressources utilisateur et aux ordinateurs portables, mais cela a quand m√™me fonctionn√©. <br><br><img src="https://habrastorage.org/webt/xf/vh/py/xfvhpysd5j89seh3qgrei3o5ryi.jpeg"><br><br>  Tout SCM peut √™tre utilis√© pour impl√©menter CloudFormation + OpsWork, tout le monde convient.  Pour cr√©er un catalogue - tout le monde sauf SaltStack le fera bien.  SaltStack a ses nuances: il est extr√™mement difficile de trouver un sp√©cialiste connaissant bien SaltStack et pouvant cr√©er un service et remplir le catalogue. <br><br><h3>  La popularit√© de SCM dans EPAM </h3><br><img src="https://habrastorage.org/webt/d3/o1/z2/d3o1z2giceihh4izcy4r6zlnkpq.jpeg"><br><br>  Ce sont des statistiques de popularit√© de SCM au sein d'EPAM.  SaltStack est tr√®s loin derri√®re.  En premier lieu Ansible, c'est la plus simple et avec un seuil d'entr√©e bas.  Lorsque nous essayons de trouver quelqu'un sur le march√© connaissant la SCM, le march√© est √† peu pr√®s le m√™me. <br><br><h3>  Travailler avec Ansible </h3><br>  Conseils que je peux donner lorsque je travaille avec Ansible: <br><ol><li>  Utilisez 'acc√©l√©rer', il d√©ploie des configurations 2 √† 6 fois plus rapidement que SSH (pour el6).  Pour tout le monde, il y a du ¬´pipelining¬ª.  Il est d√©sactiv√© pour des raisons de compatibilit√© descendante, mais r√©activer le pipelining est tr√®s facile, je recommande de le faire. <br></li><li>  Utilisez 'with_items' <br><br><pre> <code class="hljs powershell">- name: project apt dependencies installed apt: name: <span class="hljs-string"><span class="hljs-string">"{{ item }}"</span></span> become: yes with_items: - build<span class="hljs-literal"><span class="hljs-literal">-essential</span></span> - acl - git - curl - gnupg2 - libpcre3<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-apt</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-pycurl</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-boto</span></span> - imagemagick - libmysqlclient<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> <span class="hljs-comment"><span class="hljs-comment"># needed for data import</span></span></code> </pre><br>  Dans cet exemple, nous installons des packages, ce sch√©ma peut √™tre utilis√© pour cr√©er des utilisateurs et des op√©rations similaires. <br></li><li>  Utilisez soigneusement ¬´local_action¬ª et ¬´delegated¬ª.  Le premier vous permet d'obtenir quelque chose de similaire au SaltStack Runner, le second est capable de d√©l√©guer des t√¢ches √† des machines sp√©cifiques. <br><br><pre> <code class="hljs sql">- name: <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> postgresql <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> postgresql_db: <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-string"><span class="hljs-string">"{{ database_name }}"</span></span> login_host: <span class="hljs-string"><span class="hljs-string">"{{ database_host }}"</span></span> login_user: <span class="hljs-string"><span class="hljs-string">"{{ database_master_user }}"</span></span> login_password: <span class="hljs-string"><span class="hljs-string">"{{ database_master_password }}"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">encoding</span></span>: <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> lc_collate: <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> lc_ctype: <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: <span class="hljs-string"><span class="hljs-string">"template0"</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span> delegate_to: <span class="hljs-string"><span class="hljs-string">"{{ groups.pg_servers|random}}"</span></span></code> </pre><br>  Il s'agit d'une cr√©ation de base de donn√©es.  Sans la derni√®re ligne, l'op√©ration serait effectu√©e plusieurs fois et tomberait √† la deuxi√®me tentative de cr√©ation de la m√™me base de donn√©es. <br></li><li>  Optimisez vos r√¥les et performances avec des balises.  Cela peut r√©duire consid√©rablement le d√©lai de livraison. <br></li></ol><br><h3>  Conclusions </h3><br>  Pour moi, Ansible est un favori.  SaltStack est tr√®s bon, tr√®s flexible, mais n√©cessite des connaissances en Python, sans eux SaltStack est pr√©f√©rable de ne pas l'utiliser.  Chef est une solution miracle universelle pour toutes les t√¢ches et toutes les √©chelles, mais n√©cessite plus de connaissances qu'Ansible.  Et qui utilise Puppet - je ne sais pas.  En principe, il est tr√®s similaire √† Chef, mais avec ses propres nuances. <br><blockquote>  Minute de publicit√©.  Si vous avez aim√© ce rapport de la conf√©rence <b>DevOops</b> - notez que le 14 octobre, le nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOops 2018</a> se tiendra √† Saint-P√©tersbourg, il y aura beaucoup de choses int√©ressantes dans son programme.  Le site a d√©j√† les premiers intervenants et rapports. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416763/">https://habr.com/ru/post/fr416763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416753/index.html">Plugin VPN Hola populaire compromis</a></li>
<li><a href="../fr416755/index.html">Extreme Likes - Comit√© d'enqu√™te contre</a></li>
<li><a href="../fr416757/index.html">Tests feuillet√©s</a></li>
<li><a href="../fr416759/index.html">Pourquoi l'intelligence artificielle ne r√©soudra pas tous les probl√®mes</a></li>
<li><a href="../fr416761/index.html">Langage cosmique, partie 1: la grammaire universelle est-elle universelle?</a></li>
<li><a href="../fr416765/index.html">Soci√©t√© Foliplast: un cycle complet de production num√©rique en Russie</a></li>
<li><a href="../fr416767/index.html">Un diable pour vous, ou un audit avec piratage</a></li>
<li><a href="../fr416775/index.html">Un autre papercraft</a></li>
<li><a href="../fr416777/index.html">Le principe de fonctionnement du r√©seau neuronal convolutif. √Ä peu pr√®s compliqu√©</a></li>
<li><a href="../fr416781/index.html">Qui sauvera la th√©orie de la relativit√©?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>