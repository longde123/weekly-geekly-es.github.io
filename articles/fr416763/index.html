<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙆🏿 👌🏿 👨🏽‍🏫 Puppet Salt Chef Ensemble: comparez Ansible, SaltStack, Chef et Puppet 🎹 💝 👩🏽‍🤝‍👩🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous parlerons de ce qu'est le SCM et raconterons quelques histoires à travers le prisme dont nous considérerons Ansible, SaltStack, Chef...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Puppet Salt Chef Ensemble: comparez Ansible, SaltStack, Chef et Puppet</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/416763/">  Aujourd'hui, nous parlerons de ce qu'est le SCM et raconterons quelques histoires à travers le prisme dont nous considérerons Ansible, SaltStack, Chef et Puppet, en choisissant la meilleure option pour une tâche spécifique. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3xA2SggKQKo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Le matériel est basé sur la transcription d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport d'Andrei Filatov</a> , ingénieur système en chef chez EPAM Systems, de notre conférence d'octobre DevOops 2017. <br><a name="habracut"></a><br><h2>  Qu'est-ce que le SCM et avec quoi mange-t-il? </h2><br><img src="https://habrastorage.org/webt/hc/qk/qz/hcqkqz63ox1qwcu5qrfc08hkg7o.jpeg"><br><br>  Qu'est-ce que le SCM?  Tout d'abord, c'est une chose qui permet à notre infrastructure de l'état A d'exécuter l'état B en exécutant du code. De nombreux développeurs qui ne sont pas des ingénieurs DevOps dans la pratique pensent que quelque chose se passe d'une manière «automatique». sur les infrastructures. <br><br>  La méthode "automatique" nous implémente SCM (System Configuration Management).  À quoi ça sert?  Principalement pour construire des infrastructures reproductibles et cohérentes.  SCM étend bien les processus CI / CD.  Puisqu'il s'agit de code, il peut être stocké dans n'importe quel système de contrôle de version: Git, Mercurial.  Il est assez simple à développer et à maintenir. <br><br>  La dernière est un cycle d'automatisation fermé: tout peut être fait automatiquement, de la création de l'infrastructure au déploiement et au déploiement du code. <br><br><h2>  Qu'est-ce que SCM: Ansible </h2><br><img src="https://habrastorage.org/webt/w8/kg/5z/w8kg5z-9n6uy-eva2x5ofgeiuig.jpeg"><br><br>  Considérez nos candidats.  Le premier est Ansible.  Il a une architecture sans agent, si nous parlons d'une version open source, il est écrit en Python, il a une DSL de type Yaml, il est facilement extensible grâce aux modules écrits en Python, il est très simple et léger.  Ansible a le seuil d'entrée le plus bas - vous pouvez enseigner à n'importe qui. <br><br>  Il y a de l'expérience lorsqu'une personne, ne connaissant pas Python, ne connaissant rien au SCM, est entrée dans Ansible en seulement deux jours et a déjà commencé à faire quelque chose. <br>  Ci-dessous, un exemple de ChatOps: un notifiant dans Slack.  Le code Ansible qui a vu Yaml n'a rien de nouveau. <br><br><pre><code class="hljs pgsql">- block: - <span class="hljs-type"><span class="hljs-type">name</span></span>: "SlackNotify : Deploy Start" local_action: module: slack token: "{{ slack_url }}" attachments: - title: "Deploy to {{ inventory_hostname }} has been Started" <span class="hljs-type"><span class="hljs-type">text</span></span>: "&lt;!here&gt; :point_up_2:" color: "#551a8b" - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: configure.yml tags: - configure - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: remote-<span class="hljs-keyword"><span class="hljs-keyword">fetch</span></span>.yml tags: - remote - <span class="hljs-keyword"><span class="hljs-keyword">include</span></span>: assets.yml</code> </pre> <br><hr><br><h2>  Qu'est-ce que SCM: Chef </h2><br><img src="https://habrastorage.org/webt/wi/kr/bd/wikrbdzapzntbjimi4ns5jw2bm0.jpeg"><br><br>  Chef est une architecture client-serveur, il y a un serveur Chef et un client Chef.  La configuration basée sur la recherche, écrite en Ruby, a Ruby DSL.  Par conséquent, dans vos livres de recettes et recettes, vous pouvez utiliser toute la puissance de Ruby, mais je ne vous conseille pas de le faire.  Chef possède une énorme communauté et le plus grand ensemble d'outils parmi tous les SCM.  Voici à quoi ressemble le code Chef, c'est le déploiement de Jetty. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># # Cookbook Name:: dg-app-edl # Recipe::fe # node.normal[:jetty][:home] = "/usr/share/jetty" node.normal[:jetty][:group] = "deploy" include_recipe "dg-auth::deploy" include_recipe "newrelic::repository" include_recipe "newrelic::server-monitor" include_recipe "dg-jetty::jetty9" include_recipe "newrelic::java-agent" directory "edl" do action :create owner group "deploy" mode "0775" path "/usr/share/where/edl" recursive true end</span></span></code> </pre><br><hr><br><h2>  Qu'est-ce que SCM: SaltStack </h2><br><img src="https://habrastorage.org/webt/um/dp/qa/umdpqavcnru1d40qd-bncyclmx8.jpeg"><br><br>  SaltStack possède à la fois une architecture sans agent qui fonctionne en mode push avec Salt-SSH et une architecture client-serveur lorsqu'il y a Salt-master et Salt-minion.  L'accent est mis sur l'automatisation en temps réel, l'exécution parallèle prête à l'emploi de tous les processus et écrite en Python.  Également un langage de type Yaml, le code est très similaire à Ansible. <br><br><pre> <code class="hljs mel">#ntp-packages: pkg.installed: - pkgs: - ntp - ntpdate #/etc/ntp.conf: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span>: - managed - <span class="hljs-keyword"><span class="hljs-keyword">source</span></span>: salt:<span class="hljs-comment"><span class="hljs-comment">//common/ntpd/ntp.conf - template: jinja - mode: 644 #/etc/sysconfig/ntpd: file: - managed - source: salt://common/ntpd/ntpd - template: jinja - mode: 644 #ntp-service: service.running: - name: ntpd</span></span></code> </pre><br><hr><br><h2>  Qu'est-ce que SCM: Puppet </h2><br><img src="https://habrastorage.org/webt/iz/-3/ac/iz-3acdxp8hdgg-lxxk_lp8oilq.jpeg"><br><br>  Le dernier de nos soumissionnaires est Puppet.  Il a également une architecture client-serveur, comme Chef, la configuration n'est pas basée sur la recherche, mais sur les "faits" qui viennent avec le Puppet-master, écrit en Ruby, a un DSL de type Ruby.  Mais les gars de Puppet ne sont pas autorisés à utiliser du code Ruby pur dans leurs manifestes.  C'est à la fois un plus et un moins.  Voici à quoi ressemble le code manifeste Puppet: <br><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> { '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::server</span></span></span><span class="hljs-class">' : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">root_password</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">password</span></span></span><span class="hljs-class">' } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ ['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test2</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test3</span></span></span><span class="hljs-class">']: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utf8</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">require</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Class</span></span></span><span class="hljs-class">['</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::server</span></span></span><span class="hljs-class">'], } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test4</span></span></span><span class="hljs-class">': </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">latin1</span></span></span><span class="hljs-class">', } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mysql::db</span></span></span><span class="hljs-class">{ '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">test5</span></span></span><span class="hljs-class">': </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ensure</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">present</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">charset</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binary</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">collate</span></span></span><span class="hljs-class"> =&gt; '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">binary</span></span></span><span class="hljs-class">', }</span></span></code> </pre><br><h2>  SCM en pratique </h2><br><h3>  SaltStack dans un environnement démilitarisé </h3><br>  Tout d'abord, je voudrais partager un projet qui a été écrit sur SaltStack.  C'est notre projet précédent et la douleur la plus fraîche, et la douleur la plus fraîche est toujours la plus douloureuse.  Notre client est engagé dans le stockage de données - c'est la production de serveurs de fer pour stocker des données sur GPFS, GlusterFS, mais des constructions personnalisées.  Il nous a confié les tâches suivantes: <br><br><ol><li>  Création d'un programme d'installation USB / DVD.  Vous devez créer un support à partir duquel tout est installé.  Cela se fait pour les clients clients qui vivent dans des zones fermées, où les serveurs n'ont généralement pas Internet.  Nous devons emballer dans un ISO, envoyer aux ingénieurs de terrain qui déploieront tout le nécessaire sur site. <br></li><li>  Déployez un cluster de produits.  Les clients ont plusieurs gros produits, il faut pouvoir les déployer en mode cluster. <br></li><li>  Gestion, configuration et maintenance du cluster à l'aide de l'utilitaire CLI.  Notre cadre devrait aider les ingénieurs de terrain à gérer le cluster. <br></li></ol><br>  Le client avait plusieurs exigences.  Tout d'abord, il possède une énorme expertise Python, en fait uniquement des développeurs C et Python.  Le client a immédiatement déclaré: «Nous voulons SaltStack», ne laissant aucun choix. <br><br>  À quoi sommes-nous confrontés?  Le client a plusieurs produits dans l'installation, tous doivent être avec Salt-Masters.  Mais nous sommes confrontés au problème de la mise à l'échelle de la configuration Multi-Master.  Par exemple, dans NODE Info (le statut d'un serveur spécifique), nous avons sélectionné des millisecondes avec une configuration à deux maîtres, des secondes avec trois maîtres et avec cinq, nous n'avons jamais attendu la fin de l'opération.  MultiMaster est une bonne fonctionnalité, mais il ne s'adapte pas bien. <br><br>  Le deuxième problème que nous avons rencontré était le travail d'équipe: SaltStack a Runner et Module.  Le module est une extension qui fonctionne sur Salt Minion, côté machine.  Runner s'exécute côté serveur.  Nous avons souvent eu des batailles: que faire Runner et que faire des modules. <br><br>  Ensuite, nous sommes tombés sur une petite surprise de cache.mine: <br><br><pre> <code class="python hljs">ime = ImeActions() id = __grains__[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> id == ime.master_id: ret = __salt__[<span class="hljs-string"><span class="hljs-string">'mine.get'</span></span>](id, <span class="hljs-string"><span class="hljs-string">'ime_actions.make_bfs_uuid'</span></span>) ime_dict = ret.get(id, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ime_dict: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: result = __salt__[<span class="hljs-string"><span class="hljs-string">'mine.send'</span></span>](<span class="hljs-string"><span class="hljs-string">'ime_actions.make_bfs_uuid'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exeption, e: log.error(<span class="hljs-string"><span class="hljs-string">"Failed to generate uuid: {0}."</span></span>.format(str(e))) result = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>:</code> </pre><br>  Nous avons un utilitaire qui est écrit en C. Nous l'exécutons, il génère un ID aléatoire.  Il doit être unique parmi tous les participants du cluster, respectivement, nous devons le faire une fois sur le maître, puis le répartir entre les machines.  Nous avons utilisé cache.mine pour cela.  En fait, il ne connaît pas de redémarrage. <br><br><img src="https://habrastorage.org/webt/g1/n6/bo/g1n6boipselezqysof41glvfa5s.jpeg"><br><br>  "Condition de course."  La parallélisation est bonne, mais dans la configuration de base, state.orchestrate entre dans state.sls s'exécute si de longs processus se produisent.  À l'expiration du délai, il estime que l'État est déjà terminé, bien qu'il soit toujours en cours d'exécution, et essaie de démarrer le suivant.  Une erreur se produit.  Et ce problème n'est pas encore résolu. <br><br><img src="https://habrastorage.org/webt/uq/s5/wb/uqs5wbeqhfc8o22yr9mwck3fcbg.jpeg"><br>  Vous pouvez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">regarder GitHub</a> . <br><br>  Que pourrions-nous utiliser en plus de SaltStack? <br><br><h3>  SaltStack dans un environnement DMZ </h3><br><img src="https://habrastorage.org/webt/ze/k6/me/zek6meak3aivzorfh7rsgf4e9na.jpeg"><br><br><ul><li>  DMZ  Le chef est super, Puppet aussi.  Et avec Ansible, le problème est - s'il n'y a pas de tour - il n'y a aucun moyen de démarrer la configuration en mode Pull à partir de nos nœuds, ce qui doit être fait dans la zone démilitarisée. <br></li><li>  Framework pour CLI (en Python).  Chef et Puppet ne conviennent pas très bien, mais si vous n'avez aucune restriction pour utiliser uniquement Python, vous pouvez écrire en Ruby et utiliser les API Chef ou Puppet.  La boîte à outils Ansible ne prend pas en charge cela. <br></li><li>  Gestion des clusters.  Chef est bien adapté à la gestion des clusters, Puppet aussi, et Ansible a été initialement écrit pour gérer les clusters sur Amazon. <br></li></ul><br><h3>  Chef dans un environnement vaste et dynamique </h3><br>  Le client a eu pour tâche de consolider toutes les ressources dans un seul cloud - c'était Openstack.  Avant cela, tout était dispersé: quelque chose sur le Rackspace Cloud, quelque chose sur des serveurs dédiés ou leurs centres de données privés. <br><br>  Ils souhaitaient une gestion des ressources entièrement dynamique, et aussi pour que leurs applications puissent s'ajouter de la capacité si nécessaire.  Autrement dit, nous avons besoin d'une infrastructure dynamique complète et d'un environnement entièrement dynamique de haut en bas. <br><br>  Pour construire correctement le processus du CD, vous avez besoin d'un environnement entièrement automatisé.  Nous avons créé SDLC - Software Development Lifecycle pour eux, et l'avons appliqué, y compris pour SCM.  Ils passent des tests d'intégration non seulement des applications, mais aussi des infrastructures. <br><br>  En conséquence, lorsque quelque chose ne va pas chez nous, nous, comme les gars de Netflix, devrions être capables de tuer les ressources défectueuses et de restaurer les travailleurs frais et garantis à leur place. <br><br>  Quels problèmes avons-nous rencontrés: <br><br><ol><li>  C'était en 2013, utilisé Chef 10, dans lequel une recherche lente.  Nous avons commencé la recherche, faisant le tour de toutes les voitures, et cela a pris une éternité.  Nous avons essayé de résoudre le problème avec la convention de dénomination, ainsi que la sélection et la recherche de fqdn.  Cela a réduit la portée de la recherche, raison pour laquelle elle a été accélérée. <br><br>  Mais certaines opérations doivent être effectuées sur l'ensemble de l'environnement.  En conséquence, la recherche a été exécutée une fois au tout début, le résultat a été stocké dans l'attribut et à l'aide de Ruby, nous avons filtré les résultats: nous avons analysé les éléments dont nous avions besoin et fait ce qui était nécessaire. <br><br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !Chef::Config[<span class="hljs-symbol"><span class="hljs-symbol">:solo</span></span>] search(<span class="hljs-symbol"><span class="hljs-symbol">:node</span></span>, <span class="hljs-string"><span class="hljs-string">"fqdn:*metro-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:env</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">-mongodb*"</span></span>).each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|mongo|</span></span> @mongodbs &lt;&lt; mongo.fqdn <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> @mongodbs = [<span class="hljs-string"><span class="hljs-string">"lvs-metro-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{node[</span></span><span class="hljs-symbol"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-symbol">:env</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">-mongodb3001.qa.example.com"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Conclusion: utilisez les conventions de dénomination, exécutez la recherche une fois, utilisez Ruby pour filtrer les résultats souhaités. <br></li><li>  L'utilisation de "node.save" n'est pas sûre, soyez prudent et prudent.  Nous avons rencontré ce problème lors du déploiement de clusters MySQL et utilisé node.save dans la recette sur un nœud MySQL incomplètement configuré.  Et au moment de la mise à l'échelle, certaines applications ont donné une erreur de 500.  Il s'est avéré que nous sauvegardions le nœud au mauvais moment: il va au serveur Chef, là, le client Chef sur l'interface utilisateur récupère un nouveau nœud qui n'a pas été configuré avant le mode de fonctionnement. <br></li><li>  Le manque de "splay" peut tuer le serveur du chef.  Splay est un paramètre client Chef qui vous permet de définir la plage lorsque le client se rend sur le serveur pour configuration.  Avec une charge élevée, lorsque vous devez déployer plusieurs nœuds en même temps, cela ne tuera pas le serveur. <br></li></ol><br>  Que pouvons-nous utiliser à la place du chef? <br><br><img src="https://habrastorage.org/webt/0w/xx/rm/0wxxrmdr90fpnyppzwoumgkbmai.jpeg"><br><br><ul><li>  Provisionnement dynamique  SaltStack est parfait car il a SaltCloud qui s'intègre parfaitement n'importe où.  Puppet a des fonctionnalités similaires, mais il n'est disponible que dans Puppet Enterprise, pour de l'argent.  Ansible est bien adapté si l'entreprise "vit" en Amazonie, sinon autre chose - vous pouvez l'associer à des alternatives, mais ce n'est pas si pratique. <br></li><li>  SDLC.  Chef a tout, de la cuisine de test au choix des outils pour les tests d'intégration.  SaltStack a tous les outils Python disponibles, maintenant Puppet a tout.  Ansible a une spécification de rôle, vous pouvez utiliser la cuisine de test du chef, mais ce n'est pas un outil natif. <br></li><li>  Remplacement des ressources.  Tout va bien dans Chef, dans SaltStack vous pouvez terminer SaltCloud à l'état souhaité, dans Puppet, les outils ne sont que dans la version Enterprise, et Ansible ne fonctionne bien qu'avec Amazon. <br></li></ul><br><h3>  EPAM Private Cloud avec Chef </h3><br>  Un an et demi avant l'avènement d'AWS OpsWorks, nous voulions créer une Amazon CloudFormation avancée en intégrant Chef afin que les ressources soient non seulement déployées, mais également configurées. <br><br>  La deuxième tâche globale consiste à créer un catalogue de services afin que les clients et les utilisateurs puissent utiliser la CLI pour déployer une pile LAMP complètement prête à l'emploi, par exemple. <br><br><img src="https://habrastorage.org/webt/a4/cy/f6/a4cyf6ep8anoudzr6ydh7as2yrg.jpeg"><br><br>  Nous avons choisi Chef, mais le projet devait prendre en charge différents SCM.  Nous avons commencé avec le Chef-Server intégré, et les utilisateurs pouvaient également utiliser leur propre Chef-Server, qui est hébergé quelque part avec eux.  Autrement dit, nous n'avons pas eu accès aux ressources utilisateur et aux ordinateurs portables, mais cela a quand même fonctionné. <br><br><img src="https://habrastorage.org/webt/xf/vh/py/xfvhpysd5j89seh3qgrei3o5ryi.jpeg"><br><br>  Tout SCM peut être utilisé pour implémenter CloudFormation + OpsWork, tout le monde convient.  Pour créer un catalogue - tout le monde sauf SaltStack le fera bien.  SaltStack a ses nuances: il est extrêmement difficile de trouver un spécialiste connaissant bien SaltStack et pouvant créer un service et remplir le catalogue. <br><br><h3>  La popularité de SCM dans EPAM </h3><br><img src="https://habrastorage.org/webt/d3/o1/z2/d3o1z2giceihh4izcy4r6zlnkpq.jpeg"><br><br>  Ce sont des statistiques de popularité de SCM au sein d'EPAM.  SaltStack est très loin derrière.  En premier lieu Ansible, c'est la plus simple et avec un seuil d'entrée bas.  Lorsque nous essayons de trouver quelqu'un sur le marché connaissant la SCM, le marché est à peu près le même. <br><br><h3>  Travailler avec Ansible </h3><br>  Conseils que je peux donner lorsque je travaille avec Ansible: <br><ol><li>  Utilisez 'accélérer', il déploie des configurations 2 à 6 fois plus rapidement que SSH (pour el6).  Pour tout le monde, il y a du «pipelining».  Il est désactivé pour des raisons de compatibilité descendante, mais réactiver le pipelining est très facile, je recommande de le faire. <br></li><li>  Utilisez 'with_items' <br><br><pre> <code class="hljs powershell">- name: project apt dependencies installed apt: name: <span class="hljs-string"><span class="hljs-string">"{{ item }}"</span></span> become: yes with_items: - build<span class="hljs-literal"><span class="hljs-literal">-essential</span></span> - acl - git - curl - gnupg2 - libpcre3<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-apt</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-pycurl</span></span> - python<span class="hljs-literal"><span class="hljs-literal">-boto</span></span> - imagemagick - libmysqlclient<span class="hljs-literal"><span class="hljs-literal">-dev</span></span> <span class="hljs-comment"><span class="hljs-comment"># needed for data import</span></span></code> </pre><br>  Dans cet exemple, nous installons des packages, ce schéma peut être utilisé pour créer des utilisateurs et des opérations similaires. <br></li><li>  Utilisez soigneusement «local_action» et «delegated».  Le premier vous permet d'obtenir quelque chose de similaire au SaltStack Runner, le second est capable de déléguer des tâches à des machines spécifiques. <br><br><pre> <code class="hljs sql">- name: <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> postgresql <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> postgresql_db: <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-string"><span class="hljs-string">"{{ database_name }}"</span></span> login_host: <span class="hljs-string"><span class="hljs-string">"{{ database_host }}"</span></span> login_user: <span class="hljs-string"><span class="hljs-string">"{{ database_master_user }}"</span></span> login_password: <span class="hljs-string"><span class="hljs-string">"{{ database_master_password }}"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">encoding</span></span>: <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span> lc_collate: <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> lc_ctype: <span class="hljs-string"><span class="hljs-string">"en_US.UTF-8"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>: <span class="hljs-string"><span class="hljs-string">"template0"</span></span> state: <span class="hljs-keyword"><span class="hljs-keyword">present</span></span> delegate_to: <span class="hljs-string"><span class="hljs-string">"{{ groups.pg_servers|random}}"</span></span></code> </pre><br>  Il s'agit d'une création de base de données.  Sans la dernière ligne, l'opération serait effectuée plusieurs fois et tomberait à la deuxième tentative de création de la même base de données. <br></li><li>  Optimisez vos rôles et performances avec des balises.  Cela peut réduire considérablement le délai de livraison. <br></li></ol><br><h3>  Conclusions </h3><br>  Pour moi, Ansible est un favori.  SaltStack est très bon, très flexible, mais nécessite des connaissances en Python, sans eux SaltStack est préférable de ne pas l'utiliser.  Chef est une solution miracle universelle pour toutes les tâches et toutes les échelles, mais nécessite plus de connaissances qu'Ansible.  Et qui utilise Puppet - je ne sais pas.  En principe, il est très similaire à Chef, mais avec ses propres nuances. <br><blockquote>  Minute de publicité.  Si vous avez aimé ce rapport de la conférence <b>DevOops</b> - notez que le 14 octobre, le nouveau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DevOops 2018</a> se tiendra à Saint-Pétersbourg, il y aura beaucoup de choses intéressantes dans son programme.  Le site a déjà les premiers intervenants et rapports. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416763/">https://habr.com/ru/post/fr416763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416753/index.html">Plugin VPN Hola populaire compromis</a></li>
<li><a href="../fr416755/index.html">Extreme Likes - Comité d'enquête contre</a></li>
<li><a href="../fr416757/index.html">Tests feuilletés</a></li>
<li><a href="../fr416759/index.html">Pourquoi l'intelligence artificielle ne résoudra pas tous les problèmes</a></li>
<li><a href="../fr416761/index.html">Langage cosmique, partie 1: la grammaire universelle est-elle universelle?</a></li>
<li><a href="../fr416765/index.html">Société Foliplast: un cycle complet de production numérique en Russie</a></li>
<li><a href="../fr416767/index.html">Un diable pour vous, ou un audit avec piratage</a></li>
<li><a href="../fr416775/index.html">Un autre papercraft</a></li>
<li><a href="../fr416777/index.html">Le principe de fonctionnement du réseau neuronal convolutif. À peu près compliqué</a></li>
<li><a href="../fr416781/index.html">Qui sauvera la théorie de la relativité?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>