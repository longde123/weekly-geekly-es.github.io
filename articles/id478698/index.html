<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⚡️ ♣️ 🆑 Kami membuat rencana medan interaktif dalam 15 menit 😋 ➰ 🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Di Toaster, mereka sering bertanya tentang cara membuat diagram interaktif rumah, rencana struktur internal, kemampuan untuk memilih lantai atau apart...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami membuat rencana medan interaktif dalam 15 menit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478698/"><p><img src="https://habrastorage.org/webt/n0/jb/-9/n0jb-9sfsmw2ewd-etwnl04ayvc.jpeg"></p><br><p> Di Toaster, mereka sering bertanya tentang cara membuat diagram interaktif rumah, rencana struktur internal, kemampuan untuk memilih lantai atau apartemen dengan informasi tentang mereka, menampilkan informasi tentang detail produk tertentu ketika Anda mengarahkan mouse ke foto, dll.  Ini bukan tentang model tiga dimensi, tetapi tentang gambar dengan kemampuan untuk menyoroti detail tertentu.  Semua tugas ini mirip dan diselesaikan dengan cukup sederhana, namun pertanyaan tetap muncul, jadi hari ini kita akan melihat bagaimana hal-hal seperti itu dilakukan dengan menggunakan SVG, editor grafis dan sejumput javascript. </p><a name="habracut"></a><br><p>  Pilihan SVG disebabkan oleh fakta bahwa ini adalah opsi paling sederhana untuk pengembangan dan debugging.  Saya bertemu orang-orang yang menyarankan semua ini dilakukan di atas kanvas, tetapi jauh lebih sulit untuk memahami apa yang terjadi, dan koordinat semua titik pada kurva perlu dihitung terlebih dahulu, tetapi di sini saya membuka alat pengembang dan segera melihat seluruh struktur, semua benda, dengan yang ada interaksi, dan segala sesuatu yang lain dapat diklik dengan mouse di antarmuka yang ramah manusia.  Kinerja antara kanvas 2d biasa dan SVG tidak akan berbeda.  WebGL dapat memberikan beberapa bonus dalam hal ini, tetapi jadwal pengembangan akan meningkat secara signifikan, belum lagi dukungan lebih lanjut, yang tidak selalu sesuai dengan anggaran.  Saya bahkan akan mengatakan "tidak pernah cocok." </p><br><p>  Dalam tutorial ini, kami akan melakukan sesuatu seperti widget untuk situs fiktif untuk menyewa rumah pribadi di beberapa area, tetapi jelas bahwa prinsip-prinsip untuk membuat hal-hal seperti itu berlaku untuk subjek apa pun. </p><br><h2 id="nachinaem-nachinat">  Memulai </h2><br><p>  Saya akan menunjukkan semuanya dengan <a href="https://inkscape.org/">Inkscape</a> sebagai contoh, tetapi semua tindakan yang sama dapat dilakukan di editor lain menggunakan fungsi serupa. </p><br><p>  Agar berfungsi, kita membutuhkan dua kotak dialog utama: </p><br><ul><li>  Editor XML (Ctrl + Shift + X atau ikon dengan kurung sudut) - untuk melihat struktur dokumen dalam bentuk markup dan mengedit elemen individual. </li><li>  Isi dan Stroke (Ctrl + Shift + F atau ikon dengan kuas di bingkai) - terutama untuk mengisi garis besar. </li></ul><br><p>  Segera luncurkan dan lanjutkan ke pembuatan dokumen. </p><br><blockquote>  Jika Anda secara tidak sengaja menyeretnya ke jendela terpisah, maka Anda dapat mengklik di bawah bingkai atas jendela ini (di mana tidak ada), dan seret kembali ke jendela utama.  Ini tidak sepenuhnya intuitif, tetapi lebih nyaman. </blockquote><p>  Buka foto dengan tampilan area.  Kita dapat memilih untuk memasukkan gambar itu sendiri sebagai string base64 atau tautan eksternal.  Karena besar, pilih tautannya.  Kemudian kita akan mengubah jalur ke gambar dengan tangan kita ketika memperkenalkan semuanya ke halaman situs.  Dokumen SVG dibuat di mana foto akan disematkan melalui tag gambar. </p><br><blockquote>  Untuk gambar raster yang disematkan dalam SVG, tertanam dalam HTML, Anda dapat menggunakan lazy loading, serta untuk gambar biasa di halaman.  Dalam contoh ini, kita tidak akan berkutat pada optimisasi semacam itu, tetapi jangan lupakan mereka dalam pekerjaan praktis. </blockquote><p>  Pada tahap saat ini, kita melihat sesuatu di depan kita seperti ini: </p><br><p><img src="https://habrastorage.org/webt/nf/1v/ak/nf1vak7y46k_uto-ov-85ifimrc.jpeg"></p><br><p>  Sekarang buat layer baru (Ctrl + Shift + N atau Menu&gt; Layer&gt; Add layer).  Di editor XML, kita melihat bahwa elemen g biasa telah muncul.  Meskipun kami belum melangkah jauh, kami dapat memberikan kelas, yang akan kami gunakan nanti dalam skrip. </p><br><blockquote>  Jangan mengandalkan id.  Semakin kompleks antarmuka, semakin mudah membuat mereka mengulangi dan mendapatkan bug aneh.  Dan dalam tugas kami, mereka masih tidak mendapat manfaat.  Jadi atribut kelas atau data adalah pilihan kami. </blockquote><p>  Jika Anda melihat lebih dekat pada struktur dokumen di editor XML, Anda akan melihat bahwa ada banyak yang berlebihan.  Editor grafis vektor yang kurang lebih kompleks akan menambahkan sesuatu sendiri ke dokumen.  Untuk menghapus semua ini dengan tangan Anda adalah tugas yang panjang dan tanpa rasa terima kasih, editor akan terus menambahkan sesuatu lagi.  Jadi membersihkan SVG dari sampah hanya dilakukan di akhir pekerjaan.  Dan lebih disukai dalam bentuk otomatis, karena ada opsi siap pakai, <a href="https://github.com/svg/svgo">svgo yang</a> sama misalnya. </p><br><p>  Temukan alat yang disebut Draw Bezier curves dan Straight Lines (Shift + F6).  Dengan itu, kita akan menggambar kontur tertutup di sekitar objek.  Dalam tugas kita, kita perlu menjabarkan semua bangunan.  Sebagai contoh, kita membatasi diri kita menjadi enam, tetapi dalam kondisi nyata itu akan bermanfaat untuk pra-mengalokasikan waktu untuk secara akurat menguraikan semua objek yang diperlukan.  Meskipun sering terjadi bahwa ada banyak entitas yang serupa, lantai yang sama pada sebuah bangunan dapat benar-benar identik.  Dalam kasus seperti itu, Anda dapat mempercepat sedikit dan menyalin-lekatkan kurva. </p><br><p>  Setelah kami mengelilingi bangunan yang diperlukan, kami kembali ke editor XML, menambahkan kelas atau, kemungkinan besar, akan lebih nyaman, atribut data dengan indeks untuk mereka (mungkin dengan alamat, tetapi karena kami memiliki area fiktif, hanya ada indeks), dan pindahkan semuanya ke lapisan yang sebelumnya dibuat sehingga semuanya "diletakkan di rak".  Dan gambar itu, omong-omong, juga akan berguna untuk pindah ke sana, sehingga semuanya ada di satu tempat, tetapi ini adalah hal-hal sepele. </p><br><p>  Sekarang, setelah memilih satu jalur - kurva di sekitar gedung, Anda dapat memilih semuanya dengan Ctrl + A atau Menu&gt; Edit&gt; Pilih Semua dan edit pada saat yang sama.  Anda harus mengecat semuanya di jendela Fill and Stroke, dan pada saat yang sama hapus stroke tambahan di sana.  Baik, atau tambahkan jika Anda membutuhkannya untuk alasan desain. </p><br><p><img src="https://habrastorage.org/webt/du/qi/7d/duqi7d2_rtovsgoo9osa-vo25-w.jpeg"></p><br><blockquote>  Masuk akal untuk melukis semua kontur dengan beberapa warna dengan nilai opacity minimum untuk mereka, bahkan jika ini tidak diperlukan dalam hal desain.  Faktanya adalah peramban pintar percaya bahwa Anda tidak dapat mengeklik pada jalur kosong, tetapi pada jalur yang dibanjiri - Anda dapat, bahkan jika tidak ada yang melihat isi ini. </blockquote><p>  Dalam contoh kami, kami akan meninggalkan sedikit sorotan dalam warna putih untuk melihat dengan lebih baik bangunan tempat kami bekerja, menyimpan semuanya dan dengan lancar pindah ke browser dan editor kode yang lebih akrab. </p><br><h2 id="bazovyy-primer">  Contoh dasar </h2><br><p>  Mari kita buat halaman html kosong, tempel langsung SVG yang dihasilkan ke dalamnya dan tambahkan beberapa CSS sehingga tidak ada yang keluar dari layar.  Tidak ada yang perlu dikomentari. </p><br><pre><code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.map</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">90%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">max-width</span></span>: <span class="hljs-number"><span class="hljs-number">1300px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">2rem</span></span> auto; <span class="hljs-attribute"><span class="hljs-attribute">border</span></span>: <span class="hljs-number"><span class="hljs-number">1rem</span></span> solid <span class="hljs-number"><span class="hljs-number">#fff</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">1rem</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">box-shadow</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-number"><span class="hljs-number">5rem</span></span> <span class="hljs-built_in"><span class="hljs-built_in">rgba</span></span>(0, 0, 0, .3); } <span class="hljs-selector-class"><span class="hljs-selector-class">.map</span></span> &gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">svg</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: auto; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: .<span class="hljs-number"><span class="hljs-number">5rem</span></span>; }</code> </pre> <br><p>  Kami ingat bahwa kami menambahkan kelas ke bangunan dan menggunakannya agar CSS kurang lebih terstruktur. </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">transition</span></span>: opacity .<span class="hljs-number"><span class="hljs-number">3s</span></span> ease-in-out; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; <span class="hljs-attribute"><span class="hljs-attribute">opacity</span></span>: .<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.-available</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">fill</span></span>: <span class="hljs-number"><span class="hljs-number">#0f0</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.-reserved</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">fill</span></span>: <span class="hljs-number"><span class="hljs-number">#f00</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.building</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.-service</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">fill</span></span>: <span class="hljs-number"><span class="hljs-number">#fff</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre> <br><p>  Karena kita mendefinisikan gaya sebaris di Inkscape, kita perlu menyela mereka dalam CSS.  Apakah akan lebih mudah untuk melakukan semuanya dalam CSS?  Ya dan tidak  Itu tergantung situasi.  Terkadang tidak ada pilihan.  Sebagai contoh, jika seorang desainer menggambar banyak semuanya berwarna-warni dan membungkus semuanya dalam CSS dan mengembangnya menjadi tidak mungkin entah bagaimana tidak kome il faut.  Dalam contoh ini, saya menggunakan opsi "tidak nyaman" untuk menunjukkan bahwa itu tidak terlalu menakutkan dalam konteks masalah yang sedang dipecahkan. </p><br><p><img src="https://habrastorage.org/webt/t0/r4/nr/t0r4nr0bqr-zyblc_srzafnogis.jpeg"></p><br><p>  Misalkan kami menerima data baru tentang rumah, dan menambahkan kelas yang berbeda kepada mereka, tergantung pada status mereka saat ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = { <span class="hljs-attr"><span class="hljs-attr">id_0</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'service'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_2</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_3</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_4</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_5</span></span>: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">messages</span></span>: { <span class="hljs-string"><span class="hljs-string">'available'</span></span>: <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'reserved'</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'service'</span></span>: <span class="hljs-string"><span class="hljs-string">'  1-2 '</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> map = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'my-map'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildings = map.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.building'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (building <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> buildings) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = building.getAttribute(<span class="hljs-string"><span class="hljs-string">'data-building-id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> status = data[<span class="hljs-string"><span class="hljs-string">`id_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>].status; building.classList.add(<span class="hljs-string"><span class="hljs-string">`-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${status}</span></span></span><span class="hljs-string">`</span></span>); }</code> </pre> <br><p>  Kami mendapatkan sesuatu seperti ini: </p><br><p><img src="https://habrastorage.org/webt/zm/n6/tx/zmn6txixk7isjsgy9hdkukjjyc0.jpeg"></p><br><p>  Sesuatu yang mirip dengan yang kita butuhkan sudah terlihat.  Pada tahap ini, kami telah menyorot objek di medan yang merespons ke kursor mouse.  Dan tidak sulit untuk menambahkan respons mereka terhadap klik mouse melalui addEventListener standar. </p><br><h2 id="leader-line">  Garis pemimpin </h2><br><p>  Seringkali ada tugas membuat garis yang akan menghubungkan objek pada peta dan beberapa elemen pada halaman dengan informasi tambahan, serta membuat tooltip minimal ketika melayang di atas objek yang sama.  Untuk mengatasi masalah ini, mini-library <a href="https://github.com/anseki/leader-line">leader-line</a> sangat cocok, yang menciptakan panah vektor untuk setiap selera dan warna. </p><br><p>  Mari kita tambahkan harga untuk tooltips ke data dan menggambar garis-garis ini. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = { <span class="hljs-attr"><span class="hljs-attr">id_0</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'3000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'service'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_1</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'3000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_2</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'2000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_3</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'5000'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_4</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'2500'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'available'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">id_5</span></span>: { <span class="hljs-attr"><span class="hljs-attr">price</span></span>: <span class="hljs-string"><span class="hljs-string">'2500'</span></span>, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: <span class="hljs-string"><span class="hljs-string">'reserved'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">messages</span></span>: { <span class="hljs-string"><span class="hljs-string">'available'</span></span>: <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'reserved'</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'service'</span></span>: <span class="hljs-string"><span class="hljs-string">'   (1-2 )'</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> map = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'my-map'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildings = map.querySelectorAll(<span class="hljs-string"><span class="hljs-string">'.building'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> info = map.querySelector(<span class="hljs-string"><span class="hljs-string">'.info'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> lines = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (building <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> buildings) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = building.getAttribute(<span class="hljs-string"><span class="hljs-string">'data-building-id'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> status = data[<span class="hljs-string"><span class="hljs-string">`id_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>].status; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> price = data[<span class="hljs-string"><span class="hljs-string">`id_</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">`</span></span>].price; building.classList.add(<span class="hljs-string"><span class="hljs-string">`-</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${status}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> line = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LeaderLine( LeaderLine.pointAnchor(building, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span> }), LeaderLine.pointAnchor(info, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }), { <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#fff'</span></span>, <span class="hljs-attr"><span class="hljs-attr">startPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'arrow1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'behind'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endSocket</span></span>: <span class="hljs-string"><span class="hljs-string">'top'</span></span> } ); lines.push(line); }</code> </pre> <br><p>  Seperti yang Anda lihat, tidak ada yang rumit terjadi.  Garis memiliki "titik lampiran" ke elemen.  Koordinat titik-titik ini relatif terhadap unsur-unsur biasanya nyaman untuk ditentukan dalam persen.  Secara umum, ada banyak pilihan berbeda, tidak masuk akal untuk mendaftar dan mengingat, jadi saya sarankan hanya melihat melalui dokumentasi.  Salah satu opsi ini - startLabel - akan diperlukan bagi kita untuk membuat tooltip kecil dengan harga. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> line = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LeaderLine( LeaderLine.pointAnchor(building, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span> }), LeaderLine.pointAnchor(info, { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-string"><span class="hljs-string">'50%'</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }), { <span class="hljs-attr"><span class="hljs-attr">startLabel</span></span>: LeaderLine.captionLabel(<span class="hljs-string"><span class="hljs-string">`</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${price}</span></span></span><span class="hljs-string">/`</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fontFamily</span></span>: <span class="hljs-string"><span class="hljs-string">'Rubik Mono One'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fontWeight</span></span>: <span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-attr"><span class="hljs-attr">offset</span></span>: [<span class="hljs-number"><span class="hljs-number">-30</span></span>, <span class="hljs-number"><span class="hljs-number">-50</span></span>], <span class="hljs-attr"><span class="hljs-attr">outlineColor</span></span>: <span class="hljs-string"><span class="hljs-string">'#555'</span></span> }), <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#fff'</span></span>, <span class="hljs-attr"><span class="hljs-attr">startPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'arrow1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endPlug</span></span>: <span class="hljs-string"><span class="hljs-string">'behind'</span></span>, <span class="hljs-attr"><span class="hljs-attr">endSocket</span></span>: <span class="hljs-string"><span class="hljs-string">'top'</span></span>, <span class="hljs-attr"><span class="hljs-attr">hide</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } );</code> </pre> <br><blockquote>  Tidak ada yang mengganggu untuk menggambar semua tips dalam editor grafis.  Jika mereka seharusnya memiliki konten yang konsisten, maka itu bahkan bisa nyaman.  Terutama jika ada keinginan untuk meminta mereka posisi yang berbeda untuk objek yang berbeda. </blockquote><p>  Kami juga dapat menambahkan opsi sembunyikan sehingga semua baris tidak ditampilkan sebagai sapu.  Kami akan menunjukkan satu per satu saat Anda mengarahkan kursor ke bangunan yang sesuai: </p><br><pre> <code class="javascript hljs">building.addEventListener(<span class="hljs-string"><span class="hljs-string">'mouseover'</span></span>, () =&gt; { line.show(); }); building.addEventListener(<span class="hljs-string"><span class="hljs-string">'mouseout'</span></span>, () =&gt; { line.hide(); });</code> </pre> <br><p>  Di sini Anda dapat menampilkan informasi tambahan (dalam kasus kami, cukup status objek saat ini) di tempat untuk informasi.  Ini akan menghasilkan hampir apa yang dibutuhkan: </p><br><p><img src="https://habrastorage.org/webt/dj/6q/-3/dj6q-39gunb8vxq35elxb0bwse0.jpeg"></p><br><p>  Hal-hal semacam itu jarang dirancang untuk perangkat seluler, tetapi perlu diingat bahwa mereka sering dibuat layar penuh pada desktop, dan bahkan dengan beberapa panel di samping untuk informasi tambahan dan Anda perlu meregangkan semuanya dengan indah.  Sesuatu seperti ini misalnya: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">svg</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; }</code> </pre> <br><p>  Dalam hal ini, proporsi elemen SVG pasti tidak akan bertepatan dengan proporsi gambar di dalamnya.  Apa yang harus dilakukan </p><br><h2 id="nesovpadayuschie-proporcii">  Proporsi yang tidak cocok </h2><br><p>  Hal pertama yang terlintas dalam pikiran adalah <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit">objek-fit:</a> properti <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit">penutup</a> dari CSS.  Tetapi ada satu hal: itu sama sekali tidak dapat bekerja dengan SVG.  Dan bahkan jika itu berhasil, maka rumah-rumah di sepanjang tepi rencana bisa keluar dari tepi skema dan menjadi benar-benar tidak dapat diakses.  Jadi di sini Anda perlu pergi cara yang sedikit lebih rumit. </p><br><p>  Langkah pertama.  SVG memiliki atribut <a href="https://developer.mozilla.org/en-US/docs/Web/SVG/Attribute/preserveAspectRatio">preserveAspectRatio</a> , yang agak mirip dengan properti objek-fit (tidak cukup, tentu saja, tetapi ...).  Dengan <code>preserveAspectRatio="xMinYMin slice"</code> untuk elemen SVG utama dari rencana kami, kami mendapatkan rangkaian tambahan tanpa celah di tepinya dan tanpa distorsi. </p><br><p>  Langkah Dua  Anda harus melakukan drag dengan mouse.  Secara teknis, kami masih memiliki kesempatan seperti itu.  Di sini tugasnya lebih rumit, terutama untuk pemula.  Secara teori, kami memiliki acara standar untuk mouse dan layar sentuh yang dapat diproses dan mendapatkan nilai berapa peta yang perlu dipindahkan.  Namun dalam praktiknya, Anda bisa terjebak dalam hal ini untuk waktu yang sangat lama.  <a href="https://hammerjs.github.io/">Hammer.js</a> akan datang untuk <a href="https://hammerjs.github.io/">menyelamatkan</a> - perpustakaan kecil lain yang mengambil seluruh dapur internal untuk dirinya sendiri dan menyediakan antarmuka sederhana untuk bekerja dengan drag dan drop, geser, dll. </p><br><p>  Kita perlu memindahkan layer dengan bangunan dan gambar ke segala arah.  Buat itu mudah: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> buildingsLayer = map.querySelector(<span class="hljs-string"><span class="hljs-string">'.buildings_layer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hammertime = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Hammer(buildingsLayer); hammertime.get(<span class="hljs-string"><span class="hljs-string">'pan'</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">direction</span></span>: Hammer.DIRECTION_ALL });</code> </pre> <br><p>  Secara default, hammer.js juga mencakup pengenalan svaypa, tetapi kami tidak membutuhkannya di peta, jadi matikan segera sehingga tidak membodohi kepala kami: </p><br><pre> <code class="javascript hljs">hammertime.get(<span class="hljs-string"><span class="hljs-string">'swipe'</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">enable</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> });</code> </pre> <br><p>  Sekarang Anda perlu memahami apa yang sebenarnya Anda poskan untuk memindahkan peta hanya ke tepinya, tetapi tidak lebih jauh.  Dengan representasi sederhana dari dua persegi panjang di kepala kita, kita memahami bahwa untuk ini kita perlu mengetahui lekukan lapisan dengan bangunan dari elemen induk (SVG dalam kasus kita) dari keempat sisi.  GetBoundingClientRect datang untuk menyelamatkan: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> layer = buildingsLayer.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parent = svg.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offsets = { <span class="hljs-attr"><span class="hljs-attr">top</span></span>: layer.top - parent.top, <span class="hljs-attr"><span class="hljs-attr">bottom</span></span>: layer.bottom - parent.bottom, <span class="hljs-attr"><span class="hljs-attr">right</span></span>: layer.right - parent.right, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: layer.left - parent.left, };</code> </pre> <br><p>  Dan mengapa kita masih tidak memiliki cara yang lebih beradab (dan stabil) untuk melakukan ini?  Menarik getBoundingClientRect setiap kali sangat buruk dalam hal kinerja, tetapi pilihannya tidak terlalu kaya, dan hampir tidak mungkin untuk melihat penghambatan, jadi kami tidak akan datang dengan optimasi prematur di mana semuanya bekerja dengan baik.  Dengan satu atau lain cara, ini memungkinkan kita untuk memeriksa posisi layer dengan bangunan dan memindahkan semuanya hanya jika masuk akal: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> translateX = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> translateY = <span class="hljs-number"><span class="hljs-number">0</span></span>; hammertime.on(<span class="hljs-string"><span class="hljs-string">'pan'</span></span>, (e) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> layer = buildingsLayer.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> parent = svg.getBoundingClientRect(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> offsets = { <span class="hljs-attr"><span class="hljs-attr">top</span></span>: layer.top - parent.top, <span class="hljs-attr"><span class="hljs-attr">bottom</span></span>: layer.bottom - parent.bottom, <span class="hljs-attr"><span class="hljs-attr">right</span></span>: layer.right - parent.right, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: layer.left - parent.left, }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speedX = e.velocityX * <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> speedY = e.velocityY * <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speedX &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; offsets.left &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  } else if (speedX &lt; 0 &amp;&amp; offsets.right &gt; 0) { //  } if (speedY &gt; 0 &amp;&amp; offsets.top &lt; 0) { //  } else if (speedY &lt; 0 &amp;&amp; offsets.bottom &gt; 0) { //   } buildingsLayer.setAttribute('transform', `translate(${translateX} ${translateY})`); });</span></span></code> </pre> <br><p>  Pada bagian tepinya, biasanya perlu diperlambat agar tidak ada penghentian atau sentakan mendadak.  Dengan demikian, semuanya bolak-balik menjadi seperti ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (speedX &lt; -offsets.left) { translateX += speedX; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { translateX += -offsets.left * speedX / <span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre> <br><p>  Ada banyak opsi untuk pelambatan.  Yang ini paling mudah.  Dan ya, itu tidak terlalu indah, tetapi bodoh seperti gabus dan jelas.  Koefisien dalam contoh tersebut biasanya dipilih berdasarkan mata, tergantung pada perilaku kartu yang diinginkan. </p><br><p>  Jika Anda membuka browser dan bermain dengan ukuran jendela di alat pengembang, Anda dapat menemukan bahwa ada yang tidak beres ... </p><br><h2 id="nechistye-sily">  Kekuatan yang tidak murni </h2><br><p>  Pada perangkat desktop, semuanya berfungsi, tetapi pada ponsel, keajaiban terjadi, yaitu, alih-alih memindahkan peta, elemen tubuh bergerak.  Oooooooo!  Hanya para pemain di sana tidak cukup.  Meskipun baik-baik saja, ini terjadi karena ada sesuatu yang meluap di suatu tempat dan beberapa menimpa tidak disetel meluap: disembunyikan.  Tetapi dalam kasus kami, mungkin saja terjadi bahwa tidak ada yang bergerak sama sekali. </p><br><blockquote>  Teka-teki untuk huruf hijau: ada elemen g, di dalam elemen svg, di dalam elemen div, di dalam elemen tubuh, di dalam elemen html.  Doctype secara alami html.  Jika Anda menambahkan transform: translate (...) ke dalamnya untuk menyeret elemen g, maka pada laptop itu akan bergerak, seperti yang dimaksudkan, tetapi pada telepon itu bahkan tidak akan bergerak.  Tidak ada kesalahan di konsol.  Tapi pasti ada bug.  Browser adalah Chrome terakhir di sana dan di sana.  Pertanyaannya adalah mengapa? </blockquote><p>  <em>Saya sarankan Anda berpikir sekitar 10 menit tanpa Google sebelum menonton jawabannya.</em> </p><br><p><img src="https://habrastorage.org/webt/th/ec/yg/thecygjfpw8dtmjtlwtc1ds5x8m.png"></p><br><div class="spoiler">  <b class="spoiler_title">Jawabannya</b> <div class="spoiler_text"><p>  Haha  Aku menipu kamu.  Lebih tepatnya, tidak begitu.  Saya menggambarkan apa yang akan kami amati dengan pengujian manual.  Namun dalam kenyataannya, semuanya berjalan sebagaimana mestinya.  Ini bukan bug, tetapi fitur yang terkait dengan properti CSS dari <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/touch-action">tindakan sentuh</a> .  Dalam konteks tugas kita (tiba-tiba!) Terungkap bahwa itu ada, dan, apalagi, memiliki nilai tertentu yang mematahkan seluruh logika interaksi dengan peta.  Jadi kami memperlakukannya dengan sangat kasar: </p><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">svg</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">touch-action</span></span>: none <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; }</code> </pre> </div></div><br><p>  Tetapi kembalilah ke domba-domba kita dan lihat hasilnya (lebih baik, tentu saja, membuka di tab terpisah): </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://codepen.io/sfi0zy/embed/preview/ZEYYjZL" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Saya memutuskan untuk tidak mengkustomisasi kode untuk kerangka kerja yang modis, sehingga tetap dalam bentuk kosong tanpa bentuk netral, dari mana Anda dapat membangun saat membuat komponen Anda. </p><br><h2 id="chto-v-itoge">  Apa hasilnya? </h2><br><p>  Setelah menghabiskan sedikit waktu, kami membuat rencana di mana ada gambar raster, menyoroti berbagai detailnya, menghubungkan benda-benda yang tidak terkait dengan panah dan reaksi terhadap mouse.  Saya berharap saya berhasil menyampaikan ide dasar tentang bagaimana semua ini dilakukan dalam versi "anggaran".  Seperti yang kami catat di awal artikel, ada banyak aplikasi yang berbeda, termasuk yang tidak terkait dengan beberapa jenis situs desain yang membingungkan (meskipun pendekatan ini sangat sering digunakan pada mereka).  Nah, jika Anda mencari sesuatu untuk dibaca tentang hal yang interaktif, tetapi sudah tiga dimensi, maka saya meninggalkan tautan ke artikel tentang topik - <a href="https://habr.com/ru/post/433876/">Presentasi produk tiga dimensi pada Three.js untuk yang terkecil</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id478698/">https://habr.com/ru/post/id478698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id478688/index.html">Bagaimana rasanya belajar Ilmu Data pada tahun 2019</a></li>
<li><a href="../id478690/index.html">Perakitan dinamis dan penyebaran gambar Docker dengan werf menggunakan contoh situs dokumentasi versi</a></li>
<li><a href="../id478692/index.html">Bagaimana Java 8 didukung di Android</a></li>
<li><a href="../id478694/index.html">Karena kami merekomendasikan katalog terbaru di bioskop online ivi (+ kode Python)</a></li>
<li><a href="../id478696/index.html">Bagaimana Saya Mengunjungi Urban Tech 2019. Laporan Acara</a></li>
<li><a href="../id478702/index.html">Trik Pemrosesan Metrik di Kapacitor</a></li>
<li><a href="../id478706/index.html">Arsitek beban tinggi. Kursus baru dari OTUS</a></li>
<li><a href="../id478708/index.html">Bagaimana pengacak memungkinkan Anda menghembuskan kehidupan baru ke dalam game lama</a></li>
<li><a href="../id478710/index.html">Penerapan aplikasi yang mudah dan santai di Tarantool Cartridge (bagian 1)</a></li>
<li><a href="../id478712/index.html">Bagaimana tidak membayar hosting Java atau mulai cepat dengan Google App Engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>