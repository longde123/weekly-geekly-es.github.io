<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>↩️ 🚴🏿 🅱️ 我们值得拥有的文件上传字段 🏆 🧕 📔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="一切都在流动，一切都在变化，但是只有input[type=file]破坏了所有新手Web开发人员的神经，并且一直持续到现在。 N年前，当您刚开始了解创建网站的基本知识时，请记住自己。 年轻且经验不足，当文件选择按钮完全拒绝将背景颜色更改为您喜欢的桃子时，您真的感到惊讶。 正是在那一刻，您第一次遇到了...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我们值得拥有的文件上传字段</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423035/">一切都在流动，一切都在变化，但是只有<code>input[type=file]</code>破坏了所有新手Web开发人员的神经，并且一直持续到现在。  N年前，当您刚开始了解创建网站的基本知识时，请记住自己。 年轻且经验不足，当文件选择按钮完全拒绝将背景颜色更改为您喜欢的桃子时，您真的感到惊讶。 正是在那一刻，您第一次遇到了这个坚不可摧的“下载文件”冰山，直到今天，它仍然“淹没”了新手Web开发人员。 <br><br> 以创建文件上传字段为例，我将向您展示如何正确隐藏<code>input[type=file]</code> ，将焦点设置在无法获得焦点的对象上，处理拖放事件以及通过AJAX发送文件。 另外，我还将向您介绍一些浏览器错误以及解决这些错误的方法。 本文是为初学者编写的，但在某些时候，即使是经验丰富的开发人员，也可能会很有用和有趣。 <br><a name="habracut"></a><br><h2> 标记和主要样式 </h2><br> 让我们从HTML标记开始： <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  ,   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"jquery-3.3.1.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"script.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"upload-container"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"send.php"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"upload-image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"upload.svg"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file-input"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiple</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file-input"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br> 也许您应该注意的主要元素是 <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"file-input"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  HTML规范不允许我们直接在<code>input[type=file]</code>上施加视觉属性，但是我们有一个<code>label</code>标记，单击它会导致单击它所附加的form元素。 令我们高兴的是，此标签在样式化方面没有任何限制：我们可以使用它来做我们想做的一切。 <br><br> 一个行动计划应运而生：我们随心所欲地对标签进行<code>input[type=file]</code>化，并将<code>input[type=file]</code>隐藏在视线之外。 首先，设置常规页面样式： <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: flex; <span class="hljs-attribute"><span class="hljs-attribute">justify-content</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">align-items</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">min-height</span></span>: <span class="hljs-number"><span class="hljs-number">100vh</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: flex; <span class="hljs-attribute"><span class="hljs-attribute">justify-content</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">align-items</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">flex-direction</span></span>: column; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">400px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">400px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span> dashed <span class="hljs-number"><span class="hljs-number">#5d5d5d</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline-offset</span></span>: -<span class="hljs-number"><span class="hljs-number">12px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#e0f2f7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'Segoe UI'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#1f3c44</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">40%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">user-select</span></span>: none; }</code> </pre><br> 现在设置标签样式： <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-weight</span></span>: bold; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; <span class="hljs-attribute"><span class="hljs-attribute">text-decoration</span></span>: underline; }</code> </pre><br> 我们正在努力的目标（从标记中删除了<code>input[type=file]</code> ）： <br><img src="https://habrastorage.org/webt/uq/oy/nn/uqoynnkiqozkclwaalgqsxakrys.png"><br> 当然，您可以将标签居中，添加背景和边框，获得完整的按钮，但我们的首要任务是拖放。 <br><br><h2> 隐藏输入 </h2><br> 现在我们需要隐藏<code>input[type=file]</code> 。 首先要引起关注的是<code>display: none</code>和<code>visibility: hidden</code>属性。 但这不是那么简单。 在某些较旧的浏览器上，单击标签将不再起作用。 但这还不是全部。 如您所知，看不见的元素无法获得焦点，无论它们说什么，焦点都很重要，因为对于某些人来说，这是与网站进行交互的唯一方法。 因此这种方法不适合我们。 让我们来解决这个问题： <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: relative; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">0.1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">0.1px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">opacity</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">z-index</span></span>: -<span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre><br> 我们绝对将<code>input[type=file]</code>相对于其父块<code>0.1px</code> ，将其减小到<code>0.1px</code> ，使其透明，并设置其<code>z-index</code>小于父块的<code>z-index</code> ，可以这么说。 <br><br> 恭喜，我们实现了我们想要的：我们的领域与上图中完全一样。 <br><br><h2> 调整焦点 </h2><br> 由于我们的<code>input[type=file]</code>实际存在于页面上，因此它具有接收焦点的能力。 也就是说，如果我们按页面上的<code>Tab</code>键，那么在某些时候焦点将切换到<code>input[type=file]</code> 。 但是问题是我们看不到这一点：我们隐藏的字段会脱颖而出。 是的，如果此时我们按<code>Enter</code> ，对话框将打开，一切将按预期进行，但是我们如何理解该按一下了？ <br><br> 我们的任务是在焦点位于文件上传字段时以某种方式选择标记。 但是，如果标签无法获得焦点，我们该怎么做呢？  CSS3鉴赏家将立即考虑伪类<code>:focus</code> ，它定义了focus元素的样式，以及<code>+</code>或<code>~</code>选择器选择了正确的邻居：位于同一嵌套级别的元素，位于所选元素之后。 考虑到在我们的标记<code>input[type=file]</code>它直接位于<code>label</code>标签的前面，因此发生了以下输入： <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> }</code> </pre><br> 但是话又说回来，并不是那么简单。 首先，让我们讨论如何选择标签。 如您所知，所有现代浏览器（并非如此）都具有针对焦点元素的唯一默认属性。 基本上，这是<code>outline</code>属性，它在元素周围创建一个笔触，该元素不同于<code>border</code> ，因为它不会调整元素的大小并且可以从元素上移开。 通常，人们只使用一个浏览器，因此他们习惯了它的标准。 为了使人们更轻松地浏览我们的网站，我们应该尝试调整焦点，以使其在大多数流行的现代浏览器中看起来都尽可能自然。 从理论上讲，使用JavaScript，您可以获得有关用户在哪个浏览器中打开了网站的信息，并相应地自定义了样式，但是作为主要面向初学者的文章的一部分，该主题太繁琐且繁琐。 我们将尝试一点点地过。 <br><br> 在基于WebKet引擎的浏览器（Google Chrome，Opera，Safari）中，焦点元素的默认属性具有以下形式： <br><br><pre> <code class="css hljs"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br>  <code>-webkit-focus-ring-color</code>是仅针对此引擎的焦点描边<code>-webkit-focus-ring-color</code> 。 也就是说，此行仅在WebKit浏览器中有效，而这正是我们所需要的。 为我们的标签指定此属性： <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br> 我们打开Goog​​le Chrome或Opera。 一切都会正常进行： <br><img src="https://habrastorage.org/webt/se/ay/mq/seaymqj0icne6yzqwcpnn8x1ock.png"><br> 让我们来看一下Mozilla Firefox和Microsoft Edge中的情况。 对于这些浏览器，默认属性是： <br><br><pre> <code class="css hljs"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#0078d7</span></span>; }</code> </pre><br> 和 <br><br><pre> <code class="css hljs"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#212121</span></span>; }</code> </pre><br> 相应地。 <br><br> 不幸的是， <code>-moz-</code>前缀不能与<code>outline</code>属性一起使用。 因此，我们将必须选择这两个属性中的哪一个。 由于Firefox用户数量要多得多，因此优先使用此特定浏览器更为合理。 这并不意味着我们剥夺了Edge用户和其他浏览器的机会来查看焦点所在，只是看起来与他们“有所不同”。 好吧，你必须做出牺牲。 <br><br> 我们在Mozilla Firefox的WebKit样式之前添加样式：首先，所有浏览器都将应用第一个属性，然后可以（谷歌浏览器，Opera，Safari等）使用第二个属性。 <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">input</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[type=file]</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:focus</span></span> + <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#0078d7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br> 奇怪的事情开始了：在Edge中一切正常，但是Firefox由于某些未知原因拒绝将属性应用于标签，而只关注<code>input[type=file]</code> 。  <code>focus</code>事件本身发生-通过JavaScript检查。 此外，如果您通过开发人员工具将焦点放在文件选择字段上，那么该属性将适用，并且将出现我们的笔画！ 显然，这是浏览器本身的错误，但是如果有人知道为什么会发生-请在评论中写下。 <br><br> 好吧，没什么，普通的英雄总是四处走动。 如前所述， <code>focus</code>事件会发生，这意味着我们可以直接从JavaScript调整属性。 但是为此，我们将不得不更改选择器的逻辑： <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">label</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.focus</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid <span class="hljs-number"><span class="hljs-number">#0078d7</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline</span></span>: -webkit-focus-ring-color auto <span class="hljs-number"><span class="hljs-number">5px</span></span>; }</code> </pre><br> 我们将为标签描述<code>.focus</code>类，并且每次<code>input[type=file]</code>获得焦点时都将添加它，并在失去焦点时将其删除。 <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#file-input'</span></span>).focus(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'label'</span></span>).addClass(<span class="hljs-string"><span class="hljs-string">'focus'</span></span>); }) .focusout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'label'</span></span>).removeClass(<span class="hljs-string"><span class="hljs-string">'focus'</span></span>); });</code> </pre><br> 现在一切正常。 恭喜，我们找到了重点。 <br><br><h2> 拖放式 </h2><br> 使用拖放操作是通过跟踪特殊的浏览器事件进行的： <code>drag, dragstart, dragend, dragover, dragenter, dragleave, drop</code> 。 您可以在Internet上轻松找到它们的详细描述。 我们将仅跟踪其中一些。 <br><br> 首先，定义一个拖放元素： <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dropZone = $(<span class="hljs-string"><span class="hljs-string">'#upload-container'</span></span>);</code> </pre><br> 然后，我们在CSS中描述一个特殊的类，当拉动文件的光标直接位于其上方时，我们将为其分配<code>dropZone</code> 。 必须以可视方式通知用户该文件已经可以释放。 <br><br><pre> <code class="css hljs"><span class="hljs-selector-id"><span class="hljs-selector-id">#upload-container</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.dragover</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background-color</span></span>: <span class="hljs-number"><span class="hljs-number">#fafafa</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">outline-offset</span></span>: -<span class="hljs-number"><span class="hljs-number">17px</span></span>; }</code> </pre><br> 现在，我们转到JS文件。 首先，我们需要撤消拖放事件的所有默认操作。 例如，此类事件之一是浏览器引发的文件打开。 我们根本不需要它，因此我们将编写以下行： <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'drag dragstart dragend dragover dragenter dragleave drop'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; });</code> </pre><br> 在jQuery中，调用<code>return false</code>等效于立即调用两个函数： <code>e.preventDefault()</code>和<code>e.stopPropagation()</code> 。 <br><br> 我们开始描述我们自己的事件处理程序。 我们将以与焦点相同的方式进行操作，但是这次我们将跟踪<code>dragenter</code>和<code>dragover</code>事件以添加一个类，并<code>dragleave</code>事件将其删除： <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'dragover dragenter'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dropZone.addClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); }); dropZone.on(<span class="hljs-string"><span class="hljs-string">'dragleave'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); });</code> </pre><br> 再一次，令人不愉快的惊喜等待着我们：当您使用带有文件的鼠标沿着<code>dropZone</code>移动时，该字段开始闪烁。 这在Microsoft Edge和WebKit浏览器中发生。 顺便说一下，这些WebKit浏览器中的大多数当前都在Blink引擎上运行（很讽刺，是吧？）。 但是在Mozilla中，没有任何闪烁。 显然，我决定在解决焦点错误后对其进行修复。 <br><br> 发生这种闪烁的原因是，当您将鼠标悬停在<code>dropZone</code>之上时，无论是图片还是带有文件选择字段和标签的<code>div</code> ，出于某种原因<code>dragleave</code>事件。 对于我们来说显而易见的是，我们没有离开此字段，但是由于某些原因，浏览器没有退出，因此，它们<code>.focus</code>从<code>dropZone</code>删除了<code>.focus</code>类。 <br><br> 再说一次，我们必须以某种方式下车。 如果浏览器本身不了解我们没有离开该领域，那么我们将不得不提供帮助。 然后，我们将通过其他条件来执行此操作：我们计算鼠标相对于<code>dropZone</code>的坐标，然后检查光标是否在块之外。 如果保留，则删除样式： <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'dragleave'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dx = e.pageX - dropZone.offset().left; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dy = e.pageY - dropZone.offset().top; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((dx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (dx &gt; dropZone.width()) || (dy &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) || (dy &gt; dropZone.height())) { dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); }; });</code> </pre><br> 就是这样，问题就解决了！ 这是我们内部带有文件的字段的样子： <br><img src="https://habrastorage.org/webt/sz/6t/8j/sz6t8jyctde70wiimiz9zwijmi0.png"><br><br> 让我们继续处理<code>drop</code>事件本身。 但是首先请记住，除了拖放之外，我们还<code>input[type=file]</code> ，并且这些方法的本质上都是独立的，但是必须执行相同的操作：上传文件。 因此，我建议为这两种方法创建一个通用的单独函数，我们将文件传输到该函数中，并且它将已经决定如何处理它们。 我们将其称为<code>sendFiles()</code> ，但稍后将对其进行描述。 首先，请处理<code>drop</code>事件： <br><br><pre> <code class="javascript hljs">dropZone.on(<span class="hljs-string"><span class="hljs-string">'drop'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'dragover'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> files = e.originalEvent.dataTransfer.files; sendFiles(files); });</code> </pre><br> 首先， <code>.dragover</code>从<code>dropZone</code>删除<code>.dragover</code>类。 然后我们得到一个包含文件的数组。 如果使用jQuery，则路径为<code>e.originalEvent.dataTransfer.files</code> ；如果使用纯JS编写，则路径为<code>e.dataTransfer.files</code> 。 好吧，然后将数组传递给尚未实现的函数。 <br><br> 现在，我们将通过<code>input[type=file]</code>确定加载方法： <br><br><pre> <code class="javascript hljs">$(<span class="hljs-string"><span class="hljs-string">'#file-input'</span></span>).change(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> files = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.files; sendFiles(files); });</code> </pre><br> 我们在文件选择按钮上跟踪<code>change</code>事件，我们通过<code>this.files</code>获得数组并将其发送给函数。 <br><br><h2> 通过AJAX发送文件 </h2><br> 最后一步-文件处理功能的描述-每个人都是唯一的。 这将直接取决于您追求的目标。 例如，我将展示如何通过AJAX将文件发送到服务器。 <br><br> 假设我们创建了一个用于上传照片的字段。 我们不希望其他东西到达我们的服务器，因此我们将决定文件类型：将其设为PNG和JPEG。 调节用户可以发送的一张照片的最大尺寸也是值得的。 限制为五兆字节。 我们开始描述我们的功能： <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendFiles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">files</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> maxFileSize = <span class="hljs-number"><span class="hljs-number">5242880</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormData(); $(files).each(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index, file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((file.size &lt;= maxFileSize) &amp;&amp; ((file.type == <span class="hljs-string"><span class="hljs-string">'image/png'</span></span>) || (file.type == <span class="hljs-string"><span class="hljs-string">'image/jpeg'</span></span>))) { Data.append(<span class="hljs-string"><span class="hljs-string">'images[]'</span></span>, file); } }); };</code> </pre><br> 在变量<code>maxFileSize</code>要发送到服务器<code>maxFileSize</code>最大文件大小。  <code>FormData()</code>函数，我们将创建<code>FormData</code>类的新对象，该类允许我们生成键值对的集合。 这样的对象可以通过AJAX轻松发送。 接下来，我们对<code>files</code>数组使用jQuery <code>.each</code>构造，这将应用我们为其每个元素设置的功能。 元素的编号和元素本身将作为参数传递给函数，我们将分别将其作为<code>index</code>和<code>file</code>处理。 在函数本身中，我们将根据条件检查文件：文件大小小于5兆字节，类型为PNG或JPEG。 如果文件通过了测试，则可以通过调用<code>append()</code>函数将其添加到我们的<code>FormData</code>对象中。 关键是字符串<code>'photos[]'</code> ，其末尾的方括号表示该数组是可以包含多个对象的数组。 对象本身将是<code>file</code> 。 <br><br> 现在一切准备就绪，可以通过AJAX发送文件了。 将以下行添加到我们的函数中： <br><br><pre> <code class="javascript hljs">$.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: dropZone.attr(<span class="hljs-string"><span class="hljs-string">'action'</span></span>), <span class="hljs-attr"><span class="hljs-attr">type</span></span>: dropZone.attr(<span class="hljs-string"><span class="hljs-string">'method'</span></span>), <span class="hljs-attr"><span class="hljs-attr">data</span></span>: Data, <span class="hljs-attr"><span class="hljs-attr">contentType</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">processData</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'   '</span></span>); } });</code> </pre><br> 作为参数<code>url</code>和<code>type</code>我们分别指示<code>input[type=file]</code>的<code>action</code>和<code>method</code>属性的值。 为了通过AJAX，我们将成为一个<code>Data</code>对象。 需要参数<code>contentType: false</code>和<code>processData: false</code> ，以便浏览器不会无意间将我们的文件转换为其他格式。 在<code>success</code>参数中，我们指定将文件成功传输到服务器后将执行的功能。 它的内容取决于您的想象力，但是我将只介绍有关成功下载的消息的适度输出。 <br><br> 恭喜，您现在可以创建自己的文件上传字段！ 当然，我不会将我的方法定位为唯一正确和正确的方法。 我的目标是展示解决此问题的一般过程，主要适合初学者。 如果您认为可以在某处做得更好-请在评论中写下，我们将进行讨论！ <br><br> 仅此而已。 感谢您的关注！ <br><br> 资料下载： <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最终版本</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">焦点问题</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">闪烁问题</a> </li></ol><br> 触摸： <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最终版本</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">焦点问题</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">闪烁问题</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423035/">https://habr.com/ru/post/zh-CN423035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423023/index.html">为什么开发人员需要教学</a></li>
<li><a href="../zh-CN423025/index.html">现金计划如何节省分析费用？</a></li>
<li><a href="../zh-CN423027/index.html">FTDI-POF光学收发器</a></li>
<li><a href="../zh-CN423029/index.html">Club Club Report 2018，第3.2章：“发展选择”</a></li>
<li><a href="../zh-CN423033/index.html">他们在CRM上谈论过多：与八卦打交道</a></li>
<li><a href="../zh-CN423039/index.html">我们通过区块链进行Web身份验证</a></li>
<li><a href="../zh-CN423041/index.html">奇异故事超级NES CD-ROM</a></li>
<li><a href="../zh-CN423043/index.html">由于特斯拉电动汽车保护系统中的漏洞，汽车可能在几秒钟内被盗</a></li>
<li><a href="../zh-CN423045/index.html">选择哪种3D打印机？ 3Dtool视频评论</a></li>
<li><a href="../zh-CN423047/index.html">我们以合理的价格预留IT系统</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>