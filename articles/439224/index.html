<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚è¨ ‚òÄÔ∏è üë¥üèΩ De nuevo sobre los diagramas de Voronoi üë©üèø‚Äçü§ù‚Äçüë®üèª ‚úäüèΩ üóíÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como se escribi√≥ en publicaciones de blog recientes , luch√© por obtener el detalle correcto de la costa en mi juego Dragons Abound . Mi decepci√≥n surg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>De nuevo sobre los diagramas de Voronoi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439224/">  Como se escribi√≥ en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaciones de</a> blog <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recientes</a> , luch√© por obtener el detalle correcto de la costa en mi juego <b>Dragons Abound</b> .  Mi decepci√≥n surgi√≥ durante la implementaci√≥n de las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">islas barrera</a> .  Para crear la isla m√°s angosta posible, les hice una ubicaci√≥n amplia: en la figura a continuaci√≥n, cada ubicaci√≥n es un tri√°ngulo de Delaunay: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5dc/cce/739/5dccce739bdcd3372876b7cff72b4f0e.png"></div><br>  Esto fue bastante desagradable, tanto porque la isla estaba muy rota como porque el tama√±o de las partes era demasiado grande.  Parec√≠a que con un gran aumento en el n√∫mero de tri√°ngulos de Delaunay (es decir, con una fuerte disminuci√≥n en su tama√±o), este problema se resolver√≠a, pero la densidad de tri√°ngulos que necesitaba condujo a un bloqueo del navegador. <br><a name="habracut"></a><br>  Resolv√≠ este problema separando los contornos de la tierra de la representaci√≥n interna de las ubicaciones.  Esto me permiti√≥ dibujar islas de cualquier tama√±o o forma, independientemente de la cuadr√≠cula de ubicaci√≥n subyacente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b2e/8a2/351/b2e8a235144cb7c07c9d374980be1782.png"></div><br>  ¬°Entonces el problema est√° resuelto!  Esto me permiti√≥ dibujar las islas de barrera, y dado que la l√≠nea costera ya no es necesaria para seguir la cuadr√≠cula b√°sica, si es necesario, se podr√≠a crear una l√≠nea costera m√°s detallada de la manera habitual y luego agregar detalles. <br><br>  Pero ... ¬øc√≥mo agregamos detalles a la costa?  No es tan f√°cil como podr√≠as pensar.  Como quer√≠a crear una l√≠nea costera fractal, consider√© usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fractales para agregar detalles</a> a la l√≠nea costera: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b3/f94/9fd/5b3f949fd2649767029f2768d55a8185.png"></div><br>  Despu√©s de experimentar con la configuraci√≥n, pude agregar muchos detalles y cosas interesantes a la costa.  Sin embargo, el sistema no pudo crear algo parecido a ese mapa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ed/03d/701/0ed03d701f34074236f314574162073f.png"></div><br>  El ruido de Perlin <i>puede</i> crear este tipo de terreno con una cuadr√≠cula de base suficientemente detallada, pero ¬øpuede hacerse <i>sin</i> almacenar las alturas de elevaci√≥n en la cuadr√≠cula de base con la resoluci√≥n deseada (despu√©s de todo, s√© que esto romper√° mi c√≥digo)?  Hasta que descubr√≠ c√≥mo hacerlo.  El litoral es esencialmente un camino a trav√©s de todos los puntos en los que la funci√≥n de ruido Perlin tiene un valor cero.  Aunque podemos aprender directamente de la funci√≥n de ruido Perlin el valor en una ubicaci√≥n espec√≠fica (X, Y), no podemos encontrar (por ejemplo) "todas las ubicaciones en las que la funci√≥n tenga un valor cero".  Es decir, es dif√≠cil ver c√≥mo dibujar un contorno de alturas sin una cuadr√≠cula b√°sica. <br><br>  Peor a√∫n, le pregunt√© a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Amit</a> c√≥mo hacer esto, y √©l tampoco sab√≠a la respuesta.  Una cosa es cuando no puedo decir esto, pero cuando incluso una persona tan inteligente no puede dar una respuesta, empiezo a pensar que esto no se puede hacer.  Es triste  Puedo darle a la costa cualquier forma que necesite, pero no puedo obtener las formas que necesito sin una cuadr√≠cula de base muy detallada. <br><br>  Entonces, ¬øc√≥mo obtengo una cuadr√≠cula de alta resoluci√≥n sin romper el c√≥digo? <br><br>  Una de las soluciones que se me ocurri√≥ me recuerda lo que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hizo Azgaar</a> en su generador de mapas: las c√©lulas Voronoi de tama√±o variable.  La idea principal es aumentar la densidad (y disminuir el tama√±o) de la malla base a lo largo de las costas y mantener una densidad m√°s baja en los oc√©anos y otras √°reas que no requieren detalles.  Con esta opci√≥n, tendr√© muchas celdas de malla solo en aquellas √°reas donde necesite detalles.  Este cambio ser√° bastante dif√≠cil de implementar en <b>Dragons Abound</b> , pero quiero meditarlo.  Por otro lado, Azgaar en s√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no estaba muy satisfecho con este enfoque</a> , por lo que tambi√©n es necesario tenerlo en cuenta. <br><br>  Paralelamente, quer√≠a investigar las causas de un bloqueo del navegador al procesar un mont√≥n de tri√°ngulos.  Las herramientas de desarrollador en Chrome me proporcionaron informaci√≥n detallada sobre el rendimiento.  De ninguna manera soy un experto en el uso de estas herramientas, pero muchas funciones son lo suficientemente simples para que cualquiera las entienda.  En caso de que desee averiguar la cantidad total de memoria utilizada en el programa, la pesta√±a Memoria contiene informaci√≥n sobre la capacidad utilizada actual: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccd/da9/c31/ccdda9c31c29814b1ffa88b0ae5eefce.png"></div><br>  En este caso, abr√≠ la p√°gina web de Azgaar, y ocupa unos modestos 20 MB de memoria.  Puede usar esta herramienta para averiguar cu√°nta memoria ocupa <b>Dragons Abound</b> y para determinar cu√°ndo se bloquea la pesta√±a. <br><br>  El par√°metro b√°sico que controla la resoluci√≥n de la malla subyacente en <b>Dragons Abound se</b> llama inteligentemente "npts" (N√∫mero de puntos).  Para cada unidad de √°rea del mapa (los mapas de regiones que generalmente uso como ejemplos tienen un √°rea de 1 unidad) <b>Dragons Abound</b> crea un n√∫mero determinado de ubicaciones de la cuadr√≠cula base.  Usualmente uso 16K (16384) para npts, lo que significa que cada ubicaci√≥n de cuadr√≠cula corresponde a aproximadamente 70 p√≠xeles cuadrados de la pantalla en una escala de zoom est√°ndar. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73d/0a7/6ca/73d0a76ca2e25bf5c5724ef2c446b25c.png"></div><br>  Por supuesto, la cantidad exacta de memoria utilizada depende de la tarjeta, pero para la tarjeta que se muestra arriba con 16K puntos necesita aproximadamente 92 MB: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/82e/f8f/8c2/82ef8f8c28678bfb47a7a642761fe11e.png"></div><br>  Esto es menos de lo que esperaba y, para ser sincero, una cifra bastante modesta. <br><br>  Si duplica el n√∫mero de puntos en la cuadr√≠cula base, la capacidad de memoria aumentar√° a 138 MB: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/40d/beb/ad7/40dbebad7c52e1e833fef7372ac7d1d9.png"></div><br>  El tama√±o de la memoria ocupada no se ha duplicado, porque parte de esta memoria est√° ocupada por recursos y otras estructuras de datos cuyo tama√±o no ha cambiado.  16K puntos adicionales "pesan" unos 50 MB de memoria, es decir, cada punto ocupa aproximadamente 3 KB de memoria.  Esto es m√°s de lo que esperaba, pero en general el volumen sigue siendo bastante modesto.  En una computadora con 64 GB de memoria, apenas se notan 150 MB. <br><br>  Despu√©s de hacer algunos dobles m√°s, descubr√≠ que la pesta√±a con <b>Dragons Abound</b> generalmente se bloquea en aproximadamente 128K puntos.  Si lo detectamos antes de que salga volando y verifiquemos la memoria, veremos lo siguiente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/718/c57/d27/718c57d27a1bce96fa73943e53196b9a.png"></div><br>  Supuse que la pesta√±a se bloquea debido a la memoria ocupada, pero generalmente el problema no est√° en la memoria.  ¬øPor qu√© se bloquea la pesta√±a?  La √∫nica pista es que la pesta√±a no se bloquea antes de que finalice el mapa, y esto es probablemente una indicaci√≥n de que se produce un bloqueo durante el renderizado. <br><br>  Es l√≥gico suponer que el SVG que creo sobrecarga el renderizador del navegador debido a su tama√±o o complejidad.  Para comenzar, puedo averiguar cu√°ntos elementos SVG creo.  En D3, puedo obtener el n√∫mero total de elementos SVG creados usando <code>svg.selectAll('*').size()</code> . <br><br>  Ejecutar desde 16K puntos y verificar la cantidad de elementos SVG me mostr√≥ lo siguiente: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14a/d15/77d/14ad1577d0e1f61b29e76bc36f57961f.png"></div><br>  32K puntos tienen 65457 elementos, y 128K puntos tienen 258823. Cada punto agregado a la cuadr√≠cula base agrega dos elementos al mapa.  Creo que encontr√© una fuente de desgracia. <br><br>  Cada punto en la cuadr√≠cula base agrega elementos SVG debido a la forma en que <b>Dragons Abound representa la</b> tierra (y el agua).  El terreno se representa al representar cada ubicaci√≥n base como un pol√≠gono relleno, seguido de desenfocarlos a todos.  Esto permite que <b>Dragons Abound le</b> d√© a la tierra un patr√≥n hermoso o use la altura de la tierra para renderizar la tierra con sombreado 3D, como se muestra aqu√≠: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/294/b56/8c4/294b568c4939a297253b4fe4172eac0b.png"></div><br>  Puede desactivar la visualizaci√≥n de la tierra y el oc√©ano para verificar cu√°ntos elementos SVG se crean.  En 256K puntos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad7/e09/1e6/ad7e091e6c4c6de42207734830d508af.png"></div><br>  Wow, la cantidad de elementos SVG ha disminuido significativamente.  Como esperaba, ¬°ahora el mapa se muestra sin fallar!  Es decir, si evita usar una cuadr√≠cula para representar la tierra y el agua, puede crear una cuadr√≠cula mucho m√°s densa que antes. <br><br>  Ahora que tengo una cuadr√≠cula de Voronoi mucho m√°s densa, quiero verificar si me permite generar los elementos de socorro que necesito, como las islas costeras.  La densa malla de Voronoi crea otros problemas (especialmente con los r√≠os), as√≠ que apagar√© todo excepto las costas para acelerar las pruebas y enfocarme en ellas.  Aqu√≠ est√° el render original de algunas costas a 256K p√≠xeles y con ruido est√°ndar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c4/bad/0a0/7c4bad0a043f626a83d3edb071e5c77f.png"></div><br>  Resulta que el mapa se renderiza bien y ya crea una costa mucho m√°s hermosa. <br><br>  Incluso sin un ajuste cuidadoso, el resultado es mucho mejor.  El ruido crea los tipos de costas fractales e islas costeras que indiqu√© en el mapa de arriba. <br><br>  Aqu√≠ est√°n las islas con un aumento del 300%: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b70/32e/471/b7032e471d8ac9c0029781799a43af56.png"></div><br>  Con este aumento, puede observar artefactos de tri√°ngulos desde la cuadr√≠cula base, pero aun as√≠, las islas pueden crear formas interesantes.  Puede usar el suavizado (como lo hago en la versi√≥n actual de los mapas) para deshacerse de algunos de los artefactos m√°s notables de los tri√°ngulos.  Con un aumento est√°ndar, esto proporciona una costa menos accidentada, pero tambi√©n elimina algunos peque√±os detalles: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c6f/783/120/c6f78312049d55db06e1776250ce520a.png"></div><br>  Probablemente tenga que sintonizar para obtener un t√©rmino medio. <br><br>  La mayor√≠a de los generadores de sushi procesales usan el ruido Perlin para crear un mapa de altura.  Necesitamos encontrar los par√°metros de ruido apropiados, seleccionar una semilla y luego usar el valor de ruido en cada ubicaci√≥n (x, y) para establecer la masa de tierra.  Un aspecto conveniente de hacer tierra es que si necesita m√°s detalles sobre la costa, simplemente puede ajustar los par√°metros de ruido. <br><br>  Sin embargo, <b>Dragons Abound</b> no crea tierra de esta manera.  (O al menos crea m√°s que eso). <b>Dragons Abound</b> utiliza muchos m√©todos diferentes para crear sushi.  Aunque todos usan el ruido en un grado u otro, muy pocos crean tierra directamente del ruido.  Por ejemplo, el juego tiene un procedimiento para crear una isla que crea una m√°scara para la isla (generalmente una elipse), usa ruido para darle a la elipse una forma m√°s natural y luego aplica un ruido diferente para llenar la m√°scara de manera aproximada.  Cada mapa particular generalmente se crea mediante una combinaci√≥n de varios procedimientos diferentes.  Por lo tanto, agregar detalles ajustando los par√°metros de ruido para <b>Dragons Abound</b> no <b>es</b> muy adecuado. <br><br>  Para mis prop√≥sitos, es mejor abordar el problema desde un √°ngulo ligeramente diferente.  Si tengo un mapa de elevaci√≥n espec√≠fico que define las masas de tierra, ¬øc√≥mo agrego detalles a los bordes de estas masas de tierra?  Esto puede llevarnos a la idea de que necesitamos reconocer los bordes de las masas de tierra y enmascarar el resto del mapa, etc.  Pero, por otro lado, no estoy en contra de agregar detalles adicionales al resto del mapa.  Si la tierra es un poco m√°s desigual o el fondo del oc√©ano es un poco m√°s √°spero, entonces esto es normal. <br><br>  ¬øQu√© significa agregar detalles a la costa?  Una l√≠nea costera es simplemente una l√≠nea de contorno en la que un mapa de altura tiene un valor cero.  (El valor es arbitrario, pero este principio se usa en todos los generadores de tierra procesales). Para hacer esta l√≠nea m√°s detallada, debe cambiar ligeramente la tierra al lado de esta l√≠nea de contorno un poco hacia arriba y hacia abajo, para que las costas simples se vuelvan m√°s complejas, partes de la tierra sobresalgan en el oc√©ano y se vuelvan islas, y as√≠ sucesivamente.  Pero esto no deber√≠a suceder por casualidad, quiero que los cambios parezcan naturales.  Resumimos todo esto, y parece que necesita agregar una peque√±a cantidad de ruido a todo el mapa.  Y en realidad esto es exactamente lo que hice en el ejemplo original que se muestra arriba. <br><br>  Por supuesto, esto debe hacerse con cuidado para no borrar las masas de tierra creadas y crear otros problemas.  Esencialmente, necesito configurar tres par√°metros. <br><br>  El primero es la escala del ruido.  Una escala es simplemente un intervalo de valores para este ruido.  En nuestro caso, quiero reducir algunas √°reas hacia abajo y aumentar algunas, por lo que el rango de valores debe ser de negativo a positivo.  Sin embargo, no quiero agregar nuevas monta√±as o crear un oc√©ano lejos de la costa existente, por lo que har√© que el valor m√°ximo (absoluto) del ruido sea una peque√±a fracci√≥n de la altura est√°ndar de la tierra. <br><br>  El segundo par√°metro es la frecuencia principal del ruido.  La frecuencia determina qu√© tan r√°pido cambia el ruido dentro de la ubicaci√≥n.  El ruido de baja frecuencia cambia muy lentamente, por lo que un √°rea positiva con ruido de baja frecuencia puede (por ejemplo) cubrir todo el mapa.  El ruido de alta frecuencia cambia r√°pidamente, por lo que una regi√≥n positiva con ruido de alta frecuencia puede (por ejemplo) tener el tama√±o de una isla peque√±a.  En nuestro caso, la frecuencia de ruido principal determina los elementos de relieve m√°s grandes que veremos en el ruido.  Es decir, si quiero que el ruido agregue (digamos) peque√±as islas (pero nada m√°s grandes que ellas) al mapa, entonces debo seleccionar la frecuencia principal del tama√±o de una peque√±a isla. <br><br>  Puede pensar que esto es f√°cil de hacer (solo mida una isla peque√±a y asigne este tama√±o a la frecuencia principal).  Sin embargo, la frecuencia se mide en las coordenadas de la funci√≥n de ruido, no en las coordenadas del mapa.  Una funci√≥n de ruido t√≠pica puede tener un intervalo de 0 a 255 en cada coordenada, y un mapa puede tener un intervalo de -1 a 1. En cada coordenada. Peor a√∫n, las coordenadas de ruido est√°n colapsadas y muchos usuarios que usan ruido ni siquiera se dan cuenta de esto.  La traducci√≥n de una unidad a otra y la determinaci√≥n de frecuencias adecuadas es confusa, por lo que generalmente es m√°s f√°cil experimentar con intervalos de frecuencia y elegir el que crea los elementos de la tarjeta del tama√±o correcto. <br><br>  El tercer par√°metro es el n√∫mero de octavas de ruido.  Las octavas son capas adicionales de ruido.  Cada capa generalmente duplica la frecuencia y reduce a la mitad la escala de ruido.  Es decir, cada nueva capa agrega elementos de relieve dos veces menos que la capa anterior, pero tambi√©n dos veces m√°s d√©bil.  Es decir, debe seleccionar el n√∫mero de octavas que dan los elementos m√°s peque√±os que necesitamos, y para esto puede que necesite ajustar la escala de ruido, ya que todav√≠a es lo suficientemente fuerte en la octava m√°s alta para aparecer en el mapa.  Como intencionalmente hago esto para hacer que las costas sean muy complejas, usar√© bastantes octavas de ruido. <br><br>  Comencemos con la configuraci√≥n.  Para comenzar, generar√© un mapa de ejemplo sin ruido adicional: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cf2/e89/ce9/cf2e89ce9f62d676f9659141be032e15.png"></div><br>  Obviamente, esta es una costa aburrida, con l√≠neas suaves y solo un par de islas grandes.  Aqu√≠ est√° la misma costa con la muestra de ruido original: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/035/e88/a62/035e88a62f7f2a79fd41e573016bb3aa.png"></div><br>  El ruido cambi√≥ significativamente la forma del mapa, convirtiendo grandes fragmentos de tierra en un oc√©ano, y viceversa.  Tambi√©n aparecieron muchas islas, incluso lejos en el mar.  Todo esto indica que la escala de ruido es demasiado grande.  Los elementos de relieve individuales m√°s grandes a√±adidos por el ruido deben ser del tama√±o de las peque√±as islas del mapa original.  Este es probablemente el nuevo tama√±o m√°ximo de los elementos, lo que demuestra que la frecuencia principal del ruido se elige aproximadamente correctamente.  Finalmente, aparecieron muchos peque√±os detalles, hasta los l√≠mites del tama√±o de la pantalla, y esto muestra que hay suficientes octavas.  (Sin embargo, el n√∫mero de octavas puede ser m√°s de lo necesario. Esto no afecta la apariencia de la tarjeta, pero es ineficiente). Parece que b√°sicamente necesita ajustar la escala de ruido. <br><br>  Ajustar el ruido es una operaci√≥n bastante complicada porque quiero que este ruido afecte principalmente a la tierra y al agua en una l√≠nea de contorno con una altura = 0. Es decir, necesito una escala relativamente peque√±a, pero no est√° claro c√≥mo elegir el n√∫mero correcto, porque En diferentes mapas, la distribuci√≥n de las alturas var√≠a.  La soluci√≥n es encontrar la escala correcta sobre la marcha.  Puede tomar todos los valores absolutos de las alturas en el mapa, ordenarlos y encontrar el punto de corte que selecciona (digamos) el 10% de las ubicaciones alrededor de cero.  Todos estos lugares caen en el intervalo (por ejemplo) [-0.05, 0.05], y luego puedo usar el valor 0.05 para determinar la escala del ruido agregado. <br><br>  (Escribo "definiciones" porque por varias razones no puedes usar 0.05. Primero debes convertir la tierra en agua y viceversa. Agregar (digamos) 0.002 a -0.05 no har√° ning√∫n cambio visible en el mapa. Es decir, el intervalo deber√≠a ser mucho m√°s que 0.05 si quiero convertir una proporci√≥n significativa de ubicaciones con una altura de -0.05 del agua a la tierra. En segundo lugar, las funciones de ruido no est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">distribuidas uniformemente</a> , por lo que con una escala de 0.05 la funci√≥n de ruido nunca devolver√° 0.05. En la pr√°ctica, la dificultad es que la escala deber√≠a ser mucho mayor  que los valores m√°s grandes que queremos ver con suficiente frecuencia). <br><br>  Despu√©s de experimentar, encontr√© un valor que agrega complejidad a las costas, sin cambiarlas significativamente, y tambi√©n crea un peque√±o n√∫mero de islas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3f9/2e5/19c/3f92e519c2370c7bbaa3338ef65a0944.png"></div><br>  Como siempre, estos par√°metros en el juego pueden tomar un intervalo de valores, por lo que puedo obtener una amplia gama de tarjetas: desde tarjetas con costas bastante suaves hasta tarjetas con bancos rotos y complejos.  Dejando que el programa seleccione los valores, obtuve el siguiente resultado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43f/275/649/43f2756497cf54b7f95aa6a8f9cd5618.png"></div><br>  Las costas est√°n en el lado m√°s liso, pero a√∫n existe la mayor parte de la complejidad a√±adida de la escala media y un n√∫mero suficiente de nuevas islas. <br><br>  Al implementar costas fractales, me di cuenta de la capacidad de controlar el nivel de fractalizaci√≥n utilizando la funci√≥n de ruido, por lo que algunas √°reas tendr√°n costas suaves, mientras que otras tendr√°n costas complejas.  Pens√© que esto aumentar√≠a en gran medida el inter√©s del mapa, y se ver√≠a menos "generado", por lo que agregar√© esta caracter√≠stica aqu√≠.  La idea es bastante simple: antes de agregar ruido costero al mapa, lo multiplico por la salida de la segunda funci√≥n de ruido, que var√≠a de cero a 1. Cuando esta funci√≥n es peque√±a, se agregar√°n peque√±os detalles a las costas.  Cuando est√© cerca de 1, se agregar√°n detalles adicionales en su totalidad.  Al seleccionar la escala de la segunda funci√≥n de ruido, que var√≠a lentamente a lo largo del mapa, obtendr√© algunas √°reas con costas complejas, algunas con costas simples y transiciones l√≥gicas entre ellas: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/095/4a0/350/0954a03506ed074216606083654ceb08.png"></div><br>  Aqu√≠ hice grandes los par√°metros costeros, para que la diferencia sea m√°s visible.  Vemos costas salvajes y escarpadas en el noreste, y playas m√°s suaves en el oeste. <br><br>  Por lo tanto, hemos mejorado significativamente la generaci√≥n de costas, pero a√∫n no puedo generar completamente un mapa con tantos tri√°ngulos Delaunay.  Solo muestro mapas de esquema porque muchos otros elementos del mapa est√°n rotos.  Necesita ser reparado. <br><br>  El resto del programa no funciona bien con tantos tri√°ngulos de Delaunay (con configuraciones actuales de 256K).  El principal problema es que <b>Dragons Abound dibuja</b> tierra y agua dibujando todos los tri√°ngulos individuales, y tantos elementos SVG hacen que el navegador se bloquee.  As√≠ que tuve que deshabilitar completamente el renderizado de sushi.  Probablemente hay una forma de evitar este problema, pero tener tantos tri√°ngulos crea otros problemas.  Por ejemplo, algunas partes del programa deben procesar todo el mapa.  Cada uno de ellos se vuelve diecis√©is veces m√°s lento en ubicaciones de 256K que en ubicaciones de 16K.  Tambi√©n en el c√≥digo hay partes (por ejemplo, un nuevo modelo de precipitaci√≥n) que se rompen cuando se trabaja con tantos tri√°ngulos.  Y a partir de la creaci√≥n de una cuadr√≠cula de ubicaciones tan detallada, no ganamos nada: despu√©s de generar el litoral, nada mejora de la complejidad a√±adida.  Por lo tanto, aunque podr√≠a revisar el programa y corregir aquellas √°reas donde una gran cantidad de ubicaciones se ralentiza o rompe demasiado el c√≥digo, parece m√°s f√°cil reducir la resoluci√≥n de la cuadr√≠cula del mapa despu√©s de crear costas. <br><br>  Como se indic√≥ anteriormente, Azgaar ya ha realizado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">trabajos</a> para cambiar la resoluci√≥n de la cuadr√≠cula Voronoi subyacente en el mapa.  Se dio cuenta de la posibilidad de cambiar la resoluci√≥n de la cuadr√≠cula sobre la marcha en el proceso de generaci√≥n, es decir, podr√≠a (por ejemplo) aumentar la densidad de ubicaciones a lo largo de la costa.  Sin embargo, un cambio local en la densidad tiene sus inconvenientes, en particular, crea extra√±os tri√°ngulos a lo largo de la frontera.  M√°s tarde, Azgaar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sugiri√≥</a> que el sistema es demasiado complejo y no vale la pena el esfuerzo.  Azgaar generalmente sabe de lo que est√° hablando, por lo que aceptar√© su palabra y no intentar√© volver a embalar la malla terminada. <br><br>  En cambio, cre√© una segunda cuadr√≠cula con la resoluci√≥n deseada (m√°s baja) y luego copi√© el mapa de elevaci√≥n a esta nueva cuadr√≠cula.  (No olvide que <b>Dragons Abound</b> ahora almacena las costas por separado de la cuadr√≠cula, por lo que despu√©s de que se crean, ya no dependen del ajuste exacto de la cuadr√≠cula. Hacer esto es un poco complicado. Dado que la cuadr√≠cula original tiene una resoluci√≥n mucho m√°s alta que la nueva, muchas ubicaciones en el original la cuadr√≠cula se superpondr√° en una ubicaci√≥n en la nueva cuadr√≠cula. Cada una de estas ubicaciones de origen tiene una altura diferente en el mapa de altura, ¬øc√≥mo puedo copiarlas? ¬øUsar el promedio o la altura m√°xima (m√≠nima)? <br><br>  Para comenzar, solo selecciono una ubicaci√≥n aleatoria para ver si la nueva cuadr√≠cula funciona con el resto del programa: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d2/6c4/0d3/3d26c40d3b59d96dd54c98a550352dde.png"></div><br>  Todo result√≥ sorprendentemente bien.  Se produce un error menor cuando las nuevas ubicaciones no est√°n marcadas correctamente como tierra, costa o agua, pero despu√©s de resolver este problema, la generaci√≥n del mapa funcion√≥ bien.  Debe limpiar defectos menores (por ejemplo, la etiqueta Palmanor que sali√≥ al agua), pero en general se ve bien.  Incluso las peque√±as islas resultaron hermosas. <br><br>  Al final, decid√≠ que con una disminuci√≥n en la resoluci√≥n de la cuadr√≠cula Voronoi, cada ubicaci√≥n ser√≠a el promedio de las ubicaciones base.  Esto parece una decisi√≥n acertada, y si es necesario, siempre se puede cambiar.  Esta imagen muestra c√≥mo, como resultado, las costas se separaron de la malla terminada: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c40/859/805/c40859805e84a195276b4cbaeaaa0796.png"></div><br>  Para resumir: en <b>Dragons Abound</b> , se utiliza una cuadr√≠cula de tri√°ngulos Delone de muy alta resoluci√≥n al generar el mapa de altura.  Despu√©s de su finalizaci√≥n, <b>Dragons Abound</b> define las costas mediante el seguimiento de las transiciones de valores negativos a positivos en el mapa de altura.  Luego, el juego copia la cuadr√≠cula de alta resoluci√≥n en una cuadr√≠cula de resoluci√≥n mucho m√°s baja, promediando las ubicaciones que se encuentran en una ubicaci√≥n de la nueva cuadr√≠cula.  A continuaci√≥n, la cuadr√≠cula de alta resoluci√≥n se descarta y el resto de la generaci√≥n y visualizaci√≥n de procedimientos contin√∫a en la cuadr√≠cula de baja resoluci√≥n.  Una pregunta interesante es si el uso de la malla Delaunay tiene alg√∫n valor en esta etapa;  podr√≠a valer la pena copiarlo en una cuadr√≠cula de hex√°gonos o algo similar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/439224/">https://habr.com/ru/post/439224/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../439210/index.html">Java despu√©s de la erupci√≥n volc√°nica</a></li>
<li><a href="../439216/index.html">base de datos incrustable de 500 filas de pudge en golang</a></li>
<li><a href="../439218/index.html">VK bot en su rodilla, o c√≥mo complacer a las personas el 14 de febrero</a></li>
<li><a href="../439220/index.html">Gran ciudad para dispositivos m√≥viles en Unity. Experiencia en desarrollo y optimizaci√≥n.</a></li>
<li><a href="../439222/index.html">¬øQu√© es la gesti√≥n de API?</a></li>
<li><a href="../439226/index.html">Scala + MXNet = Microservicio con neurona en prod</a></li>
<li><a href="../439232/index.html">JAMstack: C√≥mo crear tu propio blog usando Gatsby + Contentful + Netlify</a></li>
<li><a href="../439234/index.html">La vida del desarrollador de c√≥digo abierto en GIF</a></li>
<li><a href="../439236/index.html">xenvman: entornos de prueba de microservicios flexibles (y m√°s)</a></li>
<li><a href="../439238/index.html">Play Store ahora acepta aplicaciones web progresivas (PWA)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>