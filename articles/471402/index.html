<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∂ ü§ΩüèΩ ‚ö±Ô∏è Iptables y filtrado de tr√°fico de los disidentes pobres y perezosos üõå üé± üë©üèΩ‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La relevancia del bloqueo de visitas a recursos prohibidos afecta a cualquier administrador que pueda ser presentado oficialmente con incumplimiento d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Iptables y filtrado de tr√°fico de los disidentes pobres y perezosos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471402/">  La relevancia del bloqueo de visitas a recursos prohibidos afecta a cualquier administrador que pueda ser presentado oficialmente con incumplimiento de la ley u √≥rdenes de las autoridades pertinentes. <br><br><img src="https://habrastorage.org/webt/9e/uq/ev/9euqevswnrg1zv6jaq_0nwcdnzu.png"><br><br>  ¬øPor qu√© reinventar la rueda cuando hay programas especializados y distribuciones para nuestras tareas, por ejemplo: Zeroshell, pfSense, ClearOS? <br><br>  Las autoridades hicieron otra pregunta: ¬øEl producto utilizado tiene un certificado de seguridad de nuestro estado? <br><a name="habracut"></a><br>  Ten√≠amos experiencia trabajando con las siguientes distribuciones: <br><br><ul><li>  Zeroshell: los desarrolladores incluso presentaron una licencia por 2 a√±os, pero result√≥ que la distribuci√≥n de intereses era il√≥gica para nosotros para cumplir una funci√≥n cr√≠tica para nosotros; </li><li>  pfSense: respeto y honor, al mismo tiempo aburrido, acostumbrarse a la l√≠nea de comando del firewall de FreeBSD no es lo suficientemente conveniente para nosotros (creo que es una cuesti√≥n de costumbre, pero result√≥ no ser "de esa manera"); </li><li>  ClearOS: result√≥ ser muy lento en nuestro hardware, no pudimos realizar pruebas serias y ¬øpor qu√© interfaces tan pesadas? </li><li>  Ideco SELECTA.  Hay una conversaci√≥n por separado sobre el producto Aydeko, un producto interesante, pero por razones pol√≠ticas no es para nosotros, pero tambi√©n quiero "morderlos" sobre la licencia para el mismo Linux, Roundcube, etc.  ¬øPor qu√© obtuvieron que al "cortar" la interfaz en <b>Python</b> y al seleccionar los derechos de superusuario, pueden vender un producto terminado compuesto por m√≥dulos desarrollados y mejorados de la comunidad de Internet distribuidos bajo la GPL, etc. </li></ul><br>  Entiendo que ahora los gritos negativos llegar√°n en mi direcci√≥n con requisitos para corroborar mis sentimientos subjetivos en detalle, pero quiero decir que este nodo de red tambi√©n es un equilibrador de tr√°fico a 4 canales externos a Internet, y cada canal tiene sus propias caracter√≠sticas.  Otra piedra angular fue la necesidad de trabajar en una de varias interfaces de red en diferentes espacios de direcciones, y estoy <b>listo</b> para admitir que no estoy <b>listo</b> para usar las VLAN donde sea <b>necesario</b> .  En uso, hay dispositivos como TP-Link TL-R480T +: no se comportan perfectamente, en general con sus propios matices.  Result√≥ ser responsable de configurar esta parte en Linux gracias al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Equilibrio de IP</a> fuera del sitio de Ubuntu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">: combinamos varios canales de Internet en uno</a> .  Adem√°s, cada uno de los canales puede "caer" en cualquier momento, as√≠ como subir.  Si est√° interesado en un script que funciona en este momento (y vale la pena publicarlo por separado), escriba los comentarios. <br><br>  La soluci√≥n en cuesti√≥n no pretende ser √∫nica, pero quiero hacer una pregunta: "¬øPor qu√© la empresa se adapta a productos de terceros cuestionables con requisitos de hardware serios cuando puede considerar una alternativa?" <br><br>  Si en Rusia hay una lista de Roskomnadzor, en Ucrania, un ap√©ndice de la Decisi√≥n del Consejo de Seguridad Nacional (por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ), entonces los l√≠deres tampoco duermen en el suelo.  Por ejemplo, se nos dio una lista de sitios prohibidos, en opini√≥n de la gerencia que empeora la productividad laboral en el lugar de trabajo. <br><br>  Al comunicarse con colegas de otras empresas donde todos los sitios est√°n prohibidos de manera predeterminada y solo bajo solicitud con el permiso del jefe, puede acceder a un sitio espec√≠fico, sonriendo respetuosamente, pensando y "fumando un problema", qued√≥ claro que la vida sigue siendo buena y nosotros comenz√≥ su b√∫squeda <br><br>  Teniendo la oportunidad no solo de ver anal√≠ticamente lo que escriben los ‚Äúlibros de amas de casa‚Äù sobre el filtrado de tr√°fico, sino tambi√©n de ver qu√© sucede en los canales de diferentes proveedores, notamos las siguientes recetas (cualquier captura de pantalla es un poco corta, por favor comprenda y perdone): <br><div class="scrollable-table"><table><tbody><tr><td>  Proveedor 1 </td><td>  - No molesta e impone su propio servidor DNS y servidor proxy transparente.  ¬øBueno? ... pero tenemos acceso a donde lo necesitamos (si lo necesitamos :)) </td></tr><tr><td>  Proveedor 2 </td><td>  - √âl cree que su proveedor principal deber√≠a pensarlo, el soporte t√©cnico del proveedor principal incluso admiti√≥ por qu√© no puedo abrir el sitio no prohibido necesario para m√≠.  Creo que la foto te divertir√° :) <br><br><img src="https://habrastorage.org/webt/vm/qh/v2/vmqhv2z15q8rx7wo2hqmd62zlma.png"><br><br>  Result√≥ que traducen los nombres de los sitios prohibidos en direcciones IP y bloquean la IP (no les molesta que 20 sitios puedan alojarse en esta direcci√≥n IP). <br></td></tr><tr><td>  Proveedor 3 </td><td>  - pasa el tr√°fico all√≠, pero no lo permite volver a lo largo de la ruta. </td></tr><tr><td>  Proveedor 4 </td><td>  - proh√≠be todas las manipulaciones con paquetes en la direcci√≥n especificada. </td></tr></tbody></table></div>  ¬øY qu√© hacer con VPN (respecto del navegador Opera) y los complementos del navegador?  Primero, jugando con el centro Mikrotik, incluso obtuvimos una receta de uso intensivo de recursos para L7, que luego tuvimos que abandonar (puede haber nombres m√°s prohibidos, se vuelve triste cuando, adem√°s de sus tareas directas en rutas, en docenas de expresiones, el procesador PPC460GT llega a 100 %) <br><br><img src="https://habrastorage.org/webt/mh/aa/5y/mhaa5y8mjctihnqzfcauqq8ctgc.png">  . <br><br>  Lo que qued√≥ claro: <br>  CSN en 127.0.0.1 no es en absoluto una panacea, las versiones modernas de los navegadores a√∫n le permiten evitar tales problemas.  Es imposible limitar a todos los usuarios con derechos reducidos, y uno no debe olvidarse de la gran cantidad de DNS alternativos.  Internet no es est√°tico y, adem√°s de las nuevas direcciones DNS, los sitios prohibidos compran nuevas direcciones, cambian los dominios de nivel superior y pueden agregar / eliminar caracteres en sus direcciones.  Pero a√∫n as√≠, tiene el derecho de vivir algo as√≠ (subjetivamente: en tal protecci√≥n veo c√≥mo el navegador, con p√©rdida, todav√≠a est√° esperando una respuesta, y la p√°gina que contiene elementos de contenido prohibido tarda mucho en cargar): <br><br><pre><code class="bash hljs">ip route add blackhole 1.2.3.4</code> </pre> <br>  Obtener una lista de direcciones IP de la lista de sitios prohibidos ser√≠a bastante efectivo, pero por las razones anteriores, pasamos a consideraciones de Iptables.  Ya hab√≠a un balanceador en vivo en CentOS Linux versi√≥n 7.5.1804. <br><br>  La Internet del usuario debe ser r√°pida y el navegador no debe esperar medio minuto, concluyendo que esta p√°gina no est√° disponible.  Despu√©s de una larga b√∫squeda de diferentes opciones de bloqueo, llegamos a este modelo: <br>  Archivo 1 -&gt; <b>/ script / deny_host</b> , lista de nombres prohibidos: <br><br><pre> <code class="plaintext hljs">test.test blablabla.bubu torrent porno</code> </pre> <br>  Archivo 2 -&gt; <b>/ script / deny_range</b> , una lista de direcciones y espacios de direcciones prohibidos: <br><br><pre> <code class="plaintext hljs">192.168.111.0/24 241.242.0.0/16</code> </pre> <br>  Archivo de script 3 -&gt; <b>ipt.sh</b> , que funciona con ipables: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#       HOSTS=`cat /script/denied_host | grep -v '^#'` RANGE=`cat /script/denied_range | grep -v '^#'` echo "Stopping firewall and allowing everyone..." #    iptables,      sudo iptables -F sudo iptables -X sudo iptables -t nat -F sudo iptables -t nat -X sudo iptables -t mangle -F sudo iptables -t mangle -X sudo iptables -P INPUT ACCEPT sudo iptables -P FORWARD ACCEPT sudo iptables -P OUTPUT ACCEPT #     (  ) sudo sh rout.sh #          for i in $HOSTS; do sudo iptables -I FORWARD -m string --string $i --algo bm --from 1 --to 600 -p tcp -j REJECT --reject-with tcp-reset; sudo iptables -I FORWARD -m string --string $i --algo bm --from 1 --to 600 -p udp -j DROP; done #          for i in $RANGE; do sudo iptables -I FORWARD -p UDP -d $i -j DROP; sudo iptables -I FORWARD -p TCP -d $i -j REJECT --reject-with tcp-reset; done</span></span></code> </pre><br>  El uso de sudo se debe al hecho de que tenemos que controlar un peque√±o truco a trav√©s de la interfaz WEB, pero como lo demuestra la experiencia con el uso de dicho modelo durante m√°s de un a√±o, WEB no es tan necesario.  Despu√©s de la implementaci√≥n, hubo un deseo de hacer una lista de sitios en la base de datos, etc.  El n√∫mero de hosts bloqueados es m√°s de 250 + una docena de espacios de direcciones.  De hecho, hay un problema al cambiar al sitio a trav√©s de una conexi√≥n https, como el administrador del sistema, tengo quejas sobre los navegadores :), pero estos son casos especiales, la mayor√≠a de las respuestas a la falta de acceso al recurso todav√≠a est√°n de nuestro lado, tambi√©n bloqueamos con √©xito Opera VPN, complementos como friGate y telemetr√≠a de Microsoft. <br><br><img src="https://habrastorage.org/webt/mm/_t/jy/mm_tjyvq1tpwumvwb3pezgfmixe.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/471402/">https://habr.com/ru/post/471402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../471380/index.html">Pentesters a la vanguardia de la ciberseguridad</a></li>
<li><a href="../471384/index.html">Liga de Internet gratis</a></li>
<li><a href="../471388/index.html">Algunas caracter√≠sticas del desarrollo de habilidades para Alice</a></li>
<li><a href="../471394/index.html">Habr Weekly # 22 / C√≥mo comunicarse en un equipo, nuevos impuestos para mega-corporaciones, TON en los dedos, Amazon copia productos</a></li>
<li><a href="../471396/index.html">C√≥mo CSS Grid cambia la estructuraci√≥n de contenido</a></li>
<li><a href="../471404/index.html">¬øEs posible ganar m√°s trabajando como ingeniero en otro pa√≠s?</a></li>
<li><a href="../471408/index.html">Una alternativa a los inversores de fase de zumbido: l√≠neas de transmisi√≥n (TQWT, ALT)</a></li>
<li><a href="../471412/index.html">Una publicaci√≥n sobre un mont√≥n de basura en el escritorio</a></li>
<li><a href="../471414/index.html">Sistema l√≠der de mesa de ayuda. ¬øC√≥mo obtenemos requisitos y desarrollamos un servicio en la nube?</a></li>
<li><a href="../471418/index.html">¬øQu√© puede ense√±ar el mercado de realidad virtual a un dise√±ador de juegos?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>