<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐜 ⁉️ 🧣 Comment nous avons conçu et mis en œuvre le nouveau réseau sur Huawei dans le bureau de Moscou, partie 2 👨‍👨‍👦 🗾 👩🏻‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la série précédente: Jet est passé à un nouveau réseau basé sur le célèbre fournisseur. Comment s'est déroulé le processus d'audit des systèmes, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons conçu et mis en œuvre le nouveau réseau sur Huawei dans le bureau de Moscou, partie 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jetinfosystems/blog/459118/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ep/l9/eo/epl9eo1kpw7j0_9u4wpibn2fsqa.jpeg"></a> <br><br>  Dans la série précédente: Jet est passé à un nouveau réseau basé sur le célèbre fournisseur.  Comment s'est déroulé le processus d'audit des systèmes, de collecte de la «liste de souhaits» et d'apprivoisement de la «réserve mutante», dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">première partie</a> . <br><br>  Cette fois, je vais parler du processus de migration des utilisateurs (plus de 1600 personnes) de l'ancien réseau vers le nouveau.  J'invite toutes les personnes intéressées par cat. <br><a name="habracut"></a><br>  Ainsi, le réseau existant de l'entreprise depuis l'été dernier: <br><br><ul><li>  la topologie la plus simple de «réseau fédéré effondré» est le cœur de réseau (le même niveau de distribution) formé de deux commutateurs de niveau réseau combinés en un cluster VSS; </li><li>  le niveau d'accès est représenté par des commutateurs et des piles de commutateurs de niveau de canal installés dans la croix, et parfois directement dans les couloirs et même dans les ateliers; </li><li>  certains des commutateurs d'accès sont inclus dans la chaîne, c'est-à-dire que le commutateur est inclus dans un autre commutateur, et le dernier est déjà dans le noyau; </li><li>  la tolérance aux pannes de la connexion des commutateurs d'accès au cœur est fournie principalement par le biais du LACP, parfois elle n'est pas du tout fournie; </li><li>  contrôle d'accès - via VLAN, routage VLAN - au cœur; </li><li>  des commutateurs d'accès de trois fabricants et quatre générations sont utilisés, les utilisateurs sont connectés à des vitesses allant de 100 Mbit / s à 1 Gbit / s; </li><li> certains utilisateurs utilisent encore des téléphones analogiques, certains utilisent des téléphones IP connectés via des injecteurs PoE et une minorité utilise des téléphones IP alimentés par PoE à partir de commutateurs d'accès. </li></ul><br>  Défi: <br><br><ul><li>  amener le réseau sous une forme décente; </li><li>  ne pas perturber le travail des employés lors de la modernisation; </li><li>  fixer le nombre maximum de problèmes qui se sont accumulés au cours des 15 dernières années de fonctionnement. </li></ul><br><h2>  Vieille vie </h2><br>  Auparavant, le système d'exploitation et d'extension du réseau dans le bureau était le suivant: supposons que nous devions organiser les emplois des nouveaux employés.  Des locaux supplémentaires ont été loués dans le centre d'affaires, des réparations ont été effectuées, SCS a été posé, puis un réseau informatique et téléphonique a été déployé. <br><br>  Un poste de travail représentait, de 2 à 4 prises RJ-45, selon les besoins de l'unité.  L'une des prises a été attribuée par téléphone (a reçu une marque verte), les autres (de une à trois) ont été attribuées par ordinateur (a reçu une marque bleue). <br><br><img src="https://habrastorage.org/webt/v0/zv/in/v0zvin26ha7a5gtzwjspbi2wtpo.jpeg"><br>  <i>Prises dans un lieu de travail typique</i> <br><br>  Chaque prise d'ordinateur au stade de la construction du réseau était connectée à un port séparé du commutateur d'accès, chaque prise téléphonique - avec le port analogique du central téléphonique (dans les anciennes pièces) ou avec le port du commutateur d'accès préconfiguré pour le transfert de données VoIP (dans les nouvelles pièces). <br><br>  Un tel schéma était pratique pour l'opération de service.  Les utilisateurs ont déménagé dans une nouvelle pièce, connecté l'ordinateur à n'importe quelle prise d'ordinateur disponible et le téléphone à n'importe quelle prise téléphonique disponible. <br><br>  Après cela, le personnel du support technique, en se concentrant sur les adresses MAC de l'équipement connecté, a prescrit les VLAN nécessaires et d'autres paramètres sur les ports des commutateurs d'accès. <br><br>  Mais l'approche avait son inconvénient - elle n'était pas économique, jusqu'à la moitié des ports restaient inutilisés.  Une telle réserve est utile si, au fil du temps, des postes de travail supplémentaires sont organisés dans la salle, mais nous n'avons pas réussi à utiliser la réserve de 50% à la fin. <br><br><h2>  Préparation à la migration </h2><br>  À la première étape, nous avons décidé de remplacer tous les commutateurs d'accès.  En standard, le modèle de la famille <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Huawei S5720 a</a> été choisi, en particulier le S5720-52X-PWR-SI-AC.  Ses caractéristiques: <br><br><ul><li>  se connecte au tronc à une vitesse de 10 Gbit / s; </li><li>  empilés sur des interfaces 10G conventionnelles; </li><li>  permet la connexion à tous les ports utilisateur à une vitesse de 1 Gbit / s; </li><li>  fournit une alimentation PoE sur tous les ports utilisateur. </li></ul><br>  Ainsi, il est autorisé de connecter un ordinateur, un téléphone IP, un ordinateur via n'importe quel port IP, des points d'accès sans fil, des caméras de surveillance vidéo et d'autres appareils à n'importe quel port. <br>  Nous avons dû trouver quelles prises dans les chambres sont réellement utilisées et ce qui y est connecté.  Nous avions: <br><br><ul><li>  les données des projets de pose de SCS anciens et peu anciens; </li><li>  Magazines de câblodistribution «pas tout à fait à jour» dans les locaux de l'entreprise; </li><li>  des tableaux d'adresses MAC sur les commutateurs d'accès existants que nous avons reçus à l'aide de l'équipement réseau intégré; </li><li>  tableaux de correspondance des adresses MAC des postes téléphoniques et des numéros internes d'abonnés - à partir du central téléphonique. </li></ul><br>  Ensuite, nous avons écrit un petit script qui, sur la base de ces données, a compilé des tables de commutation et de migration (une table distincte pour chaque prochaine étape de travail).  Ils contenaient les informations suivantes: <br><br><ul><li>  la chambre; </li><li>  marquage des ports sur le lieu de travail; </li><li>  marquer la sortie sur le panneau de brassage dans la croix; </li><li>  nom (nom d'hôte) de l'ancien commutateur (pile); </li><li>  numéro de port sur l'ancien commutateur; </li><li>  ID VLAN </li><li>  L'adresse MAC de l'appareil connecté (ou plusieurs); </li><li>  type d'appareil connecté (déterminé par l'adresse MAC); </li><li>  nom (nom d'hôte) du nouveau commutateur (pile); </li><li>  numéro de port sur le nouveau commutateur. </li></ul><br><img src="https://habrastorage.org/webt/nw/aw/6-/nwaw6-oll4db0lducpx63za8bae.png"><br>  <i>Résultats du script</i> <br><br>  À partir d'un tel tableau, il était immédiatement clair ce qui était connecté à un port spécifique - un ordinateur, un téléphone, un ordinateur via le téléphone (s'il y a deux adresses MAC), ou quelque chose de plus complexe. <br>  Sur la base des tableaux, les ingénieurs de conception ont développé de nouveaux journaux de câbles et les ingénieurs d'implémentation ont préconfiguré de nouveaux commutateurs qui, à l'étape suivante de la migration, ont été installés en croisement au lieu des anciens. <br><br><img src="https://habrastorage.org/webt/h3/fc/qc/h3fcqcnl0nlwi_02uhno0l_rkm8.png"><br>  <i>Fragment d'un nouveau magazine cross</i> <br><br><img src="https://habrastorage.org/webt/ei/8b/zk/ei8bzktczslzi3jmp4pcqxm2s8g.png"><br>  <i>Paramètres du port d'accès</i> <br><br>  Ainsi, le travail était le suivant: <br><br><ul><li>  désactiver les anciens commutateurs d'accès, retirer les cordons de brassage; </li><li>  installer de nouveaux commutateurs d'accès, connecter l'alimentation; </li><li>  effectuer la commutation entre magasins; </li><li>  faites le tour des salles de travail, assurez-vous que les téléphones et les ordinateurs fonctionnent correctement. </li></ul><br>  Cela semble simple, mais ... <br><br><h2>  La première étape est le remplacement des commutateurs d'accès: <s>trois mois de travail sans jours de repos</s> </h2><br>  Depuis la mi-2018, pendant trois mois chaque week-end, nous avons remplacé les commutateurs d'accès et effectué un changement de travail selon nos tables de migration (environ 3 500 ports au total). <br>  La première migration nous a pris plus de 12 heures, pendant ce temps, nous avons réussi à remplacer une pile d'accès de cinq commutateurs et à reconnecter environ 200 ports qui y sont connectés. <br>  La plupart du temps a été consacré à la préparation de cordons de brassage.  Chaque cordon de raccordement devait être libéré de l'emballage et collé avec des étiquettes numérotées des deux côtés.  Ce n'est qu'après cela que le cordon de raccordement peut être utilisé pour la commutation. <br><br>  Lors des prochaines migrations, nous avons optimisé le processus et préparé des cordons de brassage à l'avance.  Par conséquent, la dernière migration a pris les mêmes 12 heures, et pendant ce temps, nous avons réussi à remplacer cinq piles d'accès, de 3 à 5 commutateurs chacune, et à reconnecter plus de 1000 ports. <br><br>  Qu'avons-nous obtenu en conséquence? <br><br>  Tout d'abord, le magazine cross-country mis à jour, que nous avons partagé avec le service d'exploitation.  Le service a développé sa propre application Web pour prendre en charge l'état actuel de la commutation - elle peut désormais toujours être trouvée sur la ressource interne. <br><br>  Deuxièmement, les travaux liés aux nouveaux commutateurs d'accès modernes.  En parallèle, nous nous sommes finalement débarrassés des téléphones analogiques et des alimentations séparées pour les téléphones IP, des micrologiciels mis à jour et unifiés dans les téléphones IP afin que le téléphone et le commutateur se reconnaissent correctement en utilisant le protocole LLDP.  Ceci est nécessaire pour que le téléphone comprenne dans quel VLAN il doit transmettre des trames vocales et dans quelles - trames de l'équipement connecté via le téléphone.  Ainsi, le téléphone peut accéder aux serveurs du central téléphonique et les utilisateurs peuvent connecter des ordinateurs sur les postes de travail soit directement à la prise murale, soit via le téléphone. <br><br>  Troisièmement, nous avons désactivé tous les ports inutilisés de l'équipement actif et configuré la fonction de sécurité des ports.  Dans le même temps, nous avons formulé, approuvé et approuvé le règlement sur les connexions, maintenant il n'y a plus de connexions «au moment du paiement». <br><br>  Ainsi, nous: <br><br><ul><li>  rangé et documenté toutes les connexions de l'équipement de bureau; </li><li>  s'est débarrassé des vieux commutateurs, des injecteurs PoE, des téléphones analogiques; </li><li>  réduction de la consommation d'énergie des équipements (pour les locaux individuels de cross et de travail - jusqu'à 30%); </li><li>  augmenté l'expérience utilisateur et maintenu une réserve raisonnablement suffisante de ports d'équipement actifs (au prix d'une certaine augmentation de la charge de spécialistes du support technique, en particulier lors du déménagement des employés dans de nouveaux locaux). </li></ul><br><h2>  La migration bat son plein - passer à une nouvelle autoroute </h2><br>  Une fois la première étape terminée, la situation des connexions utilisateur est revenue à la normale, mais rien n'a changé avec la dorsale.  Comme mentionné ci-dessus, avant la modernisation, il a été organisé tout simplement.  Il y avait environ 100 VLAN qui étaient acheminés sur un commutateur central, ou plutôt sur deux commutateurs combinés en un cluster utilisant la technologie VSS. <br><br>  Parallèlement à la première étape de la migration, nous avons construit et testé une nouvelle autoroute conformément aux principes énoncés dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">premier article</a> : <br><br><ul><li>  Commutateurs de base Huawei CE8850 installés </li><li>  installé des commutateurs de distribution Huawei CE6870; </li><li>  FOCL supplémentaire pavé; </li><li>  terminé toutes les connexions; </li><li>  configuré les protocoles de routage de superposition et de sous-couche (mais jusqu'à ce que la première étape soit terminée, les commutateurs étaient inactifs et chauffaient l'air). </li></ul><br>  Ensuite, la prochaine étape de la migration a commencé.  Pas très long, mais le plus difficile. <br><br>  Pour commencer, nous avons développé et convenu un nouveau plan d'adressage IP qui prend en compte nos besoins actuels et futurs.  Le nouveau plan a identifié des gammes distinctes pour tous les L3VPN prévus - pour les utilisateurs ordinaires et les utilisateurs du centre technique, pour les systèmes de téléphonie, les systèmes de vidéoconférence, les caméras de vidéosurveillance, les stands de démonstration de divers types et d'autres besoins. <br><br>  Nous avons ensuite connecté l'ensemble de l'ancien réseau à une paire de commutateurs de distribution en une seule pile d'accès.  Après cela, nous avons commencé à basculer les piles vers le nouveau tronc en modifiant les numéros de VLAN et, en conséquence, en modifiant les adresses IP des utilisateurs connectés vers de nouvelles plages. <br><br>  Nous avons planifié les travaux de manière à commuter un groupe suffisamment large de commutateurs d'accès à la fois.  Ils travaillaient la nuit ou le week-end, selon les spécificités du travail des unités commutées. <br><br>  Avant de commencer les travaux, nous avons effectué à l'avance les opérations suivantes: <br><br><ol><li>  configurer un serveur DHCP d'entreprise afin qu'il fournisse des adresses IP de la nouvelle gamme pour les utilisateurs commutés; </li><li>  Configurer les ports sur les commutateurs de distribution, dans lesquels il était prévu d'inclure des commutateurs d'accès lors de la migration; </li><li>  À l'aide d'un autre script spécialement conçu, nous avons préparé des configurations modifiées pour les commutateurs commutables. </li></ol><br>  Ils ont travaillé dans l'ordre suivant: <br><br><ol><li>  l'accès commuté bascule de l'ancien tronc vers le nouveau; </li><li>  assurez-vous que les commutateurs sont accessibles sur l'interface de contrôle; </li><li>  la configuration préparée pour changer les numéros de VLAN a été versée sur les commutateurs commutés. </li></ol><br>  Avant d'effectuer les travaux ci-dessus, le VLAN contenant les interfaces de contrôle de tous les commutateurs d'accès était «étiré» entre l'ancien et le nouveau tronc, donc l'étape 2 prenait généralement un minimum de temps.  Dans le cas le plus simple, les postes de travail des utilisateurs (ainsi que les téléphones, imprimantes et autres périphériques) ont immédiatement reçu les adresses IP de la nouvelle gamme du serveur DHCP et ont continué à fonctionner sans modifications. <br><br><img src="https://habrastorage.org/webt/bo/nr/jz/bonrjz1h2qz30l0nrglsotacjbe.png"><br><br><h2>  Où est-ce sans problème? </h2><br>  Nous avons rencontré plusieurs difficultés en cours de route. <br>  Tout d'abord, les imprimantes ont cessé de fonctionner pour de nombreux utilisateurs.  Sur certains postes de travail d'utilisateurs, l'accès aux imprimantes a été configuré par une adresse IP spécifique.  Après avoir basculé les imprimantes vers une nouvelle gamme, elles ont reçu de nouvelles adresses et les utilisateurs n'y ont plus accès.  Pour résoudre le problème le lendemain de la migration, nous avons affecté un spécialiste du support pendant une demi-journée pour contourner les utilisateurs qui ont subi la migration et reconfigurer les imprimantes pour utiliser des noms DNS plutôt que des adresses IP. <br><br>  Lors de la migration du tout premier groupe d'utilisateurs, nous avons dû résoudre certains problèmes de configuration correcte des pare-feu afin de permettre aux utilisateurs d'accéder aux ressources d'entreprise nécessaires.  Et avec toutes les migrations ultérieures, nous savions déjà à l'avance ce qui doit être configuré. <br><br>  Enfin, nous avons relocalisé le centre de services, à savoir le personnel de quart de travail.  Le quart de travail doit fonctionner en continu et 24h / 24, avoir toujours accès aux ressources nécessaires au travail et aux systèmes d'information des clients.  Pour ces personnes, nous avons organisé des emplois temporaires à une heure convenue à l'avance et dans des chambres séparées.  Un employé en service se déplaçait dans cette salle, s'assurant qu'il pouvait avoir accès à tous les systèmes nécessaires.  Puis les autres ont emménagé dans cette pièce. <br><br>  Ensuite, nous avons procédé à la migration de l'unité correspondante, invité un des officiers de quart à retourner chez lui et vérifier la disponibilité de toutes les ressources nécessaires.  Problèmes résolus rapidement, le cas échéant.  Il y a eu peu de problèmes.  Après cela, le quart de travail est de nouveau passé du «refuge temporaire» au mode de travail habituel sur leur lieu de travail avec l'ensemble des systèmes d'information dont ils avaient besoin. <br><br>  À un moment donné, nous avons constaté qu'il ne restait plus un seul poste de travail utilisateur sur l'ancien réseau!  <s>Et ils ont ouvert le champagne.</s>  Ensuite, nous avons commencé la migration du segment de serveur.  Un autre schéma lui a déjà été appliqué, car le serveur ne peut généralement pas être arrêté, même pendant 15 minutes.  Je vais en discuter séparément dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">prochain article</a> . <br><br>  <i>Maxim Klochkov</i> <i><br></i>  <i>Consultant principal, Audit de réseau et projets intégrés</i> <i><br></i>  <i>Centre de solutions réseau</i> <i><br></i>  <i>Jet Infosystems</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459118/">https://habr.com/ru/post/fr459118/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459108/index.html">Tesla va présenter plusieurs surprises à la fois au second semestre de cette année</a></li>
<li><a href="../fr459110/index.html">Nous écrivons un bot de pêche dans le jeu Albion Online en Python</a></li>
<li><a href="../fr459112/index.html">Comprendre Google Chrome Convertir les fonctionnalités HTML en PDF</a></li>
<li><a href="../fr459114/index.html">14 meilleurs plugins WordPress SEO en 2019</a></li>
<li><a href="../fr459116/index.html">Un pas de plus vers la réparation du thymus</a></li>
<li><a href="../fr459120/index.html">Ordinateurs intégrés modulaires série UNO-1000/2000</a></li>
<li><a href="../fr459122/index.html">Aleksey Savvateev: Prix Nobel de Jean Tyrol pour l'analyse des marchés imparfaits (2014) et de la réputation collective</a></li>
<li><a href="../fr459126/index.html">Réservoir de robot Raspberry Pi avec Intel Neural Computer Stick 2</a></li>
<li><a href="../fr459128/index.html">Interfaces japonaises dans le monde réel</a></li>
<li><a href="../fr459130/index.html">Traitement des erreurs en douceur dans les microservices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>