<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüè´ üòê üå∑ Komponen eksternal untuk platform 1C Mobile (BroadcastReceiver) üå¨Ô∏è ü§òüèΩ ‚õëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Semua yang dikatakan dalam artikel ini akan menarik secara eksklusif untuk pengembang 1C. 

 Hari ini kita akan menganalisis komponen eksternal untuk ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Komponen eksternal untuk platform 1C Mobile (BroadcastReceiver)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479132/"> <b>Semua yang dikatakan dalam artikel ini akan menarik secara eksklusif untuk pengembang 1C.</b> <br><br>  Hari ini kita akan menganalisis komponen eksternal untuk "Aplikasi Seluler 1C".  Artikel ini muncul karena dua alasan.  Kami akan mengembangkan semuanya di bawah ATOL Smart.Lite yang sama <br><br><ol><li>  Mengembangkan <a href="https://habr.com/ru/post/473500/">aplikasi asli</a> ternyata jauh lebih rumit daripada yang saya pikirkan. </li><li>  Beberapa permintaan diterima secara khusus untuk komponen eksternal untuk 1C </li></ol><a name="habracut"></a><br>  Sebelum itu, saya sudah memiliki pengalaman menulis komponen eksternal <code>c++</code> .  Dan bahkan ada <a href="https://github.com/innovait-rus/NativeAPI" rel="nofollow">template</a> untuk platform x86.  Itu ditulis tanpa pemahaman <code>c++</code> .  Namun demikian, ia bekerja di dua proyek, dan tidak jatuh.  Kami melewati esensi masalah.  Perlu komponen asli untuk menerima pesan Siaran dalam 1C.  Kami akan pergi melalui Internet dan memahami bahwa ada solusi yang sudah jadi.  Tapi mereka semua ada di situs saya yang tidak terlalu favorit, untuk keserakahan yang berlebihan  Dan saya tidak mau membayar untuk kotak hitam.  Namun demikian, <a href="https://infostart.ru/public/987286/" rel="nofollow">artikel yang sangat bagus "Komponen eksternal dari platform seluler 1C untuk OS Android"</a> muncul di sana.  Ini menjelaskan cara mencetak versi komponen seluler, dan apa yang perlu dipasang.  Seperti yang saya pahami, <a href="https://github.com/ripreal/androidUtils1cExt" rel="nofollow">berikut</a> adalah kode sumber untuk artikel di atas.  Banyak terima kasih kepada pria yang baik hati atas usahanya.  Ini sangat membantu dengan contoh hidup untuk memahami apa dan bagaimana cara kerjanya.  Kemudian saya harus sedikit memperluas wawasan saya bagaimana cara kerja JNI.  Sederhana dan jelas di <a href="https://habr.com/ru/post/49660/">sini</a> dan di <a href="https://habr.com/ru/post/353294/">sini</a> .  Saya sarankan Anda membiasakan diri dengan mereka.  Saya yakin bahwa programmer nyata c + + tidak akan menyukai kode saya.  Saya meminta Anda untuk memanjakan dan menyodok apa yang bisa diperbaiki dan menulis lebih benar. <br><br>  Mari kita mulai.  Saya mengambil kode sumber dari repositori yang saya sebutkan sebelumnya, dan hampir sepenuhnya mengubahnya agar sesuai dengan kebutuhan saya.  Anda bisa membawanya ke <a href="https://github.com/innovait-rus/AtolSmartLiteUtils" rel="nofollow">sini</a> .  Mari kita bahas poin utama.  Prosedur utama bagi kami adalah <code>startEventsWatch</code> Di dalamnya, kami memeriksa bahwa kami tidak memiliki <code>BroadcastReceiver</code> terhubung dan mendefinisikan kembali fungsi <code>onReceive</code> Di sana kami melihat acara apa yang datang kepada kami, mengisi bidang, dan memanggil fungsi <code>OnBroadcastReceive</code> dan sekarang ini merupakan fungsi penghubung antara java dan C + + dan membawa kita dari dunia Android ke dunia 1C.  Lebih lanjut tentang ini nanti.  Garis yang disukai dari apa yang ingin kita dapatkan di 1C terlihat seperti ini. <br><br><pre> <code class="java hljs">filter.addAction(<span class="hljs-string"><span class="hljs-string">"com.xcheng.scanner.action.BARCODE_DECODING_BROADCAST"</span></span>); filter.addAction(NEW_KEY_UP);</code> </pre> <br>  Ini menjelaskan bahwa kami mengharapkan suatu peristiwa dari pemindai.  Dalam kasus saya, ini adalah <code>com.xcheng.scanner...</code>  Dalam kasus Anda, tergantung pada pemindai, akan ada garis lain.  Dengan demikian, data di dalam pesan juga akan berbeda.  Sebagai aturan, data ini dapat diperoleh dari pabrikan TSD.  Baik, atau lihat logcat.  Saya juga ingin menerima kode tombol tekan perangkat keras.  Namun masalah itu tidak terpecahkan di dahi.  Hanya menambahkan <code>onKeyUP</code> ke kode dan mengirimkannya ke <code>sendBroadcast</code> tidak berhasil.  Tidak mengherankan, Aktivitas kami tidak di latar depan.  Untuk alasan ini, saya harus dengan cepat membuang <a href="https://github.com/innovait-rus/KeyUPtoBroadcast" rel="nofollow"><code>AccessibilityService</code></a> <br><br><div class="spoiler">  <b class="spoiler_title">startEventsWatch</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startEventsWatch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Receiver==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { m_Receiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { String event, type, data; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (intent.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"com.xcheng.scanner.action.BARCODE_DECODING_BROADCAST"</span></span>: event = <span class="hljs-string"><span class="hljs-string">"NewBarcode"</span></span>; type = intent.getStringExtra(<span class="hljs-string"><span class="hljs-string">"EXTRA_BARCODE_DECODING_SYMBOLE"</span></span>); data = intent.getStringExtra(<span class="hljs-string"><span class="hljs-string">"EXTRA_BARCODE_DECODING_DATA"</span></span>); OnBroadcastReceive(m_V8Object, event, type, data); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NEW_KEY_UP: event = <span class="hljs-string"><span class="hljs-string">"NewKeyUP"</span></span>; type = <span class="hljs-string"><span class="hljs-string">"key"</span></span>; data = intent.getStringExtra(KEY_CODE); OnBroadcastReceive(m_V8Object, event, type, data); } } } }; IntentFilter filter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(); filter.addAction(<span class="hljs-string"><span class="hljs-string">"com.xcheng.scanner.action.BARCODE_DECODING_BROADCAST"</span></span>); filter.addAction(NEW_KEY_UP); m_Activity.registerReceiver(m_Receiver, filter); } }</code> </pre><br></div></div><br>  Sekarang kembali ke pengiriman data kami dalam 1C.  <code>OnBroadcastReceive</code> kami memanggil <code>extern "C" JNIEXPORT void JNICALL Java_org_innovait_atolsmartliteutils_MainApp_OnBroadcastReceive(JNIEnv* env, jclass jClass, jlong pObject, jstring j_event, jstring j_type, jstring j_data)</code> we work with <code>extern "C" JNIEXPORT void JNICALL Java_org_innovait_atolsmartliteutils_MainApp_OnBroadcastReceive(JNIEnv* env, jclass jClass, jlong pObject, jstring j_event, jstring j_type, jstring j_data)</code> .  <code>jstring j_event, jstring j_type, jstring j_data</code> Ini adalah variabel di mana saya lulus, acara, jenis <code>jstring j_event, jstring j_type, jstring j_data</code> itu sendiri.  Mungkin ada data lain. <br><br><div class="spoiler">  <b class="spoiler_title">Java_org_innovait_atolsmartliteutils_MainApp_OnBroadcastReceive</b> <div class="spoiler_text"><pre> <code class="java hljs">extern <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-function">JNIEXPORT </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> JNICALL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Java_org_innovait_atolsmartliteutils_MainApp_OnBroadcastReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JNIEnv* env, jclass jClass, jlong pObject, jstring j_event, jstring j_type, jstring j_data)</span></span></span><span class="hljs-function"> </span></span>{ IAddInDefBaseEx *pAddIn = (IAddInDefBaseEx *) pObject; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pAddIn != nullptr) { std::wstring ws_event =ToWStringJni(j_event); std::wstring ws_type = ToWStringJni(j_type); std::wstring ws_data = ToWStringJni(j_data); std::wstring obj_data{}; obj_data = L<span class="hljs-string"><span class="hljs-string">"{\"type\": \""</span></span> + ws_type + L<span class="hljs-string"><span class="hljs-string">"\", \"data\": \""</span></span> + ws_data + L<span class="hljs-string"><span class="hljs-string">"\"}"</span></span>; <span class="hljs-function"><span class="hljs-function">WcharWrapper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wdata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((wchar_t*)</span></span></span><span class="hljs-function">obj_data.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c_str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-function"><span class="hljs-function">WcharWrapper </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wmsg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((wchar_t*)</span></span></span><span class="hljs-function">ws_event.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c_str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">)</span></span>; pAddIn-&gt;ExternalEvent(s_EventSource, wmsg, wdata); } }</code> </pre> <br></div></div><br> <code>std::wstring ws_event =ToWStringJni(j_event);</code>  Dengan ini kita menerjemahkan string dari <code>jstring</code> ke <code>std::wstring</code> , dan kemudian kita kemas semuanya untuk 1C <code>WcharWrapper wmsg((wchar_t*)ws_event.c_str());</code> <br><br>  Terima kasih kepada orang pintar untuk fungsi konversi.  Fungsi kedua berasal dari kotak dalam contoh dari 1C. <br><br><div class="spoiler">  <b class="spoiler_title">Judul spoiler</b> <div class="spoiler_text"><pre> <code class="java hljs">std::<span class="hljs-function"><span class="hljs-function">wstring </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToWStringJni</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(jstring jstr)</span></span></span><span class="hljs-function"> </span></span>{ std::wstring ret; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (jstr) { JNIEnv* env = getJniEnv(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> jchar* jChars = env-&gt;GetStringChars(jstr, NULL); jsize jLen = env-&gt;GetStringLength(jstr); ret.assign(jChars, jChars + jLen); env-&gt;ReleaseStringChars(jstr, jChars); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br></div></div><br>  Bagi mereka yang tidak ingin menginstal semuanya dan kompilasi sendiri.  Ini adalah rilis yang sudah selesai. <br><br><ul><li>  <a href="https://github.com/innovait-rus/AtolSmartLiteUtils/releases" rel="nofollow">Atoll Smart.Lite Utils 1.0</a> </li><li>  <a href="https://github.com/innovait-rus/KeyUPtoBroadcast/releases" rel="nofollow">KeyUP ke Siaran 1.0</a> </li></ul><br>  Itu saja.  Menunggu komentar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id479132/">https://habr.com/ru/post/id479132/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id479120/index.html">Jumlah pemilih gagal: kami membawa AgentTesla ke air bersih. Bagian 2</a></li>
<li><a href="../id479122/index.html">Cara memulai proyek kesayangan dan tidak mendapat manfaat</a></li>
<li><a href="../id479124/index.html">[Infografis] Kecerdasan Buatan dalam Fiksi Ilmiah</a></li>
<li><a href="../id479126/index.html">Python dalam pengembangan Mobile</a></li>
<li><a href="../id479128/index.html">Bagaimana cara kerja layanan medis bandara</a></li>
<li><a href="../id479136/index.html">Komputasi kuantum: akhir dari blockchain?</a></li>
<li><a href="../id479140/index.html">Nikmati Flutter Interact Worldwide di kantor Ozon</a></li>
<li><a href="../id479142/index.html">Bagaimana cara mendapatkan elemen dari pohon biner dengan indeks dalam jumlah waktu yang wajar?</a></li>
<li><a href="../id479144/index.html">Apakah saya perlu mendaftarkan merek saya</a></li>
<li><a href="../id479146/index.html">Perbandingan alat pintas \ VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>