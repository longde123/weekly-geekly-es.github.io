<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèº ‚ÜñÔ∏è ü§û Mises √† jour int√©gr√©es √† l'application: acc√©l√©ration des mises √† jour des applications Android üêÖ üìñ üîÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Parmi la vari√©t√© d'outils annonc√©s lors d' Android Dev Summit , je voudrais porter une attention particuli√®re au m√©canisme de mise √† jour de l'applica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mises √† jour int√©gr√©es √† l'application: acc√©l√©ration des mises √† jour des applications Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/452092/"><img src="https://habrastorage.org/getpro/habr/post_images/3f4/39f/9a5/3f439f9a5f713ab2863a509a872b5aa8.png"><br><br>  Parmi la vari√©t√© d'outils annonc√©s lors d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Android Dev Summit</a> , je voudrais porter une attention particuli√®re au m√©canisme de mise √† jour de l'application In-App Updates (IAUs), qui aide les d√©veloppeurs √† acc√©l√©rer l'ajout de nouvelles fonctionnalit√©s, des corrections de bugs et des am√©liorations de performances.  √âtant donn√© que cette fonctionnalit√© a √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√©e</a> apr√®s Google I / O 2019, dans cet article, je vais parler en d√©tail des IAU, d√©crire les sch√©mas d'impl√©mentation recommand√©s et donner quelques exemples de code.  Je parlerai √©galement de notre exp√©rience d'int√©gration des UAI dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pandao</a> , une application de commande de marchandises en provenance de Chine. <br><a name="habracut"></a><br>  La nouvelle API permet aux d√©veloppeurs de lancer une mise √† jour de l'application vers la derni√®re version disponible sur Google Play.  De cette fa√ßon, les UAI compl√®tent le m√©canisme de mise √† jour automatique existant de Google Play.  Les UAI contiennent plusieurs sch√©mas d'impl√©mentation qui sont fondamentalement diff√©rents en termes d'interaction avec l'utilisateur. <br><br><ol><li>  <b>Flexible Flow</b> propose aux utilisateurs de t√©l√©charger la mise √† jour en arri√®re-plan et de l'installer √† un moment qui lui convient.  Il est destin√© aux cas o√π les utilisateurs peuvent toujours utiliser l'ancienne version, mais une nouvelle est d√©j√† disponible. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f8/067/c9f/1f8067c9ffa01e7a0a9b9a6631beabe3.png"><br></li><li>  <b>Immediate Flow</b> n√©cessite que les utilisateurs t√©l√©chargent et installent la mise √† jour avant de continuer √† utiliser l'application.  Il est destin√© aux cas o√π il est essentiel que les d√©veloppeurs mettent √† jour l'application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/026/409/ac2/026409ac2b2b1c7df62614ee1576ff64.png"><br></li></ol><br>  √âtant donn√© que la deuxi√®me option n'est pas si importante et moins adapt√©e √† l'application Pandao, nous analyserons le sc√©nario Flexible Flow plus en d√©tail. <br><br><h1>  Int√©gration flexible des flux de l'AIU </h1><br><h3>  Cas d'utilisation </h3><br>  Le processus de mise √† niveau √† l'aide d'IAU comprend plusieurs √©tapes. <br><br><ol><li>  Une application utilisant la biblioth√®que Play Core, qui v√©rifie sur Google Play si des mises √† jour sont disponibles. <br></li><li>  Si tel est le cas, l'application demande √† Google Play d'afficher la bo√Æte de dialogue des IAU.  Google Play affiche √† l'utilisateur une bo√Æte de dialogue avec une proposition de mise √† jour. <br></li><li>  Si l'utilisateur est d'accord, Google Play en arri√®re-plan t√©l√©charge la mise √† jour, montrant √† l'utilisateur dans la barre d'√©tat la progression du t√©l√©chargement. <br></li><li>  Si le t√©l√©chargement est termin√© lorsque l'application s'ex√©cute en arri√®re-plan, Google Play terminera automatiquement l'installation.  Si l'application est active √† ce moment, dans de tels cas, il est n√©cessaire de d√©terminer votre propre logique de fin d'installation.  Consid√©rez les sc√©narios suivants. <br><ol><li>  L'application d√©marre le processus d'installation en affichant √† l'utilisateur une bo√Æte de dialogue Google Play avec un indicateur de progression.  Une fois l'installation termin√©e, une version mise √† jour de l'application est lanc√©e.  Dans ce cas, il est recommand√© d'afficher une bo√Æte de dialogue suppl√©mentaire qui permet √† l'utilisateur de confirmer qu'il est pr√™t √† red√©marrer l'application maintenant.  <b>Il s'agit du sch√©ma d'impl√©mentation recommand√©</b> . <br></li><li>  L'application attend jusqu'√† ce qu'elle soit en arri√®re-plan, puis termine la mise √† jour.  D'une part, il s'agit d'un comportement moins intrusif du point de vue de l'UX, car l'interaction de l'utilisateur avec l'application n'est pas interrompue.  Mais d'un autre c√¥t√©, cela n√©cessite que le d√©veloppeur impl√©mente la logique pour d√©terminer si l'application est en arri√®re-plan. <br></li></ol></li></ol><br>  Si l'installation de la mise √† jour t√©l√©charg√©e n'est pas termin√©e, Google Play peut terminer l'installation en arri√®re-plan.  Cette option est pr√©f√©rable de ne pas utiliser explicitement, car elle ne garantit pas l'installation de la mise √† jour. <br><br><h3>  Exigences de test de base </h3><br>  Pour terminer manuellement l'ensemble du processus de mise √† jour sur un p√©riph√©rique de test, vous devez disposer d'au moins deux versions de l'application avec des num√©ros d'assembly diff√©rents: <b>source</b> et <b>cible</b> . <br><br><ul><li>  La version originale avec un num√©ro plus √©lev√© doit √™tre publi√©e sur Google Play, elle sera identifi√©e par Google Play comme une mise √† jour disponible.  La version cible avec un num√©ro de build inf√©rieur et des unit√©s IAU int√©gr√©es doit √™tre install√©e sur l'appareil, nous la mettrons √† jour.  L'essentiel est que lorsque l'application demande √† Google Play de rechercher une mise √† jour, elle compare les num√©ros d'assemblage de la version install√©e et disponible.  Les IAU ne seront donc lanc√©es que si le num√©ro de build sur Google Play est sup√©rieur √† la version actuelle de l'appareil. <br></li><li>  Les versions source et cible doivent avoir le <b>m√™me nom de package</b> et doivent √™tre sign√©es avec le <b>m√™me certificat de version</b> . <br></li><li>  Android 5.0 (API niveau 21) ou sup√©rieur. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jouez √† la</a> biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Core</a> 1.5.0 ou sup√©rieure. <br></li></ul><br><h3>  Exemple de code </h3><br>  Ici, nous examinons un exemple de code pour utiliser IAUs Flexible Flow, qui peut √©galement √™tre trouv√© dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle</a> .  Vous devez d'abord ajouter la biblioth√®que Play Core au fichier build.gradle au niveau du module. <br><br><pre><code class="plaintext hljs">dependencies { ... implementation "com.google.android.play:core:1.5.0" }</code> </pre> <br>  Cr√©ez ensuite une instance d' <code>AppUpdateManager</code> et ajoutez une fonction de rappel √† <code>AppUpdateInfo</code> , qui renverra des informations sur la disponibilit√© de la mise √† jour, l'objet pour d√©marrer la mise √† jour (si disponible) et la progression du t√©l√©chargement en cours, s'il a d√©j√† commenc√©. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Create instance of the IAUs manager. val appUpdateManager = AppUpdateManagerFactory.create(context) // Add state listener to app update info task. appUpdateManager.appUpdateInfo.addOnSuccessListener { appUpdateInfo -&gt; // If there is an update available, prepare to promote it. if (appUpdateInfo.updateAvailability() == UpdateAvailability.UPDATE_AVAILABLE) { // ... } // If the process of downloading is finished, start the completion flow. if (appUpdateInfo.installStatus() == InstallStatus.DOWNLOADED) { // ... } } .addOnFailureListener { e -&gt; // Handle the error. }</span></span></code> </pre> <br>  Pour afficher la bo√Æte de dialogue de demande de mise √† jour de Google Play, vous devez transmettre l'objet <code>AppUpdateInfo</code> re√ßu √† la m√©thode <code>AppUpdateInfo</code> . <br><br><pre> <code class="kotlin hljs"> appUpdateManager.startUpdateFlowForResult( <span class="hljs-comment"><span class="hljs-comment">// Pass the intent that is returned by 'getAppUpdateInfo()'. appUpdateInfo, // Or 'AppUpdateType.IMMEDIATE for immediate updates. AppUpdateType.FLEXIBLE, // The current activity. activity, REQUEST_CODE )</span></span></code> </pre> <br>  Pour surveiller l'√©tat de la mise √† jour, vous pouvez ajouter l'√©couteur d'√©v√©nements <code>InstallStateUpdatedListener</code> au gestionnaire IAUs. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Create a listener to track downloading state updates. val listener = InstallStateUpdatedListener { state -&gt; // Update progress indicator, request user to approve app reload, etc. } // At some point before starting an update, register a listener for updates. appUpdateManager.registerListener(listener) // ... // At some point when status updates are no longer needed, unregister the listener. appUpdateManager.unregisterListener(listener)</span></span></code> </pre> <br>  D√®s que la mise √† jour est t√©l√©charg√©e (√©tat <code>DOWNLOADED</code> ), vous devez red√©marrer l'application pour terminer la mise √† jour.  Le red√©marrage peut √™tre lanc√© en appelant <code>appUpdateManager.completeUpdate()</code> , mais avant cela, il est recommand√© d'afficher une bo√Æte de dialogue afin que l'utilisateur confirme explicitement qu'il est pr√™t √† red√©marrer l'application. <br><br><pre> <code class="kotlin hljs">Snackbar.make( rootView, <span class="hljs-string"><span class="hljs-string">"An update has just been downloaded from Google Play"</span></span>, Snackbar.LENGTH_INDEFINITE ).apply { setAction(<span class="hljs-string"><span class="hljs-string">"RELOAD"</span></span>) { appUpdateManager.completeUpdate() } show() }</code> </pre><br><h3>  Erreur "La mise √† jour n'est pas disponible" </h3><br>  Tout d'abord, rev√©rifiez la conformit√© aux exigences r√©pertori√©es dans la section Exigences de mise en ≈ìuvre de base.  Si vous avez tout fait, mais que la mise √† jour en fonction de l'appel <code>onSuccess</code> n'est toujours pas disponible, le probl√®me peut √™tre <code>onSuccess</code> √† la mise en cache.  Il est probable que l'application Google Play ne soit pas au courant de la mise √† jour disponible en raison du m√©canisme de mise en cache interne.  Pour √©viter cela lors des tests manuels, vous pouvez forcer une r√©initialisation du cache en acc√©dant √† la page "Mes applications et jeux" sur Google Play.  Ou vous pouvez simplement vider le cache dans les param√®tres de l'application Google Play.  Veuillez noter que ce probl√®me se produit uniquement pendant les tests, il ne devrait pas affecter les utilisateurs finaux, car leur cache est toujours mis √† jour quotidiennement. <br><br><h1>  Flux flexible de l'AIU dans l'application Pandao </h1><br>  Nous avons particip√© √† un programme d'acc√®s anticip√© et int√©gr√© l'UAI Flexible Flow (mise en ≈ìuvre recommand√©e) dans l'application Pandao, une plate-forme sur laquelle les fabricants et les vendeurs peuvent √©changer des produits chinois.  La bo√Æte de dialogue IAUs √©tait affich√©e sur l'√©cran principal afin que le nombre maximum d'utilisateurs puisse interagir avec elle.  Initialement, nous voulions montrer le dialogue pas plus d'une fois par jour, afin de ne pas distraire les gens d'interagir avec l'application. <br><br>  √âtant donn√© que les tests A / B jouent un r√¥le cl√© dans le cycle de vie de toute nouvelle fonctionnalit√©, nous avons d√©cid√© d'√©valuer l'effet des UAI dans notre application.  Nous avons divis√© au hasard les utilisateurs en deux groupes disjoints.  Le premier √©tait un contr√¥le, sans utiliser d'IAU, et le second √©tait un test, nous avons montr√© le dialogue des IAU √† ces utilisateurs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e6/281/d67/3e6281d67cb24f8f9018861697c62230.png"><br>  <i>Test Flexible Flow A / B de l'AIU dans l'application Pandao.</i> <br><br>  Au cours des derni√®res versions, nous avons mesur√© le pourcentage d'utilisateurs actifs de chaque version de l'application.  Il s'est av√©r√© que parmi les utilisateurs actifs disposant de la derni√®re version disponible √† l'√©poque, l'essentiel √©tait compos√© de participants du groupe B, c'est-√†-dire avec la fonction IAU.  La ligne violette dans le graphique montre que dans les premiers jours apr√®s la publication de la version 1.29.1, le nombre d'utilisateurs actifs avec des unit√©s AIU a d√©pass√© le nombre d'utilisateurs sans cette fonction.  Par cons√©quent, on peut affirmer que les utilisateurs dot√©s d'unit√©s IAU mettent √† jour l'application plus rapidement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/535/1cb/3a9/5351cb3a9b15cd49e59d543463cbb283.jpg"><br>  <i>La bo√Æte de dialogue Flexible Flow de l'AIU dans l'application Pandao.</i> <br><br>  Selon nos donn√©es (voir le graphique ci-dessus), les utilisateurs cliquent le plus souvent sur le bouton de confirmation dans la bo√Æte de dialogue IAUs dans les premiers jours apr√®s la sortie, puis la conversion est constamment r√©duite jusqu'√† la publication de la prochaine version de l'application.  La m√™me chose est observ√©e avec le bouton d'installation dans la bo√Æte de dialogue, qui lance l'installation de la mise √† jour t√©l√©charg√©e.  Par cons√©quent, nous pouvons dire que la valeur de conversion moyenne dans les deux cas est directement proportionnelle √† la fr√©quence des rejets.  √Ä Pandao, la conversion moyenne en un mois atteint 35% pour un clic sur le bouton de confirmation et 7% pour un clic sur le bouton d'installation. <br><br>  Nous supposons qu'une diminution du pourcentage de confirmations au fil du temps n'est qu'un probl√®me d'exp√©rience utilisateur, car les personnes int√©ress√©es par la nouvelle version se mettront √† jour assez rapidement, et celles qui ne sont pas int√©ress√©es par la mise √† jour ne seront pas int√©ress√©es.  Sur la base de cette hypoth√®se, nous avons d√©cid√© de ne pas d√©ranger ceux qui ne sont pas int√©ress√©s par la mise √† jour, et de ne pas leur demander tous les jours.  Il est recommand√© d'utiliser une logique de requ√™te diff√©rente, bas√©e sur ¬´l'obsolescence¬ª, c'est-√†-dire que, afin de ne pas d√©ranger les utilisateurs, nous √©valuons leur ancienne version et la fr√©quence √† laquelle nous avons d√©j√† sugg√©r√© de la mettre √† jour. <br><br>  En g√©n√©ral, les IAU ont montr√© de bons r√©sultats lors des tests A / B, nous avons donc d√©ploy√© les IAU pour tous les utilisateurs. <br><br><h1>  Remerciements </h1><br>  Merci de votre aide pour la r√©daction de cet article Marina Pleshkova <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Maryna_Pliashkova</a> , Alexander Cherny <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">alexchernyy</a> , Ilya Nazarov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">RolaRko</a> , Gleb Bodyachevsky, Daniil Polozov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">jokerdab</a> , Anastasia Kulik, Vladislav Breus et Vladislav Goldin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Vladiskus</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr452092/">https://habr.com/ru/post/fr452092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr452078/index.html">R√©servation Kubernetes: elle existe</a></li>
<li><a href="../fr452082/index.html">Flux flexible des mises √† jour int√©gr√©es: acc√©l√©rez le processus de mise √† jour des applications sur Android</a></li>
<li><a href="../fr452086/index.html">Ce qui est dans mon pixel pour vous: cr√©er des nanopixels en utilisant des m√©tasurfaces plasmon</a></li>
<li><a href="../fr452088/index.html">Reconnaissance routi√®re par segmentation s√©mantique</a></li>
<li><a href="../fr452090/index.html">Cr√©ation d'un g√©n√©rateur de puzzle proc√©dural</a></li>
<li><a href="../fr452094/index.html">.NET: outils pour travailler avec le multithreading et l'asynchronie. Partie 1</a></li>
<li><a href="../fr452098/index.html">Journaux du d√©veloppeur frontal Habr: refactor et reflex</a></li>
<li><a href="../fr452102/index.html">Jeu photo pour ceux qui aiment les drones: bref sur AirSelfie 2</a></li>
<li><a href="../fr452106/index.html">Nous invitons les conf√©renciers √† la r√©union de bricolage d'√©t√© du 16 juin 2019</a></li>
<li><a href="../fr452108/index.html">Docker: des conseils inoffensifs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>