<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèº üôà üõåüèº D√©veloppeur Cookbook: DDD Recipes (Part 4, Structures) üéµ üññüèª ü§≥üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 


 Nous avons donc d√©j√† d√©cid√© de la port√©e , de la m√©thodologie et de l' architecture . Passons de la th√©orie √† la pratique, pour √©crir...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppeur Cookbook: DDD Recipes (Part 4, Structures)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435920/"><h1 id="vvedenie">  Pr√©sentation </h1><br><p> Nous avons donc d√©j√† d√©cid√© de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la port√©e</a> , de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">m√©thodologie</a> et de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">architecture</a> .  Passons de la th√©orie √† la pratique, pour √©crire du code.  Je voudrais commencer par des mod√®les de conception qui d√©crivent la logique m√©tier - <em>Service</em> et <em>Interactor</em> .  Mais avant de les entreprendre, nous <em>allons</em> examiner les mod√®les structurels - <em>ValueObject</em> et <em>Entity</em> .  Nous d√©velopperons en langage <em>rubis</em> .  Dans d'autres articles, nous analyserons tous les mod√®les n√©cessaires au d√©veloppement √† l'aide de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">architecture variable</a> .  Tous les d√©veloppements qui sont des applications √† cette s√©rie d'articles seront rassembl√©s dans un cadre s√©par√©. </p><br><p><img src="https://habrastorage.org/webt/uc/iz/ea/ucizea6-xkpivfyv18q9fvds9wm.jpeg" alt="Blacjack et jarrets"></p><br><p>  Et nous avons d√©j√† choisi un nom appropri√© - <strong>LunaPark</strong> . <br>  D√©veloppements actuels <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">publi√©s sur Github</a> . <br>  Apr√®s avoir examin√© tous les mod√®les, nous assemblerons un microservice √† part enti√®re. </p><a name="habracut"></a><br><h1 id="tak-istoricheski-slozhilos">  Donc, historiquement </h1><br><p>  Il √©tait n√©cessaire de refactoriser une application d'entreprise complexe √©crite en Ruby on Rails.  Il y avait une √©quipe pr√™te √† l'emploi de d√©veloppeurs rubis.  La m√©thodologie de d√©veloppement pilot√© par domaine √©tait parfaite pour ces t√¢ches, mais il n'existait pas de solution cl√© en main dans la langue utilis√©e.  Malgr√© le fait que le choix de la langue √©tait principalement d√©termin√© par notre sp√©cialisation, il s'est av√©r√© √™tre un succ√®s.  Parmi toutes les langues couramment utilis√©es pour les applications Web, ruby ‚Äã‚Äãest, √† mon avis, la plus expressive.  Et donc, plus que d'autres adapt√©s √† la mod√©lisation d'objets r√©els.  Ce n'est pas seulement mon avis. </p><br><blockquote>  Voil√† le monde Java.  Ensuite, vous avez les nouveaux venus comme Ruby.  Ruby a une syntaxe tr√®s expressive, et √† ce niveau de base, il devrait √™tre un tr√®s bon langage pour DDD (m√™me si je n'ai pas encore entendu parler de son utilisation r√©elle dans ce genre d'applications).  Rails a g√©n√©r√© beaucoup d'enthousiasme car il semble finalement rendre la cr√©ation d'interfaces utilisateur Web aussi facile que les interfaces utilisateur l'√©taient au d√©but des ann√©es 1990, avant le Web.  √Ä l'heure actuelle, cette capacit√© a √©t√© principalement appliqu√©e √† la cr√©ation d'une partie du grand nombre d'applications Web qui n'ont pas beaucoup de richesse de domaine derri√®re elles, car m√™me celles-ci ont √©t√© douloureusement difficiles dans le pass√©.  Mais j'esp√®re que, √† mesure que la partie mise en ≈ìuvre de l'interface utilisateur du probl√®me sera r√©duite, les gens verront cela comme une opportunit√© de concentrer davantage leur attention sur le domaine.  Si l'utilisation de Ruby commence √† aller dans cette direction, je pense que cela pourrait fournir une excellente plate-forme pour DDD.  (Quelques √©l√©ments d'infrastructure devraient probablement √™tre remplis.) <br><br>  Eric Evans 2006 </blockquote><p>  Malheureusement, au cours des 13 derni√®res ann√©es, rien n'a beaucoup chang√©.  Sur Internet, vous pouvez trouver des tentatives d'adaptation de Rails pour cela, mais elles ont toutes l'air horribles.  Le framework Rails est lourd, lent et non SOLIDE.  Il est tr√®s difficile de voir sans larmes comment quelqu'un essaie de d√©crire l'impl√©mentation du mod√®le de <em>r√©f√©rentiel</em> sur la base d' <em>ActiveRecord</em> .  Nous avons d√©cid√© d'adopter un microframework et de l'adapter √† nos besoins.  Nous avons essay√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Grape</a> , l'id√©e de l'auto-documentation semblait r√©ussie, mais sinon, elle a √©t√© abandonn√©e et nous avons rapidement abandonn√© l'id√©e de l'utiliser.  Et presque imm√©diatement, ils ont commenc√© √† utiliser une autre solution - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sinatra</a> .  Nous continuons √† l'utiliser pour les <em>contr√¥leurs</em> et les <em>points de terminaison</em> REST. </p><br><div class="spoiler">  <b class="spoiler_title">REPOS?</b> <div class="spoiler_text"><p>  Si vous avez d√©velopp√© des applications Web, vous avez d√©j√† une id√©e de la technologie.  Il a ses avantages et ses inconv√©nients, dont la liste compl√®te d√©passe le cadre de cet article.  Mais pour nous, en tant que d√©veloppeurs d'applications d'entreprise, l'inconv√©nient le plus important sera que REST (cela ressort clairement du nom) ne refl√®te pas le processus, mais son √©tat.  Et l'avantage est sa compr√©hensibilit√© - la technologie est claire pour les d√©veloppeurs back-end et les d√©veloppeurs front-end. <br>  Mais alors ne vous concentrez peut-√™tre pas sur REST, mais impl√©mentez votre solution http + json?  M√™me si vous parvenez √† d√©velopper votre API de service, en fournissant sa description √† des tiers, vous recevrez de nombreuses questions.  Bien plus que si vous fournissez le REST familier. <br>  Nous envisagerons d'utiliser REST une solution de compromis.  Nous utilisons JSON pour la concision et la norme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">jsonapi</a> afin de ne pas perdre de temps aux d√©veloppeurs sur les guerres sacr√©es concernant le format de la requ√™te. <br>  √Ä l'avenir, lorsque nous analyserons <em>Endpoint</em> , nous verrons que pour se d√©barrasser du repos, il suffit de r√©√©crire une seule classe.  Donc, REST ne devrait pas d√©ranger du tout en cas de doute. </p></div></div><br><p>  Au cours de l'√©criture de plusieurs microservices, nous avons acquis des bases - un ensemble de classes abstraites.  Chacune de ces classes peut √™tre √©crite en une demi-heure, son code est facile √† comprendre si vous savez √† quoi sert ce code. </p><br><p>  Ici, les principales difficult√©s sont apparues.  Les nouveaux employ√©s qui ne s'occupaient pas des pratiques DDD et de l'architecture propre ne pouvaient pas comprendre le code et son objectif.  Si je voyais moi-m√™me ce code pour la premi√®re fois avant de lire Evans, je le consid√©rerais comme un h√©ritage, une ing√©nierie excessive. </p><br><p>  Afin de surmonter cet obstacle, il a √©t√© d√©cid√© de r√©diger une documentation (ligne directrice) d√©crivant la philosophie des approches utilis√©es.  Les grandes lignes de cette documentation semblaient r√©ussies et il a √©t√© d√©cid√© de les mettre sur Habr√©.  Des classes abstraites qui se r√©p√©taient de projet en projet, il a √©t√© d√©cid√© de mettre dans un bijou s√©par√©. </p><br><h1 id="filosofiya">  La philosophie </h1><br><p><img src="https://habrastorage.org/webt/eg/zm/c8/egzmc89jktbwuobb67mh-stoijc.png" alt="voie h√©rit√©e"><br>  Si vous vous souvenez d'un film classique sur les arts martiaux, alors il y aura un gars cool qui manipule tr√®s habilement un poteau.  Un sixi√®me est essentiellement un b√¢ton, un outil tr√®s primitif, l'un des premiers √† tomber entre les mains de l'homme.  Mais entre les mains du ma√Ætre, il devient une arme redoutable. <br>  Vous pouvez passer du temps √† cr√©er un pistolet qui ne vous tire pas dans la jambe, ou vous pouvez passer du temps √† apprendre la technique de tir.  Nous avons identifi√© 4 principes de base: </p><br><ul><li>  Vous devez simplifier des choses complexes. </li><li>  La connaissance est plus importante que la technologie.  La documentation est plus compr√©hensible pour une personne que le code; il ne faut pas remplacer les uns par les autres. </li><li>  Le pragmatisme est plus important que le dogmatisme.  Les normes devraient guider la voie, et non d√©finir un cadre de d√©limitation. </li><li>  Structuralit√© en architecture, flexibilit√© dans le choix des solutions. </li></ul><br><p>  Une philosophie similaire peut √™tre trac√©e, par exemple, dans le syst√®me d'exploitation ArchLinux - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">The Arch Way</a> .  Sur mon ordinateur portable, Linux n'a pas pris racine depuis longtemps, t√¥t ou tard il s'est cass√© et j'ai d√ª constamment le r√©installer.  Cela a caus√© un certain nombre de probl√®mes, parfois graves tels que la rupture des d√©lais de travail.  Mais apr√®s avoir pass√© 2-3 jours √† installer Arch, j'ai compris comment fonctionne mon syst√®me d'exploitation.  Apr√®s cela, elle a commenc√© √† travailler plus stable, sans √©checs.  Mes notes m'ont aid√© √† l'installer sur de nouveaux PC en quelques heures.  Une documentation abondante m'a aid√© √† r√©soudre de nouveaux probl√®mes. </p><br><p>  Le cadre a un caract√®re absolument de haut niveau.  Les classes qui le d√©crivent sont responsables de la structure de l'application.  Les solutions tierces sont utilis√©es pour interagir avec les bases de donn√©es, impl√©menter le protocole http et d'autres choses de bas niveau.  Nous aimerions que le programmeur examine le code et comprenne comment fonctionne une classe particuli√®re, et la documentation nous permettrait de comprendre comment les g√©rer.  Comprendre la conception du moteur ne vous permettra pas de conduire une voiture. </p><br><h1 id="freymvork">  Cadre </h1><br><p>  Il est difficile d'appeler LunaPark un framework au sens habituel.  Cadre - cadre, Travail - travail.  Nous exhortons √† ne pas nous limiter √† la port√©e.  Le seul cadre que nous d√©clarons est celui qui indique √† la classe dans laquelle telle ou telle logique doit √™tre d√©crite.  Il s'agit plut√¥t d'un ensemble d'outils avec des instructions d√©taill√©es pour eux. <br>  Chaque classe est abstraite et comporte trois niveaux: </p><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LunaPark</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#  module Forms #  class Single # / end end end</span></span></span></span></code> </pre> <br><p>  Si vous souhaitez impl√©menter un formulaire qui cr√©e un seul √©l√©ment, vous h√©ritez de cette classe: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forms</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Create</span></span></span><span class="hljs-class"> &lt; LunaPark::Forms::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Single</span></span></span></span></code> </pre> <br><p>  S'il y a plusieurs √©l√©ments, nous utiliserons une autre <em>impl√©mentation</em> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Forms</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Create</span></span></span><span class="hljs-class"> &lt; LunaPark::Forms::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Multiple</span></span></span></span></code> </pre> <br><p>  Pour le moment, tous les d√©veloppements n'ont pas √©t√© mis en parfait √©tat et la gemme est en √©tat alpha.  Nous le citerons par √©tapes, en fonction de la publication des articles.  C'est-√†-dire  si vous voyez un article sur <code>ValueObject</code> et <code>Entity</code> , ces deux mod√®les sont d√©j√† impl√©ment√©s.  √Ä la fin du cycle, tous seront adapt√©s √† une utilisation sur le projet.  √âtant donn√© que le cadre lui-m√™me est de peu d'utilit√© sans lien avec sinatra \ roda, un r√©f√©rentiel s√©par√© sera cr√©√© qui montrera comment ¬´tout visser¬ª pour d√©marrer rapidement votre projet. </p><br><p>  Le framework est avant tout une application √† la documentation.  Ne percevez pas ces articles comme une documentation pour le framework. </p><br><p>  Alors, passons aux choses s√©rieuses. </p><br><h1 id="obekt-znachenie-value">  Objet de valeur </h1><br><blockquote>  - Quelle est la taille de ta copine? <br>  - 151 <br>  - Vous avez commenc√© √† rencontrer la statue de la libert√©? </blockquote><p>  Quelque chose comme √ßa aurait pu arriver en Indiana.  La croissance humaine n'est pas seulement un nombre, mais aussi une unit√© de mesure.  Les attributs d'un objet ne peuvent pas toujours √™tre d√©crits uniquement par des primitives (entier, cha√Æne, bool√©en, etc.), parfois des combinaisons de ceux-ci sont requises: </p><br><ul><li>  L'argent n'est pas seulement un nombre, c'est un nombre (montant) + une devise. </li><li>  Une date se compose d'un jour, d'un mois et d'une ann√©e. </li><li>  Pour mesurer le poids, un seul chiffre ne nous suffit pas, il n√©cessite √©galement une unit√© de mesure. </li><li>  Le num√©ro de passeport se compose d'une s√©rie et, en fait, du num√©ro. </li></ul><br><p>  D'un autre c√¥t√©, ce n'est pas toujours une combinaison, c'est peut-√™tre une sorte d'extension du primitif. <br>  Un num√©ro de t√©l√©phone est souvent consid√©r√© comme un num√©ro.  En revanche, il est peu probable qu'il ait une m√©thode d'addition ou de division.  Il existe peut-√™tre une m√©thode qui √©mettra un code de pays et une m√©thode qui d√©finit un code de ville.  Il y aura peut-√™tre une certaine m√©thode d√©corative, qui la pr√©sentera non seulement comme une cha√Æne de chiffres <code>79001231212</code> , mais comme une cha√Æne lisible: <code>7-900-123-12-12</code> . </p><br><div class="spoiler">  <b class="spoiler_title">peut-√™tre un d√©corateur?</b> <div class="spoiler_text"><p>  Bas√© sur le dogme, il est incontestable - oui.  Si nous abordons ce dilemme de la part du bon sens, alors lorsque nous d√©ciderons d'appeler ce num√©ro, nous transf√©rerons l'objet lui-m√™me sur le t√©l√©phone: </p><br><pre> <code class="ruby hljs">phone.call Values::PhoneNumber.new(<span class="hljs-number"><span class="hljs-number">79001231212</span></span>)</code> </pre> <br><p>  Et si nous avons d√©cid√© de le pr√©senter sous forme de cha√Æne, cela est clairement fait pour une personne.  Alors pourquoi ne rendons-nous pas cette ligne imm√©diatement lisible pour une personne? </p><br><pre> <code class="ruby hljs">Values::PhoneNumber.new(<span class="hljs-number"><span class="hljs-number">79001231212</span></span>).to_s</code> </pre> </div></div><br><p>  Imaginez que nous cr√©ons le site de casino en ligne Three Axes et vendons des jeux de cartes.  Nous aurons besoin du cours de ¬´carte √† jouer¬ª. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayingCard</span></span></span><span class="hljs-class"> &lt; Lunapark::Values::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Compound</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">suit</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rank</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Ainsi, notre classe a deux attributs en lecture seule: </p><br><ul><li>  costume - costume de carte </li><li>  rang - dignit√© de la carte </li></ul><br><p>  Ces attributs sont d√©finis uniquement lors de la cr√©ation d'une carte et ne peuvent pas √™tre modifi√©s lors de son utilisation.  Bien s√ªr, vous pouvez prendre une carte √† jouer et barrer <s>8</s> , √©crire Q, mais cela est inacceptable.  Dans une soci√©t√© d√©cente, vous serez probablement abattu.  L'incapacit√© de modifier les attributs apr√®s la cr√©ation de l'objet d√©termine la premi√®re propri√©t√© de <em>l'objet valeur</em> - l'immuabilit√©. <br>  La deuxi√®me propri√©t√© importante de <em>l'objet valeur</em> sera la fa√ßon dont nous les comparerons. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RSpec</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">describe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayingCard</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">described_class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">suit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clubs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rank</span></span></span><span class="hljs-class">: 10 } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">let</span></span></span><span class="hljs-class">(:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">described_class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">suit</span></span></span><span class="hljs-class">: :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">clubs</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rank</span></span></span><span class="hljs-class">: 10 } </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">it</span></span></span><span class="hljs-class"> '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">should</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">be</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eql</span></span></span><span class="hljs-class">' </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">expect</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">card</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eq</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Un tel test √©chouera, car ils seront compar√©s √† l'adresse.  Pour que le test r√©ussisse, nous devons comparer <em>Value-Obects</em> par valeur, pour cela nous ajouterons une m√©thode de comparaison: </p><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">==</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(other)</span></span></span></span> suit == other.suit &amp;&amp; rank == other.rank <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><p>  Maintenant, notre test passera.  Nous pouvons √©galement ajouter des m√©thodes qui sont responsables de la comparaison, mais comment comparer 10 et K?  Comme vous l'avez probablement d√©j√† devin√©, nous les pr√©senterons √©galement sous forme <em>d'objets de valeur</em> .  Ok, alors maintenant nous devrons cr√©er les dix meilleurs clubs comme celui-ci: </p><br><pre> <code class="ruby hljs">ten = Values::Rank.new(<span class="hljs-string"><span class="hljs-string">'10'</span></span>) clubs = Values::Suits.new(<span class="hljs-symbol"><span class="hljs-symbol">:clubs</span></span>) ten_clubs = Values::PlayingCards.new(<span class="hljs-symbol"><span class="hljs-symbol">rank:</span></span> ten, <span class="hljs-symbol"><span class="hljs-symbol">clubs:</span></span> clubs)</code> </pre> <br><p>  Trois lignes suffisent pour le rubis.  Afin de contourner cette limitation, nous introduisons la troisi√®me propri√©t√© de la <em>valeur</em> de l' <em>objet</em> - chiffre d'affaires.  Ayons une m√©thode sp√©ciale de la classe <code>.wrap</code> , qui peut prendre des valeurs de diff√©rents types et les convertir en la bonne. </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlayingCard</span></span></span><span class="hljs-class"> &lt; Lunapark::Values::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Compound</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obj</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is_a?</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">self</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#      PlayingCard obj #      case obj.is_a? Hash #    ,      new(obj) #    case obj.is_a String #    ,     new rank: obj[0..-2], suit:[-1] # ,  -  . else #       raise ArgumentError #  . end end def initialize(suit:, rank:) #     </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@suit</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Suit.wrap(suit) #      </span></span><span class="hljs-doctag"><span class="hljs-class"><span class="hljs-comment"><span class="hljs-doctag">@rank</span></span></span></span><span class="hljs-class"><span class="hljs-comment"> = Rank.wrap(rank) end end</span></span></span></span></code> </pre> <br><p>  Cette approche donne un gros avantage: </p><br><pre> <code class="ruby hljs">ten = Values::Rank.new(<span class="hljs-string"><span class="hljs-string">'10'</span></span>) clubs = Values::Suits.new(<span class="hljs-symbol"><span class="hljs-symbol">:clubs</span></span>) from_values = Values::PlayingCard.wrap <span class="hljs-symbol"><span class="hljs-symbol">rank:</span></span> ten, <span class="hljs-symbol"><span class="hljs-symbol">suit:</span></span> clubs from_hash = Values::PlayingCard.wrap <span class="hljs-symbol"><span class="hljs-symbol">rank:</span></span> <span class="hljs-string"><span class="hljs-string">'10'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">suit:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:clubs</span></span> from_obj = Values::PlayingCard.wrap from_values from_str = Values::PlayingCard.wrap <span class="hljs-string"><span class="hljs-string">'10C'</span></span> <span class="hljs-comment"><span class="hljs-comment">#        utf ,  ,  .</span></span></code> </pre> <br><p>  Toutes ces cartes seront √©gales les unes aux autres.  Si la m√©thode <code>wrap</code> d√©veloppe en bonnes pratiques, la mettre dans une classe s√©par√©e le sera.  Du point de vue de l'approche dogmatique, une classe s√©par√©e sera √©galement obligatoire. <br>  Hmm, qu'en est-il de l'espace dans le pont?  Comment savoir si cette carte est un atout?  Ce n'est pas une carte √† jouer.  Il s'agit de la <em>valeur de la</em> carte √† jouer.  C'est exactement l'inscription 10 que vous menez sur le coin du carton. <br>  Il est n√©cessaire de se rapporter √† la <em>valeur de</em> l' <em>objet</em> ainsi qu'√† la primitive, qui pour une raison quelconque n'a pas √©t√© impl√©ment√©e dans ruby.  De l√† surgit la derni√®re propri√©t√© - <em>Object-Value n'est</em> li√© √† aucun domaine. </p><br><h2 id="rekomendacii">  Recommandations </h2><br><blockquote>  Parmi toute la vari√©t√© de m√©thodes et d'outils utilis√©s √† chaque instant de chaque processus, il y a toujours une m√©thode et un outil qui fonctionnent plus vite et mieux que les autres. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Frederick Taylor</a> 1914 </blockquote><br><h5 id="arifmeticheskie-operacii-dolzhny-vozvraschat-novyy-obekt">  Les op√©rations arithm√©tiques doivent renvoyer un nouvel objet </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># GOOD class Money &lt; LunaPark::Values::Compound def +(other) other = self.class.wrap(other) raise ArgumentError unless same_currency? other self.class.new( amount: amount + other.amount, currency: currency ) end end</span></span></code> </pre> <br><h5 id="atributy-_obekta-znacheniya_-mogu-byt-tolko-primitivami-ili-drugimi-_obektami-znacheniya_">  Les attributs <em>d'un objet de valeur</em> ne peuvent √™tre que des primitives ou d'autres <em>objets de valeur</em> </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># GOOD class Weight &lt; LunaPark::Values::Compound def intialize(value:, unit:) </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@value</span></span></span><span class="hljs-comment"> = value </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@unit</span></span></span><span class="hljs-comment"> = Unit.wrap(unit) end end # BAD class PlaingCard &lt; LunaPark::Value def initialize(rank:, suit:, deck:) ... </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@deck</span></span></span><span class="hljs-comment"> = Entity::Deck.wrap(deck) #    end end</span></span></code> </pre> <br><h5 id="prostye-operacii-derzhite-vnutri-metodov-klassa">  Conserver des op√©rations simples dans les m√©thodes de classe </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># GOOD class Weight &lt; LunaPark::Values::Compound def &gt;(other) value &gt; other.convert_to(unit).value end end</span></span></code> </pre> <br><h5 id="esli-operaciya-konvertaciya-bolshaya-to-vozmozhno-est-smysl-vynesti-ee-v-otdelnyy-klass">  Si l'op√©ration de "conversion" est importante, il est peut-√™tre judicieux de la d√©placer vers une classe distincte </h5><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># UGLY class Weight &lt; LunaPark::Values::Compound def convert_to(unit) unit = Unit.wrap(unit) case { self.unit.to_sym =&gt; unit.to_sym } when { :kg =&gt; :ft } Weight.new(value: 2.2046 * value, unit.to_sym) when # ... end end end # GOOD #./lib/values/weight/converter.rb class Weight class Converter &lt; LunaPark::Services::Simple def initialize(weight, to:) ... end end end #./lib/values/weight.rb class Weight &lt; LunaPark::Values::Compound def convert_to(unit) Converter.call! self, to: unit end end</span></span></code> </pre> <br><p>  Une telle suppression de logique dans un <em>service</em> s√©par√© <em>n'est</em> possible <strong>qu'√† la</strong> condition que le <em>service soit</em> isol√©: il n'utilise pas de donn√©es provenant de sources externes.  Ce service doit √™tre limit√© par le contexte de <em>l'objet valeur</em> lui-m√™me. </p><br><h5 id="obekt-znachenie-ne-mozhet-nichego-znat-o-domennoy-logike">  La valeur de l'objet ne peut rien savoir de la logique du domaine </h5><br><p>  Supposons que nous √©crivons une boutique en ligne et que nous ayons une √©valuation des marchandises.  Pour l'obtenir, vous devez faire une demande √† la base de donn√©es via le <em>r√©f√©rentiel</em> . </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># DEADLY BAD class Rate &lt; LunaPark::Values::Single def top?(10) Repository::Rates.top(first: 10).include? self end end</span></span></code> </pre> <br><h1 id="suschnost-entity">  Entit√© </h1><br><p>  La classe <em>Entity</em> est responsable d'un objet r√©el.  Cela peut √™tre un contrat, une chaise, un agent immobilier, une tarte, un fer √† repasser, un chat, un r√©frig√©rateur - n'importe quoi.  Tout objet dont vous pourriez avoir besoin pour mod√©liser vos processus m√©tier est une <em>entit√©</em> . <br>  Le concept d' <em>entit√© est</em> diff√©rent pour Evans et pour Martin.  Du point de vue d'Evans, une entit√© est un objet caract√©ris√© par quelque chose qui met l'accent sur son individualit√©. </p><br><div class="spoiler">  <b class="spoiler_title">Essence par Zvans</b> <div class="spoiler_text"><blockquote>  Si un objet est d√©termin√© par une existence individuelle unique, et non par un ensemble d'attributs, cette propri√©t√© doit √™tre lue comme la principale lors de la d√©finition d'un objet dans un mod√®le.  La d√©finition de la classe doit √™tre simple et construite autour de la continuit√© et de l'unicit√© du cycle de l'existence de l'objet.  Trouvez un moyen de distinguer chaque objet ind√©pendamment de sa forme ou de son histoire.  Portez une attention particuli√®re aux exigences techniques associ√©es √† la comparaison d'objets en fonction de leurs attributs.  D√©finissez une op√©ration qui donnerait n√©cessairement un r√©sultat unique pour chacun de ces objets - il peut √™tre n√©cessaire d'associer un certain symbole avec unicit√© garantie pour cela.  Un tel moyen d'identification peut avoir une origine externe, mais il peut √©galement s'agir d'un identifiant arbitraire g√©n√©r√© par le syst√®me pour sa propre commodit√©.  Cependant, un tel outil doit respecter les r√®gles de distinction entre les objets du mod√®le.  Le mod√®le doit donner une d√©finition exacte de ce que sont des objets identiques. </blockquote></div></div><br><p>  Du point de vue de Martin, l' <em>Entit√©</em> n'est pas un objet, mais un calque.  Cette couche combinera √† la fois l'objet et la logique m√©tier pour le modifier. </p><br><div class="spoiler">  <b class="spoiler_title">D√©solation de Martin</b> <div class="spoiler_text"><blockquote>  Mon point de vue sur les entit√©s est qu'elles contiennent des r√®gles commerciales ind√©pendantes des applications.  Ce ne sont pas simplement des objets de donn√©es.  Ils peuvent contenir des r√©f√©rences √† des objets de donn√©es;  mais leur objectif est d'impl√©menter des m√©thodes de r√®gles m√©tier qui peuvent √™tre utilis√©es par de nombreuses applications diff√©rentes. <br><br>  Les passerelles renvoient des entit√©s.  L'impl√©mentation (sous la ligne) r√©cup√®re les donn√©es de la base de donn√©es et l'utilise pour construire des structures de donn√©es qui sont ensuite transmises aux entit√©s.  Cela peut √™tre fait avec confinement ou h√©ritage. <br><br>  Par exemple: <br><br>  classe publique MyEntity {donn√©es MyDataStructure priv√©es;} <br><br>  ou <br><br>  classe publique MyEntity √©tend MyDataStructure {...} <br><br>  Et rappelez-vous, nous sommes tous des pirates par nature;  et les r√®gles dont je parle ici sont plus comme des directives ... </blockquote></div></div><br><p>  Par <em>essence,</em> nous entendons uniquement la structure.  Dans sa forme la plus simple, la classe <em>Entity</em> ressemblera √† ceci: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MeatBag</span></span></span><span class="hljs-class"> &lt; LunaPark::Entities::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simple</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hegiht</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Un objet modifiable qui d√©crit la structure d'un mod√®le d'entreprise peut contenir des types et des <em>valeurs</em> primitifs. <br>  La <code>LunaPark::Entites::Simple</code> est incroyablement simple, vous pouvez voir son code, elle ne nous donne qu'une chose - une initialisation facile. </p><br><div class="spoiler">  <b class="spoiler_title">LunaPark :: Entit√©s :: Simple</b> <div class="spoiler_text"><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LunaPark</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simple</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set_attributes</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">params</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">set_attributes</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">hash</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">each</span></span></span><span class="hljs-class"> { |</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">k</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v</span></span></span><span class="hljs-class">| </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">send</span></span></span><span class="hljs-class">(:"</span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#{k}=", v) } end end end end</span></span></span></span></code> </pre> </div></div><br><p>  Vous pouvez √©crire: </p><br><pre> <code class="ruby hljs">john_doe = Entity::MeatBag.new( <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">name:</span></span> <span class="hljs-string"><span class="hljs-string">'John Doe'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">height:</span></span> <span class="hljs-string"><span class="hljs-string">'180cm'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">weight:</span></span> <span class="hljs-string"><span class="hljs-string">'80kg'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">birthday:</span></span> <span class="hljs-string"><span class="hljs-string">'01-01-1970'</span></span> )</code> </pre> <br><p>  Comme vous l'avez probablement d√©j√† devin√©, nous voulons envelopper le poids, la taille et la date de naissance dans <em>Value Objects</em> . </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MeatBag</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Simple</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_reader</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">heiht</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wight</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Height</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Weight</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class">=(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">day</span></span></span><span class="hljs-class">) @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parse</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">day</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Afin de ne pas perdre de temps sur ces constructeurs, nous avons pr√©par√© une <em>impl√©mentation</em> plus complexe <em>de</em> <a href=""><code>LunaPark::Entites::Nested</code></a> : </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MeatBag</span></span></span><span class="hljs-class"> &lt; LunaPark::Entities::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">heiht</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Height</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">weight</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Weight</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">birthday</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Values::Date</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parse</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Comme son nom l'indique, cette <em>impl√©mentation</em> vous permet de cr√©er des arborescences. </p><br><p>  R√©pondons √† ma passion pour les appareils √©lectrom√©nagers encombrants.  Dans un article pr√©c√©dent, nous avons √©tabli une analogie entre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´torsion¬ª d'une machine √† laver et l'architecture</a> .  Et maintenant, nous allons d√©crire un objet commercial aussi important qu'un r√©frig√©rateur: </p><br><p><img src="https://habrastorage.org/webt/xl/65/pj/xl65pjsr5ou5a4nurhdm9qxbo50.png" alt="R√©frig√©rateur"></p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Refregerator</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">brand</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fridge</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">door</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upper</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lower</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upper</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lower</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">main</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">door</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">third</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">namespace</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">boxes</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">left</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">right</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Box</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">first</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">second</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">third</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fourth</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shelf</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">wrap</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">last_open_at</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comparable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  Cette approche nous √©vite de cr√©er des <em>entit√©s</em> inutiles, telles que la porte du r√©frig√©rateur.  Sans r√©frig√©rateur, il devrait faire partie du r√©frig√©rateur.  Cette approche est pratique pour compiler des documents relativement volumineux, par exemple, une demande d'achat d'assurance. </p><br><p>  La <code>LunaPark::Entites::Nested</code> poss√®de 2 propri√©t√©s plus importantes: </p><br><p>  Comparabilit√©: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u1</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites::User</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">john</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doe</span></span></span><span class="hljs-class">@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mail</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Time</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u2</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites::User</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">: '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">john</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doe</span></span></span><span class="hljs-class">@</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mail</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Time</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">now</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u1</span></span></span><span class="hljs-class"> == </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">u2</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; false</span></span></span></span></code> </pre> <br><p>  Les deux utilisateurs sp√©cifi√©s ne sont pas √©quivalents, car  ils ont √©t√© cr√©√©s √† des moments diff√©rents et par cons√©quent, la valeur de l'attribut <code>registred_at</code> sera diff√©rente.  Mais si nous barrons l'attribut de la liste des compar√©s: </p><br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entites</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; LunaPark::Entites::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Nested</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">registred_at</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">comparable</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">false</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br><p>  alors nous obtenons deux objets comparables. </p><br><p>  Cette <em>impl√©mentation a</em> √©galement la propri√©t√© du chiffre d'affaires - nous pouvons utiliser la m√©thode de classe </p><br><pre> <code class="ruby hljs">Entites::User.wrap(<span class="hljs-symbol"><span class="hljs-symbol">email:</span></span> <span class="hljs-string"><span class="hljs-string">'john.doe@mail.com'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">registred_at:</span></span> Time.now)</code> </pre> <br><p>  Vous pouvez utiliser Hash, OpenStruct ou n'importe quel joyau que vous aimez en tant qu'entit√©, ce qui vous aidera √† r√©aliser la structure de votre entit√©. </p><br><p>  <em>Une entit√©</em> est un mod√®le d'un objet m√©tier, laissez-le simple.  Si certains biens ne sont pas utilis√©s par votre entreprise, ne le d√©crivez pas. </p><br><h1 id="izmeneniya-suschnosti">  Changements d'entit√© </h1><br><p>  Comme vous l'avez remarqu√©, la classe <em>Entity</em> n'a aucune m√©thode de son propre changement.  Toutes les modifications sont effectu√©es de l'ext√©rieur.  <em>L'objet valeur est</em> √©galement immuable.  Toutes ces fonctions qui y sont pr√©sentes, dans l'ensemble, d√©corent l'essence ou cr√©ent de nouveaux objets.  L'essence elle-m√™me reste inchang√©e.  Pour un d√©veloppeur Ruby on Rails, cette approche sera inhabituelle.  De l'ext√©rieur, il peut sembler que nous utilisons g√©n√©ralement le langage OOP pour autre chose.  Mais si vous regardez un peu plus profond√©ment - ce n'est pas le cas.  Une fen√™tre peut-elle s'ouvrir d'elle-m√™me?  Obtenir une voiture pour travailler, r√©server un h√¥tel, un chat mignon, obtenir un nouvel abonn√©?  Ce sont toutes des influences externes.  Quelque chose se passe dans le monde r√©el, et nous refl√©tons cela en nous-m√™mes.  Pour chaque demande, nous modifions notre mod√®le.  Et ainsi nous le maintenons √† jour, suffisant pour nos t√¢ches commerciales.  Il est n√©cessaire de s√©parer l'√©tat du mod√®le et les processus qui provoquent des changements dans cet √©tat.  Comment faire cela, nous verrons dans le prochain article. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435920/">https://habr.com/ru/post/fr435920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435908/index.html">Web asc√©tique: prototypes de march√©s aux puces on go et js</a></li>
<li><a href="../fr435910/index.html">Pourquoi BSD a-t-il perdu la bataille avec GNU / Linux?</a></li>
<li><a href="../fr435912/index.html">Les principaux probl√®mes de d√©veloppement d'interfaces modernes</a></li>
<li><a href="../fr435914/index.html">Emballage d'applications ASP.NET Core √† l'aide de Docker</a></li>
<li><a href="../fr435916/index.html">Hacking VK, l'authentification √† deux facteurs ne sauvera pas</a></li>
<li><a href="../fr435922/index.html">Java, Spring, Kurento et services m√©dias. 2e partie</a></li>
<li><a href="../fr435924/index.html">Le r√©seau neuronal g√©n√®re des images de plats selon des recettes pour leur pr√©paration</a></li>
<li><a href="../fr435926/index.html">Un r√©seau de neurones recueille des fragments de d√©couvertes arch√©ologiques</a></li>
<li><a href="../fr435928/index.html">R√©frig√©rateur au lieu de Bruce Willis: la Terre frappe en premier</a></li>
<li><a href="../fr435930/index.html">L'origine de la thermoacoustique. La flamme chantante de Higgins. Tube de Rijke</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>