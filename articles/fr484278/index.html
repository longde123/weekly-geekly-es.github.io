<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíáüèæ üßóüèª ü§¥ Lampe √† commande gestuelle sur Arduino üíö üòí üö¥üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous !!! 
 Je suis heureux de pouvoir vous montrer √† nouveau mon nouveau m√©tier. 
 Cette fois, j'ai assembl√© une lampe Arduino √† commande ge...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Lampe √† commande gestuelle sur Arduino</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484278/"><img src="https://habrastorage.org/webt/d4/ag/wq/d4agwqmzn7bi_rgmhdau05bcc8c.jpeg" alt="image"><br><br>  Bonjour √† tous !!! <br>  Je suis heureux de pouvoir vous montrer √† nouveau mon nouveau m√©tier. <br>  Cette fois, j'ai assembl√© une lampe Arduino √† commande gestuelle. <br><br>  Ce projet m'a pris beaucoup de temps, ce qui me manque toujours. <br>  J'ai assembl√© la premi√®re version de la lampe tr√®s rapidement et cela a parfaitement fonctionn√© pour moi sur la planche √† pain, mais quand je l'ai d√©plac√©e √† un endroit permanent dans le bo√Ætier, tout a commenc√©, tous les probl√®mes de gel, de faux positifs et d'autres probl√®mes sont sortis.  Googler sur Internet, j'ai trouv√© sur des sites √©trangers de nombreuses plaintes li√©es aux probl√®mes du capteur APDS9960, mais je n'ai pas trouv√© de solutions √† ces probl√®mes.  J'ai d√ª passer un peu de temps √† √©tudier la fiche technique de ce capteur et √† comprendre son fonctionnement.  En fin de compte, cela a pay√© et j'ai pu √©crire du code fonctionnant de mani√®re stable. <br><br>  Et donc, tout est en ordre. <br><a name="habracut"></a><br><h4>  Description de la lampe </h4><br>  L'accent principal de cette lampe n'√©tait pas sur la visualisation, mais sur le contr√¥le gestuel, toutes les autres fonctions sont secondaires. <br><br>  La lampe s'allume avec des gestes √† gauche ou √† droite, et vous pouvez √©galement l'allumer avec un geste vers vous-m√™me, mais ce n'est pas tout √† fait pratique.  Ensuite, gestes gauche et droite, vous pouvez faire d√©filer les effets d'√©clairage.  Si vous commencez √† retourner vers la droite, la lampe changera d'abord ses couleurs du blanc au rouge, y compris toutes les couleurs primaires et les transitions entre elles. <br><br>  Si apr√®s avoir allum√© la lampe, nous commen√ßons √† retourner vers la gauche, nous verrons des effets d'√©clairage dynamiques, tels que ¬´Feu¬ª, ¬´Matrice¬ª, ¬´Lampe de lave¬ª, ¬´Arc-en-ciel¬ª, ¬´Confettis¬ª, ¬´√âtincelles¬ª, ¬´Lampe de feu¬ª.  Si vous devez revenir √† une lampe ordinaire, au lieu de la retourner, vous pouvez √©teindre la lampe avec un geste de vous-m√™me et allumer l'un des trois gestes. <br>  La d√©sactivation se fait par un geste de vous-m√™me. <br><br><img src="https://habrastorage.org/webt/zr/zi/4m/zrzi4maxu4cyqtt9qfh7hzgqu1q.gif"><br><br>  La luminosit√© est r√©gul√©e par le geste d'approcher et de s'√©loigner du capteur.  Vous devez d'abord amener votre paume le plus pr√®s possible du capteur, puis la relever brusquement.  La lampe passera en mode de r√©glage de la luminosit√©, en rapprochant de plus en plus la paume, vous devez trouver la luminosit√© appropri√©e et verrouiller votre main pendant quelques secondes afin que la valeur de luminosit√© soit pr√©serv√©e.  Lorsque la luminosit√© est maintenue, la lampe vous en informe en √©teignant doucement la lumi√®re, puis en l'allumant avec un nouveau niveau de luminosit√©. <br><br>  Je n'ai pas pr√™t√© beaucoup d'attention aux effets visuels, car j'ai l'intention de faire une deuxi√®me version de la lampe sur le mini contr√¥leur Wemos D1.  Dans lequel je pr√©vois de tout mettre √† l'id√©al.  Pour la m√™me raison, j'utilise toujours une seule ligne de LED, compos√©e de 4 bandes ws2812b, au lieu de quatre. <br><br><h4>  APDS9960 interruptions </h4><br>  En fait, les principaux probl√®mes de la lampe LED lui sont associ√©s.  Les interruptions dans apds9960 vivent leur propre vie, cela peut fonctionner √† partir de n'importe quoi, par exemple √† partir d'interf√©rences EM ou √† proximit√© du capteur d'une personne, d'une ondulation dans la nutrition, et peut-√™tre d'autre chose. <br><br><img src="https://habrastorage.org/webt/vn/iz/or/vnizoragveyxcjqiw3oq74y8dom.jpeg"><br><br>  J'ai d'abord essay√© de r√©soudre le probl√®me des modifications du mat√©riel.  Le filtrage de puissance n'a pas aid√©, m√™me avec une batterie 18650, le capteur a continu√© √† vivre sa vie.  J'ai essay√© de commuter la r√©sistance de charge du signal INT √† + 5V et cela n'a pas non plus r√©ussi. <br><br>  Au fur et √† mesure que l'√©tude est arriv√©e, on a compris pourquoi de fausses interruptions se sont produites.  Le probl√®me principal est la r√©flexion al√©atoire du signal IR.  Le fabricant recommande de recouvrir le capteur et tout ce qui l'entoure d'un rev√™tement en caoutchouc noir.  Je n'ai pas une telle peinture et je n'en ai pas pris la peine.  Bien s√ªr, cela pourrait r√©duire l√©g√®rement le nombre de faux positifs. <br><br>  J'ai √©crit du code qui filtre tous les d√©clencheurs al√©atoires, mais j'ai rencontr√© un autre probl√®me.  Une fois l'interruption d√©clench√©e, les informations sur les gestes sont transmises via le bus I2C pas imm√©diatement, mais avec un certain retard.  Et si l'alimentation √©lectrique due √† la bande d'adresse LED est bruyante, le temps de transmission, en tenant compte de ces interf√©rences, sera toujours diff√©rent.  J'ai d√ª tenir compte de ce fait et r√©√©crire le code pour d√©terminer les gestes d'une nouvelle mani√®re. <br><br><h4>  D√©finition du geste </h4><br>  Si le code n'utilise pas d'interruption du capteur, il n'y a pas de probl√®me avec la d√©finition du geste.  Mais dans ce cas, le multit√¢che est perdu.  Si un effet dynamique est activ√© sur la lampe, il n√©cessite en cons√©quence un code cyclique, constamment ex√©cutable, et des interruptions seront n√©cessaires pour retirer le contr√¥leur du cycle. <br><br>  Afin d'am√©liorer la stabilit√© de la reconnaissance gestuelle, il √©tait √©galement n√©cessaire de r√©duire la sensibilit√© du r√©cepteur dans la biblioth√®que.  Pour ce faire, remplacez la ligne dans le fichier SparkFun_APDS9960.h: <br><br>  <i>if (! setLEDBoost (LED_BOOST_300))</i> <br>  sur <br>  <i>if (! setLEDBoost (LED_BOOST_150))</i> <br><br>  Si vous avez t√©l√©charg√© la biblioth√®que de cet article, vous n'avez rien √† faire, tout y a d√©j√† √©t√© corrig√©. <br>  J'ai √©galement s√©lectionn√© exp√©rimentalement le courant de la LED 50 mA, dans lequel les gestes sont d√©termin√©s de la mani√®re la plus stable et il n'est pas n√©cessaire de forcer une LED infrarouge avec un courant de 100 mA. <br><br>  Et j'ai √©galement fait une erreur en pla√ßant le microcontr√¥leur au bas de la lampe et le capteur de gestes dans le capot sup√©rieur.  Pour cette raison, pour connecter Arduino et APDS9960, j'ai d√ª utiliser des fils de 30 cm de long, ce qui a √©galement ajout√© une instabilit√© suppl√©mentaire du capteur.  En cons√©quence, j'ai vaincu tous ces probl√®mes par programme. <br><br><h4>  Sch√©ma </h4><br><img src="https://habrastorage.org/webt/xe/uu/bi/xeuubilb8sr-rjoyuzi_swhliua.jpeg"><br><br>  Pour alimenter l'appareil, j'utilise un chargeur de mon smartphone, avec une tension de sortie de 5V et un courant de 2A.  Mais en fait, une lampe √† lumi√®re blanche allum√©e √† une luminosit√© maximale ne consomme pas plus de 1,3 A. Par cons√©quent, toute source d'alimentation avec un courant de sortie d'au moins 1,3 A convient. <br><br>  Le stabilisateur dc-dc mini360 peut √™tre remplac√© par tout autre convertisseur de tension abaisseur, avec un courant de sortie d'au moins 150 mA. <br><br>  Dans le sch√©ma ci-dessous, je n'utilise pas de convertisseur de niveau logique, mais c'est ma d√©cision personnelle.  Et par cons√©quent, je n'accepte aucune responsabilit√© √† l'avance en cas de d√©faillance du capteur APDS9960 connect√© sans convertisseur de niveau TTL. <br><br>  Au lieu d'Arduino Nano, vous pouvez utiliser le contr√¥leur Arduino UNO ou ses clones. <br><br>  Assurez-vous de v√©rifier la pr√©sence de cavaliers sur le capteur gestuel, ils sont marqu√©s en rouge sur la photo ci-dessous.  En cas d'absence, un fer √† souder doit √™tre appliqu√© sur ces voies de contact, appliquer et chauffer la soudure jusqu'√† formation d'une goutte uniforme.  Maintenant, les Chinois fournissent ces capteurs sans cavaliers.  Sans ces cavaliers, le fonctionnement du capteur n'est pas garanti. <br><br><img src="https://habrastorage.org/webt/kj/u0/dm/kju0dmvpbqiuuif-hetiy5hb0f8.jpeg"><br><br><h4>  Composants utilis√©s </h4><br>  Arduino Nano - 1 pcs. <br>  Capteur de geste APDS9960 - 1 pc. <br>  Bandes LED WS2812B - 4 pcs. <br>  Convertisseur abaisseur Mini360 - 1 pc. <br>  Fils de connexion - 1 jeu. <br><br><h4>  Code de programme pour Arduino </h4><br>  Le code est divis√© en deux parties.  Dans la premi√®re partie est le code principal qui fonctionne avec le capteur, et dans la deuxi√®me partie est le code pour tous les effets d'√©clairage. <br><br>  Vous pouvez ajouter n'importe quel effet vous-m√™me par analogie avec mon code, mais surtout, n'oubliez pas d'ajouter une fonction pour quitter le geste de l'effet en boucle.  Pour ce faire, ajoutez la ligne suivante √† la fin de la boucle <i>si (check_int ()) return;</i> <br><br>  Description des principales fonctions du programme <br>  processingGesture () traite les interruptions du capteur de mouvements. <br>  processingProximity () traite les interruptions du capteur de proximit√©. <br>  gesture_int () - interrompt le gestionnaire depuis le capteur de gestes. <br>  proximite_int () - interrompt le gestionnaire du capteur de proximit√©. <br><br><h4>  Description des constantes </h4><br>  APDS9960_INT - entr√©e pour une interruption externe.  Arduino Nano et UNO n'ont que deux entr√©es de ce type, 2 et 3. <br><br>  PIN - ici, vous devez sp√©cifier la sortie vers la bande LED.  Vous pouvez sp√©cifier n'importe quelle broche num√©rique √† laquelle les sangles ws2812b sont connect√©es. <br><br>  NUM_PIX - nous indiquons ici le nombre de LED d'adresse dans la bande utilis√©e. <br>  plage - la limite d'erreur est de 0 √† 10. Si, lors du r√©glage de la luminosit√©, une main est fix√©e au-dessus du capteur pendant 2 secondes, les lectures doivent √™tre enregistr√©es, mais si les lectures ne sont pas enregistr√©es, augmentez progressivement la limite d'erreur. <br><br>  <a href="" rel="nofollow">T√©l√©chargez la biblioth√®que APDS9960</a> <br>  <a href="" rel="nofollow">T√©l√©charger le croquis de la lampe</a> <br><br><h4>  Vid√©o montrant le fonctionnement de la lampe </h4><br><iframe width="560" height="315" src="https://www.youtube.com/embed/C4QELMzOpiA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h4>  R√©sum√© </h4><br>  La lampe en direct est meilleure que dans la vid√©o.  Maintenant, tous ceux qui l'ont vu de moi sont pri√©s de recueillir la m√™me chose pour eux.  Pour le moment, je n'aime pas le fonctionnement du r√©glage de la luminosit√©, mais j'y travaille.  Je ne le promets pas bient√¥t, mais la prochaine version de la lampe est d√©j√† en d√©veloppement. <br><br>  Merci d'avoir lu l'article jusqu'au bout!  Si vous avez encore des questions, vous pouvez les poser dans les commentaires sous l'article. <br><br><h4>  PS </h4><br>  Id√©e de lampe inspir√©e <a href="https://www.youtube.com/channel/UCOG6Bi2kvpDa1c8gHWZI5CQ/videos" rel="nofollow">ici</a> <br>  J'ai pris les effets principaux <a href="https://www.tweaking4all.com/hardware/arduino/adruino-led-strip-effects/" rel="nofollow">ici</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484278/">https://habr.com/ru/post/fr484278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484252/index.html">Antiquit√©s: 20 ans de technologie informatique dans les publications m√©diatiques</a></li>
<li><a href="../fr484254/index.html">Comment: infographie ou infographie?</a></li>
<li><a href="../fr484270/index.html">R√©solvons de l'argent</a></li>
<li><a href="../fr484274/index.html">Puce Qualcomm ADAS</a></li>
<li><a href="../fr484276/index.html">Num√©ro 29: Formation informatique - probl√®mes et d√©fis actuels des grandes entreprises</a></li>
<li><a href="../fr484282/index.html">Le myst√©rieux programme LyX. 3e partie</a></li>
<li><a href="../fr484284/index.html">[Par les quais] Flutter. Partie 3. Pour les d√©veloppeurs natifs de React</a></li>
<li><a href="../fr484288/index.html">Comment la confrontation de la guerre froide aide les Chinois √† d√©marrer la production informatique</a></li>
<li><a href="../fr484290/index.html">La feuille de triche qui est n√©cessaire sur le yacht</a></li>
<li><a href="../fr484292/index.html">Le plus grand physicien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>