<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèè üëù üë≤üèº A tarefa de N corpos ou como explodir uma gal√°xia sem sair da cozinha ü§∂ üç∂ üéå</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="N√£o faz muito tempo, li o romance de fic√ß√£o cient√≠fica "O Problema dos Tr√™s Corpos", de Liu Qixin . Nele, alguns alien√≠genas tinham um problema - eles...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A tarefa de N corpos ou como explodir uma gal√°xia sem sair da cozinha</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437014/"><br><img src="https://habrastorage.org/webt/ke/eo/en/keeoenv3rtuxqu19szhk5hzfb7q.png"><br><br>  N√£o faz muito tempo, li o romance de fic√ß√£o cient√≠fica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"O Problema dos Tr√™s Corpos", de Liu Qixin</a> .  Nele, alguns alien√≠genas tinham um problema - eles n√£o sabiam como, com precis√£o suficiente, calcular a trajet√≥ria de seu planeta natal.  Ao contr√°rio de n√≥s, eles viviam em um sistema de tr√™s estrelas, e o ‚Äúclima‚Äù no planeta dependia fortemente de sua localiza√ß√£o relativa - do calor incinerador ao frio g√©lido.  E decidi verificar se podemos resolver esses problemas. <br><a name="habracut"></a><br><h2>  F√≠sica do fen√¥meno </h2><br>  Para entender o problema, √© necess√°rio lidar com a f√≠sica do fen√¥meno.  No quadro da teoria cl√°ssica, a for√ßa atrativa de dois corpos √© determinada pela lei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de Newton</a> : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mtext" id="MJXp-Span-2">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c </font></font></span><span class="MJXp-mrow" id="MJXp-Span-6"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10"><font style="vertical-align: inherit;">v </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mrow" id="MJXp-Span-14" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;">r</font></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mn MJXp-script" id="MJXp-Span-16" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 1</font></span></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"> , </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;">v </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mrow" id="MJXp-Span-23" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24"><font style="vertical-align: inherit;">r</font></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 2</font></span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"> ) </font></span><span class="MJXp-mo" id="MJXp-Span-27" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;">= </font></span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;">- </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29"><font style="vertical-align: inherit;">G </font></span><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">m </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mn MJXp-script" id="MJXp-Span-32" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">1 </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">m </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">2</font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37"><font style="vertical-align: inherit;"> f </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38"><font style="vertical-align: inherit;">r </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39"><font style="vertical-align: inherit;">a </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40"><font style="vertical-align: inherit;">c </font></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mrow" id="MJXp-Span-47" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 1</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> - </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mrow" id="MJXp-Span-56" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mn MJXp-script" id="MJXp-Span-58" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 2 </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mrow" id="MJXp-Span-60"><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;">| </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mrow" id="MJXp-Span-67" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mn MJXp-script" id="MJXp-Span-69" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 1</font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"> - </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72"><font style="vertical-align: inherit;">v </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73"><font style="vertical-align: inherit;">e </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74"><font style="vertical-align: inherit;">c </font></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mrow" id="MJXp-Span-76" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77"><font style="vertical-align: inherit;">r</font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mn MJXp-script" id="MJXp-Span-78" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"> 2 </font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mrow" id="MJXp-Span-80" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;">| </font></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mn MJXp-script" id="MJXp-Span-82" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;">3</font></span></span></span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"> ,</font></span></font><span class="MJXp-mtext" id="MJXp-Span-9">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-13"><span class="MJXp-mrow" id="MJXp-Span-14" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-16" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-18">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-22"><span class="MJXp-mrow" id="MJXp-Span-23" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-27" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-28" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-30"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-32" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-35" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-36">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow" id="MJXp-Span-41"><span class="MJXp-mtext" id="MJXp-Span-42">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-46"><span class="MJXp-mrow" id="MJXp-Span-47" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-51">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mrow" id="MJXp-Span-56" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-58" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mrow" id="MJXp-Span-60"><span class="MJXp-mo" id="MJXp-Span-61" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mtext" id="MJXp-Span-62">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-66"><span class="MJXp-mrow" id="MJXp-Span-67" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-69" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mo" id="MJXp-Span-70" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mtext" id="MJXp-Span-71">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-75"><span class="MJXp-mrow" id="MJXp-Span-76" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-78" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-msubsup" id="MJXp-Span-79"><span class="MJXp-mrow" id="MJXp-Span-80" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-81" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"></font></span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-82" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="70.534ex" height="3.142ex" viewBox="0 -1039.5 30368.8 1352.7" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="1202" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-46" x="1635" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-28" x="2385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="3024" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="3510" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="3976" y="0"></use><g transform="translate(4410,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2C" x="5315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="6010" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="6496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="6962" y="0"></use><g transform="translate(7396,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-32" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-29" x="8301" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-3D" x="8968" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2212" x="10025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-47" x="10803" y="0"></use><g transform="translate(11590,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-31" x="1242" y="-213"></use></g><g transform="translate(12922,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-32" x="1242" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-66" x="14504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="15055" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-61" x="15506" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="16036" y="0"></use><g transform="translate(16469,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2212" x="2763" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="4013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="4499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="4965" y="0"></use><g transform="translate(5399,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-32" x="638" y="-213"></use></g></g><g transform="translate(22774,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-7C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="528" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="1014" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="1480" y="0"></use><g transform="translate(1914,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2212" x="3041" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="4292" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="4777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="5244" y="0"></use><g transform="translate(5677,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-32" x="638" y="-213"></use></g><g transform="translate(6583,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-7C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-33" x="393" y="675"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2C" x="30090" y="0"></use></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> \ vec {F} (\ vec {r} _1, \ vec {r} _2) = - G m_1 m_2 \ frac {\ vec {r} _1 - \ vec {r} _2} {| \ vec {r} _1 - \ vec {r} _2 | ^ 3}, </script></p><br><br>  onde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-84"><span class="MJXp-mtext" id="MJXp-Span-85">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">c</span><span class="MJXp-msubsup" id="MJXp-Span-89"><span class="MJXp-mrow" id="MJXp-Span-90" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91">r</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-92" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-94">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">c</span><span class="MJXp-msubsup" id="MJXp-Span-98"><span class="MJXp-mrow" id="MJXp-Span-99" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">r</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-101" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.837ex" height="1.817ex" viewBox="0 -520.7 5527 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="1202" y="0"></use><g transform="translate(1635,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-31" x="638" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2C" x="2540" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-76" x="3236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-65" x="3721" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-63" x="4188" y="0"></use><g transform="translate(4621,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-32" x="638" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-2"> \ vec {r} _1, \ vec {r} _2 </script>  - a posi√ß√£o dos corpos no espa√ßo, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-102"><span class="MJXp-msubsup" id="MJXp-Span-103"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-105" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-106" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-107"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108" style="margin-right: 0.05em;">m</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-109" style="vertical-align: -0.4em;">2</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.223ex" height="1.817ex" viewBox="0 -520.7 3110 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-31" x="1242" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-2C" x="1332" y="0"></use><g transform="translate(1777,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMAIN-32" x="1242" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> m_1, m_2 </script>  - massas de corpos, <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-110"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">G</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.827ex" height="2.057ex" viewBox="0 -780.1 786.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://habr.com/ru/post/437014/&amp;usg=ALkJrhiecEppE_NcpJOlUZjNTm84qxCaqw#MJMATHI-47" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> G </script>  - constante gravitacional. <br>  No sistema de <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> N </script>  Os corpos de cada um deles ser√£o afetados pela for√ßa de atra√ß√£o do resto, que √© expressa pela equa√ß√£o: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-114"><span class="MJXp-mtext" id="MJXp-Span-115">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">c</span><span class="MJXp-msubsup" id="MJXp-Span-119"><span class="MJXp-mrow" id="MJXp-Span-120" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">F</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-122" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">G</span><span class="MJXp-mtext" id="MJXp-Span-126">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">u</span><span class="MJXp-msubsup" id="MJXp-Span-129"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-130" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-131" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">k</span><span class="MJXp-mtext" id="MJXp-Span-133">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">n</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-140" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-msubsup" id="MJXp-Span-141"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-143" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-144">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-145">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">c</span><span class="MJXp-mrow" id="MJXp-Span-149"><span class="MJXp-mtext" id="MJXp-Span-150">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">c</span><span class="MJXp-msubsup" id="MJXp-Span-154"><span class="MJXp-mrow" id="MJXp-Span-155" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-157" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-158" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-159">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">c</span><span class="MJXp-msubsup" id="MJXp-Span-163"><span class="MJXp-mrow" id="MJXp-Span-164" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-166" style="vertical-align: -0.4em;">k</span></span></span><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-mrow" id="MJXp-Span-168"><span class="MJXp-mo" id="MJXp-Span-169" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-170">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">c</span><span class="MJXp-msubsup" id="MJXp-Span-174"><span class="MJXp-mrow" id="MJXp-Span-175" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-177" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-178" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-179">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">c</span><span class="MJXp-msubsup" id="MJXp-Span-183"><span class="MJXp-mrow" id="MJXp-Span-184" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-186" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-msubsup" id="MJXp-Span-187"><span class="MJXp-mrow" id="MJXp-Span-188" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-189" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-190" style="vertical-align: 0.5em;">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-191" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ vec {F} _n = -G \ sum_ {k \ neq n} m_n m_k \ frac {\ vec {r} _n - \ vec {r} _k} {| \ vec {r} _n - \ vec {r } _k | ^ 3}. </script></p><br><br>  Usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a segunda lei de Newton,</a> escrevemos a acelera√ß√£o para cada part√≠cula: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-192"><span class="MJXp-mtext" id="MJXp-Span-193">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">c</span><span class="MJXp-msubsup" id="MJXp-Span-197"><span class="MJXp-mrow" id="MJXp-Span-198" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">a</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-200" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-201" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-202">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">c</span><span class="MJXp-msubsup" id="MJXp-Span-206"><span class="MJXp-mrow" id="MJXp-Span-207" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">F</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-209" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mrow" id="MJXp-Span-210"><span class="MJXp-mo" id="MJXp-Span-211" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-msubsup" id="MJXp-Span-212"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-214" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-215" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-216" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">G</span><span class="MJXp-mtext" id="MJXp-Span-218">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">u</span><span class="MJXp-msubsup" id="MJXp-Span-221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-223" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">k</span><span class="MJXp-mtext" id="MJXp-Span-225">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-229">n</span></span></span><span class="MJXp-msubsup" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231" style="margin-right: 0.05em;">m</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-232" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-mtext" id="MJXp-Span-233">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">c</span><span class="MJXp-mrow" id="MJXp-Span-238"><span class="MJXp-mtext" id="MJXp-Span-239">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">c</span><span class="MJXp-msubsup" id="MJXp-Span-243"><span class="MJXp-mrow" id="MJXp-Span-244" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-245">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-246" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-247" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-248">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">c</span><span class="MJXp-msubsup" id="MJXp-Span-252"><span class="MJXp-mrow" id="MJXp-Span-253" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-255" style="vertical-align: -0.4em;">k</span></span></span><span class="MJXp-mrow" id="MJXp-Span-256"><span class="MJXp-mrow" id="MJXp-Span-257"><span class="MJXp-mo" id="MJXp-Span-258" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-259">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-261">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262">c</span><span class="MJXp-msubsup" id="MJXp-Span-263"><span class="MJXp-mrow" id="MJXp-Span-264" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-266" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-268">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-271">c</span><span class="MJXp-msubsup" id="MJXp-Span-272"><span class="MJXp-mrow" id="MJXp-Span-273" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-275" style="vertical-align: -0.4em;">k</span></span><span class="MJXp-msubsup" id="MJXp-Span-276"><span class="MJXp-mrow" id="MJXp-Span-277" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-278" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-279" style="vertical-align: 0.5em;">3</span></span></span><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \ vec {a} _n = \ vec {F} _n / m_n = -G \ sum_ {k \ neq n} m_k \ frac {\ vec {r} _n - \ vec {r} _k} {| \ vec { r} _n - \ vec {r} _k | ^ 3}. </script></p><br><br>  Lembrando que a acelera√ß√£o √© a segunda derivada da coordenada, obtemos uma equa√ß√£o diferencial parcial de segunda ordem, que deve ser resolvida para obter a trajet√≥ria de cada corpo: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-281"><span class="noError" id="MJXp-Span-282" style="display: inline-block;">\&nbsp;frac&nbsp;{\&nbsp;parcial&nbsp;^&nbsp;2&nbsp;\&nbsp;v&nbsp;{{}}&nbsp;n&nbsp;\&nbsp;{parcial&nbsp;t&nbsp;^&nbsp;2}&nbsp;=&nbsp;f_n&nbsp;=&nbsp;-G&nbsp;\&nbsp;sum_&nbsp;{k&nbsp;\&nbsp;neq&nbsp;n}&nbsp;m_k&nbsp;\&nbsp;frac&nbsp;{\&nbsp;vec&nbsp;{r}&nbsp;_n&nbsp;-&nbsp;\&nbsp;vec&nbsp;{r&nbsp;}&nbsp;_k}&nbsp;{|&nbsp;\&nbsp;vec&nbsp;{r}&nbsp;_n&nbsp;-&nbsp;\&nbsp;vec&nbsp;{r}&nbsp;_k&nbsp;|&nbsp;^&nbsp;3}.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> \ frac {\ parcial ^ 2 \ v {{}} n \ {parcial t ^ 2} = f_n = -G \ sum_ {k \ neq n} m_k \ frac {\ vec {r} _n - \ vec {r } _k} {| \ vec {r} _n - \ vec {r} _k | ^ 3}. </script></p><br>  √â importante notar aqui que a complexidade de calcular uma fun√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-283"><span class="MJXp-msubsup" id="MJXp-Span-284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-286" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> f_n </script>  √© igual a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-287"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-288">O</span><span class="MJXp-mo" id="MJXp-Span-289" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-290"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-291" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-292" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-293" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> O (N ^ 2) </script>  e aumenta significativamente com o aumento do n√∫mero de corpos em intera√ß√£o. <br><br><h2>  Matem√°tica </h2><br>  O primeiro e mais simples m√©todo para resolver equa√ß√µes diferenciais √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o m√©todo de Euler</a> , projetado para resolver equa√ß√µes da forma: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-294"><span class="MJXp-mtext" id="MJXp-Span-295">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-296">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-297">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-298">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-299">c</span><span class="MJXp-mrow" id="MJXp-Span-300"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-302">y</span></span><span class="MJXp-mrow" id="MJXp-Span-303"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-304">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-305">x</span></span><span class="MJXp-mo" id="MJXp-Span-306" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-307">f</span><span class="MJXp-mo" id="MJXp-Span-308" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-309">x</span><span class="MJXp-mo" id="MJXp-Span-310" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311">y</span><span class="MJXp-mo" id="MJXp-Span-312" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-313" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> \ frac {dy} {dx} = f (x, y). </script></p><br>  Ap√≥s a transi√ß√£o para a regi√£o discreta, obtemos: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-314"><span class="MJXp-msubsup" id="MJXp-Span-315"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-317" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-318">i</span></span></span><span class="MJXp-mo" id="MJXp-Span-319" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-320"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-322" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-323">i</span><span class="MJXp-mo" id="MJXp-Span-324">‚àí</span><span class="MJXp-mn" id="MJXp-Span-325">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-327">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-328">f</span><span class="MJXp-mo" id="MJXp-Span-329" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-330"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331" style="margin-right: 0.05em;">x</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-332" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-333">i</span><span class="MJXp-mo" id="MJXp-Span-334">‚àí</span><span class="MJXp-mn" id="MJXp-Span-335">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-336" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-337"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-338" style="margin-right: 0.05em;">y</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-339" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-340">i</span><span class="MJXp-mo" id="MJXp-Span-341">‚àí</span><span class="MJXp-mn" id="MJXp-Span-342">1</span></span></span><span class="MJXp-mo" id="MJXp-Span-343" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-345">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-350">i</span><span class="MJXp-mo" id="MJXp-Span-351" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-352">1</span><span class="MJXp-mo" id="MJXp-Span-353" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-354">2</span><span class="MJXp-mo" id="MJXp-Span-355" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-356">3</span><span class="MJXp-mo" id="MJXp-Span-357" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-358">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-359">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-360">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-362">s</span><span class="MJXp-mo" id="MJXp-Span-363" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364">m</span><span class="MJXp-mo" id="MJXp-Span-365" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-12"> y_ {i} = y_ {i-1} + h f (x_ {i-1}, y_ {i-1}), \ quad i = 1,2,3, \ dots, m, </script></p><br>  onde <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-366"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-367">h</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> h </script>  A etapa de integra√ß√£o e <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-368"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-369">m</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> m </script>  - o n√∫mero de etapas de integra√ß√£o.  Assim, se precisarmos calcular a posi√ß√£o dos corpos de cada vez <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-370"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-371">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> T </script>  ent√£o devemos fazer <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-372"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-373">m</span><span class="MJXp-mo" id="MJXp-Span-374" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-375">T</span><span class="MJXp-mrow" id="MJXp-Span-376"><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-378">h</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> m = T / h </script>  etapas de integra√ß√£o.  Aqui o primeiro problema √© vis√≠vel - se <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-379"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-380">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> T </script>  grande, precisamos dar um grande n√∫mero de etapas de integra√ß√£o. <br><br>  Para aplicar o m√©todo Euler ao nosso problema, ele deve ser reduzido a um sistema de primeira ordem.  Para fazer isso, introduzimos uma vari√°vel adicional - velocidade das part√≠culas: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-381"><span class="MJXp-mtext" id="MJXp-Span-382">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-383">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-384">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-385">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-386">c</span><span class="MJXp-mrow" id="MJXp-Span-387"><span class="MJXp-mtext" id="MJXp-Span-388">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-390">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-391">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-393">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-394">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-395">l</span><span class="MJXp-mtext" id="MJXp-Span-396">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-397">v</span><span class="MJXp-msubsup" id="MJXp-Span-398"><span class="MJXp-mrow" id="MJXp-Span-399" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-400">v</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-401" style="vertical-align: -0.4em;">n</span></span></span><span class="MJXp-mrow" id="MJXp-Span-402"><span class="MJXp-mtext" id="MJXp-Span-403">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-406">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-407">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-408">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-409">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-410">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411">t</span></span><span class="MJXp-mo" id="MJXp-Span-412" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-413"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-414" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-415" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-416" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mspace" id="MJXp-Span-417" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-418">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-421">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">c</span><span class="MJXp-mrow" id="MJXp-Span-423"><span class="MJXp-mtext" id="MJXp-Span-424">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-427">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-428">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">l</span><span class="MJXp-mtext" id="MJXp-Span-432">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-434">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-435">c</span><span class="MJXp-msubsup" id="MJXp-Span-436"><span class="MJXp-mrow" id="MJXp-Span-437" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">r</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-439" style="vertical-align: -0.4em;">n</span></span></span><span class="MJXp-mrow" id="MJXp-Span-440"><span class="MJXp-mtext" id="MJXp-Span-441">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-443">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-449">t</span></span><span class="MJXp-mo" id="MJXp-Span-450" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-451">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-452">v</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-453">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-454">c</span><span class="MJXp-msubsup" id="MJXp-Span-455"><span class="MJXp-mrow" id="MJXp-Span-456" style="margin-right: 0.05em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-457">v</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-458" style="vertical-align: -0.4em;">n</span></span><span class="MJXp-mo" id="MJXp-Span-459" style="margin-left: 0em; margin-right: 0.222em;">.</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-18"> \ frac {\ parcial \ v {v} _n} {\ parcial t} = f_n, \\ \ frac {\ parcial \ vec {r} _n} {\ parcial t} = \ vec {v} _n. </script></p><br><br>  O segundo problema na solu√ß√£o de sistemas de equa√ß√µes diferenciais √© a precis√£o da solu√ß√£o e seu controle.  A precis√£o pode ser aprimorada de duas maneiras: diminuindo a etapa de integra√ß√£o e escolhendo um m√©todo com uma ordem de precis√£o mais alta.  Ambos os m√©todos levam ao aumento da complexidade computacional, mas de maneiras diferentes.  Por exemplo, voc√™ pode usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todo Runge-Kutta</a> cl√°ssico de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">quarta ordem</a> ; ele requer quatro c√°lculos de fun√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-460"><span class="MJXp-msubsup" id="MJXp-Span-461"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-462" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-463" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> f_n </script>  a cada passo, mas tem uma ordem de precis√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-464"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-465">O</span><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-467"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-468" style="margin-right: 0.05em;">h</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-469" style="vertical-align: 0.5em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> O (h ^ 4) </script>  (para compara√ß√£o, o m√©todo de Euler tem uma ordem de precis√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-471"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-472">O</span><span class="MJXp-mo" id="MJXp-Span-473" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-474">h</span><span class="MJXp-mo" id="MJXp-Span-475" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> O (h) </script>  e requer um c√°lculo <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-476"><span class="MJXp-msubsup" id="MJXp-Span-477"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-478" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-479" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> f_n </script>  )  A precis√£o da solu√ß√£o tamb√©m pode ser controlada de v√°rias maneiras: compare com a solu√ß√£o anal√≠tica, resolva usando m√©todos diferentes ou com etapas diferentes e compare os resultados, controle par√¢metros e limita√ß√µes de terceiros que a solu√ß√£o deve cumprir. <br>  Al√©m disso, cada um desses m√©todos tem suas desvantagens.  As decis√µes anal√≠ticas podem estar ausentes ou, mesmo na maioria dos casos, completamente ausentes.  Por exemplo, para nossa tarefa <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-480"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-481">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> N </script>  solu√ß√£o anal√≠tica tel √© apenas para <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-482"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">N</span><span class="MJXp-mo" id="MJXp-Span-484" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-485">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> N = 2 </script>  , mas mesmo isso √© suficiente para testar a precis√£o dos m√©todos.  A resolu√ß√£o de um problema por dois m√©todos ou com etapas diferentes aumenta o tempo de computa√ß√£o, mas essa abordagem pode ser aplicada a quase qualquer tarefa.  Nem todas as tarefas t√™m limita√ß√µes, mas as nossas t√™m: em cada etapa da integra√ß√£o, podemos controlar a implementa√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">das leis de conserva√ß√£o</a> .  Essa abordagem tamb√©m aumenta a complexidade do c√°lculo, mas h√° muito por onde escolher; o c√°lculo da soma do momento ou do momento angular de todas as part√≠culas tem complexidade da ordem <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-486"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-487">O</span><span class="MJXp-mo" id="MJXp-Span-488" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489">N</span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> O (N) </script>  , enquanto o c√°lculo da energia total de um sistema tem complexidade de pedidos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-491"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-492">O</span><span class="MJXp-mo" id="MJXp-Span-493" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-494"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-495" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-496" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-497" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> O (N ^ 2) </script><br><br><div class="spoiler">  <b class="spoiler_title">Nota sobre o c√°lculo da energia total</b> <div class="spoiler_text">  No nosso caso, a energia total do sistema consiste em duas partes - energia cin√©tica e potencial.  A energia cin√©tica consiste na soma das energias cin√©ticas de todos os corpos.  Para calcular a energia potencial, precisamos adicionar as energias potenciais de cada part√≠cula no campo gravitacional das part√≠culas restantes, portanto, precisamos adicionar <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-498"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-499"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-500" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-501"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-502" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-503" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-504" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><script type="math/tex" id="MathJax-Element-27"> O (N ^ 2) </script>  termos.  A dificuldade √© que todos os termos s√£o de uma ordem muito diferente e, mesmo com c√°lculos de precis√£o dupla, n√£o √© poss√≠vel calcular esse valor com uma precis√£o suficiente para compara√ß√£o em etapas diferentes.  Para superar esse problema, foi necess√°rio aplicar a soma de acordo com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o algoritmo Kahan</a> . <br></div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/270/e1d/4d8270e1d2f39d30e9d2e5beabec6fa0.png" alt="Trajet√≥ria el√≠ptica"></div><br><p>  <b>Fig 1.</b> <i>Um exemplo de uma trajet√≥ria el√≠ptica.</i> </p><br><br><br>  Considere o caso simples de um sat√©lite se movendo em uma √≥rbita el√≠ptica ao redor da Terra.  √Ä medida que o sat√©lite se aproxima da Terra, sua velocidade aumenta e, ao se afastar da Terra, diminui, consequentemente, a possibilidade de diminuir o passo de integra√ß√£o no tempo na parte verde da √≥rbita e aument√°-lo em vermelho e azul sem alterar a precis√£o da solu√ß√£o.  Vamos tentar comparar com mais detalhes. <br><br>  <b>Tabela 1.</b> <i>M√©todos investigados para resolver equa√ß√µes diferenciais</i> <br><table><tbody><tr><th>  Marcado </th><th>  Encomendar </th><th>  Descri√ß√£o do produto </th></tr><tr><td>  adams </td><td>  1-5 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo Adams-Bashfort</a> </td></tr><tr><td>  euler </td><td>  1 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo Euler</a> </td></tr><tr><td>  rk4 </td><td>  4 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo Runge-Kutta cl√°ssico</a> </td></tr><tr><td>  rkck </td><td>  5 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo Kash-Karp</a> </td></tr><tr><td>  rkdp </td><td>  5 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo Dorman-Prince</a> </td></tr><tr><td>  rkdverk </td><td>  6 </td><td>  M√©todo de Werner <a href="">1)</a> p.  181 </td></tr><tr><td>  rkf </td><td>  7 </td><td>  M√©todo Felberg <a href="">1)</a> p.  180 </td></tr><tr><td>  rkgl </td><td>  6 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo impl√≠cito de Gauss-Legendre</a> </td></tr><tr><td>  rklc </td><td>  4 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo impl√≠cito de Lobatto</a> </td></tr><tr><td>  trap√©zio </td><td>  2 </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">M√©todo trap√©zio</a> </td></tr></tbody></table><br>  Para selecionar o melhor m√©todo para nossa tarefa, compararemos v√°rios m√©todos conhecidos.  Para isso, simulamos a colis√£o de dois sistemas de corpos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-505"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-506">N</span><span class="MJXp-mo" id="MJXp-Span-507" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-508">512</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> N = 512 </script>  e medir a mudan√ßa relativa na <a href="">energia total</a> , <a href="">momento</a> e seu <a href="">momento</a> no final da simula√ß√£o (tempo m√°ximo de simula√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-509"><span class="MJXp-msubsup" id="MJXp-Span-510"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-511" style="margin-right: 0.05em;">T</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-512" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-513">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-514">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-515">x</span></span></span><span class="MJXp-mo" id="MJXp-Span-516" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-517">2</span><span class="MJXp-mo" id="MJXp-Span-518" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-519">5</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> T_ {max} = 2,5 </script>  )  Nesse caso, variaremos a etapa e os par√¢metros dos m√©todos de integra√ß√£o e mediremos o n√∫mero de chamadas de fun√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-520"><span class="MJXp-msubsup" id="MJXp-Span-521"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-522" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-523" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> f_n </script>  , respectivamente, aqueles m√©todos que com um n√∫mero menor de chamadas levar√£o a menos perdas, consideraremos mais aceit√°veis. <br><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c0c/9de/886/c0c9de886418710c403863bc34021d9a.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/311/f1b/614/311f1b6146bb4b13a4bd1db313ee1372.svg"><br></a> <br></td></tr><tr><td align="center">  a) </td><td align="center">  b) </td></tr><tr><td colspan="2" align="center">  <b>Figura 2.</b> <i>Mudan√ßa relativa na energia a), momento b), no final da simula√ß√£o do sistema</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-524"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525">N</span><span class="MJXp-mo" id="MJXp-Span-526" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-527">512</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> N = 512 </script></i>   <i>corpos por v√°rios m√©todos, dependendo do n√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-528"><span class="MJXp-msubsup" id="MJXp-Span-529"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-530" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-531" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> f_n </script></i>   <i>precis√£o dupla</i> </td></tr></tbody></table><br>  A partir dos gr√°ficos da Figura 2, √© poss√≠vel observar que a melhor propor√ß√£o da quantidade de c√°lculo da fun√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-532"><span class="MJXp-msubsup" id="MJXp-Span-533"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-535" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> f_n </script>  e a mudan√ßa relativa na energia do sistema dos corpos nos m√©todos de Adams e Dorman-Prince de quinta ordem.  Tamb√©m √© visto que para todos os m√©todos com um aumento no n√∫mero de c√°lculos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-536"><span class="MJXp-msubsup" id="MJXp-Span-537"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-538" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-539" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> f_n </script>  a mudan√ßa relativa no momento do sistema aumenta.  Para uma mudan√ßa relativa na energia, isso tamb√©m √© percept√≠vel, mas apenas para alguns m√©todos que podem atingir o limite <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-540"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-541">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-542">E</span><span class="MJXp-mrow" id="MJXp-Span-543"><span class="MJXp-mo" id="MJXp-Span-544" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-msubsup" id="MJXp-Span-545"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-546" style="margin-right: 0.05em;">E</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-547" style="vertical-align: -0.4em;">0</span></span><span class="MJXp-mo" id="MJXp-Span-548" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-msubsup" id="MJXp-Span-549"><span class="MJXp-mn" id="MJXp-Span-550" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-551" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-552">‚àí</span><span class="MJXp-mn" id="MJXp-Span-553">12</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> dE / E_0 <10 ^ {- 12} </script>  .  Esse efeito n√£o pode mais ser atribu√≠do ao erro dos m√©todos, mas ao erro dos c√°lculos, e um aumento adicional na precis√£o √© poss√≠vel apenas junto com um aumento na precis√£o dos c√°lculos com ponto flutuante. <br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/c8e/e99/4ba/c8ee994ba56d3dcbb7c305aad402f0e3.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/745/6a2/7f4/7456a27f4253ae5ac634dcc2ebf0776d.svg"><br></a> <br></td></tr><tr><td align="center">  a) </td><td align="center">  b) </td></tr><tr><td colspan="2" align="center">  <b>Fig. 3.</b> <i>Mudan√ßa relativa na energia a), momento b), no final da simula√ß√£o do sistema</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-554"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-555">N</span><span class="MJXp-mo" id="MJXp-Span-556" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-557">512</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> N = 512 </script></i>   <i>corpos por v√°rios m√©todos, dependendo do n√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-558"><span class="MJXp-msubsup" id="MJXp-Span-559"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-561" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> f_n </script></i>   <i>com precis√£o qu√°drupla (__float128)</i> </td></tr></tbody></table><br>  As Figuras 3a e 3b mostram que o uso de c√°lculos com precis√£o qu√°drupla pode reduzir as perdas de energia relativas em at√© <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-562"><span class="MJXp-msubsup" id="MJXp-Span-563"><span class="MJXp-mn" id="MJXp-Span-564" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-565" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-566">‚àí</span><span class="MJXp-mn" id="MJXp-Span-567">23</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38"> 10 ^ {- 23} </script>  , mas voc√™ precisa entender que o tempo de computa√ß√£o √© aumentado em duas ordens de magnitude em compara√ß√£o com a precis√£o dupla.  Como no caso de c√°lculos de dupla precis√£o, a melhor raz√£o de precis√£o e o n√∫mero de c√°lculos de fun√ß√µes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-msubsup" id="MJXp-Span-569"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-570" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-571" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> f_n </script>  possuem m√©todos de Adams de quinta ordem e Dorman-Prince. <br><br>  Os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todos</a> Dorman-Prince e Werner pertencem √† classe de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">m√©todos aninhados</a> e podem calcular simultaneamente duas solu√ß√µes com alta e baixa ordem de precis√£o (para o m√©todo Dorman-Prince, ordens 5 e 4, e para o m√©todo Werner, ordens 6 e 5).  Se essas duas solu√ß√µes forem muito diferentes, poderemos dividir a etapa atual de integra√ß√£o em outras menores.  Isso nos permite alterar dinamicamente a etapa de integra√ß√£o e reduzi-la apenas nas √°reas em que √© necess√°ria. <br><br>  Vamos comparar os m√©todos de quinta ordem Dorman-Prince, Werner e Adams com mais detalhes, durante um intervalo de simula√ß√£o mais longo do nosso sistema ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-572"><span class="MJXp-msubsup" id="MJXp-Span-573"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-574" style="margin-right: 0.05em;">T</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-575" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-576">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-577">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-578">x</span></span></span><span class="MJXp-mo" id="MJXp-Span-579" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-580">300</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> T_ {max} = 300 </script>  ) <br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dcf/431/463/dcf431463350504334895ae590038f54.svg"><br></a> <br></td></tr><tr><td align="center">  <b>a) A</b> <i>mudan√ßa relativa de energia, momento e seu momento no processo de modelagem</i> <br></td></tr><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a2f/039/e55/a2f039e5575a01df083f913ab5cbb6d7.svg"><br></a> <br></td></tr><tr><td align="center">  <b>b)</b> <i>N√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-581"><span class="MJXp-msubsup" id="MJXp-Span-582"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-583" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-584" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41"> f_n </script></i>   <i>no intervalo de simula√ß√£o</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-585"><span class="MJXp-mtext" id="MJXp-Span-586">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-587">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-588">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-589">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-590">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-591">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-592">T</span><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-594">0</span><span class="MJXp-mo" id="MJXp-Span-595" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-596">3</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42"> \ Delta T = 0,3 </script></i> <br></td></tr><tr><td align="center">  <b>Fig. 4.</b> <i>Depend√™ncias da mudan√ßa relativa nos par√¢metros f√≠sicos do sistema e o n√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-597"><span class="MJXp-msubsup" id="MJXp-Span-598"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-599" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-600" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-43"> f_n </script></i>   <i>Modelagem peri√≥dica com o m√©todo de etapas vari√°veis ‚Äã‚Äãde Dorman-Prince</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">h</span><span class="MJXp-mo" id="MJXp-Span-603" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-604"><span class="MJXp-mn" id="MJXp-Span-605" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-606" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-607">‚àí</span><span class="MJXp-mn" id="MJXp-Span-608">5</span></span></span><span class="MJXp-mtext" id="MJXp-Span-609">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-610">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-611">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-612">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-613">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-614">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-615">s</span><span class="MJXp-msubsup" id="MJXp-Span-616"><span class="MJXp-mn" id="MJXp-Span-617" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-618" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-619">‚àí</span><span class="MJXp-mn" id="MJXp-Span-620">9</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44"> h = 10 ^ {- 5} \ pontos 10 ^ {- 9} </script></i> <br></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/db6/ed7/96b/db6ed796b48734885acac334d62bf74c.svg"><br></a> <br></td></tr><tr><td align="center">  <b>a) A</b> <i>mudan√ßa relativa de energia, momento e seu momento no processo de modelagem</i> <br></td></tr><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/1a8/b05/599/1a8b05599c05680aa8501197f70f8d5c.svg"><br></a> <br></td></tr><tr><td align="center">  <b>b)</b> <i>N√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-621"><span class="MJXp-msubsup" id="MJXp-Span-622"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-623" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-624" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45"> f_n </script></i>   <i>no intervalo de simula√ß√£o</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-625"><span class="MJXp-mtext" id="MJXp-Span-626">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-627">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-628">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-629">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-630">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-631">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-632">T</span><span class="MJXp-mo" id="MJXp-Span-633" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-634">0</span><span class="MJXp-mo" id="MJXp-Span-635" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-636">3</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46"> \ Delta T = 0,3 </script></i> <br></td></tr><tr><td align="center">  <b>Fig. 5.</b> <i>Depend√™ncias da mudan√ßa relativa nos par√¢metros f√≠sicos do sistema e o n√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-637"><span class="MJXp-msubsup" id="MJXp-Span-638"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-639" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-640" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47"> f_n </script></i>   <i>modelagem versus tempo pelo m√©todo Werner com uma etapa vari√°vel</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-641"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">h</span><span class="MJXp-mo" id="MJXp-Span-643" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-644"><span class="MJXp-mn" id="MJXp-Span-645" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-646" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-647">‚àí</span><span class="MJXp-mn" id="MJXp-Span-648">5</span></span></span><span class="MJXp-mtext" id="MJXp-Span-649">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-650">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-651">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-652">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-654">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655">s</span><span class="MJXp-msubsup" id="MJXp-Span-656"><span class="MJXp-mn" id="MJXp-Span-657" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-658" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-659">‚àí</span><span class="MJXp-mn" id="MJXp-Span-660">9</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48"> h = 10 ^ {- 5} \ pontos 10 ^ {- 9} </script></i> <br></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f6b/b1e/832/f6bb1e8323381a14ab438133218fdcc8.svg"><br></a> <br></td></tr><tr><td align="center">  <b>Fig. 6.</b> <i>Mudan√ßa relativa de energia, momento e seu momento no processo de modelagem pelo m√©todo de Adams-Bashfort de quinta ordem com um passo</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-661"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">h</span><span class="MJXp-mo" id="MJXp-Span-663" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-664"><span class="MJXp-mn" id="MJXp-Span-665" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-666" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-667">‚àí</span><span class="MJXp-mn" id="MJXp-Span-668">6</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49"> h = 10 ^ {- 6} </script></i> <br></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fc2/19e/8fa/fc219e8fa8a9bc8dfddc4ebb5a2aeae5.svg"><br></a> <br></td></tr><tr><td align="center">  <b>Fig 7.</b> <i>Depend√™ncias do n√∫mero de c√°lculos de fun√ß√µes</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-669"><span class="MJXp-msubsup" id="MJXp-Span-670"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-671" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-672" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> f_n </script></i>   <i>para m√©todos Adams, Dorman-Prince e Werner de quinta ordem a partir do tempo de simula√ß√£o</i> <br></td></tr></tbody></table><br>  Pode-se ver que no est√°gio inicial da evolu√ß√£o do nosso sistema ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-673"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-674">T</span><span class="MJXp-mo" id="MJXp-Span-675" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-676">25</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-51"> T <25 </script>  ) os tr√™s m√©todos mostram caracter√≠sticas semelhantes, mas em est√°gios posteriores alguns eventos ocorrem no sistema, como resultado dos erros nos principais par√¢metros do sistema (energia total, momento e seu momento) saltam acentuadamente.  Mas os m√©todos Dorman-Prince e Werner lidam com essas mudan√ßas muito melhor devido √† capacidade de reduzir a etapa de integra√ß√£o em se√ß√µes "complexas", como resultado do qual o n√∫mero de c√°lculos de fun√ß√µes aumenta <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-677"><span class="MJXp-msubsup" id="MJXp-Span-678"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-679" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-680" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52"> f_n </script>  como visto nas figuras 4b e 5b, mas o n√∫mero total de c√°lculos <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-681"><span class="MJXp-msubsup" id="MJXp-Span-682"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-683" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-684" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53"> f_n </script>  m√©todos aninhados s√£o menores que o m√©todo Adams-Bashfort, como pode ser visto na Figura 7. <br><br><div class="spoiler">  <b class="spoiler_title">Eu me pergunto o que aconteceu com o sistema nesses momentos</b> <div class="spoiler_text"><table><tbody><tr><td align="center"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZPyM6PRXjkY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></td></tr><tr><td align="center">  <b>V√≠deo 1.</b> <i>Modelando um sistema de 512 corpos.</i>  <i>M√©todo Dorman-Prince.</i>  <i>Etapa din√¢mica</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-685"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-686"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h </font></font></span><span class="MJXp-mo" id="MJXp-Span-687" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-688"><span class="MJXp-mn" id="MJXp-Span-689" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-690" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-691"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mn" id="MJXp-Span-692"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></span></span></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-694"><font style="vertical-align: inherit;"> p </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695"><font style="vertical-align: inherit;">o </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-696"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697"><font style="vertical-align: inherit;">t </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-698"><font style="vertical-align: inherit;">o </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699"><font style="vertical-align: inherit;">s </font></span><span class="MJXp-msubsup" id="MJXp-Span-700"><span class="MJXp-mn" id="MJXp-Span-701" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">10 </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-700"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-702" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-703"><font style="vertical-align: inherit;">- </font></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-700"><span class="MJXp-mrow MJXp-script" id="MJXp-Span-702" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-704"><font style="vertical-align: inherit;">9</font></span></span></span></font><span class="MJXp-mtext" id="MJXp-Span-693">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-694"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-695"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-696"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-698"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-700"><span class="MJXp-mn" id="MJXp-Span-701" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-702" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-703"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn" id="MJXp-Span-704"><font style="vertical-align: inherit;"></font></span></span></span></span></span><script type="math/tex" id="MathJax-Element-54"> h = 10 ^ {- 5} \ pontos 10 ^ {- 9} </script></i> <br></td></tr></tbody></table><br></div></div><br>  O v√≠deo demonstra que at√© o momento <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-705"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">T</span><span class="MJXp-mo" id="MJXp-Span-707" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-708">25</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55"> T = 25 </script>  o movimento √© relativamente calmo e ap√≥s uma colis√£o dos centros das ‚Äúgal√°xias‚Äù, o que leva a uma mudan√ßa acentuada nas trajet√≥rias e um forte aumento nas velocidades de algumas part√≠culas.  Al√©m disso, para manter a precis√£o da solu√ß√£o, √© necess√°rio reduzir a etapa de integra√ß√£o.  Os m√©todos aninhados podem fazer isso automaticamente; os gr√°ficos mostram que em algumas partes da evolu√ß√£o do sistema, a etapa de integra√ß√£o foi reduzida em quase duas ordens de magnitude com <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-709"><span class="MJXp-msubsup" id="MJXp-Span-710"><span class="MJXp-mn" id="MJXp-Span-711" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-712" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-713">‚àí</span><span class="MJXp-mn" id="MJXp-Span-714">5</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-56"> 10 ^ {- 5} </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-715"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-716">h</span><span class="MJXp-mo" id="MJXp-Span-717" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-718"><span class="MJXp-mn" id="MJXp-Span-719" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-720" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-721">‚àí</span><span class="MJXp-mn" id="MJXp-Span-722">7</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-57"> h = 10 ^ {- 7} </script>  .  Ao usar o m√©todo Adams e essa etapa em todo o intervalo da evolu√ß√£o do sistema, n√£o ter√≠amos esperado por uma solu√ß√£o. <br><br><h4>  Sum√°rio </h4><br>  Para a solu√ß√£o, √© melhor usar m√©todos aninhados que permitem controlar dinamicamente a etapa de integra√ß√£o e reduzi-la apenas em se√ß√µes "complexas" da trajet√≥ria. <br><br>  N√£o siga os m√©todos de ordem mais alta.  Mesmo ao usar o tipo de dados 'double', eles n√£o atingem seus recursos potenciais, usar os tipos de dados com maior precis√£o aumenta muito o tempo necess√°rio para resolver o problema. <br><br><h2>  Implementa√ß√£o de CPU </h2><br>  Agora que a escolha de um m√©todo para resolver equa√ß√µes est√° definida, vamos tentar descobrir o c√°lculo da for√ßa de intera√ß√£o para cada part√≠cula.  Temos um ciclo duplo para todas as part√≠culas: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de implementa√ß√£o 'simples'</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> body1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; body1 &lt; count; ++body1) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbvertex_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rx[ body1 ], ry[ body1 ], rz[ body1 ])</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> body2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; body2 != count; ++body2) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(body1 == body2) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbvertex_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">v2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rx[ body2 ], ry[ body2 ], rz[ body2 ])</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbvertex_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">force</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m_data-&gt;force(v1, v2, mass[body1], mass[body2]))</span></span></span></span>; total_force += force; } frx[body1] = vx[body1]; fry[body1] = vy[body1]; frz[body1] = vz[body1]; fvx[body1] = total_force.x / mass[body1]; fvy[body1] = total_force.y / mass[body1]; fvz[body1] = total_force.z / mass[body1]; }</code> </pre> <br></div></div><br>  As for√ßas gravitacionais de cada corpo s√£o calculadas independentemente e, para usar todos os n√∫cleos do processador, basta escrever a diretiva OpenMP antes do primeiro ciclo: <br><br><div class="spoiler">  <b class="spoiler_title">Um peda√ßo de c√≥digo da implementa√ß√£o do 'openmp'</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for(size_t body1 = 0; body1 &lt; count; ++body1)</span></span></code> </pre><br></div></div><br>  Porque  Como cada corpo interage com cada um deles, para reduzir o n√∫mero de intera√ß√µes do processador com a RAM e melhorar o uso do cache, temos a capacidade de carregar parte dos dados no cache e us√°-lo repetidamente: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de implementa√ß√£o 'openmp + block'</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for(size_t n1 = 0; n1 </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; count; n1 += BLOCK_SIZE) { nbcoord_t x1[BLOCK_SIZE]; nbcoord_t y1[BLOCK_SIZE]; nbcoord_t z1[BLOCK_SIZE]; nbcoord_t m1[BLOCK_SIZE]; nbvertex_t total_force[BLOCK_SIZE]; for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; x1[b1] = rx[local_n1]; y1[b1] = ry[local_n1]; z1[b1] = rz[local_n1]; m1[b1] = mass[local_n1]; } for(size_t n2 = 0; n2 &lt; count; n2 += BLOCK_SIZE) { nbcoord_t x2[BLOCK_SIZE]; nbcoord_t y2[BLOCK_SIZE]; nbcoord_t z2[BLOCK_SIZE]; nbcoord_t m2[BLOCK_SIZE]; for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { size_t local_n2 = b2 + n2; x2[b2] = rx[local_n2]; y2[b2] = ry[local_n2]; z2[b2] = rz[local_n2]; m2[b2] = mass[n2 + b2]; } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { const nbvertex_t v1(x1[ b1 ], y1[ b1 ], z1[ b1 ]); for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { const nbvertex_t v2(x2[ b2 ], y2[ b2 ], z2[ b2 ]); const nbvertex_t force(m_data-&gt;force(v1, v2, m1[b1], m2[b2])); total_force[b1] += force; } } } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; frx[local_n1] = vx[local_n1]; fry[local_n1] = vy[local_n1]; frz[local_n1] = vz[local_n1]; fvx[local_n1] = total_force[b1].x / m1[b1]; fvy[local_n1] = total_force[b1].y / m1[b1]; fvz[local_n1] = total_force[b1].z / m1[b1]; } }</span></span></span></span></code> </pre><br></div></div><br>  Uma otimiza√ß√£o adicional consiste em retirar o conte√∫do da fun√ß√£o de calcular a for√ßa no ciclo principal e eliminar a divis√£o e multiplica√ß√£o pela massa corporal m1 [b1].  Al√©m do fato de termos reduzido um pouco os c√°lculos, o compilador poder√° aplicar instru√ß√µes vetoriais do processador SSE e AVX em um ciclo t√£o expandido. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de implementa√ß√£o 'openmp + block + optimization'</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel for for(size_t n1 = 0; n1 &lt; count; n1 += BLOCK_SIZE) { nbcoord_t x1[BLOCK_SIZE]; nbcoord_t y1[BLOCK_SIZE]; nbcoord_t z1[BLOCK_SIZE]; nbcoord_t total_force_x[BLOCK_SIZE]; nbcoord_t total_force_y[BLOCK_SIZE]; nbcoord_t total_force_z[BLOCK_SIZE]; for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; x1[b1] = rx[local_n1]; y1[b1] = ry[local_n1]; z1[b1] = rz[local_n1]; total_force_x[b1] = 0; total_force_y[b1] = 0; total_force_z[b1] = 0; } for(size_t n2 = 0; n2 &lt; count; n2 += BLOCK_SIZE) { nbcoord_t x2[BLOCK_SIZE]; nbcoord_t y2[BLOCK_SIZE]; nbcoord_t z2[BLOCK_SIZE]; nbcoord_t m2[BLOCK_SIZE]; for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { size_t local_n2 = b2 + n2; x2[b2] = rx[local_n2]; y2[b2] = ry[local_n2]; z2[b2] = rz[local_n2]; m2[b2] = mass[n2 + b2]; } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { for(size_t b2 = 0; b2 != BLOCK_SIZE; ++b2) { nbcoord_t dx = x1[b1] - x2[b2]; nbcoord_t dy = y1[b1] - y2[b2]; nbcoord_t dz = z1[b1] - z2[b2]; nbcoord_t r2(dx * dx + dy * dy + dz * dz); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } nbcoord_t r = sqrt(r2); nbcoord_t coeff = (m2[b2]) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; total_force_x[b1] -= dx; total_force_y[b1] -= dy; total_force_z[b1] -= dz; } } } for(size_t b1 = 0; b1 != BLOCK_SIZE; ++b1) { size_t local_n1 = b1 + n1; frx[local_n1] = vx[local_n1]; fry[local_n1] = vy[local_n1]; frz[local_n1] = vz[local_n1]; fvx[local_n1] = total_force_x[b1]; fvy[local_n1] = total_force_y[b1]; fvz[local_n1] = total_force_z[b1]; } }</span></span></code> </pre><br></div></div><br>  <b>Tabela 2.</b> <i>Depend√™ncia do tempo de c√°lculo (em segundos) da fun√ß√£o</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-723"><span class="MJXp-msubsup" id="MJXp-Span-724"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-725" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-726" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-58-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-58"> f_n </script></i>   <i>no n√∫mero de corpos interagindo</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-727"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-59-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-59"> N </script></i>   <i>para v√°rias implementa√ß√µes de CPU</i> <br><table><tbody><tr><th><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-729"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-60-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-60"> N </script></th><th>  2048 </th><th>  4096 </th><th>  8192 </th><th>  16384 </th><th>  32768 </th></tr><tr><td>  simples </td><td>  0,0425 </td><td>  0,1651 </td><td>  0,6594 </td><td>  2,65 </td><td>  10,52 </td></tr><tr><td>  openmp </td><td>  0,0078 </td><td>  0,0260 </td><td>  0,1079 </td><td>  0,417 </td><td>  1.655 </td></tr><tr><td>  openmp + block + otimiza√ß√£o </td><td>  0,0037 </td><td>  0,0128 </td><td>  0,0495 </td><td>  0,194 </td><td>  0,774 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Par√¢metros do sistema:</b> <div class="spoiler_text"><ul><li>  sistema: <i>Debian 9, Intel Core i7-5820K (6 n√∫cleos)</i> </li><li>  compilador: <i>gcc 6.3.0</i> </li></ul><br></div></div><br>  √â claramente visto que a vers√£o com suporte ao OpenMP √© acelerada em seis vezes, exatamente em termos de n√∫mero de n√∫cleos, e a vers√£o otimizada √© mais r√°pida em pouco mais de duas vezes.  Portanto, com a otimiza√ß√£o, voc√™ n√£o deve confiar apenas no paralelismo.  Curiosamente, nos c√°lculos de fluxo √∫nico, o processador trabalhava com uma frequ√™ncia de 3,6 GHz, na vers√£o paralela (openmp) reduzia a frequ√™ncia para 3,4 GHz e, no paralelo e otimizado (openmp + bloco + otimiza√ß√£o), reduzia para 3,3 GHz, mas isso isso n√£o a impediu de trabalhar 13,6 vezes mais r√°pido.  Tamb√©m √© visto que um aumento no tempo de computa√ß√£o com um aumento no tamanho do problema √© quadr√°tico e um aumento adicional <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-731"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-732">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-61-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-61"> N </script>  torna a tarefa insol√∫vel em um tempo razo√°vel. <br><br><h2>  Implementa√ß√£o de GPU </h2><br>  Mas h√° um desejo de fazer c√°lculos ainda mais r√°pidos.  Existem v√°rias instru√ß√µes dispon√≠veis para acelera√ß√£o: computa√ß√£o em GPU, aproxima√ß√£o de fun√ß√µes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-733"><span class="MJXp-msubsup" id="MJXp-Span-734"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-736" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-62-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-62"> f_n </script>  .  Primeiro, para a computa√ß√£o da GPU, escolhi a tecnologia OpenCL.  Para um trabalho mais conveniente, a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CLHPP</a> foi usada.  A principal vantagem do OpenCL √© que o c√≥digo pode ser executado no processador e na GPU, o que simplifica a grava√ß√£o e a depura√ß√£o, al√©m de expandir a lista de hardware a ser executada.  A ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Oclgrind</a> ajuda na depura√ß√£o, que em tempo de execu√ß√£o mostra chamadas incorretas da API OpenCL e problemas de acesso √† mem√≥ria. <br><br><h4>  Opencl </h4><br>  Para come√ßar a usar o OpenCL, voc√™ precisa obter uma lista de plataformas dispon√≠veis.  As plataformas mais comuns s√£o AMD, Intel e NVidia. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;cl::Platform&gt; platforms; cl::Platform::get(&amp;platforms);</code> </pre><br></div></div><br>  Em seguida, depois de escolher uma plataforma, voc√™ precisa selecionar o dispositivo de computa√ß√£o que essa plataforma representa: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cl::<span class="hljs-function"><span class="hljs-function">Platform&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">platform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(platforms[platform_n])</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;cl::Device&gt; all_devices; platform.getDevices(CL_DEVICE_TYPE_ALL, &amp;all_devices);</code> </pre><br></div></div><br>  E no final da fase preparat√≥ria, √© necess√°rio criar um contexto e filas dentro das quais a mem√≥ria ser√° alocada e os c√°lculos ser√£o realizados.  Por exemplo, um contexto que combina todos os dispositivos de computa√ß√£o de uma plataforma selecionada √© criado da seguinte maneira: <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de cria√ß√£o de contexto e fila</b> <div class="spoiler_text"><pre> <code class="cpp hljs">cl::<span class="hljs-function"><span class="hljs-function">Context </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">context</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(all_devices)</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;cl::CommandQueue&gt; queues; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(cl::Device device: all_devices) queues.push_back(cl::CommandQueue(context, device));</code> </pre><br></div></div><br>  Para baixar o c√≥digo-fonte para um dispositivo de computa√ß√£o, ele deve ser compilado, a classe cl :: Program √© destinada a isso. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de compila√ß√£o do kernel</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &gt; source_data; cl::Program::Sources sources; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != files.size(); ++i) { source_data.push_back(load_program(files[i]));<span class="hljs-comment"><span class="hljs-comment">//   sources.push_back(std::make_pair(source_data.back().data(), source_data.back().size())); } cl::Program prog(context, sources); devices.push_back(all_devices); prog.build(devices, options);</span></span></code> </pre><br></div></div><br>  Para descrever os par√¢metros de uma fun√ß√£o (kernel) executada em um dispositivo de computa√ß√£o, existe um modelo de cl: make_kernel. <br><br><div class="spoiler">  <b class="spoiler_title">Exemplo de kernel de c√°lculo de for√ßa de intera√ß√£o</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> cl::make_kernel&lt; cl_int, cl_int, <span class="hljs-comment"><span class="hljs-comment">//Block offset cl::Buffer, //mass cl::Buffer, //y cl::Buffer, //f cl_int, cl_int, //yoff,foff cl_int, cl_int //points_count,stride &gt; ComputeBlock;</span></span></code> </pre><br></div></div><br>  Ent√£o tudo √© simples: declaramos uma vari√°vel com o tipo de kernel, passamos o programa compilado e o nome do kernel computacional para ele, podemos iniciar o kernel quase como uma fun√ß√£o normal. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de Lan√ßamento do Kernel</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">ComputeBlock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fcompute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prog, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"ComputeBlockLocal"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; cl::<span class="hljs-function"><span class="hljs-function">NDRange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">global_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(device_data_size)</span></span></span></span>; cl::<span class="hljs-function"><span class="hljs-function">NDRange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">local_range</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block_size)</span></span></span></span>; cl::<span class="hljs-function"><span class="hljs-function">EnqueueArgs </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eargs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ctx.m_queue, global_range, local_range)</span></span></span></span>; fcompute(eargs, ...  ); <span class="hljs-comment"><span class="hljs-comment">//,   .</span></span></code> </pre><br></div></div><br>  O n√∫cleo computacional do OpenCL √© muito semelhante √† op√ß√£o 'openmp + block + optimization' da CPU, diferentemente da vers√£o da CPU, o primeiro ciclo √© controlado usando o OpenCL (o intervalo do ciclo √© determinado pela vari√°vel global_range do c√≥digo de inicializa√ß√£o do kernel, e o n√∫mero da itera√ß√£o atual est√° dispon√≠vel no kernel usando a fun√ß√£o get_global_id (0)).  Primeiro, parte dos dados do corpo √© carregada da mem√≥ria local e processada.  A mem√≥ria local √© comum a todos os encadeamentos do grupo, portanto, o download ocorre uma vez para o grupo e √© processado por cada encadeamento no grupo e, desde  a mem√≥ria local √© muito mais r√°pida que a global, os c√°lculos s√£o muito mais r√°pidos. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo do Kernel</b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">kernel </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeBlockLocal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n2, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* mass, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> yoff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> foff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stride)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>) + offset_n1; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rx = y + yoff; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* ry = rx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rz = rx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vx = rx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vy = rx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vz = rx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frx = f + foff; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fry = frx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frz = frx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvx = frx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvy = frx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvz = frx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = rx[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = ry[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = rz[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x2[NBODY_DATA_BLOCK_SIZE]; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y2[NBODY_DATA_BLOCK_SIZE]; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z2[NBODY_DATA_BLOCK_SIZE]; __local <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> m2[NBODY_DATA_BLOCK_SIZE]; <span class="hljs-comment"><span class="hljs-comment">// NB! get_local_size(0) == NBODY_DATA_BLOCK_SIZE for(int b2 = 0; b2 &lt; points_count; b2 += NBODY_DATA_BLOCK_SIZE) { int n2 = b2 + offset_n2 + get_local_id(0); // Copy data block to local memory x2[ get_local_id(0) ] = rx[n2]; y2[ get_local_id(0) ] = ry[n2]; z2[ get_local_id(0) ] = rz[n2]; m2[ get_local_id(0) ] = mass[n2]; // Synchronize local work-items copy operations barrier(CLK_LOCAL_MEM_FENCE); nbcoord_t local_res_x = 0.0; nbcoord_t local_res_y = 0.0; nbcoord_t local_res_z = 0.0; for(int local_n2 = 0; local_n2 != NBODY_DATA_BLOCK_SIZE; ++local_n2) { nbcoord_t dx = x1 - x2[local_n2]; nbcoord_t dy = y1 - y2[local_n2]; nbcoord_t dz = z1 - z2[local_n2]; nbcoord_t r2 = (dx * dx + dy * dy + dz * dz); if(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } nbcoord_t r = sqrt(r2); nbcoord_t coeff = (m2[local_n2]) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; local_res_x -= dx; local_res_y -= dy; local_res_z -= dz; } // Synchronize local work-items computations barrier(CLK_LOCAL_MEM_FENCE); res_x += local_res_x; res_y += local_res_y; res_z += local_res_z; } frx[n1] = vx[n1]; fry[n1] = vy[n1]; frz[n1] = vz[n1]; fvx[n1] = res_x; fvy[n1] = res_y; fvz[n1] = res_z; }</span></span></code> </pre><br></div></div><br><h4>  Cuda </h4><br>  A implementa√ß√£o da plataforma NVidia CUDA √© um pouco mais simples que o OpenCL, n√£o precisamos criar o contexto do dispositivo e gerenciar a fila de execu√ß√£o (pelo menos at√© que desejemos fazer uma implementa√ß√£o com v√°rias GPUs).  Como no caso do OpenCL, precisamos alocar mem√≥ria na GPU, copiar nossos dados nela e ent√£o podemos iniciar o n√∫cleo da computa√ß√£o. <br><br>  Voc√™ pode ler mais sobre como trabalhar com a CUDA <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de inicializa√ß√£o do kernel CUDA</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">dim3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">grid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(count / block_size)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">dim3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block_size)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> shared_size(<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>) * block_size); kfcompute &lt;&lt;&lt; grid, block, shared_size &gt;&gt;&gt; (... ...);</code> </pre><br></div></div><br>  Diferentemente do OpenCL, o CUDA n√£o especifica toda a gama de itera√ß√µes (na implementa√ß√£o do OpenCL √© global_range), mas define o tamanho da grade e os tamanhos dos blocos na grade; portanto, o c√°lculo do n√∫mero do corpo atual muda ligeiramente; caso contr√°rio, o kernel √© muito semelhante ao OpenCL, com exce√ß√£o de outros nomes. fun√ß√µes de sincroniza√ß√£o e especificador para mem√≥ria compartilhada.  Outro recurso distintivo √∫til do CUDA √© que podemos especificar o tamanho necess√°rio da mem√≥ria compartilhada quando o kernel √© iniciado.  Como na implementa√ß√£o do OpenCL, no in√≠cio de cada bloco de itera√ß√£o, copiamos parte dos dados na mem√≥ria compartilhada e, em seguida, trabalhamos com essa mem√≥ria de todas as threads do bloco. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo do kernel CUDA</b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">global__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kfcompute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n2, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> yoff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> foff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* mass, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> stride)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = blockDim.x * blockIdx.x + threadIdx.x; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rx = y + yoff; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* ry = rx + stride; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rz = rx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = rx[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = ry[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = rz[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> __shared__ <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> shared_xyzm_buf[]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* x2 = shared_xyzm_buf; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* y2 = x2 + blockDim.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* z2 = y2 + blockDim.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* m2 = z2 + blockDim.x; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> b2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; b2 &lt; points_count; b2 += blockDim.x) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n2 = b2 + offset_n2 + threadIdx.x; <span class="hljs-comment"><span class="hljs-comment">// Copy data block to local memory x2[ threadIdx.x ] = rx[n2]; y2[ threadIdx.x ] = ry[n2]; z2[ threadIdx.x ] = rz[n2]; m2[ threadIdx.x ] = mass[n2]; // Synchronize local work-items copy operations __syncthreads(); nbcoord_t local_res_x = 0.0; nbcoord_t local_res_y = 0.0; nbcoord_t local_res_z = 0.0; for(int n2 = 0; n2 != blockDim.x; ++n2) { nbcoord_t dx = x1 - x2[n2]; nbcoord_t dy = y1 - y2[n2]; nbcoord_t dz = z1 - z2[n2]; nbcoord_t r2 = (dx * dx + dy * dy + dz * dz); if(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } nbcoord_t r = sqrt(r2); nbcoord_t coeff = (m2[n2]) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; local_res_x -= dx; local_res_y -= dy; local_res_z -= dz; } // Synchronize local work-items computations __syncthreads(); res_x += local_res_x; res_y += local_res_y; res_z += local_res_z; } n1 += foff; f[n1 + 3 * stride] = res_x; f[n1 + 4 * stride] = res_y; f[n1 + 5 * stride] = res_z; }</span></span></code> </pre><br></div></div><br>  <b>Tabela 3.</b> <i>A depend√™ncia da fun√ß√£o de tempo de c√°lculo (em segundos)</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-737"><span class="MJXp-msubsup" id="MJXp-Span-738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-740" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-63-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-63"> f_n </script></i>   <i>no n√∫mero de corpos interagindo</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-741"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-742">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-64-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-64"> N </script></i>   <i>para v√°rias implementa√ß√µes de GPU e melhores implementa√ß√µes de CPU</i> <br><table><tbody><tr><th><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-743"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-744">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-65-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-65"> N </script></th><th>  4096 </th><th>  8192 </th><th>  16384 </th><th>  32768 </th><th>  65536 </th><th>  131072 </th></tr><tr><td>  openmp + block + otimiza√ß√£o </td><td>  0,0128 </td><td>  0,0495 </td><td>  0,194 </td><td>  0,774 </td><td>  --- </td><td>  --- </td></tr><tr><td>  OpenCL + meio NVidia K80 </td><td>  0,004 </td><td>  0,008 </td><td>  0,026 </td><td>  0,134 </td><td>  0,332 </td><td>  1,18 </td></tr><tr><td>  CUDA + meia NVidia K80 </td><td>  0,004 </td><td>  0,008 </td><td>  0,0245 </td><td>  0,111 </td><td>  0,291 </td><td>  1,13 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Onde obter NVidia K80</b> <div class="spoiler_text">  As implementa√ß√µes OpenCL e CUDA foram lan√ßadas no servi√ßo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Colab</a> gratuito do Google, que fornece acesso aos computadores NVidia K80.  Voc√™ pode ler mais sobre como trabalhar com este servi√ßo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hub</a> <br></div></div><br>  Em geral, o resultado √© decepcionante, apenas 5-6 vezes mais r√°pido que a implementa√ß√£o da CPU.  Mesmo se realizarmos c√°lculos em todo o K80, obteremos acelera√ß√£o at√© 12 vezes, mas desde  Como a complexidade da tarefa √© quadr√°tica, em um tempo razo√°vel, poderemos processar n√£o 32768 corpos em intera√ß√£o, mas 131072, o que √© apenas 4 vezes mais. <br><br><h2>  Fun√ß√£o Aproxima√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-745"><span class="MJXp-msubsup" id="MJXp-Span-746"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-747" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-748" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-66-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-66"> f_n </script></h2><br>  Se voc√™ observar atentamente a fun√ß√£o, definida pela for√ßa atrativa de dois corpos, fica claro que ela diminui quadraticamente com a dist√¢ncia.  Portanto, podemos calcular com precis√£o a for√ßa de intera√ß√£o entre corpos pr√≥ximos e aproximadamente entre corpos distantes.  Uma abordagem famosa <br>  √© um algoritmo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">c√≥digo de √°rvore</a> proposto por D. Barnes e P. Hat.  Uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvore octree</a> √© constru√≠da no espa√ßo simulado, contendo em suas folhas as coordenadas e massas dos corpos simulados.  Os n√≥s pais cont√™m o centro de massa, a massa total dos n√≥s filhos e o raio da esfera descrita ao redor dos corpos dos n√≥s filhos.  A raiz da √°rvore cont√©m o centro de massa de todos os corpos, sua massa total e o raio da esfera descrita ao seu redor.  Ao calcular a for√ßa de intera√ß√£o, a dist√¢ncia da raiz da √°rvore √© considerada primeiro se a raz√£o da dist√¢ncia do n√≥ ao seu raio for maior do que alguma constante <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-749"><span class="MJXp-mtext" id="MJXp-Span-750">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-752">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-755">d</span><span class="MJXp-msubsup" id="MJXp-Span-756"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-757" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-758" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-759">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-761">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-762">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-67-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-67"> \ lambda_ {crit} </script>  , ent√£o a raiz √© considerada um corpo com coordenadas iguais √†s coordenadas do centro de massa dos corpos inclu√≠dos nela e uma massa igual √† soma das massas dos n√≥s filhos, se a raz√£o for menor ou igual a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-763"><span class="MJXp-mtext" id="MJXp-Span-764">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-768">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">d</span><span class="MJXp-msubsup" id="MJXp-Span-770"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-771" style="margin-right: 0.05em;">a</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-772" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-773">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-774">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-775">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-776">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-68-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-68"> \ lambda_ {crit} </script>  , o procedimento √© repetido recursivamente para cada n√≥ filho.  Se uma folha de uma √°rvore √© alcan√ßada, a for√ßa de intera√ß√£o √© considerada da maneira usual.  Assim, se um corpo est√° longe do grupo compacto de outros corpos, esse grupo √© apresentado a ele como um corpo, e a for√ßa de intera√ß√£o √© calculada n√£o at√© cada corpo, mas apenas at√© um corpo.  Devido a isso, a complexidade do algoritmo diminui com o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-777"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-778">O</span><span class="MJXp-mo" id="MJXp-Span-779" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-780"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-781" style="margin-right: 0.05em;">N</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-782" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-783" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-69-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-69"> O (N ^ 2) </script>  antes <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-784"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-785">O</span><span class="MJXp-mo" id="MJXp-Span-786" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-787">N</span><span class="MJXp-mtext" id="MJXp-Span-788">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-789">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-790">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-791">g</span><span class="MJXp-mo" id="MJXp-Span-792" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-793">N</span><span class="MJXp-mo" id="MJXp-Span-794" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-795" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-70-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-70"> O (N \ log (N)) </script>  ao custo de alguma perda de precis√£o. <br><br>  Na minha abordagem, decidi n√£o usar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvore</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">octree</a> , mas a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√°rvore kd,</a> porque  √© mais f√°cil de usar e possui menor sobrecarga de armazenamento em compara√ß√£o com o octree. <br><br>  Vamos voltar √† implementa√ß√£o na CPU.  Um n√≥ da √°rvore kd pode ser representado na forma de uma classe que cont√©m ponteiros para os descendentes esquerdo e direito e informa√ß√µes sobre as coordenadas e a massa: <br><br><div class="spoiler">  <b class="spoiler_title">N√≥ da √°rvore Kd</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class"> {</span></span> node* m_left; <span class="hljs-comment"><span class="hljs-comment">//!&lt;   node* m_right; //!&lt;   nbvertex_t m_mass_center; //!&lt;     nbcoord_t m_mass; //!&lt;   nbcoord_t m_radius_sqr; //!&lt;    ,   lambda_crit nbvertex_t m_bmin; //!&lt;     nbvertex_t m_bmax; //!&lt;     size_t m_body_n; //!&lt;  ,    };</span></span></code> </pre><br></div></div><br>  Com esse m√©todo de armazenamento da √°rvore, temos duas op√ß√µes poss√≠veis para percorrer a √°rvore: use recurs√£o expl√≠cita ou use a pilha.  Eu decidi pela segunda op√ß√£o. <br><br><div class="spoiler">  <b class="spoiler_title">C√°lculo da for√ßa de intera√ß√£o atravessando uma √°rvore</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> force_compute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span>&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> mass1) { <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; node* stack_data[MAX_STACK_SIZE] = {}; node** <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = stack_data; node** stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = m_root; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { node* curr = *--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbcoord_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance_sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((v1 - curr-&gt;m_mass_center).norm())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(distance_sqr &gt; curr-&gt;m_radius_sqr) {<span class="hljs-comment"><span class="hljs-comment">//  ,       total_force += force(v1, curr-&gt;m_mass_center, mass1, curr-&gt;m_mass); } else {//   ,      if(curr-&gt;m_right != NULL) { *stack++ = curr-&gt;m_right; } if(curr-&gt;m_left != NULL) { *stack++ = curr-&gt;m_left; } } } return total_force; }</span></span></code> </pre><br></div></div><br>  Como no caso da implementa√ß√£o "exata" da CPU, a fun√ß√£o de c√°lculo de for√ßa √© chamada para cada corpo.  O ciclo em todos os corpos pode ser facilmente paralelizado usando diretivas OpenMP. <br><br>  Mas as itera√ß√µes de loop vizinhas, neste caso, se referem a partes completamente diferentes da √°rvore, o que n√£o permite o uso eficiente do cache do processador.  Para superar esse problema, todos os corpos precisam ser atravessados ‚Äã‚Äãn√£o na ordem inicial, mas na ordem em que os corpos est√£o localizados nas folhas da √°rvore kd, itera√ß√µes vizinhas ocorrer√£o para corpos que est√£o pr√≥ximos no espa√ßo e atravessar√£o a √°rvore por caminhos quase id√™nticos. <br><br><div class="spoiler">  <b class="spoiler_title">Travessia de folha de √°rvore</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">traverse</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">visit</span></span></span><span class="hljs-class">) {</span></span> node* stack_data[MAX_STACK_SIZE] = {}; node** <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = stack_data; node** stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = m_root; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { node* curr = *--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(curr-&gt;m_radius_sqr &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) {<span class="hljs-comment"><span class="hljs-comment">//  .    . if(curr-&gt;m_left != NULL) { *stack++ = curr-&gt;m_left; } if(curr-&gt;m_right != NULL) { *stack++ = curr-&gt;m_right; } } else {//   .  . visit(curr-&gt;m_body_n, curr-&gt;m_mass_center, curr-&gt;m_mass); } } }</span></span></code> </pre><br></div></div><br>  Essa implementa√ß√£o tem outro problema - n√£o h√° uma maneira universal de paralelizar essa travessia de √°rvore.  Mas podemos mudar completamente a maneira como a √°rvore √© armazenada na mem√≥ria - podemos armazenar todos os n√≥s em uma matriz linear e abandonar completamente o armazenamento de ponteiros para os descendentes, por analogia com a constru√ß√£o de uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pilha bin√°ria</a> .  Ao iniciar a numera√ß√£o de n√≥s com <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-796"><span class="MJXp-mn" id="MJXp-Span-797">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-71-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-71"> 1 </script>  se o n√≥ estiver no n√∫mero da c√©lula <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-798"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-799">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-72-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-72"> i </script>  , ent√£o o filho esquerdo dele est√° na cela <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-800"><span class="MJXp-mn" id="MJXp-Span-801">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-802">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-73-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-73"> 2i </script>  crian√ßa certa na c√©lula <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-803"><span class="MJXp-mn" id="MJXp-Span-804">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805">i</span><span class="MJXp-mo" id="MJXp-Span-806" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-807">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-74-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-74"> 2i + 1 </script>  e o pai na c√©lula <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-808"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">i</span><span class="MJXp-mrow" id="MJXp-Span-810"><span class="MJXp-mo" id="MJXp-Span-811" style="margin-left: 0.111em; margin-right: 0.111em;">/</span></span><span class="MJXp-mn" id="MJXp-Span-812">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-75-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-75"> i / 2 </script>  .  O n√≥ direito correspondente √† esquerda com o n√∫mero <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-813"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-814">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-76-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-76"> i </script>  ter√° um n√∫mero <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-815"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-816">i</span><span class="MJXp-mo" id="MJXp-Span-817" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-818">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-77-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-77"> i + 1 </script>  .  A matriz em si ter√° um comprimento <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-819"><span class="MJXp-mn" id="MJXp-Span-820">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-78-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-78"> 2N </script>  e todos os n√≥s das folhas estar√£o localizados no √∫ltimo <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-822"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-823">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-79-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-79"> N </script>  Al√©m disso, as c√©lulas com espa√ßamento estreito ser√£o localizadas nas c√©lulas pr√≥ximas da matriz.  A fun√ß√£o de passagem em √°rvore mudar√° um pouco, mas a estrutura permanece a mesma: <br><br><div class="spoiler">  <b class="spoiler_title">C√°lculo de for√ßa atravessando uma √°rvore em uma matriz</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> force_compute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span>&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> mass1) { <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>* <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = stack_data; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>* stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> curr = *--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbcoord_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance_sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((v1 - m_mass_center[curr]).norm())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(distance_sqr &gt; m_radius_sqr[curr]) { total_force += force(v1, m_mass_center[curr], mass1, m_mass[curr]); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> left(left_idx(curr)); <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> rght(rght_idx(curr)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; m_body_n.size()) { *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = rght; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; m_body_n.size()) { *<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++ = left; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> total_force; }</code> </pre><br></div></div><br>  Mas essas n√£o s√£o todas as possibilidades que o armazenamento dos n√≥s na matriz se abre para n√≥s - podemos recusar a pilha ao rastrear.  Para fazer isso, no ramo de c√≥digo no qual vamos para os filhos do n√≥, adicionamos a fun√ß√£o para calcular o pr√≥ximo n√≥ ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-824"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-825">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-826">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-827">x</span><span class="MJXp-msubsup" id="MJXp-Span-828"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-829" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-830" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-831">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-832">p</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-80-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-80"> next_ {up} </script>  ) e no ramo em que calculamos a for√ßa de intera√ß√£o, adicionamos o c√°lculo do pr√≥ximo n√≥ com a sub√°rvore atual ignorada ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-833"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-834">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-835">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836">i</span><span class="MJXp-msubsup" id="MJXp-Span-837"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-838" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-839" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-840">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-841">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-842">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-81-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-81"> skip_ {down} </script>  ) <br><br>  Para pular a sub√°rvore atual, precisamos ir at√© a raiz (dire√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-844"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-845">D</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-82-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-82"> D </script>  ), enquanto estamos no descendente direito, assim que alcan√ßamos a esquerda, vamos para a sub√°rvore direita correspondente (dire√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-846"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-847">R</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-83-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-83"> R </script>  ), se chegarmos √† raiz, a travessia da √°rvore ser√° conclu√≠da. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo da Fun√ß√£o Ignorar Sub√°rvore</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> skip_down(<span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> idx) { <span class="hljs-comment"><span class="hljs-comment">// While index is 'right' -&gt; go down while(is_right(idx)) { index_t parent = parent_idx(idx); // We at root again. Stop traverse. if(parent == NBODY_HEAP_ROOT_INDEX) { return NBODY_HEAP_ROOT_INDEX; } idx = parent; } return left2right(idx); }</span></span></code> </pre><br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/f29/d13/fe4/f29d13fe464d49022665ac28be8912cf.svg"><br>  <b>Figura 8.</b> <i>Ignorando uma sub√°rvore</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-848"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-850">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-851">i</span><span class="MJXp-msubsup" id="MJXp-Span-852"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-853" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-854" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-855">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-856">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-857">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-858">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-84-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-84"> skip_ {down} </script></i>   <i>.</i> <br><br>  Para ir para o pr√≥ximo n√≥, se poss√≠vel, v√° para o filho esquerdo (dire√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-859"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860">U</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-85-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-85"> U </script>  ) e, se n√£o houver descendente, v√° para o pr√≥ximo n√≥ 'de baixo' usando a fun√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-861"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-863">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864">i</span><span class="MJXp-msubsup" id="MJXp-Span-865"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-866" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-867" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-868">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-869">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-870">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-86-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-86"> skip_ {down} </script>  . <br><br><div class="spoiler">  <b class="spoiler_title">Ir para o pr√≥ximo c√≥digo de fun√ß√£o do n√≥</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> next_up(<span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> idx, <span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> tree_size) { <span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> left = left_idx(idx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> skip_down(idx); }</code> </pre><br></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/26d/909/a33/26d909a33c617b955c256a3f717fa116.svg"><br>  <b>Figura 9.</b> <i>Transi√ß√µes para o pr√≥ximo n√≥</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-872"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-874">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-875">x</span><span class="MJXp-msubsup" id="MJXp-Span-876"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-877" style="margin-right: 0.05em;">t</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-878" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-879">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-880">p</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-87-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-87"> next_ {up} </script></i>   <i>.</i> <br><br>  Pode parecer que substitu√≠mos a recurs√£o por um loop <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-881"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-882">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-883">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-884">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-885">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-886">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-887">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-888">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-889">o</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-88-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-88"> enquanto </script>  em fun√ß√£o <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-890"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-891">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-892">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-893">i</span><span class="MJXp-msubsup" id="MJXp-Span-894"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-895" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-896" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-897">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-898">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-899">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-900">n</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-89-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-89"> skip_ {down} </script>  , e essa substitui√ß√£o n√£o fornece nada, mas vamos ver como determinar se um n√≥ com um n√∫mero <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-901"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-902">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-90-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-90"> i </script>  descendente direito.  Isso pode ser feito simplesmente verificando seu n√∫mero √≠mpar (o filho certo est√° na c√©lula <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-903"><span class="MJXp-mn" id="MJXp-Span-904">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-905">i</span><span class="MJXp-mo" id="MJXp-Span-906" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-907">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-91-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-91"> 2i + 1 </script>  ), para isso basta calcular <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-908"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-909">i</span><span class="MJXp-mtext" id="MJXp-Span-910">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-911">e</span><span class="MJXp-mn" id="MJXp-Span-912">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-92-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-92"> i \ e 1 </script>  .  I.e.  n√≥s dividimos o n√∫mero <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-913"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-914">i</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-93-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-93"> i </script>  dois se o bit menos significativo estiver definido como um.  Mas isso pode ser feito sem um loop, em muitos processadores existe uma instru√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">find first set</a> que retorna a posi√ß√£o do primeiro bit configurado, usando-o, transformamos o loop em quatro instru√ß√µes do processador. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo de fun√ß√£o de sub√°rvore de salto otimizado</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> skip_down(<span class="hljs-keyword"><span class="hljs-keyword">index_t</span></span> idx) { idx = idx &gt;&gt; (__builtin_ffs(~idx) - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> left2right(idx); }</code> </pre><br></div></div><br>  Depois disso, podemos excluir a pilha da fun√ß√£o de deslocamento em √°rvore e substitu√≠-la por um par <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-915"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-916">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-917">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-918">i</span><span class="MJXp-msubsup" id="MJXp-Span-919"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-920" style="margin-right: 0.05em;">p</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-921" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-922">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-923">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-924">w</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-925">n</span></span></span><span class="MJXp-mo" id="MJXp-Span-926" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-927">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-928">r</span><span class="MJXp-mrow" id="MJXp-Span-929"><span class="MJXp-mo" id="MJXp-Span-930" style="margin-left: 0em; margin-right: 0em;">√≥</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-931">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-932">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-933">m</span><span class="MJXp-msubsup" id="MJXp-Span-934"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-935" style="margin-right: 0.05em;">o</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-936" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-937">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-938">p</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-94-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-94"> skip_ {down} + pr√≥ximo_ {up} </script>  , depois disso a fun√ß√£o parece ainda mais simples: <br><br><div class="spoiler">  <b class="spoiler_title">C√°lculo de for√ßa atravessando uma √°rvore em uma matriz sem usar uma pilha</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> force_compute(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span>&amp; v1, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> mass1) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">nbvertex_t</span></span> total_force; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> curr = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> tree_size = m_mass_center.size(); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> nbcoord_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">distance_sqr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((v1 - m_mass_center[curr]).norm())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(distance_sqr &gt; m_radius_sqr[curr]) { total_force += force(v1, m_mass_center[curr], mass1, m_mass[curr]); curr = skip_down(curr); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { curr = next_up(curr, tree_size); } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(curr != NBODY_HEAP_ROOT_INDEX); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> total_force; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No total, obtivemos seis combina√ß√µes de deslocamento de √°rvore e c√°lculo de for√ßa. </font><font style="vertical-align: inherit;">Compare essas abordagens em termos de tempo e qualidade de computa√ß√£o. </font><font style="vertical-align: inherit;">Tomamos como medida de qualidade a mudan√ßa relativa na energia total do sistema ap√≥s 100 itera√ß√µes. </font><font style="vertical-align: inherit;">Como sistema modelo, tomamos duas "gal√°xias" interagindo consistindo em</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-939"><span class="MJXp-mn" id="MJXp-Span-940">16384</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-95-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-95">16384</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corpos cada. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela 4. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Combina√ß√µes do m√©todo transversal de √°rvore e c√°lculo de for√ßa</font></font></i> <br><table><tbody><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Tipo de c√°lculo de deslocamento / for√ßa em √°rvore </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √Årvore com pilha </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'Pilha' com uma pilha </font></font></th><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 'Heap' sem uma pilha </font></font></th></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Itera√ß√µes por n√∫mero do corpo </font></font></th><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ciclo + √°rvore </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ciclo + pilha </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cycle + heapstackless </font></font></td></tr><tr><th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bypass de folhas </font></font></th><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nestedtree + tree </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nestedtree + heap </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nestedtree + heapstackless </font></font></td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/dc4/be0/e89/dc4be0e898fd575d0bdf4228a5310884.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/aa2/ca4/e2d/aa2ca4e2daa0cfa77f59f0e6112a3714.svg"><br></a> <br></td></tr><tr><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a) </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depend√™ncia do tempo de c√°lculo da fun√ß√£o</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-941"><span class="MJXp-msubsup" id="MJXp-Span-942"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-943" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-944" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-96-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-96">f_n</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da raz√£o entre a dist√¢ncia cr√≠tica e o n√≥ da √°rvore e seu raio (</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-945"><span class="MJXp-msubsup" id="MJXp-Span-946"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-947" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-948" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-949">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-950">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-951">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-952">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-97-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-97">\lambda_{crit}</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></i> </td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b) </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A depend√™ncia da mudan√ßa relativa de energia no sistema na raz√£o entre a dist√¢ncia cr√≠tica e o n√≥ da √°rvore e seu raio (</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-953"><span class="MJXp-msubsup" id="MJXp-Span-954"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-955" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-956" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-957">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-958">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-959">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-960">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-98-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-98">\lambda_{crit}</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></i> </td></tr><tr><td colspan="2" align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Figura 10. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados do c√°lculo da fun√ß√£o</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-961"><span class="MJXp-msubsup" id="MJXp-Span-962"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-963" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-964" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-99-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-99">f_n</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de v√°rias maneiras na CPU (n√∫mero de corpos</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-965"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-966">N</span><span class="MJXp-mo" id="MJXp-Span-967" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-968">32768</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-100-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-100">N=32768</script></i>   <i>)</i> </td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pode-se ver que a implementa√ß√£o de 'nestedtree + tree' est√° irremediavelmente atrasada, porque </font><font style="vertical-align: inherit;">falta concorr√™ncia. </font><font style="vertical-align: inherit;">Implementa√ß√µes com a localiza√ß√£o de n√≥s de √°rvore na matriz e a indexa√ß√£o como em um heap bin√°rio est√£o na lideran√ßa. </font><font style="vertical-align: inherit;">A mudan√ßa relativa de energia √© insignificante para todas as variantes com</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-969"><span class="MJXp-msubsup" id="MJXp-Span-970"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-971" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-972" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-973">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-974">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-975">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-976">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-977" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-978">1</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-101-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-101">\lambda_{crit} > 1</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m na fig. </font><font style="vertical-align: inherit;">10a mostra que para (</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-979"><span class="MJXp-msubsup" id="MJXp-Span-980"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-981" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-982" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-983">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-984">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-985">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-986">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-987" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-988">10</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-102-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-102">\lambda_{crit} < 10</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) todas as variantes do c√°lculo da fun√ß√£o </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-989"><span class="MJXp-msubsup" id="MJXp-Span-990"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-991" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-992" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-103-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-103">f_n</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ultrapassar significativamente a velocidade da vers√£o mais otimizada do c√°lculo exato ('openmp + bloco + otimiza√ß√£o'), com um aumento adicional </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-993"><span class="MJXp-msubsup" id="MJXp-Span-994"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-995" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-996" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-998">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-999">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1000">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-104-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-104">\lambda_{crit}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> implementa√ß√µes com uma √°rvore perdem a vers√£o exata. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Travessal em √°rvore da GPU </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tentei ignorar a √°rvore na GPU usando a tecnologia OpenCL e CUDA. </font><font style="vertical-align: inherit;">A op√ß√£o de armazenar n√≥s na forma de uma √°rvore foi imediatamente descartada e apenas as op√ß√µes foram deixadas com o armazenamento da √°rvore em uma matriz com indexa√ß√£o como em uma pilha bin√°ria. </font><font style="vertical-align: inherit;">Em geral, a implementa√ß√£o do n√∫cleo de computa√ß√£o n√£o √© muito diferente da vers√£o da CPU.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernel OpenCL para aumentar a capacidade de computa√ß√£o atravessando uma √°rvore (travessia na ordem dos corpos de numera√ß√£o)</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">kernel </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeTreeBH</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmx, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmy, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmz, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_mass, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_crit_r2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>) + offset_n1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rx = y; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* ry = rx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* rz = rx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vx = rx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vy = rx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vz = rx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frx = f; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fry = frx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frz = frx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvx = frx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvy = frx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvz = frx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = rx[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = ry[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = rz[n1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = stack_data[--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - tree_cmx[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - tree_cmy[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - tree_cmz[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; tree_crit_r2[curr]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tree_mass[curr] / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = left_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rght = rght_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = left; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = rght; } } } frx[n1] = vx[n1]; fry[n1] = vy[n1]; frz[n1] = vz[n1]; fvx[n1] = res_x; fvy[n1] = res_y; fvz[n1] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na primeira vers√£o, o percurso da √°rvore come√ßou na ordem de numera√ß√£o dos corpos na matriz original; portanto, os threads vizinhos ignoraram partes completamente diferentes da √°rvore, o que afetou negativamente o desempenho do cache de mem√≥ria da GPU. </font><font style="vertical-align: inherit;">Portanto, na segunda modalidade, uma travessia foi aplicada, come√ßando do topo da √°rvore, neste caso, os segmentos vizinhos come√ßam a atravessar a √°rvore pelo mesmo caminho, porque </font><font style="vertical-align: inherit;">as copas das √°rvores vizinhas est√£o pr√≥ximas e no espa√ßo. </font><font style="vertical-align: inherit;">Tamb√©m √© importante escolhermos a numera√ß√£o na matriz de n√≥s da √°rvore n√£o do zero, mas de uma, neste caso, as folhas da √°rvore s√£o armazenadas na segunda metade da matriz e, com o n√∫mero de corpos igual √† pot√™ncia de dois, teremos acesso igual √† mem√≥ria pelo √≠ndice tn1.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernel do OpenCL para calcular a for√ßa atravessando uma √°rvore (atravessando os n√≥s de numera√ß√£o de uma √°rvore)</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">kernel </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ComputeHeapBH</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* y, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmx, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmy, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_cmz, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_mass, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tree_crit_r2, __global </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* body_n)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tree_offset = points_count - <span class="hljs-number"><span class="hljs-number">1</span></span> + NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tn1 = get_global_id(<span class="hljs-number"><span class="hljs-number">0</span></span>) + offset_n1 + tree_offset; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = body_n[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = tree_cmx[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = tree_cmy[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = tree_cmz[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = stack_data[--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - tree_cmx[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - tree_cmy[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - tree_cmz[curr]; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; tree_crit_r2[curr]) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tree_mass[curr] / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = left_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rght = rght_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = left; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = rght; } } } __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vx = y + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vy = y + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* vz = y + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frx = f; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fry = frx + stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* frz = frx + <span class="hljs-number"><span class="hljs-number">2</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvx = frx + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvy = frx + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride; __global <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>* fvz = frx + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride; frx[n1] = vx[n1]; fry[n1] = vy[n1]; frz[n1] = vz[n1]; fvx[n1] = res_x; fvy[n1] = res_y; fvz[n1] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao percorrer a ordem de numera√ß√£o dos n√≥s da √°rvore, obtivemos um aumento de desempenho. Mas esta op√ß√£o tamb√©m pode ser melhorada. A mem√≥ria global na qual os n√≥s da √°rvore est√£o localizados atualmente √© otimizada para </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acesso compartilhado</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , ou seja, threads de um grupo devem ler palavras localizadas em um bloco de mem√≥ria. No nosso caso, o percurso da √°rvore come√ßa nos mesmos caminhos, e solicitamos os mesmos dados com todos os threads do grupo, mas quanto mais nos aprofundamos na √°rvore, os caminhos dos threads vizinhos divergem cada vez mais, e precisamos solicitar dados diferentes, o que reduz o desempenho do subsistema v√°rias vezes. mem√≥ria. Mas os n√≥s de cada sub√°rvore pertencente ao mesmo n√≠vel est√£o localizados em c√©lulas de mem√≥ria relativamente pr√≥ximas.</font></font> I.e.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ao percorrer o restante da √°rvore, os segmentos vizinhos do n√∫cleo de computa√ß√£o n√£o acessam os mesmos n√≥s da √°rvore, mas localizados na mem√≥ria. </font><font style="vertical-align: inherit;">Para otimizar esse acesso √† mem√≥ria, pode ser usada mem√≥ria de textura. </font><font style="vertical-align: inherit;">Mas h√° um problema. </font><font style="vertical-align: inherit;">No momento, as texturas n√£o suportam o trabalho com dados de precis√£o dupla (queremos calcular com precis√£o). </font><font style="vertical-align: inherit;">Mas no CUDA h√° uma fun√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__hiloint2double</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que coleta um n√∫mero de precis√£o dupla de dois n√∫meros inteiros.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de solicita√ß√£o de n√∫mero de precis√£o dupla a partir de uma textura que armazena n√∫meros inteiros</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nb1Dfetch</span></span></span><span class="hljs-class">&lt;double&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> double4 vec4; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> __<span class="hljs-function"><span class="hljs-function">device__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cudaTextureObject_t tex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">int2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tex1Dfetch&lt;int2&gt;(tex, i))</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> __hiloint2double(py, px); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> __<span class="hljs-function"><span class="hljs-function">device__ vec4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetch4</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cudaTextureObject_t tex, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ii</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * i)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">int4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tex1Dfetch&lt;int4&gt;(tex, ii))</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">int4 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">p2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tex1Dfetch&lt;int4&gt;(tex, ii + </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">))</span></span></span></span>; vec4 d4 = {__hiloint2double(p1.y, p1.x), __hiloint2double(p1.w, p1.z), __hiloint2double(p2.y, p2.x), __hiloint2double(p2.w, p2.z) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d4; } };</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nesse caso, duas implementa√ß√µes foram feitas, em uma cada elemento da √°rvore (x, y, z, tree_crit_r2) foi solicitado independentemente, e na segunda implementa√ß√£o essas solicita√ß√µes foram combinadas. </font><font style="vertical-align: inherit;">A solicita√ß√£o para a massa do n√≥ ocorre com muito menos frequ√™ncia, apenas se a condi√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r2&gt; tree_crit_r2 [curr] for atendida</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , portanto, n√£o faz sentido combinar essa solicita√ß√£o com as outras. </font><font style="vertical-align: inherit;">Outro recurso √∫til da estrutura CUDA √© a capacidade de controlar a propor√ß√£o dos tamanhos do cache L1 e o tamanho da mem√≥ria compartilhada ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cudaFuncSetCacheConfig</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). </font><font style="vertical-align: inherit;">No caso de passagem de √°rvore, n√£o usamos mem√≥ria compartilhada, portanto, podemos aumentar o cache L1 em ‚Äã‚Äãdetrimento dele.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kernel CUDA para calcular a for√ßa atravessando uma √°rvore (atravessando a ordem de numera√ß√£o dos n√≥s da √°rvore)</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">global__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kfcompute_heap_bh_tex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, cudaTextureObject_t tree_xyzr, cudaTextureObject_t tree_mass, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* body_n)</span></span></span><span class="hljs-function"> </span></span>{ nb1Dfetch&lt;<span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>&gt; tex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tree_offset = points_count - <span class="hljs-number"><span class="hljs-number">1</span></span> + NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tn1 = blockDim.x * blockIdx.x + threadIdx.x + offset_n1 + tree_offset; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = body_n[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr = tex.fetch4(tree_xyzr, tn1); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = xyzr.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = xyzr.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = xyzr.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_data[MAX_STACK_SIZE] = {}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stack_head = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>; stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span> != stack_head) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = stack_data[--<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr2 = tex.fetch4(tree_xyzr, curr); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - xyzr2.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - xyzr2.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - xyzr2.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; xyzr2.w) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tex.fetch(tree_mass, curr) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> left = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::left_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rght = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::rght_idx(curr); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(left &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = left; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rght &lt; tree_size) { stack_data[<span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>++] = rght; } } } f[n1 + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride] = res_x; f[n1 + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride] = res_y; f[n1 + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma an√°lise do programa no nvprof profiler mostrou que, mesmo ao usar a mem√≥ria de textura para armazenar uma √°rvore, ainda h√° uma carga muito alta na mem√≥ria global. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De fato, no CUDA, toda a mem√≥ria do kernel endere√ßada a endere√ßos 'calculados' √© armazenada na mem√≥ria global e, portanto, a pilha necess√°ria para percorrer a √°rvore est√° localizada na mem√≥ria global e consome uma parte significativa da largura de banda do chip de mem√≥ria, porque a pilha possui cada thread de execu√ß√£o e h√° muitos threads. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas, felizmente, j√° sabemos como atravessar uma √°rvore sem usar uma pilha. </font><font style="vertical-align: inherit;">Complementando o n√∫cleo computacional anterior com as fun√ß√µes de calcular o pr√≥ximo n√≥ da √°rvore, obtemos um novo kernel, al√©m disso, mais compacto.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√∫cleo CUDA para a for√ßa da computa√ß√£o atravessando uma √°rvore sem usar uma pilha</font></font></b> <div class="spoiler_text"><pre> <code class="cpp hljs">__<span class="hljs-function"><span class="hljs-function">global__ </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kfcompute_heap_bh_stackless</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offset_n1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> points_count, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tree_size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">nbcoord_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">* f, cudaTextureObject_t tree_xyzr, cudaTextureObject_t tree_mass, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* body_n)</span></span></span><span class="hljs-function"> </span></span>{ nb1Dfetch&lt;<span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span>&gt; tex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tree_offset = points_count - <span class="hljs-number"><span class="hljs-number">1</span></span> + NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stride = points_count; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tn1 = blockDim.x * blockIdx.x + threadIdx.x + offset_n1 + tree_offset; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> n1 = body_n[tn1]; <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr = tex.fetch4(tree_xyzr, tn1); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> x1 = xyzr.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> y1 = xyzr.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> z1 = xyzr.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_x = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_y = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> res_z = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> curr = NBODY_HEAP_ROOT_INDEX; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">nbvec4_t</span></span> xyzr2 = tex.fetch4(tree_xyzr, curr); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dx = x1 - xyzr2.x; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dy = y1 - xyzr2.y; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> dz = z1 - xyzr2.z; <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r2 = (dx * dx + dy * dy + dz * dz); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &gt; xyzr2.w) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(r2 &lt; NBODY_MIN_R) { r2 = NBODY_MIN_R; } <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> r = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(r2); <span class="hljs-keyword"><span class="hljs-keyword">nbcoord_t</span></span> coeff = tex.fetch(tree_mass, curr) / (r * r2); dx *= coeff; dy *= coeff; dz *= coeff; res_x -= dx; res_y -= dy; res_z -= dz; curr = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::skip_idx(curr); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { curr = nbody_heap_func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;::next_up(curr, tree_size); } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(curr != NBODY_HEAP_ROOT_INDEX); f[n1 + <span class="hljs-number"><span class="hljs-number">3</span></span> * stride] = res_x; f[n1 + <span class="hljs-number"><span class="hljs-number">4</span></span> * stride] = res_y; f[n1 + <span class="hljs-number"><span class="hljs-number">5</span></span> * stride] = res_z; }</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O desempenho dos n√∫cleos em execu√ß√£o na GPU depende muito do tamanho dos blocos nos quais dividimos a tarefa. Depende desse tamanho, quantos registros, mem√≥ria local e outros recursos estar√£o dispon√≠veis para cada thread de computa√ß√£o. Voc√™ tamb√©m deve ter em mente que, enquanto aguarda o acesso √† mem√≥ria em um thread, outro thread pode executar c√°lculos no processador de sombreador, portanto, com um n√∫mero suficiente de threads em execu√ß√£o simultaneamente em um processador, o tempo de acesso √† mem√≥ria ficar√° oculto por tr√°s dos c√°lculos. Portanto, antes de comparar o desempenho de nossos n√∫cleos, precisamos calcular o tamanho ideal do bloco para cada um deles. Vamos fazer uma compara√ß√£o na metade dispon√≠vel da NVidia K80 para n√≥s. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tabela 5. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A depend√™ncia da fun√ß√£o de tempo de c√°lculo (em segundos)</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1001"><span class="MJXp-msubsup" id="MJXp-Span-1002"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1003" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1004" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-105-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-105">f_n</script></i>  <i>     GPU    </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1005"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1006">N</span><span class="MJXp-mo" id="MJXp-Span-1007" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1008">131072</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-106-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-106">N=131072</script></i>  <i></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1009"><span class="MJXp-msubsup" id="MJXp-Span-1010"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1012" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1013">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1014">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1016">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1017" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1018">10</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-107-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-107">\lambda_{crit}=10</script></i> <br><table><tbody><tr><th>  / </th><th>  8 </th><th> 16 </th><th>  32. </th><th>  64 </th><th> 128 </th><th> 256 </th><th> 512 </th><th> 1024 </th></tr><tr><td> opencl+dense </td><td> 5.77 </td><td> 2.84 </td><td> 1.46 </td><td> <b>1.13</b> </td><td> 1.15 </td><td> 1.14 </td><td> 1.14 </td><td> 1.13 </td></tr><tr><td> cuda+dense </td><td> 5.44 </td><td> 2.55 </td><td> 1.27 </td><td> <b>0.96</b> </td><td> 0.97 </td><td> 0.99 </td><td> 0.99 </td><td>  - </td></tr><tr><td> opencl+heap+cycle </td><td> 5.88 </td><td> 5.65 </td><td> 5.74 </td><td> 5.96 </td><td> 5.37 </td><td> 5.38 </td><td> <b>5.35</b> </td><td> 5.38 </td></tr><tr><td> opencl+heap+nested </td><td> 4.54 </td><td>  <b>3,68</b> </td><td> 3.98 </td><td> 5.25 </td><td> 5.46 </td><td> 5.41 </td><td> 5.48 </td><td> 5.31 </td></tr><tr><td> cuda+heap+nested </td><td>  3,62 </td><td>  2,81 </td><td>  <b>2,68</b> </td><td> 4.26 </td><td> 4.84 </td><td> 4.75 </td><td> 4.8 </td><td> 4.67 </td></tr><tr><td> cuda+heap+nested+tex </td><td> 2.6 </td><td> 1.51 </td><td> 0.912 </td><td> <b>0.7</b> </td><td> 1.85 </td><td> 1.75 </td><td> 1.69 </td><td> 1.61 </td></tr><tr><td> cuda+heap+nested+tex+stackless </td><td> 2.3 </td><td> 1.29 </td><td> 0.773 </td><td> <b>0.5</b> </td><td> 0.51 </td><td> 0.52 </td><td> 0.52 </td><td> 0.52 </td></tr></tbody></table><br><br> <b> 6.</b> <i>   ( ) </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1019"><span class="MJXp-msubsup" id="MJXp-Span-1020"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1021" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1022" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-108-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-108">f_n</script></i>  <i>     GPU    </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1023"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1024">N</span><span class="MJXp-mo" id="MJXp-Span-1025" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1026">1</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1027">M</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-109-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-109">N=1M</script></i>  <i></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1028"><span class="MJXp-msubsup" id="MJXp-Span-1029"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1030" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1031" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1032">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1033">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1034">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1035">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1036" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1037">4</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-110-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-110">\lambda_{crit}=4</script></i> <br><table><tbody><tr><th>  / </th><th>  8 </th><th> 16 </th><th>  32. </th><th>  64 </th><th> 128 </th><th> 256 </th><th> 512 </th><th> 1024 </th></tr><tr><td> opencl+dense </td><td> 366 </td><td> 179 </td><td> 89.9 </td><td> 69.3 </td><td> 70.3 </td><td> 69.1 </td><td> 68.9 </td><td> <b>68.0</b> </td></tr><tr><td> cuda+dense </td><td> 346 </td><td> 162 </td><td> 79.6 </td><td> 60.8 </td><td> 60.8 </td><td> 60.7 </td><td> <b>59.6</b> </td><td>  - </td></tr><tr><td> opencl+heap+cycle </td><td> <b>16.2</b> </td><td> 18.2 </td><td> 20.1 </td><td> 21.2 </td><td> 21.2 </td><td> 21.3 </td><td> 21.2 </td><td> 21.1 </td></tr><tr><td> opencl+heap+nested </td><td> 10.5 </td><td> 7.63 </td><td> <b>6.38</b> </td><td> 8.23 </td><td> 9.95 </td><td> 9.89 </td><td> 9.65 </td><td> 9.66 </td></tr><tr><td> cuda+heap+nested </td><td> 8.67 </td><td> 6.44 </td><td> <b>5.39</b> </td><td> 5.93 </td><td> 8.65 </td><td> 8.61 </td><td> 8.41 </td><td> 8.27 </td></tr><tr><td> cuda+heap+nested+tex </td><td> 6.38 </td><td>  3.57 </td><td> 2.13 </td><td> <b>1.44</b> </td><td> 3.56 </td><td> 3.46 </td><td> 3.30 </td><td> 3.29 </td></tr><tr><td> cuda+heap+nested+tex+stackless </td><td> 5.78 </td><td> 3.19 </td><td> 1.83 </td><td> 1.21 </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.11 </font></font></td><td> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,10</font></font></b> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.11 </font></font></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1,13 </font></font></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma situa√ß√£o dif√≠cil, mas, diferentemente da vers√£o da CPU do percurso da √°rvore, √© claro que cada etapa de otimiza√ß√£o traz resultados tang√≠veis. </font><font style="vertical-align: inherit;">A implementa√ß√£o do 'opencl + heap + cycle' √© quase 6 vezes mais lenta que uma solu√ß√£o exata com c√°lculo de fun√ß√£o completa</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1038"><span class="MJXp-msubsup" id="MJXp-Span-1039"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1040" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1041" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-111-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-111">f_n</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma implementa√ß√£o de 'opencl + heap + nested', na qual uma travessia de √°rvore inicia nos n√≥s vizinhos, 1,4 vezes mais r√°pido que o anterior, porque A mem√≥ria cache √© usada melhor. Na implementa√ß√£o de 'cuda + heap + anested', o cache L1 foi aumentado em detrimento da mem√≥ria compartilhada, o que aumentou a velocidade em 1,4 vezes, embora seja poss√≠vel que na implementa√ß√£o do cuda o kernel de compila√ß√£o seja mais otimizado (nas vers√µes de 'opencl + denso' e 'cuda os n√∫cleos + densos s√£o id√™nticos e o desempenho da vers√£o do cuda √© ~ 1,2 vezes maior). O aumento mais significativo na velocidade computacional (3,8 vezes) √© alcan√ßado quando a √°rvore est√° localizada na mem√≥ria de textura e as consultas aos elementos do n√≥ da √°rvore s√£o combinadas. A implementa√ß√£o com o deslocamento em √°rvore sem usar a pilha 'cuda + heap + nested + tex + stackless' tamb√©m √© 1,4 vezes mais r√°pida.nele, toda a largura de banda do barramento de mem√≥ria √© usada apenas para acessar dados sobre n√≥s da √°rvore e n√£o √© gasta na pilha. Assim, com</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1042"><span class="MJXp-msubsup" id="MJXp-Span-1043"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1044" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1045" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1046">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1047">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1048">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1049">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1050" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1051">10</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-112-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-112">\lambda_{crit}=10</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Foi poss√≠vel alcan√ßar a acelera√ß√£o duas vezes em compara√ß√£o com o c√°lculo completo da fun√ß√£o </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1052"><span class="MJXp-msubsup" id="MJXp-Span-1053"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1054" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1055" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-113-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-113">f_n</script>  .  Mas <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1056"><span class="MJXp-msubsup" id="MJXp-Span-1057"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1058" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1059" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1060">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1061">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1062">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1063">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1064" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1065">10</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-114-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-114">\lambda_{crit}=10</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> um valor excessivamente grande do par√¢metro, no gr√°fico da mudan√ßa relativa de energia no sistema, da raz√£o entre a dist√¢ncia cr√≠tica e o n√≥ da √°rvore e seu raio para a implementa√ß√£o da CPU, pode ser visto que valores mais baixos podem ser usados </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1066"><span class="MJXp-msubsup" id="MJXp-Span-1067"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1068" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1069" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1070">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1071">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1072">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1073">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-115-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-115">\lambda_{crit}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem uma perda vis√≠vel de precis√£o. </font><font style="vertical-align: inherit;">Vamos tentar variar</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1074"><span class="MJXp-msubsup" id="MJXp-Span-1075"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1076" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1077" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1078">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1079">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1080">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1081">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-116-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-116">\lambda_{crit}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com os tamanhos de bloco ideais que determinamos na etapa anterior. </font></font><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ae8/8b7/344/ae88b7344bf6c884545168e2870edeec.svg"><br></a> <br></td><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/85e/073/df6/85e073df6103f00705376ff7deb32ca1.svg"><br></a> <br></td></tr><tr><td align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></b> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1082"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1083">N</span><span class="MJXp-mo" id="MJXp-Span-1084" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1085">128</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1086">K</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-117-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-117">N=128K</script><br></td><td align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b)</font></font></b> <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1087"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1088">N</span><span class="MJXp-mo" id="MJXp-Span-1089" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1090">1</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1091">M</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-118-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-118">N=1M</script><br></td></tr><tr><td colspan="2" align="center"> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fig. 11. </font></font></b> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Depend√™ncia do tempo de c√°lculo da fun√ß√£o.</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1092"><span class="MJXp-msubsup" id="MJXp-Span-1093"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1094" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1095" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-119-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-119">f_n</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da raz√£o entre a dist√¢ncia cr√≠tica e o n√≥ da √°rvore e seu raio (</font></font></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1096"><span class="MJXp-msubsup" id="MJXp-Span-1097"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1098" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1099" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1100">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1101">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1102">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1103">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-120-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-120">\lambda_{crit}</script></i>  <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) para v√°rias implementa√ß√µes de passeio em √°rvore da GPU</font></font></i> <br></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pode-se ver que, para pequenas </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1104"><span class="MJXp-msubsup" id="MJXp-Span-1105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1106" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1107" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1108">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1109">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1110">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1111">t</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-121-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-121">\lambda_{crit}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> todos os m√©todos de c√°lculo de fun√ß√µes </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1112"><span class="MJXp-msubsup" id="MJXp-Span-1113"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1114" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1115" style="vertical-align: -0.4em;">n</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-122-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-122">f_n</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√° para valores pr√≥ximos, determinados no momento da constru√ß√£o da √°rvore kd e da prepara√ß√£o dos dados para a GPU. </font><font style="vertical-align: inherit;">Al√©m disso, o tempo de constru√ß√£o de uma √°rvore contribui significativamente para o tempo total de</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1116"><span class="MJXp-msubsup" id="MJXp-Span-1117"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1118" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1119" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1120">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1121">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1122">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1123">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1124" style="margin-left: 0.333em; margin-right: 0.333em;">‚â§</span><span class="MJXp-mn" id="MJXp-Span-1125">4</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-123-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-123">\lambda_{crit}\leq 4</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, esse tempo pode ser negligenciado. </font><font style="vertical-align: inherit;">√â interessante notar que quando</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1126"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1127">N</span><span class="MJXp-mo" id="MJXp-Span-1128" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1129">128</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1130">K</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-124-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-124">N=128K</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> o desempenho melhora novamente ao atingir </font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1131"><span class="MJXp-msubsup" id="MJXp-Span-1132"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1133" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1134" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1135">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1136">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1137">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1138">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1139" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1140">1024</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-125-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-125">\lambda_{crit}=1024</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provavelmente isso se deve ao fato de que todos os threads da GPU percorrem os mesmos v√©rtices da √°rvore ao mesmo tempo, o que melhora o uso do cache L1 e elimina completamente a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'diverg√™ncia de ramifica√ß√£o'</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tamb√©m √© visto que, com o melhor desempenho para uma implementa√ß√£o sem uma pilha (cuda + heap + nested + tex + stackless), ele supera a vers√£o com a pilha em aproximadamente</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1141"><span class="MJXp-mn" id="MJXp-Span-1142">1.4</span><span class="MJXp-mo" id="MJXp-Span-1143" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mn" id="MJXp-Span-1144">1.5</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-126-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-126">1.4-1.5</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vezes. </font><font style="vertical-align: inherit;">Outras implementa√ß√µes s√£o v√°rias vezes mais lentas. </font><font style="vertical-align: inherit;">Para consolidar o resultado, calcularemos o tempo em uma GPU com uma arquitetura mais nova.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resultados de lan√ßamento da GeForce GTX 1080 Ti (precis√£o √∫nica)</font></font></b> <div class="spoiler_text"> <b> 7.</b> <i>   ( ) </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1145"><span class="MJXp-msubsup" id="MJXp-Span-1146"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1147" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1148" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-127">f_n</script></i>  <i>     GPU    </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1150">N</span><span class="MJXp-mo" id="MJXp-Span-1151" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1152">1</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1153">M</span></span></span><script type="math/tex" id="MathJax-Element-128">N=1M</script></i>  <i></i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1154"><span class="MJXp-msubsup" id="MJXp-Span-1155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1156" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1157" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1158">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1159">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1160">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1161">t</span></span></span><span class="MJXp-mo" id="MJXp-Span-1162" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-1163">4</span></span></span><script type="math/tex" id="MathJax-Element-129">\lambda_{crit}=4</script></i> <br><table><tbody><tr><th>  / </th><th>  8 </th><th> 16 </th><th>  32. </th><th>  64 </th><th> 128 </th><th> 256 </th><th> 512 </th><th> 1024 </th></tr><tr><td> opencl+dense </td><td> 47.8 </td><td> 23.4 </td><td> 11.6 </td><td> <b>11.59</b> </td><td> 12.8 </td><td> 12.8 </td><td> 12.8 </td><td> 12.8 </td></tr><tr><td> cuda+dense </td><td> 49.0 </td><td> 23.8 </td><td> 11.9 </td><td> 11.8 </td><td> <b>11.7</b> </td><td> 11.7 </td><td> 11.7 </td><td> 11.7 </td></tr><tr><td> opencl+heap+cycle </td><td> 7.48 </td><td> 8.26 </td><td> 7.73 </td><td> 7.36 </td><td> 7.33 </td><td> <b>7.27</b> </td><td> 7.25 </td><td> 7.26 </td></tr><tr><td> opencl+heap+nested </td><td> 1.33 </td><td> <b>1.20</b> </td><td> 1.41 </td><td> 2.46 </td><td> 2.53 </td><td> 2.49 </td><td> 2.44 </td><td> 2.47 </td></tr><tr><td> cuda+heap+nested </td><td> 1.23 </td><td> <b>1.10</b> </td><td> 1.31 </td><td> 2.28 </td><td> 2.29 </td><td> 2.28 </td><td> 2.23 </td><td> 2.25 </td></tr><tr><td> cuda+heap+nested+tex </td><td> 0.88 </td><td> 0.68 </td><td> <b>0.654</b> </td><td>  1.6 </td><td>  1.6 </td><td>  1.6 </td><td>  1.6 </td><td>  1.6 </td></tr><tr><td> cuda+heap+nested+tex+stackless </td><td> 0.71 </td><td> 0.47 </td><td> 0.45 </td><td> 0.43 </td><td> 0.43 </td><td> 0.42 </td><td> 0.41 </td><td> <b>0.395</b> </td></tr></tbody></table><br><table><tbody><tr><td align="center"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/b14/d81/e27/b14d81e271e2edf7b1d70faa815e1710.svg"><br></a> <br></td></tr><tr><td align="center"> <b> 12.</b> <i>   </i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1164"><span class="MJXp-msubsup" id="MJXp-Span-1165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166" style="margin-right: 0.05em;">f</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1167" style="vertical-align: -0.4em;">n</span></span></span></span><script type="math/tex" id="MathJax-Element-130">f_n</script></i>  <i>          (</i> <math> </math><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1168"><span class="MJXp-msubsup" id="MJXp-Span-1169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1170" style="margin-right: 0.05em;">Œª</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1171" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1172">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1173">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1175">t</span></span></span></span></span><script type="math/tex" id="MathJax-Element-131">\lambda_{crit}</script></i>  <i>)   GPU   </i> <br></td></tr></tbody></table><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao usar o GeForce GTX 1080 Ti para c√°lculo, a diferen√ßa entre as caminhadas pela √°rvore com uma pilha e sem uma pilha √© de at√© duas vezes, desde que negligenciemos o tempo necess√°rio para construir a √°rvore. </font><font style="vertical-align: inherit;">Esse fato nos leva a garantir que, no futuro, portemos para a GPU e construamos uma √°rvore. </font><font style="vertical-align: inherit;">Uma compara√ß√£o das tabelas 5-7 mostra que n√£o h√° um tamanho ideal de bloco ideal para um n√∫mero diferente de corpos e, ainda mais, para diferentes arquiteturas de GPU, al√©m disso, a diferen√ßa de tempo de c√°lculo pode atingir v√°rias vezes, mesmo se voc√™ n√£o considerar os valores de limite. </font><font style="vertical-align: inherit;">Portanto, antes de c√°lculos demorados, faz sentido determinar o tamanho ideal do bloco para cada configura√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O principal que alcan√ßamos √© a capacidade de modelar a intera√ß√£o pareada de pouco mais de um milh√£o de corpos (</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1176"><span class="MJXp-msubsup" id="MJXp-Span-1177"><span class="MJXp-mn" id="MJXp-Span-1178" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-1179" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-1180">20</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-132-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-132">2^{20}</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) por um tempo razo√°vel em um, n√£o na GPU mais recente. Em GPUs mais recentes (Tesla V100), aparentemente, ser√° poss√≠vel processar j√° cerca de dois milh√µes de corpos em intera√ß√£o em um tempo razo√°vel, porque seu desempenho √© cerca de quatro vezes maior que a metade do Tesla K80. Embora esse n√∫mero tamb√©m seja incompar√°vel com o n√∫mero de estrelas, mesmo em gal√°xias an√£s, como a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pequena Nuvem de Magalh√£es</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas, na minha opini√£o, √© impressionante.</font></font><br><br><h2>  Conclus√£o </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O uso de m√©todos incorporados para resolver equa√ß√µes diferenciais torna poss√≠vel resolver problemas semelhantes com um alto n√≠vel de precis√£o a um custo de tempo relativamente pequeno, e a aplica√ß√£o de algoritmos para aproximar a fun√ß√£o de calcular as for√ßas de atra√ß√£o aos pares nos permite processar volumes colossais de corpos em intera√ß√£o. </font><font style="vertical-align: inherit;">Assim, diferentemente dos alien√≠genas das "Tarefas de tr√™s corpos", somos capazes de resolver o problema</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1181"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1182">N</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-133-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-133">N</script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> corpos e para um pequeno n√∫mero de corpos e aglomerados de estrelas inteiros, embora ao custo de alguma perda de precis√£o. </font></font><br><br><h4>  Visualiza√ß√£o </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para quem leu at√© o fim, darei mais alguns v√≠deos com visualiza√ß√£o da evolu√ß√£o dos sistemas dos corpos. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Simula√ß√£o de uma colis√£o de duas gal√°xias. </font><font style="vertical-align: inherit;">O n√∫mero total de corpos √© de 60 mil.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AYzgTC0qqV0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Modelando a evolu√ß√£o de uma gal√°xia que consiste em um milh√£o de estrelas. </font><font style="vertical-align: inherit;">No centro est√° um corpo com uma massa de 99% do total. </font><font style="vertical-align: inherit;">Part√≠culas √∫nicas s√£o quase indistingu√≠veis. </font><font style="vertical-align: inherit;">J√° √© mais como uma onda em uma gota de l√≠quido. </font><font style="vertical-align: inherit;">Colorido de acordo com o m√≥dulo de velocidade. </font><font style="vertical-align: inherit;">Baixa velocidade - azul, verde - m√©dio, vermelho - alto. </font><font style="vertical-align: inherit;">V√™-se que no centro a velocidade √© mais alta e diminui gradualmente para as bordas, e a mais baixa no plano equatorial.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/0_8nZCrVqWI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uma simula√ß√£o mais "din√¢mica" da evolu√ß√£o de uma gal√°xia de milh√µes de estrelas. </font><font style="vertical-align: inherit;">No centro est√° um corpo com uma massa de 10% do total. </font><font style="vertical-align: inherit;">O corpo central afeta o resto significativamente menos. </font><font style="vertical-align: inherit;">Primeiro, as "estrelas" se separam, depois se re√∫nem em v√°rios aglomerados e, no final, formam novamente um grande aglomerado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No processo de modelagem, cerca de 5% das "estrelas" deixaram a regi√£o inicial irrevogavelmente.</font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/XLvIPK6m6QI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No d√©cimo segundo, assemelha-se muito √† </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gal√°xia de roda dentada</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> existente </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O c√≥digo do projeto pode ser encontrado no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt437014/">https://habr.com/ru/post/pt437014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt437002/index.html">N√∫cleo ASP.NET v√°lido</a></li>
<li><a href="../pt437004/index.html">Os programadores da YML sonham com testes ans√≠veis?</a></li>
<li><a href="../pt437006/index.html">Revis√£o da impressora 3D Wanhao Duplicator 10</a></li>
<li><a href="../pt437008/index.html">PNL. O b√°sico. T√©cnicas. Autodesenvolvimento. Parte 1</a></li>
<li><a href="../pt437010/index.html">Ecos do passado: a experi√™ncia de Young na base do novo m√©todo de espectroscopia de raios-X</a></li>
<li><a href="../pt437018/index.html">Algumas armadilhas da digita√ß√£o est√°tica em Python</a></li>
<li><a href="../pt437020/index.html">O que h√° de errado com o aprendizado por refor√ßo?</a></li>
<li><a href="../pt437022/index.html">Bit de seguran√ßa de ru√≠do 0x22 (ataques de inje√ß√£o de falha, 35C3 e Wallet.fail)</a></li>
<li><a href="../pt437026/index.html">Google na Fran√ßa multado em 50 milh√µes de euros por GDPR por uso indevido de dados pessoais</a></li>
<li><a href="../pt437030/index.html">Automa√ß√£o da infraestrutura de um escrit√≥rio de luxo: como fica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>