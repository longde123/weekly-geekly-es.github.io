<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”” ğŸ¤¶ğŸ¿ ğŸ”“ å¦‚ä½•é€šè¿‡æ”¹å–„æ€§èƒ½æ¥é™ä½æ€§èƒ½ ğŸ› ğŸ¦‹ ğŸ‘‡ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬æƒ³è¦æœ€å¥½çš„ï¼Œä½†ç»“æœå´ä¸€å¦‚æ—¢å¾€ã€‚ 
 Victor Chernomyrdinï¼Œ 
 ä¿„ç½—æ–¯æ”¿æ²»å®¶ 


 åœ¨ç”Ÿæ´»ä¸­ï¼Œæœ‰æ—¶å€™ä¼¼ä¹ä¸€åˆ‡éƒ½åšå¯¹äº†ï¼Œä½†æ˜¯å‡ºäº†ç‚¹é—®é¢˜ã€‚ 
 è¿™ä¸ªæ•…äº‹å°±æ˜¯å…³äºè¿™ç§æƒ…å†µçš„ã€‚ 


 ä¸€æ—¦æˆ‘çœ‹äº†ä¸€ä¸‹è¿™æ®µä»£ç å¹¶è€ƒè™‘è¿‡è¦åŠ å¿«é€Ÿåº¦ï¼š 


public String appendBoun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å¦‚ä½•é€šè¿‡æ”¹å–„æ€§èƒ½æ¥é™ä½æ€§èƒ½</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436746/"><p> <em>æˆ‘ä»¬æƒ³è¦æœ€å¥½çš„ï¼Œä½†ç»“æœå´ä¸€å¦‚æ—¢å¾€ã€‚</em> <br>  Victor Chernomyrdinï¼Œ <br> ä¿„ç½—æ–¯æ”¿æ²»å®¶ </p><br><p> åœ¨ç”Ÿæ´»ä¸­ï¼Œæœ‰æ—¶å€™ä¼¼ä¹ä¸€åˆ‡éƒ½åšå¯¹äº†ï¼Œä½†æ˜¯å‡ºäº†ç‚¹é—®é¢˜ã€‚ <br> è¿™ä¸ªæ•…äº‹å°±æ˜¯å…³äºè¿™ç§æƒ…å†µçš„ã€‚ </p><a name="habracut"></a><br><p> ä¸€æ—¦æˆ‘çœ‹äº†ä¸€ä¸‹è¿™æ®µä»£ç å¹¶è€ƒè™‘è¿‡è¦åŠ å¿«é€Ÿåº¦ï¼š </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(data.str, beginIndex, endIndex) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); }</code> </pre> <br><p> é¦–å…ˆï¼Œæˆ‘æƒ³ä½¿ç”¨<code>beginIndex</code>å’Œ<code>endIndex</code>å˜é‡ï¼ˆä»¥åŠé™¤æˆªæ–­çš„å­—ç¬¦ä¸²å¤–è¿˜å°†å‘<code>StringBuilder</code>æ·»åŠ 2ä¸ªå­—ç¬¦çš„äº‹å®ï¼‰æ¥è®¡ç®—å­—ç¬¦ä¸²çš„æ€»é•¿åº¦ï¼Œå¹¶å°†æ­¤å€¼ä¼ é€’ç»™<code>StringBuilder</code>æ„é€ å‡½æ•°ä»¥ç«‹å³é€‰æ‹©æ‰€éœ€å¤§å°çš„æ•°ç»„ã€‚ è¿™ä¸ªæƒ³æ³•å¯¹æˆ‘æ¥è¯´ä¼¼ä¹å¤ªæ˜æ˜¾äº†ï¼Œæ‰€ä»¥æˆ‘å†³å®šå°è¯•å…¶ä»–æ–¹æ³•ã€‚ å°½ç®¡â€œèªæ˜â€å¥³å­©é€šå¸¸å»ºè®®ä½¿ç”¨<code>StringBuilder::append</code>çš„çŸ­å­—ç¬¦ä¸²æ›¿æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œä½†è¯¥ä»£ç å¹¶æœªè¢«â€œ Ideaâ€çªå‡ºæ˜¾ç¤ºï¼Œè¿™ä½¿æˆ‘æƒ³åˆ°äº†æ­£ç¡®çš„æƒ³æ³•ï¼Œå› ä¸ºå­—ç¬¦ä¸²è¾ƒçŸ­ï¼Œè€Œä¸”æ›´æ˜“äºé˜…è¯»ã€‚ </p><br><p> è¿™ç§ç®€åŒ–çš„éšœç¢æ˜¯ä½¿ç”¨<code>StringBuilder.append(CharSequence, int, int)</code>æ–¹æ³•ã€‚ å‡è®¾<code>data.str</code>å­—æ®µæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™ä½¿ç”¨<code>String.substring(beginIndex, endIndex)</code>å¯ä»¥ä»ä¸­é€‰æ‹©ä¸€ä¸ªå­å­—ç¬¦ä¸²å¹¶å°†å…¶ä¼ é€’ç»™<code>StringBuilder.append(String)</code> ã€‚ </p><br><p> è½¬æ¢åçš„ä»£ç ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; String subString = data.str.substring(beginIndex, endIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(subString) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); }</code> </pre> <br><p> ç°åœ¨ï¼Œè¯¥æƒ³æ³•æä¾›äº†ä¸€ä¸ªç®€åŒ–ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'L'</span></span> + data.str.substring(beginIndex, endIndex) + <span class="hljs-string"><span class="hljs-string">';'</span></span>; }</code> </pre> <br><p> ä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ç›®æ ‡ä¸æ˜¯æé«˜å¯è¯»æ€§ï¼Œè€Œæ˜¯æé«˜ç”Ÿäº§ç‡ã€‚ æ¯”è¾ƒä¸¤ç§æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@BenchmarkMode</span></span>(Mode.AverageTime) <span class="hljs-meta"><span class="hljs-meta">@OutputTimeUnit</span></span>(TimeUnit.NANOSECONDS) <span class="hljs-meta"><span class="hljs-meta">@Fork</span></span>(jvmArgsAppend = {<span class="hljs-string"><span class="hljs-string">"-Xms2g"</span></span>, <span class="hljs-string"><span class="hljs-string">"-Xmx2g"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilderAppendBenchmark</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendSubString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ String latinStr = data.latinStr; String nonLatinStr = data.nonLatinStr; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; String substring = data.nonLatin ? nonLatinStr.substring(beginIndex, endIndex) : latinStr.substring(beginIndex, endIndex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(substring) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); } <span class="hljs-meta"><span class="hljs-meta">@Benchmark</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendBounds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Data data)</span></span></span><span class="hljs-function"> </span></span>{ String latinStr = data.latinStr; String nonLatinStr = data.nonLatinStr; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex = data.beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex = data.endIndex; String appended = data.nonLatin ? nonLatinStr : latinStr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder() .append(<span class="hljs-string"><span class="hljs-string">'L'</span></span>) .append(appended, beginIndex, endIndex) .append(<span class="hljs-string"><span class="hljs-string">';'</span></span>) .toString(); } <span class="hljs-meta"><span class="hljs-meta">@State</span></span>(Scope.Thread) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Data</span></span></span><span class="hljs-class"> </span></span>{ String latinStr; String nonLatinStr; <span class="hljs-meta"><span class="hljs-meta">@Param</span></span>({<span class="hljs-string"><span class="hljs-string">"true"</span></span>, <span class="hljs-string"><span class="hljs-string">"false"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> nonLatin; <span class="hljs-meta"><span class="hljs-meta">@Param</span></span>({<span class="hljs-string"><span class="hljs-string">"5"</span></span>, <span class="hljs-string"><span class="hljs-string">"10"</span></span>, <span class="hljs-string"><span class="hljs-string">"50"</span></span>, <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-string"><span class="hljs-string">"500"</span></span>, <span class="hljs-string"><span class="hljs-string">"1000"</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> length; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> beginIndex; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> endIndex; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ThreadLocalRandom random = ThreadLocalRandom.current(); <span class="hljs-meta"><span class="hljs-meta">@Setup</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ latinStr = randomString(<span class="hljs-string"><span class="hljs-string">"abcdefghijklmnopqrstuvwxyz"</span></span>); nonLatinStr = randomString(<span class="hljs-string"><span class="hljs-string">""</span></span>); beginIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; endIndex = length + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String alphabet)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[] chars = alphabet.toCharArray(); StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(length + <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; length + <span class="hljs-number"><span class="hljs-number">2</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c = chars[random.nextInt(chars.length)]; sb.append(c); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.toString(); } } }</code> </pre> <br><p> åŸºå‡†æµ‹è¯•åªéœ€ä¸¤ä¸ªä¾¿å£«ï¼šå°†ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²æ·»åŠ åˆ°<code>StringBuilder</code> ï¼Œå…¶å¤§å°ç”±<code>length</code>å­—æ®µå†³å®šï¼Œå¹¶ä¸”ç”±äºç æ˜¯2019ï¼Œå› æ­¤æ‚¨éœ€è¦å°†å…¶æ£€æŸ¥ä¸ºä»…åŒ…å«ä¸»è¦æ‹‰ä¸å­—æ¯å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼ˆæ‰€è°“çš„å‹ç¼©è¡Œï¼Œå…¶ä¸­æ¯ä¸ªå­—ç¬¦å¯¹åº”äº1ä¸ªå­—èŠ‚ï¼‰ï¼Œä»¥åŠä¸€ä¸ªåŒ…å«éæ‹‰ä¸å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼ˆæ¯ä¸ªå­—ç¬¦ç”±2ä¸ªå­—èŠ‚è¡¨ç¤ºï¼‰ã€‚ </p><br><p> ç²—ç•¥åœ°æ£€æŸ¥ä¸€ä¸‹ï¼Œ <code>appendSubString</code>æ–¹æ³•åœ¨æˆ‘ä»¬<code>appendSubString</code>è¾ƒæ…¢ï¼Œå› ä¸ºè¦ç²˜è´´çš„æ•°æ®é‡ä¸<code>appendBounds</code>æ–¹æ³•çš„é‡ä¸€è‡´ï¼Œä½†æ˜¯ï¼Œåœ¨<code>appendSubString</code>æ–¹æ³•ä¸­<code>appendSubString</code>è¿˜æ˜ç¡®åˆ›å»ºäº†ä¸€ä¸ªå­å­—ç¬¦ä¸²ï¼Œå³ä¸ºæ–°å¯¹è±¡åˆ†é…å†…å­˜å¹¶å°†å…¶å†…å®¹ä»<code>data.latinStr</code>å¤åˆ¶åˆ°å…¶ä¸­/ <code>data.nonLatinStr</code> ã€‚ </p><br><p> æˆ‘åœ¨å®¶ç”¨è®¡ç®—æœºï¼ˆIntel Core i5-4690ï¼Œ3.50 GHzï¼‰ä¸Šä½¿ç”¨JDK11æ‰§è¡Œçš„æµ‹é‡ç»“æœæ›´ä»¤äººæƒŠè®¶ï¼ˆä½†ä¹çœ‹ä¹‹ä¸‹ï¼‰ä¼¼ä¹æ˜¯ï¼š </p><br><pre> <code class="plaintext hljs">Benchmark nonLatin length Score Error Units appendBounds true 5 44,6 Â± 0,4 ns/op appendBounds true 10 45,7 Â± 0,7 ns/op appendBounds true 50 129,0 Â± 0,5 ns/op appendBounds true 100 218,7 Â± 0,8 ns/op appendBounds true 500 907,1 Â± 5,5 ns/op appendBounds true 1000 1626,4 Â± 13,0 ns/op appendSubString true 5 28,6 Â± 0,2 ns/op appendSubString true 10 30,8 Â± 0,2 ns/op appendSubString true 50 65,6 Â± 0,4 ns/op appendSubString true 100 106,6 Â± 0,6 ns/op appendSubString true 500 430,1 Â± 2,4 ns/op appendSubString true 1000 839,1 Â± 8,6 ns/op appendBounds:Â·gc.alloc.rate.norm true 5 184,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm true 10 200,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm true 50 688,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm true 100 1192,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm true 500 5192,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm true 1000 10200,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm true 5 136,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm true 10 160,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm true 50 360,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm true 100 608,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm true 500 2608,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm true 1000 5104,0 Â± 0,0 B/op appendBounds false 5 20,8 Â± 0,1 ns/op appendBounds false 10 24,0 Â± 0,2 ns/op appendBounds false 50 66,4 Â± 0,4 ns/op appendBounds false 100 111,0 Â± 0,8 ns/op appendBounds false 500 419,2 Â± 2,7 ns/op appendBounds false 1000 840,4 Â± 7,8 ns/op appendSubString false 5 25,3 Â± 0,3 ns/op appendSubString false 10 25,7 Â± 0,2 ns/op appendSubString false 50 36,0 Â± 0,1 ns/op appendSubString false 100 52,8 Â± 0,4 ns/op appendSubString false 500 206,1 Â± 6,1 ns/op appendSubString false 1000 388,1 Â± 1,6 ns/op appendBounds:Â·gc.alloc.rate.norm false 5 80,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm false 10 88,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm false 50 320,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm false 100 544,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm false 500 2144,0 Â± 0,0 B/op appendBounds:Â·gc.alloc.rate.norm false 1000 4152,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm false 5 96,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm false 10 112,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm false 50 192,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm false 100 288,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm false 500 1088,0 Â± 0,0 B/op appendSubString:Â·gc.alloc.rate.norm false 1000 2088,0 Â± 0,0 B/op</code> </pre> <br><p> é©³æ–¥æˆ‘ä»¬çš„å‡è®¾ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ˆåŒ…æ‹¬æ€»æ˜¯é’ˆå¯¹éæ‹‰ä¸å­—ç¬¦ä¸²ï¼‰ <code>appendSubString</code>æ–¹æ³•è¢«è¯æ˜æ˜¯æ›´å¿«ï¼Œæ›´è½»æ¾ï¼ˆå³ä½¿<code>String::substring</code>è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼‰ã€‚ æ€ä¹ˆå‘ç”Ÿçš„ï¼Ÿ </p><br><h2 id="smotryu-v-knigu-vizhu-figu"> æˆ‘çœ‹ä¹¦ï¼Œçœ‹åˆ°æ— èŠ±æœ </h2><br><p> å­¦ä¹ <code>StringBuilder</code>æºä»£ç å°†æœ‰åŠ©äºæ­å¼€ä¿å¯†<code>StringBuilder</code>é¢çº±ã€‚ ä¸¤ç§ä½¿ç”¨çš„æ–¹æ³•éƒ½å°†è°ƒç”¨ä¼ é€’ç»™<code>AbstractStringBuilder</code>çš„ç›¸åŒæ–¹æ³•ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractStringBuilder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">io</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Comparable</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CharSequence</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(s, start, end); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p> è½¬åˆ°<code>AbstractStringBuilder.append(String)</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AbstractStringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (str == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> appendNull(); } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = str.length(); ensureCapacityInternal(count + len); putStringAt(count, str); count += len; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putStringAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (getCoder() != str.coder()) { inflate(); } str.getBytes(value, index, coder); }</code> </pre> <br><p> è¿™é‡Œæœ‰è¶£çš„æ˜¯ä»€ä¹ˆï¼Ÿ é¡¾åæ€ä¹‰ï¼Œ <code>AbstractStringBuilder::inflate</code>åœ¨ç»„åˆä¸åŒçš„å­—ç¬¦ä¸²æ—¶ä¼šæ‰©å±•<code>AbstractStringBuilder.value</code>æ•°ç»„ã€‚ æ•°æ®åœ¨<code>String::getBytes</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBytes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] dst, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dstBegin, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> coder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (coder() == coder) { System.arraycopy(value, <span class="hljs-number"><span class="hljs-number">0</span></span>, dst, dstBegin &lt;&lt; coder, value.length); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">// this.coder == LATIN &amp;&amp; coder == UTF16 StringLatin1.inflate(value, 0, dst, dstBegin, value.length); } }</span></span></code> </pre> <br><p> é‡è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿ å¦‚æœå­—ç¬¦ä¸²æ˜¯åŒè´¨çš„ï¼Œåˆ™ä½¿ç”¨å›ºæœ‰çš„<code>System::arraycopy</code>æ¥ç§»åŠ¨æ•°æ®ï¼Œå¦åˆ™ä½¿ç”¨<code>StringLatin1::inflate</code> ï¼Œå®ƒé€šè¿‡å§”æ‰˜å°†æˆ‘ä»¬<code>StringUTF16::inflate</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// inflatedCopy byte[] -&gt; byte[] @HotSpotIntrinsicCandidate public static void inflate(byte[] src, int srcOff, byte[] dst, int dstOff, int len) { // We need a range check here because 'putChar' has no checks checkBoundsOffCount(dstOff, len, dst); for (int i = 0; i &lt; len; i++) { putChar(dst, dstOff++, src[srcOff++] &amp; 0xff); } } @HotSpotIntrinsicCandidate static void putChar(byte[] val, int index, int c) { assert index &gt;= 0 &amp;&amp; index &lt; length(val) : "Trusted caller missed bounds check"; index &lt;&lt;= 1; val[index++] = (byte)(c &gt;&gt; HI_BYTE_SHIFT); val[index] = (byte)(c &gt;&gt; LO_BYTE_SHIFT); }</span></span></code> </pre> <br><p> å› æ­¤ï¼Œå¦‚æœè¡Œæ˜¯åŒè´¨çš„ï¼Œåˆ™ä½¿ç”¨ä¾èµ–äºå¹³å°çš„æ–¹æ³•<code>System::arraycopy</code>æ¥ç§»åŠ¨æ•°æ®ï¼Œå¦åˆ™ä½¿ç”¨å¾ªç¯ï¼ˆä¹Ÿæ˜¯å›ºæœ‰çš„ï¼‰ã€‚ è¿™æ„å‘³ç€ï¼Œå½“ç²˜è´´ä¸¤è¡Œæ—¶ï¼Œæ‰€æœ‰å­—ç¬¦éƒ½ä½äºä¸»æ‹‰ä¸å­—æ¯çš„é›†åˆä¸­ï¼ˆæ¢å¥è¯è¯´ï¼Œé€‚åˆ1ä¸ªå­—èŠ‚ï¼‰ï¼Œå…¶æ€§èƒ½åº”æ¯”ç²˜è´´å¼‚æ„è¡Œæ—¶å¥½å¾—å¤šã€‚ åŸºå‡†æµ‹è¯•ç¡®è®¤äº†è¿™ä¸€ç‚¹ï¼ˆè¯·å‚è§<code>nonLatin = false</code>è¾“å‡ºï¼‰ã€‚ </p><br><p> ç°åœ¨ï¼Œ <code>AbstractStringBuilder.append(CharSequence, int, int)</code>æ–¹æ³•<code>AbstractStringBuilder.append(CharSequence, int, int)</code> ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AbstractStringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> start, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { s = <span class="hljs-string"><span class="hljs-string">"null"</span></span>; } checkRange(start, end, s.length()); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> len = end - start; ensureCapacityInternal(count + len); appendChars(s, start, end); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">appendChars</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> off, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLatin1()) { <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] val = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = off, j = count; i &lt; end; i++) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> c = s.charAt(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (StringLatin1.canEncode(c)) { val[j++] = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)c; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { count = j; inflate(); StringUTF16.putCharsSB(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value, j, s, i, end); count += end - i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { StringUTF16.putCharsSB(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.value, count, s, off, end); } count += end - off; }</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œè¯¥æ–¹æ³•ç±»ä¼¼äºä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­çš„æ–¹æ³•ï¼šå¯¹äºåŒæ„å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ä¸€ç§æ›´ç®€å•çš„æœºåˆ¶ï¼ˆæ­¤å¤„æ˜¯å¾ªç¯ä¸­çš„ç¬¦å·å¤åˆ¶ï¼‰ï¼Œå¯¹äºå¼‚ç±»å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>StringUTF16</code> ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œå¹¶æœªå›ºæœ‰åœ°è°ƒç”¨<code>StringUTF16::putCharsSB</code> ã€‚ </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">putCharsSB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] val, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index, CharSequence s, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> off, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> end)</span></span></span><span class="hljs-function"> </span></span>{ checkBoundsBeginEnd(index, index + end - off, val); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = off; i &lt; end; i++) { putChar(val, index++, s.charAt(i)); } }</code> </pre> <br><p> å› æ­¤ï¼Œè¿™ä¸¤ç§æ–¹æ³•çš„å†…éƒ¨ç»“æ„ä»¥åŠå®ƒä»¬ä¸åŒæ€§èƒ½çš„åŸå› å¯¹æˆ‘ä»¬æ¥è¯´è¿˜æ˜¯å·®ä¸å¤šçš„ã€‚ é—®é¢˜è‡ªç„¶è€Œç„¶åœ°å‡ºç°äº†-å¦‚ä½•å¤„ç†æ¥ä¸‹æ¥è·å¾—çš„çŸ¥è¯†ï¼Ÿ ä¸€æ¬¡æœ‰å‡ ä¸ªé€‰é¡¹ï¼š </p><br><p>  1ï¼‰è¯·è®°ä½è¿™ä¸€ç‚¹ï¼Œå½“å®ƒæ£€æµ‹åˆ°å¯ç–‘ä»£ç æ—¶ï¼Œè¯·ç”¨æ‰‹è¿›è¡Œæ›´æ”¹ <br>  2ï¼‰å‰å¾€å¡”å‰å°”ï¼ˆTagirï¼‰å¹¶è¦æ±‚ä»–æäº¤æ”¯ç¥¨ï¼Œä»£æ›¿æˆ‘ä»¬æ¥åš <br>  3ï¼‰å¯¹JDKè¿›è¡Œæ›´æ”¹ï¼Œä»¥ä½¿ä»£ç å®Œå…¨ä¸å˜ã€‚ </p><br><p> å½“ç„¶ï¼Œæˆ‘ä»¬ä»ç¬¬ä¸‰ä¸ªå¼€å§‹ã€‚ å‡†å¤‡å¥½å†’é™©äº†å—ï¼Ÿ </p><br><h2 id="pogruzhenie-v-puchinu"> æ·±æ¸Š </h2><br><p> æˆ‘ä»¬å°†è®­ç»ƒ <del> åœ¨çŒ«ä¸Š </del> æœ‰å…³ç¬¬11ä¸ªJavaçš„æºä»£ç ï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>ä¸‹è½½ã€‚ </p><br><p> æœ€ç®€å•ï¼Œæœ€æ˜æ˜¾çš„æ”¹è¿›æ–¹æ³•æ˜¯é€‰æ‹©ä¸€ä¸ªä½äº<code>AbstractStringBuilder.append(CharSequence, int, int)</code>æ–¹æ³•å†…éƒ¨çš„å­å­—ç¬¦ä¸²ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  public AbstractStringBuilder append(CharSequence s, int start, int end) { if (s == null) { s = "null"; } checkRange(start, end, s.length()); int len = end - start; ensureCapacityInternal(count + len); appendChars(s, start, end); return this; } //  public AbstractStringBuilder append(CharSequence s, int start, int end) { if (s == null) { s = "null"; } checkRange(start, end, s.length()); return append(s.subSequence(start, end).toString()); }</span></span></code> </pre> <br><p> ç°åœ¨ï¼Œæ‚¨éœ€è¦æ„å»ºJDKï¼Œè¿è¡Œæµ‹è¯•å¹¶åœ¨å…¶ä¸Šè¿è¡Œ<code>StringBuilderAppendBenchmark::appendBounds</code>åŸºå‡†æµ‹è¯•ï¼Œéœ€è¦å°†å…¶ç»“æœä¸åŸå§‹JDKä¸Šç›¸åŒåŸºå‡†æµ‹è¯•çš„ç»“æœè¿›è¡Œæ¯”è¾ƒï¼š </p><br><pre> <code class="plaintext hljs">#   before      JDK, # after -   Benchmark nonLatin length before after Units avgt true 5 44,6 64,4 ns/op avgt true 10 45,7 66,3 ns/op avgt true 50 129,0 168,9 ns/op avgt true 100 218,7 281,9 ns/op avgt true 500 907,1 1116,2 ns/op avgt true 1000 1626,4 2002,5 ns/op gc.alloc.rate.norm true 5 184,0 264,0 B/op gc.alloc.rate.norm true 10 200,0 296,0 B/op gc.alloc.rate.norm true 50 688,0 904,0 B/op gc.alloc.rate.norm true 100 1192,0 1552,0 B/op gc.alloc.rate.norm true 500 5192,0 6752,0 B/op gc.alloc.rate.norm true 1000 10200,0 13256,0 B/op avgt false 5 20,8 38,0 ns/op avgt false 10 24,0 37,8 ns/op avgt false 50 66,4 82,9 ns/op avgt false 100 111,0 138,8 ns/op avgt false 500 419,2 531,9 ns/op avgt false 1000 840,4 1002,7 ns/op gc.alloc.rate.norm false 5 80,0 152,0 B/op gc.alloc.rate.norm false 10 88,0 168,0 B/op gc.alloc.rate.norm false 50 320,0 440,0 B/op gc.alloc.rate.norm false 100 544,0 688,0 B/op gc.alloc.rate.norm false 500 2144,0 2688,0 B/op gc.alloc.rate.norm false 1000 4152,0 5192,0 B/op</code> </pre> <br><p> ä»€ä¹ˆå«çªç„¶ï¼ ä¸ä»…æ²¡æœ‰æ”¹å–„ï¼Œè€Œä¸”æ¶åŒ–äº†ã€‚ è¯¥æ­»çš„ï¼Œä½†æ˜¯æ€ä¹ˆåŠï¼Ÿ </p><br><p> äº‹å®æ˜¯ï¼Œåœ¨ä¸€å¼€å§‹ï¼Œåœ¨<code>StringBuilder::append</code>æ–¹æ³•çš„æè¿°ä¸­<code>StringBuilder::append</code>æˆ‘åšäº†ä¸€ä¸ªå°ä½†è‡³å…³é‡è¦çš„é—æ¼ã€‚ æ–¹æ³•æè¿°å¦‚ä¸‹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p> è¿™æ˜¯å…¶å®Œæ•´è§†å›¾ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p> æˆ‘ä»¬ä¸Šé¢æ£€æŸ¥è¿‡çš„Javaä»£ç ï¼ˆåœ¨C2çº§åˆ«ä¸Šè¿›è¡Œäº†åŠ çƒ­å’Œç¼–è¯‘ï¼‰å¹¶ä¸é‡è¦ï¼Œå› ä¸ºå®ƒä¸æ˜¯æ‰§è¡Œçš„ï¼Œè€Œæ˜¯å†…åœ¨çš„ã€‚ é€šè¿‡ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">async-profiler</a>åˆ é™¤é…ç½®æ–‡ä»¶å¾ˆå®¹æ˜“è¯æ˜è¿™ä¸€ç‚¹ã€‚ æ­¤åï¼Œå°†åˆ é™¤<code>length = 1000</code>ä¸”<code>nonLatin = true</code>çš„é…ç½®æ–‡ä»¶ï¼š </p><br><pre> <code class="plaintext hljs">#   `appendSubString`, JDK    ns percent samples top ---------- ------- ------- --- 19096340914 43.57% 1897673 jbyte_disjoint_arraycopy &lt;--------- 13500185356 30.80% 1343343 jshort_disjoint_arraycopy &lt;--------- 4124818581 9.41% 409533 java.lang.String.&lt;init&gt; #   2177311938 4.97% 216375 java.lang.StringUTF16.compress #   1557269661 3.55% 154253 java.util.Arrays.copyOfRange #   349344451 0.80% 34823 appendSubString_avgt_jmhStub 279803769 0.64% 27862 java.lang.StringUTF16.newString 274388920 0.63% 27312 org.openjdk.jmh.infra.Blackhole.consume 160962540 0.37% 15946 SpinPause 122418222 0.28% 11795 __memset_avx2</code> </pre> <br><p>  <code>StringBuilder</code> ï¼ˆå’Œ<code>AbstractStringBuilder</code> ï¼‰çš„ä»£ç åœ¨è¿™é‡Œç”šè‡³éƒ½æ²¡æœ‰å‘³é“ï¼Œå‡ ä¹3/4çš„é…ç½®æ–‡ä»¶è¢«ä¸€ä¸ªå†…éƒ¨å‡½æ•°å ç”¨ã€‚ æˆ‘æƒ³åœ¨æˆ‘ä»¬â€œæ”¹è¿›çš„â€ <code>StringBuilder.append(CharSequence, int, int)</code>çš„é…ç½®æ–‡ä»¶ä¸­è§‚å¯Ÿåˆ°å¤§çº¦ç›¸åŒçš„å›¾ç‰‡ã€‚ </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬æœ‰ï¼š </p><br><pre> <code class="plaintext hljs"> ns percent samples top ---------- ------- ------- --- 19071221451 43.78% 1897827 jbyte_disjoint_arraycopy 6409223440 14.71% 638348 jlong_disjoint_arraycopy 3933622128 9.03% 387403 java.lang.StringUTF16.newBytesFor 2067248311 4.75% 204193 java.lang.AbstractStringBuilder.ensureCapacityInternal 1929218737 4.43% 194751 java.lang.StringUTF16.compress 1678321343 3.85% 166458 java.util.Arrays.copyOfRange 1621470408 3.72% 160849 java.lang.String.checkIndex 969180099 2.22% 96018 java.util.Arrays.copyOf 581600786 1.34% 57818 java.lang.AbstractStringBuilder.&lt;init&gt; 417818533 0.96% 41611 appendBounds_jmhTest 406565329 0.93% 40479 java.lang.String.&lt;init&gt; 340972882 0.78% 33727 java.lang.AbstractStringBuilder.append 299895915 0.69% 29982 java.lang.StringBuilder.toString 183885595 0.42% 18136 SpinPause 168666033 0.39% 16755 org.openjdk.jmh.infra.Blackhole.consume</code> </pre> <br><p> æ‚¨ä¼šè¯´ï¼šâ€œå®ƒä»¬åœ¨å†…éƒ¨ï¼Œåœ¨æœ€é¡¶å±‚ï¼â€ å®é™…ä¸Šï¼Œåªæœ‰è¿™äº›ä¸æ˜¯ç›¸åŒçš„å†…åœ¨å‡½æ•°ï¼ˆåŒ…æ‹¬ä»ä¸Šé¢æ¯”è¾ƒç¬¬äºŒä¸ªçš„åç§°ï¼‰ã€‚ å›æƒ³ä¸€ä¸‹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-meta"><span class="hljs-meta">@HotSpotIntrinsicCandidate</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> StringBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.append(str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }</code> </pre> <br><p> åœ¨æ­¤ï¼Œå†…åœ¨å‡½æ•°æ›¿æ¢äº†å¯¹<code>StringBuilder.append(String)</code>çš„è°ƒç”¨ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„è¡¥ä¸ç¨‹åºä¸­ï¼Œæ­¤è°ƒç”¨ä¸æ˜¯ï¼ ç§°ä¸º<code>AbstractStringBuilder.append(String)</code> ã€‚ æˆ‘ä»¬<code>jbyte_disjoint_arraycopy</code>çš„<code>jbyte_disjoint_arraycopy</code>è°ƒç”¨æ˜¯<code>StringLatin1::inflate</code>çš„å†…åœ¨è°ƒç”¨ï¼Œå®ƒæ˜¯é€šè¿‡<code>String::getBytes</code>ä»<code>AbstractStringBuider::putStringAt</code> <code>jbyte_disjoint_arraycopy</code>è°ƒç”¨çš„ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸<code>StringBuilder::append</code>ä¸åŒ<code>StringBuilder::append</code>ä¸ä»…å¤„ç†ç‰¹å®šäºå¹³å°çš„ä»£ç ï¼Œè¿˜å¤„ç†Javaä»£ç ï¼Œ </p><br><p> äº†è§£å¤±è´¥çš„åŸå› ï¼Œå¦åˆ™è¯·å°è¯•æˆåŠŸã€‚ å¾ˆå®¹æ˜“çŒœåˆ°æˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å¼•ç”¨<code>StringBuilder::append</code> ã€‚ æ‚¨å¯ä»¥é€šè¿‡æ’•ä¸‹ä»¥å‰çš„è¡¥ä¸å¹¶å¯¹<code>StringBuilder</code>æœ¬èº«è¿›è¡Œæ›´æ”¹æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  @Override public StringBuilder append(CharSequence s, int start, int end) { super.append(s, start, end); return this; } //  @Override public StringBuilder append(CharSequence s, int start, int end) { if (s == null) { s = "null"; } checkRange(start, end, s.length()); return this.append(s.subSequence(start, end).toString()); } }</span></span></code> </pre> <br><p> ç°åœ¨ï¼Œä¸€åˆ‡éƒ½æ˜æ™ºåœ°å®Œæˆäº†ï¼šå†…åœ¨çš„StringBuilder :: appendè¢«è°ƒç”¨ã€‚ <br> é‡å»ºï¼Œè¿è¡Œï¼Œæ¯”è¾ƒï¼š </p><br><pre> <code class="plaintext hljs">#   before      JDK, # after -   Benchmark nonLatin length before after Units avgt true 5 44,6 60,2 ns/op avgt true 10 45,7 59,1 ns/op avgt true 50 129,0 164,6 ns/op avgt true 100 218,7 276,2 ns/op avgt true 500 907,1 1088,8 ns/op avgt true 1000 1626,4 1959,4 ns/op gc.alloc.rate.norm true 5 184,0 264,0 B/op gc.alloc.rate.norm true 10 200,0 296,0 B/op gc.alloc.rate.norm true 50 688,0 904,0 B/op gc.alloc.rate.norm true 100 1192,0 1552,0 B/op gc.alloc.rate.norm true 500 5192,0 6752,0 B/op gc.alloc.rate.norm true 1000 10200,0 13256,0 B/op avgt false 5 20,8 37,9 ns/op avgt false 10 24,0 37,9 ns/op avgt false 50 66,4 80,9 ns/op avgt false 100 111,0 125,6 ns/op avgt false 500 419,2 483,6 ns/op avgt false 1000 840,4 893,8 ns/op gc.alloc.rate.norm false 5 80,0 152,0 B/op gc.alloc.rate.norm false 10 88,0 168,0 B/op gc.alloc.rate.norm false 50 320,0 440,0 B/op gc.alloc.rate.norm false 100 544,0 688,0 B/op gc.alloc.rate.norm false 500 2144,0 2688,0 B/op gc.alloc.rate.norm false 1000 4152,0 5187,2 B/op</code> </pre><br><p> æˆ‘çœŸçš„æ„Ÿåˆ°éå¸¸éš¾è¿‡ï¼Œä½†å¹¶æ²¡æœ‰å¥½è½¬ã€‚ ç°åœ¨æ˜¯ä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶ï¼š </p><br><pre> <code class="plaintext hljs"> ns percent samples top ---------- ------- ------- --- 19614374885 44.12% 1953620 jbyte_disjoint_arraycopy 6645299702 14.95% 662146 jlong_disjoint_arraycopy 4065789919 9.15% 400167 java.lang.StringUTF16.newBytesFor 2374627822 5.34% 234746 java.lang.AbstractStringBuilder.ensureCapacityInternal 1837858014 4.13% 183822 java.lang.StringUTF16.compress 1472039604 3.31% 145956 java.util.Arrays.copyOfRange 1316397864 2.96% 130747 appendBounds_jmhTest 956823151 2.15% 94959 java.util.Arrays.copyOf 573091712 1.29% 56933 java.lang.AbstractStringBuilder.&lt;init&gt; 434454076 0.98% 43202 java.lang.String.&lt;init&gt; 368480388 0.83% 36439 java.lang.AbstractStringBuilder.append 304409057 0.68% 30442 java.lang.StringBuilder.toString 272437989 0.61% 26833 SpinPause 201051696 0.45% 19985 java.lang.StringBuilder.&lt;init&gt; 198934052 0.45% 19810 appendBounds_avgt_jmhStub</code> </pre> <br><p> å‡ ä¹æ²¡æœ‰æ”¹å˜ã€‚ å¯¹æˆ‘æ¥è¯´ï¼Œç›®å‰å°šä¸æ¸…æ¥šä¸ºä»€ä¹ˆä»<code>StringBuilder</code>è®¿é—®<code>StringBuilder.append(String)</code>æ—¶å†…åœ¨å‡½æ•°ä¸ºä»€ä¹ˆä¸èµ·ä½œç”¨ã€‚ æœ‰äººæ€€ç–‘å°†<code>StringBuilder.append(String)</code>æ–¹æ³•çš„ä¸»ä½“ç²˜è´´ï¼ˆå†…è”ï¼‰åˆ°<code>StringBuilder.append(CharSequence, int, int)</code>çš„ä¸»ä½“ä¸­ä¼šæ”¹å˜VMæ–¹æ³•è°ƒç”¨çš„å¤„ç†è¿‡ç¨‹ã€‚ </p><br><p> æ— è®ºå¦‚ä½•ï¼Œè¿™æ˜¯æƒ¨è´¥ï¼Œå…„å¼Ÿã€‚ æ— æ³•ä¿®è¡¥JDKï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹æ‰‹åŠ¨è¿›è¡Œæ›¿æ¢ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å¤±è´¥æ–‡å­¦æ’¤é€€</b> <div class="spoiler_text"><blockquote> å“åº”åŠ å¯†åœ¨ä¸¤å¤©å†…å®Œæˆã€‚ èˆªæµ·å®¶ä¸æƒ³ä¸Oto Velaraåˆ†æ‰‹ï¼Œåè€…çš„å…¬å¸åˆ¶é€ å‡ºäº†æƒŠäººçš„å¿«é€Ÿè€Œå¼ºå¤§çš„å†›èˆ°ã€‚ å¯¼èˆªå™¨ä¸æƒ³å‘æˆ‘è¯»å–åŠ å¯†ã€‚ ä»–åªæ˜¯ç®€å•åœ°ä»å‘½ä»¤æ ä¸­é‡å¤å“åº”ï¼šâ€œå¦â€ã€‚ åŠ å¯†ä¸èƒ½è§£é‡Šä¸ºä»€ä¹ˆâ€œä¸â€ã€‚ æ— è®ºå¦‚ä½•ï¼Œâ€œå¦â€è¡¨ç¤ºä»–æ˜¯å¤§å‹è®¡ç®—æœºæ‰€è®¤è¯†çš„äººã€‚ å¦‚æœå¯¹ä»–ä¸€æ— æ‰€çŸ¥ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼šå°è¯•ä¸€ä¸‹ã€‚ å¤ªå¯æƒœäº† å¤±å»è¿™ä¹ˆæœ‰è¶£çš„äººçœŸå¯æƒœã€‚ æŒ‡æŒ¥å®˜ä¸€å®šä¸ºæˆ‘æ„Ÿåˆ°æŠ±æ­‰ ä¹Ÿè®¸ç¬¬ä¸€æ¬¡æ˜¯å¯æƒœçš„ã€‚ ä»–çœ‹åˆ°æˆ‘é—¯å…¥ç»´äº¬äººã€‚ ä»–ä¸æƒ³å†æŠŠæˆ‘é€¼å…¥çŒç‹—çŠ¬ã€‚ <br> ä»–ä¿æŒæ²‰é»˜ã€‚ ä½†æ˜¯æˆ‘çŸ¥é“åœ¨æä¾›å¤§é‡çš„å·¥äººçŸ­ç¼ºæ—¶ï¼š <br>  -æˆ‘ï¼ŒåŒå¿—ï¼Œæ˜å¤©å·¥ä½œã€‚ æ”¾å¼€æˆ‘ <br>  -ç»§ç»­  -çªç„¶å¥¹ç¬‘äº†ã€‚  â€œä½ çŸ¥é“ï¼Œæ¯ä¸€æœµäº‘éƒ½æœ‰ä¸€çº¿å¸Œæœ›ã€‚â€ <br>  â€œæˆ‘ï¼Œå°†å†›åŒå¿—ï¼Œæ€»æ˜¯ç”Ÿç—…æ²¡æœ‰å¥½å¤„ã€‚â€ <br>  â€œå°±åœ¨è¿™é‡Œã€‚â€ ä½ è¢«ç¦æ­¢è§ä»–ï¼Œè¿™å¾ˆç³Ÿç³•ã€‚  <strong>ä½†æ˜¯ï¼Œé™¤äº†æˆ‘ä»¬çš„ç»éªŒå®è—å¤–ï¼Œæˆ‘ä»¬è¿˜æ·»åŠ äº†å¦ä¸€ç§è°·ç‰©ã€‚</strong> </blockquote></div></div><br><p> ç»“è®ºï¼š </p><br><ul><li> åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒJDKæ–¹æ³•çš„ä»£ç ä¸å®é™…æ‰§è¡Œæ— å…³ï¼Œå› ä¸ºå¯ä»¥ä»£æ›¿æ–¹æ³•çš„ä¸»ä½“è€Œæ‰§è¡Œå†…éƒ¨å‡½æ•°ï¼Œè¯¥å†…éƒ¨å‡½æ•°éšè—åœ¨VMçš„è‚ é“ä¸­ã€‚ </li><li> å¯ä»¥è¯†åˆ«å‡ºæ­¤ç±»æ–¹æ³•ï¼Œç‰¹åˆ«æ˜¯<code>@HotSpotIntrinsicCandidate</code>æ ‡ç­¾æŒ‡å‘å®ƒä»¬ï¼Œå°½ç®¡æŸäº›æ–¹æ³•è¢«å†…åŒ–è€Œæ²¡æœ‰ä»»ä½•æç¤ºï¼Œä¾‹å¦‚<code>String::equals</code> ï¼ˆä»¥åŠ<a href="">è®¸å¤šå…¶ä»–</a> ï¼‰ã€‚ </li><li> ä»å‰ä¸¤ä¸ªå¾—å‡ºçš„ç»“è®ºæ˜¯ï¼Œæˆ‘ä»¬å¯¹JDKä»£ç å¦‚ä½•å·¥ä½œçš„è®¨è®ºå¯èƒ½ä¸ç°å®ç›¸åã€‚  Cestest vie </li></ul><br><p> èšè‹¯ä¹™çƒ¯ <br> å¦ä¸€ç§å¯èƒ½çš„æ›¿ä»£æ–¹æ³•ï¼š </p><br><pre> <code class="java hljs">StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.append(str, <span class="hljs-number"><span class="hljs-number">0</span></span>, endIndex); <span class="hljs-comment"><span class="hljs-comment">// --&gt; StringBuilder sb = new StringBuilder(str.substring(o, endIndex));</span></span></code> </pre> <br><p>  PPS <br>  Oracleå¼€å‘äººå‘˜æ­£ç¡®åœ°æŒ‡å‡º </p><br><blockquote> åœ¨æˆ‘çœ‹æ¥ï¼Œå°†ä»£ç è·¯å¾„å¼•å…¥ <br>  sb.appendï¼ˆcsï¼Œintï¼Œintï¼‰åˆ†é…å†…å­˜ä»¥ä¾¿è·å¾—ä¸€ä¸ª <br> åªæ˜¯æœ‰æ—¶å€™ä¼šä½¿äº‹æƒ…è¿è¡Œå¾—æ›´å¿«ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œæ€§èƒ½ <br> æƒè¡¡å¹¶ä¸æ˜æ˜¾ã€‚ <br><br> ç›¸åï¼Œå¦‚æœæˆ‘ä»¬è¦ä¼˜åŒ–sb.appendï¼ˆcsï¼Œintï¼Œintï¼‰ï¼Œä¹Ÿè®¸æˆ‘ä»¬åº”è¯¥å» <br> å¹¶é€šè¿‡æ·»åŠ æˆ–é‡æ–°æ’åˆ—å†…åœ¨å‡½æ•°æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ </blockquote><p> æå‡ºçš„è§£å†³æ–¹æ¡ˆæ˜¯<code>StringBuilder.append(CharSequence, int, int)</code>çš„å†…åœ¨åŒ–ã€‚ </p><br><p>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä»»åŠ¡</a> <br>  â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¨è®º</a> </p><br><p>  <strong>PPS</strong> <br> æœ‰è¶£çš„æ˜¯ï¼Œç›®å‰ï¼Œå½“å†™ç±»ä¼¼ </p><br><pre> <code class="java hljs">StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.append(str.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, endIndex));</code> </pre> <br><p>  â€œæƒ³æ³•â€å»ºè®®å°†ä»£ç ç®€åŒ–ä¸º </p><br><pre> <code class="java hljs">StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.append(s, <span class="hljs-number"><span class="hljs-number">0</span></span>, endIndex);</code> </pre> <br><p> å¦‚æœæ­¤ä½ç½®çš„æ€§èƒ½å¯¹æ‚¨è€Œè¨€ä¸æ˜¯å¾ˆé‡è¦ï¼Œåˆ™ä½¿ç”¨ç¬¬äºŒä¸ªç®€åŒ–ç‰ˆæœ¬å¯èƒ½æ›´æ­£ç¡®ã€‚ å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ç¼–å†™çš„å¤§å¤šæ•°ä»£ç æ˜¯ç»™æˆ‘ä»¬çš„æˆ˜å‹è€Œä¸æ˜¯æœºå™¨çš„ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN436746/">https://habr.com/ru/post/zh-CN436746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN436726/index.html">ç”¨æˆ·æŠ¥å‘Šç§°ï¼Œç”±äºèªæ˜åœ°çªƒå–äº†Electrumé’±åŒ…ï¼Œå¯¼è‡´æ¯”ç‰¹å¸æŸå¤±</a></li>
<li><a href="../zh-CN436738/index.html">å†æ¬¡é¢„æµ‹ï¼Œç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN436740/index.html">è‡ªå·±çš„ç ”ç©¶ï¼Œå¼€æºèƒ½å‘Šè¯‰æˆ‘ä»¬ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN436742/index.html">ç›´åˆ°2019å¹´çš„Androidæœºå™¨äººæŠ€æœ¯ï¼šçœŸå®çš„æ•…äº‹ï¼› åˆ†5éƒ¨åˆ†ï¼› ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN436744/index.html">ä½¿ç”¨Neural Compute Stickå’ŒOpenVINOåœ¨Raspberry Piä¸Šå¯åŠ¨ç¥ç»ç½‘ç»œæ£€æµ‹å™¨</a></li>
<li><a href="../zh-CN436748/index.html">ä»é›¶å¼€å§‹å¼€å‘å…­è„šæ¶ï¼ˆç¬¬3éƒ¨åˆ†ï¼‰-è¿åŠ¨å­¦</a></li>
<li><a href="../zh-CN436750/index.html">2018å¹´ä¿„ç½—æ–¯YouTubeè¶‹åŠ¿åˆ†æ</a></li>
<li><a href="../zh-CN436752/index.html">è›‹ç³•æ˜¯éª—äººçš„</a></li>
<li><a href="../zh-CN436754/index.html">Q2VKPTï¼šå®Œå…¨é‡å†™çš„Quake IIï¼Œå…·æœ‰é€¼çœŸçš„ç…§æ˜</a></li>
<li><a href="../zh-CN436756/index.html">åŒæ„æ€¥æ•‘</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>