<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèáüèª ü•• ü§òüèª MetricKit. An√°lisis de rendimiento de aplicaciones iOS. üö¥üèæ ü§ï üò™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nuevo juguete 
 Continuamos familiariz√°ndonos con el nuevo material de Apple presentado en WWDC. Esta vez, considere MetricKit , un marco completament...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MetricKit. An√°lisis de rendimiento de aplicaciones iOS.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468347/"><img src="https://habrastorage.org/getpro/habr/post_images/362/bcb/a7d/362bcba7db30e427252ec3bf33b87042.jpg" alt="imagen"><br><br><h3>  Nuevo juguete </h3><br>  Continuamos familiariz√°ndonos con el nuevo material de Apple presentado en WWDC.  Esta vez, considere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MetricKit</a> , un marco completamente nuevo que sirve como herramienta para monitorear el rendimiento de la aplicaci√≥n. <br><a name="habracut"></a><br>  Todos saben que medir el rendimiento de la aplicaci√≥n durante el desarrollo es f√°cil.  Xcode muestra la cantidad de RAM utilizada y la carga del procesador, puede conectarse utilizando instrumentos a un simulador o dispositivo bajo prueba e incluso escribir sus propias herramientas (para m√°s detalles, consulte nuestros art√≠culos sobre paquetes de herramientas personalizadas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 1</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte 2</a> ).  El solo hecho de comprender la importancia del ajuste del rendimiento no le permite medir casi todo lo que hace la aplicaci√≥n.  Pero las cosas se vuelven m√°s complicadas cuando hablamos de AppStore, si la aplicaci√≥n desarrollada est√° destinada a usuarios reales.  No importa cu√°n cuidadosamente pruebe su aplicaci√≥n, en condiciones reales siempre habr√° un mont√≥n de sorpresas que afectar√°n el rendimiento y la experiencia del usuario.  Por supuesto, hay muchas herramientas para recopilar varios par√°metros, pero la mayor√≠a de ellos est√°n limitados por el <b>SDK de iOS</b> , as√≠ como por el impacto de la supervisi√≥n real en el comportamiento de la aplicaci√≥n. <br><br>  Este a√±o, Apple decidi√≥ llenar este vac√≠o y proporcion√≥ a los desarrolladores una herramienta que les ayuda a recopilar y analizar las m√©tricas de rendimiento de las aplicaciones en un entorno del mundo real.  Anunciaron <b>MetricKit</b> (un marco que proporciona acceso a las opciones que ofrece el sistema operativo) de una pesta√±a separada en el organizador Xcode 11, donde puede encontrar la configuraci√≥n de la aplicaci√≥n.  Haremos una pausa en MetricKit, porque la visualizaci√≥n de par√°metros en Xcode solo funcionar√° con aplicaciones que ya est√°n publicadas en la AppStore. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/78a/64c/612/78a64c6124242358e3ceb0ab5b63fe88.png" alt="imagen"><br><br><h3>  MXMetricManager </h3><br>  La arquitectura del marco es bastante simple y directa.  La parte central est√° ocupada por la clase <b>MXMetricManager</b> , que es una estructura de un solo elemento que proporciona al desarrollador un gran conjunto de API de marco. <br><br>  En general, el flujo de trabajo consta de 3 pasos principales: <br><br><ol><li>  Inicializa MXMetricMnager y le asigna un observador. </li><li>  Si lo desea, puede implementar sus propias m√©tricas en su aplicaci√≥n utilizando la API Signpost </li><li>  Y finalmente, ahora estamos tratando con los datos recibidos en el m√©todo didReceivePayloads, es decir  env√≠elos a su backend para su posterior an√°lisis. </li></ol><br>  Los par√°metros vienen como una matriz de instancias de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MXMetricPayload</a> .  La carga √∫til encapsula conjuntos de metadatos y marcas de tiempo.  La carga √∫til m√©trica es un contenedor simple para subclasificar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MXMetric</a> .  Para cada tipo de par√°metro, es independiente. <br><br>  Los tipos de m√©tricas est√°n bastante bien documentados por Apple, as√≠ que no nos detenemos en esto por mucho tiempo.  Sin embargo, debe detenerse para notar una cosa interesante: MXMetric proporciona una API abierta para serializarlo en NSDictionary o JSON, que, en mi opini√≥n, es un poco inusual. <br><br><h3>  Componentes internos de MetricKit. </h3><br>  Afuera, MetricKit parece bastante simple.  Pero siempre es interesante ver c√≥mo funciona todo de adentro hacia afuera.  La inmersi√≥n en algo m√°s profundo siempre es una intriga, si se enfrenta a una tarea espec√≠fica.  As√≠ que decid√≠ que quer√≠a pasar par√°metros con las etiquetas MetricKit y luego hacer que me proporcionen m√©tricas actualizadas en cualquier momento.  Por supuesto, puede usar ` <i>Debug -&gt; Simulate MetricKit Payloads`</i> en Xcode, pero id no le permite mostrar sus propios datos.  Es cierto que este no es un equipo muy √∫til, pero le da direcci√≥n en su investigaci√≥n y se ve muy divertido;) <br><br>  Para comenzar la tarea, obviamente necesitamos MetricKit.  Puede pensar que obtener un archivo binario para el marco es f√°cil, porque Xcode lo muestra en la lista de marcos tan pronto como lo agrega a trav√©s del cuadro de di√°logo "vincular archivo binario a bibliotecas".  Este es un pensamiento muy optimista.  Porque si abre <b>MetricKit.framework</b> , ver√° el archivo <b>MetricKit.tbd</b> .  Su tama√±o es de solo <b>4kb</b> .  Obviamente, esto no es lo que estamos buscando. <br><br>  Entonces, ¬øqu√© est√° pasando realmente aqu√≠? <br><br>  <b>TBD</b> significa "trozo de dylib basado en texto" y en realidad es un archivo YAML con una descripci√≥n de dylib que exporta caracteres y una ruta al binario dylib.  La vinculaci√≥n a archivos tbd reduce el tama√±o del binario.  M√°s tarde, en tiempo de ejecuci√≥n, el binario dylib real se descargar√° del sistema operativo en la ruta especificada en el archivo tbd.  As√≠ es como se ve el archivo cuando lo abre en Xcode: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/047/3d2/e9e/0473d2e9e853e1c65632c2a1b2500b39.png" alt="imagen"><br><br>  Usando la ruta del archivo tbd, puede obtener f√°cilmente el binario MetricKit para futuras investigaciones, pero hay un m√©todo a√∫n m√°s simple. <br><br>  Nuestro binario de aplicaci√≥n contiene la ruta a cada biblioteca vinculada din√°micamente en la secci√≥n de encabezado Mach-O.  Esta informaci√≥n se recupera f√°cilmente usando la herramienta usando la bandera -l. <br><br>  Aqu√≠ est√° la salida para el proyecto de prueba que cre√©: <br><br><pre><code class="swift hljs">‚Üí otool -l ./<span class="hljs-type"><span class="hljs-type">Metrics</span></span> | grep -i metrickit name /<span class="hljs-type"><span class="hljs-type">System</span></span>/<span class="hljs-type"><span class="hljs-type">Library</span></span>/<span class="hljs-type"><span class="hljs-type">Frameworks</span></span>/<span class="hljs-type"><span class="hljs-type">MetricKit</span></span>.framework/<span class="hljs-type"><span class="hljs-type">MetricKit</span></span> (offset <span class="hljs-number"><span class="hljs-number">24</span></span>)</code> </pre> <br>  Puede ver la misma ruta que vimos anteriormente en el archivo tbd.  Tener un archivo de marco binario, puede echar un vistazo a los elementos internos.  Para esto, generalmente uso el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Desmontaje de</a> la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tolva</a> .  Es una herramienta f√°cil de usar, pero muy poderosa para un estudio cuidadoso de los archivos binarios. <br><br>  Tan pronto como se abra el archivo binario MetricKit, vaya a la pesta√±a 'Proceso'.  y expanda la lista 'Etiquetas'.  Aqu√≠ puede ver todos los caracteres exportados.  Al seleccionar uno de ellos (por ejemplo, MXMetricManager), veremos todos sus m√©todos y, despu√©s de haber seleccionado un m√©todo, veremos su contenido en el lado derecho: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ac1/f17/71a/ac1f1771a4b061364d898d3c28f4564c.png" alt="imagen"><br><br>  Al ver la lista de m√©todos MXMetricManager [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://gist.github.com/deszip/88a258ae21d33dc75d7cbac9569c6ec1</a> ] es muy f√°cil notar el m√©todo _checkAndDeliverMetricReports.  Esto parece ser lo que hay que llamar para que MetricKit entregue actualizaciones a los suscriptores. <br><br>  Desafortunadamente, un intento de llamarlo no condujo a una llamada al suscriptor, lo que probablemente significa que estos par√°metros no se entregar√°n.  Considerando la implementaci√≥n del m√©todo, observamos algunas cosas interesantes: enumera el contenido del directorio / Library / Caches / MetricKit / Reports. <br><br>  Luego intenta descomprimir la instancia de MXMetricPayload para cada elemento en el disco.  Y finalmente, itera sobre los suscriptores registrados y llama al m√©todo didReceive con una lista de datos. <br><br>  El problema es probablemente que no hay datos en <i>/ Library / Caches / MetricKit / Reports</i> , pero sabemos que necesitamos algunas instancias archivadas de MXMetricPayload.  Entonces, <i>cre√©moslos</i> y col√≥quelos en el disco antes de llamar a ' <i>_checkAndDeliverMetricReports</i> '.  Nuevamente, el plan es crear una instancia de MXMetricPayload, luego crear y agregar cualquier tipo de MXMetric y luego archivar la instancia de datos en el disco.  Despu√©s de todo, llame al m√©todo ' <i>_checkAndDeliverMetricReports</i> ', esto deber√≠a conducir a llamar a nuestro suscriptor con stub como argumento. <br><br>  Al revisar los documentos de Apple sobre la carga √∫til y las m√©tricas, puede observar que no tienen inicializadores p√∫blicos y que la mayor√≠a de las propiedades son de solo lectura.  Entonces, ¬øc√≥mo es posible instanciar una clase? <br><br>  Vuelva a Hopper nuevamente para ver una lista de los m√©todos de <b>MXMetricPayload</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3d6/e2a/12c/3d6e2a12c6d296f9f88f811068b4762d.png" alt="imagen"><br><br>  Aqu√≠ puede ver sus inicializadores y m√©todos para asignar par√°metros.  Llamar a m√©todos privados es f√°cil usando la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NSInvocation</a> y el m√©todo 'performSelector' debido a la naturaleza din√°mica de Objective-C. <br><br>  Como ejemplo, crearemos m√©tricas para la CPU y las agregaremos a la carga √∫til.  Usando este enlace, puede encontrar el fragmento de c√≥digo completo: [ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://gist.github.com/deszip/a0cf877b07cc2877129e0aaef2fed1e4</a> ]. <br><br>  Y finalmente, archivamos todo lo que creamos y escribimos los datos en el <i>directorio / Library / Caches / MetricKit / Reports</i> . <br><br>  Ahora es el momento de llamar al m√©todo ' <i>_checkAndDeliverMetricReports</i> ', que eventualmente deber√≠a conducir a una llamada al suscriptor.  Esta vez pasamos los datos con carga √∫til stubbed como argumento como argumento. <br><br><h3>  ¬øDe d√≥nde vienen las m√©tricas? </h3><br>  Obtener informes es bastante f√°cil de implementar a trav√©s de <b>MetricKit</b> , pero probablemente est√© interesado en aprender c√≥mo aparecen los informes en el directorio de la <i>aplicaci√≥n / Biblioteca</i> .  Aqu√≠ es c√≥mo. <br><br>  Al excavar dentro del binario MetricKit, not√© este m√©todo: '_createXPCConnection'.  La comprobaci√≥n de su implementaci√≥n aclara la situaci√≥n: crea una NSXPCConnection para servicio con el nombre <i>com.apple.metrickit.xpc</i> y dos interfaces <b>MXXPCServer</b> y <b>MXXPCClient</b> para el cliente y el servidor.  Si nos fijamos en la descripci√≥n del protocolo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ae/6ac/fe4/0ae6acfe4f83220d86aa7e61b9690cf5.png" alt="imagen"><br><br><h3>  Conclusi√≥n </h3><br>  <b>MetricKit</b> es una herramienta √∫nica e indispensable para cuidar el rendimiento de su aplicaci√≥n en condiciones reales de producci√≥n. <br><br>  Desafortunadamente, actualmente no es posible echar un vistazo a la interfaz de usuario 'M√©trica' en Xcode, excepto lo que se mostr√≥ durante una demostraci√≥n en una sesi√≥n de WWDC. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b9/2ec/8af/8b92ec8aff5e8566f00506333e0e4206.png" alt="imagen"><br><br>  Puede ser una herramienta invaluable para llevar la experiencia del usuario al siguiente nivel al eliminar problemas de rendimiento en su c√≥digo. <br><br>  Un inconveniente que veo ahora en esta herramienta es la falta de detalles para cada tipo: solo la separaci√≥n es la versi√≥n de la aplicaci√≥n, y no puede ver ninguna m√©trica para un grupo espec√≠fico de dispositivos / versiones de SO / regiones, etc. <br><br>  Pero, por supuesto, siempre existe la oportunidad de enviarse datos a usted mismo para su posterior procesamiento junto con la informaci√≥n importante que necesita.  Puede adjuntarlo a tareas en su rastreador de errores y m√°s.  En <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AppSpector,</a> nuestro equipo est√° trabajando para expandir la funcionalidad de las herramientas de monitoreo de rendimiento utilizando los datos obtenidos de <b>MetricKit</b> . <br><br>  Mant√©ngase al d√≠a! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/468347/">https://habr.com/ru/post/468347/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../468337/index.html">Trabajar con cron para Android y agregar un script de shell para la ejecuci√≥n autom√°tica cuando se inicia el dispositivo</a></li>
<li><a href="../468339/index.html">Presentamos el tema oscuro para Visual Studio App Center</a></li>
<li><a href="../468341/index.html">Azure Cloud Shell en la Terminal de Windows</a></li>
<li><a href="../468343/index.html">Jeff Bezos: "Ir al espacio por el bien de la tierra"</a></li>
<li><a href="../468345/index.html">GitHub lanza sus tent√°culos en CI / CD y gesti√≥n de artefactos</a></li>
<li><a href="../468351/index.html">Microestructura de mercado y selecci√≥n adversa</a></li>
<li><a href="../468363/index.html">Mi magnum opus del mundo de los juegos m√≥viles</a></li>
<li><a href="../468367/index.html">Amazon anuncia plan de calentamiento global</a></li>
<li><a href="../468369/index.html">C√≥mo cre√© "WildMAN" - una parodia de muchos juegos de 8 bits y recientemente lo port√© a Android</a></li>
<li><a href="../468371/index.html">Dise√±o de juegos a la vida. Descarga sin problemas o inmersi√≥n completa en God of War 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>