<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â®ï¸ ğŸŒ¨ï¸ ğŸ’¬ å‡å°‘Dockeræ˜ åƒçš„ä¸‰ä¸ªç®€å•æŠ€å·§ ğŸ‘¨ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ» ğŸ‰ ğŸ‘©ğŸ½â€ğŸ”§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨åˆ›å»ºDockerå®¹å™¨æ—¶ï¼Œæœ€å¥½æ€»æ˜¯å°½é‡å‡å°‘å›¾åƒçš„å¤§å°ã€‚ ä½¿ç”¨ç›¸åŒå›¾å±‚ä¸”é‡é‡æ›´è½»çš„å›¾åƒ-æ›´å¿«åœ°ä¼ è¾“å’Œéƒ¨ç½²ã€‚ 


ä½†æ˜¯ï¼Œå½“æ¯æ¬¡æ‰§è¡ŒRUNè¯­å¥åˆ›å»ºä¸€ä¸ªæ–°å±‚æ—¶ï¼Œå¦‚ä½•æ§åˆ¶å¤§å°ï¼Ÿ å¦å¤–ï¼Œåœ¨åˆ›å»ºå›¾åƒæœ¬èº«ä¹‹å‰ï¼Œæ‚¨ä»ç„¶éœ€è¦ä¸­é—´å·¥ä»¶... 


 æ‚¨å¯èƒ½çŸ¥é“å¤§å¤šæ•°Dockeræ–‡ä»¶éƒ½æœ‰å…¶è‡ªå·±çš„ç›¸å½“å¥‡æ€ªçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å‡å°‘Dockeræ˜ åƒçš„ä¸‰ä¸ªç®€å•æŠ€å·§</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/nixys/blog/437372/"><img src="https://habrastorage.org/getpro/habr/post_images/339/ed2/afb/339ed2afb54b94a155f95e6a279ede9d.png" alt="å›¾ç‰‡"><br><p> åœ¨åˆ›å»ºDockerå®¹å™¨æ—¶ï¼Œæœ€å¥½æ€»æ˜¯å°½é‡å‡å°‘å›¾åƒçš„å¤§å°ã€‚ ä½¿ç”¨ç›¸åŒå›¾å±‚ä¸”é‡é‡æ›´è½»çš„å›¾åƒ-æ›´å¿«åœ°ä¼ è¾“å’Œéƒ¨ç½²ã€‚ </p><br><p>ä½†æ˜¯ï¼Œå½“æ¯æ¬¡æ‰§è¡Œ<code>RUN</code>è¯­å¥åˆ›å»ºä¸€ä¸ªæ–°å±‚æ—¶ï¼Œå¦‚ä½•æ§åˆ¶å¤§å°ï¼Ÿ å¦å¤–ï¼Œåœ¨åˆ›å»ºå›¾åƒæœ¬èº«ä¹‹å‰ï¼Œæ‚¨ä»ç„¶éœ€è¦ä¸­é—´å·¥ä»¶... </p><a name="habracut"></a><br><p> æ‚¨å¯èƒ½çŸ¥é“å¤§å¤šæ•°Dockeræ–‡ä»¶éƒ½æœ‰å…¶è‡ªå·±çš„ç›¸å½“å¥‡æ€ªçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š </p><br><pre> <code class="plaintext hljs">FROM ubuntu RUN apt-get update &amp;&amp; apt-get install vim</code> </pre> <br><p> å¥½å§ï¼Œä¸ºä»€ä¹ˆ<code>&amp;&amp;</code>åœ¨è¿™é‡Œï¼Ÿ è¿™æ ·è¿è¡Œä¸¤ä¸ª<code>RUN</code>è¯­å¥éš¾é“ä¸æ˜¯å¾ˆå®¹æ˜“å—ï¼Ÿ </p><br><pre> <code class="plaintext hljs">FROM ubuntu RUN apt-get update RUN apt-get install vim</code> </pre> <br><p> ä»Docker 1.10ç‰ˆæœ¬å¼€å§‹ï¼Œ <code>COPY</code> ï¼Œ <code>ADD</code>å’Œ<code>RUN</code>æ“ä½œç¬¦å°†æ–°å±‚æ·»åŠ åˆ°æ˜ åƒä¸­ã€‚ åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œåˆ›å»ºäº†ä¸¤å±‚è€Œä¸æ˜¯ä¸€å±‚ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cfb/fd8/e34/cfbfd8e34d1dd89685121383128c05aa.gif" alt="å›¾ç‰‡"></p><br><h3 id="sloi-kak-git-kommity">  gitæäº¤å±‚ã€‚ </h3><br><p>  Dockerå±‚ä¿ç•™äº†æ˜ åƒçš„å…ˆå‰ç‰ˆæœ¬ä¸å½“å‰ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ã€‚ ä¸git commitsä¸€æ ·ï¼Œå¦‚æœæ‚¨ä¸å…¶ä»–å­˜å‚¨åº“æˆ–å›¾åƒå…±äº«å®ƒä»¬ï¼Œå®ƒä»¬å°†å¾ˆæ–¹ä¾¿ã€‚ å®é™…ä¸Šï¼Œå½“ä»æ³¨å†Œè¡¨ä¸­è¯·æ±‚å›¾åƒæ—¶ï¼Œåªä¼šåŠ è½½ç¼ºå°‘çš„å›¾å±‚ï¼Œä»è€Œç®€åŒ–äº†å®¹å™¨ä¹‹é—´å›¾åƒçš„åˆ†ç¦»ã€‚ </p><br><p> ä½†æ˜¯åŒæ—¶ï¼Œæ¯ä¸€å±‚éƒ½ä¼šå‘ç”Ÿï¼Œå¹¶ä¸”å±‚æ•°è¶Šå¤šï¼Œæœ€ç»ˆå›¾åƒå°±è¶Šé‡ã€‚  Gitå­˜å‚¨åº“åœ¨è¿™æ–¹é¢æ˜¯ç›¸ä¼¼çš„ï¼šå­˜å‚¨åº“çš„å¤§å°éšå±‚æ•°çš„å¢åŠ è€Œå¢åŠ ï¼Œå› ä¸ºå®ƒå¿…é¡»å­˜å‚¨æäº¤ä¹‹é—´çš„æ‰€æœ‰æ›´æ”¹ã€‚ ä¸ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸€æ ·ï¼Œåœ¨åŒä¸€è¡Œä¸Šåˆå¹¶å¤šä¸ª<code>RUN</code>è¯­å¥æ›¾ç»æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ ä½†æ˜¯ç°åœ¨ï¼Œaï¼Œä¸ã€‚ </p><br><h2 id="1-obedinyaem-neskolkih-sloev-v-odin-s-pomoschyu-poetapnoy-sborki-docker-obrazov">  1.ä½¿ç”¨åˆ†é˜¶æ®µç»„è£…çš„Dockeræ˜ åƒå°†å¤šå±‚ç»„åˆä¸ºä¸€å±‚ </h2><br><p> å½“Gitå­˜å‚¨åº“å¢é•¿æ—¶ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°å°†æ•´ä¸ªå˜æ›´å†å²æ€»ç»“ä¸ºä¸€ä¸ªæäº¤ï¼Œè€Œä¸å¿…ç†ä¼šã€‚ äº‹å®è¯æ˜ï¼Œå¯ä»¥é€šè¿‡åˆ†é˜¶æ®µç»„è£…åœ¨Dockerä¸­å®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚ </p><br><p> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªNode.jså®¹å™¨ </p><br><p> è®©æˆ‘ä»¬ä»<code>index.js</code>å¼€å§‹ï¼š </p><br><pre> <code class="plaintext hljs">const express = require('express') const app = express() app.get('/', (req, res) =&gt; res.send('Hello World!')) app.listen(3000, () =&gt; { console.log(`Example app listening on port 3000!`) })</code> </pre> <br><p> å’Œ<code>package.json</code> ï¼š </p><br><pre> <code class="plaintext hljs">{ "name": "hello-world", "version": "1.0.0", "main": "index.js", "dependencies": { "express": "^4.16.2" }, "scripts": { "start": "node index.js" } }</code> </pre> <br><p> ä½¿ç”¨ä»¥ä¸‹<code>Dockerfile</code>æ‰“åŒ…åº”ç”¨ç¨‹åºï¼š </p><br><pre> <code class="plaintext hljs">FROM node:8 EXPOSE 3000 WORKDIR /app COPY package.json index.js ./ RUN npm install CMD ["npm", "start"]</code> </pre> <br><p> åˆ›å»ºå›¾åƒï¼š </p><br><pre> <code class="plaintext hljs">$ docker build -t node-vanilla .</code> </pre> <br><p> æ£€æŸ¥ä¸€åˆ‡æ­£å¸¸ï¼š </p><br><pre> <code class="plaintext hljs">$ docker run -p 3000:3000 -ti --rm --init node-vanilla</code> </pre> <br><p>  <em>ç°åœ¨ï¼Œæ‚¨å¯ä»¥å•å‡»é“¾æ¥ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">httpï¼š//æœ¬åœ°ä¸»æœºï¼š3000ï¼Œ</a>ç„¶ååœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>çœ‹åˆ°â€œ Hello Worldï¼â€ã€‚</em> </p><br><p> åœ¨<code>Dockerfile</code>ç°åœ¨æœ‰äº†<code>COPY</code>å’Œ<code>RUN</code>è¿ç®—ç¬¦ï¼Œå› æ­¤ä¸åŸå§‹æ˜ åƒç›¸æ¯”ï¼Œæˆ‘ä»¬å°†å¢é•¿è‡³å°‘å›ºå®šäº†ä¸¤å±‚ï¼š </p><br><pre> <code class="plaintext hljs">$ docker history node-vanilla IMAGE CREATED BY SIZE 075d229d3f48 /bin/sh -c #(nop) CMD ["npm" "start"] 0B bc8c3cc813ae /bin/sh -c npm install 2.91MB bac31afb6f42 /bin/sh -c #(nop) COPY multi:3071ddd474429e1â€¦ 364B 500a9fbef90e /bin/sh -c #(nop) WORKDIR /app 0B 78b28027dfbf /bin/sh -c #(nop) EXPOSE 3000 0B b87c2ad8344d /bin/sh -c #(nop) CMD ["node"] 0B &lt;missing&gt; /bin/sh -c set -ex &amp;&amp; for key in 6A010â€¦ 4.17MB &lt;missing&gt; /bin/sh -c #(nop) ENV YARN_VERSION=1.3.2 0B &lt;missing&gt; /bin/sh -c ARCH= &amp;&amp; dpkgArch="$(dpkg --printâ€¦ 56.9MB &lt;missing&gt; /bin/sh -c #(nop) ENV NODE_VERSION=8.9.4 0B &lt;missing&gt; /bin/sh -c set -ex &amp;&amp; for key in 94AE3â€¦ 129kB &lt;missing&gt; /bin/sh -c groupadd --gid 1000 node &amp;&amp; useâ€¦ 335kB &lt;missing&gt; /bin/sh -c set -ex; apt-get update; apt-geâ€¦ 324MB &lt;missing&gt; /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦ 123MB &lt;missing&gt; /bin/sh -c set -ex; if ! command -v gpg &gt; /â€¦ 0B &lt;missing&gt; /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦ 44.6MB &lt;missing&gt; /bin/sh -c #(nop) CMD ["bash"] 0B &lt;missing&gt; /bin/sh -c #(nop) ADD file:1dd78a123212328bdâ€¦ 123MB</code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œæœ€ç»ˆæ˜ åƒå¢åŠ äº†äº”ä¸ªæ–°å±‚ï¼š <code>Dockerfile</code>æ¯ä¸ªæ“ä½œç¬¦<code>Dockerfile</code> ã€‚ ç°åœ¨è®©æˆ‘ä»¬å°è¯•åˆ†é˜¶æ®µçš„Dockeræ„å»ºã€‚ æˆ‘ä»¬ä½¿ç”¨ç›¸åŒçš„<code>Dockerfile</code> ï¼ŒåŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š </p><br><pre> <code class="plaintext hljs">FROM node:8 as build WORKDIR /app COPY package.json index.js ./ RUN npm install FROM node:8 COPY --from=build /app / EXPOSE 3000 CMD ["index.js"]</code> </pre> <br><p>  <code>Dockerfile</code>çš„ç¬¬ä¸€éƒ¨åˆ†åˆ›å»ºä¸‰å±‚ã€‚ ç„¶åå°†å„å±‚åˆå¹¶å¹¶å¤åˆ¶åˆ°ç¬¬äºŒé˜¶æ®µå’Œæœ€åé˜¶æ®µã€‚ ä¸Šé¢çš„å›¾åƒä¸­åˆæ·»åŠ äº†ä¸¤å±‚ã€‚ ç»“æœï¼Œæˆ‘ä»¬åˆ†ä¸ºä¸‰å±‚ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/72c/6a6/61e/72c6a661ef969eabd58a91b4b71b0329.gif" alt="å›¾ç‰‡"></p><br><p> è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼š </p><br><pre> <code class="plaintext hljs">$ docker build -t node-multi-stage .</code> </pre> <br><p> æŸ¥çœ‹å†å²è®°å½•ï¼š </p><br><pre> <code class="plaintext hljs">$ docker history node-multi-stage IMAGE CREATED BY SIZE 331b81a245b1 /bin/sh -c #(nop) CMD ["index.js"] 0B bdfc932314af /bin/sh -c #(nop) EXPOSE 3000 0B f8992f6c62a6 /bin/sh -c #(nop) COPY dir:e2b57dff89be62f77â€¦ 1.62MB b87c2ad8344d /bin/sh -c #(nop) CMD ["node"] 0B &lt;missing&gt; /bin/sh -c set -ex &amp;&amp; for key in 6A010â€¦ 4.17MB &lt;missing&gt; /bin/sh -c #(nop) ENV YARN_VERSION=1.3.2 0B &lt;missing&gt; /bin/sh -c ARCH= &amp;&amp; dpkgArch="$(dpkg --printâ€¦ 56.9MB &lt;missing&gt; /bin/sh -c #(nop) ENV NODE_VERSION=8.9.4 0B &lt;missing&gt; /bin/sh -c set -ex &amp;&amp; for key in 94AE3â€¦ 129kB &lt;missing&gt; /bin/sh -c groupadd --gid 1000 node &amp;&amp; useâ€¦ 335kB &lt;missing&gt; /bin/sh -c set -ex; apt-get update; apt-geâ€¦ 324MB &lt;missing&gt; /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦ 123MB &lt;missing&gt; /bin/sh -c set -ex; if ! command -v gpg &gt; /â€¦ 0B &lt;missing&gt; /bin/sh -c apt-get update &amp;&amp; apt-get installâ€¦ 44.6MB &lt;missing&gt; /bin/sh -c #(nop) CMD ["bash"] 0B &lt;missing&gt; /bin/sh -c #(nop) ADD file:1dd78a123212328bdâ€¦ 123MB</code> </pre> <br><p> æŸ¥çœ‹æ–‡ä»¶å¤§å°æ˜¯å¦å·²æ›´æ”¹ï¼š </p><br><pre> <code class="plaintext hljs">$ docker images | grep node- node-multi-stage 331b81a245b1 678MB node-vanilla 075d229d3f48 679MB</code> </pre> <br><p> æ˜¯çš„ï¼Œå®ƒå·²ç»å˜å°äº†ï¼Œä½†è¿˜ä¸æ˜¯å¾ˆå¤§ã€‚ </p><br><h2 id="2-snosim-vse-lishnee-iz-konteynera-s-pomoschyu-distroless">  2.æˆ‘ä»¬ä½¿ç”¨distrolessä»å®¹å™¨ä¸­æ¸…é™¤æ‰€æœ‰ä¸å¿…è¦çš„ä¸œè¥¿ </h2><br><p> å½“å‰å›¾åƒä¸ºæˆ‘ä»¬æä¾›äº†Node.jsï¼Œ <code>yarn</code> ï¼Œ <code>npm</code> ï¼Œ <code>bash</code>å’Œè®¸å¤šå…¶ä»–æœ‰ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ è€Œä¸”ï¼Œå®ƒåŸºäºUbuntuã€‚ å› æ­¤ï¼Œé€šè¿‡éƒ¨ç½²å®ƒï¼Œæˆ‘ä»¬è·å¾—äº†å…·æœ‰è®¸å¤šæœ‰ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶å’Œå®ç”¨ç¨‹åºçš„æˆç†Ÿæ“ä½œç³»ç»Ÿã€‚ </p><br><p> ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®ƒä»¬æ¥è¿è¡Œå®¹å™¨ã€‚ å”¯ä¸€éœ€è¦çš„ä¾èµ–é¡¹æ˜¯Node.jsã€‚ </p><br><p>  Dockerå®¹å™¨å¿…é¡»æ”¯æŒä¸€ä¸ªè¿›ç¨‹çš„æ“ä½œï¼Œå¹¶åŒ…å«è¿è¡Œå®ƒçš„æœ€å°‘å¿…éœ€çš„ä¸€ç»„å·¥å…·ã€‚ ä¸éœ€è¦æ•´ä¸ªæ“ä½œç³»ç»Ÿã€‚ </p><br><p> å› æ­¤ï¼Œé™¤äº†Node.jsï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸­è·å¾—æ‰€æœ‰æ”¶ç›Šã€‚ </p><br><p>  <strong>ä½†æ˜¯å¦‚ä½•ï¼Ÿ</strong> </p><br><p> è°·æ­Œå·²ç»æå‡ºäº†ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">-GoogleCloudPlatform / distroless</a> ã€‚ </p><br><p> å­˜å‚¨åº“çš„æè¿°ä¸ºï¼š </p><br><p>  <em>éå‘è¡Œç‰ˆæ˜ åƒä»…åŒ…å«åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–é¡¹ã€‚</em>  <em>åœ¨æ ‡å‡†Linuxå‘è¡Œç‰ˆä¸­é€šå¸¸æ²¡æœ‰æ‰¾åˆ°åŒ…ç®¡ç†å™¨ï¼Œshellæˆ–å…¶ä»–ç¨‹åºã€‚</em> </p><br><p>  <strong>è¿™å°±æ˜¯æ‚¨æ‰€éœ€è¦çš„ï¼</strong> </p><br><p> è¿è¡Œ<code>Dockerfile</code>ä»¥è·å–æ–°æ˜ åƒï¼š </p><br><pre> <code class="plaintext hljs">FROM node:8 as build WORKDIR /app COPY package.json index.js ./ RUN npm install FROM gcr.io/distroless/nodejs COPY --from=build /app / EXPOSE 3000 CMD ["index.js"]</code> </pre> <br><p> æˆ‘ä»¬ç…§å¸¸æ”¶é›†å›¾åƒï¼š </p><br><pre> <code class="plaintext hljs">$ docker build -t node-distroless .</code> </pre> <br><p> è¯¥åº”ç”¨ç¨‹åºåº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œã€‚ è¦æ£€æŸ¥ï¼Œè¯·è¿è¡Œå®¹å™¨ï¼š </p><br><pre> <code class="plaintext hljs">$ docker run -p 3000:3000 -ti --rm --init node-distroless</code> </pre> <br><p> å¹¶è½¬åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">httpï¼š// localhostï¼š3000</a> ã€‚ æ²¡æœ‰é¢å¤–çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå›¾åƒå˜å¾—æ›´å®¹æ˜“äº†å—ï¼Ÿ </p><br><pre> <code class="plaintext hljs">$ docker images | grep node-distroless node-distroless 7b4db3b7f1e5 76.7MB</code> </pre> <br><p>  <strong>å°±è¿™æ ·ï¼</strong>  <strong>ç°åœ¨ï¼Œå®ƒçš„é‡é‡ä»…ä¸º76.7 MBï¼Œå°‘äº†600 MBï¼</strong> </p><br><p> ä¸€åˆ‡éƒ½å¾ˆé…·ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹å¾ˆé‡è¦ã€‚ å½“å®¹å™¨è¿è¡Œæ—¶ï¼Œéœ€è¦æ£€æŸ¥å®ƒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œè¿æ¥ï¼š </p><br><pre> <code class="plaintext hljs">$ docker exec -ti &lt;insert_docker_id&gt; bash</code> </pre> <br><p> è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶å¯åŠ¨<code>bash</code>ä¸åˆ›å»ºSSHä¼šè¯éå¸¸ç›¸ä¼¼ã€‚ </p><br><p> ä½†æ˜¯ç”±äºdistrolessæ˜¯åŸå§‹æ“ä½œç³»ç»Ÿçš„ç®€åŒ–ç‰ˆæœ¬ï¼Œå› æ­¤æ²¡æœ‰å…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¹Ÿå®é™…ä¸Šæ²¡æœ‰shellï¼ </p><br><p> å¦‚æœæ²¡æœ‰å¤–å£³ï¼Œå¦‚ä½•è¿æ¥åˆ°æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Ÿ </p><br><p> æœ€æœ‰è¶£çš„æ˜¯ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚ </p><br><p> è¿™ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºåªèƒ½åœ¨å®¹å™¨ä¸­æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ å”¯ä¸€å¯ä»¥å¯åŠ¨çš„æ˜¯Node.jsï¼š </p><br><pre> <code class="plaintext hljs">$ docker exec -ti &lt;insert_docker_id&gt; node</code> </pre> <br><p> å®é™…ä¸Šï¼Œè¿™æ ·åšæœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå› ä¸ºå¦‚æœæŸäº›æ”»å‡»è€…å¯ä»¥è®¿é—®è¯¥å®¹å™¨ï¼Œåˆ™å…¶å±å®³è¦æ¯”å…¶å¯ä»¥è®¿é—®çš„Shellå°å¾—å¤šã€‚ æ¢å¥è¯è¯´ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶æ›´å°‘-é‡é‡æ›´è½»ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚ ä½†æ˜¯ï¼Œè¿™æ˜¯ä»¥æ›´å¤æ‚çš„è°ƒè¯•ä¸ºä»£ä»·çš„ã€‚ </p><br><p> åœ¨è¿™é‡Œåº”è¯¥æ³¨æ„ï¼Œåœ¨äº§å“ç¯å¢ƒä¸­è¿æ¥å’Œè°ƒè¯•å®¹å™¨æ˜¯ä¸å€¼å¾—çš„ã€‚ æœ€å¥½ä¾é æ­£ç¡®é…ç½®çš„æ—¥å¿—è®°å½•å’Œç›‘è§†ç³»ç»Ÿã€‚ </p><br><p> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬ä»ç„¶éœ€è¦è°ƒè¯•ï¼Œä½†åˆå¸Œæœ›Dockeræ˜ åƒæœ€å°ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ </p><br><h2 id="3-umenshaem-bazovye-obrazy-s-pomoschyu-alpine">  3.ä½¿ç”¨Alpineå‡å°‘åŸºæœ¬å›¾åƒ </h2><br><p> æ‚¨å¯ä»¥ç”¨Alpineå›¾åƒæ›¿æ¢distrolessã€‚ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Alpine Linux</a>æ˜¯åŸºäº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">musl libc</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">busybox</a>çš„é¢å‘å®‰å…¨çš„è½»é‡çº§å‘è¡Œç‰ˆã€‚ ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šè¯´ä¸€ä¸ªå­—ï¼Œè€Œæ˜¯è¦æ£€æŸ¥ä¸€ä¸‹ã€‚ </p><br><p> ä½¿ç”¨<code>node:8-alpine</code>è¿è¡Œ<code>Dockerfile</code> ï¼š </p><br><pre> <code class="plaintext hljs">FROM node:8 as build WORKDIR /app COPY package.json index.js ./ RUN npm install FROM node:8-alpine COPY --from=build /app / EXPOSE 3000 CMD ["npm", "start"]</code> </pre> <br><p> åˆ›å»ºå›¾åƒï¼š </p><br><pre> <code class="plaintext hljs">$ docker build -t node-alpine .</code> </pre> <br><p> æ£€æŸ¥å°ºå¯¸ï¼š </p><br><pre> <code class="plaintext hljs">$ docker images | grep node-alpine node-alpine aa1f85f8e724 69.7MB</code> </pre> <br><p>  <strong>åœ¨è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬æœ‰69.7MB-ç”šè‡³æ¯”ä¸€ä¸ªå‘è¡Œç‰ˆå›¾åƒè¿˜å°ã€‚</strong> </p><br><p> è®©æˆ‘ä»¬æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿æ¥åˆ°å·¥ä½œå®¹å™¨ï¼ˆå¯¹äºdistrollesæ˜ åƒï¼Œæˆ‘ä»¬æ— æ³•æ‰§è¡Œæ­¤æ“ä½œï¼‰ã€‚ </p><br><p> å¯åŠ¨å®¹å™¨ï¼š </p><br><pre> <code class="plaintext hljs">$ docker run -p 3000:3000 -ti --rm --init node-alpine Example app listening on port 3000!</code> </pre> <br><p> å¹¶è¿æ¥ï¼š </p><br><pre> <code class="plaintext hljs">$ docker exec -ti 9d8e97e307d7 bash OCI runtime exec failed: exec failed: container_linux.go:296: starting container process caused "exec: \"bash\": executable file not found in $PATH": unknown</code> </pre> <br><p> ä¸æˆåŠŸã€‚ ä½†æ˜¯ï¼Œä¹Ÿè®¸å®¹å™¨å·²ç»å˜ç¡¬äº†â€¦â€¦ï¼š </p><br><pre> <code class="plaintext hljs">$ docker exec -ti 9d8e97e307d7 sh / #</code> </pre> <br><p> å¤ªå¥½äº†ï¼ æˆ‘ä»¬è®¾æ³•è¿æ¥åˆ°äº†å®¹å™¨ï¼Œä¸æ­¤åŒæ—¶ï¼Œå®ƒçš„å›¾åƒä¹Ÿå˜å°äº†ã€‚ ä½†æ˜¯è¿™é‡Œæœ‰äº›ç»†å¾®å·®åˆ«ã€‚ </p><br><p> é«˜å±±æ˜ åƒåŸºäºmuslcï¼ˆCçš„æ›¿ä»£æ ‡å‡†åº“ï¼‰ã€‚è€Œå¤§å¤šæ•°Linuxå‘è¡Œç‰ˆï¼ˆå¦‚Ubuntuï¼ŒDebianå’ŒCentOSï¼‰å‡åŸºäºglibcã€‚ å¯ä»¥ç›¸ä¿¡ï¼Œè¿™ä¸¤ä¸ªåº“éƒ½ä¸ºä½¿ç”¨å†…æ ¸æä¾›äº†ç›¸åŒçš„æ¥å£ã€‚ </p><br><p> ä½†æ˜¯ï¼Œå®ƒä»¬æœ‰ä¸åŒçš„ç›®æ ‡ï¼šglibcæ˜¯æœ€å¸¸è§ä¸”æœ€å¿«é€Ÿçš„ï¼Œè€Œmuslcå ç”¨çš„ç©ºé—´æ›´å°‘ï¼Œå¹¶ä¸”ç¼–å†™æ—¶å¸¦æœ‰å®‰å…¨æ€§åè§ã€‚ é€šå¸¸ï¼Œåº”ç”¨ç¨‹åºåœ¨ç¼–è¯‘æ—¶ä¼šç¼–è¯‘ä¸ºç‰¹å®šçš„Cåº“ï¼Œå¦‚æœéœ€è¦ä¸å…¶ä»–åº“ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¿…é¡»é‡æ–°ç¼–è¯‘ã€‚ </p><br><p> æ¢å¥è¯è¯´ï¼Œåœ¨Alpineå›¾åƒä¸Šæ„å»ºå®¹å™¨å¯èƒ½å¯¼è‡´æ„å¤–äº‹ä»¶ï¼Œå› ä¸ºå…¶ä¸­ä½¿ç”¨çš„æ ‡å‡†Cåº“æ˜¯ä¸åŒçš„ã€‚ å½“ä½¿ç”¨é¢„ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼ŒC ++çš„Node.jsæ‰©å±•ï¼‰æ—¶ï¼Œè¿™ç§åŒºåˆ«å°†éå¸¸æ˜æ˜¾ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œå®Œæˆçš„PhantomJSè½¯ä»¶åŒ…åœ¨Alpineä¸Šä¸èµ·ä½œç”¨ã€‚ </p><br><h2 id="tak-kakoy-zhe-bazovyy-obraz-vybrat"> é‚£ä¹ˆè¦é€‰æ‹©çš„åŸºæœ¬å›¾åƒæ˜¯ä»€ä¹ˆï¼Ÿ </h2><br><p> é«˜å±±ï¼Œå¹³æ•´æˆ–é¦™è‰çš„å¤–è§‚-å½“ç„¶ï¼Œæœ€å¥½æ ¹æ®æƒ…å†µå†³å®šã€‚ </p><br><p>  <strong>å¦‚æœæ‚¨è¦å¤„ç†äº§å“å¹¶ä¸”å®‰å…¨æ€§å¾ˆé‡è¦ï¼Œé‚£ä¹ˆå¯èƒ½æœ€å¥½çš„æ–¹æ³•æ˜¯æ— åšä¸æ‘§ã€‚</strong> </p><br><p> æ·»åŠ åˆ°Dockeræ˜ åƒçš„æ¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶éƒ½ä¼šç»™æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç¨³å®šæ€§å¸¦æ¥ä¸€å®šçš„é£é™©ã€‚ é€šè¿‡åœ¨å®¹å™¨ä¸­ä»…å®‰è£…ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥é™ä½è¿™ç§é£é™©ã€‚ </p><br><p> ä¾‹å¦‚ï¼Œå¦‚æœæ”»å‡»è€…å¯ä»¥åœ¨åŸºäºéå‘è¡Œç‰ˆæ˜ åƒè¿è¡Œçš„åº”ç”¨ç¨‹åºä¸­å‘ç°æ¼æ´ï¼Œåˆ™ä»–æ— æ³•åœ¨å®¹å™¨ä¸­è¿è¡Œè¯¥å¤–å£³ï¼Œå› ä¸ºè¯¥å¤–å£³ä¸å­˜åœ¨ï¼ </p><br><p>  <strong>å¦‚æœå‡ºäºæŸç§åŸå› ï¼Œdockeræ˜ åƒçš„å¤§å°å¯¹æ‚¨æ¥è¯´éå¸¸é‡è¦ï¼Œé‚£ä¹ˆç»å¯¹å€¼å¾—ä»”ç»†ç ”ç©¶åŸºäºAlpineçš„æ˜ åƒã€‚</strong> </p><br><p> å®ƒä»¬ç¡®å®å¾ˆå°ï¼Œä½†æ˜¯ä»¥å…¼å®¹æ€§ä¸ºä»£ä»·ã€‚  Alpineä½¿ç”¨çš„æ ‡å‡†Cåº“muslcç•¥æœ‰ä¸åŒï¼Œå› æ­¤æœ‰æ—¶ä¼šå¼¹å‡ºé—®é¢˜ã€‚ å¯ä»¥åœ¨ä»¥ä¸‹é“¾æ¥ä¸­æ‰¾åˆ°ç¤ºä¾‹ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//github.com/grpc/grpc/issues/8528</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://github.com/grpc/grpc/issues/6126</a> ã€‚ </p><br><p>  <strong>é¦™è‰å›¾åƒæ˜¯æµ‹è¯•å’Œå¼€å‘çš„ç†æƒ³é€‰æ‹©ã€‚</strong> </p><br><p> æ˜¯çš„ï¼Œå®ƒä»¬å¾ˆå¤§ï¼Œä½†å®ƒä»¬åœ¨å®‰è£…äº†Ubuntuçš„æˆç†Ÿè®¡ç®—æœºä¸Šçœ‹èµ·æ¥å°½å¯èƒ½å¤šã€‚ æ­¤å¤–ï¼Œæ“ä½œç³»ç»Ÿä¸­çš„æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶å‡å¯ç”¨ã€‚ </p><br><p>  <strong>æ±‡æ€»æ”¶åˆ°çš„Dockeræ˜ åƒçš„å¤§å°ï¼š</strong> </p><br><p>  <code>node:8</code> 8681MB <br>  <code>node:8</code> ï¼Œå¢é‡æ„å»º678MB <br>  <code>gcr.io/distroless/nodejs</code> 76.7MB <br>  <code>node:8-alpine</code> 69.7MB </p><br><h3 id="naputstvie-ot-perevodchika"> è¯‘è€…çš„åˆ†è¯ </h3><br><p> é˜…è¯»æˆ‘ä»¬åšå®¢ä¸Šçš„å…¶ä»–æ–‡ç« ï¼š </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesä¸­çš„çŠ¶æ€å¤‡ä»½</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤‡ä»½å¤§é‡å¼‚æ„Webé¡¹ç›®</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Redmineçš„ç”µæŠ¥æœºå™¨äººã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦‚ä½•ç®€åŒ–è‡ªå·±å’Œä»–äººçš„ç”Ÿæ´»</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN437372/">https://habr.com/ru/post/zh-CN437372/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN437358/index.html">äº§å“å…¼å®¹æ€§ç®¡ç†</a></li>
<li><a href="../zh-CN437360/index.html">ä¸ä½¿ç”¨Arduino IDEæ§åˆ¶å°ä¸‹è½½æ§åˆ¶å™¨</a></li>
<li><a href="../zh-CN437364/index.html">å¯¹Tele2çš„æ§åˆ¶å°†ä½¿RostelecomæŸå¤±2400äº¿å¢å¸ƒ</a></li>
<li><a href="../zh-CN437366/index.html">å¦‚ä½•ç ´è§£å·¥å‚ï¼šæ— çº¿ç”µæ§åˆ¶ç³»ç»Ÿæ˜¯ç°ä»£ç”Ÿäº§ä¸­çš„è–„å¼±ç¯èŠ‚</a></li>
<li><a href="../zh-CN437368/index.html">MOSDROIDï¼ƒ15ç£·</a></li>
<li><a href="../zh-CN437374/index.html">Facebookç”¨æˆ·ä½¿ç”¨é’±å’Œå…è´¹ç¬”è®°æœ¬ç”µè„‘å‡ºç§Ÿä»–ä»¬çš„å¸æˆ·</a></li>
<li><a href="../zh-CN437376/index.html">æ¥è‡ªITä¸–ç•Œçš„å¥½å¥‡å˜æ€-2</a></li>
<li><a href="../zh-CN437378/index.html">ä»€ä¹ˆæ˜¯ARCoreï¼Ÿ æ‰€æœ‰ä½ éœ€è¦çŸ¥é“çš„</a></li>
<li><a href="../zh-CN437380/index.html">æ¯ä¸ªäººéƒ½è´£éª‚è‡ªå·±ç¼–å†™çš„æµ‹è¯•æ¡†æ¶ã€‚ è€Œä¸”æˆ‘ä»¬å¯¹æˆ‘ä»¬æ„Ÿåˆ°æ»¡æ„</a></li>
<li><a href="../zh-CN437382/index.html">çƒŸèŠ±ç†è®ºã€‚ å®‡å®™å¹»æƒ³</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>