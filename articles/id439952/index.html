<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåó üßôüèø üëª Hosting Node.js https server dengan SSL yang diperbarui secara otomatis di cloud dan bagaimana saya mengatur siklus pengembangan (+ git, bereaksi) üë©üèø‚Äç‚öñÔ∏è üéÉ üç¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kata Pengantar 
 Untuk memulainya, suatu hari saya ingin membuat aplikasi. Keinginan ini muncul karena saya suka membaca, tetapi tidak ada agregator b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hosting Node.js https server dengan SSL yang diperbarui secara otomatis di cloud dan bagaimana saya mengatur siklus pengembangan (+ git, bereaksi)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439952/"><h2>  Kata Pengantar </h2><br>  Untuk memulainya, suatu hari saya ingin membuat aplikasi.  Keinginan ini muncul karena saya suka membaca, tetapi tidak ada agregator buku normal di Internet Rusia yang luas.  Sebenarnya, karena kesusahan mencari sesuatu untuk dibaca dan mencoba mengingat nama buku yang baru saja saya baca dan bab mana saya berhenti, keinginan lahir untuk membuat aplikasi web di mana semua ini akan mungkin dan nyaman.  Perlu dicatat bahwa tidak ada pengalaman dalam pengembangan, pemrograman, dll.  Saya tidak punya, pekerjaan saya tidak terhubung dengan ini sama sekali.  Meskipun demikian, keinginan mengatasi kemalasan dan tumbuh menjadi tindakan nyata, semacam hobi. <br><br>  Saya tidak akan memberi tahu bagaimana saya mempelajari javascript, node.js, bereaksi, html, css, dll., Kita akan membahas apa yang saya ketahui saat ini, apa yang ingin saya bagikan dengan Anda dan, tentu saja, mendengarkan kritik konstruktif dari spesialis. <br><br>  Seperti banyak orang, saya berlatih di PC saya sendiri di localhost: 3000, membuat front / back-end, mengetik, bekerja dengan api, dll., Tetapi saya selalu khawatir dengan pemikiran bagaimana cara mentransfer semua ini ke hosting nanti?  Apakah ini akan berhasil?  Apakah perlu menulis ulang kode karena ini?  <b>Dan yang paling penting, apakah mungkin untuk mengkonfigurasi semuanya sehingga saya dapat bekerja pada aplikasi dari PC mana pun dan dengan mudah mentransfer semuanya ke hosting saat produksi?</b>  <b>Saya akan membicarakan ini.</b> <br><a name="habracut"></a><br><h2>  Pilihan Hosting </h2><br>  Untuk hobi saya, saya siap untuk menghabiskan $ 10 sebulan, jadi saya memilih hosting yang saya rencanakan untuk tinggal bersama di masa depan.  Seperti yang saya katakan, sebelumnya saya punya 0 pengalaman, termasuk dengan situs hosting.  Saya mencoba dan menolak yang berikut: <br><br>  <b>Jelastic</b> : <b>antarmuka yang</b> cantik dan ramah pengguna, semuanya tampak intuitif, dapat diukur dan dimengerti.  Namun demikian, saya menemui kesulitan dalam pengaturan (untuk beberapa alasan, nginx tidak ingin bekerja dari vps, hanya dengan modul terpisah) dan menghubungkan SSL (dan pembaruan otomatis) ke domain berbahasa Rusia dengan cara standar (mereka berjanji untuk memperbaiki bug, tetapi saya tidak ingin menunggu) <br><br>  <b>Hosting cloud REG.RU</b> : Saya juga punya domain di sana, jadi solusinya tampak logis, tetapi PostgreSQL tidak dikonfigurasikan secara terpisah, dan karena saya tidak ingin menghubungi administrasi database, saya mulai mencari lebih jauh. <br><br>  <b>AWS dan Google cloud</b> : Saya sudah mencobanya, semuanya tampak baik-baik saja, tetapi saya ingat tentang undang-undang kami yang "luar biasa" dan persyaratan untuk menempatkan data pengguna di server di Federasi Rusia.  Sayangnya, orang-orang ini tidak memiliki server di Federasi Rusia.  Bukan pengacara, tetapi dari dosa memutuskan untuk mencari awan dengan server di Federasi Rusia.  <b>Jika aplikasi Anda tidak memiliki masalah dengan hukum, maka pilihan yang baik.</b> <br><br>  Meskipun ada cloud dengan server di Federasi Rusia, saya masih menginginkan sesuatu yang akan menyelamatkan saya dari keharusan menyelami administrasi PostgreSQL.  Dorongan muncul sedikit tidak lama yang lalu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Yandex. Awan</a> yang menjadi tersedia, saya mencoba, sepertinya semuanya sederhana dan nyaman, jadi saya berhenti pada mereka untuk saat ini.  Perlu dicatat bahwa hosting PostgreSQL segera hadir dengan RAM 1core dan 4GB, yang biayanya sekitar 2k rubel sebulan, jadi untuk saat pengembangan dan beban rendah, saya berencana untuk menjalankan PostgreSQL pada VPS untuk ~ 300r, dan mentransfer database dengan peningkatan beban dan membiarkan Yandex terlibat dalam administrasi dan pembaruan. <br><br><h2>  Menyiapkan Yandex.Cloud </h2><br><h3>  Cloud pribadi virtual </h3><br>  1) Buat direktori untuk situs Anda: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/35e/3de/581/35e3de5819d0344d34cc9a03251cbf65.png" alt="gambar"><br><br>  2) Buat Cloud Pribadi Virtual: <br><br>  Hal utama yang dia berikan kepada saya pada tahap saat ini adalah IP untuk mengakses sumber daya yang dibuat dari luar.  Saya berkenalan dengan subnet, zona, isolasi, dan toleransi kesalahan secara dangkal, jika perlu saya akan menyusul. <br><br>  3) Buat subnet dan berikan IP internal (seperti yang saya pahami, ini seperti jaringan lokal) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f25/42d/f6c/f2542df6c7141d6e96738f6f1d3e6cf1.png" alt="gambar"><br><br>  4) Buka tab IP dan siapkan IP statis untuk diri Anda sendiri. <br><br>  Di atasnya kita akan terhubung dari rumah dan tempat lain.  Anda mungkin dapat bekerja dengan dinamis, tetapi saya tidak mengerti dalam hal apa itu berubah. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47c/ef6/265/47cef626515785d83ba86cb6f5f8c185.png" alt="gambar"><br><br><h3>  Hitung cloud </h3><br>  Di sini kita akan memiliki perhitungan :) Yaitu, kita akan membuat mesin virtual dengan Linux (saya memilih ubuntu 18.04), menginstal aplikasi node.js dan postgreSQL. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/265/293/e0c/265293e0c462dd9dd2452874799c2157.png" alt="gambar"><br><br>  Kami klik untuk membuat VM, membuka semua pengaturan ke minimum, karena tidak akan ada beban selama pengembangan (ketika aplikasi kami dirilis, kemudian memutar sedikit lebih, well, kami akan memantau dengan grafik). <br><br><h4>  Ssh </h4><br>  Poin masalah yang saya temui pada tahap ini adalah SSH: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/687/476/389/68747638934544e751f6a0b21f43e683.png" alt="gambar"><br><br>  Apa itu dan mengapa saya tidak tahu, jadi saya pergi belajar.  Ternyata - ini hanya metode akses, tetapi tidak dengan kata sandi, tetapi dengan kunci SSH yang dihasilkan.  Untuk benar-benar menghasilkannya, unduh dan instal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Putty</a> seperti yang disarankan. <br><br>  Jalankan C: \ Program Files \ Puttygen \ puttygen.exe <br><br><img src="https://habrastorage.org/getpro/habr/post_images/333/03a/e02/33303ae02d9b14983cf0627087dfd8ee.png" alt="gambar"><br><br>  Kami menekan tombol Generate dan menggerakkan mouse untuk memberikan keacakan untuk kunci yang dihasilkan (seperti yang saya mengerti).  Selanjutnya, salin baris yang muncul dimulai dengan ssh-rsa di suatu tempat di file teks dan klik Simpan kunci pribadi, Simpan kunci publik.  Kunci yang disalin ke file teks dimasukkan ke dalam bidang SSH dari kunci halaman Yandex Yandex.  Kami menetapkan root sebagai root, jika tidak, Anda tidak akan memiliki akses ketika bekerja dengan sistem file grafik dari aplikasi yang dengannya Anda akan terhubung ke cloud dari rumah / kantor (mungkin ada jalan, tapi saya tidak mengerti). <br>  <b>Seperti yang dicatat oleh andreymal, lebih baik tidak menggunakan root agar bot Cina tidak mengambil kata sandi untuk cloud Anda, tetapi karena di Yandex.cloud akses hanya melalui SSH, Anda bisa hidup seperti itu.</b> <b><br><br></b>  <b>Aplikasi pada hosting harus diluncurkan secara eksklusif oleh pengguna non-root, agar tidak memungkinkan penyerang mengeksekusi kode berbahaya melalui kemungkinan kerentanan dalam aplikasi Anda.</b> <b><br></b> <br><br><h3>  Kami terhubung ke cloud dari PC dan memilih klien SSH gratis </h3><br>  Putty standar memungkinkan Anda untuk bekerja hanya pada baris perintah, dan karena saya tidak terbiasa dengan pengguna windows, saya mulai mencari klien dengan pseudo-explorer.  Pada awalnya saya mencoba Mobaxterm, tetapi setelah beberapa saat tidak aktif itu berhenti, penjelajah membeku sama sekali, jadi sekarang saya bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bitvise ssh</a> dan sejauh ini saya tidak melihat masalah seperti Mobaxterm. <br><br><h3>  Konfigurasikan bitvise ssh </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/8a2/019/f4c/8a2019f4cafa7b44ef72286664175010.png" alt="gambar"><br><br>  Di sini, di bidang Server&gt; Host menunjukkan cloud IP eksternal kami.  Port 22. Klik manajer kunci klien&gt; impor dan tentukan kunci pribadi yang dibuat sebelumnya di dalamnya.  Anda mungkin masih memerlukan frase kunci, pilih sesuatu yang tidak akan Anda lupakan.  Tutup jendela ini dan tentukan nama pengguna di bidang otentikasi: root, metode kunci publick, kunci klien - pilih yang sebelumnya diimpor.  Klik masuk dan jika kami melakukan semuanya dengan benar, maka sambungkan ke cloud: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b4b/e6a/a9d/b4be6aa9df15651829c0b23749f18b41.png" alt="gambar"><br><br><h2>  Instal Node.js </h2><br>  Di sini saya sarankan menggunakan instruksi dari digitalocean.com, mereka sangat rinci dan banyak di Rusia.  Biasanya saya google "digitalocean ubuntu 18.04 node.js" atau apa pun yang Anda ingin instal atau konfigurasikan di sana. <br><br>  Cara menginstal Node.js dapat dibaca di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Singkatnya, kita pergi ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">nodesource</a> (di sini versi terbaru node.js dapat diinstal), buka di sini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ad/aa7/0c9/3adaa70c90a1466c1a55b71eb25f2105.png" alt="gambar"><br><br>  Salin dan jalankan perintah pada gilirannya: <br><br><pre><code class="javascript hljs">curl -sL https:<span class="hljs-comment"><span class="hljs-comment">//deb.nodesource.com/setup_11.x | sudo -E bash - sudo apt-get install -y nodejs</span></span></code> </pre> <br>  Kami memeriksa bagaimana itu didirikan oleh tim <br><br><pre> <code class="javascript hljs">nodejs -v</code> </pre> <br>  Kita akan melihat versi node.js <br><br><pre> <code class="javascript hljs">npm -v</code> </pre> <br>  Kami akan diperlihatkan versi manajer paket untuk node.js. <br><br>  Selanjutnya, buka folder / opt / mysuperapp (my_super_app_name - Anda harus membuat folder ini).  Direktori opt dipilih sebagai lokasi aplikasi setelah lama googling "di mana sesuai untuk meletakkan file node.js aplikasi di ubuntu". <br><br>  Terakhir, buat file server.js, yang akan menjadi titik masuk aplikasi, dan rekatkan kode server sederhana pada node.js di sana: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hostname = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> port = <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = http.createServer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.setHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>); res.end(<span class="hljs-string"><span class="hljs-string">'Hello World!\n'</span></span>); }); server.listen(port, hostname, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Server running at http://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${hostname}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${port}</span></span></span><span class="hljs-string">/`</span></span>); });</code> </pre> <br>  Port 80 untuk permintaan http, 443 untuk https.  Sementara kami memiliki server di http. <br><br>  Kami menyimpan semuanya dan menjalankan perintah: <br><br><pre> <code class="plaintext hljs">node server.js</code> </pre> <br>  Konsol harus menampilkan baris 'Server berjalan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">localhost</a> : 80 /' <br><br>  Sekarang Anda dapat membuka browser, masukkan IP eksternal (yang ada di cloud Yandex VM ubuntu Anda) dan kita akan melihat "Hello World!" <br><br><h2>  Kami melakukan segalanya dengan nyaman atau siklus pengembangan dengan git </h2><br>  Segalanya tampak bekerja, tetapi kami tidak akan berfungsi sepanjang waktu saat terhubung ke cloud.  Apalagi tiba-tiba kita tidak akan bekerja sendiri di masa depan. <br><br><h2>  Github </h2><br>  Github adalah tempat di mana kode aplikasi kita berada.  Singkatnya, prinsip kerja untuk satu orang adalah sebagai berikut: <br><br><ul><li>  Kami sedang mengembangkan aplikasi kami di PC rumah. </li><li>  Kami menyimpan dan membongkar kode pada Github dalam satu klik. </li><li>  Di hosting atau di PC lain, unduh aplikasi kami dari github, reboot server (jika hosting) dan versi baru aplikasi web kami tersedia di World Wide Web. </li></ul><br>  Semuanya cepat, sederhana, dan nyaman. <br><br>  Sebenarnya mendaftar di Github dan membuat repositori pribadi untuk aplikasi kami (hanya akan tersedia bagi kami): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a10/e93/4b3/a10e934b3516444c1c8aad1b45035494.png" alt="gambar"><br><br>  Salin baris <a href="">github.com/ReTWi/mysuperapp.git</a> untuk mengunduh aplikasi. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/465/959/824/4659598241a27171fbbaa8e61c3a66c2.png" alt="gambar"><br><br><ol><li>  Kami kembali ke baris perintah bitvise, hentikan aplikasi dengan menekan ctrl + c (jika masih berfungsi). </li><li>  Buka direktori / opt dan hapus folder dengan aplikasi yang kami buat </li></ol><br>  Git adalah apa yang akan kita gunakan untuk mengunggah aplikasi kita ke github, dan dari sana ke hosting atau PC lain.  Git adalah topik terpisah untuk diskusi, jadi mari kita bahas ini untuk saat ini. <br>  Instal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">git di hosting</a> dengan perintah berikut: <br><br><pre> <code class="javascript hljs">sudo apt update sudo apt install git</code> </pre> <br>  Periksa apakah semuanya sudah mapan: <br><br><pre> <code class="javascript hljs">git --version</code> </pre> <br>  Versi git akan muncul. <br><br>  Kami mengisi data git (saya tidak mengerti mengapa, tetapi tampaknya mungkin ada beberapa peringatan yang membosankan). <br><br><pre> <code class="javascript hljs">git config --global user.name <span class="hljs-string"><span class="hljs-string">"Your Name"</span></span> git config --global user.email <span class="hljs-string"><span class="hljs-string">"youremail@domain.com"</span></span></code> </pre> <br>  Akhirnya, kami mengunggah aplikasi kami ke hosting dengan perintah: <br>  (harus ada tautan ke aplikasi Anda) <br><br><pre> <code class="javascript hljs">git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/ReTWi/mysuperapp.git</span></span></code> </pre> <br>  Mysuperapp baru akan muncul di direktori / opt, tempat file aplikasi kita yang diunduh dari github akan ditemukan. <br><br>  Sekarang saatnya untuk mengulangi hal yang sama untuk PC dan menutup rantai PC (berbeda) -&gt; Github -&gt; Hosting <br><br>  Instal <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">node.js di PC</a> . <br><br><h2>  Kode studio visual </h2><br>  Untuk memulai, pilih editor kode sumber tempat kami akan bekerja.  Saya memilih kode Visual studio, jadi sederhana, nyaman, ia memiliki banyak plugin dan Anda dapat mengkonfigurasi sinkronisasi pengaturan jika Anda bekerja dengan beberapa perangkat.  Sebenarnya kita mengunduh, menginstal, meluncurkan, memilih folder aplikasi bersama, karena git clone akan membuatnya sendiri untuk kita. <br><br>  Plugin yang saya gunakan adalah sebagai berikut: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e5/5c2/17f/7e55c217f685490573a70f44970e0780.png" alt="gambar"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Instal git untuk PC</a> . <br>  Buka konsol dalam VScode menggunakan ctrl + shift + `atau terminal&gt; terminal baru <br><br>  <i>Mundur:</i> <i><br><br></i>  <i>Di konsol windows, buruk dengan karakter Rusia, sehingga tidak ada celah yang Anda butuhkan untuk membuka file&gt; preferensi&gt; pengaturan, masukkan terminal.integrated.shellArgs.windows di bidang, klik</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a70/787/6a5/a707876a56e4c0a2b601358d4aa7caf1.png" alt="gambar"><br><br></i>  <i>Dan tambahkan baris "terminal.integrated.shellArgs.windows": ["-NoExit", "/ c", "chcp 65001"],</i> <i><br><br><img src="https://habrastorage.org/getpro/habr/post_images/57d/217/da6/57d217da62d4189b8640eb854f07a8a0.png" alt="gambar"></i> <br><br>  Ulangi perintah untuk mengunduh file dari github: <br><br><pre> <code class="javascript hljs">git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/ReTWi/mysuperapp.git</span></span></code> </pre> <br>  Dalam VScode, klik File&gt; Buka Folder dan buka folder aplikasi kami. <br><br>  Buat file server.js dengan kode server sederhana yang sama: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> hostname = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> port = <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> server = http.createServer(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { res.statusCode = <span class="hljs-number"><span class="hljs-number">200</span></span>; res.setHeader(<span class="hljs-string"><span class="hljs-string">'Content-Type'</span></span>, <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>); res.end(<span class="hljs-string"><span class="hljs-string">'Hello World!\n'</span></span>); }); server.listen(port, hostname, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`Server running at http://</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${hostname}</span></span></span><span class="hljs-string">:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${port}</span></span></span><span class="hljs-string">/`</span></span>); });</code> </pre> <br>  Instal nodemon untuk memulai ulang server secara otomatis ketika ada perubahan pada kode: <br><br><pre> <code class="javascript hljs">npm i nodemon -g</code> </pre> <br>  i - kependekan dari instal <br>  g - instalasi global (tersedia di konsol), dan tidak hanya untuk aplikasi kita. <br><br>  Jalankan perintah: <br><br><pre> <code class="javascript hljs">nodemon server.js</code> </pre> <br>  Buka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">localhost</a> : 80 / di browser atau hanya localhost: 80 dan lihat Hello World. <br><br>  Sekarang saatnya untuk memeriksa rantai PC kami&gt; Github&gt; Hosting. <br><br>  Unduh desktop Github untuk kenyamanan yang lebih besar, sambungkan akun github Anda, lalu klik tambahkan file repositori lokal dan tentukan direktori aplikasi kami. <br><br>  Dalam aplikasi, kami melihat perubahan yang kami buat dibandingkan dengan versi yang diunduh dari Github (kami menambahkan server.js): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/568/3d0/52b/5683d052b9fbba8fe609035fd8ba253f.png" alt="gambar"><br><br>  Klik "commit to master"&gt; "push origin", sehingga mengunduh file dari PC ke Github. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eeb/234/bf6/eeb234bf61a0ed5b2708b196e32da7d8.png" alt="gambar"><br><br>  Kami pergi ke akun github kami di browser dan melihat file server.js yang diunduh: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e6/cf8/e1b/1e6cf8e1b08c5a15d596193dd8b0efb3.png" alt="gambar"><br><br>  Mari kita berlatih sedikit lagi, di VScode kita mengganti baris "res.end ('Hello World! \ N');"  ke "kirim ulang ('OmNomNom');".  Kita akan melihat bahwa server itu sendiri reboot: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c8/8cc/a53/8c88cca53e4d8d15632cc49e183817e7.png" alt="gambar"><br><br>  Kami akan memeriksa di browser dan melihat perubahan yang dilakukan oleh kami "OmNomNom" di sana. <br><br>  Desktop github juga akan menunjukkan kepada kami bahwa kami mengubah baris: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/020/39b/7a0/02039b7a00fabe3c07037f6a356c1919.png" alt="gambar"><br><br>  Sekali lagi, klik komit untuk menguasai&gt; dorong asal untuk mengirim file ke github. <br><br>  Beralih ke baris perintah hosting. <br><br>  Kami menghentikan aplikasi kami jika masih berjalan (ctrl + c). <br><br>  Unduh aplikasi kami yang diperbarui dengan perintah berikut: <br><br><pre> <code class="javascript hljs">git config credential.helper store git pull</code> </pre><br>  Yang pertama akan menyimpan data kami sehingga Anda tidak harus memasukkan nama pengguna dan kata sandi Anda terus-menerus.  Di masa depan, git pull akan cukup untuk kita. <br><br>  Instal pm2 - sesuatu yang mirip dengan nodemon, hanya untuk hosting: <br><br><pre> <code class="javascript hljs">npm i pm2 -g</code> </pre> <br>  Mari kita mulai aplikasi menggunakan pm2, yang akan me-restart server kita dengan tarikan git berikutnya pada hosting: <br><br><pre> <code class="javascript hljs">pm2 start server.js --watch</code> </pre> <br>  Buka browser di cloud IP eksternal kami dan lihat "OmNomNom" kami. <br><br>  Dengan demikian, kami menutup rantai kerja dengan aplikasi dan penyebarannya yang cepat di hosting. <br><br><h2>  Kami membuat sertifikat SSL sementara untuk HTTPS di hosting lokal dan </h2><br>  Kami pergi ke situs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">zerossl.com</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/151/be3/00c/151be300c4226e87b30b7f4735e09c83.png" alt="gambar"><br><br>  Di bidang domain, ip ..., masukkan localhost terlebih dahulu, klik buat dan unduh 2 file dengan tombol: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a1/b4d/24a/8a1b4d24a65f44c3ba5a604a569e1811.png" alt="gambar"><br><br>  Kami menyimpannya di proyek kami di folder ssl / localhost. <br><br>  Ulangi prosedur untuk Cloud IP eksternal dan simpan di ssl / myapp. <br><br><h2>  Luncurkan server https node.js yang lebih kompleks </h2><br>  Struktur aplikasi: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/330/6da/e58/3306dae5836d651136b030b2cc64041e.png" alt="gambar"><br><br><ul><li>  klien - di sini front-end kami akan berbohong.  Saya sudah bereaksi. </li><li>  log - log di hosting akan jatuh di sini </li><li>  node_modules - modul node.js </li><li>  pribadi - file pribadi Anda, saya menyimpan akses SSH ke cloud di sana </li><li>  server adalah backend Anda </li><li>  ssl - ssl sertifikat untuk bekerja https di hosting lokal dan </li><li>  .babelrc - aplikasi webpack'om bereaksi pengaturan build (memungkinkan Anda untuk menggunakan JS yang lebih modern saat mengembangkan frontend) </li><li>  .gitignore - file yang tidak akan dipindahkan ke github (git sepertinya tidak melihatnya) </li><li>  client.js - titik masuk untuk menghasilkan rakitan reaksi </li><li>  package.json - node_modeles yang Anda gunakan dan berbagai potongan perintah. </li><li>  package-lock.json - perubahan dalam modul (seperti yang saya mengerti, file akan memeriksa apakah modul yang sama dipasang di hosting Anda dan di PC Anda). </li><li>  pm2-watch.json - pengaturan startup pm2 untuk hosting </li><li>  README.md - penutup untuk github </li><li>  server.js - titik awal dari server Node.js backend kami </li><li>  webpack.config.js - reaksi konfigurasi pembangunan </li></ul><br><h3>  .gitignore </h3><br>  Di sini kami menunjukkan file / folder yang tidak ingin kami unggah ke github.  Mereka hanya akan berada di perangkat ini dan git tidak akan melacak / menampilkan perubahannya.  Buka dan masukkan: <br><br><pre> <code class="javascript hljs">/node_modules/ <span class="hljs-regexp"><span class="hljs-regexp">/logs/</span></span>* # exception to the rule !logs/.gitkeep /public/react_bundle.js /public/isProd.js</code> </pre> <br>  Karena github tidak membongkar folder kosong, Anda dapat memasukkan sesuatu ke dalamnya, misalnya, file gitkeep kosong.  Simpan file dan tutup. <br><br><h3>  package.json </h3><br>  Buka dan rekatkan yang berikut (setelah // menambahkan komentar) <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"myapp"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//    "version": "1.0.0", "description": "OmNomNom", "main": "server.js", "scripts": { "server": "pm2 start pm2-watch.json", //  npm run server     "client": "webpack -w --mode development", //  npm client    .        ,   . "client-prod": "webpack --mode production", //     production "client-analyze": "webpack --mode production --analyze true" //     production       .    }, "repository": { "type": "git", "url": "git+https://github.com/myapp/knigam.git" //     github }, "author": "rtw", "license": "UNLICENSED", //     ( ) "bugs": { "url": https://github.com/myapp/knigam.git" }, "homepage": "https://github.com/myapp/knigam.git#readme", "dependencies": { "@babel/core": "^7.2.2", //  js  frontend "@babel/plugin-transform-runtime": "^7.2.0", //  js  frontend "@babel/preset-env": "^7.3.1", //  js  frontend "@babel/preset-react": "^7.0.0", //  js  frontend "ajv": "^6.8.1", //    "babel-loader": "^8.0.5", //  js  frontend "babel-plugin-styled-components": "^1.10.0", //   styled-components "css-loader": "^2.1.0", //   webpack'om css "fastify": "^2.0.0-rc.6", //  express,      "fastify-cookie": "^2.1.6", //    "fastify-static": "^2.2.0", //     "moment": "^2.24.0", //    "pg": "^7.8.0", //    "pino": "^5.11.1", //   postgreSQL  node.js "pino-pretty": "^2.5.0", //     "react": "^16.8.1", // Frontend .      Vue.js,    .      ,     "react-dom": "^16.8.1", // React     "style-loader": "^0.23.1", //   webpack'om ,    "styled-components": "^4.1.3", // CSS in JS,           "webpack": "^4.29.3", //    "webpack-bundle-analyzer": "^3.0.3", //       "webpack-cli": "^3.2.3" //    ,     } }</span></span></code> </pre><br>  Saya akan fokus pada dua kerangka kerja utama / perpustakaan yang dipilih untuk aplikasi: <br>  Fastify dipilih sebagai alternatif untuk express.js, karena yang pertama sudah memiliki dukungan eksperimental untuk htpp2, Fastify berkembang secara aktif dan bagi saya tampaknya memiliki masa depan yang lebih banyak daripada express.js, yang telah menjadi sangat lambat dan entah bagaimana berkembang.  Di sisi lain, express.js telah bekerja untuk waktu yang lama dan akan lebih mudah bagi Anda untuk menemukan informasi tentang itu. <br><br>  React dipilih karena lebih mudah bagi saya untuk bekerja dengannya, memahami dan mencoba semuanya dengan tangan saya sendiri.  Vue - sepertinya sesuatu dengan aturannya sendiri, arah.  Meskipun dalam Vue mungkin perlu untuk menulis sesuatu yang kurang dengan tangan Anda sendiri, tetapi karena prioritas dibuat pada pelatihan dan untuk orang yang belum diprogram sebelumnya, reaksi menjadi lebih mudah. <br><br>  Kami menyimpan file package.json dan menginstal semua modul yang ditentukan dalam dependensi dengan perintah: <br><br><pre> <code class="javascript hljs">npm i</code> </pre> <br>  Kami akan memiliki folder node_modules, di mana akan ada semua modul untuk aplikasi kita. <br><br>  client - sementara folder kosong <br>  log - di dalam file gitkeep terletak, sehingga folder bermigrasi ke hosting dan log berhasil jatuh di sana.  Selama pengembangan, kami akan menampilkan semuanya ke konsol. <br><br><h3>  publik </h3><br>  Di sini file statis dari situs kami akan terletak, gambar di sana, favicon, dll. <br>  Mari kita membahas dua file: <br>  index.html: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;base href="/" /&gt; &lt;meta charset="UTF-8" /&gt; &lt;title&gt;MyApp&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id="cookies"&gt;    react_bundle   &lt;/div&gt; &lt;noscript &gt;:       Javscript&lt;/noscript &gt; &lt;script src="react_bundle.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  - di sini kita memiliki front-end bereaksi dimuat dan dirender menjadi tag dengan id-nya. <br><br>  isProd.js berisi satu baris "module.exports = false" <br>  Karena itu dalam pengecualian .gitignore, itu tidak portabel.  Karenanya, kami mengaturnya menjadi false di PC, dan true di hosting.  Kemudian kami menggunakan file ini untuk memahami lingkungan apa yang saat ini kami miliki (pengembangan / produksi).  Menurut saya yang paling nyaman, di samping itu, Anda dapat mengubah sebagian kode selama pengembangan dan memeriksa operasi modul dalam produksi. <br><br>  ssl - sebelumnya ada sertifikat yang disimpan di folder localhost dan myapp <br><br><h3>  .babelrc </h3><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"presets"</span></span>: [ [ <span class="hljs-string"><span class="hljs-string">"@babel/preset-env"</span></span>, { <span class="hljs-string"><span class="hljs-string">"targets"</span></span>: { <span class="hljs-string"><span class="hljs-string">"browsers"</span></span>: [<span class="hljs-string"><span class="hljs-string">"&gt;0.25%"</span></span>, <span class="hljs-string"><span class="hljs-string">"not ie 11"</span></span>, <span class="hljs-string"><span class="hljs-string">"not op_mini all"</span></span>] } } ], <span class="hljs-string"><span class="hljs-string">"@babel/preset-react"</span></span> ], <span class="hljs-string"><span class="hljs-string">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"babel-plugin-styled-components"</span></span>, <span class="hljs-string"><span class="hljs-string">"@babel/plugin-transform-runtime"</span></span> ] }</code> </pre><br>  Pengaturan untuk membuat react_bundle kami dengan dukungan browser yang digunakan oleh lebih dari 0,25% pengguna. <br><br><h3>  client.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { render } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-dom'</span></span> render(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">!!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">'cookies'</span></span>))</code> </pre> <br><br>  Render frontend kami dalam div dengan tag cookie. <br><br>  pm2-watch.json - memungkinkan Anda untuk menjalankan server dengan perintah "npm run server" di hosting dengan melacak perubahan dalam kode dan secara otomatis me-reboot. <br><br><h3>  webpack.config.js </h3><br>  Pembangun aplikasi reaktor: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>), path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>), BundleAnalyzerPlugin = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-bundle-analyzer'</span></span>).BundleAnalyzerPlugin <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">env, argv</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> prod = argv.mode == <span class="hljs-string"><span class="hljs-string">'production'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> config = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'./client.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'./public'</span></span>), <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'react_bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rules</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.(js|jsx)$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loader</span></span>: <span class="hljs-string"><span class="hljs-string">'babel-loader'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.css$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">use</span></span>: [<span class="hljs-string"><span class="hljs-string">'style-loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'css-loader'</span></span>] } ] }, <span class="hljs-attr"><span class="hljs-attr">resolve</span></span>: { <span class="hljs-attr"><span class="hljs-attr">alias</span></span>: { <span class="hljs-attr"><span class="hljs-attr">client</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'./client/shared'</span></span>), <span class="hljs-attr"><span class="hljs-attr">public</span></span>: path.resolve(<span class="hljs-string"><span class="hljs-string">'./public'</span></span>) } }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ argv.analyze ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BundleAnalyzerPlugin() : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, prod ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.optimize.AggressiveMergingPlugin() : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.ContextReplacementPlugin(<span class="hljs-regexp"><span class="hljs-regexp">/moment[\/\\]locale$/</span></span>, /ru/) ].filter(<span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>), <span class="hljs-attr"><span class="hljs-attr">optimization</span></span>: { <span class="hljs-attr"><span class="hljs-attr">minimize</span></span>: prod ? <span class="hljs-literal"><span class="hljs-literal">true</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">performance</span></span>: { <span class="hljs-attr"><span class="hljs-attr">hints</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> config }</code> </pre><br>  Singkatnya, ia membuka file client.js dan semua yang ada di dalamnya, mengumpulkan react_bundle dan menempatkannya di folder publik, dari mana file itu akan dimuat melalui index.html yang terbuka. <br><br><h3>  server.js </h3><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isProd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./public/isProd'</span></span>), fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>), log = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./server/logger'</span></span>), path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   node.js,      process.on('unhandledRejection', (reason, promise) =&gt; { log.error({ reason, promise }, '  unhandledRejection') }) process.on('uncaughtException', err =&gt; { log.error({ err }, '  uncaughtException') }) // Redirect server from http port 80 to https 443 const fastifyHttp = require('fastify')({ logger: log, ignoreTrailingSlash: true }) fastifyHttp.listen(80, '::', (err, address) =&gt; { if (err) { log.error({ err, address }, '   HTTP ') } else { log.warn('Http c ') } }) // Let's Encrypt challenge fastifyHttp.get('/.well-known/acme-challenge/:file', (req, res) =&gt; { let stream = fs.createReadStream( path.join(__dirname + '/ssl/.well-known/acme-challenge/' + req.params.file) ) res.type('text/html').send(stream) }) fastifyHttp.get('/*', (req, res) =&gt; { res.redirect(301, 'https://' + req.headers.host + req.raw.url) }) fastifyHttp.get('/', (req, res) =&gt; { res.redirect(301, 'https://' + req.headers.host + req.raw.url) }) //  let fastifyOptions = { logger: log, ignoreTrailingSlash: true, http2: true } fastifyOptions.https = isProd ? { allowHTTP1: true, key: fs.readFileSync('./ssl/myapp/key.txt'), cert: fs.readFileSync('./ssl/myapp/crt.txt') } : { allowHTTP1: true, key: fs.readFileSync('./ssl/localhost/cert.key'), cert: fs.readFileSync('./ssl/localhost/cert.pem') } const fastify = require('fastify')(fastifyOptions) fastify.listen(443, '::', (err, address) =&gt; { if (err) { log.error({ err, address }, '   ') } else { log.warn( `   ${ isProd ? '' : ' ' }` ) } }) //  fastify.setSchemaCompiler(schema =&gt; { return ajv.compile(schema) }) //  fastify fastify.setErrorHandler((err, req, res) =&gt; { log.error({ err, req }, 'fastify errorHandler') //     if (err.validation) { return res.send({ error: '   ' }) } else { return res.send({ error: ' errorHandler' }) } }) //   fastify.register(require('fastify-static'), { root: path.join(__dirname, './public') }) //  fastify.register(require('fastify-cookie'), err =&gt; { if (err) log.error({ err }, 'fastify-cookie') }) //       /   //       index.html,     //        api,   GET /api/userdata fastify.setNotFoundHandler((req, res) =&gt; { res.sendFile('index.html') }) // Routes fastify.register( async openRoutes =&gt; { //    openRoutes.register(require('./server/api/open')) openRoutes.register(async withSession =&gt; { //         //    , : ///withSession.addHook('preHandler', async (req, res) =&gt; { // if (!(await sessionManagerIsOk(req, res))) return // }) withSession.register(require('./server/api/with_session')) }) }, { prefix: '/api' } //    )</span></span></code> </pre><br><h3>  Folder server </h3><br>  Di sinilah letak backend dan semua caranya. <br>  logger.js - tergantung pada lingkungannya, log isProd ke konsol atau ke errors.log <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> pino = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'pino'</span></span>), isProd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../public/isProd'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logOptions = isProd ? { <span class="hljs-attr"><span class="hljs-attr">level</span></span>: <span class="hljs-string"><span class="hljs-string">'warn'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   timestamp: () =&gt; { return ',"time":"' + new Date() + '"' } } : { level: 'warn', prettifier: require('pino-pretty'), prettyPrint: { levelFirst: true, translateTime: true } } let dest = isProd ? pino.destination('./logs/errors.log') : pino.destination(1) let log = pino(logOptions, dest) module.exports = log</span></span></code> </pre><br>  server / api / <br>  open.js - tambahkan jalur kami di sini. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fastify, options, next</span></span></span><span class="hljs-function">) </span></span>{ fastify.route({ <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; { res.send(<span class="hljs-string"><span class="hljs-string">'api / route'</span></span>) } }) fastify.route({ <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'/hi'</span></span>, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (req, res) =&gt; { res.send(<span class="hljs-string"><span class="hljs-string">'api / route hi'</span></span>) } }) next() }</code> </pre> <br>  Setelah mengatur dan memeriksa semuanya di Localhost, kami hanya mengunggah semuanya ke github, dan dari sana git tarik ke hosting.  Yang perlu dilakukan di hosting adalah menginstal modul node.js dengan perintah "npm i" dan membuat file isProd.js <br><br><h2>  SSL Diperbarui Secara Otomatis </h2><br>  Ketika Anda membeli domain dan mengikatnya ke cloud IP, contoh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi untuk REG.RU</a> , Anda dapat menginstal di server yang secara otomatis memperbarui SSL gratis agar situs dapat berfungsi di https. <br><br>  Server kami berfungsi tanpa nginx.  Kami mungkin membutuhkannya di masa depan sebagai penyeimbang beban atau server HTTP yang lebih cepat untuk mendistribusikan file statis, tetapi sejauh ini saya tidak melihat perlunya.  Kami belum membutuhkan load balancing, tetapi saya belum menemukan perbandingan mengenai kecepatan distribusi statika. <br><br>  Sebelum menginstal di folder ssl, buat folder .well terkenal, dan di dalamnya acme-challenge.  Ternyata /opt/myapp/ssl/.well-known/acme-challenge <br><br>  Untuk menginstal SSL yang diperbarui secara otomatis pada server dengan node.js tanpa nginx <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">, klik tautannya</a> .  Pada gilirannya, jalankan perintah di konsol hosting: <br><br><pre> <code class="javascript hljs">sudo apt-get update sudo apt-get install software-properties-common sudo add-apt-repository universe sudo add-apt-repository ppa:certbot/certbot sudo apt-get update sudo apt-get install certbot sudo certbot certonly</code> </pre><br>  Kami memilih metode verifikasi kedua, yang akan menempatkan file tertentu di folder /opt/myapp/ssl/.well-known/acme-challenge, dan setelah mengonfirmasi pemilik server, itu akan dihapus. <br><br>  Kami menunjukkan domain kami berdasarkan permintaan, misalnya: "example.com" dan path ke folder ssl aplikasi kami (server dikonfigurasi sehingga akan memberikan file yang dibuat oleh bot) "/ opt / myapp / ssl". <br><br>  Bot akan mengkonfigurasi tugas cron itu sendiri untuk memperbarui sertifikat sebelum berakhirnya dalam waktu 90 hari. <br><br>  Saya tidak berpikir akan butuh banyak waktu untuk menulis semuanya, pada jam 4 pagi saya sudah bisa melewatkan sesuatu: / <br><br>  Yang menarik adalah pendapat Habrachian dan spesialis yang menguasai kanvas ini atau membaca beberapa poin individu.  Bagaimana siklus pengembangan Anda diatur?  Apakah ada poin di mana saya salah atau melakukan hal yang salah? </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id439952/">https://habr.com/ru/post/id439952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id439942/index.html">Docker: apa yang perlu diketahui oleh setiap pengembang .Net</a></li>
<li><a href="../id439944/index.html">SAPUI5 untuk boneka bagian 5: Latihan selangkah demi selangkah yang lengkap</a></li>
<li><a href="../id439946/index.html">Mengapa kami memilih Elektron</a></li>
<li><a href="../id439948/index.html">Intel SVT-AV1: Open Source AV1 Encoder untuk Tugas Berat</a></li>
<li><a href="../id439950/index.html">3rd Turing Test: syarat untuk berpartisipasi dan hadiah untuk pemenang</a></li>
<li><a href="../id439958/index.html">CodeFest X 30-31 Maret. Bagian Masa Depan</a></li>
<li><a href="../id439962/index.html">Kami bekerja dengan Atlassian Service Desk, kami mendapatkan hasil maksimal dari plug-in Riada Insight - laporan dari pertemuan Grup Pengguna Atlassian</a></li>
<li><a href="../id439964/index.html">Runc CVE-2019-5736 Kerentanan dalam Host</a></li>
<li><a href="../id439966/index.html">Pengurai sederhana untuk operasi aritmatika</a></li>
<li><a href="../id439968/index.html">Ruang Generasi dan Ruang Peluang</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>