<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍✈️ 🤽 👨🏼‍⚕️ graphql - jebakan 👎 🎯 💝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mungkin tidak ada teknologi yang sempurna. Graphql tidak terkecuali. Jika Anda belum memiliki pengalaman dengan teknologi ini, maka Anda harus memilik...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>graphql - jebakan</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451466/"> Mungkin tidak ada teknologi yang sempurna.  Graphql tidak terkecuali.  Jika Anda belum memiliki pengalaman dengan teknologi ini, maka Anda harus memiliki ide bagus tentang masalah apa yang mungkin Anda miliki dan mempersiapkannya terlebih dahulu. <br><a name="habracut"></a><br>  Untuk mulai dengan, saya akan mengatakan bahwa saya lebih mendukung daripada musuh menggunakan graphql di mana mungkin.  Dan saya tidak akan menghalangi siapa pun tentang kelayakan menggunakan teknologi ini.  Dan itulah mengapa saya mengajukan pertanyaan yang berhubungan dengan masalah yang belum terselesaikan dalam kerangka teknologi graphql. <br><br>  Misalnya, untuk seseorang mungkin tidak terduga bahwa setiap objek dalam graphql harus dideskripsikan setidaknya dua kali: sekali sebagai tipe pengembalian objek, dan sekali lagi sebagai tipe input objek (lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">graphql.org/graphql-js/mutations- dan-input-type</a> ).  Namun, saya mengatakan ini sebagai permulaan dan bahkan tidak menganggapnya sebagai kelemahan yang signifikan.  Hari ini kita akan fokus pada masalah-masalah seperti itu, sebagai suatu peraturan, harus diselesaikan ketika mengembangkan aplikasi menggunakan teknologi graphql: <br><br><ol><li>  Pemisahan akses untuk pengguna dan grup pengguna. </li><li>  Menangani kesalahan. </li><li>  PILIH N + 1 Masalah </li></ol><br><h3>  Pemisahan akses untuk pengguna dan grup pengguna </h3><br>  graphql tidak tahu apa-apa tentang berbagi akses antara pengguna dan grup.  Dengan demikian, semua pekerjaan berbagi akses adalah tanggung jawab pengembang aplikasi.  Parameter ketiga melewati objek konteks aplikasi ke fungsi resolver.  Oleh karena itu, jika Anda, misalnya, bekerja dengan implementasi graphql JavaScript + express, maka dalam parameter konteks Anda bisa mendapatkan pengguna saat ini dari objek express.js permintaan.  Tetapi pekerjaan lebih lanjut tentang kontrol akses harus dilakukan secara langsung di setiap resolver: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">root, {id}, ctx</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DB.Lists.get(id) .then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">list</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(list.owner_id &amp;&amp; list.owner_id != ctx.userId){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Not authorized to see this list"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } }); }</code> </pre> <br>  Secara alami, pendekatan ini mempersulit kontrol akses karena  tidak ada cara untuk menetapkan hak akses secara deklaratif, dan kontrol hak tersebar di lebih dari puluhan (untuk beberapa sistem besar, lebih dari ribuan) fungsi penyelesai.  Oleh karena itu, ada sejumlah perpustakaan yang memecahkan masalah ini.  Beberapa dari mereka cukup populer (dilihat dari jumlah bintang di github.com), misalnya <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/maticzav/graphql-shield</a> . <br><br><h3>  Menangani kesalahan </h3><br>  Jika frontend Anda memerlukan validasi input dan pembuatan pesan terperinci untuk setiap bidang yang belum lulus validasi, maka penanganan kesalahan dalam graphql kemungkinan besar tampaknya tidak cukup fleksibel untuk Anda.  Misalnya, jika parameter input dijelaskan sebagai string, dan nilai numerik diterima, maka pesan kesalahan akan sedikit digunakan untuk ini: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"errors"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Expected type String, found 1."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locations"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> } ] } ] }</code> </pre><br>  Jika ada kesalahan kotor dalam jenis parameter input, maka pesan kesalahan akan dihasilkan secara otomatis dan tidak ada cara untuk mengontrol proses ini.  Jika validasi berdasarkan jenis parameter input berhasil, maka dimungkinkan untuk mengirim pesan kesalahan khusus ke klien dengan melemparkan objek <code>new Error ('custom message ...')</code> .  Ini tidak akan berfungsi untuk menambahkan bidang khusus ke objek kesalahan (kustomisasi kesalahan diimplementasikan di pustaka apollo-server-express dan apollo-error saat digunakan bersama-sama).  Tentu saja, selalu ada kesempatan untuk membuat cerita bersambung objek menjadi string <code>message</code> di server dan membatalkan deserialisasi pada klien.  Tetapi apakah perlu untuk melakukannya? <br><br><h3>  PILIH N + 1 Masalah </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Masalah ini dibahas secara rinci dalam pesan</a> . <br><br>  graphql dibangun di atas fungsi resolver.  Ini berarti bahwa mengambil data dari database dapat menyebabkan masalah yang disebut SELECT N +1.  Misalkan dalam fungsi resolver daftar objek diperoleh di mana data yang terkait dengan objek ini diwakili oleh pengidentifikasi (kunci asing).  Untuk setiap pengenal tersebut, pemecah fungsi sendiri akan dipanggil, di mana (di masing-masing) permintaan tambahan ke database akan dibuat.  Jadi, alih-alih permintaan basis data tunggal (dengan SQL BERGABUNG), banyak kueri akan dieksekusi, yang membebani database dengan kueri. <br><br>  Untuk mengatasi masalah ini, facebook mengembangkan pustaka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/graphql/dataloader</a> , yang menggunakan strategi permintaan yang tertunda.  Alih-alih mengeksekusi permintaan secara langsung di resolver fungsi, ia diusulkan untuk mengakumulasikan pengidentifikasi (kunci sekunder) dalam array, dan kemudian menerimanya langsung dengan satu permintaan. <br><br>  apapacy@gmail.com <br>  13 Mei 2019 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id451466/">https://habr.com/ru/post/id451466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id451456/index.html">Penyimpanan AERODISK Rusia: pengujian beban. Meremas IOPS</a></li>
<li><a href="../id451458/index.html">Kami membuat game dev. Bagian 1</a></li>
<li><a href="../id451460/index.html">Julia dalam labirin</a></li>
<li><a href="../id451462/index.html">Tulis lebih sedikit kode duplikat menggunakan binder di Laravel</a></li>
<li><a href="../id451464/index.html">Frontend Weekly Digest (6 - 12 Mei 2019)</a></li>
<li><a href="../id451468/index.html">Intisari bahan-bahan segar dari dunia front-end untuk minggu terakhir No. 364 (6 - 12 Mei 2019)</a></li>
<li><a href="../id451476/index.html">LLVM dalam hal Go</a></li>
<li><a href="../id451478/index.html">Mempercepat eksplorasi data menggunakan panda-profiling library</a></li>
<li><a href="../id451480/index.html">Mengapa Departemen Perindustrian dan Perdagangan melarang penyimpanan data pada peralatan asing</a></li>
<li><a href="../id451482/index.html">Kompetensi programmer modern dari sudut yang berbeda</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>