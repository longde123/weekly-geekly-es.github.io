<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥üèº üî® üàµ Conf√©rence DEFCON 18. Trollim Reverse Engineering Using Mathematics ‚ò£Ô∏è üà∫ üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je vais parler de la p√™che √† la tra√Æne en math√©matiques. Ce ne sont pas des trucs de hackers √† la mode, c'est plut√¥t une expression artistique, une dr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conf√©rence DEFCON 18. Trollim Reverse Engineering Using Mathematics</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/433280/"> Je vais parler de la p√™che √† la tra√Æne en math√©matiques.  Ce ne sont pas des trucs de hackers √† la mode, c'est plut√¥t une expression artistique, une dr√¥le de technologie intelligente pour que les gens vous consid√®rent comme un cr√©tin.  Je vais maintenant v√©rifier si mon rapport est pr√™t √† √™tre affich√© √† l'√©cran.  Tout semble bien se passer, je peux donc me pr√©senter. <br><br><img src="https://habrastorage.org/webt/ez/pj/s8/ezpjs8mlxgrkekfrl6cyjia0zhu.jpeg"><a name="habracut"></a><br><br>  Je m'appelle Frank Tu, √©pel√© frank ^ 2 et @franksquared sur Twitter, car Twitter a √©galement une sorte de spammeur nomm√© "frank 2".  J'ai essay√© de leur appliquer l'ing√©nierie sociale pour qu'ils suppriment son compte, car techniquement c'est du spam et j'ai le droit de m'en d√©barrasser comme mon clone.  Mais apparemment, si vous les traitez honn√™tement, ils ne font pas la m√™me chose, car malgr√© ma demande de supprimer le compte de spammeur, ils n'y ont rien fait, alors j'ai envoy√© ce putain de Twitter en enfer. <br><br>  Beaucoup de gens me reconnaissent par ma casquette.  Je travaille dans les groupes r√©gionaux DefCon DC949 et DC310.  Je travaille √©galement avec Rapid7, mais je ne peux pas en parler ici sans utiliser un langage grossier, et mon manager ne veut pas que je jure.  J'ai donc pr√©par√© cette pr√©sentation pour DefCon et je vais respecter le d√©lai de 15 minutes, bien que ce soit un sujet assez compliqu√©.  Il s'agit essentiellement d'une pr√©sentation standard qui se concentre sur la r√©tro-ing√©nierie et les choses amusantes connexes. <br><br>  Lors de la discussion de ce sujet sur Twitter, deux camps se sont form√©s.  Un gars a dit: "Je ne sais pas de quoi parle ce putain de franc ^ 2, mais c'est g√©nial!"  Le deuxi√®me gars de Reddit a vu mes diapositives et √©tait boulevers√© par les liens vers des choses qui n'√©taient pas li√©es au sujet, √©tait en col√®re qu'un sujet aussi s√©rieux n'ait pas √©t√© enti√®rement couvert, donc je souhaitais que ma pr√©sentation ait "plus de contenu et moins de d√©chets". <br><br><img src="https://habrastorage.org/webt/dw/wg/il/dwwgilfsbikiyjsa8kkr-ifito8.jpeg"><br><br>  Par cons√©quent, je veux me concentrer sur cette citation.  Rien de personnel, mec de Reddit - je dis cela non seulement au cas o√π il serait pr√©sent dans cette pi√®ce, mais aussi parce que c'√©tait une critique juste.  Parce qu'une conversation qui ne contient pas suffisamment de contenu utile est une conversation vide. <br><br>  Le sujet de ma conversation est une routine standard pour les pirates, mais il me semble qu'en fait, les intervenants n'essaient g√©n√©ralement pas de pr√©senter leurs informations de mani√®re divertissante, m√™me lorsque cela est possible, pr√©f√©rant des conclusions s√®ches et √©mascul√©es.  "Voici l'IP, voici l'ESP, voici comment vous pouvez effectuer un exploit, voici mon" z√©ro jour ", maintenant applaudissez!"  - et tout le monde tape des mains. <br><br>  Merci pour les applaudissements, je l'appr√©cie!  Il me semble qu'il y a beaucoup de points int√©ressants dans mon mat√©riel, donc il m√©rite d'√™tre √©nonc√© d'une mani√®re quelque peu divertissante, ce que j'essaierai de faire. <br><br>  Vous verrez une attitude exceptionnellement superficielle envers l'informatique et l'humour compl√®tement enfantin, alors j'esp√®re que vous appr√©cierez ce que je vais montrer ici.  Je suis d√©sol√© si vous √™tes venu ici √† la recherche d'une conversation s√©rieuse. <br><br>  Sur la diapositive, vous voyez une analyse scientifique de mon dernier rapport comparant la part d'une approche strictement scientifique et la part d'un ¬´m√©dicament¬ª qui assure la s√©curit√© informatique. <br><br><img src="https://habrastorage.org/webt/sg/dy/ef/sgdyefwk3c8k5olv7tjymmpd77a.jpeg"><br><br>  Vous voyez qu'il y a beaucoup plus de ¬´drogues¬ª, mais ne vous inqui√©tez pas, maintenant la part de la science a l√©g√®rement augment√©. <br><br><img src="https://habrastorage.org/webt/t8/8e/u6/t88eu666sy0qrgwbk8qxydshdfe.jpeg"><br><br>  Il y a quelque temps, mon ami Merlin, assis ici au premier plan, a √©crit un bot √©tonnant bas√© sur le script IRC Python, qui n'occupe qu'une seule ligne. <br><br>  C'est un exercice vraiment g√©nial pour apprendre la programmation fonctionnelle, ce qui est tr√®s amusant √† jouer.  Vous pouvez simplement ajouter une fonction apr√®s l'autre et obtenir des combinaisons de toutes sortes de fonctions diff√©rentes, et tout cela est dessin√© sur l'√©cran comme une vague arc-en-ciel, en g√©n√©ral, c'est l'une des choses les plus stupides que vous puissiez faire. <br><br><img src="https://habrastorage.org/webt/hc/bk/oe/hcbkoelnorhbl1idrue1ishlk7c.jpeg"><br><br>  Je pensais que si vous appliquez ce principe aux fichiers binaires?  Je ne sais pas d'o√π vient cette id√©e, mais elle s'est av√©r√©e g√©niale!  Cependant, je veux clarifier certains concepts de base. <br><br>  Il est possible que votre professeur de math√©matiques ait pr√©sent√© ces fonctions beaucoup plus compliqu√©es qu'elles ne le sont r√©ellement. <br><br><img src="https://habrastorage.org/webt/fj/-q/rp/fj-qrpljhzhe4dadrmw-wpxqdyk.jpeg"><br><br>  Ainsi, la formule f (x) a un sens tr√®s simple, elle fonctionne comme des fonctions ordinaires.  Vous avez X, vous avez une entr√©e, puis vous obtenez X 7 fois, ce qui est √©gal √† votre valeur.  En Python, vous pouvez cr√©er une fonction (lambda x: x * 7).  Si vous voulez travailler avec Java - je suis d√©sol√©, j'esp√®re que vous ne voudrez jamais faire √ßa - alors vous pouvez faire quelque chose comme: <br><br><pre><code class="plaintext hljs">public static int multiplyBySevenAndReturn(Integer x) { return x * 7; }</code> </pre> <br>  Vous savez, les fonctions math√©matiques peuvent m√™me √™tre beaucoup plus compliqu√©es, mais c'est tout ce que nous devons savoir √† leur sujet pour le moment. <br><br>  Si vous regardez l'assemblage de code, vous remarquerez que les instructions JMP et CALL ne sont pas li√©es √† des valeurs sp√©cifiques; elles fonctionnent avec un d√©calage.  Si vous utilisez un d√©bogueur, vous pouvez voir que le JMP00401000 ressemble plus √† une instruction de transfert vers octets qu'√† une instruction sp√©cifique pour passer √† 5 ou 10 octets.  La m√™me chose s'applique √† la fonction CALL, sauf qu'elle pousse tout un tas de choses sur votre pile.  L'exception est le cas lorsque vous ¬´collez¬ª l'adresse au registre, c'est-√†-dire que vous acc√©dez √† une adresse sp√©cifique.  Tout se passe ici d'une mani√®re compl√®tement diff√©rente.  Apr√®s avoir raccord√© l'adresse au registre et effectu√© quelque chose comme APPELER EAX, la fonction acc√®de √† la valeur sp√©cifique dans EAX.  Il en va de m√™me pour CALL [EAX] ou JMP [EAX] - il d√©r√©f√©rence simplement EAX et va √† cette adresse.  Lorsque vous utilisez un d√©bogueur, vous ne pourrez peut-√™tre pas d√©terminer √† quelle adresse sp√©cifique CALL acc√®de.  Cela peut √™tre un probl√®me, vous devez donc en √™tre conscient. <br>  Regardons la fonction de saut court JMP SHORT.  Il s'agit d'une instruction sp√©ciale dans l'architecture x86 qui vous permet d'utiliser un d√©calage de 1 octet au lieu d'un d√©calage de 4 octets, ce qui r√©duit l'espace m√©moire utilis√©.  Cela importera plus tard pour toutes les manipulations qui se produiront avec des instructions individuelles.  Il est important de garder √† l'esprit que JMP SHORT a une plage de 256 octets.  Cependant, il n'y a rien de tel qu'un CALL SHORT. <br><br><img src="https://habrastorage.org/webt/qr/0o/fg/qr0ofgmfo8ypyexaxbhe-bmlcpo.jpeg"><br><br>  Consid√©rons maintenant la sorcellerie de l'informatique.  Au milieu de la cr√©ation de ces diapositives, j'ai r√©alis√© qu'en fait, vous pouvez d√©finir un assemblage comme un espace nul, c'est-√†-dire qu'il n'y a techniquement aucun espace entre chaque instruction.  Si vous regardez les instructions individuelles, vous verrez que chacune est ex√©cut√©e l'une apr√®s l'autre.  Techniquement, cela peut √™tre interpr√©t√© comme un saut inconditionnel √† l'instruction suivante.  Cela nous donne un espace entre chaque instruction d'assemblage, tandis que chaque instruction est associ√©e de mani√®re correspondante √† un saut inconditionnel. <br><br>  Si vous regardez cet exemple d'assemblage, au fait, ce sont des choses tr√®s simples que je recommande de d√©coder avec ASCII, il ne s'agit donc que d'un ensemble d'instructions r√©guli√®res. <br><br><img src="https://habrastorage.org/webt/ud/ld/7n/udld7n6wwfcvyuvxr6jdd28b1by.jpeg"><br><br>  Les 0 JMP situ√©s entre chaque instruction sont des sauts inconditionnels que vous ne voyez g√©n√©ralement pas.  Ils se suivent apr√®s chaque instruction.  Par cons√©quent, il est possible de placer chaque instruction d'assemblage individuelle dans un emplacement de m√©moire arbitraire si et seulement si chaque instruction d'unit√© est accompagn√©e d'un saut inconditionnel √† l'instruction suivante.  Parce que si vous transf√©rez l'assembly et que vous devez utiliser le m√™me code qu'auparavant, vous devez attacher un saut inconditionnel √† chaque instruction. <br>  Regardons plus loin.  Un tableau unidimensionnel peut techniquement √™tre interpr√©t√© comme un tableau bidimensionnel, il n√©cessite juste un peu de math√©matiques, de lignes ou quelque chose comme √ßa, je ne le dirai pas avec certitude, mais ce n'est pas trop difficile.  Cela nous donne l'occasion d'interpr√©ter l'emplacement en m√©moire sous la forme d'un r√©seau (x, y).  En combinaison avec l'interpr√©tation de l'espace vide entre les instructions comme des sauts inconditionnels qui peuvent √™tre li√©s les uns aux autres, nous pouvons litt√©ralement dessiner des instructions.  C'est g√©nial! <br><br>  Pour mettre cela en pratique, vous devez effectuer les √©tapes suivantes: <br><br><ul><li>  d√©monter chaque instruction pour d√©couvrir quel est le code; </li><li>  Allouez une place en m√©moire beaucoup plus grande que la taille du jeu d'instructions.  Je r√©serve g√©n√©ralement 10 fois plus de m√©moire que la taille du code; </li><li>  pour chaque instruction, d√©terminer f (x); </li><li>  mettre chaque instruction √† l'emplacement correspondant (x, y) en m√©moire; </li><li>  attacher un saut inconditionnel √† l'instruction; </li><li>  marquez la m√©moire comme ex√©cutable et ex√©cutez le code. </li></ul><br>  Malheureusement, de nombreuses questions se posent ici.  C'est comme avec la gravit√©, qui ne fonctionne qu'en th√©orie, mais en pratique, nous voyons une chose compl√®tement diff√©rente.  Parce qu'en r√©alit√©, x86 envoie en enfer vos instructions JMP, les instructions CALL, d√©forme votre code auto-r√©f√©rentiel, code auto-modifiant qui utilise l'it√©ration. <br><br><img src="https://habrastorage.org/webt/wi/8c/cq/wi8ccqnv606718u6worjzx7bnok.jpeg"><br><br>  Commen√ßons par les instructions JMP.  √âtant donn√© que les instructions JMP sont biais√©es, lorsqu'elles sont plac√©es dans un endroit arbitraire, elles ne pointent plus vers o√π vous pensez qu'elles devraient pointer.  SHORT JMP se retrouve dans une position similaire.  Plac√©s accidentellement par votre fonction (x, y), ils n'indiqueront pas sur quoi vous comptez.  Mais contrairement aux JMP longs, les JMP courts sont plus faciles √† corriger, surtout si vous avez affaire √† un tableau unidimensionnel.  SHORT JMP est facile √† convertir en JMP standard, mais vous devez ensuite d√©terminer ce qu'est devenu le nouveau d√©calage. <br><br>  Travailler avec des JMP bas√©s sur des registres est toujours un casse-t√™te, et comme ils n√©cessitent des d√©calages serr√©s et peuvent √™tre calcul√©s au moment de l'ex√©cution, il n'y a pas de moyen facile de savoir o√π ils vont.  Pour d√©tecter automatiquement chaque registre, vous devez utiliser un tas de connaissances issues de la th√©orie de la compilation.  Au moment de l'ex√©cution, il peut y avoir des pointeurs de fonction, des pointeurs de classe, etc.  Certes, si vous ne voulez pas faire de travail suppl√©mentaire pour faire tout cela, vous ne pouvez pas le faire.  Les fonctions f (x) fonctionnent en code r√©el pas aussi √©l√©gamment que sur papier.  Si vous voulez le faire correctement, vous devrez faire beaucoup de travail. <br><br>  Pour d√©finir des pointeurs de classe et des choses comme √ßa, vous devez conjurer avec C et C ++.  Avant de sauvegarder, lors du d√©montage, convertissez votre SHORT JMP en JMP normal, car il faut faire face aux biais, c'est assez simple. <br><br>  Essayer de calculer les d√©placements r√©els est un √©norme casse-t√™te.  Toutes les instructions que vous trouvez ont des d√©calages qui se d√©placent lorsque le code se d√©place et doivent √™tre recalcul√©es.  Cela signifie que vous devez suivre les instructions et indiquer o√π elles se d√©placent en tant qu'objectifs.  C‚Äôest difficile pour moi de vous expliquer sur les diapositives, mais un exemple de comment y parvenir est sur le CD avec le mat√©riel de cette conf√©rence. <br><br>  Apr√®s avoir plac√© toutes les instructions, remplacez les anciens d√©calages par les nouveaux d√©calages.  Si vous n'avez pas endommag√© le d√©placement, alors tout ira bien.  Maintenant que vous vous √™tes pr√©par√©, il existe une r√©elle opportunit√© de mettre en ≈ìuvre l'id√©e au plus haut niveau.  Pour ce faire, vous avez besoin de: <br><br><ul><li>  d√©monter les instructions; </li><li>  pr√©parer un tampon m√©moire; </li><li>  initialiser les constantes disponibles f (x); </li><li>  it√©rer sur f (x) et certains pointeurs de donn√©es, selon lesquels votre code sera √©crit lors du suivi des putains d'instructions; </li><li>  Attribuer des instructions aux index cr√©√©s correspondants; </li><li>  corriger tous les sauts conditionnels; </li><li>  marquer la nouvelle partition m√©moire comme ex√©cutable; </li><li>  ex√©cuter du code. </li></ul><br>  Si vous remettez les choses √† leur place, alors nous obtenons des choses √©tranges - tout est foir√©, les instructions sautent dans des lieux de m√©moire obscurs, et tout cela semble tout simplement enchanteur. <br><br><img src="https://habrastorage.org/webt/kv/pi/wf/kvpiwfksxaglubnkdlasc2gwcda.jpeg"><br><br>  Est-ce que tout cela a une signification pratique ou est-ce juste une repr√©sentation de cirque?  La valeur appliqu√©e de ces transformations est la suivante.  Isoler les instructions d'assemblage et quelques √©tapes pour calculer f (x) nous permet de placer ces instructions d'assemblage n'importe o√π dans le tampon sans aucune intervention de l'utilisateur.  Pour confondre les chemins d'ex√©cution de code, tout ce que vous avez √† faire est d'√©crire math√©matiquement la fonction et les pointeurs dans un assembleur, en les choisissant au hasard. <br><br>  Cela simplifie consid√©rablement les techniques de codage polymorphe.  Au lieu d'√©crire du code √† chaque fois qui manipule votre code d'une certaine mani√®re, vous pouvez √©crire une s√©rie de fonctions qui d√©terminent al√©atoirement la position de votre code, puis s√©lectionnez ces fonctions comme al√©atoires, etc. <br><br>  Anti-reverse n'est pas aussi cool et frais que la technique anti-d√©bogage. <br><br>  L'anti-version ne d√©pend pas du plaisir que vous obtenez √† rendre impossible l'utilisation de l'IDA, ni de la fa√ßon dont vous g√¢cherez l'ordinateur du Reverser avec des images GNAA Last Measure, bien que ce soit sacr√©ment amusant.  Anti-inversion signifie simplement √™tre un connard, car si vous, comme le dernier connard, obtenez un Reverser, un mec qui rompt la protection de diff√©rents syst√®mes, il se mettra simplement en col√®re, enverra ce programme malveillant en enfer et partira. <br><br>  Pendant ce temps, vous pourrez vendre tous vos bots aux r√©seaux d'entreprises russes, car avec votre logiciel vous ¬´baissez¬ª tous ceux impliqu√©s dans la r√©tro-ing√©nierie.  Tout le monde sait comment trouver des techniques anti-d√©bogage sur Google, mais ils n'y trouveront pas de solutions aux probl√®mes r√©sultant de choses cr√©atives.  Les anti-revolvers les plus cr√©atifs feront que les inverseurs casseront leurs doigts du clavier et laisseront des trous de la taille d'un poing dans les murs.  Les inverseurs vont bouillir de col√®re, ils ne comprendront pas ce que vous avez fait, parce que votre code a tout g√¢ch√©. <br><br>  C'est une sorte de jeu nerveux, une chose psychologique, si vous √™tes cr√©atif dans ce domaine et cr√©ez un anti-retour vraiment magnifique, vous pouvez en √™tre fier.  Mais vous savez qu'en fait, vous essayez simplement de les √©loigner de votre code. <br><br>  Alors qu'est-ce que je vais faire?  Je vais prendre les fonctions d'obscurcissement et les confondre.  Ensuite, je vais utiliser la deuxi√®me version de l'obfuscation des fonctions enchev√™tr√©es et appliquer √† nouveau l'obfuscation.  Alors, tirons le code.  Ceci est un exemple de p√™che √† la tra√Æne math√©matique, que j'ai pris comme exemple. <br><br><img src="https://habrastorage.org/webt/qt/rn/sx/qtrnsxmxi2hcqfrtyilcqrtxaem.jpeg"><br><br>  Ainsi, j'entre la commande "confuse by formula" dans la fen√™tre qui s'ouvre. <br><br><img src="https://habrastorage.org/webt/_8/mi/gg/_8miggm7ypffnzh5pxg9wqp_mls.jpeg"><br><br>  Ensuite, vous voyez des instructions d'assemblage qui font leur travail.  Notez que j'utilise C ++ ici, bien qu'√† la moindre occasion j'essaye d'√©viter cela. <br><br><img src="https://habrastorage.org/webt/vo/rs/0n/vors0n4cbvak6erlntuxupbibyw.jpeg"><br><br>  Ici, la fonction active CALL EAX est mise en √©vidence, puis l'instruction de saut √† appliquer suit, vous voyez un tas de toutes sortes de choses diff√©rentes dans le tampon, et tout cela se fait avec chaque instruction individuelle. <br><br><img src="https://habrastorage.org/webt/ei/eg/ls/eiegls4lpaq-5ktwrcmvxfm7xhg.jpeg"><br><br><img src="https://habrastorage.org/webt/bb/vl/rp/bbvlrpccrihcbvjxklexk-hee7a.jpeg"><br><br>  Maintenant, je rembobine le programme jusqu'√† la fin, et vous verrez le r√©sultat.  Donc, le code a toujours fi√®re allure, un tas d'instructions JMP sont compil√©es ici, cela semble d√©routant et en fait, il est d√©routant. <br><br><img src="https://habrastorage.org/webt/fe/n4/-f/fen4-ff9er24oisuviqc2gpc_rg.jpeg"><br><br>  La diapositive suivante montre une repr√©sentation graphique de l'apparence de la pile. <br><br><img src="https://habrastorage.org/webt/zi/d9/sa/zid9sadg9n0azq5oeesabhfq2wm.jpeg"><br><br>  Chaque fois que cela se produit, je g√©n√®re une formule d'onde sinuso√Ødale al√©atoire de forme arbitraire, vous voyez ici un tas de formes diff√©rentes, et c'est cool.  Je pense que le code commence quelque part en haut √† gauche, mais je ne me souviens pas exactement.  Il tord donc tout, vous pouvez non seulement faire des sinuso√Ødes, mais aussi tordre les spirales. <br><br><img src="https://habrastorage.org/webt/tk/hq/iq/tkhqiqo6k4yxin-xboy7wqepcic.jpeg"><br><br>  Seules deux formules fonctionnent ici, que j'ai incluses dans le code source.  Sur cette base, vous pouvez faire autant de choses cr√©atives que vous le souhaitez, essentiellement c'est juste DIFF du tampon de d√©but au tampon de fin. <br><br>  Le probl√®me est que cet exemple de code utilise des sauts inconditionnels, ce qui est en fait mauvais, car le code doit √™tre exactement le m√™me qu'avant, c'est-√†-dire que les sauts inconditionnels ne suivent qu'une seule direction.  Par cons√©quent, vous devez aller du point d'entr√©e √† la fin de la m√™me mani√®re, vous d√©barrasser des instructions de saut et vous avez termin√© - vous avez votre code!  Que faire?  Il est n√©cessaire de transformer les sauts inconditionnels en sauts conditionnels.  Les sauts conditionnels se font dans deux directions, c'est beaucoup mieux, on peut dire que c'est 50% mieux. <br><br>  Ici, nous avons un dilemme int√©ressant: si nous avons besoin de sauts conditionnels, alors nous devons toujours utiliser des sauts inconditionnels ...  Alors on fait quoi?  Les pr√©dicats opaques nous sauveront!  Pour ceux qui ne le savent pas, un pr√©dicat opaque est essentiellement une instruction bool√©enne qui est toujours ex√©cut√©e pour une version particuli√®re ind√©pendamment de quoi que ce soit. <br>  Examinons donc l'extension de l'espace z√©ro que j'ai mentionn√©e plus t√¥t.  Si vous avez un ensemble d'instructions et qu'elles ont des sauts inconditionnels, des transitions entre chaque instruction, il s'ensuit qu'une s√©rie d'instructions d'assemblage qui n'affectent pas directement les instructions dont nous avons besoin peut pr√©c√©der ou suivre une seule instruction. <br>  Par exemple, si vous avez √©crit des instructions tr√®s sp√©cifiques qui ne modifient pas l'assembly principal de ce que vous essayez de confondre, c'est-√†-dire que vous essayez de ne pas vous impliquer dans les registres tant que vous conservez l'√©tat de chaque instruction d'assembly.  Et c'est encore plus √©tonnant. <br>  Vous pouvez consid√©rer chaque instruction d'assemblage, qui peut √™tre confondue, comme le pr√©ambule, les donn√©es d'assemblage et le post-scriptum.  Le pr√©ambule est celui qui pr√©c√®de l'instruction d'assemblage, et le post-scriptum est celui qui la suit.  Le pr√©ambule est g√©n√©ralement utilis√© ou peut √™tre utilis√© pour deux choses: <br><br><ul><li>  correction des cons√©quences du pr√©dicat opaque du pr√©ambule pr√©c√©dent; </li><li>  fragments de code anti-d√©bogage. </li></ul><br>  Mais le pr√©ambule est essentiellement limit√© car vous ne pouvez pas en faire trop. <br>  Postscript est une chose plus dr√¥le.  Il peut √™tre utilis√© pour: <br><br><ul><li>  pr√©dicats opaques et sauts complexes vers les sections de code suivantes; </li><li>  anti-d√©bogage et obscurcissement de l'ex√©cution globale du code; </li><li>  chiffrement et d√©chiffrement de divers fragments de code dans le programme lui-m√™me. </li></ul><br>  En ce moment, je travaille sur la possibilit√© de chiffrer et de d√©chiffrer chaque instruction individuelle de sorte que lorsque chaque instruction est ex√©cut√©e, elle d√©chiffre la section suivante, la section suivante, la suivante, etc.  La diapositive suivante en montre un exemple. <br><br><img src="https://habrastorage.org/webt/co/is/tj/coistjw3lgdiwggoqth_c9hnq2y.jpeg"><br><br>  Les lignes du pr√©ambule et l'appel du d√©bogueur sont surlign√©s en vert.  Tout ce que cet appel fait est de v√©rifier si nous avons un d√©bogueur, apr√®s quoi nous allons dans une section arbitraire du code. <br><br>  Ci-dessous, nous avons un pr√©dicat opaque tr√®s simple.  Si vous maintenez la valeur Eax dans le post-script √† l'instruction sup√©rieure, puis suivez l'op√©rateur XOR, donc votre JZ pense: "OK, je peux √©videmment aller √† gauche ou √† droite, je pense que c'est mieux j'irai √† droite, car il y a 0".  Ensuite, POP EAX est ex√©cut√©, votre EAX revient en arri√®re, apr√®s quoi l'instruction suivante est trait√©e, etc. <br><br>  Cela, √©videmment, cr√©e des probl√®mes beaucoup plus importants que notre strat√©gie de base, tels que les effets r√©siduels et la complication de la g√©n√©ration de diff√©rents ensembles d'instructions.  Par cons√©quent, il sera tr√®s difficile de d√©terminer comment une instruction affecte une autre instruction.  Vous pouvez me lancer des pantoufles, car je n'ai pas encore termin√© ce programme incroyable, mais vous pouvez suivre les progr√®s du d√©veloppement sur mon blog. <br><br><img src="https://habrastorage.org/webt/c9/ce/el/c9ceelekpf6j1kv8f9x-qooiug8.jpeg"><br><br>  Je note que nos formules f (x) ne doivent pas √™tre calcul√©es de mani√®re it√©rative, par exemple f (1), f (2), ... f (n).  Rien ne les emp√™che d'√™tre calcul√©s au hasard.  Si vous √™tes intelligent, vous pouvez d√©terminer le nombre d'instructions dont vous avez besoin, puis attribuer, par exemple, f (27), f (54), f (9), et ce sera l'endroit o√π votre instruction sera plac√©e au hasard.  Lorsque vous effectuez cette op√©ration, selon la fa√ßon dont vous avez √©crit votre code, vous pouvez l'arr√™ter √† l'avance et le code liera toujours vos instructions de mani√®re al√©atoire. <br><br>  Si votre code est g√©n√©r√© sur la base d'une formule pr√©visible, il s'ensuit que le point d'entr√©e est √©galement pr√©visible, vous pouvez donc prendre un niveau de plus avant de terminer la r√©ception du code et confondre consid√©rablement le point d'entr√©e √† un degr√© ou un autre.  Par exemple, prenez 300 instructions d'assemblage provenant d'un seul point d'entr√©e. <br><br>  Parlons maintenant des lacunes. <br><br><img src="https://habrastorage.org/webt/2l/wp/7i/2lwp7iffr7n-s_mn-tdcztkkay8.jpeg"><br><br>  Cette m√©thode n√©cessite une compilation minutieuse du code, principalement en utilisant GCC ou, Dieu nous en pr√©serve, en utilisant C ++.  C ++ est en fait un langage assez cool pour plusieurs raisons, mais vous savez que tous les compilateurs sont nuls.  Donc, l'essentiel dans cette affaire est une compilation artisanale comp√©tente, car si votre tentative de confondre votre propre assemblage entra√Ænera l'approbation du gang qui a invent√© le ver Conficker, alors vous avez foir√©. <br><br>  Vous aurez besoin d'une grande quantit√© de m√©moire.  Rappelez-vous l'image avec des ondes sinuso√Ødales.  Le rouge est le code, et le bleu est la m√©moire n√©cessaire pour qu'il fonctionne, et il devrait √™tre suffisant pour que tout fonctionne comme il se doit. <br><br>  Vous aurez probablement affaire √† un gigantesque ensemble de donn√©es apr√®s avoir termin√© le code.  Et il augmentera consid√©rablement si vous souhaitez confondre plusieurs fonctions. <br><br>  Les pointeurs de fonction se comportent de mani√®re impr√©visible - parfois correctement, parfois non.  Cela d√©pend de ce que vous faites et il y aura certainement un probl√®me parce que vous ne pouvez pas pr√©dire o√π et quand le pointeur de fonction se d√©clenche dans votre assembly. <br><br>  Plus vous g√©n√©rez de l'obscurcissement et manipulez l'assemblage dans le pr√©ambule et le post-scriptum, plus il est difficile de corriger et de d√©boguer.  Donc, √©crire un tel code revient √† trouver un √©quilibre entre ¬´d'accord, je vais ins√©rer soigneusement un ou deux JMP ici¬ª et ¬´comment diable puis-je tout comprendre en peu de temps¬ª?  Il vous suffit donc d'ins√©rer des instructions, puis de comprendre pendant plusieurs mois ce que vous avez fait. <br><br>  J'esp√®re que vous avez appris quelque chose d'utile aujourd'hui.  √Ä mon avis, je me suis vraiment enivr√© et donc je ne comprends pas vraiment ce qui s'est pass√© maintenant.  La diapositive suivante montre mes contacts Twitter, mon blog et mon site Web, alors visitez-moi ou √©crivez. <br><br><img src="https://habrastorage.org/webt/l3/0j/ps/l30jpsxkmmgtsez-k-pxvr9vg70.jpeg"><br><br>  C'est tout, merci d'√™tre venu! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/y124L75ZKAc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Merci de rester avec nous.  Aimez-vous nos articles?  Vous voulez voir des mat√©riaux plus int√©ressants?  Soutenez-nous en passant une commande ou en le recommandant √† vos amis, une <b>r√©duction de 30% pour les utilisateurs Habr sur un analogue unique de serveurs d'entr√©e de gamme que nous avons invent√©s pour vous:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toute la v√©rit√© sur VPS (KVM) E5-2650 v4 (6 c≈ìurs) 10 Go DDR4 240 Go SSD 1 Gbps √† partir de 20 $ ou comment diviser le serveur?</a>  (les options sont disponibles avec RAID1 et RAID10, jusqu'√† 24 c≈ìurs et jusqu'√† 40 Go de DDR4). <br><br>  <b>VPS (KVM) E5-2650 v4 (6 c≈ìurs) 10 Go DDR4 240 Go SSD 1 Gbit / s jusqu'en janvier gratuitement</b> en payant pour une p√©riode de six mois, vous pouvez commander <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  <b>Dell R730xd 2 fois moins cher?</b>  Nous avons seulement <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2 x Intel Dodeca-Core Xeon E5-2650v4 128 Go DDR4 6x480 Go SSD 1 Gbps 100 TV √† partir de 249 $</a> aux Pays-Bas et aux √âtats-Unis!</b>  Pour en savoir plus sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cr√©ation d'un b√¢timent d'infrastructure.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe utilisant des serveurs Dell R730xd E5-2650 v4 co√ªtant 9 000 euros pour un sou?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433280/">https://habr.com/ru/post/fr433280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433270/index.html">R√©solution de probl√®mes MapStruct avec ManyToMany</a></li>
<li><a href="../fr433272/index.html">Entretien avec David Gobel</a></li>
<li><a href="../fr433274/index.html">Oleg Dokuka √† propos du d√©veloppement r√©actif sur jug.msk.ru</a></li>
<li><a href="../fr433276/index.html">√Ä propos des avantages de l'int√©gration de CSS dans JS</a></li>
<li><a href="../fr433278/index.html">Programmation WebGL-wind et GPU. Conf√©rence √† FrontTalks 2018</a></li>
<li><a href="../fr433282/index.html">Passerelles de protocoles d'√©changes industriels sous Linux. Assemblez-vous</a></li>
<li><a href="../fr433286/index.html">10 r√©unions et hackathons informatiques les plus proches √† Moscou</a></li>
<li><a href="../fr433288/index.html">S√©curit√© Web: Introduction √† HTTP</a></li>
<li><a href="../fr433292/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 279 (du 10 au 16 d√©cembre)</a></li>
<li><a href="../fr433294/index.html">Quelques recommandations de travail d'√©quipe simples</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>