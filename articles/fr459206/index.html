<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëµüèΩ üë©üèº‚Äçüé§ üóÇÔ∏è 9 ans dans un monolithe √† Node.JS üë¶üèº üêô üåã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a une semaine, j'ai pris la parole lors d'une r√©union Node.JS et j'ai promis √† beaucoup de publier un enregistrement de la performance. Plus tard...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>9 ans dans un monolithe √† Node.JS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459206/"><p><img src="https://habrastorage.org/webt/p-/5g/we/p-5gweh68uzyj3_baevjuocr8xi.png" alt="monolithe de https://reneaigner.deviantart.com"></p><br><p>  Il y a une semaine, j'ai pris la parole lors d'une r√©union Node.JS et j'ai promis √† beaucoup de publier un enregistrement de la performance.  Plus tard, j'ai r√©alis√© que je ne pouvais pas tenir compte de certains faits int√©ressants dans une demi-heure r√©glement√©e.  Oui, et je pr√©f√®re moi-m√™me lire, plut√¥t que regarder et √©couter, j'ai donc d√©cid√© de poster ma pr√©sentation sous la forme d'un article.  Cependant, la vid√©o sera √©galement √† la fin de l'article dans la section des liens. </p><br><p> J'ai d√©cid√© de vous parler d'un point sensible - la vie dans un monolithe.  Il y a d√©j√† des centaines d'articles √† ce sujet sur le hub, des milliers d'exemplaires sont cass√©s dans les commentaires, la v√©rit√© est morte depuis longtemps dans la controverse, mais ... Le fait est que nous avons une exp√©rience tr√®s sp√©cifique dans OneTwoTrip, contrairement √† beaucoup de gens qui √©crivent sur certains mod√®les architecturaux dans vide: </p><br><ul><li>  Tout d'abord, notre monolithe a d√©j√† 9 ans. </li><li>  Deuxi√®mement, il a pass√© toute sa vie sous forte charge (il est maintenant de 23 millions de demandes par heure). </li><li>  Et dans NaN, nous √©crivons notre monolithe sur Node.JS, qui a chang√© au-del√† de la reconnaissance au cours des 9 derni√®res ann√©es.  Oui, nous avons commenc√© √† √©crire sur le n≈ìud en 2010, nous chantons une chanson √† la fr√©n√©sie des braves! </li></ul><br><p>  Nous avons donc beaucoup de sp√©cificit√© et d'exp√©rience r√©elle.  Int√©ressant?  C'est parti! </p><a name="habracut"></a><br><p>  <strong>D√©lais de non-responsabilit√©</strong> </p><br><blockquote>  Cette pr√©sentation ne refl√®te que l'opinion priv√©e de son auteur.  Il peut co√Øncider avec la position de OneTwoTrip ou ne pas co√Øncider.  Voil√† comment la chance.  Je travaille en tant qu‚Äôexpert technique de l‚Äôune des √©quipes de l‚Äôentreprise et je ne pr√©tends pas √™tre objectif ou exprimer une opinion autre que la mienne. </blockquote><p>  <strong>Disclaimer Two</strong> </p><br><blockquote>  Cet article d√©crit les √©v√©nements historiques, et pour le moment tout est compl√®tement faux, alors ne vous inqui√©tez pas. </blockquote><br><h2 id="0-kak-zhe-tak-vyshlo">  0. Comment est-ce arriv√© </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La tendance des requ√™tes du</a> mot "microservice" dans google: <br><img src="https://habrastorage.org/webt/i5/ss/lm/i5sslmpta1fldeztaxgmmnd50ag.png"><br>  Tout est tr√®s simple - il y a neuf ans, personne ne connaissait les microservices.  Nous avons donc commenc√© √† √©crire, comme tout le monde - dans un monolithe. </p><br><h2 id="1-bol-v-monolite">  1. Douleur dans le monolithe </h2><br><p>  Je d√©crirai ici les situations probl√©matiques que nous avons connues au cours de ces 9 ann√©es.  Certains d'entre eux ont √©t√© r√©solus, certains ont √©t√© contourn√©s par des hacks, certains ont tout simplement perdu leur pertinence.  Mais leur souvenir, comme les cicatrices de bataille, ne me quittera jamais. </p><br><h3 id="11-obnovlenie-svyaznyh-komponentov">  1.1 Mise √† jour des composants connect√©s </h3><br><p><img src="https://habrastorage.org/webt/0a/h-/8f/0ah-8f7ijb259t-blaohq1_dceg.png"><br>  C'est le cas lorsque la synergie est mauvaise.  Parce que n'importe quel composant a √©t√© r√©utilis√© plusieurs centaines de fois, et s'il √©tait possible de l'utiliser de fa√ßon tordue, il n'a pas √©t√© perdu.  Toute action peut provoquer des effets compl√®tement impr√©visibles, et tous ne sont pas suivis par des unit√©s et des tests d'int√©gration.  Rappelez-vous l'histoire des vadrouilles, d'un ventilateur et d'un ballon?  Sinon, google.  Elle est la meilleure illustration du code dans le monolithe. </p><br><h3 id="12-migraciya-na-novye-tehnologii">  1.2 Migration vers les nouvelles technologies </h3><br><p>  Voulez-vous Express?  Linter?  Un autre framework pour les tests ou moks?  Mettre √† jour le validateur ou au moins lodash?  Mettre √† jour Node.js?  Je suis d√©sol√©.  Pour ce faire, vous devez modifier des milliers de lignes de code. </p><br><p>  Beaucoup parlent de l'avantage du monolithe, c'est que <strong>toute r√©vision est un commit atomique</strong> .  Ces gens sont silencieux sur une <strong>chose</strong> - <strong>cette r√©vision ne sera jamais faite</strong> . </p><br><p>  Connaissez-vous la vieille blague sur le versioning s√©mantique? </p><br><blockquote>  la vraie s√©mantique du versioning s√©mantique: <br><br>  majeur = un changement de rupture <br>  mineur = un changement de rupture mineur <br>  patch = un changement de rupture minuscule </blockquote><p>  Imaginez maintenant que tout changement de rupture minuscule appara√Ætra presque certainement dans votre code.  Non, il est possible de vivre avec, et nous avons r√©guli√®rement rassembl√© des forces et migr√©, mais c'√©tait vraiment tr√®s difficile.  Tr√®s. </p><br><h3 id="13-relizy">  1.3 Versions </h3><br><p>  Ici, je dois dire quelques sp√©cificit√©s de notre produit.  Nous avons un grand nombre d'int√©grations externes et diverses branches de la logique m√©tier qui apparaissent assez rarement s√©par√©ment.  J'envie vraiment les produits qui ex√©cutent r√©ellement toutes les branches de leur code en 10 minutes en production, mais ce n'est pas le cas ici.  Par essais et erreurs, nous avons trouv√© pour nous-m√™mes un cycle de publication optimal qui minimisait le nombre d'erreurs qui atteignent les utilisateurs finaux: </p><br><ol><li>  la sortie se passe et les tests d'int√©gration passent en une demi-journ√©e </li><li>  puis il est sous surveillance attentive sur sc√®ne pendant une journ√©e (pour 10% des utilisateurs) </li><li>  puis une autre journ√©e de production sous une surveillance encore plus attentive. </li><li>  Et seulement apr√®s cela, nous lui donnons le feu vert dans le ma√Ætre. </li></ol><br><p>  Puisque nous aimons nos coll√®gues et que nous ne sortons pas le vendredi, cela signifie finalement que la sortie va au ma√Ætre environ 1,5 √† 2 fois par semaine.  Ce qui conduit au fait que la version peut avoir 60 t√¢ches ou plus.  une telle quantit√© provoque des conflits de fusion, des effets synergiques soudains, une charge de travail compl√®te d'AQ sur l'analyse des journaux et d'autres peines.  En g√©n√©ral, il nous a √©t√© tr√®s difficile de lib√©rer un monolithe. </p><br><h3 id="14-prosto-ochen-mnogo-koda">  1.4 Juste beaucoup de code </h3><br><p>  Il semblerait que la quantit√© de code ne devrait pas √™tre d'une importance fondamentale.  Mais ... pas vraiment.  Dans le monde r√©el, c'est: </p><br><ul><li>  Seuil d'entr√©e plus √©lev√© </li><li>  D'√©normes artefacts de construction pour chaque t√¢che </li><li>  Processus CI longs, y compris les tests d'int√©gration, les tests unitaires et m√™me le linting de code </li><li>  Ralentissement du travail IDE (√† l'aube du d√©veloppement de Jetbrains, nous les avons choqu√©s avec nos journaux plus d'une fois) </li><li>  Recherche contextuelle sophistiqu√©e (n'oubliez pas, nous n'avons pas de saisie statique) </li><li>  Difficult√© √† trouver et √† supprimer le code inutilis√© </li></ul><br><h3 id="15-otsutstvuyut-vladelcy-koda">  1.5 Propri√©taires de code manquants </h3><br><p>  Tr√®s souvent, les t√¢ches surgissent avec une sph√®re de responsabilit√© incompr√©hensible - par exemple, dans les biblioth√®ques connexes.  Et le d√©veloppeur d'origine pouvait d√©j√† passer √† une autre √©quipe, voire quitter l'entreprise.  La seule fa√ßon de se rendre responsable dans ce cas est l'arbitraire administratif - de prendre et de nommer une personne.  Ce qui n'est pas toujours agr√©able tant pour le d√©veloppeur que pour celui qui le fait. </p><br><h3 id="16-slozhnost-otladki">  1.6 Difficult√© de d√©bogage </h3><br><p>  La m√©moire coule-t-elle?  Augmentation de la consommation du processeur?  Vous vouliez construire des graphiques de flammes?  Je suis d√©sol√©.  Dans un monolithe, tant de choses se produisent en m√™me temps qu'il devient incroyablement difficile de localiser un probl√®me.  Par exemple, pour comprendre laquelle des 60 t√¢ches lors du d√©ploiement en production entra√Æne une consommation accrue de ressources (bien que cela ne soit pas reproduit localement dans les environnements de test et de transfert), il est presque irr√©aliste. </p><br><h3 id="17-odin-stek">  1.7 Une pile </h3><br><p>  D'une part, c'est bien quand tous les d√©veloppeurs ¬´parlent¬ª le m√™me langage.  Dans le cas de JS, il s'av√®re que m√™me les d√©veloppeurs Backend with Frontend se comprennent.  Mais ... </p><br><ul><li>  Il n'y a pas de solution miracle, et pour certaines t√¢ches, vous souhaitez parfois utiliser autre chose.  Mais nous avons un monolithe et nous n'avons nulle part o√π coller d'autres d√©veloppeurs. </li><li>  Nous ne pouvons pas simplement prendre une bonne √©quipe sur la recommandation, qui nous est venue sur les conseils d'amis - nous n'avons nulle part o√π la mettre. </li><li>  Au fil du temps, nous nous reposons sur le fait que le march√© n'a tout simplement pas assez de d√©veloppeurs sur la bonne pile. </li></ul><br><h3 id="18-mnogo-komand-s-raznym-predstavleniem-o-schaste">  1.8 De nombreuses √©quipes avec des id√©es diff√©rentes sur le bonheur </h3><br><p><img src="https://habrastorage.org/webt/1k/bc/k1/1kbck116yjf9-ozmoee08oeacxi.png"></p><br><p>  Si vous avez deux d√©veloppeurs, vous avez d√©j√† deux id√©es diff√©rentes sur le meilleur framework, les normes √† respecter, les biblioth√®ques, etc. <br>  Si vous avez dix √©quipes, chacune ayant plusieurs d√©veloppeurs, alors ce n'est qu'un d√©sastre. <br>  Et il n'y a que deux fa√ßons de le r√©soudre - soit ¬´d√©mocratique¬ª (chacun fait ce qu'il veut), soit totalitaire (les normes sont impos√©es d'en haut).  Dans le premier cas, la qualit√© et la standardisation souffrent, dans le second - les personnes qui ne sont pas autoris√©es √† r√©aliser leur id√©e du bonheur. </p><br><h2 id="2-plyusy-monolita">  2. Les avantages du monolithe </h2><br><p>  Bien s√ªr, le monolithe pr√©sente certains avantages qui peuvent √™tre diff√©rents selon les piles, les produits et les √©quipes.  Bien s√ªr, il y en a beaucoup plus que trois, mais je ne serai pas responsable de tout ce qui est possible, seulement de ceux qui nous concernent. </p><br><h3 id="21-prostota-razvyortyvaniya">  2.1 Facile √† d√©ployer </h3><br><p>  Lorsque vous avez un service, augmenter et tester est beaucoup plus simple qu'une douzaine de services.  Certes, cet avantage n'est pertinent qu'au stade initial - par exemple, vous pouvez augmenter l'environnement de test et utiliser tous les services, √† l'exception de ceux d√©velopp√©s, √† partir de celui-ci.  Ou √† partir de conteneurs.  Ou quoi que ce soit d'autre. </p><br><h3 id="22-net-overheda-na-peredachu-dannyh">  2.2 Pas de surcharge de transfert de donn√©es </h3><br><p>  Un avantage assez douteux, si vous n'avez pas de charge √©lev√©e.  Mais nous avons un tel cas - par cons√©quent, le co√ªt du transport entre les microservices est perceptible pour nous.  Peu importe comment vous essayez de le faire rapidement, stockez et transf√©rez tout dans la RAM plus rapidement que toute autre chose - c'est √©vident. </p><br><h3 id="22-odna-sborka">  2.2 Un assemblage </h3><br><p>  Si vous avez besoin de revenir en arri√®re √† un moment donn√© de l'histoire, alors le faire avec un monolithe est vraiment simple - prenez-le et reculez.  Dans le cas des microservices, il est n√©cessaire de s√©lectionner des versions de services compatibles qui ont √©t√© utilis√©es les unes avec les autres √† un moment donn√©, ce qui ne peut pas toujours √™tre simple.  Certes, cela est √©galement r√©solu √† l'aide de l'infrastructure. </p><br><h2 id="3-mnimye-plyusy-monolita">  3. Avantages imaginaires d'un monolithe </h2><br><p>  Ici, j'ai pris toutes ces choses qui sont g√©n√©ralement consid√©r√©es comme des avantages, mais de mon point de vue, elles ne le sont pas. </p><br><h3 id="31-kod---eto-i-est-dokumentaciya">  3.1 Code - c'est la documentation </h3><br><p>  Souvent entendu cette opinion.  Mais g√©n√©ralement, il est suivi par des d√©veloppeurs novices qui n'ont pas vu de fichiers dans des dizaines de milliers de lignes de code √©crites par des gens qui sont partis il y a des ann√©es.  Eh bien, pour une raison quelconque, le plus souvent, cet article est ajout√© en faveur des partisans du monolithe - ils disent que nous n'avons besoin d'aucune documentation, nous n'avons aucun moyen de transport ou API - tout est dans le code, c'est facile et clair.  Je ne contesterai pas cette affirmation, je dirai simplement que je n'y crois pas. </p><br><h3 id="32-net-raznyh-versiy-bibliotek-servisov-i-api-net-raznyh-repozitoriev">  3.2 Il n'y a pas de versions diff√©rentes des biblioth√®ques, des services et des API.  Il n'y a pas de r√©f√©rentiels diff√©rents. </h3><br><p>  Oui  Mais non.  Parce qu'au deuxi√®me coup d'≈ìil, vous comprenez que le service n'existe pas dans le vide.  Et parmi un grand nombre d'autres codes et produits avec lesquels il s'int√®gre - √† partir de biblioth√®ques tierces, en continuant avec les versions de logiciels de serveur et sans se terminer par des int√©grations externes, une version IDE, des outils CI, etc.  Et d√®s que vous comprenez combien de choses versionn√©es diff√©rentes votre service inclut indirectement, il devient imm√©diatement clair que ce plus n'est que de la d√©magogie. </p><br><h3 id="33-prosche-monitoring">  3.3 Surveillance plus facile </h3><br><p>  Plus simple.  Parce que vous avez √† peu pr√®s un tableau de bord au lieu de quelques dizaines.  Mais c'est plus compliqu√©, et parfois m√™me impossible, car vous ne pouvez pas d√©composer vos graphiques en diff√©rentes parties du code, et vous n'avez que la temp√©rature moyenne √† l'h√¥pital.  En g√©n√©ral, j'ai d√©j√† tout dit dans le paragraphe sur la complexit√© du d√©bogage, je pr√©cise simplement que la m√™me complexit√© s'applique √† la surveillance. </p><br><h3 id="34-prosche-soblyudat-edinye-standarty">  3.4 Il est plus facile de se conformer aux normes communes </h3><br><p>  Oui  Mais, comme je l'ai d√©j√† √©crit dans le paragraphe sur beaucoup d'√©quipes avec l'id√©e du bonheur - les normes sont soit impos√©es de mani√®re totalitaire, soit affaiblies presque jusqu'√† leur absence. </p><br><h3 id="35-menshe-veroyatnost-dublirovaniya-koda">  3.5 Moins de risques de duplication de code </h3><br><p>  L'√©trange opinion est que le code n'est pas dupliqu√© dans le monolithe.  Mais je l'ai rencontr√© assez souvent.  Dans ma pratique, il s'av√®re que la duplication de code d√©pend uniquement de la culture de d√©veloppement de l'entreprise.  Si c'est le cas, le code g√©n√©ral est allou√© √† toutes sortes de biblioth√®ques, modules et microservices.  S'il n'est pas l√†, alors il y aura un copier-coller vingt fois dans le monolithe. </p><br><h2 id="4-plyusy-mikroservisov">  4. Avantages des microservices </h2><br><p>  J'√©crirai maintenant ce que nous avons obtenu apr√®s la migration.  Encore une fois, ce sont de vraies conclusions d'une situation r√©elle. </p><br><h3 id="41-mozhno-delat-geterogennuyu-infrastrukturu">  4.1 Vous pouvez cr√©er une infrastructure h√©t√©rog√®ne </h3><br><p>  Nous pouvons maintenant √©crire du code sur une pile qui est optimale pour r√©soudre un probl√®me sp√©cifique.  Et il est rationnel d‚Äôutiliser tous les bons d√©veloppeurs qui sont venus chez nous.  Par exemple, voici un exemple de liste de technologies que nous avons actuellement: <br><img src="https://habrastorage.org/webt/mt/oc/nr/mtocnrvjvhfhxxtsjfnjx3z8knc.png"></p><br><h3 id="42-mozhno-delat-mnogo-chastyh-relizov">  4.2 Vous pouvez effectuer de nombreuses versions fr√©quentes </h3><br><p>  Maintenant, nous pouvons faire de nombreuses petites versions ind√©pendantes, elles sont plus simples, plus rapides et pas douloureuses.  Autrefois, nous n'avions qu'une seule √©quipe, mais maintenant il y en a d√©j√† 18. Il y aurait eu une pause s'ils √©taient tous rest√©s dans le monolithe.  Ou les personnes qui en sont responsables ... </p><br><h3 id="43-prosche-delat-nezavisimye-testy">  4.3 Plus facile de faire des tests ind√©pendants </h3><br><p>  Nous avons r√©duit le temps pour les tests d'int√©gration, qui ne testent d√©sormais que ce qui a vraiment chang√©, et en m√™me temps nous n'avons pas peur des effets d'une synergie soudaine.  Bien s√ªr, j'ai d√ª commencer √† contourner le r√¢teau - par exemple, apprendre √† cr√©er des API r√©trocompatibles - mais au fil du temps, tout s'est arrang√©. </p><br><h3 id="44-legche-vnedryat-i-testirovat-novye-fichi">  4.4 Plus facile √† impl√©menter et √† tester de nouvelles fonctionnalit√©s </h3><br><p>  Nous sommes maintenant ouverts √† l'exp√©rimentation.  Tous les frameworks, piles, biblioth√®ques - vous pouvez tout essayer, et en cas de succ√®s, passez √† autre chose. </p><br><h3 id="45-mozhno-obnovlyat-chto-ugodno">  4.5 Vous pouvez tout mettre √† jour </h3><br><p>  Vous pouvez mettre √† jour la version du moteur, les biblioth√®ques, mais n'importe quoi!  Dans le cadre d'un petit service, trouver et corriger tous les changements de rupture est une question de minutes.  Et pas des semaines, comme avant. </p><br><h3 id="46--a-mozhno-ne-obnovlyat">  4.6 Et vous ne pouvez pas mettre √† jour </h3><br><p>  Curieusement, c'est l'une des fonctionnalit√©s les plus int√©ressantes des microservices.  Si vous avez un code de travail stable, vous pouvez simplement le geler et l'oublier.  Et vous n'aurez jamais √† le mettre √† jour, par exemple, pour ex√©cuter le code produit sur un nouveau moteur.  Le produit lui-m√™me fonctionne sur un nouveau moteur et le microservice continue de vivre comme il a v√©cu.  Les mouches avec des c√¥telettes peuvent enfin √™tre mang√©es s√©par√©ment. </p><br><h2 id="5-minusy-mikroservisov">  5 Inconv√©nients des microservices </h2><br><p>  Bien s√ªr, une mouche dans la pommade n'√©tait pas compl√®te, et une solution parfaite pour simplement s'asseoir et √™tre pay√© n'a pas fonctionn√©.  Qu'avons-nous rencontr√©: </p><br><h3 id="51-nuzhna-shina-dlya-obmena-dannymi-i-vnyatnoe-logirovanie">  5.1 Besoin d'un bus pour l'√©change de donn√©es et la journalisation claire. </h3><br><p>  L'interaction des services sur HTTP est un mod√®le classique, et en g√©n√©ral m√™me fonctionnel, √† condition qu'il y ait des couches de journalisation et d'√©quilibrage entre elles.  Mais il vaut mieux avoir un pneu plus distinct.  En outre, vous devez r√©fl√©chir √† la fa√ßon de collecter et de combiner les journaux entre eux - sinon vous n'aurez que de la bouillie sur les mains. </p><br><h3 id="52-nuzhno-sledit-za-tem-chto-delayut-razrabotchiki">  5.2 Gardez une trace de ce que font les d√©veloppeurs. </h3><br><p>  En g√©n√©ral, cela devrait toujours √™tre fait, mais dans les microservices, les d√©veloppeurs ont √©videmment plus de libert√©, ce qui peut parfois donner lieu √† des choses dont Stephen King aurait la chair de poule.  M√™me si ext√©rieurement, il semble que le service fonctionne - n'oubliez pas qu'il devrait y avoir une personne qui surveille ce qui est en lui. </p><br><h3 id="53-nuzhna-horoshaya-komanda-devops-chtoby-vsem-etim-upravlyat">  5.3 Vous avez besoin d'une bonne √©quipe DevOps pour tout g√©rer. </h3><br><p>  Presque n'importe quel d√©veloppeur peut d√©ployer un monolithe d'une mani√®re ou d'une autre et t√©l√©charger ses versions (par exemple, via FTP ou SSH, j'ai vu cela).  Mais avec les microservices, il existe toutes sortes de services centralis√©s pour collecter les journaux, les m√©triques, les tableaux de bord, les chefs pour g√©rer les configurations, les volts, les jenkins et d'autres bonnes choses, sans lesquelles vous pouvez g√©n√©ralement vivre - mais c'est mauvais et incompr√©hensible pourquoi.  Donc, pour g√©rer les microservices, vous devez avoir une bonne √©quipe DevOps. </p><br><h3 id="54-mozhno-popytatsya-slovit-hayp-i-vystrelit-sebe-v-nogu">  5.4 Vous pouvez essayer d'attraper un battage m√©diatique et de vous tirer une balle dans le pied. </h3><br><p>  C'est peut-√™tre le principal inconv√©nient de l'architecture et son danger.  Tr√®s souvent, les gens suivent aveugl√©ment les tendances et commencent √† introduire l'architecture et la technologie sans les comprendre.  Apr√®s quoi tout tombe, ils se confondent dans le g√¢chis qui en r√©sulte, et √©crivent un article sur le Habr "comment nous sommes pass√©s des microservices √† un monolithe", par exemple.  En g√©n√©ral, ne bougez que si vous savez pourquoi vous faites cela et quels probl√®mes vous allez r√©soudre.  Et lesquels vous obtenez. </p><br><h2 id="6-haki-v-monolite">  6 Kaki dans le monolithe </h2><br><p>  Certains des hacks qui nous ont permis de vivre dans un monolithe sont l√©g√®rement meilleurs et un peu plus longs. </p><br><h3 id="61-linting">  6.1 Peluches </h3><br><p>  L'introduction d'un linter dans un monolithe n'est pas une t√¢che aussi simple qu'il y para√Æt √† premi√®re vue.  Bien s√ªr, vous pouvez faire des r√®gles strictes, ajouter une config, et ... Rien ne changera, tout le monde d√©sactive simplement le linter, car la moiti√© du code devient rouge. </p><br><p>  Pour l'introduction progressive du linting, nous avons √©crit un module compl√©mentaire simple pour eslint - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">slowlint</a> , qui vous permet de faire une chose simple - pour contenir une liste de fichiers temporairement ignor√©s.  En cons√©quence: </p><br><ul><li>  Tout code incorrect est mis en √©vidence dans l'IDE </li><li>  De nouveaux fichiers sont cr√©√©s selon les r√®gles du peluchage, sinon CI ne les manquera pas </li><li>  Les anciens gouvernent progressivement et s'√©loignent des exceptions </li></ul><br><p>  Au cours de l'ann√©e, il a √©t√© possible de rassembler environ la moiti√© du code monolithique dans un seul style, c'est-√†-dire presque tout le code activement ajout√©. </p><br><h3 id="62-dorabotki-yunit-testov">  6.2 Am√©liorations des tests unitaires </h3><br><p>  Une fois les tests unitaires effectu√©s avec nous pendant trois minutes.  Les d√©veloppeurs ne voulaient pas attendre autant de temps, donc tout √©tait v√©rifi√© uniquement dans CI sur le serveur.  Apr√®s un certain temps, le d√©veloppeur a d√©couvert que les tests √©taient tomb√©s, maudits, ouvert une branche, retourn√© au code ... En g√©n√©ral, il a souffert.  Qu'avons-nous fait avec √ßa: </p><br><ol><li>  Pour commencer, nous avons commenc√© √† ex√©cuter des tests multithread.  Yandex a une variante du moka multi-thread, mais avec nous, cela n'a pas d√©coll√©, alors ils ont eux-m√™mes √©crit un simple wrapper.  Les tests ont commenc√© √† √™tre effectu√©s une fois et demie plus rapidement. </li><li>  Ensuite, nous sommes pass√©s de 0,12 n≈ìuds au 8e (oui, le processus lui-m√™me dessine dans un rapport s√©par√©).  Aussi √©trange que cela puisse para√Ætre, cela n'a pas donn√© un gain fondamental de productivit√© sur la production, mais les tests ont commenc√© √† √™tre effectu√©s 20% plus rapidement. </li><li>  Et puis nous nous sommes assis pour d√©boguer les tests et les optimiser individuellement.  Ce qui a donn√© la plus grande augmentation de vitesse. </li></ol><br><p>  En g√©n√©ral, √† l'heure actuelle, les tests unitaires s'ex√©cutent dans le crochet de pr√©paration et fonctionnent en 10 secondes, ce qui est assez confortable et vous permet de les ex√©cuter sans interruption de la production. </p><br><h3 id="63--oblegchenie-vesa-artefakta">  6.3 All√©ger le poids de l'artefact </h3><br><p>  L'artefact monolithique a finalement pris 400 m√©gaoctets.  Compte tenu du fait qu'il est cr√©√© pour chaque commit, le volume total s'est av√©r√© assez important.  Le module de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diarrh√©e</a> , une fourchette du module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modclean</a> , nous a aid√© avec cela.  Nous avons supprim√© les tests unitaires de l'artefact et l'avons nettoy√© de divers d√©chets tels que les fichiers Lisez-moi, les tests √† l'int√©rieur des packages, etc.  Le gain √©tait d'environ 30% du poids! </p><br><h3 id="64--keshirovanie-zavisimostey">  6.4 Mise en cache des d√©pendances </h3><br><p>  Auparavant, l'installation de d√©pendances √† l'aide de npm prenait tellement de temps que vous pouviez non seulement boire du caf√©, mais aussi, par exemple, cuire des pizzas.  Par cons√©quent, au d√©but, nous avons utilis√© le module <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npm-cache</a> , qui √©tait fourchu et un peu termin√©.  Il vous a permis de stocker des d√©pendances sur un lecteur r√©seau partag√©, √† partir duquel toutes les autres g√©n√©rations le prendraient ensuite. </p><br><p>  Nous avons ensuite r√©fl√©chi √† la reproductibilit√© des assemblages.  Lorsque vous avez un monolithe, le changement des d√©pendances transitives est le fl√©au de Dieu.  √âtant donn√© que nous √©tions tr√®s en retard sur la version du moteur √† ce moment-l√†, la modification d'une d√©pendance de cinqui√®me niveau a facilement cass√© tout notre ensemble.  Nous avons donc commenc√© √† utiliser npm-shrinkwrap.  C'√©tait d√©j√† plus facile avec lui, m√™me si la fusion de ses changements √©tait un plaisir pour les forts d'esprit. </p><br><p> Et puis package-lock et l'excellente commande <code>npm ci</code> finalement apparus - qui fonctionnaient √† une vitesse l√©g√®rement inf√©rieure √† celle de l'installation des d√©pendances √† partir du cache de fichiers.  Par cons√©quent, nous avons commenc√© √† l'utiliser uniquement et avons cess√© de stocker des assemblys de d√©pendances.  Ce jour-l√†, j'ai apport√© au travail plusieurs bo√Ætes de beignets. </p><br><h3 id="65--raspredelenie-ocheryodnosti-relizov">  6.5 Distribution de l'ordre des sorties. </h3><br><p>  Et c'est plus un hack administratif, pas technique.  Au d√©part, j'√©tais contre lui, mais le temps a montr√© que le deuxi√®me expert technique avait raison et √©tait g√©n√©ralement bien fait.  Lorsque les versions ont √©t√© distribu√©es √† tour de r√¥le entre plusieurs √©quipes, il est devenu clair o√π exactement les erreurs sont apparues, et plus important encore, chaque √©quipe a senti sa responsabilit√© en mati√®re de vitesse et a essay√© de r√©soudre les probl√®mes et de les d√©ployer le plus rapidement possible. </p><br><h3 id="66-udalenie-myortvogo-koda">  6.6 Suppression du code mort </h3><br><p>  Dans un monolithe, il est tr√®s effrayant de supprimer le code - vous ne savez jamais o√π vous pourriez vous y retrouver.  Par cons√©quent, le plus souvent, il ne reste plus qu'√† s'allonger sur le c√¥t√©.  Au fil des ans.  Et m√™me le code mort doit √™tre pris en charge, sans parler de la confusion qu'il introduit.  Par cons√©quent, au fil du temps, nous avons commenc√© √† utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">require-analyse</a> pour une recherche superficielle de code mort, et des tests d'int√©gration plus le lancement en mode de v√©rification de couverture pour une recherche plus approfondie. </p><br><h2 id="7-raspil-monolita">  7 Coupe monolithe </h2><br><p>  Pour une raison quelconque, beaucoup de gens pensent que pour passer aux microservices, vous devez abandonner votre monolithe, √©crire un tas de microservices pr√®s de z√©ro, l'ex√©cuter tout √† la fois - et il y aura du bonheur.  Mais ce mod√®le ... Hmm ... Il est lourd du fait que vous ne ferez rien et que vous passerez juste beaucoup de temps et d'argent √† √©crire du code que vous devrez jeter. </p><br><p>  Je propose une autre option, qui me semble plus fonctionnelle, et qui a √©t√© mise en place avec nous: </p><br><ol><li>  Nous commen√ßons √† √©crire de nouveaux services dans les microservices.  Nous g√©rons la technologie, sautons sur le r√¢teau, nous comprenons si nous voulons le faire du tout. </li><li>  Nous extrayons le code dans des modules, des biblioth√®ques ou tout ce qui y est utilis√©. </li><li>  Nous distinguons les services d'un monolithe. </li><li>  Nous distinguons les microservices des services.  Sans h√¢te et un √† la fois. </li></ol><br><h2 id="8-i-naposledok">  8 Et enfin </h2><br><p><img src="https://habrastorage.org/webt/z8/tl/cv/z8tlcv6aibivr83m9q-fxzhusay.png" alt="prix photo √† partir de https://fvl1-01.livejournal.com/"></p><br><p>  Finalement, j'ai d√©cid√© de laisser la chose la plus importante. </p><br><p>  N'oubliez pas: </p><br><ul><li>  Vous n'√™tes pas google </li><li>  Vous n'√™tes pas Microsoft </li><li>  Tu n'es pas facebook </li><li>  Vous n'√™tes pas Yandex </li><li>  Vous n'√™tes pas netflix </li><li>  Vous n'√™tes pas OneTwoTrip </li></ul><br><p>  Si quelque chose fonctionne dans d'autres entreprises, ce n'est absolument pas un fait que cela vous sera b√©n√©fique.  Si vous essayez de copier aveugl√©ment l'exp√©rience d'autres entreprises avec les mots ¬´√ßa marche pour eux¬ª, cela se terminera tr√®s probablement mal.  Chaque entreprise, chaque produit et chaque √©quipe est unique.  Ce qui fonctionne pour certains ne fonctionnera pas pour d'autres.  Je n'aime pas dire des choses √©videntes, mais trop de gens commencent √† construire un culte du fret autour d'autres entreprises, copiant aveugl√©ment les approches, et s'enterrent sous de fausses d√©corations pour arbres de No√´l.  Ne le faites pas.  Exp√©rimentez, essayez, d√©veloppez les solutions qui vous conviennent le mieux.  Et alors seulement, tout ira bien. </p><br><h2 id="poleznye-ssylki">  Liens utiles: </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mon reportage</a> au format vid√©o </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste de lecture compl√®te</a> de mitap par Node.JS </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr459206/">https://habr.com/ru/post/fr459206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr459188/index.html">Publication de Debian 10 Buster et Linux 5.2</a></li>
<li><a href="../fr459194/index.html">Comment nous avons fait des amis SCSS avec les variables CSS en utilisant le th√®me du kit d'interface utilisateur</a></li>
<li><a href="../fr459196/index.html">Des monolithes aux √©quipes modulaires</a></li>
<li><a href="../fr459198/index.html">Analyse des performances des requ√™tes dans ClickHouse. Rapport Yandex</a></li>
<li><a href="../fr459204/index.html">10 ++ fa√ßons de travailler avec les registres mat√©riels en C ++ (par exemple, IAR et Cortex M)</a></li>
<li><a href="../fr459208/index.html">Courir avec des proth√®ses: simulation de Nekstgen du mouvement humain √† l'aide de muscles, d'os et d'un r√©seau neuronal</a></li>
<li><a href="../fr459212/index.html">Impl√©mentation de propri√©t√© en C ++</a></li>
<li><a href="../fr459214/index.html">Tol√©rance aux pannes dans le stockage Qsan</a></li>
<li><a href="../fr459216/index.html">Structure de donn√©es de l'arbre B</a></li>
<li><a href="../fr459220/index.html">Test d'int√©gration pour v√©rifier les fuites de m√©moire</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>