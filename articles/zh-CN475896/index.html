<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¾â€âš–ï¸ ğŸ¤½ğŸ¿ ğŸ§•ğŸ¼ å…¨I / Oè£¸Cååº”å™¨ ğŸ‘¼ğŸ½ ğŸ‘²ğŸ» ğŸ¥“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 


 I / Oååº”å™¨ ï¼ˆå•çº¿ç¨‹äº‹ä»¶å¾ªç¯ ï¼‰æ˜¯ä¸€ç§æ¨¡å¼ï¼Œç”¨äºç¼–å†™åœ¨è®¸å¤šæµè¡Œçš„è§£å†³æ–¹æ¡ˆä¸­ä½¿ç”¨çš„é«˜è´Ÿè½½è½¯ä»¶ï¼š 


- Node.js 
- æ‰˜å°” 
- ä¼ è¾“æ–¹å¼ 
- é“¬è‰² 
- è®°å¿†å¿«å– 
- ... 


 åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘I / Oååº”å™¨çš„æ¥é¾™å»è„‰åŠå…¶æ“ä½œåŸç†ï¼Œç¼–å†™å°‘äº200è¡Œä»£ç çš„...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å…¨I / Oè£¸Cååº”å™¨</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475896/"><p><img src="https://habrastorage.org/webt/2g/w7/vr/2gw7vrlwgzkro-gf3hkbj7jxqzu.png"></p><br><h1 id="vvedenie"> å¼•è¨€ </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">I / Oååº”å™¨</a> ï¼ˆå•çº¿ç¨‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">äº‹ä»¶å¾ªç¯</a> ï¼‰æ˜¯ä¸€ç§æ¨¡å¼ï¼Œç”¨äºç¼–å†™åœ¨è®¸å¤šæµè¡Œçš„è§£å†³æ–¹æ¡ˆä¸­ä½¿ç”¨çš„é«˜è´Ÿè½½è½¯ä»¶ï¼š </p><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Node.js</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ‰˜å°”</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä¼ è¾“æ–¹å¼</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">é“¬è‰²</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è®°å¿†å¿«å–</a> </li><li>  ... </li></ul><br><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è€ƒè™‘I / Oååº”å™¨çš„æ¥é¾™å»è„‰åŠå…¶æ“ä½œåŸç†ï¼Œç¼–å†™å°‘äº200è¡Œä»£ç çš„å®ç°ï¼Œå¹¶å¼ºåˆ¶ä¸€ä¸ªç®€å•çš„HTTPæœåŠ¡å™¨æ¯åˆ†é’Ÿå¤„ç†è¶…è¿‡4000ä¸‡ä¸ªè¯·æ±‚ã€‚ </p><a name="habracut"></a><br><h1 id="predislovie"> å‰è¨€ </h1><br><ul><li> æ’°å†™æœ¬æ–‡çš„ç›®çš„æ˜¯å¸®åŠ©ç†è§£I / Oååº”å™¨çš„åŠŸèƒ½ï¼Œä»è€Œè®¤è¯†ä½¿ç”¨I / Oååº”å™¨çš„é£é™©ã€‚ </li><li> è¦æŒæ¡æœ¬æ–‡ï¼Œæ‚¨éœ€è¦äº†è§£<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Cè¯­è¨€</a>çš„åŸºç¡€çŸ¥è¯†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ï¼Œ</a>å¹¶ä¸”éœ€è¦å¾ˆå°‘çš„å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºçš„ç»éªŒã€‚ </li><li> æ‰€æœ‰ä»£ç å‡ç”±Cï¼ˆä¸¥æ ¼<strong>åœ°ä¸ºé•¿PDF</strong> ï¼‰ä¸¥æ ¼åœ°ç”¨Cç¼–å†™çš„Linux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">C11æ ‡å‡†</a> ï¼Œå¹¶ä¸”å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">GitHubä¸Šè·å¾—</a> ã€‚ </li></ul><br><h1 id="zachem-eto-nuzhno"> ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªï¼Ÿ </h1><br><p> éšç€Internetçš„æ—¥ç›Šæ™®åŠï¼ŒWebæœåŠ¡å™¨éœ€è¦åŒæ—¶å¤„ç†å¤§é‡è¿æ¥ï¼Œå› æ­¤å°è¯•äº†ä¸¤ç§æ–¹æ³•ï¼šé˜»æ­¢å¤§é‡OSçº¿ç¨‹ä¸Šçš„I / Oå’Œä¸äº‹ä»¶é€šçŸ¥ç³»ç»Ÿï¼ˆä¹Ÿç§°ä¸ºâ€œç³»ç»Ÿâ€ï¼‰ç»„åˆä½¿ç”¨éé˜»æ­¢I / Oã€‚é€‰æ‹©å™¨â€ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">epoll</a> / <a href="" rel="nofollow">kqueue</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">IOCP</a>ç­‰ï¼‰ã€‚ </p><br><p> ç¬¬ä¸€ç§æ–¹æ³•æ¶‰åŠä¸ºæ¯ä¸ªä¼ å…¥è¿æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„OSçº¿ç¨‹ã€‚ å®ƒçš„ç¼ºç‚¹æ˜¯å¯ä¼¸ç¼©æ€§å·®ï¼šæ“ä½œç³»ç»Ÿå°†ä¸å¾—ä¸è¿›è¡Œè®¸å¤š<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä¸Šä¸‹æ–‡è½¬æ¢</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç³»ç»Ÿè°ƒç”¨</a> ã€‚ å®ƒä»¬æ˜¯æ˜‚è´µçš„æ“ä½œï¼Œå¹¶ä¸”ä¼šå¯¼è‡´å¤§é‡è¿æ¥å¯¼è‡´ç¼ºå°‘å¯ç”¨RAMã€‚ </p><br><p> ä¿®æ”¹åçš„ç‰ˆæœ¬åˆ†é…äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å›ºå®šæ•°é‡çš„çº¿ç¨‹</a> ï¼ˆçº¿ç¨‹æ± ï¼‰ï¼Œä»è€Œé˜²æ­¢äº†ç³»ç»Ÿå¼‚å¸¸åœæ­¢æ‰§è¡Œï¼Œä½†æ˜¯åŒæ—¶å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šå¦‚æœåœ¨ç»™å®šçš„æ—¶åˆ»çº¿ç¨‹æ± è¢«é•¿æ—¶é—´çš„è¯»å–æ“ä½œé˜»å¡ï¼Œé‚£ä¹ˆå…¶ä»–å·²ç»èƒ½å¤Ÿæ¥æ”¶æ•°æ®çš„å¥—æ¥å­—å°†æ— æ³•æ‰§è¡Œæ­¤æ“ä½œã€‚ </p><br><p> ç¬¬äºŒç§æ–¹æ³•ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">çš„äº‹ä»¶é€šçŸ¥ç³»ç»Ÿ</a> ï¼ˆç³»ç»Ÿé€‰æ‹©å™¨ï¼‰ã€‚ æœ¬æ–‡æ ¹æ®æœ‰å…³I / Oæ“ä½œå‡†å¤‡å°±ç»ªçš„è­¦æŠ¥ï¼ˆäº‹ä»¶ï¼Œé€šçŸ¥ï¼‰ï¼Œè€Œä¸æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æœ‰å…³å…¶å®Œæˆæƒ…å†µçš„è­¦æŠ¥</a> ï¼Œè®¨è®ºæœ€å¸¸è§çš„ç³»ç»Ÿé€‰æ‹©å™¨ç±»å‹ã€‚ ä¸‹é¢çš„æµç¨‹å›¾å¯ä»¥è¡¨ç¤ºå…¶ç”¨æ³•çš„ç®€åŒ–ç¤ºä¾‹ï¼š </p><br><p><img src="https://habrastorage.org/webt/rw/kb/yo/rwkbyokmirpu7hpd6yzc47-k4va.png"></p><br><p> è¿™äº›æ–¹æ³•ä¹‹é—´çš„åŒºåˆ«å¦‚ä¸‹ï¼š </p><br><ul><li> é˜»å¡çš„I / Oæ“ä½œä¼š<strong>æŒ‚èµ·</strong>ç”¨æˆ·æµï¼Œ <strong>ç›´åˆ°</strong>æ“ä½œç³»ç»Ÿ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å°†</a>è¿›å…¥çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">IPæ•°æ®åŒ…</a>æ­£ç¡®<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ•´ç†</a>åˆ°å­—èŠ‚æµï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">TCP</a> ï¼Œæ¥æ”¶æ•°æ®ï¼‰æˆ–é‡Šæ”¾å†…éƒ¨å†™ç¼“å†²åŒºä¸­çš„è¶³å¤Ÿç©ºé—´ï¼Œä»¥ä¾¿éšåé€šè¿‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">NIC</a>å‘é€ï¼ˆå‘é€æ•°æ®ï¼‰ä¸ºæ­¢ã€‚ </li><li>  <strong>ç¨åï¼Œ</strong>ç³»ç»Ÿé€‰æ‹©å™¨ä¼šé€šçŸ¥ç¨‹åºOS <strong>å·²å¯¹</strong> IPæ•°æ®åŒ…è¿›è¡Œç¢ç‰‡æ•´ç†ï¼ˆTCPï¼Œæ­£åœ¨æ¥æ”¶æ•°æ®ï¼‰æˆ–å†…éƒ¨è®°å½•ç¼“å†²åŒºä¸­çš„è¶³å¤Ÿç©ºé—´ï¼ˆå‘é€æ•°æ®ï¼‰ã€‚ </li></ul><br><p> æ€»è€Œè¨€ä¹‹ï¼Œä¸ºæ¯ä¸ªI / Oä¿ç•™OSçº¿ç¨‹æ˜¯åœ¨æµªè´¹è®¡ç®—èƒ½åŠ›ï¼Œå› ä¸ºå®é™…ä¸Šï¼Œçº¿ç¨‹å¹¶ä¸å¿™äºæœ‰ç”¨çš„å·¥ä½œï¼ˆæœ¯è¯­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">â€œè½¯ä»¶ä¸­æ–­â€</a>æ¤æ ¹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">äºå…¶ä¸­</a> ï¼‰ã€‚ ç³»ç»Ÿé€‰æ‹©å™¨é€šè¿‡å…è®¸ç”¨æˆ·ç¨‹åºæ›´ç»æµåœ°æ¶ˆè€—CPUèµ„æºæ¥è§£å†³æ­¤é—®é¢˜ã€‚ </p><br><h1 id="model-io-reaktora"> ååº”å †I / Oå‹å· </h1><br><p>  I / Oååº”å™¨å……å½“ç³»ç»Ÿé€‰æ‹©å™¨å’Œç”¨æˆ·ä»£ç ä¹‹é—´çš„ä¸€å±‚ã€‚ ä¸‹é¢çš„æµç¨‹å›¾æè¿°äº†å…¶æ“ä½œåŸç†ï¼š </p><br><p><img src="https://habrastorage.org/webt/6j/v9/-m/6jv9-mplsvirwimvaej1zzyu2oa.png"></p><br><ul><li> è®©æˆ‘æé†’æ‚¨ï¼Œäº‹ä»¶æ˜¯å¯¹æŸä¸ªå¥—æ¥å­—èƒ½å¤Ÿæ‰§è¡Œéé˜»å¡I / Oæ“ä½œçš„é€šçŸ¥ã€‚ </li><li> äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯æ¥æ”¶åˆ°äº‹ä»¶åç”±I / Oååº”å™¨è°ƒç”¨çš„å‡½æ•°ï¼Œç„¶åè¯¥å‡½æ•°æ‰§è¡Œæ— é˜»å¡çš„I / Oæ“ä½œã€‚ </li></ul><br><p> é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œæ ¹æ®å®šä¹‰ï¼ŒI / Oååº”å™¨æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†æ˜¯æ²¡æœ‰ä»€ä¹ˆå¯ä»¥é˜»æ­¢åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­é’ˆå¯¹1ä¸ªæµï¼š1ä¸ªååº”å™¨ä½¿ç”¨æ­¤æ¦‚å¿µï¼Œä»è€Œåˆ©ç”¨äº†æ‰€æœ‰CPUå†…æ ¸ã€‚ </p><br><h1 id="realizaciya"> å®ä½œ </h1><br><p>æˆ‘ä»¬å°†å…¬å…±æ¥å£æ”¾åœ¨<a href="" rel="nofollow"><code>reactor.h</code></a>æ–‡ä»¶ä¸­ï¼Œå¹¶å°†å®ç°æ”¾åœ¨ååº”å™¨<a href="" rel="nofollow"><code>reactor.c</code></a> ã€‚  <code>reactor.h</code>å°†åŒ…å«ä»¥ä¸‹å£°æ˜ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">åœ¨reactor.hä¸­æ˜¾ç¤ºå¹¿å‘Š</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reactor</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Reactor</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-comment"><span class="hljs-comment">/* *   ,    I/O    *    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*Callback)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *  `NULL`   , -`NULL`   `Reactor`  *  . */</span></span> <span class="hljs-function"><span class="hljs-function">Reactor *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_new</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *   ,       *    I/O . * *    -1   , 0   . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_destroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Reactor *reactor)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_register</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Reactor *reactor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> interest, Callback callback, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *callback_arg)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_deregister</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Reactor *reactor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_reregister</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Reactor *reactor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> interest, Callback callback, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *callback_arg)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *     - `timeout`. * *           * /    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Reactor *reactor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">time_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout)</span></span></span></span>;</code> </pre> </div></div><br><p> ååº”å™¨çš„I / Oç»“æ„ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">epoll</a>é€‰æ‹©å™¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ–‡ä»¶æè¿°ç¬¦</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>GHashTable</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å“ˆå¸Œè¡¨ç»„æˆ</a> ï¼Œæ¯ä¸ªå¥—æ¥å­—éƒ½å°†å…¶æ˜ å°„åˆ°<code>CallbackData</code> ï¼ˆäº‹ä»¶å¤„ç†ç¨‹åºçš„ç»“æ„å’Œç”¨æˆ·å‚æ•°ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºReactorå’ŒCallbackData</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">reactor</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> epoll_fd; GHashTable *table; <span class="hljs-comment"><span class="hljs-comment">// (int, CallbackData) }; typedef struct { Callback callback; void *arg; } CallbackData;</span></span></code> </pre> </div></div><br><p> è¯·æ³¨æ„ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†é€šè¿‡æŒ‡é’ˆå¤„ç†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä¸å®Œæ•´ç±»å‹</a>çš„åŠŸèƒ½ã€‚ åœ¨<code>reactor.h</code>æˆ‘ä»¬å£°æ˜äº†<code>reactor</code>çš„ç»“æ„ï¼Œåœ¨<code>reactor.c</code>å®šä¹‰äº†å®ƒçš„ç»“æ„ï¼Œä»è€Œé˜²æ­¢äº†ç”¨æˆ·æ˜¾å¼æ›´æ”¹å…¶å­—æ®µã€‚ è¿™æ˜¯æœ‰æœºåœ°é€‚åˆCè¯­ä¹‰çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ•°æ®éšè—</a>æ¨¡å¼ä¹‹ä¸€ã€‚ </p><br><p>  <code>reactor_register</code> ï¼Œ <code>reactor_deregister</code>å’Œ<code>reactor_reregister</code>æ›´æ–°ç›®æ ‡é€‰æ‹©å™¨çš„åˆ—è¡¨ä»¥åŠç³»ç»Ÿé€‰æ‹©å™¨å’Œå“ˆå¸Œè¡¨ä¸­çš„ç›¸åº”äº‹ä»¶å¤„ç†ç¨‹åºã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºæ³¨å†ŒåŠŸèƒ½</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> REACTOR_CTL(reactor, op, fd, interest) \ </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (epoll_ctl(reactor-&gt;epoll_fd, op, fd, \ &amp;(struct epoll_event){.events = interest, \ .data = {.fd = fd}}) == -1) { \ perror(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"epoll_ctl"</span></span></span><span class="hljs-meta">); \ return -1; \ } int reactor_register(const Reactor *reactor, int fd, uint32_t interest, Callback callback, void *callback_arg) { REACTOR_CTL(reactor, EPOLL_CTL_ADD, fd, interest) g_hash_table_insert(reactor-&gt;table, int_in_heap(fd), callback_data_new(callback, callback_arg)); return 0; } int reactor_deregister(const Reactor *reactor, int fd) { REACTOR_CTL(reactor, EPOLL_CTL_DEL, fd, 0) g_hash_table_remove(reactor-&gt;table, &amp;fd); return 0; } int reactor_reregister(const Reactor *reactor, int fd, uint32_t interest, Callback callback, void *callback_arg) { REACTOR_CTL(reactor, EPOLL_CTL_MOD, fd, interest) g_hash_table_insert(reactor-&gt;table, int_in_heap(fd), callback_data_new(callback, callback_arg)); return 0; }</span></span></code> </pre> </div></div><br><p>  I / Oååº”å™¨ä½¿ç”¨<code>fd</code>æè¿°ç¬¦æ‹¦æˆªäº‹ä»¶åï¼Œå°†è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†ç¨‹åºï¼Œå°†<code>fd</code> ï¼Œç”Ÿæˆçš„äº‹ä»¶çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä½æ©ç </a>ä»¥åŠæŒ‡å‘<code>void</code>çš„ç”¨æˆ·æŒ‡é’ˆä¼ é€’åˆ°è¯¥äº‹ä»¶å¤„ç†ç¨‹åºä¸­ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºreactor_runï¼ˆï¼‰å‡½æ•°</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reactor_run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Reactor *reactor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">time_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> timeout)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">epoll_event</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">events</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((events = <span class="hljs-built_in"><span class="hljs-built_in">calloc</span></span>(MAX_EVENTS, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*events))) == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">abort</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> start = time(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span> passed = time(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) - start; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nfds = epoll_wait(reactor-&gt;epoll_fd, events, MAX_EVENTS, timeout - passed); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (nfds) { <span class="hljs-comment"><span class="hljs-comment">//  case -1: perror("epoll_wait"); result = -1; goto cleanup; //   case 0: result = 0; goto cleanup; //   default: //    for (int i = 0; i &lt; nfds; i++) { int fd = events[i].data.fd; CallbackData *callback = g_hash_table_lookup(reactor-&gt;table, &amp;fd); callback-&gt;callback(callback-&gt;arg, fd, events[i].events); } } } cleanup: free(events); return result; }</span></span></code> </pre> </div></div><br><p> æ€»è€Œè¨€ä¹‹ï¼Œç”¨æˆ·ä»£ç ä¸­çš„å‡½æ•°è°ƒç”¨é“¾å°†é‡‡ç”¨ä»¥ä¸‹å½¢å¼ï¼š </p><br><p><img src="https://habrastorage.org/webt/5r/zj/wu/5rzjwuyiu4e3f-wfvtumltvuz3i.png"></p><br><h1 id="odnopotochnyy-server"> å•çº¿ç¨‹æœåŠ¡å™¨ </h1><br><p> ä¸ºäº†æµ‹è¯•é«˜è´Ÿè½½ä¸‹çš„I / Oååº”å™¨ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªç®€å•çš„HTTP WebæœåŠ¡å™¨æ¥å“åº”å¸¦æœ‰å›¾åƒçš„ä»»ä½•è¯·æ±‚ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">HTTPåè®®å¿«é€Ÿå‚è€ƒ</b> <div class="spoiler_text"><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">HTTP</a>æ˜¯ä¸€ç§<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åº”ç”¨ç¨‹åºçº§</a>åè®®ï¼Œä¸»è¦ç”¨äºæœåŠ¡å™¨ä¸æµè§ˆå™¨çš„äº¤äº’ã€‚ </p><br><p>  HTTPå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">TCP</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä¼ è¾“</a>åè®®ä¹‹ä¸Šä½¿ç”¨ï¼Œå‘é€å’Œæ¥æ”¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è§„èŒƒ</a>å®šä¹‰çš„æ ¼å¼çš„æ¶ˆæ¯ã€‚ </p><br><h3 id="format-zaprosa"> è¦æ±‚æ ¼å¼ </h3><br><pre> <code class="plaintext hljs">&lt;&gt; &lt;URI&gt; &lt; HTTP&gt;CRLF &lt; 1&gt;CRLF &lt; 2&gt;CRLF &lt; N&gt;CRLF CRLF &lt;&gt;</code> </pre> <br><ul><li>  <code>CRLF</code>æ˜¯ä¸¤ä¸ªå­—ç¬¦çš„åºåˆ—ï¼š <code>\r</code>å’Œ<code>\n</code> ï¼Œåˆ†éš”æŸ¥è¯¢çš„ç¬¬ä¸€è¡Œï¼Œæ ‡å¤´å’Œæ•°æ®ã€‚ </li><li>  <code>&lt;&gt;</code>æ˜¯<code>CONNECT</code> ï¼Œ <code>DELETE</code> ï¼Œ <code>GET</code> ï¼Œ <code>HEAD</code> ï¼Œ <code>OPTIONS</code> ï¼Œ <code>PATCH</code> ï¼Œ <code>POST</code> ï¼Œ <code>PUT</code> ï¼Œ <code>TRACE</code> ã€‚ æµè§ˆå™¨å°†å‘æˆ‘ä»¬çš„æœåŠ¡å™¨å‘é€<code>GET</code>å‘½ä»¤ï¼Œæ„æ€æ˜¯â€œå‘æˆ‘å‘é€æ–‡ä»¶å†…å®¹â€ã€‚ </li><li>  <code>&lt;URI&gt;</code>æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦</a> ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœURI = <code>/index.html</code> ï¼Œåˆ™å®¢æˆ·ç«¯å°†è¯·æ±‚ç½‘ç«™çš„ä¸»é¡µã€‚ </li><li>  <code>&lt; HTTP&gt;</code> -HTTPåè®®ç‰ˆæœ¬ï¼Œ <code>HTTP/XY</code>æ ¼å¼ã€‚ è¿„ä»Šä¸ºæ­¢ï¼Œæœ€å¸¸ç”¨çš„ç‰ˆæœ¬æ˜¯<code>HTTP/1.1</code> ã€‚ </li><li>  <code>&lt; N&gt;</code>æ˜¯æ ¼å¼ä¸º<code>&lt;&gt;: &lt;&gt;</code>çš„é”®å€¼å¯¹ï¼Œå·²å‘é€åˆ°æœåŠ¡å™¨ä»¥è¿›è¡Œè¿›ä¸€æ­¥åˆ†æã€‚ </li><li>  <code>&lt;&gt;</code> -æœåŠ¡å™¨å®Œæˆæ“ä½œæ‰€éœ€çš„æ•°æ®ã€‚ é€šå¸¸å®ƒåªæ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">JSON</a>æˆ–ä»»ä½•å…¶ä»–æ ¼å¼ã€‚ </li></ul><br><h3 id="format-otveta"> å›åº”æ ¼å¼ </h3><br><pre> <code class="plaintext hljs">&lt; HTTP&gt; &lt; &gt; &lt; &gt;CRLF &lt; 1&gt;CRLF &lt; 2&gt;CRLF &lt; N&gt;CRLF CRLF &lt;&gt;</code> </pre> <br><ul><li>  <code>&lt; &gt;</code>æ˜¯è¡¨ç¤ºæ“ä½œç»“æœçš„æ•°å­—ã€‚ æˆ‘ä»¬çš„æœåŠ¡å™¨å°†å§‹ç»ˆè¿”å›çŠ¶æ€200ï¼ˆæˆåŠŸæ“ä½œï¼‰ã€‚ </li><li>  <code>&lt; &gt;</code> -çŠ¶æ€ä»£ç çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ å¯¹äºçŠ¶æ€ç 200ï¼Œè¿™<code>OK</code> ã€‚ </li><li>  <code>&lt; N&gt;</code> -ä¸è¯·æ±‚ä¸­çš„æ ¼å¼ç›¸åŒçš„æ ‡å¤´ã€‚ æˆ‘ä»¬å°†è¿”å›<code>Content-Length</code> ï¼ˆæ–‡ä»¶å¤§å°ï¼‰å’Œ<code>Content-Type: text/html</code> ï¼ˆè¿”å›ç±»å‹æ•°æ®ï¼‰æ ‡é¢˜ã€‚ </li><li>  <code>&lt;&gt;</code> -ç”¨æˆ·è¯·æ±‚çš„æ•°æ®ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">HTMLä¸­</a>å›¾åƒçš„è·¯å¾„ã€‚ </li></ul></div></div><br><p>  <a href="https://github.com/Hippolot/reactor-c/blob/master/" rel="nofollow"><code>http_server.c</code></a> ï¼ˆå•çº¿ç¨‹æœåŠ¡å™¨ï¼‰æ–‡ä»¶åŒ…æ‹¬<a href="" rel="nofollow"><code>common.h</code></a>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶åŒ…å«ä»¥ä¸‹å‡½æ•°åŸå‹ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºcommon.hä¸­çš„å‡½æ•°åŸå‹</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* *  ,    ,    *    . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *  ,    ,    *   HTTP . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *  ,    ,    *    HTTP . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_recv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *      . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_nonblocking</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *     stderr      *  `EXIT_FAILURE`. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> noreturn </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *format, ...)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *    ,    * TCP . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_server</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reuse_port)</span></span></span></span>;</code> </pre> </div></div><br><p> è¿˜æè¿°äº†å‡½æ•°å®<code>SAFE_CALL()</code>å¹¶å®šä¹‰äº†<code>fail()</code>å‡½æ•°ã€‚ å®å°†è¡¨è¾¾å¼çš„å€¼ä¸é”™è¯¯è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶ï¼Œå®ƒå°†è°ƒç”¨<code>fail()</code>å‡½æ•°ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SAFE_CALL(call, </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">) \ do { \ </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((call) == </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">) { \ fail(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s"</span></span></span><span class="hljs-meta">, #call); \ } \ } while (false)</span></span></code> </pre> <br><p>  <code>fail()</code>å‡½æ•°å°†ä¼ é€’çš„å‚æ•°æ‰“å°åˆ°ç»ˆç«¯ï¼ˆä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>printf()</code></a> ï¼‰ï¼Œå¹¶ä½¿ç”¨<code>EXIT_FAILURE</code>ä»£ç ç»ˆæ­¢ç¨‹åºï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> noreturn </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *format, ...)</span></span></span><span class="hljs-function"> </span></span>{ va_list args; va_start(args, format); <span class="hljs-built_in"><span class="hljs-built_in">vfprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>, format, args); va_end(args); <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">stderr</span></span>, <span class="hljs-string"><span class="hljs-string">": %s\n"</span></span>, strerror(errno)); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(EXIT_FAILURE); }</code> </pre> <br><p>  <code>new_server()</code>å‡½æ•°è¿”å›ç³»ç»Ÿè°ƒç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>socket()</code></a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>bind()</code></a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>listen()</code></a>åˆ›å»ºçš„â€œæœåŠ¡å™¨â€å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶èƒ½å¤Ÿä»¥éé˜»å¡æ¨¡å¼æ¥å—ä¼ å…¥çš„è¿æ¥ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºå‡½æ•°new_serverï¼ˆï¼‰</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_server</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reuse_port)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd; SAFE_CALL((fd = socket(AF_INET, SOCK_STREAM | SOCK_NONBLOCK, IPPROTO_TCP)), <span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (reuse_port) { SAFE_CALL( setsockopt(fd, SOL_SOCKET, SO_REUSEPORT, &amp;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>){<span class="hljs-number"><span class="hljs-number">1</span></span>}, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)), <span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sockaddr_in</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">addr</span></span></span><span class="hljs-class"> = {</span></span>.sin_family = AF_INET, .sin_port = htons(SERVER_PORT), .sin_addr = {.s_addr = inet_addr(SERVER_IPV4)}, .sin_zero = {<span class="hljs-number"><span class="hljs-number">0</span></span>}}; SAFE_CALL(bind(fd, (struct sockaddr *)&amp;addr, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(addr)), <span class="hljs-number"><span class="hljs-number">-1</span></span>); SAFE_CALL(listen(fd, SERVER_BACKLOG), <span class="hljs-number"><span class="hljs-number">-1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fd; }</code> </pre> </div></div><br><ul><li> è¯·æ³¨æ„ï¼Œå¥—æ¥å­—æœ€åˆæ˜¯ä½¿ç”¨<code>SOCK_NONBLOCK</code>æ ‡å¿—ä»¥éé˜»å¡æ¨¡å¼åˆ›å»ºçš„ï¼Œå› æ­¤åœ¨<code>on_accept()</code>å‡½æ•°ï¼ˆäº†è§£æ›´å¤šï¼‰ä¸­ï¼Œ <code>accept()</code>ç³»ç»Ÿè°ƒç”¨ä¸ä¼šåœæ­¢æµçš„æ‰§è¡Œã€‚ </li><li> å¦‚æœ<code>reuse_port</code>ä¸º<code>true</code> ï¼Œåˆ™æ­¤å‡½æ•°å°†ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>setsockopt()</code></a>ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>SO_REUSEPORT</code></a>é€‰é¡¹é…ç½®å¥—æ¥å­—ï¼Œä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„ç«¯å£ï¼ˆè¯·å‚é˜…â€œå¤šçº¿ç¨‹æœåŠ¡å™¨â€ä¸€èŠ‚ï¼‰ã€‚ </li></ul><br><p> åœ¨æ“ä½œç³»ç»Ÿç”Ÿæˆ<code>EPOLLIN</code>äº‹ä»¶ä¹‹åï¼Œå°†è°ƒç”¨<code>on_accept()</code>äº‹ä»¶å¤„ç†ç¨‹åºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€å¯ä»¥æ¥å—æ–°çš„è¿æ¥ã€‚  <code>on_accept()</code>æ¥å—ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œå°†å…¶åˆ‡æ¢ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¹¶åœ¨I / Oååº”å™¨ä¸­å‘<code>on_recv()</code>äº‹ä»¶å¤„ç†ç¨‹åºæ³¨å†Œã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºon_acceptï¼ˆï¼‰å‡½æ•°</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> incoming_conn; SAFE_CALL((incoming_conn = accept(fd, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>)), <span class="hljs-number"><span class="hljs-number">-1</span></span>); set_nonblocking(incoming_conn); SAFE_CALL(reactor_register(reactor, incoming_conn, EPOLLIN, on_recv, request_buffer_new()), <span class="hljs-number"><span class="hljs-number">-1</span></span>); }</code> </pre> </div></div><br><p> åœ¨æ“ä½œç³»ç»Ÿç”Ÿæˆ<code>EPOLLIN</code>äº‹ä»¶ä¹‹åï¼Œå°†è°ƒç”¨<code>on_recv()</code>äº‹ä»¶å¤„ç†ç¨‹åºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ„å‘³ç€æ³¨å†Œçš„<code>on_accept()</code>è¿æ¥å·²å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ã€‚ </p><br><p>  <code>on_recv()</code>ä»è¿æ¥ä¸­è¯»å–æ•°æ®ï¼Œç›´åˆ°æ”¶åˆ°å®Œæ•´çš„HTTPè¯·æ±‚ä¸ºæ­¢ï¼Œç„¶åå®ƒæ³¨å†Œ<code>on_send()</code>å¤„ç†å‡½æ•°ä»¥å‘é€HTTPå“åº”ã€‚ å¦‚æœå®¢æˆ·ç«¯æ–­å¼€è¿æ¥ï¼Œå¥—æ¥å­—å°†æ³¨é”€å¹¶ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>close()</code></a>å…³é—­ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºon_recvï¼ˆï¼‰å‡½æ•°</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_recv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span><span class="hljs-function"> </span></span>{ RequestBuffer *buffer = arg; <span class="hljs-comment"><span class="hljs-comment">//      ,  recv  0   ssize_t nread; while ((nread = recv(fd, buffer-&gt;data + buffer-&gt;size, REQUEST_BUFFER_CAPACITY - buffer-&gt;size, 0)) &gt; 0) buffer-&gt;size += nread; //    if (nread == 0) { SAFE_CALL(reactor_deregister(reactor, fd), -1); SAFE_CALL(close(fd), -1); request_buffer_destroy(buffer); return; } // read  ,   ,     //  if (errno != EAGAIN &amp;&amp; errno != EWOULDBLOCK) { request_buffer_destroy(buffer); fail("read"); } //   HTTP   .    //     if (request_buffer_is_complete(buffer)) { request_buffer_clear(buffer); SAFE_CALL(reactor_reregister(reactor, fd, EPOLLOUT, on_send, buffer), -1); } }</span></span></code> </pre> </div></div><br><p> åœ¨æ“ä½œç³»ç»Ÿç”Ÿæˆ<code>EPOLLOUT</code>äº‹ä»¶ä¹‹åï¼Œå°†è°ƒç”¨<code>on_send()</code>äº‹ä»¶å¤„ç†ç¨‹åºï¼Œè¿™æ„å‘³ç€ç”±<code>on_recv()</code>æ³¨å†Œçš„è¿æ¥å·²å‡†å¤‡å¥½å‘é€æ•°æ®ã€‚ æ­¤å‡½æ•°å°†åŒ…å«HTMLå’Œå›¾åƒçš„HTTPå“åº”å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œç„¶åå°†äº‹ä»¶å¤„ç†ç¨‹åºå†æ¬¡æ›´æ”¹ä¸º<code>on_recv()</code> ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºon_sendï¼ˆï¼‰å‡½æ•°</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fd, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> events)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *content = <span class="hljs-string"><span class="hljs-string">"&lt;img "</span></span> <span class="hljs-string"><span class="hljs-string">"src=\"https://habrastorage.org/webt/oh/wl/23/"</span></span> <span class="hljs-string"><span class="hljs-string">"ohwl23va3b-dioerobq_mbx4xaw.jpeg\"&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> response[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(response, <span class="hljs-string"><span class="hljs-string">"HTTP/1.1 200 OK"</span></span> CRLF <span class="hljs-string"><span class="hljs-string">"Content-Length: %zd"</span></span> CRLF <span class="hljs-string"><span class="hljs-string">"Content-Type: "</span></span> <span class="hljs-string"><span class="hljs-string">"text/html"</span></span> DOUBLE_CRLF <span class="hljs-string"><span class="hljs-string">"%s"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(content), content); SAFE_CALL(send(fd, response, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(response), <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">-1</span></span>); SAFE_CALL(reactor_reregister(reactor, fd, EPOLLIN, on_recv, arg), <span class="hljs-number"><span class="hljs-number">-1</span></span>); }</code> </pre> </div></div><br><p> æœ€åï¼Œåœ¨æ–‡ä»¶<code>http_server.c</code>çš„<code>main()</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>reactor_new()</code>åˆ›å»ºä¸€ä¸ªI / Oååº”å™¨ï¼Œåˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨å¥—æ¥å­—å¹¶æ³¨å†Œå®ƒï¼Œå¹¶ä½¿ç”¨<code>reactor_run()</code>å¯åŠ¨ååº”å™¨ä¸€åˆ†é’Ÿï¼Œç„¶åé‡Šæ”¾èµ„æºå¹¶é€€å‡ºä»ç¨‹åºã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºhttp_server.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"reactor.h"</span></span></span><span class="hljs-meta"> static Reactor *reactor; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"common.h"</span></span></span><span class="hljs-meta"> int main(void) { SAFE_CALL((reactor = reactor_new()), NULL); SAFE_CALL( reactor_register(reactor, new_server(false), EPOLLIN, on_accept, NULL), -1); SAFE_CALL(reactor_run(reactor, SERVER_TIMEOUT_MILLIS), -1); SAFE_CALL(reactor_destroy(reactor), -1); }</span></span></code> </pre> </div></div><br><p> æ£€æŸ¥ä¸€åˆ‡æ˜¯å¦æŒ‰é¢„æœŸè¿›è¡Œã€‚ æˆ‘ä»¬è¿›è¡Œç¼–è¯‘ï¼ˆåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ä¸º<code>chmod a+x compile.sh &amp;&amp; ./compile.sh</code> ï¼‰å¹¶å¯åŠ¨è‡ªå†™æœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">http://127.0.0.1:18470</a>å¹¶è§‚å¯Ÿé¢„æœŸçš„ç»“æœï¼š </p><br><p><img src="https://habrastorage.org/webt/i0/za/5u/i0za5um7tbcnzqt2x7sp_vey0p8.png"></p><br><h1 id="zamer-proizvoditelnosti"> ç»©æ•ˆè¯„ä¼° </h1><br><div class="spoiler">  <b class="spoiler_title">å±•ç¤ºæˆ‘çš„è½¦çš„ç‰¹ç‚¹</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">$ screenfetch MMMMMMMMMMMMMMMMMMMMMMMMMmds+. OS: Mint 19.1 tessa MMm----::-://////////////oymNMd+` Kernel: x86_64 Linux 4.15.0-20-generic MMd /++ -sNMd: Uptime: 2h 34m MMNso/` dMM `.::-. .-::.` .hMN: Packages: 2217 ddddMMh dMM :hNMNMNhNMNMNh: `NMm Shell: bash 4.4.20 NMm dMM .NMN/-+MMM+-/NMN` dMM Resolution: 1920x1080 NMm dMM -MMm `MMM dMM. dMM DE: Cinnamon 4.0.10 NMm dMM -MMm `MMM dMM. dMM WM: Muffin NMm dMM .mmd `mmm yMM. dMM WM Theme: Mint-Y-Dark (Mint-Y) NMm dMM` ..` ... ydm. dMM GTK Theme: Mint-Y [GTK2/3] hMM- +MMd/-------...-:sdds dMM Icon Theme: Mint-Y -NMm- :hNMNNNmdddddddddy/` dMM Font: Noto Sans 9 -dMNs-``-::::-------.`` dMM CPU: Intel Core i7-6700 @ 8x 4GHz [52.0Â°C] `/dMNmy+/:-------------:/yMMM GPU: NV136 ./ydNMMMMMMMMMMMMMMMMMMMMM RAM: 2544MiB / 7926MiB \.MMMMMMMMMMMMMMMMMMM</code> </pre> </div></div><br><p> æˆ‘ä»¬è¯„ä¼°å•çº¿ç¨‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚ è®©æˆ‘ä»¬æ‰“å¼€ä¸¤ä¸ªç»ˆç«¯ï¼šåœ¨å…¶ä¸­ä¸€ä¸ªä¸­ï¼Œæˆ‘ä»¬è¿è¡Œ<code>./http_server</code> ï¼Œåœ¨å¦ä¸€ä¸ªä¸­<code>./http_server</code> ã€‚ ä¸€åˆ†é’Ÿåï¼Œç¬¬äºŒä¸ªç»ˆç«¯å°†æ˜¾ç¤ºä»¥ä¸‹ç»Ÿè®¡ä¿¡æ¯ï¼š </p><br><pre> <code class="plaintext hljs">$ wrk -c100 -d1m -t8 http://127.0.0.1:18470 -H "Host: 127.0.0.1:18470" -H "Accept-Language: en-US,en;q=0.5" -H "Connection: keep-alive" Running 1m test @ http://127.0.0.1:18470 8 threads and 100 connections Thread Stats Avg Stdev Max +/- Stdev Latency 493.52us 76.70us 17.31ms 89.57% Req/Sec 24.37k 1.81k 29.34k 68.13% 11657769 requests in 1.00m, 1.60GB read Requests/sec: 193974.70 Transfer/sec: 27.19MB</code> </pre> <br><p> æˆ‘ä»¬çš„å•çº¿ç¨‹æœåŠ¡å™¨æ¯åˆ†é’Ÿèƒ½å¤Ÿå¤„ç†100ä¸‡ä¸ªè¿æ¥ä¸­çš„1100ä¸‡ä¸ªè¯·æ±‚ã€‚ ç»“æœä¸é”™ï¼Œä½†æ˜¯å¯ä»¥æ”¹å–„å—ï¼Ÿ </p><br><h1 id="mnogopotochnyy-server"> å¤šçº¿ç¨‹æœåŠ¡å™¨ </h1><br><p> å¦‚ä¸Šæ‰€è¿°ï¼Œå¯ä»¥åœ¨å•ç‹¬çš„æµä¸­åˆ›å»ºI / Oååº”å™¨ï¼Œä»è€Œåˆ©ç”¨æ‰€æœ‰CPUå†…æ ¸ã€‚ è®©æˆ‘ä»¬åœ¨å®è·µä¸­åº”ç”¨è¿™ç§æ–¹æ³•ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">æ˜¾ç¤ºhttp_server_multithreaded.c</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"reactor.h"</span></span></span><span class="hljs-meta"> static Reactor *reactor; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp threadprivate(reactor) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"common.h"</span></span></span><span class="hljs-meta"> int main(void) { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp parallel { SAFE_CALL((reactor = reactor_new()), NULL); SAFE_CALL(reactor_register(reactor, new_server(true), EPOLLIN, on_accept, NULL), -1); SAFE_CALL(reactor_run(reactor, SERVER_TIMEOUT_MILLIS), -1); SAFE_CALL(reactor_destroy(reactor), -1); } }</span></span></code> </pre> </div></div><br><p> ç°åœ¨ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ‹¥æœ‰è‡ªå·±çš„</a>ååº”å †ï¼š </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Reactor *reactor; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> omp threadprivate(reactor)</span></span></code> </pre> <br><p> è¯·æ³¨æ„ï¼Œ <code>new_server()</code>çš„å‚æ•°ä¸º<code>true</code> ã€‚ è¿™æ„å‘³ç€æˆ‘ä»¬å°†æœåŠ¡å™¨å¥—æ¥å­—è®¾ç½®ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow"><code>SO_REUSEPORT</code></a>é€‰é¡¹ï¼Œä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨å®ƒã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åœ¨è¿™é‡Œ</a>é˜…è¯»æ›´å¤šå†…å®¹ã€‚ </p><br><h1 id="vtoroy-zahod"> ç¬¬äºŒæ¬¡ </h1><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¯„ä¼°å¤šçº¿ç¨‹æœåŠ¡å™¨çš„æ€§èƒ½ï¼š </p><br><pre> <code class="plaintext hljs">$ wrk -c100 -d1m -t8 http://127.0.0.1:18470 -H "Host: 127.0.0.1:18470" -H "Accept-Language: en-US,en;q=0.5" -H "Connection: keep-alive" Running 1m test @ http://127.0.0.1:18470 8 threads and 100 connections Thread Stats Avg Stdev Max +/- Stdev Latency 1.14ms 2.53ms 40.73ms 89.98% Req/Sec 79.98k 18.07k 154.64k 78.65% 38208400 requests in 1.00m, 5.23GB read Requests/sec: 635876.41 Transfer/sec: 89.14MB</code> </pre> <br><p>  1åˆ†é’Ÿå†…å¤„ç†çš„è¯·æ±‚æ•°é‡å¢åŠ äº†çº¦3.28å€ï¼ ä½†æ˜¯åˆ°æ•´æ•°ä¸ºæ­¢ï¼Œä»…200ä¸‡æ˜¯ä¸å¤Ÿçš„ï¼Œè®©æˆ‘ä»¬å°è¯•å¯¹å…¶è¿›è¡Œä¿®å¤ã€‚ </p><br><p> é¦–å…ˆï¼ŒæŸ¥çœ‹<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">perf</a>ç”Ÿæˆçš„ç»Ÿè®¡ä¿¡æ¯ï¼š </p><br><pre> <code class="plaintext hljs">$ sudo perf stat -B -e task-clock,context-switches,cpu-migrations,page-faults,cycles,instructions,branches,branch-misses,cache-misses ./http_server_multithreaded Performance counter stats for './http_server_multithreaded': 242446,314933 task-clock (msec) # 4,000 CPUs utilized 1 813 074 context-switches # 0,007 M/sec 4 689 cpu-migrations # 0,019 K/sec 254 page-faults # 0,001 K/sec 895 324 830 170 cycles # 3,693 GHz 621 378 066 808 instructions # 0,69 insn per cycle 119 926 709 370 branches # 494,653 M/sec 3 227 095 669 branch-misses # 2,69% of all branches 808 664 cache-misses 60,604330670 seconds time elapsed</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ä½¿ç”¨CPUäº²å’ŒåŠ›</a> ï¼Œä½¿ç”¨<code>-march=native</code> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">PGOè¿›è¡Œ</a>ç¼–è¯‘ï¼Œå¢åŠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">é«˜é€Ÿç¼“å­˜ä¸­</a>çš„å‘½ä¸­æ¬¡æ•°ï¼Œå¢åŠ <code>MAX_EVENTS</code>ä»¥åŠä½¿ç”¨<code>EPOLLET</code>ä¸ä¼šæ˜¾ç€æé«˜æ€§èƒ½ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¢åŠ åŒæ—¶è¿æ¥çš„æ•°é‡ä¼šæ€æ ·ï¼Ÿ </p><br><p>  352ä¸ªåŒæ—¶è¿æ¥çš„ç»Ÿè®¡ä¿¡æ¯ï¼š </p><br><pre> <code class="plaintext hljs">$ wrk -c352 -d1m -t8 http://127.0.0.1:18470 -H "Host: 127.0.0.1:18470" -H "Accept-Language: en-US,en;q=0.5" -H "Connection: keep-alive" Running 1m test @ http://127.0.0.1:18470 8 threads and 352 connections Thread Stats Avg Stdev Max +/- Stdev Latency 2.12ms 3.79ms 68.23ms 87.49% Req/Sec 83.78k 12.69k 169.81k 83.59% 40006142 requests in 1.00m, 5.48GB read Requests/sec: 665789.26 Transfer/sec: 93.34MB</code> </pre> <br><p> è·å¾—äº†æœŸæœ›çš„ç»“æœï¼Œå®ƒå¸¦æœ‰ä¸€ä¸ªæœ‰è¶£çš„å›¾è¡¨ï¼Œæ˜¾ç¤ºäº†1åˆ†é’Ÿå†…å¤„ç†çš„è¯·æ±‚æ•°ä¸è¿æ¥æ•°çš„å…³ç³»ï¼š </p><br><p><img src="https://habrastorage.org/webt/od/8c/lv/od8clvvdlprsdcmslba9fz_rmmq.png"></p><br><p> æˆ‘ä»¬çœ‹åˆ°ï¼Œç»è¿‡æ•°ç™¾æ¬¡è¿æ¥åï¼Œä¸¤å°æœåŠ¡å™¨å¤„ç†çš„è¯·æ±‚æ•°é‡éƒ½æ€¥å‰§ä¸‹é™ï¼ˆåœ¨å¤šçº¿ç¨‹ç‰ˆæœ¬ä¸­ï¼Œè¿™ä¸€ç‚¹æ›´åŠ æ˜æ˜¾ï¼‰ã€‚ è¿™ä¸Linux TCP / IPå †æ ˆå®ç°æœ‰å…³å—ï¼Ÿ è¯·åœ¨æ³¨é‡Šä¸­éšæ„ç¼–å†™å…³äºè¿™ç§å›¾å½¢è¡Œä¸ºä»¥åŠå¤šçº¿ç¨‹å’Œå•çº¿ç¨‹é€‰é¡¹ä¼˜åŒ–çš„å‡è®¾ã€‚ </p><br><hr><br><p> å¦‚è¯„è®ºä¸­æ‰€è¿°ï¼Œæ­¤æ€§èƒ½æµ‹è¯•æœªæ˜¾ç¤ºå®é™…è´Ÿè½½ä¸‹I / Oååº”å™¨çš„è¡Œä¸ºï¼Œå› ä¸ºå‡ ä¹æ€»æ˜¯æœåŠ¡å™¨ä¸æ•°æ®åº“äº¤äº’ï¼Œæ˜¾ç¤ºæ—¥å¿—ï¼Œä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">TLS</a>åŠ å¯†ç­‰ï¼Œå› æ­¤è´Ÿè½½å˜å¾—å¼‚æ„ï¼ˆåŠ¨æ€ï¼‰ã€‚ æœ‰å…³ç¬¬ä¸‰æ–¹ç»„ä»¶çš„æµ‹è¯•å°†åœ¨æœ‰å…³I / O proactorçš„æ–‡ç« ä¸­è¿›è¡Œã€‚ </p><br><h1 id="nedostatki-io-reaktora">  I / O Reactorçš„ç¼ºç‚¹ </h1><br><p> æ‚¨éœ€è¦äº†è§£ï¼ŒI / Oååº”å™¨å¹¶éæ²¡æœ‰ç¼ºç‚¹ï¼Œå³ï¼š </p><br><ul><li> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨I / Oååº”å™¨è¦å›°éš¾ä¸€äº›ï¼Œå› ä¸º æ‚¨å¿…é¡»æ‰‹åŠ¨ç®¡ç†æµç¨‹ã€‚ </li><li> å®è·µè¡¨æ˜ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè´Ÿè½½æ˜¯å¼‚æ„çš„ï¼Œè¿™å¯èƒ½å¯¼è‡´ä»¥ä¸‹äº‹å®ï¼šä¸€ä¸ªçº¿ç¨‹å°†è¢«æ”¾ä¸‹ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹å°†è¢«åŠ è½½ã€‚ </li><li> å¦‚æœä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºé˜»æ­¢äº†æµï¼Œåˆ™ç³»ç»Ÿé€‰æ‹©å™¨æœ¬èº«ä¹Ÿå°†è¢«é˜»æ­¢ï¼Œè¿™å¯èƒ½å¯¼è‡´éš¾ä»¥æ•è·çš„é”™è¯¯ã€‚ </li></ul><br><p> è¿™äº›é—®é¢˜ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">I / Oä»£ç†</a>è§£å†³ï¼Œé€šå¸¸ä½¿ç”¨è°ƒåº¦ç¨‹åºå°†è´Ÿè½½å¹³å‡åˆ†é…ç»™çº¿ç¨‹æ± ï¼Œå¹¶ä¸”è¿˜å…·æœ‰æ›´æ–¹ä¾¿çš„APIã€‚ ç¨åå°†åœ¨æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºã€‚ </p><br><h1 id="zaklyuchenie"> ç»“è®º </h1><br><p> è‡³æ­¤ï¼Œæˆ‘ä»¬ä»ç†è®ºç›´æ¥è¿›å…¥æ’æ°”åˆ†æä»ªçš„æ—…ç¨‹ç»“æŸäº†ã€‚ </p><br><p> ä¸è¦èµ˜è¿°ï¼Œå› ä¸ºè¿˜æœ‰è®¸å¤šå…¶ä»–åŒæ ·æœ‰è¶£çš„æ–¹æ³•æ¥ç¼–å†™å…·æœ‰ä¸åŒçº§åˆ«çš„ä¾¿åˆ©æ€§å’Œé€Ÿåº¦çš„ç½‘ç»œè½¯ä»¶ã€‚ æˆ‘è®¤ä¸ºæœ‰è¶£çš„æ˜¯ï¼Œä¸‹é¢ç»™å‡ºäº†é“¾æ¥ã€‚ </p><br><p> å¾…ä¼šè§ï¼ </p><br><h1 id="interesnye-proekty"> æœ‰è¶£çš„é¡¹ç›® </h1><br><ul><li> ä¹™ <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">libevent</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">åˆ©è´å¤«</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">libuv</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">libevhtp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">è§£æ”¾</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">DPDK</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">ç½‘å›¾</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">Pf_ring</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">é“é”ˆ</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">å®‡è¾¾ç”µé€š</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">æ—¶é›„</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">smoltcp</a> </li></ul></li></ul><br><h1 id="chto-eschyo-pochitat"> è¿˜æœ‰ä»€ä¹ˆè¦è¯»çš„ï¼Ÿ </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://linux.die.net/man/7/socket</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://stackoverflow.com/questions/1050222/what-is-the-difference-between-concurrency-and-parallelism</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">http://www.kegel.com/c10k.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://kernel.dk/io_uring.pdf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://aturon.github.io/blog/2016/09/07/futures-design/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://tokio.rs/blog/2019-10-scheduler/</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" rel="nofollow">https://www.artima.com/articles/io_design_patterns.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://habr.com/cn/post/183832/</a> </li></ul><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN475896/">https://habr.com/ru/post/zh-CN475896/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN475884/index.html">è§£å†³æ¸å˜ä¸­é”¯é½¿çº¿çš„é—®é¢˜</a></li>
<li><a href="../zh-CN475886/index.html">Amazon AIå¯è½»æ¾è§£å†³ç”¨æˆ·æ·«ç§½å†…å®¹</a></li>
<li><a href="../zh-CN475888/index.html">äº‘äººè„¸è¯†åˆ«çš„å¥½å¤„</a></li>
<li><a href="../zh-CN475892/index.html">æˆ‘ä»¬å¦‚ä½•æ”¹å–„åŠå…¬å®¤åˆé¤çš„é¡ºåºï¼ˆæ— æ³•è®¿é—®æœåŠ¡å™¨ï¼‰</a></li>
<li><a href="../zh-CN475894/index.html">ä¸‰é˜¶æ®µåè®®</a></li>
<li><a href="../zh-CN475900/index.html">6é—¨æœ€æ–°çš„Azureè¯¾ç¨‹</a></li>
<li><a href="../zh-CN475902/index.html">Workflow Core-.Net Coreçš„ä¸šåŠ¡æµç¨‹å¼•æ“</a></li>
<li><a href="../zh-CN475904/index.html">ç»™æ–°ç»ç†çš„5æ¡ç¬”è®°</a></li>
<li><a href="../zh-CN475908/index.html">åä¸ªæœ€å—æ¬¢è¿çš„ä¿„è¯­ä¿„è¯­è¯¾ç¨‹</a></li>
<li><a href="../zh-CN475912/index.html">å¦‚ä½•è¯„ä¼°å’Œæ¯”è¾ƒä»¥å¤ªç½‘çš„åŠ å¯†è®¾å¤‡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>