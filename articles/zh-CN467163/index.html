<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥇 📼 🚩 得益于Kubernetes和自动化，如何在两个小时内迁移到云 🍬 💛 🖖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="URUS尝试了不同形式的Kubernetes：在Google Cloud中进行独立的裸机部署，然后将其平台移至Mail.ru Cloud Solutions（MCS）。 URUS的高级系统管理员Igor Shishkin（ t3ran ）讲述了如何选择新的云提供商以及如何在两个小时内将其迁移到新的云...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>得益于Kubernetes和自动化，如何在两个小时内迁移到云</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/467163/"><img src="https://habrastorage.org/webt/ms/rd/xs/msrdxsvvp0ml1objxiaw2lfb1b4.jpeg"><br><br>  URUS尝试了不同形式的Kubernetes：在Google Cloud中进行独立的裸机部署，然后将其平台移至Mail.ru Cloud Solutions（MCS）。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">URUS的</a>高级系统管理员Igor Shishkin（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">t3ran</a> ）讲述了如何选择新的云提供商以及如何在两个小时内将其迁移到新的云提供商。 <br><a name="habracut"></a><br><h2> 乌鲁斯做什么 </h2><br> 有许多方法可以改善城市环境的质量，其中之一就是使其对环境友好。 这正是URUS-智能数字服务公司正在开展的工作。 它实施的解决方案可帮助企业监控重要的环境指标并减少负面的环境影响。 传感器收集有关空气成分，噪声水平和其他参数的数据，然后将它们发送到单个平台“ Urus-Ekomon”进行分析和准备建议。 <br><br><h2>  “ Urus”的工作原理如何 </h2><br>  URUS的典型客户是位于住宅区或附近的公司。 它可以是工厂，港口，铁路仓库或任何其他设施。 如果我们的客户已经收到警告，因环境污染而被罚款，或希望减少噪音，减少有害排放量，请找我们，我们已经为他提供了现成的环境监测解决方案。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/j3/-c/3cj3-cvukgqpsktqzuiehm_2ioo.jpeg"></div><br>  <i>H <sub>2</sub> S浓度监测图显示附近设施的夜间夜间排放</i> <br><br> 我们在URUS中使用的设备包含多个传感器，这些传感器收集有关某些气体含量，噪声水平和其他数据的信息，以评估环境状况。 传感器的确切数量始终由特定任务确定。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u1/um/w4/u1umw4ptjdkbc8zymwy2qimgwr0.jpeg"></div><br> 根据具体的测量，带传感器的设备可以放置在建筑物，电线杆和其他任意地方的墙壁上。 每个这样的设备都会收集信息，进行汇总，然后将其发送到数据接收网关。 我们在那里保存数据以进行长期存储，并进行预处理以进行后续分析。 分析后得到的最简单的例子是空气质量指数，即AQI。 <br><br> 同时，许多其他服务都在我们的平台上工作，但是基本上它们是服务性质的。 例如，如果任何监视的参数（例如，CO <sub>2</sub>的含量）超过了允许值，则通知服务会向客户发送通知。 <br><br><h2> 我们如何存储数据。  Kubernetes在裸机上的故事 </h2><br>  URUS生态监控项目有多个数据仓库。 在其中一个中，我们保存“原始”数据-我们直接从设备本身接收到的数据。 与旧磁带一样，此存储是“磁性”磁带，其中包含所有指示器的历史记录。 第二种类型的存储用于预处理的数据-来自设备的数据，其中包含有关传感器连接和设备本身的读数，与组织的联系，位置等的元数据，这些数据使您能够动态评估特定指标在特定时间段内的变化情况。 我们使用原始数据的存储，包括作为备份，并在需要时还原预处理的数据。 <br><br> 几年前，当我们寻找解决存储问题的方法时，我们有两种选择平台的选择：Kubernetes和OpenStack。 但是由于后者看起来非常可怕（只需查看其体系结构即可了解这一点），因此我们选择了Kubernetes。 他赞成的另一个论据是相对简单的软件控制，即更灵活地将铁节点切割成资源的能力。 <br><br> 在开发Kubernetes本身的同时，我们还研究了存储数据的方式，尽管我们将所有存储都保存在Kubernetes的硬件上，但我们获得了出色的专业知识。 然后，我们在Kubernetes上生活的所有东西：全状态存储，监视系统，CI / CD。  Kubernetes已成为我们的多合一平台。 <br><br> 但是我们想将Kubernetes作为服务使用，而不是参与其支持和开发。 另外，我们不喜欢它在裸机上的含量使我们付出了多少，而我们始终需要开发！ 例如，首要任务之一是将Kubernetes Ingress控制器集成到我们组织的网络基础架构中。 这是一项繁琐的任务，尤其是如果您想象当时没有任何东西可以进行程序化资源管理，例如DNS记录或IP分配。 后来，我们开始尝试使用外部数据仓库。 我们还没有实现PVC控制器的实现，但是即使到那时，我们仍然清楚地知道这是一个很大的工作领域，为此必须挑选出各个专家。 <br><br><h2> 迁移到Google Cloud Platform临时解决方案 </h2><br> 我们意识到这种情况无法继续进行，因此将我们的数据从裸机转移到了Google Cloud Platform。 实际上，对于这家俄罗斯公司来说，没有太多有趣的选择：除了Google Cloud Platform之外，只有Amazon提供了类似的服务，但是我们仍然选择了Google的解决方案。 然后在我们看来，它更接近上游，在经济上更有利可图，更不用说Google本身就是生产中的PoC Kubernetes。 <br><br> 与我们的客户群如何增长同时出现的第一个严重问题。 当我们有必要存储个人数据时，我们面临一个选择：我们与Google合作并违反俄罗斯法律，或者我们正在俄罗斯联邦寻找替代方案。 通常，这种选择是可以预测的。  :) <br><br><h2> 我们如何看待完美的云服务 </h2><br> 在搜索开始时，我们已经知道我们想从未来的云提供商那里获得什么。 我们正在寻找什么服务： <br><br><ul><li>  <b>快速灵活</b> 。 这样我们可以随时添加一个新节点或部署某些东西。 <br></li><li>  <b>价格便宜</b> 。 由于资源有限，我们非常担心财务问题。 我们已经知道我们想与Kubernetes合作，现在的任务是最小化其成本以增加或至少保持使用此解决方案的有效性。 <br></li><li>  <b>自动化的</b> 。 我们计划通过API使用该服务，而无需管理人员和电话，也不需要在紧急模式下手动提升数十个节点的情况。 由于我们的大多数流程都是自动化的，因此我们期望云服务也是如此。 <br></li><li>  <b>在俄罗斯联邦设有服务器</b> 。 当然，我们计划遵守俄罗斯法律和152-FZ。 <br></li></ul><br> 那时，Kubernetes aaS提供商在俄罗斯很少，而选择提供商时，对我们来说，重要的是不要牺牲自己的优先级。  Mail.ru云解决方案团队已经与我们开始合作，并且仍在与他们一起工作，它为我们提供了具有API支持的全自动服务以及一个方便的控制面板，其中包含Horizo​​n-借助它我们可以迅速增加任意数量的节点。 <br><br><h2> 我们如何在两个小时内迁移到MCS </h2><br> 在这样的搬迁中，许多公司都面临着困难和失败，但在我们看来，却没有。 我们很幸运：由于在迁移开始之前我们已经在使用Kubernetes，所以我们只修复了三个文件，并在MCS的新云平台上启动了服务。 让我提醒您，到那时我们终于精疲力尽，生活在Google Cloud Platform上。 因为移动本身花费的时间不超过两个小时，再加上一些时间（大约一个小时），所以从我们的设备复制数据需要花费时间。 然后，我们已经使用了Spinnaker（一种提供连续交付的多云CD服务）。 我们还迅速将其添加到新集群中，并继续照常工作。 <br><br> 由于开发过程的自动化和CI / CD的存在，URUS中的Kubernetes被一名专家占据了（这就是我）。 在某个阶段，另一位系统管理员与我一起工作，但是后来证明我们已经使整个主例程自动化了，并且从主产品的角度来看，有越来越多的任务，将资源定向到该例程是有意义的。 <br><br> 自从我们开始合作时没有幻想，我们从云提供商那里得到了我们期望的结果。 如果发生任何事件，那么大多数都是技术性事件，这可以通过服务的相对新鲜度来轻松解释。 最主要的是，MCS团队可以快速消除缺陷并快速响应即时通讯程序中的问题。 <br><br> 如果我们将体验与Google Cloud Platform进行比较，那么在他们的情况下，我什至都不知道反馈按钮在哪里，因为根本没有必要。 如果发生任何问题，Google也会单方面发出通知。 但是，对于MCS而言，这是一大优势，我认为他们在地理和精神上都尽可能接近俄罗斯客户。 <br><br><h2> 如我们所见，未来将使用云 </h2><br> 现在，我们的工作与Kubernetes紧密相关，并且在基础架构任务方面完全适合我们。 因此，尽管我们不断引入新的实践和服务来简化日常任务并自动化新任务，提高服务的稳定性和可靠性，但我们不打算从那里迁移它。现在我们正在启动Chaos Monkey服务（具体来说，我们正在使用chaoskube，但这不会改变概念： ），最初是在Netflix中创建的。 混沌猴子做一件简单的事情：在任意时间删除Kubernetes中的任意under。 这对于我们的服务在n – 1个实例数下正常运行是必要的，因此我们习惯于为发生任何故障做好准备。 <br><br> 现在，我看到使用第三方解决方案-相同的云平台-作为年轻公司的唯一正确选择。 通常，在旅程开始时，它们的人力和财力资源有限，并且构建和维护自己的云或数据中心过于昂贵和耗时。 云提供商可以将这些成本降至最低，他们可以快速获得服务在此处和现在运行所需的资源，并实际上为这些资源付费。 至于Urus公司，目前我们将继续忠实于云中的Kubernetes。 但是谁知道，也许我们将不得不在地理上进行扩展，或者基于某些特定设备实施解决方案。 或者，像过去那样，消耗的资源量将证明其在裸机上使用自己的Kubernetes是合理的。  :) <br><br><h2> 我们从云服务的经验中学到了什么 </h2><br> 我们开始在裸机上使用Kubernetes，即使在那里它也有其自身的优势。 但是，他的优势恰恰体现为云中的aaS组件。 如果您设定目标并尽可能使所有事情自动化，您将能够避免供应商锁定，并且在云提供商之间迁移将花费几个小时，而神经细胞将一直陪伴着我们。 我们可以为其他公司提供建议：如果您要启动（云）服务，资源有限且开发速度最快，请立即开始租用云资源，并在《福布斯》撰写您的文章后建立您的数据中心。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN467163/">https://habr.com/ru/post/zh-CN467163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN467149/index.html">上古：1992年计算机出版社</a></li>
<li><a href="../zh-CN467151/index.html">处理异议：静态分析将占用部分工作时间</a></li>
<li><a href="../zh-CN467153/index.html">异议处理：静态分析将占用一部分工作时间</a></li>
<li><a href="../zh-CN467155/index.html">Kubernetes容器的最佳做法：运行状况检查</a></li>
<li><a href="../zh-CN467161/index.html">Kotlin + Spring Boot + Vue.js上的Web应用程序</a></li>
<li><a href="../zh-CN467165/index.html">在俄罗斯斯卡拉运动的脚步。 第二部分</a></li>
<li><a href="../zh-CN467169/index.html">测试超过200,000行基础架构代码的经验教训</a></li>
<li><a href="../zh-CN467171/index.html">我通过测试200,000行基础架构代码中学到了什么</a></li>
<li><a href="../zh-CN467173/index.html">建筑师安全的ERP实施</a></li>
<li><a href="../zh-CN467175/index.html">使用游戏引擎前请三思</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>