<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ” ğŸ§‘ğŸ¿â€ğŸ¤â€ğŸ§‘ğŸ¿ ğŸ§”ğŸ¾ JPA 2.2çš„æ–°å¢åŠŸèƒ½ ğŸš» ğŸ ğŸ’ªğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¥å¤§å®¶èŠ‚æ—¥å¿«ä¹ï¼ 

 çªç„¶é—´ï¼Œç¬¬äºŒä¸ªå°ç»„â€œ Java Enterprise Developerâ€çš„å¼€å§‹æ°é€¢ä¸€å¹´çš„ç¬¬256å¤©ã€‚ å·§åˆå—ï¼Ÿ æˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚ 

 å¥½å§ï¼Œæˆ‘ä»¬æœ‰ç€å€’æ•°ç¬¬äºŒä¸ªå…´è¶£ï¼šJPA 2.2å¸¦æ¥äº†å“ªäº›æ–°åŠŸèƒ½-æµå¼ä¼ è¾“ç»“æœï¼Œæ”¹è¿›çš„æ—¥æœŸè½¬æ¢ï¼Œæ–°çš„æ³¨é‡Š-ä»…æ˜¯ä¸€äº›æœ‰ç”¨çš„æ”¹è¿›ç¤ºä¾‹ã€‚ 

 èµ°å§ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JPA 2.2çš„æ–°å¢åŠŸèƒ½</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/423195/"> ç¥å¤§å®¶èŠ‚æ—¥å¿«ä¹ï¼ <br><br> çªç„¶é—´ï¼Œç¬¬äºŒä¸ªå°ç»„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">â€œ Java Enterprise Developerâ€çš„å¼€å§‹</a>æ°é€¢ä¸€å¹´çš„ç¬¬256å¤©ã€‚  <s>å·§åˆå—ï¼Ÿ</s>  <s>æˆ‘ä¸è¿™ä¹ˆè®¤ä¸ºã€‚</s> <br><br> å¥½å§ï¼Œæˆ‘ä»¬æœ‰ç€å€’æ•°ç¬¬äºŒä¸ªå…´è¶£ï¼šJPA 2.2å¸¦æ¥äº†å“ªäº›æ–°åŠŸèƒ½-æµå¼ä¼ è¾“ç»“æœï¼Œæ”¹è¿›çš„æ—¥æœŸè½¬æ¢ï¼Œæ–°çš„æ³¨é‡Š-ä»…æ˜¯ä¸€äº›æœ‰ç”¨çš„æ”¹è¿›ç¤ºä¾‹ã€‚ <br><br> èµ°å§ <br><br>  Java Persistence APIï¼ˆJPAï¼‰æ˜¯åŸºæœ¬çš„Java EEè§„èŒƒï¼Œå·²åœ¨ä¸šç•Œå¹¿æ³›ä½¿ç”¨ã€‚ æ— è®ºæ‚¨æ˜¯ä¸ºJava EEå¹³å°è¿˜æ˜¯ä¸ºæ›¿ä»£Javaæ¡†æ¶è€Œå¼€å‘ï¼ŒJPAéƒ½æ˜¯ä¿å­˜æ•°æ®çš„é€‰æ‹©ã€‚  JPA 2.1æ”¹è¿›äº†è§„èŒƒï¼Œä½¿å¼€å‘äººå‘˜èƒ½å¤Ÿè§£å†³è¯¸å¦‚è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“æ¨¡å¼å’Œæœ‰æ•ˆåœ°ä½¿ç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„è¿‡ç¨‹ä¹‹ç±»çš„é—®é¢˜ã€‚ æœ€æ–°ç‰ˆæœ¬çš„JPA 2.2æ ¹æ®è¿™äº›æ›´æ”¹æ”¹è¿›äº†è§„èŒƒã€‚ <br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºæ–°åŠŸèƒ½å¹¶æä¾›ç¤ºä¾‹ï¼Œä»¥å¸®åŠ©æ‚¨å¼€å§‹ä½¿ç”¨å®ƒã€‚ ä½œä¸ºç¤ºä¾‹ï¼Œæˆ‘ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Š</a>çš„â€œ Java EE 8 Playgroundâ€é¡¹ç›®ã€‚ è¯¥ç¤ºä¾‹åº”ç”¨ç¨‹åºåŸºäºJava EE 8è§„èŒƒï¼Œå¹¶ä½¿ç”¨JavaServer Facesï¼ˆJSFï¼‰ï¼ŒEnterprise JavaBeansï¼ˆEJBï¼‰å’ŒJPAæ¡†æ¶æ¥å®ç°æŒä¹…æ€§ã€‚ æ‚¨éœ€è¦ç†Ÿæ‚‰JPAæ‰èƒ½äº†è§£å…¶å«ä¹‰ã€‚ <br><br><img src="https://habrastorage.org/webt/2a/o5/xl/2ao5xlvs1k6qa91gdq0ndz3akis.png"><br><a name="habracut"></a><br>  <b>ä½¿ç”¨JPA 2.2</b> <br><br>  JPA 2.2ç‰ˆæ˜¯Java EE 8å¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ä¸Java EE 8å…¼å®¹çš„åº”ç”¨æœåŠ¡å™¨æ‰æä¾›å¯ç«‹å³ä½¿ç”¨çš„è§„èŒƒã€‚ åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼ˆ2017å¹´æœ«ï¼‰ï¼Œæœ‰å¾ˆå¤šè¿™æ ·çš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ã€‚ ä½†æ˜¯ï¼Œå°†JPA 2.2ä¸Java EE7ä¸€èµ·ä½¿ç”¨å¾ˆå®¹æ˜“ã€‚ é¦–å…ˆï¼Œæ‚¨éœ€è¦ä½¿ç”¨<a href="">Maven Central</a>ä¸‹è½½é€‚å½“çš„JARæ–‡ä»¶å¹¶å°†å…¶æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚ å¦‚æœæ‚¨åœ¨é¡¹ç›®ä¸­ä½¿ç”¨Mavenï¼Œè¯·å°†åæ ‡æ·»åŠ åˆ°Maven POMæ–‡ä»¶ï¼š <br><br><pre><code class="java hljs">&lt;dependency&gt; &lt;groupId&gt;javax.persistence&lt;/groupId&gt; &lt;artifactId&gt;javax.persistence-api&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.2</span></span>&lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br> ç„¶åï¼Œé€‰æ‹©è¦ä½¿ç”¨çš„JPAå®ç°ã€‚ ä»JPA 2.2å¼€å§‹ï¼ŒEclipseLinkå’ŒHibernateéƒ½æœ‰å…¼å®¹çš„å®ç°ã€‚ ä½œä¸ºæœ¬æ–‡ä¸­çš„ç¤ºä¾‹ï¼Œæˆ‘é€šè¿‡æ·»åŠ ä»¥ä¸‹ä¾èµ–é¡¹æ¥ä½¿ç”¨<a href="">EclipseLink</a> ï¼š <br><br><pre> <code class="java hljs">&lt;dependency&gt; &lt;groupId&gt;org.eclipse.persistence&lt;/groupId&gt; &lt;artifactId&gt;eclipselink&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.7</span></span>.0 &lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br> å¦‚æœä½¿ç”¨çš„æ˜¯ä¸Java EE 8å…¼å®¹çš„æœåŠ¡å™¨ï¼Œä¾‹å¦‚GlassFish 5æˆ–Payara 5ï¼Œåˆ™åº”è¯¥èƒ½å¤Ÿåœ¨POMæ–‡ä»¶ä¸­ä¸ºè¿™äº›ä¾èµ–é¡¹æŒ‡å®šâ€œæä¾›â€åŒºåŸŸã€‚ å¦åˆ™ï¼Œè¯·æŒ‡å®šâ€œç¼–è¯‘â€åŒºåŸŸä»¥å°†å®ƒä»¬åŒ…æ‹¬åœ¨é¡¹ç›®ç¨‹åºé›†ä¸­ã€‚ <br><br>  <b>Java 8æ—¥æœŸå’Œæ—¶é—´æ”¯æŒ</b> <br><br>  Java 8 Date and Time APIæ”¯æŒå¯èƒ½æ˜¯æœ€ç§¯æçš„è¡¥å……ä¹‹ä¸€ã€‚ è‡ª2014å¹´Java SE 8å‘å¸ƒä»¥æ¥ï¼Œå¼€å‘äººå‘˜å·²ä½¿ç”¨å˜é€šåŠæ³•å°†Date and Time APIä¸JPAç»“åˆä½¿ç”¨ã€‚ å°½ç®¡å¤§å¤šæ•°è§£å†³æ–¹æ³•éƒ½éå¸¸ç®€å•ï¼Œä½†æ˜¯æ—©å°±åº”è¯¥ä¸ºæ›´æ–°çš„Date and Time APIæ·»åŠ åŸºæœ¬æ”¯æŒã€‚  JPAå¯¹æ—¥æœŸå’Œæ—¶é—´APIçš„æ”¯æŒåŒ…æ‹¬ä»¥ä¸‹ç±»å‹ï¼š <br><br><ul><li> <code>java.time.LocalDate</code> </li> <li> <code>java.time.LocalTime</code> </li> <li> <code>java.time.LocalDateTime</code> </li> <li> <code>java.time.OffsetTime</code> </li> <li> <code>java.time.OffsetDateTime</code> </li> </ul><br> ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘å°†é¦–å…ˆè¯´æ˜åœ¨æ²¡æœ‰JPA 2.2çš„æƒ…å†µä¸‹å¦‚ä½•æ”¯æŒDate and Time APIã€‚  JPA 2.1åªèƒ½ä¸è¾ƒæ—©çš„æ—¥æœŸæ„é€ ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚<code>java.util.Date</code>å’Œ<code>java.sql.Timestamp</code> ã€‚ å› æ­¤ï¼Œå¿…é¡»ä½¿ç”¨è½¬æ¢å™¨å°†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ—¥æœŸè½¬æ¢ä¸ºJPA 2.1æ”¯æŒçš„æ—§è®¾è®¡ï¼Œç„¶åå°†å…¶è½¬æ¢ä¸ºæ›´æ–°çš„Date and Time APIä»¥åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ã€‚ å¯ä»¥è¿›è¡Œè½¬æ¢çš„JPA 2.1ä¸­çš„æ—¥æœŸè½¬æ¢å™¨å¯èƒ½ç±»ä¼¼äºæ¸…å•1ã€‚å…¶ä¸­çš„è½¬æ¢å™¨ç”¨äºåœ¨<code>LocalDate</code>å’Œ<code>java.util.Date</code>ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚ <br><br>  <i>æ¸…å•1</i> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Converter</span></span>(autoApply = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalDateTimeConverter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttributeConverter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalDate</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Date</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Date </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToDatabaseColumn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LocalDate entityValue)</span></span></span><span class="hljs-function"> </span></span>{ LocalTime time = LocalTime.now(); Instant instant = time.atDate(entityValue) .atZone(ZoneId.systemDefault()) .toInstant(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Date.from(instant); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LocalDate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToEntityAttribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date databaseValue)</span></span></span></span>{ Instant instant = Instant.ofEpochMilli(databaseValue.getTime()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LocalDateTime.ofInstant(instant, ZoneId.systemDefault()).toLocalDate(); } }</code> </pre> <br>  JPA 2.2ä¸å†éœ€è¦ç¼–å†™è¿™æ ·çš„è½¬æ¢å™¨ï¼Œå› ä¸ºæ‚¨ä½¿ç”¨çš„æ˜¯å—æ”¯æŒçš„æ—¥æœŸæ—¶é—´ç±»å‹ã€‚ å¯¹æ­¤ç±»ç±»å‹çš„æ”¯æŒæ˜¯å†…ç½®çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥ç®€å•åœ°åœ¨å®ä½“ç±»å­—æ®µä¸­æŒ‡å®šå—æ”¯æŒçš„ç±»å‹ï¼Œè€Œæ— éœ€å…¶ä»–ä»£ç ã€‚ ä¸‹é¢çš„ä»£ç æ®µæ¼”ç¤ºäº†æ­¤æ¦‚å¿µã€‚ è¯·æ³¨æ„ï¼Œç”±äºç±»å‹æ˜ å°„æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„ï¼Œå› æ­¤æ— éœ€åœ¨<code>@Temporal</code>ä»£ç ä¸­æ·»åŠ æ³¨é‡Šã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Job</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ . . . <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"WORK_DATE"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LocalDate workDate; . . . }</code> </pre> <br> ç”±äºå—æ”¯æŒçš„æ—¥æœŸæ—¶é—´ç±»å‹æ˜¯JPAä¸­çš„ä¸€æµå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥åœ¨æ²¡æœ‰é™„åŠ ä»ªå¼çš„æƒ…å†µä¸‹æŒ‡å®šå®ƒä»¬ã€‚ åœ¨JPA 2.1 <code>@Temporal</code>å¿…é¡»åœ¨<code>java.util.Date</code>å’Œ<code>java.util.Calendar</code>æ‰€æœ‰å¸¸é‡å­—æ®µå’Œå±æ€§ä¸­æè¿°æ³¨é‡Šã€‚ <br><br> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ­¤ç‰ˆæœ¬ä»…æ”¯æŒéƒ¨åˆ†æ•°æ®æ—¶é—´ç±»å‹ï¼Œä½†æ˜¯å¯ä»¥è½»æ¾ç”Ÿæˆå±æ€§è½¬æ¢å™¨ä»¥ä¸å…¶ä»–ç±»å‹ä¸€èµ·ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œå°†<code>LocalDateTime</code>è½¬æ¢ä¸º<code>ZonedDateTime</code> ã€‚ ç¼–å†™æ­¤ç±»è½¬æ¢å™¨çš„æœ€å¤§é—®é¢˜æ˜¯ç¡®å®šå¦‚ä½•åœ¨ä¸åŒç±»å‹ä¹‹é—´è¿›è¡Œæœ€ä½³è½¬æ¢ã€‚ ä¸ºäº†ä½¿äº‹æƒ…å˜å¾—æ›´åŠ å®¹æ˜“ï¼Œç°åœ¨å¯ä»¥å®ç°å±æ€§è½¬æ¢å™¨ã€‚ æˆ‘å°†åœ¨ä¸‹é¢ç»™å‡ºä¸€ä¸ªç¤ºä¾‹å®ç°ã€‚ <br><br> æ¸…å•2ä¸­çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•å°†æ—¶é—´ä»<code>LocalDateTime</code>è½¬æ¢ä¸º<code>ZonedDateTime</code> ã€‚ <br><br>  <i>æ¸…å•2</i> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Converter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalToZonedConverter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttributeConverter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZonedDateTime</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LocalDateTime</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> LocalDateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToDatabaseColumn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ZonedDateTime entityValue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> entityValue.toLocalDateTime(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ZonedDateTime </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToEntityAttribute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(LocalDateTime databaseValue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ZonedDateTime.of(databaseValue, ZoneId.systemDefault()); } }</code> </pre> <br> ç‰¹åˆ«åœ°ï¼Œæ­¤ç¤ºä¾‹éå¸¸ç®€å•ï¼Œå› ä¸º<code>ZonedDateTime</code>åŒ…å«æ˜“äºè½¬æ¢çš„æ–¹æ³•ã€‚ é€šè¿‡è°ƒç”¨<code>toLocalDateTime()</code>æ–¹æ³•è¿›è¡Œè½¬æ¢ã€‚ å¯ä»¥é€šè¿‡è°ƒç”¨<code>ZonedDateTimeOf()</code>æ–¹æ³•å¹¶å°†<code>LocalDateTime</code>å€¼ä¸<code>ZoneId</code>ä¸€èµ·ä½¿ç”¨ä»¥ä½¿ç”¨æ—¶åŒºæ¥å®Œæˆé€†è½¬æ¢ã€‚ <br><br>  <b>åµŒå…¥å¼å±æ€§è½¬æ¢å™¨</b> <br><br> å±æ€§è½¬æ¢å™¨æ˜¯JPA 2.1çš„ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……ï¼Œå› ä¸ºå®ƒä»¬å…è®¸å±æ€§ç±»å‹æ›´åŠ çµæ´»ã€‚  JPA 2.2æ›´æ–°å¢åŠ äº†ä½¿å±æ€§è½¬æ¢å™¨å¯å®ç°çš„æœ‰ç”¨åŠŸèƒ½ã€‚ è¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†ä¸Šä¸‹æ–‡å’Œä¾èµ–æ³¨å…¥ï¼ˆCDIï¼‰èµ„æºç›´æ¥åµŒå…¥åˆ°å±æ€§è½¬æ¢å™¨ä¸­ã€‚ æ­¤ä¿®æ”¹ä¸Java EE 8è§„èŒƒä¸­çš„å…¶ä»–CDIå¢å¼ºåŠŸèƒ½ï¼ˆä¾‹å¦‚é«˜çº§JSFè½¬æ¢å™¨ï¼‰ä¸€è‡´ï¼Œå› ä¸ºå®ƒä»¬ç°åœ¨ä¹Ÿå¯ä»¥ä½¿ç”¨CDIæ³¨å…¥ã€‚ <br><br> è¦åˆ©ç”¨æ­¤æ–°åŠŸèƒ½ï¼Œåªéœ€æ ¹æ®éœ€è¦å°†CDIèµ„æºåµŒå…¥å±æ€§è½¬æ¢å™¨ä¸­å³å¯ã€‚ æ¸…å•2æä¾›äº†ä¸€ä¸ªå±æ€§è½¬æ¢å™¨çš„ç¤ºä¾‹ï¼Œç°åœ¨æˆ‘å°†å¯¹å…¶è¿›è¡Œåˆ†è§£ï¼Œè§£é‡Šæ‰€æœ‰é‡è¦çš„ç»†èŠ‚ã€‚ <br><br> è½¬æ¢å™¨ç±»å¿…é¡»å®ç°<code>javax.persistence.AttributeConverter</code>æ¥å£ï¼Œå¹¶ä¼ é€’Xå’ŒYå€¼ï¼ŒXå€¼å¯¹åº”äºJavaå¯¹è±¡ä¸­çš„æ•°æ®ç±»å‹ï¼Œè€ŒYå€¼å¿…é¡»å¯¹åº”äºæ•°æ®åº“åˆ—ç±»å‹ã€‚ ç„¶åï¼Œè½¬æ¢å™¨ç±»åº”ä½¿ç”¨<code>@Converter</code>æ³¨é‡Šã€‚ æœ€åï¼Œè¯¥ç±»å¿…é¡»é‡å†™<code>convertToDatabaseColumn()</code>å’Œ<code>convertToEntityAttribute()</code>æ–¹æ³•ã€‚ è¿™äº›æ–¹æ³•ä¸­çš„æ¯ä¸ªæ–¹æ³•çš„å®ç°éƒ½åº”å°†å€¼ä»ç‰¹å®šç±»å‹è½¬æ¢å›å»ã€‚ <br><br> è¦åœ¨æ¯æ¬¡ä½¿ç”¨æŒ‡å®šçš„æ•°æ®ç±»å‹æ—¶è‡ªåŠ¨åº”ç”¨è½¬æ¢å™¨ï¼Œè¯·æ·»åŠ â€œè‡ªåŠ¨â€ï¼Œå¦‚<code>@Converter(autoApply=true)</code> ã€‚ è¦å°†è½¬æ¢å™¨åº”ç”¨äºå•ä¸ªå±æ€§ï¼Œè¯·åœ¨å±æ€§çº§åˆ«ä½¿ç”¨@Converteræ‰¹æ³¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(converter=LocalDateConverter.java) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> LocalDate workDate;</code> </pre> <br> è½¬æ¢å™¨ä¹Ÿå¯ä»¥åœ¨ç±»çº§åˆ«åº”ç”¨ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Convert</span></span>(attributeName=<span class="hljs-string"><span class="hljs-string">"workDate"</span></span>, converter = LocalDateConverter.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Job</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ . . .</code> </pre> <br> å‡è®¾æˆ‘è¦åœ¨ä¿å­˜æ—¶åŠ å¯†<code>Customer</code>å®ä½“çš„<code>creditLimit</code>å­—æ®µä¸­åŒ…å«çš„å€¼ã€‚ è¦å®ç°æ­¤è¿‡ç¨‹ï¼Œå¿…é¡»å…ˆå¯¹å€¼è¿›è¡ŒåŠ å¯†ï¼Œç„¶åå†ä¿å­˜ï¼Œå¹¶åœ¨ä»æ•°æ®åº“ä¸­æ£€ç´¢åè§£å¯†ã€‚ è¿™å¯ä»¥ç”±è½¬æ¢å™¨å®Œæˆï¼Œå¹¶ä¸”ä½¿ç”¨JPA 2.2ï¼Œæˆ‘å¯ä»¥å°†åŠ å¯†å¯¹è±¡åµŒå…¥è½¬æ¢å™¨ä¸­ä»¥è·å¾—æ‰€éœ€çš„ç»“æœã€‚ æ¸…å•3æä¾›äº†ä¸€ä¸ªç¤ºä¾‹ã€‚ <br><br>  <i>æ¸…å•3</i> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Converter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreditLimitConverter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AttributeConverter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigDecimal</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BigDecimal</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> CreditLimitEncryptor encryptor; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToDatabaseColumn</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal entityValue)</span></span></span><span class="hljs-function"> </span></span>{ String encryptedFormat = encryptor.base64encode(entityValue.toString()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BigDecimal.valueOf(Long.valueOf(encryptedFormat)); } ... }</code> </pre> <br> åœ¨æ­¤ä»£ç ä¸­ï¼Œé€šè¿‡<code>CreditLimitEncryptor</code>ç±»æ³¨å…¥åˆ°è½¬æ¢å™¨ä¸­ï¼Œç„¶åä½¿ç”¨å®ƒæ¥å¸®åŠ©è¯¥è¿‡ç¨‹æ¥æ‰§è¡Œè¯¥è¿‡ç¨‹ã€‚ <br><br>  <b>æµæŸ¥è¯¢ç»“æœ</b> <br><br> ç°åœ¨ï¼Œåœ¨ä½¿ç”¨æŸ¥è¯¢ç»“æœæ—¶ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°å……åˆ†åˆ©ç”¨Java SE 8æµåŠŸèƒ½ã€‚ çº¿ç¨‹ä¸ä»…å¯ä»¥ç®€åŒ–ä»£ç çš„è¯»å–ï¼Œç¼–å†™å’Œç»´æŠ¤ï¼Œè€Œä¸”åœ¨æŸäº›æƒ…å†µä¸‹è¿˜å¯ä»¥å¸®åŠ©æé«˜æŸ¥è¯¢æ€§èƒ½ã€‚ å°½ç®¡åœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨<code>ResultSet</code>åˆ†é¡µå¯èƒ½æ¯”æµæ›´å¥½åœ°å·¥ä½œï¼Œä½†æŸäº›çº¿ç¨‹å®ç°ä¹Ÿæœ‰åŠ©äºé¿å…åŒæ—¶å‘é€è¿‡å¤šçš„æ•°æ®è¯·æ±‚ã€‚ <br><br> ä¸ºäº†å¯ç”¨æ­¤åŠŸèƒ½ï¼Œå·²å°†<code>getResultStream()</code>æ–¹æ³•æ·»åŠ åˆ°<code>Query</code>å’Œ<code>TypedQuery</code> ã€‚ è¿™ä¸ªå¾®å°çš„å˜åŒ–ä½¿JPAå¯ä»¥ç®€å•åœ°è¿”å›ç»“æœæµè€Œä¸æ˜¯åˆ—è¡¨ã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å¤§å‹<code>ResultSet</code> ï¼Œåˆ™æœ‰å¿…è¦æ¯”è¾ƒæ–°çº¿ç¨‹å®ç°ä¸å¯æ»šåŠ¨<code>ResultSets</code>æˆ–åˆ†é¡µä¹‹é—´çš„æ€§èƒ½ã€‚ åŸå› æ˜¯çº¿ç¨‹å®ç°ä¸€æ¬¡æ£€ç´¢æ‰€æœ‰è®°å½•ï¼Œå°†å®ƒä»¬å­˜å‚¨åœ¨åˆ—è¡¨ä¸­ï¼Œç„¶åè¿”å›å®ƒä»¬ã€‚ å¯æ»šåŠ¨çš„<code>ResultSet</code>å’Œåˆ†é¡µæŠ€æœ¯å¯ä»¥é›¶ç¢åœ°æ£€ç´¢æ•°æ®ï¼Œè¿™å¯¹äºå¤§å‹æ•°æ®é›†å¯èƒ½æ›´å¥½ã€‚ <br><br> æŒä¹…æ€§æä¾›ç¨‹åºå¯èƒ½ä¼šå†³å®š<code>getResultStream()</code>æ”¹è¿›çš„å®ç°æ¥è¦†ç›–æ–°çš„<code>getResultStream()</code>æ–¹æ³•ã€‚  Hibernateå·²ç»åŒ…å«ä¸€ä¸ªstreamï¼ˆï¼‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä½¿ç”¨å¯æ»šåŠ¨çš„<code>ResultSet</code>æ¥è§£æè®°å½•çš„ç»“æœï¼Œè€Œä¸æ˜¯å®Œå…¨è¿”å›å®ƒä»¬ã€‚ è¿™ä½¿Hibernateå¯ä»¥å¤„ç†éå¸¸å¤§çš„æ•°æ®é›†ï¼Œå¹¶ä¸”è¡¨ç°å‡ºè‰²ã€‚ å¯ä»¥æœŸæœ›å…¶ä»–æä¾›è€…é‡å†™æ­¤æ–¹æ³•ï¼Œä»¥æä¾›å¯¹JPAæœ‰ç›Šçš„ç±»ä¼¼åŠŸèƒ½ã€‚ <br><br> é™¤äº†æ€§èƒ½ä¹‹å¤–ï¼Œæµç»“æœçš„åŠŸèƒ½æ˜¯å¯¹JPAçš„å¾ˆå¥½è¡¥å……ï¼Œå®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥å¤„ç†æ•°æ®ã€‚ æˆ‘å°†æ¼”ç¤ºä¸€äº›å¯èƒ½æ´¾ä¸Šç”¨åœºçš„åœºæ™¯ï¼Œä½†æ˜¯å¯èƒ½æ€§æœ¬èº«æ˜¯æ— é™çš„ã€‚ åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘éƒ½æŸ¥è¯¢<code>Job</code>å®ä½“å¹¶è¿”å›æµã€‚ é¦–å…ˆï¼Œçœ‹ä¸‹é¢çš„ä»£ç ï¼Œåœ¨è¿™é‡Œæˆ‘é€šè¿‡è°ƒç”¨<code>Query</code> <code>getResultStream()</code>æ¥å£æ–¹æ³•æ¥é’ˆå¯¹ç‰¹å®šçš„<code>Customer</code>è§£æ<code>Jobs</code>æµã€‚ ç„¶åï¼Œæˆ‘ä½¿ç”¨è¯¥çº¿ç¨‹è¾“å‡ºæœ‰å…³<code>customer</code>å’Œ<code>work date</code> Job'açš„è¯¦ç»†ä¿¡æ¯ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByCustomer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PoolCustomer customer)</span></span></span></span>{ Stream&lt;Job&gt; jobList = em.createQuery(<span class="hljs-string"><span class="hljs-string">"select object(o) from Job o "</span></span> + <span class="hljs-string"><span class="hljs-string">"where o.customer = :customer"</span></span>) .setParameter(<span class="hljs-string"><span class="hljs-string">"customer"</span></span>, customer) .getResultStream(); jobList.map(j -&gt; j.getCustomerId() + <span class="hljs-string"><span class="hljs-string">" ordered job "</span></span> + j.getId() + <span class="hljs-string"><span class="hljs-string">" - Starting "</span></span> + j.getWorkDate()) .forEach(jm -&gt; System.out.println(jm)); }</code> </pre> <br><br> å¯ä»¥ç¨åŠ ä¿®æ”¹æ­¤æ–¹æ³•ï¼Œä»¥ä¾¿ä½¿ç”¨<code>Collectors .toList()</code>æ–¹æ³•è¿”å›ç»“æœåˆ—è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Job&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByCustomer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PoolCustomer customer)</span></span></span></span>{ Stream&lt;Job&gt; jobList = em.createQuery( <span class="hljs-string"><span class="hljs-string">"select object(o) from Job o "</span></span> + <span class="hljs-string"><span class="hljs-string">"where o.customerId = :customer"</span></span>) .setParameter(<span class="hljs-string"><span class="hljs-string">"customer"</span></span>, customer) .getResultStream(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jobList.collect(Collectors.toList()); }</code> </pre> <br> åœ¨ä¸‹é¢æ˜¾ç¤ºçš„ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œæˆ‘æ‰¾åˆ°äº†ä¸ç‰¹å®šå½¢å¼çš„æ± ç›¸å…³<code>List</code>ä»»åŠ¡<code>List</code> ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘è¿”å›æ‰€æœ‰ä¸ä½œä¸ºå­—ç¬¦ä¸²æäº¤çš„è¡¨å•åŒ¹é…çš„ä»»åŠ¡ã€‚ ä¸ç¬¬ä¸€ä¸ªç¤ºä¾‹ç±»ä¼¼ï¼Œé¦–å…ˆæˆ‘è¿”å›<code>Jobs</code>è®°å½•æµã€‚ ç„¶åï¼Œæˆ‘æ ¹æ®å®¢æˆ·ç¾¤è¡¨å•è¿‡æ»¤è®°å½•ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œç”Ÿæˆçš„ä»£ç éå¸¸ç´§å‡‘å¹¶ä¸”æ˜“äºé˜…è¯»ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Job&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByCustPoolShape</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String poolShape)</span></span></span></span>{ Stream&lt;Job&gt; jobstream = em.createQuery( <span class="hljs-string"><span class="hljs-string">"select object(o) from Job o"</span></span>) .getResultStream(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jobstream.filter( c -&gt; poolShape.equals(c.getCustomerId().getPoolId().getShape())) .collect(Collectors.toList()); }</code> </pre><br> å¦‚å‰æ‰€è¿°ï¼Œè®°ä½è¿”å›å¤§é‡æ•°æ®çš„æƒ…å†µä¸‹çš„æ€§èƒ½éå¸¸é‡è¦ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œçº¿ç¨‹åœ¨æŸ¥è¯¢æ•°æ®åº“ä¸­æ›´æœ‰ç”¨ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚ ä¸€æ¡å¥½çš„ç»éªŒæ³•åˆ™æ˜¯ï¼Œå¦‚æœå¯ä»¥åœ¨SQLæŸ¥è¯¢ä¸­æŸ¥è¯¢æ•°æ®ï¼Œåˆ™å¯ä»¥è¿™æ ·åšã€‚ æœ‰æ—¶ï¼Œä½¿ç”¨ä¼˜é›…çš„çº¿ç¨‹è¯­æ³•çš„å¥½å¤„ä¸ä¼šè¶…è¿‡ä½¿ç”¨æ ‡å‡†SQLè¿‡æ»¤æ‰€èƒ½è¾¾åˆ°çš„æœ€ä½³æ€§èƒ½ã€‚ <br><br>  <b>é‡å¤æ³¨é‡Šæ”¯æŒ</b> <br><br> å‘å¸ƒJava SE 8æ—¶ï¼Œå¯ä»¥ä½¿ç”¨é‡å¤çš„æ‰¹æ³¨ï¼Œä»è€Œå…è®¸æ‚¨åœ¨å£°æ˜ä¸­é‡ç”¨æ‰¹æ³¨ã€‚ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦å¤šæ¬¡åœ¨ç±»æˆ–å­—æ®µä¸Šä½¿ç”¨ç›¸åŒçš„æ³¨é‡Šã€‚ ä¾‹å¦‚ï¼Œç»™å®šå®ä½“ç±»å¯èƒ½æœ‰å¤šä¸ª<code>@SqlResultSetMapping</code>æ‰¹æ³¨ã€‚ åœ¨éœ€è¦æ”¯æŒé‡æ–°æ³¨é‡Šçš„æƒ…å†µä¸‹ï¼Œåº”ä½¿ç”¨å®¹å™¨æ³¨é‡Šã€‚ é‡å¤æ³¨é‡Šä¸ä»…å‡å°‘äº†å°†ç›¸åŒæ³¨é‡Šçš„é›†åˆåŒ…è£…åœ¨å®¹å™¨æ³¨é‡Šä¸­çš„è¦æ±‚ï¼Œè€Œä¸”è¿˜ä½¿ä»£ç æ›´æ˜“äºé˜…è¯»ã€‚ <br><br> å®ƒçš„å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼šæ³¨é‡Šç±»çš„å®ç°åº”ä½¿ç”¨<code>@Repeatable</code>å…ƒæ³¨é‡Šè¿›è¡Œæ ‡è®°ï¼Œä»¥æŒ‡ç¤ºå¯ä»¥å¤šæ¬¡ä½¿ç”¨å®ƒã€‚  <code>@Repeatable</code>å…ƒæ³¨é‡Šé‡‡ç”¨å®¹å™¨æ³¨é‡Šç±»çš„ç±»å‹ã€‚ ä¾‹å¦‚ï¼Œ <code>NamedQuery</code>æ³¨é‡Š<code>NamedQuery</code>ç°åœ¨å·²æ ‡æœ‰<code>@Repeatable(NamedQueries.class)</code>æ³¨é‡Šã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»ç„¶ä½¿ç”¨å®¹å™¨æ³¨é‡Šï¼Œä½†æ˜¯å½“åœ¨å£°æ˜æˆ–ç±»ä¸Šä½¿ç”¨ç›¸åŒçš„æ³¨é‡Šæ—¶ï¼Œæ‚¨ä¸å¿…è€ƒè™‘å®ƒï¼Œå› ä¸º<code>@Repeatable</code>æŠ½è±¡äº†æ­¤ç»†èŠ‚ã€‚ <br><br> æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ã€‚ å¦‚æœè¦å‘JPA 2.1ä¸­çš„å®ä½“ç±»æ·»åŠ å¤šä¸ª<code>@NamedQuery</code>æ‰¹æ³¨ï¼Œåˆ™éœ€è¦å°†å®ƒä»¬å°è£…åœ¨<code>@NamedQueries</code>æ‰¹æ³¨å†…ï¼Œå¦‚æ¸…å•4æ‰€ç¤ºã€‚ <br><br>  <i>æ¸…å•4</i> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CUSTOMER"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@NamedQueries</span></span>({ <span class="hljs-meta"><span class="hljs-meta">@NamedQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"Customer.findAll"</span></span>, query = <span class="hljs-string"><span class="hljs-string">"SELECT c FROM Customer c"</span></span>) , <span class="hljs-meta"><span class="hljs-meta">@NamedQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"Customer.findByCustomerId"</span></span>, query = <span class="hljs-string"><span class="hljs-string">"SELECT c FROM Customer c "</span></span> + <span class="hljs-string"><span class="hljs-string">"WHERE c.customerId = :customerId"</span></span>) , <span class="hljs-meta"><span class="hljs-meta">@NamedQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"Customer.findByName"</span></span>, query = <span class="hljs-string"><span class="hljs-string">"SELECT c FROM Customer c "</span></span> + <span class="hljs-string"><span class="hljs-string">"WHERE c.name = :name"</span></span>) . . .)}) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ . . . }</code> </pre> <br> ä½†æ˜¯ï¼Œåœ¨JPA 2.2ä¸­ï¼Œä¸€åˆ‡éƒ½ä¸åŒã€‚ ç”±äº<code>@NamedQuery</code>æ˜¯é‡å¤çš„æ³¨é‡Šï¼Œå› æ­¤å¯ä»¥åœ¨å®ä½“ç±»ä¸­å¤šæ¬¡æŒ‡å®šå®ƒï¼Œå¦‚æ¸…å•5æ‰€ç¤ºã€‚ <br><br>  <i>æ¸…å•5</i> <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"CUSTOMER"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@XmlRootElement</span></span> <span class="hljs-meta"><span class="hljs-meta">@NamedQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"Customer.findAll"</span></span>, query = <span class="hljs-string"><span class="hljs-string">"SELECT c FROM Customer c"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NamedQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"Customer.findByCustomerId"</span></span>, query = <span class="hljs-string"><span class="hljs-string">"SELECT c FROM Customer c "</span></span> + <span class="hljs-string"><span class="hljs-string">"WHERE c.customerId = :customerId"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@NamedQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"Customer.findByName"</span></span>, query = <span class="hljs-string"><span class="hljs-string">"SELECT c FROM Customer c "</span></span> + <span class="hljs-string"><span class="hljs-string">"WHERE c.name = :name"</span></span>) . . . <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Customer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ . . . }</code> </pre> <br> é‡å¤æ³¨é‡Šåˆ—è¡¨ï¼š <br><br><ul><li> <code>@AssociationOverride</code> </li> <li> <code>@AttributeOverride</code> </li> <li> <code>@Convert</code> </li> <li> <code>@JoinColumn</code> </li> <li> <code>@MapKeyJoinColumn</code> </li> <li> <code>@NamedEntityGraphy</code> </li> <li> <code>@NamedNativeQuery</code> </li> <li> <code>@NamedQuery</code> </li> <li> <code>@NamedStoredProcedureQuery</code> </li> <li> <code>@PersistenceContext</code> </li> <li> <code>@PersistenceUnit</code> </li> <li> <code>@PrimaryKeyJoinColumn</code> </li> <li> <code>@SecondaryTable</code> </li> <li> <code>@SqlResultSetMapping</code> </li> </ul><br>  <b>ç»“è®º</b> <br><br>  JPA 2.2ç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›æ›´æ”¹ï¼Œä½†æ˜¯å…¶ä¸­åŒ…å«çš„æ”¹è¿›éå¸¸é‡è¦ã€‚ æœ€åï¼ŒJPAä¸Java SE 8ä¿æŒä¸€è‡´ï¼Œä»è€Œä½¿å¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨è¯¸å¦‚Date and Time APIï¼ŒæµæŸ¥è¯¢ç»“æœå’Œé‡å¤æ³¨é‡Šä¹‹ç±»çš„åŠŸèƒ½ã€‚ æ­¤ç‰ˆæœ¬è¿˜é€šè¿‡æ·»åŠ å°†CDIèµ„æºåµŒå…¥å±æ€§è½¬æ¢å™¨çš„åŠŸèƒ½æ¥æé«˜CDIä¸€è‡´æ€§ã€‚  JPA 2.2ç°åœ¨å¯ç”¨ï¼Œå¹¶ä¸”æ˜¯Java EE 8çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘æƒ³æ‚¨ä¼šå–œæ¬¢ä½¿ç”¨å®ƒã€‚ <br><br> ç»“æŸ <br><br> ä¸å¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬æ­£åœ¨ç­‰å¾…é—®é¢˜å’Œè¯„è®ºã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN423195/">https://habr.com/ru/post/zh-CN423195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN423185/index.html">ä¸è¦åƒï¼ æœ‰ç”¨çš„3Dç³–å°åˆ·</a></li>
<li><a href="../zh-CN423187/index.html">ä¿„ç½—æ–¯æˆæƒè®¤è¯æœºæ„çš„æ ¹æºè¯ä¹¦å’Œä¸­é—´è¯ä¹¦</a></li>
<li><a href="../zh-CN423189/index.html">ç ”ç©¶ï¼šä¸€åŠå…¬å¸åœ¨ä¸€ä¸ªæœˆå†…ä¿®è¡¥äº†æ¼æ´-ä¸ºä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN423191/index.html">æ¨å‡ºæµ·ä¸Šå¹³å°çš„å…ƒç´ ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN423193/index.html">é€æ­¥ä½¿ç”¨pywebpushé…ç½®Webæ¨é€é€šçŸ¥</a></li>
<li><a href="../zh-CN423197/index.html">LOLWUTï¼šæ•°æ®åº“å›¢é˜Ÿä¸­çš„è‰ºæœ¯å“</a></li>
<li><a href="../zh-CN423203/index.html">é…·å›¢é˜Ÿè´Ÿè´£äººå°†è´Ÿè´£æœåŠ¡</a></li>
<li><a href="../zh-CN423205/index.html">MS SQL Serverä¸Šçš„å­˜å‚¨é¡¹ç›®ï¼Œä¸1C 7.7é›†æˆä»¥åŠSSDTä¸­çš„å¼€å‘è‡ªåŠ¨åŒ–</a></li>
<li><a href="../zh-CN423207/index.html">å¦‚ä½•è‡ªåŠ¨æ›´æ–°åœ¨çº¿æ¸¸æˆå®¢æˆ·ç«¯</a></li>
<li><a href="../zh-CN423209/index.html">æ€æ‰‹è¡¨æ ¼2ï¼Ÿ MoonRay S100ç‰™ç§‘3Dæ‰“å°æœºæ¦‚è¿°</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>