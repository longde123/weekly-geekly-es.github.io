<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé£ üéÄ üòÆ Konfigurieren Sie IPSec Site-to-Site-VPN auf der Hardware von Palo Alto Networks üîí ü¶ê üö¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist eine Fortsetzung des vorherigen Materials zu den Funktionen des Ger√§te-Setups von Palo Alto Networks . Hier m√∂chten wir √ºber das Ei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Konfigurieren Sie IPSec Site-to-Site-VPN auf der Hardware von Palo Alto Networks</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/crosstech/blog/448952/"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/68c/d7c/a2c68cd7c6cbac21b84a65f55eb7dd33.png" alt="Bild"><br><br>  Dieser Artikel ist eine Fortsetzung des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">vorherigen Materials</a> zu den Funktionen des Ger√§te-Setups von <b>Palo Alto Networks</b> .  Hier m√∂chten wir √ºber das Einrichten von <b>IPSec Site-to-Site-VPN</b> auf Ger√§ten von <b>Palo Alto Networks</b> und √ºber eine m√∂gliche Konfigurationsoption f√ºr die Verbindung mehrerer Internetanbieter sprechen. <br><a name="habracut"></a><br>  Zur Demonstration wird das Standardschema zum Verbinden der Zentrale mit der Niederlassung verwendet.  Um eine fehlertolerante Internetverbindung bereitzustellen, nutzt die Zentrale die gleichzeitige Verbindung zweier Anbieter: ISP-1 und ISP-2.  Die Zweigstelle hat nur eine Verbindung zu einem Anbieter, ISP-3.  Zwischen den Firewalls PA-1 und PA-2 werden zwei Tunnel gebaut.  Die Tunnel arbeiten im <b>Aktiv-Standby-</b> Modus, Tunnel-1 ist aktiv, Tunnel-2 beginnt mit der √úbertragung von Verkehr, wenn Tunnel-1 ausf√§llt.  Tunnel-1 verwendet eine Verbindung zum ISP-1-Internetdienstanbieter, Tunnel-2 verwendet eine Verbindung zum ISP-2-Internetdienstanbieter.  Alle IP-Adressen werden zu Demonstrationszwecken zuf√§llig generiert und sind nicht realit√§tsbezogen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/312/8a1/67b/3128a167bfa98d8aed104e6e1e85ef22.png" alt="Bild"><br><br>  Zum Erstellen eines Site-to-Site-VPN wird <b>IPSec</b> verwendet - eine Reihe von Protokollen zum Schutz von Daten, die √ºber IP √ºbertragen werden.  <b>IPSec</b> arbeitet mit dem <b>ESP-</b> Sicherheitsprotokoll (Encapsulating Security Payload), das die Verschl√ºsselung der √ºbertragenen Daten erm√∂glicht. <br><br>  <b>IPSec</b> enth√§lt <b>IKE</b> (Internet Key Exchange), das Protokoll, das f√ºr die Aushandlung von SA-Sicherheitsparametern (Security Associations) verantwortlich ist, die zum Schutz der √ºbertragenen Daten verwendet werden.  PAN-Firewalls unterst√ºtzen <b>IKEv1</b> und <b>IKEv2</b> . <br><br>  In <b>IKEv1</b> VPN wird die Verbindung in zwei Phasen aufgebaut: <b>IKEv1 Phase 1</b> (IKE-Tunnel) und <b>IKEv1 Phase 2</b> (IPSec-Tunnel). <b>Daher</b> werden zwei Tunnel erstellt, von denen einer f√ºr den Austausch von <b>Dienstinformationen</b> zwischen Firewalls und der zweite f√ºr die Verkehrs√ºbertragung dient.  In <b>IKEv1 Phase 1</b> gibt es zwei Betriebsmodi: Hauptmodus und aggressiver Modus.  Der aggressive Modus verwendet weniger Nachrichten und ist schneller, unterst√ºtzt jedoch keinen Peer-Identit√§tsschutz. <br><br>  <b>IKEv2</b> ersetzte <b>IKEv1</b> und im Vergleich zu <b>IKEv1 besteht</b> sein Hauptvorteil in geringeren Bandbreitenanforderungen und einer schnelleren SA-Aushandlung.  <b>IKEv2</b> verwendet weniger Dienstnachrichten (insgesamt 4), unterst√ºtzt das EAP- und MOBIKE-Protokoll und f√ºgt einen Peer-Verf√ºgbarkeitspr√ºfungsmechanismus hinzu, mit dem ein Tunnel erstellt wird - <b>Liveness Check</b> , der die Dead Peer-Erkennung in IKEv1 ersetzt.  Wenn der Test fehlschl√§gt, kann <b>IKEv2</b> den Tunnel zur√ºcksetzen und dann so schnell wie m√∂glich automatisch wiederherstellen.  Hier k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie</a> mehr √ºber die Unterschiede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">lesen</a> . <br><br>  Wenn der Tunnel zwischen Firewalls verschiedener Hersteller aufgebaut ist, kann es zu Fehlern bei der Implementierung von <b>IKEv2</b> <b>kommen</b> . Aus <b>Gr√ºnden der</b> Kompatibilit√§t mit solchen Ger√§ten kann <b>IKEv1 verwendet werden</b> .  In anderen F√§llen ist es besser, <b>IKEv2</b> zu verwenden. <br><br>  Einrichtungsschritte: <br><br>  <b>‚Ä¢ Konfigurieren von zwei Internetanbietern im Active \ Standby-Modus</b> <br><br>  Es gibt verschiedene M√∂glichkeiten, diese Funktion zu implementieren.  Eine davon ist die Verwendung des <b>Pfad√ºberwachungsmechanismus</b> , der seit <b>PAN-OS 8.0.0</b> verf√ºgbar ist.  In diesem Beispiel wird Version 8.0.16 verwendet.  Diese Funktion √§hnelt IP SLA in Cisco-Routern.  Im Parameter der statischen Standardroute wird das Senden von Ping-Paketen an eine bestimmte IP-Adresse von einer bestimmten Quelladresse konfiguriert.  In diesem Fall pingt die Ethernet1 / 1-Schnittstelle das Standard-Gateway einmal pro Sekunde an.  Wenn auf drei Pings hintereinander keine Antwort erfolgt, wird die Route als nicht funktionsf√§hig betrachtet und aus der Routing-Tabelle entfernt.  Dieselbe Route wird in Richtung des zweiten Internetproviders konfiguriert, jedoch mit mehr Metriken (es handelt sich um eine Sicherung).  Sobald die erste Route aus der Tabelle entfernt wurde, sendet die Firewall Datenverkehr entlang der zweiten Route - <b>Failover</b> .  Wenn der erste Anbieter auf Pings reagiert, kehrt seine Route zur Tabelle zur√ºck und ersetzt die zweite aufgrund der besten Metrik - <b>Failback</b> .  Der <b>Failover-</b> Vorgang dauert abh√§ngig von den konfigurierten Intervallen einige Sekunden. In jedem Fall erfolgt der Vorgang jedoch nicht sofort, und zu diesem Zeitpunkt geht der Datenverkehr verloren.  <b>Fail-Back-</b> P√§sse ohne Verkehrsverlust.  Es ist m√∂glich, das <b>Failover</b> mit <b>BFD zu</b> beschleunigen, wenn Ihr ISP diese Option bietet.  <b>BFD wird</b> ab der <b>PA-3000-Serie</b> und <b>VM-100 unterst√ºtzt</b> .  Als Ping-Adresse ist es besser, nicht das Gateway des Anbieters anzugeben, sondern eine √∂ffentliche, immer zug√§ngliche Internetadresse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/459/47f/546/45947f5469df67a6ecd315180779465b.png" alt="Bild"><br><br>  <b>‚Ä¢ Erstellen einer Tunnelschnittstelle</b> <br><br>  Der Verkehr innerhalb des Tunnels wird √ºber spezielle virtuelle Schnittstellen √ºbertragen.  Jeder von ihnen muss mit einer IP-Adresse aus dem Transitnetzwerk konfiguriert sein.  In diesem Beispiel wird das Subnetz 172.16.1.0/30 f√ºr Tunnel-1 und das Subnetz 172.16.2.0/30 f√ºr Tunnel-2 verwendet. <br>  Die Tunnelschnittstelle wird im Abschnitt <b>Netzwerk -&gt; Schnittstellen -&gt; Tunnel erstellt</b> .  Sie m√ºssen den virtuellen Router und die Sicherheitszone sowie die IP-Adresse des entsprechenden Transportnetzwerks angeben.  Die Schnittstellennummer kann beliebig sein. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b06/a3d/08e/b06a3d08e1ee5088b23f5196aae51d3f.png" alt="Bild"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/13f/9e5/5b6/13f9e55b6855207fc6bc8c2be69657c7.png" alt="Bild"><br><br>  Im Abschnitt <b>Erweitert</b> k√∂nnen Sie ein <b>Verwaltungsprofil</b> angeben, das das Pingen an diese Schnittstelle erm√∂glicht. Dies kann zum Testen hilfreich sein. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b67/f4d/47a/b67f4d47a922bdf70f010be46f3e3fe2.png" alt="Bild"><br><br>  <b>‚Ä¢ Konfigurieren Sie das IKE-Profil</b> <br><br>  <b>Das IKE-Profil</b> ist f√ºr den ersten Schritt beim Erstellen einer VPN-Verbindung verantwortlich. Hier werden die Tunnelparameter der <b>IKE-Phase 1</b> angegeben.  Das Profil wird im Abschnitt <b>Netzwerk -&gt; Netzwerkprofile -&gt; IKE Crypto erstellt</b> .  Sie m√ºssen den Verschl√ºsselungsalgorithmus, das Hashing, die Diffie-Hellman-Gruppe und die Schl√ºssellebensdauer angeben.  Je komplexer die Algorithmen sind, desto schlechter ist im Allgemeinen die Leistung. Sie m√ºssen basierend auf bestimmten Sicherheitsanforderungen ausgew√§hlt werden.  Es wird jedoch dringend davon abgeraten, die Diffie-Hellman-Gruppe unter 14 Jahren zum Schutz wichtiger Informationen zu verwenden.  Dies liegt an der Sicherheitsanf√§lligkeit des Protokolls, die nur mit einer Modulgr√∂√üe von 2048 Bit oder h√∂her oder an elliptischen Kryptografiealgorithmen, die in den Gruppen 19, 20, 21, 24 verwendet werden, ausgeglichen werden kann. Diese Algorithmen sind produktiver als herk√∂mmliche Kryptografie.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Weitere Details hier</a> .  Und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ff/18a/d04/3ff18ad0457e792f86045d8b42534e39.png" alt="Bild"><br><br>  <b>‚Ä¢ Konfigurieren Sie das IPSec-Profil</b> <br><br>  Der zweite Schritt beim Erstellen einer VPN-Verbindung ist der IPSec-Tunnel.  SA-Parameter daf√ºr werden unter <b>Netzwerk -&gt; Netzwerkprofile -&gt; IPSec-Kryptoprofil</b> konfiguriert.  Hier m√ºssen Sie das IPSec-Protokoll - <b>AH</b> oder <b>ESP</b> sowie <b>SA-</b> Parameter - Hashing, Verschl√ºsselungsalgorithmen, Diffie-Hellman-Gruppen und die Lebensdauer der Schl√ºssel angeben.  Die SA-Einstellungen in IKE Crypto Profile und IPSec Crypto Profile stimmen m√∂glicherweise nicht √ºberein. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b38/5e2/30c/b385e230c1548d0c65f6b8d7ead35b29.png" alt="Bild"><br><br>  <b>‚Ä¢ Konfigurieren Sie IKE Gateway</b> <br><br>  <b>Ein IKE-Gateway</b> ist ein Objekt, das den Router oder die Firewall identifiziert, mit denen ein VPN-Tunnel erstellt wird.  F√ºr jeden Tunnel m√ºssen Sie Ihr eigenes <b>IKE-Gateway</b> erstellen.  In diesem Fall werden zwei Tunnel erstellt, einer √ºber jeden Internetprovider.  Die entsprechende ausgehende Schnittstelle und ihre IP-Adresse, Peer-IP-Adresse und gemeinsamer Schl√ºssel werden angezeigt.  Sie k√∂nnen Zertifikate als Alternative zu einem gemeinsam genutzten Schl√ºssel verwenden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a56/251/b36/a56251b36a69840ec730e50568e690e8.png" alt="Bild"><br><br>  Dies zeigt das zuvor erstellte <b>IKE-Kryptoprofil an</b> .  Die Parameter f√ºr das zweite <b>IKE Gateway-</b> Objekt sind mit Ausnahme der IP-Adressen √§hnlich.  Wenn sich die Firewall von Palo Alto Networks hinter einem NAT-Router befindet, muss der <b>NAT-Traversal-</b> Mechanismus aktiviert sein. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23b/3cc/da8/23b3ccda8c845371f4bd4e7efd41a7ea.png" alt="Bild"><br><br>  <b>‚Ä¢ Konfigurieren Sie den IPSec-Tunnel</b> <br><br>  <b>IPSec-Tunnel</b> ist ein Objekt, das die IPSec-Tunnelparameter angibt, wie der Name schon sagt.  Hier m√ºssen Sie die Tunnelschnittstelle und zuvor erstellte <b>IKE Gateway-</b> , <b>IPSec Crypto Profile-</b> Objekte angeben.  Um eine automatische Umschaltung des Routings zum Standby-Tunnel sicherzustellen, m√ºssen Sie <b>Tunnel Monitor</b> aktivieren.  Dies ist ein Mechanismus, der mithilfe des ICMP-Verkehrs √ºberpr√ºft, ob ein Peer am Leben ist.  Als Zieladresse m√ºssen Sie die IP-Adresse der Tunnelschnittstelle des Peers angeben, mit dem der Tunnel erstellt wird.  Das Profil zeigt die Timer und die Aktion bei Verbindungsverlust an.  <b>Warten Wiederherstellen</b> - Warten Sie, bis die Verbindung wiederhergestellt ist. <b>Failover</b> - Senden Sie gegebenenfalls Datenverkehr auf einer anderen Route.  Die Konfiguration des zweiten Tunnels ist v√∂llig identisch, die zweite Tunnelschnittstelle und das IKE-Gateway werden angezeigt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fdb/29c/f75/fdb29cf75864f4fcf0ca5ec1d7459dc4.png" alt="Bild"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/96c/330/1cb/96c3301cb47e3dcbb449f5174227532a.png" alt="Bild"><br><br>  <b>‚Ä¢ Routing-Setup</b> <br><br>  In diesem Beispiel wird statisches Routing verwendet.  In der PA-1-Firewall m√ºssen Sie zus√§tzlich zu zwei Standardrouten zwei Routen zum Subnetz 10.10.10.0/24 in der Verzweigung angeben.  Eine Route verwendet Tunnel-1, die andere Tunnel-2.  Die Route durch Tunnel-1 ist einfach, da sie eine niedrigere Metrik hat.  Der <b>Pfad√ºberwachungsmechanismus</b> f√ºr diese Routen wird nicht verwendet.  <b>Tunnel Monitor</b> ist f√ºr die Umschaltung verantwortlich. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f94/b4f/3ed/f94b4f3ed8ce6c2d44af95ebfaf3c1b1.png" alt="Bild"><br><br>  Die gleichen Routen f√ºr das Subnetz 192.168.30.0/24 m√ºssen auf PA-2 konfiguriert werden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bdd/a93/ffb/bdda93ffb9dc17d0765d7e6cf78515ad.png" alt="Bild"><br><br>  <b>‚Ä¢ Konfigurieren Sie Netzwerkregeln</b> <br><br>  Damit der Tunnel funktioniert, ben√∂tigen Sie drei Regeln: <br><br><ol><li>  Aktivieren Sie ICMP auf externen Schnittstellen, damit <b>Path Monitor</b> funktioniert. </li><li>  Aktivieren Sie f√ºr <b>IPSec</b> <b>ike-</b> und <b>ipsec-</b> Anwendungen auf externen Schnittstellen. </li><li>  Zulassen des Datenverkehrs zwischen internen Subnetzen und Tunnelschnittstellen. </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/157/271/34a/15727134adc31c0260c32ef6c2768248.png" alt="Bild"><br><br>  <b>Fazit</b> <br><br>  Dieser Artikel beschreibt die Konfiguration einer ausfallsicheren Internetverbindung und eines <b>Site-to-Site-VPN</b> .  Wir hoffen, dass die Informationen n√ºtzlich waren und der Leser eine Vorstellung von den in den <b>Palo Alto-Netzwerken</b> verwendeten Technologien bekam.  Wenn Sie Fragen zur Anpassung und Vorschl√§ge zu den Themen zuk√ºnftiger Artikel haben - schreiben Sie diese in die Kommentare, wir beantworten diese gerne. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de448952/">https://habr.com/ru/post/de448952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de448942/index.html">Kryptow√§hrung: lebt oder stirbt?</a></li>
<li><a href="../de448944/index.html">Fluent 1.0: Flexibles Lokalisierungssystem</a></li>
<li><a href="../de448946/index.html">So starten Sie die Anwendung von R in Enterprise. Praktisches Beispiel</a></li>
<li><a href="../de448948/index.html">Die Wissenschaft der Logik in der Programmierung</a></li>
<li><a href="../de448950/index.html">Schweizer json Verarbeitungsmesser</a></li>
<li><a href="../de448956/index.html">Wut √ºber Code: Programmierer und Negativit√§t</a></li>
<li><a href="../de448958/index.html">Wie Amazon seine scheinbar zuf√§lligen Angebote des Tages ausw√§hlt. Und warum jagen Verk√§ufer ihnen so nach?</a></li>
<li><a href="../de448960/index.html">Unbegrenzte XR-Technologie im Zeitalter des verteilten Rechnens</a></li>
<li><a href="../de448962/index.html">Die Wirksamkeit des Marketing-Trichters AARRR</a></li>
<li><a href="../de448964/index.html">Der Toaster gibt Benutzern mehr Rechte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>