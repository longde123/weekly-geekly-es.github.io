<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ŒğŸ» ğŸ•¹ï¸ ğŸ‘ğŸ¾ Kubernetesçš„å®‰å…¨åŸºç¡€çŸ¥è¯†ï¼šèº«ä»½éªŒè¯ï¼Œæˆæƒï¼Œå®¡è®¡ â¬‡ï¸ ğŸ•Šï¸ â›´ï¸</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ä»»ä½•ç³»ç»Ÿçš„è¿è¡Œè¿Ÿæ—©éƒ½ä¼šå¼•å‘å®‰å…¨æ€§é—®é¢˜ï¼šç¡®ä¿èº«ä»½éªŒè¯ï¼Œæƒé™åˆ†ç¦»ï¼Œå®¡è®¡å’Œå…¶ä»–ä»»åŠ¡ã€‚ å·²ç»ä¸ºKubernetesåˆ›å»ºäº†è®¸å¤šè§£å†³æ–¹æ¡ˆ ï¼Œå³ä½¿åœ¨éå¸¸è‹›åˆ»çš„ç¯å¢ƒä¸­ä¹Ÿå¯ä»¥å®ç°æ ‡å‡†åˆè§„æ€§ã€‚ç›¸åŒçš„ææ–™ä¸“é—¨ç”¨äºåœ¨K8å†…ç½®æœºåˆ¶çš„æ¡†æ¶å†…å®ç°çš„åŸºæœ¬å®‰å…¨æ–¹é¢ã€‚ é¦–å…ˆï¼Œå¯¹äºå¼€å§‹äº†è§£Kubernetesçš„äººæ¥è¯´ï¼Œè¿™å°†æ˜¯æœ‰ç”¨çš„ï¼Œå®ƒæ˜¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kubernetesçš„å®‰å…¨åŸºç¡€çŸ¥è¯†ï¼šèº«ä»½éªŒè¯ï¼Œæˆæƒï¼Œå®¡è®¡</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/468679/"><img src="https://habrastorage.org/webt/ao/pp/ke/aoppkeeufk5-tv1rmtmtw9oce7a.png"><br><br> ä»»ä½•ç³»ç»Ÿçš„è¿è¡Œè¿Ÿæ—©éƒ½ä¼šå¼•å‘å®‰å…¨æ€§é—®é¢˜ï¼šç¡®ä¿èº«ä»½éªŒè¯ï¼Œæƒé™åˆ†ç¦»ï¼Œå®¡è®¡å’Œå…¶ä»–ä»»åŠ¡ã€‚ å·²ç»ä¸ºKubernetesåˆ›å»ºäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¸å¤šè§£å†³æ–¹æ¡ˆ</a> ï¼Œå³ä½¿åœ¨éå¸¸è‹›åˆ»çš„ç¯å¢ƒä¸­ä¹Ÿå¯ä»¥å®ç°æ ‡å‡†åˆè§„æ€§ã€‚ç›¸åŒçš„ææ–™ä¸“é—¨ç”¨äºåœ¨K8å†…ç½®æœºåˆ¶çš„æ¡†æ¶å†…å®ç°çš„åŸºæœ¬å®‰å…¨æ–¹é¢ã€‚ é¦–å…ˆï¼Œå¯¹äºå¼€å§‹äº†è§£Kubernetesçš„äººæ¥è¯´ï¼Œè¿™å°†æ˜¯æœ‰ç”¨çš„ï¼Œå®ƒæ˜¯ç ”ç©¶å®‰å…¨é—®é¢˜çš„èµ·ç‚¹ã€‚ <a name="habracut"></a><br><br><h2> è®¤è¯æ–¹å¼ </h2><br>  Kubernetesæœ‰ä¸¤ç§ç±»å‹çš„ç”¨æˆ·ï¼š <br><br><ul><li>  <i>æœåŠ¡å¸æˆ·</i> -ç”±Kubernetes APIç®¡ç†çš„å¸æˆ·ï¼› </li><li>  <i>ç”¨æˆ·</i> -ç”±å¤–éƒ¨ç‹¬ç«‹æœåŠ¡æ§åˆ¶çš„â€œæ™®é€šâ€ç”¨æˆ·ã€‚ </li></ul><br> è¿™äº›ç±»å‹ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¯¹äºæœåŠ¡å¸æˆ·ï¼ŒKubernetes APIä¸­æœ‰ä¸€äº›ç‰¹æ®Šçš„å¯¹è±¡ï¼ˆå®ƒä»¬ç§°ä¸º<code>ServiceAccounts</code> ï¼‰ï¼Œè¿™äº›å¯¹è±¡ä¸åç§°ç©ºé—´å’Œå­˜å‚¨åœ¨é›†ç¾¤ä¸­ç±»å‹ä¸ºSecretsçš„å¯¹è±¡ä¸­çš„æˆæƒæ•°æ®é›†ç›¸å…³ã€‚ æ­¤ç±»ç”¨æˆ·ï¼ˆæœåŠ¡å¸æˆ·ï¼‰ä¸»è¦ç”¨äºç®¡ç†å¯¹åœ¨Kubernetesé›†ç¾¤ä¸­è¿è¡Œçš„Kubernetes APIè¿›ç¨‹çš„è®¿é—®æƒé™ã€‚ <br><br> æ™®é€šç”¨æˆ·åœ¨Kubernetes APIä¸­æ²¡æœ‰æ¡ç›®ï¼šå®ƒä»¬å¿…é¡»ç”±å¤–éƒ¨æœºåˆ¶ç®¡ç†ã€‚ å®ƒä»¬é€‚ç”¨äºå±…ä½åœ¨é›†ç¾¤å¤–éƒ¨çš„äººå‘˜æˆ–æµç¨‹ã€‚ <br><br> å¯¹APIçš„æ¯ä¸ªè¯·æ±‚éƒ½ç»‘å®šåˆ°æœåŠ¡å¸æˆ·æˆ–ç”¨æˆ·ï¼Œæˆ–è€…è¢«è§†ä¸ºåŒ¿åã€‚ <br><br> ç”¨æˆ·è®¤è¯æ•°æ®åŒ…æ‹¬ï¼š <br><br><ul><li>  <i>ç”¨æˆ·</i>å-ç”¨æˆ·åï¼ˆåŒºåˆ†å¤§å°å†™ï¼ï¼‰ï¼› </li><li>  <i>UID</i>æ˜¯æœºå™¨å¯è¯»çš„ç”¨æˆ·æ ‡è¯†å­—ç¬¦ä¸²ï¼Œâ€œæ¯”ç”¨æˆ·åæ›´ä¸€è‡´å’Œå”¯ä¸€â€ï¼› </li><li>  <i>ç»„</i> -ç”¨æˆ·æ‰€å±çš„ç»„åˆ—è¡¨ï¼› </li><li>  <i>é¢å¤–</i> -æˆæƒæœºåˆ¶å¯ä»¥ä½¿ç”¨çš„å…¶ä»–å­—æ®µã€‚ </li></ul><br>  Kuberneteså¯ä»¥ä½¿ç”¨å¤šç§èº«ä»½éªŒè¯æœºåˆ¶ï¼šX509è¯ä¹¦ï¼Œæ‰¿è½½ä»¤ç‰Œï¼Œèº«ä»½éªŒè¯ä»£ç†ï¼ŒHTTPåŸºæœ¬èº«ä»½éªŒè¯ã€‚ ä½¿ç”¨è¿™äº›æœºåˆ¶ï¼Œå¯ä»¥å®ç°å¤§é‡çš„æˆæƒæ–¹æ¡ˆï¼šä»å¸¦æœ‰å¯†ç çš„é™æ€æ–‡ä»¶åˆ°OpenID OAuth2ã€‚ <br><br> æ­¤å¤–ï¼ŒåŒæ—¶å…è®¸å¤šä¸ªæˆæƒæ–¹æ¡ˆã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä½¿ç”¨ï¼š <br><br><ul><li> æœåŠ¡å¸æˆ·ä»¤ç‰Œ-ç”¨äºæœåŠ¡å¸æˆ·ï¼› </li><li>  X509-é€‚ç”¨äºç”¨æˆ·ã€‚ </li></ul><br> æœ‰å…³ServiceAccountsç®¡ç†çš„é—®é¢˜ä¸åœ¨æœ¬æ–‡çš„è®¨è®ºèŒƒå›´ä¹‹å†…ï¼Œä½†æ˜¯æˆ‘å»ºè®®å¼€å§‹ä»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£é¡µé¢</a>å¼€å§‹å­¦ä¹ æœ‰å…³æ­¤é—®é¢˜çš„æ›´å¤šä¿¡æ¯ã€‚ æˆ‘ä»¬å°†æ›´è¯¦ç»†åœ°è€ƒè™‘X509è¯ä¹¦çš„å·¥ä½œé—®é¢˜ã€‚ <br><br><h3> ç”¨æˆ·è¯ä¹¦ï¼ˆX.509ï¼‰ </h3><br> ä½¿ç”¨è¯ä¹¦çš„ç»å…¸æ–¹æ³•åŒ…æ‹¬ï¼š <br><br><ul><li> å¯†é’¥ç”Ÿæˆï¼š <br><br><pre> <code class="bash hljs">mkdir -p ~/mynewuser/.certs/ openssl genrsa -out ~/.certs/mynewuser.key 2048</code> </pre> </li><li> è¯ä¹¦ç”³è¯·ç”Ÿæˆï¼š <br><br><pre> <code class="bash hljs">openssl req -new -key ~/.certs/mynewuser.key -out ~/.certs/mynewuser.csr -subj <span class="hljs-string"><span class="hljs-string">"/CN=mynewuser/O=company"</span></span></code> </pre> </li><li> ä½¿ç”¨Kubernetesé›†ç¾¤CAå¯†é’¥å¤„ç†è¯ä¹¦è¯·æ±‚ï¼Œè·å–ç”¨æˆ·è¯ä¹¦ï¼ˆè¦è·å–è¯ä¹¦ï¼Œæ‚¨éœ€è¦ä½¿ç”¨æœ‰æƒè®¿é—®Kubernetesé›†ç¾¤è¯ä¹¦é¢å‘æœºæ„å¯†é’¥çš„å¸æˆ·ï¼Œè¯¥å¸æˆ·é»˜è®¤ä½äº<code>/etc/kubernetes/pki/ca.key</code> ï¼‰ï¼š <br><br><pre> <code class="bash hljs">openssl x509 -req -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ~/.certs/mynewuser.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out ~/.certs/mynewuser.crt -days 500</code> </pre> </li><li> åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š <br><ul><li> ç¾¤é›†è¯´æ˜ï¼ˆæŒ‡å®šç‰¹å®šç¾¤é›†å®‰è£…çš„CAè¯ä¹¦æ–‡ä»¶çš„åœ°å€å’Œä½ç½®ï¼‰ï¼š <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-cluster kubernetes --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.100.200:6443</code> </pre> </li><li> æˆ–è€…-å¦‚æœ<b>ä¸æ˜¯</b>æ¨èçš„é€‰é¡¹-æ‚¨å¯ä»¥çœç•¥æ ¹è¯ä¹¦ï¼ˆç„¶åï¼Œkubectlå°†ä¸ä¼šæ£€æŸ¥apiæœåŠ¡å™¨é›†ç¾¤çš„æ­£ç¡®æ€§ï¼‰ï¼š <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-cluster kubernetes --insecure-skip-tls-verify=<span class="hljs-literal"><span class="hljs-literal">true</span></span> --server=https://192.168.100.200:6443</code> </pre> </li><li> å°†ç”¨æˆ·æ·»åŠ åˆ°é…ç½®æ–‡ä»¶ï¼š <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-credentials mynewuser --client-certificate=.certs/mynewuser.crt --client-key=.certs/mynewuser.key</code> </pre> </li><li> æ·»åŠ ä¸Šä¸‹æ–‡ï¼š <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-context mynewuser-context --cluster=kubernetes --namespace=target-namespace --user=mynewuser</code> </pre> </li><li> é»˜è®¤ä¸Šä¸‹æ–‡åˆ†é…ï¼š <br><br><pre> <code class="bash hljs">kubectl config use-context mynewuser-context</code> </pre> </li></ul></li></ul><br> ç»è¿‡ä¸Šè¿°æ“ä½œåï¼Œå°†åœ¨<code>.kube/config</code>æ–‡ä»¶ä¸­åˆ›å»ºè¡¨å•çš„<code>.kube/config</code> ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: v1 clusters: - cluster: certificate-authority: /etc/kubernetes/pki/ca.crt server: https://192.168.100.200:6443 name: kubernetes contexts: - context: cluster: kubernetes namespace: target-namespace user: mynewuser name: mynewuser-context current-context: mynewuser-context kind: Config preferences: {} users: - name: mynewuser user: client-certificate: /home/mynewuser/.certs/mynewuser.crt client-key: /home/mynewuser/.certs/mynewuser.key</code> </pre> <br> ä¸ºäº†ä¾¿äºåœ¨å¸æˆ·å’ŒæœåŠ¡å™¨ä¹‹é—´è½¬ç§»é…ç½®ï¼Œç¼–è¾‘ä»¥ä¸‹é”®çš„å€¼å¾ˆæœ‰ç”¨ï¼š <br><br><ul><li> <code>certificate-authority</code> </li> <li> <code>client-certificate</code> </li> <li> <code>client-key</code> </li> </ul><br> ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨base64å¯¹å…¶ä¸­æŒ‡ç¤ºçš„æ–‡ä»¶è¿›è¡Œç¼–ç ï¼Œç„¶åé€šè¿‡å°†åç¼€<code>-data</code>æ·»åŠ åˆ°å¯†é’¥åç§°ä¸­æ¥å°†å®ƒä»¬æ³¨å†Œåˆ°é…ç½®ä¸­ï¼Œå³ è·å–<code>certificate-authority-data</code>ç­‰ <br><br><h3> è¯ä¹¦ä¸kubeadm </h3><br> éšç€<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetes 1.15</a>çš„å‘å¸ƒï¼Œç”±äº<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubeadmå®ç”¨ç¨‹åº</a>æ”¯æŒçš„alphaç‰ˆæœ¬ï¼Œä½¿ç”¨è¯ä¹¦å˜å¾—æ›´åŠ å®¹æ˜“ã€‚ ä¾‹å¦‚ï¼Œè¿™å°±æ˜¯ç°åœ¨ä½¿ç”¨ç”¨æˆ·å¯†é’¥ç”Ÿæˆé…ç½®æ–‡ä»¶çš„æ ·å­ï¼š <br><br><pre> <code class="bash hljs">kubeadm alpha kubeconfig user --client-name=mynewuser --apiserver-advertise-address 192.168.100.200</code> </pre> <br>  <i><b>æ³¨æ„</b> ï¼šå¯ä»¥åœ¨api-serveré…ç½®ä¸­æŸ¥çœ‹æ‰€éœ€çš„<i>å¹¿å‘Šåœ°å€</i> ï¼Œè¯¥é…ç½®é»˜è®¤ä½äº<code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> ã€‚</i> <br><br> ç”Ÿæˆçš„é…ç½®å°†è¾“å‡ºåˆ°stdoutã€‚ å®ƒå¿…é¡»ä¿å­˜åœ¨ç”¨æˆ·å¸æˆ·çš„<code>~/.kube/config</code>æˆ–<code>KUBECONFIG</code>ç¯å¢ƒ<code>KUBECONFIG</code>æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚ <br><br><h3> æ·±å…¥æŒ–æ˜ </h3><br> å¯¹äºé‚£äº›å¸Œæœ›å½»åº•äº†è§£æ‰€æè¿°é—®é¢˜çš„äººï¼š <br><br><ul><li>  Kuberneteså®˜æ–¹æ–‡æ¡£ä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¦æœ‰ä¸€ç¯‡</a>å…³äºä½¿ç”¨è¯ä¹¦çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« </a> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bitnamiçš„ä¸€ç¯‡å¥½æ–‡ç« </a> ï¼Œä»å®ç”¨çš„è§’åº¦è§£å†³äº†è¯ä¹¦é—®é¢˜ã€‚ </li><li>  Kubernetesä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¸¸è§„</a>èº«ä»½éªŒè¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚ </li></ul><br><h2> ç™»å…¥ </h2><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œé€šè¿‡èº«ä»½éªŒè¯çš„å¸æˆ·æ— æƒåœ¨ç¾¤é›†ä¸­æ‰§è¡Œæ“ä½œã€‚  Kuberneteså…·æœ‰ç”¨äºæˆäºˆæƒé™çš„æˆæƒæœºåˆ¶ã€‚ <br><br> åœ¨1.6ç‰ˆä¹‹å‰ï¼ŒKubernetesä½¿ç”¨ä¸€ç§ç§°ä¸º<b>ABAC</b> ï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰çš„èº«ä»½éªŒè¯ç±»å‹ã€‚ å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£ä¸­</a>æ‰¾åˆ°æœ‰å…³å®ƒçš„è¯¦ç»†ä¿¡æ¯ã€‚ ç›®å‰ï¼Œè¿™ç§æ–¹æ³•è¢«è®¤ä¸ºæ˜¯æ—§æ–¹æ³•ï¼Œä½†æ˜¯æ‚¨ä»ç„¶å¯ä»¥ä¸å…¶ä»–ç±»å‹çš„æˆæƒåŒæ—¶ä½¿ç”¨ã€‚ <br><br> åˆ’åˆ†ç¾¤é›†è®¿é—®æƒé™çš„å®é™…ï¼ˆæ›´çµæ´»ï¼‰æ–¹æ³•ç§°ä¸º<b>RBAC</b> ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶</a> ï¼‰ã€‚ è‡ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetes 1.8</a>ä»¥æ¥ï¼Œå®ƒå·²è¢«å®£å¸ƒç¨³å®šã€‚  RBACå®ç°äº†ä¸€ç§æƒé™æ¨¡å‹ï¼Œè¯¥æ¨¡å‹ç¦æ­¢ä»»ä½•æœªæ˜ç¡®å…è®¸çš„å†…å®¹ã€‚ <br>  <b>è¦å¯ç”¨RBAC</b> ï¼Œæ‚¨éœ€è¦ä½¿ç”¨--authorization <code>--authorization-mode=RBAC</code>é€‰é¡¹è¿è¡ŒKubernetes api-serverã€‚ å‚æ•°æ˜¯ä½¿ç”¨api-serveré…ç½®åœ¨æ¸…å•ä¸­è®¾ç½®çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥æ–‡ä»¶ä½äº<code>command</code>éƒ¨åˆ†ä¸­çš„è·¯å¾„<code>/etc/kubernetes/manifests/kube-apiserver.yaml</code>ä¸­ã€‚ ä½†æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹å·²å¯ç”¨RBACï¼Œå› æ­¤æ‚¨å¯èƒ½ä¸å¿…æ‹…å¿ƒï¼šæ‚¨å¯ä»¥é€šè¿‡<code>authorization-mode</code>çš„å€¼ï¼ˆåœ¨å·²æåŠçš„<code>kube-apiserver.yaml</code> ï¼‰è¿›è¡ŒéªŒè¯ã€‚ é¡ºä¾¿è¯´ä¸€å¥ï¼Œåœ¨å…¶å€¼ä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–ç±»å‹çš„æˆæƒï¼ˆ <code>node</code> ï¼Œ <code>webhook</code> ï¼Œ <code>always allow</code> ï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬å°†å…¶ä¿ç•™åœ¨ææ–™èŒƒå›´ä¹‹å¤–ã€‚ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä»¬å·²ç»å‘è¡¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†ä¸€ç¯‡æ–‡ç« ï¼Œ</a>å…¶ä¸­åŒ…å«æœ‰å…³ä½¿ç”¨RBACçš„åŸç†å’ŒåŠŸèƒ½çš„ç›¸å½“è¯¦ç»†çš„æ•…äº‹ï¼Œå› æ­¤æˆ‘å°†è¿›ä¸€æ­¥é™åˆ¶è‡ªå·±çš„åŸºç¡€çŸ¥è¯†å’Œç¤ºä¾‹æ¸…å•ã€‚ <br><br> ä»¥ä¸‹APIå®ä½“ç”¨äºæ§åˆ¶é€šè¿‡RBACå¯¹Kubernetesçš„è®¿é—®ï¼š <br><br><ul><li>  <code>Role</code>å’Œ<code>ClusterRole</code>æ˜¯æè¿°ç‰¹æƒçš„è§’è‰²ï¼š </li><li>  <code>Role</code>å…è®¸æ‚¨æè¿°åç§°ç©ºé—´ä¸­çš„æƒé™ï¼› </li><li>  <code>ClusterRole</code>ç¾¤é›†å†…ï¼ŒåŒ…æ‹¬ç‰¹å®šäºç¾¤é›†çš„å¯¹è±¡ï¼Œä¾‹å¦‚èŠ‚ç‚¹ï¼Œéèµ„æºurlï¼ˆå³ä¸Kubernetesèµ„æºæ— å…³-ä¾‹å¦‚<code>/version</code> ï¼Œ <code>/logs</code>å’Œ<code>/api*</code> ï¼‰; </li><li>  <code>RoleBinding</code>å’Œ<code>ClusterRoleBinding</code>ç”¨äºå°†<code>Role</code>å’Œ<code>ClusterRole</code>ç»‘å®šåˆ°ç”¨æˆ·ï¼Œç”¨æˆ·ç»„æˆ–ServiceAccountã€‚ </li></ul><br> å®ä½“Roleå’ŒRoleBindingå—åç§°ç©ºé—´é™åˆ¶ï¼Œå³ å¿…é¡»åœ¨åŒä¸€åç§°ç©ºé—´å†…ã€‚ ä½†æ˜¯ï¼ŒRoleBindingå¯ä»¥å¼•ç”¨ClusterRoleï¼Œå®ƒå…è®¸æ‚¨åˆ›å»ºä¸€ç»„æ ‡å‡†æƒé™å¹¶ä½¿ç”¨å®ƒä»¬æ¥æ§åˆ¶è®¿é—®ã€‚ <br><br> è§’è‰²ä½¿ç”¨åŒ…å«ä»¥ä¸‹å†…å®¹çš„è§„åˆ™é›†æè¿°æƒé™ï¼š <br><br><ul><li>  APIç»„-è¯·å‚é˜…apiGroupsçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a>ä»¥åŠ<code>kubectl api-resources</code>çš„è¾“å‡ºï¼› </li><li> èµ„æºï¼ˆ <i>èµ„æº</i> ï¼š <code>pod</code> ï¼Œ <code>namespace</code> ï¼Œ <code>deployment</code>ç­‰ï¼‰ï¼› </li><li> åŠ¨è¯ï¼ˆ <i>åŠ¨è¯</i> ï¼š <code>set</code> ï¼Œ <code>update</code>ç­‰ï¼‰ã€‚ </li><li> èµ„æºåç§°ï¼ˆ <code>resourceNames</code> ï¼‰-é€‚ç”¨äºéœ€è¦æä¾›å¯¹ç‰¹å®šèµ„æºè€Œéæ­¤ç±»å‹æ‰€æœ‰èµ„æºçš„è®¿é—®æƒé™çš„æƒ…å†µã€‚ </li></ul><br> å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£</a>é¡µé¢ä¸Šæ‰¾åˆ°æœ‰å…³Kubernetesä¸­æˆæƒçš„æ›´è¯¦ç»†è®¨è®ºã€‚ å–è€Œä»£ä¹‹ï¼ˆæˆ–è€…è¯´ï¼Œé™¤æ­¤ä¹‹å¤–ï¼‰ï¼Œæˆ‘å°†ä¸¾ä¾‹è¯´æ˜å…¶å·¥ä½œã€‚ <br><br><h3>  RBACå®ä½“ç¤ºä¾‹ </h3><br> ä¸€ä¸ªç®€å•çš„<code>Role</code> ï¼Œå¯è®©æ‚¨è·å–podçš„åˆ—è¡¨å’ŒçŠ¶æ€ï¼Œå¹¶åœ¨<code>target-namespace</code>å¯¹å…¶è¿›è¡Œç›‘è§†ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: namespace: target-namespace name: pod-reader rules: - apiGroups: [""] resources: ["pods"] verbs: ["get", "watch", "list"]</code> </pre> <br> ä¸€ä¸ª<code>ClusterRole</code>çš„ç¤ºä¾‹ï¼Œå®ƒå…è®¸æ‚¨è·å–<code>ClusterRole</code>çš„åˆ—è¡¨å’ŒçŠ¶æ€å¹¶åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ç›‘è§†å®ƒä»¬ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRole metadata: #  "namespace" ,   ClusterRole    name: pod-reader rules: - apiGroups: [""] resources: ["pods"] verbs: ["get", "watch", "list"]</code> </pre> <br> ç¤ºä¾‹<code>RoleBinding</code> ï¼Œå®ƒå…è®¸ç”¨æˆ·<code>mynewuser</code>åœ¨<code>my-namespace</code> â€œè¯»å–â€ podï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: read-pods namespace: target-namespace subjects: - kind: User name: mynewuser #     ! apiGroup: rbac.authorization.k8s.io roleRef: kind: Role #    â€œRoleâ€  â€œClusterRoleâ€ name: pod-reader #  Role,      namespace, #   ClusterRole,   #    apiGroup: rbac.authorization.k8s.io</code> </pre> <br><h2> æ´»åŠ¨å®¡æ ¸ </h2><br> åœ¨ç¤ºæ„å›¾ä¸Šï¼ŒKubernetesçš„ä½“ç³»ç»“æ„å¯ä»¥è¡¨ç¤ºå¦‚ä¸‹ï¼š <br><br><img src="https://habrastorage.org/getpro/habr/post_images/617/793/499/6177934998b4bf1c5c8816c75beaef3f.png" alt="å›¾ç‰‡"><br><br> è´Ÿè´£å¤„ç†è¯·æ±‚çš„Kubernetesçš„å…³é”®ç»„ä»¶æ˜¯<b>api-server</b> ã€‚ é›†ç¾¤ä¸Šçš„æ‰€æœ‰æ“ä½œéƒ½å°†é€šè¿‡å®ƒã€‚ åœ¨æ–‡ç« â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¼€å§‹è¿è¡Œkubectlæ—¶åœ¨Kubernetesä¸­ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</a> â€ä¸­è¯¦ç»†äº†è§£è¿™äº›å†…éƒ¨æœºåˆ¶<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a>  â€ã€‚ <br><br> ç³»ç»Ÿå®¡æ ¸æ˜¯Kubernetesä¸­ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸‹å·²å…³é—­ã€‚ å®ƒå…è®¸æ‚¨è®°å½•å¯¹Kubernetes APIçš„æ‰€æœ‰è°ƒç”¨ã€‚ æ‚¨å¾ˆå®¹æ˜“çŒœåˆ°ï¼Œé€šè¿‡æ­¤APIï¼Œå°†æ‰§è¡Œä¸ç›‘è§†å’Œæ›´æ”¹ç¾¤é›†çŠ¶æ€æœ‰å…³çš„æ‰€æœ‰æ“ä½œã€‚ ä¸å¾€å¸¸ä¸€æ ·ï¼Œå¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹çš„</a> K8s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>æ‰¾åˆ°å…¶åŠŸèƒ½çš„è¯¦ç»†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¯´æ˜</a> ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘å°†å°è¯•ä»¥ä¸€ç§ç®€å•çš„è¯­è¨€æ¥ä»‹ç»è¯¥ä¸»é¢˜ã€‚ <br><br> å› æ­¤ï¼Œ <b>è¦å¯ç”¨å®¡æ ¸</b> ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸‰ä¸ªå¿…éœ€çš„å‚æ•°ä¼ é€’ç»™apiæœåŠ¡å™¨ä¸­çš„å®¹å™¨ï¼Œä»¥ä¸‹å°†å¯¹å…¶è¿›è¡Œè¯¦ç»†è¯´æ˜ï¼š <br><br><ul><li> <code>--audit-policy-file=/etc/kubernetes/policies/audit-policy.yaml</code> </li> <li> <code>--audit-log-path=/var/log/kube-audit/audit.log</code> </li> <li> <code>--audit-log-format=json</code> </li> </ul><br> é™¤äº†è¿™ä¸‰ä¸ªå¿…éœ€å‚æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰è®¸å¤šå…¶ä»–ä¸å®¡æ ¸ç›¸å…³çš„è®¾ç½®ï¼šä»æ—¥å¿—è½®æ¢åˆ°Webhookæè¿°ã€‚ æ—¥å¿—è½®æ¢å‚æ•°ç¤ºä¾‹ï¼š <br><br><ul><li> <code>--audit-log-maxbackup=10</code> </li> <li> <code>--audit-log-maxsize=100</code> </li> <li> <code>--audit-log-maxage=7</code> </li> </ul><br> ä½†æ˜¯æˆ‘ä»¬ä¸ä¼šæ›´è¯¦ç»†åœ°ä»‹ç»å®ƒä»¬-æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kube-apiserver</a>çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£ä¸­</a>æ‰¾åˆ°æ‰€æœ‰è¯¦ç»†ä¿¡æ¯ã€‚ <br><br> å¦‚å‰æ‰€è¿°ï¼Œæ‰€æœ‰å‚æ•°å‡åœ¨apiéƒ¨åˆ†ä¸­çš„api-serveré…ç½®ï¼ˆé»˜è®¤ä¸º<code>/etc/kubernetes/manifests/kube-apiserver.yaml</code> ï¼‰ä¸­è®¾ç½®ã€‚ è®©æˆ‘ä»¬å›åˆ°3ä¸ªå¿…éœ€å‚æ•°å¹¶è¿›è¡Œåˆ†æï¼š <br><br><ol><li>  <code>audit-policy-file</code> file-å¸¦æœ‰å®¡æ ¸ç­–ç•¥è¯´æ˜çš„YAMLæ–‡ä»¶çš„è·¯å¾„ã€‚ æˆ‘ä»¬å°†è¿”å›å…¶å†…å®¹ï¼Œä½†æ˜¯ç°åœ¨æˆ‘æ³¨æ„åˆ°è¯¥æ–‡ä»¶åº”è¯¥å¯ä»¥é€šè¿‡api-serverè¿›ç¨‹è¿›è¡Œè¯»å–ã€‚ å› æ­¤ï¼Œæœ‰å¿…è¦å°†å…¶å®‰è£…åœ¨å®¹å™¨å†…ï¼Œä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°é…ç½®çš„ç›¸åº”éƒ¨åˆ†ï¼š <br><br><pre> <code class="plaintext hljs"> volumeMounts: - mountPath: /etc/kubernetes/policies name: policies readOnly: true volumes: - hostPath: path: /etc/kubernetes/policies type: DirectoryOrCreate name: policies</code> </pre> </li><li>  <code>audit-log-path</code>æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„ã€‚ è·¯å¾„ä¹Ÿåº”è¯¥å¯ä¾›api-serverè¿›ç¨‹è®¿é—®ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ç±»ä¼¼åœ°æè¿°å…¶å®‰è£…ï¼š <br><br><pre> <code class="plaintext hljs"> volumeMounts: - mountPath: /var/log/kube-audit name: logs readOnly: false volumes: - hostPath: path: /var/log/kube-audit type: DirectoryOrCreate name: logs</code> </pre> </li><li>  <code>audit-log-format</code> ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯<code>json</code> ï¼Œä½†æ˜¯æ—§æ–‡æœ¬æ ¼å¼ä¹Ÿå¯ç”¨ã€‚ </li></ol><br><h3> å®¡æ ¸æ”¿ç­– </h3><br> ç°åœ¨å…³äºæåˆ°çš„æ–‡ä»¶ä»¥åŠæ—¥å¿—è®°å½•ç­–ç•¥çš„æè¿°ã€‚ å®¡æ ¸ç­–ç•¥çš„ç¬¬ä¸€ä¸ªæ¦‚å¿µæ˜¯<code>level</code> ï¼Œå³<b>æ—¥å¿—è®°å½•çº§åˆ«</b> ã€‚ å®ƒä»¬å¦‚ä¸‹ï¼š <br><br><ul><li>  <code>None</code> -ä¸ç™»å½•ï¼› </li><li>  <code>Metadata</code> -è®°å½•è¯·æ±‚å…ƒæ•°æ®ï¼šç”¨æˆ·ï¼Œè¯·æ±‚æ—¶é—´ï¼Œç›®æ ‡èµ„æºï¼ˆpodï¼Œåç§°ç©ºé—´ç­‰ï¼‰ï¼Œæ“ä½œç±»å‹ï¼ˆåŠ¨è¯ï¼‰ç­‰ï¼› </li><li>  <code>Request</code> -è®°å½•å…ƒæ•°æ®å’Œè¯·æ±‚æ­£æ–‡ï¼› </li><li>  <code>RequestResponse</code>å…ƒæ•°æ®ï¼Œè¯·æ±‚æ­£æ–‡å’Œå“åº”æ­£æ–‡ã€‚ </li></ul><br> æœ€åä¸¤ä¸ªçº§åˆ«ï¼ˆ <code>Request</code>å’Œ<code>RequestResponse</code> ï¼‰ä¸è®°å½•æœªè®¿é—®èµ„æºçš„è¯·æ±‚ï¼ˆå¯¹æ‰€è°“çš„éèµ„æºurlçš„è°ƒç”¨ï¼‰ã€‚ <br><br> æ­¤å¤–ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ç»è¿‡<b>å‡ ä¸ªé˜¶æ®µ</b> ï¼š <br><br><ul><li>  <code>RequestReceived</code>å¤„ç†ç¨‹åºæ¥æ”¶åˆ°è¯·æ±‚ä½†å°šæœªæ²¿ç€å¤„ç†ç¨‹åºé“¾è¿›ä¸€æ­¥è½¬ç§»çš„é˜¶æ®µï¼› </li><li>  <code>ResponseStarted</code>å‘é€å“åº”å¤´ï¼Œä½†åœ¨å‘é€å“åº”ä¸»ä½“ä¹‹å‰ã€‚ ä¸ºé•¿æ—¶é—´æŸ¥è¯¢è€Œç”Ÿæˆï¼ˆä¾‹å¦‚<code>watch</code> ï¼‰ï¼› </li><li>  <code>ResponseComplete</code>å‘é€å“åº”ä¸»ä½“ï¼Œå°†ä¸å‘é€æ›´å¤šä¿¡æ¯ï¼› </li><li>  <code>Panic</code> -æ£€æµ‹åˆ°ç´§æ€¥æƒ…å†µæ—¶ä¼šç”Ÿæˆäº‹ä»¶ã€‚ </li></ul><br> æ‚¨å¯ä»¥ä½¿ç”¨<code>omitStages</code>è·³è¿‡ä»»ä½•é˜¶æ®µã€‚ <br><br> åœ¨ç­–ç•¥æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æè¿°å…·æœ‰ä¸åŒæ—¥å¿—çº§åˆ«çš„å‡ ä¸ªéƒ¨åˆ†ã€‚ ç­–ç•¥è¯´æ˜ä¸­æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªåŒ¹é…è§„åˆ™å°†é€‚ç”¨ã€‚ <br><br>  kubeletå®ˆæŠ¤ç¨‹åºä½¿ç”¨api-serveré…ç½®ç›‘è§†æ¸…å•æ›´æ”¹ï¼Œå¦‚æœæ£€æµ‹åˆ°ä»»ä½•æ›´æ”¹ï¼Œå®ƒå°†ä½¿ç”¨api-serveré‡æ–°å¯åŠ¨å®¹å™¨ã€‚ ä½†æ˜¯æœ‰ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚ï¼š <b>ä»–ä»¬å°†å¿½ç•¥å¯¹ç­–ç•¥æ–‡ä»¶çš„æ›´æ”¹</b> ã€‚ æ›´æ”¹ç­–ç•¥æ–‡ä»¶åï¼Œæ‚¨å°†éœ€è¦æ‰‹åŠ¨é‡æ–°å¯åŠ¨api-serverã€‚ ç”±äºapi-serverä½œä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é™æ€pod</a>è¿è¡Œï¼Œå› æ­¤<code>kubectl delete</code>å‘½ä»¤ä¸ä¼šé‡æ–°å¯åŠ¨å®ƒã€‚ æ‚¨å°†å¿…é¡»æ‰‹åŠ¨ä½¿dockeråœ¨æ›´æ”¹äº†å®¡æ ¸ç­–ç•¥çš„kube-masterä¸Š<code>docker stop</code> ï¼š <br><br><pre> <code class="bash hljs">docker stop $(docker ps | grep k8s_kube-apiserver | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>)</code> </pre> <br> å¯ç”¨å®¡æ ¸æ—¶ï¼Œè¯·åŠ¡å¿…è®°ä½<b>kube-apiserverå…·æœ‰è¾ƒé«˜çš„è´Ÿè½½</b> ã€‚ ç‰¹åˆ«æ˜¯ï¼Œç”¨äºå­˜å‚¨è¯·æ±‚ä¸Šä¸‹æ–‡çš„å†…å­˜æ¶ˆè€—æ­£åœ¨å¢åŠ ã€‚ ä»…åœ¨å‘é€å“åº”å¤´ä¹‹åæ‰å¼€å§‹è®°å½•æ—¥å¿—ã€‚ åŒæ ·ï¼Œè´Ÿè½½å–å†³äºå®¡æ ¸ç­–ç•¥çš„é…ç½®ã€‚ <br><br><h3> æ”¿ç­–èŒƒä¾‹ </h3><br> è®©æˆ‘ä»¬ä½¿ç”¨ç¤ºä¾‹åˆ†æç­–ç•¥æ–‡ä»¶çš„ç»“æ„ã€‚ <br><br> è¿™æ˜¯ä¸€ä¸ªç®€å•çš„<code>policy</code>æ–‡ä»¶ï¼Œç”¨äºè®°å½•<code>Metadata</code>çº§åˆ«çš„æ‰€æœ‰å†…å®¹ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: audit.k8s.io/v1 kind: Policy rules: - level: Metadata</code> </pre> <br> æ‚¨å¯ä»¥åœ¨ç­–ç•¥ä¸­æŒ‡å®šç”¨æˆ·åˆ—è¡¨ï¼ˆ <code>Users</code>å’Œ<code>ServiceAccounts</code> ï¼‰å’Œç”¨æˆ·ç»„ã€‚ ä¾‹å¦‚ï¼Œè¿™æ˜¯æˆ‘ä»¬å°†å¿½ç•¥ç³»ç»Ÿç”¨æˆ·ï¼Œä½†åœ¨â€œ <code>Request</code>çº§åˆ«è®°å½•å…¶ä»–æ‰€æœ‰<code>Request</code> ï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: audit.k8s.io/v1 kind: Policy rules: - level: None userGroups: - "system:serviceaccounts" - "system:nodes" users: - "system:anonymous" - "system:apiserver" - "system:kube-controller-manager" - "system:kube-scheduler" - level: Request</code> </pre> <br> ä¹Ÿå¯ä»¥æè¿°ç›®æ ‡ï¼š <br><br><ul><li>  <code>namespaces</code> </li><li> åŠ¨è¯ï¼ˆ <i>åŠ¨è¯</i> ï¼š <code>get</code> ï¼Œ <code>update</code> ï¼Œ <code>delete</code>ç­‰ï¼‰ï¼› </li><li> èµ„æºï¼ˆ <i>èµ„æº</i> ï¼Œå³ï¼š <code>pod</code> ï¼Œ <code>configmaps</code>ç­‰ï¼‰å’Œèµ„æºç»„ï¼ˆ <code>apiGroups</code> ï¼‰ã€‚ </li></ul><br>  <b>æ³¨æ„ï¼</b> å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å–èµ„æºå’Œèµ„æºç»„ï¼ˆAPIç»„ï¼Œå³apiGroupsï¼‰ä»¥åŠå®ƒä»¬åœ¨ç¾¤é›†ä¸­å®‰è£…çš„ç‰ˆæœ¬ï¼š <br><br><pre> <code class="bash hljs">kubectl api-resources kubectl api-versions</code> </pre> <br> ä»¥ä¸‹å®¡è®¡ç­–ç•¥æ˜¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é˜¿é‡Œäº‘æ–‡æ¡£</a>ä¸­æœ€ä½³å®è·µçš„æ¼”ç¤ºï¼š <br><br><pre> <code class="plaintext hljs">apiVersion: audit.k8s.io/v1beta1 kind: Policy #    RequestReceived omitStages: - "RequestReceived" rules: #   ,     : - level: None users: ["system:kube-proxy"] verbs: ["watch"] resources: - group: "" #  api group   ,    #   Kubernetes,  â€œcoreâ€ resources: ["endpoints", "services"] - level: None users: ["system:unsecured"] namespaces: ["kube-system"] verbs: ["get"] resources: - group: "" # core resources: ["configmaps"] - level: None users: ["kubelet"] verbs: ["get"] resources: - group: "" # core resources: ["nodes"] - level: None userGroups: ["system:nodes"] verbs: ["get"] resources: - group: "" # core resources: ["nodes"] - level: None users: - system:kube-controller-manager - system:kube-scheduler - system:serviceaccount:kube-system:endpoint-controller verbs: ["get", "update"] namespaces: ["kube-system"] resources: - group: "" # core resources: ["endpoints"] - level: None users: ["system:apiserver"] verbs: ["get"] resources: - group: "" # core resources: ["namespaces"] #     read-only URLs: - level: None nonResourceURLs: - /healthz* - /version - /swagger* #   ,     â€œâ€: - level: None resources: - group: "" # core resources: ["events"] #   Secret, ConfigMap  TokenReview    , #         - level: Metadata resources: - group: "" # core resources: ["secrets", "configmaps"] - group: authentication.k8s.io resources: ["tokenreviews"] #   get, list  watch   ;    - level: Request verbs: ["get", "list", "watch"] resources: - group: "" # core - group: "admissionregistration.k8s.io" - group: "apps" - group: "authentication.k8s.io" - group: "authorization.k8s.io" - group: "autoscaling" - group: "batch" - group: "certificates.k8s.io" - group: "extensions" - group: "networking.k8s.io" - group: "policy" - group: "rbac.authorization.k8s.io" - group: "settings.k8s.io" - group: "storage.k8s.io" #        API - level: RequestResponse resources: - group: "" # core - group: "admissionregistration.k8s.io" - group: "apps" - group: "authentication.k8s.io" - group: "authorization.k8s.io" - group: "autoscaling" - group: "batch" - group: "certificates.k8s.io" - group: "extensions" - group: "networking.k8s.io" - group: "policy" - group: "rbac.authorization.k8s.io" - group: "settings.k8s.io" - group: "storage.k8s.io" #         - level: Metadata</code> </pre> <br><br> å¦ä¸€ä¸ªè‰¯å¥½çš„å®¡æ ¸ç­–ç•¥ç¤ºä¾‹æ˜¯<a href="">GCEä¸­ä½¿ç”¨</a>çš„<a href="">é…ç½®æ–‡ä»¶</a> ã€‚ <br><br> ä¸ºäº†å¿«é€Ÿå“åº”å®¡æ ¸äº‹ä»¶ï¼Œå¯ä»¥<b>æè¿°ä¸€ä¸ªwebhook</b> ã€‚ æ­¤é—®é¢˜å·²åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£ä¸­</a>æŠ«éœ²ï¼Œæˆ‘å°†ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´ä¹‹å†…ã€‚ <br><br><h2> æ€»ç»“ </h2><br> æœ¬æ–‡æ¦‚è¿°äº†Kubernetesé›†ç¾¤ä¸­çš„åŸºæœ¬å®‰å…¨æœºåˆ¶ï¼Œè¿™äº›æœºåˆ¶ä½¿æ‚¨å¯ä»¥åˆ›å»ºä¸ªæ€§åŒ–çš„ç”¨æˆ·å¸æˆ·ï¼Œå…±äº«å…¶æƒé™å¹¶è®°å½•å…¶æ“ä½œã€‚ æˆ‘å¸Œæœ›è¿™å¯¹äºé‚£äº›åœ¨ç†è®ºä¸Šæˆ–å·²ç»åœ¨å®è·µä¸­é¢ä¸´æ­¤ç±»é—®é¢˜çš„äººéƒ½æ˜¯æœ‰ç”¨çš„ã€‚ æˆ‘è¿˜å»ºè®®æ‚¨é˜…è¯»â€œ PSâ€ä¸­åˆ—å‡ºçš„æœ‰å…³Kubernetesä¸­å®‰å…¨æ€§ä¸»é¢˜çš„å…¶ä»–ææ–™åˆ—è¡¨-ä¹Ÿè®¸æ‚¨ä¼šåœ¨å…¶ä¸­æ‰¾åˆ°ä¸æ‚¨ç›¸å…³çš„é—®é¢˜çš„å¿…è¦è¯¦ç»†ä¿¡æ¯ã€‚ <br><br><h2> èšè‹¯ä¹™çƒ¯ </h2><br> å¦è¯·å‚é˜…æˆ‘ä»¬çš„åšå®¢ï¼š <br><br><ul><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">33+ Kuberneteså®‰å…¨å·¥å…·</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰å…¨ä¸“ä¸šäººå‘˜çš„Kubernetesç½‘ç»œç­–ç•¥ç®€ä»‹</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†è§£Kubernetesä¸Šçš„RBAC</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetesçš„9ä¸ªæœ€ä½³å®‰å…¨å®è·µ</a> â€ï¼› </li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼ˆä¸æ˜¯ï¼‰æˆä¸ºKubernetesé»‘å®¢æ”»å‡»çš„11ç§æ–¹æ³•</a> ã€‚â€ </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN468679/">https://habr.com/ru/post/zh-CN468679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN468657/index.html">ä¸æ”¯æŒå…±èˆï¼šæ”¯æŒçš„ç±»å‹å’Œå½¢å¼ã€‚ ä½œæˆ˜ä¸­çš„æ”¯æ´ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN468663/index.html">è‡ªåŠ¨è¯­éŸ³è¯†åˆ«ä»»åŠ¡ä¸­çš„End2 Endæ–¹æ³•</a></li>
<li><a href="../zh-CN468665/index.html">ä½†æ˜¯æ˜¯æ—¶å€™ä¹°ä¸€å°çŒæº‰æœºäº†å—ï¼Ÿ</a></li>
<li><a href="../zh-CN468673/index.html">ç ”è®¨ä¼šâ€œç¡®ä¿ä¸ªäººæ•°æ®çš„å®‰å…¨æ€§â€-åœ£å½¼å¾—å ¡ï¼Œ10æœˆ3æ—¥</a></li>
<li><a href="../zh-CN468677/index.html">æ™ºèƒ½æ‰‹æœºå°ç±³Mi Mix Alphaçš„å‘å¸ƒ</a></li>
<li><a href="../zh-CN468683/index.html">DockeræœåŠ¡æ ‡å‡†åŒ–çš„ç†è®ºä¸å®è·µ</a></li>
<li><a href="../zh-CN468687/index.html">æˆ‘ä»¬åˆ†æäº†ä¸­å¤®é“¶è¡Œç›‘ç®¡è‚¡å¸‚çš„æ–°ä¸¾æªï¼šä¸‰ç±»æŠ•èµ„è€…ï¼Œå¯¹åˆå­¦è€…çš„é™åˆ¶</a></li>
<li><a href="../zh-CN468689/index.html">åœ¨æ–°åŠ å¡æ³¨å†Œæ‚¨çš„ITä¸šåŠ¡ï¼šæˆ‘è¯¥æ€ä¹ˆåŠï¼Ÿ</a></li>
<li><a href="../zh-CN468691/index.html">ç³»ç»Ÿæˆ–LOLDriversä¸Šçš„å±é™©ç¬¬ä¸‰æ–¹é©±åŠ¨ç¨‹åº</a></li>
<li><a href="../zh-CN468693/index.html">è‡ªåŠ¨åŒ–å¦‚ä½•æ‘§æ¯æ²ƒå°”ç›å‘˜å·¥</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>