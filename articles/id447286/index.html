<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ˜¹ ğŸ‘¨ğŸ½â€âš–ï¸ ğŸ§‘ğŸ¿ Mengapa dan bagaimana kita menyembunyikan plat nomor mobil di iklan Avito ğŸ¥Ÿ ğŸ‘ğŸ¾ ğŸ”·</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai Pada akhir tahun lalu, kami mulai secara otomatis menyembunyikan nomor plat pada foto di kartu pengumuman Avito. Tentang mengapa kami melakukan in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengapa dan bagaimana kita menyembunyikan plat nomor mobil di iklan Avito</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avito/blog/447286/">  Hai  Pada akhir tahun lalu, kami mulai secara otomatis menyembunyikan nomor plat pada foto di kartu pengumuman Avito.  Tentang mengapa kami melakukan ini, dan apa cara untuk menyelesaikan masalah seperti itu, baca artikelnya. <br><br><img src="https://habrastorage.org/webt/fr/0p/vx/fr0pvxzrkfbjqpvdeeu3-hfp4z8.png" alt="Sembunyikan piring saya!"><br><a name="habracut"></a><br><h4>  Tantangan </h4><br>  Di Avito pada 2018, 2,5 juta mobil terjual.  Ini hampir 7000 sehari.  Semua iklan yang dijual membutuhkan ilustrasi - foto mobil.  Tetapi dengan nomor negara di atasnya Anda dapat menemukan banyak informasi tambahan tentang mobil.  Dan beberapa pengguna kami mencoba untuk menutup plat nomor sendiri. <br><table><tbody><tr><td><img src="https://habrastorage.org/webt/ti/u9/yl/tiu9ylusazwgoyouuhvbd3iephi.png" alt="gambar"></td><td><img src="https://habrastorage.org/webt/tf/8x/6l/tf8x6lq0j4cnyytbzn4pbwalky8.png" alt="gambar"></td></tr><tr><td><img src="https://habrastorage.org/webt/t-/mz/ig/t-mzigkjjc00g-w_b2vx4sz0vy8.png" alt="gambar"></td><td><img src="https://habrastorage.org/webt/rq/gu/31/rqgu31h8n1j4n08z2wu6oqfzwlo.png" alt="gambar"></td></tr><tr><td colspan="2"><img src="https://habrastorage.org/webt/55/9b/rb/559brbhsq8xldsnln_umbwjqldw.png" alt="prototipe untuk ilustrasi di awal artikel"></td></tr></tbody></table><br>  Alasan mengapa pengguna ingin menyembunyikan nomor plat mungkin berbeda.  Untuk bagian kami, kami ingin membantu mereka melindungi data mereka.  Dan kami mencoba meningkatkan proses penjualan dan pembelian untuk pengguna.  Misalnya, layanan nomor anonim telah lama bekerja dengan kami: ketika Anda menjual mobil, nomor seluler sementara dibuat untuk Anda.  Nah, untuk melindungi data di plat nomor, kami menganonimkan foto. <br><br><img src="https://habrastorage.org/webt/ol/-o/ii/ol-oiivyox1f2cogwd2pzf1jz9y.png" alt="gambar"><br><br><h4>  Ikhtisar Solusi </h4><br>  Untuk mengotomatiskan proses melindungi foto pengguna, Anda dapat menggunakan jaringan saraf convolutional untuk mendeteksi poligon dengan plat nomor. <br>  Sekarang, untuk mendeteksi objek, arsitektur dua kelompok digunakan: jaringan dua tahap, misalnya, RCNN Lebih Cepat dan Mask RCNN;  satu tahap (singleshot) - SSD, YOLO, RetinaNet.  Mendeteksi objek adalah output dari empat koordinat persegi panjang di mana objek yang diinginkan dituliskan. <br><br><img src="https://habrastorage.org/webt/-g/bz/p4/-gbzp4vk0cj2uwknc1qeavh8roy.png" alt="gambar"><br><br>  Jaringan yang disebutkan di atas dapat menemukan banyak objek dari kelas yang berbeda dalam gambar, yang sudah berlebihan untuk menyelesaikan masalah pencarian plat nomor, karena kami biasanya hanya memiliki satu mobil dalam gambar (ada pengecualian ketika orang mengambil gambar mobil yang dijual dan tetangga acaknya) , tapi ini jarang terjadi, jadi ini bisa diabaikan). <br><br>  Fitur lain dari jaringan ini adalah bahwa secara default mereka menghasilkan kotak pembatas dengan sisi yang sejajar dengan sumbu koordinat.  Ini terjadi karena satu set jenis bingkai persegi panjang yang telah ditentukan yang disebut kotak jangkar digunakan untuk deteksi.  Lebih tepatnya, pertama menggunakan jaringan konvolusional (misalnya, resnet34), matriks atribut diperoleh dari gambar.  Kemudian, untuk setiap subset atribut yang diperoleh menggunakan jendela geser, klasifikasi terjadi: apakah ada objek untuk kotak jangkar k atau tidak, dan regresi dilakukan ke dalam empat koordinat bingkai, yang menyesuaikan posisinya. <br>  Baca lebih lanjut tentang ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><img src="https://habrastorage.org/webt/ew/er/dq/ewerdqloqogwqhsp8kauzmwzwtq.png" alt="gambar"><br><br>  Setelah itu, ada dua kepala lagi: <br><br><img src="https://habrastorage.org/webt/be/9j/ib/be9jibquo3xic6fi-3dof-ivyq4.png" alt="bukan gambar arsitektur yang paling asli"><br><br>  satu untuk mengklasifikasikan objek (anjing / kucing / tanaman, dll), <br>  yang kedua (bbox regressor) - untuk regresi koordinat frame yang diperoleh pada langkah sebelumnya untuk meningkatkan rasio area objek ke area frame. <br><br>  Untuk memprediksi bingkai tinju yang diputar, Anda perlu mengubah regresi bbox sehingga Anda juga mendapatkan sudut rotasi bingkai.  Jika ini tidak dilakukan, maka entah bagaimana akan berubah. <br><br><img src="https://habrastorage.org/webt/c0/4p/5d/c04p5dcpnl02xrgbvapzycdtboe.png" alt="gambar"><br><br>  Selain Faster R-CNN dua tahap, ada detektor satu tahap, seperti RetinaNet.  Ini berbeda dari arsitektur sebelumnya karena langsung memprediksi kelas dan bingkai, tanpa tahap awal mengusulkan bagian gambar yang mungkin berisi objek.  Untuk memprediksi topeng yang diputar, Anda juga harus mengubah kepala subnet kotak. <br><br><img src="https://habrastorage.org/webt/uu/_w/qx/uu_wqxel27ctxz39s_trbw4be88.png" alt="gambar"><br><br>  Salah satu contoh arsitektur yang ada untuk memprediksi rotating bounding box adalah DRBOX.  Jaringan ini tidak menggunakan tahap awal proposal kawasan, seperti pada RCNN Lebih Cepat, oleh karena itu, ini merupakan modifikasi dari metode satu tahap.  Untuk melatih jaringan ini, K diputar pada kotak sudut pembatas tertentu (rbox) digunakan.  Jaringan memprediksi probabilitas untuk setiap rbox K untuk memuat objek target, koordinat, ukuran bbox, dan sudut rotasi. <br><br><img src="https://habrastorage.org/webt/oq/a4/yo/oqa4yonbchbbmkcu9mjsj7nmmfm.png" alt="gambar"><br><br>  Memodifikasi arsitektur dan melatih kembali salah satu jaringan yang dipertimbangkan pada data dengan kotak pembatas yang diputar adalah tugas yang dapat direalisasikan.  Tetapi tujuan kami dapat dicapai dengan lebih mudah, karena ruang lingkup jaringan yang kami miliki jauh lebih sempit - hanya untuk menyembunyikan plat nomor. <br>  Oleh karena itu, kami memutuskan untuk memulai dengan jaringan sederhana untuk memprediksi empat poin dari angka tersebut, dan selanjutnya dimungkinkan untuk mempersulit arsitekturnya. <br><br><h4>  Data </h4><br>  Perakitan dataset dibagi menjadi dua langkah: untuk mengumpulkan gambar mobil dan menandai area dengan plat nomor pada mereka.  Tugas pertama telah diselesaikan dalam infrastruktur kami: kami dengan hati-hati menyimpan semua iklan yang pernah ditempatkan di Avito.  Untuk mengatasi masalah kedua, kami menggunakan Toloka.  Di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">toloka.yandex.ru/requester kami</a> membuat tugas: <br><blockquote>  Tugas diberikan foto mobil.  Penting untuk menyoroti plat nomor mobil menggunakan quadrangle.  Dalam hal ini, nomor negara harus dialokasikan seakurat mungkin. </blockquote><img src="https://habrastorage.org/webt/mk/vl/j4/mkvlj4d7k8bsg_xkke1gkcsrxuy.png" alt="gambar"><br><br>  Menggunakan Toloka, Anda dapat membuat tugas untuk menandai data.  Misalnya, mengevaluasi kualitas hasil pencarian, menandai berbagai kelas objek (teks dan gambar), menandai video, dll.  Mereka akan dilakukan oleh pengguna Toloka, untuk biaya yang Anda kenakan.  Misalnya, dalam kasus kami, toloker harus menyorot TPA dengan nomor plat mobil di foto.  Secara umum, sangat nyaman untuk menandai dataset yang besar, tetapi mendapatkan kualitas tinggi cukup sulit.  Ada banyak bot di kerumunan, tugasnya adalah mendapatkan uang dari Anda dengan memberikan jawaban secara acak atau menggunakan semacam strategi.  Untuk mengatasi bot ini ada sistem aturan dan pemeriksaan.  Pemeriksaan utama adalah pencampuran pertanyaan kontrol: Anda secara manual menandai bagian dari tugas menggunakan antarmuka Toloki, dan kemudian mencampurnya ke dalam tugas utama.  Jika markup sering keliru pada pertanyaan kontrol, Anda memblokirnya dan tidak memperhitungkan markup. <br><br>  Untuk tugas klasifikasi, sangat mudah untuk menentukan apakah penandaan itu salah atau tidak, dan untuk masalah menyoroti suatu wilayah, itu tidak begitu sederhana.  Cara klasik adalah menghitung IoU. <br><br><img src="https://habrastorage.org/webt/fw/r2/ye/fwr2yeqbrlk1-skjy2udjx04y2e.png" alt="gambar"><br><br>  Jika rasio ini kurang dari ambang tertentu untuk beberapa tugas, maka pengguna tersebut diblokir.  Namun, untuk dua quadrangles sewenang-wenang, menghitung IoU tidak begitu sederhana, terutama karena di Tolok perlu menerapkan ini dalam JavaScript.  Kami membuat retasan kecil, dan kami percaya bahwa pengguna tidak salah jika untuk setiap titik poligon sumber di lingkungan kecil ada titik yang ditandai dengan juru tulis.  Ada juga aturan respons cepat untuk memblokir respons pengguna terlalu cepat, captcha, perbedaan dengan pendapat mayoritas, dll.  Setelah menyiapkan aturan ini, Anda dapat mengharapkan markup yang cukup bagus, tetapi jika Anda benar-benar membutuhkan markup yang berkualitas tinggi dan kompleks, Anda perlu menyewa scribers freelancer secara khusus.  Akibatnya, set data kami berjumlah 4k gambar yang ditandai, dan semuanya berharga $ 28 di Tolok. <br><br><h4>  Model </h4><br>  Sekarang mari kita membuat jaringan untuk memprediksi empat titik area.  Kami akan mendapatkan tanda-tanda menggunakan resnet18 (parameter 11,7M versus parameter 21,8M untuk resnet34), kemudian kami membuat kepala untuk regresi ke empat poin (delapan koordinat) dan kepala untuk klasifikasi apakah ada plat nomor dalam gambar atau tidak.  Kepala kedua diperlukan, karena dalam iklan untuk penjualan mobil, tidak semua foto dengan mobil.  Foto mungkin detail mobil. <br><br><img src="https://habrastorage.org/webt/wz/qc/5s/wzqc5spmzueaqptlw6hiknobayo.png" alt="gambar"><br><br>  Mirip dengan kita, tentu saja, tidak perlu dideteksi. <br><br>  Kami melatih dua tujuan secara bersamaan dengan menambahkan ke dataset sebuah foto tanpa plat dengan kotak pembatas (0,0,0,0,0,0,0,0,0,0) dan nilai untuk "gambar dengan / tanpa plat nomor" - (0, 1). <br><br>  Kemudian Anda dapat membuat fungsi kerugian tunggal untuk kedua sasaran sebagai jumlah dari kerugian berikut.  Untuk regresi ke koordinat poligon plat kami menggunakan kerugian L1 halus. <br><br><img src="https://habrastorage.org/webt/6s/v7/yu/6sv7yus_w9o4d1xmqfhbnsenotc.png" alt="gambar"><br><br>  Ini dapat diartikan sebagai kombinasi L1 dan L2, yang berperilaku seperti L1 ketika nilai absolut dari argumen besar dan sebagai L2 ketika nilai argumen mendekati nol.  Untuk klasifikasi, kami menggunakan kerugian softmax dan crossentropy.  Extractor fitur resnet18, kami menggunakan bobot yang sudah dilatih sebelumnya di ImageNet, lalu kami akan melatih ekstraktor dan kepala lebih lanjut pada dataset kami.  Dalam masalah ini, kami menggunakan kerangka mxnet, karena itu adalah yang utama untuk visi komputer di Avito.  Secara umum, arsitektur microservice memungkinkan Anda untuk tidak terikat pada kerangka kerja tertentu, tetapi ketika Anda memiliki basis kode yang besar, lebih baik untuk menggunakannya dan tidak menulis kode yang sama lagi. <br><br>  Setelah menerima kualitas yang dapat diterima pada dataset kami, kami berpaling kepada para perancang untuk memberi kami plat nomor dengan logo Avito.  Awalnya kami mencoba melakukannya sendiri, tentu saja, tetapi itu tidak terlihat sangat indah.  Selanjutnya, Anda perlu mengubah kecerahan plat nomor Avito ke kecerahan area asli dengan plat nomor dan Anda dapat menumpangkan logo pada gambar. <br><br><img src="https://habrastorage.org/webt/3j/gr/bz/3jgrbzhv3y9sldjmbm5hlfmhlo8.png" alt="gambar"><br><br><h4>  Luncurkan dalam prod </h4><br>  Masalah reproduktifitas hasil, dukungan dan pengembangan proyek, diselesaikan dengan beberapa kesalahan dalam dunia pengembangan backend dan frontend, masih berdiri terbuka di mana diperlukan untuk menggunakan model pembelajaran mesin.  Anda mungkin harus memahami model kode lama.  Baik jika readme memiliki tautan ke artikel atau repositori open source yang menjadi dasar solusinya.  Skrip untuk memulai pelatihan ulang mungkin gagal dengan kesalahan, misalnya, versi cudnn telah berubah, dan versi tensorflow tidak lagi berfungsi dengan versi cudnn ini, dan cudnn tidak berfungsi dengan versi driver nvidia ini.  Mungkin untuk pelatihan kami menggunakan satu iterator sesuai dengan data, dan untuk pengujian dalam produksi yang lain.  Ini dapat berlanjut untuk beberapa waktu.  Secara umum, masalah reproduktifitas ada. <br><br>  Kami mencoba menghapusnya menggunakan lingkungan nvidia-docker untuk model pelatihan, ia memiliki semua dependensi yang diperlukan untuk suda, dan kami juga menginstal dependensi untuk python di sana.  Versi perpustakaan dengan iterator sesuai dengan data, augmentasi, dan model inferensi adalah umum untuk tahap pelatihan / percobaan dan untuk produksi.  Jadi, untuk melatih model pada data baru, Anda perlu memompa repositori ke server, menjalankan skrip shell yang akan mengumpulkan lingkungan buruh pelabuhan, di mana notebook jupyter akan naik.  Di dalam, Anda akan memiliki semua buku catatan untuk pelatihan dan pengujian, yang tentunya tidak akan gagal dengan kesalahan karena lingkungan.  Tentu saja, lebih baik memiliki satu file train.py, tetapi latihan menunjukkan bahwa Anda selalu perlu melihat dengan mata Anda apa yang diberikan oleh model dan mengubah sesuatu dalam proses pembelajaran, jadi pada akhirnya Anda akan tetap menjalankan jupyter. <br><br>  Bobot model disimpan dalam git lfs - ini adalah teknologi khusus untuk menyimpan file besar dalam git. Sebelum itu, kami menggunakan artifaktor, tetapi menggunakan git lfs lebih nyaman, karena mengunduh repositori dengan layanan, Anda segera mendapatkan versi skala timbangan saat ini, seperti dalam produksi.  Autotests ditulis untuk inferensi model, sehingga Anda tidak akan dapat meluncurkan layanan dengan bobot yang tidak lulus.  Layanan itu sendiri diluncurkan di buruh pelabuhan di dalam infrastruktur microservice di cluster kubernetes.  Untuk memantau kinerja, kami menggunakan grafana.  Setelah bergulir, kami secara bertahap meningkatkan beban pada instance layanan dengan model baru.  Saat meluncurkan fitur baru, kami membuat tes a / b dan mengeluarkan putusan tentang nasib fitur tersebut di masa mendatang, berdasarkan pada uji statistik. <br><br>  Sebagai hasilnya: kami meluncurkan pemangkasan angka pada iklan dalam kategori otomatis untuk pedagang swasta, persentil ke-95 dari waktu pemrosesan satu gambar untuk menyembunyikan angkanya adalah 250 ms. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id447286/">https://habr.com/ru/post/id447286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id447276/index.html">Apa perpustakaan ITIL dan mengapa perusahaan Anda membutuhkannya?</a></li>
<li><a href="../id447278/index.html">Estonia mencoba menggunakan AI dalam keadilan</a></li>
<li><a href="../id447280/index.html">Meningkatkan level akun game di Tiongkok: bisnis serius dan sakit kepala bagi pengembang</a></li>
<li><a href="../id447282/index.html">Kesalahan pemrogram sistem dan aplikasi terperangkap di frontend (artikel dihapus)</a></li>
<li><a href="../id447284/index.html">Perbarui alat Web dan Azure di Visual Studio 2019</a></li>
<li><a href="../id447288/index.html">5 stablecoin teratas. Yang perlu Anda ketahui</a></li>
<li><a href="../id447290/index.html">Dokter naik, naik</a></li>
<li><a href="../id447292/index.html">14 produk baru di Visual Studio 2019</a></li>
<li><a href="../id447294/index.html">Live Share sekarang disertakan dengan Visual Studio 2019</a></li>
<li><a href="../id447298/index.html">Manajemen pengetahuan melalui model kompetensi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>