<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüîß „äôÔ∏è üåñ Inhaltsfilterung in der Schule basierend auf Ubuntu 18.04 und transparentem Squid, mit Integration in das Netzwerk auf MikroTik und nicht nur ‚õ∫Ô∏è üò≠ üöù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Einleitung 
 Das Thema Inhaltsfilterung in Schulen ist ziemlich abgedroschen und voller Informationen, aber es ist bereits ziemlich veraltet, da vi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Inhaltsfilterung in der Schule basierend auf Ubuntu 18.04 und transparentem Squid, mit Integration in das Netzwerk auf MikroTik und nicht nur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/473584/"><img src="https://habrastorage.org/webt/sl/bc/ta/slbctarcmoniq1q3aotimy8oiv8.jpeg"><br><br><h3>  1. Einleitung </h3><br>  Das Thema Inhaltsfilterung in Schulen ist ziemlich abgedroschen und voller Informationen, aber es ist bereits ziemlich veraltet, da viele Websites auf das sichere HTTPS-Protokoll umgestellt werden, mit dem die meisten vorgeschlagenen L√∂sungen nicht funktionieren.  Aus diesem Grund habe ich beschlossen, den vollst√§ndigsten Artikel von A bis Z zu schreiben und alle Informationen, die ich in den Google-Erweiterungen gefunden habe, zusammen zu sammeln.  Der Artikel richtet sich an Grundkenntnisse im Bereich Verwaltung und ist f√ºr Informatiklehrer geeignet. <br><br><h3>  2. Leistungsbeschreibung </h3><br>  <b>Gegeben:</b> 436-FZ und eine Schule, in der viele Computer √ºber einen MikroTik-Router oder einen anderen vernetzt und mit dem Internet verbunden sind. <br><br>  <b>Ziel:</b> Inhaltsfilterung von HTTP und HTTPS nach Whitelist f√ºr alle au√üer Ihrer Geliebten und der Schulleitung. <br><a name="habracut"></a><br><br><h3>  3. Probleml√∂sung </h3><br>  Es wurde ein nicht verwendeter Desktop-Computer mit einem Dual-Core-Intel-Ohm, 1 GB RAM und harten 80 GB gefunden. <br>  Um dies zu l√∂sen, wird Folgendes durchgef√ºhrt: <br><br><ol><li>  Linux Ubuntu Server 18.04 LTS installiert </li><li>  Transparent Proxy Squid wird auf dem Server installiert und konfiguriert und aus Quellcodes mit HTTPS-Unterst√ºtzung kompiliert. </li><li>  Integration des Servers in das Subnetz durch Umleiten von Anforderungen an Proxy oder eine alternative Option (ganz am Ende) </li></ol><br>  Fangen wir an. <br><br><h4>  3.1.  Installieren und konfigurieren Sie Ubuntu 18.04 </h4><br>  Der Installationsvorgang ist einfach.  Laden Sie die Distribution von Ubuntu Server 18.04 von der offiziellen Website herunter.  Ich empfehle das Herunterladen mit dem alten Installationsprogramm, da das neue, pers√∂nlich von mir, w√§hrend der Installation unendlich heruntergeladen wurde.  Wir schreiben das Bild auf bequeme Weise auf ein USB-Flash-Laufwerk.  F√ºr die Aufnahme auf einem USB-Stick empfehle ich die Verwendung von Rufus und w√§hle zu Beginn der Aufnahme ‚ÄûDD-Bild aufnehmen‚Äú.  Installieren Sie anschlie√üend das System gem√§√ü den Informationen auf dem Bildschirm.  Wir besch√§ftigen uns nur mit der Auswahl der Komponenten, bei denen Sie sofort OpenSSH ausw√§hlen k√∂nnen und das war's.  Wir brauchen nicht viel, aber wir m√ºssen installieren, was wir brauchen. <br><br>  Also ist Ubuntu installiert.  Wenn Sie √ºber DHCP verf√ºgen, ist das Netzwerk bereits konfiguriert.  Wir werden in den Superuser-Modus wechseln, damit wir den Befehlen nicht jedes Mal sudo hinzuf√ºgen. <br><br><pre><code class="javascript hljs">sudo -s</code> </pre> <br>  Geben Sie Ihr Passwort ein und aktualisieren Sie das System. <br><br><pre> <code class="javascript hljs">apt-get update apt-get upgrade</code> </pre> <br>  Installieren Sie einen Texteditor und einen Dateimanager. <br><br><pre> <code class="javascript hljs">apt-get install nano mc</code> </pre> <br>  Um die Datei in <i><b>Nano</b></i> zu speichern, m√ºssen Sie <i>Strg + O</i> gefolgt von <i>Y</i> dr√ºcken.  Beenden Sie den Editor, indem Sie <i>Strg + X</i> dr√ºcken.  Sie k√∂nnen die Datei unmittelbar vor dem Beenden speichern, indem Sie <i>Strg + X</i> gefolgt von <i>Y</i> dr√ºcken. <br>  <i><b>Geben Sie mc ein,</b></i> um den Dateimanager zu √∂ffnen.  Ein typisches NortonCommander DOS oder Windows TotalCommander / FAR wird mit zwei Bedienfeldern ge√∂ffnet.  Obwohl ich es gewohnt bin, mit der Konsole zu arbeiten, hilft der Dateimanager manchmal auch, beispielsweise die gew√ºnschte Datei schneller zu finden. <br><br>  Wenn Sie kein DHCP haben oder eine separate IP-Adresse f√ºr Ihren Server w√ºnschen, wie ich es wollte, fahren wir mit der Konfiguration fort. <br><br><div class="spoiler">  <b class="spoiler_title">Konfigurieren Sie die statische IP-Adresse</b> <div class="spoiler_text">  Im Gegensatz zu fr√ºheren Versionen von Ubuntu wird das Netzwerk in der neuen Version 18.04 nicht mehr in den √ºblichen <i>/ etc / network / interfaces konfiguriert</i> , sondern √ºber netplan in der Datei <i><b>/etc/netplan/*.yaml</b></i> .  Die Datei kann anders benannt sein, ist aber nur dort.  / Etc / network / interfaces selbst schreibt uns folgendes: <br><br><img src="https://habrastorage.org/webt/ye/m5/xr/yem5xrromrmumjbg5gcjyb_qkte.jpeg"><br><br>  Wenn Sie ein Upgrade von einer Version durchf√ºhren m√∂chten, die √§lter als 18.04 ist, bleiben die Netzwerkeinstellungen unver√§ndert.  Netplan ist nur f√ºr eine Neuinstallation vom 18.04. Relevant. <br><br>  Kommen wir zum Einrichten des Netzwerks. <br><br>  Schauen wir uns zun√§chst den Namen der dem Betriebssystem zugewiesenen Netzwerkschnittstelle an und merken uns diesen. <br><br><pre> <code class="javascript hljs">ifconfig</code> </pre> <br>  √ñffnen Sie nun die Einstellungsdatei. <br><br><pre> <code class="javascript hljs">nano /etc/netplan<span class="hljs-comment"><span class="hljs-comment">/*.yaml</span></span></code> </pre> <br>  Es sollte bereits eine DHCP-Einstellung haben.  Bringen wir die Datei in das folgende Formular. <br><br><pre> <code class="javascript hljs"># This file describes the network interfaces available on your system # For more information, see netplan(<span class="hljs-number"><span class="hljs-number">5</span></span>). network: version: <span class="hljs-number"><span class="hljs-number">2</span></span> renderer: networkd ethernets:   : dhcp4: no dhcp6: no addresses: [/<span class="hljs-number"><span class="hljs-number">24</span></span>] gateway4:  nameservers: addresses: [<span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span>, <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span>]</code> </pre><br>  Geben Sie Ihre Schnittstelle, Adresse und Ihr Gateway ein.  DNS empfiehlt, diese zu verlassen - Yandex.DNS Kinder werden als zus√§tzlicher Schutz dienen.  Das gleiche DNS ist in meinem Router konfiguriert.  In jedem Fall m√ºssen Sie den DNS angeben, den der Router verteilt. <br><br>  Hier m√ºssen Sie auf Leerzeichen achten (n√§mlich Leerzeichen, keine Tabulatoren).  Jede Art von Absatz ist vom vorherigen Leerzeichen getrennt.  Wenn beispielsweise nach Nameservern die Adresszeile nicht durch ein Leerzeichen getrennt, sondern an der obigen Zeile ausgerichtet ist, gibt netplan beim Versuch, die Einstellungen anzuwenden, einen Fehler aus. <br><br>  √úbernehmen Sie die Einstellungen. <br><br><pre> <code class="javascript hljs">netplan apply</code> </pre> <br>  Starten Sie den Server f√ºr alle F√§lle neu. <br><br><pre> <code class="javascript hljs">reboot</code> </pre> <br></div></div><br>  Au√üerdem f√ºgte er eine alternative Netzwerkkonfigurationsoption f√ºr DHCP und statische IP hinzu, falls Netplan nicht passt. <br><div class="spoiler">  <b class="spoiler_title">Alternative Netzwerkeinrichtung</b> <div class="spoiler_text">  In Ubuntu 18.04 k√∂nnen Sie √ºber <i>/ etc / network / interfaces</i> zur bekannten Netzwerkkonfigurationsoption zur√ºckkehren.  Zu diesem <i>Zweck</i> gibt die Datei selbst an, dass Sie das Dienstprogramm <i>ifupdown</i> installieren <i>m√ºssen</i> .  Installieren Sie es: <br><pre> <code class="javascript hljs">apt-get install ifupdown</code> </pre> <br>  √ñffnen Sie nun die Grundeinstellungsdatei in netplan <br><pre> <code class="javascript hljs">nano /etc/netplan<span class="hljs-comment"><span class="hljs-comment">/*.yaml</span></span></code> </pre> <br>  und kommentieren Sie alle Inhalte aus, damit es keine Konflikte gibt. <br>  √ñffnen Sie als N√§chstes die Netzwerkeinstellungsdatei <br><pre> <code class="javascript hljs">nano /etc/network/interfaces</code> </pre> <br>  Und f√ºgen Sie hinzu: <br>  f√ºr statische IP <br><pre> <code class="javascript hljs">auto ___ iface ___ inet <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> address IP- netmask  gateway  dns-nameservers <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">77.88</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span></code> </pre> <br>  f√ºr dynamisch (DHCP) <br><pre> <code class="javascript hljs">auto ___ iface ___ inet dhcp</code> </pre> <br>  Starten Sie den Server neu <br><pre> <code class="javascript hljs">reboot</code> </pre> <br>  Wenn Sie diese Option zum Konfigurieren des Netzwerks verwenden, k√∂nnen Sie in den Firewall-Einstellungen Webmin ganz deaktivieren und die Konfigurationsoption unter dem Spoiler verwenden (obwohl die Option mit Webmin auch funktioniert). <br></div></div><br><br>  Jetzt m√ºssen Sie die √úbertragung von Paketen durch unseren Server aktivieren.  √ñffnen Sie die Datei <i>/etc/sysctl.conf</i> <br><pre> <code class="javascript hljs">nano /etc/sysctl.conf</code> </pre> <br>  Wir <i><b>suchen darin nach dem</b></i> String <i><b>net.ipv4.ip_forward = 1</b></i> und kommentieren ihn aus.  Wenn der Wert <i>0 ist</i> , wechseln Sie zu <i>1</i> . <br>  Geben Sie den Befehl ein, um die Einstellung zu √ºbernehmen <br><pre> <code class="javascript hljs">sysctl -p /etc/sysctl.conf</code> </pre> <br><br>  Nach dem Einrichten des Netzwerks empfehle ich, dass Sie direkt zum Terminal gehen und dort weiterarbeiten.  Wenn Sie dazu w√§hrend der Installationsphase nicht OpenSSH ausgew√§hlt haben, installieren Sie es. <br><br><pre> <code class="javascript hljs">apt-get install ssh</code> </pre> <br>  Standardm√§√üig ist SSH bereits f√ºr die Benutzer- / Kennwortanmeldung an Port 22 konfiguriert. Sie k√∂nnen es jedoch selbst konfigurieren, z. B. √ºber einen Autorisierungsschl√ºssel und einen anderen Port, um den Server vor Angriffen von au√üen zu sch√ºtzen.  Wie das geht, ist voller Informationen im Internet. <br><br>  Als Terminal verwende ich XShell.  Sie k√∂nnen die von Ihnen bevorzugte verwenden. <br><br>  Wir ben√∂tigen keinen DHCP-Server und keine zweite Netzwerkkarte, da wir Benutzeranforderungen √ºber den Router selbst an unseren Proxy umleiten. <br><br>  Der Grundstein wird gelegt.  Fahren wir nun mit der Installation und Konfiguration von Squid fort. <br><br><h4>  3.2.  Installieren und Konfigurieren von Squid mit HTTPS-Unterst√ºtzung und Listenfilterung </h4><br>  <b>3.2.1.</b>  <b>Squid erstellen und installieren</b> <br><br>  Da es in den Repositorys kein fertiges Squid-Paket mit SSL-Unterst√ºtzung gibt, m√ºssen Sie es manuell aus der Quelle zusammenstellen.  √ñffnen Sie zun√§chst die Datei mit den Repositorys. <br><br><pre> <code class="javascript hljs">nano /etc/apt/sources.list</code> </pre> <br>  Darin kommentieren wir (am Anfang # l√∂schen) die Zeilen, die mit <i><b>deb-src beginnen</b></i> . <br><br>  Danach werden wir die Pakete aktualisieren. <br><br><pre> <code class="javascript hljs">apt-get update</code> </pre> <br>  Installieren Sie als N√§chstes die Montagewerkzeuge. <br><br><pre> <code class="javascript hljs">apt-get install fakeroot build-essential devscripts</code> </pre> <br>  Und f√ºgen Sie alle notwendigen Pakete f√ºr die Montage hinzu. <br><br><pre> <code class="javascript hljs">apt-get build-dep squid3</code> </pre> <br>  Installieren Sie die Bibliothek f√ºr die SSL-Unterst√ºtzung. <br><br><pre> <code class="javascript hljs">apt-get install libssl1<span class="hljs-number"><span class="hljs-number">.0</span></span>-dev</code> </pre> <br>  Gehen wir zum Basisordner und erstellen einen Ordner f√ºr die Assembly, wobei Sie sofort die erforderlichen Rechte daf√ºr festlegen. <br><br><pre> <code class="javascript hljs">cd ~ mkdir build chown _apt:root build</code> </pre> <br>  Gehen Sie zum erstellten Ordner und laden Sie die Squid-Quellen herunter. <br><br><pre> <code class="javascript hljs">cd build apt-get source squid3</code> </pre> <br>  Im Build-Ordner wird ein Ordner mit dem Namen squid3 und der Versionsnummer angezeigt.  Unter Ubuntu 18.04.3 ist es 3.5.27.  Lass uns darauf eingehen. <br><br><pre> <code class="javascript hljs">cd squid3<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.27</span></span></code> </pre> <br>  Vor dem Zusammenbau m√ºssen Sie Optionen angeben.  √ñffnen Sie die Datei mit ihnen. <br><br><pre> <code class="javascript hljs">nano debian/rules</code> </pre> <br>  Wir suchen nach einer Liste von Optionen, wie auf dem Bild <br><br><img src="https://habrastorage.org/webt/w3/1a/xn/w31axng0b2nuqhjipuqc84sey78.jpeg"><br>  F√ºgen Sie die folgenden Optionen hinzu. <br><br><pre> <code class="javascript hljs">--enable-ssl \ --enable-ssl-crtd \ --<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>-openssl</code> </pre> <br>  Bitte beachten Sie, dass dem Bild bereits Optionen hinzugef√ºgt wurden und das Zeichen <b>"\"</b> nach jeder Zeile in den Optionen mit <b>Ausnahme der letzten</b> Zeile angezeigt werden sollte. <br><br>  Damit ist alles montagefertig.  Fahren wir nun mit dem Squid-Quellordner fort, obwohl Sie sich bereits darin befinden sollten. <br><br><pre> <code class="javascript hljs">cd ~<span class="hljs-regexp"><span class="hljs-regexp">/build/</span></span>squid3<span class="hljs-number"><span class="hljs-number">-3.5</span></span><span class="hljs-number"><span class="hljs-number">.27</span></span></code> </pre> <br>  Und geben Sie den Befehl zum Erstellen ein. <br><br><pre> <code class="javascript hljs">debuild -d</code> </pre> <br>  Die Montage wird sehr lange dauern, ich habe durchschnittlich 2 bis 4 Stunden gebraucht.  H√§ngt von der Geschwindigkeit des Computers ab.  Am Ende der Assembly wird ein Paketsignaturfehler angezeigt.  Dies ist normal - ignorieren Sie den Fehler. <br><br>  Gehen Sie nun zum Build-Ordner. <br><br><pre> <code class="javascript hljs">cd ~<span class="hljs-regexp"><span class="hljs-regexp">/build</span></span></code> </pre> <br>  Und installiere Squid. <br><br><pre> <code class="javascript hljs">dpkg -i squid*.deb</code> </pre> <br>  F√ºhren Sie sofort einen Fehler √ºber nicht erf√ºllte Abh√§ngigkeiten aus und geben Sie den Befehl ein <br><br><pre> <code class="javascript hljs">apt-get install -f</code> </pre> <br>  Nach der Installation markieren wir die Pakete so, dass sie nach der Aktualisierung des Systems nicht √ºberschrieben werden. <br><br><pre> <code class="javascript hljs">apt-mark hold squid apt-mark hold squid-common apt-mark hold squidclient</code> </pre> <br>  <b>3.2.2.</b>  <b>Tintenfisch konfigurieren und filtern</b> <br><br>  Also, Squid ist installiert, es bleibt, um es f√ºr unsere Bed√ºrfnisse zu konfigurieren. <br><br>  Alle Einstellungen befinden sich in der Datei <i><b>/etc/squid/squid.conf</b></i> .  Es enth√§lt viele Kommentare und auf den ersten Blick scheint es sehr kompliziert zu sein, aber tats√§chlich ist nichts sehr kompliziertes daran.  Zun√§chst werden wir Kommentare entfernen, indem wir zuerst das Original kopieren, wenn Sie es pl√∂tzlich genauer untersuchen m√∂chten.  Der Einfachheit halber gehen wir mit Squid direkt zum Ordner. <br><br><pre> <code class="javascript hljs">cd /etc/squid cp squid.conf squid.conf.backup cat squid.conf.backup | egrep <span class="hljs-string"><span class="hljs-string">"^[^#]"</span></span> &gt; squid.conf</code> </pre> <br>  √ñffnen Sie jetzt squid.conf <br><br><pre> <code class="javascript hljs">nano squid.conf</code> </pre> <br>  Wie Sie sehen k√∂nnen, hat er sich von Kommentaren befreit und ist nicht mehr so ‚Äã‚Äãsperrig, wie er schien. <br>  Unter dem Spoiler werde ich meine Datei mit Einstellungen ver√∂ffentlichen, die einwandfrei funktionieren, und im Folgenden werde ich in Bl√∂cken beschreiben, was und wie. <br><br><div class="spoiler">  <b class="spoiler_title">Squid.conf Konfiguration</b> <div class="spoiler_text"><pre> <code class="javascript hljs">acl localnet src <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> acl worktime time <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> acl SSL_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> acl Safe_ports port <span class="hljs-number"><span class="hljs-number">80</span></span> # http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">21</span></span> # ftp acl Safe_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> # https acl Safe_ports port <span class="hljs-number"><span class="hljs-number">70</span></span> # gopher acl Safe_ports port <span class="hljs-number"><span class="hljs-number">210</span></span> # wais acl Safe_ports port <span class="hljs-number"><span class="hljs-number">1025</span></span><span class="hljs-number"><span class="hljs-number">-65535</span></span> # unregistered ports acl Safe_ports port <span class="hljs-number"><span class="hljs-number">280</span></span> # http-mgmt acl Safe_ports port <span class="hljs-number"><span class="hljs-number">488</span></span> # gss-http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">591</span></span> # filemaker acl Safe_ports port <span class="hljs-number"><span class="hljs-number">777</span></span> # multiling http acl CONNECT method CONNECT acl blacklist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist"</span></span> acl whitelist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist"</span></span> http_access allow localhost http_access deny manager http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow CONNECT http_access deny blacklist http_access allow whitelist http_access deny all worktime http_access allow all http_port <span class="hljs-number"><span class="hljs-number">3128</span></span> http_port <span class="hljs-number"><span class="hljs-number">3129</span></span> intercept https_port <span class="hljs-number"><span class="hljs-number">3130</span></span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>squid/squid.pem always_direct allow all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist_ssl"</span></span> acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist_ssl"</span></span> acl step1 at_step SslBump1 ssl_bump peek step1 ssl_bump terminate blacklist_ssl ssl_bump splice whitelist_ssl ssl_bump terminate all worktime ssl_bump splice all sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/ssl_db -M <span class="hljs-number"><span class="hljs-number">4</span></span>MB # cache_mem <span class="hljs-number"><span class="hljs-number">512</span></span> MB maximum_object_size_in_memory <span class="hljs-number"><span class="hljs-number">512</span></span> KB memory_replacement_policy lru cache_dir aufs /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> # access_log daemon:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>log/squid/access.log squid logfile_rotate <span class="hljs-number"><span class="hljs-number">1</span></span> coredump_dir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid refresh_pattern ^ftp: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">10080</span></span> refresh_pattern ^gopher: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">1440</span></span> refresh_pattern -i (<span class="hljs-regexp"><span class="hljs-regexp">/cgi-bin/</span></span>|\?) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">0</span></span> refresh_pattern (Release|Packages(.gz)*)$ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">2880</span></span> refresh_pattern . <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">4320</span></span></code> </pre> <br></div></div><br>  <i><b>Der erste Block ist</b></i> wie folgt. <br><br><pre> <code class="javascript hljs">acl localnet src <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span> acl worktime time <span class="hljs-number"><span class="hljs-number">08</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span> acl SSL_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> acl Safe_ports port <span class="hljs-number"><span class="hljs-number">80</span></span> # http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">21</span></span> # ftp acl Safe_ports port <span class="hljs-number"><span class="hljs-number">443</span></span> # https acl Safe_ports port <span class="hljs-number"><span class="hljs-number">70</span></span> # gopher acl Safe_ports port <span class="hljs-number"><span class="hljs-number">210</span></span> # wais acl Safe_ports port <span class="hljs-number"><span class="hljs-number">1025</span></span><span class="hljs-number"><span class="hljs-number">-65535</span></span> # unregistered ports acl Safe_ports port <span class="hljs-number"><span class="hljs-number">280</span></span> # http-mgmt acl Safe_ports port <span class="hljs-number"><span class="hljs-number">488</span></span> # gss-http acl Safe_ports port <span class="hljs-number"><span class="hljs-number">591</span></span> # filemaker acl Safe_ports port <span class="hljs-number"><span class="hljs-number">777</span></span> # multiling http acl CONNECT method CONNECT</code> </pre> <br>  Er ist verantwortlich f√ºr Standard-ACL-Parameter.  In localnet √§ndern wir das lokale Netzwerk in unser eigenes und f√ºgen au√üerdem eine Arbeitszeit hinzu (optional).  Ich f√ºgte Arbeitszeit hinzu, da Lehrer oft zu mir kommen und sich beschweren, dass sie nichts finden k√∂nnen, alles unzug√§nglich ist.  Nat√ºrlich bin ich froh, dass alles so funktioniert, wie es sollte, aber ehrlich gesagt bin ich es leid, mir das anzuh√∂ren.  Jetzt melde ich ihre Behauptung, dass nach 15:00 Uhr die Filterung deaktiviert ist und sie die ben√∂tigten Informationen (fast) frei finden k√∂nnen.  Sie k√∂nnen Ihre Zeit hinzuf√ºgen oder die Filterung rund um die Uhr verlassen, ohne diese ACL hinzuzuf√ºgen. <br><br>  <i><b>Der zweite Block</b></i> definiert die Listen der zul√§ssigen und verbotenen Sites f√ºr HTTP und sieht wie folgt aus. <br><br><pre> <code class="javascript hljs">acl blacklist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist"</span></span> acl whitelist url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist"</span></span></code> </pre><br>  Wir werden sp√§ter Listen mit erlaubten und verbotenen Sites hinzuf√ºgen und sie werden in Dateien abgelegt, die in acl angegeben sind. <br><br>  <i><b>Der dritte Block</b></i> bestimmt die Zugriffsparameter √ºber HTTP und sieht so aus <br><br><pre> <code class="javascript hljs">http_access allow localhost http_access deny manager http_access deny !Safe_ports http_access deny CONNECT !SSL_ports http_access allow CONNECT http_access deny blacklist http_access allow whitelist http_access deny all worktime http_access allow all</code> </pre> <br>  Hier ist der Eintrag <i>http_access allow CONNECT</i> erforderlich, da Squid ohne ihn Squid niemanden ins Internet lassen w√ºrde.  Als n√§chstes folgen die Regeln f√ºr die Schwarz-Wei√ü-Listen.  Die Parameter <i>Verweigern</i> und <i>Zulassen</i> <i>verweigern</i> bzw. <i>erlauben den</i> Zugriff.  Danach folgt die Regel, den gesamten HTTP-Verkehr w√§hrend der Gesch√§ftszeiten vollst√§ndig zu sperren.  Wenn Sie keine Arbeitszeit festgelegt haben, l√∂schen Sie die <i>Arbeitszeit</i> , und das Verbot ist dauerhaft.  Ein wichtiger Punkt ist die Reihenfolge der Regeln, da Squid sie von oben nach unten liest <br>  <i><b>Der vierte Block</b></i> definiert die Porteinstellungen f√ºr Squid. <br><br><pre> <code class="javascript hljs">http_port <span class="hljs-number"><span class="hljs-number">3128</span></span> http_port <span class="hljs-number"><span class="hljs-number">3129</span></span> intercept https_port <span class="hljs-number"><span class="hljs-number">3130</span></span> intercept ssl-bump options=ALL:NO_SSLv3:NO_SSLv2 connection-auth=off cert=<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>squid/squid.pem</code> </pre> <br>  Der erste Parameter ist erforderlich, damit der Fehler "FEHLER: Keine Forward-Proxy-Ports konfiguriert" nicht unendlich in den Protokollen angezeigt wird.  Es f√ºllt das Protokoll und damit den Speicher.  Ein h√§ufiger Fehler, aber aus irgendeinem Grund habe ich in unserem Ru-Segment nicht gefunden, wie ich ihn beheben kann. Ausl√§ndische Foren haben geholfen.  Der zweite Parameter definiert den HTTP-Protokollport.  <i>Abfangen</i> bedeutet Proxy-Transparenz, dh es m√ºssen nicht auf jedem Computer Einstellungen festgelegt werden. <br>  Der dritte Parameter definiert den HTTPS-Port und seine Optionen.  Dies ist eine lange Schlange.  Die Datei <i>squid.pem</i> ist unser Zertifikat, das wir sp√§ter erstellen werden. <br><br>  <i><b>Der f√ºnfte Block</b></i> definiert die Parameter der SSL-Verbindung mit Squid.  Insbesondere weist er darauf hin, dass der gesamte Datenverkehr ohne Verwendung h√∂herer Caches sofort ins Internet geleitet werden sollte und die letzten beiden Verbindungen auch bei Fehlern bei der Zertifikats√ºberpr√ºfung zulassen, da die Entscheidung zum Besuch einer solchen Ressource vom Benutzer und nicht vom Server getroffen werden muss.  Es sieht so aus. <br><br><pre> <code class="javascript hljs">always_direct allow all sslproxy_cert_error allow all sslproxy_flags DONT_VERIFY_PEER</code> </pre> <br>  <i><b>Der sechste Block</b></i> legt die acl-Parameter der sp√§ter erstellten Listen ‚Äûschwarz‚Äú und ‚Äûwei√ü‚Äú sowie die Tiefe des Abfangens des HTTPS-Verkehrs fest. <br><br><pre> <code class="javascript hljs">acl blacklist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/blacklist_ssl"</span></span> acl whitelist_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist_ssl"</span></span> acl step1 at_step SslBump1</code> </pre> <br>  <i><b>Der siebte Block</b></i> bestimmt die Zugriffsparameter unter Verwendung des HTTPS-Protokolls.  Hier sind das Verbot und die Erlaubnis bereits f√ºr das <i>Beenden</i> bzw. <i>Splei√üen</i> verantwortlich.  Vergessen Sie auch hier nicht, die Arbeitszeit zu entfernen, wenn Sie keine bestimmte Arbeitszeit haben. <br><br><pre> <code class="javascript hljs">ssl_bump peek step1 ssl_bump terminate blacklist_ssl ssl_bump splice whitelist_ssl ssl_bump terminate all worktime ssl_bump splice all sslcrtd_program /usr/lib/squid/ssl_crtd -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/ssl_db -M <span class="hljs-number"><span class="hljs-number">4</span></span>MB</code> </pre><br>  <i><b>Der achte Block</b></i> legt den Cache und das Protokoll unseres Tintenfischs fest.  Hier ist nur der Parameter <i>logfile_rotate zu beachten</i> , der die Anzahl der Tage angibt, an denen das Protokoll gespeichert ist. <br><br><pre> <code class="javascript hljs"># cache_mem <span class="hljs-number"><span class="hljs-number">512</span></span> MB maximum_object_size_in_memory <span class="hljs-number"><span class="hljs-number">512</span></span> KB memory_replacement_policy lru cache_dir aufs /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span> # access_log daemon:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>log/squid/access.log squid logfile_rotate <span class="hljs-number"><span class="hljs-number">1</span></span> coredump_dir /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/spool/squid refresh_pattern ^ftp: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">10080</span></span> refresh_pattern ^gopher: <span class="hljs-number"><span class="hljs-number">1440</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">1440</span></span> refresh_pattern -i (<span class="hljs-regexp"><span class="hljs-regexp">/cgi-bin/</span></span>|\?) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>% <span class="hljs-number"><span class="hljs-number">0</span></span> refresh_pattern (Release|Packages(.gz)*)$ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">2880</span></span> refresh_pattern . <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>% <span class="hljs-number"><span class="hljs-number">4320</span></span></code> </pre> <br>  Damit ist die Einrichtung von squid.conf abgeschlossen.  Wir speichern die Datei und fahren mit der Erstellung des Zertifikats und der Listen fort. <br><br>  Gehen wir mit Squid in den Ordner <br><br><pre> <code class="javascript hljs">cd /etc/squid/</code> </pre> <br>  Geben Sie den folgenden Befehl ein, um das Zertifikat zu erstellen <br><br><pre> <code class="javascript hljs">openssl req -<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> -newkey rsa:<span class="hljs-number"><span class="hljs-number">1024</span></span> -days <span class="hljs-number"><span class="hljs-number">36500</span></span> -nodes -x509 -keyout squid.pem -out squid.pem</code> </pre> <br>  Als n√§chstes m√ºssen Sie die Zertifikatdaten eingeben.  Das Zertifikat ist 100 Jahre g√ºltig, um es f√ºr eine lange Zeit zu vergessen.  Es wird nur f√ºr Proxy ben√∂tigt. <br><br>  Erstellen Sie nun unsere Listendateien. <br><br><pre> <code class="javascript hljs">touch blacklist touch whitelist cp whitelist whitelist_ssl cp blacklist blacklist_ssl</code> </pre> <br>  Websites werden in Form von regul√§ren Ausdr√ºcken aufgelistet.  Um beispielsweise mail.ru zu entsperren, √∂ffnen Sie die <i>Whitelist</i> <br><br><pre> <code class="javascript hljs">nano whitelist</code> </pre> <br>  und f√ºgen Sie den folgenden Ausdruck hinzu. <br><br><pre> <code class="javascript hljs">mail\.ru</code> </pre> <br>  Blockiere jetzt Games.Mail.ru.  √ñffnen wir unsere <i>schwarze Liste</i> <br><br><pre> <code class="javascript hljs">nano blacklist</code> </pre> <br>  und schreiben Sie den folgenden Ausdruck hinein <br><br><pre> <code class="javascript hljs">games\.mail\.ru</code> </pre> <br>  Da sich in der Regel ein Blacklist-Blocker √ºber unserer Whitelist befindet, wird die Site beim Wechsel zu mail.ru wie erwartet ge√∂ffnet (mit Ausnahme von Bildern, aber dazu sp√§ter mehr). Wenn Sie versuchen, zu Games zu wechseln, Squid us werde nicht loslassen. <br><br>  Einige Websites haben viele Subdomains, Subdomains usw.  Zum Beispiel speichert mail.ru seine Bilder auf imgsmail.ru.  In Bezug auf andere √§hnliche Websites m√ºssen Sie die gew√ºnschte Website in einem beliebigen Browser (ich verwende Chrome) und anschlie√üend in den Entwicklertools (in Chrome werden sie durch Dr√ºcken von F12 aufgerufen) √∂ffnen. <br><br><img src="https://habrastorage.org/webt/ie/43/a7/ie43a7r-zkjhouxldavryxg0kjg.jpeg"><br><br>  Gehen Sie zur Registerkarte Quellen und sehen Sie, von welchen anderen Ressourcen die Site Informationen l√§dt. <br><br>  Kopieren Sie die Websites nach dem Hinzuf√ºgen in die Listen f√ºr HTTPS. <br><br><pre> <code class="javascript hljs">cp whitelist whitelist_ssl cp blacklist blacklist_ssl</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Listenf√ºllungstipp</b> <div class="spoiler_text">  Erstellen Sie eine Nur-Text-Datei auf Ihrem Computer, suchen und kopieren Sie die Liste der zul√§ssigen Websites und f√ºgen Sie sie Ihrer hinzu.  Ersetzen Sie dann in einem normalen Notizbuch den Punkt automatisch durch einen Schr√§gstrich (\.) Und l√∂schen Sie den unn√∂tigen Punkt mit demselben automatischen Ersatz (www, http, das Zeichen "/" usw.).  Anschlie√üend kann eine solche Datei mithilfe des Terminals sofort auf die Bl√§tter auf dem Server kopiert werden. <br></div></div><br>  √úberpr√ºfen Sie nun die Konfiguration. <br><br><pre> <code class="javascript hljs">squid -k check</code> </pre> <br>  Wenn alles in Ordnung ist, stoppen Sie Squid. <br><br><pre> <code class="javascript hljs">/etc/init.d/squid stop</code> </pre> <br>  Erstellen Sie den Cache neu <br><br><pre> <code class="javascript hljs">squid -z</code> </pre> <br>  Und wieder Squid laufen lassen <br><br><pre> <code class="javascript hljs">/etc/init.d/squid start</code> </pre> <br>  Nach √Ñnderungen an Listen oder der Squid-Konfiguration muss diese mit dem Befehl neu geladen werden <br><br><pre> <code class="javascript hljs">/etc/init.d/squid restart</code> </pre> <br>  Sie k√∂nnen auch die Seite mit den Zugriffsbeschr√§nkungen (funktioniert nur unter HTTP) unter dem Pfad <i><b>/ usr / share / squid / Errors / ~ Russian-1251</b></i> √§ndern.  Suchen Sie im Ordner nach der Datei <i><b>ERR_ACCESS_DENIED</b></i> und bearbeiten Sie sie.  Die Dateisyntax lautet HTML. <br><br><h4>  3.3.  √úberwachen des Serverstatus und Konfigurieren der Firewall </h4><br>  Installieren Sie das <b>Webmin-</b> Dienstprogramm, mit dessen Hilfe wir unsere Firewall konfigurieren, um den Status unseres Servers zu √ºberwachen.  Dar√ºber hinaus k√∂nnen Sie damit den Status der CPU, des Arbeitsspeichers usw. √ºberwachen, Pakete aktualisieren, Komponenten hinzuf√ºgen und konfigurieren und vieles mehr.  Es hat ein eigenes Terminal, wenn auch ungeschickt.  Das Dienstprogramm funktioniert √ºber jeden Browser. Daher k√∂nnen Sie von jedem Computer im Netzwerk aus eine Verbindung zu unserem Server herstellen. Dies ist praktisch, aber nicht sicher.  Falls gew√ºnscht, kann die Verbindung nur auf einzelne IP-Adressen in der "IP-Zugriffskontrolle" in Webmin selbst beschr√§nkt werden. <br><br>  F√ºgen Sie vor dem Start der Installation das Webmin-Repository hinzu.  √ñffnen Sie die Datei source.list. <br><br><pre> <code class="javascript hljs">nano /etc/apt/sources.list</code> </pre> <br>  Und f√ºgen Sie die folgende Zeile hinzu. <br><br><pre> <code class="javascript hljs">deb http:<span class="hljs-comment"><span class="hljs-comment">//download.webmin.com/download/repository sarge contrib</span></span></code> </pre> <br>  Installieren Sie nun den GPG-Schl√ºssel, mit dem Pakete im Webmin-Repository signiert sind <br><br><pre> <code class="javascript hljs">cd /root wget http:<span class="hljs-comment"><span class="hljs-comment">//www.webmin.com/jcameron-key.asc apt-key add jcameron-key.asc</span></span></code> </pre> <br>  Als n√§chstes aktualisieren wir die Liste der Pakete und installieren das Dienstprogramm <br><br><pre> <code class="javascript hljs">apt-get update apt-get install webmin</code> </pre> <br>  Sie k√∂nnen in jedem Browser eine Verbindung zum Server herstellen, indem Sie die Adressleiste eingeben <br><br><pre> <code class="javascript hljs">IP__:<span class="hljs-number"><span class="hljs-number">10000</span></span></code> </pre> <br>  Standardm√§√üig stellt Webmin eine Verbindung √ºber SSL her, und die meisten Browser geben einen nicht vertrauensw√ºrdigen Zertifikatfehler aus.  Deaktivieren Sie SSL, um nicht jedes Mal Vertrauen zu w√§hlen.  √ñffnen Sie dazu die Datei <i>/etc/webmin/miniserv.conf</i> <br><br><pre> <code class="javascript hljs">nano /etc/webmin/miniserv.conf</code> </pre> <br>  Suchen Sie die Zeichenfolge <i><b>ssl = 1</b></i> und ersetzen Sie sie durch <i><b>ssl = 0</b></i> .  In derselben Datei k√∂nnen Sie den Verbindungsport √§ndern.  Standardm√§√üig ist es 10000. Sie k√∂nnen jeden freien setzen. <br><br>  Nachdem Sie eine Verbindung zu Webmin hergestellt haben, gehen Sie zu <i>Webmin -&gt; Webmin-Konfiguration</i> und wechseln Sie die Sprache zu Russisch.  Gehen Sie dann zu <i>Netzwerk -&gt; Firewall</i> .  Standardm√§√üig ist unsere Firewall sauber.  Wir gehen ganz nach unten und w√§hlen gegen√ºber "Beim <i>Booten aktivieren"</i> <i>"Ja"</i> .  Klicken Sie auf <i>"Konfiguration anwenden".</i>  Jetzt werden die Einstellungen unserer Firewall in der Datei <i><b>/etc/webmin/firewall/iptables.save</b></i> angegeben und mit dem System gestartet.  Wenn es keine solche Datei gibt, lesen Sie, was in der Zeile ‚ÄûDatei mit Regeln‚Äú auf der Registerkarte Firewall in Webmin geschrieben steht.  √ñffnen wir es im Terminal. <br><br><pre> <code class="javascript hljs">nano /etc/webmin/firewall/iptables.save</code> </pre> <br>  Wir gehen zum <i><b>* nat-</b></i> Block und f√ºgen am Ende vor <i>COMMIT</i> die folgenden Regeln hinzu. <br><br><pre> <code class="javascript hljs">-A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number"><span class="hljs-number">80</span></span> -j DNAT --to-destination ip_:<span class="hljs-number"><span class="hljs-number">3129</span></span> -A PREROUTING -p tcp -m tcp -i _ --dport <span class="hljs-number"><span class="hljs-number">443</span></span> -j REDIRECT --to-ports <span class="hljs-number"><span class="hljs-number">3130</span></span></code> </pre> <br>  Diese Regeln leiten den Datenverkehr zu den Ports 80 (HTTP) und 443 (HTTPS) des Servers zu den Ports unseres Squid.  Hier habe ich zwei Varianten der Regeln mit DNAT und REDIRECT vorgestellt.  Sie k√∂nnen beide verwenden oder eine Option ausw√§hlen, indem Sie die entsprechenden Ports eingeben. <br><br><div class="spoiler">  <b class="spoiler_title">Konfigurieren Sie FIrewall f√ºr die alternative Netzwerkeinrichtung</b> <div class="spoiler_text">  Diese Option ist geeignet, wenn Sie das oben beschriebene alternative Netzwerk-Setup verwendet haben. <br>  Erstellen Sie zun√§chst eine Datei mit den Regeln f√ºr unsere Firewall und geben Sie ihr das Recht zur Ausf√ºhrung. <br><pre> <code class="javascript hljs">touch /etc/nat chmod +x /etc/nat</code> </pre> <br>  √ñffne es <br><pre> <code class="javascript hljs">nano /etc/nat</code> </pre> <br>  Und f√ºgen Sie den folgenden Inhalt hinzu <br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh #Firewall iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport 80 -j DNAT --to-destination ip_:3129 iptables -t nat -A PREROUTING -p tcp -m tcp -i _ --dport 443 -j REDIRECT --to-ports 3130</span></span></code> </pre> <br>  Wie im Fall von Webmin habe ich zwei Varianten der Regeln mit DNAT und REDIRECT vorgestellt.  Sie k√∂nnen beide verwenden oder eine Option ausw√§hlen, indem Sie die entsprechenden Ports eingeben. <br>  F√ºgen Sie nun unsere Datei sofort nach dem Start des Netzwerks zum Download hinzu.  √ñffnen Sie die Netzwerkeinstellungsdatei <br><pre> <code class="javascript hljs">nano /etc/network/interfaces</code> </pre> <br>  Und f√ºgen Sie die Zeile am Ende der Datei hinzu <br><pre> <code class="javascript hljs">post-up /etc/nat</code> </pre> <br>  PS: Das Plus dieser Option ist, dass Sie in Zukunft Ihre eigenen Regeln hinzuf√ºgen k√∂nnen, indem Sie einfach die Datei / etc / nat bearbeiten.  Webmin ist etwas komplizierter. <br></div></div><br>  Damit ist die Servereinrichtung abgeschlossen.  Starten Sie es neu. <br><br><pre> <code class="javascript hljs">reboot</code> </pre> <br>  Fahren wir mit der Einrichtung des MikroTik-Routers fort. <br><br><h4>  3.4.  Konfigurieren eines MikroTik-Routers zum Umleiten des Datenverkehrs an Proxy </h4><br>  Wir gehen davon aus, dass Sie das <b>WinBox-</b> Dienstprogramm zur Fernsteuerung bereits heruntergeladen haben, das Internet und das lokale Netzwerk konfiguriert sind und die Firewall auf dem Router sauber ist.  Sie kennen den Namen der LAN-Schnittstelle (Sie k√∂nnen ihn in <i>IP - DHCP Server - DHCP sehen</i> ). <br><br>  <b>a)</b> Gehen Sie zu WinBox, gehen Sie zu <i><b>IP - DHCP Server - Leases</b></i> .  In der Liste suchen wir nach IP-Computern, f√ºr die die Filterung nicht funktioniert (Director, Management). Klicken Sie mit der rechten Maustaste darauf und w√§hlen <i><b>Sie</b></i> im Men√º die <i><b>Option Statisch</b></i> erstellen.  Neben ihnen sollte der Buchstabe "D" verschwinden, was "dynamisch" bedeutet.  Jetzt werden diese Adressen diesen Computern unabh√§ngig von der Lease-Zeit sofort statisch anhand der MAC-Adresse zugewiesen.  Wenn der Laptop √ºber WLAN und Kabel verwendet wird, m√ºssen Sie auf beiden MAC-Adressen die Option "Statisch erstellen" ausw√§hlen. <br><br>  <b>b)</b> Gehen Sie als n√§chstes zu <i><b>IP - Firewall - Adresslisten</b></i> und klicken Sie auf das blaue <i><b>Pluszeichen "+"</b></i> .  <i><b>Geben Sie im</b></i> Feld <i><b>Name</b></i> den Namen f√ºr unsere Gruppe von <s>hellen,</s> ungefilterten Adressen an, z. B. "Administratoren".  <i><b>Geben Sie im</b></i> Feld Adresse eine IP-Adresse von denen an, denen eine statische zugewiesen wurde.  Wir wiederholen dies f√ºr jede Adresse und w√§hlen unsere Gruppe im Feld Name mit einem Pfeil aus. <br><br>  <b>c)</b> Gehen <i><b>Sie</b></i> in derselben <i><b>IP-Firewall</b></i> zur Registerkarte <i><b>Mangle</b></i> und klicken Sie auf <i><b>"+"</b></i> .  Ein Fenster mit Registerkarten wird ge√∂ffnet.  F√ºllen Sie auf der Registerkarte <i><b>Allgemein</b></i> die folgenden Felder aus: <br><br><pre> <code class="javascript hljs">Chain - Prerouting Src. Address - __proxy Protocol - <span class="hljs-number"><span class="hljs-number">6</span></span> (tcp) Dst. Port - <span class="hljs-number"><span class="hljs-number">80</span></span> In. Interface - __</code> </pre><br>  √úberpr√ºfen Sie auf der Registerkarte <b><i>Aktion</i></b> den Wert <i><b>Akzeptieren</b></i> und klicken Sie auf OK. <br><br>  Wiederholen Sie den Vorgang, jedoch im Feld <i>Dst.</i>  <i>Port</i> setzt den Wert auf <i>443</i> . <br><br>  <b>d)</b> Klicken Sie erneut auf "+" und f√ºllen Sie auf der Registerkarte " <i><b>Allgemein</b></i> " erneut die folgenden Felder aus: <br><br><pre> <code class="javascript hljs">Chain - Prerouting Protocol - <span class="hljs-number"><span class="hljs-number">6</span></span> (tcp) Dst. Port - <span class="hljs-number"><span class="hljs-number">80</span></span> In. Interface - __</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gehen Sie zur Registerkarte </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erweitert</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und in das Feld </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Src. </font><font style="vertical-align: inherit;">Adressliste W√§hlen</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sie unsere Verwaltungsadressliste " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Administratoren</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " aus. </font><font style="vertical-align: inherit;">Stellen Sie sicher, dass Sie auf das angezeigte Feld neben der Liste klicken. </font><font style="vertical-align: inherit;">Ein Ausrufezeichen </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"!"</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wird angezeigt </font><b><font style="vertical-align: inherit;">. </font></b><font style="vertical-align: inherit;">, was logisch NICHT oder NEGATIV bedeutet. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gehen Sie zur Registerkarte </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aktion</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und f√ºllen Sie die Felder aus:</font></font><br><br><pre> <code class="javascript hljs">Action - mark routing New Routing Mark - to_proxy Passthrough -  </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klicken Sie auf OK und f√ºhren Sie die gleichen Aktionen aus, jedoch im Feld </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dst. </font><font style="vertical-align: inherit;">Port</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> geben Sie den Wert </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443 an</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> F√ºgen Sie abschlie√üend die letzte Regel hinzu. </font><font style="vertical-align: inherit;">Klicken Sie auf das Pluszeichen und f√ºllen Sie die folgenden Felder auf der Registerkarte </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Allgemein aus</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="javascript hljs">Chain - Prerouting In. Interface - __ Routing Mark - to_proxy</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Infolgedessen sollte Folgendes mit Ihren Parametern geschehen. </font><font style="vertical-align: inherit;">Ordnung ist wichtig! </font></font><br><br><img src="https://habrastorage.org/webt/tp/vw/zi/tpvwzizj0x_x4hg5quooe1t8bpo.png"><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir gehen in </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - Routen</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und dr√ºcken auf "+". </font><font style="vertical-align: inherit;">F√ºllen Sie die folgenden Felder aus:</font></font><br><br><pre> <code class="javascript hljs">Dst. Address - <span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> Gateway - __proxy Routing Mark - to_proxy</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klicken Sie auf "OK" und fertig. </font><font style="vertical-align: inherit;">Wenn der Server eingeschaltet ist, wird der gesamte HTTP- und HTTPS-Verkehr √ºber unseren Squid geleitet.</font></font><br><br><h4>  3.5.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alternatives Setup f√ºr MikroTik und andere Router </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese Option eignet sich sowohl f√ºr den MikroTik-Router als auch f√ºr alle anderen, selbst die einfachsten (mit Ausnahme der gemieteten Anbieterteile, von denen Sie selbst wissen, was). </font><font style="vertical-align: inherit;">In diesem Fall implementieren wir die gemeinsame Nutzung des Internetzugangs nicht auf dem Router, sondern auf Squid selbst.</font></font> Also fangen wir an. <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir gehen davon aus, dass Sie diesen Punkt erreicht haben, indem Sie alle h√∂heren abgeschlossen haben, einschlie√ülich der Einrichtung der Umleitung zu Proxy in MikroTik. F√ºr einen st√∂rungsfreien Betrieb der beschriebenen Option m√ºssen wir </font><font style="vertical-align: inherit;">Absatz </font><i><b><font style="vertical-align: inherit;">3.4</font></b></i><font style="vertical-align: inherit;"> Buchstabe </font></font><b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></i></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dieses Artikels </font><font style="vertical-align: inherit;">streichen </font><font style="vertical-align: inherit;">. Sie k√∂nnen den gesamten Punkt 3.4 abbrechen (m√∂glicherweise unter Buchstabe </font><i><font style="vertical-align: inherit;">a),</font></i><font style="vertical-align: inherit;"> damit sich unsere IPs nicht √§ndern. Dies ist jedoch optional. Es ist wichtig, dass wir das Routing selbst abbrechen. Gehen Sie dazu zu </font><i><b><font style="vertical-align: inherit;">IP - Routen</font></b></i><font style="vertical-align: inherit;"> , suchen Sie nach unserer Route, w√§hlen Sie sie aus und klicken Sie auf das </font><b><i><font color="#cc0000"><font style="vertical-align: inherit;">rote Kreuz</font></font></i></b><font style="vertical-align: inherit;"> (kein Pluszeichen, sondern das Kreuz neben dem H√§kchen). Die Route wird grau =&gt; sie ist deaktiviert. Die Filterung wurde ebenfalls deaktiviert. Jetzt gehen alle Clients direkt √ºber einen Router ins Internet. </font><b><font style="vertical-align: inherit;">b)</font></b></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"></font><b><i><font color="#cc0000"><font style="vertical-align: inherit;"></font></font></i></b><font style="vertical-align: inherit;"></font><br><br> <b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gehen Sie jetzt zu unserem Server und gehen Sie zu dem Ordner mit Squid </font></font><br><pre> <code class="javascript hljs">cd /etc/squid/</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ñffnen Sie die Konfigurationsdatei </font></font><br><pre> <code class="javascript hljs">nano squid.conf</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und wir f√ºgen es in Bl√∂cken hinzu: </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im ersten Block</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unmittelbar nach der Zeile mit acl localnet ...</font></font><br><pre> <code class="javascript hljs">acl admins src <span class="hljs-string"><span class="hljs-string">"/etc/squid/admins-ip"</span></span> # IP   acl students src <span class="hljs-string"><span class="hljs-string">"/etc/squid/students-ip"</span></span> # IP  </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir brauchen keine Liste mit den Computern der Lehrer, da verstanden wird, dass alle anderen Lehrer sind. </font><font style="vertical-align: inherit;">Sie k√∂nnen es jedoch selbst mit den entsprechenden Regeln in anderen Bl√∂cken hinzuf√ºgen. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im zweiten Block</font></font></b></i> <br><pre> <code class="javascript hljs">acl whitelist-stud url_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist-stud"</span></span> #     </code> </pre> <br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Im dritten Block</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nach http_access verweigern Sie die Blacklist</font></font><br><pre> <code class="javascript hljs">http_access allow admins #      http_access allow students whitelist-stud #       http_access deny students #       </code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferner bleibt der Block unver√§ndert, da die Lehrer (alle anderen IPs) folgen und nach ihrer wei√üen Liste und w√§hrend der Arbeitszeit (falls angegeben) filtern. </font><font style="vertical-align: inherit;">Sie k√∂nnen die Admins-Gruppe auch die Blacklist umgehen lassen, indem Sie die Zulassungsregel √ºber der Verbotsregel festlegen, oder separate IPs (z. B. Ihre eigenen) zu einer separaten ACL hinzuf√ºgen und in die Regeln √ºber der Blacklist einf√ºgen. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der vierte und f√ºnfte Block sind</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unver√§ndert. </font></font><br> <i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie im sechsten Block</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzu</font></font><br><pre> <code class="javascript hljs">acl whitelist-stud_ssl ssl::server_name_regex -i <span class="hljs-string"><span class="hljs-string">"/etc/squid/whitelist-stud_ssl"</span></span></code> </pre> <br> <i><b><font style="vertical-align: inherit;"></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie</font><i><b><font style="vertical-align: inherit;"> im siebten Block</font></b></i><font style="vertical-align: inherit;"> add hinzu, nachdem ssl_bump blacklist_ssl beendet hat</font></font><br><pre> <code class="javascript hljs">ssl_bump splice admins ssl_bump splice students whitelist-stud_ssl ssl_bump terminate students</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das Prinzip ist das gleiche wie im dritten Block. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Rest bleibt unver√§ndert. </font><font style="vertical-align: inherit;">Speichern und beenden </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Erstellen Sie nun unsere Listen mit IP-Adressen.</font></font><br><pre> <code class="javascript hljs">touch admins-ip touch students-ip</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und Whitelists f√ºr Studenten. </font></font><br><pre> <code class="javascript hljs">touch whitelist-stud cp whitelist-stud whitelist-stud_ssl</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie die erforderlichen IP-Adressen und Sites zu den entsprechenden Listen hinzu. </font><font style="vertical-align: inherit;">In der Sch√ºlerliste der Websites k√∂nnen Sie die Liste f√ºr Lehrer kopieren, indem Sie Websites entfernen, die von den Sch√ºlern nicht ben√∂tigt werden. </font><font style="vertical-align: inherit;">Das Kopieren von Dateien unter Linux erfolgt mit dem Befehl</font></font><br><pre> <code class="javascript hljs">cp &lt;    &gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name"></span></span></span></span><span class="xml"><span class="hljs-tag">    &gt;</span></span></span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Starten Sie Squid neu </font></font><br><pre> <code class="javascript hljs">/etc/init.d/squid restart</code> </pre> <br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d)</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir sind zu dem Wichtigsten gekommen, n√§mlich wie wir Kunden dazu bringen k√∂nnen, √ºber unseren Proxy online zu gehen. Wir m√ºssen das Gateway unseres DHCP-Servers von der Adresse des Routers auf die Adresse unseres Servers √§ndern. Dazu muss die Serveradresse nat√ºrlich statisch oder an den MAC gebunden sein. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In MikroTik:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Gehen Sie zu </font></font><i><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP - DHCP Server - Netzwerk</font></font></b></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und doppelklicken Sie auf unser Netzwerk. √Ñndern Sie im Feld Gateway die Adresse des Routers in die Adresse des Proxyservers. Klicken Sie auf OK und fertig. Sie k√∂nnen den Router neu starten, damit die Einstellungen f√ºr alle aktiven Clients korrekt aktualisiert werden. Danach √§ndern die Clients wahrscheinlich den Netzwerktyp in "√∂ffentlich" (wenn es privat war). </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In einem normalen Router:</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Suchen Sie im Handbuch nach Ihrem Router, wo Sie das Gateway des DHCP-Servers √§ndern k√∂nnen, aber ich sage, was in den Einstellungen enthalten ist :)</font></font><br><br> <i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fazit </font><i><font style="vertical-align: inherit;">:</font></i><font style="vertical-align: inherit;"> Als Ergebnis dieser alternativen L√∂sung konnten wir den Zugriff nach IP und Listen optimieren und normale IP-Adressen von Clients in den Squid-Protokollen abrufen. </font><font style="vertical-align: inherit;">Wenn einige Kunden online gehen m√ºssen, um Proxy √ºber einen Router zu umgehen, lesen Sie den Spoiler.</font></font><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet umgeht Proxy</font></font></b> <div class="spoiler_text">   ,  -      Squid ,        ,   , <br></div></div><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4. Fazit </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um all das zusammenzufassen. </font><font style="vertical-align: inherit;">Wir haben es geschafft, Linux Ubuntu 18.04 LTS von Grund auf neu zu installieren und zu konfigurieren, Squid mit HTTPS-Unterst√ºtzung zu erstellen und zu installieren, die Whitelist-Filterung zu konfigurieren und den Proxyserver in unser Netzwerk zu integrieren, ohne einen zus√§tzlichen DHCP-Server installieren zu m√ºssen.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 5. Liste der Quellen </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei der Erstellung des Artikels wurden verschiedene Materialien von den Websites des </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Technischen Blogs von Interface LLC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> und von </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web-Sicherheitsspezialisten - Webfilter f√ºr Ihr Netzwerk</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - sowie pers√∂nliches Wissen und Erfahrung verwendet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bei der Bearbeitung und Erg√§nzung des Artikels haben folgende Benutzer sehr geholfen: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kanlas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PetRiot</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Barsook</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Vielen Dank an sie f√ºr ihre Hilfe und Hilfe.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Notizen des Autors </font></font></h3><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alle Arbeiten mit dem Server m√ºssen im Superuser-Modus ausgef√ºhrt werden, indem </font><font style="vertical-align: inherit;">vor dem Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hinzugef√ºgt </font><font style="vertical-align: inherit;">oder der Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo -s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> einmal </font><i><font style="vertical-align: inherit;">eingegeben wird</font></i><font style="vertical-align: inherit;"> .</font></font></li><li> Squid \     ,    , ,     .          . </li><li>    , .    ,        1000 . </li><li> <s> ,           IP-  Squid.   Squid   IP- ‚Äî  Mikrotik.    ,      DHCP    ,      . ,    ,    ,     IP .</s> ‚Äî     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Barsook</a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Damit Squid mit einer gro√üen Anzahl von Clients (mehr als 50) arbeiten kann, ist mindestens 1 GB RAM erforderlich. </font><font style="vertical-align: inherit;">Bevorzugter, da Squid Speicher frisst. </font><font style="vertical-align: inherit;">Sie k√∂nnen den Speicherstatus √ºberpr√ºfen, indem Sie den Befehl </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">top</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eingeben </font><font style="vertical-align: inherit;">.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ich empfehle, beide Optionen f√ºr die Konfiguration des Routers zu verwenden, da Sie die Sperre umgehen k√∂nnen, wenn Sie in den Netzwerkeinstellungen explizit ein anderes Gateway angeben (den Router selbst). </font></font></li></ol><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD1:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alternative Netzwerkkonfiguration hinzugef√ºgt und Firewall </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD2:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Alternative </font><b><font style="vertical-align: inherit;">Routerkonfigurationsoption</font></b><font style="vertical-align: inherit;"> hinzugef√ºgt, bei der Probleme mit der Anzeige von Adressen in Squid-Protokollen behoben wurden. </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD3:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In 3.1 wurde ein Fix hinzugef√ºgt, der es Paketen erm√∂glicht, den Server zu passieren, den er urspr√ºnglich vergessen hatte, hinzuzuf√ºgen. </font><font style="vertical-align: inherit;">Andernfalls funktioniert das Internet nicht. </font><font style="vertical-align: inherit;">Vielen Dank an </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dmitry1986</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr das Testen des Artikels.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de473584/">https://habr.com/ru/post/de473584/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de473570/index.html">Suche 314 km¬≤ in 10 Stunden - der letzte Kampf der Suchingenieure gegen den Wald</a></li>
<li><a href="../de473572/index.html">‚ÄûZakroma Rodina‚Äú wird erz√§hlt: Deutschland wird die strategischen Reserven nach der neuen Methode bestimmen</a></li>
<li><a href="../de473574/index.html">Anwendung auf TSD und Kommunikation mit 1C: Enterprise 8.3 √ºber HTTP-Service. Teil 3 (BroadcastReceiver Abrufen des Barcodes)</a></li>
<li><a href="../de473576/index.html">Entwickler-Experiment-Infrastruktur</a></li>
<li><a href="../de473578/index.html">Erstellen dynamischer Module f√ºr Nginx</a></li>
<li><a href="../de473586/index.html">FortiConverter oder problemloses Bewegen</a></li>
<li><a href="../de473588/index.html">Aufdringliche Asse: Kinematik der "umgekehrten" Landung in blauen Fliegen</a></li>
<li><a href="../de473590/index.html">Wie ich 3 von 4 Goldmedaillen bei der Computerolympiade gewonnen habe</a></li>
<li><a href="../de473592/index.html">Scrum Community MeetUp bei Raiffeisenbank + Sendung</a></li>
<li><a href="../de473596/index.html">Python v3.x: Ausnahmehandler f√ºr Coroutine- und Synchronfunktionen. Im Allgemeinen f√ºr alles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>