<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ”‚ â›±ï¸ ğŸ•ºğŸ» Pengalaman dengan printer kartu, bagian 1 ğŸ‘¨ğŸ¾â€ğŸ’» ğŸŒˆ ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan berguna bagi mereka yang mulai bekerja dengan printer kartu ( Evolis Primacy dan Smart-51 ) dan kartu berkode NFC seperti Mifare Clas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengalaman dengan printer kartu, bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481734/"><p>  Artikel ini akan berguna bagi mereka yang mulai bekerja dengan printer kartu ( <strong>Evolis Primacy</strong> dan <strong>Smart-51</strong> ) dan kartu berkode NFC seperti <strong>Mifare Classic</strong> dan <strong>Mifare DESFire EV2</strong> .  Pada bagian pertama kita akan menggambarkan kesan umum bekerja dengan printer kartu, serta masalah yang harus kita hadapi.  Pada bagian kedua, direncanakan untuk menunjukkan bagian yang lebih praktis: kode, kiat pengoperasian. </p><br><h3 id="1-kak-poyavilas-zadacha">  1. Bagaimana tugas itu muncul </h3><br><p>  Kami sedang mengembangkan sistem tiket elektronik, yang mencakup bekerja dengan kartu NFC.  Setiap kartu NFC memiliki <strong>Nomor yang mudah digunakan</strong> , dan <strong>ID</strong> individual.  <strong>Nomor tersebut</strong> harus dicetak pada kartu, dan <strong>ID</strong> ditulis dalam chip NFC.  Salah satu tugasnya adalah membangun produksi kartu transportasi yang stabil. </p><br><p>  Pada tahap pertama, masalah diselesaikan dengan cara paling sederhana - cetakan dengan <strong>Angka</strong> dicetak oleh penyedia kartu NFC, dan ID direkam oleh kami menggunakan pembaca desktop, perangkat lunak khusus dan seseorang.  Setelah menerima kartu dari pemasok, Anda harus mendaftarkan kartu ke dalam sistem dan menghubungkan <strong>ID</strong> dan <strong>Nomor</strong> satu sama lain.  Sebagai pembaca desktop, kami menggunakan Z-2 Reader [1]. </p><br><p>  Prosesnya terlihat seperti ini: </p><br><ul><li>  Operator mengambil kartu.  Nomor kartu sudah dicetak pada kartu, tetapi pendaftaran kartu dalam sistem dan pencatatan <strong>ID</strong> dalam chip NFC diperlukan </li><li>  Operator meletakkan kartu pada Pembaca Z-2 dan mendaftarkan <strong>Nomor</strong> dalam sistem tiket elektronik dengan memasukkan <strong>Nomor</strong> Kartu secara manual.  Untuk bundling dan pendaftaran, panggilan API HTTPS dibuat </li><li>  Operator mengambil kartu berikutnya dan melakukannya lagi. </li></ul><br><p>  Solusi sederhana dan cepat dengan satu kelemahan <em>kecil</em> .  Pengaruh faktor manusia menghasilkan kartu hantu yang <strong>Nomor yang</strong> tercetak di kartu tidak sesuai dengan <strong>ID</strong> tautan - <strong>Nomor</strong> dalam basis data sistem. </p><a name="habracut"></a><br><p>  Maka lahirlah pernyataan masalah berikut: Diperlukan untuk mencetak <strong>Nomor</strong> , menuliskan <strong>ID</strong> dan mendaftarkan kartu NFC dalam sistem <strong>secara atom</strong> dan dengan keterlibatan manusia yang minimal. </p><br><p>  Dalam artikel ini kami akan menjelaskan semua peralatan yang kami gunakan, dan semua perangkap.  Pada akhirnya, kami akan mencoba mengatakan peralatan mana yang lebih baik bagi kami. </p><br><h3 id="11-nfc-karty">  1.1.  Kartu nfc </h3><br><p>  Kami meninjau kartu NFC MIFARE Classic 1K dan MIFARE DESFire EV2.  MIFARE Classic adalah yang paling umum dan paling rentan disalin.  Namun, mereka terus menjadi populer di tempat-tempat seperti universitas dan transportasi umum.  Saat menangani arus kas, solusi yang lebih andal dibutuhkan.  Karenanya, kartu MIFARE DESFire EV2 menjadi alternatif.  Ini adalah salah satu jenis kartu terakhir yang menggunakan DES, TDES (2KTDES, 3KTDES), algoritma enkripsi AES [2, 3].  Secara singkat tentang setiap peta: </p><br><p>  <em>MIFARE Classic</em> </p><br><p>  Kartu memori adalah sektor dan blok.  Unit memori pertama adalah sektor.  Ada 16 sektor di peta, yang masing-masing memiliki 4 blok data.  Memori setiap blok adalah 16 byte.  Untuk membaca dan / atau menulis data, pembaca harus masuk ke sektor ini.  Satu blok khusus di setiap sektor, blok trailer, dirancang untuk menyimpan kunci.  Pertama-tama, untuk bekerja dengan sektor ini, Anda harus masuk ke blok trailer.  Blok trailer juga menyimpan 16 byte: 6 byte per kunci tipe A, 4 byte per hak akses, 6 byte per tipe kunci B. </p><br><p>  Gambar 1 [4] dengan jelas menunjukkan sektor, balok dan kunci. </p><br><br><p><img src="https://habrastorage.org/webt/lj/mr/as/ljmrasis1ncssiee0chfn8ougie.png"><br>  Gambar 1 - Perangkat memori di Mifare Classic </p><br><p>  <em>MIFARE DESFire</em> </p><br><p>  Perangkat kartu menyerupai sistem file.  Kartu terdiri dari aplikasi dan file.  Di peta ada aplikasi utama (aplikasi) dengan id - 000000 (0x00, 0x00, 0x00).  Di dalam aplikasi utama, Anda dapat membuat aplikasi baru dan membuat file data di dalamnya. <br>  Karakteristik kartu DESFire disajikan pada Gambar 2 [5].  Setiap aplikasi diberi kunci aksesnya sendiri ke file aplikasi. </p><br><p><img src="https://habrastorage.org/webt/6q/xc/6f/6qxc6fkpk9i2jjpocy9v6iwgf0c.png"><br>  Gambar 2 - Karakteristik kartu Mifare DESFire </p><br><h3 id="12-printery-kak-reshenie">  1.2.  Printer sebagai solusi </h3><br><p>  Untuk menyelesaikan tugas ini, printer kartu khusus digunakan.  Saat ini ada banyak perusahaan yang memasok printer ini.  Misalnya: Evolis, Smart, Zebra, Datacard, dll. Kami menggunakan printer <strong>Evolis Primacy</strong> dan <strong>Smart-51</strong> .  Printer ini memiliki banyak kesamaan di jantung pekerjaan: mereka berdua menggunakan kartrid tape untuk mencetak dan memiliki prinsip pembersihan yang serupa.  Ada juga perbedaan - encoders NFC yang berbeda.  Kedua printer dapat ditambah atau diganti tergantung pada kebutuhan pelanggan. </p><br><p>  Programmer untuk kartu NFC didasarkan pada standar ISO / IEC 14443A dan ISO / IEC 7816-4 untuk DESFire, ISO / IEC 14443 Tipe A untuk Classic.  Namun, tergantung pada pabrikan, pemrogram dapat menerima perintah asli sesuai dengan standar, atau membungkus perintah asli secara khusus untuk pemrogram tertentu.  Kita berhadapan dengan satu dan lainnya. </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Keutamaan Evolis </th><th>  Smart-51 </th></tr></thead><tbody><tr><td>  Cetak </td><td>  Kaset ini digunakan untuk mencetak (warna atau monokrom).  Kaset kaset disediakan. </td><td>  Kaset ini digunakan untuk mencetak (warna atau monokrom).  Hanya pita yang disediakan, satu kartrid dan dilengkapi dengan printer itu sendiri.  Rol pembersih disertakan dengan selotip. </td></tr><tr><td>  Encoder </td><td>  Encoder Elyctis.  Mudah digunakan karena  mendukung interaksi dengan perpustakaan Windows default untuk komunikasi dengan kartu NFC, kartu menang. </td><td>  Encoder DUALi.  Dukungan teknis menyediakan SDK khusus untuk bekerja dengan enkoder. </td></tr><tr><td>  Membersihkan </td><td>  Untuk menjaga printer dalam kondisi kerja, itu membutuhkan pembersihan konstan.  Ada dua jenis pembersihan: berkala (setelah setiap 1000 kartu) dan diperpanjang (setelah 5000 kartu).  Kepatuhan dengan jadwal pembersihan adalah prasyarat dalam perjanjian jaminan. </td><td>  Pembersihan diperlukan setelah menggunakan pita cetak.  Tergantung pada jenis kaset dan ukuran gambar untuk dicetak, pembersihan akan diperlukan setelah 2-4 ribu kartu. </td></tr><tr><td>  Perumahan </td><td>  Kasing plastik memungkinkan printer menjadi sangat ringan.  Interiornya mudah dijangkau, karena dinding printer terbuka di kedua sisi. </td><td>  Kasing logam membuat printer andal untuk pengoperasian.  Beberapa isi perut hanya dapat dilihat dengan membuka penutup atas. </td></tr><tr><td>  Perangkat lunak </td><td>  Hadir dengan perangkat lunak khusus "Evolis Print Center" dan CardPresso.  Yang pertama diperlukan untuk pengaturan printer, dilengkapi dengan berbagai pembantu.  Perangkat lunak kedua memungkinkan Anda untuk dengan cepat menguji kemampuan printer untuk mencetak dan menyandikan. </td><td>  Perangkat lunak terpisah untuk mengontrol printer tidak diperlukan.  Properti printer cukup dalam daftar perangkat Windows.  Dilengkapi dengan perangkat lunak SmartID untuk pencetakan dan pengodean. </td></tr></tbody></table></div><br>  Tabel 1 - Perbandingan Evolis Primacy dan Smart-51 <br><h3 id="2-eksperimenty">  2. Eksperimen </h3><br><p>  Secara umum, bekerja dengan printer dapat dibagi menjadi beberapa bagian: komunikasi dengan dukungan teknis, mempelajari interaksi kartu dan encoders, pencetakan. </p><br><h3 id="21-vpechatlenie-ot-tehnicheskoy-podderzhki">  2.1.  Kesan dukungan teknis </h3><br><p>  Bekerja dengan printer termasuk komunikasi yang konstan dengan dukungan teknis, karena kami perlu menulis perangkat lunak kami sendiri.  Dalam kedua kasus tersebut, kami lebih banyak berbicara dengan distributor perusahaan di negara kami dan negara tetangga. </p><br><p>  Distributor Evolis sebagian besar selalu berhubungan.  Namun, segera masalah spesifik menunjukkan perlunya komunikasi dengan perwakilan Evolis.  Sayangnya, mereka tidak memberi kami kontak mereka dan harus bertukar pesan melalui distributor.  Namun, ini hanya menyangkut masalah cetak, pada masalah pengkodean kami diberi surat perwakilan Elyctis.  Komunikasi langsung dengan Elyctis sangat menyederhanakan proses pengkodean.  Secara teknis murni, kami segera saling memahami dan tidak ada kesalahpahaman.  Dalam hal pencetakan dan contoh kode untuk Evolis Primacy, komunikasi di beberapa titik terhenti.  Pada dasarnya, kesan negatif dibuat oleh saat-saat ketika contoh-contoh pencetakan dua sisi tidak bekerja untuk kita dan butuh waktu lama untuk membuktikannya.  Saya sampai pada rekaman proses cetak pada video, setelah itu tips yang lebih produktif dari Evolis diikuti. </p><br><p>  Salah satu pertanyaan dukungan teknologi Evolis terbaru adalah bagaimana menghubungkan printer melalui Ethernet.  Saat ini, kami menghubungkan printer melalui USB ke laptop, yang dapat ditoleransi di hadapan 1-2 printer.  Jawaban masih menunggu.  Namun, jawaban dari Elyctis telah diterima bahwa pembuat enkode mereka untuk printer Evolis Primacy tidak menyediakan koneksi jaringan. </p><br><p>  Berkomunikasi dengan dukungan teknologi Smart-51 juga dilakukan dengan berkomunikasi dengan perwakilan perusahaan melalui distributor.  Pada awalnya, semuanya berjalan lancar.  Ketika datang ke kartu encoding seperti Mifare DESFire, masalah dimulai.  Kesulitan disebabkan oleh tim khusus yang tidak akan Anda temukan di Internet.  Untuk alasan ini, Anda hanya perlu menyalin beberapa bagian dari kode kerja yang disediakan oleh pabrikan sebagai contoh.  Namun, menyalin sembarangan tidak mengarah pada kebaikan.  Akibatnya, dua minggu dihabiskan untuk menjelaskan kesalahan kepada produsen, di pihak siapa lelaki itu jelas duduk, tidak terlalu dekat dengan seluk-beluk sistem, tetapi membawa dokumentasi umum bersamanya.  Endapan yang tidak menyenangkan tetap ada, tetapi itu dimulai dengan sangat baik. </p><br><p>  Komunikasi melalui distributor tidak memiliki plus, minus yang solid.  Sebagai contoh: </p><br><ol><li>  Respons tertunda, karena orang yang bertanggung jawab di pihak distributor mungkin sibuk dengan hal-hal lain atau pergi berlibur. </li><li>  Ketika distributor berada di negara lain, ini adalah hari libur tambahan, oleh karena itu, bukan hari kerja.  Dalam kasus Smart-51, komunikasi terjadi dengan partisipasi orang-orang dari 3 negara. </li><li>  Balasan tidak diteruskan.  Teks respons dimasukkan ke dalam surat baru dari distributor.  Karena alasan ini, kadang-kadang file yang dilampirkan hilang dan tidak dapat segera dijangkau. </li><li>  Tidak ada kepastian yang jelas bahwa pesan Anda telah mencapai pabrikan tidak berubah. </li></ol><br><p>  Di bawah ini adalah tabel dengan jumlah surat yang dibuat komunikasi dengan dukungan teknis.  Pada dasarnya, pertanyaan untuk Evolis dan Smart hampir sama.  Misalnya, "Mengapa mencetak bukan warna yang seragam? Apakah Anda memiliki contoh kode dalam C # atau Java?"  dan pertanyaan yang lebih spesifik tentang mengapa sesuatu tidak berfungsi seperti yang diharapkan. </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Evolis </th><th>  Elykis </th><th>  Smart-51 </th></tr></thead><tbody><tr><td>  Jumlah huruf </td><td>  97 </td><td>  37 </td><td>  61 </td></tr></tbody></table></div><br>  Tabel 2 - Perbandingan jumlah email dengan dukungan teknis <br><h3 id="22-kodirovka">  2.2.  Pengkodean </h3><br><p>  Komunikasi dengan pembaca terjadi melalui perintah APDU.  APDU (Application Protocol Data Unit) adalah format standar untuk komunikasi antara kartu dan pembaca.  Artikel ini akan menjelaskan tim APDU dasar untuk MIFARE Classic dan MIFARE DESFire. </p><br><div class="scrollable-table"><table><thead><tr><th>  Judul </th><th>  Ukuran </th><th>  Deskripsi </th></tr></thead><tbody><tr><td>  CLA </td><td>  1 byte </td><td>  Byte kelas </td></tr><tr><td>  Ins </td><td>  1 byte </td><td>  Byte instruksi </td></tr><tr><td>  P1 </td><td>  1 byte </td><td>  Parameter 1 </td></tr><tr><td>  P2 </td><td>  1 byte </td><td>  Parameter 2 </td></tr><tr><td>  Panjang data </td><td>  1 byte </td><td>  Ukuran Data yang Ditransmisikan </td></tr><tr><td>  Data </td><td>  ... </td><td>  Data yang dikirimkan </td></tr><tr><td>  Panjang Data Yang Diharapkan </td><td>  1 byte </td><td>  Ukuran data yang diharapkan dalam respons </td></tr></tbody></table></div><br>  Tabel 3 - Format perintah APDU <br><div class="scrollable-table"><table><thead><tr><th>  Judul </th><th>  Ukuran </th><th>  Deskripsi </th></tr></thead><tbody><tr><td>  SW1 </td><td>  1 byte </td><td>  Kode sukses atau kesalahan umum </td></tr><tr><td>  SW2 </td><td>  1 byte </td><td>  Kode kesalahan terperinci </td></tr><tr><td>  Data </td><td>  ... </td><td>  Kembalikan data </td></tr></tbody></table></div><br>  Tabel 4 - Format respons APDU <br><p>  Deskripsi semua kode respons yang mungkin dapat ditemukan di sini [6].  Perangkat untuk berkomunikasi kartu dengan pembaca dapat ditemukan di [7]. </p><br><p>  Algoritma pengodean singkat adalah sebagai berikut: </p><br><ol><li>  Dapatkan UID kartu.  Ini adalah nomor unik, ini di-flash oleh pemasok dan tidak berubah. </li><li>  Baca data dari masing-masing sektor: <br>  2.1 Masuk ke sektor menggunakan kunci default (0x00 atau 0xFF) <br>  2.2 Membaca data dari tiga blok data </li><li>  Jika data yang dibaca kosong, maka pergi ke catatan data <br>  3.1 Masuk ke sektor menggunakan kunci default (0x00 atau 0xFF) <br>  3.2 Menulis data ke tiga blok data sektor <br>  3.3 Buat kunci baru berdasarkan UID kartu <br>  3.4 Ganti kunci otorisasi di blok trailer dengan kunci baru. </li></ol><br><h3 id="221-elyctis">  2.2.1.  Elykis </h3><br><p>  Printer Evolis menggunakan <strong>pembaca CL ELYCTIS</strong> .  Menggunakan perpustakaan <strong>WinSCard</strong> (C ++ dan C #) dan jnasmartcardio (java), Anda dapat dengan mudah berinteraksi dengan pembaca.  Agar dapat dengan cepat membuat perangkat lunak dengan antarmuka yang cukup sederhana, diputuskan untuk menulis kode dalam <strong>C #</strong> .  Sebagian besar tim kami menulis kode di Jawa, yang membuat transisi ke C # kurang menyakitkan.  Juga mendukung C # adalah kenyataan bahwa Windows lebih cocok untuk bekerja dengan printer. </p><br><p>  Tabel di bawah ini menunjukkan contoh perintah APDU asli yang diterima oleh pembaca Elyctis. </p><br><div class="scrollable-table"><table><thead><tr><th>  Deskripsi </th><th>  Data </th><th>  APDU </th></tr></thead><tbody><tr><td>  Memperoleh kartu UID </td><td>  - </td><td>  <strong>0xFF 0xCA 0x00 0x00 0x00</strong> </td></tr><tr><td>  Memuat kunci otorisasi ke dalam memori pembaca </td><td>  Tombol 6 byte </td><td>  Contoh memuat kunci default.  <strong>0xFF 0x82 0x20 0x00 0x06 0x00 0x00 0x00 0x00 0x00 0x00 0x00</strong> </td></tr><tr><td>  Login </td><td>  Nomor blok otorisasi sektor (blok sektor 3) dan jenis kunci (A - 0x60 atau B - 0x61) </td><td>  Contoh otorisasi ke sektor 1. Nomor blok dari sektor ini adalah 4-7, blok trailer adalah nomor 7. <strong>0xFF 0x86 0x00 0x00 0X05 0x01 0x00 0x07 0X60 0x00 0x00</strong> </td></tr><tr><td>  Membaca data dari satu blok </td><td>  - </td><td>  Contoh membaca data dari blok 4 (blok 1 sektor 1).  Nomor sektor dimasukkan dalam parameter 2. 0xFF 0xB0 0x00 0x04 0x00 0x10 </td></tr><tr><td>  Menulis data ke blok </td><td>  16 byte data </td><td>  Contoh penulisan data untuk diblokir 4. <strong>0xFF 0xD6 0x00 0x04 0x10 0x11 0x22 0x33 0x44 0x55 0x66 0x77 0x77 0x88 0x22 0x44 0x55 0x66 0x77 0x88 0x00</strong> </td></tr></tbody></table></div><br>  Tabel 5 - Contoh Perintah APDU untuk Mifare Classic <br><p>  Setelah memastikan pengodean kartu seperti Mifare Classic berhasil, kami beralih ke <strong>perintah untuk DESFire</strong> .  Dengan referensi [8] Anda dapat menemukan contoh-contoh sederhana dari perintah dengan penjelasan.  Namun, sudah berada di tim otorisasi, kami menemukan perilaku pembaca yang menarik.  Singkatnya, pembaca membuat otorisasi penuh sendiri.  Ternyata dukungan teknis Elyctis memberi kami firmware khusus yang mencakup <em>kecerdasan easyDESFire</em> .  Hanya diperlukan untuk menentukan algoritma enkripsi yang digunakan pembaca.  Dalam kasus kami, itu adalah 3DES. </p><br><p>  Dalam kasus normal, otorisasi dilakukan dengan bertukar beberapa pesan. </p><br><ol><li>  Kami mengirim perintah APDU untuk otorisasi: <strong>0x90 0x0A 0x00 0x00 0x00 0x00</strong> . </li><li>  Bergantung pada algoritma, array 8 byte acak yang dikodekan oleh kunci kartu datang sebagai respons terhadap perintah, kami menyatakannya dengan <strong>RandBEnc</strong> . </li><li>  <strong>Kami mendekripsi RandBEnc</strong> dan melakukan byte byte ke kiri.  <strong>Nyatakan</strong> hasilnya oleh <strong>RandBLeft</strong> . </li><li>  Kami menghasilkan di sisi kami sebuah array 8 byte acak, <strong>RandA</strong> . </li><li>  <strong>Kami mengelompokkan RandA</strong> dan <strong>RandBLeft</strong> , mengenkripsi dengan kunci kartu dan mengirim array yang dihasilkan 16 byte. </li><li>  Kami mendapatkan kunci sesi sebagai respons, sehingga masuk ke aplikasi di peta. </li></ol><br><p>  Rincian lebih lanjut tentang proses otorisasi dapat ditemukan di sini [9].  Kode dari github juga sangat berguna [10]. </p><br><p>  Selama pengkodean, masalah muncul dengan penggunaan perintah dari sumber [8].  Dengan bantuan dukungan teknis Elyctis, kami menerima perintah yang diperlukan yang sesuai untuk <em>kecerdasan easyDESFire</em> . </p><br><p>  Selama penyandian pada Elyctis, satu <strong>masalah</strong> besar pembaca terungkap - <strong>keterlambatan komunikasi</strong> .  Seringkali, sinyal tidak mencapai pembaca, sehingga perintah yang sama kadang-kadang perlu dikirim beberapa kali.  Perilaku ini kurang umum, tetapi masih diperhatikan saat mengirim perintah untuk dicetak.  Akibatnya, mengirim semua perintah berlangsung dalam satu lingkaran, hingga eksekusi berhasil. </p><br><h3 id="222-duali">  2.2.2.  DUALi </h3><br><p>  Pabrikan memberikan SDK-nya untuk bekerja dengan encoder DUALi.  Pada tahap bekerja dengan Mifare Classic, perintah untuk membaca dan menulis dapat diambil dari kode templat yang diberikan distributor kepada kami.  Contohnya dalam C ++, Visual Basic, Java.  Namun, itu mungkin untuk mengkompilasi kode sepenuhnya hanya dalam C ++.  Permintaan pertama untuk contoh kode C #, kami ditolak, atau lebih tepatnya, distributor tidak memilikinya.  Tidak ada programmer C ++ yang percaya diri di tim kami, jadi menulis semua kode sangat rumit dengan hal-hal yang sangat sederhana.  Sebagai contoh: </p><br><ol><li>  Bekerja dengan array <br>  Saat meneruskan array sebagai parameter ke suatu fungsi, kami tidak meneruskan ukuran array.  Untuk menentukan panjang array, fungsi sizeOf () digunakan.  Namun, fungsi terus-menerus mengembalikan ukuran 4, terlepas dari ukuran sebenarnya dari array.  Perilaku ini tidak segera direkam, karena beberapa array memang berukuran 4. </li><li>  Konfigurasikan semua perpustakaan <br>  Banyak rasa sakit yang dialami saat memasang semua lingkungan yang diperlukan.  Kami terlalu terbiasa dengan hal-hal seperti maven dan apt (di Ubuntu).  Program kami seharusnya memanggil API backend melalui permintaan HTTP dan mengenkripsi data di Base64.  Untuk ini, diputuskan untuk menggunakan libcurl dan openssl libraries.  Penulisan program itu sendiri terjadi di lingkungan Microsoft Visual Studio.  Repotnya terpanjang dengan menginstal libcurl. </li></ol><br><p>  SDK itu sendiri adalah perpustakaan dll yang ditulis dalam C ++.  Berkat contoh kode, kami relatif cepat menulis sebuah program untuk berinteraksi dengan kartu Mifare Classic.  Seperti disebutkan di atas, perintah APDU untuk DUALi sangat spesifik, yaitu dua byte pertama tidak cocok dengan yang dapat ditemukan di Internet.  Karena itu, saya harus menyalinnya secara membabi buta, karena, pada prinsipnya, semuanya berfungsi seperti yang diharapkan.  Masalah dimulai dengan tes dengan kartu DESFire. </p><br><p>  Prinsip perintah APDU untuk DESFire di DUALi setidaknya dapat dimengerti.  Ada dua byte untuk <strong>{CLA, INS}</strong> , mereka tidak berubah, dan sebenarnya mereka mengatakan bahwa perintah ini ditujukan untuk kartu seperti DESFire.  Parameter 1 dan 2 juga tidak berubah.  Data yang dikirimkan sudah berisi bagian dari perintah DESFire asli, yaitu byte <strong>{INS, Data}</strong> .  Selama sekitar satu minggu, kami tidak dapat memperoleh jawaban yang diharapkan untuk perintah sederhana, misalnya, perintah "pilih aplikasi".  Di awal kode, kami meninggalkan eksekusi APDU dari perintah GetCardStatus, yang bukan format perintah untuk DESFire.  Namun, dia bekerja dan mengeluarkan kartu UID.  Ternyata, setelah eksekusi GetCardStatus, tim DESFire berhenti bekerja.  Kelalaian ini ditentukan oleh pasukan kami, setelah dialog selama seminggu dengan pemasok, yang tidak mengarah pada apa pun. </p><br><p>  Setelah satu bulan beroperasi dengan stabil pada program kami, kami sampai pada kebutuhan untuk menulis ulang program dalam C #.  Alasan utamanya adalah pengaturan CI.  Program C ++ dikompilasi menggunakan Microsoft Visual Studio.  Semua server kami berjalan di Linux, jadi meluncurkan docker dengan Windows dan Visual Studio ToolKit yang diperlukan tidak dimungkinkan.  Tentu saja, Anda dapat meningkatkan mesin virtual dengan Windows dan masih mengkonfigurasi semuanya untuk C ++, tetapi saya tidak benar-benar menginginkannya.  Setelah berulang kali meminta kode sampel C # dari pabrikan, kami diberikan sebuah contoh.  Anda dapat menulis sendiri, berdasarkan definisi metode pada contoh antarmuka C ++, tetapi ternyata tidak semua fungsi dijelaskan.  Contohnya banyak membantu dan pada akhirnya kami menulis ulang program dalam C # dan mengatur CI. </p><br><h3 id="23-pechat">  2.3.  Cetak </h3><br><p>  Sepintas, sepertinya pencetakan seharusnya tidak menimbulkan masalah, karena pada awalnya kita menggunakan printer cetak.       ,    ,            . </p><br><p>       .       ,       ,   . </p><br><h3 id="231-pechat-na-evolis-primacy"> 2.3.1.   Evolis Primacy </h3><br><p>     JSON ,   HTTP .    Evolis Services Provider,          .      8 : </p><br><ol><li>      </li><li>   </li><li>   :  ,   ,  . . </li><li>    </li><li>     </li><li>    </li><li>   </li><li>    </li></ol><br><p>     -  4-6, . .               .      .         SDK,       .     . <br>      : </p><br><ol><li>   <br>       . </li><li>   <br>      . </li></ol><br><p>                    .          ,      .           .    ,   .          .         .      ,   ,         ,  3. </p><br><img src="https://habrastorage.org/webt/pa/4_/i8/pa4_i8xhdbhicczzxejgvzayzne.jpeg" alt="menggambar" width="300"><br><p>  3 â€”    </p><br><p>     3         . </p><br><p>             , . .    QR-.      ,        QR-  .     ,     ,  4  6 . </p><br><p>   , Evolis ,   Evolis Print Center,     ,    ,              .            . </p><br><h3 id="232-pechat-na-smart-51"> 2.3.2.   Smart-51 </h3><br><p>     ,     SmartID,     .      ,      Evolis.        : </p><br><ol><li>   ,        . </li><li>     ,     . </li></ol><br><p>          ,     .       Smart-51.   : </p><br><ol><li>      </li><li>    ,  . </li><li>   </li><li>   </li><li>    ,   QR- </li><li>   </li><li>   </li><li>    </li></ol><br><p>    ,     User Manuals .      ,         ,        . </p><br><h3 id="233-obschie-problemy-s-pechatyu"> 2.3.3.     </h3><br><p>    ,        .      ,      ,         .           .        .      ,    . </p><br><p>      Evolis Primacy    100 ,   0,76 .      ,  86 .   Smart-51    100 ,          .   ,      . </p><br><h3 id="3-rezultaty"> 3.  </h3><br><p>         .        .        .     17 .        . </p><br><div class="scrollable-table"><table><thead><tr><th>  </th><th>  ,  </th><th>  ,  </th><th>  Total </th></tr></thead><tbody><tr><td> Evolis Primacy </td><td> â‰ˆ 10 </td><td> â‰ˆ 10 </td><td> â‰ˆ 20 </td></tr><tr><td> Smart-51 </td><td> â‰ˆ 17 </td><td> â‰ˆ 6 </td><td> â‰ˆ 23 </td></tr></tbody></table></div><br><img src="https://habrastorage.org/webt/aa/tu/r2/aatur26peetmxaj2ynj4jxwxshm.jpeg" alt="menggambar" width="400"><br><p> ) </p><br><img src="https://habrastorage.org/webt/ll/y1/ed/lly1edhu6n42rdbybxn4-gwvniu.jpeg" alt="menggambar" width="400"><br><p> ) <br>  4 â€”  :  â€”  ,  â€”   </p><br><h3 id="4-zaklyuchenie"> 4.  </h3><br><p>         NFC   -.      , ..      .   Smart-51   Evolis Primacy.    Evolis       ,     . Smart-51             .       Smart-51      Evolis.              ,   .  Evolis Primacy   ,     .      .  Smart-51    .   ,          . </p><br><p>       , ..         .              ,         . </p><br><h3 id="spisok-literatury">  Referensi </h3><br><ol><li> <a href="https://ironlogic.ru/il.nsf/htm/ru_z2usb">https://ironlogic.ru/il.nsf/htm/ru_z2usb</a> </li><li> <a href="https://www.nxp.com/products/rfid-nfc/mifare-hf/mifare-desfire/mifare-desfire-ev2:MIFARE_DESFIRE_EV2_2K_8K">https://www.nxp.com/products/rfid-nfc/mifare-hf/mifare-desfire/mifare-desfire-ev2:MIFARE_DESFIRE_EV2_2K_8K</a> </li><li> <a href="https://www.nxp.com/docs/en/data-sheet/MF3DX2_MF3DHX2_SDS.pdf">https://www.nxp.com/docs/en/data-sheet/MF3DX2_MF3DHX2_SDS.pdf</a> </li><li> <a href="https://www.nxp.com/docs/en/data-sheet/MF1S50YYX_V1.pdf">https://www.nxp.com/docs/en/data-sheet/MF1S50YYX_V1.pdf</a> </li><li> <a href="https://www.nxp.com/docs/en/data-sheet/MF3DX2_MF3DHX2_SDS.pdf">https://www.nxp.com/docs/en/data-sheet/MF3DX2_MF3DHX2_SDS.pdf</a> </li><li> <a href="https://www.eftlab.com/knowledge-base/complete-list-of-apdu-responses/">https://www.eftlab.com/knowledge-base/complete-list-of-apdu-responses/</a> </li><li> Advanced Card Systems Guide <a href="http://downloads.acs.com.hk/drivers/en/API-ACR122U-2.02.pdf">http://downloads.acs.com.hk/drivers/en/API-ACR122U-2.02.pdf</a> </li><li> Mifare Desfire communication example <a href="https://ridrix.wordpress.com/2009/09/19/mifare-desfire-communication-example/">https://ridrix.wordpress.com/2009/09/19/mifare-desfire-communication-example/</a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembar Data Mifare DESFire </font></font><a href="http://neteril.org/files/M075031_desfire.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://neteril.org/files/M075031_desfire.pdf</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proyek GitHub untuk DESFire </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/EsupPortail/esup-nfc-tag-server/blob/master/src/main/java/nfcjlib/core/DESFireEV1.java</font></font></a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id481734/">https://habr.com/ru/post/id481734/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id481716/index.html">Pemrograman reaktif, apakah itu layak untuk menjatuhkan segalanya dan bergegas menuju mimpi</a></li>
<li><a href="../id481718/index.html">11 faktor dan peretasan kehidupan yang akan meningkatkan efektivitas Anda</a></li>
<li><a href="../id481726/index.html">Laravel Routing yang dilokalkan</a></li>
<li><a href="../id481728/index.html">Cungkil -> REPL untuk Ruby, yang sangat berharga</a></li>
<li><a href="../id481730/index.html">Dengarkan MPow T6 - headphone TWS hebat dengan kontrol yang praktis</a></li>
<li><a href="../id481736/index.html">Apa yang membangun infrastruktur Wi-Fi 6?</a></li>
<li><a href="../id481738/index.html">Tugas Pemrograman - Cara yang Buruk untuk Mengevaluasi Kualifikasi Pengembang Senior</a></li>
<li><a href="../id481740/index.html">Apakah cahaya biru mengganggu bioritme manusia?</a></li>
<li><a href="../id481742/index.html">Strategi Apple. Mengikat OS ke perangkat keras - keuntungan atau kerugian kompetitif?</a></li>
<li><a href="../id481746/index.html">Menyiapkan lingkungan di CLI. Terminal WSL / Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>