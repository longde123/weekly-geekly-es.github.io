<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèæ üòÖ üíô KVM, PCI-Passthrough, Spiegel und alles in allem üë©‚Äçüë©‚Äçüëß‚Äçüë¶ üôãüèΩ ü§ß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nach einem erfolgreichen √úbergang zu Linux-Softwareentwicklern kam der Moment, als ein wenig gearbeitet wurde und auch das Hauptbetriebssystem ge√§nder...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>KVM, PCI-Passthrough, Spiegel und alles in allem</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433878/"> Nach einem erfolgreichen √úbergang zu Linux-Softwareentwicklern kam der Moment, als ein wenig gearbeitet wurde und auch das Hauptbetriebssystem ge√§ndert wurde.  Bedenken wurden durch Necro-Plattform-Software zur Unterst√ºtzung bestehender Projekte verursacht.  Ein Teil der Software arbeitete mit Wein.  Es stellte sich jedoch heraus, dass bestimmte Software sich weigert, unter Wein zu arbeiten.  Es wurde beschlossen, Software auf der virtuellen Maschine QEMU + KVM auszuf√ºhren.  Die Software begann zu laufen, aber die Arbeit darin war ziemlich unpraktisch.  Virtuelle Software-Grafikkarten unterscheiden sich nicht in der Leistung, und die Unterst√ºtzung f√ºr 3D-Grafiken ist sehr bescheiden.  Ich musste das Tamburin aufdecken und nach einem Ausweg suchen. <br><a name="habracut"></a><br><h1>  Ordnen Sie dem Gastsystem eine separate Grafikkarte zu! </h1><br>  Es dauerte nicht lange, einen Ausweg zu finden, aber die Idee, ein Tamburin mit einem Suchscheinwerfer zu treffen, erwies sich als sehr seltsam.  Beim Thema Weiterleiten von Grafikkarten an eine virtuelle Maschine enth√§lt das Internet Anweisungen zu verschiedenen Zeiten und f√ºr verschiedene Hardware.  Was ist ein riesiger Artikel auf der Arch Linux Site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[0]</a> .  Ich werde eine gek√ºrzte Version der Anweisungen zum Weiterleiten einer Grafikkarte geben. <br><br><h3>  0. √úberpr√ºfen Sie, ob die Hardware IOMMU unterst√ºtzt </h3><br>  Zum Beispiel hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[1]</a> . <br><br><h3>  1. Wir bieten Unterst√ºtzung f√ºr IOMMU in einem Kernel. </h3><br><div class="spoiler">  <b class="spoiler_title">cat / etc / default / grub</b> <div class="spoiler_text"><blockquote>  GRUB_CMDLINE_LINUX_DEFAULT = "leises Spritzen amd_iommu = on" <br>  oder <br>  GRUB_CMDLINE_LINUX_DEFAULT = "leiser Splash intel_iommu = on" <br></blockquote><br></div></div><br>  Vergessen Sie nicht <code>sudo update-grub</code> . <br><br><h3>  2. Wir w√§hlen die Grafikkarte aus dem Treiber </h3><br>  Wir suchen nach den notwendigen Ger√§ten und sehen, welche Treiber sie verwenden. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> VGA-kompatibler Controller: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (Rev. a2) <br>  Verwendeter Kerneltreiber: <b>Nouveau</b> <br>  Kernelmodule: nvidiafb, nouveau <br>  <b>04: 00.1</b> Audioger√§t: High Definition Audio Controller der NVIDIA Corporation [ <b>10de: 0be3</b> ] (rev a1) <br>  Verwendeter <b>Kerneltreiber</b> : <b>snd_hda_intel</b> <br>  Kernelmodule: snd_hda_intel <br></blockquote><br></div></div><br>  F√ºgen Sie VFIO-Module hinzu, damit sie beim Booten geladen werden. <br><br><div class="spoiler">  <b class="spoiler_title">cat / etc / modules |</b>  <b class="spoiler_title">grep vfio</b> <div class="spoiler_text"><blockquote>  vfio <br>  vfio_iommu_type1 <br>  vfio_pci <br>  vfio_virqfd <br></blockquote><br></div></div><br>  Wir konfigurieren das VFIO-Modul so, dass es Ger√§te abf√§ngt und verhindert, dass die Haupttreiber geladen werden.  F√ºgen Sie bei Bedarf den Haupttreiber zur Blacklist hinzu. <br><br><div class="spoiler">  <b class="spoiler_title">cat /etc/modprobe.d/vfio.conf</b> <div class="spoiler_text"><blockquote>  Optionen vfio-pci ids = <b>10de: 0a65,10de: 0be3</b> <br>  Blacklist Nouveau <br></blockquote><br></div></div><br><h3>  3. Starten Sie neu und √ºberpr√ºfen Sie, ob alles geklappt hat </h3><br>  IOMMU eingeschaltet. <br><br><div class="spoiler">  <b class="spoiler_title">dmesg |</b>  <b class="spoiler_title">grep -e DMAR -e IOMMU -e AMD-Vi</b> <div class="spoiler_text"><blockquote>  DMAR: Intel¬Æ Virtualisierungstechnologie f√ºr gerichtete E / A. <br>  oder <br>  AMD-Vi: IOMMU um 0000: 00: 00.2 cap 0x40 gefunden <br>  AMD-Vi: Interrupt-Neuzuordnung aktiviert <br>  AMD-Vi: Lazy IO / TLB-Sp√ºlung aktiviert <br></blockquote><br></div></div><br>  Verbundger√§te fielen in eine Gruppe. <br><br><div class="spoiler">  <b class="spoiler_title">f√ºr ein in / sys / kernel / iommu_groups / *;</b>  <b class="spoiler_title">finde $ a-Typ l;</b>  <b class="spoiler_title">erledigt |</b>  <b class="spoiler_title">sort --version-sort</b> <div class="spoiler_text"><blockquote>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/15/devices/0000:01:00.1</b> <br>  /sys/kernel/iommu_groups/16/devices/0000:02:00.0 <br>  /sys/kernel/iommu_groups/17/devices/0000:03:00.0 <br>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.0</b> <b><br></b>  <b>/sys/kernel/iommu_groups/18/devices/0000:04:00.1</b> <br></blockquote><br></div></div><br>  KVM- und VFIO-Treiber geladen. <br><br><div class="spoiler">  <b class="spoiler_title">lsmod |</b>  <b class="spoiler_title">grep -e kvm -e vfio</b> <div class="spoiler_text"><blockquote><pre> kvm_amd 94208 0
 ccp 90112 1 kvm_amd
 kvm 622592 1 kvm_amd
 vfio_pci 45056 0
 vfio_virqfd 16384 1 vfio_pci
 irqbypass 16384 2 vfio_pci, kvm
 vfio_iommu_type1 24576 0
 vfio 28672 2 vfio_iommu_type1, vfio_pci
</pre></blockquote><br></div></div><br>  Grafikkarte f√ºr das von VFIO erfasste Gastbetriebssystem. <br><br><div class="spoiler">  <b class="spoiler_title">lspci -nnk</b> <div class="spoiler_text"><blockquote>  <b>04: 00.0</b> VGA-kompatibler Controller: NVIDIA Corporation GT218 [GeForce 210] [ <b>10de: 0a65</b> ] (Rev. a2) <br>  Verwendeter <b>Kerneltreiber</b> : <b>vfio-pci</b> <br>  Kernelmodule: nvidiafb, nouveau <br>  <b>04: 00.1</b> Audioger√§t: High Definition Audio Controller der NVIDIA Corporation [ <b>10de: 0be3</b> ] (rev a1) <br>  Verwendeter <b>Kerneltreiber</b> : <b>vfio-pci</b> <br>  Kernelmodule: snd_hda_intel <br></blockquote><br></div></div><br><h3>  4. Konfigurieren Sie QEMU und starten Sie das Gastbetriebssystem </h3><br><div class="spoiler">  <b class="spoiler_title">Installieren, falls noch nicht installiert</b> <div class="spoiler_text"><blockquote>  sudo apt installiere qemu-kvm qemu-utils seabios ovmf virt-viewer <br></blockquote></div></div><br><div class="spoiler">  <b class="spoiler_title">Erstellen Sie eine Festplatte, auf der das Gastbetriebssystem installiert wird</b> <div class="spoiler_text"><blockquote>  qemu-img create -f raw -o preallocation = full guest.img 50G <br>  oder <br>  fallocate -l 50G guest.img <br></blockquote></div></div><br>  Wir starten die virtuelle Maschine, ohne die Grafikkarte weiterzuleiten, um das Gastbetriebssystem zu installieren.  Da es einen Blick auf Looking Glass gibt, lohnt es sich f√ºr den Gast, Windows 10 zu w√§hlen. Windows 8 / 8.1 nach den neuesten Daten wird ebenfalls unterst√ºtzt. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  Remote-Viewer-Gew√ºrz: //127.0.0.1: 5900 &amp; <br>  sudo qemu-system-x86_64 \ <br>  -Maschine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, Sockets = 1, Cores = 2, Threads = 1 \ <br>  -m 6G \ <br>  -rtc base = Ortszeit, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -Ger√§t USB-Tablet \ <br>  -drive if = pflash, format = raw, schreibgesch√ºtzt, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'w10.iso', if = ide, format = raw, index = 2, media = cdrom, cache = none \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -spice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -Ger√§t e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br><h3>  5. Wir leiten die Grafikkarte an das Gastbetriebssystem weiter </h3><br>  Booten Sie zun√§chst mit zwei Grafikkarten.  Wir sehen, dass die weitergeleitete Karte im System angezeigt wird, setzen die Treiber darauf und stellen sicher, dass sie funktionieren. <br><br><div class="spoiler">  <b class="spoiler_title">vga_qxl_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  Remote-Viewer-Gew√ºrz: //127.0.0.1: 5900 &amp; <br>  sudo qemu-system-x86_64 \ <br>  -Maschine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, Sockets = 1, Cores = 2, Threads = 1 \ <br>  -m 6G \ <br>  -rtc base = Ortszeit, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -Ger√§t USB-Tablet \ <br>  -drive if = pflash, format = raw, schreibgesch√ºtzt, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga qxl \ <br>  -spice port = 5900, addr = 127.0.0.1, disable-ticketing \ <br>  <b>-Ger√§t ioh3420, Bus = PCIE.0, Adr = 1c.0, Multifunktion = Ein, Port = 1, Chassis = 1, ID = Root \</b> <b><br></b>  <b>-device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on \</b> <b><br></b>  <b>-device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \</b> <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -Ger√§t e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Nachdem die weitergeleitete Grafikkarte funktioniert hat und im Ger√§te-Manager "Das Ger√§t funktioniert einwandfrei" geschrieben ist, starten wir die virtuelle Maschine nur mit der weitergeleiteten Grafikkarte. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -Maschine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, Sockets = 1, Cores = 2, Threads = 1 \ <br>  -m 6G \ <br>  -rtc base = Ortszeit, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -Ger√§t USB-Tablet \ <br>  -drive if = pflash, format = raw, schreibgesch√ºtzt, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga <b>keine</b> \ <br>  -Ger√§t ioh3420, Bus = PCIE.0, Adr = 1c.0, Multifunktion = Ein, Port = 1, Chassis = 1, ID = Root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -Ger√§t e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Wir schlie√üen einen Monitor daran an und bewundern das Desktop-Image des Gastbetriebssystems. <br><br><h1>  Der Ort, an dem einfache Entscheidungen enden </h1><br>  Und dann beginnt der Spa√ü.  Jemand, alles ist in Ordnung, das Bild ist weg und alles ist einfach.  Meine Erfahrung stolperte zweimal √ºber das Stadium des Imagemangels.  Das erste Mal war die Weiterleitung der integrierten Grafikkarte des Intel 6700T HD 530-Prozessors, die Videoausg√§nge waren leer und der Fehler wurde auf die Tatsache zur√ºckgef√ºhrt, dass die Plug-Ins nicht gut funktionieren.  Das zweite Mal wurde das externe Nvidia GF210 umgeworfen, das bereits speziell f√ºr Experimente gekauft wurde.  Das Ergebnis war noch interessanter.  Im Nicht-EFI-Modus wurde die Grafikkarte erfolgreich weitergeleitet und zeigte sogar ein Bild, schaltete jedoch das <abbr title="etwa 50 bis 50">fehlgeschlagene</abbr> Gastbetriebssystem aus. <br><br>  Eine nachfolgende Weiterleitung k√∂nnte den Host einfach h√§ngen lassen.  Ein paar Stunden einfaches Googeln f√ºhren dazu, dass das Problem des Einfrierens einer Grafikkarte h√§ufig auftritt.  Dies f√ºhrt zu einem fehlerhaften Herunterfahren der virtuellen Maschine und mit einiger Wahrscheinlichkeit sogar zu einem korrekten Herunterfahren.  Als Ausgabe wird empfohlen, im EFI-Modus weiterzuleiten.  VBIOS Nvidia GF210 unterst√ºtzt EFI jedoch nicht ... <br><br><h3>  N√§hen oder nicht n√§hen, das ist die Frage </h3><br>  Nicht n√§hen.  QEMU unterst√ºtzt VBIOS-Spoofing beim Weiterleiten einer Grafikkarte.  VBIOS muss jedoch noch unterrichtet werden, um den EFI-Modus zu unterst√ºtzen.  Es wird normalerweise empfohlen, dies zu √ºberpr√ºfen, bevor Sie mit der Weiterleitung der Grafikkarte beginnen, z. B. hier <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[2]</a> .  Aber man muss sich mit dem besch√§ftigen, was ist, und wollte nicht nach einer neuen Grafikkarte mit EFI-Unterst√ºtzung suchen.  Sie m√ºssen also VBIOS patchen.  <u>Alle mit VBIOS durchgef√ºhrten Operationen erfolgen auf eigenes Risiko.</u>  Ich habe hier ein Softwarepaket und Anweisungen dazu verwendet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[3]</a> .  Nach dem Lesen von VBIOS erhalten wir die Datei <code>gt210.rom</code> , patch und am Ausgang haben wir <code>gt210_uefi.rom</code> .  Hier m√ºssen Sie die Grafikkarte ablegen, wenn Sie die virtuelle Maschine laden. <br><br><div class="spoiler">  <b class="spoiler_title">vga_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -Maschine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, Sockets = 1, Cores = 2, Threads = 1 \ <br>  -m 6G \ <br>  -rtc base = Ortszeit, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -Ger√§t USB-Tablet \ <br>  -drive if = pflash, format = raw, schreibgesch√ºtzt, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga keine \ <br>  -Ger√§t ioh3420, Bus = PCIE.0, Adr = 1c.0, Multifunktion = Ein, Port = 1, Chassis = 1, ID = Root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, <b>romfile = gt210_uefi.rom</b> \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, ipv6 = off, smb = "/ media / user / data" \ <br>  -Ger√§t e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Wir starten die virtuelle Maschine und schauen. <br><br><h3>  Dunkelheit </h3><br>  Die Ausg√§nge der Grafikkarte leuchteten im Dunkeln.  Wieder einmal bestand die Moral den Test des Scheiterns.  Das erste, was mir einf√§llt, ist, dass das Gastbetriebssystem beim Start abst√ºrzt.  Protokolle, ich brauche ihre Protokolle.  F√ºhren Sie dazu <code>vga_qxl.sh</code> .  Wir schauen uns den vorherigen Start an.  Und dort ist alles in Ordnung, au√üer dass das Essen scharf gezogen wurde.  Es stellt sich heraus, dass es funktioniert, obwohl es nicht funktioniert.  Die erste Idee war, eine Verbindung √ºber RDP herzustellen und zu sehen, was dort passiert, aber es ist immer noch besser, VNC zu verwenden, zum Beispiel tightvnc <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[4]</a> .  Wir installieren VNC, konfigurieren Port <code>5600</code> und leiten diesen Port f√ºr den Zugriff vom Host weiter. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo qemu-system-x86_64 \ <br>  -Maschine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, Sockets = 1, Cores = 2, Threads = 1 \ <br>  -m 6G \ <br>  -rtc base = Ortszeit, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -Ger√§t USB-Tablet \ <br>  -drive if = pflash, format = raw, schreibgesch√ºtzt, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga keine \ <br>  -Ger√§t ioh3420, Bus = PCIE.0, Adr = 1c.0, Multifunktion = Ein, Port = 1, Chassis = 1, ID = Root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, romfile = gt210_uefi.rom \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  -monitor stdio \ <br>  -netdev user, id = n1, <b>hostfwd = tcp: 127.0.0.1: 5600-: 5600,</b> ipv6 = off, smb = "/ media / user / data" \ <br>  -Ger√§t e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Wir verbinden und sehen die Arbeitsmaschine, nur der Monitor hat einen seltsamen generischen Nicht-PnP-Monitor (Universal Monitor ist kein PnP).  Es gibt ein Bild, sodass Sie versuchen k√∂nnen, Looking Glass auszuf√ºhren. <br><br><h3>  Spiegel </h3><br>  Obwohl diese Technologie OpenGL verwendet, wird nach gl kein Platz ben√∂tigt.  Sie m√ºssen jedoch die Anweisungen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[5]</a> auf der Projektwebsite lesen.  Laden Sie f√ºr das Gastbetriebssystem den Bildschirm herunter <b>-</b> erfassen Sie die Anwendung <b>Looking-Glass-Host.exe</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[6]</a> , laden Sie Microsoft Visual C ++ 2015 Redistributable herunter und installieren Sie ihn <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[7]</a> . Laden Sie den Treiber f√ºr das IVSHMEM-Ger√§t herunter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[8]</a> .  F√ºr den Host f√ºgen wir Abh√§ngigkeiten hinzu, laden die Clientanwendung herunter und erstellen sie. <br><br><div class="spoiler">  <b class="spoiler_title">build_looking_glass_a12.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  sudo apt-get install cmake libsdl2-dev libsdl2-ttf-dev Brennnessel-dev libspice-Protokoll-dev libfontconfig1-dev libx11-dev Schriftarten-freefont-ttf libconfig-dev <br>  wget <a href="">github.com/gnif/LookingGlass/archive/a12.tar.gz</a> <br>  tar -xf a12.tar.gz <br>  cd LookingGlass-a12 <br>  mkdir client / build <br>  CD-Client / Build <br>  cmake ../ <br>  machen <br></blockquote></div></div><br>  Wir starten die virtuelle Maschine mit dem IVSHMEM-Ger√§t.  Die Speichergr√∂√üe von 32 MB wird f√ºr eine Aufl√∂sung von 1920 x 1080 ausgew√§hlt. <br><br><div class="spoiler">  <b class="spoiler_title">vga_vnc_lg_pass_rom.sh</b> <div class="spoiler_text"><blockquote>  #! / bin / bash <br>  <b>wenn [!</b>  <b>-f / dev / shm / schauglas];</b>  <b>dann</b> <b><br></b>  <b>touch / dev / shm / schauglas</b> <b><br></b>  <b>chown `whoami`: kvm / dev / shm / schauglas</b> <b><br></b>  <b>chmod 660 / dev / shm / schauglas</b> <b><br></b>  <b>fi</b> <br>  sudo qemu-system-x86_64 \ <br>  -Maschine q35, accel = kvm \ <br>  -enable-kvm \ <br>  -cpu host, kvm = off, check \ <br>  -smp cpus = 2, Sockets = 1, Cores = 2, Threads = 1 \ <br>  -m 6G \ <br>  -rtc base = Ortszeit, clock = host \ <br>  -device piix3-usb-uhci \ <br>  -Ger√§t USB-Tablet \ <br>  -drive if = pflash, format = raw, schreibgesch√ºtzt, file = / usr / share / OVMF / OVMF_CODE.fd \ <br>  -drive file = 'virtio-win-0.1.141_st.iso', if = ide, format = raw, index = 3, media = cdrom, cache = none \ <br>  -drive file = 'guest.img', if = ide, format = raw, index = 4, media = disk, cache = writeback \ <br>  -vga keine \ <br>  -Ger√§t ioh3420, Bus = PCIE.0, Adr = 1c.0, Multifunktion = Ein, Port = 1, Chassis = 1, ID = Root \ <br>  -device vfio-pci, host = 04: 00.0, bus = root, addr = 00.0, multifunction = on, romfile = gt210_uefi.rom \ <br>  -device vfio-pci, host = 04: 00.1, bus = root, addr = 00.1 \ <br>  <b>-device ivshmem-plain, memdev = ivshmem, bus = pcie.0 \</b> <b><br></b>  <b>-Objektspeicher-Backend-Datei, id = ivshmem, share = on, mem-path = / dev / shm / schauglas, size = 32M \</b> <br>  -monitor stdio \ <br>  -netdev user, id = n1, hostfwd = tcp: 127.0.0.1: 5600-: 5600, ipv6 = off, smb = "/ media / user / data" \ <br>  -Ger√§t e1000, netdev = n1, mac = 67: 77: 78: 88: 89: 99 \ <br>  "$ @" <br></blockquote></div></div><br>  Wir stellen eine Verbindung √ºber VNC her, installieren den Treiber auf dem IVSHMEM-Ger√§t. M√∂glicherweise wird ein Standardtreiber darauf installiert, der sich in den "Systemger√§ten" befindet.  Wir beginnen mit der <b>Suche nach der host.exe</b> .  F√ºhren <code>./LookingGlass-a12/client/build/looking-glass-client</code> auf dem Host <code>./LookingGlass-a12/client/build/looking-glass-client</code> . <br><br>  Auf diesem System funktionierte ein System mit NVidia GF210 f√ºr mich, und dann wurde Intel HD530 auf demselben Weg gestartet.  Es gab ein kleines Problem mit der Bildschirmaufl√∂sung. Um zu einer seltenen Aufl√∂sung zu wechseln, z. B. 2048 x 1152, musste ich das Dienstprogramm f√ºr benutzerdefinierte Aufl√∂sung verwenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[9]</a> . <br><br>  Eine weitere Nuance: Wenn <b>Sie die Anwendung look-glass-host.exe</b> zum Start hinzuf√ºgen, m√ºssen Sie die automatische Benutzeranmeldung konfigurieren. Aus Sicherheitsgr√ºnden k√∂nnen Sie den Anmeldebildschirm vom Gastbetriebssystem nicht erfassen. <br><br><h1>  Nachwort </h1><br>  Wenn Sie keine Aufgabe festlegen und ein Bild auf einem physischen Videoausgang abrufen, reicht dieses Ergebnis aus, um eine funktionierende virtuelle Maschine mit einer physischen Grafikkarte und einer reaktionsschnellen Steuerung zu erhalten.  Die Verwaltung erfolgt vom Host in einem separaten Fenster oder im Vollbildmodus.  Es gibt jedoch Nuancen. <br><br>  <b>Leistung</b> .  Overhead-Ressourcen f√ºr die Virtualisierung und nicht das effizienteste Gastbetriebssystem erm√∂glichen es Ihnen nicht, bequem mit schwacher und mittlerer bis niedriger Hardware zu arbeiten.  Es erfordert einen leistungsstarken Prozessor mit mindestens 6-8 Kernen, eine gute Grafikkarte f√ºr ein Gastbetriebssystem, 16 GB + RAM und mindestens 8 GB f√ºr jedes Betriebssystem.  Und mit einem Tamburin tanzen, um das Beste aus Eisen herauszuholen. <br>  <b>Geduld</b> .  Wenn es nicht sofort funktioniert, m√ºssen Sie Zeit und Zeit anst√§ndig verbringen.  Suchen, lesen, versuchen.  Schauen Sie noch einmal, lesen Sie und versuchen Sie es erneut.  Ich werde noch ein paar Links hinterlassen, auf die ich gesto√üen bin. Vielleicht gibt es weitere n√ºtzliche Informationen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[10]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[11]</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">[12]</a> <br><br>  <b>Referenzen</b> <br><br>  Achtung, in diesem Fenster √∂ffnen sich Links. <br><br><a name="L0"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">0. https://wiki.archlinux.org/index.php/PCI_passthrough_via_OVMF</a> <br><a name="L1"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">1. https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware</a> <br><a name="L2"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">2. https://www.techpowerup.com/vgabios/</a> <br><a name="L3"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">3. https://www.win-raid.com/t892f16-AMD-and-Nvidia-GOP-update-No-requests-DIY.html</a> <br><a name="L4"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">4. https://www.tightvnc.com/download.php</a> <br><a name="L5"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">5. https://looking-glass.hostfission.com/quickstart</a> <br><a name="L6"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">6. https://github.com/gnif/LookingGlass/releases</a> <br><a name="L7"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">7. https://www.microsoft.com/en-us/download/details.aspx?id=48145</a> <br><a name="L8"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">8. https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/upstream-virtio/</a> <br><a name="L9"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">9. https://www.monitortests.com/forum/Thread-Custom-Resolution-Utility-CRU</a> <br><a name="L10"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">10. https://heiko-sieger.info/running-windows-10-on-linux-using-kvm-with-vga-passthrough</a> <br><a name="L11"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">11. https://ycnrg.org/vga-passthrough-with-ovmf-vfio/</a> <br><a name="L12"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">12. https://www.reddit.com/r/VFIO/comments/8h352p/guide_running_windows_via_qemukvm_and_intel_gvtg/</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de433878/">https://habr.com/ru/post/de433878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de433868/index.html">Warum das Glukosemessger√§t von Alphabet nicht hochgeflogen ist</a></li>
<li><a href="../de433870/index.html">Warum ist es so schwierig, Glukose kontinuierlich zu messen?</a></li>
<li><a href="../de433872/index.html">Mobiler Zugang - √ºber ein Smartphone in Zugangskontrollsystemen</a></li>
<li><a href="../de433874/index.html">Experimente mit neuronalen JavaScript-Schnittstellen</a></li>
<li><a href="../de433876/index.html">Dreidimensionale Produktpr√§sentationen auf Three.js f√ºr die Kleinsten</a></li>
<li><a href="../de433880/index.html">Life Hacks f√ºr Entwickler: Effektives Verwenden von SQ (Source Qualifier) ‚Äã‚Äãim Informatica Power Center</a></li>
<li><a href="../de433884/index.html">Rechtliche Aspekte der Video√ºberwachung: Vermeidung von Gesetzesproblemen</a></li>
<li><a href="../de433886/index.html">Python Machine Learning mit interaktiven Jupyter-Demos</a></li>
<li><a href="../de433888/index.html">Verwendung von Lithium-Ionen-Batterien in einphasigen USVs</a></li>
<li><a href="../de433892/index.html">FSTEC vs NIST: Auslaufschutz in russischer und amerikanischer Sprache</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>