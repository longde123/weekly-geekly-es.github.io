<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö∂üèø üÜö üèª ¬´Class-fields-proposition¬ª ou ¬´Qu'est-ce qui s'est mal pass√© dans tc39 commit¬ª üéà üëÜüèª üó£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a longtemps, nous voulons tous une encapsulation normale dans JS, qui pourrait √™tre utilis√©e sans gestes inutiles. Nous voulons √©galement des con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬´Class-fields-proposition¬ª ou ¬´Qu'est-ce qui s'est mal pass√© dans tc39 commit¬ª</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428119/"><p>  Il y a longtemps, nous voulons tous une encapsulation normale dans JS, qui pourrait √™tre utilis√©e sans gestes inutiles.  Nous voulons √©galement des constructions pratiques pour d√©clarer les propri√©t√©s de classe.  Et enfin, nous voulons que toutes ces fonctionnalit√©s du langage apparaissent de mani√®re √† ne pas casser les applications existantes. </p><br><p> Il semblerait qu'ici c'est le bonheur: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">classe-champs-proposition</a> , qui apr√®s de nombreuses ann√©es de tourments du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">comit√© tc39 est</a> encore <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parvenue</a> √† l' <code>stage 3</code> et a m√™me √©t√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mise en ≈ìuvre en chrome</a> . </p><br><p>  Honn√™tement, j'aimerais vraiment √©crire un article expliquant pourquoi vous devriez utiliser la nouvelle fonctionnalit√© de langue et comment le faire, mais, malheureusement, l'article ne parlera pas du tout de cela. </p><a name="habracut"></a><br><h1 id="opisanie-tekuschego-propozala">  Description du courant manquant </h1><br><p>  Je ne r√©p√©terai pas ici la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">description d'origine</a> , la <a href="">FAQ</a> et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">modifications des sp√©cifications</a> , mais je ne r√©sumerai que bri√®vement les principaux points. </p><br><h2 id="polya-klassa">  Champs de classe </h2><br><p>  D√©clarer des champs et les utiliser dans une classe: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Acc√®s aux champs en dehors de la classe: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(ax);</code> </pre> <br><p>  Tout semblait √©vident et depuis de nombreuses ann√©es, nous utilisons cette syntaxe en utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Babel</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TypeScript</a> . </p><br><p>  Seulement, il y a une nuance.  Cette nouvelle syntaxe utilise <code>[[Define]]</code> , et non <code>[[Set]]</code> s√©mantique avec laquelle nous avons v√©cu tout ce temps. </p><br><p>  En pratique, cela signifie que le code ci-dessus n'est <strong>pas √©gal √†</strong> ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = <span class="hljs-number"><span class="hljs-number">1</span></span>; } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Mais en fait, cela <strong>√©quivaut</strong> √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.defineProperty(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"x"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">configurable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">enumerable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">writable</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> }); } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Et, bien que pour l'exemple ci-dessus, les deux approches font essentiellement la m√™me chose, c'est une diff√©rence <strong>TR√àS GRAVE</strong> , et voici pourquoi: </p><br><p>  Disons que nous avons une classe parent comme celle-ci: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x); } }</code> </pre> <br><p>  Sur cette base, nous en avons cr√©√© un autre: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">B</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ x = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  Et ils l'ont utilis√©: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> B(); b.method(); <span class="hljs-comment"><span class="hljs-comment">//   2  </span></span></code> </pre> <br><p>  Ensuite, pour une raison quelconque, la classe <code>A</code> √©t√© modifi√©e d'une mani√®re apparemment r√©trocompatible: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ _x = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,   ,        get x() { return this._x; }; set x(val) { return this._x = val; }; method() { console.log(this._x); } }</span></span></code> </pre> <br><p>  Et pour la s√©mantique de <code>[[Set]]</code> , c'est vraiment un changement r√©trocompatible, mais pas pour <code>[[Define]]</code> .  Maintenant, l'appel √† <code>b.method()</code> sortira sur la console <code>1</code> au lieu de <code>2</code> .  Et cela se produira car <code>Object.defineProperty</code> red√©finit le descripteur de propri√©t√© et, par cons√©quent, getter / setter de la classe <code>A</code> ne sera pas appel√©.  En fait, dans la classe enfant, nous avons <em>masqu√© la</em> propri√©t√© <code>x</code> du parent, de la m√™me mani√®re que nous pouvons le faire dans la port√©e lexicale: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  Certes, dans ce cas, le linter avec ses r√®gles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>no-shadow</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>no-shadowed-variable</code></a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>no-shadow</code></a> nous sauvera, mais la probabilit√© que quelqu'un cr√©e un <code>no-shadowed-class-field</code> tend √† z√©ro. </p><br><blockquote>  Soit dit en passant, je serai reconnaissant pour le terme russe plus r√©ussi pour l' <code>shadowed</code> . </blockquote><p>  Malgr√© tout ce qui pr√©c√®de, je ne suis pas un adversaire inacceptable de la nouvelle s√©mantique (bien que j'en pr√©f√®re une autre), car elle a ses propres aspects positifs.  Mais, malheureusement, ces avantages ne l'emportent pas sur les inconv√©nients les plus importants - nous utilisons la s√©mantique <code>[[Set]]</code> depuis de nombreuses ann√©es, car elle est utilis√©e par d√©faut dans <code>babel6</code> et <code>TypeScript</code> . </p><br><blockquote>  Certes, il convient de noter que dans <code>babel7</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">valeur par d√©faut a √©t√© modifi√©e</a> . </blockquote><p>  Des discussions plus originales sur ce sujet peuvent √™tre lues <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p><br><h2 id="privatnye-polya">  Champs priv√©s </h2><br><p>  Et maintenant, nous allons passer √† la partie la plus controvers√©e de celle-ci.  Tellement controvers√© que: </p><br><ol><li>  bien qu'il soit d√©j√† impl√©ment√© dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Chrome Canary</a> et que les champs publics soient d√©j√† activ√©s par d√©faut, les champs priv√©s sont toujours derri√®re le drapeau; </li><li>  bien que le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">profil initial pour les champs priv√©s ait</a> √©t√© fusionn√© avec le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">profil</a> actuel, des demandes sont toujours en cours pour la s√©paration de ces deux caract√©ristiques (par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trois</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">quatre</a> ); </li><li>  m√™me certains membres du comit√© (comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Allen Wirfs-Brock</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Kevin Smith</a> ) s'expriment et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">proposent des alternatives</a> , malgr√© l' <strong>√©tape3</strong> ; </li><li>  cette erreur a √©tabli un record pour le nombre de probl√®mes - <strong>129</strong> dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel actuel</a> + <strong>96</strong> dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">original</a> , contre <strong>126</strong> pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BigInt</a> , et le d√©tenteur du record a surtout <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">des commentaires n√©gatifs</a> ; </li><li>  J'ai d√ª cr√©er un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fil s√©par√©</a> avec une tentative de r√©sumer en quelque sorte toutes les r√©clamations contre lui; </li><li>  J'ai d√ª √©crire une <a href="">FAQ s√©par√©e</a> qui couvre cette partie <br><blockquote>  cependant, en raison d'une argumentation plut√¥t faible, de telles discussions sont apparues ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">deux</a> ) <br></blockquote></li><li>  Personnellement, j'ai pass√© tout mon temps libre (et parfois travaill√©) pendant une longue p√©riode pour tout comprendre et m√™me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouver une explication de la</a> raison pour laquelle il √©tait comme √ßa ou proposer une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">alternative appropri√©e</a> ; </li><li>  √† la fin, j'ai d√©cid√© d'√©crire cet article de synth√®se. </li></ol><br><p>  Les champs priv√©s sont d√©clar√©s comme suit: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv; }</code> </pre> <br><p>  Et leur acc√®s est le suivant: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv = <span class="hljs-number"><span class="hljs-number">1</span></span>; method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.#priv); } }</code> </pre> <br><p>  Je ne soul√®verai m√™me pas le sujet selon lequel le mod√®le mental derri√®re cela n'est pas tr√®s intuitif ( <code>this.#priv !== this['#priv']</code> ), n'utilise pas les mots <code>private</code> / <code>protected</code> d√©j√† r√©serv√©s (ce qui causera n√©cessairement une douleur suppl√©mentaire pour les d√©veloppeurs TypeScript), il n'est pas clair comment l'√©tendre √† d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">autres modificateurs d'acc√®s</a> , et la syntaxe elle-m√™me n'est pas tr√®s belle.  Bien que tout cela soit la raison originale qui m'a pouss√© √† une √©tude plus approfondie et √† une participation aux discussions. </p><br><p>  Tout cela concerne la syntaxe, o√π les pr√©f√©rences esth√©tiques subjectives sont tr√®s fortes.  Et on pourrait vivre avec et s'y habituer avec le temps.  Sinon pour une chose: il y a un probl√®me tr√®s important de s√©mantique ... </p><br><h3 id="cemantika-weakmap">  S√©mantique <code>WeakMap</code> </h3><br><p>  Voyons ce qui se cache derri√®re la proposition existante.  Nous pouvons r√©√©crire l'exemple ci-dessus avec encapsulation et sans utiliser la nouvelle syntaxe, mais en pr√©servant la s√©mantique de la syntaxe actuelle: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> privatesForA = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { privatesForA.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, {}); privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).priv = <span class="hljs-number"><span class="hljs-number">1</span></span>; } method() { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).priv); } }</code> </pre> <br><blockquote>  Soit dit en passant, sur la base de cette s√©mantique, l'un des membres du comit√© a m√™me construit une petite <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que d'utilitaires</a> qui vous permet d'utiliser l'√©tat priv√© en ce moment, afin de montrer que cette fonctionnalit√© est trop surfaite par le comit√©.  Le code format√© ne prend que 27 lignes. </blockquote><p>  En g√©n√©ral, tout va bien, nous obtenons <code>hard-private</code> acc√®s <code>hard-private</code> , qui ne peut en aucun cas √™tre obtenu / intercept√© / suivi √† partir de code externe, et en m√™me temps, nous pouvons acc√©der aux champs priv√©s d'une autre instance de la m√™me classe, par exemple comme ceci: </p><br><pre> <code class="javascript hljs">isEquals(obj) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> privatesForA.get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>).id === privatesForA.get(obj).id; }</code> </pre> <br><p>  Eh bien, c'est tr√®s pratique, sauf que cette s√©mantique, en plus de l'encapsulation elle-m√™me, comprend √©galement la <code>brand-checking</code> (vous ne pouvez pas google ce que c'est - il est peu probable que vous trouviez des informations pertinentes). <br>  <code>brand-checking</code> est l'oppos√© de la <code>duck-typing</code> de <code>duck-typing</code> , en ce sens qu'elle ne v√©rifie pas l'interface publique de l'objet, mais le fait que l'objet a √©t√© construit √† l'aide d'un code de confiance. <br>  Une telle v√©rification, en fait, a une certaine port√©e - elle est principalement associ√©e √† la s√©curit√© de l'appel de code non approuv√© dans un seul espace d'adressage avec un espace de confiance et √† la possibilit√© d'√©changer des objets directement sans s√©rialisation. </p><br><blockquote>  Bien que certains ing√©nieurs consid√®rent cela comme une partie n√©cessaire d'une bonne encapsulation. </blockquote><p>  Malgr√© le fait qu'il s'agit d'une opportunit√© plut√¥t curieuse, qui est √©troitement li√©e au mod√®le de <code></code> (description <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">courte</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus longue</a> ), √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>Realms</code> propagande</a> et travaux scientifiques dans le domaine de l'informatique, dans lesquels <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mark Samuel Miller est</a> engag√© (il est √©galement membre du comit√©), selon mon exp√©rience. , dans la pratique de la plupart des d√©veloppeurs, cela ne se produit presque jamais. </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Soit dit en passant</a> , je suis toujours tomb√© sur une membrane (m√™me si je ne savais pas ce que c'√©tait alors) lorsque j'ai r√©√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vm2 pour</a> r√©pondre √† mes besoins. </blockquote><br><h3 id="problema-brand-checking">  Probl√®me de <code>brand-checking</code> </h3><br><p>  Comme mentionn√© pr√©c√©demment, la <code>brand-checking</code> est l'oppos√© de la <code>duck-typing</code> de <code>duck-typing</code> .  En pratique, cela signifie qu'avoir ce code: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> brands = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">WeakMap</span></span>(); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { brands.set(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, {}); } method() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } brandCheckedMethod() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!brands.has(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">'Brand-check failed'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.method()); } }</code> </pre> <br><p>  <code>brandCheckedMethod</code> ne peut √™tre appel√© qu'avec une instance de classe <code>A</code> et m√™me si la cible est un objet qui conserve les invariants de cette classe, cette m√©thode l√®vera une exception: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> duckTypedObj = { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: A.prototype.method.bind(duckTypedObj), <span class="hljs-attr"><span class="hljs-attr">brandCheckedMethod</span></span>: A.prototype.brandCheckedMethod.bind(duckTypedObj), }; duckTypedObj.method(); <span class="hljs-comment"><span class="hljs-comment">//        1 duckTypedObj.brandCheckedMethod(); //     </span></span></code> </pre> <br><p>  √âvidemment, cet exemple est assez synth√©tique et l'utilisation de <code>duckTypedObj</code> comme celle-ci <code>duckTypedObj</code> douteuse, jusqu'√† ce que nous pensions √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>Proxy</code></a> . <br>  La m√©taprogrammation est l'un des sc√©narios d'utilisation de proxy tr√®s importants.  Pour que le proxy fasse tout le travail utile n√©cessaire, les m√©thodes des objets encapsul√©s √† l'aide d'un proxy doivent √™tre ex√©cut√©es dans le contexte du proxy, et non dans le contexte de la cible, √† savoir: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> a = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Proxy</span></span>(a, { get(target, p, receiver) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> property = <span class="hljs-built_in"><span class="hljs-built_in">Reflect</span></span>.get(target, p, receiver); doSomethingUseful(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, retval, target, p, receiver); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> property === <span class="hljs-string"><span class="hljs-string">'function'</span></span>) ? property.bind(proxy) : property; } });</code> </pre> <br><p>  Appelez <code>proxy.method();</code>  fera un travail utile d√©clar√© dans le proxy et retournera <code>1</code> , tout en appelant <code>proxy.brandCheckedMethod();</code>  au lieu de faire deux fois un travail utile √† partir du proxy, il l√®vera une exception, car <code>a !== proxy</code> , ce qui signifie que la <code>brand-check</code> n'a pas r√©ussi. </p><br><p>  Oui, nous pouvons ex√©cuter des m√©thodes / fonctions dans le contexte d'une cible r√©elle, pas d'un proxy, et pour certains sc√©narios cela suffit (par exemple, pour impl√©menter le mod√®le <code></code> ), mais cela ne suffit pas pour tous les cas (par exemple, pour impl√©menter des propri√©t√©s r√©actives: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MobX 5</a> utilise d√©j√† un proxy pour cela, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vue.js</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Aurelia</a> exp√©rimentent cette approche pour les futures versions). </p><br><p>  En g√©n√©ral, tant que le <code>brand-check</code> de <code>brand-check</code> doit √™tre fait explicitement, ce n'est pas un probl√®me - le d√©veloppeur doit juste consciemment d√©cider quel compromis il fait et s'il en a besoin, de plus, dans le cas d'un <code>brand-check</code> explicite <code>brand-check</code> vous pouvez l'impl√©menter de telle mani√®re que l'erreur ne serait pas renvoy√©e sur des proxys approuv√©s. </p><br><p>  Malheureusement, l'actuel nous a priv√© de cette flexibilit√©: </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ #priv; method() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.#priv; <span class="hljs-comment"><span class="hljs-comment">//    brand-check   } }</span></span></code> </pre> <br><p>  Une telle <code>method</code> l√®vera toujours une exception si elle n'est pas appel√©e dans le contexte d'un objet construit √† l'aide du constructeur <code>A</code>  Et le pire, c'est que la <code>brand-check</code> est implicite ici et est m√©lang√©e √† une autre fonctionnalit√© - l'encapsulation. </p><br><p>  Alors que l' <code></code> presque n√©cessaire pour tout code, la <code>brand-check</code> a une port√©e plut√¥t √©troite.  Et les combiner en une seule syntaxe entra√Ænera le fait que de nombreuses <code>brand-check</code> involontaires apparaissent dans le code utilisateur, lorsque le d√©veloppeur avait uniquement l'intention de masquer les d√©tails de l'impl√©mentation. <br>  Et le slogan qui est utilis√© pour promouvoir cela √©tait <code># is the new _</code> exacerbant seulement la situation. </p><br><blockquote>  Vous pouvez √©galement lire une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">discussion d√©taill√©e sur la fa√ßon dont un proxy existant rompt un proxy</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">L'un des d√©veloppeurs</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">auteur</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'Aurelia</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vue.js est intervenu dans la discussion</a> . <br><br>  De plus, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mon commentaire</a> , qui d√©crit plus en d√©tail la diff√©rence entre les diff√©rents sc√©narios de proxy, peut sembler int√©ressant pour quelqu'un.  Dans son ensemble, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">toute la discussion sur la connexion des champs priv√©s et des membranes</a> . </blockquote><br><h1 id="alternativy">  Alternatives </h1><br><p>  Toutes ces discussions auraient peu de sens s'il n'y avait pas d'alternatives.  Malheureusement, pas un seul rempla√ßant n'est m√™me arriv√© √† l' <strong>√©tape 1</strong> , et, par cons√©quent, n'a m√™me pas eu la chance d'√™tre suffisamment √©labor√©.  Cependant, je vais √©num√©rer ici des alternatives qui r√©solvent en quelque sorte les probl√®mes d√©crits ci-dessus. </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Symbol.private</strong></a> - un prozazil alternatif l'un des membres du comit√©. <br><ol><li>  R√©sout tous les probl√®mes ci-dessus (bien qu'il puisse avoir le sien, mais, compte tenu du manque de travail actif sur celui-ci, il est difficile de les trouver) </li><li>  il a de nouveau √©t√© rejet√© lors de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">derni√®re r√©union du comit√© en</a> raison de l'absence d'un <code>brand-check</code> int√©gr√©, de probl√®mes avec le motif de la membrane (bien que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela</a> + <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cela</a> offre une solution ad√©quate) et du manque de syntaxe pratique </li><li>  une syntaxe pratique peut √™tre construite au-dessus de la r√©elle, comme je l'ai montr√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> </li></ol></li><li>  <a href=""><strong>Classes 1.1</strong></a> - posozal ant√©rieur du m√™me auteur </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><strong>Utilisation de <em>Private</em> comme objet</strong></a> </li></ol><br><h1 id="vmesto-zaklyucheniya">  Au lieu d'une conclusion </h1><br><p>  Par le ton de l'article, il peut probablement sembler que je condamne le comit√© - ce n'est pas le cas.  Il me semble qu'au fil des ann√©es (selon le point de d√©part, cela pourrait m√™me √™tre des d√©cennies) que le comit√© a travaill√© sur l'encapsulation dans JS, beaucoup de choses dans l'industrie ont chang√©, et l'apparence pourrait √™tre floue, ce qui a conduit √† un faux classement des priorit√©s . </p><br><p>  De plus, en tant que communaut√©, nous <strong>poussons</strong> le <strong>tc39 √† les</strong> forcer √† publier des fonctionnalit√©s plus rapidement, tout en donnant tr√®s peu de commentaires dans les premiers stades des prozos, ce qui ne fait baisser notre indignation qu'√† un moment o√π peu de choses peuvent √™tre modifi√©es. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">On pense</a> que dans ce cas, le processus a simplement √©chou√©. </p><br><p>  Apr√®s l'avoir plong√© dans ma t√™te et avoir discut√© avec certains repr√©sentants, j'ai d√©cid√© que je ferais de mon mieux pour √©viter la r√©p√©tition d'une situation similaire - mais je peux faire un peu (√©crire un article de revue, faire en sorte que la mise en ≈ìuvre de l' <code>stage1</code> rat√©e √† <code>babel</code> et tout le <code>babel</code> ). </p><br><p>  Mais la chose la plus importante est la r√©troaction - je vous demanderais donc de participer √† cette petite enqu√™te.  Et j'essaierai √† mon tour de le transmettre au comit√©. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428119/">https://habr.com/ru/post/fr428119/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428109/index.html">Mur d'entreprise</a></li>
<li><a href="../fr428111/index.html">Arithm√©tique de pr√©cision arbitraire √† Erlang</a></li>
<li><a href="../fr428113/index.html">√Ä la question des courbes de B√©zier, de la vitesse Arduino et d'un site int√©ressant, ou comment j'ai pass√© le week-end</a></li>
<li><a href="../fr428115/index.html">D√©veloppement Web pour le commerce √©lectronique: 5 tendances technologiques pour 2019</a></li>
<li><a href="../fr428117/index.html">Processeurs tensoriels gratuits de Google dans le cloud collaboratif</a></li>
<li><a href="../fr428121/index.html">Stan Drapkin. Pi√®ges de cryptographie de haut niveau dans .NET</a></li>
<li><a href="../fr428123/index.html">Semaine de la s√©curit√© 41: Bonne nouvelle</a></li>
<li><a href="../fr428125/index.html">Qui sont les analyses de produits et pourquoi sont-elles n√©cessaires dans une √©quipe?</a></li>
<li><a href="../fr428127/index.html">Cache Nginx: tout nouveau - vieux bien oubli√©</a></li>
<li><a href="../fr428129/index.html">Une logique floue simple coll√©e ¬´de ce qui √©tait¬ª pour un moteur √† turbine √† gaz</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>