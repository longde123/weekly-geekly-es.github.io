<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüíª üë∞üèº ü§´ Pengujian Python dengan pytest. BAB 3 Jadwal Terbaik üíÉüèº üëãüèª üßùüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kembali Selanjutnya 


 Buku ini adalah bab yang hilang yang hilang dari setiap buku Python yang komprehensif. 


 Frank ruiz 
 Insinyur Keandalan Sit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pengujian Python dengan pytest. BAB 3 Jadwal Terbaik</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448786/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Selanjutnya</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  Buku ini adalah bab yang hilang yang hilang dari setiap buku Python yang komprehensif. </p><br><p>  Frank ruiz <br>  Insinyur Keandalan Situs Utama, Box, Inc. </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p>  Contoh-contoh dalam buku ini ditulis menggunakan Python 3.6 dan pytest 3.2.  pytest 3.2 mendukung Python 2.6, 2.7 dan Python 3.3+ </p><br><blockquote> Kode sumber untuk proyek Tugas, serta untuk semua tes yang ditunjukkan dalam buku ini, tersedia di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">tautan</a> di halaman web buku di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  Anda tidak perlu mengunduh kode sumber untuk memahami kode uji;  kode uji disajikan dalam bentuk yang mudah dalam contoh.  Tetapi untuk mengikuti tugas-tugas proyek, atau mengadaptasi contoh uji untuk menguji proyek Anda sendiri (tangan Anda tidak terikat!), Anda harus pergi ke halaman web buku dan mengunduh karya.  Di sana, di halaman web buku, ada tautan untuk pesan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://pragprog.com/titles/bopytest/errata">errata</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" title="https://forums.pragprog.com/forums/438">forum diskusi</a> . </blockquote><p>  Di bawah spoiler adalah daftar artikel dalam seri ini. </p><br><div class="spoiler">  <b class="spoiler_title">Daftar isi</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Pendahuluan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 1: memulai dengan pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 2: Fungsi Tes Penulisan</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 3: Jadwal Pytest</strong></a> (Artikel ini) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 4: Perlengkapan yang Terpasang</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 5: Plugin</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 6: Konfigurasi</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>Bab 7: Menggunakan pytest dengan alat lain</strong></a> </li></ul></div></div><br><p>  Sekarang Anda telah melihat dasar-dasar pytest, mari kita mengalihkan perhatian kita ke fixture, yang diperlukan untuk menyusun kode uji untuk hampir semua sistem perangkat lunak non-sepele.  Fixture adalah fungsi yang dilakukan oleh pytest sebelum (dan kadang-kadang setelah) fungsi tes yang sebenarnya.  Kode fixture dapat melakukan apa pun yang Anda butuhkan.  Anda dapat menggunakan Fixtures untuk mendapatkan dataset untuk pengujian.  Anda dapat menggunakan Jadwal untuk membuat sistem dalam kondisi yang diketahui sebelum menjalankan tes.  Fixture juga digunakan untuk mendapatkan data untuk beberapa tes. </p><br><p>  Berikut adalah contoh perlengkapan sederhana yang mengembalikan nomor: </p><br><blockquote> <strong><code>test_fixtures.py</code> / <code>test_fixtures.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">import pytest @pytest.fixture() def some_data(): """Return answer to ultimate question.""" return 42 def test_some_data(some_data): """Use fixture return value in a test.""" assert some_data == 42</code> </pre> <br><p>  <code>@pytest.fixture()</code> digunakan untuk memberi tahu pytest bahwa fungsinya adalah fixture.  Saat Anda memasukkan nama fixture dalam daftar parameter fungsi tes, pytest tahu cara menjalankannya sebelum menjalankan tes.  Perlengkapan dapat melakukan pekerjaan, atau mereka dapat mengembalikan data ke fungsi tes. </p><br><p>  Tes <code>test_some_data()</code> memiliki nama <code>test_some_data()</code> <code>some_data</code> sebagai parameter.  pytest akan mendeteksi ini dan menemukan fixture dengan nama itu.  Namanya signifikan di pytest.  pytest akan mencari perlengkapan dengan nama itu di modul tes.  Dia juga akan mencari di <em>conftest.py</em> jika dia tidak menemukannya dalam hal ini. </p><br><p>  Sebelum kita memulai penelitian kita tentang fixture (dan file conftest.py), saya perlu mempertimbangkan fakta bahwa fixture istilah memiliki banyak arti dalam komunitas pemrograman dan pengujian dan bahkan dalam komunitas Python.  Saya menggunakan <code>fixture</code> , <code>fixture function</code> , dan <code>fixture method</code> bergantian untuk merujuk ke fungsi <code>@pytest.fixture()</code> dijelaskan dalam bab ini.  Fixture juga dapat digunakan untuk menunjukkan sumber daya yang dirujuk oleh fungsi fixture.  Fungsi-fungsi fixture seringkali mengatur atau mengambil beberapa data yang dapat digunakan oleh tes ini.  Terkadang data ini dianggap sebagai perlengkapan.  Sebagai contoh, komunitas Django sering menggunakan perlengkapan untuk menunjukkan beberapa data mentah yang dimuat ke dalam database di awal aplikasi. </p><br><p>  Terlepas dari arti lain, di pytest dan dalam buku ini, perlengkapan pengujian merujuk pada mekanisme yang disediakan pytest untuk memisahkan kode "bersiap-siap" dan "membersihkan setelah" dari fungsi pengujian Anda. </p><br><p>  perlengkapan pytest adalah salah satu fitur unik yang menaikkan pytest dari lingkungan pengujian lainnya dan merupakan alasan mengapa banyak orang yang dihormati beralih ke ... dan tetap menggunakan pytest.  Namun, perlengkapan di pytest berbeda dari perlengkapan di Django dan berbeda dari pengaturan dan prosedur teardown ditemukan di unittest dan hidung.  Ada banyak fitur dan nuansa dalam hal perlengkapan.  Begitu Anda mendapatkan model mental yang baik tentang bagaimana mereka bekerja, Anda akan merasa lebih baik.  Namun, Anda perlu bermain dengan mereka untuk sementara waktu untuk mengemudi, jadi mari kita mulai. </p><br><h2 id="obmen-fixtures-cherez-conftestpy">  Berbagi perlengkapan melalui conftest.py </h2><br><p>  Anda dapat meletakkan fixture dalam file tes yang terpisah, tetapi untuk membagikan fixture dalam beberapa file uji, lebih baik menggunakan file <em>conftest.py</em> di suatu tempat di tempat yang umum, terpusat untuk semua tes.  Untuk proyek tugas, semua perlengkapan akan berada di <code>tasks_proj/tests/conftest.py</code> . </p><br><p>  Dari sana, perlengkapan dapat dibagi dengan adonan apa pun.  Anda dapat menempatkan fixture dalam file pengujian terpisah jika Anda ingin fixture hanya digunakan dalam pengujian file ini.  Demikian pula, Anda dapat memiliki file <em>conftest.py</em> lainnya di subdirektori dari direktori <em>tes teratas</em> .  Jika Anda melakukannya, perlengkapan yang ditentukan dalam file-file conftest.py tingkat rendah ini akan tersedia untuk pengujian dalam direktori dan subdirektori ini.  Namun, sampai sekarang perlengkapan dalam proyek Tugas telah dirancang untuk pengujian apa pun.  Oleh karena itu, menggunakan semua alat kami di file <em>conftest.py</em> di root tes, <code>tasks_proj/tests</code> , masuk akal. </p><br><p>  Meskipun conftest.py adalah modul Python, itu tidak boleh diimpor oleh file uji.  Jangan mengimpor conftest kapan!  File conftest.py dibaca oleh pytest dan dianggap sebagai plug-in lokal, yang akan menjadi jelas ketika kita mulai berbicara tentang plug-in di bab 5 ‚ÄúPlug-in‚Äù di halaman 95. Untuk saat ini, pertimbangkan <code>tests/conftest.py</code> sebagai tempat di mana kita dapat menempatkan perlengkapan untuk digunakan semua tes di direktori tes.  Lalu mari kita ulang beberapa tes kami untuk <code>task_proj</code> menggunakan perlengkapan dengan benar. </p><br><h2 id="ispolzovanie--fixtures-dlya-setup-i-teardown">  Menggunakan Perlengkapan untuk Pengaturan dan Teardown </h2><br><p>  Sebagian besar tes dalam proyek Tugas mengasumsikan bahwa database Tugas sudah dikonfigurasikan, berjalan, dan siap.  Dan kita harus menghapus beberapa entri pada akhirnya, jika ada kebutuhan untuk pembersihan.  Dan Anda mungkin juga perlu memutuskan koneksi dari database.  Untungnya, sebagian besar diurus dalam kode tugas dengan <code>tasks.start_tasks_db(&lt;directory to store db\&gt;, 'tiny' or 'mongo')</code> dan <code>tasks.stop_tasks_db()</code> ;  kita hanya perlu memanggil mereka pada waktu yang tepat, dan kita juga memerlukan direktori sementara. </p><br><p>  Untungnya, pytest menyertakan perlengkapan yang sangat baik yang disebut tmpdir.  Kita bisa menggunakannya untuk pengujian dan tidak perlu khawatir tentang pembersihan.  Ini bukan sihir, hanya praktik pengkodean yang baik dari orang yang paling ingin tahu.  (Jangan khawatir; kami akan menganalisis tmpdir dan menuliskannya lebih detail menggunakan tmpdir_factory di bagian ‚ÄúMenggunakan tmpdir dan tmpdir_factory‚Äù di halaman 71.) </p><br><p>  Dengan semua komponen ini, fixture ini berfungsi dengan baik: </p><br><blockquote>  <strong>ch3 / a / <code>tasks_proj</code> /tests/conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">import pytest import tasks from tasks import Task @pytest.fixture() def tasks_db(tmpdir): """    ,  .""" # Setup : start db tasks.start_tasks_db(str(tmpdir), 'tiny') yield #    # Teardown : stop db tasks.stop_tasks_db()</code> </pre> <br><p>  Nilai <em>tmpdir</em> bukan string - itu adalah objek yang mewakili direktori.  Namun, ini mengimplementasikan <code>__str__</code> , jadi kita bisa menggunakan <code>str()</code> untuk mendapatkan string yang lewat ke <code>start_tasks_db()</code> .  Untuk saat ini, kami masih menggunakan tiny untuk TinyDB. </p><br><p>  Fungsi fixture dijalankan sebelum tes yang menggunakannya.  Namun, jika fungsi memiliki <em>hasil</em> , maka akan berhenti di sana, kontrol akan diteruskan ke tes dan baris berikutnya setelah <em>hasil</em> dijalankan setelah tes selesai.  Oleh karena itu, pikirkan kode di atas <em>hasil</em> sebagai "pengaturan", dan kode setelah <em>hasil</em> sebagai "teardown".  Kode setelah <em>menghasilkan</em> "teardown" akan dijalankan terlepas dari apa yang terjadi selama pengujian.  Kami tidak mengembalikan data dengan output di fixture ini.  Tapi kamu bisa. </p><br><p>  Mari kita modifikasi salah satu dari <code>tasks.add()</code> tes untuk menggunakan fixture ini: </p><br><blockquote>  ch3 / a / <code>tasks_proj</code> / tes / func / <code>test_add</code> .py </blockquote><br><pre> <code class="plaintext hljs">import pytest import tasks from tasks import Task def test_add_returns_valid_id(tasks_db): """tasks.add(&lt;valid task&gt;)    .""" # GIVEN    # WHEN    # THEN  task_id  int new_task = Task('do something') task_id = tasks.add(new_task) assert isinstance(task_id, int)</code> </pre> <br><p>  Perubahan utama di sini adalah bahwa perlengkapan tambahan dalam file telah dihapus, dan kami menambahkan <code>tasks_db</code> ke daftar parameter pengujian.  Saya suka menyusun tes dalam format <em>GIVEN / WHEN / THEN</em> (DANO / WHEN / SETELAH), menggunakan komentar, terutama jika ini tidak jelas dari kode apa yang terjadi.  Saya pikir ini berguna dalam kasus ini.  Semoga GIVEN memulai tugas db akan membantu mencari tahu mengapa <code>tasks_db</code> digunakan sebagai alat untuk pengujian. </p><br><hr><br><p>  Pastikan Tugas diinstal. </p><br><hr><br><p>  Kami masih menulis tes untuk proyek Tugas di bab ini, yang pertama kali diinstal di bab 2. Jika Anda melewatkan bab ini, pastikan untuk menginstal tugas dengan kode cd;  <code>pip install ./tasks_proj/</code> . </p><br><hr><br><h2 id="trassirovka-fixture-execution-s-setup-show">  Melacak Eksekusi Fixture dengan ‚Äìsetup-show </h2><br><p>  Jika Anda menjalankan tes dari bagian terakhir, Anda tidak akan melihat perlengkapan mana yang berjalan: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ $ pip install ./tasks_proj/ #      $ cd /path/to/code/ch3/a/tasks_proj/tests/func $ pytest -v test_add.py -k valid_id ===================== test session starts ====================== collected 3 items test_add.py::test_add_returns_valid_id PASSED ====================== 2 tests deselected ====================== ============ 1 passed, 2 deselected in 0.02 seconds ============</code> </pre> <br><p>  Ketika saya mendesain perlengkapan, saya perlu melihat apa yang berhasil dan kapan.  Untungnya, pytest menyediakan flag baris perintah seperti itu, <code>-- setup-show</code> , yang tidak hanya itu: </p><br><pre> <code class="plaintext hljs">$ pytest --setup-show test_add.py -k valid_id ============================= test session starts ============================= collected 3 items / 2 deselected test_add.py SETUP S tmpdir_factory SETUP F tmpdir (fixtures used: tmpdir_factory) SETUP F tasks_db (fixtures used: tmpdir) func/test_add.py::test_add_returns_valid_id (fixtures used: tasks_db, tmpdir, tmpdir_factory). TEARDOWN F tasks_db TEARDOWN F tmpdir TEARDOWN S tmpdir_factory =================== 1 passed, 2 deselected in 0.18 seconds ====================</code> </pre> <br><p>  Tes kami ada di tengah, dan pytest menunjuk bagian SETUP dan TEARDOWN untuk setiap fixture.  Dimulai dengan <code>test_add_returns_valid_id</code> , Anda melihat bahwa <code>tmpdir</code> bekerja sebelum tes.  Dan sebelum itu <code>tmpdir_factory</code> .  <code>tmpdir</code> tampaknya menggunakannya sebagai perlengkapan. </p><br><p>  <strong>F</strong> dan <strong>S</strong> di depan nama fixture menunjukkan area.  <strong>F</strong> untuk cakupan dan <strong>S</strong> untuk cakupan sesi.  Saya akan membahas ruang lingkup di bagian "Spesifikasi Ruang Lingkup" di halaman 56. </p><br><h2 id="ispolzovanie-fixtures-dlya-test-data">  Menggunakan Fixture untuk Data Uji </h2><br><p>  Perlengkapan adalah tempat yang tepat untuk menyimpan data untuk pengujian.  Anda dapat mengembalikan apa pun.  Berikut adalah fixture yang mengembalikan tuple tipe campuran: </p><br><blockquote>  <strong>ch3 / test_fixtures.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.fixture() def a_tuple(): """ -  """ return (1, 'foo', None, {'bar': 23}) def test_a_tuple(a_tuple): """Demo the a_tuple fixture.""" assert a_tuple[3]['bar'] == 32</code> </pre> <br><p>  Karena <code>test_a_tuple()</code> harus gagal <em>(23! = 32)</em> , kita akan melihat apa yang terjadi ketika tes fixture gagal: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3 $ pytest test_fixtures.py::test_a_tuple ============================= test session starts ============================= collected 1 item test_fixtures.py F [100%] ================================== FAILURES =================================== ________________________________ test_a_tuple _________________________________ a_tuple = (1, 'foo', None, {'bar': 23}) def test_a_tuple(a_tuple): """Demo the a_tuple fixture.""" &gt; assert a_tuple[3]['bar'] == 32 E assert 23 == 32 test_fixtures.py:38: AssertionError ========================== 1 failed in 0.17 seconds ===========================</code> </pre> <br><p>  Bersama-sama dengan bagian stack stack, pytest menampilkan parameter nilai dari fungsi yang menyebabkan pengecualian atau pernyataan yang gagal.  Dalam kasus pengujian, fixture adalah parameter untuk pengujian, sehingga mereka dilaporkan menggunakan stack stack.  Apa yang terjadi jika pernyataan (atau pengecualian) terjadi pada fixture? </p><br><pre> <code class="plaintext hljs">$ pytest -v test_fixtures.py::test_other_data ============================= test session starts ============================= test_fixtures.py::test_other_data ERROR [100%] =================================== ERRORS ==================================== ______________________ ERROR at setup of test_other_data ______________________ @pytest.fixture() def some_other_data(): """Raise an exception from fixture.""" x = 43 &gt; assert x == 42 E assert 43 == 42 test_fixtures.py:21: AssertionError =========================== 1 error in 0.13 seconds ===========================</code> </pre> <br><p>  Beberapa hal terjadi.  Jejak tumpukan dengan benar menunjukkan bahwa pernyataan terjadi dalam fungsi fixture.  Selain itu, <code>test_other_data</code> dilaporkan bukan sebagai <strong>GAGAL</strong> , tetapi sebagai <strong>KESALAHAN</strong> .  Ini perbedaan utama.  Jika tes tiba-tiba gagal, Anda tahu bahwa kegagalan terjadi dalam tes itu sendiri, dan tidak tergantung pada beberapa perlengkapan. </p><br><p>  Tetapi bagaimana dengan proyek Tugas?  Untuk proyek Tugas, kami mungkin dapat menggunakan beberapa perlengkapan data, daftar tugas yang mungkin berbeda dengan properti yang berbeda: </p><br><blockquote>  <strong>ch3 / a / task_proj / tes / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">#    Task constructor # Task(summary=None, owner=None, done=False, id=None) # summary    # owner  done   # id    @pytest.fixture() def tasks_just_a_few(): """    .""" return ( Task('Write some code', 'Brian', True), Task("Code review Brian's code", 'Katie', False), Task('Fix what Brian did', 'Michelle', False)) @pytest.fixture() def tasks_mult_per_owner(): """     .""" return ( Task('Make a cookie', 'Raphael'), Task('Use an emoji', 'Raphael'), Task('Move to Berlin', 'Raphael'), Task('Create', 'Michelle'), Task('Inspire', 'Michelle'), Task('Encourage', 'Michelle'), Task('Do a handstand', 'Daniel'), Task('Write some books', 'Daniel'), Task('Eat ice cream', 'Daniel'))</code> </pre> <br><p>  Anda dapat menggunakannya langsung dari tes, atau dari perlengkapan lain.  Mari kita buat database yang tidak kosong untuk pengujian dengan bantuan mereka. </p><br><h2 id="ispolzovanie-multiple-fixtures">  Menggunakan Berbagai Perlengkapan </h2><br><p>  Anda telah melihat bahwa tmpdir menggunakan tmpdir_factory.  Dan Anda menggunakan tmpdir di fixture task_db kami.  Mari kita lanjutkan rantai dan tambahkan beberapa perlengkapan khusus untuk pangkalan tugas proyek yang tidak kosong: </p><br><blockquote>  <strong>ch3 / a / task_proj / tes / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.fixture() def db_with_3_tasks(tasks_db, tasks_just_a_few): """   3 ,  .""" for t in tasks_just_a_few: tasks.add(t) @pytest.fixture() def db_with_multi_per_owner(tasks_db, tasks_mult_per_owner): """   9 , 3 owners,  3   .""" for t in tasks_mult_per_owner: tasks.add(t)</code> </pre> <br><p>  Semua perlengkapan ini menyertakan dua perlengkapan dalam daftar parameter mereka: <code>tasks_db</code> dan kumpulan data.  Dataset digunakan untuk menambahkan tugas ke database.  Sekarang tes dapat menggunakannya jika Anda ingin tes dimulai dengan database yang tidak kosong, misalnya: </p><br><blockquote>  <strong>ch3 / a / task_proj / tes / func / test_add.py</strong> </blockquote><br><pre> <code class="plaintext hljs">def test_add_increases_count(db_with_3_tasks): """Test tasks.add()    tasks.count().""" # GIVEN db  3  # WHEN     tasks.add(Task('throw a party')) # THEN    1 assert tasks.count() == 4</code> </pre> <br><p>  Ini juga menunjukkan salah satu alasan utama untuk menggunakan fixture: untuk memfokuskan tes pada apa yang sebenarnya Anda uji, daripada apa yang harus Anda lakukan untuk mempersiapkan tes.  Saya suka menggunakan komentar untuk GIVEN / KETIKA / KEMUDIAN dan mencoba untuk mendorong sebanyak mungkin data (DIBERIKAN) ke dalam perlengkapan karena dua alasan.  Pertama, itu membuat tes lebih mudah dibaca dan karena itu lebih dapat dipertahankan.  Kedua, pernyataan atau pengecualian dalam fixture menghasilkan kesalahan (ERROR), sedangkan pernyataan atau pengecualian dalam fungsi tes menghasilkan kesalahan (GAGAL).  Saya tidak ingin <code>test_add_increases_count()</code> jika inisialisasi database gagal.  Itu membingungkan.  Saya ingin kegagalan (GAGAL) dari <code>test_add_increases_count()</code> menjadi mungkin hanya jika <code>add ()</code> benar-benar tidak dapat mengubah penghitung.  Mari kita jalankan dan lihat bagaimana semua perlengkapan bekerja: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/a/tasks_proj/tests/func $ pytest --setup-show test_add.py::test_add_increases_count ============================= test session starts ============================= collected 1 item test_add.py SETUP S tmpdir_factory SETUP F tmpdir (fixtures used: tmpdir_factory) SETUP F tasks_db (fixtures used: tmpdir) SETUP F tasks_just_a_few SETUP F db_with_3_tasks (fixtures used: tasks_db, tasks_just_a_few) func/test_add.py::test_add_increases_count (fixtures used: db_with_3_tasks, tasks_db, tasks_just_a_few, tmpdir, tmpdir_factory). TEARDOWN F db_with_3_tasks TEARDOWN F tasks_just_a_few TEARDOWN F tasks_db TEARDOWN F tmpdir TEARDOWN S tmpdir_factory ========================== 1 passed in 0.20 seconds ===========================</code> </pre> <br><p>  Kami mendapat banyak Fs dan Ss lagi untuk area fungsi dan sesi.  Mari kita lihat apa itu. </p><br><h2 id="specifikaciya-oblasteyscope-fixture">  Spesifikasi Ruang Lingkup </h2><br><p>  Perlengkapan termasuk parameter opsional yang disebut <strong>lingkup</strong> , yang menentukan seberapa sering perlengkapan menerima pengaturan dan pembongkaran.  Parameter <em>lingkup</em> untuk <code>@ pytest.fixture()</code> dapat memiliki nilai fungsi, kelas, modul, atau sesi.  <em>Lingkup</em> adalah fungsi secara default.  Pengaturan task_db dan semua perlengkapan belum menentukan area.  Dengan demikian, mereka adalah perlengkapan fungsional. </p><br><p>  Berikut ini adalah deskripsi singkat dari setiap nilai <em>Lingkup</em> : </p><br><ul><li><p>  <em>scope = 'function'</em> </p><br><p>  Ini dilakukan sekali untuk setiap fungsi tes.  Bagian pengaturan dijalankan sebelum setiap tes menggunakan fixture.  Bagian teardown dimulai setelah setiap tes menggunakan fixture.  Ini adalah area default jika parameter lingkup tidak ditentukan. </p><br></li><li><p>  <em>scope = 'class'</em> </p><br><p>  Ini dijalankan sekali untuk setiap kelas tes, terlepas dari jumlah metode pengujian di kelas. </p><br></li><li><p>  <em>scope = 'module'</em> </p><br><p>  Ini dijalankan satu kali untuk setiap modul, terlepas dari berapa banyak fungsi pengujian atau metode atau perlengkapan lain yang digunakan saat menggunakan modul. </p><br></li><li><p>  <em>scope = 'session'</em> </p><br><p>  Ini dilakukan sekali per sesi.  Semua metode dan fungsi pengujian yang menggunakan perlengkapan lingkup sesi menggunakan pengaturan tunggal dan panggilan teardown. </p><br></li></ul><br><p>  Begini seperti apa nilai lingkup dalam tindakan: </p><br><blockquote>  <strong>ch3 / test_scope.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""Demo fixture scope.""" import pytest @pytest.fixture(scope='function') def func_scope(): """A function scope fixture.""" @pytest.fixture(scope='module') def mod_scope(): """A module scope fixture.""" @pytest.fixture(scope='session') def sess_scope(): """A session scope fixture.""" @pytest.fixture(scope='class') def class_scope(): """A class scope fixture.""" def test_1(sess_scope, mod_scope, func_scope): """   ,   .""" def test_2(sess_scope, mod_scope, func_scope): """     .""" @pytest.mark.usefixtures('class_scope') class TestSomething(): """Demo class scope fixtures.""" def test_3(self): """Test using a class scope fixture.""" def test_4(self): """Again, multiple tests are more fun."""</code> </pre> <br><p>  Mari kita gunakan <code>--setup-show</code> untuk menunjukkan bahwa jumlah fixture dan panggilan setup dipasangkan dengan teardown dilakukan tergantung pada area: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/ $ pytest --setup-show test_scope.py ============================= test session starts ============================= collected 4 items test_scope.py SETUP S sess_scope SETUP M mod_scope SETUP F func_scope test_scope.py::test_1 (fixtures used: func_scope, mod_scope, sess_scope). TEARDOWN F func_scope SETUP F func_scope test_scope.py::test_2 (fixtures used: func_scope, mod_scope, sess_scope). TEARDOWN F func_scope SETUP C class_scope test_scope.py::TestSomething::()::test_3 (fixtures used: class_scope). test_scope.py::TestSomething::()::test_4 (fixtures used: class_scope). TEARDOWN C class_scope TEARDOWN M mod_scope TEARDOWN S sess_scope ========================== 4 passed in 0.11 seconds ===========================</code> </pre> <br><p>  Sekarang Anda dapat melihat tidak hanya <strong>F</strong> dan <strong>S</strong> untuk fungsi dan sesi, tetapi juga <strong>C</strong> dan <strong>M</strong> untuk kelas dan modul. </p><br><p>  Lingkup didefinisikan menggunakan perlengkapan.  Saya tahu ini jelas dari kode, tetapi ini adalah poin penting untuk memastikan bahwa Anda benar-benar mengerang. mengerti ").  Ruang lingkup didefinisikan dalam definisi fixture, dan bukan di tempat panggilannya.  Fungsi pengujian yang menggunakan perlengkapan tidak mengontrol seberapa sering (SETUP) dan waktu istirahat (TEARDOWN). </p><br><p>  Perlengkapan hanya dapat bergantung pada perlengkapan lain dari lingkup yang sama atau lebih diperluas.  Dengan demikian, fixture lingkup fungsi dapat bergantung pada fixture lingkup fungsi lainnya (secara default dan masih digunakan dalam proyek Tugas).  fixture lingkup fungsi mungkin juga tergantung pada kelas, modul, dan perlengkapan dari area sesi, tetapi tidak pernah dalam urutan terbalik. </p><br><h3 id="smena-scope-dlya-tasks-project-fixtures">  Ubah Lingkup untuk Jadwal Proyek Tugas </h3><br><p>  Dengan pengetahuan tentang ruang lingkup ini, sekarang mari kita mengubah ruang lingkup beberapa perlengkapan proyek Tugas. </p><br><p>  Sejauh ini, kami belum memiliki masalah dengan waktu pengujian.  Tapi, Anda harus mengakui bahwa tidak berguna untuk membuat direktori sementara dan koneksi database baru untuk setiap tes.  Selama kami dapat menyediakan database kosong, bila perlu, ini sudah cukup. </p><br><p>  Untuk menggunakan sesuatu seperti <code>tasks_db</code> sebagai ruang lingkup sesi, Anda harus menggunakan <code>tmpdir_factory</code> , karena <code>tmpdir</code> adalah ruang lingkup fungsi dan <code>tmpdir_factory</code> adalah ruang lingkup sesi.  Untungnya, ini hanya satu baris perubahan kode (yah, dua jika Anda mempertimbangkan <code>tmpdir-&gt;tmpdir_factory</code> dalam daftar parameter): </p><br><blockquote>  <strong>ch3 / b / task_proj / tes / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs">"""Define some fixtures to use in the project.""" import pytest import tasks from tasks import Task @pytest.fixture(scope='session') def tasks_db_session(tmpdir_factory): """Connect to db before tests, disconnect after.""" temp_dir = tmpdir_factory.mktemp('temp') tasks.start_tasks_db(str(temp_dir), 'tiny') yield tasks.stop_tasks_db() @pytest.fixture() def tasks_db(tasks_db_session): """An empty tasks db.""" tasks.delete_all()</code> </pre> <br><p>  Di sini kami mengubah <code>tasks_db</code> tergantung pada <code>tasks_db_session</code> , dan kami menghapus semua entri untuk memastikannya kosong.  Karena kami belum mengubah namanya, tidak ada satu pun perlengkapan atau tes yang sudah termasuk yang boleh berubah. </p><br><p>  Perlengkapan data hanya mengembalikan nilai, sehingga benar-benar tidak ada alasan bagi mereka untuk bekerja sepanjang waktu.  Satu kali per sesi sudah cukup: </p><br><blockquote>  <strong>ch3 / b / task_proj / tes / conftest.py</strong> </blockquote><br><pre> <code class="plaintext hljs"># Reminder of Task constructor interface # Task(summary=None, owner=None, done=False, id=None) # summary is required # owner and done are optional # id is set by database @pytest.fixture(scope='session') def tasks_just_a_few(): """All summaries and owners are unique.""" return ( Task('Write some code', 'Brian', True), Task("Code review Brian's code", 'Katie', False), Task('Fix what Brian did', 'Michelle', False)) @pytest.fixture(scope='session') def tasks_mult_per_owner(): """Several owners with several tasks each.""" return ( Task('Make a cookie', 'Raphael'), Task('Use an emoji', 'Raphael'), Task('Move to Berlin', 'Raphael'), Task('Create', 'Michelle'), Task('Inspire', 'Michelle'), Task('Encourage', 'Michelle'), Task('Do a handstand', 'Daniel'), Task('Write some books', 'Daniel'), Task('Eat ice cream', 'Daniel'))</code> </pre> <br><p>  Sekarang mari kita lihat apakah semua perubahan ini akan bekerja dengan pengujian kami: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/b/tasks_proj $ pytest ===================== test session starts ====================== collected 55 items tests/func/test_add.py ... tests/func/test_add_variety.py ............................ tests/func/test_add_variety2.py ............ tests/func/test_api_exceptions.py ....... tests/func/test_unique_id.py . tests/unit/test_task.py .... ================== 55 passed in 0.17 seconds ===================</code> </pre> <br><p>  Segalanya tampak teratur.  Mari kita lihat jadwal untuk satu file tes untuk melihat bagaimana area yang berbeda bekerja sesuai dengan harapan kita: </p><br><pre> <code class="plaintext hljs">$ pytest --setup-show tests/func/test_add.py ============================= test session starts ============================= platform win32 -- Python 3.6.5, pytest-3.9.3, py-1.7.0, pluggy-0.8.0 rootdir: c:\_BOOKS_\pytest_si\bopytest-code\code\ch3\b\tasks_proj\tests, inifile: pytest.ini collected 3 items tests\func\test_add.py SETUP S tmpdir_factory SETUP S tasks_db_session (fixtures used: tmpdir_factory) SETUP F tasks_db (fixtures used: tasks_db_session) func/test_add.py::test_add_returns_valid_id (fixtures used: tasks_db, tasks_db_session, tmpdir_factory). TEARDOWN F tasks_db SETUP F tasks_db (fixtures used: tasks_db_session) func/test_add.py::test_added_task_has_id_set (fixtures used: tasks_db, tasks_db_session, tmpdir_factory). TEARDOWN F tasks_db SETUP S tasks_just_a_few SETUP F tasks_db (fixtures used: tasks_db_session) SETUP F db_with_3_tasks (fixtures used: tasks_db, tasks_just_a_few) func/test_add.py::test_add_increases_count (fixtures used: db_with_3_tasks, tasks_db, tasks_db_session, tasks_just_a_few, tmpdir_factory). TEARDOWN F db_with_3_tasks TEARDOWN F tasks_db TEARDOWN S tasks_db_session TEARDOWN S tmpdir_factory TEARDOWN S tasks_just_a_few ========================== 3 passed in 0.24 seconds ===========================</code> </pre> <br><p>  Ya  . <code>tasks_db_session</code>     ,    <code>task_db</code>        . </p><br><h3 id="specifying-fixtures-with-usefixtures"> Specifying Fixtures with usefixtures </h3><br><p>   ,   ,    ,       .  ,        <code>@pytest.mark.usefixtures('fixture1', 'fixture2')</code> . <em>usefixtures</em>  ,    ,  .          ‚Äî     .       : </p><br><blockquote> <strong>ch3/test_scope.py</strong> </blockquote><br><pre> <code class="plaintext hljs">@pytest.mark.usefixtures('class_scope') class TestSomething(): """Demo class scope fixtures.""" def test_3(self): """Test using a class scope fixture.""" def test_4(self): """Again, multiple tests are more fun."""</code> </pre> <br><p>  <em>usefixtures</em>    ,         .     ,       ,       . ,   -  <em>usefixtures</em> ,      . </p><br><h2 id="ispolzovanie--autouse-dlya-fixtures-that-always-get-used-kotorye-ispolzuyutsya-nepreryvno">  autouse  Fixtures That Always Get Used (  ) </h2><br><p>        ,  ,    (  <em>usefixtures</em>     ).     <em>autouse=True</em> ,    .     ,       ,              .    : </p><br><blockquote> <strong>ch3/test_autouse.py</strong> </blockquote><br><pre> <code class="plaintext hljs">""" autouse fixtures.""" import pytest import time @pytest.fixture(autouse=True, scope='session') def footer_session_scope(): """    session().""" yield now = time.time() print('--') print('finished : {}'.format(time.strftime('%d %b %X', time.localtime(now)))) print('-----------------') @pytest.fixture(autouse=True) def footer_function_scope(): """     .""" start = time.time() yield stop = time.time() delta = stop - start print('\ntest duration : {:0.3} seconds'.format(delta)) def test_1(): """   .""" time.sleep(1) def test_2(): """    .""" time.sleep(1.23)</code> </pre> <br><p>         ,         .     : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3 $ pytest -v -s test_autouse.py ===================== test session starts ====================== collected 2 items test_autouse.py::test_1 PASSED test duration : 1.0 seconds test_autouse.py::test_2 PASSED test duration : 1.24 seconds -- finished : 25 Jul 16:18:27 ----------------- =================== 2 passed in 2.25 seconds ===================</code> </pre> <br><p>  <em>autouse</em>  .    ,  .    ,          . </p><br><p> ,    <em>autouse</em>  ,   ,       <code>tasks_db</code>   .   Tasks  ,     ,  ,      API   .      .      ,     . </p><br><h2 id="pereimenovanie-fixtures">  Fixtures </h2><br><p>  ,        ,  ,      . , <em>pytest</em>       name  <code>@pytest.fixture()</code> : </p><br><blockquote> <strong>ch3/ <code>test_rename_fixture.py</code></strong> </blockquote><br><pre> <code class="plaintext hljs">""" fixture renaming.""" import pytest @pytest.fixture(name='lue') def ultimate_answer_to_life_the_universe_and_everything(): """  .""" return 42 def test_everything(lue): """   .""" assert lue == 42</code> </pre> <br><p>  <em>lue</em>    <code>fixture</code> ,   <code>fixture_with_a_name_much_longer_than_lue</code> .    ,       <code>--setup-show</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --setup-show test_rename_fixture.py ======================== test session starts ======================== collected 1 items test_rename_fixture.py SETUP F lue test_rename_fixture.py::test_everything (fixtures used: lue). TEARDOWN F lue ===================== 1 passed in 0.01 seconds ======================</code> </pre> <br><p>    ,   <em>lue</em> ,    pytest <code>--fixtures</code>       .     ,   ,    ,   : </p><br><pre> <code class="plaintext hljs">$ pytest --fixtures test_rename_fixture.py ======================== test session starts ======================= ... ------------------ fixtures defined from test_rename_fixture ------------------ lue Return ultimate answer. ================= no tests ran in 0.01 seconds =================</code> </pre> <br><p>      ‚Äî   .  , ,   ,  ,   ,   .    ,    <em>lue</em> .      ¬´Tasks¬ª: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/b/tasks_proj $ pytest --fixtures tests/func/test_add.py ======================== test session starts ======================== ... tmpdir_factory Return a TempdirFactory instance for the test session. tmpdir Return a temporary directory path object which is unique to each test function invocation, created as a sub directory of the base temporary directory. The returned object is a `py.path.local`_ path object. ----------------------- fixtures defined from conftest ------------------------ tasks_db An empty tasks db. tasks_just_a_few All summaries and owners are unique. tasks_mult_per_owner Several owners with several tasks each. db_with_3_tasks Connected db with 3 tasks, all unique. db_with_multi_per_owner Connected db with 9 tasks, 3 owners, all with 3 tasks. tasks_db_session Connect to db before tests, disconnect after. =================== no tests ran in 0.01 seconds ====================</code> </pre> <br><p> !     <em>conftest.py</em> .        <code>tmpdir</code>  <code>tmpdir_factory</code> ,    . </p><br><h2 id="parametrizaciya-fikstur">   </h2><br><p>  [Parametrized Testing] ,  . 42,   .     .  -    ,      ,   : </p><br><blockquote> <code>ch3/b/tasks_proj/tests/func/test_add_variety2.py</code> <br> <br> """Test the tasks.add() API function.""" <br><br> import pytest <br> import tasks <br> from tasks import Task <br><br> tasks_to_try = (Task('sleep', done=True), <br> Task('wake', 'brian'), <br> Task('breathe', 'BRIAN', True), <br> Task('exercise', 'BrIaN', False)) <br><br> task_ids = ['Task({},{},{})'.format(t.summary, t.owner, t.done) <br> for t in tasks_to_try] <br><br> def equivalent(t1, t2): <br> """Check two tasks for equivalence.""" <br> return ((t1.summary == t2.summary) and <br> (t1.owner == t2.owner) and <br> (t1.done == t2.done)) </blockquote><p>  ,   ,      <code>a_task</code> : </p><br><blockquote> <strong>ch3/b/tasks_proj/tests/func/ <code>test_add_variety2.py</code></strong> <br><br> @pytest.fixture(params=tasks_to_try) <br> def a_task(request): <br> """ .""" <br> return request.param <br><br> def test_add_a(tasks_db, a_task): <br> """  a_task ( ids).""" <br> task_id = tasks.add(a_task) <br> t_from_db = tasks.get(task_id) <br> assert equivalent(t_from_db, a_task) </blockquote><p> ,    fixture,    ,    .      .    param,      ,  params  <code>@pytest.fixture(params=tasks_to_try)</code> . </p><br><p>  <code>a_task</code>   ‚Äî    <code>request.param</code>     ,  .        ,     ,       : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch3/b/tasks_proj/tests/func $ pytest -v test_add_variety2.py::test_add_a ===================== test session starts ====================== collected 4 items test_add_variety2.py::test_add_a[a_task0] PASSED test_add_variety2.py::test_add_a[a_task1] PASSED test_add_variety2.py::test_add_a[a_task2] PASSED test_add_variety2.py::test_add_a[a_task3] PASSED =================== 4 passed in 0.03 seconds ===================</code> </pre> <br><p>    ,  pytest   ,   ()   .        ,       : </p><br><blockquote> <strong>ch3/b/tasks_proj/tests/func/ <code>test_add_variety2.py</code></strong> <br><br> @pytest.fixture(params=tasks_to_try, ids=task_ids) <br> def b_task(request): <br> """  .""" <br> return request.param <br><br> def test_add_b(tasks_db, b_task): <br> """  b_task,  .""" <br> task_id = tasks.add(b_task) <br> t_from_db = tasks.get(task_id) <br> assert equivalent(t_from_db, b_task) </blockquote><p>      : </p><br><pre> <code class="plaintext hljs">$ pytest -v test_add_variety2.py::test_add_b ===================== test session starts ====================== collected 4 items test_add_variety2.py::test_add_b[Task(sleep,None,True)] PASSED test_add_variety2.py::test_add_b[Task(wake,brian,False)] PASSED test_add_variety2.py::test_add_b[Task(breathe,BRIAN,True)] PASSED test_add_variety2.py::test_add_b[Task(exercise,BrIaN,False)] PASSED =================== 4 passed in 0.04 seconds ===================</code> </pre> <br><p>      <code>ids</code>  ,   ,   .    ,       : </p><br><blockquote> <strong>ch3/b/tasks_proj/tests/func/ <code>test_add_variety2.py</code></strong> <br><br> def id_func(fixture_value): <br> """   .""" <br> t = fixture_value <br> return 'Task({},{},{})'.format(t.summary, t.owner, t.done) <br><br> @pytest.fixture(params=tasks_to_try, ids=id_func) <br> def c_task(request): <br> """  (id_func)   .""" <br> return request.param <br><br> def test_add_c(tasks_db, c_task): <br> """    .""" <br> task_id = tasks.add(c_task) <br> t_from_db = tasks.get(task_id) <br> assert equivalent(t_from_db, c_task) </blockquote><p>         .       Task, <code>id_func()</code>     <em>Task</em> ,       <em>namedtuple</em>      <em>Task</em>      <em>Task</em>  .   ,      ,   : </p><br><pre> <code class="plaintext hljs">$ pytest -v test_add_variety2.py::test_add_c ===================== test session starts ====================== collected 4 items test_add_variety2.py::test_add_c[Task(sleep,None,True)] PASSED test_add_variety2.py::test_add_c[Task(wake,brian,False)] PASSED test_add_variety2.py::test_add_c[Task(breathe,BRIAN,True)] PASSED test_add_variety2.py::test_add_c[Task(exercise,BrIaN,False)] PASSED =================== 4 passed in 0.04 seconds ===================</code> </pre> <br><p>          .       ,   ,    .    , ! </p><br><h3 id="parametrizaciya-fixtures-v-tasks-project">  Fixtures  Tasks Project </h3><br><p>   ,         Tasks.      <em>TinyDB</em>   .   ,        .   ,   ,   ,   ,     <em>TinyDB</em> ,    <em>MongoDB</em> . </p><br><p>  ( ),     ,    <code>start_tasks_db()</code>   <code>tasks_db_session</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ch3/b/tasks_proj/tests/conftest.py</a> <br><br> """      .""" <br><br> import pytest <br> import tasks <br> from tasks import Task <br><br> @pytest.fixture(scope='session') <br> def tasks_db_session(tmpdir_factory): <br> """    ,  .""" <br> temp_dir = tmpdir_factory.mktemp('temp') <br> tasks.start_tasks_db(str(temp_dir), 'tiny') <br> yield <br> tasks.stop_tasks_db() <br><br> @pytest.fixture() <br> def tasks_db(tasks_db_session): <br> """   tasks.""" <br> tasks.delete_all() </blockquote><p>  <code>db_type</code>   <code>start_tasks_db()</code>   .      ,        : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>tasks_proj/src/tasks/api.py</strong></a> </blockquote><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_tasks_db</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(db_path, db_type)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># type: (str, str) -None """  API  .""" if not isinstance(db_path, string_types): raise TypeError('db_path must be a string') global _tasksdb if db_type == 'tiny': import tasks.tasksdb_tinydb _tasksdb = tasks.tasksdb_tinydb.start_tasks_db(db_path) elif db_type == 'mongo': import tasks.tasksdb_pymongo _tasksdb = tasks.tasksdb_pymongo.start_tasks_db(db_path) else: raise ValueError("db_type   'tiny'  'mongo'")</span></span></code> </pre> <br><p>   MongoDB,       db_type  mongo.  : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>ch3/c/tasks_proj/tests/conftest.py</strong></a> </blockquote><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> tasks <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Task <span class="hljs-comment"><span class="hljs-comment"># @pytest.fixture(scope='session', params=['tiny',]) @pytest.fixture(scope='session', params=['tiny', 'mongo']) def tasks_db_session(tmpdir_factory, request): """Connect to db before tests, disconnect after.""" temp_dir = tmpdir_factory.mktemp('temp') tasks.start_tasks_db(str(temp_dir), request.param) yield # this is where the testing happens tasks.stop_tasks_db() @pytest.fixture() def tasks_db(tasks_db_session): """An empty tasks db.""" tasks.delete_all()</span></span></code> </pre> <br><p>    params=['tiny',' mongo']  -.   <code>request</code>    <em>temp_db</em>   <em>db_type</em>  <code>request.param</code>  ,    "tiny"  "mongo". </p><br><p>   <code>--verbose</code>   <code>-v</code>    pytest     , pytest        .      ,   . </p><br><hr><br><p>  <strong>Menginstal MongoDB</strong> </p><br><hr><br><p>    MongoDB, ,   MongoDB  <em>pymongo</em> .       MongoDB,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://www.mongodb.com/download-center</a> . pymongo   pip‚Äî <em>pip install pymongo</em> .   MongoDB       ;           <strong> 7</strong> . </p><br><hr><br><p>     : </p><br><pre> <code class="plaintext hljs"> $ cd /path/to/code/ch3/c/tasks_proj $ pip install pymongo $ pytest -v --tb=no ===================== test session starts ====================== collected 92 items test_add.py::test_add_returns_valid_id[tiny] PASSED test_add.py::test_added_task_has_id_set[tiny] PASSED test_add.py::test_add_increases_count[tiny] PASSED test_add_variety.py::test_add_1[tiny] PASSED test_add_variety.py::test_add_2[tiny-task0] PASSED test_add_variety.py::test_add_2[tiny-task1] PASSED ... test_add.py::test_add_returns_valid_id[mongo] FAILED test_add.py::test_added_task_has_id_set[mongo] FAILED test_add.py::test_add_increases_count[mongo] PASSED test_add_variety.py::test_add_1[mongo] FAILED test_add_variety.py::test_add_2[mongo-task0] FAILED ... ============= 42 failed, 50 passed in 4.94 seconds =============</code> </pre> <br><p>  Hm . ,     ,     -   Mongo.  ,     pdb:   ,  . 125.        TinyDB. </p><br><h2 id="uprazhneniya">  Latihan </h2><br><ol><li>    <code>test_fixtures.py</code> . <br> 2.  fixtures‚Äîfunctions     <code>@pytest.fixture()</code> ,     . ,   ,  . </li><li>         ,   . </li><li>   ,       . </li><li>  <code>pytest --setup-show test_fixtures.py</code> .      ? </li><li>  <code>scope= 'module'</code>     4. </li><li>   <code>pytest --setup-show test_fixtures.py</code> .  Apa yang berubah? </li><li>     6  <code>return &lt;data&gt;</code>  <code>yield &lt;data&gt;</code> . </li><li>       <code>yield</code> . </li><li>  <code>pytest -s -v test_fixtures.py</code> .    ? </li></ol><br><h2 id="chto-dalshe">  Apa selanjutnya </h2><br><p>  pytest fixture  ,   ,   <em>building blocks</em> ,    <em>setup</em>  <em>teardown</em> ,        (,  Mongo  TinyDB).    ,      ,         . </p><br><p>       pytest,   ,    (builtin)  tmpdir  tmpdir_factory.        (builtin) . </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kembali</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Selanjutnya</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id448786/">https://habr.com/ru/post/id448786/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id448774/index.html">SQL ke CSV menggunakan DBMS_SQL</a></li>
<li><a href="../id448776/index.html">RxVMS - Arsitektur Praktis untuk Aplikasi Flutter</a></li>
<li><a href="../id448778/index.html">Memperkenalkan Debugging Perjalanan Waktu untuk Visual Studio Enterprise 2019</a></li>
<li><a href="../id448780/index.html">Apa yang memberi perangkat lunak untuk merekrut uang</a></li>
<li><a href="../id448784/index.html">Fitur baru untuk penulis ekstensi di Visual Studio 2019 versi 16.1</a></li>
<li><a href="../id448788/index.html">Pengujian Python dengan pytest. Bab 2, Fungsi Tes Penulisan</a></li>
<li><a href="../id448792/index.html">Pengujian Python dengan pytest. Perlengkapan Bawaan, Bab 4</a></li>
<li><a href="../id448796/index.html">Pengujian Python dengan pytest. Konfigurasi, BAB 6</a></li>
<li><a href="../id448798/index.html">Pengujian Python dengan pytest. Menggunakan pytest dengan alat lain, BAB 7</a></li>
<li><a href="../id448800/index.html">Konfigurasikan Visual Studio di seluruh organisasi Anda dengan .vsconfig</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>