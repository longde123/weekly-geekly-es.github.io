<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëæ üåØ üÄÑÔ∏è Bombas de insulina, microchips a prueba de manipulaciones y radio definida por software. üê° üë®üèæ‚Äçüåæ üññüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bomba de insulina de ingenier√≠a inversa para terapia de bricolaje 

 Hace unos tres a√±os, escuch√© sobre un sitio web que ofrec√≠a una recompensa por es...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bombas de insulina, microchips a prueba de manipulaciones y radio definida por software.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450962/">  <i>Bomba de insulina de ingenier√≠a inversa para terapia de bricolaje</i> <br><br>  Hace unos tres a√±os, escuch√© sobre un sitio web que ofrec√≠a una recompensa por estar muy cerca de mi coraz√≥n: comunicaciones de ingenier√≠a inversa con una bomba de insulina.  Ya ayud√© a crear un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sistema</a> para mi hija llamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Loop</a> , con una bomba Medtronic, para lo cual realic√© ingenier√≠a inversa de comunicaciones (Ben West descifr√≥ la mayor parte del protocolo de comunicaci√≥n principal de Medtronic usando el dispositivo USB Carelink, y descubr√≠ las frecuencias de radio e hice un trabajo adicional en protocolo).  Pero la bomba Medtronic necesitaba apagarse durante la gimnasia durante varias horas.  El dise√±o sin c√°mara de esta bomba Omnipod me pareci√≥ interesante y ten√≠a todas las herramientas para trabajar. <br><br>  El sistema Omnipod consiste en una peque√±a bomba de un solo uso llamada m√≥dulo (pod) y una unidad de control (PDM). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/6a8/053/8416a805371c4dd2def86783f903bc24.jpg"></div><br><a name="habracut"></a><br>  Como el PDM se comunica con el m√≥dulo por radio, y el m√≥dulo no tiene una interfaz incorporada, esto significa que est√° completamente controlado por radio.  Existe la posibilidad de una integraci√≥n completa con Loop, utilizando solo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RileyLink</a> o su versi√≥n modificada. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">James Wedding</a> nombr√≥ una recompensa, y atrajo mucha atenci√≥n, y luego a las personas adecuadas que ayudaron en el trabajo. <br><br><h1>  Radio definida por software </h1><br>  SDR es una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramienta excelente</a> .  √âl hace visible el mundo oculto de la radio.  Hay una variedad de tipos de mensajes que se transmiten constantemente en el aire, y estas herramientas le permiten examinar, ver mensajes y, despu√©s de un poco de trabajo, decodificar los peque√±os flashes que ve all√≠.  Si est√° buscando mensajes de un dispositivo espec√≠fico, necesita saber en qu√© √°rea comenzar la b√∫squeda.  Aqu√≠ es donde los documentos p√∫blicos de la FCC son √∫tiles. <br><br>  La documentaci√≥n de la FCC para PDM, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RBV-019</a> , dice que el dispositivo transmite en la banda de 433 MHz.  Despu√©s de configurar el software SDR para escuchar en el rango de 433 MHz, aparecen las siguientes se√±ales al emitir el estado desde PDM: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45b/3a2/f4b/45b3a2f4bc2273bfc3980fe7ce880ddf.png"><br><br>  Como finalmente descubr√≠, estas dos l√≠neas brillantes indican un cierto tipo de modulaci√≥n llamada modulaci√≥n por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desplazamiento de frecuencia</a> , o FSK.  Esto significa que la frecuencia de la se√±al var√≠a seg√∫n la informaci√≥n transmitida.  El bit 1 se env√≠a como una frecuencia m√°s alta (l√≠nea superior) y el 0 se env√≠a con una frecuencia ligeramente m√°s baja (l√≠nea inferior).  Usando la herramienta de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">inspecci√≥n,</a> podemos analizar los datos para reconocer m√°s claramente 1 y 0. Aqu√≠ hay una vista muy ampliada del primer mensaje: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20c/80e/a0d/20c80ea0d16d084da29f5e2afdd76283.png"><br><br>  Escrib√≠ un script de python para extraer estos bits para que podamos verlos como paquetes completos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a9/bbc/f46/4a9bbcf46f710c93c85407fb9c4df813.png"><br><br>  Resulta que este patr√≥n repetitivo es parte del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pre√°mbulo</a> .  Para ahorrar energ√≠a, los receptores a menudo entran en modo de suspensi√≥n y se despiertan peri√≥dicamente para verificar la se√±al.  El transmisor env√≠a el pre√°mbulo el tiempo suficiente para que el receptor lo atrape durante uno de los cortos per√≠odos de escucha.  Cuando el receptor escucha el pre√°mbulo, se despierta hasta que aparecen datos reales. <br><br>  Debe pasar por otra capa antes de obtener los datos del lote real.  No puede enviar sus datos por la radio exactamente de la misma manera que los bits originales, porque el receptor usa transiciones para sincronizar a tiempo cu√°ndo esperar el siguiente bit.  Si tiene un conjunto largo de ceros o unos, entonces el receptor puede no estar sincronizado.  Por lo tanto, las comunicaciones de radio generalmente usan codificaci√≥n para verificar que haya suficientes transiciones.  Las comunicaciones omn√≠podas utilizan la llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">codificaci√≥n Manchester</a> .  Cada bit est√° codificado en dos bits.  1 est√° codificado como 10 y 0 est√° codificado como 01. <br><br>  Tom√≥ mucho tiempo descubrirlo, y hab√≠a muchas teor√≠as en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el canal openomni en Slack</a> mientras <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">intent√°bamos</a> repetir los bits originales.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mark Brighton</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dan Caron</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@larsonlr</a> han logrado cierto √©xito utilizando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFCat</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ti Stick</a> para capturar paquetes.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Evarist Kurgio</a> finalmente escribi√≥ una herramienta llamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rtlomni</a> , utiliza el receptor USB rtl-sdr para escuchar paquetes y decodificarlos, lo que result√≥ ser muy conveniente y m√°s confiable que los m√©todos basados ‚Äã‚Äãen TI Stick. <br><br><h1>  Decodificaci√≥n de paquetes </h1><br>  Habiendo recibido los bits reales, comenzamos a estudiar la estructura del paquete.  En funci√≥n de los bits que cambiaron entre los diferentes m√≥dulos y los diferentes equipos, creamos una estructura que se ve as√≠: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/502/143/9c3/5021439c396b22015da60af09a84516a.png"><br><br><h1>  CRC8 </h1><br>  La radio est√° lejos de ser un medio de transmisi√≥n ideal.  Hay muchas fuentes diferentes de interferencia que hacen que el receptor escuche 1 cuando se env√≠a 0, y viceversa.  Es importante saber cu√°ndo sucedi√≥ esto, por lo que la mayor√≠a de los protocolos usan una suma de verificaci√≥n, a menudo llamada CRC.  El receptor calcula el CRC a medida que se reciben los datos, y el √∫ltimo byte del paquete incluye el CRC calculado por el transmisor.  Si no coinciden, el receptor descarta el paquete y espera la retransmisi√≥n. <br><br>  El protocolo Omnipod utilizaba el CRC est√°ndar de 8 bits.  Cuando lo encontramos, decidimos que est√°bamos muy cerca de entender los mensajes.  Qu√© poco sab√≠amos ... <br><br><h1>  Mensajes, CRC16 </h1><br>  Algunos mensajes son demasiado grandes para caber en un paquete, por lo que se dividen en varios paquetes.  Comenzamos a reconstruir el formato del mensaje y notamos otro conjunto de bits al final de cada mensaje, que parec√≠a un CRC de 16 bits.  Pero fue extra√±o: 5 de 16 bits nunca se configuraron.  Probamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">muchos m√©todos diferentes</a> para descubrir c√≥mo se codifica esto, pero nada funcion√≥. <br><br>  Este fue el primer gran problema: pudimos continuar trabajando en otros bits en los mensajes, pero no ayudar√° mucho entender lo que se est√° enviando, y no podremos generar nuevos paquetes nosotros mismos, por lo que el progreso se ralentiz√≥. <br><br>  Varios meses pasaron casi en vano.  Finalmente, en el invierno de 2016, un miembro del grupo bajo el apodo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">@lorelai</a> inform√≥ que hab√≠a copiado con √©xito el firmware de un chip ARM m√°s grande a PDM y comenz√≥ el tedioso proceso de desmontaje: aceptando instrucciones de CPU y convirti√©ndolas en c√≥digo legible para humanos con variables sem√°nticas y nombres de funciones.  Hizo un trabajo incre√≠ble al descubrir los diversos m√©todos que se utilizaron para transmitir datos. <br><br>  Observ√© una de las rutinas sin t√≠tulo y not√© que parec√≠a una implementaci√≥n est√°ndar del c√°lculo CRC de una tabla.  Y la tabla ten√≠a valores para el CRC est√°ndar de 16 bits.  Escrib√≠ mi propia implementaci√≥n en tablas, y se prob√≥ como un CRC normal.  Luego mir√© cuidadosamente c√≥mo se escribi√≥ la funci√≥n.  Una implementaci√≥n CRC normal se ve as√≠: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (len--) { crc = (crc &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ crctable[((crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ *c++)]; }</code> </pre> <br>  Su implementaci√≥n se ve√≠a as√≠: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (len--) { crc = (crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ crctable[((crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ *c++)]; }</code> </pre> <br>  ¬øNota la diferencia?  Lo que se supon√≠a que era un operador de desplazamiento a la izquierda bit a bit estaba codificado de alguna manera como un desplazamiento a la derecha.  Esto es un error  No hay ninguna raz√≥n para paralizar su propio algoritmo CRC, ya que esto dificulta la identificaci√≥n de mensajes corruptos. <br><br>  Estamos de vuelta en funcionamiento!  Y reanudaron el trabajo de decodificaci√≥n de mensajes, grabando sesiones de PDM para la administraci√≥n de bolos [medicamentos], bases temporales [La tasa basal temporal determina un aumento o disminuci√≥n en la administraci√≥n de insulina - aprox.  carril], suspensi√≥n de archivo, etc. <br><br><h1>  N√∫mero de un solo uso </h1><br>  Todos los equipos de administraci√≥n de insulina ten√≠an una pieza de datos de 4 bytes al comienzo del mensaje, que parec√≠a una forma de criptograf√≠a.  Nuevamente, probamos muchas formas diferentes de interpretarlo y analizarlo en el contexto de los mensajes en los que se envi√≥, pero no era CRC (a veces vimos los mismos 4 bytes incluso en mensajes diferentes).  Y a veces vimos la imagen repetirse.  Parec√≠a, tal vez, como parte de un protocolo para evitar la reproducci√≥n de datos.  En otros protocolos, una funci√≥n similar se llama <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nonce</a> . <br><br>  Una de las opciones que consideramos fue grabar una base de mensajes para reproducir comandos dados.  Incluso si la direcci√≥n de cada m√≥dulo fuera diferente, ahora sab√≠amos c√≥mo generar un CRC, para poder tomar la copia anterior del comando, poner la nueva direcci√≥n en el mensaje y volver a contar el CRC.  Solo este nonce nos impidi√≥ usar esta estrategia.  Independientemente del comando, el m√≥dulo solo acept√≥ el siguiente nonce en la secuencia, y no sab√≠amos c√≥mo generar el siguiente nonce. <br><br>  Pero!  Despu√©s de todo, tenemos un firmware PDM descompilado, ¬°podemos mirar all√≠!  Entonces, estudiamos el firmware PDM, rastreamos la generaci√≥n de mensajes en el c√≥digo y encontramos d√≥nde deber√≠an estar estos cuatro bytes.  Pero en lugar de un m√©todo que calcula algunos nonce criptogr√°ficos, acabamos de encontrar cuatro caracteres <code>INS.</code>  .  ¬øQu√© tonter√≠a?  Bueno, de alguna manera este √°rea de mensajes debe actualizarse m√°s adelante en la tuber√≠a. <br><br>  Hab√≠a otro chip en el PDM, m√°s cerca de la radio.  Era el mismo chip que se utiliz√≥ en los m√≥dulos, con el identificador SC9S08ER48, que no estaba documentado en Internet.  Probablemente se hizo por encargo para el Insulet.  Tal vez podamos eliminar el firmware de este chip.  Desafortunadamente, el chip fue bloqueado, lo que impidi√≥ la copia del firmware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fa/b0d/60c/7fab0d60c765bfaf689f79d4bdf5433a.png"><br><br>  El trabajo se ralentiz√≥ de nuevo ... fue como un verdadero callej√≥n sin salida.  Ponemos todos nuestros esfuerzos mentales en este nonce, y no ten√≠amos ninguna buena pista en las matem√°ticas detr√°s de esto.  Y el chip ER48, que (posiblemente) guardaba secretos, estaba bloqueado, y es dif√≠cil encontrar informaci√≥n p√∫blica que ayude a descifrarlo. <br><br><h1>  Rayos X </h1><br>  Tratando de entender ER48, algunos miembros de la comunidad Slack sugirieron tomar radiograf√≠as.  Fue realmente genial, pero, desafortunadamente, no abri√≥ nuevas oportunidades. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76f/9d7/261/76f9d72614dc261b6a594d099b610514.jpg"><br>  <i><font color="gray">Tiro general</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8b/5ac/86b/d8b5ac86b2c595e0ab03724e22eb58de.jpg"><br>  <i><font color="gray">Tiro detallado</font></i> <br><br><h1>  Autopsia y tiro </h1><br>  Dan Caron decidi√≥ recurrir a un investigador, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dr. Sergey Skorobogatov</a> de la Universidad de Cambridge en el Reino Unido.  Dan ley√≥ que ten√≠a experiencia extrayendo c√≥digo de chips bloqueados, y lo convenci√≥ de echar un vistazo a nuestro problema.  El Dr. Skorobogatov realiz√≥ una investigaci√≥n en el campo del uso de SEM (microscopio electr√≥nico de barrido) para la ingenier√≠a inversa de microcircuitos.  Sugiri√≥ que es posible, pero ser√° costoso, requerir√° equipo costoso y no garantiza un resultado.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Joe Moran</a> , quien recientemente comenz√≥ a usar Loop despu√©s de que nos conocimos en el hackathon Nightscout en el oto√±o de 2016, acept√≥ ayudar con el proyecto.  Estuvo de acuerdo con una empresa de Silicon Valley, Nanolab Technologies, para abrir y fotografiar los chips, y tambi√©n financi√≥ amablemente el trabajo de Nanolab y el Dr. Skorobogatov (as√≠ como sus m√≥dulos personales). <br><br>  El Dr. Skorobogatov le pidi√≥ a Nanolab que aplicara varias t√©cnicas de imagen para descubrir si es posible romper la protecci√≥n con m√©todos conocidos no invasivos o semi-invasivos.  Como resultado, aparecieron muchas im√°genes, algunas de ellas muy hermosas.  Estas son im√°genes microsc√≥picas √≥pticas de una matriz de silicio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/031/21e/bfb/03121ebfb9b91c9b4b68c71664df2869.jpg"><br>  <i><font color="gray">Vista general del microcircuito bajo un microscopio √≥ptico.</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9a/131/5b7/d9a1315b7eb9403fd06e38b06229f01d.jpg"><br>  <i><font color="gray">Vista general del microcircuito bajo un microscopio √≥ptico.</font></i> <br><br>  Tambi√©n se tomaron im√°genes de √°reas espec√≠ficas de la matriz usando un microscopio electr√≥nico de barrido.  Con diferentes voltajes, diferentes preparaciones de superficie y diferentes equipos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/e7a/1b0/d3ae7a1b0d68eb0bd0400c56eecad6fa.jpg"><br>  <i><font color="gray">Imagen SEM de c√©lulas flash.</font></i>  <i><font color="gray">No muestra datos</font></i> <br><br>  Desafortunadamente, ninguna de estas im√°genes mostr√≥ el contenido real de la memoria flash. <br><br>  El Dr. Skorobogatov ten√≠a un √∫ltimo m√©todo, que puede usarse solo en caso de falla.  Este era un m√©todo patentado, cuyo uso ten√≠a que obtener el permiso de la universidad.  El Dr. Skorobogatov hizo la prueba inicial y confirm√≥ que pod√≠a leer datos en este chip.  Pero antes de continuar, era necesario firmar el NDA y, por lo tanto, se llevaron a cabo negociaciones sobre qui√©n recibir√≠a el contenido del firmware extra√≠do. <br><br>  Finalmente, la NDA firm√≥ la fundaci√≥n Nightscout y se responsabiliz√≥ por evitar la divulgaci√≥n no autorizada de m√©todos y resultados de extracci√≥n de memoria. <br><br>  El resultado de este acuerdo y trabajo fue <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un art√≠culo incre√≠ble</a> escrito por el Dr. Sergei Skorobogatov, as√≠ como el c√≥digo de firmware.  Desde la primera vez hubo bastantes errores en el c√≥digo, pero esto fue suficiente para comenzar.  En el Nightscout Spring Hackathon, Joe recurri√≥ a los chicos si a alguien le gustar√≠a desmontarlo.  Nadie levant√≥ las manos.  Convertir las instrucciones del procesador en algo comprensible es un trabajo arduo, y muy pocas personas saben c√≥mo hacerlo.  Trat√© de profundizar en el ensamblador utilizando la documentaci√≥n de la CPU, pero logr√© muy poco y me decepcion√≥.  Otros pidieron optimistamente el c√≥digo del firmware con expectativas de progreso r√°pido, luego se dieron cuenta de la escala y la complejidad de la tarea, y se cayeron en silencio. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b4/ab1/8f8/5b4ab18f82c273633dab9f193d69d331.png"><br>  <i><font color="gray">Ejemplo de desmontaje de instrucciones SC908</font></i> <br><br>  Resulta que Joe tambi√©n ten√≠a una amplia experiencia trabajando con ensamblador, y comenz√≥ a llevar a cabo esta dif√≠cil tarea.  En julio, el Dr. Skorobogatov complet√≥ una segunda operaci√≥n de extracci√≥n de memoria con muchos menos errores.  Durante el verano, Joe Moran trabaj√≥ incansablemente para mostrar una gran cantidad de instrucciones de procesador e integrarlas gradualmente en la imagen general del pseudoc√≥digo del m√≥dulo. <br><br>  Al final, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ken Shirriff</a> , un experto en ingenier√≠a inversa de hardware, se uni√≥ a nosotros y aceler√≥ enormemente el proceso.  Juntos, Joe y Ken terminaron traduciendo suficiente c√≥digo para encontrar una funci√≥n que codifique nonce.  Esto sucedi√≥ en septiembre de 2017. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d93/1d5/a00/d931d5a000713fdefa9f865744a5b6a2.gif"></div><br><br><h1>  RileyLink y Loop </h1><br>  Actualizamos los scripts Python de openomni, pero ahora es el momento de centrarse en RileyLink + iOS, as√≠ que comenc√© a trabajar en OmniKit y actualizaciones de firmware para RileyLink.  Cre√≠a que ten√≠amos los conceptos b√°sicos del protocolo, y el resto eran solo detalles.  Nuevamente, subestimando por completo cu√°nto est√° por venir. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f5/710/6d8/4f57106d8931a3e2b5f01e2a8fd8f9db.jpg"><br><br>  Tuve que escribir un nuevo firmware que maneje la modulaci√≥n y la codificaci√≥n del m√≥dulo.  Tambi√©n tuve que reescribir c√≥mo dos chips en RL se comunican entre s√≠ para procesar ceros, ya que en Medtronic los ceros eran el final especial del marcador de paquetes.  Gran parte de Loop tuvo que ser redise√±ado para admitir m√∫ltiples bombas, as√≠ como nuevas interfaces para admitir emparejamiento, desactivaci√≥n y manejo de errores.  Afortunadamente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Nate Racklift</a> puso una base s√≥lida en Loop para hacer que todo esto sea posible. <br><br>  Mientras tanto, el trabajo continu√≥ para comprender el formato de los equipos.  Todo fue cuidadosamente documentado en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki de openomni</a> , la documentaci√≥n m√°s completa del protocolo.  Joe, Evarist y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Elke J√§ger</a> han hecho un gran trabajo a lo largo del tiempo decodificando mensajes y actualizando p√°ginas.  Varios miembros del canal Slack han contribuido a la captura de paquetes PDM y al m√≥dulo para ayudar a los esfuerzos generales de decodificaci√≥n. <br><br>  La decodificaci√≥n fue un trabajo divertido, con muchas peque√±as victorias, ya que cada componente de cada equipo se descifra, y realmente me gust√≥ trabajar en esta parte, agregando gradualmente c√≥digo a Loop.  En abril de 2018, compart√≠ en Slack que hice "la canulaci√≥n primaria emparejada a trav√©s de iPhone + RL de acuerdo con el programa basal programado, y luego 5 unidades se enfermaron". <br><br>  El firmware RL 2.0 se complet√≥ en julio de 2018 y ya se han enviado nuevas entregas.  Se esperaba que estas placas pudieran usarse con Loop y Omnipod, pero la antena existente de 915 MHz era demasiado mala para funcionar de manera efectiva a 433 MHz. <br><br>  La decodificaci√≥n y la implementaci√≥n han progresado significativamente durante el verano, y Loop se acerca gradualmente al rendimiento.  Joe hizo lo maravilloso al darme fondos, as√≠ que dej√© mi trabajo diario y me concentr√© en este proyecto, y finalmente me un√≠ al maravilloso equipo de Tidepool.  Por supuesto, en el campo del bricolaje y la regulaci√≥n legislativa de equipos m√©dicos hubo m√°s eventos que no cubrir√©, ¬°pero fue un verano muy interesante! <br><br><h1>  Screamers </h1><br>  Cuando aparecieron m√°s funciones en el controlador, lo conect√© a Loop, activando la capacidad de configurar autom√°ticamente la entrega a tiempo.  En esta etapa, a menudo se obten√≠an m√≥dulos "llamativos" cuando algunas de las comprobaciones internas del m√≥dulo encontraron un problema y √©l dej√≥ de administrar insulina. <br><br>  Pero esto parec√≠a ser un problema solucionable, ya que continuamos encontrando peque√±as discrepancias en los paquetes Loop y el PDM original al enviar comandos manualmente, y suger√≠ que si los solucion√°bamos todos, los "gritos" se detendr√≠an. <br><br><h1>  Work Loop! </h1><br>  El 3 de octubre de 2018, Joe se puso el m√≥dulo administrado Loop y se convirti√≥ en el primer usuario de Loop Omnipod, aunque no me lo dijo de inmediato porque sab√≠a que estar√≠a preocupado.  Cuando me lo dijo, todav√≠a estaba preocupado.  Vimos c√≥mo funcionaba el m√≥dulo y entendimos la funcionalidad, y el algoritmo b√°sico se prob√≥ durante mucho tiempo, pero a√∫n as√≠ ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c74/adc/6ec/c74adc6ecee823d919dbf3162b120e5c.png"><br><br>  Un mes despu√©s, en el hackathon de Nightscout en noviembre de 2018, varios aventureros m√°s decidieron probarlo por s√≠ mismos, y tambi√©n se convirtieron en parte de un peque√±o grupo de prueba cerrado que crecer√° a m√°s de 30 personas antes de que se publique el c√≥digo. <br><br>  Desafortunadamente, todav√≠a encontramos "gritos" de m√≥dulos, que a menudo ocurren antes de completar los tres d√≠as completos de uso, y comparamos cuidadosamente los comandos Loop con muestras de PDM.  En este proceso, Elke fue especialmente √∫til: escribi√≥ un script para verificar autom√°ticamente los comandos con versiones originales.  Comenc√© a preocuparme de que el funcionamiento intermitente de los m√≥dulos fuera causado por el aumento de los requisitos de bater√≠a para las comunicaciones cada cinco minutos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e92/90b/39b/e9290b39bd5057064ebaf3dfed0e8980.png"><br>  <i><font color="gray">Grifos del regulador de voltaje en el m√≥dulo, perforados a trav√©s del pl√°stico del panel posterior, en superpegamento</font></i> <br><br>  Por lo tanto, comenc√© a medir el voltaje de suministro del m√≥dulo usando Arduino, escribir datos y guardarlos en una base de datos local para su visualizaci√≥n.  Compar√© PDM y Loop. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/701/02d/d09/70102dd0984ee469ff50a75f4912f8bc.png"><br>  <i><font color="gray">Cambio a largo plazo en la tensi√≥n de alimentaci√≥n del m√≥dulo.</font></i> <br><br>  Desafortunadamente, esto tambi√©n result√≥ ser un callej√≥n sin salida;  usando PDM e inyectando una gran cantidad de insulina, pude llevar el m√≥dulo a un voltaje m√°s bajo que durante toda la vida √∫til del m√≥dulo Loop, y no pude hacer que el m√≥dulo "gritara".  Parec√≠a que el estr√©s no era un problema, debe haber algo m√°s. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc6/4bc/e44/fc64bce4473247b8d55f69a3d2bcab58.jpg"><br>  <i><font color="gray">RileyLinks con antenas de bobina de 955 MHz (izquierda) y 433 MHz (derecha)</font></i> <br><br>  En alg√∫n momento, not√© que si fallaba el intercambio de mensajes con el m√≥dulo, el m√≥dulo a veces segu√≠a intentando finalizar el intercambio volviendo a enviar paquetes una y otra vez.  Los registros de los probadores tambi√©n mostraron muchos problemas t√©cnicos, as√≠ que comenc√© a experimentar con antenas.  Ambos problemas deben estar relacionados con la calidad de la comunicaci√≥n.  Planeaba probar diferentes antenas y las orden√© en diferentes lugares de Internet, pero no tuve tiempo de probarlas hasta que esto se convirti√≥ en una prioridad. <br><br>  Ten√≠a varias antenas flexibles de 433 MHz que se pueden conectar al interior del gabinete RL.  A menudo muestran un mejor rendimiento en algunos escenarios, pero no en otros;  Demasiado poco confiable.  Cuando llegu√© al carrete, mostr√≥ un buen rendimiento de manera muy consistente y en rangos muy sorprendentes.  Es hora de presentar un nuevo caso para RileyLink. <br><br>  Con una nueva antena y algunas optimizaciones que redujeron la mensajer√≠a mientras se realizaban ajustes cada 5 minutos, los gritos se volvieron muy raros.  Probablemente comparable al uso habitual de m√≥dulos con PDM.  En las √∫ltimas 7.500 horas de pruebas en tiempo real, el 94% de los m√≥dulos se completaron sin fallas. <br><br><h1>  Pruebas y documentaci√≥n. </h1><br>  El grupo de pruebas creci√≥ lentamente: los nuevos usuarios se unieron constantemente al sistema, quienes con una nueva mirada podr√≠an evaluar qu√© partes parecen confusas.  Estos probadores soportaron muchos m√≥dulos llamativos e hicieron una gran contribuci√≥n para mejorar el rendimiento de Loop con Omnipod.  B√°sicamente, enviaron informes de problemas y registros de trabajo. <br><br>  Estos informes tienen un registro de mensajes que pueden analizarse utilizando una herramienta hecha por Elke.  Da una idea si obtenemos comandos distorsionados, y tambi√©n le permite recopilar estad√≠sticas sobre ciertas partes de la interacci√≥n de Loop con los m√≥dulos. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Marion Barker se</a> uni√≥ al grupo de pruebas y agreg√≥ informes especiales y estad√≠sticas adicionales sobre el progreso de las pruebas, y pudimos usar sus estad√≠sticas de m√≥dulos exitosos contra fallas para tener una idea del progreso de alto nivel. <br><br>  Al final, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Katie DiSimone se</a> uni√≥ al grupo de prueba.  Comenz√≥ una importante reestructuraci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">loopdocs.org</a> con documentaci√≥n sobre el uso de Loop con m√∫ltiples dispositivos.  La espera de la versi√≥n de Loop que funcion√≥ con Omnipod fue incre√≠blemente alta, y sin una buena documentaci√≥n estaba claro que nos ver√≠amos abrumados con las mismas preguntas. <br><br><h1>  Nuevas caracter√≠sticas de bucle </h1><br>  La integraci√≥n con Omnipod requiri√≥ un replanteamiento de algunos de los elementos de la interfaz y la adici√≥n de nuevos controles.  El m√≥dulo no informa la bater√≠a, y el usuario puede hacer poco con una carga baja si esto sucede, por lo que mostrar el widget de nivel de bater√≠a no tiene sentido.  Adem√°s, sin una interfaz de usuario en la bomba, el usuario deber√≠a poder cancelar r√°pidamente el bolo.  El icono del tanque representaba el tanque Medtronic, por lo que quer√≠amos rehacerlo.  Gracias a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Paul Forgione</a> por desarrollar el logotipo del m√≥dulo, que ahora muestra el nivel del tanque. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ed/2ff/020/0ed2ff02079b5cbaf6606c21467577ee.png"><br><br><h1>  Agradecimientos </h1><br>  Gracias a todas las personas que nos ayudaron a recorrer este largo camino para que nos demos cuenta de la meta que establecimos hace mucho tiempo.  S√© que no mencion√© todos los eventos involucrados y no todos.  Esto no es posible en un art√≠culo, y solo tengo experiencia personal.  Es dif√≠cil imaginar cu√°ntas horas tard√≥.  Si los agrega todos juntos, estoy seguro de que es una cifra impactante.  Sin mencionar el trabajo en la creaci√≥n del Omnipod en s√≠, que, me parece, eclipsa todos estos esfuerzos.  As√≠ que gracias a todos.  Adem√°s, muchas de estas horas se habr√≠an pasado con las familias.  Realmente aprecio la comprensi√≥n de mi esposa e hijos por el tiempo que pas√© en eso, y tambi√©n quiero agradecerles. <br><br><h1>  Notas </h1><br>  Debo mencionar a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Joachim Ornstedt</a> como uno de los contribuyentes a la decodificaci√≥n de openomni, as√≠ como el creador de probablemente la primera integraci√≥n con omnipod.  Construy√≥ un dispositivo que utilizaba el reconocimiento √≥ptico de caracteres (OCR) para extraer datos del PDM, y conect√≥ los botones num√©ricos al PDM f√≠sico a trav√©s de otro microcontrolador.  Este enfoque es dif√≠cil de escalar, pero es muy inteligente y evita muchos de los problemas que tuvimos que enfrentar con una soluci√≥n basada en RE.  Realmente admiro c√≥mo lidi√≥ con el problema y configur√≥ el trabajo durante una peque√±a fracci√≥n del tiempo que tard√≥ en hacer que el dispositivo funcione con Loop. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450962/">https://habr.com/ru/post/450962/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450948/index.html">MU-MIMO: uno de los algoritmos de implementaci√≥n</a></li>
<li><a href="../450950/index.html">Conceptos b√°sicos de Dart Streams</a></li>
<li><a href="../450952/index.html">√çndice medio y Antibank</a></li>
<li><a href="../450954/index.html">C√≥mo aprendimos a explotar Java en Docker</a></li>
<li><a href="../450958/index.html">AnyStub, biblioteca de stub de conexi√≥n Java</a></li>
<li><a href="../450964/index.html">Nueva biblioteca intr√≠nseca x86 SIMD - depuraci√≥n de immintrin</a></li>
<li><a href="../450966/index.html">Grabar video de una computadora vieja - m√©todos de LGR</a></li>
<li><a href="../450970/index.html">C√≥mo comparar realmente los precios de Apple en los Estados Unidos y Rusia. Experiencia personal</a></li>
<li><a href="../450972/index.html">¬øC√≥mo organizar un estudio fotogr√°fico? Caso de Bolshakova Studio</a></li>
<li><a href="../450974/index.html">Xiaomi Sleep Tracker - Revisi√≥n de Sleepace Sleep Dot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>