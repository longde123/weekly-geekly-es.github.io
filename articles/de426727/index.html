<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè™ üê© üßú EME? Cdm? DRM? CENC? IDK! Was Sie brauchen, um Ihren eigenen Video-Player in einem Browser zu erstellen ü§∂üèº üë®üèº‚Äçüîß üë®‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was bedeuten all diese Abk√ºrzungen? Was braucht es, um einen Open-Source-Player zu entwickeln, mit dem Sie Videos von Amazon, Sky und anderen Plattfor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>EME? Cdm? DRM? CENC? IDK! Was Sie brauchen, um Ihren eigenen Video-Player in einem Browser zu erstellen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/426727/"> Was bedeuten all diese Abk√ºrzungen?  Was braucht es, um einen Open-Source-Player zu entwickeln, mit dem Sie Videos von Amazon, Sky und anderen Plattformen und Videos von einem beliebigen Anbieter ansehen k√∂nnen?  Sebastian Golasch sprach auf der HolyJS 2018 Piter-Konferenz dar√ºber, wie der Video-Streaming-Prozess abl√§uft.  Unter dem Schnitt - Video und √úbersetzung seines Berichts. <br><br><img src="https://habrastorage.org/webt/et/to/7c/etto7cv1khykp68gwreip_8rfy4.jpeg"><br><br>  <i>Sebastian Golasch ist derzeit Entwickler bei der Deutschen Telekom.</i>  <i>Er arbeitete lange Zeit mit Java und PHP und wechselte dann zu JS, Python und Rust.</i>  <i>Seit sieben Jahren arbeitet er an der propriet√§ren Qivicon Smart Home-Plattform.</i> <br><br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3Y3R_snaDDc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h2>  Ein bisschen √ºber die Geschichte des Video-Streamings </h2><br>  Schauen wir uns zun√§chst die Geschichte des Webs an, da wir in 25 Jahren von QuickTime zu Netflix gewechselt sind.  Alles begann in den 90er Jahren, als Apple QuickTime erfand.  Die Nutzung im Internet begann 1993-1994.  Zu diesem Zeitpunkt konnte der Player Videos mit einer Aufl√∂sung von 156 √ó 116 Pixel und einer Frequenz von 10 FPS ohne Hardwarebeschleunigung abspielen (wobei nur Prozessorressourcen verwendet wurden).  Dieses Format konzentrierte sich auf eine 9600-Baud-DF√ú-Verbindung - 9600 Bit / s, einschlie√ülich Overhead-Informationen. <br><br>  Es war die Zeit des Netscape-Browsers.  Das Video im Browser sah nicht besonders gut aus, da es nicht im Web enthalten war.  F√ºr die Wiedergabe verwendeten wir externe Software (dieselbe QuickTime) mit einer eigenen Oberfl√§che, die im Browser mithilfe des Einbettungs-Tags visualisiert wurde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/664/455/137/664455137979de92508841f0d3ceaafa.png"><br><br>  Die Situation wurde etwas besser, als Macromedia den Shockwave Player ver√∂ffentlichte (nach der √úbernahme von Macromedia durch Adobe wurde er als Adobe Flash Player bekannt).  Die erste Version von Shockwave Player wurde 1997 ver√∂ffentlicht, die Videowiedergabe wurde jedoch erst 2002 ver√∂ffentlicht. <br><br>  Sie verwendeten den Sorenson Spark alias H.263-Codec.  Es wurde f√ºr kleine Aufl√∂sungen und kleine Dateigr√∂√üen optimiert.  Was bedeutet das?  Ein 43-Sekunden-Video, mit dem der Shockwave Player getestet wurde, wog beispielsweise nur 560 KB.  Nat√ºrlich w√§re es nicht sehr angenehm, einen Film in dieser Qualit√§t zu sehen, aber die Technologie selbst war f√ºr diese Zeit interessant.  Wie im Fall von QuickTime war jedoch zus√§tzliche Software erforderlich, damit der Shockwave Player im Browser funktioniert.  Dieser Player hatte viele Sicherheitsprobleme, aber das Wichtigste ist, dass das Video immer noch ein Browser-Add-On war. <br><br>  2007 ver√∂ffentlichte Microsoft Silverlight, das etwas an Flash erinnert.  Wir werden nicht tief graben, aber alle diese L√∂sungen hatten etwas gemeinsam - eine Black Box.  Alle Spieler arbeiteten als Browser-Add-On, und Sie hatten keine Ahnung, was im Inneren vor sich ging. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84b/418/52e/84b41852efd2fb39dbea144b2e898dfe.png"><br><br>
<h2>  &lt; <code>Video/</code> &gt; Element </h2><br>  2007 schlug Opera vor, das &lt; <code>Video/</code> &gt; -Tag zu verwenden, dh native Videos in einem Browser zu erstellen.  Wir benutzen es heute.  Es ist einfach und bequem und jedes Video kann nicht nur angezeigt, sondern auch heruntergeladen werden.  Und selbst wenn wir das Herunterladen von Videos nicht zulassen m√∂chten, k√∂nnen wir das Herunterladen in den Browser nicht verbieten.  Das Maximum besteht darin, das Herunterladen von Videos zu erschweren. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cac/3be/693/cac3be693c7a3328062521d828c12c38.png"><br><br>  Das <code>&lt;Video/&gt;</code> ist das genaue Gegenteil der Black Box, und das Anzeigen des Quellcodes ist sehr einfach. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca1/f23/708/ca1f237081ed5a6a9e648b65e05ea7a1.png"><br><br><h2>  DRM </h2><br>  Sie k√∂nnen jedoch nicht einfach mit der rechten Maustaste auf ein Video auf Netflix klicken und "Speichern unter" ausw√§hlen.  Der Grund daf√ºr ist DRM (Digital Restrictions Management).  Dies ist keine einzelne Technologie oder Anwendung, die eine Aufgabe ausf√ºhrt.  Dies ist ein allgemeiner Begriff f√ºr Konzepte wie: <br><br><ul><li>  Authentifizierung und Benutzerverschl√ºsselung </li><li>  Inhaltsbasierte Verschl√ºsselung </li><li>  Definition von Rechten und Anwendung von Beschr√§nkungen </li><li>  Feedback und Update </li><li>  Ausgangssteuerung und Verbindungsschutz </li><li>  Untersuchung und Verfolgung von Eindringlingen </li><li>  Schl√ºssel- und Lizenzverwaltung </li></ul><br>  Um zu verstehen, was DRM ist, m√ºssen wir sein √ñkosystem untersuchen, dh herausfinden, welche Unternehmen beteiligt sind.  Das: <br><br><ul><li>  <b>Inhaltseigent√ºmer</b> stehen an der Spitze des √ñkosystems.  Zum Beispiel Disney, MGM oder FIFA.  Diese Unternehmen produzieren Inhalte und haben Rechte daran. </li><li>  <b>DRM-Kerne</b> sind Unternehmen, die DRM-Technologie anbieten (z. B. Google, Apple, Microsoft usw.). Derzeit gibt es etwa 7-8 DRM-Technologien von verschiedenen Unternehmen. </li><li>  <b>Dienstanbieter</b> - Entwickeln Sie eine Serversoftware, die Videos verschl√ºsselt. </li><li>  <b>Browser</b> , die tats√§chlich Spieler sind. </li><li>  <b>Inhaltsanbieter</b> sind Unternehmen wie Netflix, Amazon, Sky usw. In der Regel besitzen sie keine Rechte an den Inhalten, sie lizenzieren und vertreiben sie. </li><li>  <b>Chip- / Ger√§tehersteller</b> sind ebenfalls am √ñkosystem beteiligt, da DRM nicht nur Softwaretechnologie ist.  Einige Unternehmen (haupts√§chlich Chinesen) entwickeln Chips, die Videos codieren und decodieren. </li></ul><br>  Haben Sie sich jemals gefragt, warum ein Video auf Netflix in einem Browser nicht √ºber eine sehr hohe Aufl√∂sung (SD) verf√ºgt? Wenn Sie jedoch dasselbe Video auf einer Apple TV- oder Android TV-Box ansehen, wird derselbe Inhalt in Full HD oder in abgespielt 4K?  Daf√ºr ist auch DRM verantwortlich.  Tatsache ist, dass Hersteller immer Angst haben, dass Piraten Inhalte stehlen.  Je weniger sicher die Umgebung ist, in der die Videodecodierung durchgef√ºhrt wird, desto schlechter ist die Qualit√§t, die dem Benutzer angezeigt wird.  Wenn die Dekodierung beispielsweise programmgesteuert durchgef√ºhrt wird (z. B. in Chrome oder Firefox), wird das Video in der schlechtesten Qualit√§t angezeigt.  In einer Umgebung, in der Hardwarefunktionen zum Decodieren verwendet werden (z. B. wenn Android eine GPU verwendet), sind die M√∂glichkeiten des illegalen Kopierens von Inhalten geringer, und hier ist die Wiedergabequalit√§t h√∂her.  Die sicherste Umgebung ist schlie√ülich die vollst√§ndige Hardware (Apple TV oder Android TV Box), in der die Dekodierung und Wiedergabe ohne Einbeziehung der Software durchgef√ºhrt wird. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f9/4fb/1bb/9f94fb1bb7c1fa9d31a02d2bf62950f0.png"><br><br>  Wenn wir jedoch √ºber Browser sprechen, wird die Dekodierung in diesen fast immer von der Software durchgef√ºhrt.  Unterschiedliche Browser verwenden unterschiedliche Systeme f√ºr DRM.  Chrome und Firefox verwenden Widevine.  Dieses Unternehmen geh√∂rt Google und lizenziert seine DRM-Anwendungen.  Zum Dekodieren l√§dt Firefox daher die DRM-Bibliothek von Google herunter.  Im Browser k√∂nnen Sie sehen, woher der Download kommt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca9/49d/015/ca949d015734b50c36e8594b8f5a4370.png"><br><br>  Apple verwendet ein eigenes FairPlay-System, das bereits bei der Einf√ºhrung des ersten iPhone und iPad entwickelt wurde.  Microsoft verwendet auch eine eigene Entwicklung namens PlayReady, die direkt in Windows integriert ist.  In anderen F√§llen wird Widevine am h√§ufigsten verwendet.  Dieses System existiert sowohl als Anwendung als auch als Hardwarel√∂sung - Chips, die Videos dekodieren. <br><br><h2>  Cdm </h2><br>  Die Abk√ºrzung CDM steht f√ºr Content Decryption Module.  Dies ist eine Software oder Hardware, die auf verschiedene Arten funktionieren kann: <br><br><ul><li>  Entschl√ºsseln Sie das Video und rendern Sie es anschlie√üend im Browser mit dem Tag &lt;Video /&gt;. </li><li>  Entschl√ºsseln und dekodieren Sie das Video und √ºbertragen Sie dann die Rohbilder des Videos zur Wiedergabe an den Browser. </li><li>  Entschl√ºsseln und dekodieren Sie das Video und √ºbertragen Sie dann die Rohbilder des Videos zur Wiedergabe mit der GPU. </li></ul><br>  Trotz der Unterst√ºtzung der GPU wird die zweite Option am h√§ufigsten verwendet (zumindest bei Chrome und Firefox). <br><br><h2>  Dekodieren und Dekodieren von Ebenen im Browser </h2><br>  Wie funktioniert das alles zusammen?  Um dies zu verstehen, sehen Sie sich die Dekodierungs- und Entschl√ºsselungsebenen im Browser an.  Sie sind unterteilt in: <br><br><ul><li>  JavaScript-Anwendung - teilt dem Computer mit, welches Video ich ansehen werde. </li><li>  Ein Browser ist ein Player, der Videoinhalte wiedergibt. </li><li>  Modul zur Entschl√ºsselung von Inhalten. </li><li>  Bei der Verwaltung digitaler Rechte dreht sich alles um die Videodekodierung (ich k√∂nnte mir keine bessere Notation einfallen lassen, also habe ich es so genannt). </li><li>  Vertrauensw√ºrdige Laufzeit. </li><li>  In diesem Fall sind die ersten beiden Komponenten ein DRM-Player, das Inhaltsentschl√ºsselungsmodul ist ein DRM-Client und die letzten beiden Komponenten sind der DRM-Kern. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b2b/7da/87b/b2b7da87bf7b3b92ef4004f4d4b97800.png"><br><br>  Was passiert, wenn Sie ein Video in einem Browser abspielen, sehen Sie im Bild unten.  Sie ist nat√ºrlich etwas verwirrend: Es gibt viele Pfeile und Farben.  Ich werde es Schritt f√ºr Schritt durchgehen und reale F√§lle verwenden, um es klarer zu machen <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1e/982/bb7/b1e982bb7fe74fa39f08b00264987409.png"><br><br>  Wir werden Netflix als Beispiel verwenden.  Ich habe eine Debugging-App geschrieben. <br><br>  Ich begann damit, wo, glaube ich, jeder von Ihnen anfangen w√ºrde: Ich habe mir die Anfragen angesehen, die Netflix beim Starten eines Videos stellt, und ich habe eine gro√üe Anzahl von Aufnahmen gesehen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b04/913/8d7/b049138d7a4da37f5b9b6c5e4da88bf3.png"><br><br>  Wenn Sie jedoch nur diejenigen belassen, die f√ºr die Wiedergabe des Videos wirklich ben√∂tigt werden, stellt sich heraus, dass es nur drei davon gibt: Manifest, Lizenz und das erste Fragment des Videos. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/381/e12/a9f/381e12a9f194014ae19501e4e9ada763.png"><br><br>  Der Netflix-Player ist in JavaScript geschrieben und enth√§lt √ºber 76.000 Codezeilen. Nat√ºrlich kann ich ihn nicht vollst√§ndig analysieren.  Ich m√∂chte jedoch die Hauptteile zeigen, die f√ºr die Wiedergabe gesch√ºtzter Videos erforderlich sind. <br><br>  Wir beginnen mit der Vorlage: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ba/205/e6f/9ba205e6f022e4a99ffa373372c99047.png"><br><br><h2>  EME </h2><br>  Bevor wir uns jedoch mit den Funktionen befassen, m√ºssen wir uns mit einer anderen Technologie vertraut machen - EME (Encrypted Media Extensions, Encrypted Media Extensions).  Diese Technologie f√ºhrt keine Entschl√ºsselung und Entschl√ºsselung durch, sondern ist nur eine Browser-API.  EME dient als Schnittstelle f√ºr CDM, f√ºr KeySystem, f√ºr einen Server mit einer Lizenz und f√ºr einen Server, auf dem Inhalte gespeichert sind. <br><br>  Beginnen wir also mit getKeySystemConfig. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e68/179/765/e68179765d8d942b41efd0a05fb51cd4.png"><br><br>  Es sollte bedacht werden, dass es vom Anbieter abh√§ngt, so dass die Konfiguration, die ich hier pr√§sentiere, f√ºr Netflix funktioniert, aber beispielsweise nicht f√ºr Amazon. <br><br>  In dieser Konfiguration m√ºssen wir dem Backend-System mitteilen, welche vertrauensw√ºrdige Laufzeitstufe wir anbieten k√∂nnen.  Dies kann eine sichere Hardware-Dekodierung oder eine sichere Software-Dekodierung sein.  Das hei√üt, wir teilen dem System mit, welche Hardware und Software f√ºr die Wiedergabe verwendet wird.  Und das bestimmt die Qualit√§t des Inhalts. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0f/071/1dd/c0f0711ddf9da278d6ab4c23ff31f75c.png"><br><br>  Schauen Sie sich nach der Konfiguration die Konfiguration an, um ein erstes MediaKeySystem zu erstellen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99a/62b/ccb/99a62bccbf59fc6c893db5b34b3e3c91.png"><br><br>  Hier beginnt die Interaktion mit dem Modul zur Inhaltsentschl√ºsselung.  Sie m√ºssen der API mitteilen, welches DRM-System und welches KeySystem wir verwenden.  In unserem Fall ist dies Widevine. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e31/ff8/416/e31ff841688a7f78547c02723c31c11c.png"><br><br>  Der n√§chste Schritt ist f√ºr alle Systeme optional, f√ºr Netflix jedoch erforderlich.  Auch hier h√§ngt seine Notwendigkeit vom Anbieter ab.  Wir m√ºssen ein Serverzertifikat auf unsere mediaKeys anwenden.  Serverzertifikate sind einfacher Text in einer Netflix Cadmium.js-Datei, der leicht kopiert werden kann.  Und wenn wir es auf mediaKeys anwenden, wird die gesamte Kommunikation zwischen dem Server mit der Lizenz und unserem Browser dank der Verwendung dieses Zertifikats sicher. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3c/601/dd1/d3c601dd109f2a67e84efe69ca76ba6a.png"><br><br>  Wenn dies erledigt ist, m√ºssen wir uns dem urspr√ºnglichen Element des Videos zuwenden und sagen: ‚ÄûOk, dies ist das Schl√ºsselsystem, das wir verwenden m√∂chten, und dies ist das Hallo-Video-Tag.  Lass uns dich vereinen. ‚Äú <br><br><img src="https://habrastorage.org/getpro/habr/post_images/797/6cf/3ce/7976cf3ce8dacf000547d40084d16d22.png"><br><br>  Und hier ist die letzte Funktion, die Sie zum Konfigurieren des Videosystems ben√∂tigen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/107/ce0/fa0/107ce0fa0c047fd77218983652e0aa89.png"><br><br>  Dies ist eine DRM-Sitzung oder MediaKeySession.  Dies sind nur die Daten, die vom Anbieter an das Entschl√ºsselungsmodul gesendet werden, das die Anforderungen mit ihnen signiert.  Diese Daten sind auch einfacher Text, der hinter mehreren Funktionen in der Netflix-Player-Datei verborgen ist, von wo ich sie kopiert habe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed7/3a4/0a3/ed73a40a370d7744f55590fc9e23efa5.png"><br><br>  Wenn wir create.Session f√ºr das mediaKeys-Objekt aufrufen, m√ºssen wir angeben, welches Video wir unterst√ºtzen.  In diesem Fall ist es mp4.  Dies bringt uns zur√ºck zum Messaging-Kontext mit unserem CDM-System.  Wir ben√∂tigen auch Netflix, um das Base64-Serverzertifikat in jedem Formular anzuwenden, aber all diese Konfigurationen in der Erstellungssitzung werden wiederum abh√§ngig vom DRM-System bereitgestellt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b24/8ff/e27/b248ffe2709055f4eadc33eab77df455.png"><br><br>  Die letzte Funktion hier unten - keySession.generateRequest erstellt eine Lizenzanforderung im Hintergrund.  Oder CDM erstellt im Hintergrund eine Lizenzanforderung.  Mit anderen Worten, dies sind bin√§re Rohdaten, die wir an den lizenzierten Server senden m√ºssen, um im Gegenzug eine g√ºltige Lizenz zu erhalten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/43c/798/16e/43c79816e9006b0668d58555887017b7.png"><br><br>  Hier ist cenc von Interesse.  Es ist ein ISO-Verschl√ºsselungsstandard, der ein Sicherheitsschema f√ºr MP3-Videos definiert.  In WebM wird dies anders aufgerufen, aber die Funktion f√ºhrt dieselbe aus. <br><br>  handleMessage ist die von uns konfigurierte EventListener-Schnittstelle.  Wenn dieses Ereignis durch das Nachrichtenereignis in keySession ausgel√∂st wird, wissen wir, dass wir bereit sind, eine Lizenz vom Server zu erhalten. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ef/93b/e85/4ef93be85d1d8535408a1abed9ca9ec6.png"><br><br>  Und in diesem R√ºckruf erhalten wir nur eine Anfrage an einen Server mit einer Lizenz, die einige Bin√§rdaten enth√§lt (diese k√∂nnen je nach Anbieter auch unterschiedlich sein).  Wir verwenden diese Daten, um die aktuelle Sitzung durch Hinzuf√ºgen einer Lizenz zu aktualisieren.  Das hei√üt, sobald wir eine g√ºltige Lizenz vom Server erhalten haben, wei√ü unser CDM, dass wir das Video entschl√ºsseln und entschl√ºsseln k√∂nnen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/779/ef3/ea9/779ef3ea918671d1c4a2d2df8d9c404d.png"><br><br>  Wenn wir dies auf das folgende Diagramm anwenden, erhalten wir Folgendes: Wir m√∂chten das Video abspielen, und die JavaScript-Anwendung sagt: ‚ÄûHallo, Browser!  Ich m√∂chte das Video abspielen! ‚Äú  - verwendet dann verschl√ºsselte Medienerweiterungen und fordert bei Lizenzfunktionen in Widevine CDM eine Lizenz an.  Diese Anfrage wird dann an den Browser zur√ºckgesendet, und wir k√∂nnen sie gegen eine g√ºltige Lizenz auf dem Lizenzserver eintauschen. Anschlie√üend m√ºssen wir diese Lizenz zur√ºck an CDM √ºbertragen.  Dieser Vorgang wurde im obigen Code gezeigt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a98/e80/622/a98e806221a4f2533f0155c8425a36b4.png"><br><br>  Beachten Sie jedoch, dass wir noch keine Sekunde des Videos verloren haben und dies alle tun m√ºssen, um in Zukunft einige Videos abspielen zu k√∂nnen. <br><br><h2>  MSE </h2><br>  Eine weitere Technologie, die wir erforschen m√ºssen, ist MSE (Media Source Extensions).  Sie kann als Halbschwester von EME (Encrypted Media Extensions) bezeichnet werden.  Dies ist auch eine Browser-API, die nichts mit DRM zu tun hat.  Ich sehe es als Programmierschnittstelle zu &lt; <code>Video/</code> &gt; Src.  Mit ihm k√∂nnen Sie bin√§re Streams in JavaScript erstellen und Videofragmente auf das &lt; <code>Video/</code> &gt; -Element anwenden.  Dank dessen wird die Quelle des &lt; <code>Video/</code> &gt; -Tags dynamisch. <br><br>  So k√∂nnen wir die Erweiterungen f√ºr Multimedia-Quellen verwenden, das Video instanziieren und darauf zugreifen und dann die Videofragmente in Teilen herunterladen und auf das &lt; <code>Video/</code> &gt; -Tag anwenden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a1/8f5/99f/0a18f599f2422bc047ad16d71f32f9af.png"><br><br>  Der Punkt ist, dass Sie beim Ansehen eines zweist√ºndigen Videos nicht warten m√∂chten, bis es vollst√§ndig geladen ist.  Stattdessen schneiden Sie es in kleine St√ºcke mit einer Gr√∂√üe von etwa 30 Sekunden bis 2 Minuten und wenden sie einzeln auf das &lt; <code>Video/</code> &gt; -Element an. <br><br>  Sobald unser MediaSource-Puffer bereit und mit dem &lt; <code>Video/</code> &gt; -Element verkn√ºpft ist, k√∂nnen wir einen SourceBuffer hinzuf√ºgen.  Wir m√ºssen ihm noch einmal sagen, welches Videoformat und welche Codecs wir verwenden, und dann wird es erstellt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/49a/d01/b0f/49ad01b0fcb2745fd0243c9bd4cf0972.png"><br><br>  Schlie√ülich k√∂nnen wir jetzt einzelne Fragmente abrufen und sie mithilfe der Append-Methode an das &lt;Video /&gt; -Element in unserem SourceBuffer senden und ein dynamisch erstelltes Video empfangen.  Es kann auch f√ºr andere Anwendungsf√§lle verwendet werden, in denen Benutzer verschiedene Elemente des Videos unabh√§ngig voneinander kombinieren und ihre eigenen Videos erstellen k√∂nnen, aber ich m√∂chte nicht zu tief darauf eingehen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d5/687/bc3/9d5687bc390e405b84977c99420abb4b.png"><br><br>  Dies ist also fast der letzte Schritt, den wir unternehmen m√ºssen.  Sie haben ein Vertriebsnetzwerk, Sie haben Fragmente, und dann sendet der Browser die verschl√ºsselten und komprimierten Fragmente an das CDM, wo die Entschl√ºsselung und m√∂glicherweise die Dekodierung durchgef√ºhrt wird.  Anschlie√üend werden die entschl√ºsselten und unkomprimierten Fragmente an den Browser zur√ºckgesendet, wo sie visualisiert und angezeigt werden. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/498/2d0/8a6/4982d08a6ee484ab5de56fb3cdb6d247.png"><br><br><h2>  Manifest </h2><br>  Aber es gibt noch einen Punkt.  Woher wissen wir, welche Fragmente wir herunterladen m√ºssen, von wo und wann wir sie herunterladen m√ºssen?  Und dies ist der letzte Teil, die fehlende Anfrage aus dem Manifest.  Wenn wir Netflix nach einem Manifest abfragen, ben√∂tigt es viele Daten.  Wenn wir nur ein Video abspielen m√∂chten, ist es uns wichtig, welches DRM-System wir verwenden, welches Video wir ansehen m√∂chten (Netflix-ID, die von der URL kopiert werden kann) und Profile.  Profile bestimmen, in welcher Aufl√∂sung wir Video empfangen und in welcher Sprache wir Audiospuren empfangen, in welchem ‚Äã‚ÄãFormat (Stereo, Dolby Digital usw.), ob wir Untertitel verwenden usw. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daf/b78/506/dafb7850664c7b2baba6894add61a79a.png"><br><br><h2>  MPEG-DASH </h2><br>  Das am h√§ufigsten verwendete Manifestformat ist MPEG-DASH.  Es stimmt, Apple verwendet ein anderes Format - HSL, das anscheinend einer Liste von Dateien im alten Winamp-Player √§hnelt.  Aber Widevine und Microsoft verwenden genau MPEG-DASH.  Es basiert auf XML und definiert alles: Dauer, Puffergr√∂√üe, Inhaltstypen, wann welche Fragmente geladen werden, Fragmente f√ºr unterschiedliche Aufl√∂sungen sowie adaptives Bitraten-Switching.  Letzteres bedeutet, dass die Wiedergabe nicht stoppt, wenn ein Benutzer beispielsweise ein Video ansieht und gleichzeitig die Download-Geschwindigkeit sinkt, sondern sich die Videoqualit√§t einfach verschlechtert.  Dies liegt an der Tatsache, dass das Manifest dieselben Teile f√ºr unterschiedliche Aufl√∂sungen definiert, sie haben dieselbe Dauer und dieselben Indizes.  Wenn die Download-Geschwindigkeit abnimmt, kann der Browser daher einfach zu einem Stream mit einer niedrigeren Aufl√∂sung wechseln, ohne den Download anzuhalten und ohne die Daten zu puffern. <br><br>  So sieht das Manifest f√ºr Guardians of the Galaxy aus.  Darin k√∂nnen wir sehen, dass Menschen mit unterschiedlichen Download-Geschwindigkeiten Videos mit unterschiedlicher Qualit√§t erhalten, sowie die Tatsache, dass es Audiospuren f√ºr Menschen mit H√∂rbehinderungen gibt.  Es werden auch Untertitel geschrieben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/785/a96/a6f/785a96a6fa6b13ed57bd6f5518f36fa1.png"><br><br>  Wir haben eine Dauer und einen Hinweis auf die Zeit, ab der die Wiedergabe gestartet werden soll.  Diese Funktion wird beispielsweise verwendet, wenn Sie die Anzeige unterbrechen und dann wieder zum Video zur√ºckkehren, beginnend an der Stelle, an der Sie aufgeh√∂rt haben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dcc/349/b4c/dcc349b4c9b4a4eabfa26da95511185d.png"><br><br>  Es gibt auch wieder Robustheit, die besagt: Dieses Fragment kann nur verloren gehen, wenn Ihr System die Anforderungen erf√ºllt.  In diesem Fall handelt es sich um Hardware-Decodierung - Hardware Secure Codecs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a76/7c2/248/a767c224876945a69441fe4314114319.png"><br><br>  F√ºr denselben Teil des Videos k√∂nnen Sie eine beliebige Anzahl von Fragmenten mit unterschiedlichen Aufl√∂sungen bestimmen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9fa/202/d19/9fa202d1922b5e6d9aabb5a22f359d49.png"><br><br>  Anschlie√üend erhalten Sie die URL zum Laden des Fragments, und der Bereichsparameter zeigt den Wertebereich in Millisekunden an. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/35e/325/93c/35e32593c77c1c7b242ce0141e8b6fd3.png"><br><br>  Dies ist der letzte Teil.  Manchmal erhalten Sie auch ein Manifest vom CDN.  Einige Anbieter verf√ºgen √ºber einen separaten Server f√ºr die Fragment√ºbermittlung. Meistens stammen sie jedoch von demselben Computer wie die Manifestfunktionalit√§t.  Wenn wir das Manifest heruntergeladen haben, wissen wir, welche Fragmente wir herunterladen m√ºssen, k√∂nnen eine Anfrage nach Fragmenten senden und dann von CDM entschl√ºsseln und entschl√ºsseln. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/2e5/47d/8262e547d950d80ec737263c795ddab9.png"><br><br>  Im Allgemeinen ist das alles.  Alles, was oben gesagt wurde, reicht aus, um einen Open-Source-Player zum Ansehen von Videos von Amazon, Sky und anderen Plattformen sowie zum Ansehen von Videos von fast jedem Anbieter zu entwickeln. <br><br><h2>  Msl </h2><br>  Netflix hielt es f√ºr sinnvoll, eine zus√§tzliche Nachrichtenverschl√ºsselung zwischen dem Browser und dem Server hinzuzuf√ºgen.  Sie nannten es die "Nachrichtensicherheitsschicht", die Nachrichtensicherheitsschicht oder MSL.  Es macht nichts direkt mit dem Video, es ist nur eine zus√§tzliche Verschl√ºsselungsebene.  Einer der Gr√ºnde f√ºr die Implementierung von MSL ist, dass HTTPS nicht sicher genug ist.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MSL</a> hingegen ist Open Source, sodass Sie immer sehen k√∂nnen, wie es funktioniert.  Hier werde ich mich nicht mit diesem Thema befassen, und wenn Sie interessiert sind, finden Sie in ihrem Blog immer Informationen dar√ºber, warum Netflix MSL macht.  GitHub verf√ºgt √ºber eine detaillierte Dokumentation zu seiner Implementierung und den funktionierenden Implementierungen in Java. <br><br>  Es gibt auch eine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Python-Implementierung</a> , die wir mit Freunden geschrieben haben.  Soweit ich wei√ü, ist dies der einzige funktionierende Open Source-Client f√ºr Netflix.  Er arbeitet mit Kodi Media Center zusammen.  Zur Visualisierung k√∂nnen Sie den VLC Player oder eine andere geeignete Software verwenden. <br><br><h2>  Und wieder die "Black Box" </h2><br>  Sie haben also gesehen, was wir f√ºr die Implementierung ben√∂tigen und wie oft ich CDM erw√§hnt habe - die ‚ÄûBlack Box‚Äú, die von Google heruntergeladen wird.  So haben wir das Video wieder in die ‚ÄûBlack Box‚Äú zur√ºckgebracht.  Das sch√∂ne &lt;Video /&gt; -Element ist uns wieder verborgen.  Wir haben Software von Drittanbietern hinzugef√ºgt, die uns hilft, aber gleichzeitig geschlossen ist und die wir nicht verwalten k√∂nnen.  Es kann viele unauff√§llige Dinge tun: Nachverfolgung, Analyse, Senden von Daten ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ef/e10/72c/7efe1072c1d1d1390451a08ba3897f33.png"><br><br>  Dazu sagte Tim Berners Lee: <i>"Im Allgemeinen ist es wichtig, EME als eine relativ sichere Online-Umgebung zu erhalten, in der Sie Filme ansehen k√∂nnen, sowie als die bequemste und eine, die es Teil des vernetzten Diskurses der Menschheit macht."</i> <br><br>  Es gibt aber auch andere Meinungen dazu.  Insbesondere von der Electronic Frontiers Foundation, die vor dem Aufkommen von DRM Mitglied des W3C war.  Sie sagen Folgendes: <i>‚Äû2013 war EFF entt√§uscht zu erfahren, dass das W3C das Standardisierungsprojekt f√ºr EME-verschl√ºsselte Medienerweiterungen √ºbernommen hat.</i>  <i>Tats√§chlich handelt es sich um eine API, deren einzige Funktion darin bestand, DRM eine f√ºhrende Rolle im Browser-√ñkosystem zu verschaffen.</i>  <i>Wir werden weiter daf√ºr k√§mpfen, dass das Internet frei und offen ist.</i>  <i>"Wir werden die US-Regierung weiterhin verklagen, um Gesetze aufzuheben, die DRM so giftig machen, und wir werden weiterhin auf der Ebene des globalen Rechts k√§mpfen."</i> <br><br>  Es f√§llt mir schwer zu sagen, wie ich damit umgehen soll.   ,       ,      ,      .   ,     Netflix,     . ,        ,         . <br><br><blockquote>   , 24-25 ,    <b>HolyJS 2018 Moscow</b> ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">¬´The Universal Serial Web¬ª</a> :     WebUSB,    USB-  .     -,    . <br><br> PS  1-      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> . ,     ‚Äî  50%   . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de426727/">https://habr.com/ru/post/de426727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de426717/index.html">Die Illusion der T√§uschung: Eine visuelle optische T√§uschung basierend auf Retro-Prognosen</a></li>
<li><a href="../de426719/index.html">Hackathon √ºber Data Science in SIBUR: wie es war</a></li>
<li><a href="../de426721/index.html">Vermeiden von Fehlern w√§hrend der Produktentwicklung: 10 Tipps von Rookee</a></li>
<li><a href="../de426723/index.html">Microsoft und Partner hoffen, eine Zeitkapsel auf dem Mond zu schaffen</a></li>
<li><a href="../de426725/index.html">Wie man Dinge macht, wenn man keine Lust dazu hat</a></li>
<li><a href="../de426729/index.html">TypeScript School of Magic: Generika und Typerweiterung</a></li>
<li><a href="../de426731/index.html">CSS: interessante Merkmale des Randradius</a></li>
<li><a href="../de426733/index.html">Eisen wird nicht versagen. Wie ich Dutzende von Servern pro Tag f√ºr den Kampf vorbereite</a></li>
<li><a href="../de426735/index.html">Willkommen beim JETHACK Hackathon</a></li>
<li><a href="../de426737/index.html">Kurz √ºber die Architektur neuromorpher Prozessoren: ein Einblick</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>