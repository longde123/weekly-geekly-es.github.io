<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêã üèΩ üò∞ Introduction √† GitOps pour OpenShift üë®‚ÄçüöÄ ü¶à üßëüèª‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aujourd'hui, nous parlerons des principes et des mod√®les de GitOps, ainsi que de la fa√ßon dont ces mod√®les sont mis en ≈ìuvre sur la plate-forme OpenSh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Introduction √† GitOps pour OpenShift</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/redhatrussia/blog/478852/">  Aujourd'hui, nous parlerons des principes et des mod√®les de GitOps, ainsi que de la fa√ßon dont ces mod√®les sont mis en ≈ìuvre sur la plate-forme OpenShift.  Un guide en ligne sur ce sujet est disponible <a href="https://learn.openshift.com/introduction/gitops-introduction/%3FextIdCarryOver%3Dtrue%26sc_cid%3D701f2000001OH74AAG">ici</a> . <br><br><img src="https://habrastorage.org/webt/sk/g4/vk/skg4vkilbd51gs_dk6vk3-emy2o.jpeg" width="100%"><br><br>  En bref, GitOps est un ensemble de m√©thodes pratiques d'utilisation des requ√™tes pull Git pour g√©rer les configurations d'infrastructure et d'application.  Le r√©f√©rentiel Git dans GitOps est consid√©r√© comme une source unique d'informations sur l'√©tat du syst√®me, et tout changement de cet √©tat est enti√®rement surveill√© et audit√©. <br><a name="habracut"></a><br>  L'id√©e du suivi des modifications dans GitOps n'est pas nouvelle; cette approche a longtemps √©t√© utilis√©e presque partout lorsque vous travaillez avec du code source d'application.  GitOps impl√©mente simplement des fonctions similaires (v√©rifications de v√©rification, demandes d'extraction, balises, etc.) lors de la gestion de l'infrastructure et des configurations d'application et offre des avantages similaires √† ceux de la gestion du code source. <br><br>  Pour GitOps, il n'y a pas de d√©finition acad√©mique ni d'ensemble de r√®gles approuv√©, seulement un ensemble de principes sur lesquels cette pratique est bas√©e: <br><br><ul><li>  La description d√©clarative du syst√®me est stock√©e dans le r√©f√©rentiel Git (configs, monitoring, etc.). </li><li>  Les changements d'√©tat sont effectu√©s par le biais de demandes d'extraction. </li><li>  L'√©tat des syst√®mes en cours d'ex√©cution est align√© sur les donn√©es du r√©f√©rentiel √† l'aide des requ√™tes push Git. </li></ul><br><h3>  Principes GitOps </h3><br><ul><li>  <b>Les d√©finitions de syst√®me sont d√©crites comme du code source.</b> </li></ul><br>  La configuration du syst√®me est consid√©r√©e comme du code, elle peut donc √™tre stock√©e et versionn√©e automatiquement dans le r√©f√©rentiel Git, qui est la seule source de v√©rit√©.  Cette approche facilite le d√©ploiement et la restauration des modifications apport√©es aux syst√®mes. <br><br><ul><li>  <b>L'√©tat souhait√© et la configuration du syst√®me sont d√©finis et versionn√©s dans Git</b> </li></ul><br>  En stockant et en versionnant dans Git l'√©tat souhait√© des syst√®mes, nous obtenons la possibilit√© d'annuler et d'annuler facilement les modifications apport√©es aux syst√®mes et aux applications.  Nous pouvons √©galement utiliser les m√©canismes de s√©curit√© de Git pour contr√¥ler la propri√©t√© du code et v√©rifier son authenticit√©. <br><br><ul><li>  <b>Les modifications de configuration peuvent √™tre appliqu√©es automatiquement √† l'aide de demandes d'extraction.</b> </li></ul><br>  √Ä l'aide des demandes d'extraction Git, nous pouvons facilement contr√¥ler la fa√ßon dont les modifications sont appliqu√©es aux configurations dans le r√©f√©rentiel.  Par exemple, ils peuvent √™tre envoy√©s pour v√©rification √† d'autres membres de l'√©quipe ou ex√©cuter des tests CI, etc. <br><br>  Et en m√™me temps, vous n'avez pas besoin de donner des droits d'administrateur √† droite et √† gauche.  Pour valider les modifications de configuration, les utilisateurs disposent d'autorisations suffisantes dans le r√©f√©rentiel Git o√π ces configurations sont stock√©es. <br><br><ul><li>  <b>Correction des configurations de d√©rive non contr√¥l√©es</b> </li></ul><br>  Lorsque l'√©tat souhait√© du syst√®me est stock√© dans le r√©f√©rentiel Git, nous ne pouvons trouver que des logiciels qui contr√¥leraient que l'√©tat actuel du syst√®me correspond √† son √©tat souhait√©.  Si ce n'est pas le cas, ce logiciel devrait - selon les param√®tres - soit corriger lui-m√™me la diff√©rence, soit nous informer de la d√©rive de la configuration. <br><br><h3>  Mod√®les GitOps pour OpenShift </h3><br><h4>  R√©conciliateur de ressources sur cluster </h4><br>  Selon ce mod√®le, le cluster dispose d'un contr√¥leur charg√© de comparer les ressources Kubernetes (fichiers YAML) du r√©f√©rentiel Git avec les ressources r√©elles du cluster.  En cas de divergences, le contr√¥leur envoie des notifications et, √©ventuellement, prend des mesures pour √©liminer les incoh√©rences.  Ce mod√®le GitOps est utilis√© par Anthos Config Management et Weaveworks Flux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lh/c9/p2/lhc9p2tphyarqpe6jrsh10fgo7e.png"></div><br><br>
<h4>  R√©conciliateur de ressources externes (push) </h4><br>  Ce mod√®le peut √™tre consid√©r√© comme une variation du pr√©c√©dent, lorsque nous avons un ou plusieurs contr√¥leurs charg√©s de synchroniser les ressources par paires ¬´Git repository - Kubernetes cluster¬ª.  La diff√©rence ici est que chaque cluster g√©r√© n'a pas besoin d'avoir son propre contr√¥leur s√©par√©.  Les paires de clusters Git-k8s sont souvent d√©finies comme CRD de d√©finition de ressources personnalis√©es, qui d√©crivent comment le contr√¥leur doit effectuer la synchronisation.  Dans ce mod√®le, les contr√¥leurs comparent le r√©f√©rentiel Git sp√©cifi√© dans CRD avec les ressources du cluster Kubernetes, √©galement d√©finies dans CRD, et effectuent les actions correspondantes en fonction des r√©sultats de la comparaison.  En particulier, un tel mod√®le GitOps est utilis√© dans ArgoCD. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zw/51/ip/zw51ipo5hqcn8ccnc8vfqkqbc88.png"></div><br><br><h3>  GitOps sur la plate-forme OpenShift </h3><br><h4>  Administration de l'infrastructure multicubuster Kubernetes </h4><br>  Avec la diffusion de Kubernetes et la popularit√© croissante des strat√©gies multi-cloud et de l'informatique de pointe, le nombre moyen de clusters OpenShift par client a √©galement augment√©. <br><br>  Par exemple, lors de l'utilisation de l'informatique p√©riph√©rique, les clusters d'un seul client peuvent √™tre d√©ploy√©s par centaines, voire par milliers.  En cons√©quence, il est oblig√© de g√©rer plusieurs clusters OpenShift ind√©pendants ou coordonn√©s dans le cloud public et sur site. <br><br>  Dans le m√™me temps, de nombreux probl√®mes doivent √™tre r√©solus, en particulier: <br><br><ul><li>  Pour contr√¥ler que les clusters sont dans un √©tat identique (configurations, surveillance, stockage, etc.) </li><li>  Recr√©ez (ou restaurez) des clusters selon un √©tat connu. </li><li>  Cr√©ez de nouveaux clusters selon un √©tat connu. </li><li>  Tirez les modifications sur plusieurs clusters OpenShift. </li><li>  Annulez les modifications apport√©es √† plusieurs clusters OpenShift. </li><li>  Liez des configurations √† motifs √† diff√©rents environnements. </li></ul><br><h4>  Configurations d'application </h4><br>  Au cours de leur cycle de vie, les applications passent souvent par une cha√Æne de clusters (dev, stage, etc.) avant d'entrer dans un cluster de production.  De plus, en raison des exigences de disponibilit√© et d'√©volutivit√©, les clients d√©ploient souvent des applications sur plusieurs clusters sur site ou dans plusieurs r√©gions d'une plateforme de cloud public. <br><br>  Dans ce cas, il est n√©cessaire de r√©soudre les probl√®mes suivants: <br><ul><li>  Assurer le mouvement des applications (binaires, configs, etc.) entre les clusters (dev, stage, etc.). </li><li>  Reportez les modifications apport√©es aux applications (binaires, configurations, etc.) dans plusieurs clusters OpenShift. </li><li>  Annulez les modifications des applications au niveau de l'√©tat connu pr√©c√©dent. </li></ul><br><h3>  Sc√©narios d'utilisation d'OpenShift GitOps </h3><br><h4>  1. Appliquer les modifications du r√©f√©rentiel Git </h4><br>  L'administrateur de cluster peut stocker les configurations de cluster OpenShift dans le r√©f√©rentiel Git et les appliquer automatiquement pour cr√©er de nouveaux clusters sans effort suppl√©mentaire et les amener √† un √©tat identique √† l'√©tat connu stock√© dans le r√©f√©rentiel Git. <br><br><h4>  2. Synchronisation avec Secret Manager </h4><br>  L'administrateur trouvera √©galement utile de synchroniser les objets secrets OpenShift avec des logiciels appropri√©s comme Vault pour les g√©rer √† l'aide d'outils sp√©cialement cr√©√©s √† cet effet. <br><br><h4>  3. Contr√¥le des configurations de d√©rive </h4><br>  L'administrateur ne sera en faveur que si OpenShift GitOps d√©tectera et avertira des √©carts entre les configurations r√©elles et celles sp√©cifi√©es dans le r√©f√©rentiel, afin que vous puissiez r√©pondre rapidement √† la d√©rive. <br><br><h4>  4. Notifications de d√©rive de configuration </h4><br>  Cela sera utile lorsque l'administrateur souhaite s'informer rapidement des configurations de d√©rive afin de prendre rapidement les mesures appropri√©es par lui-m√™me. <br><br><h4>  5. Synchronisation manuelle des configurations lors de la d√©rive </h4><br>  Permet √† l'administrateur de synchroniser le cluster OpenShift avec le r√©f√©rentiel Git en cas de configurations de d√©rive afin de ramener rapidement le cluster √† un √©tat connu ant√©rieur. <br><br><h4>  6. Auto-synchronisation des configurations de d√©rive </h4><br>  L'administrateur peut √©galement configurer le cluster OpenShift pour qu'il se synchronise automatiquement avec le r√©f√©rentiel lorsqu'une d√©rive est d√©tect√©e, afin que la configuration du cluster corresponde toujours aux configurations de Git. <br><br><h4>  7. Clusters multiples - un r√©f√©rentiel </h4><br>  L'administrateur peut stocker les configurations de plusieurs clusters OpenShift diff√©rents dans un r√©f√©rentiel Git et les appliquer de mani√®re s√©lective selon les besoins. <br><br><h4>  8. Hi√©rarchie des configurations de cluster (h√©ritage) </h4><br>  L'administrateur peut d√©finir la hi√©rarchie des configurations de cluster dans le r√©f√©rentiel (√©tape, prod, portefeuille d'applications, etc. avec h√©ritage).  En d'autres termes, il peut d√©terminer comment les configurations doivent √™tre appliqu√©es - √† un ou plusieurs clusters. <br><br>  Par exemple, si l'administrateur d√©finit la hi√©rarchie ¬´Clusters de production (prod) ‚Üí Clusters du syst√®me X ‚Üí Clusters de production du syst√®me X¬ª dans le r√©f√©rentiel Git, les configurations suivantes sont appliqu√©es aux clusters de production du syst√®me X: <br><br><ul><li>  Configurations communes √† tous les clusters de production. </li><li>  Configure le syst√®me de cluster X. </li><li>  Configurer le cluster de production du syst√®me X. </li></ul><br><h4>  9. Mod√®les et remplacements de configuration </h4><br>  L'administrateur peut remplacer l'ensemble des configurations h√©rit√©es et leurs valeurs, par exemple, pour affiner la configuration des clusters sp√©cifiques auxquels ils seront appliqu√©s. <br><br><h4>  10. Inclusion et exclusion s√©lectives pour les configurations, la configuration des applications </h4><br>  L'administrateur peut d√©finir les conditions d'application ou de non-application de certaines configurations aux clusters ayant certaines caract√©ristiques. <br><br><h4>  11. Prise en charge des mod√®les </h4><br>  Les d√©veloppeurs trouveront utile de choisir la mani√®re dont les ressources de l'application seront d√©termin√©es (Helm Chart, pure Kubernetes yaml, etc.) afin d'utiliser le format le plus appropri√© pour chaque application sp√©cifique. <br><br><h3>  Outils GitOps sur la plate-forme OpenShift </h3><br><h4>  Argocd </h4><br>  ArgoCD impl√©mente le mod√®le External Resource Reconcile et offre une interface utilisateur centralis√©e pour orchestrer les relations entre les clusters et les r√©f√©rentiels Git de mani√®re un √† plusieurs.  Les inconv√©nients de ce programme incluent l'impossibilit√© de g√©rer les applications pendant qu'ArgoCD ne fonctionne pas. <br><br>  <a href="https://argoproj.github.io/argo-cd/">Site officiel</a> <br><br><h4>  Flux </h4><br>  Flux impl√©mente le mod√®le On-Cluster Resource Reconcile et, par cons√©quent, il n'y a pas de gestion centralis√©e du r√©f√©rentiel de d√©finitions, ce qui est un point faible.  D'un autre c√¥t√©, pr√©cis√©ment en raison du manque de centralisation, la capacit√© de g√©rer les applications est pr√©serv√©e m√™me en cas de d√©faillance d'un cluster. <br><br>  <a href="https://fluxcd.io/">Site officiel</a> <br><br><h3>  Installer ArgoCD sur OpenShift </h3><br>  ArgoCD offre une excellente interface de ligne de commande et une console Web, nous ne consid√©rerons donc pas Flux et d'autres alternatives ici. <br><br>  Pour d√©ployer ArgoCD sur la plate-forme OpenShift 4, proc√©dez comme suit en tant qu'administrateur de cluster: <br><br><h4>  D√©ploiement de composants ArgoCD sur la plate-forme OpenShift </h4><br><pre><code class="plaintext hljs"># Create a new namespace for ArgoCD components oc create namespace argocd # Apply the ArgoCD Install Manifest oc -n argocd apply -f https://raw.githubusercontent.com/argoproj/argo-cd/v1.2.2/manifests/install.yaml # Get the ArgoCD Server password ARGOCD_SERVER_PASSWORD=$(oc -n argocd get pod -l "app.kubernetes.io/name=argocd-server" -o jsonpath='{.items[*].metadata.name}')</code> </pre> <br><h4>  Le raffinement d'ArgoCD Server sera vu par OpenShift Route </h4><br><pre> <code class="plaintext hljs"># Patch ArgoCD Server so no TLS is configured on the server (--insecure) PATCH='{"spec":{"template":{"spec":{"$setElementOrder/containers":[{"name":"argocd-server"}],"containers":[{"command":["argocd-server","--insecure","--staticassets","/shared/app"],"name":"argocd-server"}]}}}}' oc -n argocd patch deployment argocd-server -p $PATCH # Expose the ArgoCD Server using an Edge OpenShift Route so TLS is used for incoming connections oc -n argocd create route edge argocd-server --service=argocd-server --port=http --insecure-policy=Redirect</code> </pre> <br><h4>  D√©ployer l'outil ArgoCD Cli </h4><br><pre> <code class="plaintext hljs"># Download the argocd binary, place it under /usr/local/bin and give it execution permissions curl -L https://github.com/argoproj/argo-cd/releases/download/v1.2.2/argocd-linux-amd64 -o /usr/local/bin/argocd chmod +x /usr/local/bin/argocd</code> </pre> <br><h4>  Changer le mot de passe administrateur ArgoCD Server </h4><br><pre> <code class="plaintext hljs"># Get ArgoCD Server Route Hostname ARGOCD_ROUTE=$(oc -n argocd get route argocd-server -o jsonpath='{.spec.host}') # Login with the current admin password argocd --insecure --grpc-web login ${ARGOCD_ROUTE}:443 --username admin --password ${ARGOCD_SERVER_PASSWORD} # Update admin's password argocd --insecure --grpc-web --server ${ARGOCD_ROUTE}:443 account update-password --current-password ${ARGOCD_SERVER_PASSWORD} --new-password</code> </pre> <br>  Une fois ces √©tapes termin√©es, vous pouvez travailler avec ArgoCD Server via la console Web ArgoCD WebUI ou l'outil de ligne de commande ArgoCD Cli. <br>  <a href="https://blog.openshift.com/is-it-too-late-to-integrate-gitops/">https://blog.openshift.com/is-it-too-late-to-integrate-gitops/</a> <br><br><h3>  GitOps - Il n'est jamais trop tard </h3><br>  ¬´Le train est parti¬ª - c'est ce qu'ils disent de la situation lorsque l'occasion de faire quelque chose est manqu√©e.  Dans le cas d'OpenShift, le d√©sir de commencer imm√©diatement √† utiliser cette nouvelle plate-forme cool cr√©e souvent une telle situation avec la gestion et la maintenance des itin√©raires, des d√©ploiements et d'autres objets OpenShift.  Mais la chance est-elle toujours compl√®tement manqu√©e? <br><br>  Poursuivant une s√©rie d'articles sur <a href="https://blog.openshift.com/introduction-to-gitops-with-openshift/">GitOps</a> , nous montrerons aujourd'hui comment transformer une application cr√©√©e manuellement et ses ressources en un certain processus o√π la bo√Æte √† outils GitOps contr√¥le tout.  Pour ce faire, nous d√©ployons d'abord l'application httpd avec nos mains.  La capture d'√©cran ci-dessous montre comment nous cr√©ons un espace de noms, un d√©ploiement et un service, puis exposons ce service pour cr√©er un itin√©raire. <br><br><pre> <code class="plaintext hljs">oc create -f https://raw.githubusercontent.com/openshift/federation-dev/master/labs/lab-4-assets/namespace.yaml oc create -f https://raw.githubusercontent.com/openshift/federation-dev/master/labs/lab-4-assets/deployment.yaml oc create -f https://raw.githubusercontent.com/openshift/federation-dev/master/labs/lab-4-assets/service.yaml oc expose svc/httpd -n simple-app</code> </pre> <br>  Nous avons donc une application cr√©√©e manuellement.  Maintenant, il doit √™tre transf√©r√© sous le contr√¥le de GitOps sans perte de disponibilit√©.  En bref, il fait ceci: <br><br><ul><li>  Cr√©ez un r√©f√©rentiel Git pour le code. </li><li>  Nous exportons nos objets actuels et les chargeons dans le r√©f√©rentiel Git. </li><li>  S√©lectionnez et d√©ployez la bo√Æte √† outils GitOps. </li><li>  Ajoutez notre r√©f√©rentiel √† cette bo√Æte √† outils. </li><li>  Nous d√©finissons l'application dans notre bo√Æte √† outils GitOps. </li><li>  Effectuez une ex√©cution d'essai de l'application √† l'aide de la bo√Æte √† outils GitOps. </li><li>  Nous synchronisons les objets √† l'aide de la bo√Æte √† outils GitOps. </li><li>  Nous activons l'√©lagage et la synchronisation automatique des objets. </li></ul><br>  Comme mentionn√© dans l' <a href="https://blog.openshift.com/introduction-to-gitops-with-openshift/">article</a> pr√©c√©dent, GitOps a une et une seule source d'informations sur tous les objets dans le (s) cluster (s) Kubernetes - le r√©f√©rentiel Git.  De plus, nous partons du principe que votre organisation utilise d√©j√† un r√©f√©rentiel Git.  Il peut √™tre public ou priv√©, mais il doit √™tre disponible pour les clusters Kubernetes.  Il peut s'agir du m√™me r√©f√©rentiel que pour le code d'application ou d'un r√©f√©rentiel distinct cr√©√© sp√©cifiquement pour le d√©ploiement.  Il est recommand√© de disposer d'autorisations strictes dans le r√©f√©rentiel, car les objets secrets, les itin√©raires et autres √©l√©ments sensibles √† la s√©curit√© y seront stock√©s. <br><br>  Dans notre exemple, nous allons cr√©er un nouveau r√©f√©rentiel public sur GitHub.  Vous pouvez le nommer comme vous le souhaitez, nous utilisons le nom blogpost. <br><br>  Si les fichiers YAML des objets n'√©taient pas stock√©s localement ou dans Git, vous devrez utiliser les binaires oc ou kubectl.  Dans la capture d'√©cran ci-dessous, nous demandons YAML pour notre espace de noms, d√©ploiement, service et route.  Avant cela, nous avons clon√© le r√©f√©rentiel nouvellement cr√©√© et l'avons d√©plac√© avec la commande cd. <br><br><pre> <code class="plaintext hljs">oc get namespace simple-app -o yaml --export &gt; namespace.yaml oc get deployment httpd -o yaml -n simple-app --export &gt; deployment.yaml oc get service httpd -o yaml -n simple-app --export &gt; service.yaml oc get route httpd -o yaml -n simple-app --export &gt; route.yaml</code> </pre> <br>  Corrigez maintenant le fichier deployment.yaml pour en supprimer un champ que le CD Argo ne peut pas synchroniser. <br><br><pre> <code class="plaintext hljs">sed -i '/\sgeneration: .*/d' deployment.yaml</code> </pre> <br>  De plus, vous devez modifier l'itin√©raire.  Nous allons d'abord d√©finir la variable multiligne, puis remplacer ingress: null par le contenu de cette variable. <br><br><pre> <code class="plaintext hljs">export ROUTE=" ingress:\\ - conditions:\\ - status: 'True'\\ type: Admitted" sed -i "s/ ingress: null/$ROUTE/g" route.yaml</code> </pre> <br>  Donc, avec les fichiers tri√©s, il reste √† les enregistrer dans le r√©f√©rentiel Git.  Apr√®s cela, ce r√©f√©rentiel devient la seule source d'informations et toute modification manuelle des objets doit √™tre strictement interdite. <br><br><pre> <code class="plaintext hljs">git commit -am 'initial commit of objects' git push origin master</code> </pre> <br>  De plus, nous partons du fait qu'ArgoCD est d√©j√† d√©ploy√© pour vous (comment faire, voir le <a href="https://blog.openshift.com/introduction-to-gitops-with-openshift/">post</a> pr√©c√©dent).  Par cons√©quent, nous ajoutons au CD Argo le r√©f√©rentiel que nous avons cr√©√© qui contient le code d'application de notre exemple.  Assurez-vous simplement de sp√©cifier le r√©f√©rentiel exact que vous avez cr√©√© pr√©c√©demment. <br><br><pre> <code class="plaintext hljs">argocd repo add https://github.com/cooktheryan/blogpost</code> </pre> <br>  Cr√©ez maintenant l'application.  L'application d√©finit les valeurs de sorte que la bo√Æte √† outils GitOps comprenne le r√©f√©rentiel et les chemins √† utiliser, quel OpenShift est n√©cessaire pour g√©rer les objets, ainsi que la branche sp√©cifique du r√©f√©rentiel n√©cessaire et si les ressources doivent √™tre auto-synchronis√©es. <br><br><pre> <code class="plaintext hljs">argocd app create --project default \ --name simple-app --repo https://github.com/cooktheryan/blogpost.git \ --path . --dest-server https://kubernetes.default.svc \ --dest-namespace simple-app --revision master --sync-policy none</code> </pre> <br>  Une fois l'application sp√©cifi√©e dans le CD Argo, cette bo√Æte √† outils commence √† v√©rifier la conformit√© des objets d√©j√† d√©ploy√©s avec les d√©finitions du r√©f√©rentiel.  Dans notre exemple, la synchronisation automatique et le nettoyage sont d√©sactiv√©s, donc les √©l√©ments ne changent pas encore.  Veuillez noter que dans l'interface Argo CD, notre application aura le statut ¬´Hors synchronisation¬ª (non synchronis√©e), car il n'y a aucune √©tiquette d'√©tiquette qu'ArgoCD appose. <br>  C'est pourquoi, lorsque nous lancerons la synchronisation un peu plus tard, le red√©ploiement des objets ne sera pas effectu√©. <br><br>  Ex√©cutez maintenant un test pour vous assurer qu'il n'y a pas d'erreurs dans nos fichiers. <br><br><pre> <code class="plaintext hljs">argocd app sync simple-app --dry-run</code> </pre> <br>  S'il n'y a aucune erreur, vous pouvez proc√©der √† la synchronisation. <br><br><pre> <code class="plaintext hljs">argocd app sync simple-app</code> </pre> <br>  Apr√®s avoir ex√©cut√© la commande argocd get sur notre application, nous devrions voir que le statut de l'application est pass√© √† Healthy ou Synced.  Cela signifie que toutes les ressources du r√©f√©rentiel Git correspondent d√©sormais aux ressources d√©j√† d√©ploy√©es. <br><br><pre> <code class="plaintext hljs">argocd app get simple-app Name: simple-app Project: default Server: https://kubernetes.default.svc Namespace: simple-app URL: https://argocd-server-route-argocd.apps.example.com/applications/simple-app Repo: https://github.com/cooktheryan/blogpost.git Target: master Path: . Sync Policy: &lt;none&gt; Sync Status: Synced to master (60e1678) Health Status: Healthy ...</code> </pre> <br>  Mais maintenant, vous pouvez activer la synchronisation automatique et le nettoyage pour vous assurer que rien ne sera cr√©√© manuellement et que chaque fois que l'objet est cr√©√© ou mis √† jour dans le r√©f√©rentiel, le d√©ploiement sera effectu√©. <br><br><pre> <code class="plaintext hljs">argocd app set simple-app --sync-policy automated --auto-prune</code> </pre> <br>  Ainsi, nous avons r√©ussi √† transf√©rer au contr√¥le de GitOps une application qui au d√©part n'utilisait pas GitOps en aucune fa√ßon. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr478852/">https://habr.com/ru/post/fr478852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr478840/index.html">O√π commence la cr√©ation d'un march√©. Deuxi√®me partie</a></li>
<li><a href="../fr478844/index.html">Peur et d√©go√ªt en informatique</a></li>
<li><a href="../fr478846/index.html">Systemd, scripts interactifs et minuteries</a></li>
<li><a href="../fr478848/index.html">L'√©volution de la photographie num√©rique</a></li>
<li><a href="../fr478850/index.html">Attribution d'un nom √† une grille CSS</a></li>
<li><a href="../fr478854/index.html">La bataille des serveurs web. Partie 1 - HTTP dissoci√© de la r√©alit√©:</a></li>
<li><a href="../fr478856/index.html">SD-WAN - tendances r√©centes et pr√©visions pour 2020</a></li>
<li><a href="../fr478858/index.html">Comparaison des sessions de profilage dans XHProf Admin</a></li>
<li><a href="../fr478862/index.html">Comment les tests frontaux sont-ils organis√©s dans Yandex.Market et pourquoi nous refusons les versions hebdomadaires</a></li>
<li><a href="../fr478866/index.html">Meet Space - Nouveau produit de JetBrains</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>