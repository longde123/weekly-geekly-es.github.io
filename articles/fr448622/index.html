<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíâ üìê üë¥üèΩ PHP GR8: JIT am√©liorera-t-il les performances de PHP 8 üöß üìÇ üßëüèΩ‚Äçü§ù‚Äçüßëüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PHP est l'un des principaux langages de d√©veloppement de Badoo. Dans nos centres de donn√©es, des milliers de c≈ìurs de processeur sont occup√©s √† ex√©cut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PHP GR8: JIT am√©liorera-t-il les performances de PHP 8</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/448622/"><img src="https://habrastorage.org/webt/bw/fj/lk/bwfjlk2iy2btywbt8rqmlsok_-i.jpeg"><br><br>  <i>PHP est l'un des principaux langages de d√©veloppement de Badoo.</i>  <i>Dans nos centres de donn√©es, des milliers de c≈ìurs de processeur sont occup√©s √† ex√©cuter des millions de lignes de code PHP.</i>  <i>Nous suivons de pr√®s l'actualit√© et recherchons activement des moyens d'am√©liorer la productivit√©, car m√™me une petite optimisation de nos volumes permet de r√©aliser d'importantes √©conomies de ressources.</i>  <i>L'une des principales nouveaut√©s en mati√®re de performances PHP est l'apparition de JIT dans la huiti√®me version du langage.</i>  <i>Cela, bien s√ªr, ne pouvait pas rester sans notre attention, et nous avons traduit l'article sur ce qu'est JIT, comment il sera impl√©ment√© en PHP, pourquoi il a √©t√© d√©cid√© de le faire et √† quoi s'attendre.</i> <br><br>  Si vous n'avez pas quitt√© la grotte ou que vous ne venez pas du pass√© (dans ce cas, bienvenue), vous savez d√©j√† que PHP 8 aura JIT: l'autre jour, le vote s'est d√©roul√© tranquillement et pacifiquement et la grande majorit√© des participants a vot√© en faveur de la mise en ≈ìuvre, alors tout est d√©cid√© . <br><br>  Dans un acc√®s de joie, vous pouvez m√™me d√©peindre plusieurs mouvements fous comme sur la photo (d'ailleurs, cela s'appelle le "Detroit JIT": <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ip/gp/gk/ipgpgk3stro-ora0on1jhgbxg-y.jpeg"><br><br>  Maintenant, asseyez-vous et lisez cet article d√©mystifiant.  Je veux clarifier le malentendu associ√© √† ce qu'est le JIT et √† son utilit√©, et parler de son fonctionnement (mais pas trop en d√©tail pour ne pas vous ennuyer). <br><br>  Comme je ne sais pas qui lira l'article, je passerai de questions simples √† complexes.  Si vous connaissez d√©j√† la r√©ponse √† la question dans le titre, vous pouvez ignorer le chapitre correspondant en toute s√©curit√©. <br><br><h1>  Qu'est-ce que JIT? </h1><br>  PHP est impl√©ment√© sur la base d'une machine virtuelle (nous l'appelons Zend VM).  Le langage compile le code source PHP en instructions que la machine virtuelle comprend (c'est ce qu'on appelle l'√©tape de compilation).  Les instructions de machine virtuelle obtenues lors de la compilation sont appel√©es opcodes.  Au stade de l'ex√©cution, la VM Zend ex√©cute les opcodes, effectuant ainsi le travail requis. <br><br>  Ce circuit fonctionne tr√®s bien.  De plus, des outils comme APC (avant) et OpCache (aujourd'hui) mettent en cache les r√©sultats de l'√©tape de compilation, cette √©tape n'est donc ex√©cut√©e que si n√©cessaire. <br><br>  En bref, JIT est une strat√©gie de compilation juste √† temps (au bon moment), dans laquelle le code est d'abord traduit en une repr√©sentation interm√©diaire, qui se transforme ensuite en un code machine d√©pendant de l'architecture lors de l'ex√©cution. <br><br>  En PHP, cela signifie que JIT consid√©rera les instructions pour la machine virtuelle re√ßues au stade de la compilation comme une repr√©sentation interm√©diaire et donnera du code machine qui ne sera plus ex√©cut√© par la VM Zend, mais directement par le processeur. <br><br><h1>  Pourquoi PHP a-t-il besoin de JIT? </h1><br>  Peu de temps avant l'av√®nement de PHP 7.0, l'objectif principal de l'√©quipe PHP √©tait la performance du langage.  La plupart des changements majeurs de PHP 7.0 ont √©t√© apport√©s au correctif PHPNG, ce qui a consid√©rablement am√©lior√© la fa√ßon dont PHP utilise la m√©moire et le processeur.  Depuis lors, chacun de nous doit regarder la performance de la langue. <br><br>  Apr√®s la sortie de PHP 7.0, les am√©liorations de performances se sont poursuivies: une table de hachage (la structure de donn√©es principale en PHP) a √©t√© optimis√©e, la sp√©cialisation de certains opcodes dans Zend VM et la sp√©cialisation de certaines s√©quences dans le compilateur ont √©t√© mises en ≈ìuvre, l'Optimizer (composant OpCache) a √©t√© constamment am√©lior√© et de nombreux autres changements ont √©t√© mis en ≈ìuvre. <br><br>  La dure v√©rit√© est qu'√† la suite de toutes ces optimisations, nous approchons rapidement de la limite des opportunit√©s d'am√©lioration de la productivit√©. <br><br>  Veuillez noter: par ¬´limite des possibilit√©s d'am√©lioration¬ª, je veux dire le fait que les compromis qui doivent √™tre faits pour de nouvelles am√©liorations ne semblent plus attrayants.  Lorsqu'il s'agit d'optimiser les performances, nous parlons toujours de compromis.  Souvent, pour des raisons de productivit√©, nous devons sacrifier la simplicit√©.  Tout le monde voudrait penser que le code le plus simple est aussi le plus rapide, mais dans le monde moderne de la programmation C, ce n'est pas le cas.  Le plus rapide est le code qui est pr√©par√© pour tirer parti de la structure interne de l'architecture ou des structures int√©gr√©es dans la plateforme / le compilateur.  La simplicit√© seule ne garantit pas de meilleures performances. <br><br>  Par cons√©quent, √† ce stade, la meilleure fa√ßon d'extraire encore plus de performances de PHP est d'impl√©menter JIT. <br><br><h1>  JIT va-t-il acc√©l√©rer mon site? </h1><br>  Tr√®s probablement, de fa√ßon insignifiante. <br><br>  Ce n'est peut-√™tre pas la r√©ponse que vous attendiez.  Le fait est qu'en g√©n√©ral, les applications PHP sont limit√©es par les entr√©es / sorties (li√©es aux E / S), et JIT fonctionne mieux avec du code limit√© par le processeur (li√© aux CPU). <br><br><h1>  Que signifie ¬´limit√© par les E / S et le processeur¬ª? </h1><br>  Pour d√©crire les caract√©ristiques des performances globales de certains codes ou applications, nous utilisons les termes ¬´limit√© par entr√©e-sortie¬ª et ¬´limit√© par processeur¬ª. <br><br>  La d√©finition la plus simple: <br><br><ul><li>  le code limit√© par les E / S fonctionnera beaucoup plus rapidement si nous trouvons un moyen d'am√©liorer (r√©duire, optimiser) les op√©rations d'E / S effectu√©es; <br></li><li>  le code limit√© par processeur fonctionnera beaucoup plus rapidement si nous trouvons un moyen d'am√©liorer (r√©duire, optimiser) les instructions ex√©cut√©es par le processeur ou d'augmenter comme par magie la vitesse d'horloge du processeur. <br></li></ul><br>  Le code et l'application peuvent √™tre limit√©s par les E / S, le processeur ou les deux. <br><br>  En g√©n√©ral, les applications PHP ont tendance √† √™tre limit√©es par les E / S: leur principal goulot d'√©tranglement est souvent les op√©rations d'E / S - connexion, lecture et √©criture √† la base de donn√©es, caches, fichiers, sockets, etc. <br><br><h1>  √Ä quoi ressemble le code PHP limit√© par processeur? </h1><br>  Certains programmeurs PHP sont peut-√™tre nouveaux dans le code limit√© par le processeur en raison de la nature de la plupart des applications PHP: ils agissent g√©n√©ralement comme un lien vers la base de donn√©es ou le cache, r√©cup√®rent et produisent de petites quantit√©s de r√©ponses HTML / JSON / XML. <br><br>  Vous pouvez consulter votre base de code et trouver beaucoup de code qui n'a rien √† voir avec les E / S, du code qui appelle des fonctions qui n'ont rien √† voir avec les E / S.  Et vous pouvez √™tre confus que cela ne rend pas votre application limit√©e par le processeur, bien que son code ait plus de lignes qui ne fonctionnent pas avec les E / S que le travail. <br><br>  Le fait est que PHP est l'un des langages interpr√©t√©s les plus rapides.  Il n'y a pas de diff√©rence notable entre l'appel d'une fonction qui n'utilise pas les E / S dans Zend VM et dans le code machine.  Bien s√ªr, il y a une diff√©rence, mais le code machine et la machine virtuelle Zend utilisent la convention d'appel, donc peu importe <code>-___()</code> vous appelez <code>-___()</code> dans les opcodes ou dans le code machine - cela n'aura pas d'effet notable sur les performances de l'ensemble de l'application qui effectue l'appel. <br><br>  <i>Remarque: en termes simples, une convention d'appel est une s√©quence d'instructions ex√©cut√©es <b>avant d'</b> entrer dans une autre fonction.</i>  <i>Dans les deux cas, la convention d'appel transmet des arguments √† la pile.</i> <br><br>  Vous demandez: "Qu'en est-il des boucles, des appels de queue et plus encore?"  PHP est assez intelligent - et lorsque l'Optimizer d'OpCache est activ√©, votre code sera magiquement converti en une version plus efficace de ce que vous avez √©crit. <br><br>  Il convient de noter ici que JIT ne changera pas les conventions d'appel de Zend VM.  Cela est d√ª au fait que PHP doit pouvoir basculer entre les modes JIT et VM √† tout moment (ils ont donc d√©cid√© de conserver les conventions actuelles).  Par cons√©quent, tous les appels que vous voyez partout en utilisant JIT ne fonctionneront pas beaucoup plus rapidement. <br><br>  Si vous voulez voir √† quoi ressemble le code PHP limit√© par processeur, jetez un ≈ìil ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/php/php-src/blob/master/Zend/bench.php</a> .  C'est un exemple extr√™me, mais il montre que toute la splendeur de JIT se r√©v√®le dans les math√©matiques. <br><br><h1>  D√ª faire un compromis aussi extr√™me pour acc√©l√©rer les calculs math√©matiques en PHP? </h1><br>  Non.  Nous l'avons fait dans le but d'√©largir le champ d'application de la langue (et d'√©largir consid√©rablement). <br><br>  Nous ne voulons pas nous vanter, mais PHP domine le Web.  Si vous √™tes engag√© dans le d√©veloppement Web et que vous n'envisagez pas d'utiliser PHP dans votre prochain projet, alors vous faites quelque chose de mal (selon un d√©veloppeur PHP tr√®s biais√©). <br><br>  √Ä premi√®re vue, il peut sembler que l'acc√©l√©ration des calculs math√©matiques en PHP a une application tr√®s √©troite.  Cependant, cela nous ouvre la voie, par exemple, √† l'apprentissage automatique, au rendu 3D, au rendu 2D (GUI) et √† l'analyse des donn√©es. <br><br><h1>  Pourquoi cela ne peut-il pas √™tre impl√©ment√© en PHP 7.4? </h1><br>  Ci-dessus, j'ai appel√© JIT un compromis extr√™me, et je le pense vraiment: c'est l'une des strat√©gies de compilation les plus difficiles parmi toutes celles qui existent, sinon la plus difficile.  L'impl√©mentation de JIT repr√©sente une augmentation significative de la complexit√©. <br><br>  Si vous demandez √† Dmitry, l'auteur de JIT, s'il a rendu PHP compliqu√©, il r√©pondra: "Non, je d√©teste la complexit√©" (c'est une citation). <br><br>  Essentiellement, ¬´complexe¬ª signifie ¬´ce que nous ne comprenons pas¬ª.  Et aujourd'hui, peu de d√©veloppeurs de langage comprennent vraiment l'impl√©mentation existante de JIT. <br><br>  Les travaux sur PHP 7.4 progressent rapidement et l'introduction de JIT dans cette version conduira au fait que seuls quelques-uns peuvent d√©boguer, corriger et am√©liorer le langage.  C'est inacceptable pour ceux qui ont vot√© contre JIT en PHP 7.4. <br><br>  Avant la sortie de PHP 8, beaucoup d'entre nous comprendront l'impl√©mentation JIT.  Il y a des fonctionnalit√©s que nous voulons impl√©menter et des outils que nous voulons r√©√©crire pour la huiti√®me version, nous devons donc d'abord comprendre le JIT.  Nous avons besoin de ce temps, et nous sommes tr√®s reconnaissants √† la majorit√© d'avoir vot√© pour nous le donner. <br><br>  Complexe n'est pas synonyme de terrible.  La complexit√© peut √™tre aussi belle qu'une n√©buleuse √©toil√©e, et c'est √† peu pr√®s JIT.  En d'autres termes, m√™me lorsque 20 personnes de notre √©quipe commencent √† comprendre le JIT pas pire que Dmitry, cela ne changera pas la complexit√© de la nature du JIT. <br><br><h1>  Le d√©veloppement PHP va-t-il ralentir? </h1><br>  Il n'y a aucune raison de le penser.  Nous avons assez de temps, donc on peut affirmer qu'au moment o√π PHP 8 sera pr√™t, il y en aura assez parmi nous qui auront suffisamment ma√Ætris√© JIT pour travailler non moins efficacement qu'aujourd'hui lorsqu'il s'agit de corriger des bugs et de d√©velopper PHP. <br><br>  Lorsque vous essayez de relier cela √† l'id√©e de la complexit√© d'origine de JIT, n'oubliez pas que la plupart du temps que nous passons √† introduire de nouvelles fonctionnalit√©s est consacr√© √† leur discussion.  Le plus souvent, lorsque vous travaillez sur des fonctionnalit√©s et corrigez des bogues, l'√©criture d'un code prend des minutes ou des heures, et les discussions prennent des semaines ou des mois.  Dans de rares cas, le code doit √™tre √©crit pendant des heures ou des jours, mais m√™me alors, les discussions durent toujours plus longtemps. <br><br>  C'est tout ce que je voulais dire. <br><br><blockquote>  Et puisque nous parlons de performance, j'invite mon coll√®gue Pavel Murzakov au rapport du 17 mai √† la conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PHP Russie.</a>  Pasha sait comment extraire la derni√®re seconde CPU du code PHP! </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448622/">https://habr.com/ru/post/fr448622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448606/index.html">Sidorin: KnowledgeConf est sur la fa√ßon de maintenir les connaissances avec une dur√©e moyenne de travail en un seul endroit en 2-3 ans</a></li>
<li><a href="../fr448608/index.html">Comment faire les premiers pas en robotique?</a></li>
<li><a href="../fr448610/index.html">DIY: Comment nous avons cr√©√© un programme en direct pour Codefest X</a></li>
<li><a href="../fr448612/index.html">Ce qui a √©t√© gel√© au gel des fonctionnalit√©s 2019. Partie I. JSONPath</a></li>
<li><a href="../fr448618/index.html">Algorithme Douglas-Pecker</a></li>
<li><a href="../fr448624/index.html">Voir les donn√©es? Non. Donc je ne vois pas, mais ils le sont. Nous d√©truisons les donn√©es sur les disques SSD et restaurons m√™me la vitesse</a></li>
<li><a href="../fr448626/index.html">DDoS pour aider: comment nous menons le stress et les tests de stress</a></li>
<li><a href="../fr448628/index.html">Esth√©tique et technologie technique sovi√©tique</a></li>
<li><a href="../fr448632/index.html">Java est maintenant pay√©? D√©mystifier les rumeurs (ou pas?)</a></li>
<li><a href="../fr448634/index.html">Cours d'ukrainien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>