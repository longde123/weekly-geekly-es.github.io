<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïê ü•¢ üë©‚ÄçüöÄ Dap em a√ß√£o. Escrevendo TodoMVC. Parte 1 üß• üìå üò¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O primeiro artigo sobre a dap , obviamente, n√£o se tornou meu sucesso de escrita: a grande maioria dos coment√°rios a ele se resumia a "niasilil" e "ni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dap em a√ß√£o. Escrevendo TodoMVC. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480912/"> O primeiro <a href="https://habr.com/ru/post/478330/">artigo</a> sobre a <a href="https://dap.js.org/" rel="nofollow">dap</a> , obviamente, n√£o se tornou meu sucesso de escrita: a grande maioria dos coment√°rios a ele se resumia a "niasilil" e "niasilil, mas eu condeno".  E o pr√™mio <s>do</s> √∫nico coment√°rio construtivo de n√≠vel superior vai para o <a href="https://habr.com/en/users/oldvitus/" class="user_link">OldVitus</a> , por conselhos para demonstrar o dap usando TodoMVC como exemplo, para que haja algo para comparar.  O que farei neste artigo. <br><br>  <a href="http://todomvc.com/" rel="nofollow">TodoMVC</a> , se algu√©m n√£o sabe, esse √© um mundo de chamadas de interface do usu√°rio padr√£o, que permite comparar solu√ß√µes para o mesmo problema - a "lista de tarefas" condicional - usando estruturas diferentes.  A tarefa, com toda a sua simplicidade (sua <a href="https://dap.js.org/samples/todo.html" rel="nofollow">solu√ß√£o no dap</a> quebra ‚Äúem uma tela‚Äù), √© muito ilustrativa.  Portanto, usando seu exemplo, tentarei mostrar como as tarefas t√≠picas de um front-end da web s√£o implementadas usando dap. <br><br>  N√£o procurei e estudei a descri√ß√£o formal do problema, mas decidi simplesmente reverter um dos exemplos.  O back-end deste artigo n√£o √© interessante para n√≥s, portanto, n√£o o escreveremos, mas usaremos <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">um dos j√° prontos</a> no site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> e, a partir da√≠, levaremos <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">um cliente de exemplo</a> e um <a href="" rel="nofollow">arquivo CSS</a> padr√£o. <br><br>  Para usar o dap, voc√™ n√£o precisa baixar e instalar nada.  Nenhuma <code>npm install</code> e √© tudo.  N√£o √© necess√°rio criar nenhum projeto com uma estrutura de diret√≥rios espec√≠fica, manifestos e outros atributos de sucesso da TI.  Editor de texto e navegador suficientes.  Para depurar solicita√ß√µes XHR, voc√™ tamb√©m pode precisar de um servidor Web - um servidor bastante simples, como esta <a href="https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb" rel="nofollow">extens√£o</a> para o Chrome.  Todo o frontend consistir√° em um √∫nico arquivo .html (√© claro, referindo-se ao script dap-engine e ao arquivo CSS TodoMVC padr√£o) <br><br>  Ent√£o, do zero. <br><a name="habracut"></a><br><h2>  1. Crie um arquivo .html </h2><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Todo -- dap sample<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.todobackend.com/client/css/vendor/todomvc-common.css"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://dap.js.org/0.4.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-comment"><span class="actionscript"><span class="hljs-comment">//   dap </span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  A prepara√ß√£o html usual em que inclu√≠mos o arquivo CSS, gentilmente fornecido pelo site <a href="https://www.todobackend.com/" rel="nofollow">www.todobackend.com</a> e o dap-engine, n√£o menos gentilmente fornecido pelo site <a href="https://dap.js.org/" rel="nofollow">dap.js.org</a> <br><br><h2>  2. Copie a estrutura DOM do exemplo original </h2><br>  Para usar o arquivo CSS padr√£o sem altera√ß√µes, aderiremos √† mesma estrutura DOM do <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">exemplo original</a> .  Abra-o no navegador Chrome, pressione Ctr + Shift + I, selecione a guia Elementos e veja se o aplicativo est√° na <code>section id="todo-app"&gt;</code> elemento <code>section id="todo-app"&gt;</code> <br><br><img src="https://habrastorage.org/webt/3d/ks/mq/3dksmqoxzyif_tgnxfc3v-wf_us.png"><br><br>  Ao abrir esta sub√°rvore uma a uma, reescrevemos sua estrutura em nosso arquivo .html.  Agora, estamos simplesmente desenhando de maneira r√°pida, e n√£o escrevendo c√≥digo, apenas escrevemos as assinaturas dos elementos em 'aspas simples' e entre par√™nteses de seus filhos.  Se n√£o houver filhos, desenhamos colchetes vazios.  Monitoramos os √≠ndices e o saldo dos colchetes. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   dap '#todoapp'( '#header'( 'H1'() 'INPUT#new-todo placeholder="What needs to be done?" autofocus'() ) '#main'( '#toggle-all type=checkbox'() 'UL#todo-list'( 'LI'( 'INPUT.toggle type=checkbox'() 'LABEL'() 'BUTTON.destroy'() ) ) ) '#footer'( '#todo-count'() 'UL#filters'( 'LI'() ) '#clear-completed'() ) )</span></span></code> </pre><br>  Nota: repetindo elementos (por exemplo, aqui est√£o elementos <code>LI</code> ), escrevemos na estrutura uma vez, mesmo se houver v√°rios deles no original;  obviamente, essas s√£o matrizes do mesmo padr√£o. <br><br>  O formato da assinatura, eu acho, √© compreens√≠vel para quem escreveu HTML e CSS com as m√£os, ent√£o n√£o vou me aprofundar em detalhes por enquanto.  S√≥ posso dizer que as etiquetas s√£o escritas em letras mai√∫sculas e a aus√™ncia de uma etiqueta √© equivalente √† presen√ßa de uma etiqueta DIV.  A abund√¢ncia de elementos # (com ID) aqui √© devida √†s especificidades do arquivo CSS inclu√≠do, que usa principalmente seletores de identifica√ß√£o. <br><br><h2>  3. Lembre-se de que o programa dap √© Javascript </h2><br>  Para nos salvar de colchetes desnecess√°rios no c√≥digo, o mecanismo dap injeta v√°rios m√©todos diretamente no <code>String.prototype</code> (eu sei que implementar seus m√©todos em objetos padr√£o √© ayahay, mas ... em suma, passamos), que converte a string de assinatura em dap modelo.  Um desses m√©todos √© <code>.d(rule, ...children)</code> .  O primeiro argumento necess√°rio √© uma regra de gera√ß√£o (regra <i>-d</i> ), e o restante dos argumentos √© um n√∫mero arbitr√°rio de filhos. <br><br>  Com base nesse novo conhecimento, adicionamos nosso c√≥digo para que, em vez de cada chave de abertura, tenhamos a sequ√™ncia <code>.d(""</code> e antes de cada cita√ß√£o simples de abertura, exceto a primeira, h√° uma v√≠rgula. Life hack: voc√™ pode usar a substitui√ß√£o autom√°tica. <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#header'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'H1'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'INPUT#new-todo placeholder="What needs to be done?" autofocus'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#main'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#toggle-all type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'LABEL'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'BUTTON.destroy'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ) ) ,<span class="hljs-string"><span class="hljs-string">'#footer'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'#todo-count'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ,<span class="hljs-string"><span class="hljs-string">'UL#filters'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) ,<span class="hljs-string"><span class="hljs-string">'#clear-completed'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span>) ) )</code> </pre><br>  Voila!  Temos uma √°rvore de chamadas para o m√©todo <code>.d</code> , que est√° pronto para se transformar em um modelo dap.  As cadeias vazias <code>""</code> s√£o as sementes das futuras regras d e os filhos s√£o argumentos separados por v√≠rgulas.  Formalmente, este √© um programa dap v√°lido, embora ainda n√£o completamente com a exaust√£o de que precisamos.  Mas j√° pode ser lan√ßado!  Para fazer isso, ap√≥s o fechamento do colchete raiz, adicione o m√©todo <code>.RENDER()</code> .  Esse m√©todo, como o pr√≥prio nome indica, renderiza o modelo resultante. <br><br>  Portanto, nesta fase, temos um arquivo .html com este conte√∫do: <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Todo -- dap sample&lt;/title&gt; &lt;link rel="stylesheet" href="https://www.todobackend.com/client/css/vendor/todomvc-common.css"/&gt; &lt;script src="https://dap.js.org/0.4.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; '#todoapp'.d("" ,'#header'.d("" ,'H1'.d("") ,'INPUT#new-todo placeholder="What needs to be done?" autofocus'.d("") ) ,'#main'.d("" ,'#toggle-all type=checkbox'.d("") ,'UL#todo-list'.d("" ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("") ,'LABEL'.d("") ,'BUTTON.destroy'.d("") ) ) ) ,'#footer'.d("" ,'#todo-count'.d("") ,'UL#filters'.d("" ,'LI'.d("") ) ,'#clear-completed'.d("") ) ) .RENDER() //   dap   &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  Voc√™ pode <a href="http://dap.js.org/samples/tutorial/3.html" rel="nofollow">abri-lo em um navegador</a> para garantir que os elementos DOM sejam gerados, os estilos CSS sejam aplicados, resta apenas preencher este modelo com dados. <br><br><h2>  4. Obtenha os dados </h2><br>  Vamos para <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">a p√°gina original</a> , abrimos a guia Rede nas ferramentas, ligamos o filtro XHR e vemos de onde v√™m os dados e de que forma. <br><br><img src="https://habrastorage.org/webt/vf/ff/4l/vfff4lreh7nhj6jpgb8re83wb-s.png"><br><br><img src="https://habrastorage.org/webt/qi/lh/ga/qilhganpuhmmtevpnyuytm1uadu.png"><br><br>  Ok, ok.  A lista de tarefas √© obtida diretamente de <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">todo-backend-express.herokuapp.com</a> como uma matriz json de objetos.  √ìtimo <br><br>  Para receber dados, a dap possui um conversor <code>:query</code> que "converte" de forma ass√≠ncrona o URL nos dados recebidos dele.  A pr√≥pria URL, n√£o escreveremos diretamente na regra, e a denotaremos pela constante <code>todos</code> ;  todo o design de minera√ß√£o de dados ficar√° assim: <br><br><pre> <code class="javascript hljs">todos:query</code> </pre><br>  e escreva a constante <code>todos</code> no dicion√°rio - na se√ß√£o <code>.DICT</code> , logo antes de <code>.RENDER()</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'#todoapp'</span></span>.d(<span class="hljs-string"><span class="hljs-string">""</span></span> ... ) .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"https://todo-backend-express.herokuapp.com/"</span></span> }) .RENDER()</code> </pre><br>  Ap√≥s receber a matriz <code>todos</code> , constru√≠mos uma lista de tarefas: para cada caso, pegamos o nome do campo <code>.title</code> e o escrevemos no elemento <code>LABEL</code> , e no campo <code>.completed</code> o sinal de ‚Äúcompletude‚Äù e <code>INPUT.toggle</code> a propriedade <code>checked</code> do elemento <code>INPUT.toggle</code> da <code>checked</code> <code>INPUT.toggle</code> .  √â feito assim: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> <span class="hljs-comment"><span class="hljs-comment">//  *       ,'LI'.d("" ,'INPUT.toggle type=checkbox'.d("#.checked=.completed") // #  " " ,'LABEL'.d("! .title") //  !      ,'BUTTON.destroy'.d("") ) )</span></span></code> </pre><br>  Atualizamos esta p√°gina no navegador e ... se voc√™ a iniciar no sistema de arquivos, nada acontece.  O problema √© que os navegadores modernos n√£o permitem solicita√ß√µes XHR entre dom√≠nios de documentos locais. <br><br><img src="https://habrastorage.org/webt/tm/fy/bi/tmfybiqw7s2geblqodepfg7k7lk.png"><br><br>  √â hora de assistir nossa p√°gina via http - usando qualquer servidor web local.  Bem, ou se voc√™ n√£o estiver pronto para escrever o dap com suas pr√≥prias m√£os, veja vers√µes seq√ºenciais da p√°gina usando meus links (n√£o se esque√ßa de olhar a fonte - no Chrome, isso √© feito usando Ctrl + U) <br><br>  Ent√£o, vamos <a href="http://dap.js.org/samples/tutorial/4.html" rel="nofollow">√† nossa p√°gina em http: //</a> e vemos que os dados est√£o chegando, a lista est√° sendo constru√≠da.  √ìtimo!  Voc√™ j√° dominou os operadores <code>*</code> e <code>!</code>  , conversor <code>:query</code> , constantes e acesso aos campos do elemento atual da matriz.  Veja novamente o c√≥digo resultante.  Ainda parece ileg√≠vel para voc√™? <br><br><h2>  5. Adicione estado </h2><br>  Talvez voc√™ j√° tenha tentado clicar nas marcas de sele√ß√£o na lista de tarefas.  As pr√≥prias caixas de sele√ß√£o mudam de cor, mas, diferentemente do original, o elemento pai do <code>LI</code> n√£o altera seu estilo (o "trabalho conclu√≠do" deve ficar cinza e riscado, mas isso n√£o acontece) - as coisas n√£o mudam de <i>estado</i> .  Mas esses elementos ainda n√£o possuem nenhum estado e, portanto, n√£o podem alter√°-lo.  Agora vamos consertar isso. <br><br>  Adicione um estado de "conclus√£o" ao elemento <code>LI</code> .  Para fazer isso, defina a <i>vari√°vel de estado</i> <code>$completed</code> em sua regra-d.  Para o <code>INPUT.toggle</code> , que pode alterar esse estado, atribuiremos uma regra de rea√ß√£o apropriada (regra da <i>interface</i> do <code>INPUT.toggle</code> ), que definir√° a vari√°vel <code>$completed</code> acordo com seu pr√≥prio sinalizador <code>checked</code> (‚Äúa daw est√° ativada‚Äù).  Dependendo do estado de <code>$completed</code> elemento <code>LI</code> ativar√° ou desativar√° a classe CSS "conclu√≠da". <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'UL#todo-list'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"*@ todos:query"</span></span> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed"</span></span><span class="hljs-comment"><span class="hljs-comment">//  ,    .completed ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") //       .ui("$completed=#.checked") //    $completed ,'LABEL'.d("! .title") ,'BUTTON.destroy'.d("") ) .a("!? $completed") //     $completed,    css- completed )</span></span></code> </pre><br>  Tais manipula√ß√µes com classes CSS s√£o uma coisa bastante comum; portanto, existe um operador especial no dap para elas !? <br>  Observe que fazemos isso na <i>regra geral</i> (da palavra acumular).  Por que n√£o na regra d?  A diferen√ßa entre esses dois tipos de regras √© que, ao atualizar, a regra d reconstr√≥i completamente o conte√∫do do elemento, excluindo o antigo e o novo novamente, enquanto a regra geral n√£o toca no conte√∫do existente do elemento, mas ‚Äúanexa‚Äù o resultado ao que j√° est√° l√°.  A altera√ß√£o de um √∫nico atributo de um elemento <code>LI</code> n√£o requer a reestrutura√ß√£o do restante de seu conte√∫do; portanto, √© mais racional fazer isso na regra. <br><br>  N√≥s olhamos para o <a href="http://dap.js.org/samples/tutorial/5-1.html" rel="nofollow">resultado</a> .  J√° √© melhor: clicar nas caixas de sele√ß√£o altera o estado do item de pend√™ncia correspondente e, de acordo com esse estado, o estilo visual do elemento tamb√©m muda.  Mas ainda h√° um problema: se a lista de tarefas conclu√≠das estiver presente inicialmente, elas n√£o ficar√£o cinza, porque, por padr√£o, a regra geral n√£o √© executada quando o elemento √© gerado.  Para execut√°-lo mesmo durante a gera√ß√£o, adicionamos o operador <code>a!</code> √Ä regra d do elemento <code>LI</code> <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//      $completed    a-</span></span></code> </pre><br>  <a href="http://dap.js.org/samples/tutorial/5-2.html" rel="nofollow">N√≥s olhamos</a> .  Ok  Com o status de <code>$completed</code> resolvido.  Os casos conclu√≠dos s√£o estilizados corretamente na inicializa√ß√£o inicial e durante a altern√¢ncia manual subsequente. <br><br><h2>  6. Editando nomes de casos </h2><br>  Voltar ao <a href="https://todo-backend-express.herokuapp.com/" rel="nofollow">original</a> .  Ao clicar duas vezes no nome do caso, o modo de edi√ß√£o √© ativado, no qual esse nome pode ser alterado.  √â implementado de tal maneira que o modelo do modo de exibi√ß√£o "view" (com um daw, um t√≠tulo e um bot√£o de exclus√£o) fica completamente oculto, e o elemento <code>INPUT class="edit"</code> √© exibido.  Faremos isso de maneira um pouco diferente - ocultaremos apenas o elemento <code>LABEL</code> , pois os outros dois elementos n√£o interferem em nossa edi√ß√£o.  Basta adicionar a classe <code>view</code> ao elemento <code>LABEL</code> . <br><br>  Para o estado "edi√ß√£o", defina a vari√°vel de <code>$editing</code> no elemento <code>LI</code> .  Inicialmente, ele (estado) √© redefinido, <code>dblclick</code> por <code>dblclick</code> no elemento <code>LABEL</code> e desativado quando o elemento <code>INPUT.edit</code> est√° fora de foco.  Ent√£o escrevemos: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$completed=#.checked") ,'LABEL.view' .d("? $editing:!; ! .title") //  $editing ,     .e("dblclick","$editing=`yes") //  dblclick  $editing ,'INPUT.edit' .d("? $editing; !! .title@value") //  $editing  .ui(".title=#.value") //  .title   change (ui     INPUT) .e("blur","$editing=") //  $editing   blur ,'BUTTON.destroy'.d("") ).a("!? $completed $editing") //   $completed  $editing  css-  'LI'</span></span></code> </pre><br>  Agora podemos editar os nomes dos casos. <br><br><h2>  7. Enviando dados para o servidor </h2><br>  Ok, j√° podemos editar as coisas no navegador, mas essas altera√ß√µes tamb√©m devem ser transferidas para o servidor.  Observamos como o original faz: <br><br><img src="https://habrastorage.org/webt/jd/r5/bw/jdr5bwsa8yi7wu4sbwxqr3bwcdi.png"><br><br>  As altera√ß√µes s√£o enviadas ao servidor usando o m√©todo PATCH com um determinado URL no formato <code>http://todo-backend-express.herokuapp.com/28185</code> , que, obviamente, √© exclusivo para cada caso.  Este URL √© indicado pelo servidor no campo <code>.url</code> para cada caso na lista.  Ou seja, tudo o que √© necess√°rio para atualizar o caso no servidor √© enviar uma solicita√ß√£o PATCH para o endere√ßo especificado no campo <code>.url</code> , com os dados alterados no formato JSON: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.edit'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"? $editing; !! .title@value"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) .e(<span class="hljs-string"><span class="hljs-string">"blur"</span></span>,<span class="hljs-string"><span class="hljs-string">"$editing="</span></span>)</code> </pre><br>  Aqui usamos o mesmo conversor <code>:query</code> , mas em uma vers√£o mais detalhada.  Quando <code>:query</code> √© aplicada a uma sequ√™ncia simples, essa sequ√™ncia √© tratada como uma URL e uma solicita√ß√£o GET √© executada.  Se <code>:query</code> recebe um objeto complexo, como neste caso, trata-o como uma descri√ß√£o detalhada da solicita√ß√£o que cont√©m os campos <code>.method</code> , <code>.url</code> , <code>.headers</code> e <code>.body</code> e executa a solicita√ß√£o de acordo com eles.  Aqui, imediatamente ap√≥s a atualiza√ß√£o do <code>.title</code> enviamos ao servidor uma solicita√ß√£o PATCH com este <code>.title</code> atualizado <br><br>  Mas h√° uma nuance.  N√≥s obtemos o campo <code>.url</code> do servidor, √© algo como isto: <code>http://todo-backend-express.herokuapp.com/28185</code> , ou seja, o protocolo http: // √© codificado permanentemente se o nosso cliente tamb√©m estiver aberto via http: // ent√£o est√° tudo bem.  Mas se o cliente estiver aberto via https: //, surgir√° um problema: por motivos de seguran√ßa, o navegador bloqueia o tr√°fego http da fonte https. <br><br>  √â resolvido de forma simples: se voc√™ remover o protocolo de <code>.url</code> , a solicita√ß√£o passar√° pelo protocolo da p√°gina.  Ent√£o vamos fazer isso: escreva o conversor apropriado - <code>dehttp</code> e passaremos <code>.url</code> por ele.  Conversores personalizados (e outras funcionalidades) s√£o <code>.FUNC</code> na se√ß√£o <code>.FUNC</code> : <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp (@Content-type`application/json)@headers (.title):json.encode@body):query"</span></span>) ... .FUNC({ <span class="hljs-attr"><span class="hljs-attr">convert</span></span>:{ <span class="hljs-comment"><span class="hljs-comment">//  -         dehhtp: url=&gt;url.replace(/^https?\:/,'')//    URL } })</span></span></code> </pre><br>  Tamb√©m faz sentido colocar o objeto de cabe√ßalhos no dicion√°rio para que ele possa ser usado em outras consultas: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title):json.encode@body):query"</span></span>) ... .DICT({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span> : <span class="hljs-string"><span class="hljs-string">"//todo-backend-express.herokuapp.com/"</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: {<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>:<span class="hljs-string"><span class="hljs-string">"application/json"</span></span>} })</code> </pre><br>  Bem, para o feng shui completo, usaremos outra propriedade √∫til do conversor <code>:query</code> - codifica√ß√£o autom√°tica do corpo da solicita√ß√£o em json, de acordo com o cabe√ßalho <code>Content-type:application/json</code> .  Como resultado, a regra ficar√° assim: <br><br><pre> <code class="javascript hljs"> .ui(<span class="hljs-string"><span class="hljs-string">".title=#.value; (@method`PATCH .url:dehttp headers (.title)):query"</span></span>)</code> </pre><br>  Ent√£o <a href="http://dap.js.org/samples/tutorial/7-2.html" rel="nofollow">olha</a> .  Ok, os nomes dos casos agora mudam n√£o apenas no navegador, mas tamb√©m no servidor.  Mas!  N√£o apenas o nome do caso pode mudar, mas tamb√©m seu estado de conclus√£o - <code>completed</code> .  Portanto, ele tamb√©m precisa ser enviado ao servidor. <br>  Voc√™ pode adicionar a mesma solicita√ß√£o PATCH ao elemento <code>INPUT.toggle</code> , basta enviar <code>(.completed)</code> vez de <code>(.completed)</code> : <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'INPUT.toggle type=checkbox'</span></span> .d(<span class="hljs-string"><span class="hljs-string">"#.checked=.completed"</span></span>) .ui(<span class="hljs-string"><span class="hljs-string">"$completed=#.checked; (@method`PATCH .url:dehttp headers (.completed:?)):query"</span></span>)</code> </pre><br>  E voc√™ pode colocar essa solicita√ß√£o de PATCH ‚Äúentre colchetes‚Äù: <br><br><pre> <code class="javascript hljs"> ,<span class="hljs-string"><span class="hljs-string">'LI'</span></span>.d(<span class="hljs-string"><span class="hljs-string">"$completed=.completed $editing= $patch=; a!"</span></span> <span class="hljs-comment"><span class="hljs-comment">// $patch - ""   ,'INPUT.toggle type=checkbox' .d("#.checked=.completed") .ui("$patch=($completed=#.checked)") //   $patch  completed ,'LABEL.view' .d("? $editing:!; ! .title") .e("dblclick","$editing=`yes") ,'INPUT.edit' .d("? $editing; !! .title@value") .ui("$patch=(.title=#.value)") //   $patch  title .e("blur","$editing=") ,'BUTTON.destroy'.d("") ) .a("!? $completed $editing") //  $patch  ,   ,   .u("? $patch; (@method`PATCH .url:dehttp headers $patch@):query $patch=")</span></span></code> </pre><br>  Aqui est√° a coisa.  As regras de rea√ß√£o pertencem ao grupo ‚Äúup-rules‚Äù, que √© executado ‚Äúde baixo para cima‚Äù - do descendente ao pai, at√© a pr√≥pria raiz (essa sequ√™ncia pode ser interrompida, se necess√°rio).  √â como os eventos pop-up no DOM.  Portanto, alguns fragmentos da rea√ß√£o comum a v√°rios descendentes podem ser atribu√≠dos a um ancestral comum. <br><br>  Especificamente, no nosso caso, o ganho dessa delega√ß√£o n√£o √© particularmente percept√≠vel, mas se houvesse mais campos edit√°veis, colocar essa solicita√ß√£o volumosa (pelos padr√µes dap, √© claro) em uma regra geral ajudaria muito a manter o c√≥digo simples e leg√≠vel.  Ent√£o eu recomendo. <br><br>  <a href="http://dap.js.org/samples/tutorial/7-3.html" rel="nofollow">Observamos</a> : Agora, as altera√ß√µes de nome e de status s√£o enviadas ao servidor. <br><br>  No pr√≥ximo artigo, se voc√™ estiver interessado, considere adicionar, remover e filtrar casos.  Enquanto isso, voc√™ pode ver o <a href="https://dap.js.org/samples/todo.html" rel="nofollow">resultado final</a> e outros exemplos de c√≥digo dap em <a href="https://dap.js.org/docs/" rel="nofollow">dap.js.org/docs</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt480912/">https://habr.com/ru/post/pt480912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt480900/index.html">Traga de volta meu beb√™! (N.-F. hist√≥ria)</a></li>
<li><a href="../pt480902/index.html">Novos recursos de monitoramento do PostgesSQL PostgreSQL</a></li>
<li><a href="../pt480904/index.html">Framework de Microservice PHP: Ambiente de Desenvolvimento para Swoft</a></li>
<li><a href="../pt480906/index.html">Escrevendo um jogo python simples</a></li>
<li><a href="../pt480910/index.html">Como criar uma classe de teste b√°sica para testes do Selenium e inicializar atrav√©s do JUnit RuleChain</a></li>
<li><a href="../pt480914/index.html">Microsservi√ßos para iniciantes</a></li>
<li><a href="../pt480918/index.html">Qualidade de c√≥digo do Apache Hadoop: teste de produ√ß√£o vs.</a></li>
<li><a href="../pt480920/index.html">Teste de switches TP-Link com PoE de longo alcance. E um pouco sobre atualiza√ß√µes de modelos antigos</a></li>
<li><a href="../pt480922/index.html">Evgeny Usvitsky: ‚ÄúTodos no mundo sabem onde obter geodados livremente - apenas no OSM‚Äù</a></li>
<li><a href="../pt480924/index.html">Como e por que os criadores do remake de MediEvil redesenharam o chefe cult do jogo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>