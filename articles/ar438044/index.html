<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐ฒ๐ฝ ๐ช๐ป ูุฑุญุจุง ุงูุนุงูู ุงูุชุญููู ๐จ๐ผโ๐ญ ๐ฉ๐ผโโ๏ธ ๐ฉ๐พโ๐คโ๐ฉ๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello World ูู ุฃุญุฏ ุงูุจุฑุงูุฌ ุงูุฃููู ุงูุชู ููุชุจูุง ุจุฃู ูุบุฉ ุจุฑูุฌุฉ. 

 ุจุงููุณุจุฉ ูู C ุ ูุจุฏู ุนุงูู ุงูุชุฑุญูุจ ุจุณูุทูุง ููุตูุฑูุง: 



#include <stdio.h> void main() { ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุฑุญุจุง ุงูุนุงูู ุงูุชุญููู</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438044/" style=";text-align:right;direction:rtl">  Hello World ูู ุฃุญุฏ ุงูุจุฑุงูุฌ ุงูุฃููู ุงูุชู ููุชุจูุง ุจุฃู ูุบุฉ ุจุฑูุฌุฉ. <br><br>  ุจุงููุณุจุฉ ูู C ุ ูุจุฏู ุนุงูู ุงูุชุฑุญูุจ ุจุณูุทูุง ููุตูุฑูุง: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; void main() { printf("Hello World!\n"); }</span></span></span></span></code> </pre> <br>  ูุธุฑูุง ูุฃู ุงูุจุฑูุงูุฌ ูุตูุฑ ุฌุฏูุง ุ ูุฌุจ ุฃู ูููู ูู ุงูุถุฑูุฑู ุดุฑุญ ูุง ูุญุฏุซ "ุชุญุช ุงูุบุทุงุก". <br><a name="habracut"></a><br>  ุฃููุงู ุ ุฏุนููุง ูุฑู ูุง ูุญุฏุซ ุนูุฏ ุงูุชุฌููุน ูุงูุฑุจุท: <br> <code>gcc --save-temps hello.c -o hello</code> <br> <br>  <code>--save-temps</code> ุจุญูุซ ูุชุฑู gcc <code>hello.s</code> ุ ููู ุฑูุฒ ุงูุชุฌููุน. <br><br>  ูููุง ููู ูููุฐุฌ ูุฌูุน ุงูุดูุฑุฉ ุงูุฐู ุชูููุชู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> .file "hello.c" .section .rodata .LC0: .string "Hello World!" .text .globl main .type main, @function main: pushq %rbp movq %rsp, %rbp movl $.LC0, %edi call puts popq %rbp ret</code> </pre> <br>  ููุง ุชุฑูู ูู ูุงุฆูุฉ ุงููุฌููุน ุ ูุฅูู ููุณ <code>printf</code> ูุณูู ุ ูููู <code>puts</code> .  ูุชู ุฃูุถูุง ุชุนุฑูู ูุธููุฉ <code>puts</code> ูู ููู <code>stdio.h</code> ูุชูุชุฒู ุจุทุจุงุนุฉ ุณุทุฑ ููุณุฑ ูุงุตู. <br><br>  ุญุณููุง ุ ููุฏ ููููุง ุงููุธููุฉ ุงูุชู ุชุณุชุฏุนููุง ุงูููุฏ.  ูููู ุฃูู ูุชู <code>puts</code> ุชููุฐุ <br><br>  ูุชุญุฏูุฏ ุฃู ููุชุจุฉ ุชุทุจู ุ ูุณุชุฎุฏู <code>ldd</code> ุ ุงูุฐู ูุนุฑุถ ุชุจุนูุงุช ุงูููุชุจุฉ ุ ู <code>nm</code> ุ ูุงูุฐู ูุนุฑุถ ุฃุญุฑู ููู ุงููุงุฆู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ ldd hello libc.so.6 =&gt; /lib64/libc.so.6 (0x0000003e4da00000) $ nm /lib64/libc.so.6 | grep " puts" 0000003e4da6dd50 W puts</code> </pre> <br>  ุชูุฌุฏ ุงููุธููุฉ ูู ููุชุจุฉ ุชุณูู <code>libc</code> ูุชูุน ูู <code>/lib64/libc.so.6</code> ุนูู <code>/lib64/libc.so.6</code> (Fedora 19).  ูู ุญุงูุชู ุ ูุนุฏ <code>/lib64</code> ุนูู <code>/usr/lib64</code> ุ ู <code>/lib64</code> ูู <code>/lib64</code> ุนูู <code>/usr/lib64</code> .  ูุฐุง ุงูููู ูุญุชูู ุนูู ุฌููุน ุงููุธุงุฆู. <br><br>  ุงูุชุดููุง ุฅุตุฏุงุฑ <code>libc</code> ุนู ุทุฑูู ุชุดุบูู ุงูููู ููุง ูู ูุงู ูุงุจูุงู ููุชูููุฐ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">$ /usr/lib64/libc-2.17.so GNU C Library (GNU libc) stable release version 2.17, by Roland McGrath et al. ...</code> </pre> <br>  ูุชูุฌุฉ ูุฐูู ุ ูุณุชุฏุนู ุจุฑูุงูุฌูุง ูุธููุฉ <code>puts</code> ูู <code>glibc</code> ุงูุฅุตุฏุงุฑ 2.17.  ุฏุนููุง ุงูุขู ูุฑู ูุง ุชููู ุจู ูุธููุฉ <code>puts</code> ูู <code>glibc-2.17</code> . <br><br>  ูุตุนุจ ุงูุชููู ุจุฑูุฒ glibc ุจุณุจุจ ุงูุงุณุชุฎุฏุงู ุงููุงุณุน ุงููุทุงู ููุญุฏุงุช ูุง ูุจู ุงููุนุงูุฌุฉ ูุงูุจุฑุงูุฌ ุงููุตูุฉ.  ุจุงููุธุฑ ุฅูู ุงูููุฏ ุ ูุฑู ูุง ููู ูู <code>libio/ioputs.c</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">weak_alias (_IO_puts, <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>)</code> </pre> <br>  ูู glibc ุ ูุฐุง ูุนูู ุฃูู ุนูุฏ ุงุณุชุฏุนุงุก ุงูููุงููุงุช ุ ูุชู ุงุณุชุฏุนุงุก <code>_IO_puts</code> ุจุงููุนู.  ุชู ุชูุถูุญ ูุฐู ุงููุธููุฉ ูู ููุณ ุงูููู ุ ููุจุฏู ุงูุฌุฒุก ุงูุฑุฆูุณู ูู ูุฐู ุงููุธููุฉ ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _IO_puts (str) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *str; { <span class="hljs-comment"><span class="hljs-comment">//... _IO_sputn (_IO_stdout, str, len) //... }</span></span></code> </pre> <br>  ุฑููุช ูู ุงูููุงูุฉ ุญูู ุงูุชุญุฏู ุงูููู ููุง.  ุงูุขู <code>_IO_sputn</code> ูู <code>_IO_sputn</code> ุงูุญุงูู ูู ุณูุณูุฉ ููุงููุงุช hello world.  ูุฌุฏ ุชุนุฑูููุง ุ ูุฐุง ุงูุงุณู ูู ูุงูุฑู ูุนุฑู ูู <code>libio/libioP.h</code> ูุงูุฐู ูุณุชุฏุนู ูุงูุฑู ุขุฎุฑ ุ ูุงูุฐู ูุฑุฉ ุฃุฎุฑู ... ุชุญุชูู ุดุฌุฑุฉ ุงููุงูุฑู ุนูู ุงูุดุฎุต ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _IO_sputn(__fp, __s, __n) _IO_XSPUTN (__fp, __s, __n) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//... #define _IO_XSPUTN(FP, DATA, N) JUMP2 (__xsputn, FP, DATA, N) //... #define JUMP2(FUNC, THIS, X1, X2) (_IO_JUMPS_FUNC(THIS)-&gt;FUNC) (THIS, X1, X2) //... # define _IO_JUMPS_FUNC(THIS) \ (*(struct _IO_jump_t **) ((void *) &amp;_IO_JUMPS ((struct _IO_FILE_plus *) (THIS)) + (THIS)-&gt;_vtable_offset)) //... #define _IO_JUMPS(THIS) (THIS)-&gt;vtable</span></span></span></span></code> </pre> <br>  ูุงุฐุง ุจุญู ุงูุฌุญูู ูุญุฏุซ ููุงุ  ุฏุนูุง ููุณุน ูู ูุญุฏุงุช ุงููุงูุฑู ูููุธุฑ ูู ุงูููุฏ ุงูููุงุฆู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"> ((*(struct _IO_jump_t **) ((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) &amp;((struct _IO_FILE_plus *) (((_IO_FILE*)(&amp;_IO_2_1_stdout_)) ) )-&gt;vtable+(((_IO_FILE*)(&amp;_IO_2_1_stdout_)) )-&gt;_vtable_offset))-&gt;__xsputn ) (((_IO_FILE*)(&amp;_IO_2_1_stdout_)), str, len)</code> </pre><br>  ุนููู ุชุคุฐู.  ุงุณูุญูุง ูู ุฃู ุฃุดุฑุญ ูุง ูุญุฏุซ ููุง.  ูุณุชุฎุฏู Glibc ุฌุฏูู ุงูููุฒ ูุงุณุชุฏุนุงุก ูุธุงุฆู.  ูู ุญุงูุชูุง ุ ููุน ุงูุฌุฏูู ูู ุจููุฉ ุชุณูู <code>_IO_2_1_stdout_</code> ุ ูุชุณูู ุงููุธููุฉ ุงูุชู ูุญุชุงุฌ ุฅูููุง <code>__xsputn</code> . <br><br>  ุชู ุงูุชุตุฑูุญ ุนู ุงูุจููุฉ ูู ููู <code>libio/libio.h</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO_FILE_plus</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO_2_1_stdout_</span></span></span><span class="hljs-class">;</span></span></code> </pre> <br>  ููู ุงูููู <code>libio/libioP.h</code> ุชุนุฑููุงุช ูููููู ูุงูุฌุฏูู <code>libio/libioP.h</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO_FILE_plus</span></span></span><span class="hljs-class"> {</span></span> _IO_FILE file; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IO_jump_t</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vtable</span></span></span><span class="hljs-class">;</span></span> }; <span class="hljs-comment"><span class="hljs-comment">//... struct _IO_jump_t { //... JUMP_FIELD(_IO_xsputn_t, __xsputn); //... JUMP_FIELD(_IO_read_t, __read); JUMP_FIELD(_IO_write_t, __write); JUMP_FIELD(_IO_seek_t, __seek); JUMP_FIELD(_IO_close_t, __close); JUMP_FIELD(_IO_stat_t, __stat); //... };</span></span></code> </pre> <br>  ุฅุฐุง <code>_IO_2_1_stdout_</code> ุฃุนูู ุ <code>_IO_2_1_stdout_</code> ุฃู ุงูุฌุฏูู <code>_IO_2_1_stdout_</code> ุชููุฆุชู ูู ุงูููู <code>libio/stdfiles.c</code> ุ ููุชู ุชุญุฏูุฏ ุงูุชุทุจููุงุช <code>libio/stdfiles.c</code> ููุธุงุฆู ุงูุฌุฏูู ูู <code>libio/fileops.c</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* from libio/stdfiles.c */</span></span> DEF_STDFILE(_IO_2_1_stdout_, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;_IO_2_1_stdin_, _IO_NO_READS); <span class="hljs-comment"><span class="hljs-comment">/* from libio/fileops.c */</span></span> <span class="hljs-meta"><span class="hljs-meta"># </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _IO_new_file_xsputn _IO_file_xsputn </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//... const struct _IO_jump_t _IO_file_jumps = { //... JUMP_INIT(xsputn, _IO_file_xsputn), //... JUMP_INIT(read, _IO_file_read), JUMP_INIT(write, _IO_new_file_write), JUMP_INIT(seek, _IO_file_seek), JUMP_INIT(close, _IO_file_close), JUMP_INIT(stat, _IO_file_stat), //... };</span></span></span></span></code> </pre> <br>  ูู ูุฐุง ูุนูู ุฃููุง ุฅุฐุง ุงุณุชุฎุฏููุง ุฌุฏูู ุงูููุฒ ุงููุฑุชุจุท ุจู <code>stdout</code> ุ ูุณูููู ูู ุงูููุงูุฉ ุจุงุณุชุฏุนุงุก ุงูุฏุงูุฉ <code>_IO_new_file_xsputn</code> .  ุจุงููุนู ุฃูุฑุจ ุ ุฃููุณ ูุฐููุ  ูุฐู ุงููุธููุฉ ุชููู ุงูุจูุงูุงุช ูู ุงููุฎุงุฒู ุงููุคูุชุฉ ูุชุฏุนู <code>new_do_write</code> ุนูุฏูุง ูููู ุฅุฎุฑุงุฌ ูุญุชููุงุช ุงููุฎุฒู ุงููุคูุช.  ูุฐุง ูุง ูุจุฏู ุนููู <code>new_do_write</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> _<span class="hljs-function"><span class="hljs-function">IO_size_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_do_write</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fp, data, to_do)</span></span></span><span class="hljs-function"> _IO_FILE *fp</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *data; _IO_size_t to_do; { _IO_size_t count; .. count = _IO_SYSWRITE (fp, data, to_do); .. <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count; }</code> </pre> <br>  ุจุงูุทุจุน ุ ุงููุงูุฑู ูุณูู.  ูู ุฎูุงู ููุณ ุขููุฉ ุงูุงูุชูุงู <code>__xsputn</code> ูู <code>__xsputn</code> ุ ูุชู <code>__write</code> .  ุจุงููุณุจุฉ ููููุงุช <code>__write</code> ุ <code>__write</code> <code>_IO_new_file_write</code> ุฅูู <code>_IO_new_file_write</code> .  ูุชุณูู ูุฐู ุงููุธููุฉ ูู ููุงูุฉ ุงููุทุงู.  ุฏุนูุง ููุธุฑ ููุงุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">_IO_ssize_t _IO_new_file_write (f, data, n) _IO_FILE *f; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *data; _IO_ssize_t n; { _IO_ssize_t to_do = n; _IO_ssize_t count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (to_do &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// .. write (f-&gt;_fileno, data, to_do)); // .. }</span></span></code> </pre> <br>  ุฃุฎูุฑูุง ุ ูุธููุฉ ุชุณุชุฏุนู ุดูุฆูุง ูุง ูุจุฏุฃ ุจุชุณุทูุฑ ุฃุณูู ุงูุณุทุฑ!  ูุธููุฉ <code>write</code> ูุนุฑููุฉ ููุญุฏุฏุฉ ูู <code>unistd.h</code> .  ูุฐู ุทุฑููุฉ ููุงุณูุฉ ุฅูู ุญุฏ ูุง ููุชุงุจุฉ ุจุงูุช ุฅูู ููู ุจุงุณุชุฎุฏุงู ูุงุตู ููู.  ูุชู ุชุนุฑูู ูุธููุฉ <code>write</code> ูู glibc ููุณูุง ุ ูุฐูู ูุญู ุจุญุงุฌุฉ ุฅูู ุงูุนุซูุฑ ุนูู ุงูููุฏ. <br><br>  ููุฏ ูุฌุฏุช ุฑูุฒ <code>write</code> ูู <code>sysdeps/unix/syscalls.list</code> .  ูุชู ุฅูุดุงุก ูุนุธู ููุงููุงุช ุงููุธุงู ูููููุฉ ูู glibc ูู ูุฐู ุงููููุงุช.  ูุญุชูู ุงูููู ุนูู ุงุณู ุงููุธููุฉ ูุงููุณูุทุงุช ุงูุชู ุชุชุทูุจูุง.  ูุชู ุฅูุดุงุก ูุต ุงูุฏุงูุฉ ูู ููุท ุงุณุชุฏุนุงุก ูุธุงู ุดุงุฆุน. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># File name Caller Syscall name Args Strong name Weak names ... write - write Ci:ibn __libc_write __write write ...</code> </pre> <br>  ุนูุฏ ุงุณุชุฏุนุงุก ุฑูุฒ glibc <code>write</code> (ุฅูุง <code>__libcwrite</code> ุฃู <code>__write</code> ) ุ ูุญุฏุซ syscall ูู kernel.  ุฑูุฒ Kernel ุฃูุซุฑ ูุงุจููุฉ ูููุฑุงุกุฉ ูู glibc.  ููุทุฉ ุงูุฅุฏุฎุงู ุฅูู syscall <code>write</code> ูู <code>fs/readwrite.c</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs">SYSCALL_DEFINE3(write, <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, fd, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> __user *, buf, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>, count) { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fd</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fdget</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fd</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> ret = -EBADF; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f.file) { <span class="hljs-keyword"><span class="hljs-keyword">loff_t</span></span> pos = file_pos_read(f.file); ret = vfs_write(f.file, buf, count, &amp;pos); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ret &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) file_pos_write(f.file, pos); fdput(f); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre> <br>  ุฃููุงู ุ ุชู ุงูุนุซูุฑ ุนูู ุงูุจููุฉ ุงููุชูุงููุฉ ูุน ูุงุตู ุงูููู ุ ุซู ูุชู <code>vfs_write</code> ุงูุฏุงูุฉ <code>vfs_write</code> ูู ุงููุธุงู ุงููุฑุนู ููุธุงู ุงููููุงุช ุงูุธุงูุฑู (vfs).  ุณูุชูุงูู ุงููููู ูู ุญุงูุชูุง ูุน ููู <code>stdout</code> .  ุฃููู ูุธุฑุฉ ุนูู <code>vfs_write</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> vfs_write(struct file *file, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> __user *buf, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> count, <span class="hljs-keyword"><span class="hljs-keyword">loff_t</span></span> *pos) { <span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span> ret; <span class="hljs-comment"><span class="hljs-comment">//... ret = file-&gt;f_op-&gt;write(file, buf, count, pos); //... return ret; }</span></span></code> </pre> <br>  ุชููุถ ุงููุธููุฉ ุชูููุฐ ูุธููุฉ <code>write</code> ุงูุฎุงุตุฉ ุจููู ูุนูู.  ูู ูุธุงู Linux ุ ุบุงูุจูุง ูุง ูุชู ุชุทุจูู ุฐูู ูู ุฑูุฒ ุจุฑูุงูุฌ ุงูุชุดุบูู ุ ูุฐูู ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุจุฑูุงูุฌ ุงูุชุดุบูู ุงูุฐู ูุณูู ูู ุญุงูุชูุง. <br><br>  ุฃุณุชุฎุฏู Fedora 19 ูุน Gnome 3. ูุฅุฌุฑุงุก ุงูุชุฌุงุฑุจ ุ ููุนูู ูุฐุง ุนูู ูุฌู ุงูุฎุตูุต ุฃู ุงูุฌูุงุฒ ุงูุทุฑูู ูู <code>gnome-terminal</code> ุงูุชุฑุงุถููุง.  ูู ุจุชุดุบูู ูุฐุง ุงูุฌูุงุฒ ูููุฐ ูุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">~$ tty /dev/pts/0 ~$ ls -l /proc/self/fd total 0 lrwx------ 1 kos kos 64 okt. 15 06:37 0 -&gt; /dev/pts/0 lrwx------ 1 kos kos 64 okt. 15 06:37 1 -&gt; /dev/pts/0 lrwx------ 1 kos kos 64 okt. 15 06:37 2 -&gt; /dev/pts/0 ~$ ls -la /dev/pts total 0 drwxr-xr-x 2 root root 0 okt. 10 10:14 . drwxr-xr-x 21 root root 3580 okt. 15 06:21 .. crw--w---- 1 kos tty 136, 0 okt. 15 06:43 0 c--------- 1 root root 5, 2 okt. 10 10:14 ptmx</code> </pre> <br>  ูููู ุงูุฃูุฑ <code>tty</code> ุจุทุจุงุนุฉ ุงุณู ุงูููู ุงููุฑุชุจุท ุจุงูุฅุฏุฎุงู ุงูููุงุณู ุ ูููุง ุชุฑูู ูู ูุงุฆูุฉ ุงููููุงุช ูู <code>/proc</code> ุ ูุฑุชุจุท ุงูููู ููุณู <code>/proc</code> ูุฏูู ุงูุฃุฎุทุงุก.  ุชุณูู ูููุงุช ุงูุฌูุงุฒ ุงูููุฌูุฏุฉ ูู <code>/dev/pts</code> ุฒุงุฆูุฉ ุ ูุจุตูุฑุฉ ุฃูุซุฑ ุฏูุฉ ุ ููู ูุญุทุงุช ุฒุงุฆูุฉ ููุฑููู.  ุนูุฏูุง ุชูุชุจ ุนูููุฉ ูุง ุฅูู ูุญุทุฉ ุฒุงุฆูุฉ ููุฑููู ุ ุชูุชูู ุงูุจูุงูุงุช ุฅูู ุงููุญุฏุฉ ุงูุฒุงุฆูุฉ ุงูุฑุฆูุณูุฉ.  ูุงุฌุณุชูุฑ ูุญุทุฉ ุงูุฒุงุฆูุฉ ูู ุฌูุงุฒ <code>/dev/ptmx</code> . <br><br>  ููุฌุฏ ุจุฑูุงูุฌ ุชุดุบูู ุงูุฌูุงุฒ ุงูุฒุงุฆู ูู Linux kernel ูู <code>drivers/tty/pty.c</code> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __<span class="hljs-function"><span class="hljs-function">init </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unix98_pty_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... pts_driver-&gt;driver_name = "pty_slave"; pts_driver-&gt;name = "pts"; pts_driver-&gt;major = UNIX98_PTY_SLAVE_MAJOR; pts_driver-&gt;minor_start = 0; pts_driver-&gt;type = TTY_DRIVER_TYPE_PTY; pts_driver-&gt;subtype = PTY_TYPE_SLAVE; //... tty_set_operations(pts_driver, &amp;pty_unix98_ops); //... /* Now create the /dev/ptmx special device */ tty_default_fops(&amp;ptmx_fops); ptmx_fops.open = ptmx_open; cdev_init(&amp;ptmx_cdev, &amp;ptmx_fops); //... } static const struct tty_operations pty_unix98_ops = { //... .open = pty_open, .close = pty_close, .write = pty_write, //... };</span></span></code> </pre> <br>  ุนูุฏ ุงููุชุงุจุฉ ุฅูู <code>pts</code> ุ ูุชู <code>pty_write</code> ุ ูุงูุฐู ูุจุฏู ููุง ููู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pty_write</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct tty_struct *tty, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tty_struct</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">to</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tty</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">link</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tty-&gt;stopped) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* Stuff the data into the input queue of the other end */</span></span> c = tty_insert_flip_string(to-&gt;port, buf, c); <span class="hljs-comment"><span class="hljs-comment">/* And shovel */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c) { tty_flip_buffer_push(to-&gt;port); tty_wakeup(tty); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> c; }</code> </pre> <br>  ุชุณุงุนุฏ ุงูุชุนูููุงุช ูู ููู ุฃู ุงูุจูุงูุงุช ูู ูุงุฆูุฉ ุงูุชุธุงุฑ ุงูุฅุฏุฎุงู ูุฌูุงุฒ ุงูููุจููุชุฑ ุงูุทุฑูู ุงูุฑุฆูุณู ุงููุฒูู.  ููู ูู ููุฑุฃ ูู ูุฐุง ุงูุฎุทุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">~$ lsof | grep ptmx gnome-ter 13177 kos 11u CHR 5,2 0t0 1133 /dev/ptmx gdbus 13177 13178 kos 11u CHR 5,2 0t0 1133 /dev/ptmx dconf 13177 13179 kos 11u CHR 5,2 0t0 1133 /dev/ptmx gmain 13177 13182 kos 11u CHR 5,2 0t0 1133 /dev/ptmx ~$ ps 13177 PID TTY STAT TIME COMMAND 13177 ? Sl 0:04 /usr/libexec/gnome-terminal-server</code> </pre> <br>  <code>gnome-terminal-server</code> ุนูููุฉ <code>gnome-terminal-server</code> all ุฌููุน <code>gnome-terminal</code> ูุชุฎูู ูุญุทุงุช ุฒุงุฆูุฉ ุฌุฏูุฏุฉ.  ูู ุงูุฐู ูุณุชูุน ุฅูู ูุญุทุฉ ุงูุฒุงุฆูุฉ ุงูุฑุฆูุณูุฉ ุ ููู ุงูููุงูุฉ ุ ุณูุชููู ุจูุงูุงุชูุง ุ ููู <code>"Hello World"</code> .  ูุณุชูุจู ุฎุงุฏู <code>gnome-terminal</code> ุงูุณูุณูุฉ ููุนุฑุถูุง ุนูู ุงูุดุงุดุฉ.  ุจุดูู ุนุงู ุ ูู ููู ููุงู ูุง ูููู ูู ุงูููุช ูุชุญููู ููุตู <code>gnome-terminal</code> :) <br><br><h3 style=";text-align:right;direction:rtl">  ุงูุฎุงุชูุฉ </h3><br>  ุงููุณุงุฑ ุงูุนุงู ูุฎุท "Hello World" ุงูุฎุงุต ุจูุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0.</span></span> hello: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Hello World"</span></span>) <span class="hljs-number"><span class="hljs-number">1.</span></span> glibc: <span class="hljs-built_in"><span class="hljs-built_in">puts</span></span>() <span class="hljs-number"><span class="hljs-number">2.</span></span> glibc: _IO_puts() <span class="hljs-number"><span class="hljs-number">3.</span></span> glibc: _IO_new_file_xsputn() <span class="hljs-number"><span class="hljs-number">4.</span></span> glibc: new_do_write() <span class="hljs-number"><span class="hljs-number">5.</span></span> glibc: _IO_new_file_write() <span class="hljs-number"><span class="hljs-number">6.</span></span> glibc: syscall write <span class="hljs-number"><span class="hljs-number">7.</span></span> kernel: vfs_write() <span class="hljs-number"><span class="hljs-number">8.</span></span> kernel: pty_write() <span class="hljs-number"><span class="hljs-number">9.</span></span> gnome_terminal: read() <span class="hljs-number"><span class="hljs-number">10.</span></span> gnome_terminal: show to user</code> </pre> <br>  ูุจุฏู ููุฃูู ุชูุซุงู ูุตูู <i>ููููุง</i> ููุฐู ุงูุนูููุฉ ุงูุจุณูุทุฉ.  ูู ุงูุฌูุฏ ุฃู ูุฑุงูุง ููุท ุฃููุฆู ุงูุฐูู ูุฑูุฏูููุง ุญููุง. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar438044/">https://habr.com/ru/post/ar438044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar438024/index.html">ุงููุฏููุนุงุช ุงูุณุฑูุนุฉ: ูุง ุชุญุชุงุฌ ุงูุจููู ููููู</a></li>
<li><a href="../ar438026/index.html">RedisPipe - ุฃูุซุฑ ูุชุนุฉ ูุนุง</a></li>
<li><a href="../ar438028/index.html">ูุง ุชุญุชุงุฌ ุฅูู blockchain: 8 ุญุงูุงุช ูุณุชุฎุฏู ุดููุฑุฉ ูููุงุฐุง ูุง ุชุนูู</a></li>
<li><a href="../ar438034/index.html">Android ู Rx ู Kotlin ุ ุฃู ููููุฉ ุฌุนู ูุฎูุจ Lego ูุชููุต. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar438036/index.html">3blue1brown ู MIT ุจุงููุบุฉ ุงูุฑูุณูุฉ</a></li>
<li><a href="../ar438046/index.html">ููููุฉ ุงูุชุฑููุฒ ุงูุฌุบุฑุงูู ููููู ููุทุฉ ุนูู ุณุจุงุฑู ุจุทุฑููุฉ ุณุฑูุนุฉุ</a></li>
<li><a href="../ar438052/index.html">ุงูุชูุงุนู ุ ููุท ุงูุนูููุฉ</a></li>
<li><a href="../ar438058/index.html">"ุชุญููู ุงูุจูุงูุงุช ูู ุจูุซูู" ูู ุฌุฒุฃูู</a></li>
<li><a href="../ar438060/index.html">ุชูุฏูุฑ ุงูุงุชุฌุงู ุงูููุงูู ุ ุฃู ููู ูุง ุชุฎุงููุง ูู ูุฑุดุญุงุช ูุงูููู ููุงุฌููู</a></li>
<li><a href="../ar438062/index.html">ุนููุงูู ููุณ ููุฒู ุฃู ุดุงุฑุน ุ ุนููุงูู ูู ุงูุงุชุญุงุฏ ุงูุณูููุชูุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>