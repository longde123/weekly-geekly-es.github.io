<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèñÔ∏è ü§ê üåè N√≥s escrevemos o carregador FPGA no LabVIEW. Parte 1 üêøÔ∏è üëãüèª üë®üèº‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A maioria dos programadores "normais", para dizer o m√≠nimo, tem uma atitude amb√≠gua em rela√ß√£o √† tecnologia LabVIEW . Aqui voc√™ pode discutir por um l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>N√≥s escrevemos o carregador FPGA no LabVIEW. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427529/"><img src="https://habrastorage.org/webt/2m/nu/6l/2mnu6ljkhtj-pydr_chsebgpp_i.jpeg"><br><p><br>  A maioria dos programadores "normais", para dizer o m√≠nimo, tem uma atitude amb√≠gua em rela√ß√£o √† tecnologia <strong>LabVIEW</strong> .  Aqui voc√™ pode discutir por um longo tempo e sem sucesso.  A situa√ß√£o √© agravada pelo fato de existirem muitos exemplos de programas LabVIEW na rede, mas todos eles s√£o orientados a um iniciante e resumem-se a ‚Äúoh, veja como √© simples, conecte a tor√ß√£o ao indicador, gire o bot√£o, o d√≠gito muda‚Äù ou, na melhor das hip√≥teses, ao gr√°fico no ciclo um n√∫mero aleat√≥rio ou seno √© exibido, tudo isso √© acompanhado por uma interface furiosa na forma de comutadores gigantes, bot√µes girat√≥rios e indicadores de discagem.  Pessoalmente, essa abordagem de simplifica√ß√£o consciente me incomoda.  Em uma curta s√©rie de artigos, tentarei apresentar ao leitor o processo de desenvolvimento de software aplicativo no LabVIEW.  Para n√£o dedicar muito tempo √† √°rea de assunto, usaremos o algoritmo detalhado para carregar o arquivo de configura√ß√£o no FPGA via FTDI no modo MPSSE (fazer o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">download da configura√ß√£o no FPGA via USB ou desmontar o FTDI MPSSE</a> ).  Neste artigo, mostrarei como implementar o mesmo carregador FPGA, mas na linguagem LabVIEW. </p><a name="habracut"></a><br><p>  Como mencionado acima, o algoritmo de carregamento FPGA no modo Serial Passive (SP) e o princ√≠pio da opera√ß√£o FTDI est√£o bem descritos no artigo anterior.  Eu n√£o vou me repetir.  Acreditamos que o algoritmo √© testado e reconhecido como adequado.  E sim, suponha que o leitor esteja pelo menos superficialmente familiarizado com o conceito LabVIEW e seja versado em programa√ß√£o cl√°ssica. </p><br><p>  Embora o processo de cria√ß√£o de um carregador de inicializa√ß√£o n√£o demore muito, a descri√ß√£o do processo n√£o conseguiu se encaixar no volume de um artigo, portanto haver√° uma pequena s√©rie.  Como a etapa dos experimentos j√° foi conclu√≠da e estou confiante na operacionalidade do algoritmo, permitirei iniciar o desenvolvimento a partir da interface do usu√°rio.  No primeiro artigo, criaremos a interface do usu√°rio do carregador e implementaremos a estrutura do programa.  Na segunda - atrav√©s da DLL do driver FTDI, implementamos o carregamento do arquivo * .rbf no FPGA. </p><br><p>  Para a produtividade da conversa, n√£o √© sup√©rfluo lembrar a terminologia adotada no LabVIEW.  No LabVIEW, o programa aplicativo √© chamado de Instrumento Virtual, tamb√©m conhecido como VI, tamb√©m conhecido como Instrumento Virtual ou VI, para abreviar.  O vice-presidente tem dois "lados": o painel frontal, onde est√£o localizados os controles e indicadores, e o diagrama de blocos (diagrama de blocos), onde esses elementos s√£o interconectados e as fun√ß√µes e fluxos de processamento de dados s√£o implementados.  Como regra, um vice-presidente tem uma estrutura hier√°rquica; todos os vice-presidentes em um vice-presidente de n√≠vel superior s√£o geralmente chamados de subdispositivo ou SubVI. </p><br><h2 id="interfeys-polzovatelya">  Interface do usu√°rio </h2><br><p>  Nosso aplicativo deve carregar o arquivo de configura√ß√£o no FPGA.  Ao mesmo tempo, queremos dizer que v√°rios FTDIs podem ser conectados a um computador ao mesmo tempo, e alguns deles podem ser potencialmente usados ‚Äã‚Äãpara configurar FPGAs.  Sugiro fazer uma escolha de dispositivo na lista suspensa, selecionando um arquivo atrav√©s de um bot√£o com uma sa√≠da de caminho.  Para iniciar o download, adicione o bot√£o "programa".  Um LED virtual indicar√° o status da opera√ß√£o.  Inicie o LabVIEW. </p><br><p>  Adicione os elementos necess√°rios ao painel frontal (painel frontal).  Vou usar o estilo "Silver" para o vice-presidente.  A figura abaixo mostra o resultado, todos os elementos em sua condi√ß√£o original.  Pelo nome, se necess√°rio, eles s√£o bastante f√°ceis de encontrar na paleta. </p><br><img src="https://habrastorage.org/webt/qq/os/bt/qqosbtkepb8n5fe2l3_qnz309q8.png"><br><p><br>  Editamos elementos: transferimos, expandimos, adicionamos inscri√ß√µes - trazemos para o formul√°rio necess√°rio.  Aqui, de fato, √© necess√°ria a m√£o do designer, mas como pude: </p><br><img src="https://habrastorage.org/webt/wd/sp/iz/wdspizcngovsuygvcmkofpnepjw.png"><br><p><br>  E o diagrama de blocos: </p><br><img src="https://habrastorage.org/webt/l0/g_/hi/l0g_hij_xwkzm3n-sfrqe6pfypg.png"><br><p><br>  Eu chamo sua aten√ß√£o.  Cada elemento possui duas propriedades que determinam o nome - R√≥tulo e Legenda. </p><br><img src="https://habrastorage.org/webt/pi/xi/r9/pixir9kcyslk2iscflmbtfxtpmq.png"><br><p><br>  A primeira propriedade define o nome do elemento, sob esse nome ele ser√° exibido no diagrama de blocos.  O r√≥tulo, ao contr√°rio do Caption, n√£o pode ser alterado durante a execu√ß√£o do VI.  Em conex√£o com esse recurso, recomendo que voc√™ oculte a etiqueta em seus VIs no painel frontal e exiba Legenda.  Para Label, crie um nome significativo, como uma vari√°vel em uma linguagem de programa√ß√£o cl√°ssica, de prefer√™ncia em um layout latino.  Para o Caption, apresentaremos um nome orientado para humanos, que pode ser bastante longo, incluir espa√ßos e, se necess√°rio, em russo.  Usando o LabVIEW, voc√™ pode personalizar a fonte de exibi√ß√£o da legenda.  Devo dizer que ningu√©m nos obriga a mexer com a Legenda: qualquer inscri√ß√£o pode ser feita diretamente no <abbr title="Painel frontal">FP,</abbr> em qualquer lugar livre. </p><br><p> Implementamos a opera√ß√£o VP de acordo com o esquema cl√°ssico: While loop e manipulador de eventos.  Adicione um loop <code>While</code> (Programa√ß√£o -&gt; Estruturas -&gt; Loop While) ao diagrama de blocos e uma estrutura de manipulador de eventos (Programa√ß√£o -&gt; Estruturas -&gt; Estrutura de Eventos). </p><br><div class="spoiler">  <b class="spoiler_title">Breve ajuda na estrutura de eventos</b> <div class="spoiler_text"><p>  A estrutura aguarda o evento ocorrer e, em seguida, o manipulador correspondente √© executado.  A estrutura dos eventos possui um ou v√°rios subdiagramas - manipuladores de eventos, os chamados casos, um dos quais √© executado quando ocorre um evento.  Usando o terminal no canto superior esquerdo, voc√™ pode especificar o n√∫mero de milissegundos durante os quais a estrutura espera um evento.  Se durante esse per√≠odo nenhum evento ocorrer, o sub-diagrama ‚ÄúTimeout‚Äù ser√° executado.  O valor padr√£o √© menos 1, o que significa que o tempo limite nunca expira. </p><br><img src="https://habrastorage.org/webt/ol/qj/uo/olqjuooy0reae8un_fyw5bs2l78.png"><br><br><ol><li>  O r√≥tulo do seletor de eventos indica quais eventos acionam o caso atual.  Para visualizar outros manipuladores, voc√™ pode clicar na seta para baixo ao lado do nome do evento. </li><li>  O terminal de <code>timeout</code> define o n√∫mero de milissegundos para aguardar um evento.  Se o valor for diferente de -1, o subdiagrama de tempo limite deve ser implementado. </li><li>  Um terminal para inserir eventos din√¢micos.  Este terminal n√£o √© exibido por padr√£o.  Para exibi-lo, selecione "Mostrar terminais de eventos din√¢micos" no menu de contexto. </li><li>  N√≥ de dados do evento.  Quando um evento ocorre, o LabVIEW gera dados associados a esse evento.  Este n√≥ fornece esses dados para o manipulador.  Voc√™ pode usar o mouse para redimensionar o n√≥ verticalmente e selecionar os elementos necess√°rios.  Alguns dados, como <code>Type</code> e <code>Time</code> , s√£o comuns a todos os eventos, outros, como <code>Char</code> e <code>VKey</code> , dependem do tipo de evento configurado. </li><li>  O n√≥ do filtro de eventos define os dados do evento que voc√™ pode modificar antes que a interface com o usu√°rio processe esses dados.  Este n√≥ √© exibido apenas nos manipuladores em que a filtragem est√° dispon√≠vel.  Voc√™ pode conectar e alterar itens do n√≥ de dados do evento para o n√≥ do filtro de eventos.  Voc√™ tamb√©m pode alterar esses eventos conectando os novos valores aos terminais do n√≥.  Posso cancelar completamente a rea√ß√£o da interface ao evento se eu enviar <code>true</code> ao terminal <code>Discard?</code>  .  Se voc√™ n√£o conectar o valor ao elemento de filtro, esse elemento de dados permanecer√° inalterado. </li><li>  Como a estrutura <code>Case</code> , a estrutura do evento suporta t√∫neis.  Se voc√™ adicionar um t√∫nel em um caso, ele ser√° criado automaticamente para cada manipulador.  No entanto, por padr√£o, n√£o h√° necessidade de conectar os t√∫neis de sa√≠da da estrutura de eventos em cada manipulador.  Todos os t√∫neis n√£o conectados usam o valor padr√£o para o tipo de dados do t√∫nel.  Potencialmente, isso pode levar a erros dif√≠ceis de detectar.  Voc√™ pode retornar o modo no qual o t√∫nel deve ser conectado em todos os manipuladores; para isso, selecione "Usar padr√£o se n√£o conectado" no menu de contexto. </li></ol></div></div><br><p>  Primeiro, cuidaremos de como o ciclo termina e sai do programa.  A maneira mais f√°cil √© adicionar um bot√£o de parada, que interromper√° o ciclo, mas, na minha opini√£o, √© habitual encerrar o programa com uma cruz vermelha no canto superior da janela. <br>  Adicione o manipulador apropriado √† <code>Event Structure</code> .  No menu de contexto, selecione "Adicionar caso de evento".  Como fonte do evento, selecione "This VI", o evento indica "Panel Close?" </p><br><div class="spoiler">  <b class="spoiler_title">Editar eventos</b> <div class="spoiler_text"><p> <a href=""><img src="https://habrastorage.org/webt/bt/xo/qv/btxoqvdb2l67eohk78xrvwnhgcg.png"></a> <br>  <em>Imagem clic√°vel</em> </p></div></div><br><p>  Observe que, se voc√™ selecionar "Fechar painel" (sem uma pergunta), esse evento ser√° sem filtro e n√£o poder√° ser desfeito.  E se com uma pergunta, quando voc√™ clicar na cruz, podemos assumir o controle e concluir o programa corretamente de forma independente.  No "Painel Fechar?"  atrav√©s do t√∫nel, conectamos a constante booleana <code>true</code> ao terminal para interromper o <code>while</code> .  Entrada "Descartar?"  tamb√©m servem de <code>true</code> . </p><br><p>  Agora n√£o h√° nuances √≥bvias: se o VI atual √© lan√ßado n√£o no ambiente LabVIEW, mas na forma de um aplicativo compilado, clicar na cruz n√£o fecha a janela, mas interrompe o aplicativo, o que n√£o √© necess√°rio.  Para resolver esse problema, ap√≥s a conclus√£o do ciclo principal, verificaremos se estamos no ambiente de desenvolvimento ou no modo de programa, se ainda estiver no modo de programa, finalizaremos o aplicativo.  Para entender onde o VI atual √© executado, use o n√≥ de propriedade (Programa√ß√£o -&gt; Controle de Aplicativo -&gt; N√≥ de Propriedade).  Este n√≥ fornece acesso √†s propriedades de um objeto por refer√™ncia a esse objeto.  Nesse caso, devemos obter um link para todo o aplicativo como um todo.  Selecione a constante <code>VI Server Reference</code> na mesma paleta.  Depois que a constante √© definida no diagrama de blocos, voc√™ precisa alterar seu tipo para <code>This Application</code> (bot√£o esquerdo do mouse).  Conectamos o link resultante ao n√≥ da propriedade.  Selecione a propriedade <code>Application:Kind Property</code> - retorna o tipo do sistema LabVIEW no qual o VI atual est√° sendo executado.  N√≥s conectamos a sa√≠da da propriedade √† Estrutura do Caso, adicionamos o caso "Run Time System", onde encerramos o aplicativo ( <code>Quit LabVIEW</code> ).  Para que este bloco seja executado ap√≥s o ciclo, e n√£o antes, conectamos o <code>error in</code> terminal de entrada ao ciclo atrav√©s do t√∫nel. </p><br><p> <a href=""><img width="720" src="https://habrastorage.org/webt/il/nm/ty/ilnmtyv89c3yv-nogcksavitbnu.png"></a> <br>  <em>Imagem clic√°vel</em> </p><br><p>  Agora, quando voc√™ inicia o programa, pode interromp√™-lo clicando na cruz da janela.  O programa lan√ßado √© assim: </p><br><img src="https://habrastorage.org/webt/pv/9e/za/pv9ezax9jrro78shza6coogtu_4.png"><br><p><br>  Na minha opini√£o, muito sup√©rfluo.  V√° para as propriedades do VI (menu Arquivo -&gt; Propriedades do VI), selecione a categoria "Apar√™ncia da janela", defina Personalizado. </p><br><p>  Desligue a exibi√ß√£o do menu (ele permanece no modo de edi√ß√£o), desligue a barra de rolagem, oculte a barra de ferramentas quando o aplicativo estiver sendo executado (Mostrar barra de ferramentas durante a execu√ß√£o).  Proibimos o redimensionamento da janela, permitimos minimizar e minimizar a janela.  Isso √© melhor: </p><br><img src="https://habrastorage.org/webt/a9/mg/u-/a9mgu-7km4wqkzj_rgdmc4mgfse.png"><br><p><br>  Certamente, valeria a pena remover a inscri√ß√£o "National Instruments. LabVIEW Evaluation Software", mas ainda n√£o quero comprar uma licen√ßa para um computador dom√©stico, vamos aturar a inscri√ß√£o e gerenciar o per√≠odo de avalia√ß√£o de 45 dias. </p><br><p>  Naturalmente, voc√™ pode ajustar a cor do plano de fundo e cada elemento, escolher fontes, mas n√£o sou designer, mas algo me diz que s√≥ vou piorar. </p><br><h2 id="spisok-priborov">  Lista de Instrumentos </h2><br><p>  O VP deve oferecer ao usu√°rio uma lista de dispositivos conectados ao computador, adequados ao firmware FPGA, para que o usu√°rio possa selecionar o desejado.  Na biblioteca FTD2XX, as fun√ß√µes <code>FT_GetDeviceInfoDetail</code> e <code>FT_GetDeviceInfoDetail</code> s√£o para esse fim.  Conforme discutido em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior</a> , as bibliotecas de drivers podem ser usadas para usar a API FTD2XX.  O LabVIEW possui um mecanismo conveniente para interagir com bibliotecas din√¢micas - o n√≥ N√≥ de Fun√ß√£o da Biblioteca de Chamadas, voc√™ pode encontr√°-lo na paleta "Conectividade -&gt; Bibliotecas e Execut√°veis".  O n√≥ da chamada de fun√ß√£o deve ser configurado: primeiro, especifique o caminho para a dll (a guia "Fun√ß√£o"), ap√≥s o qual o sistema varre a biblioteca e oferece a sele√ß√£o do nome da fun√ß√£o na lista "Nome da Fun√ß√£o" - selecione <code>FT_CreateDeviceInfoList</code> , conven√ß√£o de chamada - selecione <strong>stdcall (WINAPI)</strong> .  Em segundo lugar, na guia "Par√¢metros", √© necess√°rio inserir uma lista de par√¢metros de fun√ß√£o, onde o primeiro elemento da lista √© o valor de retorno.  Aqui, seria bom ter em mente a documenta√ß√£o da API ou o arquivo de cabe√ßalho.  Ao definir par√¢metros na √°rea "Prot√≥tipo de fun√ß√£o", o prot√≥tipo da fun√ß√£o importada √© exibido.  Quando a assinatura da documenta√ß√£o corresponder ao prot√≥tipo configurado, clique em OK. </p><br><p>  Suponha que a digitaliza√ß√£o seja realizada uma vez por segundo.  Colocamos o n√≥ de chamada na estrutura do manipulador de eventos na guia "Timeout", configuramos o tempo de espera para 1000 ms.  Adicionamos indicadores aos pinos do n√≥ e, se tudo for feito corretamente, ao iniciar o VI, o n√∫mero de dispositivos conectados com o FTDI dever√° ser exibido: </p><br><div class="spoiler">  <b class="spoiler_title">Painel frontal e diagrama de blocos</b> <div class="spoiler_text"><p> <a href=""><img width="720" src="https://habrastorage.org/webt/sc/pg/fr/scpgfrpwkg3gi5hepnez6b8l_nc.png"></a> <br>  <em>Imagem clic√°vel</em> </p><br><img src="https://habrastorage.org/webt/v7/cy/fu/v7cyfuon36rdj3wxlwoaotzt_2c.png"></div></div><br><p>  Da mesma forma, crie um n√≥ para a fun√ß√£o <code>FT_GetDeviceInfoDetail</code> .  O prot√≥tipo da fun√ß√£o √©: </p><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">FTD2XX_API FT_STATUS WINAPI </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FT_GetDeviceInfoDetail</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( DWORD dwIndex, LPDWORD lpdwFlags, LPDWORD lpdwType, LPDWORD lpdwID, LPDWORD lpdwLocId, LPVOID lpSerialNumber, LPVOID lpDescription, FT_HAN</span></span></span></span></code> </pre> <br><p>  Ao descrever os par√¢metros, deve-se observar que <code>lpdwFlags</code> , <code>lpdwType</code> , <code>lpdwID</code> , <code>lpdwLocId</code> s√£o passados ‚Äã‚Äãcomo ponteiros para o <code>uint32</code> .  Os par√¢metros <code>lpSerialNumber</code> e <code>lpDescription</code> s√£o a ess√™ncia das cadeias de bytes (matrizes de <code>char</code> com um terminador nulo).  Os par√¢metros desse tipo no n√≥ de chamada podem ser formatados de v√°rias maneiras. Voc√™ pode inseri-los em uma matriz de palavras de 8 bits, mas acho mais conveniente indicar imediatamente que essa √© uma string e definir o tamanho esperado.  Nesse caso, a sa√≠da ser√° imediatamente uma linha "labirinto" v√°lida e nenhuma transforma√ß√£o adicional ser√° necess√°ria. </p><br><img src="https://habrastorage.org/webt/zi/n8/8t/zin88t8hl5je5csuxcq7l_bbk9c.png"><br><p>  Fun√ß√£o de biblioteca de chamadas </p><br><p>  Esta fun√ß√£o retorna informa√ß√µes pelo n√∫mero de s√©rie do <code>dwIndex</code> .  Se v√°rios FTDIs estiverem conectados ao computador, para ler as informa√ß√µes de cada conversor, a fun√ß√£o dever√° ser chamada em um loop.  O n√∫mero de itera√ß√µes do loop ser√° fornecido pela fun√ß√£o anterior <code>FT_CreateDeviceInfoList</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Painel frontal e diagrama de blocos</b> <div class="spoiler_text"><p> <a href=""><img width="720" src="https://habrastorage.org/webt/sr/2a/gq/sr2agqtusiwcn3tcttwqbncllgk.png"></a> <br>  <em>Imagem clic√°vel</em> </p><br><img src="https://habrastorage.org/webt/t9/dg/tl/t9dgtlw3lapeklhbi4y3tzca0lm.png"></div></div><br><p>  H√° um recurso desagrad√°vel: todas as portas do n√≥ de chamada devem estar conectadas pelo menos em um lado.  Portanto, um t√∫nel √© feito no loop para os terminais de sa√≠da que n√£o vamos usar. </p><br><p>  <code>Types</code> matriz de <code>Types</code> cont√©m tipos de chip FTDI, precisamos deles para limitar a escolha apenas √†queles que suportam MPSSE e podem ser potencialmente usados ‚Äã‚Äãpara programa√ß√£o FPGA.  No entanto, operar com "n√∫meros m√°gicos" √© inconveniente - proponho organizar os tipos de FTDI na forma de <code>enum</code> .  Al√©m disso, essa <code>enum</code> j√° <code>enum</code> no arquivo de cabe√ßalho ftd2xx.h.  No LabVIEW, voc√™ pode usar dois controles para criar uma enumera√ß√£o: o Text Ring e o pr√≥prio Enum.  Ambos cont√™m listas de cadeias com valores num√©ricos entre os quais voc√™ pode alternar.  A principal diferen√ßa √© que "Enum" exige que os valores num√©ricos sejam n√∫meros consecutivos inteiros, enquanto o "Anel de texto" tem mais liberdade - voc√™ pode especificar quaisquer valores. </p><br><div class="spoiler">  <b class="spoiler_title">Enum.</b>  <b class="spoiler_title">Cria√ß√£o</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v9/ye/ik/v9yeik6iwgvetbpoa2wcf9b0kn8.png"><br><p>  <em>N√≥s inserimos manualmente os valores, √© uma pena que n√£o haja uma fun√ß√£o de importa√ß√£o <code>enum</code> de C</em> </p><br><img src="https://habrastorage.org/webt/en/jd/4r/enjd4rvd8snxw6fhtstrinlcvey.png"><br><p>  <em>No painel frontal, este indicador se parece com este</em> </p><br><img src="https://habrastorage.org/webt/yc/t6/er/yct6erqkpta8o-a4mnp7vfbty7w.png"><br><p>  <em>Selecionando um valor clicando com o bot√£o esquerdo</em> </p></div></div><br><p>  Para vincular e sincronizar todas as inst√¢ncias futuras da lista criada, √© conveniente usar o "Make Type Def".  (sele√ß√£o atrav√©s do menu de contexto do item).  Como resultado, um tipo de dados personalizado ser√° criado.  O novo tipo √© colocado em um arquivo separado com a extens√£o * .ctl.  A edi√ß√£o deste arquivo modificar√° todas as inst√¢ncias desse elemento.  Eu acho que n√£o vale a pena explicar o qu√£o conveniente isso pode ser.  O acesso ao arquivo de defini√ß√£o pode ser obtido no menu de contexto da inst√¢ncia, selecionando "Open Type Def"; no mesmo menu, voc√™ deve prestar aten√ß√£o aos itens "Atualiza√ß√£o autom√°tica do Type Def".  e "Desconectar do Tipo Def". </p><br><p>  Alteramos o indicador de <code>Types</code> para uma matriz de indicadores do <code>FTDI Type</code> e, como resultado, quando o VI √© iniciado, o tipo do conversor conectado √© exibido: </p><br><img src="https://habrastorage.org/webt/zy/07/zy/zy07zy2phqs7mc_q8a4hur1hunw.png"><br><p>  <em>Tr√™s dispositivos encontrados</em> </p><br><p>  √â f√°cil perceber que a funcionalidade do c√≥digo resultante no caso "Timeout" est√° completa, portanto, pode ser movida para um SubVI separado.  Selecione os elementos que queremos transferir para o subdispositivo e selecione "Criar SubVI" no menu principal Editar. </p><br><div class="spoiler">  <b class="spoiler_title">diagrama de blocos com sub-instrumento criado</b> <div class="spoiler_text"><p>  Todos os indicadores permaneceram e um novo VI com um √≠cone padr√£o foi formado no lugar dos n√≥s de chamada. <br> <a href=""><img src="https://habrastorage.org/webt/wz/oo/ba/wzoobavcvisx9kmmntke3m_2pxe.png"></a> <br>  <em>Imagem clic√°vel</em> </p></div></div><br><p>  Clicar duas vezes no novo subVI abrir√° sua janela de edi√ß√£o.  Primeiro, salvamos e fornecemos um nome significativo, por exemplo, "FT_GetDeviceInfo".  Configure os terminais de E / S.  Para fazer isso, use o Painel Conector: </p><br><img src="https://habrastorage.org/webt/1e/fs/gw/1efsgw6lcoaoauj-qguyus4fbn4.png"><br><p>  O painel √© um conjunto de terminais correspondentes aos controles e indicadores VI. </p><br><p>  Se voc√™ selecionar um terminal no painel de conex√£o, o elemento correspondente no painel frontal ser√° destacado.  Se voc√™ selecionar um terminal vazio e clicar em um elemento no painel frontal, o elemento ser√° anexado ao terminal, mas antes disso n√£o dever√° ser atribu√≠do a outro terminal.  No menu de contexto, voc√™ pode desconectar individualmente ou de uma s√≥ vez os terminais dos elementos, alterar o padr√£o do painel como um todo. </p><br><p>  N√£o gosto de como os terminais foram atribu√≠dos ao criar o subVI atual. Selecione "Desconectar todos os terminais" e marque-o manualmente.  Eu recomendo colocar os terminais de entrada √† esquerda e a sa√≠da √† direita, a entrada opcional pode ser colocada na parte superior e a sa√≠da opcional na parte inferior.  Isso garantir√° boa legibilidade do c√≥digo e ordem visual no diagrama de blocos. </p><br><p>  Para controlar erros, crie dois elementos adicionais, <code>Error in</code> e <code>Error out</code> .  O t√≥pico de controle de erros do LabVIEW √© muito extenso e vai al√©m do escopo deste artigo, portanto, nos limitaremos a um m√≠nimo de explica√ß√µes e seguiremos o princ√≠pio "fa√ßa como eu".  Ent√£o, criamos dois terminais para erros - entrada e sa√≠da. </p><br><div class="spoiler">  <b class="spoiler_title">√â conveniente cri√°-los usando o menu de contexto</b> <div class="spoiler_text"><p>  Clique com o bot√£o direito do mouse no terminal de erro de qualquer n√≥: </p><br><img src="https://habrastorage.org/webt/ul/ew/re/ulewre7rct2swn34bhqejv3kg24.png"></div></div><br><p>  No LabVIEW, √© habitual colocar o terminal de entrada do erro no painel de conex√£o na parte inferior esquerda e o terminal de sa√≠da na parte inferior direita. </p><br><p>  Ser√° mais conveniente combinar a sa√≠da em uma estrutura.  Para sa√≠da, faremos duas matrizes: a primeira matriz conter√° todos os dispositivos FTDI encontrados, a segunda matriz conter√° apenas aqueles que podem MPSSE e, teoricamente, podem ser usados ‚Äã‚Äãpara configurar FPGAs. </p><br><p>  O toque final ao criar um subinstrumento √© configurar o √≠cone.  Clicar duas vezes no √≠cone no canto superior direito da janela inicia o editor.  Estamos tentando criar algum tipo de imagem significativa que nos permita interpretar inequivocamente o objetivo do dispositivo no diagrama de blocos. </p><br><div class="spoiler">  <b class="spoiler_title">FT_GetDeviceInfo.vi</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/l1/hy/sd/l1hysdhgshztti7xczw7tjmbex0.png"><br><p>  <em>Painel frontal</em> </p><br><img src="https://habrastorage.org/webt/a4/ba/5w/a4ba5wwquuv-coxuxpxzjo8xwio.png"><br><p>  <em>Diagrama de blocos</em> </p><br><p>  E √© assim que o caso "Timeout" cuida da organiza√ß√£o das coisas: <br> <a href=""><img src="https://habrastorage.org/webt/ea/yu/6d/eayu6ddx32eq_easysclsqqp7pg.png"></a> <br>  <em>Imagem clic√°vel</em> </p></div></div><br><p>  At√© esse momento, a lista suspensa com o nome "Selecionar um dispositivo" estava vazia, agora temos os dados para preench√™-lo.  Criamos um n√≥ de propriedade para a lista com a propriedade "Strings []" (menu de contexto -&gt; Criar -&gt; N√≥ da propriedade -&gt; Strings []).  Qualquer propriedade √© grav√°vel e leg√≠vel; o modo atual √© selecionado no menu de contexto do N√≥ da propriedade.  Ao criar um n√≥ por padr√£o, as propriedades s√£o configuradas para serem lidas.  Altere para escrever: "Alterar para escrever". </p><br><p>  Na matriz de estruturas, selecione a matriz com a descri√ß√£o e alimente-a com <code>Strings[]</code> .  Voc√™ pode selecionar uma matriz usando o <code>For Loop</code> . </p><br><p>  Ap√≥s iniciar o VI, pressione o bot√£o esquerdo no elemento "Selecionar um dispositivo", voc√™ pode especificar o dispositivo para configura√ß√£o.  Nesse caso, a lista de dispositivos √© atualizada duas vezes por segundo.  Obviamente, seria poss√≠vel atualizar a propriedade apenas se a lista fosse atualizada, mas at√© agora isso resultar√° em uma confus√£o desnecess√°ria no diagrama de blocos. </p><br><div class="spoiler">  <b class="spoiler_title">O que aconteceu?</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/_t/gh/i7/_tghi7fjgo0hhb6thtdcosvfp1m.png"><br><p>  <em>Painel frontal</em> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/x6/wo/3v/x6wo3v0sqbdvwzhksbg4kghoeho.png"></a> <br>  <em>Imagem clic√°vel</em> </p><br><p>  Antes, esqueci de mencionar um recurso t√£o interessante, o loop For n√£o precisa especificar explicitamente o n√∫mero de itera√ß√µes, basta criar um t√∫nel de entrada da matriz e o loop ser√° executado para cada elemento, esse comportamento se assemelha ao <strong><code>foreach</code></strong> no C ++ 11.  No entanto, voc√™ precisa ter cuidado quando mais de uma matriz chegar na entrada do loop. </p></div></div><br><p>  Na estrutura do evento, adicione um manipulador para pressionar o bot√£o "programa".  Embora n√£o tenhamos um VI respons√°vel por carregar o arquivo no FPGA, criaremos um sub-dispositivo "stub".  Suponha que ele use o caminho para o arquivo de configura√ß√£o e o descritor FTDI como entrada e, de acordo com os resultados da opera√ß√£o, ele retornar√° o status do firmware: bem-sucedido ou n√£o.  E para tornar mais interessante testar a interface do programa, tornaremos esse status aleat√≥rio. </p><br><div class="spoiler">  <b class="spoiler_title">Stub FT_MPSSE_SP_FPGA.vi</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gy/xl/qf/gyxlqf-hzbjik3667nmzga5bf6g.png"><br><p>  <em>Painel frontal</em> </p><br><img src="https://habrastorage.org/webt/f_/qz/kw/f_qzkwjrp7nqvo9yfgl0o9ovidw.png"><br><p>  <em>Diagrama de blocos</em> </p></div></div><br><p>  Passaremos o descritor FTDI para a entrada stub atrav√©s da propriedade list (menu de contexto -&gt; Criar -&gt; N√≥ da propriedade -&gt; Texto do anel -&gt; Texto), para transferir o caminho do arquivo para o elemento "Caminho do arquivo", crie uma vari√°vel local (menu de contexto -&gt; Criar -&gt; Local Vari√°vel) e defina-o para ler (Alterar para ler).  E conecte a sa√≠da de status diretamente ao indicador de <code>Status</code> .  O bot√£o <code>Programm</code> √© arrastado para o manipulador de eventos.  √â uma boa pr√°tica colocar elementos nos quais o evento est√° configurado nos manipuladores - agora, clicar duas vezes nesse elemento no painel frontal mostrar√° n√£o apenas o elemento correspondente no diagrama de blocos, mas tamb√©m o manipulador de eventos associado a esse elemento. </p><br><p>  Agora, pressionando o bot√£o "Programa", o indicador fica verde (sucesso) ou verde escuro (sem sucesso).  N√£o √© muito claro.  Nas propriedades do indicador, altere a cor "Desligado" para vermelho.  Isso √© melhor  Se o indicador estiver verde, podemos dizer que o FPGA no dispositivo selecionado est√° configurado por um arquivo, cujo caminho √© indicado na janela: </p><br><img src="https://habrastorage.org/webt/wl/le/re/wllerexz4zkxjzemfyspv_3yyoo.png"><br><p>  <em>Painel frontal</em> </p><br><p>  Mas essa declara√ß√£o se torna falsa se alteramos o arquivo ou selecionamos outro dispositivo.  Ao mesmo tempo, n√£o podemos colorir o indicador em vermelho, porque n√£o ocorreu um erro de programa√ß√£o.  No caso de uma altera√ß√£o de arquivo ou dispositivo, √© conveniente enfatizar que o valor do indicador n√£o √© relevante - escure√ßa-o.  Para isso, voc√™ pode usar a propriedade Indicador <code>Disabled</code> .  Essa propriedade pode receber tr√™s valores: <code>Enabled</code> - exibi√ß√£o normal, o usu√°rio pode controlar o objeto;  <code>Disabled</code> - o objeto √© exibido no painel frontal como de costume, mas o usu√°rio n√£o pode controlar o objeto;  <code>Disabled and Grayed Out</code> - o objeto √© exibido no painel frontal escurecido e o usu√°rio n√£o pode controlar o objeto. </p><br><p>  Criamos manipuladores de eventos para a <code>Devices list</code> e <code>File Path</code> , e neles escurecemos o indicador de status e, no manipulador, atribu√≠mos o bot√£o "Programa" √† propriedade <code>Enabled</code> . </p><br><div class="spoiler">  <b class="spoiler_title">O que aconteceu</b> <div class="spoiler_text"><p> <a href=""><img src="https://habrastorage.org/webt/59/xl/da/59xldabidafiphelnavil1h3iue.png"></a> <br>  <em>Manipulador "Programm": altera√ß√£o de valor.</em> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/i4/xm/sx/i4xmsxdxklfiusfqfamtyqxpoog.png"></a> <br>  <em>Manipulador da lista de dispositivos: altera√ß√£o de valor</em> </p><br><img src="https://habrastorage.org/webt/w3/58/dn/w358dn13xtxn61o6o5frte7-gsk.png"><br><p>  <em>√â assim que o indicador escuro se parece</em> </p></div></div><br><p>  Vamos tornar a busca pelo arquivo de configura√ß√£o conveniente para o usu√°rio - configuraremos a janela de visualiza√ß√£o do arquivo.  V√° para as propriedades do elemento <code>File Path</code> do <code>File Path</code> , na guia "Op√ß√µes de navega√ß√£o", preencha Prompt, R√≥tulo do padr√£o, especifique o filtro do tipo de arquivo (Padr√£o) e o nome do bot√£o (Texto do bot√£o). </p><br><div class="spoiler">  <b class="spoiler_title">Janela de sele√ß√£o de arquivo</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/vf/i2/yc/vfi2ycpuj_lhydbcp1jebbjb0ni.png"><br><p>  <em>Somente arquivos rbf s√£o exibidos</em> </p><br><img src="https://habrastorage.org/webt/1-/w3/e8/1-w3e8dg3uauxccfq8-buzrs75y.png"></div></div><br><p>  A cria√ß√£o de uma interface com o usu√°rio pode ser considerada completa. </p><br><img src="https://habrastorage.org/webt/tm/5w/oq/tm5woq3kwnfgmo38klp_5qxenug.png"><br><p>  <em>Executando o gerenciador de inicializa√ß√£o</em> </p><br><h2 id="s-chem-poznakomilis-segodnya">  O que voc√™ conheceu hoje? </h2><br><p>  Neste artigo, como exemplo de cria√ß√£o de um aplicativo funcionalmente completo com uma interface minimalista, tentei mostrar v√°rias abordagens para trabalhar no LabVIEW. </p><br><p>  Como resultado, tocamos neles: </p><br><ul><li>  Configurando as propriedades do dispositivo virtual.       . </li><li>   :   . </li><li>    . </li><li>  . </li><li>    dll. </li><li>    . </li></ul><br><p>         API FTD2XX   MPSSE.     . </p><br><h2 id="materialy-po-teme">    </h2><br><ol><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     USB   FTDI MPSSE</a> </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">labview_mpsse</a> .   . </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">   </a> .    </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Software Application Development D2XX Programmer's Guide</a> .   API D2XX. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427529/">https://habr.com/ru/post/pt427529/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427519/index.html">Meetup @Kubernetes no Mail.Ru Group: 29 de outubro e sempre</a></li>
<li><a href="../pt427521/index.html">Pr√™mio Breakthrough 2019. Anunciados os vencedores do Pr√™mio de Ci√™ncia Milner, Brin e Zuckerberg.</a></li>
<li><a href="../pt427523/index.html">Sucesso de cobertura</a></li>
<li><a href="../pt427525/index.html">Intel Core 9a gera√ß√£o em n√∫meros e benchmarks</a></li>
<li><a href="../pt427527/index.html">10 truques para pain√©is avan√ßados no Splunk. Parte 2</a></li>
<li><a href="../pt427531/index.html">Da Sib√©ria a Chipre e vice-versa - a hist√≥ria de um emigrante fracassado</a></li>
<li><a href="../pt427533/index.html">Rel√≥gios inteligentes que n√£o precisam de carregamento. Existem muitos deles?</a></li>
<li><a href="../pt427535/index.html">Lan√ßamos uma escolha coletiva de solu√ß√µes</a></li>
<li><a href="../pt427537/index.html">Como se tornar um gerente de produto de sucesso: cursos onde voc√™ √© treinado agora</a></li>
<li><a href="../pt427539/index.html">Europa √∫ltima vez que ajusta o rel√≥gio para o inverno</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>