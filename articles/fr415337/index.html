<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👦 😣 🧝🏾 Comment les canaux Pusher ont déjà livré 10 000 000 000 000 de messages 🤧 😄 🤳🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salut Je suis récemment tombé sur une description assez intéressante de l'architecture des canaux Pusher et j'ai décidé de la traduire pour vous. À mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment les canaux Pusher ont déjà livré 10 000 000 000 000 de messages</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/415337/"><p> <em>Salut</em>  <em>Je suis récemment tombé sur une description assez intéressante de l'architecture des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">canaux Pusher</a> et j'ai décidé de la traduire pour vous.</em>  <em>À mon avis, l'auteur a très facilement décrit les approches de construction d'une architecture hautement chargée et évolutive.</em>  <em>Très probablement, l'article sera utile aux débutants, ainsi qu'aux spécialistes de domaines connexes.</em> </p><br><p>  Au bureau Pusher, nous avons un petit comptoir avec un nombre toujours croissant.  Il indique le nombre de messages remis pour toute l'existence de canaux pousseurs.  Vendredi à 22h20 UTC, le nombre a augmenté d'une catégorie pour atteindre 10 000 000 000 000.  Il a 13 zéros - 10 billions. </p><br><p><img src="https://habrastorage.org/webt/za/kb/dw/zakbdwmmhgz5p8hg5oxvhbi-jdc.jpeg"></p><br><p>  Vous pourriez penser que le nombre total de messages est une métrique gonflée inutile.  Mais ce nombre est un indicateur clé du succès de Pusher Channels, notre produit de communication en temps réel.  Tout d'abord, ce compteur reflète la confiance que nous accordent les utilisateurs.  Deuxièmement, il mesure l'évolutivité de notre système.  Afin d'augmenter le nombre, chez Pusher, nous devons nous assurer que les utilisateurs font confiance à l'envoi de messages à notre service, et nous devons être sûrs que notre système est capable de traiter ces messages.  Mais que devons-nous délivrer 10 billions de messages?  Voyons voir. </p><a name="habracut"></a><br><p>  Environ 200 000 messages sont envoyés par seconde via les canaux Pusher, et des millions aux heures de pointe.  Par exemple, lorsque le New York Times a utilisé le service pour tenir ses lecteurs informés du déroulement de l'élection présidentielle américaine. </p><br><p>  Voyons d'abord les canaux Pusher comme une grande boîte noire à travers laquelle passent tous ces messages: </p><br><p><img src="https://habrastorage.org/webt/q8/ly/tt/q8lyttjmuao2gkkgkfbjavnx120.png"></p><br><p>  Pusher Channels est un système de type publication-abonnement.  Les clients s'abonnent à des canaux (par exemple, "btc-usd" ou "private-user-jim"), tandis que d'autres clients leur envoient des messages.  Si un million de personnes sont abonnées au canal "btc-usd" et que quelqu'un y envoie le coût réel du bitcoin, les canaux Pusher devront livrer un million de messages.  Nous le faisons en quelques millisecondes. </p><br><p>  Un serveur ne peut pas délivrer autant de messages en si peu de temps.  Par conséquent, nous utilisons trois techniques éprouvées: le déploiement, le partage et l'équilibrage de charge.  Voyons ce qu'il y a dans la boîte noire. </p><br><p><img src="https://habrastorage.org/webt/fe/vx/rx/fevxrxzehjg1squjlnjqoa473sq.png"></p><br><p>  Des millions d'abonnés sont répartis sur environ 170 serveurs Edge puissants, chacun détenant environ 20 000 connexions.  Chacun de ces serveurs se souvient de la liste des chaînes qui intéressent ses clients et s'y abonne dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">service</a> central <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Redis</a> .  Même si 2000 clients sont intéressés par «btc-usd» sur le serveur de périphérie, il n'a besoin de s'y abonner qu'une seule fois.  Ainsi, lorsqu'un nouveau message arrive sur le canal, Redis envoie 170 messages aux serveurs de périphérie, qui envoient déjà 20 000 messages à leurs abonnés.  Cette approche est appelée fan-out. </p><br><p>  Mais un simple fan-out ne nous suffit pas, car il reste un composant Redis central par lequel passent tous ceux qui envoient des messages.  Cette centralisation limite le nombre de messages envoyés par seconde.  Pour contourner cette limitation, le service Redis central se compose de nombreux fragments Redis.  Chaque canal, à son tour, est attaché au redécoupage en hachant son nom.  Lorsque le client souhaite envoyer un message, il se rend au service de repos.  Ce dernier hache le nom du canal et, en fonction du résultat, détermine le fragment Redis nécessaire auquel le message doit être envoyé.  Cette approche est appelée sharding. </p><br><p>  Il semble que nous passions simplement de la centralisation d'un service Redis à un service de repos.  Mais ce n'est pas le cas, car le service de repos lui-même comprend environ 90 serveurs qui effectuent le même travail: ils reçoivent des demandes de publication, calculent des redis-shards et leur envoient des messages.  Lorsqu'un éditeur souhaite envoyer un message, il se rend sur l'un des nombreux serveurs de repos.  Cette approche est appelée équilibrage de charge. </p><br><p>  Ensemble, le déploiement, le partage et l'équilibrage de charge permettent au système d'avoir un composant central.  Cette propriété est essentielle pour atteindre l'évolutivité horizontale, qui permet d'envoyer des millions de messages par seconde. </p><br><p>  Nous avons examiné les composants centraux du service Pusher Channels, mais il existe d'autres parties, telles que les métriques (comment obtenir ce nombre de 10 billions), les webhooks (comment informer les clients sur les événements intéressants), l'autorisation (restriction d'accès aux canaux), les données sur les actifs utilisateurs, limitation des tarifs (comment s'assurer que nos clients utilisent exactement autant de ressources qu'ils ont payé et qu'ils n'interfèrent pas avec les autres clients).  Toutes ces fonctionnalités supplémentaires doivent être mises en œuvre sans sacrifier la bande passante, le délai de livraison des messages et la disponibilité de notre service dans son ensemble. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr415337/">https://habr.com/ru/post/fr415337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr415327/index.html">Le théorème de Pythagore a été utilisé par les constructeurs de Stonehenge 2000 ans avant la naissance de Pythagore lui-même</a></li>
<li><a href="../fr415329/index.html">Toute la vérité sur RTOS de Colin Walls. Article # 3. Tâches et planification</a></li>
<li><a href="../fr415331/index.html">Des imprimantes de construction pour imprimeries de 5-6 étages sont produites à Yaroslavl</a></li>
<li><a href="../fr415333/index.html">Arduino - émetteur de diffusion AM micropuissant</a></li>
<li><a href="../fr415335/index.html">Tutoriel d'arrière-plan Android. Partie 5: Coroutines à Kotlin</a></li>
<li><a href="../fr415341/index.html">Cours d'administration PostgreSQL</a></li>
<li><a href="../fr415343/index.html"># 2HACKATON pour les jeunes professionnels à Perm</a></li>
<li><a href="../fr415345/index.html">Conseils pour décider de devenir développeur iOS</a></li>
<li><a href="../fr415347/index.html">2. Basé sur Meyers «C ++ efficace et moderne» - détails de l'inférence de type de modèle pour les tableaux</a></li>
<li><a href="../fr415349/index.html">Kubernetes 1.11: un aperçu des principales innovations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>