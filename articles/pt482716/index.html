<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç§ üôéüèª üÖøÔ∏è Desenvolvimento de uma placa de depura√ß√£o para K1986BE1QI (air) ‚ôæ ü§Æ üë©üèø‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alguns anos atr√°s, eu me encontrei com os microcontroladores russos de Milander. Foi em 2013, quando os engenheiros discutiram vigorosamente os primei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento de uma placa de depura√ß√£o para K1986BE1QI (air)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482716/"><img src="https://habrastorage.org/webt/xa/8d/4m/xa8d4m3m5jgwavt_34l7oj8abfi.jpeg" alt="Placa de depura√ß√£o MDB1986"><br><br>  Alguns anos atr√°s, eu me encontrei com os microcontroladores russos de Milander.  Foi em 2013, quando os engenheiros discutiram vigorosamente os primeiros resultados do Programa Alvo Federal "Desenvolvimento da base de componentes eletr√¥nicos e radioeletr√¥nicos" para 2008-2015.  Naquela √©poca, o controlador K1986BE9x (n√∫cleo Cortex-M3) j√° havia sido lan√ßado e o controlador 1986BE1T (n√∫cleo Cortex-M1) apareceu.  Ele na caixa de pl√°stico LQFP-144 tinha a designa√ß√£o K1986BE1QI (avia) e, no pr√≥prio chip, a designa√ß√£o MDR32F1QI.  No site do fabricante, ele possui o sufixo "avia", pois possui interfaces espec√≠ficas para a ind√∫stria aeron√°utica (ARINC 429, MIL_STD_1553). <a name="habracut"></a><br><br>  Surpreendentemente, no momento da distribui√ß√£o desses controladores, a empresa Milander preparou kits de depura√ß√£o e uma biblioteca de subprogramas para trabalhar com perif√©ricos, ‚Äúmas sem garantias e obriga√ß√µes adicionais em rela√ß√£o √† corre√ß√£o da biblioteca‚Äù.  A biblioteca √© semelhante √† Biblioteca Perif√©rica Padr√£o da STMicroelectronics.  Em geral, todos os controladores ARM constru√≠dos no n√∫cleo Cortex-M t√™m muito em comum.  Por esse motivo, o conhecimento dos novos controladores russos foi r√°pido.  E para aqueles que compraram kits de depura√ß√£o de marca, foi fornecido suporte t√©cnico durante o uso. <br><br><img src="https://habrastorage.org/webt/36/-5/cu/36-5cuhduqbdylqea5diodzri2o.png"><br>  <i>Kit de depura√ß√£o para o microcontrolador 1986BE1T, ¬© Milander</i> <br><br>  No entanto, com o tempo, come√ßaram a surgir ‚Äúdoen√ßas da inf√¢ncia‚Äù de novos microcircuitos e bibliotecas.  Exemplos de teste de firmware funcionaram sem problemas vis√≠veis, mas com uma modifica√ß√£o significativa, falhas e erros ocorreram.  O primeiro "engolir" na minha pr√°tica foram falhas inexplic√°veis ‚Äã‚Äãna opera√ß√£o do controlador CAN.  Um ano depois, no controlador de auditoria precoce 1986BE1T (a√©reo), um problema foi detectado no m√≥dulo <a href="https://ru.wikipedia.org/wiki/MIL-STD-1553" rel="nofollow">MKIO (canal de troca de informa√ß√µes multiplexado)</a> .  Em geral, todas as revis√µes desses microcontroladores at√© 2016 eram de uso limitado.  Demorou muito tempo e nervos para identificar esses problemas, cuja confirma√ß√£o agora pode ser encontrada nas <a href="https://ic.milandr.ru/upload/iblock/352/352a1573c08c406a94b976ed95fe4506.pdf" rel="nofollow">listas de erros (Erratas)</a> . <br><br>  Uma caracter√≠stica desagrad√°vel era que era necess√°rio trabalhar e lidar com erros n√£o nas placas de depura√ß√£o, mas nas placas de prot√≥tipo dos dispositivos planejados para produ√ß√£o em s√©rie.  Al√©m do conector JTAG, normalmente n√£o havia nada l√°.  A conex√£o com um analisador l√≥gico era dif√≠cil e inconveniente, e geralmente n√£o havia LEDs ou telas.  Por esse motivo, pensei em criar minha pr√≥pria placa de depura√ß√£o. <br><br>  Por um lado, havia kits de depura√ß√£o de marca no mercado, al√©m de placas maravilhosas da LDM-Systems de Zelenograd.  Por outro lado, os pre√ßos desses produtos s√£o estupor e a funcionalidade b√°sica sem placas de expans√£o n√£o atende √†s expectativas.  Uma placa com um controlador soldado e um conector de pinos n√£o √© do meu interesse.  E placas mais interessantes s√£o caras. <br><br><img src="https://habrastorage.org/webt/6u/ob/ww/6uobww_tvc36dmyyhcmemgkedhg.jpeg"><br>  <i>Placa de depura√ß√£o MILANDR LDM-HELPER-K1986BE1QI-FULL, ¬© LDM Systems</i> <br><br>  Os pre√ßos e o marketing da empresa "Milander" s√£o peculiares.  Portanto, √© poss√≠vel obter amostras gr√°tis de alguns microcircuitos, mas isso est√° dispon√≠vel apenas para pessoas jur√≠dicas e est√° associado a uma busca burocr√°tica.  Em geral, os microcircuitos em uma caixa metalocer√¢mica s√£o ouro em sentido direto e figurado.  Por exemplo, o controlador 1986BE1T custa de 14 a 24 mil rublos em Moscou.  O chip de mem√≥ria est√°tica 1645RU6U custa de 15.000 rublos.  E essa ordem de pre√ßos para todos os produtos.  Como resultado, mesmo institutos de pesquisa especializados com ordens estatais economizam e evitam tais pre√ßos.  Microcircuitos em uma caixa de pl√°stico para uso civil s√£o significativamente mais baratos, mas n√£o est√£o dispon√≠veis em fornecedores populares.  Al√©m disso, a qualidade dos microcircuitos em uma caixa de pl√°stico, parece-me, √© pior que a dos ‚Äúdourados‚Äù.  Por exemplo, n√£o pude iniciar o controlador K1986BE1QI com uma frequ√™ncia de 128 MHz sem aumentar o par√¢metro de lat√™ncia do flash.  Ao mesmo tempo, a temperatura deste controlador subiu para 40-50C.  Mas o controlador 1986BE1T ("gold") foi lan√ßado em 128 MHz sem configura√ß√µes adicionais e permaneceu frio.  Ele √© realmente bom. <br><br><img src="https://habrastorage.org/webt/hm/hd/vm/hmhdvmzvhpvw7ujz09cw5ol49ou.png"><br>  <i>Microcontrolador "Dourado" 1986BE1T, (c) Milander</i> <br><br>  Tive a sorte de ainda poder comprar um microcontrolador em uma caixa de pl√°stico no varejo na LDM Systems, e todas as placas de circuito est√£o dispon√≠veis gratuitamente.  O ruim √© que no site da foto do controlador h√° uma marca√ß√£o que diz que esta √© a quarta revis√£o de 2014, ou seja,  com defeitos.  Eu pensei por um longo tempo - para comprar ou n√£o comprar.  Ent√£o, v√°rios anos se passaram ... <hr><br><br>  A id√©ia de criar uma placa de depura√ß√£o n√£o desapareceu.  Gradualmente, formei todos os requisitos e pensei em colocar tudo isso em uma placa, para que fosse compacto e n√£o fosse caro.  Paralelamente, pedi os componentes ausentes aos chineses.  N√£o tinha pressa - fiz tudo por mim.  Os fornecedores chineses s√£o famosos pela neglig√™ncia - tive que pedir a mesma coisa em lugares diferentes para obter tudo o que precisava.  Al√©m disso, alguns dos microcircuitos de mem√≥ria estavam em uso - obviamente evaporados de dispositivos quebrados.  Isso voltou para mim mais tarde. <br><br>  Comprar um microcontrolador Milander K1986BE1QI (avia) n√£o √© uma tarefa f√°cil.  Na mesma loja Chip and Dip, na se√ß√£o "Order Items", encontrei apenas o K1986BE92QI por 740 rublos, mas n√£o me agradou.  A √∫nica op√ß√£o √© comprar na LDM-Systems por 2.000 rublos, n√£o uma nova revis√£o.  Como n√£o consegui encontrar um substituto em nenhum outro lugar, decidi comprar o que era.  Para minha surpresa agrad√°vel, eles me venderam um novo controlador de vers√£o de dezembro de 2018, revis√£o 6+ (1820).  E o site ainda tem uma foto antiga e, no momento da reda√ß√£o deste documento, o controlador n√£o est√° dispon√≠vel ... <br><br><img src="https://habrastorage.org/webt/cr/p3/eu/crp3euoxhtfbkqo_pzet4vjencs.jpeg"><br>  <i>Microcontrolador K1986BE1QI (avia) em embalagens tecnol√≥gicas, (c) - Fotografia por</i> <br><br>  As principais especifica√ß√µes t√©cnicas da minha placa de depura√ß√£o <b>MDB1986 s√£o</b> as seguintes: <br><br><ul><li>  programador de depura√ß√£o integrado compat√≠vel com J-Link e CMSIS-DAP; </li><li>  Mem√≥ria est√°tica de 4Mbit (256k x 16, 10 ns); </li><li>  Chip de mem√≥ria flash de 64Mbit, Winbond 25Q64FVSIG; </li><li>  Transceptor de interface RS-232 com linhas RTS e CTS; </li><li>  interfaces e conectores para Ethernet, USB, CAN; </li><li>  Controlador de tela MAX7221 de 7 segmentos </li><li>  conector de pinos para trabalhar com MKIO (MIL_STD_1553) e ARINC429; </li><li>  Fototransistor Everlight PT17-21C; </li><li>  cinco LEDs coloridos, um bot√£o de redefini√ß√£o e dois bot√µes de usu√°rio; </li><li>  alimentado por porta USB 5 volts; </li><li>  Dimens√µes da placa de circuito impresso 100 x 80 mm </li></ul><br>  Gostei das placas da s√©rie STM-Discovery porque existe um programador de depurador embutido - o ST-Link.  O ST-Link da marca s√≥ funciona com controladores STMicroelectronics, mas h√° alguns anos se tornou poss√≠vel atualizar o firmware no ST-Link e obter um depurador SEGGER J-Link OB (integrado).  Legalmente, h√° uma restri√ß√£o no uso desse depurador apenas com placas STMicroelectronics, mas na verdade o potencial n√£o √© limitado.  Assim, tendo um J-Link OB, voc√™ pode ter um depurador embutido na placa de depura√ß√£o.  Observo que nos produtos de "LDM-Systems" √© usado o conversor CP2102 (Usb2Uart), que pode apenas piscar. <br><br><img src="https://habrastorage.org/webt/fq/yd/6z/fqyd6z1yxuwig0mw46du7l0pu8y.jpeg"><br>  <i>Microcontroladores STM32F103C8T6, reais e n√£o t√£o, (c) Foto por</i> <br><br>  Portanto, foi necess√°rio comprar o STM32F103C8T6 original, pois o firmware propriet√°rio n√£o funcionar√° corretamente com o clone.  Duvidei desta tese e decidi experimentar o controlador CS32F103C8T6 da empresa chinesa CKS em opera√ß√£o.  N√£o tenho queixas sobre o pr√≥prio controlador, mas o firmware ST-Link n√£o funcionou nele.  O J-Link funcionou parcialmente - o dispositivo USB foi detectado, mas o programador n√£o executou suas fun√ß√µes e constantemente lembrou que estava "com defeito". <br><br><img src="https://habrastorage.org/webt/sh/dp/zs/shdpzs1rrvs4ndpodfxgykmxoqk.png"><br>  <i>Erro ao trabalhar com o depurador em um controlador n√£o original</i> <br><br>  N√£o me acalmei com isso e primeiro escrevi o firmware para o LED piscar e, em seguida, realizei a solicita√ß√£o IDCODE usando o protocolo JTAG.  O programador ST-Link que eu tinha na placa Discovery e o programa Utility ST-Link estavam piscando no CS32F103C8T6 sem problemas.Como resultado, verifiquei se minha placa estava funcionando.  Para minha alegria, o controlador de destino K1986BE1QI (avia) emitiu alegremente seu IDCODE atrav√©s da linha TDO. <br><br><img src="https://habrastorage.org/webt/mg/cd/6b/mgcd6bodfiolhoncf0dqpy_ztyi.png"><br>  <i>Oscilograma da linha de sinal Tdo com resposta codificada Idcode, (c) - Fotografia por</i> <br><br><img src="https://habrastorage.org/webt/ls/9b/hk/ls9bhkuow-fz1gir-e48kwyld2i.png"><br>  <i>Portanto, a porta SWD foi √∫til para depurar o pr√≥prio depurador e verificar o IDCODE</i> <br><br>  Havia uma variante com o depurador <a href="https://arm-software.github.io/CMSIS_5/DAP/html/index.html" rel="nofollow">CMSIS-DAP (porta de acesso √† depura√ß√£o)</a> .  Criar um projeto a partir do c√≥digo fonte do ARM n√£o √© uma tarefa f√°cil, peguei o projeto no <a href="https://habr.com/ru/users/x893/" class="user_link">X893</a> e tentei o DAP42.  Infelizmente, o Keil uVision desligou e n√£o queria trabalhar com eles.  Como resultado, substitu√≠ o chip do depurador pelo propriet√°rio STM32F103C8T6 e n√£o retornei mais a esse problema. <br><br><img src="https://habrastorage.org/webt/qd/ry/fs/qdryfsbagp3hggtvmrl0tiym-dg.png"><br>  <i>Depurador J-Link STLink V2 bem-sucedido</i> <br><br>  Quando todos os principais componentes da futura placa de depura√ß√£o estavam dispon√≠veis, entrei no Eagle CAD e descobri que eles n√£o estavam na biblioteca de elementos.  Nenhum lugar para ir - eles tiveram que se desenhar.  Ao mesmo tempo, criei pegadas para a mem√≥ria, conector HanRun para Ethernet e adicionei quadros para resistores e capacitores.  O arquivo do projeto e a biblioteca de componentes podem ser encontrados <a href="https://github.com/makbit/MDB1986" rel="nofollow">no meu GitHub</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Diagrama esquem√°tico da placa de depura√ß√£o MDB1986</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hx/44/jy/hx44jyp0pkskpjgb1zh-1tf6hfu.png"></div></div><br><br>  A placa √© alimentada por uma fonte CC de 5 volts, obtida a partir da porta USB.  Existem duas portas USB tipo B na placa.  Um √© para o programador, o segundo √© para o controlador K1986BE1QI.  O conselho pode trabalhar com qualquer uma dessas fontes ou com as duas ao mesmo tempo.  O controle de carga e a prote√ß√£o mais simples das linhas de energia s√£o implementados nos diodos Schottky, no circuito D2 e ‚Äã‚ÄãD3 (SS24).  Tamb√©m no diagrama, voc√™ pode ver os fus√≠veis auto-repar√°veis ‚Äã‚ÄãF1 e F2 a 500mA.  As linhas de sinal da porta USB s√£o protegidas por um conjunto de diodos USBLC6-2SC6. <br><br>  O circuito depurador-programador ST-Link √© conhecido por muitos, pode ser encontrado na documenta√ß√£o das placas STM32-Discovery e outras fontes.  Para o firmware inicial do clone ST-Link / J-Link-OB / DAP (opcional), destaquei as linhas SWDIO (PA13), SWCLK (PA14), GND.  Muitas pessoas usam o UART para firmware e s√£o for√ßadas a puxar os jumpers BOOT.  Mas o SWD √© mais conveniente para mim, al√©m disso, esse protocolo permite a depura√ß√£o. <br><br>  Quase todos os componentes da placa s√£o alimentados por 3,3 volts, provenientes do regulador de tens√£o AMS1117-3.3.  Para suprimir a interfer√™ncia eletromagn√©tica e as correntes de irrup√ß√£o, s√£o utilizados filtros LC dos capacitores e bobinas da s√©rie BLM31PG. <br><br>  Tamb√©m devemos mencionar o driver para o display de 7 segmentos MAX7221.  De acordo com a especifica√ß√£o, a fonte de alimenta√ß√£o recomendada √© de 4 a 5,5 volts e o alto n√≠vel de sinal (unidade l√≥gica) √© de pelo menos 3,5V (0,7 x VCC), com fonte de alimenta√ß√£o de 5V.  Para o controlador K1986BE1QI (avia), a sa√≠da de uma unidade l√≥gica corresponde a uma tens√£o de 2,8 a 3,3V.  Obviamente, h√° uma incompatibilidade de n√≠veis de sinal que pode interferir na opera√ß√£o normal.  Decidi alimentar o MAX7221 de 4V e baixar os n√≠veis de sinal para 2,8V (0,7 x 4 = 2,8).  Para isso, o diodo D4 (RS1A ou FR103) √© instalado em s√©rie com o circuito da fonte de alimenta√ß√£o do driver.  A queda de tens√£o total √© de 0,9V (diodo Schottky de 0,3V e 0,6V) e tudo funciona. <br><br>  A maioria das portas do microcontrolador K1986BE1QI (avia) s√£o compat√≠veis com sinais de at√© 5V.  Portanto, o uso do transceptor CAN MCP2551, que tamb√©m opera em 5V, n√£o causa problemas.  O chip MAX3232 √© indicado no diagrama como um transceptor RS-232, mas na verdade eu usei o SN65C3232D da Texas Instruments, porque  Funciona a partir de 3.3V e fornece velocidades de at√© 1Mbit / s. <br><br>  Existem 4 ressonadores de quartzo na placa - um para o depurador (8 MHz) e tr√™s para o microcontrolador de destino K1986BE1QI (avia) com valores de 32.768 kHz, 16 MHz, 25 MHz.  Esses s√£o componentes necess√°rios, como  Os par√¢metros do gerador RC incorporado est√£o em uma ampla faixa de 6 a 10 MHz.  √â necess√°ria uma frequ√™ncia de 25 MHz para a opera√ß√£o do controlador Ethernet integrado.  No site de Milander (talvez por engano), por algum motivo, √© indicado que n√£o h√° Ethernet no estojo de pl√°stico.  Mas confiaremos na especifica√ß√£o e nos fatos. <br><br>  Um incentivo importante para criar sua pr√≥pria placa de depura√ß√£o foi a capacidade de trabalhar com o barramento de sistema externo EBC (controlador de barramento externo), que √© essencialmente uma porta paralela.  O microcontrolador K1986BE1QI (avia) permite conectar e trabalhar com chips de mem√≥ria e perif√©ricos externos, por exemplo, ADC, FPGA, etc.  Os recursos do barramento do sistema externo s√£o bastante grandes - voc√™ pode trabalhar com RAM est√°tica de 8 bits, 16 bits e 32 bits, ROM e NAND Flash.  Para ler / gravar dados de 32 bits, o controlador pode executar automaticamente 2 opera√ß√µes correspondentes para circuitos de 16 bits e para opera√ß√µes de 8 bits - 4.  Obviamente, uma opera√ß√£o de E / S de 32 bits ser√° a mais r√°pida com o barramento de dados de 32 bits.  As desvantagens incluem a necessidade do programa operar com dados de 32 bits e 32 faixas devem ser colocadas no quadro. <br><br><img src="https://habrastorage.org/webt/oh/sf/n8/ohsfn8vpr98krnms8rohx6l-bjs.jpeg"><br>  <i>Usados ‚Äã‚Äãchips de RAM est√°ticos (adivinhe qual deles est√° com defeito)</i> <br><br>  Uma solu√ß√£o equilibrada √© usar chips de mem√≥ria de 16 bits.  Tenho Integrated Silicon Solutions Inc.  (ISSI IS61LV25616AL, 16 x 256k, 10 ns, 3,3V).  Obviamente, a empresa Milander possui sua pr√≥pria <a href="https://ic.milandr.ru/products/mikroskhemy_pamyati/" rel="nofollow">s√©rie 1645RU de chips de</a> mem√≥ria est√°tica, mas s√£o muito caros e inacess√≠veis.  Como alternativa, existem compat√≠veis com pinos Samsung K6R4016V1D.  Mencionei anteriormente que os microcircuitos estavam em uso e a inst√¢ncia que instalei inicialmente forneceu falhas e valores ca√≥ticos na 15¬™ linha de dados.  Demorou v√°rios dias para procurar erros de hardware, e maior foi a sensa√ß√£o de satisfa√ß√£o quando substitu√≠ o chip danificado por um que funcionava.  Seja como for, a velocidade de trabalhar com mem√≥ria externa deixa muito a desejar. <br><br><div class="spoiler">  <b class="spoiler_title">Barramento externo e modo aut√¥nomo</b> <div class="spoiler_text">  O microcontrolador K1986BE1QI (avia) possui um modo StandAlone exclusivo, projetado para acesso externo direto aos controladores Ethernet e MKIO (MIL_STD_1553) por meio de um barramento externo, e o n√∫cleo est√° em um estado de redefini√ß√£o, ou seja,  n√£o usado.  Este modo √© conveniente para processadores e FPGAs nos quais n√£o h√° Ethernet e / ou MKIO. </div></div><br>  O diagrama de conex√£o √© o seguinte: <br><br><ul><li>  Barramento de dados do MCU (D0-D15) =&gt; SRAM (E / S0-E / O15), </li><li>  barramento de endere√ßo MCU (A1-A18) =&gt; SRAM (A0-A17), </li><li>  Controle MCU (nWR, nRD, PortC2) =&gt; SRAM (WE, OE, CE), </li><li>  SRAM (UB, LB) conectado ou puxado para o terra atrav√©s de um resistor. </li></ul><br>  A linha CE √© puxada para cima por energia atrav√©s de um resistor; os pinos para a sele√ß√£o de bytes do MCU (BE0-BE3) n√£o s√£o usados.  Sob o spoiler, cito o c√≥digo de inicializa√ß√£o da porta e o controlador de barramento externo. <br><br><div class="spoiler">  <b class="spoiler_title">Inicializa√ß√£o de portas e controlador EBC (controlador de barramento externo)</b> <div class="spoiler_text"><pre><code class="plaintext hljs">void SRAM_Init (void) { EBC_InitTypeDef EBC_InitStruct = { 0 }; EBC_MemRegionInitTypeDef EBC_MemRegionInitStruct = { 0 }; PORT_InitTypeDef initStruct = { 0 }; RST_CLK_PCLKcmd (RST_CLK_PCLK_EBC, ENABLE); PORT_StructInit (&amp;initStruct); //--------------------------------------------// // DATA PA0..PA15 (D0..D15) // //--------------------------------------------// initStruct.PORT_MODE = PORT_MODE_DIGITAL; initStruct.PORT_PD_SHM = PORT_PD_SHM_ON; initStruct.PORT_SPEED = PORT_SPEED_FAST; initStruct.PORT_FUNC = PORT_FUNC_MAIN; initStruct.PORT_Pin = PORT_Pin_All; PORT_Init (MDR_PORTA, &amp;initStruct); //--------------------------------------------// // Address PF3-PF15 (A0..A12), A0 - not used. // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_ALTER; initStruct.PORT_Pin = PORT_Pin_4 | PORT_Pin_5 | PORT_Pin_6 | PORT_Pin_7 | PORT_Pin_8 | PORT_Pin_9 | PORT_Pin_10 | PORT_Pin_11 | PORT_Pin_12 | PORT_Pin_13 | PORT_Pin_14 | PORT_Pin_15; PORT_Init (MDR_PORTF, &amp;initStruct); //--------------------------------------------// // Address PD3..PD0 (A13..A16) // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_OVERRID; initStruct.PORT_Pin = PORT_Pin_0 | PORT_Pin_1 | PORT_Pin_2 | PORT_Pin_3; PORT_Init (MDR_PORTD, &amp;initStruct); //--------------------------------------------// // Address PE3, PE4 (A17, A18) // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_ALTER; initStruct.PORT_Pin = PORT_Pin_3 | PORT_Pin_4; PORT_Init (MDR_PORTE, &amp;initStruct); //--------------------------------------------// // Control PC0,PC1 (nWE,nOE) // //--------------------------------------------// initStruct.PORT_FUNC = PORT_FUNC_MAIN; initStruct.PORT_Pin = PORT_Pin_0 | PORT_Pin_1; PORT_Init (MDR_PORTC, &amp;initStruct); //--------------------------------------------// // Control PC2 (nCE) // //--------------------------------------------// initStruct.PORT_PD = PORT_PD_DRIVER; initStruct.PORT_OE = PORT_OE_OUT; initStruct.PORT_FUNC = PORT_FUNC_PORT; initStruct.PORT_Pin = MDB_SRAM_CE; PORT_Init (MDR_PORTC, &amp;initStruct); //--------------------------------------------// // Initialize EBC controler // //--------------------------------------------// EBC_DeInit(); EBC_StructInit(&amp;EBC_InitStruct); EBC_InitStruct.EBC_Mode = EBC_MODE_RAM; EBC_InitStruct.EBC_WaitState = EBC_WAIT_STATE_3HCLK; EBC_InitStruct.EBC_DataAlignment = EBC_EBC_DATA_ALIGNMENT_16; EBC_Init(&amp;EBC_InitStruct); EBC_MemRegionStructInit(&amp;EBC_MemRegionInitStruct); EBC_MemRegionInitStruct.WS_Active = 2; EBC_MemRegionInitStruct.WS_Setup = EBC_WS_SETUP_CYCLE_1HCLK; EBC_MemRegionInitStruct.WS_Hold = EBC_WS_HOLD_CYCLE_1HCLK; EBC_MemRegionInitStruct.Enable_Tune = ENABLE; EBC_MemRegionInit (&amp;EBC_MemRegionInitStruct, EBC_MEM_REGION_60000000); EBC_MemRegionCMD(EBC_MEM_REGION_60000000, ENABLE); // Turn ON RAM (nCE) PORT_ResetBits (MDR_PORTC, MDB_SRAM_CE); }</code> </pre> </div></div><br>  O microcontrolador no pacote LQFP-144 e a mem√≥ria no pacote TSOP-44 possuem muitos pinos conectados e ocupam muito espa√ßo na placa de circuito impresso.  Tendo experi√™ncia na solu√ß√£o de problemas de otimiza√ß√£o no campo da economia, era √≥bvio para mim que era necess√°rio colocar esses microcircuitos no quadro em primeiro lugar.  Em v√°rias fontes, vi elogios ao <a href="https://www.eremex.ru/products/delta-design/topor/" rel="nofollow">TopoR CAD (Roteador Topol√≥gico)</a> .  Eu baixei a vers√£o de teste e pude exportar meu projeto para l√° do Eagle CAD somente quando exclu√≠ quase todos os componentes.  Infelizmente, at√© 10 elementos do programa TopoR n√£o me ajudaram a colocar no quadro.  Primeiro, todos os componentes foram colocados em um canto e depois colocados ao longo da borda.  Essa op√ß√£o n√£o me satisfez e, durante muito tempo, localizei a placa no modo manual no ambiente familiar CAD da Eagle. <br><br>  Um elemento importante da placa de circuito impresso √© a serigrafia.  A placa de depura√ß√£o n√£o deve ter apenas assinaturas para componentes eletr√¥nicos, mas todos os conectores devem ser assinados.  Na parte de tr√°s do quadro, coloquei tabelas de memorando com as fun√ß√µes das portas do controlador (prim√°rio, alternativo, substitu√≠do, atual).  Encomendei a fabrica√ß√£o de placas de circuito impresso na China no conhecido escrit√≥rio da PCBWay.  N√£o vou elogiar, porque a qualidade √© boa.  Eles podem fazer melhor, com menos toler√¢ncias, mas <a href="https://www.pcbway.com/HighQualityOrderOnline.aspx" rel="nofollow">por uma taxa</a> . <br><br><img src="https://habrastorage.org/webt/8q/gh/2w/8qgh2wsaofz5p2lat7gcoqc4km4.jpeg"><br>  <i>Placas de circuito impresso fabricadas MDB1986, (c) Foto por autor</i> <br><br>  Eu tive que soldar os componentes "no meu joelho" com um ferro de solda de 40 watts e solda POS-61, porque raramente o soldo, 1-2 vezes por ano, e a pasta de solda secou.  Eu tive que mudar o controlador CS32F103 chin√™s para o STM32F103 original e tamb√©m substituir a mem√≥ria.  Em geral, agora o resultado me conv√©m completamente, embora ainda n√£o tenha verificado a opera√ß√£o do RS-232 e CAN. <br><br><img src="https://habrastorage.org/webt/-h/il/8v/-hil8vgd1228zqjk7ig090eurpq.jpeg"><br>  <i>Placa de depura√ß√£o MDB1986 no trabalho - brilha e aquece, (c) foto por</i> <br><br>  Voc√™ pode encontrar <a href="https://edu.milandr.ru/library/" rel="nofollow">materiais de treinamento</a> suficientes <a href="https://edu.milandr.ru/library/" rel="nofollow">no</a> site da Milander <a href="https://edu.milandr.ru/library/" rel="nofollow">para estudar</a> os controladores da s√©rie 1986BE9 (n√∫cleo Cortex-M3), mas n√£o vejo nada para o microcontrolador K1986BE1QI (avia).  Depois de revisar os materiais publicados l√°, os manuais e os trabalhos de laborat√≥rio das universidades, fico feliz que o pessoal esteja sendo treinado em todo o pa√≠s para trabalhar com os controladores russos.  A maioria dos materiais de treinamento √© preparada para trabalhar com portas de E / S, timers, ADCs, DACs, SPI, UART.  Diferentes ambientes de desenvolvimento IDE s√£o usados ‚Äã‚Äã(Keil, IAR, CodeMaster).  Em algum lugar, eles programam usando registros CMSIS e em algum lugar usam a Biblioteca MDR.  √â necess√°rio mencionar o recurso <a href="https://startmilandr.ru/" rel="nofollow">Start Milandr</a> , que cont√©m muitos artigos de programadores pr√°ticos.  E, √© claro, n√£o se deve esquecer <a href="https://forum.milandr.ru/" rel="nofollow">o f√≥rum de Milander</a> . <br><br><div class="spoiler">  <b class="spoiler_title">O Pensamento de Milander</b> <div class="spoiler_text">  A microeletr√¥nica est√° se desenvolvendo na R√∫ssia e Milander desempenha um papel de destaque nesse processo.  Existem novos microcontroladores interessantes, por exemplo, 198681 e "Power" com interfaces SpaceWire e MKIO (o mesmo que em 1986BE1 e, possivelmente, com os mesmos problemas), etc.  Mas estudantes comuns, professores e engenheiros civis para comprar esses chips n√£o s√£o realistas.  Portanto, a comunidade de engenheiros n√£o poder√° identificar rapidamente os erros e problemas desse chip.  Parece-me que, a princ√≠pio, √© necess√°rio produzir microcircuitos em uma caixa de pl√°stico, distribu√≠-la a todas as partes interessadas e, somente ap√≥s o teste (aprova√ß√£o em latim - aprova√ß√£o, reconhecimento), os especialistas podem preparar uma auditoria em uma caixa de metal-cer√¢mica com prote√ß√£o contra todos os fatores terr√≠veis.  Espero que, no futuro pr√≥ximo, todos n√≥s gostemos dos novos projetos anunciados nas exposi√ß√µes. </div></div><br>  Qualquer pessoa desenvolvida por mim, o quadro de depura√ß√£o, pode repetir, modificar e usar no processo educacional.  Antes de tudo, criei um quadro para mim, mas ficou t√£o bem que <a href="https://github.com/makbit/MDB1986" rel="nofollow">decidi compartilh√°-lo com todos</a> . <br><br>  O K1986BE1QI (avia) √© um controlador muito interessante com interfaces exclusivas que podem ser usadas nas universidades para educar os alunos.  Acho que depois de corrigir os erros detectados no controlador e passar nos testes de certifica√ß√£o, o controlador voar√° no sentido literal da palavra! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482716/">https://habr.com/ru/post/pt482716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482704/index.html">Sincroniza√ß√£o de cache Redis para o servi√ßo Go</a></li>
<li><a href="../pt482706/index.html">Recomenda√ß√µes para a implementa√ß√£o do RAS cont√°bil paralelo + IFRS na plataforma 1C</a></li>
<li><a href="../pt482708/index.html">Um recurso da cultura corporativa necess√°rio para o bem-estar da base de c√≥digo</a></li>
<li><a href="../pt482712/index.html">Antiguidades: Sony MZ-1 ou a hist√≥ria de um prot√≥tipo que entrou em produ√ß√£o</a></li>
<li><a href="../pt482714/index.html">A coluna de r√°dio na Internet mais simples "Kodi" ou o resgate do tijolo "Raspberry"</a></li>
<li><a href="../pt482722/index.html">Hist√≥ria fant√°stica "Projeto C. Vaidade das vaidades" (10 min.)</a></li>
<li><a href="../pt482726/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel # 328 (23 a 29 de dezembro)</a></li>
<li><a href="../pt482728/index.html">JPEG. Algoritmo de compress√£o</a></li>
<li><a href="../pt482730/index.html">Enquete de f√©rias</a></li>
<li><a href="../pt482734/index.html">Ofuscar tempo de compila√ß√£o usando NAND / NOR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>