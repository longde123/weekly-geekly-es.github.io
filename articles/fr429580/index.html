<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèΩ‚Äçüíª ‚ö´Ô∏è ü§úüèº Microinteractions dans iOS. Conf√©rence Yandex üï¶ üçå üíáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a quelques semaines, un √©v√©nement sp√©cial de la communaut√© CocoaHeads a eu lieu dans le bureau Yandex - plus grand que les mitaps traditionnels. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Microinteractions dans iOS. Conf√©rence Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/429580/">  Il y a quelques semaines, un √©v√©nement sp√©cial de la communaut√© CocoaHeads a eu lieu dans le bureau Yandex - plus grand que les mitaps traditionnels.  Le d√©veloppeur Anton Sergeyev a pris la parole lors de cette r√©union et a parl√© du mod√®le de micro-interaction que les concepteurs UX utilisent habituellement, ainsi que de la fa√ßon de mettre en pratique les id√©es qu'il contient.  Anton a accord√© la plus grande attention √† l'animation. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JoVBQCwX8ys" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - Il est tr√®s important pour moi que j'ai eu l'honneur de rencontrer les invit√©s.  Je vois ici ceux que je connais depuis tr√®s longtemps, ceux que j'ai connus r√©cemment et ceux que je n'ai pas encore rencontr√©s.  Bienvenue sur CocoaHeads. <a name="habracut"></a><br><br>  Je vais vous parler des micro-interactions.  C'est un peu l'app√¢t du clic - nous sommes ing√©nieurs, d√©veloppeurs, nous parlerons plus de la partie logicielle, mais nous commencerons par un sujet tr√®s humanitaire, comme les micro-interactions.  En cons√©quence, nous appliquerons ce th√®me humanitaire dans la partie technique pour apprendre √† concevoir plus efficacement et simplement de tr√®s petits composants visuels, tels que des boutons, de petits chargeurs, des barres.  Ils sont satur√©s d'animation et le code d'animation ramifi√© peut souvent sembler tr√®s compliqu√©, il est extr√™mement difficile √† maintenir. <br><br>  Mais d'abord, un peu de distraction.  Pensez-y, vous souvenez-vous quand vous avez d√©cid√© de devenir d√©veloppeur?  Je m'en souviens clairement.  Tout a commenc√© avec une table.  Une fois, j'ai d√©cid√© d'apprendre ObjC.  Un langage √† la mode, amusant, juste comme √ßa, sans plans ambitieux.  J'ai trouv√© un livre, semble-t-il, Big Nerd Ranch, et j'ai commenc√© √† lire chapitre par chapitre, faisant chaque exercice, v√©rifiant, lisant, jusqu'√† ce que j'atteigne la table.  Je me suis ensuite familiaris√© avec le mod√®le de d√©l√©gu√©, plus pr√©cis√©ment avec sa sous-esp√®ce ¬´Data source¬ª, source de donn√©es.  Ce paradigme me semble tr√®s simple maintenant: il y a une source de donn√©es, d√©l√©gu√©, tout est simple.  Mais ensuite, cela m'a √©poustoufl√©: comment puis-je s√©parer une table de donn√©es compl√®tement diff√©rentes?  Vous avez d√©j√† vu un tableau sur un morceau de papier dans lequel vous pouvez mettre un nombre infini de lignes, des donn√©es compl√®tement abstraites.  Cela m'a beaucoup influenc√©.  J'ai r√©alis√© que la programmation, le d√©veloppement ont d'√©normes opportunit√©s, et il sera tr√®s int√©ressant de les appliquer.  Depuis lors, j'ai d√©cid√© de devenir d√©veloppeur. <br><br>  Au cours du d√©veloppement, divers mod√®les ont √©t√© rencontr√©s.  √ânormes, appel√©es architectures qui d√©crivent l'ensemble de l'application.  Des petits qui tiennent par dizaines dans un petit bouton.  Il est important de comprendre que tous ces sch√©mas ne sont pas venus de l'air, mais du secteur humanitaire.  Le m√™me mod√®le de d√©l√©gu√©.  La d√©l√©gation est apparue bien avant la programmation, et la programmation reprend toutes ces choses humanitaires pour un travail plus efficace. <br><br>  Aujourd'hui, je vais parler d'une autre approche qui prend le relais d'une autre chose humanitaire.  En particulier, sur les micro-interactions. <br><br>  Tout a commenc√© avec un chargeur.  Lors des travaux pr√©c√©dents, avant Yandex, j'avais la t√¢che de r√©p√©ter le chargeur de conception de mat√©riaux Google.  Il y en a deux, l'un ind√©fini, l'autre d√©fini.  J'ai eu la t√¢che de les combiner en un seul, il devait √™tre √† la fois certain et ind√©fini, mais il y avait des exigences strictes - de sorte que c'√©tait extr√™mement lisse.  √Ä tout moment, nous pouvons passer d'un √©tat √† un autre, et tout doit √™tre anim√© en douceur et avec pr√©cision. <br><br>  Je suis un d√©veloppeur intelligent, j'ai tout fait.  J'ai re√ßu plus de 1000 lignes de code de nouilles incompr√©hensible.  Cela a fonctionn√©, mais j'ai re√ßu un commentaire sympa sur la r√©vision du code: "J'esp√®re vraiment que personne ne modifiera jamais ce code."  Et pour moi, c'est pratiquement inappropri√©.  J'ai √©crit un code affreux.  Cela fonctionnait bien, c'√©tait l'une de mes meilleures animations, mais le code √©tait horrible. <br><br>  Aujourd'hui, je vais essayer de d√©crire l'approche que j'ai trouv√©e apr√®s avoir quitt√© ce poste. <br><br><img src="https://habrastorage.org/webt/w6/93/ez/w693ezlmyrpdyxgcxluxx0scxdo.jpeg"><br><br>  Commen√ßons par le sujet le plus humanitaire - les mod√®les de micro-interaction.  Comment sont-ils int√©gr√©s et g√©n√©ralement o√π sont-ils cach√©s dans nos applications?  Continuons √† utiliser ce mod√®le dans notre monde technique.  Consid√©rez comment UIView, qui traite de l'affichage et de l'animation, comment cela fonctionne.  En particulier, nous parlerons beaucoup du m√©canisme CAAction, qui est √©troitement int√©gr√© √† et fonctionne avec UIView, CALayer.  Et puis consid√©rez de petits exemples. <br><br>  D√©finition d'abord.  Apparemment, l'auteur a vraiment aim√© le pr√©fixe "micro", mais il n'y a pas de macro ou nano-interactions, la taille n'a pas d'importance.  Pour simplifier, nous les appellerons simplement des interactions.  Il s'agit d'un mod√®le tellement pratique qui vous permet de d√©crire toute interaction avec l'application, du d√©but √† la fin.  Il se compose de quatre points: un d√©clencheur, une logique m√©tier qui doit √™tre impl√©ment√©e dans cette interaction, une r√©troaction pour transmettre quelque chose √† l'utilisateur et un changement dans l'√©tat de l'application. <br><br>  Je vais raconter une histoire avec trois r√¥les diff√©rents.  Je vais commencer par l'utilisateur, la chose la plus importante dans le d√©veloppement.  Quand je pr√©parais le rapport, je suis tomb√© malade.  J'avais besoin de trouver une pharmacie et j'ai ouvert Yandex.Map.  J'ai ouvert l'application, regardez-la, elle me regarde, mais rien ne se passe.  J'ai alors r√©alis√© que j'√©tais l'utilisateur, je suis le principal, je donne des instructions sur ce qu'il faut faire pour l'application.  J'ai orient√©, cliqu√© sur le bouton ¬´rechercher¬ª, entr√© ¬´pharmacie¬ª, cliqu√© sur ¬´OK¬ª, l'application a fait le travail interne, trouv√© les pharmacies n√©cessaires √† c√¥t√© de moi et l'affichait sur l'√©cran. <br><br>  J'ai cherch√© la bonne et j'ai constat√© qu'en plus des pharmacies, un bouton sp√©cial apparaissait √† l'√©cran - pour construire un itin√©raire.  Ainsi, l'application est pass√©e √† un nouvel √©tat.  J'ai cliqu√© dessus et je suis all√© √† la pharmacie.  Je suis entr√© dans cette application pour une raison quelconque - pour trouver une pharmacie.  Je l'ai atteinte.  Je suis un utilisateur satisfait. <br><br>  Avant que cette application n'apparaisse et que j'aie pu y chercher quelque chose, elle a d'abord √©t√© d√©velopp√©e.  Qu'a pens√© le concepteur UX lorsqu'il a mis au point ce processus?  Tout a commenc√© par le fait qu'il fallait sortir d'une sc√®ne muette lorsque l'utilisateur et l'application se regardent, et rien ne se passe.  Pour cela, une sorte de d√©clencheur √©tait n√©cessaire.  Tout a un d√©but, et l√† aussi, il fallait commencer quelque part. <br><br>  Le d√©clencheur a √©t√© s√©lectionn√© - bouton de recherche.  En cliquant dessus, il fallait r√©soudre le probl√®me d'un point de vue technique.  Demander des donn√©es sur le serveur, analyser la r√©ponse, mettre √† jour le mod√®le, analyser.  Demandez la position actuelle des utilisateurs et plus encore.  Nous avons donc obtenu ces donn√©es et nous savons exactement o√π se trouvent toutes les pharmacies. <br><br>  Il semblerait qu'il soit possible d'y mettre fin.  Apr√®s tout, nous avons r√©solu le probl√®me, trouv√© toutes les pharmacies.  Il n'y a qu'un seul probl√®me: l'utilisateur ne sait toujours rien de ces pharmacies.  Il a besoin de le faire passer. <br><br>  D'une mani√®re ou d'une autre, emballer notre solution √† ce probl√®me et la lui apporter dans un bel emballage pour qu'il le comprenne.  Il se trouve que les utilisateurs sont des personnes, ils interagissent avec le monde ext√©rieur √† travers les sens.  L'√©tat actuel de la technologie est tel que nous, en tant que d√©veloppeurs d'applications mobiles, n'avons que trois sens: la vision - nous pouvons montrer quelque chose sur l'√©cran, l'ou√Øe - nous pouvons reproduire dans les haut-parleurs, et une sensation tactile, nous pouvons pousser l'utilisateur dans la main. <br><br>  Mais l'homme est beaucoup plus fonctionnel.  Mais l'√©tat actuel de la technologie est tel que pour le moment nous ne pouvons compter que sur ces trois-l√†.  Et dans ce cas, nous s√©lectionnons un √©cran, affichons sur la carte les pharmacies les plus proches et une liste avec des informations plus d√©taill√©es sur ces pharmacies.  Et il semblerait que c'est exactement tout, l'utilisateur a trouv√© des pharmacies et tout va bien. <br><br>  Mais il y a un probl√®me.  Lorsque l'utilisateur est entr√© dans l'application, il se trouvait dans un contexte dans lequel il ne savait pas o√π se trouvaient les pharmacies.  Et ses t√¢ches consistaient √† la retrouver.  Mais maintenant le contexte a chang√©, il sait o√π sont les pharmacies, il n'a plus besoin de les chercher.  Il avait la t√¢che suivante - obtenir des instructions pour la prochaine pharmacie.  C'est pourquoi nous devons afficher des contr√¥les suppl√©mentaires √† l'√©cran, en particulier, c'est un bouton pour construire un itin√©raire, c'est-√†-dire transf√©rer l'application dans un autre √©tat dans lequel elle est pr√™te √† accepter √† nouveau de nouveaux d√©clencheurs pour les prochaines interactions. <br><br>  Imaginez, le concepteur UX a propos√© tout cela, vient au d√©veloppeur et commence √† d√©crire en couleurs comment l'utilisateur clique sur le bouton, comment et ce qui se passe, comment il est recherch√©, comment l'utilisateur est satisfait, comment nous augmentons la DAU et ainsi de suite.  La pile de questions non r√©solues du d√©veloppeur a d√©bord√© ailleurs sur la premi√®re phrase, lorsque nous avons mentionn√© le bouton pour la premi√®re fois. <br><br>  Il √©coute patiemment tout, et √† la fin, quand √ßa se termine, il dit que d'accord, c'est cool, mais parlons du bouton.  C'est un √©l√©ment important. <br><br>  Au cours de la discussion, il s'av√®re que le bouton est intrins√®quement un d√©clencheur, il contient en lui-m√™me une logique par laquelle il peut recevoir des messages du syst√®me, en particulier, sur les clics des utilisateurs sur l'√©cran.  Sur la base de ce clic, il peut d√©marrer une cha√Æne d'√©v√©nements, qui commence par le fait que le m√™me bouton envoie des messages √† diff√©rents objets sur la n√©cessit√© de d√©marrer divers processus, dans ce cas, demander des informations sur le serveur, un peu plus. <br><br>  Lorsqu'il est enfonc√©, le bouton change d'√©tat, il devient enfonc√©.  Lorsque l'utilisateur rel√¢che, il cesse d'√™tre press√©.  Autrement dit, il donne un retour √† l'utilisateur afin qu'il comprenne √† quoi s'attendre de ce bouton.  Et le bouton peut √™tre press√©, non press√©, actif ou inactif, dans diff√©rents √©tats, et se d√©placer selon une logique diff√©rente d'un √©tat √† l'autre. <br><br>  Ainsi, nous avons vu que le m√™me mod√®le de micro-interaction, qui consiste en un d√©clencheur, une logique m√©tier, un retour d'exp√©rience et des changements d'√©tat, peut d√©crire notre application √† diff√©rentes √©chelles, comme √† l'√©chelle d'un cas utilisateur complet, une √©norme recherche de la pharmacie la plus proche, donc en termes de petit bouton. <br><br>  Et c'est un mod√®le tr√®s pratique qui vous permet de simplifier l'interaction au sein de l'√©quipe et de d√©crire par programme, quatre entit√©s distinctes: d√©clencheur, logique m√©tier, r√©troaction et changement d'√©tat.  Voyons ce que UIKit nous offre pour l'utiliser.  Et non seulement fournit, mais utilise.  Lors de la mise en ≈ìuvre de diverses animations, les petits composants des sous-classes UIView, il utilise uniquement ce m√©canisme, et ne va pas de mani√®re diff√©rente. <br><br>  Commen√ßons par UIView, comment il s'int√®gre dans ce mod√®le.  Ensuite, nous consid√©rerons CALayer qu'il nous fournit pour soutenir ces √©tats, et nous consid√©rerons le m√©canisme des actions, le moment le plus int√©ressant. <br><br>  Commen√ßons par l'UIView.  Nous l'utilisons pour afficher des rectangles √† l'√©cran.  Mais en fait, UIView ne sait pas se dessiner, il utilise pour cela un autre objet CALayer.  En fait, UIView s'engage √† recevoir des messages sur le toucher du syst√®me, ainsi que sur d'autres appels, concernant l'API que nous avons d√©finie dans nos sous-classes d'UIView.  Ainsi, UIView impl√©mente lui-m√™me la logique de d√©clenchement, c'est-√†-dire le lancement de certains processus, recevant ces messages du syst√®me. <br><br>  UIView peut √©galement informer ses d√©l√©gu√©s des √©v√©nements qui se sont produits et √©galement envoyer des messages aux abonn√©s, comme, par exemple, faire des sous-classes UIControl des √©v√©nements diff√©rents.  De cette fa√ßon, la logique m√©tier de cette UIView est impl√©ment√©e.  Tous n'ont pas de logique m√©tier, beaucoup d'entre eux ne sont que des √©l√©ments d'affichage et n'ont pas de r√©troaction au sens de la logique m√©tier. <br><br><img src="https://habrastorage.org/webt/ur/9o/tu/ur9otu78v5xkyy3knr8ze443pl8.jpeg"><br><br>  Nous avons examin√© deux points, un d√©clencheur et une logique m√©tier.  Et o√π les commentaires et les changements d'√©tat sont-ils cach√©s dans UIView?  Pour comprendre cela, nous devons nous rappeler que UIView n'existe pas par lui-m√™me.  Une fois cr√©√©, il cr√©e un backlayer, une sous-classe de CALayer. <br><br><img src="https://habrastorage.org/webt/_y/dw/wt/_ydwwtnnokhkvxeuj5kl02v4qaa.jpeg"><br><br>  Et se d√©signe lui-m√™me son d√©l√©gu√©.  Pour comprendre comment UIView utilise CALayer, il peut exister dans diff√©rents √©tats. <br><br>  Comment distinguer un √©tat d'un autre?  Ils diff√®rent par l'ensemble de donn√©es qui doit √™tre stock√© quelque part.  Nous consid√©rerons quelles fonctionnalit√©s CALayer nous fournit pour UIView, afin qu'il stocke l'√©tat. <br><br><img src="https://habrastorage.org/webt/ls/2x/7f/ls2x7f_qs_-ysgeirsunqki1o7o.jpeg"><br><br>  Notre interface se d√©veloppe un peu, l'interaction entre UIView et CALayer, UIView a une t√¢che suppl√©mentaire - mettre √† jour le r√©f√©rentiel dans CALayer. <br><br>  Un fait peu connu que peu de gens utilisent: CALayer peut se comporter comme un tableau associatif, ce qui signifie que nous pouvons y √©crire des donn√©es arbitraires sur n'importe quelle cl√© comme suit: setValue (_: forKey :). <br><br><img src="https://habrastorage.org/webt/hy/l_/r9/hyl_r9663azms_wx4qlf1f12ctw.jpeg"><br><br>  Cette m√©thode est pr√©sente dans toutes les sous-classes NSObject, mais contrairement √† beaucoup d'autres, lorsqu'une cl√© est re√ßue qui n'est pas remplac√©e par elle, elle ne se bloque pas.  Et il l'√©crit correctement, puis nous pouvons le lire.  C'est une chose tr√®s pratique qui permet, sans cr√©er de sous-classes de CALayer, d'y √©crire des donn√©es puis de les lire, en les consultant.  Mais il s'agit d'un r√©f√©rentiel simple tr√®s primitif, en fait, un dictionnaire.  CALayer est beaucoup plus progressif.  Il prend en charge les styles. <br><br>  Ceci est impl√©ment√© par la propri√©t√© Style que poss√®de n'importe quel CALayer.  Par d√©faut, il est nul, mais nous pouvons le red√©finir et l'utiliser. <br><br><img src="https://habrastorage.org/webt/ow/x1/ox/owx1ox1elo1_go_6jxikiuc6fws.jpeg"><br><br>  En g√©n√©ral, c'est un dictionnaire ordinaire et rien de plus, mais il a une particularit√© sur la fa√ßon dont CALayer fonctionne avec lui, si nous demandons la valeur de Key, une autre m√©thode que NSObject a.  Il agit de mani√®re tr√®s int√©ressante, il recherche r√©cursivement les valeurs n√©cessaires dans le dictionnaire de style.  Si nous emballons un style existant dans un nouveau style avec la cl√© de style et y √©crivons quelques cl√©s, mais cela se pr√©sentera de la mani√®re suivante. <br><br><img src="https://habrastorage.org/webt/xd/m3/z1/xdm3z1vyiscv35nd1jspq5aujve.jpeg"><br><br>  Regardez d'abord la racine, puis l'int√©rieur des terres et ainsi de suite, jusqu'√† ce que cela ait du sens.  Lorsque le style devient nul, cela n'a aucun sens de chercher plus loin. <br><br>  De cette fa√ßon, UIView peut, en utilisant l'infrastructure fournie par CALayer, organiser les changements d'√©tat, mettre √† jour le r√©f√©rentiel CALayer interne, soit en utilisant le style, un r√©f√©rentiel tr√®s puissant qui peut simuler une pile, soit en utilisant un tableau associatif r√©gulier, qui est √©galement tr√®s efficace et tr√®s utile . <br><br>  Fini le stockage, commencez par CAAction.  Je vais vous en dire plus sur lui. <br><br><img src="https://habrastorage.org/webt/r7/ay/kz/r7aykzzyhz25wrbcddkax9-oyzm.jpeg"><br><br>  Il y a une nouvelle t√¢che pour UIView - demander des actions √† CALayer.  Quelles sont les actions? <br><br><img src="https://habrastorage.org/webt/rk/yi/le/rkyile_6v-vwfrq0d98sgeq4obs.jpeg"><br><br>  CAAction est juste un protocole qui n'a qu'une seule m√©thode - ex√©cuter.  Apple aime g√©n√©ralement les th√®mes du cin√©ma, l'action ici comme ¬´appareil photo, moteur!¬ª.  Ce ¬´moteur¬ª n'est qu'une action, et pas seulement ce nom a √©t√© utilis√©.  La m√©thode d'ex√©cution signifie d√©marrer une action qui peut d√©marrer, ex√©cuter et terminer, ce qui est le plus important.  Cette m√©thode est tr√®s g√©n√©rique, elle n'a qu'une cha√Æne d'√©v√©nements et tout le reste peut √™tre de n'importe quel type.  En ObjC, tout cela est id et un NSDictionary normal. <br><br><img src="https://habrastorage.org/webt/3u/q-/6z/3uq-6zsnqrcdp_ijgpmbvljcxui.jpeg"><br><br>  Il existe des classes dans UIKit qui satisfont au protocole CAAction.  Le premier est l'animation.  Tout d'abord, nous savons que l'animation peut √™tre ajout√©e √† un calque, mais c'est une chose de tr√®s bas niveau.  Une abstraction de haut niveau au-dessus consiste √† ex√©cuter une action avec les param√®tres n√©cessaires avec une couche. <br><br>  La deuxi√®me exception importante est NSNull.  Nous savons qu'il ne peut pas √™tre appel√© par aucune m√©thode, mais il satisfait le protocole CAAction, et cela est fait afin de rechercher commod√©ment CAAction dans les couches. <br><br><img src="https://habrastorage.org/webt/nm/34/9d/nm349dj4-hpwpaf2jshz4bjr6ee.jpeg"><br><br>  Comme nous l'avons dit pr√©c√©demment, UIView est un d√©l√©gu√© √† CALayer, et l'une des m√©thodes de d√©l√©gu√© est l'action (pour: forKey :).  La couche a une m√©thode, action forKey. <br><br><img src="https://habrastorage.org/webt/xh/1s/wz/xh1swzwsz49zo9iythd65yntg5a.jpeg"><br><br>  Nous pouvons l'appeler √† tout moment sur le calque, et √† tout moment il donnera l'action correcte ou nulle, car il peut √©galement donner.  L'algorithme est une recherche tr√®s inhabituelle.  Le pseudocode est √©crit ici, regardons les lignes.  D√®s r√©ception d'un tel message, il consulte d'abord le d√©l√©gu√©.  Un d√©l√©gu√© peut soit retourner nil, ce qui signifie que la recherche doit se poursuivre ailleurs, soit renvoyer une action valide, un objet valide qui satisfait le protocole CAAction.  Mais il y a une r√®gle logique: s'il renvoie NSNull, qui satisfait ce protocole, il sera ensuite converti en nil.  Autrement dit, si nous renvoyons Null, cela signifie en fait ¬´arr√™tez de chercher¬ª.  Il n'y a aucune action et ce n'est pas n√©cessaire. <br><br>  Mais il y a ce qui suit.  Apr√®s avoir consult√© le d√©l√©gu√© et que le d√©l√©gu√© est revenu √† z√©ro, il a poursuivi ses recherches.  Tout d'abord, dans le dictionnaire Actions, que poss√®de le calque, puis il recherchera r√©cursivement dans le dictionnaire de style, o√π il peut √©galement y avoir un dictionnaire avec la cl√© d'actions, dans lequel de nombreuses actions peuvent √™tre √©crites, et il pourra √©galement les rechercher r√©cursivement.  Si cela n'a pas fonctionn√©, il demandera √† la classe l'action par d√©faut pour la m√©thode Key, qui est d√©finie par CALayer et jusqu'√† r√©cemment renvoy√© quelque chose, mais derni√®rement, elle retourne toujours z√©ro dans les derni√®res versions d'iOS. <br><br>  Compris la th√©orie.  Voyons comment tout est appliqu√© dans la pratique. <br><br>  Il y a des √©v√©nements, ils ont des cl√©s, certaines actions ont lieu sur ces √©v√©nements.  Fondamentalement, deux types d'√©v√©nements diff√©rents peuvent √™tre distingu√©s.  Le premier est l'animation des propri√©t√©s stock√©es.  Supposons que lorsque nous appelons Viewcolor = red sur View, il est th√©oriquement possible d'animer. <br><br><img src="https://habrastorage.org/webt/2i/6p/sc/2i6pscholbhv-jvln05rlepz1ru.jpeg"><br><br>  Quel rapport sur les mod√®les sans circuit?  J'en ai dessin√© deux.  UIView a une sorte d'interface que nous avons d√©finie pour les sous-classes ou celle qui est re√ßue du syst√®me avec des √©v√©nements.  La t√¢che de UIView est de demander l'action souhait√©e, de mettre √† jour le magasin interne et de lancer l'action qui s'est produite.  L'ordre est tr√®s important par rapport √† la demande: action, seulement ensuite mettre √† jour l'action, et seulement ensuite mettre √† jour le magasin et l'action. <br><br><img src="https://habrastorage.org/webt/b4/qu/mm/b4qumm17wvgwfhycn1ld3z7tuka.jpeg"><br><br>  Que se passe-t-il si √† UIView nous mettons √† jour backgroundColor.  Nous savons que dans UIView, tout ce qui concerne l'affichage √† l'√©cran est toujours un proxy pour CALayer.  Il met en cache tout ce qu'il re√ßoit, juste au cas o√π, mais en m√™me temps tout diffuse CALayer, et il traite de toute la logique plus loin sur CALayer.  Que se passe-t-il dans CALayer lorsqu'il re√ßoit une t√¢che pour changer l'arri√®re-plan?  Tout est un peu plus compliqu√© ici. <br><br><img src="https://habrastorage.org/webt/wd/gd/-p/wdgd-peskdkf3x9pt9ta408lpa8.jpeg"><br><br>  Pour commencer, il demandera une action.  Et il est important de comprendre que l'action sera demand√©e en premier.  Cela vous permettra de demander √† CALayer ses valeurs actuelles, y compris backgroundColor, au moment de la cr√©ation de l'action, seulement alors le magasin sera mis √† jour, et lorsque l'action re√ßue recevra la commande d'ex√©cution, il pourra consulter CALayer et obtenir de nouvelles valeurs.  Ainsi, il poss√©dera √† la fois l'ancien et le nouveau, ce qui lui permettra de cr√©er des animations, si n√©cessaire. <br><br>  Mais il y a une fonctionnalit√© dans UIView, si nous changeons le backgroundColor dans UIView, si nous le faisons dans le bloc d'animation, alors il est anim√©, et s'il est en dehors du bloc d'animation, il n'est pas anim√©. <br><br><img src="https://habrastorage.org/webt/nm/34/9d/nm349dj4-hpwpaf2jshz4bjr6ee.jpeg"><br><br>  Tout est tr√®s simple, il n'y a pas de magie.  Mais rappelez-vous simplement que UIView est un d√©l√©gu√© de CALayer, il a une telle m√©thode.  Tout est tr√®s simple. <br><br>  Si cette m√©thode a √©t√© ex√©cut√©e dans le bloc d'animation, elle renverra une sorte d'action.  Si en dehors du bloc d'animation, cette m√©thode retournera NSNull, ce qui signifie que rien n'a besoin d'√™tre anim√©.      ,  CALayer      . <br><br>       ,  UIView   ,  .         .       ? <br><br><img src="https://habrastorage.org/webt/hb/bp/j_/hbbpj_qzzphg6b_dvw-mhbmceak.jpeg"><br><br>    ,   .  UIView   ,  read only,      ,  inheritedAnimationDuration.    .      ,      .      . <br><br>    ?          duration,      .        ,   run, ,      . <br><br><img src="https://habrastorage.org/webt/a6/4u/n9/a64un9twddqprjgzjvzwnppwnpk.jpeg"><br><br>       ,   CAAction,  backgroundcolor  opacity,     UIView .  ,      ,  ,  ,  .          .    setValue forKey    ,        ,     ,   ,       ,      ,   . <br><br>     ,       ,    ,   ,   . <br><br>    ‚Äî      . ,    ¬´¬ª  ¬´¬ª   .    . <br><br>    . <br><br><img src="https://habrastorage.org/webt/l6/je/7m/l6je7mjo7fnwwxyvfql1y-yuy0q.jpeg"><br><br>     . ,        ,         ,    .               UIView   CALayer,       ,    , CAAction, ,  ,   . <br><br><img src="https://habrastorage.org/webt/q6/uo/jq/q6uojqtnrhojwxpuuwzxtuentju.jpeg"><br><br><img src="https://habrastorage.org/webt/jg/ax/_s/jgax_s_wow82hbtxeax_29d3brw.jpeg"><br><br> ,     ,    ,       .            ,       .    . <br><br>    .   - . <br><br>             CAAction,    ,   .   ,    ,    ,  . <br><br><img src="https://habrastorage.org/webt/pa/0b/b8/pa0bb8gtuowzwknknhve-btxbsw.jpeg"><br><br>   ,       , ,    home,    .     ,    . ,      . <br><br><img src="https://habrastorage.org/webt/hw/5r/l8/hw5rl8bhdrs4fvmi503inw7iauq.jpeg"><br><br>      .   - . <br><br><img src="https://habrastorage.org/webt/bp/np/di/bpnpdiveiwjnqlxotgrvlr5egj8.jpeg"><br><br>   ,  -    , -   .     ,    ,    .     ,   . <br><br>      ,    ,      . <br><br><img src="https://habrastorage.org/webt/hj/ub/55/hjub55ptyxd7nbmmr9jur-zn3sy.jpeg"><br><br>   ,   CAAction      ,   .     ,   UIControl,  - ,   - ,     ,      ,  -   . <br><br> ,  .  ,  UIView  -,     ,   -   ,       ,   ,      . <br><br>    ‚Äî     .       . <br><br>   ?    .  ,          .      ‚Äî   .      activating,      inactive  active.        ,  ,        . <br><br><img src="https://habrastorage.org/webt/rz/lt/hw/rzlthwfk8lmduvkc_ltfagvorbk.jpeg"><br><br>    .   ,  onOrderIn  onOrderOut.  ,      UIKit,        . <br><br>  ,   -, ‚Äî ,    . <br><br><img src="https://habrastorage.org/webt/q4/8t/2v/q48t2v7xemofbmsmaydyaivlgqw.jpeg"><br><br>    .      UIView  ,      : isActive  progress.        .        CAAction,     . <br><br>   ,   .   ,  , 30 CAACtion,    .          ,   30 ,        NSNull.     15     15 .    .      ‚Äî  .   ,   ‚Äî      . <br><br> ,         .     . <br><br>   .  ,        ,    : , -,     . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En d√©composant toutes les interactions en ces quatre morceaux, on ne peut pas interf√©rer avec la logique de l'un avec l'autre, simplifier. </font><font style="vertical-align: inherit;">Par cons√©quent, essayez d'analyser vos applications et diverses t√¢ches en utilisant ces micro-interactions. </font><font style="vertical-align: inherit;">N'oubliez pas qu'UIKit fournit une √©norme infrastructure pour le faire facilement et magnifiquement. </font><font style="vertical-align: inherit;">Ne la n√©gligez pas. </font><font style="vertical-align: inherit;">Il existe souvent des m√©thodes tr√®s anciennes, elles sont rarement utilis√©es, mais elles sont tr√®s importantes et vous aideront √† r√©aliser vos √©l√©ments magnifiquement, simplement et rapidement.</font></font> Merci de votre attention. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429580/">https://habr.com/ru/post/fr429580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429568/index.html">R√©duisez les temps d'arr√™t de Zimbra lors des pannes de serveur avec Zextras Backup</a></li>
<li><a href="../fr429570/index.html">Apprendre √† un agent √† jouer √† Mario Kart avec des filtres</a></li>
<li><a href="../fr429572/index.html">Interception de conversations priv√©es dans Skype √† l'aide de Devicelock DLP</a></li>
<li><a href="../fr429574/index.html">Cours gratuit Check Point pour d√©butants √† CheckMates</a></li>
<li><a href="../fr429578/index.html">Quelles erreurs sont masqu√©es dans le code Infer.NET?</a></li>
<li><a href="../fr429582/index.html">Indicateur analogique de la charge de l'ordinateur</a></li>
<li><a href="../fr429586/index.html">Comment d√©terminer le meilleur moment pour trader sur la bourse</a></li>
<li><a href="../fr429588/index.html">Toute la v√©rit√© sur RTOS. Article # 20. S√©maphores: services auxiliaires et structures de donn√©es</a></li>
<li><a href="../fr429590/index.html">Analyse vocale pour les centres d'appels bas√©s sur SOLR</a></li>
<li><a href="../fr429592/index.html">Comment les cartes bancaires affectent l'√©conomie et pourquoi la bille ne d√©colle pas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>