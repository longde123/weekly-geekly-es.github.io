<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚§¥Ô∏è üë®üèæ‚Äçüé® üé• Comment l'adresse physique est affich√©e dans les cha√Ænes DRAM et les banques üíΩ üòΩ ‚òùüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans un article pr√©c√©dent, nous avons expliqu√© comment les processeurs Intel Sandy Bridge mappent les adresses physiques dans le cache L3. 

 Je vais ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment l'adresse physique est affich√©e dans les cha√Ænes DRAM et les banques</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431102/">  Dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent,</a> nous avons expliqu√© comment les processeurs Intel Sandy Bridge mappent les adresses physiques dans le cache L3. <br><br>  Je vais maintenant vous expliquer comment les contr√¥leurs de m√©moire de ces processeurs mappent les adresses physiques √† un emplacement dans la DRAM - en particulier, les num√©ros de ligne, de banque et de colonne dans les modules DRAM.  Appelez-le <i>mappage d'adresse DRAM</i> .  J'utilise une machine de test comme exemple. <br><br><h4>  Motivation: bug de Rowhammer </h4><br>  Je suis int√©ress√© par le mappage des adresses DRAM, car il se rapporte √† un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bogue Rowhammer</a> . <br><br>  Rowhammer est un probl√®me avec certains modules DRAM o√π certains mod√®les d'acc√®s √† la m√©moire dans le pire des cas peuvent entra√Æner une corruption de la m√©moire.  Dans ces DRAM, l'activation multiple d'une ligne de m√©moire (¬´colmatage de ligne¬ª) provoque un bruit √©lectrique qui modifie les bits dans les cellules vuln√©rables des lignes adjacentes. <br><a name="habracut"></a><br>  Ces activations de ligne r√©p√©t√©es peuvent √™tre provoqu√©es par un acc√®s multiple √† une paire d'adresses DRAM qui se trouvent sur diff√©rentes lignes de la m√™me banque DRAM.  La connaissance du mappage des adresses DRAM est utile car elle indique quelles paires d'adresses satisfont cette propri√©t√© ¬´une banque, une ligne diff√©rente¬ª (m√™me banque, ligne diff√©rente; SBDR). <br><br><h4>  Deviner et v√©rifier le mappage d'adresses </h4><br>  Pour le test, j'ai une machine avec des modules DRAM vuln√©rable au bug Rowhammer.  L'ex√©cution de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rowhammer_test</a> sur cette machine montre un peu de changement. <br><br>  Je voudrais conna√Ætre le sch√©ma de mappage d'adresse DRAM pour cette machine, mais il n'est pas publiquement document√©: voici le processeur Sandy Bridge, mais Intel ne documente pas le mappage d'adresse utilis√© par les contr√¥leurs de m√©moire de ces processeurs. <br><br>  En fait, le test <code>rowhammer_test</code> pas besoin de conna√Ætre les paires d'adresses SBDR.  Il essaie juste plusieurs fois de marteler des paires d'adresses s√©lectionn√©es au hasard.  Habituellement, 1/8 ou 1/16 d'entre eux se r√©v√®lent √™tre des paires SBDR, car dans notre voiture, il y a 8 banques dans chaque DIMM (et 16 banques au total).  Ainsi, nous n'avons pas besoin de conna√Ætre le mappage des adresses DRAM pour provoquer un changement de bit dans la m√©moire, mais de telles connaissances aideront √† effectuer le test de mani√®re plus cibl√©e. <br><br>  Bien que le mappage des adresses ne soit pas document√©, j'ai trouv√© que je pouvais faire une hypoth√®se raisonnable √† ce sujet en fonction de la g√©om√©trie de la DRAM, puis v√©rifier l'hypoth√®se en fonction des adresses physiques signal√©es par <code>rowhammer_test</code> .  Le test rapporte les adresses physiques o√π les bits changent ( <i>¬´victimes¬ª</i> ) et les paires d'adresses physiques qui font ces changements ( <i>¬´agresseurs¬ª</i> ).  √âtant donn√© que ces paires doivent √™tre des paires SBDR, nous pouvons v√©rifier un mappage hypoth√©tique d'adresses √† ces donn√©es empiriques. <br><br><h4>  G√©om√©trie m√©moire </h4><br>  Premi√®re √©tape: v√©rifiez le nombre de modules DIMM install√©s sur la machine et leur organisation interne. <br><br>  Je peux demander des informations DIMM en utilisant l' <code>decode-dimms</code> sous Linux (sur Ubuntu, il est dans le package <code>I2C-tools</code> ).  Cet outil d√©code les m√©tadonn√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SPD (Serial Presence Detect)</a> dans DIMM. <br><br>  Sur ma machine de test, deux <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SO-DIMM de</a> quatre gigaoctets, ce qui donne 8 Go de m√©moire. <br><br>  L' <code>decode-dimms</code> rapporte les informations suivantes pour chacun des modules: <br><br><pre>  Taille 4096 MB
 Banques x rang√©es x colonnes x bits 8 x 15 x 10 x 64
 Rangs 2 </pre><br>  Cela signifie que les deux modules DIMM: <br><br><ul><li>  Chaque banque a 2 ^ 15 lignes (32768 lignes). </li><li>  Chaque ligne contient 2 ^ 10 * 64 bits = 2 ^ 16 bits = 2 ^ 13 octets = 8 Ko. </li></ul><br>  Chaque module DIMM a 2 rangs et 8 banques.  Le recoupement de la capacit√© du module DIMM donne la taille attendue: <br><br>  8 Ko par ligne * 32768 lignes * 2 rangs * 8 banques = 4096 Mo = 4 Go <br><br><h4>  Cartographie des adresses DRAM </h4><br>  Sur mon ordinateur de test, des bits d'adresses physiques sont utilis√©s comme suit: <br><br><ul><li>  <b>Bits 0-5</b> : ce sont les 6 bits inf√©rieurs de l'index d'octets dans la cha√Æne (c'est-√†-dire l'index 6 bits pour la ligne de cache de 64 octets). </li><li>  <b>Bit 6</b> : il s'agit d'un num√©ro de canal √† 1 bit qui s√©lectionne entre deux modules DIMM. </li><li>  <b>Bits 7-13</b> : les 7 bits sup√©rieurs de l'index dans une ligne (c'est-√†-dire les bits sup√©rieurs du num√©ro de colonne). </li><li>  <b>Bits 14-16</b> : XOR avec les 3 bits inf√©rieurs du num√©ro de ligne, ce qui donne un num√©ro de banque de 3 bits. </li><li>  <b>Bit 17</b> : Un num√©ro de rang sur 1 bit qui s√©lectionne entre deux rangs DIMM (qui sont g√©n√©ralement les deux c√¥t√©s d'une puce DIMM). </li><li>  <b>Bits 18-32</b> : num√©ro de ligne 15 bits. </li><li>  <b>Bits 33+</b> : ils peuvent √™tre d√©finis car la m√©moire physique commence par des adresses physiques sup√©rieures √† 0. </li></ul><br><h4>  Pourquoi un tel affichage? </h4><br>  Ce mappage est <code>rowhammer_test</code> aux r√©sultats de <code>rowhammer_test</code> (voir ci-dessous), mais nous pouvons √©galement expliquer que les bits d'adresse sont mapp√©s de mani√®re √† fournir de bonnes performances pour les mod√®les d'acc√®s √† la m√©moire typiques, tels que l'acc√®s s√©quentiel et l'acc√®s pas √† pas ( acc√®s strid√©): <br><br><ul><li>  <b>Canaux d'acc√®s simultan√©</b> .  Placer un num√©ro de canal dans le bit 6 signifie que les lignes de cache alterneront entre deux canaux (c'est-√†-dire, deux barrettes DIMM) accessibles en parall√®le.  Cela signifie que si nous acc√©dons aux adresses de mani√®re s√©quentielle, la charge sera r√©partie sur deux canaux. <br><br>  Soit dit en passant, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ivy Bridge</a> (le successeur de Sandy Bridge) semble compliquer l'affichage du num√©ro de cha√Æne.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">La pr√©sentation d'Intel</a> mentionne le ¬´hachage de canal¬ª et d√©clare qu'elle ¬´vous permet de s√©lectionner un canal en fonction de plusieurs bits d'adresse.  Historiquement, c'√©tait ¬´A [6]¬ª.  Cela garantit une r√©partition plus uniforme de l'acc√®s √† la m√©moire entre les canaux. ¬ª </li><li>  <b>Glissement de banque</b> : en g√©n√©ral, la disposition des num√©ros de colonne, des banques et des lignes devrait minimiser le changement fr√©quent de lignes actives de banque (d√©bordement de banque). <br><br>  Une petite introduction: les modules DRAM sont organis√©s en banques, qui, √† leur tour, sont organis√©es en lignes.  Chaque banque dispose d'une ¬´ligne activ√©e en cours¬ª: son contenu est copi√© dans le <i>buffer de ligne</i> , qui fait office de cache accessible rapidement.  L'acc√®s √† une autre ligne prend plus de temps car elle doit d'abord √™tre activ√©e.  Ainsi, lors du mappage d'adresses DRAM, les paires SBDR sont transport√©es autant que possible dans l'espace d'adressage physique. <br><br>  La poursuite des lignes (martelage des lignes) est un cas particulier de glissement d'une banque lorsque deux lignes sp√©cifiques sont activ√©es en alternance (√©ventuellement √† dessein). </li><li>  <b>Parall√©lisme bancaire</b> : les banques sont accessibles en parall√®le (quoique dans une moindre mesure que les canaux), de sorte que le num√©ro de banque change avant le num√©ro de ligne √† mesure que l'adresse augmente. </li><li>  <b>Sch√©ma XOR</b> : XOR'ing les bits les moins significatifs d'un num√©ro de ligne √† un num√©ro de banque est une astuce pour √©viter de glisser la banque lors de l'acc√®s aux tableaux en grandes √©tapes.  Par exemple, dans l'affichage ci-dessus, XOR'ing force les adresses X et X + 256k √† se trouver dans diff√©rentes banques, sans former de paire SBDR. <br><br>  Les sch√©mas XOR pour banque / ligne sont d√©crits dans diverses publications, par exemple: <br><ul><li>  Th√®se de doctorat de David Tavei Wang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´Syst√®mes DRAM modernes: analyse des performances et algorithmes de planification¬ª</a> , 2005. Voir section 5.3.5 ¬´Lissage d'adresse de banque (collision par √©tapes)¬ª.  Vous pouvez √©galement trouver d'excellentes informations de base sur la technologie DRAM en g√©n√©ral dans cette th√®se. </li><li>  L'article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">¬´R√©duction des d√©lais DRAM avec la hi√©rarchie de m√©moire int√©gr√©e¬ª</a> , 2001. Voir figure.  3. </li></ul></li></ul><br><h4>  R√©conciliation avec rowhammer_test </h4><br>  L'ex√©cution de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rowhammer_test_ext</a> (une version √©tendue de <code>rowhammer_test</code> ) sur une machine de test pendant 6 heures a r√©v√©l√© un changement r√©p√©t√© de bits √† 22 endroits.  (voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">donn√©es source et code d'analyse</a> ). <br><br>  Le test de frappe des cha√Ænes g√©n√®re des ensembles de trois adresses (A1, A2, V): <br><br><ul><li>  V est l'adresse de la victime, o√π l'on voit le changement de bits. </li><li>  A1 et A2 sont les adresses de l'agresseur que nous frappons. </li><li>  Triez A1 et A2 de sorte que A1 soit plus proche de V que A2.  Nous supposons provisoirement qu'une adresse plus proche, A1, provoque en fait un changement de bit (bien que cela ne serait pas n√©cessairement vrai si un mappage plus complexe d'adresses DRAM √©tait utilis√©). </li></ul><br>  Pour tous ces r√©sultats, nous nous attendons √† ce que trois propri√©t√©s soient termin√©es: <br><br><ul><li>  <b>Ligne</b> : les num√©ros de <b>ligne</b> A1 et V doivent diff√©rer de 1, c'est-√†-dire  ils devraient √™tre dans des lignes adjacentes.  (A2 peut avoir n'importe quel num√©ro de ligne). <br><br>  Cette propri√©t√© facilite la d√©termination de l'emplacement des bits les plus bas du num√©ro de ligne dans l'adresse physique. <br><br>  Le test a montr√© que cette propri√©t√© est valable pour tous les r√©sultats sauf deux.  Dans ces deux r√©sultats, les num√©ros de ligne diff√®rent de 3 plut√¥t que de 1. </li><li>  <b>Banque</b> : V, A1 et A2 doivent avoir le m√™me num√©ro de banque.  En effet, cette propri√©t√© s'est manifest√©e dans les 22 r√©sultats.  Il n'est enregistr√© que lors de l'application du sch√©ma XOR'ing de lignes / banques. </li><li>  <b>Canal</b> : V, A1 et A2 doivent avoir le m√™me num√©ro de canal.  Cela est vrai pour tous les r√©sultats.  Il arrive que tous les r√©sultats aient canal = 0, car <code>rowhammer_test</code> s√©lectionne uniquement les adresses align√©es en 4k, et ne teste donc qu'un seul canal (cela peut √™tre consid√©r√© comme un bug). </li></ul><br><h4>  Autres tests possibles </h4><br>  √Ä l'avenir, vous pouvez ex√©cuter deux autres exp√©riences pour v√©rifier si le mappage d'adresse DRAM √©value correctement la propri√©t√© SBDR: <br><br><ul><li>  <b>Mesure du temps</b> : l'acc√®s multiple √† des paires d'adresses SBDR devrait √™tre plus lent que l'acc√®s multiple √† des paires sans SBDR, car le premier provoque l'activation des lignes, et le second non. </li><li>  <b>Test exhaustif de Rowhammer</b> : d√®s que l'on trouve l'adresse de l'agresseur A1, ce qui provoque un changement r√©p√©t√© de bits, on peut le v√©rifier sur de nombreuses valeurs de A2.  L'effet de la monnaie (A1, A2) ne changera les bits que s'il s'agit d'une paire de SBDR. </li></ul><br>  De plus, la suppression d'un module DIMM de l'unit√© centrale doit supprimer le bit de canal du mappage d'adresse DRAM et modifier en cons√©quence les adresses d'agresseur et de victime.  Cela peut √©galement √™tre v√©rifi√©. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431102/">https://habr.com/ru/post/fr431102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431090/index.html">Un bot VK, un C # et une orange</a></li>
<li><a href="../fr431092/index.html">ROS: carte de profondeur sur le Raspberry Pi "low blood"</a></li>
<li><a href="../fr431094/index.html">Tri solitaire</a></li>
<li><a href="../fr431096/index.html">Comment cr√©er un produit de chat bot</a></li>
<li><a href="../fr431098/index.html">M√™me un incendie n'est pas un obstacle, ou Zimbra Speed ‚Äã‚ÄãRecovery apr√®s une catastrophe</a></li>
<li><a href="../fr431104/index.html">Comment nous, chez Neoflex, d√©veloppons l'expertise DevOps</a></li>
<li><a href="../fr431106/index.html">Combien d'argent les Am√©ricains ont d√©pens√© ce Black Friday et qu'est-ce que les smartphones ont √† voir avec √ßa?</a></li>
<li><a href="../fr431108/index.html">Comment transformer l'imagerie satellite en cartes. Vision par ordinateur dans Yandex</a></li>
<li><a href="../fr431110/index.html">Arr√™tez de nourrir les √©diteurs. L'UE √©labore des r√®gles pour le libre acc√®s obligatoire √† la recherche</a></li>
<li><a href="../fr431112/index.html">Comment utiliser les m√©thodes des moindres carr√©s pour √©valuer les ressources et surveiller les bases de donn√©es Oracle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>