<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👩‍👧‍👧 🏟️ ✋🏾 Besi tidak akan gagal. Bagaimana saya menyiapkan puluhan server per hari untuk pertempuran 👇🏾 🤷🏼 👩🏽‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Memeriksa satu server tidak menjadi masalah. Anda mengambil daftar periksa dan memeriksa urutan: prosesor, memori, disk. Tetapi dengan seratus server,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Besi tidak akan gagal. Bagaimana saya menyiapkan puluhan server per hari untuk pertempuran</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/426733/"> Memeriksa satu server tidak menjadi masalah.  Anda mengambil daftar periksa dan memeriksa urutan: prosesor, memori, disk.  Tetapi dengan seratus server, metode ini tidak mungkin bekerja dengan baik.  Untuk mengecualikan faktor manusia, untuk membuat pemeriksaan lebih andal dan lebih cepat, perlu untuk mengotomatisasi proses.  Siapa yang perlu tahu bagaimana melakukan ini lebih baik daripada penyedia hosting?  Artyom Artemyev di HighLoad ++ Siberia memberi tahu metode apa yang dapat digunakan, apa yang lebih baik untuk dijalankan dengan tangan Anda, dan apa yang bekerja dengan baik untuk mengotomatisasi.  Selanjutnya, versi teks dari laporan dengan tips yang dapat diulang oleh siapa pun yang bekerja dengan besi dan perlu memeriksa kinerjanya. <br><br><img src="https://habrastorage.org/webt/eg/iq/xc/egiqxczvizqa8elpiks7967fg3y.png"><br><br>  <strong>Tentang pembicara:</strong> Artyom Artemyev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">artemirk</a> ) direktur teknis di penyedia hosting besar FirstVDS, ia bekerja dengan besi. <br><a name="habracut"></a><br>  FirstVDS memiliki dua pusat data.  Yang pertama adalah milik mereka sendiri, mereka membangun gedung mereka sendiri, membawa dan memasang rak mereka, mereka sendiri memelihara, khawatir tentang arus dan pendinginan pusat data.  Pusat data kedua adalah ruang besar di pusat data besar yang disewakan, semuanya lebih mudah dengan itu, tetapi juga ada.  Totalnya adalah 60 rak dan sekitar 3.000 server besi.  Ada sesuatu untuk dilatih dan diuji pendekatan yang berbeda, yang berarti bahwa kami sedang menunggu rekomendasi yang dikonfirmasi secara praktis.  Mari mulai melihat atau membaca laporan. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/eQjNQ2RnjUY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Sekitar 6-7 tahun yang lalu, kami menyadari bahwa hanya menempatkan sistem operasi di server tidak cukup.  OS menyala, server terjaga dan siap untuk bertempur.  Kami meluncurkannya pada produksi - reboot dan pembekuan yang tidak dapat dipahami dimulai.  Apa yang harus dilakukan, tidak jelas - proses sedang berlangsung, mentransfer seluruh draft kerja ke sepotong logam baru itu sulit, mahal, menyakitkan.  Kemana harus lari? <br><br>  Metode penyebaran modern memungkinkan kami untuk menghindari ini dan mengangkut server dalam 5 detik, tetapi klien kami (terutama 6 tahun yang lalu) tidak terbang di awan, berjalan di tanah dan menggunakan potongan besi biasa. <br><br><img src="https://habrastorage.org/webt/li/kc/fa/likcfazjalyfvnjz_vq17bqqjpm.png"><br><br>  Pada artikel ini saya akan memberi tahu Anda metode apa yang kami coba, mana yang kami ambil root, yang tidak berakar, mana yang baik untuk dijalankan dengan tangan Anda, dan bagaimana mengotomatiskan semua ini.  Saya akan memberi Anda saran, dan Anda dapat mengulanginya di perusahaan Anda jika Anda bekerja dengan besi dan Anda memiliki kebutuhan seperti itu. <br><br><h2>  Apa masalahnya? <br></h2><br>  Secara teori, memeriksa server tidak menjadi masalah.  Awalnya, kami memiliki proses, seperti pada gambar di bawah ini.  Seorang pria duduk, mengambil daftar periksa, memeriksa: prosesor, memori, disk, kerutan dahinya, membuat keputusan. <br><br><img src="https://habrastorage.org/webt/bq/75/ac/bq75acnj5b9-wk-mhonnk06vtbc.png"><br><br>  Kemudian 3 server diinstal per bulan.  Tetapi, ketika ada semakin banyak server, orang ini mulai menangis dan mengeluh bahwa dia sekarat di tempat kerja.  Seseorang semakin keliru, karena verifikasi telah menjadi rutinitas. <br><br>  <strong>Kami membuat keputusan: kami mengotomatisasi!</strong>  Seseorang akan melakukan hal-hal yang lebih bermanfaat. <br><br><h3>  Tamasya singkat <br></h3><br><img src="https://habrastorage.org/webt/yp/xx/ar/ypxxarfkx9huiayenmyjsiauh2g.png"><br><br>  Saya akan mengklarifikasi apa yang saya maksud ketika saya berbicara tentang server hari ini.  Kami, seperti orang lain, menghemat ruang rak dan menggunakan server kepadatan tinggi.  Saat ini 2 unit, yang dapat memuat 12 node server prosesor tunggal, atau 4 node server prosesor ganda.  Artinya, setiap server mendapat 4 disk - semuanya dengan jujur.  Plus, ada dua catu daya di rak, yaitu semuanya redundan dan semua orang menyukainya. <br><br><h2>  Dari mana besinya? <br></h2><br>  Besi dibawa ke pusat data kami oleh pemasok kami - biasanya Supermicro dan Intel.  Di pusat data, operator-operator kami memasang server di ruang kosong di rak dan menghubungkan dua kabel, jaringan dan daya.  Ini juga merupakan tanggung jawab operator untuk mengkonfigurasi BIOS di server.  Yaitu, sambungkan keyboard, monitor, dan konfigurasikan dua parameter: <code>Restore on AC/Power Loss — [Power On]</code> , sehingga server selalu menyala segera setelah daya muncul.  Ini harus bekerja tanpa henti.  Perangkat <code>First boot device — [PXE]</code> kedua <code>First boot device — [PXE]</code> , yaitu, kami meletakkan perangkat boot pertama di jaringan, jika tidak, kami tidak akan dapat mencapai server, karena itu bukan fakta bahwa ia memiliki disk segera, dll. <br><br><img src="https://habrastorage.org/webt/ab/hf/i2/abhfi2f6a412ead4dsnxyjjmhe8.png"><br><br>  Setelah itu, operator membuka panel akuntansi server besi, di mana Anda perlu mencatat fakta menginstal server, yang ditunjukkan: <br><br><ul><li>  rak; </li><li>  stiker </li><li>  port jaringan </li><li>  port daya </li><li>  nomor unit. </li></ul><br>  Setelah itu, port jaringan tempat operator menginstal server baru, untuk tujuan keamanan, pergi ke karantina VLAN khusus, yang juga hang DHCP, Pxe, TFtp.  Selanjutnya, server memuat Linux favorit kami, yang memiliki semua utilitas yang diperlukan, dan proses diagnostik dimulai. <br><br>  Karena server masih memiliki perangkat boot pertama di jaringan, untuk server yang masuk ke produksi, port beralih ke VLAN lain.  Tidak ada DHCP di VLAN lain, dan kami tidak takut bahwa kami akan menginstal ulang server produksi kami secara tidak sengaja.  Untuk ini, kami memiliki VLAN terpisah. <br><br>  Itu terjadi bahwa server diinstal, semuanya baik-baik saja, tetapi tidak bisa boot ke sistem diagnostik.  Ini terjadi, sebagai suatu peraturan, karena fakta bahwa dengan penundaan dalam beralih VLAN, tidak semua switch jaringan dengan cepat beralih VLAN, dll. <br><br><img src="https://habrastorage.org/webt/q0/qa/wl/q0qawlis6oq5tykqjri3hif8bwg.png"><br><br>  Kemudian operator menerima tugas me-restart server dengan tangannya.  Sebelumnya, tidak ada IPMI, kami memasang soket jarak jauh dan memperbaiki port soket server, menarik soket melalui jaringan, dan server reboot. <br><br>  Tetapi outlet yang dikelola juga tidak selalu berfungsi dengan baik, jadi kami sekarang mengelola daya server dari IPMI.  Tetapi ketika server baru, IPMI tidak dikonfigurasi, itu hanya dapat di-boot dengan naik dan menekan tombol.  Karena itu, seorang pria duduk, menunggu - lampu menyala - berjalan dan menekan tombol.  Begitulah pekerjaannya. <br><br>  Jika setelah itu server tidak bisa boot, maka dimasukkan dalam daftar khusus untuk diperbaiki.  Daftar ini termasuk server di mana diagnostik tidak memulai, atau hasilnya tidak memuaskan.  Seorang individu - yang mencintai besi - duduk dan membongkar setiap hari - mengumpulkan, mencari, mengapa tidak bekerja. <br><br><h2>  CPU <br></h2><br>  Semuanya baik-baik saja, server sudah mulai, kami mulai menguji.  Pertama, kami menguji prosesor sebagai salah satu elemen paling penting. <br><br><img src="https://habrastorage.org/webt/8k/6m/n0/8k6mn0cwmprfgrqoanohbc1lyyo.png"><br><br>  Impuls pertama adalah menggunakan aplikasi dari vendor.  Kami memiliki hampir semua prosesor Intel - kami pergi ke situs tersebut, mengunduh Intel Processor Diagnostic Tool - semuanya baik-baik saja, ini menunjukkan banyak informasi menarik, termasuk jam operasi server dalam jam dan grafik konsumsi daya. <br><br>  Tetapi masalahnya adalah bahwa Intel PTD bekerja di bawah Windows, yang tidak kita sukai lagi.  Untuk memulai tes di dalamnya, Anda hanya perlu menggerakkan mouse, tekan tombol "MULAI", dan tes akan dimulai.  Hasilnya ditampilkan di layar, tetapi tidak ada cara untuk mengekspornya di mana saja.  Ini tidak cocok untuk kita, karena prosesnya tidak otomatis. <br><br><img src="https://habrastorage.org/webt/ax/zo/t1/axzot1gbcsfefqbkta32bixrxk4.png"><br><br>  Kami pergi membaca forum dan menemukan dua cara termudah. <br><br><ol><li>  <strong>Lingkaran abadi kucing / dev / nol&gt; / dev / null</strong> .  Anda dapat memeriksa di atas - 100% satu inti dikonsumsi.  Kami menghitung jumlah inti, menjalankan jumlah kucing / dev / nol yang diperlukan, dikalikan dengan jumlah inti yang diinginkan.  Semuanya bekerja dengan baik! <br></li><li>  <strong>Utilitas / bin / stres</strong> .  Dia membangun matriks dalam memori dan mulai secara konstan membalikkannya.  Semuanya baik-baik saja - prosesor sedang melakukan pemanasan, ada beban. <br></li></ol><br>  Kami memberikan server dalam produksi, pengguna kembali dan mengatakan bahwa prosesor tidak stabil.  Dicentang - prosesor tidak stabil.  Mereka mulai menyelidiki, mereka mengambil server, yang lolos pemeriksaan, tetapi crash dalam pertempuran, menyalakan kernel debug di Linux, dan mengumpulkan Core dump.  Server sebelum mem-boot flush ke file semua yang ada di memori sebelum crash. <br><br><img src="https://habrastorage.org/webt/i1/iu/z0/i1iuz0zoafq9lm8aaimgyqzyiic.png"><br><br>  Berbagai optimasi dibangun ke prosesor untuk operasi yang sering.  Kita dapat melihat bendera yang mencerminkan optimasi yang didukung prosesor, misalnya, optimasi untuk bekerja dengan angka floating point, optimasi multimedia, dll.  Tapi kami / bin / stress, dan siklus abadi hanya membakar prosesor dalam satu operasi dan tidak menggunakan fitur tambahan.  Investigasi menunjukkan bahwa CPU macet ketika mencoba menggunakan fungsi dari salah satu flag bawaan. <br><br>  Impuls pertama adalah meninggalkan / bin / stres - biarkan prosesor hangat.  Kemudian dalam satu siklus kita menjalankan semua bendera, tarik mereka.  Sambil berpikir tentang bagaimana mengimplementasikan ini, yang memerintahkan untuk memanggil untuk memanggil fungsi dari masing-masing flag, kita membaca forum. <br><br>  Pada forum overclocker, kami menemukan sebuah proyek yang menarik untuk mencari bilangan prima <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Great Internet Mersenne Prime Search</a> .  Para ilmuwan telah membuat jaringan terdistribusi yang dapat dihubungkan oleh siapa saja dan membantu menemukan bilangan prima.  Para ilmuwan tidak mempercayai siapa pun, sehingga program ini bekerja dengan sangat cerdik: pertama Anda menjalankannya, ia menghitung bilangan prima yang sudah diketahui, dan membandingkan hasilnya dengan apa yang diketahui.  Jika hasilnya tidak cocok, berarti prosesor tidak berfungsi.  Kami benar-benar menyukai properti ini: dengan segala omong kosong itu cenderung jatuh. <br><br>  Selain itu, tujuan dari proyek ini adalah untuk menemukan bilangan prima sebanyak mungkin, oleh karena itu program ini terus dioptimalkan untuk sifat-sifat prosesor baru, sebagai akibatnya menarik banyak bendera. <br><br>  Mprime tidak memiliki batas waktu, jika tidak dihentikan, ia bekerja selamanya.  Kami menjalankannya selama 30 menit. <br><br><pre> <code class="hljs powershell">/usr/bin/timeout <span class="hljs-number"><span class="hljs-number">30</span></span>m /opt/mprime <span class="hljs-literal"><span class="hljs-literal">-t</span></span> /bin/grep <span class="hljs-literal"><span class="hljs-literal">-i</span></span> error /root/result.txt</code> </pre><br>  Setelah menyelesaikan pekerjaan, kami memeriksa bahwa tidak ada kesalahan dalam result.txt, dan melihat log kernel, khususnya, dalam file / proc / kmsg kami mencari kesalahan. <br><br><h3>  Tamasya lain <br></h3><br><img src="https://habrastorage.org/webt/es/ic/kj/esickjc00tooyxznjt_6lyumimg.png"><br><br>  Pada 3 Januari 2018, mereka menemukan bilangan prima Mersenne ke-50 (2 <sup>p</sup> -1).  Dari jumlah ini, hanya 23 juta digit.  Anda dapat mengunduhnya untuk melihatnya - <a href="">ini</a> adalah <a href="">arsip zip 12 Mb</a> . <br><br>  Mengapa kita membutuhkan bilangan prima?  Pertama, setiap enkripsi RSA menggunakan nomor prima.  Semakin banyak bilangan prima yang kita tahu, semakin dapat diandalkan kunci SSH Anda.  Kedua, para ilmuwan menguji hipotesis dan teorema matematika mereka, dan kami tidak keberatan membantu para ilmuwan - tidak ada biaya bagi kami.  Ternyata win-win history. <br><br><img src="https://habrastorage.org/webt/v0/nd/cl/v0ndcljwlkwops-dtp9nwk9bsru.png"><br><br>  Jadi, prosesornya bekerja, semuanya baik-baik saja.  Masih mencari tahu jenis prosesornya.  Kami menggunakan prosesor dmidecode -t dan melihat semua slot yang ada di motherboard, dan prosesor mana yang ada di slot ini.  Informasi ini memasuki sistem akuntansi kami, kami akan menafsirkannya nanti. <br><br><h3>  Tangkap <br></h3><br>  Dengan demikian, secara mengejutkan, kaki yang patah dapat ditemukan.  / bin / stres dan siklus abadi bekerja, dan Mprime jatuh.  Mereka mengemudi untuk waktu yang lama, mencari, menemukan - hasil dalam gambar di bawah ini - semuanya jelas di sini. <br><br><img src="https://habrastorage.org/webt/13/ae/gc/13aegcfaw9ozlrzzzgog3povm5w.jpeg"><br><br>  Prosesor seperti itu tidak dimulai.  Operator sangat kuat, mengambil prosesor yang salah - tetapi bisa memberikan. <br><br><img src="https://habrastorage.org/webt/gj/xr/_w/gjxr_wu8lxf_cgsf4ehxs84-yb8.jpeg"><br><br>  Kasus indah lainnya.  Baris hitam pada foto di bawah adalah kipas, panah menunjukkan bagaimana udara berhembus.  Kita lihat: radiator berdiri di seberang sungai.  Tentu saja, semuanya kepanasan dan mati. <br><br><img src="https://habrastorage.org/webt/oh/-c/hp/oh-chp3arnnkslirn8elylfcfww.jpeg"><br><br><h2>  Memori <br></h2><br>  Dengan memori, semuanya sangat sederhana.  Ini adalah sel tempat kita menulis informasi, dan setelah beberapa saat kita membacanya lagi.  Jika tetap sama dengan yang kami tulis, maka sel ini berfungsi. <br><br><img src="https://habrastorage.org/webt/91/gl/_s/91gl_slwgtws8webfnnjxfajui8.png"><br><br>  Semua orang tahu program <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Memtest86 +</a> yang baik, langsung klasik, yang berjalan dari media apa pun, melalui jaringan, atau bahkan dari floppy disk.  Itu dibuat untuk memeriksa sel-sel memori sebanyak mungkin.  Setiap sel yang ditempati tidak lagi dapat diperiksa.  Karena itu memtest86 + memiliki ukuran minimum agar tidak menempati memori.  Sayangnya, <strong>memtest86 + hanya menampilkan statistiknya di layar</strong> .  Kami mencoba mengembangkannya entah bagaimana, tetapi semuanya berujung pada kenyataan bahwa di dalam program itu bahkan tidak ada tumpukan jaringan.  Untuk mengembangkannya, seseorang harus membawa kernel Linux dan yang lainnya. <br><br>  Ada versi berbayar dari program ini yang sudah tahu cara mengirim informasi ke disk.  Tetapi server kami tidak selalu memiliki disk, dan tidak selalu ada sistem file pada disk ini.  Tetapi drive jaringan, seperti yang telah kita ketahui, tidak dapat dihubungkan. <br><br>  Kami mulai menggali lebih jauh dan menemukan program <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Memtester</a> serupa.  Program ini bekerja dari level OS dari Linux.  Minus terbesar adalah bahwa OS itu sendiri dan Memtester menempati beberapa sel memori, dan sel-sel ini tidak akan diperiksa. <br><br>  Memtester dimulai dengan perintah: memtester `cat / proc / meminfo | grep MemFree |  awk '{print $ 2-1024}' 'k 5 <br><br>  Di sini kami mentransfer jumlah memori bebas minus 1 MB.  Ini dilakukan, karena jika tidak Memtester mengambil semua memori dan pembunuh bawah membunuhnya.  Kami mengendarai tes ini selama 5 siklus, pada output kami memiliki plat dengan OK atau gagal. <br><br><table width="300"><tbody><tr><td>  Terjebak alamat </td><td>  oke </td></tr><tr><td>  Nilai acak </td><td>  oke </td></tr><tr><td>  Bandingkan XOR </td><td>  oke </td></tr><tr><td>  Bandingkan SUB </td><td>  oke </td></tr><tr><td>  Bandingkan MUL </td><td>  oke </td></tr><tr><td>  Bandingkan DIV </td><td>  oke </td></tr><tr><td>  Bandingkan ATAU </td><td>  oke </td></tr><tr><td>  Bandingkan DAN </td><td>  oke </td></tr></tbody></table><br><br>  Kami menyimpan hasil akhir dan menganalisis lebih lanjut untuk kegagalan. <br><br><img src="https://habrastorage.org/webt/ah/55/kt/ah55kt9fxuqwkmqsz8-dozgunic.png"><br><br>  Untuk memahami tingkat masalahnya - server terkecil kami memiliki memori 32 GB, citra Linux kami dengan Memtester membutuhkan 60 MB, <strong>kami tidak memeriksa 2% dari memori</strong> .  Tetapi menurut statistik selama 6 tahun terakhir, tidak ada hal seperti itu yang dipukuli memori terus-menerus masuk ke produksi.  Ini adalah kompromi yang kita setujui, dan yang mahal untuk kita perbaiki, dan kita hidup dengannya. <br><br>  Sepanjang jalan, kami juga mengumpulkan dmidecode -t memory, yang memberikan semua bank memori yang kami miliki di motherboard (biasanya hingga 24 buah), dan yang mati ada di setiap bank.  Informasi ini berguna jika kita ingin meningkatkan server - kita akan tahu ke mana harus menambahkan apa, berapa banyak strip yang harus diambil dan server mana yang harus dituju. <br><br><h2>  Perangkat penyimpanan <br></h2><br>  6 tahun yang lalu, semua disc dengan pancake yang berputar.  Sebuah cerita terpisah adalah menyusun daftar semua disk.  Ada beberapa pendekatan yang berbeda, karena tidak percaya bahwa Anda bisa melihat ls / dev / sd.  Tetapi pada akhirnya, kami berhenti melihat ls / dev / sd * dan ls / dev / cciss / c0d *.  Dalam kasus pertama, ini adalah perangkat SATA, dalam perangkat kedua - SCSI dan SAS. <br><br><img src="https://habrastorage.org/webt/e7/gm/br/e7gmbraujo_ko4qmfanfwnru71y.png"><br><br>  Secara harfiah tahun ini, mereka mulai menjual disk nvme dan menambahkan daftar nvme di sini. <br><br>  Setelah daftar disk dikompilasi, kami mencoba membaca 0 byte darinya untuk memahami bahwa ini adalah perangkat blok dan semuanya baik-baik saja.  Jika Anda tidak bisa membacanya, maka kami percaya bahwa ini semacam hantu, dan kami tidak pernah dan tidak pernah memiliki disk seperti itu. <br><br>  Pendekatan pertama untuk memeriksa disk adalah jelas: "Mari kita menulis data acak ke disk dan melihat kecepatannya" - <code>dd -o nocache -o direct if=/dev/urandom of=${disk}</code> .  Sebagai aturan, pancake disk memberikan 130-150 Mb / s.  Kami memicingkan mata dan memutuskan untuk diri kami sendiri bahwa 90 MB / s adalah angka yang setelah itu ada disk yang dapat diservis, semua yang lebih kecil mengalami malfungsi. <br><br>  Tetapi sekali lagi, pengguna mulai kembali dan mengatakan bahwa drive buruk.  Ternyata fisika berbahaya bercanda lagi dengan kami. <br><br><img src="https://habrastorage.org/webt/m_/uh/tf/m_uhtfarwgyskpslnxxkufxynty.png"><br><br>  Ada kecepatan sudut, dan, sebagai aturannya, ketika Anda menjalankan -dd, ia menulis di dekat spindle.  Jika karena alasan tertentu kecepatan spindel telah menurun, maka ini kurang terlihat dibandingkan jika Anda menulis dari tepi disk. <br><br>  Saya harus mengubah prinsip verifikasi.  Sekarang kita periksa di tiga tempat: dekat gelendong, di tengah dan di luar.  Mungkin, itu dapat diperiksa hanya dari luar, tetapi ini adalah bagaimana itu terjadi secara historis.  Dan apa yang berhasil, jangan disentuh. <br><br>  Anda dapat menggunakan <strong>smartctl</strong> untuk bertanya pada disk bagaimana kabarnya.  Kami percaya bahwa dorongan yang baik: <br><br><ul><li>  Tidak ada Sektor Reallocated (Sektor <strong>Reallocated Count = 0)</strong> , yaitu, semua sektor yang telah meninggalkan pekerjaan pabrik. </li><li>  Kami <strong>tidak menggunakan cakram yang lebih dari 4 tahun</strong> , meskipun <strong>cakram</strong> itu cukup berfungsi.  Sebelum kami memperkenalkan praktik ini, kami memiliki disk selama 7 tahun.  Sekarang kami percaya bahwa setelah 4 tahun disk telah terbayar, dan kami tidak siap untuk menerima risiko keausan. </li><li>  Tidak ada sektor yang akan <strong>dialokasikan kembali</strong> ( <strong>Current_Pending_Sector = 0</strong> ). </li><li>  <strong>UltraDMA CRC Error Count = 0</strong> - ini adalah kesalahan pada kabel SATA.  Jika ada kesalahan, Anda hanya perlu mengganti kabel, Anda tidak perlu mengganti disk. </li></ul><br><img src="https://habrastorage.org/webt/01/jy/48/01jy48l5jyw-x1yx7wse-yawhdq.png"><br><br>  SSD yang didistribusikan umumnya adalah drive yang sangat baik, mereka bekerja dengan cepat, tidak membuat suara, tidak memanas.  Kami percaya bahwa SSD yang baik memiliki kecepatan tulis lebih dari 200 MB / s.  Pelanggan kami menyukai harga murah, dan model server yang mengeluarkan 320-350 MB / s tidak selalu sampai kepada kami. <br><br>  Untuk SSD, kami juga melihat smartctl.  Realokasi yang sama, Power_On_Hours, Current_Pending_Sector.  Semua SSD dapat menampilkan tingkat keausan, ini menunjukkan parameter Media_Wearout_Indicator.  Kami menghapus cakram hingga 5% dari kehidupan, dan hanya kemudian mengeluarkannya.  Disk semacam itu terkadang menemukan kehidupan kedua dalam kebutuhan pribadi karyawan.  Sebagai contoh, saya baru-baru ini menemukan bahwa dalam 2 tahun disk seperti itu telah usang oleh 1% lain di laptop karyawan, meskipun di negara kita itu di bawah cache SSD habis 95% dalam waktu sekitar 10 bulan. <br><br>  Tetapi masalahnya adalah bahwa tidak semua produsen disk menyetujui nama parameter, dan Media_Wearout_Indicator ini, misalnya, disebut Percent_Lifetime_Digunakan untuk Toshiba, Hitungan Leveling Wear lainnya, Persen Seumur Hidup yang Tersisa untuk produsen lain, atau hanya. * Pakai. *. <br><br>  Sangat penting tidak memiliki opsi ini sama sekali.  Kemudian kita hanya mempertimbangkan jumlah penulisan ulang disk - "byte ditulis" - berapa banyak byte yang telah kita tulis ke disk ini.  Selanjutnya, sesuai dengan spesifikasi, kami mencoba mencari tahu berapa banyak penulisan ulang disk ini yang dihitung oleh pabrikan.  Dengan matematika dasar kita menentukan berapa banyak lagi dia akan hidup.  Jika sudah waktunya untuk berubah - ubah. <br><br><h2>  RAID <br></h2><br>  Saya tidak tahu mengapa di dunia modern pelanggan kami masih menginginkan RAID.  Orang-orang membeli RAID, meletakkan 4 SSD di sana, yang jauh lebih cepat daripada RAID ini (6 Gb).  Mereka memiliki semacam instruksi, dan mereka mengumpulkannya.  Saya pikir ini adalah hal yang hampir tidak perlu. <br><br>  Dulu ada 3 produsen: Adaptec;  3ware;  Intel  Kami memiliki 3 utilitas, kami terganggu, tetapi kami menjalankan diagnostik untuk semua orang.  Sekarang LSI membeli semua orang - hanya ada satu utilitas yang tersisa. <br><br>  Ketika sistem diagnostik kami melihat RAID, ia mem-parsing volume logis ke disk terpisah sehingga Anda dapat mengukur kecepatan setiap disk dan membaca Smart-nya.  Setelah itu, RAID tetap memeriksa baterai.  Siapa yang tidak tahu - ada cukup baterai di RAID untuk memutar semua disk selama 2 jam.  Artinya, Anda mematikan server, mengeluarkannya, dan memutar disk selama 2 jam untuk menyelesaikan semua rekaman. <br><br><h2>  Jaringan <br></h2><br>  Dengan jaringan, semuanya cukup sederhana - harus ada kurang dari 300 Mbit di dalam pusat data.  Jika kurang, Anda harus memperbaikinya.  Kami juga melihat kesalahan pada antarmuka.  <strong>Kesalahan pada antarmuka jaringan tidak boleh sama sekali</strong> , dan jika ada, maka semuanya buruk. <br><br><img src="https://habrastorage.org/webt/ad/m2/yw/adm2yw4vmjpztcicdovupo84l20.png"><br><br>  Kami mencoba memperbarui BIOS dan firmware IPMI di sepanjang jalan.  Ternyata kami tidak suka semua BIOS.  Kami masih memiliki BIOS yang tidak tahu cara UEFI dan fitur lain yang kami gunakan.  Kami mencoba memperbaruinya secara otomatis, tetapi ini tidak selalu berhasil, semuanya tidak terlalu sederhana di sana.  Jika itu tidak berhasil, maka orang tersebut pergi dan memperbarui dengan tangannya. <br><br>  Kami tidak memberikan IPMI Supermicro kepada dunia, kami memilikinya di alamat abu-abu melalui OpenVPN.  Namun demikian, kami takut bahwa suatu hari kerentanan lain akan keluar dan kami akan menderita.  Oleh karena itu, kami mencoba menjaga agar firmware IPMI selalu menjadi yang terakhir.  Jika tidak, perbarui. <br><br>  Dari hal yang aneh, baru-baru ini keluar bahwa Intel pada kartu jaringan 10 dan 40-gigabit tidak termasuk boot PXE.  Ternyata jika server berada di rak di mana hanya ada kartu 40-gigabit, maka tidak mungkin untuk melakukan booting melalui jaringan, karena Anda perlu boot ke kartu gigabit.  Kami secara terpisah mem-flash kartu jaringan pada 40G sehingga mereka memiliki PXE dan dapat terus hidup. <br><br>  <strong>Setelah semuanya diperiksa, server segera mulai dijual</strong> .  Harganya dihitung, di mana ia diletakkan di situs dan dijual. <br><br><img src="https://habrastorage.org/webt/by/ca/ah/bycaah2szao5f0-lcrkk5zcwzyo.png"><br><br>  Secara total, kami melakukan sekitar 350 cek per bulan, 69% server dapat diservis, 31% tidak dapat diservis.  Ini karena fakta bahwa kami memiliki sejarah yang kaya, beberapa server telah berdiri selama 10 tahun.  Sebagian besar server yang tidak lulus tes, kami hanya membuang. <br><br><blockquote>  Untuk yang penasaran: kami memiliki 3 klien yang masih hidup di Pentium IV dan tidak ingin pergi ke mana pun.  Mereka memiliki RAM 512 MB. <br></blockquote><br>  Masa depan telah tiba!  Jika saya memagari sistem ini hari ini ... <br><br><img src="https://habrastorage.org/webt/4v/bb/e_/4vbbe_vodbx8hzm_zk-nf2oejf4.png"><br><br>  Utilitas yang luar biasa, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hardware Lister</a> (lshw), dirilis, yang dapat berkomunikasi dengan kernel, dengan indah menampilkan jenis perangkat keras apa yang ada di dalam kernel, apa yang dapat dideteksi oleh kernel.  Tidak semua tarian ini dibutuhkan.  Jika Anda ulangi - Saya sangat menyarankan Anda untuk melihat utilitas ini dan menggunakannya.  Semuanya akan menjadi lebih sederhana. <br><br><h1>  Ringkasan: <br></h1><br><ul><li>  Kompromi itu tidak buruk, itu hanya masalah harga.  Jika solusinya sangat mahal, Anda perlu mencari tingkat di mana keandalan dan harga dapat diterima. </li><li>  Program non-inti terkadang keren untuk pengujian.  Tetap hanya untuk menemukan mereka. </li><li>  Uji semua yang Anda raih! </li></ul><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HighLoad ++</a> berikutnya sudah pada 8 dan 9 November di Moskow.  Program ini mencakup spesialis terkenal dan nama baru, tugas tradisional dan baru.  Di bagian DevOps, misalnya, yang berikut sudah diterima: <br><br><ul><li>  David O'Brien (Xirus), yang akan membahas keabadian - “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Metrik!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Metrik!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Metrik!</a>  " <br></li><li>  Vladimir Kolobaev (Avito) dengan laporan banding " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pemantauan - untuk pengembang!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Teknologi untuk komunitas!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Untung - untuk semua orang!</a>  " <br></li><li>  Elena Grahovac (N26) akan menghadirkan " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Praktik Terbaik untuk Layanan Cloud Asli</a> ". <br></li></ul><br>  Pelajari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">daftar</a> laporan dan cepatlah bergabung.  Atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berlangganan</a> buletin kami dan Anda akan menerima ulasan berkala atas laporan, laporan tentang artikel dan video baru. <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id426733/">https://habr.com/ru/post/id426733/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id426723/index.html">Microsoft dan para mitra berharap dapat membuat kapsul waktu di bulan</a></li>
<li><a href="../id426725/index.html">Bagaimana melakukan sesuatu ketika Anda tidak ingin melakukannya</a></li>
<li><a href="../id426727/index.html">EME? Cdm? DRM? CENC? IDK! Apa yang Anda butuhkan untuk membuat pemutar video Anda sendiri di browser</a></li>
<li><a href="../id426729/index.html">TypeScript School of Magic: Generik dan Jenis Ekstensi</a></li>
<li><a href="../id426731/index.html">CSS: fitur menarik dari radius batas</a></li>
<li><a href="../id426735/index.html">Selamat datang di JETHACK Hackathon</a></li>
<li><a href="../id426737/index.html">Secara singkat tentang arsitektur prosesor neuromorfik: tampilan dalam</a></li>
<li><a href="../id426739/index.html">File proxy dari AWS S3 menggunakan nginx</a></li>
<li><a href="../id426741/index.html">Memo untuk mereka yang berencana merekrut pekerja magang untuk pertama kalinya</a></li>
<li><a href="../id426743/index.html">Cara-cara menggunakan blockchain diputar di tempat lain. Sony mengumumkan sistem DRM berbasis blockchain</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>