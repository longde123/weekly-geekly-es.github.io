<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚òòÔ∏è üìì üö¥üèæ VKScript-Sprachanalyse: JavaScript, oder? ü§üüèø üé§ üï∏Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR 



 VKScript ist kein JavaScript. Die Semantik dieser Sprache unterscheidet sich grundlegend von der Semantik von JavaScript. Siehe die Schlus...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VKScript-Sprachanalyse: JavaScript, oder?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464099/"><h1>  TL; DR </h1><br><hr><br><p>  VKScript ist <b>kein</b> JavaScript.  Die Semantik dieser Sprache unterscheidet sich grundlegend von der Semantik von JavaScript.  Siehe die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Schlussfolgerung</a> . </p><br><a name="habracut"></a><h1>  Was ist VKScript? </h1><br><hr><br><p> <b>VKScript</b> ist eine JavaScript-√§hnliche Skriptprogrammiersprache, die in der VKontakte <code>execute</code> API-Methode verwendet wird, mit der Kunden genau die Informationen herunterladen k√∂nnen, die sie ben√∂tigen.  Im Wesentlichen ist VKScript ein Analogon zu GraphQL, das von Facebook f√ºr denselben Zweck verwendet wird. </p><br><p>  Vergleichen Sie GraphQL und VKScript: </p><br><div class="scrollable-table"><table><tbody><tr><th></th><th>  GraphQL </th><th>  VKScript </th></tr><tr><td>  Implementierungen </td><td>  Viele Open-Source-Implementierungen in verschiedenen Programmiersprachen </td><td>  Die einzige Implementierung innerhalb der VK-API </td></tr><tr><td>  Basierend auf </td><td>  Brandneue Sprache </td><td>  Javascript </td></tr><tr><td>  Die M√∂glichkeiten </td><td>  Datenanforderung, begrenzte Filterung;  Abfrageargumente k√∂nnen die Ergebnisse fr√ºherer Abfragen nicht verwenden </td><td>  Nachbearbeitung von Daten nach Ermessen des Kunden;  API-Anforderungen werden in Form von Methoden dargestellt und k√∂nnen beliebige Daten aus fr√ºheren Anforderungen verwenden </td></tr></tbody></table></div><br><p>  Beschreibung von VKScript auf der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Methodenseite in der VK-API-Dokumentation</a> (die einzige offizielle Sprachdokumentation): </p><br><blockquote><div class="scrollable-table"><table><tbody><tr><th>  Code </th><td>  Algorithmuscode in <b>VKScript</b> - ein Format √§hnlich <b>JavaScript</b> oder <b>ActionScript</b> <i>(Kompatibilit√§t mit <b>ECMAScript wird</b> vorausgesetzt)</i> .  Der Algorithmus sollte mit dem Befehl <b>return% expression%</b> enden.  Operatoren m√ºssen durch Semikolons getrennt werden. <br>  Zeichenfolge </td></tr></tbody></table></div><br><p>  Folgendes wird unterst√ºtzt: </p><br><ul><li>  arithmetische Operationen </li><li>  logische Operationen </li><li>  Erstellung von Arrays und Listen ([X, Y]) </li><li>  <b>parseInt</b> und <b>parseDouble</b> </li><li>  Verkettung (+) </li><li>  <b>wenn</b> konstruieren </li><li>  Array-Filter nach Parameter (@.) </li><li>  <b>API-</b> Methodenaufrufe, L√§ngenparameter </li><li>  Schleifen mit der <b>while-</b> Anweisung </li><li>  Javascript-Methoden: <b>Slice</b> , <b>Push</b> , <b>Pop</b> , <b>Shift</b> , <b>Unshift</b> , <b>Splice</b> , <b>Substr</b> , <b>Split</b> </li><li>  Operator <b>l√∂schen</b> </li><li>  Zuordnung zu Array-Elementen, zum Beispiel: row.user.action = "test"; </li><li>  Die Suche im Array oder String lautet <b>indexOf</b> , zum Beispiel: "123" .indexOf (2) = 1, [1, 2, 3] .indexOf (3) = 2. Gibt -1 zur√ºck, wenn das Element nicht gefunden wird. </li></ul><br><p>  Die Funktionserstellung wird derzeit nicht unterst√ºtzt. </p><br></blockquote><br><p>  In der zitierten Dokumentation hei√üt es: "ECMAScript-Kompatibilit√§t ist geplant."  Aber ist das so?  Versuchen wir herauszufinden, wie diese Sprache von innen funktioniert. </p><br><br><h1>  Inhalt </h1><br><hr><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Virtuelle VKScript-Maschine</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Semantik von VKScript-Objekten</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Fazit</a> </li></ol><br><a name="vm"></a><h1>  Virtuelle VKScript-Maschine </h1><br><hr><br><p>  Wie kann ein Programm ohne lokale Kopie analysiert werden?  Das ist richtig - senden Sie Anfragen an den √∂ffentlichen Endpunkt und analysieren Sie die Antworten.  Versuchen wir beispielsweise, den folgenden Code auszuf√ºhren: </p><br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>  Beim <code>Runtime error occurred during code invocation: Too many operations</code> ein <code>Runtime error occurred during code invocation: Too many operations</code> .  Dies deutet darauf hin, dass bei der Implementierung der Sprache die Anzahl der durchgef√ºhrten Aktionen begrenzt ist.  Versuchen wir, den genauen Grenzwert festzulegen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">1000</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <code>Runtime error occurred during code invocation: Too many operations</code> . </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><ul><li>  <code>{"response": null}</code> - Der Code wurde erfolgreich ausgef√ºhrt. </li></ul><br><p>  Somit liegt die Grenze f√ºr die Anzahl der Operationen bei etwa 1000 "Leerlauf" -Zyklen.  Gleichzeitig ist jedoch klar, dass ein solcher Zyklus h√∂chstwahrscheinlich keine ‚Äûeinheitliche‚Äú Operation ist.  Versuchen wir, eine Operation zu finden, die vom Compiler nicht in mehrere kleinere unterteilt wird. </p><br><p>  Der offensichtlichste Kandidat f√ºr die Rolle einer solchen Operation ist die sogenannte leere Anweisung ( <code>;</code> ).  Nach dem Hinzuf√ºgen zum Code mit <code>i &lt; 999</code> 50 Zeichen <code>;</code>  wird das Limit nicht √ºberschritten.  Dies bedeutet, dass entweder die leere Anweisung vom Compiler ausgel√∂st wird und keine Operationen verschwendet, oder dass eine Iteration der Schleife mehr als 50 Operationen erfordert (was h√∂chstwahrscheinlich nicht der Fall ist). </p><br><p>  Das n√§chste, was mir danach einf√§llt <code>;</code>  - Berechnung eines einfachen Ausdrucks (zum Beispiel wie folgt: <code>1;</code> ).  Versuchen wir, einige dieser Ausdr√ºcke zu unserem Code hinzuzuf√ºgen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    1; //       "Too many operations"</span></span></code> </pre> <br><p>  Somit sind 2 Operationen <code>1;</code>  mehr Operationen als 50 Operationen ausgeben <code>;</code>  .  Dies best√§tigt die Hypothese, dass eine leere Anweisung keine Anweisungen verschwendet. </p><br><p>  Versuchen wir, die Anzahl der Iterationen des Zyklus zu verringern und eine zus√§tzliche <code>1;</code> hinzuzuf√ºgen <code>1;</code>  .  Es ist leicht zu bemerken, dass es f√ºr jede Iteration 5 zus√§tzliche <code>1;</code>  Daher verbraucht eine Iteration des Zyklus f√ºnfmal mehr Operationen als eine Operation <code>1;</code>  . </p><br><p>  Aber gibt es eine noch einfachere Bedienung?  Zum Hinzuf√ºgen des un√§ren Operators <code>~</code> ist beispielsweise keine Berechnung zus√§tzlicher Ausdr√ºcke erforderlich, und die Operation selbst wird auf dem Prozessor ausgef√ºhrt.  Es ist logisch anzunehmen, dass das Hinzuf√ºgen dieser Operation zum Ausdruck die Gesamtzahl der Operationen um 1 erh√∂ht. </p><br><p>  F√ºgen Sie diesen Operator unserem Code hinzu: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; ~<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br><p>  Und ja, wir k√∂nnen einen solchen Operator und einen weiteren Ausdruck <code>1;</code> hinzuf√ºgen <code>1;</code>  - nicht mehr.  Daher <code>1;</code>  ist wirklich kein einheitlicher Operator. </p><br><p>  √Ñhnlich wie Operator <code>1;</code>  reduzieren wir die Anzahl der Iterationen der Schleife und f√ºgen die Operatoren <code>~</code> .  Eine Iteration entsprach 10 einheitlichen Operationen <code>~</code> , daher Ausdruck <code>1;</code>  verbringt 2 Operationen. </p><br><p>  Es ist zu beachten, dass die Grenze ungef√§hr 1000 Iterationen betr√§gt, d. H. Ungef√§hr 10.000 Einzeloperationen.  Wir gehen davon aus, dass das Limit genau 10.000 Operationen betr√§gt. </p><br><br><h2>  Messen der Anzahl von Operationen im Code </h2><br><hr><br><p>  Beachten Sie, dass wir jetzt die Anzahl der Operationen in jedem Code messen k√∂nnen.  F√ºgen Sie dazu diesen Code nach der Schleife hinzu und f√ºgen Sie Iterationen, <code>~</code> -Operatoren oder die gesamte letzte Zeile hinzu / entfernen Sie sie, bis der Fehler <code>Too many operations</code> verschwindet. </p><br><p>  Einige Messergebnisse: </p><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Anzahl der Operationen </th></tr><tr><td> <code>1;</code> </td> <td>  2 </td></tr><tr><td> <code>~1;</code> </td> <td>  3 </td></tr><tr><td> <code>1+1;</code> </td> <td>  4 </td></tr><tr><td> <code>1+1+1;</code> </td> <td>  6 </td></tr><tr><td> <code>(true?1:1);</code> </td> <td>  5 </td></tr><tr><td> <code>(false?1:1);</code> </td> <td>  4 </td></tr><tr><td> <code>if(0)1;</code> </td> <td>  2 </td></tr><tr><td> <code>if(1)1;</code> </td> <td>  4 </td></tr><tr><td> <code>if(0)1;else 1;</code> </td> <td>  4 </td></tr><tr><td> <code>if(1)1;else 1;</code> </td> <td>  5 </td></tr><tr><td> <code>while(0);</code> </td> <td>  2 </td></tr><tr><td> <code>i=1;</code> </td> <td>  3 </td></tr><tr><td> <code>i=i+1;</code> </td> <td>  5 </td></tr><tr><td> <code>var j = 1;</code> </td> <td>  1 </td></tr><tr><td> <code>var j = 0;while(j &lt; 1)j=j+1;</code> </td> <td>  15 </td></tr></tbody></table></div><br><br><h2>  Bestimmen des Typs der virtuellen Maschine </h2><br><hr><br><p>  Zuerst m√ºssen Sie verstehen, wie der VKScript-Interpreter funktioniert.  Es gibt zwei mehr oder weniger plausible Optionen: </p><br><ul><li>  Der Interpreter durchl√§uft rekursiv den Syntaxbaum und f√ºhrt eine Operation f√ºr jeden Knoten aus. </li><li>  Der Compiler √ºbersetzt den Syntaxbaum in eine Folge von Anweisungen, die der Interpreter ausf√ºhrt. </li></ul><br><p>  Es ist leicht zu verstehen, dass VKScript die zweite Option verwendet.  Betrachten Sie den Ausdruck <code>(true?1:1);</code>  (5 Operationen) und <code>(false?1:1);</code>  (4 Operationen).  Im Fall der sequentiellen Ausf√ºhrung von Anweisungen wird eine zus√§tzliche Operation durch einen √úbergang erkl√§rt, der die falsche Option ‚Äûumgeht‚Äú, und im Fall einer rekursiven AST-Umgehung sind beide Optionen f√ºr den Interpreter √§quivalent.  Ein √§hnlicher Effekt wird bei if / else mit einem anderen Zustand beobachtet. </p><br><p>  Es lohnt sich auch, auf das Paar <code>i = 1;</code> zu achten <code>i = 1;</code>  (3 Operationen) und <code>var j = 1;</code>  (1 Operation).  Das Erstellen einer neuen Variablen kostet nur 1 Operation, und das Zuweisen zu einer vorhandenen kostet 3?  Die Tatsache, dass das Erstellen einer Variablen 1 Operation kostet (und h√∂chstwahrscheinlich eine konstante Ladeoperation ist), sagt zwei Dinge aus: </p><br><ul><li>  Beim Erstellen einer neuen Variablen gibt es keine explizite Speicherzuordnung f√ºr die Variable. </li><li>  Beim Erstellen einer neuen Variablen wird der Wert nicht in die Speicherzelle geladen.  Dies bedeutet, dass der Speicherplatz f√ºr die neue Variable dort zugewiesen wird, wo der Wert des Ausdrucks berechnet wurde, und danach dieser Speicher als zugewiesen betrachtet wird.  Dies legt die Verwendung einer Stapelmaschine nahe. </li></ul><br><p>  Die Verwendung des Stapels erkl√§rt auch, dass der Ausdruck <code>var j = 1;</code>  l√§uft schneller als Ausdruck <code>1;</code>  : Der letzte Ausdruck gibt zus√§tzliche Anweisungen zum Entfernen des berechneten Werts aus dem Stapel aus. </p><br><br><h2>  Ermittlung des genauen Grenzwertes </h2><br><p>  Man beachte, dass der Zyklus <code>var j=0;while(j &lt; 1)j=j+1;</code>  (15 Operationen) ist eine kleine Kopie des Zyklus, der f√ºr Messungen verwendet wurde: </p><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Anzahl der Operationen </th></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> </td><td>  15 </td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> </td><td>  15 + 998 * 10 = 9995 </td></tr><tr><td><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">999</span></span>) i = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; ~<span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  (Grenze) </td><td>  9998 </td></tr></tbody></table></div><br><p>  H√∂r auf was?  Gibt es ein Limit von 9998 Anweisungen?  Uns fehlt eindeutig etwas ... </p><br><p>  Beachten Sie, dass der <code>return 1;</code>  durchgef√ºhrt nach Messungen f√ºr 0 Anweisungen.  Dies ist leicht zu erkl√§ren: Der Compiler f√ºgt am Ende des Codes eine implizite <code>return null;</code> hinzu <code>return null;</code>  und wenn die R√ºckgabe hinzugef√ºgt wird, schl√§gt dies fehl.  Unter der Annahme, dass das Limit 10000 betr√§gt, schlie√üen wir, dass die Operation <code>return null;</code>  nimmt 2 Anweisungen (wahrscheinlich ist dies so etwas wie <code>push null; return;</code> ). </p><br><br><h2>  Verschachtelte Codebl√∂cke </h2><br><hr><br><p>  Nehmen wir noch einige Messungen vor: </p><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Anzahl der Operationen </th></tr><tr><td> <code>{};</code> </td> <td>  0 </td></tr><tr><td> <code>{var j = 1;};</code> </td> <td>  2 </td></tr><tr><td> <code>{var j = 1, k = 2;};</code> </td> <td>  3 </td></tr><tr><td> <code>{var j = 1; var k = 2;};</code> </td> <td>  3 </td></tr><tr><td> <code>var j = 1; var j = 1;</code> </td> <td>  4 </td></tr><tr><td> <code>{var j = 1;}; var j = 1;</code> </td> <td>  3 </td></tr></tbody></table></div><br><p>  Beachten wir die folgenden Fakten: </p><br><ul><li>  Das Hinzuf√ºgen einer Variablen zu einem Block erfordert eine zus√§tzliche Operation. </li><li>  Beim "erneuten Deklarieren einer Variablen" erf√ºllt die zweite Deklaration eine normale Zuordnung. </li><li>  Gleichzeitig ist die Variable innerhalb des Blocks von au√üen nicht sichtbar (siehe letztes Beispiel). </li></ul><br><p>  Es ist leicht zu verstehen, dass eine zus√§tzliche Operation zum Entfernen der im Block deklarierten lokalen Variablen vom Stapel aufgewendet wird.  Dementsprechend muss nichts gel√∂scht werden, wenn keine lokalen Variablen vorhanden sind. </p><br><br><h1>  Objekte, Methoden, API-Aufrufe </h1><br><hr><br><div class="scrollable-table"><table><tbody><tr><th>  Code </th><th>  Anzahl der Operationen </th></tr><tr><td> <code>"";</code> </td> <td>  2 </td></tr><tr><td> <code>"abcdef";</code> </td> <td>  2 </td></tr><tr><td> <code>{};</code> </td> <td>  2 </td></tr><tr><td> <code>[];</code> </td> <td>  2 </td></tr><tr><td> <code>[1, 2, 3];</code> </td> <td>  5 </td></tr><tr><td> <code>{a: 1, b: 2, c: 3};</code> </td> <td>  5 </td></tr><tr><td> <code>API.users.isAppUser(1);</code> </td> <td>  3 </td></tr><tr><td> <code>"".substr(0, 0);</code> </td> <td>  6 </td></tr><tr><td> <code>var j={};jx=1;</code> </td> <td>  6 </td></tr><tr><td> <code>var j={x:1};delete jx;</code> </td> <td>  6 </td></tr></tbody></table></div><br><p>  Lassen Sie uns die Ergebnisse analysieren.  M√∂glicherweise stellen Sie fest, dass das Erstellen einer Zeichenfolge und eines leeren Arrays / Objekts zwei Vorg√§nge erfordert, ebenso wie das Laden einer Zahl.  Beim Erstellen eines nicht leeren Arrays oder Objekts werden Vorg√§nge zum Laden von Elementen des Arrays / Objekts hinzugef√ºgt.  Dies deutet darauf hin, dass das direkte Erstellen eines Objekts in einer Operation erfolgt.  Gleichzeitig wird keine Zeit mit dem Herunterladen von Eigenschaftsnamen verschwendet. Daher ist das Herunterladen Teil des Vorgangs zum Erstellen des Objekts. </p><br><p>  Mit dem API-Methodenaufruf ist auch alles ganz normal: Laden einer Einheit, tats√§chliches Aufrufen der Methode, <code>pop</code> Ergebnisses (Sie k√∂nnen feststellen, dass der Methodenname als Ganzes verarbeitet wird und keine Eigenschaften annimmt).  Aber die letzten drei Beispiele sehen interessant aus. </p><br><ul><li> <code>"".substr(0, 0);</code>  - Laden eines Strings, Laden von Null, Laden von Null, <code>pop</code> Ergebnis.  Aus einem bestimmten Grund gibt es zwei Anweisungen zum Aufrufen einer Methode (aus irgendeinem Grund siehe unten). </li><li> <code>var j={};jx=1;</code>  - Erstellen eines Objekts, Laden eines Objekts, Laden einer Einheit, <code>pop</code> Einheit nach Zuweisung.  Auch hier gibt es 2 Anweisungen f√ºr die Zuordnung. </li><li> <code>var j={x:1};delete jx;</code>  - Laden einer Einheit, Erstellen eines Objekts, Laden eines Objekts, L√∂schen.  Es gibt 3 Anweisungen pro L√∂schvorgang. </li></ul><br><br><a name="semantics"></a><br><h1>  Semantik von VKScript-Objekten </h1><br><h2>  Die Zahlen </h2><br><hr><br><p>  Zur√ºck zur urspr√ºnglichen Frage: Ist VKScript eine Teilmenge von JavaScript oder einer anderen Sprache?  Lassen Sie uns einen einfachen Test machen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1000000000</span></span> + <span class="hljs-number"><span class="hljs-number">2000000000</span></span>;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: <span class="hljs-number"><span class="hljs-number">-1294967296</span></span>};</code> </pre> <br><p>  Wie wir sehen k√∂nnen, f√ºhrt das Hinzuf√ºgen von Ganzzahlen zu einem √úberlauf, obwohl JavaScript keine Ganzzahlen als solche hat.  Es ist auch leicht zu √ºberpr√ºfen, ob das Teilen durch 0 zu einem Fehler f√ºhrt und keine <code>Infinity</code> . </p><br><br><h2>  Die Objekte </h2><br><hr><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {};</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: []}</code> </pre> <br><p>  H√∂r auf was?  Wir geben <i>ein Objekt zur√ºck</i> und erhalten ein <i>Array</i> ?  Ja, das ist es.  In VKScript werden Arrays und Objekte vom selben Typ dargestellt, insbesondere sind ein leeres Objekt und ein leeres Array ein und dasselbe.  In diesem Fall funktioniert die <code>length</code> Eigenschaft des Objekts und gibt die Anzahl der Eigenschaften zur√ºck. </p><br><p>  Es ist interessant zu sehen, wie sich Listenmethoden verhalten, wenn Sie sie f√ºr ein Objekt aufrufen. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">a</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Die <code>pop</code> Methode gibt die zuletzt deklarierte Eigenschaft zur√ºck, was jedoch logisch ist.  √Ñndern Sie die Reihenfolge der Eigenschaften: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">b</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">c</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">a</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Anscheinend erinnern sich Objekte in VKScript an die Reihenfolge, in der Eigenschaften zugewiesen werden.  Versuchen wir, numerische Eigenschaften zu verwenden: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">'0'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>}.pop();</code> </pre> <br><pre> <code class="json hljs"><span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p>  Nun wollen wir sehen, wie Push funktioniert: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-string"><span class="hljs-string">'b'</span></span>,<span class="hljs-string"><span class="hljs-string">'x'</span></span>:<span class="hljs-string"><span class="hljs-string">'c'</span></span>}; a.push(<span class="hljs-string"><span class="hljs-string">'d'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: <span class="hljs-string"><span class="hljs-string">"d"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>};</code> </pre> <br><p>  Wie Sie sehen k√∂nnen, sortiert die Push-Methode die Zifferntasten und f√ºgt nach der letzten Zifferntaste einen neuen Wert hinzu.  "L√∂cher" werden in diesem Fall nicht gef√ºllt. </p><br><p>  Versuchen Sie nun, diese beiden Methoden zu kombinieren: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = {<span class="hljs-string"><span class="hljs-string">'2'</span></span>:<span class="hljs-string"><span class="hljs-string">'a'</span></span>,<span class="hljs-string"><span class="hljs-string">'1'</span></span>:<span class="hljs-string"><span class="hljs-string">'b'</span></span>,<span class="hljs-string"><span class="hljs-string">'x'</span></span>:<span class="hljs-string"><span class="hljs-string">'c'</span></span>}; a.push(a.pop()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"1"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"2"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"3"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"x"</span></span>: <span class="hljs-string"><span class="hljs-string">"c"</span></span>};</code> </pre> <br><p>  Wie wir sehen, wurde das Element nicht aus dem Array gel√∂scht.  Wenn wir jedoch <code>push</code> und <code>pop</code> in verschiedene Zeilen setzen, verschwindet der Fehler.  Wir m√ºssen tiefer gehen! </p><br><br><h2>  Objektspeicherung </h2><br><hr><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = {}; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = x; xy = <span class="hljs-string"><span class="hljs-string">'z'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y;</code> </pre> <br><pre> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"response"</span></span>: []}</code> </pre> <br><p>  Wie sich herausstellte, werden Objekte in VKScript im Gegensatz zu JavaScript nach Wert gespeichert.  Jetzt sehen wir das seltsame Verhalten der Zeichenfolge <code>a.push(a.pop());</code>  - Anscheinend wurde der alte Wert des Arrays auf dem Stapel gespeichert, von wo er sp√§ter √ºbernommen wurde. </p><br><p>  Wie werden dann jedoch die Daten im Objekt gespeichert, wenn die Methode sie √§ndert?  Anscheinend ist die "zus√§tzliche" Anweisung beim Aufrufen der Methode speziell zum Zur√ºckschreiben von √Ñnderungen an das Objekt konzipiert. </p><br><br><h2>  Array-Methoden </h2><br><hr><br><div class="scrollable-table"><table><tbody><tr><th>  Methode </th><th>  Aktion </th></tr><tr><td> <code>push</code> </td> <td><ul><li>  Ziffern nach Wert sortieren </li><li>  Nehmen Sie den maximalen numerischen Schl√ºssel und f√ºgen Sie einen hinzu </li><li>  schreibe Argument in Array </li><li>  F√ºgen Sie am Ende des Arrays nicht numerische Schl√ºssel hinzu </li></ul></td></tr><tr><td> <code>pop</code> </td> <td>  Entfernen Sie das letzte Element aus dem Array (nicht unbedingt mit einem numerischen Schl√ºssel) und kehren Sie zur√ºck. </td></tr><tr><td>  der Rest </td><td><ul><li>  Sortieren Sie die Zifferntasten nach Wert und entfernen Sie die ‚ÄûL√∂cher‚Äú im Array </li><li>  F√ºhren Sie eine entsprechende Javascript-Operation durch </li><li>  F√ºgen Sie am Ende des Arrays nicht numerische Schl√ºssel hinzu </li></ul><br><p>  Bei Verwendung der Slice-Methode werden √Ñnderungen nicht gespeichert </p><br></td></tr></tbody></table></div><br><a name="summary"></a><h1>  Fazit </h1><br><hr><br><p>  VKScript ist kein JavaScript.  Im Gegensatz zu JavaScript werden darin enthaltene Objekte nach Wert und nicht nach Referenz gespeichert und haben eine v√∂llig andere Semantik.  Wenn Sie VKScript jedoch f√ºr den Zweck verwenden, f√ºr den es bestimmt ist, ist der Unterschied nicht erkennbar. </p><br><br><h1>  PS Semantik von Operatoren </h1><br><hr><br><p>  In den Kommentaren wurde das Kombinieren von Objekten √ºber <code>+</code> .  In diesem Zusammenhang habe ich beschlossen, Informationen √ºber die Arbeit der Betreiber hinzuzuf√ºgen. </p><br><div class="scrollable-table"><table><tbody><tr><th>  Betreiber </th><th>  Aktionen </th></tr><tr><td>  + </td><td><ul><li>  Wenn beide Argumente Objekte sind, erstellen Sie eine Kopie des ersten Objekts und f√ºgen Sie die Schl√ºssel des zweiten (mit Ersetzung) hinzu. </li><li>  Wenn beide Argumente Zahlen sind, f√ºgen Sie sie als Zahlen hinzu. </li><li>  Andernfalls werden beide Operanden in eine Zeichenfolge umgewandelt und als Zeichenfolgen hinzugef√ºgt. </li></ul></td></tr><tr><td>  Andere arithmetische Operatoren </td><td>  Beide Operanden werden in eine Zahl umgewandelt, und die entsprechende Operation wird ausgef√ºhrt.  F√ºr Bitoperationen werden Operanden zus√§tzlich in <code>int</code> . </td></tr><tr><td>  Vergleichsoperatoren </td><td>  Wenn zwei Zeichenfolgen oder zwei Zahlen verglichen werden, werden sie direkt verglichen.  Wenn eine Zeichenfolge und eine Zahl verglichen werden und die Zeichenfolge eine korrekte Notation f√ºr die Zahl ist, wird die Zeichenfolge in eine Zahl umgewandelt.  Andernfalls wird ein Fehler beim <code>Comparing values of different or unsupported types</code> zur√ºckgegeben. </td></tr><tr><td>  Auf Schnur werfen </td><td>  Zahlen und Zeichenfolgen werden wie in JavaScript angegeben.  Objekte werden als durch Kommas getrennte Werteliste in der Reihenfolge der Schl√ºssel aufgelistet.  <code>false</code> und <code>null</code> werden als <code>""</code> , <code>true</code> als <code>"1"</code> . </td></tr><tr><td>  Besetzung zu </td><td>  Wenn das Argument eine Zeichenfolge ist, die eine g√ºltige Notation ist, wird die Nummer zur√ºckgegeben.  Andernfalls wird ein <code>Numeric arguments expected</code> Fehler mit <code>Numeric arguments expected</code> zur√ºckgegeben. </td></tr></tbody></table></div><br><p>  Bei Operationen mit Zahlen (au√üer Bit) wird <code>int</code> <code>double</code> , wenn die Operanden <code>int</code> und <code>double</code> sind.  Wenn beide Operanden <code>int</code> , wird eine Operation f√ºr vorzeichenbehaftete 32-Bit-Ganzzahlen (mit √úberlauf) ausgef√ºhrt. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de464099/">https://habr.com/ru/post/de464099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de464089/index.html">Automatisierung von HTTP-Anforderungen im Kontext von Spring</a></li>
<li><a href="../de464091/index.html">Die Zusammenfassung interessanter Materialien f√ºr den mobilen Entwickler # 311 (vom 12. bis 18. August)</a></li>
<li><a href="../de464093/index.html">Digitale Waren: Was tun, wenn ein Kunde in einem Jahr einen Kauf abholt?</a></li>
<li><a href="../de464095/index.html">Getter und Setter in Dart und Flutter</a></li>
<li><a href="../de464097/index.html">Die Evolution der Intelligenz: Warum Roboter Emotionen brauchen</a></li>
<li><a href="../de464103/index.html">OpenUNB-Entwurf eines nationalen IoT-Standards: kritische √úberpr√ºfung</a></li>
<li><a href="../de464105/index.html">Native Commento-Server mit Docker Compose</a></li>
<li><a href="../de464107/index.html">Digitale Veranstaltungen in Moskau vom 19. bis 25. August</a></li>
<li><a href="../de464109/index.html">Weltraum-√úberschallfallschirme</a></li>
<li><a href="../de464111/index.html">Natas Web. Passage der CTF-Plattform zur Ausnutzung von Web-Schwachstellen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>