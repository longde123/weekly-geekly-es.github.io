<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ“– ğŸ¤³ğŸ¾ ğŸ‘‚ğŸ¾ ä½¿ç”¨Liquibaseåœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­ç®¡ç†æ•°æ®åº“ç»“æ„ã€‚ ç¬¬äºŒéƒ¨åˆ† ğŸ¤ª ğŸ¡ ğŸ¤²ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†Liquibaseçš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªä½¿ç”¨Liquibaseåˆå§‹åŒ–æ•°æ®åº“çš„Springå¼•å¯¼åº”ç”¨ç¨‹åºçš„åŸºæœ¬ç¤ºä¾‹ã€‚ å®Œæ•´çš„åŸºæœ¬åº”ç”¨ç¨‹åºä»£ç å¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ° ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºliquibase-maven-pluginåŠå…¶ä¸ºæ•°æ®åº“ç»“æ„ç‰ˆæœ¬åŒ–æä¾›çš„å…¶ä»–åŠŸèƒ½ã€‚ è®©æˆ‘...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨Liquibaseåœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­ç®¡ç†æ•°æ®åº“ç»“æ„ã€‚ ç¬¬äºŒéƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460907/">åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸Šä¸€éƒ¨åˆ†ä¸­ï¼Œ</a>æˆ‘ä»¬äº†è§£äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Liquibase</a>çš„åŸºæœ¬åŠŸèƒ½ï¼Œå¹¶ç¼–å†™äº†ä¸€ä¸ªä½¿ç”¨Liquibaseåˆå§‹åŒ–æ•°æ®åº“çš„<i>Springå¼•å¯¼</i>åº”ç”¨ç¨‹åºçš„åŸºæœ¬ç¤ºä¾‹ã€‚ å®Œæ•´çš„åŸºæœ¬åº”ç”¨ç¨‹åºä»£ç å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨GitHubä¸Šæ‰¾åˆ°</a> ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®º<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">liquibase-maven-plugin</a></i>åŠå…¶ä¸ºæ•°æ®åº“ç»“æ„ç‰ˆæœ¬åŒ–æä¾›çš„å…¶ä»–åŠŸèƒ½ã€‚ è®©æˆ‘ä»¬ä»å¦‚ä½•ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¯”è¾ƒåŠŸèƒ½</a>è‡ªåŠ¨åˆ›å»ºè„šæœ¬å¼€å§‹ã€‚ <br><br> å‡è®¾æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“çš„ç»“æ„è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›<i>email</i>ä¸ä¸º<i>null</i> ã€‚ å½“ç„¶ï¼Œå¯¹äºè¿™ä¹ˆå°çš„æ›´æ”¹ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨æ›´æ­£ä»£ç å’Œè„šæœ¬ï¼Œä½†æ˜¯å¦‚æœè¿˜æœ‰æ›´å¤šæ›´æ”¹ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒLiquibaseå†…ç½®æ•°æ®åº“çš„èƒ½åŠ›å°†å¯¹æˆ‘ä»¬æœ‰æ‰€å¸®åŠ©ã€‚ å®ƒçš„ä¸€ä¸ªæœ‰è¶£çš„åŠŸèƒ½æ˜¯ï¼Œæ‚¨ä¸ä»…å¯ä»¥æ¯”è¾ƒä¸¤ä¸ªæ•°æ®åº“ï¼Œè¿˜å¯ä»¥æ¯”è¾ƒåº”ç”¨ç¨‹åºä¸­å…·æœ‰ä¸€ç»„JPAå®ä½“çš„æ•°æ®åº“ã€‚ è¿™å°±æ˜¯æˆ‘ä»¬ç°åœ¨è¦åšçš„ï¼ <br><a name="habracut"></a><br><h4> ä½¿ç”¨liquibase-diffåˆ›å»ºå…·æœ‰æ›´æ”¹çš„è„šæœ¬ </h4><br> åœ¨<i>pom.xml</i>æ–‡ä»¶çš„<i>plugins</i>éƒ¨åˆ†ä¸­ï¼Œ <i>æˆ‘ä»¬</i>æ·»åŠ äº†è¿™ä¸ªç›¸å½“å¤æ‚çš„è®¾è®¡ã€‚ è¿™æ˜¯<i>liquibase-maven-plugin</i> ï¼Œä¸è¯¥ä¾èµ–é¡¹è¿æ¥çš„ä¾èµ–é¡¹ç”¨äºåˆ†æ<i>ä¼‘çœ å®ä½“</i>å’Œä½¿ç”¨YAMLæ–‡ä»¶ã€‚ è¯¥æ’ä»¶å°†é€šè¿‡æ¯”è¾ƒä¸¤ä¸ªæ•°æ®åº“ä¸­çš„ç»“æ„ï¼Œç”šè‡³é€šè¿‡æ¯”è¾ƒæ•°æ®åº“ä¸­çš„æ•°æ®ç»“æ„ä»¥åŠæˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­çš„ä¸€ç»„hiberanteå®ä½“ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨ç”Ÿæˆ<i>liquibaseè„šæœ¬</i> ï¼ˆ <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸ºæ­¤</a></i>æ·»åŠ äº†<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">liquibase-hibernate5</a></i> ï¼‰ã€‚ <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.8.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">propertyFile</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}/liquibase-maven-plugin.properties<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">propertyFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">systemProperties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user.name</span></span></span><span class="hljs-tag">&gt;</span></span>your_liquibase_username<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user.name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">systemProperties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span>info<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase.ext<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-hibernate5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-data-jpa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.0.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br> æ³¨æ„<i>user.name</i>è®¾ç½®ã€‚ å®ƒæ˜¯å¯é€‰çš„ï¼Œä½†æ²¡æœ‰å®ƒï¼ŒLiquibaseå°†åœ¨åˆ›å»ºçš„è„šæœ¬ä¸­æŒ‡ç¤ºå¯åŠ¨æ’ä»¶çš„å½“å‰OSç”¨æˆ·çš„åç§°ã€‚ <br><br> å¯ä»¥åœ¨è°ƒç”¨mavenæ—¶å°†æ’ä»¶çš„è®¾ç½®ç›´æ¥å†™å…¥pom.xmlæˆ–ä½œä¸ºå‘½ä»¤è¡Œå‚æ•°ä¼ é€’ï¼Œä½†æ˜¯æˆ‘æ›´å–œæ¬¢å¸¦æœ‰å•ç‹¬<i>liquibase-maven-plugin.properties</i>æ–‡ä»¶çš„é€‰é¡¹ã€‚ å…¶å†…å®¹å°†å¦‚ä¸‹æ‰€ç¤ºã€‚ <br><br><pre> <code class="plaintext hljs">changeLogFile= @project.basedir@/src/main/resources/db/changelog/db.changelog-master.yaml url= jdbc:mysql://localhost:3306/geek_db?createDatabaseIfNotExist=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC username= dbusername password= dbpassword driver= com.mysql.cj.jdbc.Driver referenceUrl= hibernate:spring:ru.usharik.liquibase.demo.persist.model?dialect=org.hibernate.dialect.MySQLDialect diffChangeLogFile= @project.basedir@/src/main/resources/db/changelog/db.changelog-@timestamp@.yaml ignoreClasspathPrefix= true</code> </pre> å€¼å¾—æ³¨æ„<i>url</i>å’Œ<i>referenceUrl</i>å‚æ•°ã€‚ æ¯”è¾ƒåå°†åˆ›å»ºliquibaseçš„è„šæœ¬å°†æ˜¯ä½¿ç”¨referenceUrlé“¾æ¥çš„åŸºç¡€å’Œä½¿ç”¨<i>url</i>é“¾æ¥çš„åŸºç¡€ä¹‹é—´çš„åŒºåˆ«ã€‚ å¦‚æœä»¥åä½¿ç”¨<i>url</i>é“¾æ¥åœ¨åŸºç¡€ä¸Šè¿è¡Œæ­¤è„šæœ¬ï¼Œåˆ™è¯¥è„šæœ¬å°†ä¸referenceUrlé“¾æ¥ä¸Šçš„è„šæœ¬ç›¸åŒã€‚ åº”ç‰¹åˆ«æ³¨æ„referenceUrlé“¾æ¥ã€‚ å¦‚æ‚¨æ‰€è§ï¼Œå®ƒä¸æ˜¯æŒ‡æ•°æ®åº“ï¼Œè€Œæ˜¯æŒ‡å®ä½“ç±»æ‰€åœ¨çš„åº”ç”¨ç¨‹åºåŒ…ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªè„šæœ¬ï¼Œè¯¥è„šæœ¬ä¼šå°†ä»£ç ä¸­æ‰€åšçš„æ›´æ”¹æ·»åŠ åˆ°æ•°æ®åº“ä¸­ã€‚ <br><br> ç°åœ¨æˆ‘ä»¬éœ€è¦é…ç½®maven-resource-pluginæ¥æ›¿æ¢è®¾ç½®æ–‡ä»¶ä¸­çš„å ä½ç¬¦ï¼Œä¾‹å¦‚<code>@project.basedir@</code>å’Œ<code>@timestamp@</code> ã€‚ ä¸ºæ­¤ï¼Œè¯·å°†ä»¥ä¸‹è¡¨å•çš„<i>èµ„æº</i>éƒ¨åˆ†æ·»åŠ åˆ°<i>æ„å»º</i>éƒ¨åˆ† <br><br><pre> <code class="plaintext hljs">&lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;*.properties&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;**/*.*&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt;</code> </pre> <br> é¡ºä¾¿è¯´ä¸€å¥ï¼ŒSpringå¯åŠ¨å°†ä½¿ç”¨<i>maven-resource-plugin</i>å¡«å……çš„å ä½ç¬¦çš„æ ‡å‡†æ ¼å¼ä»<code>${smth}</code>æ›´æ”¹ä¸º<code>@smth@</code> ã€‚ äº‹å®æ˜¯ï¼ŒSpring Bootä¸­<code>@smth@</code>å ä½ç¬¦ç”¨äºæ›¿æ¢ç¯å¢ƒå˜é‡å’ŒSpring Bootåº”ç”¨ç¨‹åºæœ¬èº«çš„å‚æ•°ã€‚ <br><br> å¦å¤–ï¼Œæˆ‘ä»¬ç¨å¾®æ›´æ”¹<i>pom.xmlä¸­</i>çš„<i>properties</i>éƒ¨åˆ†ï¼Œä»¥æ‰€éœ€çš„æ ¼å¼å°†å€¼åˆ†é…ç»™<i>timestamp</i>å˜é‡ã€‚  lasï¼Œæ ‡å‡†æ ¼å¼å¯èƒ½åŒ…å«æŸäº›æ“ä½œç³»ç»Ÿçš„æ–‡ä»¶åä¸­ç¦æ­¢çš„å­—ç¬¦ã€‚ <br><br><pre> <code class="plaintext hljs">&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;timestamp&gt;${maven.build.timestamp}&lt;/timestamp&gt; &lt;maven.build.timestamp.format&gt;yyyyMMdd-HHmmssSSS&lt;/maven.build.timestamp.format&gt; &lt;/properties&gt;</code> </pre> <br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ›´æ”¹Userç±»ä¸­çš„emailå­—æ®µ <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"email"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String email;</code> </pre> <br> æœ€åï¼Œä½¿ç”¨<i>liquibase-maven-plugin</i>è¿è¡Œbuildå‘½ä»¤è¿›è¡Œæ¯”è¾ƒã€‚ <br><br><pre> <code class="plaintext hljs">mvn clean install liquibase:diff -DskipTests=true</code> </pre> <br> åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å®Œå…¨é‡å»ºé¡¹ç›®ï¼Œå› ä¸ºè¯¥æ’ä»¶ï¼ˆliquibaseï¼šdiffï¼‰å°†ä¸ä½¿ç”¨ç¼–è¯‘æºï¼Œè€Œæ˜¯ä½¿ç”¨<i>ç›®æ ‡</i>æ–‡ä»¶å¤¹ä¸­çš„ç¼–è¯‘å®ä½“ç±»æ–‡ä»¶è¿›è¡Œåˆ†æã€‚ <br><br> å¦‚æœä¸€åˆ‡æ­£ç¡®å®Œæˆï¼Œé‚£ä¹ˆåœ¨<i>èµ„æº/ db / changelog</i>æ–‡ä»¶å¤¹ä¸­æˆåŠŸæ‰§è¡Œå‘½ä»¤åï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªåä¸º<i>db.changelog-20190723-100748666.yaml</i>çš„æ–‡ä»¶ã€‚ ç”±äºæˆ‘ä»¬åœ¨æ–‡ä»¶åä¸­ä½¿ç”¨äº†å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼Œå› æ­¤æ¯æ¬¡å¯åŠ¨æ—¶æˆ‘ä»¬éƒ½ä¼šæœ‰ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œè¿™éå¸¸æ–¹ä¾¿ã€‚ å¦‚æœæ‚¨å·²ç»ä½¿ç”¨ä¸Šä¸€è¯¾æ‰€å¯¹åº”çš„è¡¨ç»“æ„åˆ›å»ºäº†æ•°æ®åº“ï¼Œåˆ™æ–‡ä»¶çš„å†…å®¹åº”å¦‚ä¸‹æ‰€ç¤ºã€‚ <br><br><pre> <code class="plaintext hljs">databaseChangeLog: - changeSet: id: 1563876485764-1 author: your_liquibase_username (generated) changes: - addNotNullConstraint: columnDataType: varchar(255) columnName: email tableName: users</code> </pre> å¦‚æ‚¨æ‰€è§ï¼Œæ­¤è„šæœ¬å®Œå…¨è¿›è¡Œäº†ä»£ç ä¸­çš„æ›´æ”¹ã€‚ ä½œä¸ºç»ƒä¹ ï¼Œæˆ‘å»ºè®®æ‚¨é’ˆå¯¹ä¸€ä¸ªç©ºçš„æ•°æ®åº“è¿è¡Œæ­¤è„šæœ¬å¹¶æŸ¥çœ‹ç»“æœã€‚ <br><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†<i>changeSet</i>ä»è¯¥æ–‡ä»¶å¤åˆ¶åˆ°<i>db.changelog-master.yamlï¼Œ</i>æˆ–è€…å¯ä»¥é€šè¿‡ä¸€æ¡æŒ‡ä»¤å°†è¯¥æ–‡ä»¶è¿æ¥åˆ°å®ƒ <br><br><pre> <code class="plaintext hljs"> - include: file: db.changelog-20190723-100748666.yaml relativeToChangelogFile: true</code> </pre> <br> åŒæ ·åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œæ‚¨éœ€è¦æŒ‡å®š<code>logicalFilePath: db/changelog/db.changelog-20190723-100748666.yaml</code> ï¼Œç±»ä¼¼äºåœ¨<i>db.changelog-master.yamlä¸­çš„æ“ä½œ</i> ã€‚ <br> è¿™å°†æœ‰åŠ©äºè§£å†³åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å†…ç½®çš„liquibase beanå’Œ<i>liquibase-maven-plugin</i>æ—¶å¯èƒ½å‡ºç°çš„ä¸€äº›é—®é¢˜ã€‚ ä¹‹åï¼Œé‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºæˆ–è¿è¡Œå‘½ä»¤ï¼š <br><br><pre> <code class="plaintext hljs">mvn liquibase:update</code> </pre> <br> è®©æˆ‘ä»¬å°è¯•å¯¹ä»£ç è¿›è¡Œä¸€äº›æ›´å¤æ‚çš„æ›´æ”¹ã€‚ ä¾‹å¦‚ï¼Œæ·»åŠ ä¸€ä¸ªè§’è‰²è¡¨ï¼Œè¯¥è§’è‰²è¡¨å°†ä¸ç”¨æˆ·è¡¨å…·æœ‰å¤šå¯¹å¤šå…³ç³»ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"roles"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Role</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>, unique = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(mappedBy = <span class="hljs-string"><span class="hljs-string">"roles"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;User&gt; users; <span class="hljs-comment"><span class="hljs-comment">//  , ,  }</span></span></code> </pre> <br> ç„¶ååœ¨â€œç”¨æˆ·â€è¡¨ä¸­æ·»åŠ  <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(fetch = FetchType.LAZY) <span class="hljs-meta"><span class="hljs-meta">@JoinTable</span></span>(name = <span class="hljs-string"><span class="hljs-string">"users_roles"</span></span>, joinColumns = <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user_id"</span></span>), inverseJoinColumns = <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"role_id"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;Role&gt; roles;</code> </pre> <br> å¼€å§‹æ¯”è¾ƒä¹‹åï¼Œæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶ <br><pre> <code class="plaintext hljs">databaseChangeLog: - changeSet: id: 1563877765929-1 author: your_liquibase_username (generated) changes: - createTable: columns: - column: autoIncrement: true constraints: primaryKey: true primaryKeyName: rolesPK name: id type: BIGINT - column: constraints: nullable: false name: name type: VARCHAR(255) tableName: roles - changeSet: id: 1563877765929-2 author: your_liquibase_username (generated) changes: - createTable: columns: - column: constraints: nullable: false name: user_id type: BIGINT - column: constraints: nullable: false name: role_id type: BIGINT tableName: users_roles - changeSet: id: 1563877765929-3 author: your_liquibase_username (generated) changes: - addPrimaryKey: columnNames: user_id, role_id tableName: users_roles - changeSet: id: 1563877765929-4 author: your_liquibase_username (generated) changes: - addUniqueConstraint: columnNames: name constraintName: UC_ROLESNAME_COL tableName: roles - changeSet: id: 1563877765929-5 author: your_liquibase_username (generated) changes: - addForeignKeyConstraint: baseColumnNames: user_id baseTableName: users_roles constraintName: FK2o0jvgh89lemvvo17cbqvdxaa deferrable: false initiallyDeferred: false referencedColumnNames: id referencedTableName: users - changeSet: id: 1563877765929-6 author: your_liquibase_username (generated) changes: - addForeignKeyConstraint: baseColumnNames: role_id baseTableName: users_roles constraintName: FKj6m8fwv7oqv74fcehir1a9ffy deferrable: false initiallyDeferred: false referencedColumnNames: id referencedTableName: roles</code> </pre> <br> æˆ‘ä»¬è¿˜å¯ä»¥è½»æ¾åœ°å°†æ­¤æ–‡ä»¶æ·»åŠ åˆ°å·¥ä½œè„šæœ¬ä¸­ã€‚ <br><br><h4> å›æ»šæ›´æ”¹ </h4><br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å›æ»šæ‰€åšçš„æ›´æ”¹ã€‚ ç”±äºæŸäº›åŸå› ï¼Œæˆ‘ä»¬åœ¨changeSetsä¸­æŒ‡å®šçš„é‚£äº›æ ‡è¯†ç¬¦ä¸èƒ½ç”¨äºå›æ»šåˆ°å®ƒä»¬ã€‚ æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼ŒæŒ‡å®šä¸€ä¸ªå›æ»šç‚¹ <br><br><ul><li> ä»å½“å‰è®¡æ•°çš„changeSetçš„æ•°é‡ </li><li> æ›´æ”¹æ—¥æœŸä¹‹å </li><li> é€šè¿‡æ ‡ç­¾ï¼ˆä½¿ç”¨ç‰¹æ®Šç±»å‹çš„changeSetè®¾ç½®ï¼‰ </li></ul><br> æ ‡ç­¾è®¾ç½®å¦‚ä¸‹ã€‚ <br><br><pre> <code class="plaintext hljs"> - changeSet: id: some_uniqui_id author: liquibase_user_name changes: - tagDatabase: tag: db_tag</code> </pre> <br> å¥½äº†ï¼Œåˆ—å‡ºäº†ä¸‰ç§å›æ»šæ–¹å¼çš„å‘½ä»¤ <br><br><pre> <code class="plaintext hljs">mvn liquibase:rollback -Dliquibase.rollbackTag=db_tag mvn liquibase:rollback -Dliquibase.rollbackCount=1 mvn liquibase:rollback "-Dliquibase.rollbackDate=Jun 03, 2017"</code> </pre><br> æœ€åï¼Œä¸€äº›å…¶ä»–ææ–™ <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æœ¬æ–‡ä»£ç </a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³äºLiquibaseä¸­çš„å›æ»š</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³äºä½¿ç”¨Liquibaseè¿›è¡Œè¿ç§»</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GitHubä¸Šçš„Liquibase</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…³äºæ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶çš„å„ç§æ–¹æ³•çš„éå¸¸å¥½çš„æ–‡ç« </a> </li></ol><br> å½“ç„¶ï¼Œå¯¹äºä»»ä½•è¯„è®ºï¼Œè¡¥å……ï¼Œè¯´æ˜ç­‰ï¼Œæˆ‘éƒ½ä¼šæ„Ÿåˆ°éå¸¸é«˜å…´ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460907/">https://habr.com/ru/post/zh-CN460907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460893/index.html">ä»å†…è€Œå¤–çœ‹å‘çˆ±æ²™å°¼äºšçš„è¿ç§»-åˆ©å¼Š</a></li>
<li><a href="../zh-CN460897/index.html">å¸¦æœ‰Kubernetesçš„GitLab CIä¸­çš„JUnit</a></li>
<li><a href="../zh-CN460899/index.html">7æœˆ26æ—¥ï¼ŒDeworkacy-Rostelecomçš„DocOps</a></li>
<li><a href="../zh-CN460901/index.html">ä¸ºä»€ä¹ˆé«˜çº§å¼€å‘äººå‘˜æ‰¾ä¸åˆ°å·¥ä½œ</a></li>
<li><a href="../zh-CN460905/index.html">ä¼ä¸šå®¶æœ€å°‘çš„SEOçŸ¥è¯†</a></li>
<li><a href="../zh-CN460909/index.html">2050å¹´æˆ‘ä»¬ä¼šåƒä»€ä¹ˆ</a></li>
<li><a href="../zh-CN460911/index.html">åšå–„äº‹ï¼Œåšåäº‹ï¼šç”¨Goç¼–å†™é‚ªæ¶ä»£ç ï¼Œç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN460913/index.html">å¥¥å¸ƒå®æ–¯å…‹ç‰©ç†ä¸èƒ½æºç ”ç©¶æ‰€åšç‰©é¦†å›¾ç‰‡å±•</a></li>
<li><a href="../zh-CN460915/index.html">ä¾¿æ·çš„æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ</a></li>
<li><a href="../zh-CN460923/index.html">Yandexæµ‹è¯•ä»»åŠ¡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>