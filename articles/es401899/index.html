<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëì üë®üèΩ‚Äçüíª üçÑ Registrador de bricolaje multifuncional. Parte 1 üßóüèæ üë®‚Äçüë®‚Äçüë¶‚Äçüë¶ ‚ùóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Soy propietario de un dispositivo maravilloso: el registrador GPS Holux M-241. La cosa es muy conveniente y √∫til cuando se viaja. Con la ayuda de un r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Registrador de bricolaje multifuncional. Parte 1</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/401899/"><img src="https://habrastorage.org/getpro/geektimes/post_images/65a/f4c/1c8/65af4c1c8bd4dd394b6a6d2939c6d211.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Soy propietario de un dispositivo maravilloso: el registrador GPS Holux M-241. La cosa es muy conveniente y √∫til cuando se viaja. Con la ayuda de un registrador, escribo una ruta GPS de un viaje, a lo largo de la cual puedes ver tu camino en detalle, y tambi√©n adjunto las fotos que tomas a las coordenadas GPS. Tambi√©n tiene una peque√±a pantalla que muestra informaci√≥n adicional: horas, velocidad actual, altitud y direcci√≥n, od√≥metro y mucho m√°s. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> una vez escrib√≠ una breve rese√±a.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con todas las ventajas de una pieza de hierro, comenc√© a salir de ella. </font><font style="vertical-align: inherit;">Echo de menos algunas cosas peque√±as pero √∫tiles: algunos od√≥metros, que muestran la velocidad vertical, que miden los par√°metros de una secci√≥n de pista. </font><font style="vertical-align: inherit;">Parecen cosas peque√±as, pero la compa√±√≠a Holux encontr√≥ que esto no es lo suficientemente √∫til para la implementaci√≥n en el firmware. </font><font style="vertical-align: inherit;">Adem√°s, no me gustan algunos par√°metros del hardware, y algunas cosas se han quedado obsoletas durante 10 a√±os ... </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En alg√∫n momento me di cuenta de que yo mismo podr√≠a hacer un registrador con las funciones que necesito. </font><font style="vertical-align: inherit;">Afortunadamente, todos los componentes necesarios son bastante baratos y asequibles. </font><font style="vertical-align: inherit;">Comenc√© a hacer mi implementaci√≥n basada en Arduino. </font><font style="vertical-align: inherit;">Debajo del corte, un diario de construcci√≥n donde intent√© pintar mis soluciones t√©cnicas.</font></font><br>
<a name="habracut"></a><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Definiendo caracter√≠sticas</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Muchos se preguntar√°n por qu√© necesito construir mi propio registrador, si es seguro que hay algo listo para fabricantes eminentes. </font><font style="vertical-align: inherit;">Posiblemente </font><font style="vertical-align: inherit;">Para ser honesto, realmente no lo busqu√©. </font><font style="vertical-align: inherit;">Pero seguro que faltar√° algo. </font><font style="vertical-align: inherit;">En cualquier caso, este proyecto es un fan para m√≠. </font><font style="vertical-align: inherit;">¬øPor qu√© no comenzamos a construir el dispositivo de nuestros sue√±os? </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, por lo que aprecio mi Holux M-241.</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La pantalla</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> hace una "caja negra", cuyos resultados est√°n disponibles solo despu√©s del viaje, una herramienta muy conveniente, cuyas lecturas est√°n disponibles aqu√≠ y ahora. </font><font style="vertical-align: inherit;">Tener una pantalla hace posible casi todas las funciones de esta lista.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un reloj</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> es √∫til en s√≠ mismo. </font><font style="vertical-align: inherit;">En los viajes con GPS, el registrador que cuelga de una cuerda alrededor de su cuello a menudo resulta estar m√°s cerca que un tel√©fono celular en su bolsillo o en una mochila. </font><font style="vertical-align: inherit;">El reloj admite todas las zonas horarias (aunque con cambio manual)</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El bot√≥n POI le</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> permite marcar la coordenada actual en la pista. </font><font style="vertical-align: inherit;">Por ejemplo, para notar un punto de referencia que se ha deslizado fuera de la ventana del autob√∫s, sobre el que quiero buscar en Google m√°s tarde.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Con el </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">od√≥metro,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> puede medir la distancia recorrida desde alg√∫n punto. </font><font style="vertical-align: inherit;">Por ejemplo, la distancia recorrida por d√≠a o la longitud de una pista.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La velocidad, altitud y direcci√≥n actuales lo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ayudan a encontrarse en el espacio</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La capacidad de supervivencia de 12-14 horas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> con una bater√≠a AA en la mayor√≠a de los casos le permite no pensar en problemas de suministro de energ√≠a. </font><font style="vertical-align: inherit;">Es decir </font><font style="vertical-align: inherit;">casi siempre carga suficiente para un d√≠a completo de viaje.</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compacto y f√°cil de usar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : las cosas en el mundo moderno son muy agradables</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sin embargo, algunas cosas podr√≠an hacerse un poco mejor:</font></font><br>
<br>
<ul>
<li>   <b> </b>      ‚Äî    ,       .       . <br>
<br>
        .            (   5      ).     .       .   ,      .        ,    .<br>
<br>
 6            .             .          .         .<br>
<br>
</li>
<li><b>  </b>    ‚Äî        .     5   ,     .         .<br>
<br>
</li>
<li>          <b>  </b>.<br>
<br>
</li>
<li><b> </b> ‚Äî       .         .<br>
<br>
</li>
<li>        .   .     ,  GPS      .            .          <b></b>  <b> </b>  .<br>
<br>
</li>
<li><b>  </b>.    , ,   ,  ,      ,  .       ,   ,   .<br>
<br>
</li>
<li><b></b>   .    ‚Äî  .         ‚Äú‚Äù +- 50.      ‚Äú‚Äù  .    10           . <br>
<br>
</li>
<li><b> </b>   38400. ,     2017  COM      .  2      20 .<br>
<br>
          .    .   BT747,            .<br>
<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El tama√±o de la unidad flash es de</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> solo 2 MB. </font><font style="vertical-align: inherit;">Por un lado, esto es suficiente para un viaje de dos semanas con puntos de ahorro cada 5 segundos. </font><font style="vertical-align: inherit;">Pero, en primer lugar, el formato empaquetado interno </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
requiere conversi√≥n y, en segundo lugar, no permite aumentar el volumen</font></font></li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El dispositivo de almacenamiento masivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> por alguna raz√≥n ahora no est√° de moda. </font><font style="vertical-align: inherit;">Las interfaces modernas intentan ocultar el hecho de la presencia de archivos. </font><font style="vertical-align: inherit;">He estado con computadoras durante 25 a√±os, y trabajar con archivos directamente es mucho m√°s conveniente para m√≠ que de ninguna otra manera.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No hay nada aqu√≠ que no pueda realizarse sin esfuerzos significativos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Algo diferente </font><font style="vertical-align: inherit;">No lo uso yo mismo, pero de repente alguien es √∫til:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Muestra las coordenadas actuales (latitud, longitud)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se dibujan diferentes iconos en el lado izquierdo de la pantalla, cuya esencia ni siquiera puedo recordar sin un manual. </font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay cambio de metros / km - pies / millas.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluetooth: el registrador se puede conectar a tel√©fonos m√≥viles sin GPS.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La distancia absoluta al punto.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registro por tiempo (cada N segundos) o por distancia (cada X metros).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Soporte para diferentes idiomas.</font></font></li>
</ul><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Elegir hierro</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los requisitos est√°n m√°s o menos definidos. </font><font style="vertical-align: inherit;">Es hora de entender c√≥mo se puede implementar todo esto. </font><font style="vertical-align: inherit;">Los componentes principales que tendr√© son:</font></font><br>
<br>
<ul>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microcontrolador</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : no tengo planes para ning√∫n algoritmo computacional sofisticado, por lo que la potencia de procesamiento del n√∫cleo no es particularmente importante. </font><font style="vertical-align: inherit;">Tampoco tengo requisitos especiales para el llenado; un conjunto de perif√©ricos est√°ndar funcionar√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A la mano solo hab√≠a una dispersi√≥n de arduinoes diversos, as√≠ como un par de stm32f103c8t6. </font><font style="vertical-align: inherit;">Decid√≠ comenzar con AVR, que conozco bien a nivel de controlador / registros / perif√©ricos. </font><font style="vertical-align: inherit;">Si me encuentro con restricciones, habr√° una raz√≥n para sentir el STM32.</font></font><br>
<br>
</li>
<li><b>GPS </b>    NEO6MV2, Beitan BN-800  Beitan BN-880.     .   ,    ‚Äî    .          ‚Äî  BN-800    ,   BN-880     .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BN-880</a>.<br>
<br>
</li>
<li><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pantalla</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : el original utiliza una pantalla LCD de 128 x 32 con luz de fondo. </font><font style="vertical-align: inherit;">No encontr√© exactamente lo mismo. </font><font style="vertical-align: inherit;">Compr√© un </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OLED de 0.91 "en el controlador SSD1306</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> y una </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pantalla LCD de 1.2" en el controlador ST7565R</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Decid√≠ comenzar desde el principio, porque </font><font style="vertical-align: inherit;">Es m√°s f√°cil conectarse con un peine est√°ndar seg√∫n I2C o SPI. </font><font style="vertical-align: inherit;">Pero es un poco m√°s peque√±o en comparaci√≥n con el original, y tampoco funcionar√° en √©l para mostrar constantemente la imagen por razones de eficiencia de combustible. </font><font style="vertical-align: inherit;">La segunda pantalla debe ser menos glotona, pero debe soldar un conector complicado y descubrir c√≥mo alimentar la luz de fondo.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De las peque√±as cosas:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Botones una vez compr√≥ una bolsa entera;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Escudo con tarjeta SD - tambi√©n a la mano;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compr√© un par de controladores de carga diferentes para bater√≠as de litio, pero todav√≠a no lo entend√≠a.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decid√≠ dise√±ar la placa al final, cuando el firmware est√° listo. </font><font style="vertical-align: inherit;">En este momento, finalmente decidir√© sobre los componentes principales y el esquema para su inclusi√≥n. </font><font style="vertical-align: inherit;">En la primera etapa, decid√≠ depurar en el tablero conectando los componentes mediante cables de conexi√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero primero debe decidir sobre un tema muy importante: la nutrici√≥n de los componentes. </font><font style="vertical-align: inherit;">Me pareci√≥ razonable alimentar todo desde 3.3V: el GPS y la pantalla solo en √©l y saber c√≥mo funcionar. </font><font style="vertical-align: inherit;">Este es tambi√©n el voltaje nativo para USB y SD. </font><font style="vertical-align: inherit;">Adem√°s, el circuito puede alimentarse con una lata de litio. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La elecci√≥n recay√≥ en el Arduino Pro Mini, que se puede encontrar en la versi√≥n 8MHz / 3.3V. </font><font style="vertical-align: inherit;">Pero ella no ten√≠a USB a bordo: tuve que usar un adaptador USB-UART.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Primeros pasos</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, el proyecto fue creado en Arduino IDE. Pero para ser sincero, mi idioma no se atreve a llamarlo IDE, como un editor de texto con un compilador. En cualquier caso, despu√©s de Visual Studio, en el que he estado trabajando durante los √∫ltimos 13 a√±os, no puedo hacer nada serio en Arduino IDE sin l√°grimas y matyuk. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, hay un Atmel Studio gratuito, en el que incluso Visual Assist est√° integrado de f√°brica. El programa sabe todo lo que se necesita, todo es familiar y est√° en su lugar. Bueno, casi todo (no encontr√© c√≥mo compilar solo un archivo, por ejemplo, para verificar la sintaxis) </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/bfc/b08/98f/bfcb0898f136628896be3b6769eda34f.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
comenc√© desde la pantalla; esto es necesario para depurar el esqueleto del firmware y luego llenarlo de funcionalidad. Se detuvo en la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">primera biblioteca disponible para Adafruit SSD1306</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ella sabe todo lo que se necesita y proporciona una interfaz muy simple.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jugado con fuentes. </font><font style="vertical-align: inherit;">Result√≥ que una fuente puede tomar hasta 8kb (el tama√±o de las letras es de 24pt) - no se puede andar especialmente en un controlador de 32kb. </font><font style="vertical-align: inherit;">Se necesitan fuentes grandes, por ejemplo, para mostrar el tiempo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de muestra de fuente</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Adafruit_GFX.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Adafruit_SSD1306.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;gfxfont.h&gt;</span></span></span></span><font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;fonts/FreeMono12pt7b.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;fonts/FreeMono18pt7b.h&gt;</span></span></span></span><font></font>
...<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;fonts/FreeSerifItalic24pt7b.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;fonts/FreeSerifItalic9pt7b.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;fonts/TomThumb.h&gt;</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">font_and_name</span></span></span><span class="hljs-class">
{</span></span>
	<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * PROGMEM name;<font></font>
	GFXfont * font;<font></font>
};<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> FONT(name) {#name, &amp;name}</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> font_and_name fonts[] = {
<span class="hljs-comment"><span class="hljs-comment">//	FONT(FreeMono12pt7b),</span></span><font></font>
	FONT(FreeMono18pt7b),<font></font>
	<span class="hljs-comment"><span class="hljs-comment">/*
	FONT(FreeMono24pt7b),
	FONT(FreeMono9pt7b),
	FONT(FreeMonoBold12pt7b),
	...
	FONT(FreeSerifItalic9pt7b),
	FONT(TomThumb)*/</span></span><font></font>
};<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fonts_count = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(fonts) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(font_and_name);
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> current_font = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> Adafruit_SSD1306 display;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunFontTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{<font></font>
	display.clearDisplay();<font></font>
	display.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>);<font></font>
	display.setFont(fonts[current_font].font);<font></font>
	display.print(<span class="hljs-string"><span class="hljs-string">"12:34:56"</span></span>);<font></font>
	display.setCursor(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>);<font></font>
	display.setFont(&amp;TomThumb);<font></font>
	display.print(fonts[current_font].name);<font></font>
	display.display();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SwitchToNextFont</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{<font></font>
	current_font = ++current_font % fonts_count;<font></font>
}</code></pre><br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las fuentes completas con la biblioteca son muy torpes. </font><font style="vertical-align: inherit;">La fuente monoespacio result√≥ ser muy ancha: la l√≠nea "12:34:56" no encaja, Serif: todos los n√∫meros son de diferentes pesos. </font><font style="vertical-align: inherit;">A menos que la fuente est√°ndar de 5x7 en la biblioteca se vea comestible. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/b7a/67f/676/b7a67f676d061bdb4920985b0c46692a.jpg" alt="imagen"><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/9de/e19/69f/9dee1969f16ad50138756b9dab906d4d.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que estas fuentes se convirtieron de algunas fuentes ttf de c√≥digo abierto que simplemente no est√°n optimizadas para peque√±as resoluciones.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tuve que dibujar mis fuentes. </font><font style="vertical-align: inherit;">M√°s precisamente, primero, desenterrar s√≠mbolos individuales de los terminados. </font><font style="vertical-align: inherit;">El s√≠mbolo ':' en la tabla ASCII es muy √∫til justo despu√©s de los n√∫meros y se puede comprar en un bloque. </font><font style="vertical-align: inherit;">Tambi√©n es conveniente que pueda hacer una fuente no para todos los caracteres, sino solo para un rango, por ejemplo, de 0x30 ('0') a 0x3a (':'). </font><font style="vertical-align: inherit;">T.O. </font><font style="vertical-align: inherit;">de FreeSans18pt7b result√≥ ser una fuente muy compacta solo para los caracteres necesarios. </font><font style="vertical-align: inherit;">Es cierto que tuve que ajustar ligeramente el ancho para que el texto se ajuste al ancho de la pantalla.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sub-Font FreeSans18pt7b</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// This font consists only of digits and ':' to display current time.</span></span>
<span class="hljs-comment"><span class="hljs-comment">// The font is very based on FreeSans18pt7b.h</span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> 25 pixel height is too much for displaying time. Create another 22px font</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> TimeFontBitmaps[] PROGMEM = {
	<span class="hljs-comment"><span class="hljs-comment">/*
	0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xE9, 0x20, 0x3F, 0xFC, 0xE3, 0xF1,
	0xF8, 0xFC, 0x7E, 0x3F, 0x1F, 0x8E, 0x82, 0x41, 0x00, 0x01, 0xC3, 0x80,
...
	0x03, 0x00, 0xC0, 0x60, 0x18, 0x06, 0x03, 0x00, 0xC0, 0x30, 0x18, 0x06,
	0x01, 0x80, 0xC0, 0x30, 0x00, */</span></span><span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x7C</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xFE</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x87</span></span>, <span class="hljs-number"><span class="hljs-number">0x83</span></span>, <span class="hljs-number"><span class="hljs-number">0xC3</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0xF3</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x39</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x7F</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFE</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x73</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0xB8</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x8F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xC7</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x39</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFE</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x8F</span></span>, <span class="hljs-number"><span class="hljs-number">0x83</span></span>, <span class="hljs-number"><span class="hljs-number">0xE7</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xEF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x73</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xE3</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0xEF</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0C</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFE</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x87</span></span>, <span class="hljs-number"><span class="hljs-number">0x83</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xC7</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0xF3</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x39</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xE3</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0xF9</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x1D</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xF7</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x73</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x7C</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF7</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xC7</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>,
	<span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>,
	<span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-comment"><span class="hljs-comment">/*, 0xFF, 0xF0, 0x00, 0x00,
	0x00, 0x07, 0xFF, 0xB6, 0xD6, 0x00, 0x00, 0x80, 0x03, 0xC0, 0x07, 0xE0,
	0x0F, 0xC0, 0x3F, 0x80, 0x7E, 0x00, 0xFC, 0x01, 0xF0, 0x00, 0xE0, 0x00,
...
	0x38, 0x38, 0xF8, 0xF0, 0xE0, 0x38, 0x00, 0xFC, 0x03, 0xFC, 0x1F, 0x3E,
	0x3C, 0x1F, 0xE0, 0x1F, 0x80, 0x1E, 0x00
	*/</span></span><font></font>
};<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//TODO Recalc offset numbers</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GFXglyph TimeFontGlyphs[] PROGMEM =<font></font>
{<font></font>
	{   <span class="hljs-number"><span class="hljs-number">449</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">2</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x30 '0'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">499</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">4</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x31 '1'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">524</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">2</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x32 '2'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">574</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">17</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">1</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x33 '3'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">628</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">1</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x34 '4'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">678</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">17</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">1</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x35 '5'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">732</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">2</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x36 '6'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">782</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">2</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x37 '7'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">832</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">17</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">1</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x38 '8'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">886</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,  <span class="hljs-number"><span class="hljs-number">16</span></span>,  <span class="hljs-number"><span class="hljs-number">25</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,    <span class="hljs-number"><span class="hljs-number">1</span></span>,  <span class="hljs-number"><span class="hljs-number">-24</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x39 '9'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">936</span></span><span class="hljs-number"><span class="hljs-number">-449</span></span>,   <span class="hljs-number"><span class="hljs-number">3</span></span>,  <span class="hljs-number"><span class="hljs-number">19</span></span>,   <span class="hljs-number"><span class="hljs-number">7</span></span>,    <span class="hljs-number"><span class="hljs-number">2</span></span>,  <span class="hljs-number"><span class="hljs-number">-20</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x3A ':'</span></span><font></font>
};<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GFXfont TimeFont PROGMEM = {<font></font>
	(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>  *)TimeFontBitmaps,<font></font>
	(GFXglyph *)TimeFontGlyphs,<font></font>
<span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0x3A</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span> };</code></pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que la fuente de 18 puntos tiene en realidad 25 p√≠xeles de alto. Debido a esto, cabe ligeramente en otra inscripci√≥n. La </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/543/aee/2e5/543aee2e5c6515307a4c969a3bfff374.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
pantalla invertida, por cierto, ayuda a comprender d√≥nde est√°n realmente los bordes del √°rea de dibujo y c√≥mo se encuentra la l√≠nea en relaci√≥n con este borde: la pantalla tiene marcos muy grandes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Busqu√© en Google durante mucho tiempo las fuentes preparadas, pero no encajaban ni en tama√±o, ni en forma, ni en contenido. Por ejemplo, en Internet, un eje de fuente 8x12 (volcados de generadores de caracteres de tarjetas VGA). Pero, de hecho, estas fuentes son 6x8, es decir muchos paseos espaciales; en el caso de una resoluci√≥n y un tama√±o tan peque√±os como los m√≠os, es fundamental.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tuve que dibujar mis propias fuentes, ya que el formato de fuente de la biblioteca Adafruit es muy simple. </font><font style="vertical-align: inherit;">Prepar√© la imagen en Paint.net: simplemente dibuj√© las letras en la fuente correcta, luego las correg√≠ un poco con un l√°piz. </font><font style="vertical-align: inherit;">Guard√© la imagen como png y luego la envi√© r√°pidamente al script de Python escrito en mi rodilla. </font><font style="vertical-align: inherit;">Este script gener√≥ un c√≥digo semiacabado que ya apunta las reglas en el IDE directamente en los c√≥digos hexadecimales. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/618/78f/f7e/61878ff7eff21be033fdbc56183a4f5e.png" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por ejemplo, as√≠ es como se ve el proceso de creaci√≥n de una fuente monoespaciada 8x12 con min√∫sculas y espaciado entre l√≠neas. </font><font style="vertical-align: inherit;">Cada car√°cter al final result√≥ ser aproximadamente 7x10, y por defecto ocupaba 10 bytes. </font><font style="vertical-align: inherit;">Ser√≠a posible empaquetar cada car√°cter en 8-9 bytes (la biblioteca lo permite), pero no me molest√©. </font><font style="vertical-align: inherit;">Adem√°s, en este formulario, puede editar p√≠xeles individuales directamente en el c√≥digo.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Font 8x12</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// A simple 8x12 font (slightly modifier Courier New)</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> Monospace8x12Bitmaps[] PROGMEM = {
	<span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-comment"><span class="hljs-comment">//0</span></span>
	<span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x7f</span></span>, <span class="hljs-comment"><span class="hljs-comment">//1</span></span>
	<span class="hljs-number"><span class="hljs-number">0x3e</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x0c</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x7f</span></span>, <span class="hljs-comment"><span class="hljs-comment">//2</span></span>
	<span class="hljs-number"><span class="hljs-number">0x3e</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x0e</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x3e</span></span>, <span class="hljs-comment"><span class="hljs-comment">//3</span></span>
	<span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x0a</span></span>, <span class="hljs-number"><span class="hljs-number">0x12</span></span>, <span class="hljs-number"><span class="hljs-number">0x12</span></span>, <span class="hljs-number"><span class="hljs-number">0x22</span></span>, <span class="hljs-number"><span class="hljs-number">0x3f</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x0f</span></span>, <span class="hljs-comment"><span class="hljs-comment">//4</span></span>
	<span class="hljs-number"><span class="hljs-number">0x7f</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x7e</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x3e</span></span>, <span class="hljs-comment"><span class="hljs-comment">//5</span></span>
	<span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x5e</span></span>, <span class="hljs-number"><span class="hljs-number">0x61</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x3e</span></span>, <span class="hljs-comment"><span class="hljs-comment">//6</span></span>
	<span class="hljs-number"><span class="hljs-number">0x7f</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-comment"><span class="hljs-comment">//7</span></span>
	<span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-comment"><span class="hljs-comment">//8</span></span>
	<span class="hljs-number"><span class="hljs-number">0x1e</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0x23</span></span>, <span class="hljs-number"><span class="hljs-number">0x1d</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x22</span></span>, <span class="hljs-number"><span class="hljs-number">0x1c</span></span>, <span class="hljs-comment"><span class="hljs-comment">//9</span></span>
	<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-comment"><span class="hljs-comment">//:</span></span><font></font>
};<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GFXglyph Monospace8x12Glyphs[] PROGMEM =<font></font>
{<font></font>
	{   <span class="hljs-number"><span class="hljs-number">0</span></span>,    <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x30 '0'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">10</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x31 '1'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">20</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x32 '2'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">30</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x33 '3'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">40</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x34 '4'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">50</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x35 '5'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">60</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x36 '6'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">70</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x37 '7'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">80</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x38 '8'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">90</span></span>,   <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x39 '9'</span></span>
	{   <span class="hljs-number"><span class="hljs-number">100</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">10</span></span>,  <span class="hljs-number"><span class="hljs-number">8</span></span>,  <span class="hljs-number"><span class="hljs-number">0</span></span>,  <span class="hljs-number"><span class="hljs-number">-11</span></span> },   <span class="hljs-comment"><span class="hljs-comment">// 0x3A ':'</span></span><font></font>
};<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GFXfont Monospace8x12Font PROGMEM = {<font></font>
	(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>  *)Monospace8x12Bitmaps,<font></font>
	(GFXglyph *)Monospace8x12Glyphs,<font></font>
<span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0x3A</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span> };
</code></pre><br>
</div></div><br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Marco</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El dispositivo original proporciona una interfaz muy simple y conveniente. La informaci√≥n se agrupa en categor√≠as que se muestran desde p√°ginas individuales (pantallas). Con el bot√≥n, puede recorrer las p√°ginas y usar el segundo bot√≥n para seleccionar el elemento actual o realizar la acci√≥n indicada en la firma debajo del bot√≥n. Este enfoque me parece muy conveniente y no hay necesidad de cambiar nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me gusta la belleza de OOP, porque inmediatamente deslumbr√© una peque√±a interfaz, cada p√°gina implementa la interfaz como lo requiere. La p√°gina sabe c√≥mo dibujarse e implementa la reacci√≥n a los botones.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class">
{</span></span><font></font>
	Screen * nextScreen;<font></font>
	<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:<font></font>
	Screen();<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Screen() {}<font></font>
<font></font>
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>;
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSelButton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOkButton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> PROGMEM </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSelButtonText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;
	<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> PROGMEM </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOkButtonText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;<font></font>
	<font></font>
	<span class="hljs-function"><span class="hljs-function">Screen * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Screen * screen)</span></span></span></span>;<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los botones pueden realizar varias acciones seg√∫n la pantalla actual. Por lo tanto, la parte superior de la pantalla con una altura de 8 p√≠xeles, asign√© a las etiquetas de los botones. El texto para las firmas depende de la pantalla actual y lo devuelven las funciones virtuales getSelButtonText () y getOkButtonText (). Tambi√©n en el encabezado se mostrar√°n elementos como la intensidad de la se√±al GPS y la carga de la bater√≠a. Las pantallas ¬æ restantes est√°n disponibles para obtener informaci√≥n √∫til. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como dije, las pantallas se pueden voltear, lo que significa que en alg√∫n lugar debe haber una lista de objetos para diferentes p√°ginas. En qu√© m√°s de uno: las pantallas se pueden anidar, como un submen√∫. Incluso comenc√© la clase ScreenManager, que supuestamente administraba estas listas, pero luego encontr√© la soluci√≥n m√°s f√°cil.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces cada pantalla simplemente tiene un puntero a la siguiente. </font><font style="vertical-align: inherit;">Si la pantalla le permite ingresar al submen√∫, entonces agrega un puntero m√°s a la pantalla de este submen√∫</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class">
{</span></span><font></font>
	Screen * nextScreen;<font></font>
‚Ä¶<font></font>
};<font></font>
<font></font>
<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ParentScreen</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Screen<font></font>
{<font></font>
	Screen * childScreen;<font></font>
‚Ä¶<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por defecto, el controlador de botones simplemente llama a la funci√≥n de cambio de pantalla, pas√°ndole el puntero deseado. </font><font style="vertical-align: inherit;">La funci√≥n result√≥ ser trivial: simplemente cambi√≥ el puntero a la pantalla actual. </font><font style="vertical-align: inherit;">Para asegurar el anidamiento de las pantallas, hice una peque√±a pila. </font><font style="vertical-align: inherit;">Entonces, el administrador de pantalla completo cabe en 25 l√≠neas y 4 funciones peque√±as.</font></font><br>
<br>
<pre><code class="cpp hljs">Screen * screenStack[<span class="hljs-number"><span class="hljs-number">3</span></span>];
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> screenIdx = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCurrentScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Screen * screen)</span></span></span><span class="hljs-function">
</span></span>{<font></font>
	screenStack[screenIdx] = screen;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">Screen * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCurrentScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
	<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> screenStack[screenIdx];<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enterChildScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Screen * screen)</span></span></span><span class="hljs-function">
</span></span>{<font></font>
	screenIdx++; <span class="hljs-comment"><span class="hljs-comment">//TODO limit this</span></span><font></font>
	screenStack[screenIdx] = screen;<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backToParentScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(screenIdx)<font></font>
		screenIdx--;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es cierto que el c√≥digo para llenar estas estructuras no se ve muy bien, pero hasta ahora no se ha inventado mejor.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Screen * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCurrentTimeScreen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{<font></font>
	TimeZoneScreen * tzScreen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeZoneScreen(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>);<font></font>
	tzScreen = tzScreen-&gt;addScreen(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeZoneScreen(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">45</span></span>));<font></font>
	tzScreen = tzScreen-&gt;addScreen(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TimeZoneScreen(<span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>));
	<span class="hljs-comment"><span class="hljs-comment">// TODO Add real timezones here</span></span><font></font>
	<font></font>
	CurrentTimeScreen * screen = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CurrentTimeScreen();<font></font>
	screen-&gt;addChildScreen(tzScreen);<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> screen;<font></font>
}</code></pre><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El pensamiento</font></font></b><div class="spoiler_text"> , ,  ,     .           .<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adelante En mi implementaci√≥n de la interfaz, quer√≠a hacer algo como un cuadro de mensaje, un mensaje corto que aparecer√≠a por un segundo o dos, y luego desaparecer√≠a. Por ejemplo, si presiona el bot√≥n POI (Punto de inter√©s) en la pantalla con las coordenadas actuales, adem√°s de escribir el punto en la pista, ser√≠a bueno mostrarle al usuario el mensaje "Waypoint guardado" (en el dispositivo original, solo se muestra un icono adicional por un segundo). O, cuando la bater√≠a est√° baja, "animar" al usuario con un mensaje. </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/aa5/dec/17b/aa5dec17b1b4b298b764fce33b8441db.jpg" alt="imagen"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dado que los datos del GPS llegar√°n constantemente, no se puede hablar de ninguna funci√≥n de bloqueo. Por lo tanto, tuve que inventar una m√°quina de estado simple (m√°quina de estado), que en la funci√≥n loop () elegir√≠a qu√© hacer: mostrar la pantalla actual o el cuadro de mensaje.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> State<font></font>
{<font></font>
	IDLE_DISPLAY_OFF,<font></font>
	IDLE,<font></font>
	MESSAGE_BOX,<font></font>
	BUTTON_PRESSED,<font></font>
};</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n es conveniente manejar las pulsaciones de botones usando la m√°quina de estado. Quiz√°s ser√≠a correcto a trav√©s de interrupciones, pero tambi√©n result√≥ bien. Funciona as√≠: si se presion√≥ un bot√≥n en el estado IDLE, recuerde la hora en que se presion√≥ y vaya al estado BUTTON_PRESSED. En este estado, esperamos hasta que el usuario suelte el bot√≥n. Aqu√≠ podemos calcular la duraci√≥n cuando se presion√≥ el bot√≥n. Las respuestas cortas (&lt;30 ms) simplemente se ignoran; lo m√°s probable es que se trate de un rebote de contactos. Los viajes largos ya se pueden interpretar como presionar un bot√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Planeo usar ambas pulsaciones cortas de botones para acciones ordinarias y largas (&gt; 1c) para funciones especiales. Por ejemplo, una presi√≥n breve inicia / pausa el od√≥metro, una presi√≥n larga restablece el contador a 0.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiz√°s se agregar√°n otros estados. </font><font style="vertical-align: inherit;">Entonces, por ejemplo, en el registrador original despu√©s de cambiar a la p√°gina siguiente, los valores en la pantalla cambian con frecuencia, y con menos frecuencia despu√©s de un par de segundos, una vez por segundo. </font><font style="vertical-align: inherit;">Esto se puede hacer agregando otro estado. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cuando el marco estuvo listo, ya comenc√© a conectar el GPS. </font><font style="vertical-align: inherit;">Pero aqu√≠ hubo matices que me hicieron posponer esta tarea.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Optimizaci√≥n de firmware</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Antes de continuar, necesito distraerme con algunos detalles t√©cnicos. </font><font style="vertical-align: inherit;">El hecho es que en este lugar comenc√© a toparme con el aumento del consumo de memoria. </font><font style="vertical-align: inherit;">Result√≥ que la l√≠nea declarada imprudentemente sin el modificador PROGMEM al comienzo del firmware se copia en la RAM y ocupa espacio all√≠ durante todo el tiempo de ejecuci√≥n.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Varias arquitecturas</font></font></b><div class="spoiler_text">  .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  </a>         . ..            .<br>
<br>
 ,  ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>,     . ..         .     C/C++   ,                    . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Afortunadamente, los desarrolladores de bibliotecas ya se han ocupado en parte de esto. La clase principal de la biblioteca de visualizaci√≥n: Adafruit_SSD1306 se hereda de la clase Print de la biblioteca est√°ndar de Arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto nos proporciona una serie completa de modificaciones diferentes del m√©todo de impresi√≥n: para imprimir cadenas, caracteres individuales, n√∫meros y algo m√°s. Por lo tanto, tiene 2 funciones separadas para imprimir l√≠neas:</font></font><br>
<br>
<pre><code class="cpp hljs">
    <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> print(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> __FlashStringHelper *);
    <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> print(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[]);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El primero sabe que necesita imprimir una l√≠nea desde una unidad flash y la carga car√°cter por car√°cter. </font><font style="vertical-align: inherit;">El segundo imprime caracteres de la RAM. </font><font style="vertical-align: inherit;">De hecho, ambas funciones llevan un puntero a una cadena, solo desde diferentes espacios de direcciones. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante mucho tiempo busqu√© en el c√≥digo arduino este __FlashStringHelper para aprender c√≥mo llamar a la funci√≥n print () deseada. </font><font style="vertical-align: inherit;">Result√≥ que los chicos hicieron el truco: simplemente declararon este tipo con la declaraci√≥n directa (sin declarar el tipo en s√≠) y escribieron una macro que arrojaba punteros a l√≠neas en un instante al tipo __FlashStringHelper. </font><font style="vertical-align: inherit;">Solo para que el compilador seleccione la funci√≥n sobrecargada necesaria</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> __</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlashStringHelper</span></span></span><span class="hljs-class">;</span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> F(string_literal) (reinterpret_cast</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;const __FlashStringHelper *&gt;(PSTR(string_literal)))</span></span></span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esto te permite escribir as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs">display.print(F(‚ÄúString in flash memory‚Äù));</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no permite escribir como</font></font><br>
<pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> text[] PROGMEM = <span class="hljs-string"><span class="hljs-string">"String in flash memory"</span></span>; <font></font>
display.print(F(text));</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y, aparentemente, la biblioteca no proporciona nada que pueda hacerse de esa manera. </font><font style="vertical-align: inherit;">S√© que no es bueno usar piezas de biblioteca privada en mi c√≥digo, pero ¬øqu√© debo hacer? </font><font style="vertical-align: inherit;">Dibuj√© mi macro, que hizo lo que necesitaba.</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> USE_PGM_STRING(x) reinterpret_cast</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;const __FlashStringHelper *&gt;(x)</span></span></span></span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces la funci√≥n de dibujo del sombrero comenz√≥ a verse as√≠:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Screen::drawHeader()<font></font>
{<font></font>
	display.setFont(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);<font></font>
	display.setCursor(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
	display.print(<span class="hljs-string"><span class="hljs-string">'\x1e'</span></span>);<font></font>
	display.print(USE_PGM_STRING(getSelButtonText()));<font></font>
	<font></font>
	display.setCursor(<span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
	display.print(<span class="hljs-string"><span class="hljs-string">'\x1e'</span></span>);<font></font>
	display.print(USE_PGM_STRING(getOkButtonText()));<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bueno, desde que me met√≠ en las piezas de bajo nivel del firmware, decid√≠ estudiar m√°s a fondo c√≥mo funciona todo dentro. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En general, los chicos que inventaron Arduino necesitan erigir un monumento. Crearon una plataforma simple y conveniente para la creaci√≥n de prototipos y manualidades. Una gran cantidad de personas con un conocimiento m√≠nimo de electr√≥nica y programaci√≥n pudieron ingresar al mundo de Arduino. Pero todo esto es suave y hermoso al hacer basura, como luces intermitentes con LED o leer el term√≥metro. Tan pronto como te balancees en algo serio, inmediatamente tienes que entender m√°s profundo de lo que quer√≠as desde el principio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces, despu√©s de cada biblioteca o clase agregada, not√© cu√°n r√°pido est√° creciendo el consumo de memoria. En este punto, estaba ocupado con m√°s de 14 KB de 32 KB de flash y 1300 bytes de RAM (de 2k). Cada movimiento descuidado agreg√≥ otro 10 por ciento al ya usado. Pero todav√≠a no he conectado realmente las bibliotecas GPS y SD / FAT32, y el gato estaba llorando. Tuve que recoger el </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">comprobador de</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> desensamblador y estudiar lo que hizo el compilador.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Secretamente esperaba que el enlazador eliminara las funciones no utilizadas. </font><font style="vertical-align: inherit;">Pero result√≥ que algunos de ellos el enlazador se inserta casi por completo. </font><font style="vertical-align: inherit;">En el firmware, encontr√© las funciones de dibujo lineal y algunas otras de la biblioteca para trabajar con la pantalla, aunque en el c√≥digo obviamente no las llam√© en ese momento. </font><font style="vertical-align: inherit;">Impl√≠citamente, tampoco deber√≠an llamarse: ¬øpor qu√© necesito una funci√≥n de dibujo lineal si solo dibujo letras de mapas de bits? </font><font style="vertical-align: inherit;">M√°s de 5.2kb de la nada (y eso sin contar las fuentes). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de la biblioteca de control de visualizaci√≥n, tambi√©n encontr√©:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.6 kb - en SoftwareSerial (en alg√∫n momento lo inclu√≠ en el proyecto)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.6 kb - I2C</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.3 kb - Serie de hardware</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 kb - TinyGPS</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.5 kb en el arduino real (inicializaci√≥n, pines, todo tipo de tablas, el temporizador principal para las funciones millis () y delay ()), </font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Los n√∫meros son muy indicativos, ya que </font><font style="vertical-align: inherit;">El optimizador est√° mezclando seriamente el c√≥digo. </font><font style="vertical-align: inherit;">Algunas funciones pueden comenzar en un lugar, y luego otra de otra biblioteca, que se llama desde la primera, puede seguirla de inmediato. </font><font style="vertical-align: inherit;">Adem√°s, se pueden ubicar ramas separadas de estas funciones en el otro extremo del flash. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n en el c√≥digo que encontr√©:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control de pantalla por SPI (aunque lo tengo conectado a trav√©s de I2C)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todos de clases base que a ellos mismos no se les llama, porque </font><font style="vertical-align: inherit;">redefinido en los herederos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Destructores que nunca son llamados por dise√±o</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funciones de dibujo (y no todas: parte de las funciones que el enlazador a√∫n lanz√≥)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc / free, mientras que en mi c√≥digo todos los objetos son esencialmente est√°ticos</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero no solo el consumo de memoria flash, sino tambi√©n SRAM est√° creciendo a pasos agigantados:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">130 bytes - I2C</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 bytes - SoftwareSerial</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">157 bytes - Serie</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">558 bytes - Pantalla (de los cuales 512 es el b√∫fer de trama)</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No menos entretenida fue la secci√≥n .data. </font><font style="vertical-align: inherit;">Hay alrededor de 700 bytes y esta cosa se carga desde un flash en la RAM al principio. </font><font style="vertical-align: inherit;">Result√≥ que hay lugares reservados para las variables en la memoria, y junto con los valores de inicializaci√≥n. </font><font style="vertical-align: inherit;">Aqu√≠ viven las variables y constantes que olvid√≥ declarar como const PROGMEM. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entre esto hab√≠a una gran matriz con una "pantalla de bienvenida" de la pantalla: los valores iniciales del b√∫fer de trama. </font><font style="vertical-align: inherit;">Te√≥ricamente, si realiza la pantalla () inmediatamente despu√©s del inicio, puede ver la flor y la inscripci√≥n Adafruit, pero en mi caso no tiene sentido gastar memoria flash en esto.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La secci√≥n .data tambi√©n contiene vtables. Se copian en la memoria desde una unidad flash, aparentemente por razones de eficiencia en tiempo de ejecuci√≥n. Pero tiene que sacrificar una porci√≥n de RAM bastante grande: m√°s de una docena de clases de m√°s de 150 bytes. Adem√°s, parece que no hay una clave del compilador que, sacrificando el rendimiento, deje las tablas virtuales en la memoria flash. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
¬øQu√© hacer al respecto? A√∫n no lo s√© Depender√° de c√≥mo el consumo continuar√° creciendo. Para que las jambas se encuentren bien deben repararse sin piedad. Con toda probabilidad, tendr√© que dibujar todas las bibliotecas en mi proyecto expl√≠citamente y luego cubrirlas a fondo. Y es posible que tambi√©n deba volver a escribir algunas de las piezas de manera diferente para optimizar la memoria. O cambie a un hardware m√°s potente. En cualquier caso, ahora s√© sobre el problema y hay una estrategia sobre c√≥mo solucionarlo. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACTUALIZACI√ìN</font></font></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Poco progreso en eficiencia de recursos. Estoy haciendo una actualizaci√≥n de esta parte, porque en la pr√≥xima quiero centrarme en cosas completamente diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En los comentarios hay cierto desconcierto sobre el uso de C ++. En particular, ¬øpor qu√© es tan malo y mantiene vtable en la preciosa RAM? En general, las funciones virtuales, los constructores y los destructores son gastos generales. Por qu√© ¬°Vamos a resolverlo! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqu√≠ est√°n las estad√≠sticas sobre la memoria en alguna etapa del proyecto </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
: Tama√±o del programa: 15 458 bytes (utilizado el 50% de un m√°ximo de 30 720 bytes) (2.45 segundos) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uso m√≠nimo de memoria: 1258 bytes (61% de un m√°ximo de 2048 bytes) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Experimento No. 1 - reescribir a C.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Lanc√© clases, reescrib√≠ todo en tablas con punteros a funciones. Como las pantallas siempre tienen la misma estructura, todos los miembros de datos se han convertido en variables globales ordinarias. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estad√≠sticas despu√©s de refactorizar </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tama√±o del programa: 14 568 bytes (utilizado el 47% de un m√°ximo de 30 720 bytes) (2,35 segundos) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uso m√≠nimo de memoria: 1176 bytes (57% de un m√°ximo de 2048 bytes) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Total. Gan√≥ 900 bytes de flash y 80 bytes de RAM. Lo que dej√≥ exactamente el flash no cav√≥. 80 bytes de RAM es solo el tama√±o de vtable. Todos los dem√°s datos (miembros de la clase) de alguna manera permanecieron. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Debo decir que no estrope√© todo, solo quer√≠a ver el panorama general sin pasar mucho tiempo en ello. Despu√©s de refactorizar, "perd√≠" capturas de pantalla anidadas. Con ellos, el consumo ser√≠a un poco m√°s.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero lo m√°s importante en este experimento es que la calidad del c√≥digo se ha deteriorado significativamente. El c√≥digo de un funcional se ha extendido por varios archivos. Para algunos datos, "un propietario" dej√≥ de existir, algunos m√≥dulos comenzaron a escalar en la memoria de otros. El c√≥digo se ha vuelto amplio y feo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Experimento 2: exprimir bytes de C ++ </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
. Revert√≠ mi experimento, decid√≠ dejar todo como clases. Solo que esta vez, las pantallas funcionan en objetos distribuidos est√°ticamente. La estructura de las p√°ginas en mis pantallas es fija. Puede especificarlo en la etapa de compilaci√≥n sin usar new / delete. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tama√±o del programa: 15 408 bytes (utilizado el 50% de un m√°ximo de 30 720 bytes) (2,60 segundos) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uso m√≠nimo de memoria: 1273 bytes (62% de un m√°ximo de 2048 bytes)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El consumo de RAM ha aumentado ligeramente. Pero esto es, de hecho, para mejor. El aumento en el consumo de RAM se explica por el movimiento de objetos del mont√≥n a un √°rea de memoria distribuida est√°ticamente. Es decir de hecho, los objetos se crearon antes, pero esto no fue a las estad√≠sticas. Y ahora estos objetos se tienen en cuenta expl√≠citamente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pero reducir significativamente el consumo de flash no funcion√≥. El c√≥digo a√∫n contiene los propios constructores, que todav√≠a se llaman al inicio. Es decir El compilador no pudo "ejecutarlos" por adelantado y poner todos los valores en √°reas preasignadas. Y todav√≠a hab√≠a destructores en el c√≥digo, aunque para el erizo est√° claro que los objetos nunca se eliminar√°n.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En un intento de ahorrar al menos un poco, elimin√© todos los destructores en la jerarqu√≠a, y en particular el destructor virtual en la clase base. La idea era liberar un par de bytes en cada vtable. Y luego me esperaba una sorpresa: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tama√±o del programa: 14 704 bytes (utilizado el 48% de un m√°ximo de 30 720 bytes) (2,94 segundos) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uso m√≠nimo de memoria: 1211 bytes (59% de un m√°ximo de 2048 bytes) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Result√≥ que vtable hab√≠a desaparecido no por un puntero, sino ya por 2. ¬øQu√© tiene que ver con el destructor? Solo un destructor est√° vac√≠o (visible para los objetos en la pila), y el otro con una llamada gratuita, visible para los objetos en el mont√≥n (-12 bytes de RAM). Adem√°s, las variables asociadas con la cadera (8 bytes) y las etiquetas de los objetos que nunca se crean (Screen, ParentScreen - 40 bytes) desaparecieron</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El consumo de flash disminuy√≥ significativamente, en 700 bytes. </font><font style="vertical-align: inherit;">No solo los destructores en s√≠, sino tambi√©n las implementaciones malloc / free / new / delete han desaparecido. </font><font style="vertical-align: inherit;">¬°700 bytes para un destructor virtual vac√≠o! </font><font style="vertical-align: inherit;">700 bytes, Carl! </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eso no ir√≠a de un lado a otro, aqu√≠ est√°n todos los n√∫meros en un solo lugar</font></font><br>
<br>
<div class="scrollable-table"><table>
<tbody><tr>
<th></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Era</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C ++</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 458</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14,568</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14,704</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAM</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1258</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1176</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1211</font></font></td>
</tr>
</tbody></table></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En pocas palabras: el consumo en C ++ result√≥ ser casi el mismo que en C. Pero al mismo tiempo, la encapsulaci√≥n, la herencia y el polimorfismo son poder. </font><font style="vertical-align: inherit;">Estoy listo para pagar de m√°s por esto con alg√∫n aumento en el consumo. </font><font style="vertical-align: inherit;">Tal vez simplemente no puedo escribir bellamente en C, pero ¬øpor qu√© si puedo escribir bellamente en C ++?</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ep√≠logo</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Inicialmente, quer√≠a escribir un art√≠culo al final del proyecto. Pero como las notas se acumulan a gran velocidad a medida que avanza el trabajo, el art√≠culo amenaza con ser muy grande. Entonces decid√≠ dividirlo en varias partes. En esta parte, habl√© sobre las etapas preparatorias: entender lo que realmente quiero, elegir una plataforma, implementar un marco de aplicaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En la siguiente parte, planeo pasar a la implementaci√≥n de la funcionalidad b√°sica: trabajar con GPS. Ya me he encontrado con un par de rastrillos interesantes sobre los que me gustar√≠a contar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Durante m√°s de 10 a√±os no he programado seriamente para microcontroladores. </font><font style="vertical-align: inherit;">Result√≥ que estaba un tanto mimado por la abundancia de recursos de las computadoras grandes y est√° limitado a las realidades de ATMega32. </font><font style="vertical-align: inherit;">Por lo tanto, tuve que pensar en varias opciones de copia de seguridad, como recortar la funcionalidad de las bibliotecas o redise√±ar la aplicaci√≥n en nombre del uso eficiente de la memoria. </font><font style="vertical-align: inherit;">Tampoco excluyo la posibilidad de cambiar a controladores m√°s potentes: ATMega64 o algo de la l√≠nea STM32. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por estilo, el art√≠culo resulta ser algo as√≠ como una revista de construcci√≥n. </font><font style="vertical-align: inherit;">Y estar√© encantado de hacer comentarios constructivos: no es demasiado tarde para cambiar nada. </font><font style="vertical-align: inherit;">Los que lo deseen pueden unirse a mi </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proyecto en el github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El final de la primera parte. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Segunda parte</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es401899/">https://habr.com/ru/post/es401899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es401889/index.html">Amplificadores legendarios de los a√±os 80-90: paradojas de Lamm, el monstruo de Johnson, asesino integral de "l√°mparas calientes"</a></li>
<li><a href="../es401891/index.html">Escaneo 3D e impresi√≥n 3D en acci√≥n (dedicado a motociclistas)</a></li>
<li><a href="../es401893/index.html">¬øDe d√≥nde viene el agua y el ox√≠geno en la ISS?</a></li>
<li><a href="../es401895/index.html">Los atacantes son cada vez m√°s creativos en la creaci√≥n de skimmers</a></li>
<li><a href="../es401897/index.html">Paquete de noticias para SLS y Orion</a></li>
<li><a href="../es401901/index.html">Ventana de luz de luna al universo</a></li>
<li><a href="../es401903/index.html">C√≥mo los sonidos afectan nuestro sue√±o y productividad</a></li>
<li><a href="../es401905/index.html">Apple Power Mac G4 Cube y sus contempor√°neos en una peque√±a rese√±a fotogr√°fica</a></li>
<li><a href="../es401907/index.html">Los autos rob√≥ticos deben aprender a entender a las personas.</a></li>
<li><a href="../es401909/index.html">Sistema de seguridad casero basado en productos para un hogar inteligente de Nootekhnika</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>