<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôãüèº üèº üö± WiFi Enterprise. FreeRadius + FreeIPA + Ubiquiti üë©üèø‚Äçüöí üçø üßíüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quelques exemples de WiFi d'entreprise ont d√©j√† √©t√© d√©crits. Je d√©crirai ici comment j'ai mis en ≈ìuvre une solution similaire et les probl√®mes auxquel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WiFi Enterprise. FreeRadius + FreeIPA + Ubiquiti</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463225/"><img src="https://habrastorage.org/webt/2w/tm/tw/2wtmtwbdgzq2u6yp-ujvywpl4rw.jpeg"><br><br>  Quelques exemples de WiFi d'entreprise ont d√©j√† √©t√© d√©crits.  Je d√©crirai ici comment j'ai mis en ≈ìuvre une solution similaire et les probl√®mes auxquels j'ai d√ª faire face lors de la connexion sur diff√©rents appareils.  Nous utiliserons le LDAP existant avec les utilisateurs √©tablis, augmenterons FreeRadius et configurerons WPA2-Enterprise sur le contr√¥leur Ubnt.  Il semble que tout soit simple.  Voyons voir ... <br><a name="habracut"></a><br><h2>  Un peu sur les m√©thodes EAP </h2><br>  Avant de poursuivre la t√¢che, nous devons d√©cider quelle m√©thode d'authentification nous utiliserons dans notre solution. <br><br>  <b>De wikipedia:</b> <br><blockquote>  EAP est un cadre d'authentification souvent utilis√© dans les r√©seaux sans fil et les connexions point √† point.  Le format a d'abord √©t√© d√©crit dans la RFC 3748 et mis √† jour dans la RFC 5247. <br>  EAP est utilis√© pour s√©lectionner une m√©thode d'authentification, transf√©rer des cl√©s et traiter ces cl√©s avec des plug-ins appel√©s m√©thodes EAP.  Il existe de nombreuses m√©thodes EAP, √† la fois d√©finies avec EAP lui-m√™me et celles publi√©es par les fabricants individuels.  EAP ne d√©finit pas la couche de liaison, il d√©finit uniquement le format du message.  Chaque protocole utilisant EAP a son propre protocole pour encapsuler les messages EAP. </blockquote><br>  <b>Les m√©thodes elles-m√™mes:</b> <br><br><ul><li>  LEAP est un protocole propri√©taire d√©velopp√© par CISCO.  Vuln√©rabilit√©s trouv√©es.  Actuellement non recommand√© </li><li>  EAP-TLS est bien pris en charge par les fournisseurs de services sans fil.  Il s'agit d'un protocole s√©curis√© car il succ√®de aux normes SSL.  La configuration du client est assez compliqu√©e.  Besoin d'un certificat client en plus du mot de passe.  Pris en charge sur de nombreux syst√®mes </li><li>  EAP-TTLS - largement pris en charge sur de nombreux syst√®mes, offre une bonne s√©curit√© en utilisant des certificats PKI uniquement sur le serveur d'authentification </li><li>  EAP-MD5 est un autre standard ouvert.  Offre une s√©curit√© minimale.  Vuln√©rable, ne prend pas en charge l'authentification mutuelle et la g√©n√©ration de cl√©s </li><li>  EAP-IKEv2 - Bas√© sur le protocole d'√©change de cl√©s Internet version 2. Fournit l'authentification mutuelle et l'√©tablissement de cl√©s de session entre le client et le serveur </li><li>  PEAP est une solution conjointe CISCO, Microsoft et RSA Security en tant que norme ouverte.  Largement disponible dans les produits, offre une tr√®s bonne s√©curit√©.  Similaire √† EAP-TTLS, ne n√©cessitant qu'un certificat c√¥t√© serveur </li><li>  PEAPv0 / EAP-MSCHAPv2 - apr√®s EAP-TLS, c'est la deuxi√®me norme largement utilis√©e dans le monde.  Relation client-serveur utilis√©e dans Microsoft, Cisco, Apple, Linux </li><li>  PEAPv1 / EAP-GTC - Cr√©√© par Cisco comme alternative √† PEAPv0 / EAP-MSCHAPv2.  Ne prot√®ge en aucun cas les donn√©es d'authentification.  Non pris en charge sous Windows OS </li><li>  EAP-FAST est une m√©thode d√©velopp√©e par Cisco pour corriger les carences de LEAP.  Utilise les informations d'identification d'acc√®s prot√©g√© (PAC).  Pas compl√®tement d√©velopp√© </li></ul><br>  De toute cette diversit√©, le choix n'est toujours pas grand.  La m√©thode d'authentification √©tait requise: bonne s√©curit√©, prise en charge sur tous les appareils (Windows 10, macOS, Linux, Android, iOS) et, en fait, plus c'est simple, mieux c'est.  Par cons√©quent, le choix s'est port√© sur EAP-TTLS en conjonction avec le protocole PAP. <br>  Peut-√™tre que la question se pose - Pourquoi utiliser PAP?  parce qu'il transf√®re les mots de passe en texte clair? <br><br>  Oui, c'est vrai.  La communication entre FreeRadius et FreeIPA se fera de cette mani√®re.  En mode d√©bogage, vous pouvez suivre la fa√ßon dont le nom d'utilisateur et le mot de passe sont envoy√©s.  Oui, et laissez-les partir, vous seul avez acc√®s au serveur FreeRadius. <br><br>  En savoir plus sur le travail d'EAP-TTLS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <br><br><h2>  Freeradius </h2><br>  Nous allons augmenter FreeRadius sur CentOS 7.6.  Rien de compliqu√© ici, r√©gl√© de la mani√®re habituelle. <br><br><pre><code class="bash hljs">yum install freeradius freeradius-utils freeradius-ldap -y</code> </pre> <br>  <i>√Ä partir des packages, la version 3.0.13 est install√©e.</i>  <i>Cette derni√®re peut √™tre prise sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://freeradius.org/</a></i> <br><br>  Apr√®s cela, FreeRadius fonctionne d√©j√†.  Vous pouvez d√©commenter la ligne dans / etc / raddb / users <br><br><pre> <code class="bash hljs">steve Cleartext-Password := <span class="hljs-string"><span class="hljs-string">"testing"</span></span></code> </pre> <br>  Ex√©cuter sur le serveur en mode d√©bogage <br><br><pre> <code class="bash hljs">freeradius -X</code> </pre> <br>  Et faites une connexion de test avec localhost <br><br><pre> <code class="bash hljs">radtest steve testing 127.0.0.1 1812 testing123</code> </pre> <br>  Vous avez re√ßu une r√©ponse <i>Re√ßu Access-Accept Id 115 de 127.0.0.1:1812 √† 127.0.0.1‚ñ∫6081 longueur 20</i> , alors tout va bien.  Allez-y. <br><br>  Nous connectons le module <i><b>LDAP</b></i> . <br><br><pre> <code class="bash hljs">ln -s /etc/raddb/mods-available/ldap /etc/raddb/mods-enabled/ldap</code> </pre> <br>  Et changez-le imm√©diatement.  Nous avons besoin de FreeRadius pour acc√©der √† FreeIPA <br><br><div class="spoiler">  <b class="spoiler_title">compatible avec les mods / ldap</b> <div class="spoiler_text"><pre> <code class="bash hljs">ldap { server=<span class="hljs-string"><span class="hljs-string">"ldap://ldap.server.com"</span></span> port=636 start_tls=yes identity=<span class="hljs-string"><span class="hljs-string">"uid=admin,cn=users,dc=server,dc=com"</span></span> password=********** base_dn=<span class="hljs-string"><span class="hljs-string">"cn=users,dc=server,dc=com"</span></span> set_auth_type=yes ... user { base_dn=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${..base_dn}</span></span></span><span class="hljs-string">"</span></span> filter=<span class="hljs-string"><span class="hljs-string">"(uid=%{%{Stripped-User-Name}:-%{User-Name}})"</span></span> } ...</code> </pre> <br></div></div><br>  Nous red√©marrons le serveur radius et v√©rifions la synchronisation des utilisateurs LDAP: <br><br><pre> <code class="bash hljs">radtest user_ldap password_ldap localhost 1812 testing123</code> </pre> <br>  Modification d'eap dans les <i><b>mods-enabled / eap</b></i> <br>  Ajoutez deux instances de tas ici.  Ils ne diff√©reront que par les certificats et les cl√©s.  Je vais expliquer juste ci-dessous pourquoi <br><br><div class="spoiler">  <b class="spoiler_title">compatible avec les mods / eap</b> <div class="spoiler_text"><pre> <code class="bash hljs">eap eap-client { default_eap_type = ttls timer_expire = 60 ignore_unknown_eap_types = no cisco_accounting_username_bug = no max_sessions = <span class="hljs-variable"><span class="hljs-variable">${max_requests}</span></span> tls-config tls-common { private_key_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/fisrt.key certificate_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/first.crt dh_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/dh ca_path = <span class="hljs-variable"><span class="hljs-variable">${cadir}</span></span> cipher_list = <span class="hljs-string"><span class="hljs-string">"HIGH"</span></span> cipher_server_preference = no ecdh_curve = <span class="hljs-string"><span class="hljs-string">"prime256v1"</span></span> check_crl = no } ttls { tls = tls-common default_eap_type = md5 copy_request_to_tunnel = no use_tunneled_reply = yes virtual_server = <span class="hljs-string"><span class="hljs-string">"inner-tunnel"</span></span> } } eap eap-guest { default_eap_type = ttls timer_expire = 60 ignore_unknown_eap_types = no cisco_accounting_username_bug = no max_sessions = <span class="hljs-variable"><span class="hljs-variable">${max_requests}</span></span> tls-config tls-common { private_key_passwotd=blablabla private_key_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/server.key certificate_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/server.crt dh_file = <span class="hljs-variable"><span class="hljs-variable">${certdir}</span></span>/dh ca_path = <span class="hljs-variable"><span class="hljs-variable">${cadir}</span></span> cipher_list = <span class="hljs-string"><span class="hljs-string">"HIGH"</span></span> cipher_server_preference = no ecdh_curve = <span class="hljs-string"><span class="hljs-string">"prime256v1"</span></span> check_crl = no } ttls { tls = tls-common default_eap_type = md5 copy_request_to_tunnel = no use_tunneled_reply = yes virtual_server = <span class="hljs-string"><span class="hljs-string">"inner-tunnel"</span></span> } }</code> </pre> <br></div></div><br>  Ensuite, modifiez le <i><b>site activ√© / par d√©faut</b></i> .  Int√©ress√© par les sections autoriser et authentifier. <br><br><div class="spoiler">  <b class="spoiler_title">site activ√© / par d√©faut</b> <div class="spoiler_text"><pre> <code class="bash hljs">authorize { filter_username preprocess <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (&amp;User-Name == <span class="hljs-string"><span class="hljs-string">"guest"</span></span>) { eap-guest { ok = <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } elsif (&amp;User-Name == <span class="hljs-string"><span class="hljs-string">"client"</span></span>) { eap-client { ok = <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { eap-guest { ok = <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> } } ldap <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ok || updated) &amp;&amp; User-Password) { update { control:Auth-Type := ldap } } expiration logintime pap } authenticate { Auth-Type LDAP { ldap } Auth-Type eap-guest { eap-guest } Auth-Type eap-client { eap-client } pap }</code> </pre> <br></div></div><br>  Dans la section autoriser, nous supprimons tous les modules dont nous n'avons pas besoin.  Ne laissez que LDAP.  Nous ajoutons la v√©rification du client par nom d'utilisateur.  C‚Äôest pourquoi nous avons ajout√© les deux instances ci-dessus. <br><br><div class="spoiler">  <b class="spoiler_title">Multi eap</b> <div class="spoiler_text">  Le fait est qu'en connectant certains appareils, nous utiliserons des certificats syst√®me et indiquerons le domaine.  Nous avons un certificat et une cl√© d'une autorit√© de certification de confiance.  Personnellement, √† mon avis, une telle proc√©dure de connexion est plus facile que de lancer un certificat auto-sign√© sur chaque appareil.  Mais m√™me sans certificats auto-sign√©s, cela n'a toujours pas fonctionn√©.  Les appareils Samsung et les versions Android = &lt;6 ne savent pas comment utiliser les certificats syst√®me.  Par cons√©quent, pour eux, nous cr√©ons une instance distincte d'eap-guest avec des certificats auto-sign√©s.  Pour tous les autres appareils, nous utiliserons eap-client avec un certificat de confiance.  Le nom d'utilisateur est d√©termin√© par le champ anonyme lorsque l'appareil est connect√©.  Seules 3 valeurs sont autoris√©es: Invit√©, Client et champ vide.  Le reste est jet√©.  Ceci est configur√© dans les politiques.  Je donnerai un exemple plus tard <br></div></div><br>  Modifier les sections d'autorisation et d'authentification dans le <i><b>tunnel activ√©</b></i> par le <i><b>site / tunnel interne</b></i> <br><br><div class="spoiler">  <b class="spoiler_title">activ√© par le site / tunnel interne</b> <div class="spoiler_text"><pre> <code class="bash hljs">authorize { filter_username filter_inner_identity update control { &amp;Proxy-To-Realm := LOCAL } ldap <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((ok || updated) &amp;&amp; User-Password) { update { control:Auth-Type := ldap } } expiration digest logintime pap } authenticate { Auth-Type eap-guest { eap-guest } Auth-Type eap-client { eap-client } Auth-Type PAP { pap } ldap }</code> </pre> <br></div></div><br>  Ensuite, vous devez sp√©cifier dans les politiques quels noms peuvent √™tre utilis√©s pour la connexion anonyme.  Modifiez <b><i>policy.d / filter</i></b> . <br><br>  Vous devez trouver des lignes similaires √† ceci: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (&amp;outer.request:User-Name !~ /^(anon|@)/) { update request { Module-Failure-Message = <span class="hljs-string"><span class="hljs-string">"User-Name is not anonymized"</span></span> } reject }</code> </pre> <br>  Et ci-dessous dans elsif ajoutez les valeurs n√©cessaires: <br><br><pre> <code class="bash hljs">elsif (&amp;outer.request:User-Name !~ /^(guest|client|@)/) { update request { Module-Failure-Message = <span class="hljs-string"><span class="hljs-string">"User-Name is not anonymized"</span></span> } reject }</code> </pre> <br>  Maintenant, nous devons passer au r√©pertoire <b><i>certs</i></b> .  Ici, vous devez mettre la cl√© et le certificat d'une autorit√© de certification de confiance, que nous avons d√©j√† et devons g√©n√©rer des certificats auto-sign√©s pour eap-guest. <br><br>  Modifiez les param√®tres dans le fichier <b><i>ca.cnf</i></b> . <br><br><div class="spoiler">  <b class="spoiler_title">ca.cnf</b> <div class="spoiler_text"><pre> <code class="bash hljs">... default_days = 3650 default_md = sha256 ... input_password = blablabla output_password = blablabla ... countryName = RU stateOrProvinceNmae = State localityNmae = City organizationName = NONAME emailAddress = admin@admin.ru commonName = <span class="hljs-string"><span class="hljs-string">"CA FreeRadius"</span></span></code> </pre> <br></div></div><br>  Les m√™mes valeurs sont sp√©cifi√©es dans le fichier <b><i><i>server.cnf</i></i></b> .  Nous changeons seulement <br>  <b>commonName</b> : <br><br><div class="spoiler">  <b class="spoiler_title">server.cnf</b> <div class="spoiler_text"><pre> <code class="bash hljs">... default_days = 3650 default_md = sha256 ... input_password = blablabla output_password = blablabla ... countryName = RU stateOrProvinceNmae = State localityNmae = City organizationName = NONAME emailAddress = admin@admin.ru commonName = <span class="hljs-string"><span class="hljs-string">"Server Certificate FreeRadius"</span></span></code> </pre> <br></div></div><br>  Nous cr√©ons: <br><br><pre> <code class="bash hljs">make</code> </pre> <br>  C'est fait.  Le <b><i>server.crt</i></b> et le <b><i>server.key r√©sultants</i></b> sont d√©j√† enregistr√©s ci-dessus dans eap-guest. <br><br>  Enfin, ajoutez nos points d'acc√®s au fichier <b><i>client.conf</i></b> .  Je les ai 7. Afin de ne pas ajouter chaque point s√©par√©ment, nous n'enregistrerons que le r√©seau dans lequel ils se trouvent (mes points d'acc√®s sont dans un VLAN s√©par√©). <br><br><pre> <code class="bash hljs">client APs { ipaddr = 192.168.100.0/24 password = password_AP }</code> </pre> <br><h2>  Contr√¥leur Ubiquiti </h2><br>  Sur le contr√¥leur, nous √©levons un r√©seau s√©par√©.  Que ce soit 192.168.2.0/24 <br>  Acc√©dez aux param√®tres -&gt; profil.  Cr√©ez-en un nouveau: <br><br><img src="https://habrastorage.org/webt/n4/mj/_s/n4mj_shukldt1eogoqnpphaal3e.png"><br><br>  Nous √©crivons l'adresse et le port du serveur radius et le mot de passe qui ont √©t√© enregistr√©s dans le fichier <b><i>clients.conf</i></b> : <br><br><img src="https://habrastorage.org/webt/6x/8e/km/6x8ekm2bbnrzghk0rv5qbdggnam.png"><br><br>  Cr√©ez un nouveau nom sans fil.  Comme m√©thode d'authentification, s√©lectionnez WPA-EAP (Enterprise) et sp√©cifiez le profil de rayon cr√©√©: <br><br><img src="https://habrastorage.org/webt/5i/ku/9n/5iku9n_j-r3fqsxvppyekim8aqi.png"><br><br>  Nous √©conomisons, appliquons et passons. <br><br><h2>  Configuration client </h2><br>  Commen√ßons par les plus difficiles! <br><br><h3>  Windows 10 </h3><br>  La complexit√© se r√©sume au fait que Windows n'est toujours pas en mesure de se connecter au WiFi d'entreprise par domaine.  Par cons√©quent, vous devez t√©l√©charger manuellement notre certificat dans le magasin de cl√©s de confiance.  Ici, vous pouvez utiliser √† la fois l'auto-signature et une autorit√© de certification.  J'utiliserai le second. <br><br>  Ensuite, vous devez cr√©er une nouvelle connexion.  Pour ce faire, acc√©dez aux param√®tres r√©seau et Internet -&gt; Centre R√©seau et partage -&gt; Cr√©er et configurer une nouvelle connexion ou un nouveau r√©seau: <br><br><img src="https://habrastorage.org/webt/7d/9e/ix/7d9eixr7yfn94zmiv56f1kqpm_o.png"><br><br><img src="https://habrastorage.org/webt/-z/iy/dp/-ziydpjwwwqxkgisvkxmj4kpfse.png"><br><br><img src="https://habrastorage.org/webt/jg/hd/w3/jghdw32jkf-d-9gxs71ca2o-q9y.png"><br><br>  Enregistrez manuellement le nom du r√©seau et modifiez le type de s√©curit√©.  Apr√®s avoir cliqu√© sur <i>modifier les param√®tres de connexion</i> et dans la section S√©curit√©, nous s√©lectionnons l'authentification r√©seau - EAP-TTLS. <br><br><img src="https://habrastorage.org/webt/gq/tg/x6/gqtgx6svylvh5sqmxrcjmovj-10.png"><br><br><img src="https://habrastorage.org/webt/kn/7l/a8/kn7la8fhk6a2fh8vkjtwvsji1gu.png"><br><br><img src="https://habrastorage.org/webt/y1/tl/gv/y1tlgv2-xbwqn-lcupnyiwpxz3s.png"><br><br>  Nous entrons dans les param√®tres, prescrivons la confidentialit√© de l'authentification - <b>client</b> .  En tant qu'autorit√© de certification de confiance, nous s√©lectionnons le certificat que nous avons ajout√©, cochez la case "Ne pas inviter l'utilisateur si le serveur ne peut pas √™tre autoris√©" et s√©lectionnez la m√©thode d'authentification - mot de passe non crypt√© (PAP). <br><br><img src="https://habrastorage.org/webt/5x/ww/3j/5xww3jjmvmf1rhkdxcqvoxh0l18.png"><br><br>  Ensuite, acc√©dez aux param√®tres suppl√©mentaires, cochez "Sp√©cifier le mode d'authentification".  S√©lectionnez l'√©l√©ment "Authentification utilisateur" et cliquez sur <i>enregistrer les informations d'identification</i> .  Ici, vous devrez entrer username_ldap et password_ldap <br><br><img src="https://habrastorage.org/webt/e5/lv/xu/e5lvxualbxusv6ksq1iqwhiodyi.png"><br><br><img src="https://habrastorage.org/webt/om/he/tc/omhetcqvchjagt5mcqjo_e5hq0m.png"><br><br><img src="https://habrastorage.org/webt/2p/ni/oc/2pniocysbjtvvzgoa5yqw5ahl_g.png"><br><br>  Nous sauvegardons, appliquons, fermons tout.  Vous pouvez vous connecter au nouveau r√©seau. <br><br><h3>  Linux </h3><br>  J'ai test√© sur Ubuntu 18.04, 18.10, Fedora 29, 30. <br><br>  Pour commencer, t√©l√©chargez un certificat.  Je n'ai pas trouv√© sous Linux s'il √©tait possible d'utiliser des certificats syst√®me et s'il y avait un tel stockage du tout. <br><br>  Nous nous connecterons par domaine.  Par cons√©quent, vous avez besoin d'un certificat du centre de certification aupr√®s duquel notre certificat a √©t√© achet√©. <br><br>  Toute connexion se fait dans une seule fen√™tre.  Choisissez notre r√©seau: <br><br><img src="https://habrastorage.org/webt/_b/bv/ks/_bbvksnhgramkno1xteuugeiicu.png"><br><br>  <i>anonyme - client</i> <i><br></i>  <i>domaine - domaine pour lequel le certificat est √©mis</i> <i><br></i> <br><h3>  Android </h3><br><h4>  non-samsung </h4><br>  √Ä partir de la version 7, lors de la connexion WiFi, vous pouvez utiliser des certificats syst√®me en sp√©cifiant uniquement le domaine: <br><br><img src="https://habrastorage.org/webt/ft/ma/cl/ftmaclvd6hgnr6l61f1ntqx4pho.png"><br><br>  <i>domaine - domaine pour lequel le certificat est √©mis</i> <i><br></i>  <i>anonyme - client</i> <i><br></i> <br><h4>  Samsung </h4><br>  Comme d√©j√† mentionn√© ci-dessus, les appareils Samsung ne savent pas comment utiliser les certificats syst√®me lors de la connexion WiFi et ils n'ont pas la possibilit√© de se connecter par domaine.  Par cons√©quent, vous devez ajouter manuellement le certificat racine de l'autorit√© de certification (ca.pem, nous le prenons sur le serveur Radius).  C'est l√† qu'il utilisera l'auto-signature. <br><br>  T√©l√©chargez le certificat sur votre appareil et installez-le. <br><br><div class="spoiler">  <b class="spoiler_title">Installation de certificat</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/jw/vn/p6/jwvnp6k3hcvgr_-sxahbjjfwuma.png"><br><br><img src="https://habrastorage.org/webt/vw/-u/2c/vw-u2crpfqhzv2hewbw4fvcm0k8.png"><br><br><img src="https://habrastorage.org/webt/fn/n-/i6/fnn-i6gkkzzt6w9hxjpv5fgo_sk.png"><br><br><img src="https://habrastorage.org/webt/xk/pc/-2/xkpc-2wufsgnckjexjhmiv79avy.png"><br><br>  Dans ce cas, il sera n√©cessaire de d√©finir le sch√©ma de d√©verrouillage de l'√©cran, le code PIN ou le mot de passe, s'il n'est pas d√©j√† install√©: <br><br><img src="https://habrastorage.org/webt/_w/aa/px/_waapxwklsloxwpvo3oe8mrdwek.png"><br><br><img src="https://habrastorage.org/webt/v6/nx/k1/v6nxk1ts6ej-j8sffb1kpqfx9ae.png"><br><br>  <i>J'ai montr√© une version compliqu√©e de l'installation du certificat.</i>  <i>Sur la plupart des appareils, cliquez simplement sur le certificat t√©l√©charg√©.</i> <br></div></div><br>  Une fois le certificat install√©, vous pouvez proc√©der √† la connexion: <br><br><img src="https://habrastorage.org/webt/rr/9l/vx/rr9lvx4jov8ohepj-hetehl4g1s.png"><br><br>  <i>certificat - indiquez celui qui a √©t√© install√©</i> <i><br></i>  <i>utilisateur anonyme - invit√©</i> <i><br></i> <br><h3>  macOS </h3><br>  Les appareils Apple pr√™ts √† l'emploi ne peuvent se connecter qu'√† EAP-TLS, mais vous devez toujours leur d√©poser un certificat.  Pour sp√©cifier une m√©thode de connexion diff√©rente, vous devez utiliser Apple Configurator 2. En cons√©quence, vous devez d'abord le t√©l√©charger sur le coquelicot, cr√©er un nouveau profil et ajouter tous les param√®tres WiFi n√©cessaires. <br><br><div class="spoiler">  <b class="spoiler_title">Configurateur Apple</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tg/mj/zi/tgmjzi_qpkrel011yzj5q5h23qs.png"><br><br><img src="https://habrastorage.org/webt/dw/dd/dl/dwdddlobqibczjpygjt1f-cnbp8.png"><br><br>  <i>Ici nous indiquons le nom de votre r√©seau</i> <i><br></i>  <i>Type de s√©curit√© - WPA2 Enterprise</i> <i><br></i>  <i>Types d'EAP accept√©s - TTLS</i> <i><br></i>  <i>Nom d'utilisateur et mot de passe - laissez vide</i> <i><br></i>  <i>Authentification int√©rieure - PAP</i> <i><br></i>  <i>Identit√© externe - client</i> <i><br></i> <br><br>  <i>Onglet Trust.</i>  <i>Ici nous indiquons notre domaine</i> <br><br>  C‚Äôest tout.  Un profil peut √™tre enregistr√©, sign√© et distribu√© aux appareils <br></div></div><br>  Une fois le profil pr√™t, il doit √™tre t√©l√©charg√© sur le pavot et install√©.  Pendant le processus d'installation, vous devrez sp√©cifier l'utilisateur usernmae_ldap et password_ldap: <br><br><img src="https://habrastorage.org/webt/_z/um/7m/_zum7mpbqlszgaq5d9cm6k7-why.png"><br><br><img src="https://habrastorage.org/webt/hb/iq/ig/hbiqigx3cy7zdklsbnx22zmb0e4.png"><br><br><img src="https://habrastorage.org/webt/u4/tb/-8/u4tb-8v3jbt9t5gs9zz9tplbnt0.png"><br><br><h3>  iOS </h3><br>  Le processus est similaire √† macOS.  Vous devez utiliser un profil (vous pouvez faire la m√™me chose que pour macOS. Comment cr√©er un profil dans Apple Configurator, voir ci-dessus). <br><br>  T√©l√©chargez le profil, installez, entrez les informations d'identification, connectez-vous: <br><br><img src="https://habrastorage.org/webt/pi/gx/3m/pigx3mjskrdwyuk07xs0m6zh-v4.png"><br><br><img src="https://habrastorage.org/webt/y9/hk/6g/y9hk6gm7k5jkdrvms-stzkdmu9s.png"><br><br><img src="https://habrastorage.org/webt/ie/xt/a-/iexta-krrvub6rrozdvmk7adh_s.png"><br><br><img src="https://habrastorage.org/webt/ej/oo/wj/ejoowjqmtjojl31jmau1z3np7mi.png"><br><br><img src="https://habrastorage.org/webt/pw/s4/en/pws4enrdkqc97p009eglr3wpiy0.png"><br><br><img src="https://habrastorage.org/webt/zj/z_/5f/zjz_5f7hqthgj52z_nnigigrcm4.png"><br><br>  C‚Äôest tout.  Nous avons install√© un serveur Radius, l'avons synchronis√© avec FreeIPA et avons dit aux points d'acc√®s Ubiquiti d'utiliser WPA2-EAP. <br><br><h2>  Questions possibles </h2><br>  <b>Q:</b> comment transf√©rer le profil / certificat √† l'employ√©? <br><br>  <b>R:</b> Tous les certificats / profils que je stocke sur ftp avec acc√®s via le web.  A augment√© un r√©seau invit√© avec une limite de vitesse et un acc√®s Internet uniquement, sauf pour ftp. <br>  L'authentification dure 2 jours, apr√®s quoi elle est r√©initialis√©e et le client se retrouve sans Internet.  T.O.  Lorsqu'un employ√© souhaite se connecter au WiFi, il se connecte d'abord au r√©seau invit√©, visite FTP, t√©l√©charge le certificat ou le profil dont il a besoin, les installe, puis peut se connecter au r√©seau d'entreprise. <br><br>  <b>Q:</b> pourquoi ne pas utiliser un sch√©ma avec MSCHAPv2?  elle est plus s√ªre! <br><br>  <b>R:</b> premi√®rement, un tel sch√©ma fonctionne bien sur NPS (Windows Network Policy System), dans notre impl√©mentation, il est n√©cessaire de configurer en plus LDAP (FreeIpa) et de stocker les hachages de mot de passe sur le serveur.  Ajouter.  les r√©glages ne sont pas recommand√©s, car  cela peut entra√Æner divers probl√®mes de synchronisation des ultrasons.  Deuxi√®mement, le hachage est MD4, donc cela n'augmente pas vraiment la s√©curit√©. <br><br>  <b>Q: est-</b> il possible d'autoriser des appareils par mac-adresses? <br><br>  <b>R:</b> NON, ce n'est pas s√ªr, un attaquant peut usurper des adresses de pavot, et en outre l'autorisation pour les adresses de pavot n'est pas prise en charge sur de nombreux appareils <br><br>  <b>Q:</b> pourquoi utiliser tous ces certificats?  vous pouvez vous connecter sans eux <br><br>  <b>R: Les</b> certificats sont utilis√©s pour autoriser le serveur.  C'est-√†-dire  l'appareil, une fois connect√©, v√©rifie si c'est le serveur qui peut √™tre approuv√© ou non.  Si tel est le cas, l'authentification va plus loin, sinon, la connexion est ferm√©e.  Vous pouvez vous connecter sans certificats, mais si un attaquant ou un voisin r√©cup√®re un serveur radius et un point d'acc√®s du m√™me nom que le n√¥tre, il peut facilement intercepter les informations d'identification de l'utilisateur (n'oubliez pas qu'elles sont transmises en texte clair).  Et lorsque le certificat est utilis√©, l'ennemi ne verra dans nos journaux que notre nom d'utilisateur fictif - invit√© ou client et une erreur de type - Certificat CA inconnu <br><br><div class="spoiler">  <b class="spoiler_title">en savoir plus sur macOS</b> <div class="spoiler_text">  G√©n√©ralement, sur macOS, la r√©installation du syst√®me se fait via Internet.  En mode de r√©cup√©ration, le coquelicot doit √™tre connect√© au WiFi, et ni notre WiFi d'entreprise ni le r√©seau invit√© ne fonctionneront ici.  Personnellement, j'ai choisi un autre r√©seau, le WPA2-PSK habituel, cach√©, uniquement pour les op√©rations techniques.  Sinon, vous pouvez cr√©er une cl√© USB bootable avec le syst√®me √† l'avance.  Mais si le coquelicot apr√®s 2015, vous aurez toujours besoin de trouver un adaptateur pour ce lecteur flash) <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463225/">https://habr.com/ru/post/fr463225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463197/index.html">Blazor + MVVM = Silverlight riposte parce que le mal ancien est invincible</a></li>
<li><a href="../fr463205/index.html">Initialement inutilisable: comment survivre avec un ordinateur portable sous Windows 10 et un lecteur de 32 gigaoctets</a></li>
<li><a href="../fr463213/index.html">Id√©es fausses pour les d√©veloppeurs C # novices. Essayer de r√©pondre √† des questions standard</a></li>
<li><a href="../fr463215/index.html">Les ing√©nieurs et les architectes con√ßoivent d√©j√† des √©tablissements lunaires</a></li>
<li><a href="../fr463221/index.html">Regarder le soleil: 5 types de gadgets, de 5 $ √† 5 000 $</a></li>
<li><a href="../fr463229/index.html">Jetpacks dans la culture: cin√©ma</a></li>
<li><a href="../fr463231/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 14. VTP, √©lagage et VLAN natif</a></li>
<li><a href="../fr463233/index.html">Formation Cisco 200-125 CCNA v3.0. Jour 15. Communication lente et s√©curit√© des ports</a></li>
<li><a href="../fr463237/index.html">Comment nous avons jou√© de la musique avec les r√©seaux de neurones v 2.0</a></li>
<li><a href="../fr463239/index.html">22 ao√ªt - Alfa JS MeetUP SPb</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>