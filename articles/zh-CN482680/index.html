<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🎩 📶 🆗 地穴，XOR，入侵未加密的ZIP和PRSP。 使用r0ot-mi Crypto解决问题。 第二部分 👩🏽‍🎨 ▶️ 👩🏾‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我们学习了crypt函数，了解如何为具有未加密文件名的ZIP存档选择密码，熟悉xortool实用程序，还处理了伪随机数生成器。 以前有关此主题的文章： 

 第1部分- 使用PIL python进行编码，移位密码，暴力哈希和图片创建。 

 组织信息  特别是对于那些想要学习新知识并在信息...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>地穴，XOR，入侵未加密的ZIP和PRSP。 使用r0ot-mi Crypto解决问题。 第二部分</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482680/"><img src="https://habrastorage.org/webt/ux/pz/a0/uxpza0t6_t38ztc07yhtciypf8g.jpeg" alt="图片"><br><br> 在本文中，我们学习了crypt函数，了解如何为具有未加密文件名的ZIP存档选择密码，熟悉xortool实用程序，还处理了伪随机数生成器。 以前有关此主题的文章： <br><br> 第1部分- <a href="https://habr.com/ru/post/472628/">使用PIL python进行编码，移位密码，暴力哈希和图片创建。</a> <br><br><div class="spoiler">  <b class="spoiler_title">组织信息</b> <div class="spoiler_text"> 特别是对于那些想要学习新知识并在信息和计算机安全性的任何领域中发展的人们，我将撰写和讨论以下类别： <br><br><ul><li>  PWN； </li><li> 密码学（加密）； </li><li> 网络技术（网络）； </li><li> 反向（反向工程）； </li><li> 隐写术（Stegano）； </li><li> 搜索和利用Web漏洞。 </li></ul><br> 除此之外，我还将分享我在计算机取证，恶意软件和固件分析，对无线网络和局域网的攻击，进行笔测试和编写漏洞利用程序方面的经验。 <br><a name="habracut"></a><br> 为了使您可以查找有关新文章，软件和其他信息的信息，我<a href="https://t.me/RalfHackerChannel" rel="nofollow">在Telegram中</a>创建了一个<a href="https://t.me/RalfHackerChannel" rel="nofollow">频道，</a>并创建了一个<a href="https://t.me/RalfHackerPublicChat" rel="nofollow">小组来讨论</a> ICD领域中的<a href="https://t.me/RalfHackerPublicChat" rel="nofollow">所有问题</a> 。 另外，我会亲自考虑您的个人要求，问题，建议和建议， <a href="https://t.me/hackerralf8" rel="nofollow">并会回答所有人</a> 。 <br><br> 提供所有信息仅出于教育目的。 对于由于使用本文档而获得的知识和方法对某人造成的任何损害，本文档的作者不承担任何责任。 <br></div></div><br><br><h2>  ELF64-PID加密 </h2><br><img src="https://habrastorage.org/webt/zp/9w/da/zp9wdanzxvhz4uiuusjcfd5coe8.png" alt="图片"><br><br> 我们看一下源代码。 程序将字符串作为参数，并将其与cryt函数从程序的PID返回的内容和字符串“ $ 1 $ awesome”进行比较。 <br><br>  cryt函数是一个库函数，用于计算密码哈希。 函数的输出不仅是散列，还包含一行盐，使用的散列算法以及用于接收散列的参数（例如，回合数和其他选项）的一行文本。 <br><br><img src="https://habrastorage.org/webt/jq/3f/3y/jq3f3y-d2srjnkudzwbrhxwsfsk.png" alt="图片"><br><br> 该功能包含在Perl，PHP，Pike，Python和Ruby编程语言中。 因此，您需要猜测将用来启动程序的PID。 通过SSH连接后，我们看到它们为我们提供了一个程序，其源代码和一个带有密码的文件。 <br><br><img src="https://habrastorage.org/webt/9m/8i/k7/9m8ik71wa-fei5gcp-hbcm01mpk.png" alt="图片"><br><br> 在Linux上，每个新运行的应用程序将收到最接近的增量免费PID值。 例如，连续执行ps几次。  PID每次递增。 <br><br><img src="https://habrastorage.org/webt/iu/sr/db/iusrdb1rfj_k3rh116obbcee_ds.png" alt="图片"><br><br> 因此，您可以从任何空闲的PID计算散列，并以该值作为参数，无限期地运行程序。 让我们以PID为例，例如30000，并执行crypt函数。 我将在python中完成。 <br><br><img src="https://habrastorage.org/webt/im/yh/pr/imyhpredd7_yoo0jvvlcjlz9zbg.png" alt="图片"><br><br> 现在运行一个无穷循环的程序执行。 <br><br><img src="https://habrastorage.org/webt/vx/y6/mr/vxy6mrtke5wyblw7fmzaz0_92nw.png" alt="图片"><br><br> 一分钟后，我们从读取密码的地方得到一个外壳。 <br><br><img src="https://habrastorage.org/webt/m1/zu/u7/m1zuu7o4dytba97nopsqm0a-qck.png" alt="图片"><br><br><h2> 文件-PKZIP </h2><br><img src="https://habrastorage.org/webt/8h/fh/n8/8hfhn8x1q1c6mng5btrn9n3tpxm.png" alt="图片"><br><br> 下载他们给我们的文件。 这是受密码保护的ZIP存档。 让我们通过密码。 由于文件名未加密，因此将其命名为fcrackzip实用程序，并将rockyou.txt作为字典。 <br><br><img src="https://habrastorage.org/webt/sd/mi/qt/sdmiqt3lilxfpbaxz8chexwtlrk.png" alt="图片"><br><br> 解压缩后，我们得到一个文本文件，其中说答案是存档中的密码。 <br><br><img src="https://habrastorage.org/webt/lp/m5/uq/lpm5uqukykoth4k-y_gjf8t2qqi.png" alt="图片"><br><br><h2> 已知的明文-XOR </h2><br><img src="https://habrastorage.org/webt/eg/it/va/egitvahzvebbcqatvgwcqfclo-g.png" alt="图片"><br><br> 我们获得了使用XOR BMP加密的图片。 由于我们使用XOR（我假设使用短键）并且密文很大，因此可以使用xortool。 <br><br><img src="https://habrastorage.org/webt/fe/uo/_r/feuo_rxvnihxkyvnz92balmp0ka.png" alt="图片"><br><br> 因此，xortool认为最可能的密钥长度是6。让我们请他确定密钥。 <br><br><img src="https://habrastorage.org/webt/2j/tb/ol/2jtbol6v5yhbd0swhdy8cnbpn7g.png" alt="图片"><br><br> 太好了 密钥已定义，但是xortool本身已解密该文件并将其保存在xortool_out目录中。 <br><br><img src="https://habrastorage.org/webt/ul/wr/u4/ulwru45g91prmp9990nawqeu98c.png" alt="图片"><br><br><h2> 代码-伪随机数生成器 </h2><br><img src="https://habrastorage.org/webt/pd/pr/ns/pdprnsnnnqtgmthwxzpzzbgtg0e.png" alt="图片"><br><br> 我们提供了一个用于加密文件以及文件本身的程序。 另外，他们说加密发生在2012年12月。让我们清理代码。 <br><br> 在程序的开始，将存储当前时间（更确切地说，是自1970年1月1日以来经过的时间）。 接下来，检查程序参数的存在-文件路径。 <br><br><img src="https://habrastorage.org/webt/te/ve/w6/tevew6jfzkm_160_8kit7_8ue-i.png" alt="图片"><br><br><img src="https://habrastorage.org/webt/cf/bc/lo/cfbclozjtg9e6itqoj7t6rznmg4.png" alt="图片"><br><br> 然后打开此文件以进行读取，并创建一个新文件以进行写入。 这两个文件的描述符都传递给crypt_file函数。 <br><br><img src="https://habrastorage.org/webt/2h/ri/ya/2hriyayc7ulxizar3dhk_6ndj7m.png" alt="图片"><br><br> 在crypt_file中，genere_key（）函数将32字节的密钥反转，该密钥用于对文件进行XOR加密。 加密结果将写入新创建的文件。 <br><br><img src="https://habrastorage.org/webt/tf/ed/s1/tfeds1s1m5txk8llicyfh6hmrbc.png" alt="图片"><br><br> 密钥以伪随机方式编译。 从每个步骤显示的字母中，根据holdrand值选择一个值，该值也会在每个步骤中更改，而在最开始时它等于当前时间。 <br><br><img src="https://habrastorage.org/webt/c3/hm/mp/c3hmmpadb0yoqdaor0er7q_xtes.png" alt="图片"><br><br> 因此，我们需要生成可能的密钥。  python源代码如下所示。 <br><pre><code class="python hljs">keys = [] charset = <span class="hljs-string"><span class="hljs-string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123456789"</span></span> l = len(charset) holdrand = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> holdrand holdrand = holdrand * <span class="hljs-number"><span class="hljs-number">214013</span></span> + <span class="hljs-number"><span class="hljs-number">2531011</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((holdrand &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7fff</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">genere_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> key = <span class="hljs-string"><span class="hljs-string">""</span></span>.join( [ charset[Rand()%l] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _ <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">32</span></span>) ] ) keys.append(key) start = ? fin = ? <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(start, fin): holdrand = ts genere_key()</code> </pre> <br><br> 现在让我们处理时间的界限。 由于加密是在2012年12月执行的，因此我们需要对12月1日至12月31日之间的所有可能值进行排序。 <br><br><img src="https://habrastorage.org/webt/_p/vj/i-/_pvji-osfxwv0e941u66gdemhmu.png" alt="图片"><br><br><pre> <code class="python hljs">start = <span class="hljs-number"><span class="hljs-number">1354320000</span></span> fin = <span class="hljs-number"><span class="hljs-number">1356998400</span></span></code> </pre> <br><br> 我们已经确定了边界，但仍然有很多关键。 幸运的是，文件具有扩展名-这是bz2。 <br><br><img src="https://habrastorage.org/webt/3m/ue/tq/3muetqnmr68aqqxdhurwzs-vae4.png" alt="图片"><br><br> 也就是说，文件的前三个字节必须是“ BZh”，第四个字节必须是从“ 1”到“ 9”的字符之一，而后六个字节必须是0x314159265359。 让我们为键添加一个过滤器。 为此，我们需要密文的第一个字节。 <br><br><img src="https://habrastorage.org/webt/vq/dw/wf/vqdwwfaeqhc31rflnns7gr2wuiu.png" alt="图片"><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">key_filter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(key)</span></span></span><span class="hljs-function">:</span></span> ctext = <span class="hljs-string"><span class="hljs-string">"\x23\x17\x5d\x70\x5a\x11\x6d\x67\x37\x08"</span></span> BZh = <span class="hljs-string"><span class="hljs-string">"BZh"</span></span> sign = <span class="hljs-string"><span class="hljs-string">""</span></span>.join( [ chr(ord(ctext[i])^ord(BZh[i])) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">3</span></span>) ] ) byte4 = <span class="hljs-string"><span class="hljs-string">""</span></span>.join( [ chr(ord(ctext[<span class="hljs-number"><span class="hljs-number">3</span></span>])^ord(i)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"123456789"</span></span> ] ) bytePI = chr(ord(ctext[<span class="hljs-number"><span class="hljs-number">4</span></span>])^<span class="hljs-number"><span class="hljs-number">0x31</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sign <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> key[:<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> key[<span class="hljs-number"><span class="hljs-number">3</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> byte4 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> key[<span class="hljs-number"><span class="hljs-number">4</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> bytePI: print(key)</code> </pre> <br><br> 而且我们只有一把钥匙。 <br><br><img src="https://habrastorage.org/webt/zv/yp/4i/zvyp4iyuuxu-m2daciww8howgbe.png" alt="图片"><br><br> 使用相同的xortool，您可以使用密钥代理文件。 <br><br><img src="https://habrastorage.org/webt/b6/8t/ly/b68tlygv2_abbqakbsmc1bucywi.png" alt="图片"><br><br> 因此，您解密了存档。 <br><br> 您可以通过<a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a>加入我们。 让我们建立一个社区，在这个社区中，会有一些精通IT领域的人，然后我们可以在任何IT和信息安全问题上互相帮助。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482680/">https://habr.com/ru/post/zh-CN482680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482670/index.html">在MacBook上使用混合硬盘驱动器并在其上安装Windows</a></li>
<li><a href="../zh-CN482672/index.html">年度报告Habrapost-2019</a></li>
<li><a href="../zh-CN482674/index.html">“节后立即”：ITMO大学的研讨会，大师班和技术竞赛</a></li>
<li><a href="../zh-CN482676/index.html">有效排序Struct类型数据</a></li>
<li><a href="../zh-CN482678/index.html">我如何决定针对iOS进行文本搜索以及它的结果</a></li>
<li><a href="../zh-CN482684/index.html">我用两周时间和552美元创建了自己的蘸酱</a></li>
<li><a href="../zh-CN482686/index.html">科学家使动物行为研究自动化，以解码大脑功能</a></li>
<li><a href="../zh-CN482690/index.html">在合并中创建发布者</a></li>
<li><a href="../zh-CN482692/index.html">英特尔NUC工作与虚拟化之家</a></li>
<li><a href="../zh-CN482694/index.html">Windows之后有生命吗？或者到2020年在哪里培养Windows系统管理员/工程师？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>