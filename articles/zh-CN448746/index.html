<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ—¼ ğŸ‘¨ğŸ¿â€ğŸ³ â© PostgreSQLä¸­çš„ç´¢å¼•-7ï¼ˆGINï¼‰ ğŸ§’ğŸ» ğŸ¤³ğŸ¾ ğŸ‘¨â€ğŸš’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰PostgreSQL ç´¢å¼•å¼•æ“å’Œè®¿é—®æ–¹æ³•çš„ç•Œé¢ï¼Œå¹¶è®¨è®ºäº†å“ˆå¸Œç´¢å¼• ï¼Œ Bæ ‘ ï¼Œ GiSTå’ŒSP-GiSTç´¢å¼•ã€‚ å¹¶ä¸”æœ¬æ–‡å°†ä»‹ç»GINç´¢å¼•ã€‚ 

 æœæ¾å­é…’ 
 â€œæœæ¾å­é…’ã€‚ã€‚æœæ¾å­é…’ä¼¼ä¹æ˜¯ä¸€ç§ç¾å›½é…’ï¼Ÿã€‚â€ 
 â€œæˆ‘ä¸æ˜¯å–é…’ï¼Œå“¦ï¼Œå¥½å¥‡çš„ç”·å­©ï¼â€ è€äººåˆçˆ†å‘äº†å‡ºæ¥ï¼Œåˆä¸€æ¬¡æ„è¯†åˆ°äº†è‡ªå·±ï¼Œå¹¶å†æ¬¡...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostgreSQLä¸­çš„ç´¢å¼•-7ï¼ˆGINï¼‰</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/448746/"> æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰PostgreSQL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç´¢å¼•å¼•æ“</a>å’Œè®¿é—®æ–¹æ³•çš„ç•Œé¢ï¼Œå¹¶è®¨è®ºäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å“ˆå¸Œç´¢å¼•</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bæ ‘</a> ï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GiST</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SP-GiST</a>ç´¢å¼•ã€‚ å¹¶ä¸”æœ¬æ–‡å°†ä»‹ç»GINç´¢å¼•ã€‚ <br><br><h1> æœæ¾å­é…’ </h1><br>  <em>â€œæœæ¾å­é…’ã€‚ã€‚æœæ¾å­é…’ä¼¼ä¹æ˜¯ä¸€ç§ç¾å›½é…’ï¼Ÿã€‚â€</em> <em><br></em>  <em>â€œæˆ‘ä¸æ˜¯å–é…’ï¼Œå“¦ï¼Œå¥½å¥‡çš„ç”·å­©ï¼â€</em>  <em>è€äººåˆçˆ†å‘äº†å‡ºæ¥ï¼Œåˆä¸€æ¬¡æ„è¯†åˆ°äº†è‡ªå·±ï¼Œå¹¶å†æ¬¡å°†è‡ªå·±æ¡åœ¨æ‰‹ä¸­ã€‚</em>  <em>â€œæˆ‘ä¸æ˜¯å–é…’ï¼Œè€Œæ˜¯ä¸€ç§å¼ºå¤§è€Œå‹‡æ•¢çš„ç²¾ç¥ï¼Œä¸–ç•Œä¸Šæ²¡æœ‰æˆ‘æ— æ³•åšåˆ°çš„é­”åŠ›ã€‚â€</em> <br>  -æ‹‰æ‰å°”Â·æ‹‰é‡‘ï¼ˆLazar Laginï¼‰ï¼Œã€Šè€éœå¡”æ¯”å¥‡ã€‹ã€‚ <br><br>  <em>æœæ¾å­é…’ï¼ˆGinï¼‰ä»£è¡¨å¹¿ä¹‰å€’ç½®ç´¢å¼•ï¼Œåº”è¢«è§†ä¸ºç²¾çµï¼Œè€Œéé…’æ°´ã€‚</em> <br>  - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ªè¿°æ–‡ä»¶</a> <br><a name="habracut"></a><br><h2> ä¸€èˆ¬æ¦‚å¿µ </h2><br>  GINæ˜¯ç¼©å†™çš„å¹¿ä¹‰å€’æ’ç´¢å¼•ã€‚ è¿™å°±æ˜¯æ‰€è°“çš„<em>å€’æ’ç´¢å¼•</em> ã€‚ å®ƒå¤„ç†å…¶å€¼ä¸æ˜¯åŸå­çš„è€Œæ˜¯ç”±å…ƒç´ ç»„æˆçš„æ•°æ®ç±»å‹ã€‚ æˆ‘ä»¬å°†è¿™äº›ç±»å‹ç§°ä¸ºå¤åˆã€‚ è¿™äº›ä¸æ˜¯ç´¢å¼•çš„å€¼ï¼Œè€Œæ˜¯å„ä¸ªå…ƒç´ ã€‚ æ¯ä¸ªå…ƒç´ éƒ½å¼•ç”¨å…¶å‡ºç°çš„å€¼ã€‚ <br><br> è¿™ç§æ–¹æ³•çš„ä¸€ä¸ªå¾ˆå¥½çš„ç±»æ¯”æ˜¯ä¹¦æœ«çš„ç´¢å¼•ï¼Œè¯¥ç´¢å¼•ä¸ºæ¯ä¸ªæœ¯è¯­æä¾›äº†è¯¥æœ¯è¯­å‡ºç°çš„é¡µé¢åˆ—è¡¨ã€‚ è®¿é—®æ–¹æ³•å¿…é¡»ç¡®ä¿å¿«é€Ÿæœç´¢ç´¢å¼•å…ƒç´ ï¼Œå°±åƒä¹¦ä¸­çš„ç´¢å¼•ä¸€æ ·ã€‚ å› æ­¤ï¼Œè¿™äº›å…ƒç´ å­˜å‚¨ä¸ºç†Ÿæ‚‰çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bæ ‘</a> ï¼ˆä¸ºå…¶ä½¿ç”¨äº†ä¸åŒçš„ï¼Œæ›´ç®€å•çš„å®ç°ï¼Œä½†æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹æ— å…³ç´§è¦ï¼‰ã€‚ å¯¹åŒ…å«å…ƒç´ çš„å¤åˆå€¼çš„è¡¨è¡Œçš„æœ‰åºå¼•ç”¨é›†é“¾æ¥åˆ°æ¯ä¸ªå…ƒç´ ã€‚ æœ‰åºæ€§å¯¹äºæ•°æ®æ£€ç´¢è‡³å…³é‡è¦ï¼ˆTIDçš„æ’åºé¡ºåºå¹¶ä¸é‡è¦ï¼‰ï¼Œä½†å¯¹ç´¢å¼•çš„å†…éƒ¨ç»“æ„å¾ˆé‡è¦ã€‚ <br><br> å…ƒç´ æ°¸è¿œä¸ä¼šä»GINç´¢å¼•ä¸­åˆ é™¤ã€‚ å¯ä»¥è®¤ä¸ºåŒ…å«å…ƒç´ çš„å€¼å¯ä»¥æ¶ˆå¤±ï¼Œå‡ºç°æˆ–å˜åŒ–ï¼Œä½†æ˜¯ç»„æˆå®ƒä»¬çš„å…ƒç´ é›†æˆ–å¤šæˆ–å°‘æ˜¯ç¨³å®šçš„ã€‚ è¯¥è§£å†³æ–¹æ¡ˆæå¤§åœ°ç®€åŒ–äº†å¸¦æœ‰ç´¢å¼•çš„å¤šä¸ªè¿›ç¨‹çš„å¹¶å‘å·¥ä½œçš„ç®—æ³•ã€‚ <br><br> å¦‚æœTIDåˆ—è¡¨å¾ˆå°ï¼Œåˆ™å¯ä»¥ä¸è¯¥å…ƒç´ æ”¾å…¥åŒä¸€é¡µé¢ï¼ˆç§°ä¸ºâ€œå‘å¸ƒåˆ—è¡¨â€ï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœåˆ—è¡¨å¾ˆå¤§ï¼Œåˆ™éœ€è¦ä¸€ç§æ›´æœ‰æ•ˆçš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”æˆ‘ä»¬å·²ç»æ„è¯†åˆ°äº†-å®ƒåˆæ˜¯Bæ ‘ã€‚ è¿™æ ·çš„æ ‘ä½äºå•ç‹¬çš„æ•°æ®é¡µä¸Šï¼ˆç§°ä¸ºâ€œå‘å¸ƒæ ‘â€ï¼‰ã€‚ <br><br> å› æ­¤ï¼ŒGINç´¢å¼•ç”±å…ƒç´ çš„Bæ ‘ç»„æˆï¼Œå¹¶ä¸”Bæ ‘æˆ–TIDçš„å¹³é¢åˆ—è¡¨é“¾æ¥åˆ°è¯¥Bæ ‘çš„å¶è¡Œã€‚ <br><br> å°±åƒå‰é¢è®¨è®ºçš„GiSTå’ŒSP-GiSTç´¢å¼•ä¸€æ ·ï¼ŒGINä¸ºåº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æä¾›äº†ç•Œé¢ï¼Œä»¥æ”¯æŒå¯¹å¤åˆæ•°æ®ç±»å‹çš„å„ç§æ“ä½œã€‚ <br><br><h2> å…¨æ–‡æœç´¢ </h2><br>  GINæ–¹æ³•çš„ä¸»è¦åº”ç”¨é¢†åŸŸæ˜¯åŠ é€Ÿå…¨æ–‡æœç´¢ï¼Œå› æ­¤ï¼Œåœ¨å¯¹è¯¥ç´¢å¼•è¿›è¡Œæ›´è¯¦ç»†çš„è®¨è®ºæ—¶ï¼Œå¯ä»¥å°†å…¶ç”¨ä½œç¤ºä¾‹ã€‚ <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸GiSTç›¸å…³çš„æ–‡ç« </a>å·²ç»æä¾›äº†å…¨æ–‡æœç´¢çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç®€çŸ­</a>ä»‹ç»ï¼Œå› æ­¤è®©æˆ‘ä»¬ç›´æ¥è®²ä¸€ç‚¹ã€‚ å¾ˆæ˜æ˜¾ï¼Œè¿™ç§æƒ…å†µä¸‹çš„å¤åˆå€¼æ˜¯<em>æ–‡æ¡£</em> ï¼Œè€Œè¿™äº›æ–‡æ¡£çš„å…ƒç´ æ˜¯<em>è¯ç´ </em> ã€‚ <br><br> è®©æˆ‘ä»¬è€ƒè™‘ä¸GiSTç›¸å…³çš„æ–‡ç« ä¸­çš„ç¤ºä¾‹ï¼š <br><br><pre><code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> ts(doc <span class="hljs-type"><span class="hljs-type">text</span></span>, doc_tsv <span class="hljs-type"><span class="hljs-type">tsvector</span></span>); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> ts(doc) <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-string"><span class="hljs-string">'Can a sheet slitter slit sheets?'</span></span>), (<span class="hljs-string"><span class="hljs-string">'How many sheets could a sheet slitter slit?'</span></span>), (<span class="hljs-string"><span class="hljs-string">'I slit a sheet, a sheet I slit.'</span></span>), (<span class="hljs-string"><span class="hljs-string">'Upon a slitted sheet I sit.'</span></span>), (<span class="hljs-string"><span class="hljs-string">'Whoever slit the sheets is a good sheet slitter.'</span></span>), (<span class="hljs-string"><span class="hljs-string">'I am a sheet slitter.'</span></span>), (<span class="hljs-string"><span class="hljs-string">'I slit sheets.'</span></span>), (<span class="hljs-string"><span class="hljs-string">'I am the sleekest sheet slitter that ever slit sheets.'</span></span>), (<span class="hljs-string"><span class="hljs-string">'She slits the sheet she sits on.'</span></span>); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> doc_tsv = to_tsvector(doc); postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(doc_tsv);</code> </pre> <br> è¯¥ç´¢å¼•çš„å¯èƒ½ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/lc/nh/m-/lcnhm-vqquxgvzpklv8kemu6z-a.png"><br><br> ä¸å‰é¢çš„æ‰€æœ‰å›¾ä¸­çš„å›¾ä¸åŒï¼Œå¯¹è¡¨è¡Œï¼ˆTIDï¼‰çš„å¼•ç”¨åœ¨æ·±è‰²èƒŒæ™¯ï¼ˆé¡µé¢ç¼–å·å’Œé¡µé¢ä½ç½®ï¼‰ä¸Šç”¨æ•°å­—è¡¨ç¤ºï¼Œè€Œä¸ç”¨ç®­å¤´è¡¨ç¤ºã€‚ <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> ctid, left(doc,<span class="hljs-number"><span class="hljs-number">20</span></span>), doc_tsv <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts;</code> </pre><pre> <code class="plaintext hljs"> ctid | left | doc_tsv -------+----------------------+--------------------------------------------------------- (0,1) | Can a sheet slitter | 'sheet':3,6 'slit':5 'slitter':4 (0,2) | How many sheets coul | 'could':4 'mani':2 'sheet':3,6 'slit':8 'slitter':7 (0,3) | I slit a sheet, a sh | 'sheet':4,6 'slit':2,8 (1,1) | Upon a slitted sheet | 'sheet':4 'sit':6 'slit':3 'upon':1 (1,2) | Whoever slit the she | 'good':7 'sheet':4,8 'slit':2 'slitter':9 'whoever':1 (1,3) | I am a sheet slitter | 'sheet':4 'slitter':5 (2,1) | I slit sheets. | 'sheet':3 'slit':2 (2,2) | I am the sleekest sh | 'ever':8 'sheet':5,10 'sleekest':4 'slit':9 'slitter':6 (2,3) | She slits the sheet | 'sheet':4 'sit':6 'slit':2 (9 rows)</code> </pre><br> åœ¨æ­¤æ¨æµ‹æ€§ç¤ºä¾‹ä¸­ï¼ŒTIDåˆ—è¡¨é€‚åˆæ‰€æœ‰è¯ç´ ï¼ˆâ€œå·¥ä½œè¡¨â€ï¼Œâ€œç‹­ç¼â€å’Œâ€œåˆ†åˆ‡å™¨â€ï¼‰çš„å¸¸è§„é¡µé¢ã€‚ è¿™äº›è¯ç´ å‡ºç°åœ¨è®¸å¤šæ–‡æ¡£ä¸­ï¼Œå¹¶ä¸”å®ƒä»¬çš„TIDåˆ—è¡¨å·²æ”¾å…¥å•ç‹¬çš„Bæ ‘ä¸­ã€‚ <br><br> é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä»¬å¦‚ä½•æ‰¾å‡ºåŒ…å«ä¸€ä¸ªè¯ç´ çš„æ–‡æ¡£ï¼Ÿ å¯¹äºä¸€å¼ å°æ¡Œå­ï¼Œä¸‹é¢æ˜¾ç¤ºçš„ä¸€ç§â€œç›´æ¥â€æŠ€æœ¯å°†èµ·ä½œç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å°†è¿›ä¸€æ­¥å­¦ä¹ å¦‚ä½•å¤„ç†è¾ƒå¤§çš„æ¡Œå­ã€‚ <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> (unnest(doc_tsv)).lexeme, count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>;</code> </pre><pre> <code class="plaintext hljs"> lexeme | count ----------+------- sheet | 9 slit | 8 slitter | 5 sit | 2 upon | 1 mani | 1 whoever | 1 sleekest | 1 good | 1 could | 1 ever | 1 (11 rows)</code> </pre><br> è¿˜è¦æ³¨æ„ï¼Œä¸å¸¸è§„Bæ ‘ä¸åŒï¼ŒGINç´¢å¼•çš„é¡µé¢æ˜¯é€šè¿‡å•å‘åˆ—è¡¨è€Œä¸æ˜¯åŒå‘åˆ—è¡¨è¿æ¥çš„ã€‚ è¿™æ˜¯è¶³å¤Ÿçš„ï¼Œå› ä¸ºä»…ä»¥ä¸€ç§æ–¹å¼å®Œæˆæ ‘éå†ã€‚ <br><br><h3> æŸ¥è¯¢ç¤ºä¾‹ </h3><br> å¯¹äºæˆ‘ä»¬çš„ç¤ºä¾‹ï¼Œå°†å¦‚ä½•æ‰§è¡Œä»¥ä¸‹æŸ¥è¯¢ï¼Ÿ <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> doc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> doc_tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'many &amp; slitter'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN --------------------------------------------------------------------- Bitmap Heap Scan on ts Recheck Cond: (doc_tsv @@ to_tsquery('many &amp; slitter'::text)) -&gt; Bitmap Index Scan on ts_doc_tsv_idx Index Cond: (doc_tsv @@ to_tsquery('many &amp; slitter'::text)) (4 rows)</code> </pre><br> é¦–å…ˆä»æŸ¥è¯¢ä¸­æå–å•ä¸ªè¯ç´ ï¼ˆæœç´¢å…³é”®å­—ï¼‰ï¼šâ€œ maniâ€å’Œâ€œ slitterâ€ã€‚ è¿™æ˜¯ç”±ä¸“é—¨çš„APIå‡½æ•°å®Œæˆçš„ï¼Œè¯¥å‡½æ•°è€ƒè™‘äº†æ“ä½œå‘˜ç±»ç¡®å®šçš„æ•°æ®ç±»å‹å’Œç­–ç•¥ï¼š <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> amop.amopopr::<span class="hljs-type"><span class="hljs-type">regoperator</span></span>, amop.amopstrategy <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_opclass opc, pg_opfamily opf, pg_am am, pg_amop amop <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> opc.opcname = <span class="hljs-string"><span class="hljs-string">'tsvector_ops'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> opf.oid = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.oid = opf.opfmethod <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amopfamily = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.amname = <span class="hljs-string"><span class="hljs-string">'gin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amoplefttype = opc.opcintype;</code> </pre><pre> <code class="plaintext hljs"> amopopr | amopstrategy -----------------------+-------------- @@(tsvector,tsquery) | 1 matching search query @@@(tsvector,tsquery) | 2 synonym for @@ (for backward compatibility) (2 rows)</code> </pre><br> æ¥ä¸‹æ¥ï¼Œåœ¨è¯ç´ çš„Bæ ‘ä¸­ï¼Œæ‰¾åˆ°è¿™ä¸¤ä¸ªé”®ï¼Œå¹¶ä»”ç»†æŸ¥çœ‹TIDçš„åˆ—è¡¨ã€‚ æˆ‘ä»¬å¾—åˆ°ï¼š <br><br> ä¸ºâ€œ maniâ€-ï¼ˆ0,2ï¼‰ã€‚ <br> å¯¹äºâ€œåˆ†ç‰‡â€-ï¼ˆ0,1ï¼‰ï¼Œï¼ˆ0,2ï¼‰ï¼Œï¼ˆ1,2ï¼‰ï¼Œï¼ˆ1,3ï¼‰ï¼Œï¼ˆ2,2ï¼‰ã€‚ <br><br><img src="https://habrastorage.org/webt/mg/qc/do/mgqcdou-xlhsztvkxii5qluc5rq.png"><br><br> æœ€åï¼Œå¯¹äºæ‰¾åˆ°çš„æ¯ä¸ªTIDï¼Œå°†è°ƒç”¨APIä¸€è‡´æ€§å‡½æ•°ï¼Œè¯¥å‡½æ•°å¿…é¡»ç¡®å®šæ‰¾åˆ°çš„å“ªäº›è¡Œä¸æœç´¢æŸ¥è¯¢åŒ¹é…ã€‚ ç”±äºæŸ¥è¯¢ä¸­çš„è¯ç´ ç”±å¸ƒå°”â€œå’Œâ€è¿æ¥ï¼Œå› æ­¤è¿”å›çš„å”¯ä¸€è¡Œæ˜¯ï¼ˆ0,2ï¼‰ï¼š <br><br><pre> <code class="plaintext hljs"> | | | consistency | | | function TID | mani | slitter | slit &amp; slitter -------+------+---------+---------------- (0,1) | f | T | f (0,2) | T | T | T (1,2) | f | T | f (1,3) | f | T | f (2,2) | f | T | f</code> </pre><br> ç»“æœæ˜¯ï¼š <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> doc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> doc_tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'many &amp; slitter'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> doc --------------------------------------------- How many sheets could a sheet slitter slit? (1 row)</code> </pre><br> å¦‚æœå°†è¿™ç§æ–¹æ³•ä¸å·²ç»é’ˆå¯¹GiSTè®¨è®ºçš„æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™GINåœ¨å…¨æ–‡æœç´¢ä¸­çš„ä¼˜åŠ¿æ˜¾è€Œæ˜“è§ã€‚ ä½†è¿™ä¸åªæ˜¯ä»¤äººçœ¼å‰ä¸€äº®ã€‚ <br><br><h3> æ›´æ–°ç¼“æ…¢çš„é—®é¢˜ </h3><br> äº‹å®æ˜¯ï¼ŒGINç´¢å¼•ä¸­çš„æ•°æ®æ’å…¥æˆ–æ›´æ–°éå¸¸æ…¢ã€‚ æ¯ä¸ªæ–‡æ¡£é€šå¸¸åŒ…å«è®¸å¤šè¦ç´¢å¼•çš„è¯ç´ ã€‚ å› æ­¤ï¼Œå½“ä»…æ·»åŠ æˆ–æ›´æ–°ä¸€ä¸ªæ–‡æ¡£æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»å¤§é‡æ›´æ–°ç´¢å¼•æ ‘ã€‚ <br><br> å¦ä¸€æ–¹é¢ï¼Œå¦‚æœåŒæ—¶æ›´æ–°å‡ ä¸ªæ–‡æ¡£ï¼Œåˆ™å®ƒä»¬çš„æŸäº›è¯ç´ å¯èƒ½ç›¸åŒï¼Œå¹¶ä¸”æ€»å·¥ä½œé‡å°†å°äºä¸€æ¬¡ä¸€ä¸ªåœ°æ›´æ–°æ–‡æ¡£æ—¶çš„å·¥ä½œé‡ã€‚ <br><br>  GINç´¢å¼•å…·æœ‰â€œ fastupdateâ€å­˜å‚¨å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ›å»ºç´¢å¼•æ—¶æŒ‡å®šå®ƒï¼Œå¹¶åœ¨ä»¥åæ›´æ–°ï¼š <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(doc_tsv) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> (fastupdate = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre><br> å¯ç”¨æ­¤å‚æ•°åï¼Œæ›´æ–°å°†ç´¯ç§¯åœ¨å•ç‹¬çš„æ— åºåˆ—è¡¨ä¸­ï¼ˆåœ¨å„ä¸ªè¿æ¥çš„é¡µé¢ä¸Šï¼‰ã€‚ å½“æ­¤åˆ—è¡¨è¶³å¤Ÿå¤§æ—¶æˆ–åœ¨æ¸…ç†æœŸé—´ï¼Œæ‰€æœ‰ç´¯ç§¯çš„æ›´æ–°å°†ç«‹å³å¯¹ç´¢å¼•è¿›è¡Œã€‚ å“ªäº›åˆ—è¡¨è¢«è®¤ä¸ºâ€œè¶³å¤Ÿå¤§â€ç”±é…ç½®å‚æ•°â€œ gin_pending_list_limitâ€æˆ–ç´¢å¼•çš„åŒåå­˜å‚¨å‚æ•°ç¡®å®šã€‚ <br><br> ä½†æ˜¯è¿™ç§æ–¹æ³•æœ‰ç¼ºç‚¹ï¼šé¦–å…ˆï¼Œæœç´¢é€Ÿåº¦å˜æ…¢ï¼ˆå› ä¸ºé™¤äº†æ ‘ä¹‹å¤–è¿˜éœ€è¦æµè§ˆæ— åºåˆ—è¡¨ï¼‰ï¼Œå…¶æ¬¡ï¼Œå¦‚æœæ— åºåˆ—è¡¨å·²æº¢å‡ºï¼Œåˆ™ä¸‹ä¸€æ¬¡æ›´æ–°å¯èƒ½ä¼šæ„å¤–åœ°èŠ±è´¹å¤§é‡æ—¶é—´ã€‚ <br><br><h3> æœç´¢éƒ¨åˆ†åŒ¹é… </h3><br> æˆ‘ä»¬å¯ä»¥åœ¨å…¨æ–‡æœç´¢ä¸­ä½¿ç”¨éƒ¨åˆ†åŒ¹é…ã€‚ ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æŸ¥è¯¢ï¼š <br><br><pre> <code class="pgsql hljs">gin=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> doc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> doc_tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'slit:*'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> doc -------------------------------------------------------- Can a sheet slitter slit sheets? How many sheets could a sheet slitter slit? I slit a sheet, a sheet I slit. Upon a slitted sheet I sit. Whoever slit the sheets is a good sheet slitter. I am a sheet slitter. I slit sheets. I am the sleekest sheet slitter that ever slit sheets. She slits the sheet she sits on. (9 rows)</code> </pre><br> è¯¥æŸ¥è¯¢å°†æŸ¥æ‰¾åŒ…å«ä»¥â€œ slitâ€å¼€å¤´çš„è¯ç´ çš„æ–‡æ¡£ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œè¿™æ ·çš„è¯ç´ æ˜¯â€œç‹­ç¼â€å’Œâ€œåˆ†åˆ‡â€ã€‚ <br><br> å³ä½¿æ²¡æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢å½“ç„¶ä¹Ÿå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯GINè¿˜å¯ä»¥åŠ å¿«ä»¥ä¸‹æœç´¢çš„é€Ÿåº¦ï¼š <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> doc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> doc_tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'slit:*'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ------------------------------------------------------------- Bitmap Heap Scan on ts Recheck Cond: (doc_tsv @@ to_tsquery('slit:*'::text)) -&gt; Bitmap Index Scan on ts_doc_tsv_idx Index Cond: (doc_tsv @@ to_tsquery('slit:*'::text)) (4 rows)</code> </pre><br> åœ¨è¿™é‡Œï¼Œåœ¨æ ‘ä¸­æŸ¥æ‰¾æ‰€æœ‰åœ¨æœç´¢æŸ¥è¯¢ä¸­æŒ‡å®šäº†å‰ç¼€çš„è¯ç´ ï¼Œå¹¶ç”¨å¸ƒå°”â€œæˆ–â€å°†å…¶è¿æ¥èµ·æ¥ã€‚ <br><br><h3> é¢‘ç¹å’Œä¸é¢‘ç¹çš„å£è¯­ </h3><br> ä¸ºäº†è§‚å¯Ÿç´¢å¼•å¦‚ä½•å¤„ç†å®æ—¶æ•°æ®ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹â€œ pgsql-hackersâ€ç”µå­é‚®ä»¶çš„å­˜æ¡£ï¼Œåœ¨è®¨è®ºGiSTæ—¶æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†å®ƒã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤ç‰ˆæœ¬çš„å­˜æ¡£</a>åŒ…å«356125æ¡æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«å‘é€æ—¥æœŸï¼Œä¸»é¢˜ï¼Œä½œè€…å’Œæ–‡æœ¬ã€‚ <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> tsv <span class="hljs-type"><span class="hljs-type">tsvector</span></span>; fts=# <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> tsv = to_tsvector(body_plain);</code> </pre><pre> <code class="plaintext hljs">NOTICE: word is too long to be indexed DETAIL: Words longer than 2047 characters are ignored. ... UPDATE 356125</code> </pre><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(tsv);</code> </pre><br> è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹å‡ºç°åœ¨è®¸å¤šæ–‡æ¡£ä¸­çš„è¯ç´ ã€‚ ä½¿ç”¨â€œ unnestâ€çš„æŸ¥è¯¢å°†æ— æ³•å¤„ç†å¦‚æ­¤å¤§çš„æ•°æ®é‡ï¼Œæ­£ç¡®çš„æŠ€æœ¯æ˜¯ä½¿ç”¨â€œ ts_statâ€åŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½æä¾›æœ‰å…³è¯ç´ ï¼Œå‡ºç°å®ƒä»¬çš„æ–‡æ¡£æ•°ä»¥åŠå‡ºç°æ€»æ•°çš„ä¿¡æ¯ã€‚ <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> word, ndoc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts_stat(<span class="hljs-string"><span class="hljs-string">'select tsv from mail_messages'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> ndoc <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre><pre> <code class="plaintext hljs"> word | ndoc -------+-------- re | 322141 wrote | 231174 use | 176917 (3 rows)</code> </pre><br> è®©æˆ‘ä»¬é€‰æ‹©â€œå†™â€ã€‚ <br><br> è€Œä¸”ï¼Œæˆ‘ä»¬ä¼šç”¨ä¸€äº›ä¸å¸¸è§çš„å•è¯ä½œä¸ºå¼€å‘äººå‘˜çš„ç”µå­é‚®ä»¶ï¼Œä¾‹å¦‚â€œçº¹èº«â€ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> word, ndoc <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ts_stat(<span class="hljs-string"><span class="hljs-string">'select tsv from mail_messages'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> word = <span class="hljs-string"><span class="hljs-string">'tattoo'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> word | ndoc --------+------ tattoo | 2 (1 row)</code> </pre><br> è¿™ä¸¤ä¸ªè¯ç´ éƒ½å‡ºç°äº†å—ï¼Ÿ çœ‹æ¥æœ‰ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'wrote &amp; tattoo'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> count ------- 1 (1 row)</code> </pre><br> å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•æ‰§è¡Œæ­¤æŸ¥è¯¢ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œå¦‚æœæˆ‘ä»¬è·å¾—ä¸¤ä¸ªè¯ç´ çš„TIDåˆ—è¡¨ï¼Œåˆ™æœç´¢æ˜¾ç„¶æ•ˆç‡ä½ä¸‹ï¼šæˆ‘ä»¬å°†å¿…é¡»éå†20ä¸‡å¤šä¸ªå€¼ï¼Œåªå‰©ä¸‹å…¶ä¸­ä¸€ä¸ªã€‚ å¹¸è¿çš„æ˜¯ï¼Œä½¿ç”¨è®¡åˆ’ç¨‹åºç»Ÿè®¡ä¿¡æ¯ï¼Œè¯¥ç®—æ³•å¯ä»¥äº†è§£åˆ°â€œå†™â€è¯ä½ç»å¸¸å‡ºç°ï¼Œè€Œâ€œ tatooâ€åˆ™å¾ˆå°‘å‡ºç°ã€‚ å› æ­¤ï¼Œæ‰§è¡Œä¸ç»å¸¸ä½¿ç”¨çš„è¯ç´ çš„æœç´¢ï¼Œç„¶åæ£€æŸ¥æ£€ç´¢åˆ°çš„ä¸¤ä¸ªæ–‡æ¡£ä¸­æ˜¯å¦å­˜åœ¨â€œå†™â€è¯ç´ ã€‚ ä»æŸ¥è¯¢ä¸­å¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹å‡ºè¿™ä¸€ç‚¹ï¼Œå®ƒå¯ä»¥å¿«é€Ÿæ‰§è¡Œï¼š <br><br><pre> <code class="pgsql hljs">fts=# \<span class="hljs-keyword"><span class="hljs-keyword">timing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'wrote &amp; tattoo'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> count ------- 1 (1 row) Time: 0,959 ms</code> </pre><br> ä»…æœç´¢â€œ wroteâ€è¦èŠ±è´¹æ›´é•¿çš„æ—¶é—´ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'wrote'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> count -------- 231174 (1 row) Time: 2875,543 ms (00:02,876)</code> </pre><br> å½“ç„¶ï¼Œè¿™ç§ä¼˜åŒ–ä¸ä»…é€‚ç”¨äºä¸¤ä¸ªè¯ç´ ï¼Œè€Œä¸”åœ¨æ›´å¤æ‚çš„æƒ…å†µä¸‹ä¹Ÿé€‚ç”¨ã€‚ <br><br><h3> é™åˆ¶æŸ¥è¯¢ç»“æœ </h3><br>  GINè®¿é—®æ–¹æ³•çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œç»“æœæ€»æ˜¯ä»¥ä½å›¾çš„å½¢å¼è¿”å›ï¼šè¯¥æ–¹æ³•ä¸èƒ½æŒ‰TIDè¿”å›ç»“æœTIDã€‚ å› æ­¤ï¼Œæœ¬æ–‡ä¸­çš„æ‰€æœ‰æŸ¥è¯¢è®¡åˆ’éƒ½ä½¿ç”¨ä½å›¾æ‰«æã€‚ <br><br> å› æ­¤ï¼Œä½¿ç”¨LIMITå­å¥é™åˆ¶ç´¢å¼•æ‰«æç»“æœçš„æ•ˆç‡ä¸æ˜¯å¾ˆé«˜ã€‚ æ³¨æ„æ“ä½œçš„é¢„è®¡æˆæœ¬ï¼ˆâ€œé™åˆ¶â€èŠ‚ç‚¹çš„â€œæˆæœ¬â€å­—æ®µï¼‰ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'wrote'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ----------------------------------------------------------------------------------------- Limit (cost=1283.61..1285.13 rows=1) -&gt; Bitmap Heap Scan on mail_messages (cost=1283.61..209975.49 rows=137207) Recheck Cond: (tsv @@ to_tsquery('wrote'::text)) -&gt; Bitmap Index Scan on mail_messages_tsv_idx (cost=0.00..1249.30 rows=137207) Index Cond: (tsv @@ to_tsquery('wrote'::text)) (5 rows)</code> </pre><br> ä¼°è®¡æˆæœ¬ä¸º1285.13ï¼Œè¿™æ¯”æ„å»ºæ•´ä¸ªä½å›¾1249.30ï¼ˆä½å›¾ç´¢å¼•æ‰«æèŠ‚ç‚¹çš„â€œæˆæœ¬â€å­—æ®µï¼‰çš„æˆæœ¬è¦å¤§ä¸€äº›ã€‚ <br><br> å› æ­¤ï¼Œç´¢å¼•å…·æœ‰é™åˆ¶ç»“æœæ•°é‡çš„ç‰¹æ®ŠåŠŸèƒ½ã€‚ é˜ˆå€¼åœ¨â€œ gin_fuzzy_search_limitâ€é…ç½®å‚æ•°ä¸­æŒ‡å®šï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ç­‰äºé›¶ï¼ˆæ²¡æœ‰é™åˆ¶ï¼‰ã€‚ ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®¾ç½®é˜ˆå€¼ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> gin_fuzzy_search_limit = <span class="hljs-number"><span class="hljs-number">1000</span></span>; fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'wrote'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> count ------- 5746 (1 row)</code> </pre><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> gin_fuzzy_search_limit = <span class="hljs-number"><span class="hljs-number">10000</span></span>; fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tsv @@ to_tsquery(<span class="hljs-string"><span class="hljs-string">'wrote'</span></span>);</code> </pre><pre> <code class="plaintext hljs"> count ------- 14726 (1 row)</code> </pre><br> å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå¯¹äºä¸åŒçš„å‚æ•°å€¼ï¼ˆå¦‚æœä½¿ç”¨ç´¢å¼•è®¿é—®ï¼‰ï¼ŒæŸ¥è¯¢è¿”å›çš„è¡Œæ•°ä¼šæœ‰æ‰€ä¸åŒã€‚ é™åˆ¶å¹¶ä¸ä¸¥æ ¼ï¼šå¯ä»¥è¿”å›å¤šäºæŒ‡å®šè¡Œçš„è¡Œï¼Œè¿™è¯æ˜å‚æ•°åç§°çš„â€œæ¨¡ç³Šâ€éƒ¨åˆ†æ˜¯åˆç†çš„ã€‚ <br><br><h3> ç´§å‡‘çš„è¡¨ç¤º </h3><br> åœ¨å…¶ä»–æ–¹é¢ï¼Œç”±äºå…¶ç´§å‡‘æ€§ï¼ŒGINç´¢å¼•å¾ˆå¥½ã€‚ é¦–å…ˆï¼Œå¦‚æœåœ¨å¤šä¸ªæ–‡æ¡£ä¸­å‡ºç°ç›¸åŒçš„è¯ç´ ï¼ˆé€šå¸¸æ˜¯è¿™ç§æƒ…å†µï¼‰ï¼Œåˆ™å®ƒä»…åœ¨ç´¢å¼•ä¸­å­˜å‚¨ä¸€æ¬¡ã€‚ å…¶æ¬¡ï¼ŒTIDä»¥æœ‰åºçš„æ–¹å¼å­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨ä¸€ç§ç®€å•çš„å‹ç¼©æ–¹å¼ï¼šåˆ—è¡¨ä¸­çš„æ¯ä¸ªä¸‹ä¸€ä¸ªTIDå®é™…ä¸Šéƒ½å­˜å‚¨ä¸ºä¸ä¸Šä¸€ä¸ªTIDçš„ä¸åŒï¼› è¿™é€šå¸¸æ˜¯ä¸€ä¸ªå¾ˆå°çš„æ•°å­—ï¼Œä¸å®Œæ•´çš„å…­å­—èŠ‚TIDç›¸æ¯”ï¼Œæ‰€éœ€çš„ä½æ•°è¦å°‘å¾—å¤šã€‚ <br><br> ä¸ºäº†äº†è§£å…¶å¤§å°ï¼Œè®©æˆ‘ä»¬ä»æ¶ˆæ¯æ–‡æœ¬æ„å»ºBæ ‘ã€‚ ä½†æ˜¯ï¼Œè‚¯å®šä¸ä¼šå‘ç”Ÿå…¬å¹³çš„æ¯”è¾ƒï¼š <br><br><ul><li>  GINå»ºç«‹åœ¨å…¶ä»–è¾ƒå°çš„æ•°æ®ç±»å‹ï¼ˆâ€œ tsvectorâ€è€Œéâ€œ textâ€ï¼‰ä¸Šï¼Œ </li><li> åŒæ—¶ï¼ŒBæ ‘çš„æ¶ˆæ¯å¤§å°å¿…é¡»ç¼©çŸ­åˆ°å¤§çº¦2 KBã€‚ </li></ul><br> å°½ç®¡å¦‚æ­¤ï¼Œæˆ‘ä»¬ç»§ç»­ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> mail_messages_btree <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> mail_messages(substring(body_plain <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">2048</span></span>));</code> </pre><br> æˆ‘ä»¬è¿˜å°†å»ºç«‹GiSTç´¢å¼•ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> mail_messages_gist <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> mail_messages <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gist(tsv);</code> </pre><br>  â€œçœŸç©ºå·²æ»¡â€æ—¶çš„ç´¢å¼•å¤§å°ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> pg_size_pretty(pg_relation_size(<span class="hljs-string"><span class="hljs-string">'mail_messages_tsv_idx'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> gin, pg_size_pretty(pg_relation_size(<span class="hljs-string"><span class="hljs-string">'mail_messages_gist'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> gist, pg_size_pretty(pg_relation_size(<span class="hljs-string"><span class="hljs-string">'mail_messages_btree'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> btree;</code> </pre><pre> <code class="plaintext hljs"> gin | gist | btree --------+--------+-------- 179 MB | 125 MB | 546 MB (1 row)</code> </pre><br> ç”±äºè¡¨ç¤ºçš„ç´§å‡‘æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•åœ¨ä»Oracleè¿ç§»è¿‡ç¨‹ä¸­ä½¿ç”¨GINç´¢å¼•æ¥ä»£æ›¿ä½å›¾ç´¢å¼•ï¼ˆåœ¨æ­¤ä¸åšè¯¦ç»†ä»‹ç»ï¼Œå‡ºäºå¥½å¥‡å¿ƒï¼Œæˆ‘ä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lewisçš„æ–‡ç« </a>æä¾›<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">äº†å‚è€ƒ</a> ï¼‰ã€‚ é€šå¸¸ï¼Œä½å›¾ç´¢å¼•ç”¨äºå”¯ä¸€å€¼å¾ˆå°‘çš„å­—æ®µï¼Œè¿™å¯¹äºGINä¹Ÿéå¸¸æœ‰ç”¨ã€‚ è€Œä¸”ï¼Œå¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€ç¯‡æ–‡ç« </a>æ‰€ç¤ºï¼ŒPostgreSQLå¯ä»¥åŸºäºä»»ä½•ç´¢å¼•ï¼ˆåŒ…æ‹¬GINï¼‰åŠ¨æ€æ„å»ºä½å›¾ã€‚ <br><br><h3> æ˜¯GiSTè¿˜æ˜¯GINï¼Ÿ </h3><br> å¯¹äºè®¸å¤šæ•°æ®ç±»å‹ï¼ŒGiSTå’ŒGINéƒ½å¯ä»¥ä½¿ç”¨è¿ç®—ç¬¦ç±»ï¼Œè¿™å¼•èµ·äº†ä½¿ç”¨å“ªä¸ªç´¢å¼•çš„é—®é¢˜ã€‚ ä¹Ÿè®¸ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å¾—å‡ºä¸€äº›ç»“è®ºã€‚ <br><br> é€šå¸¸ï¼ŒGINåœ¨å‡†ç¡®æ€§å’Œæœç´¢é€Ÿåº¦ä¸Šå‡èƒœè¿‡GiSTã€‚ å¦‚æœæ•°æ®æ›´æ–°ä¸é¢‘ç¹å¹¶ä¸”éœ€è¦å¿«é€Ÿæœç´¢ï¼Œåˆ™å¾ˆå¯èƒ½ä¼šé€‰æ‹©GINã€‚ <br><br> å¦ä¸€æ–¹é¢ï¼Œå¦‚æœå¯¹æ•°æ®è¿›è¡Œå¯†é›†æ›´æ–°ï¼Œåˆ™æ›´æ–°GINçš„å¼€é”€æˆæœ¬å¯èƒ½çœ‹èµ·æ¥å¤ªå¤§ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸æ¯”è¾ƒè¿™ä¸¤ç§é€‰æ‹©ï¼Œå¹¶é€‰æ‹©å…¶ç‰¹å¾æ›´å¥½åœ°å¹³è¡¡çš„é€‰æ‹©ã€‚ <br><br><h2> æ•°ç»„ </h2><br> ä½¿ç”¨GINçš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯æ•°ç»„çš„ç´¢å¼•ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°ç»„å…ƒç´ è¿›å…¥ç´¢å¼•ï¼Œè¿™å¯ä»¥åŠ å¿«å¯¹æ•°ç»„çš„å¤§é‡æ“ä½œï¼š <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> amop.amopopr::<span class="hljs-type"><span class="hljs-type">regoperator</span></span>, amop.amopstrategy <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_opclass opc, pg_opfamily opf, pg_am am, pg_amop amop <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> opc.opcname = <span class="hljs-string"><span class="hljs-string">'array_ops'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> opf.oid = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.oid = opf.opfmethod <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amopfamily = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.amname = <span class="hljs-string"><span class="hljs-string">'gin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amoplefttype = opc.opcintype;</code> </pre><pre> <code class="plaintext hljs"> amopopr | amopstrategy -----------------------+-------------- &amp;&amp;(anyarray,anyarray) | 1 intersection @&gt;(anyarray,anyarray) | 2 contains array &lt;@(anyarray,anyarray) | 3 contained in array =(anyarray,anyarray) | 4 equality (4 rows)</code> </pre><br> æˆ‘ä»¬çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ¼”ç¤ºæ•°æ®åº“</a>å…·æœ‰â€œè·¯çº¿â€è§†å›¾ä»¥åŠèˆªç­ä¿¡æ¯ã€‚ åœ¨å…¶ä½™è§†å›¾ä¸­ï¼Œæ­¤è§†å›¾åŒ…å«â€œ days_of_weekâ€åˆ—-å‘ç”Ÿèˆªç­çš„å·¥ä½œæ—¥æ•°ç»„ã€‚ ä¾‹å¦‚ï¼Œä»ä¼åŠªç§‘æ²ƒé£å¾€æ ¼è¿å‰å…‹çš„èˆªç­åœ¨æ˜ŸæœŸäºŒï¼Œæ˜ŸæœŸå››å’Œæ˜ŸæœŸæ—¥å‡ºå‘ï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> departure_airport_name, arrival_airport_name, days_of_week <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> flight_no = <span class="hljs-string"><span class="hljs-string">'PG0049'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> departure_airport_name | arrival_airport_name | days_of_week ------------------------+----------------------+-------------- Vnukovo | Gelendzhik | {2,4,7} (1 row)</code> </pre><br> ä¸ºäº†å»ºç«‹ç´¢å¼•ï¼Œè®©æˆ‘ä»¬å°†è§†å›¾â€œç‰©åŒ–â€åˆ°è¡¨ä¸­ï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes; demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(days_of_week);</code> </pre><br><br> ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥ç´¢å¼•æ¥äº†è§£åœ¨æ˜ŸæœŸäºŒï¼Œæ˜ŸæœŸå››å’Œæ˜ŸæœŸæ—¥å‡ºå‘çš„æ‰€æœ‰èˆªç­ï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> days_of_week = <span class="hljs-keyword"><span class="hljs-keyword">ARRAY</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>];</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ----------------------------------------------------------- Bitmap Heap Scan on routes_t Recheck Cond: (days_of_week = '{2,4,7}'::integer[]) -&gt; Bitmap Index Scan on routes_t_days_of_week_idx Index Cond: (days_of_week = '{2,4,7}'::integer[]) (4 rows)</code> </pre><br> çœ‹æ¥å…¶ä¸­æœ‰å…­ä¸ªï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> flight_no, departure_airport_name, arrival_airport_name, days_of_week <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> days_of_week = <span class="hljs-keyword"><span class="hljs-keyword">ARRAY</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>];</code> </pre><pre> <code class="plaintext hljs"> flight_no | departure_airport_name | arrival_airport_name | days_of_week -----------+------------------------+----------------------+-------------- PG0005 | Domodedovo | Pskov | {2,4,7} PG0049 | Vnukovo | Gelendzhik | {2,4,7} PG0113 | Naryan-Mar | Domodedovo | {2,4,7} PG0249 | Domodedovo | Gelendzhik | {2,4,7} PG0449 | Stavropol | Vnukovo | {2,4,7} PG0540 | Barnaul | Vnukovo | {2,4,7} (6 rows)</code> </pre><br> è¯¥æŸ¥è¯¢å¦‚ä½•æ‰§è¡Œï¼Ÿ ä¸ä¸Šè¿°æ–¹æ³•å®Œå…¨ç›¸åŒï¼š <br><br><ol><li> ä»æ­¤å¤„èµ·æœç´¢æŸ¥è¯¢ä½œç”¨çš„æ•°ç»„{2,4,7}ä¸­æå–å…ƒç´ ï¼ˆæœç´¢å…³é”®å­—ï¼‰ã€‚ æ˜¾ç„¶ï¼Œè¿™äº›æ˜¯â€œ 2â€ï¼Œâ€œ 4â€å’Œâ€œ 7â€çš„å€¼ã€‚ <br></li><li> åœ¨å…ƒç´ æ ‘ä¸­ï¼Œæ‰¾åˆ°æå–çš„é”®ï¼Œå¹¶ä¸ºæ¯ä¸ªé”®é€‰æ‹©TIDåˆ—è¡¨ã€‚ <br></li><li> åœ¨æ‰¾åˆ°çš„æ‰€æœ‰TIDä¸­ï¼Œä¸€è‡´æ€§åŠŸèƒ½ä¼šä»æŸ¥è¯¢ä¸­é€‰æ‹©ä¸è¿ç®—ç¬¦åŒ¹é…çš„TIDã€‚ å¯¹äº<code>=</code>è¿ç®—ç¬¦ï¼Œåªæœ‰é‚£äº›TIDåŒ¹é…å‡ºç°åœ¨æ‰€æœ‰ä¸‰ä¸ªåˆ—è¡¨ä¸­çš„TIDï¼ˆæ¢å¥è¯è¯´ï¼Œåˆå§‹æ•°ç»„å¿…é¡»åŒ…å«æ‰€æœ‰å…ƒç´ ï¼‰ã€‚ ä½†è¿™è¿˜ä¸å¤Ÿï¼šæ•°ç»„è¿˜éœ€è¦ä¸åŒ…å«ä»»ä½•å…¶ä»–å€¼ï¼Œå¹¶ä¸”æˆ‘ä»¬æ— æ³•ä½¿ç”¨ç´¢å¼•æ£€æŸ¥æ­¤æ¡ä»¶ã€‚ å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¿é—®æ–¹æ³•è¦æ±‚ç´¢å¼•å¼•æ“é‡æ–°æ£€æŸ¥ä¸è¡¨ä¸€èµ·è¿”å›çš„æ‰€æœ‰TIDã€‚ <br></li></ol><br> æœ‰è¶£çš„æ˜¯ï¼Œæœ‰äº›ç­–ç•¥ï¼ˆä¾‹å¦‚â€œåŒ…å«åœ¨æ•°ç»„ä¸­â€ï¼‰æ— æ³•æ£€æŸ¥ä»»ä½•å†…å®¹ï¼Œè€Œå¿…é¡»é‡æ–°æ£€æŸ¥åœ¨è¡¨ä¸­æ‰¾åˆ°çš„æ‰€æœ‰TIDã€‚ <br><br> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦çŸ¥é“å‘¨äºŒï¼Œå‘¨å››å’Œå‘¨æ—¥ä»è«æ–¯ç§‘å‡ºå‘çš„èˆªç­æ€ä¹ˆåŠï¼Ÿ ç´¢å¼•ä¸æ”¯æŒå…¶ä»–æ¡ä»¶ï¼Œè¯¥æ¡ä»¶å°†è¿›å…¥â€œè¿‡æ»¤å™¨â€åˆ—ã€‚ <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> days_of_week = <span class="hljs-keyword"><span class="hljs-keyword">ARRAY</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> departure_city = <span class="hljs-string"><span class="hljs-string">'Moscow'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ----------------------------------------------------------- Bitmap Heap Scan on routes_t Recheck Cond: (days_of_week = '{2,4,7}'::integer[]) Filter: (departure_city = 'Moscow'::text) -&gt; Bitmap Index Scan on routes_t_days_of_week_idx Index Cond: (days_of_week = '{2,4,7}'::integer[]) (5 rows)</code> </pre><br> æ­¤å¤„å¯ä»¥ï¼ˆç´¢å¼•ä»…é€‰æ‹©å…­è¡Œï¼‰ï¼Œä½†æ˜¯åœ¨é™„åŠ æ¡ä»¶å¢åŠ äº†é€‰æ‹©èƒ½åŠ›çš„æƒ…å†µä¸‹ï¼Œå¸Œæœ›æœ‰è¿™æ ·çš„æ”¯æŒã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸èƒ½åªåˆ›å»ºç´¢å¼•ï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(days_of_week,departure_city);</code> </pre><pre> <code class="plaintext hljs">ERROR: data type text has no default operator class for access method "gin" HINT: You must specify an operator class for the index or define a default operator class for the data type.</code> </pre><br> ä½†æ˜¯â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">btree_gin</a> â€æ‰©å±•åä¼šæœ‰æ‰€å¸®åŠ©ï¼Œå®ƒæ·»åŠ äº†GINè¿ç®—ç¬¦ç±»æ¥æ¨¡æ‹Ÿå¸¸è§„Bæ ‘çš„å·¥ä½œã€‚ <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> btree_gin; demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(days_of_week,departure_city); demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_t <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> days_of_week = <span class="hljs-keyword"><span class="hljs-keyword">ARRAY</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> departure_city = <span class="hljs-string"><span class="hljs-string">'Moscow'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN --------------------------------------------------------------------- Bitmap Heap Scan on routes_t Recheck Cond: ((days_of_week = '{2,4,7}'::integer[]) AND (departure_city = 'Moscow'::text)) -&gt; Bitmap Index Scan on routes_t_days_of_week_departure_city_idx Index Cond: ((days_of_week = '{2,4,7}'::integer[]) AND (departure_city = 'Moscow'::text)) (4 rows)</code> </pre><br><h2> æ°æ£® </h2><br> å…·æœ‰å†…ç½®GINæ”¯æŒçš„å¤åˆæ•°æ®ç±»å‹çš„å¦ä¸€ä¸ªç¤ºä¾‹æ˜¯JSONã€‚ ä¸ºäº†ä½¿ç”¨JSONå€¼ï¼Œç›®å‰å®šä¹‰äº†è®¸å¤šè¿ç®—ç¬¦å’Œå‡½æ•°ï¼Œå…¶ä¸­ä¸€äº›å¯ä»¥ä½¿ç”¨ç´¢å¼•åŠ å¿«ï¼š <br><br><pre> <code class="pgsql hljs">postgres=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> opc.opcname, amop.amopopr::<span class="hljs-type"><span class="hljs-type">regoperator</span></span>, amop.amopstrategy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> str <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_opclass opc, pg_opfamily opf, pg_am am, pg_amop amop <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> opc.opcname <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'jsonb_ops'</span></span>,<span class="hljs-string"><span class="hljs-string">'jsonb_path_ops'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> opf.oid = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.oid = opf.opfmethod <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amopfamily = opc.opcfamily <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> am.amname = <span class="hljs-string"><span class="hljs-string">'gin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> amop.amoplefttype = opc.opcintype;</code> </pre><pre> <code class="plaintext hljs"> opcname | amopopr | str ----------------+------------------+----- jsonb_ops | ?(jsonb,text) | 9 top-level key exists jsonb_ops | ?|(jsonb,text[]) | 10 some top-level key exists jsonb_ops | ?&amp;(jsonb,text[]) | 11 all top-level keys exist jsonb_ops | @&gt;(jsonb,jsonb) | 7 JSON value is at top level jsonb_path_ops | @&gt;(jsonb,jsonb) | 7 (5 rows)</code> </pre><br> å¦‚æˆ‘ä»¬æ‰€è§ï¼Œæœ‰ä¸¤ä¸ªæ“ä½œç¬¦ç±»å¯ç”¨ï¼šâ€œ jsonb_opsâ€å’Œâ€œ jsonb_path_opsâ€ã€‚ <br><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨ç¬¬ä¸€ä¸ªè¿ç®—ç¬¦ç±»â€œ jsonb_opsâ€ã€‚ æ‰€æœ‰é”®ï¼Œå€¼å’Œæ•°ç»„å…ƒç´ éƒ½å°†ä½œä¸ºåˆå§‹JSONæ–‡æ¡£çš„å…ƒç´ åˆ°è¾¾ç´¢å¼•ã€‚ å°†å±æ€§æ·»åŠ åˆ°è¿™äº›å…ƒç´ ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œä»¥æŒ‡ç¤ºè¯¥å…ƒç´ æ˜¯å¦ä¸ºé”®ï¼ˆâ€œå­˜åœ¨â€ç­–ç•¥éœ€è¦æ­¤å±æ€§ï¼Œä»¥åŒºåˆ†é”®å’Œå€¼ï¼‰ã€‚ <br><br> ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬å°†â€œ routesâ€ä¸­çš„å‡ è¡Œè¡¨ç¤ºä¸ºJSONï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> routes_jsonb <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> to_jsonb(t) route <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> departure_airport_name, arrival_airport_name, days_of_week <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> flight_no <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> ) t; demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> ctid, jsonb_pretty(route) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_jsonb;</code> </pre><pre> <code class="plaintext hljs"> ctid | jsonb_pretty -------+------------------------------------------------- (0,1) | { + | "days_of_week": [ + | 1 + | ], + | "arrival_airport_name": "Surgut", + | "departure_airport_name": "Ust-Ilimsk" + | } (0,2) | { + | "days_of_week": [ + | 2 + | ], + | "arrival_airport_name": "Ust-Ilimsk", + | "departure_airport_name": "Surgut" + | } (0,3) | { + | "days_of_week": [ + | 1, + | 4 + | ], + | "arrival_airport_name": "Sochi", + | "departure_airport_name": "Ivanovo-Yuzhnyi"+ | } (0,4) | { + | "days_of_week": [ + | 2, + | 5 + | ], + | "arrival_airport_name": "Ivanovo-Yuzhnyi", + | "departure_airport_name": "Sochi" + | } (4 rows)</code> </pre><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> routes_jsonb <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> gin(route);</code> </pre><br><br> è¯¥ç´¢å¼•å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><img src="https://habrastorage.org/webt/oo/yi/x3/ooyix34gx7mrpiwdcol3a3ewnwu.png"><br><br> ç°åœ¨ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ç´¢å¼•æ‰§è¡Œå¦‚ä¸‹æŸ¥è¯¢ï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> jsonb_pretty(route) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_jsonb <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> route @&gt; <span class="hljs-string"><span class="hljs-string">'{"days_of_week": [5]}'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN --------------------------------------------------------------- Bitmap Heap Scan on routes_jsonb Recheck Cond: (route @&gt; '{"days_of_week": [5]}'::jsonb) -&gt; Bitmap Index Scan on routes_jsonb_route_idx Index Cond: (route @&gt; '{"days_of_week": [5]}'::jsonb) (4 rows)</code> </pre><br> ä»JSONæ–‡æ¡£çš„æ ¹å¼€å§‹ï¼Œ <code>@&gt;</code>è¿ç®—ç¬¦æ£€æŸ¥æ˜¯å¦å‘ç”Ÿäº†æŒ‡å®šçš„è·¯ç”±ï¼ˆ <code>"days_of_week": [5]</code> ï¼‰ã€‚ è¿™é‡Œçš„æŸ¥è¯¢å°†è¿”å›ä¸€è¡Œï¼š <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> jsonb_pretty(route) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> routes_jsonb <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> route @&gt; <span class="hljs-string"><span class="hljs-string">'{"days_of_week": [5]}'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> jsonb_pretty ------------------------------------------------ { + "days_of_week": [ + 2, + 5 + ], + "arrival_airport_name": "Ivanovo-Yuzhnyi",+ "departure_airport_name": "Sochi" + } (1 row)</code> </pre><br> æŸ¥è¯¢æ‰§è¡Œå¦‚ä¸‹ï¼š <br><br><ol><li> åœ¨æœç´¢æŸ¥è¯¢ï¼ˆ <code>"days_of_week": [5]</code> ï¼‰ä¸­ï¼Œæå–å…ƒç´ ï¼ˆæœç´¢å…³é”®å­—ï¼‰ï¼šâ€œ days_of_weekâ€å’Œâ€œ 5â€ã€‚ <br></li><li> åœ¨å…ƒç´ æ ‘ä¸­æ‰¾åˆ°æå–çš„é”®ï¼Œå¹¶ä¸ºæ¯ä¸ªé”®é€‰æ‹©TIDåˆ—è¡¨ï¼šå¯¹äºâ€œ 5â€-ï¼ˆ0.4ï¼‰ï¼Œå¯¹äºâ€œ days_of_weekâ€-ï¼ˆ0,1ï¼‰ï¼Œï¼ˆ0,2 ï¼‰ï¼Œï¼ˆ0.3ï¼‰ï¼Œï¼ˆ0.4ï¼‰ã€‚ <br></li><li> åœ¨æ‰¾åˆ°çš„æ‰€æœ‰TIDä¸­ï¼Œä¸€è‡´æ€§åŠŸèƒ½ä¼šä»æŸ¥è¯¢ä¸­é€‰æ‹©ä¸è¿ç®—ç¬¦åŒ¹é…çš„TIDã€‚ å¯¹äº<code>@&gt;</code>è¿ç®—ç¬¦ï¼Œè‚¯å®šä¸èƒ½åŒ…å«ä¸åŒ…å«æœç´¢æŸ¥è¯¢ä¸­æ‰€æœ‰å…ƒç´ çš„æ–‡æ¡£ï¼Œå› æ­¤ä»…ä¿ç•™ï¼ˆ0,4ï¼‰ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦é‡æ–°æ£€æŸ¥è¡¨å·¦ä¾§çš„TIDï¼Œå› ä¸ºä»ç´¢å¼•ä¸­ä¸æ¸…æ¥šæ‰€æ‰¾åˆ°çš„å…ƒç´ åœ¨JSONæ–‡æ¡£ä¸­çš„å‡ºç°é¡ºåºã€‚ <br></li></ol><br> è¦å‘ç°å…¶ä»–æ“ä½œå‘˜çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥é˜…è¯»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£</a> ã€‚ <br><br> é™¤äº†ç”¨äºå¤„ç†JSONçš„å¸¸è§„æ“ä½œå¤–ï¼Œâ€œ jsqueryâ€æ‰©å±•åæ—©å·²å¯ç”¨ï¼Œè¯¥æ‰©å±•åå®šä¹‰äº†ä¸€ç§å…·æœ‰æ›´ä¸°å¯ŒåŠŸèƒ½çš„æŸ¥è¯¢è¯­è¨€ï¼ˆå½“ç„¶ï¼Œè¿˜æ”¯æŒGINç´¢å¼•ï¼‰ã€‚ æ­¤å¤–ï¼Œ2016å¹´å‘å¸ƒäº†æ–°çš„SQLæ ‡å‡†ï¼Œè¯¥æ ‡å‡†å®šä¹‰äº†è‡ªå·±çš„æ“ä½œé›†å’ŒæŸ¥è¯¢è¯­è¨€â€œ SQL / JSONè·¯å¾„â€ã€‚ è¯¥æ ‡å‡†çš„å®ç°å·²ç»å®Œæˆï¼Œæˆ‘ä»¬ç›¸ä¿¡å®ƒå°†å‡ºç°åœ¨PostgreSQL 11ä¸­ã€‚ <br><br><blockquote>  SQL / JSONè·¯å¾„ä¿®è¡¥ç¨‹åºæœ€ç»ˆ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æäº¤</a>ç»™PostgreSQL 12ï¼Œè€Œå…¶ä»–ä¿®è¡¥ç¨‹åºä»åœ¨è¿›è¡Œä¸­ã€‚ å¸Œæœ›æˆ‘ä»¬èƒ½åœ¨PostgreSQL 13ä¸­çœ‹åˆ°å®Œå…¨å®ç°çš„åŠŸèƒ½ã€‚ <br></blockquote><br><h2> å†…éƒ¨æ„é€  </h2><br> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pageinspect</a> â€æ‰©å±•åæŸ¥çœ‹GINç´¢å¼•ã€‚ <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extension</span></span> pageinspect;</code> </pre><br>  metaé¡µé¢ä¸­çš„ä¿¡æ¯æ˜¾ç¤ºäº†å¸¸è§„ç»Ÿè®¡ä¿¡æ¯ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gin_metapage_info(get_raw_page(<span class="hljs-string"><span class="hljs-string">'mail_messages_tsv_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre><pre> <code class="plaintext hljs">-[ RECORD 1 ]----+----------- pending_head | 4294967295 pending_tail | 4294967295 tail_free_size | 0 n_pending_pages | 0 n_pending_tuples | 0 n_total_pages | 22968 n_entry_pages | 13751 n_data_pages | 9216 n_entries | 1423598 version | 2</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é¡µé¢ç»“æ„</a>æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„åŒºåŸŸï¼Œè®¿é—®æ–¹æ³•å¯ä»¥åœ¨å…¶ä¸­å­˜å‚¨å…¶ä¿¡æ¯ã€‚ å¯¹äºçœŸç©ºç­‰æ™®é€šç¨‹åºï¼Œè¯¥åŒºåŸŸæ˜¯â€œä¸é€æ˜çš„â€ã€‚  â€œ Gin_page_opaque_infoâ€å‡½æ•°æ˜¾ç¤ºGINçš„æ­¤æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£ç´¢å¼•é¡µé¢é›†ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> flags, count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> generate_series(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">22967</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> g(id), <span class="hljs-comment"><span class="hljs-comment">-- n_total_pages gin_page_opaque_info(get_raw_page('mail_messages_tsv_idx',g.id)) group by flags;</span></span></code> </pre><pre> <code class="plaintext hljs"> flags | count ------------------------+------- {meta} | 1 meta page {} | 133 internal page of element B-tree {leaf} | 13618 leaf page of element B-tree {data} | 1497 internal page of TID B-tree {data,leaf,compressed} | 7719 leaf page of TID B-tree (5 rows)</code> </pre><br>  â€œ Gin_leafpage_itemsâ€åŠŸèƒ½æä¾›æœ‰å…³å­˜å‚¨åœ¨é¡µé¢{æ•°æ®ï¼Œå¶å­ï¼Œå‹ç¼©çš„}ä¸Šçš„TIDçš„ä¿¡æ¯ï¼š <br><br><pre> <code class="pgsql hljs">fts=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gin_leafpage_items(get_raw_page(<span class="hljs-string"><span class="hljs-string">'mail_messages_tsv_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">2672</span></span>));</code> </pre><pre> <code class="plaintext hljs">-[ RECORD 1 ]--------------------------------------------------------------------- first_tid | (239,44) nbytes | 248 tids | {"(239,44)","(239,47)","(239,48)","(239,50)","(239,52)","(240,3)",... -[ RECORD 2 ]--------------------------------------------------------------------- first_tid | (247,40) nbytes | 248 tids | {"(247,40)","(247,41)","(247,44)","(247,45)","(247,46)","(248,2)",... ...</code> </pre><br> è¯·æ³¨æ„ï¼ŒTIDæ ‘çš„ç¦»å¼€é¡µé¢å®é™…ä¸ŠåŒ…å«æŒ‡å‘è¡¨è¡Œçš„å°å‹å‹ç¼©æŒ‡é’ˆåˆ—è¡¨ï¼Œè€Œä¸æ˜¯å•ä¸ªæŒ‡é’ˆã€‚ <br><br><h2> ç‰©äº§ </h2><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹GINè®¿é—®æ–¹æ³•çš„å±æ€§ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å·²ç»æä¾›äº†</a>æŸ¥è¯¢ï¼‰ã€‚ <br><br><pre> <code class="plaintext hljs"> amname | name | pg_indexam_has_property --------+---------------+------------------------- gin | can_order | f gin | can_unique | f gin | can_multi_col | t gin | can_exclude | f</code> </pre><br> æœ‰è¶£çš„æ˜¯ï¼ŒGINæ”¯æŒåˆ›å»ºå¤šåˆ—ç´¢å¼•ã€‚ ä½†æ˜¯ï¼Œä¸å¸¸è§„Bæ ‘ä¸åŒï¼Œå¤šåˆ—ç´¢å¼•ä»å°†å­˜å‚¨å•ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯å¤åˆé”®ï¼Œå¹¶ä¸”å°†ä¸ºæ¯ä¸ªå…ƒç´ æŒ‡ç¤ºåˆ—å·ã€‚ <br><br> ä»¥ä¸‹ç´¢å¼•å±‚å±æ€§å¯ç”¨ï¼š <br><br><pre> <code class="plaintext hljs"> name | pg_index_has_property ---------------+----------------------- clusterable | f index_scan | f bitmap_scan | t backward_scan | f</code> </pre><br> è¯·æ³¨æ„ï¼Œä¸æ”¯æŒæŒ‰TIDï¼ˆç´¢å¼•æ‰«æï¼‰è¿”å›ç»“æœTIDã€‚ åªèƒ½è¿›è¡Œä½å›¾æ‰«æã€‚ <br><br> ä¹Ÿä¸æ”¯æŒå‘åæ‰«æï¼šæ­¤åŠŸèƒ½ä»…å¯¹ç´¢å¼•æ‰«æå¿…ä¸å¯å°‘ï¼Œè€Œå¯¹äºä½å›¾æ‰«æåˆ™ä¸å¿…éœ€ã€‚ <br><br> ä»¥ä¸‹æ˜¯åˆ—å±‚å±æ€§ï¼š <br><br><pre> <code class="plaintext hljs"> name | pg_index_column_has_property --------------------+------------------------------ asc | f desc | f nulls_first | f nulls_last | f orderable | f distance_orderable | f returnable | f search_array | f search_nulls | f</code> </pre><br> è¿™é‡Œæ²¡æœ‰å¯ç”¨çš„å†…å®¹ï¼šæ²¡æœ‰æ’åºï¼ˆå¾ˆæ¸…æ¥šï¼‰ï¼Œæ²¡æœ‰ä½¿ç”¨ç´¢å¼•ä½œä¸ºè¦†ç›–ï¼ˆå› ä¸ºæ–‡æ¡£æœ¬èº«æœªå­˜å‚¨åœ¨ç´¢å¼•ä¸­ï¼‰ï¼Œæ²¡æœ‰å¯¹NULLçš„æ“ä½œï¼ˆå› ä¸ºå¯¹äºå¤åˆç±»å‹çš„å…ƒç´ æ²¡æœ‰æ„ä¹‰ï¼‰ ã€‚ <br><br><h2> å…¶ä»–æ•°æ®ç±»å‹ </h2><br> è¿˜æœ‰ä¸€äº›æ‰©å±•å¯ä»¥æ·»åŠ å¯¹æŸäº›æ•°æ®ç±»å‹çš„GINæ”¯æŒã€‚ <br><br><ul><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pg_trgm</a> â€ä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡æ¯”è¾ƒå¯ç”¨çš„ç›¸ç­‰çš„ä¸‰ä¸ªå­—æ¯åºåˆ—ï¼ˆå­—æ¯ï¼‰æ¥ç¡®å®šå•è¯çš„â€œç›¸ä¼¼åº¦â€ã€‚ æ·»åŠ äº†ä¸¤ä¸ªè¿ç®—ç¬¦ç±»â€œ gist_trgm_opsâ€å’Œâ€œ gin_trgm_opsâ€ï¼Œå®ƒä»¬æ”¯æŒå„ç§è¿ç®—ç¬¦ï¼ŒåŒ…æ‹¬é€šè¿‡LIKEå’Œæ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ¯”è¾ƒã€‚ æˆ‘ä»¬å¯ä»¥å°†æ­¤æ‰©å±•åä¸å…¨æ–‡æœç´¢ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å»ºè®®ç”¨äºä¿®æ­£æ‹¼å†™é”™è¯¯çš„å•è¯é€‰é¡¹ã€‚ <br></li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">hstore</a> â€å®ç°â€œé”®å€¼â€å­˜å‚¨ã€‚ å¯¹äºæ­¤æ•°æ®ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨åŒ…æ‹¬GINåœ¨å†…çš„å„ç§è®¿é—®æ–¹æ³•çš„è¿ç®—ç¬¦ç±»ã€‚ ä½†æ˜¯ï¼Œéšç€â€œ jsonbâ€æ•°æ®ç±»å‹çš„å¼•å…¥ï¼Œä½¿ç”¨â€œ hstoreâ€æ²¡æœ‰ç‰¹æ®Šçš„åŸå› ã€‚ <br></li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">intarray</a> â€æ‰©å±•äº†æ•´æ•°æ•°ç»„çš„åŠŸèƒ½ã€‚ ç´¢å¼•æ”¯æŒåŒ…æ‹¬GiSTå’ŒGINï¼ˆâ€œ gin__int_opsâ€è¿ç®—ç¬¦ç±»ï¼‰ã€‚ <br></li></ul><br> ä¸Šé¢å·²ç»æåˆ°äº†è¿™ä¸¤ä¸ªæ‰©å±•ï¼š <br><br><ul><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">btree_gin</a> â€å¢åŠ äº†å¯¹å¸¸è§„æ•°æ®ç±»å‹çš„GINæ”¯æŒï¼Œä»¥ä¾¿å®ƒä»¬ä¸å¤åˆç±»å‹ä¸€èµ·åœ¨å¤šåˆ—ç´¢å¼•ä¸­ä½¿ç”¨ã€‚ <br></li><li>  â€œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">jsquery</a> â€å®šä¹‰äº†ä¸€ç§ç”¨äºJSONæŸ¥è¯¢çš„è¯­è¨€ï¼Œä»¥åŠä¸€ä¸ªç”¨äºå¯¹è¯¥è¯­è¨€è¿›è¡Œç´¢å¼•æ”¯æŒçš„è¿ç®—ç¬¦ç±»ã€‚ æ­¤æ‰©å±•æœªåŒ…å«åœ¨æ ‡å‡†PostgreSQLäº¤ä»˜ä¸­ã€‚ <br></li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç»§ç»­é˜…è¯»</a> ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448746/">https://habr.com/ru/post/zh-CN448746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448734/index.html">æ— äººæœºå’Œæœºå™¨äººå¸®åŠ©æ‹¯æ•‘å·´é»åœ£æ¯é™¢</a></li>
<li><a href="../zh-CN448738/index.html">è°åœ¨å¯»æ‰¾åˆåˆ›å…¬å¸ï¼Ÿ</a></li>
<li><a href="../zh-CN448740/index.html">æˆ‘ä»¬åœ¨ç°ä»£PCä¸Šé€šè¿‡OPL3æ”¶å¬SIDéŸ³ä¹ï¼ˆCommodore 64ï¼‰</a></li>
<li><a href="../zh-CN448742/index.html">æ½˜å¤šæ‹‰é­”ç›’ï¼ˆPandora's Boxï¼‰ï¼šæˆ‘ä»¬ä»¥NeoQUEST-2019å·¥ä½œä¸ºä¾‹åˆ†æWinRARæ¼æ´çš„åˆ©ç”¨</a></li>
<li><a href="../zh-CN448744/index.html">å¦‚ä½•åœ¨Androidä¸­å°†å˜é‡ä»ç‰‡æ®µä¼ è¾“åˆ°æ´»åŠ¨ï¼Ÿ</a></li>
<li><a href="../zh-CN448750/index.html">å…³äºä¸€ä¸ªä¸æ˜¯çš„æ¼æ´</a></li>
<li><a href="../zh-CN448754/index.html">è°æ˜¯å¼€æºä¸­çš„è°ï¼šæå®¢ä¼ è®°</a></li>
<li><a href="../zh-CN448758/index.html">åœ¨ç‰©ç†æœº6502ä¸Šä½¿ç”¨BASICçš„æ™ºèƒ½æ‰‹è¡¨</a></li>
<li><a href="../zh-CN448760/index.html">äº‘ä¸­çš„å¼€å‘ï¼Œä¿¡æ¯å®‰å…¨æ€§å’Œä¸ªäººæ•°æ®ï¼šæ‘˜è¦ï¼Œä¾›å‘¨æœ«ä»1cloudé˜…è¯»</a></li>
<li><a href="../zh-CN448762/index.html">Picabaæš´åŠ¨ã€‚ ç”¨æˆ·å¤§é‡å‰å¾€Reddit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>