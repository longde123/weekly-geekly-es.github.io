<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ìÇÔ∏è üë®‚Äçüë¶ üßòüèº D√©buter avec stm32 ou ne pas r√©p√©ter mes erreurs üçµ üë©üèº‚Äç‚öïÔ∏è üìü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une courte histoire sur le r√¢teau rencontr√© sur la fa√ßon de conna√Ætre ARM sur l'exemple de stm32f103c8t6 et stm32l151rct6. 


 Ma connaissance des mic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©buter avec stm32 ou ne pas r√©p√©ter mes erreurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456280/"><p><img src="https://habrastorage.org/getpro/habr/post_images/7af/bf8/34a/7afbf834aacfe9204173342ee1d2787c.jpg" alt="image"></p><br><p>  Une courte histoire sur le r√¢teau rencontr√© sur la fa√ßon de conna√Ætre ARM sur l'exemple de stm32f103c8t6 et stm32l151rct6. </p><a name="habracut"></a><br><p>  Ma connaissance des microcontr√¥leurs a commenc√© avec AVR.  J'ai travaill√© sur eux pendant un certain temps, allant des planches avec des pistes ray√©es et de l'assembleur dans AtmelStudio4 au butin normal et aux makefiles auto-√©crits pour travailler dans le bloc-notes (dans mon cas, KWrite) et la ligne de commande. </p><br><p>  Mais il est temps de mettre un b√¢ton dans leurs fr√®res a√Æn√©s - ARM.  Le choix d'une famille sp√©cifique a √©t√© long et passif (car il n'y avait pas de besoin direct, donc je n'√©tais pas press√©), mais finalement il s'est retrouv√© sur stm32f1, car c'√©tait peut-√™tre la plus populaire.  Acheter un programmeur, une carte de d√©bogage comme Discovery ou une pilule bleue?  Que faites-vous, je suis un ma√Ætre des AVR-cams!  N'importe quelle planche peut √™tre fabriqu√©e LUT, et m√™me selon vos besoins, sans trop de kit carrosserie.  Par cons√©quent, j'ach√®te un stm32f103c8t6 nu et commence √† chamaniser avec la trace de la carte.  De quoi aurai-je besoin?  Au moins deux ports doivent √™tre apport√©s aux peignes ... oups, il n'est pas pratique d'afficher les ports enti√®rement.  Eh bien, je vais avoir 8 jambes chacune - du port A les plus jeunes (0-7), de B les plus √¢g√©s (8-15).  Toujours, bien s√ªr, les LED et les boutons, comme sans indication et contr√¥le.  Voici ce qui me surprend dans les cartes de d√©bogage termin√©es, c'est le manque d'au moins 2-3 LED et 1-2 boutons qui n'entreraient en conflit avec rien.  Comment imaginent-ils le d√©bogage?  Sous les boutons PA8, PA9 eux-m√™mes sont demand√©s, ils sont id√©alement situ√©s.  USB, cavaliers BOOT0, BOOT1 et un connecteur de batterie pour montres sont √©galement utiles.  Et des connecteurs pour le quartz, donc c'est tr√®s beau (je n'ai jamais utilis√© les connecteurs pour le quartz par la suite).  Pour l'alimentation, le contr√¥leur n'a pas besoin de plus de 3,6 V, et avec USB est de 5 V. Il est n√©cessaire d'installer un stabilisateur.  J'ai beaucoup lu comment les gens choisissent les stabilisateurs avec une faible chute de tension ... pourquoi?  La diff√©rence est de un vol et demi, mais il y a assez de ch√™ne 78l33.  Et maintenant le connecteur JTAG.  Le connecteur de programmation d'Atmel avait un ISP10 ou ISP6 standard.  JTAG est probablement √©galement une chose standard.  Il s'av√®re que oui ... mais seulement pour un seul fabricant ou m√™me un appareil.  Nous regardons le connecteur sur st-link: beau, 10 broches.  Nous examinons un programmeur pour AVR: oups, d√©j√† √† 20 broches.  Nous regardons ailleurs: des connecteurs plus incompatibles avec le dieu des normes incompatibles.  Eh bien, si c'est le cas, nous inventerons le n√¥tre.  Si quoi que ce soit, l'adaptateur entre eux ne sera pas plus compliqu√© que l'adaptateur ISP-6 √† ISP-10.  Tout semble √™tre pr√™t, vous pouvez faire des frais.  En fin de compte, un pas de 0,5 mm est tout √† fait r√©alisable √† un niveau amateur, je n'ai m√™me pas eu √† peindre avec un marqueur. </p><br><p>  Maintenant, comment le flasher.  Puisqu'il y a USB, il est probablement capable de le traverser.  J'ai lu la fiche technique - oui, elle ne peut pas via USB, mais elle peut l'√™tre via UART1.  Oups, j'ai oubli√© de le retirer.  De plus, il entre √©galement en conflit avec le bouton, avec celui qui se bloque sur PA9.  Bon, d'accord, je le publierai sur les publications, mais il reste encore un bouton.  Un peu de chamanisme et la carte est pr√™te et m√™me d√©finie dans stm32flash. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/180/277/876/180277876d736da44658abbce5e5d426.jpg" alt="image"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4d8/341/8a5/4d83418a5f8bb271a41aefa94fd5d42c.jpg" alt="image"></p><br><p>  Il semble √™tre r√©gl√© avec du fer, il est temps de passer au code.  Apr√®s avoir lu plusieurs articles sur Internet, j'ai trouv√© une archive pr√™te √† l'emploi sous gcc-arm-none-eabi.  Je d√©couvrirai exactement comment d√©finir la s√©quence d'assemblage plus tard.  Jusqu'√† pr√©sent, je fais des mondes salutaires sur les boutons et les LED.  Puisque c'est ma premi√®re connaissance de cette famille, aucun wrapper comme HAL n'est juste un travail manuel avec des registres.  Cependant, il s'agit d'une approche tout √† fait naturelle, il me semble, on ne pourrait pas le mentionner.  Cela m'ennuie un peu tout le temps de tirer la puissance et BOOT0 sur la carte, mais bon, un jour je ferai un programmeur JTAG.  Curieusement, je ne suis pas mont√© sur le r√¢teau avec l'horloge √©teinte.  Il a rappel√© sa jeunesse quand il a √©crit le traitement 3D sur TurboPascal.  Ici, j'ai un affichage sur ili9341 de raspberry pi et un contr√¥leur √† 72 MHz.  C'est ce qui s'est produit - jusqu'√† 200 points par mod√®le et 11 images par seconde.  Bien entendu, toutes les matrices de transformation sont compt√©es en nombres √† virgule fixe. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/D9KuP8Q5qTM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  √Ä un moment donn√©, j'ai voulu faire fonctionner un appareil portable pendant longtemps sur la batterie.  J'ai regard√© la fiche technique et j'√©tais boulevers√©: le fameux ARM en consommation est bien pire que le m√™me AVR-ok!  Si ce dernier (piqu√© sur le premier contr√¥leur qui s'est av√©r√© √™tre ATmega88p) avait une consommation de 0,8 ŒºA, en tenant compte des heures, alors le premier, m√™me dans le mode de sommeil le plus √©conomique *, avait 25 ŒºA ¬± 1,4 ŒºA au RTC.  Ce n'est pas bon.  Cependant, stm32f103 n'est pas positionn√© comme une s√©rie √©conomique.  Je regarde le site Web de STmicroelectronics pour d'autres s√©ries de contr√¥leurs et s√©lectionne la s√©rie stm32l1: en plus de consommer environ 1 ŒºA, il y a aussi un capteur capacitif et un contr√¥leur LCD.  Certes, la fr√©quence maximale est inf√©rieure, seulement 36 MHz (ou 24 MHz si l'USB est utilis√©), mais je vais y survivre en quelque sorte.  Il a √©t√© d√©cid√©: je prends un couple de stm32l151rct6 directement √† partir de 32 Ko de RAM (il y a aussi 256 Ko de flash, mais je peux √† peine imaginer comment il peut √™tre martel√©. Sauf avec une merde absolument sauvage ou des fichiers de donn√©es). </p><br><ul><li>  <em>) ne confondez pas les modes veille (veille, arr√™t) avec l'arr√™t (veille)</em> </li></ul><br><p>  En parall√®le, je cr√©e le programmateur st-link v2 √† partir du stm32f103 de rechange, simplement parce que je suis fatigu√© de jouer avec BOOT0 et la puissance, et c'est plus rapide.  Cependant, je quitterai la programmation UART - vous ne savez jamais quoi.  Il y avait aussi un peu de chamanisme, mais rien d'exceptionnel.  √Ä moins de trouver la ligne de commande pour openocd s'est av√©r√© √™tre un probl√®me.  Pour les g√©n√©rations futures, je la quitterai: </p><br><pre><code class="plaintext hljs">openocd -f interface/stlink-v2.cfg -f target/stm32f1x.cfg -c "init" -c "reset halt" -c "flash write_image erase "$(firmware).bin" 0x08000000" -c "reset run" -c "exit"</code> </pre> <br><p>  Pour stm32l151, il est bien s√ªr n√©cessaire de corriger la cible en "target / stm32l1.cfg" </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e7/20b/8b2/4e720b8b2a7c604796d911ac8c989f2f.jpg" alt="image"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6ec/f47/a66/6ecf47a661552fd60fd9fae056b1828c.jpg" alt="image"></p><br><p>  Je vais courir un peu en avance dans la chronologie, mais pas pour revenir.  Messieurs, ne √©conomisez pas sur l'√©paisseur du PCB!  Ou au moins ajoutez des accessoires, ou n'utilisez pas de composants smd.  Il se trouve que sur la carte de programmation, je n'ai fourni que deux trous de montage √† des endroits al√©atoires.  Et les lieux √©taient assez √©loign√©s du connecteur JTAG.  Et apr√®s un certain temps, j'ai remarqu√© que le programmeur est instable.  Cela fonctionne, alors non, puis via UART, vous devez effacer la "victime", puis la ramasser.  Il s'est av√©r√© que la r√©sistance provenant de la sortie du contr√¥leur vers le connecteur s'est cass√©e.  Il est juste tomb√© du bloc de contact du corps.  J'ai soud√© la r√©sistance.  Puis il a soud√© le reste.  Puis il s'est rendu compte que m√™me cette petite d√©formation de la planche qui se produisait lors du collage-tirage du c√¢ble √©tait suffisante pour les composants malheureux.  En cons√©quence, j'ai coll√© une sauvegarde juste √† c√¥t√© du connecteur.  Tout en tenant. </p><br><p>  Comme le lecteur l'a d√©j√† devin√©, la programmation se fait √©galement dans un √©diteur de texte, tandis que la compilation et le firmware sont dans la console.  Naturellement, l'achat d'une carte de d√©bogage pour l151 ne m'a pas plus inspir√© que n'importe quel IDE.  Frottant les traces du r√¢teau laiss√©es par la premi√®re carte, je multiplie la seconde (en comptant le programmeur comme troisi√®me, mais ce n'est toujours pas une carte de d√©bogage).  Puisque j'allais d√©boguer un appareil √©conome en √©nergie, j'ai besoin de me soucier de l'alimentation.  Je ne changerai pas le stabilisateur 78l33, mais j'ai d√©chir√© sa sortie avec un cavalier pour pouvoir le piquer avec un amp√®rem√®tre (j'esp√®re tout de m√™me pour un micro-amp√®rem√®tre, mais voil√†).  Laissez les peignes √™tre les m√™mes que sur la carte pr√©c√©dente - compatibilit√©!  Eh bien, quelques LED et boutons, bien s√ªr.  Le r√¢teau avec UART1 brille de mani√®re attrayante, mais je mets toujours son connecteur et ne le mets pas sur le front.  Bien s√ªr, j'ai d√©j√† JTAG, mais l'assurance ne fera pas de mal.  Tout comme le pr√©c√©dent (et la carte de programmation aussi), il √©tait possible de se s√©parer d'un c√¥t√©, m√™me s'il n'y a pas trop de cavaliers. </p><br><p>  Mais lorsque le contr√¥leur a √©t√© scell√©, un probl√®me est survenu.  J'ai en quelque sorte na√Øvement cru qu'il devrait y avoir une cl√© sur le corps du microcircuit indiquant la premi√®re jambe.  Qui s'attendrait √† ce que bien fait de ST produise DEUX cl√©s, sym√©triquement.  Alors de quel c√¥t√© le souder maintenant?  En pensant, j'ai d√©cid√© que ce n'√©taient pas des cl√©s, mais des approfondissements technologiques.  On ne sait jamais, par exemple pour positionner la puce dans la fabrication.  Ou appuyez sur la base pour la remplir de plastique.  Ensuite, vous devez naviguer par l'inscription.  Il est logique que l'inscription soit lisible si le microcircuit est positionn√© ¬´standard¬ª, c'est-√†-dire lorsque la premi√®re jambe est dans le coin sup√©rieur gauche.  Alors il a commenc√© √† souder.  Soit un d√©faut de LUT, soit des mains tordues, mais le microcircuit a √©t√© soud√© de travers, je l'ai remarqu√© √† temps avant de le souder compl√®tement.  Peu importe, il existe une ancienne m√©thode pour souder les mille-pattes √† l'aide d'une lame de rasoir: elle n'est pas mouill√©e par la soudure et assez mince pour ne pas trop se plier.  Il s'est av√©r√© que les mains ne sont toujours pas assez droites, car les jambes sont pli√©es.  Mais pas vers le haut, mais sur le c√¥t√©, enfin, du moins pas tr√®s bien, et ils ont r√©ussi √† les redresser.  La deuxi√®me tentative de soudure √©tait d√©j√† au microscope, mais avant cela, j'ai d√©cid√© de corriger les jambes.  Et l'un d'eux s'est interrompu.  De quoi sont-ils faits, que vous ne pouvez pas plier-plier une fois?  Les composants de sortie n'ont pas un tel probl√®me.  Eh bien, c'est tout, je pense que la puce du mariage devra en souder une autre.  Mais du coup ce n'est pas une √©tape critique?  Eh bien l√†, une conclusion d'ordre g√©n√©ral, ou l'un des repas.  Jusqu'√† pr√©sent, je l'ai scell√© sans elle, et l√†, on le verra.  Cette fois, j'ai r√©ussi √† souder uniform√©ment, bien que la jambe soit mont√©e sur I2C, avec laquelle je voulais m'amuser, mais au moins pas sur des connecteurs vitaux comme USB, JTAG, UART ou BOOT.  Je le connecte - cela ne fonctionne pas, les programmeurs ne voient pas la carte.  Depuis quelque temps, le chaman avec des jambes √† souder, mais cela n'aide pas.  Un coup d'≈ìil √† la fiche technique tombe sur une photo du contr√¥leur situ√© quelque part au sous-sol du document.  Voici comment vous pourriez trouver l'inscription BOKOM?!  C'est-√†-dire que si vous tournez le contr√¥leur pour que l'inscription soit lue, la premi√®re jambe sera dans le coin inf√©rieur gauche.  En cours de route, il s'est av√©r√© que l'un des ¬´recoins technologiques¬ª est toujours la cl√©.  Certes, cela n'explique pas comment le distinguer du sym√©trique ... Bon, au moins un indice.  Je soude le contr√¥leur avec un s√®che-cheveux de b√¢timent pour ne pas casser les conclusions, et cette fois je le soude sur le c√¥t√©.  La sortie interrompue va exactement √† la sortie TX de UART1, c'est-√†-dire au connecteur de programmation et de d√©bogage.  C'est compl√®tement mauvais, mais avant de changer le contr√¥leur, vous devez au moins vous assurer qu'avec l'orientation j'ai devin√© que lors de la soudure pour vivre, ne le tuez pas avec une connexion incorrecte.  Je connecte le programmeur - cela fonctionne.  Hourra.  Il reste peu de choses - soudez les connecteurs, les diodes et autres faisceaux.  Les commentaires sugg√©raient une autre voie - faire le tour de la terre: ils sont g√©n√©ralement connect√©s √† l'int√©rieur du bo√Ætier et ne sont pas situ√©s compl√®tement sym√©triques.  Certes, compte tenu de l'√©tape des conclusions, il peut √™tre difficile de tirer les bonnes conclusions.  Quoi qu'il en soit, c'est le moyen le plus fiable. </p><br><p>  Je ne veux pas travailler avec le contr√¥leur sans UART1, et c'est encore pire que maintenant.  Et si c'est le cas, c'est tout de m√™me de changer, alors je d√©cide de jouer un chirurgien et de faire du contr√¥leur une jambe proth√©tique √† partir des cheveux de MGTF.  Juste √† port√©e de main se trouve une bonne colle √©lectriquement conductrice, avec laquelle les cheveux collent de mani√®re d√©cisive √† la plate-forme sur le corps de la puce.  Cette colle qui a p√©n√©tr√© sur les jambes voisines est impitoyablement enlev√©e avec un scalpel.  Et que voulez-vous entrer dans la plate-forme demi-millim√®tre et ne pas entrer dans les jambes saillantes adjacentes?  Je v√©rifie - cela fonctionne.  Jusqu'√† ce qu'il tombe, et pour ne pas tomber plus tard, versez du cyanoacrylate. </p><br><p>  C'est peut-√™tre ainsi que j'aurais utilis√© cette planche si la jambe n'√©tait pas retomb√©e.  Et il est recouvert de colle.  Cependant, il est assez doux et coup√© avec un scalpel, il est donc nettoy√© avec succ√®s.  Mais pour une raison quelconque, je ne veux pas utiliser le m√™me adh√©sif √©lectriquement conducteur pour la deuxi√®me fois.  Je vais essayer de souder la jambe.  La pointe habituelle du fer √† souder ne s'y glissa pas, mais le c√¥ne √©tait inclus dans le kit (en fait, le c√¥ne √©tait √† l'origine le seul, mais en raison de son inconv√©nient √©vident, il a √©t√© remplac√© par celui habituel, avec un aff√ªtage en forme de coin), qui s'y glisse compl√®tement.  Curieusement, ¬´l'op√©ration de transplantation¬ª a r√©ussi et la jambe a fonctionn√© comme il se doit (une photo rapproch√©e de la jambe sur KDPV). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/db2/03e/a69/db203ea69ff912c7d012e3f39ab94c17.jpg" alt="image"></p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6ec/f47/a66/6ecf47a661552fd60fd9fae056b1828c.jpg" alt="image"></p><br><p>  Donc, le fer est pr√™t, il est temps de passer au code.  Ce serait bien de trouver un exemple pr√™t √† l'emploi sous gcc et la biblioth√®que CMSIS.  Quoi de mieux pour cela que le site officiel du fabricant?  Il s'est av√©r√© que STmicroelectronics ne partage pas mon optimisme.  Le fait que la navigation sur le site se fasse √† travers un lieu ind√©cent est d√©j√† familier, il est d√©sormais difficile de trouver un site fait par des personnes pour des personnes.  Mais ils ne permettent rien de t√©l√©charger depuis le site!  Peut-√™tre qu‚Äôils l‚Äôautoriseraient apr√®s l‚Äôinscription, mais avant cela, je n‚Äôavais pas envie de m‚Äôinscrire quelque part, et apr√®s une telle attitude envers les d√©veloppeurs, encore plus.  Pourquoi diable avez-vous besoin de mon courrier ou que demandez-vous l√†-bas?  Collecter des donn√©es personnelles, envoyer du spam?  Traversez la for√™t et je la trouverai dans le domaine public!  Soit dit en passant, j'ai √©t√© un peu surpris que le package correspondant ne soit pas dans le r√©f√©rentiel, mais peut-√™tre que ST a propos√© une sorte d'h√©morro√Ødes sous licence.  Par cons√©quent, j'envoie les rayons de la diarrh√©e aux commer√ßants qui ont mis au point une telle politique, et pour un site inconfortable aussi. </p><br><p>  Quoi qu'il en soit, la biblioth√®que a √©t√© parfaitement trouv√©e sur Internet (je ne donnerai aucun lien, on ne sait jamais ce qu'il adviendra du site).  Une alternative est de t√©l√©charger l'environnement de d√©veloppement ou CubeMX, o√π ces biblioth√®ques sont int√©gr√©es.  Il est vrai que les t√©l√©charger √† partir du site officiel est tout aussi impossible, nous examinons donc les logiciels tiers et les installons sur une machine virtuelle, au cas o√π ¬´si quelque chose se passait¬ª. </p><br><p>  Nous avons compris le fer et les sortes aussi.  Il est enfin temps de traiter avec le contr√¥leur.  La premi√®re surprise attendait en essayant d'utiliser du code tiers sous Discovery.  Ils ont utilis√© le contr√¥leur stm32l152, qui √† premi√®re vue est presque le m√™me que le stm32l151 que j'ai install√©.  En plus des diff√©rences mineures, il s'est av√©r√© que le module LCD n'√©tait pas install√© dans le contr√¥leur "my".  Un peu d√©cevant, mais je n'avais toujours pas pr√©vu de l'utiliser.  Bien qu'une telle diff√©rence aurait pu √™tre plus clairement distingu√©e qu'une note de bas de page dans la fiche technique.  Par ailleurs, dans une fiche technique, il est recommand√© dans ce cas de connecter la broche VLCD √† l'alimentation, sur ma photo la r√©sistance 0 ohm correspondante n'est pas soud√©e, mais en r√©alit√© je l'ai install√©e.  Sans cela, cela fonctionne aussi, mais ne surchargez pas les connexions internes.  Le comportement de l'horloge temps r√©el s'est r√©v√©l√© plus int√©ressant.  Ils ne voulaient pas obstin√©ment travailler, et sur Internet ils √©crivent simplement "fais-le, fais-le, √ßa marche".  Mais √ßa ne marche pas.  Dans certains endroits, cependant, il a √©t√© fait mention de ¬´probl√®mes connus avec RTC dans cette s√©rie¬ª.  Quoi qu'il en soit, la montre est toujours enroul√©e, mais uniquement sur le g√©n√©rateur RC int√©gr√©.  Les tentatives de verrouillage du quartz d'horloge ont conduit √† l'attente sans fin du bit de pr√©paration LSE.  J'ai essay√© de v√©rifier si les jambes du microcircuit √©taient tomb√©es des pistes de la carte et les ai tir√©es en mode GPIO normal.  Le quartz √† haute fr√©quence est tomb√©.  WTF?!  En g√©n√©ral, ces deux quartz ne veulent pas travailler ensemble, mais au moins s√©par√©ment ils fonctionnent √† tout le moins. </p><br><p>  Et puis j'ai devin√©: la superglue, qui √©tait remplie de la moiti√© du contr√¥leur (c'est liquide, vous ne pouvez pas l'appliquer avec pr√©cision, et qui aurait pens√© ...) donne une fuite et du quartz interf√®re avec leurs pointes.  Eh bien, ce n'est pas difficile de gratter la colle de l'ext√©rieur, mais apr√®s tout, elle est engourdie m√™me sous le fond de la puce.  Et s'il y a suffisamment de fuites pour le quartz, cela affectera la consommation.  Je regarde dans Google, que les gens enl√®vent le cyanoacrylate.  Il offre de l'eau chaude (quoi ???) et du dim√©thylsulfoxyde.  Je ne crois pas √† l'eau chaude, alors j'ach√®te du DMSO.  Apr√®s plus d'une heure de d√©couverte d'une goutte de produit chimique √† la surface de la colle, je n'ai pas remarqu√© la diff√©rence.  Mais ils ont remarqu√© du quartz et ont commenc√© √† travailler plus ou moins normalement (je me demande pourquoi? Dimexide a remplac√© l'humidit√© absorb√©e par la colle?).  Cependant, cela ne m'a pas convaincu, et les restes de colle sont toujours une horreur ... pour rien qui sont sur le dessous de la planche et ne sont pas particuli√®rement visibles.  Soit dit en passant, l'eau chaude que j'ai lav√©e avec du dimexide n'a pas affect√© la colle (je ne suis pas surpris).  J'ai d√©couvert qu'il existe un dissolvant de colle, dans le m√™me tube que la colle elle-m√™me, uniquement en violet.  Eh bien, au moins √ßa devrait marcher!  Il s'est av√©r√© que cela peut fonctionner et fonctionne, mais sa consistance ressemble √† de la cr√®me sure et ne tient tout simplement pas sous le microcircuit.  Eh bien, √† quoi √ßa sert, gomme?!  Dehors, je peux le nettoyer.  Derni√®re chance: l'ac√©tone est rarement mentionn√©e.  J'ai un peu peur pour les pi√®ces en plastique, mais juste les remplacer est facile.  Je verse de l'ac√©tone dans un bocal en verre, j'y jette une planche et je la laisse toute la nuit.  Le lendemain matin, il s'est av√©r√© que l'ac√©tone fonctionne vraiment, et comment!  Il n'y avait aucune trace de colle.  De plus, le poussoir de l'un des boutons s'est dissous.  Fait int√©ressant, le second survivant, probablement, √©tait en plastique plus stable.  J'ai √©t√© un peu surpris que l'autre plastique soit rest√© intact, m√™me les inscriptions ont surv√©cu.  Eh bien, excellent, mais le bouton peut √™tre remplac√©. </p><br><p>  Nous avons maintenant r√©ussi √† lancer RTC √† partir du quartz de la montre, √† toucher le mode veille et √† communiquer avec d'autres p√©riph√©riques.  Et aussi, pour qu'il soit compl√®tement timide, il a appos√© des signatures sur le tableau.  Mais pas avec un marqueur (soudain se baigner √† nouveau dans des solvants?) Mais gratt√© avec un scalpel.  Pendant des si√®cles! </p><br><p>  Eh bien, pour les g√©n√©rations futures, je vais laisser des exemples de code pour les deux contr√¥leurs, ainsi que des biblioth√®ques, des makefiles, etc.  Il ne reste plus qu'√† installer gcc-arm-none-eabi, openocd, stm32flash et autres bagatelles. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stm32f103</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stm32l151</a> </p><br><p>  Dans les commentaires, il leur a √©t√© conseill√© √† plusieurs reprises de ne pas faire de LUT et de commander la fabrication de planches √† des professionnels.  Pour le prototypage, comme ici - je ne vois aucune raison.  Une autre chose est si vous avez besoin d'une carte multicouche, ou d'une √©tape encore plus petite, ou d'un bo√Ætier BGA, ou de quelque chose d'autre qui est difficile √† faire √† la maison.  Et, bien s√ªr, dans la fabrication de la version finale de l'appareil et la r√©plication.  Ce n'est pas bon si le client d√©monte le bo√Ætier <del>  soud√© √† partir de PCB, </del>  et il d√©couvrira une planche sci√©e tordue sans masque et avec des cavaliers de MGTF. </p><br><p>  Conclusions: </p><br><ol><li>  Vous pouvez faire des tableaux de d√©bogage pour vous-m√™me si vous le souhaitez, ils ne sont pas pires que ceux achet√©s.  Mais le programmeur de d√©bogueur est toujours pr√©f√©rable d'acheter s'il n'est pas trop cher.  Bien s√ªr, vous pouvez le faire, mais vous ne changerez pas le sch√©ma, et si c'est le cas, ce ne sera pas mieux que l'achat.  Moins cher, tr√®s probablement aussi.  Sauf si le contr√¥leur superflu reste ou avec un probl√®me de livraison. </li><li>  N'oubliez pas le connecteur de programmation de sauvegarde UART1, eh bien, en m√™me temps, les cavaliers BOOT0, BOOT1.  En plus de la programmation proprement dite, il est tr√®s pratique de d√©boguer un programme en utilisant UART. </li><li>  Il y a deux cl√©s sur le bo√Ætier LQFP64, dont l'une est fausse.  Vous devrez naviguer jusqu'√† l'inscription afin de regarder avec vos pieds vers la gauche. </li><li>  Le soudage des composants avec une petite √©tape se fait uniquement au microscope.  Sinon, il est difficile de d√©terminer si tout a disparu et s'il y a "morve".  Eh bien, que ce soit sur un √©quipement "professionnel" comme un s√®che-cheveux sp√©cial, de la p√¢te √† souder, etc.  Je ne sais pas ici, j'√©cris sur la technologie amateur. </li><li>  N'√©conomisez pas sur l'√©paisseur du PCB.  Il se plie et cela peut √™tre suffisant pour endommager les r√©sistances CMS et, probablement, les condensateurs.  Cela ne fait pas peur √† la sortie, et les composants aux conclusions courb√©es (transistors, microcircuits) survivront probablement. </li><li>  La fabrication de connecteurs pour le quartz est une perte de temps.  Vous ne les changerez pas, alors soudez simplement sur la carte. </li><li>  Boire un mille-pattes avec une lame de rasoir n'est possible que dans les cas les plus extr√™mes, lorsqu'il n'y a pas de s√®che-cheveux.  Sinon, le risque de l'endommager est trop grand. </li><li>  M√™me si la jambe est tomb√©e du microcircuit, elle peut √™tre restaur√©e!  M√™me lorsque le pas est de 0,5 mm.  L'essentiel est d'utiliser de la soudure, pas de la colle conductrice. </li><li>  Ne remplissez jamais la puce avec de la colle cyanoacrylate (super glue)!  Il n'a pas les caract√©ristiques √©lectriques, voire m√©caniques, appropri√©es. </li><li>  L'ac√©tone est mieux adapt√©e pour √©liminer la superglue des zones difficiles √† atteindre.  Il se dissout compl√®tement.  L'essentiel est de s'assurer que les composants environnants ne sont pas affect√©s.  Des endroits non difficiles d'acc√®s peuvent √™tre retir√©s m√©caniquement. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456280/">https://habr.com/ru/post/fr456280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456266/index.html">Le condens√© de mat√©riaux int√©ressants pour le d√©veloppeur mobile # 302 (du 10 au 16 juin)</a></li>
<li><a href="../fr456270/index.html">Redis Stream - Fiabilit√© et √©volutivit√© de vos syst√®mes de messagerie</a></li>
<li><a href="../fr456272/index.html">Qu'est-ce qu'Android Lint et comment vous aide-t-il √† √©crire du code pris en charge?</a></li>
<li><a href="../fr456274/index.html">Psychologues: les robots sexuels entra√Æneront une augmentation du nombre de personnes sans couple qui n'ont pas besoin de relations avec d'autres personnes</a></li>
<li><a href="../fr456276/index.html">Qu'est-ce que l'information?</a></li>
<li><a href="../fr456282/index.html">Graphiques multidimensionnels en Python - de trois dimensions √† six dimensions</a></li>
<li><a href="../fr456288/index.html">MAM: assemblage frontal sans douleur</a></li>
<li><a href="../fr456294/index.html">Diff√©rences entre LabelEncoder et OneHotEncoder dans SciKit Learn</a></li>
<li><a href="../fr456296/index.html">Le monde de l'hypersph√®re tridimensionnelle. Tra√ßage de rayons g√©od√©siques dans un univers ferm√© √† g√©om√©trie sph√©rique</a></li>
<li><a href="../fr456298/index.html">Les technologies de la micro√©lectronique sur les doigts: la loi de Moore, les mouvements de marketing et pourquoi les nanom√®tres ne sont plus les m√™mes aujourd'hui. 2e partie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>