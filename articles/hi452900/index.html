<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЮ┐ ЁЯУ╗ ЁЯСМЁЯП╗ PostgreSQL рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХ - 9 (BRIN) ЁЯСк ЁЯС╡ЁЯП┐ ЁЯС┤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦреЛрдВ рдореЗрдВ рд╣рдордиреЗ PostgreSQL рдЗрдВрдбреЗрдХреНрд╕рд┐рдВрдЧ рдЗрдВрдЬрди , рдПрдХреНрд╕реЗрд╕ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдФрд░ рдирд┐рдореНрди рд╡рд┐рдзрд┐рдпреЛрдВ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА: рд╣реИрд╢ рдЗрдВрдбреЗрдХреНрд╕ , рдмреА- рдЯреНрд░реАрдЬрд╝ , рдЬреАрдПрд╕рдЯреА , рдПрд╕рдкреА-рдЬреА...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostgreSQL рдореЗрдВ рд╕реВрдЪрдХрд╛рдВрдХ - 9 (BRIN)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/452900/">  рдкрд┐рдЫрд▓реЗ рд▓реЗрдЦреЛрдВ рдореЗрдВ рд╣рдордиреЗ PostgreSQL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЗрдВрдбреЗрдХреНрд╕рд┐рдВрдЧ рдЗрдВрдЬрди</a> , рдПрдХреНрд╕реЗрд╕ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЗ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдФрд░ рдирд┐рдореНрди рд╡рд┐рдзрд┐рдпреЛрдВ рдкрд░ рдЪрд░реНрдЪрд╛ рдХреА: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╣реИрд╢ рдЗрдВрдбреЗрдХреНрд╕</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдмреА-</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЯреНрд░реАрдЬрд╝</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреАрдПрд╕рдЯреА</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрд╕рдкреА-рдЬреАрдПрд╕рдЯреА</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреАрдЖрдИрдПрди</a> , рдФрд░ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЖрд░рдпреВрдПрдо</a> ред  рдЗрд╕ рд▓реЗрдЦ рдХрд╛ рд╡рд┐рд╖рдп рдмреНрд░рд┐рди рдЗрдВрдбреЗрдХреНрд╕ рд╣реИред <br><br><h1>  рдмреНрд░рд┐рди </h1><br><h2>  рд╕рд╛рдорд╛рдиреНрдп рдЕрд╡рдзрд╛рд░рдгрд╛ </h2><br>  рдЙрди рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛рдУрдВ рдХреЗ рд╡рд┐рдкрд░реАрдд, рдЬрд┐рдирдХреЗ рд╕рд╛рде рд╣рдо рдкрд╣рд▓реЗ рд╣реА рдПрдХрддреНрд░ рд╣реЛ рдЪреБрдХреЗ рд╣реИрдВ, рдмреНрд░рд┐рди рдХрд╛ рд╡рд┐рдЪрд╛рд░ рд╣реИ рдХрд┐ рд╡реЗ рдореЗрд▓ рдЦрд╛рдиреЗ рд╡рд╛рд▓реА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рдХреА рдмрдЬрд╛рдп рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреБрдкрдпреЛрдЧреА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦрдиреЗ рд╕реЗ рдмрдЪреЗрдВред  рдпрд╣ рд╣рдореЗрд╢рд╛ рдПрдХ рдЧрд▓рдд рд╕реВрдЪрдХрд╛рдВрдХ рд╣реИ: рдЗрд╕рдореЗрдВ TID рдХреА рддрд╛рд▓рд┐рдХрд╛ рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИрдВред <br><br>  рд╕рд░рд▓реАрдХреГрдд рд░реВрдк рд╕реЗ, BRIN рдЙрди рд╕реНрддрдВрднреЛрдВ рдХреЗ рд▓рд┐рдП рдареАрдХ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдорд╛рди рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЙрдирдХреЗ рднреМрддрд┐рдХ рд╕реНрдерд╛рди рдХреЗ рд╕рд╛рде рд╕рдВрдмрджреНрдз рд╣реЛрддреЗ рд╣реИрдВред  рджреВрд╕рд░реЗ рд╢рдмреНрджреЛрдВ рдореЗрдВ, рдпрджрд┐ ORDER BY рдЦрдВрдб рдХреЗ рдмрд┐рдирд╛ рдХреЛрдИ рдХреНрд╡реЗрд░реА рд╡рд╕реНрддреБрддрдГ рдмрдврд╝рддреЗ рдпрд╛ рдШрдЯрддреЗ рдХреНрд░рдо рдореЗрдВ рд╕реНрддрдВрдн рдорд╛рди рд▓реМрдЯрд╛рддрд╛ рд╣реИ (рдФрд░ рдЙрд╕ рд╕реНрддрдВрдн рдкрд░ рдХреЛрдИ рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдирд╣реАрдВ рд╣реИрдВ)ред <br><br>  рдпрд╣ рдкрд╣реБрдВрдЪ рд╡рд┐рдзрд┐ рдмрд╣реБрдд рдмрдбрд╝реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЗ рд▓рд┐рдП рдпреВрд░реЛрдкреАрдп рдкрд░рд┐рдпреЛрдЬрдирд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдПрдХреНрд╕рд▓ рдХреЗ</a> рджрд╛рдпрд░реЗ рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рдереА, рдЬрд┐рд╕рдореЗрдВ рдХрдИ рдЯреЗрд░рд╛рдмрд╛рдЗрдЯ рдпрд╛ рджрд░реНрдЬрдиреЛрдВ рдЯреЗрд░рд╛рдмрд╛рдЗрдЯ рдмрдбрд╝реЗ рд╣реИрдВред  BRIN рдХреА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рд╢реЗрд╖рддрд╛ рд╣реИ рдЬреЛ рд╣рдореЗрдВ рдРрд╕реА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдкрд░ рдЕрдиреБрдХреНрд░рдорд┐рдд рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреА рд╣реИ рдЬреЛ рд░рдЦрд░рдЦрд╛рд╡ рдХрд╛ рдПрдХ рдЫреЛрдЯрд╛ рдЖрдХрд╛рд░ рдФрд░ рдиреНрдпреВрдирддрдо рдУрд╡рд░рд╣реЗрдб рд▓рд╛рдЧрдд рд╣реИред <br><br>  рдпрд╣ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред  рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдЙрди <em>рд╢реНрд░реЗрдгрд┐рдпреЛрдВ</em> рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ <em>рд╣реИ</em> рдЬреЛ рдХрдИ рдкреГрд╖реНрда рдмрдбрд╝реЗ рд╣реИрдВ (рдпрд╛ рдХрдИ рдмреНрд▓реЙрдХ рдмрдбрд╝реЗ рд╣реИрдВ, рдЬреЛ рд╕рдорд╛рди рд╣реИ) - рдЗрд╕рд▓рд┐рдП рдирд╛рдо: рдмреНрд▓реЙрдХ рд░реЗрдВрдЬ рдЗрдВрдбреЗрдХреНрд╕, BRINред  рд╕реВрдЪрдХрд╛рдВрдХ рдкреНрд░рддреНрдпреЗрдХ рд╕реАрдорд╛ рдореЗрдВ рдбреЗрдЯрд╛ рдкрд░ <em>рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА</em> рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИред  рдПрдХ рдирд┐рдпрдо рдХреЗ рд░реВрдк рдореЗрдВ, рдпрд╣ рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдЧреЗ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдорд╛рди рд▓реЗрдВ рдХрд┐ рдХрд┐рд╕реА рдХреНрд╡реЗрд░реА рдХреЛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрд┐рд╕реА рд╕реНрддрдВрдн рдХреЗ рд▓рд┐рдП рд╕реНрдерд┐рддрд┐ рд╣реЛрддреА рд╣реИ;  рдпрджрд┐ рдорд╛рдВрдЧреЗ рдЧрдП рдорд╛рди рдЕрдВрддрд░рд╛рд▓ рдореЗрдВ рдирд╣реАрдВ рдорд┐рд▓рддреЗ рд╣реИрдВ, рддреЛ рдкреВрд░реА рд╕реАрдорд╛ рдХреЛ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ;  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рд╡реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╕рднреА рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рд╕рднреА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЙрдирдХреЗ рдмреАрдЪ рдорд┐рд▓рд╛рди рд╡рд╛рд▓реЗ рд▓реЛрдЧреЛрдВ рдХреЛ рдЪреБрдирдиреЗ рдХреЗ рд▓рд┐рдП рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ред <br><br>  BRIN рдХреЛ рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд░реВрдк рдореЗрдВ рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕реНрдХреИрди рдХреЗ рддреНрд╡рд░рдХ рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдПрдХ рдЧрд▓рддреА рд╣реЛрдЧреАред  рдпрджрд┐ рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рд╢реНрд░реЗрдгреА рдХреЛ "рдЖрднрд╛рд╕реА" рд╡рд┐рднрд╛рдЬрди рдХреЗ рд░реВрдк рдореЗрдВ рдорд╛рдирддреЗ рд╣реИрдВ рддреЛ рд╣рдо рд╡рд┐рднрд╛рдЬрди рдХреЗ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВ рдмреНрд░рд┐рди рдХрд╛ рд╕рдВрдмрдВрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЕрдм рдЖрдЗрдП рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВред <br><a name="habracut"></a><br><h2>  рд╕рдВрд░рдЪрдирд╛ </h2><br>  рдкрд╣рд▓реЗ (рдЕрдзрд┐рдХ рд╕рдЯреАрдХ, рд╢реВрдиреНрдп) рдкреГрд╖реНрда рдореЗрдВ рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред <br><br>  рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рд╡рд╛рд▓реЗ рдкреГрд╖реНрда рдореЗрдЯрд╛рдбреЗрдЯрд╛ рд╕реЗ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдСрдлрд╝рд╕реЗрдЯ рдкрд░ рд╕реНрдерд┐рдд рд╣реИрдВред  рдЙрди рдкреГрд╖реНрдареЛрдВ рдкрд░ рдкреНрд░рддреНрдпреЗрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдкрдВрдХреНрддрд┐ рдореЗрдВ рдПрдХ рд╕реАрдорд╛ рдкрд░ рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрддреА рд╣реИред <br><br>  рдореЗрдЯрд╛ рдкреЗрдЬ рдФрд░ рд╕рд╛рд░рд╛рдВрд╢ рдбреЗрдЯрд╛ рдХреЗ рдмреАрдЪ, <em>рд░рд┐рд╡рд░реНрд╕ рд░реЗрдВрдЬ рдореИрдк рдХреЗ</em> рд╕рд╛рде рдкреГрд╖реНрда (рд╕рдВрдХреНрд╖рд┐рдкреНрдд рд░реВрдк рдореЗрдВ "рд░рд┐рд╡реИрдореНрдк") рд╕реНрдерд┐рдд рд╣реИрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдЗрд╕реА рдЕрдиреБрдХреНрд░рдордгрд┐рдХрд╛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╕рдВрдХреЗрдд (TID) рдХрд╛ рдПрдХ рд╕рд░рдгреА рд╣реИред <br><br><img src="https://habrastorage.org/webt/nr/pm/s9/nrpms932o5clzubwymywxtud6q4.png"><br><br>  рдХреБрдЫ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП, "рд░реЗрд╡рдореИрдк" рдореЗрдВ рдкреЙрдЗрдВрдЯрд░ рд╕реЗ рдХреЛрдИ рдЗрдВрдбреЗрдХреНрд╕ рдкрдВрдХреНрддрд┐ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреА рд╣реИ (рдПрдХ рдЖрдХреГрддрд┐ рдореЗрдВ рдЧреНрд░реЗ рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рд╣реИ)ред  рдРрд╕реЗ рдореЗрдВ, рдЗрд╕ рд╕реАрдорд╛ рдХреЛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдЕрднреА рддрдХ рдЗрд╕рдХреА рдХреЛрдИ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИред <br><br><h2>  рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рд╕реНрдХреИрди рдХрд░рдирд╛ </h2><br>  рдпрджрд┐ рд╕реВрдЪрдХрд╛рдВрдХ рдореЗрдВ рддрд╛рд▓рд┐рдХрд╛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рд╕рдВрджрд░реНрдн рдирд╣реАрдВ рд╣реИ рддреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ?  рдпрд╣ рдкрд╣реБрдВрдЪ рд╡рд┐рдзрд┐ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ TID рджреНрд╡рд╛рд░рд╛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ TID рдирд╣реАрдВ рд▓реМрдЯрд╛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдмрд┐рдЯрдореИрдк рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░ рд╕рдХрддреА рд╣реИред  рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдмрд┐рдЯрдореИрдк рдкреГрд╖реНрда рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ: рдкреГрд╖реНрда рдкрд░ рд╕рдЯреАрдХ, рдкрдВрдХреНрддрд┐ рдФрд░ рдЕрд╢реБрджреНрдзрд┐ред  рдпрд╣ рдПрдХ рдЧрд▓рдд рдмрд┐рдЯрдореИрдк рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рд╕рд░рд▓ рд╣реИред  рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХрд╛ рдорд╛рдирдЪрд┐рддреНрд░ рдХреНрд░рдорд┐рдХ рд░реВрдк рд╕реЗ рд╕реНрдХреИрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЕрд░реНрдерд╛рдд, рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЙрдирдХреЗ рд╕реНрдерд╛рди рдХреЗ рдХреНрд░рдо рдореЗрдВ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЛ рдкрд╛рд░ рдХрд░ рд▓рд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)ред  рдкреНрд░рддреНрдпреЗрдХ рд╕реАрдорд╛ рдкрд░ рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде рд╕реВрдЪрдХрд╛рдВрдХ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрджрд┐ рдХрд┐рд╕реА рд╢реНрд░реЗрдгреА рдореЗрдВ рдорд╛рдВрдЧреА рдЧрдИ рдорд╛рди рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдпрджрд┐ рдЙрд╕рдореЗрдВ рдорд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╛ рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдЕрдиреБрдкрд▓рдмреНрдз рд╣реИ), рддреЛ рд╢реНрд░реЗрдгреА рдХреЗ рд╕рднреА рдкреГрд╖реНрда рдмрд┐рдЯрдореИрдк рдореЗрдВ рдЬреБрдбрд╝ рдЬрд╛рддреЗ рд╣реИрдВред  рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк рдмрд┐рдЯрдореИрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br><h2>  рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдЕрджреНрдпрддрди рдХрд░рдирд╛ </h2><br>  рдпрд╣ рдЕрдзрд┐рдХ рджрд┐рд▓рдЪрд╕реНрдк рд╣реИ рдХрд┐ рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдмрджрд▓рдиреЗ рдкрд░ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдХреИрд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдХрд┐рд╕реА рддрд╛рд▓рд┐рдХрд╛ рдкреГрд╖реНрда рдкрд░ рдкрдВрдХреНрддрд┐ рдХрд╛ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг <strong>рдЬреЛрдбрд╝рддреЗ</strong> рд╕рдордп, рд╣рдо рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдХрд┐рд╕ рд╕реАрдорд╛ рдореЗрдВ рд╕рдорд╛рд╣рд┐рдд рд╣реИ рдФрд░ рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде рд╕реВрдЪрдХрд╛рдВрдХ рдкрдВрдХреНрддрд┐ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рдорд╛рдирдЪрд┐рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред  рдпреЗ рд╕рднреА рд╕рд░рд▓ рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдСрдкрд░реЗрд╢рди рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╢реНрд░реЗрдгреА рдХрд╛ рдЖрдХрд╛рд░ рдЪрд╛рд░ рдФрд░ рдкреГрд╖реНрда 13 рдкрд░, 42 рдХреЗ рдорд╛рди рдХреЗ рд╕рд╛рде рдПрдХ рдкрдВрдХреНрддрд┐ рд╕рдВрд╕реНрдХрд░рдг рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рд░реЗрдВрдЬ рдХреА рд╕рдВрдЦреНрдпрд╛ (рд╢реВрдиреНрдп рд╕реЗ рд╢реБрд░реВ) 13/4 = 3 рд╣реИ, рдЗрд╕рд▓рд┐рдП, "рд░рд┐рд╡рд╛рдореНрдк" рдореЗрдВ рд╣рдо 3 рдХреА рдСрдлрд╕реЗрдЯ рдХреЗ рд╕рд╛рде рдкреЙрдЗрдВрдЯрд░ рд▓реЗрддреЗ рд╣реИрдВ (рдЗрд╕рдХреА рдХреНрд░рдо рд╕рдВрдЦреНрдпрд╛ рдЪрд╛рд░ рд╣реИ)ред <br><br>  рдЗрд╕ рд╢реНрд░реЗрдгреА рдХреЗ рд▓рд┐рдП рдиреНрдпреВрдирддрдо рдореВрд▓реНрдп 31 рд╣реИ, рдФрд░ рдЕрдзрд┐рдХрддрдо рдПрдХ 40 рд╣реИред рдЪреВрдВрдХрд┐ 42 рдХрд╛ рдирдпрд╛ рдореВрд▓реНрдп рдЕрдВрддрд░рд╛рд▓ рд╕реЗ рдмрд╛рд╣рд░ рд╣реИ, рд╣рдо рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдп (рдЖрдВрдХрдбрд╝рд╛ рджреЗрдЦреЗрдВ) рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдирдпрд╛ рдорд╛рди рдЕрднреА рднреА рд╕рдВрдЧреНрд░рд╣реАрдд рд╕реАрдорд╛ рдХреЗ рднреАрддрд░ рд╣реИ, рддреЛ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИред <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ba7/6ce/e4c/ba76cee4c3d40e9f428954d0478ecee0.png"><br><br>  рдпрд╣ рд╕рдм рдЙрд╕ рд╕реНрдерд┐рддрд┐ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рдЬрдм рдкреГрд╖реНрда рдХрд╛ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдЙрд╕ рд╢реНрд░реЗрдгреА рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рд╣реИред  рдЬрдм рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрдкрд▓рдмреНрдз рд╕рднреА рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдХреА рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЬрдм рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдФрд░ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдирдП рдкреГрд╖реНрда рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕реАрдорд╛рдУрдВ рд╕реЗ рдмрд╛рд╣рд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рджреЛ рд╡рд┐рдХрд▓реНрдк рдпрд╣рд╛рдВ рдЙрдкрд▓рдмреНрдз рд╣реИрдВ: <br><br><ol><li>  рдЖрдорддреМрд░ рдкрд░ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рддреБрд░рдВрдд рдЕрдкрдбреЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣ рдХреЛрдИ рдмрдбрд╝реА рдмрд╛рдд рдирд╣реАрдВ рд╣реИ: рдЬреИрд╕рд╛ рдХрд┐ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрдм рд╕реВрдЪрдХрд╛рдВрдХ рдХреЛ рд╕реНрдХреИрди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдкреВрд░реА рд╕реАрдорд╛ рдкрд░ рдзреНрдпрд╛рди рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЕрджреНрдпрддрди "рд╡реИрдХреНрдпреВрдо" рдХреЗ рджреМрд░рд╛рди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ рдЗрд╕реЗ "brin_summarize_new_values" рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред </li><li> рдпрджрд┐ рд╣рдо "рдСрдЯреЛрд╕реБрдордорд╛рд░рд╛рдЗрдЬ" рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рдЕрдкрдбреЗрдЯ рддреБрд░рдВрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЬрдм рд╕реАрдорд╛ рдХреЗ рдкреГрд╖реНрда рдирдП рдорд╛рдиреЛрдВ рд╕реЗ рдЖрдмрд╛рдж рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЕрдкрдбреЗрдЯ рдЕрдХреНрд╕рд░ рднреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред </li></ol><br>  рдЬрдм рдирдИ рд╕реАрдорд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВ, рддреЛ "рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐" рдХрд╛ рдЖрдХрд╛рд░ рдмрдврд╝ рд╕рдХрддрд╛ рд╣реИред  рдЬрдм рднреА рдорд╛рдирдЪрд┐рддреНрд░, рдореЗрдЯрд╛ рдкреГрд╖реНрда рдФрд░ рд╕рд╛рд░рд╛рдВрд╢ рдбреЗрдЯрд╛ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИ, рдЙрд╕реЗ рджреВрд╕рд░реЗ рдкреГрд╖реНрда рджреНрд╡рд╛рд░рд╛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдореМрдЬреВрджрд╛ рдкрдВрдХреНрддрд┐ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рдХреБрдЫ рдЕрдиреНрдп рдкреГрд╖реНрдареЛрдВ рдкрд░ рд▓реЗ рдЬрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рддреЛ, рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХрд╛ рдирдХреНрд╢рд╛ рд╣рдореЗрд╢рд╛ рдореЗрдЯрд╛ рдкреЗрдЬ рдФрд░ рд╕рд╛рд░рд╛рдВрд╢ рдбреЗрдЯрд╛ рдХреЗ рдмреАрдЪ рд╕реНрдерд┐рдд рд╣реЛрддрд╛ рд╣реИред <br><br>  рдЬрдм рдХреЛрдИ рдкрдВрдХреНрддрд┐ <strong>рд╣рдЯрд╛ рджреА</strong> рдЬрд╛рддреА <strong>рд╣реИ</strong> , рддреЛ ... рдХреБрдЫ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред  рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХрднреА-рдХрднреА рдиреНрдпреВрдирддрдо рдпрд╛ рдЕрдзрд┐рдХрддрдо рдореВрд▓реНрдп рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдЕрдВрддрд░рд╛рд▓ рдХреЛ рдХрдо рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕реАрдорд╛ рдХреЗ рд╕рднреА рдореВрд▓реНрдпреЛрдВ рдХреЛ рдкрдврд╝рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдпрд╣ рдорд╣рдВрдЧрд╛ рд╣реИред <br><br>  рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рд╢реБрджреНрдзрддрд╛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЦреЛрдЬ рдХреЛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╕реЗ рдЕрдзрд┐рдХ рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреЗрдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдРрд╕реЗ рдЬрд╝реЛрди рдХреЗ рд▓рд┐рдП рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рдкреБрдирд░реНрдЧрдгрдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ ("brin_desummarize_range" рдФрд░ "brin_summarize_new_values" рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ), рд▓реЗрдХрд┐рди рд╣рдо рдЗрд╕ рддрд░рд╣ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХрд╛ рдкрддрд╛ рдХреИрд╕реЗ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ?  рд╡реИрд╕реЗ рднреА, рдХреЛрдИ рднреА рдкрд╛рд░рдВрдкрд░рд┐рдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЗрд╕рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИред <br><br>  рдЕрдВрдд рдореЗрдВ, <strong>рдПрдХ рдкрдВрдХреНрддрд┐</strong> рдХреЛ <strong>рдЕрдкрдбреЗрдЯ</strong> рдХрд░рдирд╛ рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдПрдХ рд╡рд┐рд▓реЛрдкрди рд╣реИ рдФрд░ рдПрдХ рдирдпрд╛ рдЬреЛрдбрд╝рдирд╛ рд╣реИред <br><br><h2>  рдЙрджрд╛рд╣рд░рдг </h2><br>  рдЪрд▓реЛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдбреЗрдореЛ рдбреЗрдЯрд╛рдмреЗрд╕</a> рдХреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рд╕реЗ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдорд┐рдиреА рдбреЗрдЯрд╛ рд╡реЗрдпрд░рд╣рд╛рдЙрд╕ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред  рдорд╛рди рд▓реЗрдВ рдХрд┐ рдмреАрдЖрдИ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП, рдПрдХ рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЗ рд╕реЗ рд░рд╡рд╛рдирд╛ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдЙрдбрд╝рд╛рдиреЛрдВ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛ рдХреЗрдмрд┐рди рдореЗрдВ рдПрдХ рд╕реАрдЯ рдХреА рд╕рдЯреАрдХрддрд╛ рдХреЗ рд▓рд┐рдП рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЗ рдкрд░ рдЙрддрд░рд╛ рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдкрд╕рд╛рдорд╛рдиреНрдп рддрд╛рд▓рд┐рдХрд╛ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЗ рдХрд╛ рдбреЗрдЯрд╛ рджрд┐рди рдореЗрдВ рдПрдХ рдмрд╛рд░ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛, рдЬрдм рдпрд╣ рдЙрдЪрд┐рдд рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдореЗрдВ рдордзреНрдпрд░рд╛рддреНрд░рд┐ рд╣реИред  рдбреЗрдЯрд╛ рдХреЛ рди рддреЛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рди рд╣реА рд╣рдЯрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рддрд╛рд▓рд┐рдХрд╛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА: <br><br><pre><code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> flights_bi( airport_code <span class="hljs-type"><span class="hljs-type">char</span></span>(<span class="hljs-number"><span class="hljs-number">3</span></span>), airport_coord <span class="hljs-type"><span class="hljs-type">point</span></span>, <span class="hljs-comment"><span class="hljs-comment">-- geo coordinates of airport airport_utc_offset interval, -- time zone flight_no char(6), -- flight number flight_type text. -- flight type: departure / arrival scheduled_time timestamptz, -- scheduled departure/arrival time of flight actual_time timestamptz, -- actual time of flight aircraft_code char(3), seat_no varchar(4), -- seat number fare_conditions varchar(10), -- travel class passenger_id varchar(20), passenger_name text );</span></span></code> </pre> <br>  рд╣рдо рдиреЗрд╕реНрдЯреЗрдб рд▓реВрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: рдПрдХ рдмрд╛рд╣рд░реА рдПрдХ - рджрд┐рди (рд╣рдо <a href="">рдПрдХ рдмрдбрд╝реЗ рдбреЗрдЯрд╛рдмреЗрд╕</a> рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП 365 рджрд┐рди), рдФрд░ рдПрдХ рдЖрдВрддрд░рд┐рдХ рд▓реВрдк - рд╕рдордп рдХреНрд╖реЗрддреНрд░ (UTC + 02 рд╕реЗ UTC + 12 рддрдХ) ред  рдкреНрд░рд╢реНрди рдмрд╣реБрдд рд▓рдВрдмрд╛ рд╣реИ рдФрд░ рд╡рд┐рд╢реЗрд╖ рд░реБрдЪрд┐ рдХрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореИрдВ рдЗрд╕реЗ рд╕реНрдкреЙрдЗрд▓рд░ рдХреЗ рдиреАрдЪреЗ рдЫрд┐рдкрд╛ рджреВрдВрдЧрд╛ред <br><br><div class="spoiler">  <b class="spoiler_title">рднрдВрдбрд╛рд░рдг рдореЗрдВ рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЕрдиреБрдХрд░рдг</b> <div class="spoiler_text"><pre> <code class="pgsql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DO</span></span> $$<span class="pgsql"><span class="pgsql"> </span><span class="hljs-symbol"><span class="pgsql"><span class="hljs-symbol">&lt;&lt;local&gt;&gt;</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">DECLARE</span></span></span><span class="pgsql"> curdate </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">date</span></span></span><span class="pgsql"> := (</span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">SELECT</span></span></span><span class="pgsql"> min(scheduled_departure) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">FROM</span></span></span><span class="pgsql"> flights); utc_offset </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">interval</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">BEGIN</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHILE</span></span></span><span class="pgsql"> (curdate &lt;= bookings.now()::</span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">date</span></span></span><span class="pgsql">) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">LOOP</span></span></span><span class="pgsql"> utc_offset := </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">interval</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'12 hours'</span></span></span><span class="pgsql">; </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WHILE</span></span></span><span class="pgsql"> (utc_offset &gt;= </span><span class="hljs-type"><span class="pgsql"><span class="hljs-type">interval</span></span></span><span class="pgsql"> </span><span class="hljs-string"><span class="pgsql"><span class="hljs-string">'2 hours'</span></span></span><span class="pgsql">) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">LOOP</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INSERT</span></span></span><span class="pgsql"> </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">INTO</span></span></span><span class="pgsql"> flights_bi </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">WITH</span></span></span><span class="pgsql"> flight ( airport_code, airport_coord, flight_id, flight_no, scheduled_time, actual_time, aircraft_code, flight_type ) </span><span class="hljs-keyword"><span class="pgsql"><span class="hljs-keyword">AS</span></span></span><span class="pgsql"> ( </span><span class="hljs-comment"><span class="pgsql"><span class="hljs-comment">--  SELECT a.airport_code, a.coordinates, f.flight_id, f.flight_no, f.scheduled_departure, f.actual_departure, f.aircraft_code, 'departure' FROM airports a, flights f, pg_timezone_names tzn WHERE a.airport_code = f.departure_airport AND f.actual_departure IS NOT NULL AND tzn.name = a.timezone AND tzn.utc_offset = local.utc_offset AND timezone(a.timezone, f.actual_departure)::date = curdate UNION ALL --  SELECT a.airport_code, a.coordinates, f.flight_id, f.flight_no, f.scheduled_arrival, f.actual_arrival, f.aircraft_code, 'arrival' FROM airports a, flights f, pg_timezone_names tzn WHERE a.airport_code = f.arrival_airport AND f.actual_arrival IS NOT NULL AND tzn.name = a.timezone AND tzn.utc_offset = local.utc_offset AND timezone(a.timezone, f.actual_arrival)::date = curdate ) SELECT f.airport_code, f.airport_coord, local.utc_offset, f.flight_no, f.flight_type, f.scheduled_time, f.actual_time, f.aircraft_code, s.seat_no, s.fare_conditions, t.passenger_id, t.passenger_name FROM flight f JOIN seats s ON s.aircraft_code = f.aircraft_code LEFT JOIN boarding_passes bp ON bp.flight_id = f.flight_id AND bp.seat_no = s.seat_no LEFT JOIN ticket_flights tf ON tf.ticket_no = bp.ticket_no AND tf.flight_id = bp.flight_id LEFT JOIN tickets t ON t.ticket_no = tf.ticket_no; RAISE NOTICE '%, %', curdate, utc_offset; utc_offset := utc_offset - interval '1 hour'; END LOOP; curdate := curdate + 1; END LOOP; END; $$</span></span></span></span>;</code> </pre><br></div></div><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(*) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi;</code> </pre><pre> <code class="plaintext hljs"> count ---------- 30517076 (1 row)</code> </pre><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> pg_size_pretty(pg_total_relation_size(<span class="hljs-string"><span class="hljs-string">'flights_bi'</span></span>));</code> </pre><pre> <code class="plaintext hljs"> pg_size_pretty ---------------- 4127 MB (1 row)</code> </pre><br>  рд╣рдореЗрдВ 30 рдорд┐рд▓рд┐рдпрди рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдФрд░ 4 рдЬреАрдмреА рдорд┐рд▓рддреА рд╣реИрдВред  рдЗрддрдирд╛ рдмрдбрд╝рд╛ рдЖрдХрд╛рд░ рдирд╣реАрдВ, рд▓реЗрдХрд┐рди рдПрдХ рд▓реИрдкрдЯреЙрдк рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд: рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕реНрдХреИрди рдиреЗ рдореБрдЭреЗ рд▓рдЧрднрдЧ 10 рд╕реЗрдХрдВрдб рдХрд╛ рд╕рдордп рджрд┐рдпрд╛ред <br><br><h3>  рд╣рдореЗрдВ рдХрд┐рди рд╕реНрддрдВрднреЛрдВ рдкрд░ рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рд┐рдП? </h3><br>  рдЪреВрдБрдХрд┐ BRIN рдЗрдВрдбреЗрдХреНрд╕ рдХрд╛ рдЖрдХрд╛рд░ рдЫреЛрдЯрд╛ рдФрд░ рдордзреНрдпрдо рдУрд╡рд░рд╣реЗрдб рд▓рд╛рдЧрдд рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЕрджреНрдпрддрди рдЕрдХреНрд╕рд░ рд╣реЛрддрд╛ рд╣реИ, рдпрджрд┐ рдХреЛрдИ рд╣реЛ, рддреЛ рдПрдХ рджреБрд░реНрд▓рдн рдЕрд╡рд╕рд░ рдХрдИ рдЗрдВрдбреЗрдХреНрд╕ "рдмрд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ" рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдарддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрди рд╕рднреА рдХреНрд╖реЗрддреНрд░реЛрдВ рдкрд░, рдЬрд┐рди рдкрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдкрдирд╛ рддрджрд░реНрде рдкреНрд░рд╢реНрди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ ред  рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реЛрдЧрд╛ - рдХреЛрдИ рдмрд╛рдд рдирд╣реАрдВ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрдХ рд╕реВрдЪрдХрд╛рдВрдХ рдЬреЛ рдмрд╣реБрдд рдХреБрд╢рд▓ рдирд╣реАрдВ рд╣реИ, рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕реНрдХреИрди рд╕реЗ рдмреЗрд╣рддрд░ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред  рдмреЗрд╢рдХ, рдРрд╕реЗ рдХреНрд╖реЗрддреНрд░ рд╣реИрдВ рдЬрд┐рди рдкрд░ рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рдирд╛ рдмрд┐рд▓реНрдХреБрд▓ рдмреЗрдХрд╛рд░ рд╣реИ;  рд╢реБрджреНрдз рд╕рд╛рдорд╛рдиреНрдп рдЬреНрдЮрд╛рди рдЙрдиреНрд╣реЗрдВ рд╕рдВрдХреЗрдд рджреЗрдЧрд╛ред <br><br>  рд▓реЗрдХрд┐рди рд╕рд▓рд╛рд╣ рдХреЗ рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рддрдХ рдЦреБрдж рдХреЛ рд╕реАрдорд┐рдд рдХрд░рдирд╛ рдЕрдЬреАрдм рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЗрд╕рд▓рд┐рдП, рдПрдХ рдФрд░ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рдорд╛рдирджрдВрдб рдмрддрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред <br><br>  рд╣рдордиреЗ рдкрд╣рд▓реЗ рд╣реА рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рд╣реИ рдХрд┐ рдбреЗрдЯрд╛ рдХреЛ рдЕрдкрдиреЗ рднреМрддрд┐рдХ рд╕реНрдерд╛рди рдХреЗ рд╕рд╛рде рдХреБрдЫ рд╕рд╣рд╕рдВрдмрдВрдзрд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдпрд╣рд╛рдВ рдпрд╣ рдпрд╛рдж рд░рдЦрдирд╛ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдХрд┐ PostgreSQL рдЯреЗрдмрд▓ рдХреЙрд▓рдо рдЖрдБрдХрдбрд╝реЗ рдЗрдХрдЯреНрдард╛ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рд╣рд╕рдВрдмрдВрдз рдореВрд▓реНрдп рд╢рд╛рдорд┐рд▓ рд╣реИрдВред  рдирд┐рдпреЛрдЬрдХ рдЗрд╕ рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд┐рдпрдорд┐рдд рд╕реВрдЪрдХрд╛рдВрдХ рд╕реНрдХреИрди рдФрд░ рдмрд┐рдЯрдореИрдк рд╕реНрдХреИрди рдХреЗ рдмреАрдЪ рдЪрдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИ, рдФрд░ рд╣рдо рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ BRIN рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рдкреНрд░рдпреЛрдЬреНрдпрддрд╛ рдХрд╛ рдЕрдиреБрдорд╛рди рд▓рдЧрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЙрдкрд░реЛрдХреНрдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдбреЗрдЯрд╛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рджрд┐рдиреЛрдВ ("рдирд┐рд░реНрдзрд╛рд░рд┐рдд_рдЯрд╛рдЗрдо" рдХреЗ рд╕рд╛рде-рд╕рд╛рде "рд╡рд╛рд╕реНрддрд╡рд┐рдХ_рдЯрд╛рдЗрдо" рджреНрд╡рд╛рд░рд╛ - рдмрд╣реБрдд рдЕрдзрд┐рдХ рдЕрдВрддрд░ рдирд╣реАрдВ рд╣реИ) рдХрд╛ рдЖрджреЗрд╢ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдРрд╕рд╛ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЬрдм рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ (рдмрд┐рдирд╛ рд╡рд┐рд▓реЛрдк рдФрд░ рдЕрдкрдбреЗрдЯ рдХреЗ), рддреЛ рд╡реЗ рдПрдХ рдХреЗ рдмрд╛рдж рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд░рдЦреА рдЬрд╛рддреА рд╣реИрдВред  рдбреЗрдЯрд╛ рд▓реЛрдбрд┐рдВрдЧ рдХреЗ рд╕рд┐рдореБрд▓реЗрд╢рди рдореЗрдВ рд╣рдордиреЗ ORDER BY рдХреНрд▓реЙрдЬ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛, рдЗрд╕рд▓рд┐рдП, рдПрдХ рджрд┐рди рдХреЗ рднреАрддрд░ рддрд╛рд░реАрдЦреЗрдВ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ, рдПрдХ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдорд┐рд▓рд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрджреЗрд╢ рдЬрдЧрд╣ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЖрдЗрдП рдЗрд╕рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span> flights_bi; demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> attname, correlation <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_stats <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tablename=<span class="hljs-string"><span class="hljs-string">'flights_bi'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> correlation <span class="hljs-keyword"><span class="hljs-keyword">desc</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nulls last</span></span>;</code> </pre><pre> <code class="plaintext hljs"> attname | correlation --------------------+------------- scheduled_time | 0.999994 actual_time | 0.999994 fare_conditions | 0.796719 flight_type | 0.495937 airport_utc_offset | 0.438443 aircraft_code | 0.172262 airport_code | 0.0543143 flight_no | 0.0121366 seat_no | 0.00568042 passenger_name | 0.0046387 passenger_id | -0.00281272 airport_coord | (12 rows)</code> </pre><br>  рд╡рд╣ рдорд╛рди рдЬреЛ рд╢реВрдиреНрдп рдХреЗ рдХрд░реАрдм рдирд╣реАрдВ рд╣реИ (рдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, рдкреНрд▓рд╕-рдорд╛рдЗрдирд╕ рдПрдХ рдХреЗ рдкрд╛рд╕, рдЬреИрд╕рд╛ рдХрд┐ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣реИ), рд╣рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ BRIN рдЗрдВрдбреЗрдХреНрд╕ рдЙрдкрдпреБрдХреНрдд рд╣реЛрдЧрд╛ред <br><br>  рдпрд╛рддреНрд░рд╛ рд╡рд░реНрдЧ "fare_condition" (рдХреЙрд▓рдо рдореЗрдВ рддреАрди рдЕрджреНрд╡рд┐рддреАрдп рдореВрд▓реНрдп рд╣реИрдВ) рдФрд░ рдЙрдбрд╝рд╛рди рдХрд╛ рдкреНрд░рдХрд╛рд░ "рдЙрдбрд╝рд╛рди_ рдкреНрд░рдХрд╛рд░" (рджреЛ рдЕрджреНрд╡рд┐рддреАрдп рдореВрд▓реНрдп) рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд░реВрдк рд╕реЗ рджреВрд╕рд░реЗ рдФрд░ рддреАрд╕рд░реЗ рд╕реНрдерд╛рди рдкрд░ рджрд┐рдЦрд╛рдИ рджрд┐рдПред  рдпрд╣ рдПрдХ рднреНрд░рдо рд╣реИ: рдФрдкрдЪрд╛рд░рд┐рдХ рд░реВрдк рд╕реЗ рд╕рд╣рд╕рдВрдмрдВрдз рдЙрдЪреНрдЪ рд╣реИ, рдЬрдмрдХрд┐ рдХрдИ рдХреНрд░рдорд┐рдХ рдкреГрд╖реНрдареЛрдВ рдкрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╕рднреА рд╕рдВрднрд╡ рдорд╛рдиреЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝реЗрдЧрд╛, рдЬрд┐рд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдмреНрд░рд┐рди рдХреЛрдИ рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред <br><br>  рдЯрд╛рдЗрдо рдЬрд╝реЛрди "Airport_utc_offset" рдЖрдЧреЗ рдЬрд╛рддрд╛ рд╣реИ: рдорд╛рдирд╛ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рдПрдХ рджрд┐рди рдХреЗ рдЪрдХреНрд░ рдХреЗ рднреАрддрд░, рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЛрдВ рдХреЛ рдЯрд╛рдЗрдо рдЬрд╝реЛрди рджреНрд╡рд╛рд░рд╛ "рдирд┐рд░реНрдорд╛рдг рджреНрд╡рд╛рд░рд╛" рдЖрджреЗрд╢ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред <br><br>  рдпрд╣ рдЗрди рджреЛ рдХреНрд╖реЗрддреНрд░реЛрдВ, рд╕рдордп рдФрд░ рд╕рдордп рдХреНрд╖реЗрддреНрд░ рд╣реИ, рдЬрд┐рд╕реЗ рд╣рдо рдЖрдЧреЗ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br><h3>  рд╕рд╣рд╕рдВрдмрдВрдз рдХрд╛ рдХрдордЬреЛрд░ рдХрдордЬреЛрд░ рд╣реЛрдирд╛ </h3><br>  рдбреЗрдЯрд╛ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд┐рдП рдЬрд╛рдиреЗ рдкрд░ "рдирд┐рд░реНрдорд╛рдг рджреНрд╡рд╛рд░рд╛" рд╕рд╣рд╕рдВрдмрдВрдз рдЖрд╕рд╛рдиреА рд╕реЗ рдХрдордЬреЛрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред  рдФрд░ рдпрд╣рд╛рдВ рдорд╛рдорд▓рд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдореВрд▓реНрдп рдХреЗ рдкрд░рд┐рд╡рд░реНрддрди рдореЗрдВ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди рдорд▓реНрдЯреАрд╡реЗрд░рд╕ рдХреЙрдиреНрд╕рд┐рд░реЗрдиреНрд╕реА рдХрдВрдЯреНрд░реЛрд▓ рдХреА рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ: рдПрдХ рдкреГрд╖реНрда рдкрд░ рдкреБрд░рд╛рдирд╛ рдкрдВрдХреНрддрд┐ рд╕рдВрд╕реНрдХрд░рдг рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЬрд╣рд╛рдВ рднреА рдореБрдлреНрдд рд╕реНрдерд╛рди рдЙрдкрд▓рдмреНрдз рд╣реИ, рд╡рд╣рд╛рдВ рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдЕрдкрдбреЗрдЯ рдХреЗ рджреМрд░рд╛рди рдкреВрд░реА рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдорд┐рд╢реНрд░рд┐рдд рд╣реЛ рдЬрд╛рддреА рд╣реИрдВред <br><br>  рд╣рдо рдЖрдВрд╢рд┐рдХ рд░реВрдк рд╕реЗ "рдлрд┐рд▓рдлреИрдХреНрдЯрд░" рднрдВрдбрд╛рд░рдг рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдХрдо рдХрд░рдХреЗ рдФрд░ рднрд╡рд┐рд╖реНрдп рдХреЗ рдЕрдкрдбреЗрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреГрд╖реНрда рдкрд░ рдЦрд╛рд▓реА рдЬрдЧрд╣ рдЫреЛрдбрд╝рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЗрд╕ рдЖрд╢рдп рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдХреНрдпрд╛ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд┐рд╢рд╛рд▓ рддрд╛рд▓рд┐рдХрд╛ рдХрд╛ рдЖрдХрд╛рд░ рдмрдврд╝рд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рд╡рд┐рд▓реЛрдкрди рдХреЗ рдореБрджреНрджреЗ рдХреЛ рд╣рд▓ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ: рд╡реЗ рдореМрдЬреВрджрд╛ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рдЕрдВрджрд░ рдХрд╣реАрдВ рдФрд░ рд╕реНрдерд╛рди рдЦрд╛рд▓реА рдХрд░рдХреЗ рдирдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП "рдЬрд╛рд▓ рд╕реЗрдЯ" рднреА рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕рдХреЗ рдХрд╛рд░рдг, рдЬреЛ рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдЕрдиреНрдпрдерд╛ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдЕрдВрдд рдореЗрдВ рдкрд╣реБрдБрдЪ рдЬрд╛рдПрдВрдЧреА, рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ рдордирдорд╛рдиреЗ рд╕реНрдерд╛рди рдкрд░ рдбрд╛рд▓рд╛ рдЬрд╛рдПрдЧрд╛ред <br><br>  рд╡реИрд╕реЗ, рдпрд╣ рдПрдХ рдЬрд┐рдЬреНрдЮрд╛рд╕реБ рддрдереНрдп рд╣реИред  рдЪреВрдВрдХрд┐ BRIN рдЗрдВрдбреЗрдХреНрд╕ рдореЗрдВ рдЯреЗрдмрд▓ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рд╕рдВрджрд░реНрдн рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХреА рдЙрдкрд▓рдмреНрдзрддрд╛ HOT рдЕрдкрдбреЗрдЯ рдХреЛ рдмрд┐рд▓реНрдХреБрд▓ рднреА рдмрд╛рдзрд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рд▓реЗрдХрд┐рди рдпрд╣ рдХрд░рддрд╛ рд╣реИред <br><br>  рддреЛ, BRIN рдореБрдЦреНрдп рд░реВрдк рд╕реЗ рдмрдбрд╝реЗ рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдмрдбрд╝реЗ рдЖрдХрд╛рд░реЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ рдпрд╛ рддреЛ рдмрд┐рд▓реНрдХреБрд▓ рдЕрджреНрдпрддрди рдирд╣реАрдВ рд╣реИрдВ рдпрд╛ рдмрд╣реБрдд рдереЛрдбрд╝реЗ рд╕реЗ рдЕрдкрдбреЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдирдИ рдкрдВрдХреНрддрд┐рдпреЛрдВ (рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдЕрдВрдд рддрдХ) рдХреЗ рд╕рд╛рде рдореБрдХрд╛рдмрд▓рд╛ рдХрд░рддрд╛ рд╣реИред  рдпрд╣ рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХреНрд╕реЗрд╕ рд╡рд┐рдзрд┐ рдбреЗрдЯрд╛ рд╡реЗрдпрд░рд╣рд╛рдЙрд╕ рдФрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдгрд╛рддреНрдордХ рд░рд┐рдкреЛрд░реНрдЯрд┐рдВрдЧ рдХреА рджреГрд╖реНрдЯрд┐ рд╕реЗ рдмрдирд╛рдИ рдЧрдИ рдереАред <br><br><h3>  рд╣рдореЗрдВ рдХрд┐рд╕ рд╢реНрд░реЗрдгреА рдХрд╛ рдЪрдпрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? </h3><br>  рдпрджрд┐ рд╣рдо рдПрдХ рдЯреЗрд░рд╛рдмрд╛рдЗрдЯ рдЯреЗрдмрд▓ рд╕реЗ рдирд┐рдкрдЯрддреЗ рд╣реИрдВ, рддреЛ рд░реЗрдВрдЬ рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рдЪрдпрди рдХрд░рддреЗ рд╕рдордп рд╣рдорд╛рд░реА рдореБрдЦреНрдп рдЪрд┐рдВрддрд╛ рд╢рд╛рдпрдж рдмреНрд░рд┐рди рдЗрдВрдбреЗрдХреНрд╕ рдХреЛ рдмрд╣реБрдд рдмрдбрд╝рд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдорд╛рд░реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдо рдбреЗрдЯрд╛ рдХрд╛ рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдХрд┐рд╕реА рд╕реНрддрдВрдн рдХреЗ рдЕрдирдиреНрдп рдорд╛рдиреЛрдВ рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╡реЗ рдХрд┐рддрдиреЗ рдкреГрд╖реНрда рд╣реИрдВред  рдорд╛рдиреЛрдВ рдХреЗ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг рд╕реЗ BRIN рдЗрдВрдбреЗрдХреНрд╕ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдореЗрдВ рд╕рдлрд▓рддрд╛ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрдврд╝ рдЬрд╛рддреА рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреГрд╖реНрдареЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдПрдХ рд╢реНрд░реЗрдгреА рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рд╕рдВрдХреЗрдд рджреЗрдЧреАред  рд▓реЗрдХрд┐рди рдпрджрд┐ рдореВрд▓реНрдп рд╕рднреА рдкреГрд╖реНрдареЛрдВ рдкрд░ "рдлреИрд▓рд╛ рд╣реБрдЖ" рд╣реИ, рддреЛ BRIN рдмреЗрдХрд╛рд░ рд╣реИред <br><br>  рдмреЗрд╢рдХ, рд╣рдореЗрдВ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдбреЗрдЯрд╛ рдХреА рдЖрдВрддрд░рд┐рдХ рд╕рдВрд░рдЪрдирд╛ рдкрд░ рдирдЬрд░ рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрд╣ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдореВрд▓реНрдп рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рддреНрдпреЗрдХ рддрд┐рдерд┐ (рдЕрдзрд┐рдХ рд╕рдЯреАрдХ, рдПрдХ рдЯрд╛рдЗрдорд╕реНрдЯреИрдореНрдк, рд╕рдордп рд╕рд╣рд┐рдд) рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдорддрд▓рдм рдирд╣реАрдВ рд╣реИ - рд╣рдореЗрдВ рдЗрд╕реЗ рджрд┐рдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЧреЛрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br>  рддрдХрдиреАрдХреА рд░реВрдк рд╕реЗ, рдпрд╣ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЫрд┐рдкреЗ рд╣реБрдП "ctid" рдХреЙрд▓рдо рдХреЗ рдореВрд▓реНрдп рдХреЛ рджреЗрдЦрдХрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ рдкрдВрдХреНрддрд┐ рд╕рдВрд╕реНрдХрд░рдг (TID) рдХреЛ рд╕реВрдЪрдХ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ: рдкреГрд╖реНрда рдХреА рд╕рдВрдЦреНрдпрд╛ рдФрд░ рдкреГрд╖реНрда рдХреЗ рдЕрдВрджрд░ рдкрдВрдХреНрддрд┐ рдХреА рд╕рдВрдЦреНрдпрд╛ред  рджреБрд░реНрднрд╛рдЧреНрдп рд╕реЗ, TID рдХреЛ рдЗрд╕рдХреЗ рджреЛ рдШрдЯрдХреЛрдВ рдореЗрдВ рд╡рд┐рдШрдЯрд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрдИ рдкрд╛рд░рдВрдкрд░рд┐рдХ рддрдХрдиреАрдХ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рдкрд╛рда рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЯрд╛рдЗрдк рдХрд░рдирд╛ рд╣реЛрдЧрд╛: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> min(numblk), round(avg(numblk)) avg, max(numblk) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> count(<span class="hljs-keyword"><span class="hljs-keyword">distinct</span></span> (ctid::<span class="hljs-type"><span class="hljs-type">text</span></span>::<span class="hljs-type"><span class="hljs-type">point</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]) numblk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> scheduled_time::<span class="hljs-type"><span class="hljs-type">date</span></span> ) t;</code> </pre><pre> <code class="plaintext hljs"> min | avg | max ------+------+------ 1192 | 1500 | 1796 (1 row)</code> </pre><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> relpages <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_class <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> relname = <span class="hljs-string"><span class="hljs-string">'flights_bi'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> relpages ---------- 528172 (1 row)</code> </pre><br>  рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рджрд┐рди рдХреЛ рд╕рдорд╛рди рд░реВрдк рд╕реЗ рдкреГрд╖реНрдареЛрдВ рдкрд░ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рджрд┐рди рдПрдХ-рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рдереЛрдбрд╝рд╛ рдорд┐рд╢реНрд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ (1500 рдФрд░ рдЧреБрдгрд╛ 365 = 547500, рдЬреЛ рддрд╛рд▓рд┐рдХрд╛ 528172 рдореЗрдВ рдкреГрд╖реНрдареЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рдереЛрдбрд╝рд╛ рд╣реА рдмрдбрд╝рд╛ рд╣реИ)ред  рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡реИрд╕реЗ рднреА "рдирд┐рд░реНрдорд╛рдг рджреНрд╡рд╛рд░рд╛" рд╕реНрдкрд╖реНрдЯ рд╣реИред <br><br>  рдпрд╣рд╛рдБ рдмрд╣реБрдореВрд▓реНрдп рдЬрд╛рдирдХрд╛рд░реА рдкреГрд╖реНрдареЛрдВ рдХреА рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕рдВрдЦреНрдпрд╛ рд╣реИред  128 рдкреГрд╖реНрдареЛрдВ рдХреЗ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд░реЗрдВрдЬ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде, рдкреНрд░рддреНрдпреЗрдХ рджрд┐рди 9-14 рд╢реНрд░реЗрдгрд┐рдпреЛрдВ рдХреЛ рдЖрдмрд╛рдж рдХрд░реЗрдЧрд╛ред  рдпрд╣ рдпрдерд╛рд░реНрдерд╡рд╛рджреА рд▓рдЧрддрд╛ рд╣реИ: рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рджрд┐рди рдХреЗ рд▓рд┐рдП рдХреНрд╡реЗрд░реА рдХреЗ рд╕рд╛рде, рд╣рдо рд▓рдЧрднрдЧ 10% рддреНрд░реБрдЯрд┐ рдХреА рдЙрдореНрдореАрдж рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЖрдЗрдП рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> brin(scheduled_time);</code> </pre><br>  рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЖрдХрд╛рд░ 184 KB рдЬрд┐рддрдирд╛ рдЫреЛрдЯрд╛ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> pg_size_pretty(pg_total_relation_size(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span>));</code> </pre><pre> <code class="plaintext hljs"> pg_size_pretty ---------------- 184 kB (1 row)</code> </pre><br>  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╕рдЯреАрдХрддрд╛ рдХреЛ рдЦреЛрдиреЗ рдХреА рдХреАрдордд рдкрд░ рдПрдХ рд╕реАрдорд╛ рдХреЗ рдЖрдХрд╛рд░ рдореЗрдВ рд╡реГрджреНрдзрд┐ рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реИред  рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ, рддреЛ рд╣рдо рдЖрдХрд╛рд░ рдХреЛ рдХрдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рдЯреАрдХрддрд╛, рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд, рд╡реГрджреНрдзрд┐ (рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдЖрдХрд╛рд░ рдХреЗ рд╕рд╛рде) рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br>  рдЕрдм рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдХреЛ рджреЗрдЦрддреЗ рд╣реИрдВред  рдпрд╣рд╛рдВ рд╣рдо рдПрдХ рдмреНрд░реВрдЯ-рдмрд▓ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╕рднреА рдорд╛рдиреЛрдВ рдХреЛ рджрд┐рди рдЪрдХреНрд░реЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╕реЗ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рд╡рд┐рддрд░рдг рдкреНрд░рддреНрдпреЗрдХ рджрд┐рди рдХреЗ рднреАрддрд░ рджреЛрд╣рд░рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЪреВрдВрдХрд┐ рдХреБрдЫ рд╣реА рд╕рдордп рдХреНрд╖реЗрддреНрд░ рд╣реИрдВ, рд╣рдо рдкреВрд░реЗ рд╡рд┐рддрд░рдг рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> airport_utc_offset, count(<span class="hljs-keyword"><span class="hljs-keyword">distinct</span></span> (ctid::<span class="hljs-type"><span class="hljs-type">text</span></span>::<span class="hljs-type"><span class="hljs-type">point</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>])/<span class="hljs-number"><span class="hljs-number">365</span></span> numblk <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> airport_utc_offset <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><pre> <code class="plaintext hljs"> airport_utc_offset | numblk --------------------+-------- 12:00:00 | 6 06:00:00 | 8 02:00:00 | 10 11:00:00 | 13 08:00:00 | 28 09:00:00 | 29 10:00:00 | 40 04:00:00 | 47 07:00:00 | 110 05:00:00 | 231 03:00:00 | 932 (11 rows)</code> </pre><br>  рдФрд╕рддрди, рд╣рд░ рдмрд╛рд░ рдЬрд╝реЛрди рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рдПрдХ рджрд┐рди рдореЗрдВ 133 рдкреГрд╖реНрдареЛрдВ рдХреЛ рдкреЙрдкреНрдпреБрд▓реЗрдЯ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд┐рддрд░рдг рдЕрддреНрдпрдзрд┐рдХ рдЧреИрд░-рд╕рдорд╛рди рд╣реИ: рдкреЗрдЯреНрд░реЛрдкрд╛рд╡рд▓реЛрд╡реНрд╕реНрдХ-рдХрд╛рдордЪрддреНрд╕реНрдХреА рдФрд░ рдЕрдирд╛рджрд┐рд░ рдЫрд╣ рдкреГрд╖реНрдареЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдлрд┐рдЯ рд╣реЛрддреЗ рд╣реИрдВ, рдЬрдмрдХрд┐ рдореЙрд╕реНрдХреЛ рдФрд░ рдЗрд╕рдХреЗ рдкрдбрд╝реЛрд╕ рдХреЛ рдЙрдирдореЗрдВ рд╕реЗ рд╕реИрдХрдбрд╝реЛрдВ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдХрд┐рд╕реА рд╢реНрд░реЗрдгреА рдХрд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдЖрдХрд╛рд░ рдпрд╣рд╛рдВ рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реИ;  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЗрд╕реЗ рдЪрд╛рд░ рдкреГрд╖реНрдареЛрдВ рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> brin(airport_utc_offset) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> (pages_per_range=<span class="hljs-number"><span class="hljs-number">4</span></span>); demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> pg_size_pretty(pg_total_relation_size(<span class="hljs-string"><span class="hljs-string">'flights_bi_airport_utc_offset_idx'</span></span>));</code> </pre><pre> <code class="plaintext hljs"> pg_size_pretty ---------------- 6528 kB (1 row)</code> </pre><br><h2>  рдирд┐рд╖реНрдкрд╛рджрди рдпреЛрдЬрдирд╛ </h2><br>  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред  рдЖрдЗрдП, рдХрд┐рд╕реА рджрд┐рди рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ, рдХрд╣рддреЗ рд╣реИрдВ, рдПрдХ рд╕рдкреНрддрд╛рд╣ рдкрд╣рд▓реЗ (рдбреЗрдореЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ, "рдЖрдЬ" "рдмреБрдХрд┐рдВрдЧ.рд╡рди" рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ): <br><br><pre> <code class="pgsql hljs">demo=# \<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> d <span class="hljs-string"><span class="hljs-string">'bookings.now()::date - interval \'</span></span><span class="hljs-number"><span class="hljs-number">7</span></span> days\<span class="hljs-string"><span class="hljs-string">''</span></span> demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> scheduled_time &gt;= :d <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> scheduled_time &lt; :d + <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 day'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN -------------------------------------------------------------------------------- Bitmap Heap Scan on flights_bi (actual time=10.282..94.328 rows=83954 loops=1) Recheck Cond: ... Rows Removed by Index Recheck: 12045 Heap Blocks: lossy=1664 -&gt; Bitmap Index Scan on flights_bi_scheduled_time_idx (actual time=3.013..3.013 rows=16640 loops=1) Index Cond: ... Planning time: 0.375 ms Execution time: 97.805 ms</code> </pre><br>  рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпреЛрдЬрдирд╛рдХрд╛рд░ рдиреЗ рдмрдирд╛рдП рдЧрдП рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдпрд╣ рдХрд┐рддрдирд╛ рд╕рд╣реА рд╣реИ?  рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реМрдЯреЗ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреА рдХреБрд▓ рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рдХреНрд╡реЗрд░реА рдХреА рд╢рд░реНрддреЛрдВ (рдмрд┐рдЯрдореИрдк рд╣реАрдк рдиреЛрдб рдХреЗ "рдкрдВрдХреНрддрд┐рдпреЛрдВ" рд╕реЗ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓реА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдЕрдиреБрдкрд╛рдд) (рдЗрд╕реА рдореВрд▓реНрдп рдкреНрд▓рд╕ рдЗрдВрдбреЗрдХреНрд╕ рджреНрд╡рд╛рд░рд╛ рд╣рдЯрд╛рдП рдЧрдП рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ) рд╣рдореЗрдВ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрддрд╛рддрд╛ рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ 83954 / (83954 + 12045), рдЬреЛ рдХрд┐ рд▓рдЧрднрдЧ 90% рд╣реИ, рдЬреИрд╕рд╛ рдХрд┐ рдЕрдкреЗрдХреНрд╖рд┐рдд рдерд╛ (рдпрд╣ рдореВрд▓реНрдп рдПрдХ рджрд┐рди рд╕реЗ рджреВрд╕рд░реЗ рджрд┐рди рдмрджрд▓ рдЬрд╛рдПрдЧрд╛)ред <br><br>  рдмрд┐рдЯрдореИрдк рдЗрдВрдбреЗрдХреНрд╕ рд╕реНрдХреИрди рдиреЛрдб рдХреА "рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдкрдВрдХреНрддрд┐рдпреЛрдВ" рдореЗрдВ 16640 рдирдВрдмрд░ рдХрд╣рд╛рдБ рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддрд╛ рд╣реИ?  рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ рдпреЛрдЬрдирд╛ рдХрд╛ рдпрд╣ рдиреЛрдб рдЧрд▓рдд (рдкреГрд╖реНрда-рджрд░-рдкреГрд╖реНрда) рдмрд┐рдЯрдореИрдк рдмрдирд╛рддрд╛ рд╣реИ рдФрд░ рдмрд┐рдЯрдореИрдк рдХреЛ рдХрд┐рддрдиреА рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╕реНрдкрд░реНрд╢ рдХрд░реЗрдЧрд╛, рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдЕрдирднрд┐рдЬреНрдЮ рд╣реИ, рдЬрдмрдХрд┐ рдХреБрдЫ рджрд┐рдЦрд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдирд┐рд░рд╛рд╢рд╛ рдореЗрдВ рдПрдХ рдкреГрд╖реНрда рдореЗрдВ 10 рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдмрд┐рдЯрдореИрдк рдореЗрдВ рдХреБрд▓ 1664 рдкреГрд╖реНрда рд╣реИрдВ (рдпрд╣ рдорд╛рди "рд╣реАрдк рдмреНрд▓реЙрдХреНрд╕: рд╣рд╛рдирд┐рдкреВрд░реНрдг = 1664" рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ);  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рд╕рд┐рд░реНрдл 16640 рдорд┐рд▓рддреЗ рд╣реИрдВред рдХреБрд▓ рдорд┐рд▓рд╛рдХрд░, рдпрд╣ рдПрдХ рд╕рдВрд╡реЗрджрдирд╣реАрди рд╕рдВрдЦреНрдпрд╛ рд╣реИ, рдЬрд┐рд╕ рдкрд░ рд╣рдореЗрдВ рдзреНрдпрд╛рди рдирд╣реАрдВ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br>  рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреИрд╕реЗ?  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЪрд▓реЛ рд╡реНрд▓рд╛рджрд┐рд╡реЛрд╕реНрддреЛрдХ рдХреЗ рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдХреЛ рд▓реЗрддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рджрд┐рди рдореЗрдВ 28 рдкреГрд╖реНрда рдЖрдмрд╛рдж рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> airport_utc_offset = <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'8 hours'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ---------------------------------------------------------------------------------- Bitmap Heap Scan on flights_bi (actual time=75.151..192.210 rows=587353 loops=1) Recheck Cond: (airport_utc_offset = '08:00:00'::interval) Rows Removed by Index Recheck: 191318 Heap Blocks: lossy=13380 -&gt; Bitmap Index Scan on flights_bi_airport_utc_offset_idx (actual time=74.999..74.999 rows=133800 loops=1) Index Cond: (airport_utc_offset = '08:00:00'::interval) Planning time: 0.168 ms Execution time: 212.278 ms</code> </pre><br>  рдпреЛрдЬрдирд╛рдХрд╛рд░ рдлрд┐рд░ рд╕реЗ рдмрдирд╛рдП рдЧрдП BRIN рдЗрдВрдбреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рд╕рдЯреАрдХрддрд╛ рдмрджрддрд░ рд╣реИ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд▓рдЧрднрдЧ 75%), рд▓реЗрдХрд┐рди рдпрд╣ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рд╕рд╣рд╕рдВрдмрдВрдз рдХрдо рд╣реЛрдиреЗ рдХреЗ рдмрд╛рдж рд╕реЗред <br><br>  рдХрдИ BRIN рдЗрдВрдбреЗрдХреНрд╕ (рдХрд┐рд╕реА рднреА рдЕрдиреНрдп рдХреА рддрд░рд╣) рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдмрд┐рдЯрдореИрдк рд╕реНрддрд░ рдкрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдорд╣реАрдиреЗ рдХреЗ рд▓рд┐рдП рдЪрдпрдирд┐рдд рдЯрд╛рдЗрдо рдЬрд╝реЛрди рдкрд░ рдбреЗрдЯрд╛ (рдиреЛрдЯрд┐рд╕ "рдмрд┐рдЯрдореИрдк рдФрд░ рдиреЛрдб") рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# \<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> d <span class="hljs-string"><span class="hljs-string">'bookings.now()::date - interval \'</span></span><span class="hljs-number"><span class="hljs-number">60</span></span> days\<span class="hljs-string"><span class="hljs-string">''</span></span> demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> scheduled_time &gt;= :d <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> scheduled_time &lt; :d + <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'30 days'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> airport_utc_offset = <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'8 hours'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN --------------------------------------------------------------------------------- Bitmap Heap Scan on flights_bi (actual time=62.046..113.849 rows=48154 loops=1) Recheck Cond: ... Rows Removed by Index Recheck: 18856 Heap Blocks: lossy=1152 -&gt; BitmapAnd (actual time=61.777..61.777 rows=0 loops=1) -&gt; Bitmap Index Scan on flights_bi_scheduled_time_idx (actual time=5.490..5.490 rows=435200 loops=1) Index Cond: ... -&gt; Bitmap Index Scan on flights_bi_airport_utc_offset_idx (actual time=55.068..55.068 rows=133800 loops=1) Index Cond: ... Planning time: 0.408 ms Execution time: 115.475 ms</code> </pre><br><h3>  рдмреА-рдЯреНрд░реА рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ </h3><br>  рдХреНрдпрд╛ рд╣реЛрдЧрд╛ рдпрджрд┐ рд╣рдо BRIN рдХреЗ рд╕рдорд╛рди рдХреНрд╖реЗрддреНрд░ рдкрд░ рдирд┐рдпрдорд┐рдд B- рдЯреНрд░реА рдЗрдВрдбреЗрдХреНрд╕ рдмрдирд╛рддреЗ рд╣реИрдВ? <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> flights_bi_scheduled_time_btree <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> flights_bi(scheduled_time); demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> pg_size_pretty(pg_total_relation_size(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_btree'</span></span>));</code> </pre><pre> <code class="plaintext hljs"> pg_size_pretty ---------------- 654 MB (1 row)</code> </pre><br>  рдпрд╣ рд╣рдорд╛рд░реЗ BRIN рд╕реЗ <em>рдХрдИ рд╣рдЬрд╛рд░ рдЧреБрдирд╛ рдмрдбрд╝рд╛</em> рджрд┐рдЦрд╛рдИ рджрд┐рдпрд╛!  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдХреНрд╡реЗрд░реА рдХреЛ рдереЛрдбрд╝реА рддреЗрдЬрд╝реА рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: рдкреНрд▓рд╛рдирд░ рдиреЗ рдЖрдБрдХрдбрд╝реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдХрд┐ рдбреЗрдЯрд╛ рдХреЛ рднреМрддрд┐рдХ рд░реВрдк рд╕реЗ рдСрд░реНрдбрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрд┐рдЯрдореИрдк рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ рдФрд░, рдореБрдЦреНрдп рд░реВрдк рд╕реЗ, рд╕реВрдЪрдХрд╛рдВрдХ рдХреА рд╕реНрдерд┐рддрд┐ рдХреЛ рдлрд┐рд░ рд╕реЗ рдЬрд╛рдБрдЪрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> scheduled_time &gt;= :d <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> scheduled_time &lt; :d + <span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-string"><span class="hljs-string">'1 day'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ---------------------------------------------------------------- Index Scan using flights_bi_scheduled_time_btree on flights_bi (actual time=0.099..79.416 rows=83954 loops=1) Index Cond: ... Planning time: 0.500 ms Execution time: 85.044 ms</code> </pre><br>  рдмреНрд░рд┐рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЗрддрдирд╛ рдЕрджреНрднреБрдд рд╣реИ: рд╣рдо рджрдХреНрд╖рддрд╛ рдХрд╛ рддреНрдпрд╛рдЧ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдмрд╣реБрдд рдЕрдзрд┐рдХ рд╕реНрдерд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред <br><br><h2>  рд╕рдВрдЪрд╛рд▓рдХ рд╡рд░реНрдЧ </h2><br><h3>  minmax </h3><br>  рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреА рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ, рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА <em>рдореЗрдВ рдиреНрдпреВрдирддрдо рдФрд░ рдЕрдзрд┐рдХрддрдо рдорд╛рди рд╢рд╛рдорд┐рд▓ рд╣реИрдВ</em> ред  рд╕рдВрдмрдВрдзрд┐рдд рдСрдкрд░реЗрдЯрд░ рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рдирд╛рдореЛрдВ рдореЗрдВ "рдорд╛рдЗрдирдореИрдХреНрд╕" рд╣реЛрддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, "рдбреЗрдЯ_рдорд┐рдирдореИрдХреНрд╕_рдУрдкреНрд╕"ред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпреЗ рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рд╣реИрдВ рдЬреЛ рд╣рдо рдЕрдм рддрдХ рд╡рд┐рдЪрд╛рд░ рдХрд░ рд░рд╣реЗ рдереЗ, рдФрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдкреНрд░рдХрд╛рд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣реИрдВред <br><br><h3>  рд╕рдореНрдорд┐рд▓рд┐рдд </h3><br>  рддреБрд▓рдирд╛ рдСрдкрд░реЗрдЯрд░реЛрдВ рдХреЛ рд╕рднреА рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЗрдВ рдмрд┐рдВрджреБрдУрдВ ("рдмрд┐рдВрджреБ" рдкреНрд░рдХрд╛рд░) рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬреЛ рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЛрдВ рдХреЗ рднреМрдЧреЛрд▓рд┐рдХ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреЗ рд╣реИрдВред  рд╡реИрд╕реЗ, рдпрд╣ рдЗрд╕ рдХрд╛рд░рдг рд╕реЗ рд╣реИ рдХрд┐ рдЖрдВрдХрдбрд╝реЗ рдЗрд╕ рд╕реНрддрдВрдн рдХреЗ рд▓рд┐рдП рд╕рд╣рд╕рдВрдмрдВрдз рдирд╣реАрдВ рджрд┐рдЦрд╛рддреЗ рд╣реИрдВред <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> attname, correlation <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_stats <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tablename=<span class="hljs-string"><span class="hljs-string">'flights_bi'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> attname = <span class="hljs-string"><span class="hljs-string">'airport_coord'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> attname | correlation ---------------+------------- airport_coord | (1 row)</code> </pre><br>  рд▓реЗрдХрд┐рди рдРрд╕реЗ рдХрдИ рдкреНрд░рдХрд╛рд░ рд╣рдореЗрдВ "рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рдПрд░рд┐рдпрд╛" рдХреА рдЕрд╡рдзрд╛рд░рдгрд╛ рдХреЛ рдкреЗрд╢ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЬреНрдпрд╛рдорд┐рддреАрдп рдЖрдХреГрддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдмрд╛рдЙрдВрдбрд┐рдВрдЧ рдЖрдпрддред  рд╣рдордиреЗ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рдЪрд░реНрдЪрд╛ рдХреА рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">GiST</a> рд╕реВрдЪрдХрд╛рдВрдХ рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕реА рддрд░рд╣, BRIN рднреА рдЗрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рд╡рд╛рд▓реЗ рд╕реНрддрдВрднреЛрдВ рдкрд░ рд╕рд╛рд░рд╛рдВрд╢ рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИ: <em>рдПрдХ рд╕реАрдорд╛ рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдореВрд▓реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реАрдорд╛</em> рдХреНрд╖реЗрддреНрд░ рд╕рд┐рд░реНрдл рд╕рд╛рд░рд╛рдВрд╢ рдореВрд▓реНрдп рд╣реИред <br><br>  GiST рдХреЗ рд╡рд┐рдкрд░реАрдд, BRIN рдХреЗ рд▓рд┐рдП рд╕рд╛рд░рд╛рдВрд╢ рдореВрд▓реНрдп рдЙрд╕реА рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕ рддрд░рд╣ рд╕реЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдЕрдиреБрдХреНрд░рдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЕрдВрдХреЛрдВ рдХреЗ рд▓рд┐рдП рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рд╣реИ рдХрд┐ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ BRIN рдореЗрдВ рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: рджреЗрд╢рд╛рдВрддрд░ рдмрд╛рд░реАрдХреА рд╕реЗ рд╕рдордп рдХреНрд╖реЗрддреНрд░ рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред  рд╕реМрднрд╛рдЧреНрдп рд╕реЗ, рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реИ рдХрд┐ рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкрд░ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдирд┐рд░реНрдорд╛рдг рдореЗрдВ рдЧрд┐рд░рд╛рд╡рдЯ рдЖрдпрддреЛрдВ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рджред  рдЙрд╕реА рд╕рдордп, рд╣рдо рдПрдХ рд╕реАрдорд╛ рдХреЗ рдЖрдХрд╛рд░ рдХреЛ рдПрдХ рдкреГрд╖реНрда рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗ, рдмрд╕ рд╕реАрдорд╛ рдорд╛рдорд▓реЗ рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> brin (box(airport_coord)) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> (pages_per_range=<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  рдЗрддрдиреА рд╡рд┐рд╖рдо рдкрд░рд┐рд╕реНрдерд┐рддрд┐ рдореЗрдВ рднреА рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЖрдХрд╛рд░ 30 рдПрдордмреА рдЬрд┐рддрдирд╛ рдЫреЛрдЯрд╛ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> pg_size_pretty(pg_total_relation_size(<span class="hljs-string"><span class="hljs-string">'flights_bi_box_idx'</span></span>));</code> </pre><pre> <code class="plaintext hljs"> pg_size_pretty ---------------- 30 MB (1 row)</code> </pre><br>  рдЕрдм рд╣рдо рдЙрди рдкреНрд░рд╢реНрдиреЛрдВ рдХреЛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рджреНрд╡рд╛рд░рд╛ рд╣рд╡рд╛рдИ рдЕрдбреНрдбреЛрдВ рдХреЛ рд╕реАрдорд┐рдд рдХрд░рддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> airport_code, airport_name <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> airports <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> box(coordinates) &lt;@ <span class="hljs-type"><span class="hljs-type">box</span></span> <span class="hljs-string"><span class="hljs-string">'120,40,140,50'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> airport_code | airport_name --------------+----------------- KHV | Khabarovsk-Novyi VVO | Vladivostok (2 rows)</code> </pre><br>  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпреЛрдЬрдирд╛рдХрд╛рд░ рд╣рдорд╛рд░реЗ рд╕реВрдЪрдХрд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдЗрдВрдХрд╛рд░ рдХрд░реЗрдЧрд╛ред <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span> flights_bi; demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> box(airport_coord) &lt;@ <span class="hljs-type"><span class="hljs-type">box</span></span> <span class="hljs-string"><span class="hljs-string">'120,40,140,50'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN --------------------------------------------------------------------- Seq Scan on flights_bi (cost=0.00..985928.14 rows=30517 width=111) Filter: (box(airport_coord) &lt;@ '(140,50),(120,40)'::box)</code> </pre><br>  рдХреНрдпреЛрдВ?  рдЪрд▓реЛ рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕реНрдХреИрди рдХреЛ рдЕрдХреНрд╖рдо рдХрд░реЗрдВ рдФрд░ рджреЗрдЦреЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> enable_seqscan = <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>; demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> box(airport_coord) &lt;@ <span class="hljs-type"><span class="hljs-type">box</span></span> <span class="hljs-string"><span class="hljs-string">'120,40,140,50'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN -------------------------------------------------------------------------------- Bitmap Heap Scan on flights_bi (cost=14079.67..1000007.81 rows=30517 width=111) Recheck Cond: (box(airport_coord) &lt;@ '(140,50),(120,40)'::box) -&gt; Bitmap Index Scan on flights_bi_box_idx (cost=0.00..14072.04 rows=30517076 width=0) Index Cond: (box(airport_coord) &lt;@ '(140,50),(120,40)'::box)</code> </pre><br>  рдРрд╕рд╛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рд╕реВрдЪрдХрд╛рдВрдХ <em>рдХрд╛</em> рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ <em>рдЬрд╛ рд╕рдХрддрд╛</em> рд╣реИ, рд▓реЗрдХрд┐рди рдпреЛрдЬрдирд╛рдХрд╛рд░ рдпрд╣ рдорд╛рдирддрд╛ рд╣реИ рдХрд┐ рдмрд┐рдЯрдореИрдк рдХреЛ рдкреВрд░реА рдореЗрдЬ рдкрд░ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ (рдмрд┐рдЯрдореИрдк рдЗрдВрдбреЗрдХреНрд╕ рд╕реНрдХреИрди рдиреЛрдб рдХреА "рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ), рдФрд░ рдпрд╣ рдХреЛрдИ рдЖрд╢реНрдЪрд░реНрдп рдирд╣реАрдВ рд╣реИ рдХрд┐ рдпреЛрдЬрдирд╛рдХрд╛рд░ рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕реНрдХреИрди рдЪреБрдирддрд╛ рд╣реИ" рдпрд╣ рдорд╛рдорд▓рд╛ред  рдпрд╣рд╛рдБ рдореБрджреНрджрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЬреНрдпрд╛рдорд┐рддреАрдп рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд▓рд┐рдП, PostgreSQL рдХрд┐рд╕реА рднреА рдЖрдВрдХрдбрд╝реЗ рдХреЛ рдЗрдХрдЯреНрдард╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпреЛрдЬрдирд╛рдХрд╛рд░ рдХреЛ рдЖрдБрдЦ рдмрдВрдж рдХрд░рдХреЗ рдЬрд╛рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_stats <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tablename = <span class="hljs-string"><span class="hljs-string">'flights_bi_box_idx'</span></span> \gx</code> </pre><pre> <code class="plaintext hljs">-[ RECORD 1 ]----------+------------------- schemaname | bookings tablename | flights_bi_box_idx attname | box inherited | f null_frac | 0 avg_width | 32 n_distinct | 0 most_common_vals | most_common_freqs | histogram_bounds | correlation | most_common_elems | most_common_elem_freqs | elem_count_histogram |</code> </pre><br>  рдЕрдлрд╕реЛрд╕ред  рд▓реЗрдХрд┐рди рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреЛрдИ рд╢рд┐рдХрд╛рдпрдд рдирд╣реАрдВ рд╣реИ - рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдФрд░ рдареАрдХ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">explain</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">costs</span></span> <span class="hljs-keyword"><span class="hljs-keyword">off</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">analyze</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flights_bi <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> box(airport_coord) &lt;@ <span class="hljs-type"><span class="hljs-type">box</span></span> <span class="hljs-string"><span class="hljs-string">'120,40,140,50'</span></span>;</code> </pre><pre> <code class="plaintext hljs"> QUERY PLAN ---------------------------------------------------------------------------------- Bitmap Heap Scan on flights_bi (actual time=158.142..315.445 rows=781790 loops=1) Recheck Cond: (box(airport_coord) &lt;@ '(140,50),(120,40)'::box) Rows Removed by Index Recheck: 70726 Heap Blocks: lossy=14772 -&gt; Bitmap Index Scan on flights_bi_box_idx (actual time=158.083..158.083 rows=147720 loops=1) Index Cond: (box(airport_coord) &lt;@ '(140,50),(120,40)'::box) Planning time: 0.137 ms Execution time: 340.593 ms</code> </pre><br>  рдирд┐рд╖реНрдХрд░реНрд╖ рдЗрд╕ рддрд░рд╣ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП: рдЕрдЧрд░ рдХреБрдЫ рднреА рдЬреНрдпрд╛рдорд┐рддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рддреЛ рдкреЛрд╕реНрдЯрдЬреАрдЖрдИрдПрд╕ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдпрд╣ рд╡реИрд╕реЗ рднреА рдЖрдВрдХрдбрд╝реЗ рдЗрдХрдЯреНрдард╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред <br><br><h2>  internals </h2><br>  рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╡рд┐рд╕реНрддрд╛рд░ "рдкреЗрдЬрд┐рдиреНрд╕рдкреЗрдХреНрдЯ" рд╣рдореЗрдВ рдмреНрд░рд┐рди рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдЕрдВрджрд░ рджреЗрдЦрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддрд╛ рд╣реИред <br><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдореЗрдЯреИрдирдлреЙрд░реНрдореЗрд╢рди рд╣рдореЗрдВ рдПрдХ рд╢реНрд░реЗрдгреА рдХреЗ рдЖрдХрд╛рд░ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрдЧрд╛ рдФрд░ "рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐" рдХреЗ рд▓рд┐рдП рдХрд┐рддрдиреЗ рдкреГрд╖реНрда рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВред <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brin_metapage_info(get_raw_page(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre><pre> <code class="plaintext hljs"> magic | version | pagesperrange | lastrevmappage ------------+---------+---------------+---------------- 0xA8109CFA | 1 | 128 | 3 (1 row)</code> </pre><br>  рдкреЗрдЬ 1-3 рдпрд╣рд╛рдВ "рд░рд┐рд╡рд╛рдкрдо" рдХреЗ рд▓рд┐рдП рдЖрд╡рдВрдЯрд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЬрдмрдХрд┐ рдмрд╛рдХреА рдореЗрдВ рд╕рд╛рд░рд╛рдВрд╢ рдбреЗрдЯрд╛ рд╣реИред  "рд╕реБрдзрд╛рд░" рд╕реЗ рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рд╕реАрдорд╛ рдХреЗ рд▓рд┐рдП рд╕рд╛рд░рд╛рдВрд╢ рдбреЗрдЯрд╛ рдХреЗ рд╕рдВрджрд░реНрдн рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдХрд╣рддреЗ рд╣реИрдВ, рдкрд╣рд▓реЗ 128 рдкреГрд╖реНрдареЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реБрдП рдкрд╣рд▓реА рд╕реАрдорд╛ рдкрд░ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рд╕реНрдерд┐рдд рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brin_revmap_data(get_raw_page(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><pre> <code class="plaintext hljs"> pages --------- (6,197) (1 row)</code> </pre><br>  рдФрд░ рдпрд╣ рд╕рд╛рд░рд╛рдВрд╢ рдбреЗрдЯрд╛ рд╣реА рд╣реИ: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> allnulls, hasnulls, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brin_page_items( get_raw_page(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> itemoffset = <span class="hljs-number"><span class="hljs-number">197</span></span>;</code> </pre><pre> <code class="plaintext hljs"> allnulls | hasnulls | value ----------+----------+---------------------------------------------------- f | f | {2016-08-15 02:45:00+03 .. 2016-08-15 17:15:00+03} (1 row)</code> </pre><br>  рдЕрдЧрд▓реА рд╕реАрдорд╛: <br><br><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brin_revmap_data(get_raw_page(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">limit</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><pre> <code class="plaintext hljs"> pages --------- (6,198) (1 row)</code> </pre><pre> <code class="pgsql hljs">demo=# <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> allnulls, hasnulls, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> brin_page_items( get_raw_page(<span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-string"><span class="hljs-string">'flights_bi_scheduled_time_idx'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> itemoffset = <span class="hljs-number"><span class="hljs-number">198</span></span>;</code> </pre><pre> <code class="plaintext hljs"> allnulls | hasnulls | value ----------+----------+---------------------------------------------------- f | f | {2016-08-15 06:00:00+03 .. 2016-08-15 18:55:00+03} (1 row)</code> </pre><br>  рдФрд░ рдЗрд╕реА рддрд░рд╣ред <br><br>  "рд╕рдорд╛рд╡реЗрд╢" рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рд▓рд┐рдП, "рдорд╛рди" рдлрд╝реАрд▓реНрдб рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░реЗрдЧрд╛ <br><br><pre> <code class="plaintext hljs"> {(94.4005966186523,69.3110961914062),(77.6600036621,51.6693992614746) .. f .. f}</code> </pre><br>  рдкрд╣рд▓рд╛ рдорд╛рди рдЕрдВрддрдГрд╕реНрдерд╛рдкрд┐рдд рдЖрдпрдд рд╣реИ, рдФрд░ рдЕрдВрдд рдореЗрдВ "f" рдЕрдХреНрд╖рд░ рдЦрд╛рд▓реА рддрддреНрд╡реЛрдВ (рдкрд╣рд▓реЗ рд╡рд╛рд▓реЗ) рдХрд╛ рдЕрднрд╛рд╡ рд╣реИ рдФрд░ рдПрдХрд╛рддреНрдордХ рдорд╛рди (рджреВрд╕рд░рд╛ рд╡рд╛рд▓рд╛) рдХрд╛ рдЕрднрд╛рд╡ рд╣реИред  рджрд░рдЕрд╕рд▓, рдПрдХрдорд╛рддреНрд░ рдЕрдкрд░рд┐рд╖реНрдХреГрдд рдореВрд▓реНрдп "рдЖрдИрдкреАрд╡реА 4" рдФрд░ "рдЖрдИрдкреАрд╡реА 6" рдкрддреЗ ("рдЗрдирдЯ" рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░) рд╣реИрдВред <br><br><h2>  рдЧреБрдг </h2><br>  рдЖрдкрдХреЛ рдЙрди рдкреНрд░рд╢реНрдиреЛрдВ рдХреА рдпрд╛рдж рджрд┐рд▓рд╛рддрд╛ рд╣реИ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЬреЛ рдкрд╣рд▓реЗ рд╣реА рдкреНрд░рджрд╛рди рдХрд┐рдП рдЬрд╛ рдЪреБрдХреЗ рд╣реИрдВ</a> ред <br><br>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд╣реБрдБрдЪ рд╡рд┐рдзрд┐ рдХреЗ рдЧреБрдг рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs"> amname | name | pg_indexam_has_property --------+---------------+------------------------- brin | can_order | f brin | can_unique | f brin | can_multi_col | t brin | can_exclude | f</code> </pre><br>  рдХрдИ рд╕реНрддрдВрднреЛрдВ рдкрд░ рд╕реВрдЪрдХрд╛рдВрдХ рдмрдирд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдХреЙрд▓рдо рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╕рд╛рд░рд╛рдВрд╢ рдЖрдВрдХрдбрд╝реЗ рдПрдХрддреНрд░ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡реЗ рдкреНрд░рддреНрдпреЗрдХ рд╢реНрд░реЗрдгреА рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддреЗ рд╣реИрдВред  рдмреЗрд╢рдХ, рдпрд╣ рд╕реВрдЪрдХрд╛рдВрдХ рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдФрд░ рдПрдХ рд╣реА рд╢реНрд░реЗрдгреА рдХрд╛ рдЖрдХрд╛рд░ рд╕рднреА рд╕реНрддрдВрднреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИред <br><br>  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реВрдЪрдХрд╛рдВрдХ-рдкрд░рдд рдЧреБрдг рдЙрдкрд▓рдмреНрдз рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs"> name | pg_index_has_property ---------------+----------------------- clusterable | f index_scan | f bitmap_scan | t backward_scan | f</code> </pre><br>  рдЬрд╛рд╣рд┐рд░ рд╣реИ, рдХреЗрд╡рд▓ рдмрд┐рдЯрдореИрдк рд╕реНрдХреИрди рд╕рдорд░реНрдерд┐рдд рд╣реИред <br><br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рдХреНрд▓рд╕реНрдЯрд░рд┐рдВрдЧ рдХреА рдХрдореА рднреНрд░рд╛рдордХ рд▓рдЧ рд╕рдХрддреА рд╣реИред  рд▓рдЧрд╛рддрд╛рд░, рдЪреВрдВрдХрд┐ BRIN рдЗрдВрдбреЗрдХреНрд╕ рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЗ рднреМрддрд┐рдХ рдХреНрд░рдо рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдЗрдВрдбреЗрдХреНрд╕ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдбреЗрдЯрд╛ рдХреНрд▓рд╕реНрдЯрд░ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рддрд░реНрдХрд╕рдВрдЧрдд рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдРрд╕рд╛ рд╣реИ рдирд╣реАрдВред  рд╣рдо рдЗрд╕рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХреЗрд╡рд▓ рдПрдХ "рдирд┐рдпрдорд┐рдд" рд╕реВрдЪрдХрд╛рдВрдХ (рдмреА-рдЯреНрд░реА рдпрд╛ рдЬреАрдПрд╕рдЯреА, рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░) рдФрд░ рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред  рд╡реИрд╕реЗ, рдХреНрдпрд╛ рдЖрдк рдПрдХ рдмрд╣реБрдд рдмрдбрд╝реА рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рддрд╛рд▓реЗ, рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рд╕рдордп рдФрд░ рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХреА рдЦрдкрдд? <br><br>  рд╕реНрддрдВрдн-рдкрд░рдд рдЧреБрдг рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИрдВ: <br><br><pre> <code class="plaintext hljs"> name | pg_index_column_has_property --------------------+------------------------------ asc | f desc | f nulls_first | f nulls_last | f orderable | f distance_orderable | f returnable | f search_array | f search_nulls | t</code> </pre><br>  рдХреЗрд╡рд▓ рдЙрдкрд▓рдмреНрдз рд╕рдВрдкрддреНрддрд┐ NULLs рдореЗрдВ рд╣реЗрд░рдлреЗрд░ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реИред <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдкрд░ рдкрдврд╝реЗрдВ</a> ред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi452900/">https://habr.com/ru/post/hi452900/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi452886/index.html">рд╡рд┐рдХреА рдкреНрд░реЛрдЬреЗрдХреНрдЯреНрд╕ рдФрд░ рдиреЛрд╡реЛрдХреЗрдпрд░ рдирд╛рдо HACKNOWLEGE рдкрд░</a></li>
<li><a href="../hi452888/index.html">рдореНрдпреВрдирд┐рдЦ рдХреЗ рдкрд╛рд╕ рдлреБрд▓-рд╕рд╛рдЗрдЬрд╝ рдкрд╛рдВрдЪ рд╕реАрдЯреЛрдВ рд╡рд╛рд▓реЗ рдЯрд┐рд▓реНрдЯреНрд░реЛрд▓рд░ рд▓рд┐рд▓рд┐рдпрдо рдЬреЗрдЯ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рд╢реБрд░реВ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi452890/index.html">23 рдордИ, 18:30 - QIWI рд░рд╕реЛрдИ рдХрд╛ рд▓рд╛рдЗрд╡ рдкреНрд░рд╕рд╛рд░рдг</a></li>
<li><a href="../hi452892/index.html">рдПрдХ рдЧреИрд░-рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдпреВрдПрд╕рдП рдореЗрдВ рдХреИрд╕реЗ рдХрджрдо рд░рдЦ рд╕рдХрддрд╛ рд╣реИ: рдЪрд░рдг-рджрд░-рдЪрд░рдг рдирд┐рд░реНрджреЗрд╢</a></li>
<li><a href="../hi452894/index.html">рдлреЗрд╕ рдПрдВрдЯреА-рд╕реНрдкреВрдлрд┐рдВрдЧ рдпрд╛ рддрдХрдиреАрдХреА рд░реВрдк рд╕реЗ рдЪреЗрд╣рд░реЗ рд╕реЗ рд╣рдЬрд╛рд░ рдореЗрдВ рд╕реЗ рдПрдХ рдЪреАрдЯрд░ рдХреЛ рдкрд╣рдЪрд╛рдирддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi452902/index.html">рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреЗ рд░реВрдк рдореЗрдВ 4 рд╕рд╛рд▓ рдХреЗ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдХреЛ рдЦрддреНрдо рдХрд░рдирд╛, рдореИрдВ рд╕рдордЭрддрд╛ рд╣реВрдВ рдХрд┐ рдореИрдВ рдПрдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рд╕реЗ рдмрд╣реБрдд рджреВрд░ рд╣реВрдВ</a></li>
<li><a href="../hi452904/index.html">рдорд╢реАрдиреЗрдВ рдХреИрд╕реЗ рд╕рдВрд╡рд╛рдж рдХрд░рддреА рд╣реИрдВ - рдПрдордХреНрдпреВрдЯреАрдЯреА рдкреНрд░реЛрдЯреЛрдХреЙрд▓</a></li>
<li><a href="../hi452906/index.html">рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬрди: рд╡реЗ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреЙрд▓ рд╕реНрдЯреИрдХ рд╕реЗ рд╡рд╛рджреЛрдВ рддрдХ, (рд▓рдЧрднрдЧ) рд╡рд╣ рд╕рдм рдХреБрдЫ рдЬреЛ рдЖрдкрдХреЛ рдЬрд╛рдирдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ</a></li>
<li><a href="../hi452908/index.html">рд╕реЗрд▓реЗрдирд┐рдпрдо рд╡реЗрдмрдбреНрд░рд╛рдЗрд╡рд░ - рдЧреНрд░рд╛рдлрд╛рдирд╛ рдФрд░ рдЗрдиреНрдлреНрд▓рдХреНрд╕рдмреАрдбреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдкрд░реАрдХреНрд╖рдг рдореАрдЯреНрд░рд┐рдХ</a></li>
<li><a href="../hi452910/index.html">рдирдорд╕реНрдХрд╛рд░, рд╣реЗрдмреНрд░! рд╣реЗрд▓реЛ рдЯреЗрд░рдХреЛрди</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>