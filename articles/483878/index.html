<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ∂ üëèüèª üíÜüèø C√≥mo hablar sobre los principales componentes de Android en 15 minutos. üëÅ‚Äçüó® ‚ñ´Ô∏è üéà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 Este art√≠culo discutir√° c√≥mo decirle a una persona que previamente no estaba familiarizada con la programaci√≥n para Android, sobre su...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo hablar sobre los principales componentes de Android en 15 minutos.</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483878/"><h1 id="vvedenie">  Introduccion </h1><br><p>  Este art√≠culo discutir√° c√≥mo decirle a una persona que previamente no estaba familiarizada con la programaci√≥n para Android, sobre sus componentes principales.  Interesar y demostrar que no todo es tan dif√≠cil como mucha gente piensa.  Al mismo tiempo, h√°galo en 15 minutos y sin entrar en una explicaci√≥n de alguna teor√≠a b√°sica que todos puedan leer por s√≠ mismos y volver con preguntas aclaratorias. </p><br><p>  Cuando intent√© hacer esto por primera vez, me sorprendi√≥ desagradablemente.  Mi explicaci√≥n "simple y comprensible" se convirti√≥ en aburrida, en cuyo marco se traz√≥ claramente un intento desesperado por captar la inmensidad y contar en pocas palabras todo lo que un poco estaba claro.  No es necesario decir que es probable que una historia de este tipo no interese, sino que asusta a su interlocutor, al tiempo que disminuye el deseo de hacer algo por su cuenta, incluso si anteriormente ten√≠a una peque√±a calculadora en sus planes. </p><br><p>  No es ning√∫n secreto que una gran cantidad de art√≠culos sobre este tema se publican en Internet, pero en mi caso la narraci√≥n ser√° ligeramente diferente: solo habr√° pr√°ctica visual, sin definiciones y otros detalles.  Es decir, miramos, vemos, comentamos lo que est√° sucediendo.  Parece, en mi opini√≥n, todo es bastante simple y claro, los fragmentos de c√≥digo tambi√©n son peque√±os y muy simples, listos para su uso r√°pido en su propio proyecto.  Me parece que este enfoque ofrece una visi√≥n general bastante amplia de las herramientas cl√°sicas de Android, y al escribir la primera aplicaci√≥n, en lugar de las preguntas "qu√© debo usar", habr√° preguntas m√°s espec√≠ficas "c√≥mo exactamente deber√≠a usar el componente X".  Y ya todos los detalles sobre esta persona podr√°n descubrirlos por s√≠ mismos, si as√≠ lo desean. </p><a name="habracut"></a><br><p>  ¬°Entonces vamos! </p><br><h1 id="izuchaem-komponenty">  Aprendiendo los componentes </h1><br><p>  Instale la aplicaci√≥n, ejec√∫tela y ... por ahora, es suficiente que MainActivity se haya abierto antes que nosotros.  La pregunta "por qu√© es exactamente" se responder√° m√°s adelante. </p><br><p>  En primer lugar, veamos de d√≥nde proviene: de main_activity.xml, donde se declaran todos los elementos de la interfaz.  Est√°n publicados en LinearLayout, por lo que es poco probable que surjan preguntas aqu√≠. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre><code class="plaintext hljs">&lt;LinearLayout android:orientation="vertical" android:layout_width="match_parent" android:layout_height="match_parent"&gt; &lt;TextView android:id="@+id/textView" android:layout_width="match_parent" android:layout_height="wrap_content" android:text="Android Demo Application" /&gt; &lt;TextView android:id="@+id/textView3" android:layout_width="match_parent" android:layout_height="wrap_content" android:text=" 1" /&gt; &lt;Button android:id="@+id/buttonShowToast" android:layout_width="match_parent" android:layout_height="wrap_content" android:text=" Toast" /&gt; ... &lt;/LinearLayout&gt;</code> </pre> </div></div><br><h2 id="prostye-komponenty">  Componentes simples </h2><br><h3 id="toast">  Tostadas </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/g7/oh/a7/g7oha7j9ymxha54ezk_u9p962qk.jpeg"></p></div></div><br><p>  Ahora vamos a MainActivity.java y al primer bot√≥n de su interfaz: "Mostrar tostadas" (notificaci√≥n emergente). <br>  Encuentre el identificador del bot√≥n en main_activity.xml y vaya a su OnClickListener en MainActivity.java. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Button btn = findViewById(R.id.buttonShowToast); btn.setOnClickListener(new View.OnClickListener() { @Override public void onClick(View v) { Toast.makeText(getApplicationContext(), "This is a Toast", Toast.LENGTH_LONG).show(); } });</code> </pre> </div></div><br><p>  Resulta que para mostrar una notificaci√≥n emergente, ¬°una l√≠nea de c√≥digo es suficiente!  Genial, ¬øno es as√≠? </p><br><h3 id="vzaimodeystvie-s-drugim-activity">  Interacci√≥n con otra actividad </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p>  Primera actividad <br><img src="https://habrastorage.org/webt/tz/oj/zh/tzojzhhwxgkdbhlgmw8mizvzk8m.jpeg"><br>  Segunda actividad <br><img src="https://habrastorage.org/webt/d8/tn/t6/d8tnt6ov9udgwmnxtxtrllgz1ui.jpeg"></p></div></div><br><p>  Ahora intentemos ir a alg√∫n lugar fuera de la p√°gina principal de la aplicaci√≥n.  Por ejemplo, a otra p√°gina de este tipo!  Vaya a "Interacci√≥n con otra actividad" y entramos en otra actividad con otros controles.  ¬øC√≥mo las diferentes actividades en una aplicaci√≥n transfieren datos entre ellos?  Este es el momento de hablar sobre dos mecanismos diferentes: un almacenamiento constante de valores: shared_prefs, as√≠ como startActivityForResult / onActivityResult (no quer√≠a insertar esto al principio, pero a√∫n brevemente: si inicia una <strong>nueva</strong> actividad desde <strong>una</strong> actividad <strong>abierta</strong> usando startActivityForResult, luego de completar la <strong>segunda</strong> actividad se llamar√° aActivityResult en la <strong>primera</strong> actividad. No se alarme si esto a√∫n no est√° claro). <br>  Y, por supuesto, demostrar en la pr√°ctica! </p><br><p>  Entrada en shared_prefs: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">String valueToSave = "test"; SharedPreferences.Editor editor = getSharedPreferences("demoapp", MODE_PRIVATE).edit(); editor.putString("myValue", valueToSave); editor.apply();</code> </pre> </div></div><br><p>  Lectura de shared_prefs: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SharedPreferences prefs = getSharedPreferences("demoapp", MODE_PRIVATE); String storedValue = prefs.getString("myValue", "NOT_FOUND");</code> </pre> </div></div><br><p>  Un ejemplo con onActivityResult: consulte el origen de la aplicaci√≥n. </p><br><h3 id="sohranenie-i-vosstanovlenie-nastroek">  Guardar y restaurar configuraciones </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/bq/_s/3v/bq_s3vglngrttsakobha70texya.jpeg"></p></div></div><br><p>  Como mencionamos shared_prefs, terminemos con ellos.  Vamos a "Guardar y restaurar configuraciones", donde se nos presenta una tarjeta t√≠pica de una cuenta t√≠pica con varios tipos de campos (tenga en cuenta que su tipo se configura con una sola variable: un interruptor).  Guardaremos el contenido de estos campos en shared_prefs y luego los restauraremos.  Hasta ahora, un bot√≥n separado, sin onResume, ¬°a√∫n no los hemos alcanzado! <br>  Guardar: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SharedPreferences.Editor editor = getSharedPreferences(MY_PREFS_NAME, MODE_PRIVATE).edit(); EditText et = findViewById(R.id.editTextName); String name = et.getText().toString(); editor.putString("name", name); editor.apply();</code> </pre> </div></div><br><p>  Restauramos: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SharedPreferences prefs = getSharedPreferences(MY_PREFS_NAME, MODE_PRIVATE); EditText et = findViewById(R.id.editTextName); et.setText(prefs.getString("name", "")); ...</code> </pre> </div></div><br><h3 id="prostoe-menyu">  Men√∫ simple </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/nc/9u/6y/nc9u6ypwmnmxhrvpoflexjjtuhe.jpeg"></p></div></div><br><p>  La siguiente secci√≥n es un men√∫ simple.  Aprendemos de √©l que no tiene nada de complicado: simplemente configure onCreateOptionsMenu y compl√©telo con la estructura de my_menu.xml. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">@Override public boolean onCreateOptionsMenu(Menu menu) { MenuInflater inflater = getMenuInflater(); inflater.inflate(R.menu.my_menu, menu); return true; }</code> </pre> </div></div><br><h3 id="vsplyvayuschee-menyu">  Men√∫ emergente </h3><br><p>  Inmediatamente despu√©s, un bot√≥n de men√∫ emergente.  Ya es m√°s interesante que el anterior, incluso con la presencia de memoria de configuraci√≥n y la presencia de submen√∫s. <br>  El c√≥digo para el men√∫ emergente se puede ver en el c√≥digo fuente de la aplicaci√≥n. </p><br><h3 id="audiopleer">  Reproductor de audio </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/jl/c8/fj/jlc8fj0leasmypoxdtysiyywfdg.jpeg"></p></div></div><br><p>  Utilizando el ejemplo del reproductor de audio, adem√°s del hecho de que no hay nada complicado en la reproducci√≥n de m√∫sica, puede demostrar la conexi√≥n de seekBar a algo, en este caso, a la posici√≥n actual del reproductor multimedia.  En el control de volumen, tampoco nada sobrenatural.  La bonificaci√≥n muestra un error.  Abra la actividad con el reproductor multimedia, inicie la reproducci√≥n y presione el bot√≥n "Atr√°s".  La m√∫sica contin√∫a sonando y ya no se puede detener ... ¬°El problema!  C√≥mo resolverlo: lo descubriremos un poco m√°s tarde. <br>  El c√≥digo del reproductor de audio se puede encontrar en el c√≥digo fuente de la aplicaci√≥n. </p><br><h3 id="veb-brauzer">  Navegador web </h3><br><p>  Bueno, en conclusi√≥n de la primera parte, mostramos que tampoco hay nada divino en el navegador web. </p><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/5h/od/rw/5hodrwcppknr_gl2nkkq1odvdfe.jpeg"></p></div></div><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">WebView view = findViewById(R.id.webView); view.setWebViewClient(new WebViewClient()); view.getSettings().setJavaScriptEnabled(true); view.getSettings().setCacheMode(WebSettings.LOAD_NO_CACHE); view.loadUrl("https://google.com");</code> </pre> </div></div><br><p>  La siguiente parte ya es m√°s dif√≠cil. </p><br><h2 id="servisy-i-uvedomleniya">  Servicios y notificaciones </h2><br><h3 id="broadcastreceiver">  BroadcastReceiver </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vl/jj/qu/vljjquneo8n5iiejykuxgd81mug.jpeg"></p></div></div><br><p>  Recordemos c√≥mo pasamos el resultado de una actividad a otra.  De alguna manera (a√∫n no sabemos c√≥mo) result√≥ que cuando se cerr√≥ la segunda actividad, el resultado vol√≥ al resultado onActivityResult de la primera.  ¬øPero podemos transferir el resultado a cualquier lugar dentro de nuestra aplicaci√≥n?  S√≠, podemos anunciar y registrar un oyente que nos escucha desde cualquier parte del programa.  Tal oyente se llama BroadcastReceiver. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public BroadcastReceiver MyReceiver = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Toast.makeText(getApplicationContext(), "Broadcast receiver: received!", Toast.LENGTH_LONG).show(); } };</code> </pre> </div></div><br><p>  Aqu√≠ no puede prescindir de intenciones, pero al nivel m√°s primitivo: por ahora, el hecho de que sean suficientes para nosotros se env√≠a a un determinado autob√∫s com√∫n, y que de acuerdo con una acci√≥n predeterminada, BroadcastReceiver nos escuchar√° dondequiera que estemos. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">IntentFilter filter = new IntentFilter(); filter.addAction("MyCustomActionName"); registerReceiver(MyReceiver, filter); sendBroadcast(new Intent("MyCustomActionName"));</code> </pre> </div></div><br><p>  Por el momento, tenemos una idea b√°sica de qu√© es Receiver, pero no est√° claro por qu√© es necesario: esto es normal, y ahora ser√° m√°s f√°cil. </p><br><h3 id="prostoy-servis">  Servicio simple </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/jh/c6/5b/jhc65b-blaklmc4cd0n8v_fzrms.jpeg"></p></div></div><br><p>  Pase sin problemas al servicio, donde BroadcastReceiver encontrar√° su aplicaci√≥n completa.  Y en lugar de tratar de decir en pocas palabras qu√© es un servicio de Android, propongo comenzar la demostraci√≥n de inmediato.  Ejecute el servicio, que comienza su trabajo en segundo plano.  Junto con esto, registraremos dos receptores: uno en actividad y otro en servicio. <br>  El receptor en servicio es necesario para demostrar que, a pesar de la ejecuci√≥n en segundo plano, siempre podemos alcanzarlo desde la actividad. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public BroadcastReceiver MyServiceReceiver = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Toast.makeText(getApplicationContext(), "Toast from Service: I hear you!", Toast.LENGTH_LONG).show(); } };</code> </pre> </div></div><br><p>  El receptor en actividad es necesario para mostrar los resultados del servicio en TextView. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public BroadcastReceiver MyPrintReceiver = new BroadcastReceiver() { @Override public void onReceive(Context context, Intent intent) { Toast.makeText(getApplicationContext(), "pong", Toast.LENGTH_SHORT).show(); TextView tv = findViewById(R.id.textViewSimpleServiceStatus); String msg = intent.getStringExtra("msg"); tv.setText(msg); } };</code> </pre> </div></div><br><p>  Y, para una comprensi√≥n completa, al enviar un mensaje del servicio a Activity, mostraremos Toast ("ping").  Y cuando recibamos el mensaje en la Actividad y dibujemos el valor en TextView, mostraremos Toast ("pong"). <br>  Deje que la tarea principal del servicio sea enviar tales "pings" a la actividad, y la tarea de la actividad es simplemente mostrarlos en su interfaz. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Handler handler = new Handler(); runnable = new Runnable() { public void run() { if (running) { printMsg("Service is still running " + running); handler.postDelayed(runnable, 5000); //   } else { printMsg("Service exited"); } } }; handler.postDelayed(runnable, 5000);</code> </pre> </div></div><br><p>  Un ejemplo de la operaci√≥n del controlador se considerar√° en detalle m√°s adelante, por el momento es solo un medio de enviar ping cada 5 segundos. </p><br><p>  Y ahora, despu√©s de iniciar el servicio, vemos Toast ("¬°Servicio creado!") Y enviamos notificaciones de ping-pong.  Y en TextView los mensajes del servicio comenzaron a llegar. </p><br><p>  Genial, ejecuci√≥n de fondo que vimos.  Ahora cierra la aplicaci√≥n!  En las √∫ltimas versiones de Android, veremos lo siguiente: el servicio se ha reiniciado (aparecer√° Toast ("¬°Servicio creado!") Y enviar√° "pings".  Al mismo tiempo, no hay "pongs", despu√©s de todo, ¬°no hay m√°s actividad que los procese!  Despu√©s de unos segundos, los pings tambi√©n se detuvieron en mi tel√©fono inteligente.  El servicio est√° siendo destruido.  Abra la configuraci√≥n de energ√≠a, apague la optimizaci√≥n para nuestra aplicaci√≥n y vuelva a realizar el procedimiento.  Ahora el servicio no se destruye, e incluso despu√©s de que se cierra el programa, vemos "pings" entrantes estables.  Pero, por supuesto, no hay garant√≠a aqu√≠, y dicho servicio no durar√° mucho tiempo.  Desde el punto de vista del desarrollador, esto puede ser terrible, pero ve√°moslo a trav√©s de los ojos de un usuario simple: ¬øqueremos que cualquier aplicaci√≥n funcione en segundo plano con tanta libertad e impunidad, comiendo una bater√≠a?  Apenas  ¬øC√≥mo, entonces, trabajar completamente en segundo plano? </p><br><p>  Para hacer esto, solo necesita notificar al usuario sobre esto.  Este es un requisito obligatorio de Android, que, en presencia de un canal de notificaci√≥n, le permite lanzar no solo lo habitual, sino tambi√©n el servicio en primer plano, que funcionar√° completamente en segundo plano sin el riesgo de ser asesinado de la nada. <br>  Agregue a nuestro onCreate de nuestro servicio: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">String CHANNEL_ID = "my_channel_01"; NotificationChannel channel = new NotificationChannel(CHANNEL_ID, "Channel human readable title", NotificationManager.IMPORTANCE_DEFAULT); ((NotificationManager) getSystemService(Context.NOTIFICATION_SERVICE)).createNotificationChannel(channel); Notification notification = new NotificationCompat.Builder(this, CHANNEL_ID) .setContentTitle("") .setContentText("").build(); startForeground(1, notification);</code> </pre> </div></div><br><p>  Y lo ejecutaremos con el comando: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">startForegroundService(new Intent(getApplicationContext(), TestServiceForeground.class));</code> </pre> </div></div><br><p>  Volveremos a nuestra aplicaci√≥n de demostraci√≥n, devolveremos la configuraci√≥n de ahorro de energ√≠a a su estado original.  Y ahora lanzaremos el servicio en primer plano.  Al cerrar la aplicaci√≥n cuando el servicio se est√° ejecutando, observamos que el servicio ya no se reinicia y no se destruye, sino que simplemente sigue funcionando de manera estable en segundo plano, enviando sus "pings" cada 5 segundos.  Al mismo tiempo, un icono de notificaci√≥n colgar√° en las notificaciones. </p><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/-d/xv/of/-dxvofzx6oknkrfw6eyiwpowybk.jpeg"></p></div></div><br><p>  El usuario podr√° ocultar estas notificaciones si lo desea, pero usted no puede ocultarlas mediante programaci√≥n al momento de crear el canal de notificaci√≥n. </p><br><h3 id="plavayuschaya-knopka-overlay">  Bot√≥n flotante (superposici√≥n) </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hw/ca/l0/hwcal0xkvtxak6ciqpa1zdjexas.jpeg"></p></div></div><br><p>  Sabiendo lo que es un servicio, puede pasar a su uso m√°s simple y obvio: trabajar con botones flotantes.  En los androides actuales, no puede declarar los derechos de representaci√≥n de superposiciones de esa manera: debe pedirle expl√≠citamente permiso al usuario "Sobre todas las ventanas".  Luego hacemos clic en Dibujar superposici√≥n y vemos un √≠cono flotante, detr√°s del cual realmente hay un servicio que escucha los clics en √©l. </p><br><h3 id="otpravka-uvedomleniy">  Enviar notificaciones </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/vu/sb/w-/vusbw-5nvjt-ws-kgrw95hfwzpy.jpeg"></p></div></div><br><p>  Otra caracter√≠stica importante que probablemente sea √∫til en la mayor√≠a de las aplicaciones de Android es enviar notificaciones al usuario.  Veamos brevemente c√≥mo funciona esto.  Para comenzar (en los androides actuales), necesitamos crear un canal de notificaci√≥n: s√≠, s√≠, uno de los que generalmente est√°n disponibles en grandes cantidades en las aplicaciones modernas. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">private void createNotificationChannel() { try { CharSequence channelName = CHANNEL_ID; String channelDesc = "channelDesc"; if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.O) { int importance = NotificationManager.IMPORTANCE_LOW; NotificationChannel channel = new NotificationChannel(CHANNEL_ID, channelName, importance); channel.setDescription(channelDesc); NotificationManager notificationManager = getSystemService(NotificationManager.class); assert notificationManager != null; NotificationChannel currChannel = notificationManager.getNotificationChannel(CHANNEL_ID); if (currChannel == null) { notificationManager.createNotificationChannel(channel); Toast.makeText(getApplicationContext(), "channel created", Toast.LENGTH_SHORT).show(); } else { Toast.makeText(getApplicationContext(), "channel exists", Toast.LENGTH_SHORT).show(); } } } catch (Exception e) { } }</code> </pre> </div></div><br><p>  Bueno, entonces puedes enviarle notificaciones sin restricciones. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public void setNotify() { try { Intent snoozeIntent = new Intent("ActionFromNotify"); PendingIntent snoozePendingIntent = PendingIntent.getBroadcast(this, 0, snoozeIntent, 0); String title = "Start"; Intent intent = new Intent(this, MainActivity.class); intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK); NotificationCompat.Action action = new NotificationCompat.Action.Builder(R.drawable.ic_launcher_background, title, snoozePendingIntent).build(); NotificationCompat.Builder mBuilder = new NotificationCompat.Builder(this, CHANNEL_ID) .setSmallIcon(R.drawable.ic_launcher_background) .setContentTitle("MyNotification") .setContentText("Text here") .setPriority(NotificationCompat.PRIORITY_LOW) .setContentIntent(null) .setOngoing(true) //   .setSound(null) .addAction(action); NotificationManagerCompat notificationManager = NotificationManagerCompat.from(this); int notificationId = (int) (System.currentTimeMillis() / 4); notificationManager.notify(notificationId, mBuilder.build()); } catch (Exception e) { Log.e("error", e.toString()); } }</code> </pre> </div></div><br><h3 id="servis-s-otpravkoy-uvedomleniy">  Servicio con envio de notificaciones </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/nj/ee/lr/njeelrzozunwgncm4a3vusood6k.jpeg"></p></div></div><br><p>  Enviar notificaciones directamente desde la actividad, como puede ver, no es muy impresionante.  Todav√≠a estamos acostumbrados a algo m√°s.  Pero, ¬øqu√© sabemos sobre la ejecuci√≥n en segundo plano hasta ahora?  Solo que hay servicios.  As√≠ que no nos apuremos y hagamos un servicio simple (ni siquiera en primer plano, por simplicidad) que env√≠e una nueva notificaci√≥n cada 5 segundos.  De acuerdo, esto ya es m√°s bonito y m√°s impresionante que solo enviar notificaciones con un bot√≥n. </p><br><p>  Como breve pausa despu√©s de servicios aparentemente complicados (si nunca los ha conocido antes), consideraremos cuatro controles que son f√°ciles de entender.  Y luego volvemos al material complejo, a los flujos. </p><br><h2 id="dopolnitelnye-komponenty">  Componentes adicionales </h2><br><h3 id="tablica-s-dannymi">  Tabla de datos </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/_r/sx/f_/_rsxf_zb6buobcqpdlrxtcuhtpc.jpeg"></p></div></div><br><p>  Comencemos nuestra pausa con la tabla de datos.  Estudiar el c√≥digo fuente se deja al lector. </p><br><h3 id="okno-s-vkladkami">  Ventana con pesta√±as </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/d4/l3/tc/d4l3tc6j_ruxlnmm-p7nl4l-jce.jpeg"></p></div></div><br><p>  La siguiente parada es una ventana con pesta√±as.  Con la ayuda de un simple TabView, puede colocar varias actividades en una pantalla. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public class TabsActivity extends TabActivity { @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.tabs_activity); //  TabHost TabHost tabHost = getTabHost(); TabHost.TabSpec tabSpec; tabSpec = tabHost.newTabSpec("tag1"); tabSpec.setIndicator(""); tabSpec.setContent(new Intent(this, SaveRestorePrefsActivity.class)); tabHost.addTab(tabSpec); tabSpec = tabHost.newTabSpec("tag2"); tabSpec.setIndicator(""); tabSpec.setContent(new Intent(this, FloatingMenuActivity.class)); tabHost.addTab(tabSpec); ... } }</code> </pre> </div></div><br><h3 id="vyvod-obektov-struktur-fragment-i-tablica">  Mostrar objetos de estructura: fragmento y tabla </h3><br><p>  La salida de los objetos de estructura se puede hacer con fragmentos y una tabla. <br>  As√≠ es como se ve el relleno de fragmentos </p><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ck/hw/nz/ckhwnzzk1fbl4ohzv5cwrc5rhiq.jpeg"></p></div></div><br><p>  Y entonces la mesa </p><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/k9/ap/ty/k9aptygs4p29eczt1qlru2pgqk8.jpeg"></p></div></div><br><h3 id="zhiznennyy-cikl-activity">  Ciclo de vida de la actividad </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/8j/kg/-e/8jkg-eoo706wtilrcga7nhefnr0.jpeg"></p></div></div><br><p>  Gradualmente terminando nuestra pausa, procedemos al ciclo de vida de la actividad.  Este es el momento de descubrir que existen otros m√©todos adem√°s de onCreate.  Al principio, un peque√±o fragmento de c√≥digo y notificaciones emergentes ayudar√°n a comprenderlos mejor que cualquier explicaci√≥n. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">@Override protected void onResume() { super.onResume(); Toast.makeText(getApplicationContext(), "onResume -    ", Toast.LENGTH_SHORT).show(); } @Override protected void onDestroy() { super.onDestroy(); Toast.makeText(getApplicationContext(), "onDestroy -  ", Toast.LENGTH_SHORT).show(); } @Override protected void onPause() { super.onPause(); Toast.makeText(getApplicationContext(), "onPause -      ", Toast.LENGTH_SHORT).show(); }</code> </pre> </div></div><br><p>  Lo mismo se aplica a OnTouchListener'ov y onTextChanged. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">CheckBox cb = findViewById(R.id.checkBoxChangeExample); cb.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() { public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) { printMsg("CheckBox - OnCheckedChangeListener: new value is checked = " + isChecked); } }); SeekBar seekBar = (SeekBar) findViewById(R.id.seekBarChangeExample); seekBar.setMax(100); seekBar.setOnTouchListener(new View.OnTouchListener() { @Override public boolean onTouch(View v, MotionEvent event) { Integer progress = ((SeekBar)v).getProgress(); printMsg("SeekBar - OnTouchListener: new value is = " + progress.toString()); return false; } });</code> </pre> </div></div><br><h2 id="otlozhennoe-parallelnoe-i-regulyarnoe-vypolnenie">  Ejecuci√≥n retrasada, paralela y regular </h2><br><p>  Pasamos a la parte m√°s dif√≠cil de la historia: la ejecuci√≥n diferida y paralela. </p><br><h3 id="otlozhennoe-vypolnenie-handler">  Ejecuci√≥n retrasada: controlador </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/og/lv/xh/oglvxhy6hgo0yqpamaybomdrmus.jpeg"></p></div></div><br><p>  Comencemos la inmersi√≥n con Handler.  Qu√© es un controlador en todos los detalles: una persona lo leer√° m√°s tarde por s√≠ mismo, no lo privaremos de este placer.  Pero, dado que lo estamos considerando, es importante saber lo principal: que le permite realizar una tarea pendiente y no lo hace en paralelo. <br>  Mu√©stralo.  Creemos un controlador, agreguemos la tarea "para generar Toast en 5 segundos".  Vemos que Toast fue retirado y no se requirieron durmientes (pausas en la ejecuci√≥n de todo el programa). </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Handler handler = new Handler(); Runnable r = new Runnable() { public void run() { Toast.makeText(getApplicationContext(), "Delayed task executed", Toast.LENGTH_SHORT).show(); } }; handler.postDelayed(r, 5000);</code> </pre> </div></div><br><p>  Ahora agregue una tarea c√≠clica al controlador: </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Runnable r = new Runnable() { public void run() { Toast.makeText(getApplicationContext(), "Delayed task executed", Toast.LENGTH_SHORT).show(); handler.postDelayed(this, 5000); //   } }; handler.postDelayed(r, 5000);</code> </pre> </div></div><br><p>  Despu√©s de asegurarse de que se ejecuta cada 5 segundos, borre el controlador </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">handler.removeCallbacksAndMessages(null);</code> </pre> </div></div><br><p>  Queda por demostrar que la ejecuci√≥n de tareas desde Handler no se produce en paralelo.  La forma m√°s f√°cil de mostrar esto es carg√°ndolo con algo pesado y al mismo tiempo simple.  Me gusta ... mientras (cierto) sin dormir!  Diez segundos, para no matar por completo la aplicaci√≥n. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Runnable r = new Runnable() { public void run() { long initTime = System.currentTimeMillis(); boolean timeElapsed = false; while(!timeElapsed){ if(System.currentTimeMillis() - initTime &gt; 10000 ){ timeElapsed = true; //   ,   ! (  ,    ).         sleep } } } }; Toast.makeText(getApplicationContext(), "Hard Delayed task started", Toast.LENGTH_SHORT).show(); handler.postDelayed(r, 100);</code> </pre> </div></div><br><p>  Al iniciar dicha tarea, vemos que la aplicaci√≥n no responde a nuestros clics durante estos 10 segundos: est√° completamente ocupada procesando nuestro complejo ciclo.  La segunda conclusi√≥n que se desprende de este ejemplo es que no puede ejecutar tareas intensivas en recursos en el mismo hilo con la interfaz.  El subproceso de la interfaz de usuario siempre debe estar libre, y sus funciones deben resolverse lo m√°s r√°pido posible.  Algunas operaciones en la transmisi√≥n de la interfaz de usuario est√°n expl√≠citamente prohibidas: por ejemplo, Android bloquear√° la aplicaci√≥n si intenta acceder a Internet en la transmisi√≥n de la interfaz de usuario. </p><br><h3 id="parallelnoe-vypolnenie-potok">  Ejecuci√≥n concurrente: Stream </h3><br><div class="spoiler">  <b class="spoiler_title">Ver imagen</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/l7/3q/81/l73q81k62jyqkcimlbw_nvtotqe.jpeg"></p></div></div><br><p>  La pregunta l√≥gica ahora es c√≥mo crear nuevos hilos y trabajar en paralelo. <br>  Mostramos tanto la creaci√≥n de la secuencia como el hecho de su operaci√≥n paralela.  Vamos a crear una secuencia y cargarla con la misma tarea, por lo que, en el caso de habdler, nos quedamos con una interfaz inactiva durante 10 segundos. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Thread thread = new Thread() { @Override public void run() { try { sendMsgUsingBroadcast("Thread started"); long initTime = System.currentTimeMillis(); boolean timeElapsed = false; while(!timeElapsed){ if(System.currentTimeMillis() - initTime &gt; 10000 ){ timeElapsed = true; } } sendMsgUsingBroadcast("Thread stopped"); } catch (Exception e) { sendMsgUsingBroadcast("Thread error " + e.toString()); } } }; thread.start();</code> </pre> </div></div><br><p>  Creado, cargado, ¬°y la interfaz funciona!  La ejecuci√≥n del hilo ocurre en paralelo. <br>  La siguiente pregunta es c√≥mo controlar el flujo.  Es importante comprender que un subproceso se completar√° solo cuando se ejecute todo su c√≥digo fuente.  No puedes simplemente tomar y matar la transmisi√≥n.  Es hora de pensar en shared_prefs y aplicar la variable para la sincronizaci√≥n: deje que la variable running = true se configure junto con el inicio de la secuencia.  En cada una de sus iteraciones, el hilo verifica si se est√° ejecutando == verdadero, y si no, completa su ejecuci√≥n. </p><br><div class="spoiler">  <b class="spoiler_title">Ver c√≥digo</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">Thread thread = new Thread() { @Override public void run() { try { sendMsgUsingBroadcast("Thread started"); SharedPreferences prefs = getSharedPreferences(MY_PREFS_NAME, MODE_PRIVATE); while (true) { if (!prefs.getBoolean("running", false)) { break; } else { try { Thread.sleep(100); } catch (Exception e) {} } } sendMsgUsingBroadcast("Thread stopped"); } catch (Exception e) { sendMsgUsingBroadcast("Thread error " + e.toString()); } } }; thread.start();</code> </pre> </div></div><br><p>  Entonces, hemos avanzado unos pasos m√°s y ahora sabemos no solo sobre el servicio, sino tambi√©n sobre Handler y la transmisi√≥n.  Parece que estas herramientas son suficientes para comenzar a escribir una aplicaci√≥n que tenga una de las funciones de notificaci√≥n regular al usuario.  Pero tienen una caracter√≠stica: todos ellos est√°n unidos por el hecho de que no perdemos el control por un segundo, y siempre estamos obligados a estar en alg√∫n tipo de ciclo interminable que duerme la mayor parte del tiempo y ocasionalmente se despierta para verificar si se cumplen un par de condiciones para entender, para deducir aviso del usuario o volver a dormir por un largo tiempo.  Esto agrega un dolor de cabeza: ¬øqu√© pasa si nuestro servicio o aplicaci√≥n mata el optimizador de bater√≠a, y por qu√© consumimos tantos recursos de tel√©fonos inteligentes en aras de un peque√±o silbato no tan necesario? ,    ,               ,  -    ,             ? </p><br><h3 id="povtoryayuscheesya-vypolnenie-alarmmanager">  : AlarmManager </h3><br><p>       AlarmManager. </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/zf/9p/_u/zf9p_ushxeqt_yto0askm_xo-fw.jpeg"></p></div></div><br><p>  ,    ‚Äî  sendBroadcast  Action,        BroadcastReceiver! </p><br><p>  BroadcastReceiver, ,   ,    : </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">public class MyAlarmServiceReceiver extends BroadcastReceiver { private String CHANNEL_ID = "MyNotificationsChannel"; @Override public void onReceive(Context context, Intent intent) { Toast.makeText(context, "MyAlarmServiceReceiver onReceive", Toast.LENGTH_SHORT).show(); setNotify("Notify from AlarmManager", context); } }</code> </pre> </div></div><br><p>  AlarmManager   Receiver  15 : </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">AlarmManager alarmManager = (AlarmManager) getSystemService(ALARM_SERVICE); Intent intent = new Intent(AlarmActivity.this, MyAlarmServiceReceiver.class); PendingIntent pendingIntent = PendingIntent.getBroadcast(getApplicationContext(), 0, intent, PendingIntent.FLAG_UPDATE_CURRENT); Calendar calendar = Calendar.getInstance(); calendar.setTimeInMillis(System.currentTimeMillis()); calendar.set(Calendar.HOUR_OF_DAY, 1); calendar.set(Calendar.MINUTE, 10); //alarmManager.setExactAndAllowWhileIdle(AlarmManager.RTC_WAKEUP, 1 * 60 * 1000, pendingIntent); // not repeating - just one run, if needed alarmManager.setRepeating(AlarmManager.RTC_WAKEUP, System.currentTimeMillis(), AlarmManager.INTERVAL_FIFTEEN_MINUTES, pendingIntent);</code> </pre> </div></div><br><p>      :  15      . </p><br><p>   (     )   . </p><br><h3 id="logirovanie">  </h3><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/96/e-/0r/96e-0rjswq33id8bi4g4xjq3du8.jpeg"></p></div></div><br><p>  Logcat Reader   ,     . <br>     (      )  ,     . </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">String LOG_TAG = "MYDEMOAPP"; Log.i(LOG_TAG, "Test info log"); Log.d(LOG_TAG, "Test debug log"); Log.e(LOG_TAG, "Test error log");</code> </pre> </div></div><br><p>      ,   ,       MainActivity,     ,   . </p><br><h1 id="ishodnyy-kod">  C√≥digo fuente </h1><br><p> <a href="https://github.com/Jen94/AndroidDemo" rel="nofollow">     <br></a> </p><br><h1 id="zaklyuchenie">  Conclusi√≥n </h1><br><p>      ,           Android.           ,    ,   ,      :     ,     .  , ,           -       Android-. </p></div></div><p>Source: <a href="https://habr.com/ru/post/483878/">https://habr.com/ru/post/483878/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../483860/index.html">WHD Global 2012: el verdadero valor de los dominios baratos</a></li>
<li><a href="../483862/index.html">Funciones virtuales en microcontroladores: el lado oscuro</a></li>
<li><a href="../483864/index.html">M√°s r√°pido que C ++; m√°s lento que php</a></li>
<li><a href="../483874/index.html">La publicaci√≥n del c√≥digo VVVVVV mostr√≥ cu√°n groseros son los juegos dentro</a></li>
<li><a href="../483876/index.html">La cultura corporativa roja es el principal problema de los negocios rusos (Parte 1)</a></li>
<li><a href="../483880/index.html">¬øEn qu√© se diferencia la programaci√≥n actual de la programaci√≥n hace 20 a√±os?</a></li>
<li><a href="../483882/index.html">Pruebas unitarias en arquitectura Clean Swift</a></li>
<li><a href="../483886/index.html">Decodificador Movix Pro: del software a la √∫ltima tuerca</a></li>
<li><a href="../483888/index.html">Ejecutar programas de un solo archivo en Java 11 sin compilaci√≥n</a></li>
<li><a href="../483896/index.html">C√≥mo lanzar un producto solo si es desarrollador: Consejos del creador de Laravel, Taylor Otvel. Parte 2: Encontrar una idea</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>