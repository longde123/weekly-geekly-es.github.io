<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö¥üèº üë®üèø‚Äçüé§ üöç DataPower-Lernprogramm ü§¥ ‚úñÔ∏è üöã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Von wedmeed mitverfasstes Material 


 Als unser Projekt 2017 in Vietnam begann, stie√üen wir auf das neue Biest IBM DataPower f√ºr uns. IBM DataPower i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DataPower-Lernprogramm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/neoflex/blog/442686/"><p>  Von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">wedmeed</a> mitverfasstes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">Material</a> </p><br><p> Als unser Projekt 2017 in Vietnam begann, stie√üen wir auf das neue Biest IBM DataPower f√ºr uns.  IBM DataPower ist ein Gateway-Produkt zwischen Clients und Backends, das zum Filtern, Weiterleiten, Anreichern oder f√ºr andere Transformationen von Nachrichten entwickelt wird (im Folgenden als Anforderungen bezeichnet).  Es war notwendig, schnell zu lernen, es gab keine Zeit f√ºr den Aufbau, daher wurden wir eingeladen, uns damit vertraut zu machen. Danach gab es viele Stunden Skype-Konferenz mit unserem Kollegen aus Moskau, der uns sein Wissen und seine Erfahrung mit diesem Produkt weitergab. <br></p><br><p>  Das Selbststudium basierte darauf, die Dokumentation zu studieren und Schulungsvideos aus dem Internet anzusehen - und hier wartete ich auf einen Fang.  Ich konnte praktisch keine Informationen auf Russisch finden.  √úbrigens waren meine Kenntnisse der englischen Sprache zu dieser Zeit nicht auf h√∂chstem Niveau, au√üerdem war es mein erstes Projekt und wahrscheinlich haben diese Faktoren mein Leben kompliziert.  Dies brachte mich dazu, einen Schulungsartikel auf Russisch und auf einfachste Weise f√ºr Anf√§nger zu schreiben, die auf dieses Produkt gesto√üen sind und versuchen, seine Grundlagen schnell zu verstehen.  Der Artikel befreit Sie nicht vom Lesen der Dokumentation, erleichtert jedoch das Leben in den fr√ºhen Phasen des Verst√§ndnisses "wie es funktioniert". <br></p><br><p>  Es ist auch erw√§hnenswert, dass die in der Praxis angegebene Struktur dem tats√§chlichen Projekt nahe kommt, sodass Sie es als Basis verwenden und Ihre Anforderungen erweitern und erg√§nzen k√∂nnen.  Abschlie√üend werden den Abschnitten zur Theorie einige Worte zum bereits umgesetzten Projekt sowie einige Funktionen gegeben, die es wert sind, beachtet zu werden. </p><br><img src="https://habrastorage.org/webt/rm/at/lk/rmatlkcfuvcjxvgireijushp7yc.jpeg"><br><a name="habracut"></a><br><h2>  Teil 1. Installieren von DataPower mit der Docker Toolbox </h2><br><p>  Installieren Sie die Docker Toolbox-App und f√ºhren Sie sie aus.  Unmittelbar nach dem Start sehen Sie die IP-Adresse des Computers, √ºber die DataPower sp√§ter verf√ºgbar sein wird: <br></p><br><img src="https://habrastorage.org/webt/zs/qa/wn/zsqawn2jksqp8j8gfl5gwslnks4.png"><br><br><p>  Um das Image zu starten, m√ºssen Sie einige Einstellungen der virtuellen Maschine (relevant f√ºr Version IDG.2018.4.1.0) √§ndern und neu starten: <br></p><br><ol><li>  Stoppen Sie die Docker-Maschine mit dem folgenden Befehl: <br><br><pre><code class="plaintext hljs">docker-machine stop</code> </pre> </li><li>  System -&gt; Motherboard -&gt; Hauptspeicher: mindestens 4096 MB; <br></li><li>  System -&gt; Prozessor: mindestens 2; <br></li><li>  Anzeige -&gt; Bildschirm -&gt; Videospeicher: mindestens 128 MB; <br></li><li>  Wir starten die Docker-Maschine mit dem Befehl: <br><br><pre> <code class="plaintext hljs">docker-machine start</code> </pre> <br>  <i>Hinweis</i>  <i>Wenn Sie aufgefordert werden, die Docker-Maschine env neu zu starten, f√ºhren Sie Folgendes aus:</i> <br><br><pre> <code class="plaintext hljs">docker-machine env</code> </pre> </li><li>  Als N√§chstes m√ºssen Sie das IBM DataPower-Image entleeren: <br><br><pre> <code class="plaintext hljs">docker pull ibmcom/datapower</code> </pre> </li><li>  Starten Sie dann den Docker-Container mit dem folgenden Befehl: <br><br><pre> <code class="plaintext hljs">docker run -it \ -v $PWD/config:/drouter/config \ -v $PWD/local:/drouter/local \ -e DATAPOWER_ACCEPT_LICENSE=true \ -e DATAPOWER_INTERACTIVE=true \ -p 9090:9090 \ -p 3630:3630 \ -p 9022:22 \ -p 7170:7170 \ --name idg \ ibmcom/datapower</code> </pre></li><li>  Dr√ºcken Sie nach Abschluss des Befehls die Eingabetaste und geben Sie <b>admin / admin</b> als Benutzernamen und Passwort ein <br></li><li>  Verwenden Sie die folgenden Befehle, um die Webverwaltungsoberfl√§che zu starten: <br><br><pre> <code class="plaintext hljs">co</code> </pre> <br>  und <br><br><pre> <code class="plaintext hljs">web-mgmt 0 9090</code> </pre> </li><li>  F√ºhren Sie nach all diesen Schritten im Browser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://192.168.99.100:9090/ aus.</a> <br></li></ol><br><h2>  Teil 2. Dom√§nen </h2><br><h3>  2.1.  Theorie </h3><br><p>  Mit Domains in DataPower k√∂nnen Sie Administrations- und Entwicklungstools trennen und Sicherheit bieten. <br></p><br><p>  Nach der Installation gibt es nur eine Standarddom√§ne, aus der Anwendungsdom√§nen erstellt werden k√∂nnen.  Jede Dom√§ne hat ihre eigene Konfiguration von Parametern. <br></p><br><p>  Einige allgemeine Ressourcen und Parameter k√∂nnen nur in der Standarddom√§ne definiert werden. Dazu geh√∂ren Netzwerkschnittstellen, Benutzer- und Zugriffssteuerung, Anwendungsdom√§nen und andere. <br></p><br><p>  Eine Anwendungsdom√§ne ist ein Entwicklungsabschnitt f√ºr Anforderungsverarbeitungsdienste.  Darin definierte Dienste k√∂nnen nicht mit einer anderen Anwendungsdom√§ne geteilt werden.  Anwendungsdom√§nen k√∂nnen separat und unabh√§ngig neu gestartet werden, ohne dass ein vollst√§ndiger Neustart von DataPower erforderlich ist. <br></p><br><p>  Sie k√∂nnen Dom√§nen erstellen, neu starten, zur√ºcksetzen, anhalten, erneuern oder l√∂schen.  Ausf√ºhrlichere Informationen zu allen Verwaltungsfunktionen finden Sie in der offiziellen Dokumentation. <br></p><br><p>  Ein wenig √ºber das abgeschlossene Projekt.  Wir haben 3 Domains verwendet: <br></p><br><ul><li>  Standard - Die Standarddom√§ne mit gemeinsam genutzten Ressourcen und Parametern. </li><li>  Trunk - die Hauptdom√§ne, die alles enth√§lt, was zur Verarbeitung von Anforderungen erforderlich ist; </li><li>  Einstellungen - Einstellungen und Sicherheitsdom√§ne, lokale Dateien enthalten Informationen zu Service-Routing-Regeln und Sicherheitseinstellungen. </li></ul><br><p>  Die Notwendigkeit, alle Einstellungen auf eine separate Dom√§ne zu √ºbertragen, entstand im Zusammenhang mit der Suche nach einem einfacheren Bereitstellungspfad.  Wie in vielen Projekten wurden die Entwicklungs-, Test- und Produktumgebungen getrennt, und die √úbertragung in eine separate Einstellungsdom√§ne erm√∂glichte es uns, alle Hauptdom√§nen aus der Entwicklungsumgebung in anderen Umgebungen durch Export / Import zu installieren, ohne das Risiko, die Umgebungseinstellungen zu verlieren. <br></p><br><h3>  2.2.  √úbe </h3><br><ul><li>  Geben Sie im Suchfeld "Domain" ein, w√§hlen Sie "Application Domain" und klicken Sie auf "Add". <br><img src="https://habrastorage.org/webt/uo/k_/gs/uok_gsaxjifcklt56rs9wmiujhm.png"></li><li>  Hier m√ºssen Sie den Domainnamen angeben, einen Kommentar abgeben (falls gew√ºnscht) und die √úberwachung und Protokollierung aktivieren.  F√ºllen Sie die Felder aus und √ºbernehmen Sie die √Ñnderungen <br><img src="https://habrastorage.org/webt/3b/6w/ts/3b6wtsfrlvxcxgb7jgpkmm6u1rq.png"></li><li>  F√ºgen Sie in √§hnlicher Weise eine weitere Domain "Trunk" hinzu </li><li>  Gehen Sie zu √Ñnderungen √ºberpr√ºfen <br><img src="https://habrastorage.org/webt/p-/nh/cp/p-nhcpeur45dhrzahmpffom9pq8.png"></li><li>  und speichern Sie die Dom√§nenkonfiguration <br><img src="https://habrastorage.org/webt/1u/8n/si/1u8nsi-zblkkqdsrpa7lnqcgw8g.png"></li><li>  Sie k√∂nnen den Status der erstellten Objekte √ºberpr√ºfen, indem Sie in der Navigationsstruktur unter Status -&gt; Haupt -&gt; Objektstatus zur Standarddom√§ne wechseln <br><img src="https://habrastorage.org/webt/uz/qo/q4/uzqoq4kek4qdgkfkhovrjmiridm.png"></li><li>  W√§hlen Sie <b><i>Anzeigen nach: Typen</i></b> <br><img src="https://habrastorage.org/webt/fj/5_/6z/fj5_6zg-kidxhkt5as0omzfvsiw.png"></li><li>  Suchen Sie die Anwendungsdom√§ne in der Liste und √ºberpr√ºfen Sie den Status der Objekte: Jedes Objekt muss gespeichert, aktiviert und aktiviert sein.  Wenn ja, fahren Sie mit dem n√§chsten Kapitel fort. </li></ul><br><img src="https://habrastorage.org/webt/xa/ii/kj/xaiikjxfdhsy19lez-rxo2xmeug.png"><br><br><h2>  Teil 3. Warteschlangenmanager </h2><br><p>  Der Warteschlangenmanager ist keine obligatorische Komponente von IBM DataPower. Am Beispiel von MQ k√∂nnen Sie jedoch die volle Leistung dieses Produkts zeigen.  Wir werden MQ von IBM verwenden.  W√§hrend der in Kapitel 6 beschriebenen Tests m√ºssen wir eine Nachricht an den lokalen Warteschlangenmanager senden.  In diesem Artikel werde ich dies mit dem Dienstprogramm rfhutil tun, aber Sie k√∂nnen jede Methode verwenden, die Ihnen zur Verf√ºgung steht.  Zum Testen m√ºssen Sie mithilfe des MQ-Warteschlangenmanagers eine Verbindung von DP zu Ihrem lokalen Warteschlangenmanager herstellen. </p><br><cut></cut><br><h3>  3.1.  Theorie </h3><br><p>  Der Warteschlangenmanager stellt den Datenaustausch zwischen dem Gateway und den Remote-Warteschlangenmanagern bereit. </p><br><p>  Sie k√∂nnen auch die MQ Queue Manager-Gruppe konfigurieren, wodurch die Fehlertoleranz des Systems erh√∂ht wird.  Dies kann beispielsweise n√ºtzlich sein, wenn Sie den Client mit einem der funktionierenden Warteschlangenmanager verbinden m√∂chten, und in einigen F√§llen, die Sie in der offiziellen Dokumentation finden. </p><br><p>  Aus der Erfahrung des Projekts sollte nur eine Funktion beachtet werden: Zu einer Zeit wollten wir versuchen, den Lastenausgleich mit DataPower zu implementieren, insbesondere mit Gruppen von Warteschlangenmanagern, aber in der Praxis fanden wir keine solche M√∂glichkeit.  Eine alternative L√∂sung besteht darin, einen Cluster von Warteschlangenmanagern zu erstellen. </p><br><br><h3>  3.2.  √úbe </h3><br><h4>  3.2.1.  Vorbereitung </h4><br><ol><li>  Installieren Sie WebSphere MQ. </li><li>  Erstellen Sie einen lokalen Warteschlangenmanager LOCAL_DP_QM, auf den √ºber Port 3630 zugegriffen werden kann. </li><li>  Konfigurieren Sie den DP.SVRCONN-Kanal. <br><br><p>  Beim Erstellen eines Kanals k√∂nnen die folgenden Befehle hilfreich sein: </p><br><pre> <code class="plaintext hljs">strmqm LOCAL_DP_QM /*  mq*/ runmqsc LOCAL_DP_QM /*   mq*/ DEFINE CHANNEL (DP.SVRCONN) CHLTYPE(SVRCONN) MCAUSER('evlasenko') /* */ SET CHLAUTH('DP.SVRCONN') TYPE(USERMAP) CLNTUSER('evlasenko') USERSRC(channel) ADDRESS('*') ACTION(ADD) /*      */ SET CHLAUTH(DP.SVRCONN) TYPE(BLOCKUSER) USERLIST('nobody') /*   */ ALTER LISTENER (SYSTEM.DEFAULT.LISTENER.TCP) TRPTYPE(TCP) PORT(3630) control(QMGR) /*    3630*/ ALTER AUTHINFO (SYSTEM.DEFAULT.AUTHINFO.IDPWOS) AUTHTYPE(IDPWOS) CHCKCLNT(OPTIONAL) /* */ REFRESH SECURITY TYPE(CONNAUTH) /*  */ endmqm LOCAL_DP_QM /*  mq*/ strmqm LOCAL_DP_QM /*  mq*/ END</code> </pre><br></li><li>  Erstellen Sie die Warteschlangen DP.IIB.REQIN und DP.IIB.RESIN </li><li>  F√ºhren Sie rfhutil unter dem Namen des Benutzers aus, f√ºr den der Kanal erstellt wurde.  Schreiben Sie in die Zeile Name des Warteschlangenmanagers (zum Herstellen einer Verbindung): <br><br><pre> <code class="plaintext hljs">DP.SVRCONN/TCT/127.0.0.1(3630)</code> </pre> <br></li><li>  Versuchen Sie, die Liste der Warteschlangennamen zu laden. Das Nachrichtenfenster sollte keine Fehler enthalten.  Die Verbindung zum Kanal wurde √ºberpr√ºft. <br></li></ol><br><h4>  3.2.2.  Erstellen Sie IBM MQ Queue Manager </h4><br><ol><li>  Gehen Sie zur Trunk-Domain. </li><li>  Geben Sie bei der Suche MQ ein, w√§hlen Sie IBM MQ Queue Manager aus und klicken Sie auf Hinzuf√ºgen. </li><li>  Sie m√ºssen den Namen (TEST_QM), den Hostnamen des Warteschlangenmanagers, den Namen des Warteschlangenmanagers und den Kanalnamen sowie das Zeitlimit angeben.  Konfigurieren und speichern Sie die √Ñnderungen. <br><img src="https://habrastorage.org/webt/di/sg/x1/disgx1dt8szkq9uoicnlepcn9lg.png"><br></li></ol><br><p>  √úberpr√ºfen Sie den Status des Warteschlangenmanagerobjekts auf dieselbe Weise wie den Status von Dom√§nen.  W√§hlen Sie dazu Objektstatus und den Filter Anzeigen nach: Typen aus der Trunk-Dom√§ne aus.  Suchen Sie im Abschnitt "IBM MQ Queue Manager" das entsprechende Objekt und √ºberpr√ºfen Sie dessen Status. </p><br><h2>  Teil 4. Multiprotokoll-Gateways </h2><br><h3>  4.1.  Theorie </h3><br><p>  Multi-Protocol Gateway (MPG) ist ein Multi-Protocol-Gateway, mit dem Sie Anforderungen von Clients mit verschiedenen Protokollen empfangen und dann mit verschiedenen Protokollen auf verschiedene Server √ºbertragen k√∂nnen.  Das vom Client verwendete Protokoll stimmt m√∂glicherweise nicht mit dem vom RAS-Server verwendeten Protokoll √ºberein. </p><br>  In den wichtigsten MPG-Einstellungen k√∂nnen Sie die folgenden Komponenten definieren: <br><br><ul><li>  XML Manager - steuert das Kompilieren und Zwischenspeichern von Stylesheets (xsl, xslt) sowie das Zwischenspeichern von Dokumenten. </li><li>  Richtlinie - besteht aus Regeln, von denen jede eine Reihe von Aktionen definiert, die auf die durch das Gateway √ºbertragene Nachricht angewendet werden. </li><li>  Einstellungen auf der Vorder- und R√ºckseite (Festlegen der URL, Arten eingehender und ausgehender Nachrichten, Zeit√ºberschreitungen und mehr). </li></ul><br><p>  Ein paar Worte zum Projekt: </p><br><p>  Das Projekt verwendet 4 Multiprotokoll-Gateways (Routing, 2 Transformations-Gateways f√ºr verschiedene Endsysteme und ein zus√§tzliches f√ºr den Empfang von Dateien aus der Einstellungsdom√§ne).  Das folgende Diagramm zeigt das allgemeine Interaktionsschema: </p><br><img src="https://habrastorage.org/webt/p9/ea/yb/p9eayb25jpeoiazqjd0sitssuf4.png"><br><p>  Die Menge an MPG kann abh√§ngig von der Architektur der gesamten L√∂sung variieren.  In unserem Fall ist DataPower mit einem Integrationsbus (IIB) und Mikrodiensten konfrontiert, die erhebliche Unterschiede in den Schnittstellen aufweisen (json / http gegen√ºber xml / mq). Daher wurde beschlossen, f√ºr jedes spezifische Backend transformative MPGs zu erstellen und diese entsprechend zu benennen.  F√ºr alle Clients arbeiten wir mit json / http, daher ist das Routing von MPG eines davon.  Die Haupt-MPGs bestehen aus 3 Regeln f√ºr die Verarbeitung von Nachrichten - Anforderung, Antwort und Fehler.  Jede Regel besteht aus den erforderlichen Aktionen wie Transformation, Protokollierung, Routing und anderen. </p><br><p>  Von Features - Wenn Sie in der Richtlinie die Aktion ConvertQueryParamToXML verwenden, achten Sie auf InputConversion.  Wenn Sie die Standardcodierung auf JSON setzen und versuchen, eine GET-Anforderung zu senden, werden Sie √ºberrascht sein, dass die Nachricht keine von Ihnen angegebenen Transformationen durchlaufen hat und Sie keine Spuren davon finden.  Diese Funktion hilft dabei, die Erstellung einer separaten Regel f√ºr GET-Anforderungen zu √ºberwinden. </p><br><h3>  4.2.  √úbe </h3><br><h4>  4.2.1.  Vorbereitung </h4><br><p>  Sie finden alle f√ºr die Arbeit erforderlichen Dateien unter dem Link <a href="">https://github.com/EvgenyaVlasenko/IBM_DataPower.git</a> <br></p><h4>  4.2.1.1.  Domain-Trunk </h4><br><ol><li>  Gehen Sie zur Trunk-Domain. </li><li>  W√§hlen Sie in der Systemsteuerung Dateiverwaltung aus. </li><li>  Erstellen Sie im lokalen Verzeichnis die folgende Verzeichnisstruktur und platzieren Sie die entsprechenden Dateien darin (jede Datei enth√§lt eine kurze Beschreibung der von ihr ausgef√ºhrten Funktionen sowie eine ausf√ºhrlichere Beschreibung dieser Informationen weiter unten in diesem Artikel). <br><img src="https://habrastorage.org/webt/oj/am/i9/ojami90qdgg81ojuyr88pmeuzd0.png"><br></li></ol><br><h4>  4.2.1.2.  Dom√§neneinstellungen </h4><br><ol><li>  Gehen Sie zur Einstellungsdom√§ne. </li><li>  W√§hlen Sie in der Systemsteuerung Dateiverwaltung aus. </li><li>  Erstellen Sie im lokalen Verzeichnis die folgende Verzeichnisstruktur und platzieren Sie die entsprechenden Dateien darin (die Dateien enthalten auch eine kurze Beschreibung davon). <br><img src="https://habrastorage.org/webt/mf/9r/ne/mf9rnemyu8mcb01ad_wi6__ozj0.png"><br></li></ol><br><h3>  4.2.2.  Erstellen Sie GetFileMPG </h3><br><p>  Erstellen Sie zun√§chst ein einfaches Hilfs-MPG, das Dateien aus der Einstellungsdom√§ne zur√ºckgibt. </p><br><ol><li>  Gehen Sie zur Einstellungsdom√§ne. </li><li>  W√§hlen Sie in der Systemsteuerung Multi-Protocol Gateway aus und klicken Sie auf Erstellen. </li><li>  Geben Sie den Namen (GetFileMPG), die Beschreibung (optional) und den Backend-Typ (dynamisch) an.  Da das Backend nicht aufgerufen wird und nur die Datei vom lokalen System zur√ºckgegeben wird, k√∂nnen Sie in diesem Beispiel einen beliebigen Backend-Typ angeben. <br><img src="https://habrastorage.org/webt/ds/g7/5g/dsg75gxvgo-7caldbmytubddg6i.png"><br></li><li>  Geben Sie Anforderungs- und Antworttypen an.  Durch die explizite Angabe von Typen wird die Anzahl der Inline-Pr√ºfungen verringert.  Wenn Sie den Durchgangstyp angeben, k√∂nnen Sie keine Regel erstellen (in diesem Fall die Antwort transformieren).  Wenn wir den Anforderungstyp angeben, der ebenfalls weitergeleitet wird, k√∂nnen wir die Nachricht in keiner Weise verarbeiten.  Diese Option passt nicht zu uns, daher beschr√§nken wir die Art der Anforderung mithilfe von Nicht-XML. <br><br><img src="https://habrastorage.org/webt/qx/nx/l_/qxnxl_j3ki9e8hcc215zropuix8.png"><br></li><li>  Klicken Sie auf + und w√§hlen Sie den HTTP-Handler aus, um ein neues Front-Side-Protokoll zu erstellen. <br><br><img src="https://habrastorage.org/webt/dc/gq/pq/dcgqpqgpx284pxkoqdqhivwjbku.png"><br></li><li>  Hier sollten Sie einen Namen, eine IP-Adresse, einen Port und eine Liste der zul√§ssigen Methoden angeben.  Achten Sie auf die IP-Adresse.  Wenn Sie 0.0.0.0 angeben, kann jeder auf dieses Gateway zugreifen.  Wenn 127.0.0.1 - nur andere Gateways innerhalb derselben DataPower.  Da die Einstellungen Sicherheitsparameter enthalten, verwenden wir die zweite Option.  F√ºllen Sie die Felder aus und klicken Sie auf "√úbernehmen". Das Protokoll wird automatisch zum Gateway hinzugef√ºgt. <br><br><img src="https://habrastorage.org/webt/xn/y5/-r/xny5-rfrolidwemexqwg25-tkec.png"><br></li><li>  Klicken Sie auf +, um eine neue Richtlinie hinzuzuf√ºgen. <br><br><img src="https://habrastorage.org/webt/ju/y0/q6/juy0q6_osmjfnwd2v5xev97wvta.png"><br></li><li>  Geben Sie den Richtliniennamen "GetFilePolicy" ein. <br></li><li>  Erstellen Sie eine neue Regel, geben Sie den Namen und die Richtung der Regel ein.  Da es wirklich kein Backend gibt und nur die gew√ºnschte Datei zur√ºckgegeben wird, gibt es nur eine Regel (Client zu Server). <br><br><img src="https://habrastorage.org/webt/cv/4c/z_/cv4cz_dfzc5sjxu4i7as6iluzne.png"><br></li><li>  Doppelklicken Sie auf die Aktion "√úbereinstimmen", um sie zu konfigurieren, w√§hlen Sie eine vorhandene Regel aus und √ºbernehmen Sie die √Ñnderungen.  Es w√§re ideologisch korrekt, eine Einschr√§nkung f√ºr die F√§higkeit festzulegen, nur Get-Anfragen zu empfangen. Im Rahmen der Schulungsaufgabe k√∂nnen Sie jedoch die vorhandene ausw√§hlen. <br></li><li>  F√ºgen Sie eine weitere Aktion hinzu - GatewayScript, indem Sie es auf die Regel ziehen und konfigurieren.  Als Transformation verwenden wir die vorbereitete Datei, die im lokalen Dateisystem: /// die Datei anhand des Namens aus dem URI der eingehenden Anforderung findet und in den Nachrichtentext einf√ºgt.  Das Ergebnis der Operation wird direkt in den Ausgabepuffer der Regel √ºbertragen.  Speichern Sie die √Ñnderungen. <br><br><img src="https://habrastorage.org/webt/ai/pr/va/aiprvaljftoye2gr5tf1xjf4s_u.png"><br></li><li>  Das endg√ºltige politische Ergebnis sollte folgenderma√üen aussehen: <br><br><img src="https://habrastorage.org/webt/rm/q0/on/rmq0onkkkvygnyevy574vsgz3ns.png"><br></li><li>  Die MPG-Erstellung ist abgeschlossen. Speichern Sie die √Ñnderungen. <br></li><li>  Sie k√∂nnen den Erfolg der Erstellung mithilfe des Objektstatus √ºberpr√ºfen, √§hnlich wie Sie den Status der Dom√§nen und des Warteschlangenmanagers √ºberpr√ºfen.  W√§hlen Sie dazu in der Einstellungsdom√§ne den Objektstatus und den Filter Anzeigen nach: Diensten aus.  Suchen Sie im Abschnitt ‚ÄûMulti-Protocol Gateway‚Äú nach dem entsprechenden Objekt und √ºberpr√ºfen Sie dessen Status. <br></li><li>  Sie k√∂nnen dieses MPG nicht von au√üen aufrufen, da Sie es mit IP gesch√ºtzt haben.  √Ñndern Sie die IP vor√ºbergehend von 127.0.0.1 auf 0.0.0.0 und den Port von 7171 auf 7170 und f√ºhren Sie die folgende Abfrage aus: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/trunk/route/routeRules.xml"</code> </pre><br></li><li>  Sie sollten die folgende Antwort erhalten: <br><br><img src="https://habrastorage.org/webt/e5/m8/3n/e5m83ngxz17e8lahsicaxs6lj5s.png"><br></li><li>  √Ñndern Sie erneut die IP-Adresse und den Port auf das Original 127.0.0.1:7171. <br></li></ol><br><h4>  4.2.3.  RoutingMPG erstellen </h4><br><p>  Erstellen Sie nun RoutingMPG.  Basierend auf den Eingabeanforderungs- und Routingregeln bestimmt er, wohin und mit welchen Parametern die Anforderung gesendet werden soll. </p><br><ol><li>  Gehen Sie zur Trunk-Domain. </li><li>  Erstellen Sie ein neues Multiprotokoll-Gateway gem√§√ü den Abschnitten 2-10 von Abschnitt 4.2.2 mit den folgenden Werten: <br><ul><li>  3 - Name: RoutingMPG, Backend-Typ: Dynamisch (f√ºr die M√∂glichkeit, Anforderungen bei Bedarf an verschiedene MPGs weiterzuleiten). </li><li>  4 - Rq: Nicht-XML, Rs: Nicht-XML. </li><li>  6 - Name: RoutingHTTP_FSH, IP: 0.0.0.0, Port: 7170, + Get-Methode. </li><li>  8 - Name: RoutingPolicy. </li><li>  9 - Name: RoutingPolicy_rule_req, Richtung: Client zu Server. </li></ul><br></li><li>  F√ºgen Sie eine weitere Aktion hinzu, um die Anforderung weiterzuleiten. Ziehen Sie dazu die Aktion "Weiterleiten" auf die Regel, doppelklicken Sie darauf, um sie zu konfigurieren, f√ºllen Sie die Felder aus und √ºbernehmen Sie die √Ñnderungen.  Die Datei route.xsl empf√§ngt die Routing-Einstellungsdatei von der Einstellungsdom√§ne √ºber GetFileMPG, das zuvor erstellt wurde.  Danach werden basierend auf dem URI die Einstellungen, die f√ºr diesen Vorgang erforderlich sind, bereits aus der Datei ausgew√§hlt.  Einige von ihnen werden f√ºr das Routing verwendet, andere werden Headern zur Verwendung in anderen MPGs hinzugef√ºgt.  Die Eingabe- und Ausgabeparameter bestimmen die Arbeitsweise nur mit dem Nachrichtentext und wirken sich in keiner Weise auf Header und Variablen aus.  Deshalb: Eingabe von null - da die Informationen aus dem Nachrichtentext nicht f√ºr das Routing verwendet werden.  Die Ausgabe ist null - da das Ergebnis der Transformation nur eine √Ñnderung der Serviceinformationen ist. <br><br><img src="https://habrastorage.org/webt/bb/q0/nh/bbq0nh2dtogav5pyfoeneb3t66m.png"><br></li><li>  Erstellen Sie auf √§hnliche Weise zwei weitere Regeln und speichern Sie alle √Ñnderungen: <br><ul><li>  Richtung: Server-Client, Name: RoutingPolicy_rule_resp; <br>  Transformation: Eingabe INPUT, Ausgabe NULL, lokale Transformationsdatei: ///RoutingMPG/transform/resp.xslt.  Die Datei resp.xslt empf√§ngt den http-Status der Transformations-MPG-Antwort und setzt ihn explizit auf die RoutingMPG-Antwort.  Ist dies nicht der Fall, wird der Standardcode auf 200 gesetzt, auch wenn im Transformations-MPG ein Fehler aufgetreten ist. <br></li><li>  Richtung: Fehler, Name: RoutingPolicy_rule_error; <br>  Transformation: Input INPUT, Output PIPE (gem√§√ü der Dokumentation kann die Verwendung von PIPE zwischen zwei benachbarten Aktionsknoten als INPUT und OUTPUT zus√§tzliche Verarbeitung eliminieren und den verwendeten Speicher reduzieren). Die Transformationsdatei ist lokal: ///RoutingMPG/transform/errors.xsl.  Die Datei error.xsl empf√§ngt den Fehlercode und den Text aus der Antwort von der Transformations-MPG und generiert eine JSON-Fehlermeldung in dem vom Client erwarteten Format. <br></li></ul><br></li><li>  Das endg√ºltige politische Ergebnis sollte folgenderma√üen aussehen: <br><br><img src="https://habrastorage.org/webt/um/kx/x-/umkxx-3kwx3hi1dzmc1e80ko-wa.png"><br></li><li>  Die MPG-Erstellung ist abgeschlossen. Speichern Sie die √Ñnderungen. <br></li><li>  F√ºhren Sie beispielsweise mit dem Dienstprogramm curl die folgende Abfrage aus: <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage"</code> </pre> <br></li><li>  Wenn Sie den folgenden Fehler erhalten, wird alles korrekt ausgef√ºhrt.  Dieser Fehler bedeutet, dass die Nachricht erfolgreich empfangen und verarbeitet wurde, der Versuch, das Backend (in diesem Fall IIBMPG) aufzurufen, jedoch nicht erfolgreich war.  Fahren Sie mit dem n√§chsten Schritt fort. <br><br><img src="https://habrastorage.org/webt/8g/iq/tl/8giqtlzspsyix66vnl7mkcxnelk.png"><br></li></ol><br><h4>  4.2.4.  Erstellung von IIBMPG </h4><br><p>  Der n√§chste Schritt ist das Erstellen eines transformativen MPG.  Angenommen, das externe System hat das JSON-Anforderungsformat und das interne ist XML.  Wir m√ºssen die Eingabenachricht transformieren, damit das interne System sie verstehen kann.  Es ist erw√§hnenswert, dass dies nicht immer eine einfache Konvertierung der gesamten Nachricht ist.  Es ist h√§ufig erforderlich, eine abgeschnittene oder erweiterte Nachricht zu √ºbermitteln, manchmal mit einer vollst√§ndig neu gestalteten Struktur. </p><br><ol><li>  Gehen Sie zur Trunk-Domain. </li><li>  Erstellen Sie ein neues Multiprotokoll-Gateway gem√§√ü den Abschnitten 2-10 von Abschnitt 4.2.2 mit den folgenden Werten: <br><ul><li>  3 - Name: IIBMPG, Backend-Typ: Dynamisch </li><li>  4 - Rq: JSON, Rs: XML </li><li>  6 - Name: IIBHTTP_FSH, IP: 127.0.0.1 (nur Anforderungen von derselben DataPower), Port: 7172, + Get-Methode </li><li>  8 - Name: IIBPolicy </li><li>  9 - Name: IIBPolicy_rule_req, Richtung: Client zu Server </li></ul><br></li><li>  F√ºgen Sie eine Beschreibung hinzu.  Basierend auf dem X-DP-Transform-Namen in den Anforderungsheadern empf√§ngt die Datei IIBRuleRoute.xsl aus der lokalen Datei: ///IIB/route/IIBRouteRules.xml die Namen der Anforderungsumwandlungs-, Antwort- und Fehlerdateien f√ºr diesen Dienst und setzt ihre Werte auf die entsprechenden Kontextvariablen var: // context / IIB / reqTransform, var: // context / IIB / ansTransform, var: // context / IIB / errTransform.  Andere Werte aus Headern (URL, URL, Ablaufdatum, Zeitlimit) werden ebenfalls in Kontextvariablen platziert. <br><br><img src="https://habrastorage.org/webt/xo/6b/ek/xo6bekae8dsumpvosfe5xnbhneg.png"><br></li><li>  F√ºgen Sie eine weitere Aktion hinzu, indem Sie Erweitert auf Ihre Regel ziehen und Abfrageparameter in XML konvertieren aus der Liste ausw√§hlen und konfigurieren.  Sie m√ºssen eine neue Eingabekonvertierungszuordnung hinzuf√ºgen, die einen Namen (cmnJSONParseCNVM) und den erforderlichen Typ (JSON) enth√§lt. <br><br><img src="https://habrastorage.org/webt/ir/az/gb/irazgbszkybdgjkor1otjvrllqc.png"><br><br><img src="https://habrastorage.org/webt/yd/tk/2x/ydtk2xhbveh4j6z1gsweidcyhak.png"><br></li><li>  F√ºgen Sie die Transformation nach der Standardkonvertierung hinzu und konfigurieren Sie sie.  In diesem Fall wird die in der vorherigen Transformation festgelegte Variable verwendet, um die Transformationsdatei anzugeben.  Dies geschieht so, dass die Transformation universell ist und die Datei selbst abh√§ngig von der Eingabenachricht "on the fly" ersetzt wird.  Der Nachrichtentext ist bereit.  Der n√§chste Schritt besteht darin, die Nachricht weiterzuleiten. Der Nachrichtentext √§ndert sich nicht. Daher erstellen wir die Variable dpvar_1 und speichern das Ergebnis darin.  Auf diese Variable verweisen wir auf die Eingabe f√ºr die Aktion Ergebnisse.  Speichern Sie die √Ñnderungen. <br><br><img src="https://habrastorage.org/webt/yz/cf/do/yzcfdogrjturkuvvmqx7bio_ex4.png"><br></li><li>  F√ºgen Sie eine Routing-Aktion hinzu und stellen Sie die folgenden Parameter ein.  Die Datei IIBURLRoute.xsl empf√§ngt die Werte von Kontextvariablen, von denen einige als Dienstanforderungsvariablen festgelegt sind, und bildet im √úbrigen den URI f√ºr die Anforderung an das Zielsystem, das auch in der Dienstvariablen gespeichert ist. <br><br><img src="https://habrastorage.org/webt/kl/vk/cf/klvkcfgcro60wznqwo0ibxdncys.png"><br></li><li>  Erstellen Sie auf √§hnliche Weise zwei weitere Regeln und speichern Sie alle √Ñnderungen: <br><ul><li>  Richtung: Server-Client, Name: IIBPolicy_rule_resp; <br>  Transformation: Input INPUT, Output PIPE, Transformationsdatei var: // context / IIB / ansTransform (Kontextvariable zum Ersetzen der Transformation der Antwort "on the fly"). </li><li>  Richtung: Fehler, Name: IIBPolicy_rule_error; <br>  Transformation: Eingabe NULL, Ausgabe PIPE, Transformationsdatei var: // context / IIB / errTransform (Kontextvariable, um die Fehlertransformation im laufenden Betrieb zu ersetzen). </li></ul><br></li><li>  Das endg√ºltige politische Ergebnis sollte folgenderma√üen aussehen: <br><img src="https://habrastorage.org/webt/qi/d9/7u/qid97ursvmwifemzxbfdtudjkjc.png"><br></li><li>  Die MPG-Erstellung ist abgeschlossen. Speichern Sie die √Ñnderungen. <br></li></ol><br><h2>  Teil 5. Testen </h2><br><h3>  5.1.  Vorbereitung </h3><br><ol><li>  Laden Sie beispielsweise das Dienstprogramm rfhutil zum Lesen und Schreiben von Nachrichten in die Warteschlange herunter. </li><li>  Testdateien befinden sich im Testordner des gleichen Verzeichnisses wie die Projektdateien. </li></ol><br><h3>  5.2.  Gesundheitscheck </h3><br><ol><li>  Senden Sie die Anfrage mit dem Dienstprogramm curl (f√ºr die unten stehende Anfrage sollte das aktuelle Verzeichnis mit example.json identisch sein). <br><br><pre> <code class="plaintext hljs">curl -vv -k "http://192.168.99.100:7170/dp/test/transformMessage" -H "Content-Type: application/json" --data-binary @example.json</code> </pre> <br></li><li>  √ñffnen Sie zwei Instanzen des Dienstprogramms rfhutil und subtrahieren Sie die Nachricht mit der ersten Instanz von der Warteschlange DP.IIB.REQIN. <br></li><li>  Gehen Sie zur Registerkarte MQMD und kopieren Sie die MessageID. <br></li><li>  √ñffnen Sie in der zweiten Instanz die Datei rs.xml auf der Registerkarte MQMD, f√ºgen Sie die Nachrichtenkennung in CorrelID ein und stellen Sie die Nachricht in die Warteschlange DP.IIB.RESIN. <br></li><li>  Sie sollten eine √§hnliche Antwort erhalten: <br><br><img src="https://habrastorage.org/webt/mn/kj/xj/mnkjxj0lyafkvo7hjgpyytuytee.png"><br></li><li>  Wiederholen Sie die Schritte 1-3. <br></li><li>      rs_error.xml       correllId; <br></li><li>     <br><br><img src="https://habrastorage.org/webt/_y/i5/hb/_yi5hbw1lnrfwsuryyln9z3rdic.png"><br></li></ol><br><h2>  6.  </h2><br><h3>  6.1.  Theorie </h3><br><p> Log Targets   ,         . <br></p><br><p>     Log Targets    .     ,      4     1000Kb,      .              2-4    .       ,        .  , DataPower,  , ,   ,        ,      ,      -  MPG,     . <br></p><br><h3>  6.2.  √úbe </h3><br><ol><li>    trunk; </li><li>    Log Target   ; </li><li>      : <br><ul><li> (IIB_LOG); </li><li> (File); </li><li>  (Text); </li><li>  timestamp(zulu); </li><li>   (logtemp:///IIB.log ‚Äî  IIBMPG); </li><li>  (1000). <br><img src="https://habrastorage.org/webt/ev/sm/mj/evsmmjxy8m6suwkbaeojvgcudf8.png"><br></li></ul><br></li><li>   .        MPG   IIBMPG. <br><br><img src="https://habrastorage.org/webt/lq/vl/5l/lqvl5lvc_w8powdnufq6emgjgwc.png"><br></li><li>    ,     ,    (  ,        ). <br><br><img src="https://habrastorage.org/webt/ia/tu/98/iatu98v3l0fioelwktk8uwu-6fw.png"><br></li><li>         ; <br></li><li>    ; <br></li><li>          . <br></li><li>      Log Targets    MPG. <br></li><li>   : <br><ul><li>             , ,         . <br><br><img src="https://habrastorage.org/webt/z2/ix/vt/z2ixvtjk8eidxsfbbe6mmfcecnc.png"><br></li><li>        . <br><br><img src="https://habrastorage.org/webt/go/ik/wl/goikwl1pdvlzhiyd_d7gqpffzo8.png"><br></li></ul><br></li></ol><br><h2>  7.  -    </h2><br><ol><li>       ‚Äì  ,   .    ‚Äì  ,   ,     -    . <br></li><li>      .       View Logs.      ,  ¬´  ¬ª, ¬´   ¬ª     . <br></li><li>       .           .       MPG       Show Probe -&gt; Enable Probe.         .   ,        . <br><br><img src="https://habrastorage.org/webt/re/6s/mh/re6smhejkm-i8cdmmeky6ch6cmy.png"><br></li><li>   ,      . <br></li></ol><br><p>     ‚Äì    . <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de442686/">https://habr.com/ru/post/de442686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de442676/index.html">Wohin Tr√§ume f√ºhren: Untergrund</a></li>
<li><a href="../de442678/index.html">Gr√∂√ütes Projekt in der Stereolithographie: Mammutskelett auf einem 3D-Drucker gedruckt</a></li>
<li><a href="../de442680/index.html">Mit sensorischen Ersatztechnologien k√∂nnen Sie die Welt mithilfe von Ger√§uschen sehen: Wie die Neuroplastizit√§t des menschlichen Gehirns funktioniert</a></li>
<li><a href="../de442682/index.html">Was Sie eingeben und wie Sie ein C ++ - Projekt zusammenstellen</a></li>
<li><a href="../de442684/index.html">Ausgewogene Site-Leistung. Teil 3: Inhalt</a></li>
<li><a href="../de442688/index.html">Scala-Datenanalyse - ein dringender Bedarf oder eine angenehme Gelegenheit?</a></li>
<li><a href="../de442690/index.html">Mondmission "Bereshit" - Selfie auf dem Hintergrund der Erde</a></li>
<li><a href="../de442692/index.html">Blockchain ohne Zwischenh√§ndler: Wie wir Wertpapiere an eine verteilte Registrierung gesendet haben</a></li>
<li><a href="../de442694/index.html">Einer der Streaming-Giganten startete in Indien und zog in einer Woche eine Million Nutzer an</a></li>
<li><a href="../de442696/index.html">S for Security: Internetsicherheit von Dingen und Berichten bei InoThings ++ 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>