<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§û üö∂üèæ üõèÔ∏è Sistema de ventilaci√≥n de la sala basado en "frambuesa" y "detector de CO2" üôçüèø üë©üèø‚Äçüíª üìÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La moda de los hogares inteligentes ha barrido todo Internet, ahora todos quieren hacer una bombilla que pueda apagarse a trav√©s de Internet o encende...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistema de ventilaci√≥n de la sala basado en "frambuesa" y "detector de CO2"</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dadget/blog/390859/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La moda de los hogares inteligentes ha barrido todo Internet, ahora todos quieren hacer una bombilla que pueda apagarse a trav√©s de Internet o encender un ventilador en el inodoro. </font><font style="vertical-align: inherit;">Mi experiencia fue bastante simple: quer√≠a hacer un sistema que pueda ventilar autom√°ticamente una habitaci√≥n, ni m√°s ni menos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de considerar el principio del sistema, llegu√© a algunas conclusiones, que decid√≠ implementar. </font><font style="vertical-align: inherit;">Seg√∫n lo planeado, toda la funcionalidad del sistema se divide en tres componentes: los "cerebros" que controlan todo, el sistema de ventilaci√≥n para abrir la ventana o encender el ventilador, y el sensor mismo que monitorea la calidad del aire en la habitaci√≥n. </font><font style="vertical-align: inherit;">A continuaci√≥n, hablar√© sobre el sensor de calidad del aire, m√°s un peque√±o toque sobre el tema de integrarlo con los "cerebros" de un hogar inteligente.</font></font><br>
<a name="habracut"></a><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Descripci√≥n del dispositivo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Decid√≠ controlar la calidad de la "frescura" del aire mediante la concentraci√≥n de di√≥xido de carbono. Los planes futuros incluyen el lanzamiento de sensores para amon√≠aco, propano / butano (fugas de gas), concentraciones de polvo en el aire, etc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se decidi√≥ colocar el sistema de ventilaci√≥n en una sala de estar donde una persona pasa el mayor tiempo posible. Probablemente, dicha habitaci√≥n es un dormitorio, y es all√≠ donde un sistema de ventilaci√≥n autom√°tica ser√° muy √∫til durante una noche de sue√±o. </font></font><br>
<br>
<img src="https://habrastorage.org/files/a25/543/468/a25543468c9b46439f7f570577cddd2b.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No es ning√∫n secreto que la concentraci√≥n de di√≥xido de carbono en el aire afecta fuertemente no solo la productividad del cerebro humano, el rendimiento humano, sino tambi√©n la capacidad de descansar bien. Cuanto mayor es la concentraci√≥n de CO2, peor.</font></font><br>
 <br>
 <img src="https://habrastorage.org/files/609/2dc/c2f/6092dcc2ff3340eea4c0727347a8f234.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El detector de di√≥xido de carbono de la compa√±√≠a Dadget se utiliz√≥ como dispositivo para medir la concentraci√≥n de di√≥xido de carbono. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este dispositivo puede recibir energ√≠a del puerto USB de una computadora o computadora port√°til. </font><font style="vertical-align: inherit;">En el panel frontal: indicador LCD, que muestra informaci√≥n sobre la concentraci√≥n de di√≥xido de carbono y la temperatura ambiente. </font><font style="vertical-align: inherit;">Tambi√©n hay 3 LED que le dan al usuario una representaci√≥n visual del contenido. </font><font style="vertical-align: inherit;">Todo es bastante simple: encienda el dispositivo. </font><font style="vertical-align: inherit;">Y todo funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Me atrajo el hecho de que hay un software que funciona con este dispositivo. </font><font style="vertical-align: inherit;">Hay software para Windows y Linux. </font><font style="vertical-align: inherit;">El c√≥digo fuente del programa para Linux est√° en github y parece haber sido escrito por nuestro compatriota. </font><font style="vertical-align: inherit;">Y si tiene el c√≥digo fuente, puede pensar en algo, modificarlo, "agudizar" el programa usted mismo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Resumen del flujo de trabajo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como lo demostraron la pr√°ctica y Google, la computadora ve el dispositivo como un dispositivo HID. Por lo tanto, en el programa para Windows hay un dll llamado HIDApi. Para trabajar con Linux, necesita la biblioteca HIDApi del mismo nombre. Finalic√© el c√≥digo fuente para el software de Linux y escrib√≠ un simple chirrido. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Est√° claro que usar una computadora Linux para leer datos del sensor y transferirlos a un controlador dom√©stico inteligente en alg√∫n lugar es una blasfemia. Por lo tanto, se decidi√≥ usar Raspbery pi con Debian puro instalado. En el futuro, se planea hacer todo en Arduino y transmitir a trav√©s de canales inal√°mbricos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El esquema de mi complejo de hardware y software es el siguiente:</font></font><br>
<br>
<img src="https://habrastorage.org/files/c83/600/997/c836009971eb43578523742643ed8002.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un lector experto y un geek √°vido podr√≠an pensar que no es muy deportivo usar HUB en este esquema. As√≠ es, puede conectar directamente un monitor de CO2 y disfrutar de la vida. Utilizando este esquema, resuelvo varios problemas a la vez: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚óè con mayor frecuencia, los cerebros de una casa inteligente no est√°n donde est√° el sensor; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚óè el uso de raspberry pi permite conectar sensores adicionales; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚óè colocando el sensor por separado, obtenemos dos m√©todos de indicaci√≥n, el primero en la pantalla del sensor, el segundo en el tel√©fono o a trav√©s de una p√°gina web, ya que los datos se transmiten al controlador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un dispositivo MicasaVerde se utiliza como un controlador dom√©stico inteligente, el dispositivo puede recopilar datos de sensores y tomar decisiones de acuerdo con un programa dado, que se denominan "escenas" en su terminolog√≠a.</font></font><br>
<br>
<img src="https://habrastorage.org/files/963/588/075/963588075d534090bab5100c83c1dfa7.png"><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el dispositivo, puede crear sensores virtuales y actualizar su informaci√≥n utilizando solicitudes http, lo que hice con raspberry pi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ejemplo de solicitud: </font></font><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip_address</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : 3480 / data_request? Id = variableset &amp; DeviceNum = 6 &amp; serviceId = urn: micasaverde-com: serviceId: DoorLock1 &amp; Variable = Status &amp; Value = 1 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es decir, Malinka lee los datos del detector de di√≥xido de carbono y luego transmite la solicitud http de datos a Vera. </font><font style="vertical-align: inherit;">El esquema es simple pero funciona.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Revisi√≥n de software</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entonces hay una "frambuesa", no importa qu√© versi√≥n, lo principal es que tiene una interfaz de red. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, debe instalar el soporte para dispositivos ocultos. Esta biblioteca est√° tomada de git, por lo que git debe instalarse en el "malink": </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
apt-get install libcurl4-gnutls-dev libexpat1-dev gettext libz-dev libssl-dev </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A continuaci√≥n, descargue e </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">instale la</font></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><br><font style="vertical-align: inherit;"></font><a href=""><font style="vertical-align: inherit;"></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> biblioteca </font><i><font style="vertical-align: inherit;">
clon </font></i><i><font style="vertical-align: inherit;">mkdir hidapi </font></i><i><font style="vertical-align: inherit;">
cd hidapi / </font></i><i><font style="vertical-align: inherit;">
git init </font></i><i><font style="vertical-align: inherit;">git. </font></i><i><a href=""><font style="vertical-align: inherit;">github.com/signal11/hidapi.git</font></a></i></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Bibliotecas adicionales </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo apt-get install libudev-dev libusb-1.0-0-dev libfox-1.6-dev autotools-dev autoconf automake libtool </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Instalar </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd hidapi / </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./bootstrap </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
./configure </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
sudo make instalar</font></font><br>
</i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Despu√©s de eso, descargue el c√≥digo fuente del programa de monitoreo de CO2 </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkdir co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
cd co2monitor </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git init </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
git clone </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github.com/dmage/co2mon.git</font></font></a></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
A continuaci√≥n, </font><i><a href=""><font style="vertical-align: inherit;">modifiqu√©</font></a></i><font style="vertical-align: inherit;"> un poco el c√≥digo del programa, en la versi√≥n inicial lee dos par√°metros (temperatura y co2) y lo env√≠a a la consola en un bucle sin fin . Esta opci√≥n no me conven√≠a, el objetivo era ejecutarla una vez y obtener el valor una vez, as√≠ que cambi√© dos l√≠neas en main.c. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Estamos buscando l√≠neas </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf ("CntR \ t% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Y cambie a </font></font><br>
<br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf (‚Äú% s \ n", buf); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
fflush (stdout); </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
exit (1);</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La primera l√≠nea es responsable de generar el valor, despu√©s del cambio, solo se mostrar√° el d√≠gito, y despu√©s de la salida, el programa se cerrar√°, la l√≠nea de salida (1) responder√°. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Compile </font></font><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
make</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Luego se escribi√≥ un script simple que inicia el programa, asigna los valores de salida del programa compilado anteriormente a una variable y luego pasa este valor usando curl a MicasaVerde. Despu√©s de eso, agregue la regla udev para que el sistema tenga acceso al sensor sin root. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
SUBSISTEMA == "usb", ATTR {idVendor} == "04d9", ATTR {idProduct} == "a052", MODE = "0666" </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y agregue el script de sondeo y transmisi√≥n a cron, cada minuto. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
crontab -e </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Y agrega la l√≠nea </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
* * * * * /home/pi/co2sender.sh </font></font><br>
<br>
<img src="https://habrastorage.org/files/2cb/23c/1b2/2cb23c1b202f4aa5aad89c8c70c69148.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El resultado del script</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, a√∫n debe configurar los archivos MicasaVerde para que haya registros adecuados en todas partes. </font><font style="vertical-align: inherit;">Pero funciona, r√°pido y f√°cil.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, tenemos un sistema basado en el </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Detector de CO2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , que funciona como de costumbre, analiza e informa sobre los cambios en la concentraci√≥n de di√≥xido de carbono. </font><font style="vertical-align: inherit;">Al mismo tiempo, Malinka lee los datos del sensor una vez por minuto y los transfiere al controlador del hogar inteligente, que puede encender el sistema de ventilaci√≥n si es necesario.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es390859/">https://habr.com/ru/post/es390859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es390845/index.html">Revisi√≥n de la tableta "termonuclear" de 8 pulgadas bb-mobile Topol 'LTE</a></li>
<li><a href="../es390849/index.html">Funcionarios de aduanas de EE. UU. Comienzan a tomar datos biom√©tricos de personas que cruzan la frontera de EE. UU. A pie</a></li>
<li><a href="../es390851/index.html">Uso pr√°ctico de ROS en la Raspberry Pi - Parte 3</a></li>
<li><a href="../es390853/index.html">En la mayor√≠a de los casos, los gerentes intentaron robar informaci√≥n confidencial de su propia empresa en 2015</a></li>
<li><a href="../es390855/index.html">La V√≠a L√°ctea se estudi√≥ en el rango submilim√©trico. Proyecto ATLASGAL completado</a></li>
<li><a href="../es390863/index.html">Video: transmisi√≥n de la actualizaci√≥n de la alineaci√≥n de Samsung Galaxy</a></li>
<li><a href="../es390865/index.html">SpaceX pospone el lanzamiento de SES-9 por segunda vez (upd: lanzado desde la quinta vez, fall√≥ el aterrizaje)</a></li>
<li><a href="../es390867/index.html">–ì–æ–º–µ–æ–ø–∞—Ç–∏—è: –∏–Ω–¥—É—Å—Ç—Ä–∏—è –ø–ª–∞—Ü–µ–±–æ —Å –º–∏–ª–ª–∏–∞—Ä–¥–Ω—ã–º–∏ –¥–æ—Ö–æ–¥–∞–º–∏</a></li>
<li><a href="../es390869/index.html">ASU Cast One - Smart Watch Projector debe estar a la venta en verano</a></li>
<li><a href="../es390871/index.html">Revisi√≥n del video del port√°til Asus Zenbook Pro UX501VW</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>