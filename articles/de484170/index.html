<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüé® üëú üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© Aktualisieren Sie Check Point von R77.30 auf 80.20 üëÇ üëêüèº üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Im Herbst 2019 unterst√ºtzte Check Point die R77.XX-Versionen nicht mehr und musste aktualisiert werden. √úber den Unterschied zwischen den Versionen, d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aktualisieren Sie Check Point von R77.30 auf 80.20</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/484170/"><img src="https://habrastorage.org/webt/iz/bu/-j/izbu-j4fcyoxpsga-spzdz-rujc.png"><br><br>  Im Herbst 2019 unterst√ºtzte Check Point die R77.XX-Versionen nicht mehr und musste aktualisiert werden.  √úber den Unterschied zwischen den Versionen, die Vor- und Nachteile des √úbergangs zum R80 wurde bereits viel gesprochen.  Lassen Sie uns dar√ºber sprechen, wie der Check Point der virtuellen Appliance (CloudGuard f√ºr VMware ESXi, Hyper-V, KVM-Gateway-NGTP) tats√§chlich aktualisiert wird und was schief gehen k√∂nnte. <br><br>  Wir hatten also 2 CCSE-Ingenieure, mehr als ein Dutzend virtueller Cluster, Check Point R77.30, mehrere Wolken, ein paar Hotfixes und eine Menge verschiedener Bugs, Pannen und so weiter, alle Farben und Gr√∂√üen und auch sehr enge Fristen.  Lass uns gehen! <br><blockquote>  <b>Inhalt:</b> <br><br>  <a href="https://habr.com/ru/company/dataline/blog/484170/">Vorbereitung</a> <br>  <a href="https://habr.com/ru/company/dataline/blog/484170/">Aktualisieren des Verwaltungsservers</a> <br>  <a href="https://habr.com/ru/company/dataline/blog/484170/">Aktualisieren des Clusters</a> <br></blockquote><br><img src="https://habrastorage.org/webt/ng/ow/ye/ngowyegpn17chzucgvdx_afc2ag.png"><br><br>  <i>So sieht eine typische Client-Cloud-Infrastruktur mit virtuellem Check Point aus</i> <br><a name="habracut"></a><br><a name="ONE"></a><h2>  Vorbereitung </h2><br>  Zun√§chst m√ºssen Sie pr√ºfen, ob die Ressourcen f√ºr das Update ausreichen.  Die empfohlenen Mindestanforderungen f√ºr R80.20 sehen jetzt so aus: <br><br><div class="scrollable-table"><table><tbody><tr><td>  Ger√§t <br></td><td>  CPU <br></td><td>  RAM <br></td><td>  HDD <br></td></tr><tr><td>  Sicherheitsgateway <br></td><td>  2 Kern <br></td><td>  4 gb <br></td><td>  Ab 15 GB <br></td></tr><tr><td>  SMS <br></td><td>  2 Kern <br></td><td>  6 gb <br></td><td>  - </td></tr></tbody></table></div><br>  <i>Empfehlungen sind in <a href="https://sc1.checkpoint.com/documents/R80.20_GA/WebAdminGuides/EN/CP_R80.20_RN/html_frameset.htm">CP_R80.20_GA_Release_Notes beschrieben</a> .</i> <br><br>  Aber wir werden realistisch sein.  Wenn dies in der minimalsten Konfiguration ausreicht, haben wir, wie die Praxis zeigt, normalerweise die https-Pr√ºfung aktiviert, SmartEvent funktioniert f√ºr SMS usw., was nat√ºrlich v√∂llig andere Kapazit√§ten erfordert.  Insgesamt aber nicht gr√∂√üer als beim R77.30. <br><br>  Aber es gibt Nuancen.  Dabei geht es vor allem um die Gr√∂√üe des physischen Ged√§chtnisses.  Viele Vorg√§nge direkt w√§hrend des Aktualisierungsvorgangs erfordern Festplattenspeicher. <br><br>  Bei einem Verwaltungsserver h√§ngt die Menge des freien Speicherplatzes sehr stark von der Menge der aktuellen Protokolle (wenn diese gespeichert werden sollen) und von der Anzahl der gespeicherten Datenbankrevisionen ab, obwohl sie nicht in gro√üem Umfang ben√∂tigt werden.  F√ºr Cluster-Knoten ist dies nat√ºrlich egal (es sei denn, Sie speichern Protokolle auch lokal).  So √ºberpr√ºfen Sie, ob Sie √ºber den richtigen Speicherplatz verf√ºgen: <br><br><ol><li>  Wir stellen √ºber ssh eine Verbindung zum Smart Management Server her, wechseln in den Expertenmodus und geben den folgenden Befehl ein: <br><br>  <b>[Experte @ cp-sms: 0] # df -h</b> </li><li>  Am Ausgang sehen wir so etwas wie diese Konfiguration: <br><br>  <b>Verwendete Dateisystemgr√∂√üe Verf√ºgbarkeit Verwendung% Aktiviert am</b> <b><br></b>  <b>/ dev / mapper / vg_splat-lv_current 30G 7.4G 21G 27% /</b> <b><br></b>  <b>/ dev / sda1 289 M 24 M 251 M 9% / boot</b> <b><br></b>  <b>tmpfs 2,0G 0 2,0G 0% / dev / shm</b> <b><br></b>  <b>/ dev / mapper / vg_splat-lv_log 243G 177G 53G 78% / var / log</b> </li><li>  Derzeit interessieren wir uns f√ºr den Abschnitt <b>/ var / log</b> </li></ol><br>  Beachten Sie, dass abh√§ngig von der Richtlinie zum Speichern und L√∂schen alter Protokolldateien sowie der Gr√∂√üe der exportierten Datenbank m√∂glicherweise mehr Speicherplatz erforderlich ist.  Wenn beim Erstellen des Archivs der freie Speicherplatz geringer wird als in der Richtlinie zum Speichern von Protokolldateien angegeben, l√∂scht das System die alten Protokolle und nimmt sie NICHT in das Archiv auf. <br><br>  F√ºr den eigentlichen Aktualisierungsvorgang ben√∂tigt das System mindestens 13 GB nicht zugewiesenen Speicherplatz auf der Festplatte.  Sie k√∂nnen das Vorhandensein mit dem folgenden Befehl √ºberpr√ºfen: <br><br>  <b>[Expert @ cp-sms: 0] # pvs</b> <br><br>  Wir werden ungef√§hr die folgende Schlussfolgerung sehen: <br><br>  <b>PV VG Fmt Attr PSize PFree</b> <b><br></b>  <b>/ dev / sda3 vg_splat lvm2 a-141.69G 43.69G</b> <br><br>  In diesem Fall haben wir 43 GB.  Es gibt genug Ressourcen.  Sie k√∂nnen mit der Aktualisierung beginnen. <br><br><a name="TWO"></a><h2>  Aktualisieren von Check Point SMS Management Server </h2><br>  Bevor Sie mit der Arbeit beginnen, gehen Sie wie folgt vor: <br><br><ol><li>  Installieren Sie das Migrationstools-Paket auf dem Verwaltungsserver.  Dazu m√ºssen Sie das Bild vom <a href="https://supportcenter.checkpoint.com/supportcenter/portal/role/supportcenterUser/page/default.psml/media-type/html%3Faction%3Dportlets.DCFileAction%255E_%255Eamp%255E_%255EeventSubmit_doGetdcdetails%3D%255E_%255Eamp%255E_%255Efileid%3D72085">Check Point-</a> Portal hochladen. </li><li>  Laden Sie das Archiv √ºber WinSCP im Ordner <b>/var/log/UpgradeR77.30_R80.20</b> auf den Verwaltungsserver <b>herunter</b> (erstellen Sie ggf. zuerst einen Ordner). </li><li>  Wir stellen √ºber SSH eine Verbindung zum Verwaltungsserver her und <b>wechseln</b> in den <b>Archivordner</b> : <b>cd /var/log/UpgradeR77.30_R80.20/</b> </li><li>  Entpacken Sie die Datei: <b>tar -zxvf ./ &lt;Dateiname&gt; .tgz</b> </li><li>  Wir starten das Dienstprogramm pre_upgrade_verifier mit dem folgenden Befehl: <b>./pre_upgrade_verifier -p $ FWDIR -c R77 -t R80.20</b> </li><li>  Nach Abschluss des Befehls wird ein Bericht √ºber inkompatible Einstellungen erstellt.  Es ist verf√ºgbar unter <b>/opt/CPsuite-R77/fw1/log/pre_upgrade_verification_report.(xls, html, txt).</b>  Es ist bequemer, es √ºber SCP zu entladen und √ºber den Browser zu schauen. <br>  Verwenden Sie <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk117237">SK117237,</a> um alle nicht kompatiblen Einstellungen zu <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk117237">entfernen</a> . </li><li>  F√ºhren Sie dann das Dienstprogramm pre_upgrade_verifier erneut aus, um sicherzustellen, dass alle Ursachen f√ºr die Inkompatibilit√§t behoben wurden. </li><li>  Als N√§chstes sammeln wir Informationen √ºber Netzwerkschnittstellen, die Routing-Tabelle und laden die GAIA-Konfiguration hoch: <br>  <b>ip a&gt; /var/log/UpgradeR77.30_R80.20/cp-sms-config.txt</b> <b><br></b>  <b>ip r&gt; /var/log/UpgradeR77.30_R80.20/cp-sms-config.txt</b> <b><br></b>  <b>Klicken Sie auf -c "Konfiguration anzeigen"&gt; /var/log/UpgradeR77.30_R80.20/cp-sms-config.txt</b> </li><li>  Laden Sie die empfangene Datei √ºber SCP hoch. </li><li>  Wir machen Snapshots auf der Ebene der Virtualisierung. </li><li>  Wir erh√∂hen das Timeout der SSH-Sitzung auf 8 Stunden.  So viel Gl√ºck: Abh√§ngig von der Gr√∂√üe der exportierten Basis kann dies einige Minuten bis einige Stunden dauern.  Daf√ºr: <br>  <b>[Expert @ HostName] # clish -c "Inaktivit√§ts-</b> Timeout anzeigen <b>"</b> Den aktuellen Timeout-Clish anzeigen. <br><br>  <b>[Expert @ HostName] # clish -c "set inactivity-timeout 720"</b> legt eine neue Zeit√ºberschreitung fest (in Minuten), <br><br>  <b>[Expert @ HostName] # echo $ TMOUT</b> den aktuellen Timeout-Expertenmodus anzeigen, <br><br>  <b>[Expert @ HostName] # export TMOUT = 3600 Geben Sie</b> einen neuen Timeout-Expertenmodus an (in Sekunden). Wenn Sie den Wert auf 0 setzen, wird das Timeout <b>deaktiviert</b> . </li><li>  Wir laden das SMS.iso-Installationsimage und h√§ngen es an die virtuelle Maschine an. <br><br>  Vergewissern Sie sich vor dem n√§chsten Schritt erneut, dass auf Ihrer Festplatte gen√ºgend nicht zugewiesener Speicherplatz vorhanden ist (ich erinnere Sie daran, dass Sie 13 GB ben√∂tigen). <br></li><li>  Bevor Sie mit dem Export der Konfiguration beginnen, √§ndern Sie die Protokolldatei mit dem Befehl: <b>fw logswitch</b> </li></ol><br>  <b>Konfiguration und Protokolle exportieren</b> <br><br><ol><li>  F√ºhren Sie das Dienstprogramm migrate_export aus, um die Konfiguration zu entladen.  <b>Wechseln</b> Sie dazu in den zuvor erstellten Ordner: <b>cd /var/log/UpgradeR77.30_R80.20/</b> und verwenden Sie den Befehl: <b>./migrate export -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> <br><br>  entweder <br><br>  <b>Wechseln</b> Sie in den Ordner: <b>cd $ FWDIR / bin / upgrade_tools /</b> und <br>  F√ºhren Sie den folgenden Befehl aus: <b>./migrate export -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> <br><br>  Wenn die exportierte Basis gro√ü ist, kann der Vorgang mehrere Stunden dauern. <br>  Trennen Sie die SSH-Sitzung w√§hrend des Vorgangs nicht. <br><br>  Dabei zeigt GAIA folgende Meldung an: <br><img src="https://habrastorage.org/webt/ca/za/b-/cazab-404a0urgpqe7g1vejfjta.png"><br>  Sie k√∂nnen sicher f√ºr Kaffee und Mittagessen gehen. <br><br>  Nachdem wir entweder eine Fehlermeldung wie diese sehen: <br><br><img src="https://habrastorage.org/webt/k0/v9/20/k0v920a3j-8z2pciapocj0bzhnk.png"><br><br>  Oder eine Nachricht √ºber den erfolgreichen Abschluss des Vorgangs: <br><br><img src="https://habrastorage.org/webt/jf/aj/nd/jfajnd1gn41wnuk-ipg2-vitgqe.png"><br><br>  Wenn der Vorgang bereits einige Stunden dauert, k√∂nnen Sie ihn √ºberpr√ºfen.  Richten Sie eine parallele Sitzung √ºber ssh ein, ohne die aktuelle Sitzung zu trennen, und geben Sie den Befehl <b>top ein.</b>  Unter den Prozessen sollte der <b>Migrationsprozess</b> angezeigt werden <b>.</b> <br><br>  Wenn Sie die SSH-Sitzung in keiner Weise trennen m√∂chten, verwenden Sie: <b>yes |</b>  <b>nohup ./migrate export -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> <br><br>  In diesem Fall k√∂nnen Sie die Sitzung trennen, es ist jedoch unpraktisch, den Fortschritt zu √ºberwachen: Sie m√ºssen den Abschluss des Vorgangs mit dem Befehl top √ºberpr√ºfen, und im Falle eines Problems wird keine Fehlermeldung angezeigt.  Daher empfehlen wir diese Option. </li><li>  Entfernen Sie die Pr√ºfsumme aus dem Archiv: <b>md5sum /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> </li><li>  Wir speichern den empfangenen Wert in einem Notizbuch. </li><li>  Wir verbinden uns per SCP mit SMS und laden das Archiv mit der Konfiguration auf die Workstation hoch.  Stellen Sie sicher, dass Sie die Datei√ºbertragung im Bin√§rformat verwenden. </li></ol><br>  <b>Exportieren Sie die SmartEvent-Datenbank</b> <br><br>  Hier ben√∂tigen wir eine vorinstallierte SMS-Version R80.  Jeder Test wird ausreichen. <br><br><ol><li>  F√ºr SMS ben√∂tigen wir ein Skript, das sich hier befindet: <b>$ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Laden <b>Sie</b> √ºber SCP das Skript <b>eva_db_backup.csh</b> in den Ordner: <b>/var/log/UpgradeR77.30_R80.20/</b> </li><li>  Wir verbinden uns via SSH mit SMS.  Kopieren Sie die Datei in den Ordner: <b>cp /var/log/UpgradeR77.30_R80.20/eva_db_backup.csh</b> <b><br></b>  <b>$ RTDIR / bin / eva_db_backup.csh</b> <br></li><li>  <b>√Ñndern Sie die</b> Codierung: <b>dos2unix $ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Besitzer <b>hinzuf√ºgen</b> : <b>chown -v admin: root $ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Berechtigungen <b>hinzuf√ºgen</b> : <b>chmod -v 0755 $ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Wir starten den Export der SmartEvent-Basis: <b>$ RTDIR / bin / eva_db_backup.csh</b> </li><li>  Wir laden die empfangenen Dateien √ºber SCP: <b>$ RTDIR / bin / &lt;Datum&gt; -db-backup.backup</b> und <b>$ RTDIR / bin / eventiaUpgrade.tar</b> auf die Workstation <b>hoch</b> . </li></ol><br>  <b>Update</b> <br><br><ol><li>  Gehen Sie zu <b>WebUI GAIA SMS ‚Üí CPUSE ‚Üí Alle Pakete anzeigen.</b> </li><li>  In dem Fall, dass CPUSE einen Connect Point-Cloud-Verbindungsfehler generiert, √ºberpr√ºfen wir die DGW-, DNS- und Proxy-Einstellungen. </li><li>  Wenn alles in Ordnung ist, der Fehler jedoch weiterhin auftritt, m√ºssen Sie CPUSE manuell aktualisieren, indem <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk92449%255E_%255Eamp%255E_%255Epartition%3DGeneral%255E_%255Eamp%255E_%255Eproduct%3DAll%2522">Sie</a> sich an <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk92449%255E_%255Eamp%255E_%255Epartition%3DGeneral%255E_%255Eamp%255E_%255Eproduct%3DAll%2522">sk92449 orientieren</a> . </li><li>  Laden Sie das Bild herunter und gehen Sie durch <b>Verifier.</b>  Beseitigen Sie gegebenenfalls Inkonsistenzen. <br><br>  Infolgedessen sollte diese Meldung angezeigt werden: <br><br><img src="https://habrastorage.org/webt/w3/ai/_w/w3ai_wdfusghwng1pwxls5l4aek.png"></li><li>  W√§hlen Sie <b>R80.20 Fresh Install and Upgrade f√ºr Security Management.</b> </li><li>  W√§hlen Sie bei der Installation des Updates die Option "Neuinstallation".  Nach der Installation wird das System neu gestartet. </li><li>  Wir bestehen den First Time <b>Wizard.</b> </li><li>  Nachdem wir Zugriff erhalten haben, √ºberpr√ºfen wir die Konten. </li><li>  Wir stellen √ºber SSH eine Verbindung zu SMS her und √§ndern unsere Benutzer-Shell in / bin / bash /: <br><br>  <b>setze Benutzer &lt;Benutzername&gt; shell / bin / bash /</b> <br><br>  <b>Speichere die Konfiguration</b> (falls wir bin / bash / als Standard-Shell lassen wollen und nach dem Neustart). </li><li>  Als n√§chstes verbinden wir uns √ºber SCP mit SMS und √ºbertragen im Bin√§rmodus das Archiv mit der Konfiguration <b>SMS_w_logs_export_r77_r80.tgz</b> in den Ordner <b>/var/log/UpgradeR77.30_R80.20/</b> <b><br></b> </li><li>  Wir entfernen die Pr√ºfsumme aus dem Archiv: <b>md5sum /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> und vergleichen sie mit dem vorherigen Wert.  Die Pr√ºfsumme muss √ºbereinstimmen. </li><li>  Wir erh√∂hen das Timeout der SSH-Sitzung auf 8 Stunden.  Daf√ºr: <br><br>  <b>[Expert @ HostName] # clish -c "Inaktivit√§ts-</b> Timeout anzeigen <b>"</b> Den aktuellen Timeout-Clish anzeigen. <br><br>  <b>[Expert @ HostName] # clish -c "set inactivity-timeout 720"</b> legt eine neue Zeit√ºberschreitung fest (in Minuten), <br><br>  <b>[Expert @ HostName] # echo $ TMOUT</b> den aktuellen Timeout-Expertenmodus anzeigen, <br><br>  <b>[Expert @ HostName] # export TMOUT = 3600 gibt</b> den neuen Timeout-Expertenmodus an (in Sekunden).  Wenn Sie den Wert auf 0 setzen, wird das Timeout deaktiviert. </li><li>  F√ºhren Sie zum Importieren der Einstellungen das Dienstprogramm zum Migrieren des Imports aus.  <b>Wechseln</b> Sie dazu in den Ordner: <b>cd $ FWDIR / bin / upgrade_tools /</b> und f√ºhren Sie den Import aus: <b>./migrate imp</b> <b><br></b>  <b>ort -l /var/log/UpgradeR77.30_R80.20/SMS_w_logs_export_r77_r80.tgz</b> </li></ol><br>  Genie√üe das Leben f√ºr die n√§chsten paar Stunden.  Trennen Sie die SSH-Sitzung w√§hrend des Vorgangs nicht.  Am Ende gibt der Migrationsprozess entweder eine Erfolgsmeldung oder einen Fehler zur√ºck. <br><br>  <b>Checkliste nach Updates</b> <br><br><ol><li>  Verf√ºgbarkeit von Ressourcen. </li><li>  SIC mit GW. </li><li>  Lizenzen  Wenn die Lizenzen falsch oder nicht in SMS angezeigt werden, f√ºhren Sie den Befehl <b>vsec_central_licence aus</b> , um die Lizenzen zu verteilen. </li><li>  Richtlinieneinstellung. </li></ol><br>  <b>SmartEvent-Datenbank importieren</b> <br><br><ol><li>  Aktivieren Sie das SmartEvent-Blade. </li><li>  Wir verbinden uns per WinSCP mit SMS und √ºbertragen im Bin√§rmodus die zuvor heruntergeladenen <b>Dateien</b> <b>&lt;date&gt; -db-backup.backup</b> und <b>eventiaUpgrade.tar</b> in den Ordner <b>/var/log/UpgradeR77.30_R80.20/</b> </li><li>  Wir starten das Skript mit dem Befehl: <b>$ RTDIR / bin / eventiaUpgrade.sh -upgrade /var/log/UpgradeR77.30_R80.20/eventiaUpgrade.tar</b> </li><li>  √úberpr√ºfen des Status: <b>watch -n 10 eventiaUpgrade.sh</b> </li><li>  √úberpr√ºfen Sie die Protokolle in SmartEvent.  <b>TRAUM!</b> </li></ol><br><a name="THREE"></a><h2>  Cluster Check Point GW aktualisieren (Aktiv / Backup) </h2><br>  <b>Vor Arbeitsbeginn</b> <br><br><ol><li>  Wir speichern die GAIA-Konfiguration von jedem Knoten des Clusters in eine Datei. Verwenden Sie dazu den Befehl: <b>clish -c "show configuration"&gt; ./ &lt;Dateiname&gt; .txt</b> </li><li>  Wir laden Dateien mit WinSCP hoch. </li><li>  Wir verbinden uns mit der WebUI beider Knoten und gehen zur Registerkarte <b>CPUSE ‚Üí Show all packages.</b> </li><li>  Wir finden das Service Pack f√ºr Version <b>R80.20 Fresh Install</b> , klicken Sie auf <b>Download.</b> </li><li>  Wir pr√ºfen, ob das CCP-Protokoll im <b>Broadcast-</b> Modus funktioniert, geben dazu den Befehl ein: <b>cphaprob -a if</b> <br>  Wenn der <b>Multicast-</b> Modus ausgew√§hlt ist, √§ndern Sie ihn mit dem Befehl: <b>cphaconf set_ccp broadcast</b> (der Befehl wird auf jedem Knoten ausgef√ºhrt). </li><li>  Stellen Sie die Ausfallzeit f√ºr die beteiligten Knoten in Ihrem √úberwachungssystem ein. </li><li>  Wir stellen sicher, dass auf der Virtualisierungsebene die Parameter <b>MAC Address Change</b> und <b>Forged Transmits</b> f√ºr das Synchronisierungsnetzwerk aktiviert sind. </li></ol><br>  <b>Update</b> <br><br><ol><li>  Wir verbinden uns √ºber ssh mit dem aktiven Knoten und f√ºhren den Befehl aus, um den Clusterstatus zu √ºberwachen: <b>watch -n 2 cphaprob stat</b> </li><li>  Wir kehren zu den WebUI-Stanby-Knoten auf der Registerkarte <b>CPUSE zur√ºck</b> und f√ºhren <b>Verifier</b> f√ºr das ausgew√§hlte <b>R80.20-Frischinstallationspaket aus</b> <b>.</b> </li><li>  Wir analysieren den Verifier-Bericht.  Wenn die Installation zul√§ssig ist, fahren Sie fort. </li><li>  W√§hlen Sie das Paket <b>R80.20 Fresh Install</b> und f√ºhren Sie <b>Upgrade aus</b> .  W√§hrend des Aktualisierungsprozesses wird das System neu gestartet.  GAIA-Einstellungen werden gespeichert.  Zum Zeitpunkt des Neustarts √ºberwachen wir den Status des Clusters.  Nach dem Laden sollte sich der Status des aktualisierten Knotens auf BEREIT √§ndern.  In einigen F√§llen hatten wir einen Moment, in dem ein noch nicht aktualisierter Knoten in den Status "Aktive Aufmerksamkeit" √ºberging und den Status des aktualisierten Knotens nicht mehr anzeigte.  Seien Sie nicht beunruhigt - diese Option ist auch g√ºltig. </li><li>  √ñffnen <b>Sie</b> nach Abschluss des Updates <b>SmartDashboard.</b> </li><li>  √ñffnen Sie das Cluster-Objekt und √§ndern Sie die Cluster-Version von R77.30 auf R80.20.  Klicken Sie auf OK.  Wenn beim Speichern der √Ñnderungen ein Fehler auftritt: <br>  <i>Ein interner Fehler ist aufgetreten.</i>  <i>(Code: 0x8003001D, Zugriff auf Datei f√ºr Schreibvorgang nicht m√∂glich),</i> <br>  <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk119973">Folgen Sie</a> der <a href="https://supportcenter.checkpoint.com/supportcenter/portal%3FeventSubmit_doGoviewsolutiondetails%3D%255E_%255Eamp%255E_%255Esolutionid%3Dsk119973">SK119973</a> .  Speichern Sie anschlie√üend die √Ñnderungen und klicken <b>Sie auf Richtlinie installieren.</b> </li><li>  Deaktivieren <b>Sie</b> in den Einstellungen den Parameter <b>F√ºr Gateway-Cluster. Wenn die Installation auf einem Cluster-Mitglied fehlschl√§gt, installieren Sie nicht auf diesem Cluster.</b> </li><li>  Wir legen eine Politik fest.  Das System gibt einen Fehler f√ºr den aktiven Knoten aus, der noch nicht aktualisiert wurde. </li><li>  Wir stellen √ºber ssh eine Verbindung zum aktualisierten Knoten her und f√ºhren den Befehl aus, um den Clusterstatus zu √ºberwachen: <b>watch -n 2 cphaprob stat</b> </li><li>  Wir stellen eine Verbindung zu den aktiven WebUI-Knoten her und <b>wechseln zur</b> Registerkarte <b>CPUSE ‚Üí Alle Pakete anzeigen.</b>  Wir finden das Service Pack f√ºr Version <b>R80.20 Fresh Install</b> , klicken Sie auf <b>Download.</b> </li><li>  Stellen Sie die Ausfallzeit f√ºr die beteiligten Knoten in Ihrem √úberwachungssystem ein. </li><li>  Wir kehren zu den aktiven WebUI-Knoten auf der Registerkarte <b>CPUSE zur√ºck</b> und f√ºhren <b>Verifier</b> f√ºr das ausgew√§hlte <b>R80.20-Frischinstallationspaket aus</b> <b>.</b> </li><li>  Wir analysieren den Verifier-Bericht.  Wenn die Installation zul√§ssig ist, fahren Sie fort. </li><li>  W√§hlen Sie das Paket <b>R80.20 Fresh Install</b> und f√ºhren Sie <b>Upgrade aus.</b>  W√§hrend des Aktualisierungsprozesses wird das System neu gestartet.  GAIA-Einstellungen werden gespeichert.  Zum Zeitpunkt des Neustarts √ºberwachen wir den Status des Clusters auf einem bereits aktualisierten Knoten.  Nach dem Neustart √§ndert sich der Clusterstatus auf dem aktualisierten Knoten von BEREIT in AKTIV. </li><li>  Starten Sie nach Abschluss des Aktualisierungsvorgangs SmartDashboard und installieren Sie die Richtlinie. </li></ol><br>  <b>Checkliste nach Updates</b> <br><br><ul><li>  Ereignisprotokolle in SmartLog, Status von VPN-Tunneln. </li><li>  GAIA-Einstellungen. </li><li>  Clusterwiederherstellung nach Testfailover. </li><li>  Lizenzen und Vertr√§ge.  Wenn die Lizenzen falsch angezeigt werden oder nicht in SMS angezeigt werden, f√ºhren Sie den Befehl aus.  vsec_central_licence f√ºr die Lizenzverteilung. </li><li>  CoreXL. </li><li>  SecureXL. </li><li>  Hotfix und CPinfo auf zwei Knoten. </li></ul><br>  <b>Fazit</b> <br><br>  Im Allgemeinen ist zu diesem Zeitpunkt alles - Sie haben aktualisiert. <br><br>  Unser gesamter Prozess dauerte im Durchschnitt 6 bis 12 Stunden, abh√§ngig von der Gr√∂√üe der exportierten Datenbanken.  Die Arbeit wurde f√ºr zwei N√§chte durchgef√ºhrt: eine zum Aktualisieren von SMS, die zweite f√ºr den Cluster. <br><br>  Es gab keine Verkehrsausf√§lle, obwohl wir alle oben genannten Fehler selbst √ºberpr√ºft haben. <br><br>  Nat√ºrlich k√∂nnen w√§hrend des Aktualisierungsvorgangs manchmal v√∂llig neue Schwierigkeiten auftreten, aber dies ist Check Point, und wie wir alle wissen, gibt es immer einen Hotfix! <br><br>  Viel Gl√ºck mit deinen rosa und rosa N√§chten und Updates! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de484170/">https://habr.com/ru/post/de484170/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de484154/index.html">Methode zur L√∂sung des Diophantingleichungssystems</a></li>
<li><a href="../de484160/index.html">Ausweichendes Talent: Russland verliert die besten IT-Experten</a></li>
<li><a href="../de484164/index.html">Die Geschichte der B√ºcher und die Zukunft der Bibliotheken</a></li>
<li><a href="../de484166/index.html">VVVVVV ??? VVVVVV !!! :)</a></li>
<li><a href="../de484168/index.html">Wir schreiben unsere Strategie f√ºr das virtuelle Scrollen von Angular CDK</a></li>
<li><a href="../de484172/index.html">Kontinuierliche Integration in Unity: Verk√ºrzung der Montagezeit und Einsparung von Ressourcen + Gewinnlinie als Geschenk</a></li>
<li><a href="../de484174/index.html">Castle trinkt unter "extremen" Bedingungen oder wie wir an der "DOZOR" Show teilgenommen haben</a></li>
<li><a href="../de484176/index.html">Implementieren der Statusvorlage in Unity</a></li>
<li><a href="../de484178/index.html">Intelligenter Ethernet-Switch f√ºr Planet Earth</a></li>
<li><a href="../de484180/index.html">Virtuelle Telefonanlage von Rostelecom: Was und wie kann √ºber die API geschehen?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>