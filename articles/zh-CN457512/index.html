<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸšŸ ğŸ”» ğŸ‘©ğŸ¿â€ğŸ¤â€ğŸ‘¨ğŸ» PostgreSQLç‰ˆæœ¬ä¹‹é—´çš„é€»è¾‘å¤åˆ¶ ğŸ¶ ğŸ‘ğŸ½ ğŸ¡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ‰å¤šç§æ›´æ–°PostgreSQLçš„æ–¹æ³•ï¼Œä½†æ˜¯æœ‰äº›æ–¹æ³•ä¼šå¯¼è‡´åœæœºã€‚ å¦‚æœè¦é¿å…åœæœºï¼Œè¯·æ ¹æ®æƒ…å†µä½¿ç”¨å¤åˆ¶è¿›è¡Œå‡çº§-é€»è¾‘æˆ–ç‰©ç†ï¼ˆæµå¼ï¼‰ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨PostgreSQLä¸­é€»è¾‘å¤åˆ¶å’Œç‰©ç†å¤åˆ¶ä¹‹é—´çš„åŒºåˆ«ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºå¦‚ä½•ä½¿ç”¨é€»è¾‘å¤åˆ¶æ¥æ›´æ–°ç‰ˆæœ¬ï¼ŒåŒæ—¶é¿å…åº”ç”¨ç¨‹åºåœæœºã€‚ ä¸‹ä¸€ç¯‡æ–‡ç« å°†è®¨è®ºç‰©ç†å¤åˆ¶...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PostgreSQLç‰ˆæœ¬ä¹‹é—´çš„é€»è¾‘å¤åˆ¶</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/457512/"><p><img src="https://habrastorage.org/webt/yl/pr/hs/ylprhs3ilpoukerjhyvwdnj6kmu.png"></p><br><p> æœ‰å¤šç§æ›´æ–°PostgreSQLçš„æ–¹æ³•ï¼Œä½†æ˜¯æœ‰äº›æ–¹æ³•ä¼šå¯¼è‡´åœæœºã€‚ å¦‚æœè¦é¿å…åœæœºï¼Œè¯·æ ¹æ®æƒ…å†µä½¿ç”¨å¤åˆ¶è¿›è¡Œå‡çº§-é€»è¾‘æˆ–ç‰©ç†ï¼ˆæµå¼ï¼‰ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨PostgreSQLä¸­é€»è¾‘å¤åˆ¶å’Œç‰©ç†å¤åˆ¶ä¹‹é—´çš„åŒºåˆ«ã€‚ ç„¶åï¼Œæˆ‘ä»¬å°†è¯¦ç»†è®¨è®ºå¦‚ä½•ä½¿ç”¨é€»è¾‘å¤åˆ¶æ¥æ›´æ–°ç‰ˆæœ¬ï¼ŒåŒæ—¶é¿å…åº”ç”¨ç¨‹åºåœæœºã€‚  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‹ä¸€ç¯‡æ–‡ç« å°†</a>è®¨è®ºç‰©ç†å¤åˆ¶ã€‚ </p><br><p> åœ¨å…ˆå‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡çº§PostgreSQLçš„</a>æ–¹æ³•ï¼ˆ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨pg_dumpall</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡çº§PostgreSQL</a>å’Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨pg_dump / pg_restoreå‡çº§PostgreSQL</a> ï¼‰ä½œä¸º<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å‡çº§æˆ–è¿ç§»æ—§PostgreSQLç‰ˆæœ¬</a>ç³»åˆ—çš„ä¸€éƒ¨åˆ†ã€‚ ä½†æ˜¯è¿™ä¸¤ç§æ–¹æ³•éƒ½ä¸èƒ½æ’é™¤åœæœºæ—¶é—´ã€‚ </p><a name="habracut"></a><br><h2 id="tipy-logicheskoy-replikacii"> é€»è¾‘å¤åˆ¶ç±»å‹ </h2><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®¨è®ºä¸¤ç§å¤åˆ¶ç±»å‹ï¼š </p><br><ul><li> ä½¿ç”¨å†…ç½®é€»è¾‘å¤åˆ¶åœ¨PostgreSQL 10å’Œ11ä¹‹é—´è¿›è¡Œå¤åˆ¶ã€‚ </li><li> ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pgologic</a>æ‰©å±•åœ¨PostgreSQL 9.4ï¼ˆæˆ–PG 11ä¹‹å‰ï¼‰å’ŒPostgreSQL 11ä¹‹é—´è¿›è¡Œ<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¤åˆ¶</a> ã€‚ </li></ul><br><p> ä¸ºäº†æœ€å¤§ç¨‹åº¦åœ°å‡å°‘åœæœºæ—¶é—´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤åˆ¶è¿›è¡Œå‡çº§ã€‚ å½“æ‰€æœ‰ç›¸å…³æ•°æ®éƒ½å¤åˆ¶åˆ°å¦ä¸€å°æœ€æ–°çš„PostgreSQLæœåŠ¡å™¨ä¸Šæ—¶ï¼Œæ‚¨åªéœ€å°†åº”ç”¨ç¨‹åºè½¬ç§»åˆ°æ–°æœåŠ¡å™¨ä¸Šï¼Œåœæœºæ—¶é—´æœ€å°‘ï¼Œå°½ç®¡å½“ç„¶ï¼Œè¿™å…¨éƒ½å–å†³äºåº”ç”¨ç¨‹åºå †æ ˆçš„å¤æ‚æ€§ã€‚ </p><br><p>  PostgreSQLä¸­çš„<strong>é€»è¾‘å¤åˆ¶</strong>å…è®¸ç”¨æˆ·æœ‰é€‰æ‹©åœ°å¤åˆ¶è¡¨å¹¶æ‰“å¼€å¤‡ä»½æœåŠ¡å™¨ä»¥è¿›è¡Œå†™æ“ä½œã€‚  PostgreSQLä¸­çš„<strong>ç‰©ç†å¤åˆ¶</strong>æ˜¯æŒ‰å—å®Œæˆçš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‘å¯¼ä¸­çš„æ¯ä¸ªæ•°æ®åº“éƒ½å°†å¤åˆ¶åˆ°å¤‡ä»½æœåŠ¡å™¨ï¼Œæ— æ³•è¿›è¡Œå†™æ“ä½œã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç§°ä¸ºç‰©ç†å¤åˆ¶<strong>æµ</strong> ã€‚ </p><br><p>åœ¨å¤‡ç”¨æœåŠ¡å™¨ä¸Šä½¿ç”¨é€»è¾‘å¤åˆ¶æ—¶ï¼Œå¯ä»¥å¯ç”¨æ¥è‡ªå¤šä¸ªä¸»æœåŠ¡å™¨çš„å¤åˆ¶ã€‚ åœ¨éœ€è¦å°†æ•°æ®ä»å¤šä¸ªPostgreSQLï¼ˆOLTPï¼‰æ•°æ®åº“å¤åˆ¶åˆ°å•ä¸ªPostgreSQLæœåŠ¡å™¨ä»¥è¿›è¡ŒæŠ¥å‘Šå’Œæ•°æ®å­˜å‚¨çš„æƒ…å†µä¸‹ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚ </p><br><p> é€»è¾‘å¤åˆ¶ä¼˜äºæµä¼ è¾“çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼Œä½¿ç”¨é€»è¾‘å¤åˆ¶ï¼Œæ‚¨å¯ä»¥å°†æ›´æ”¹ä»æ—§ç‰ˆæœ¬çš„PostgreSQLå¤åˆ¶åˆ°æ–°ç‰ˆæœ¬ã€‚ ä»…å½“ä¸»æœåŠ¡å™¨å’Œå¤‡ç”¨æœåŠ¡å™¨å…·æœ‰ç›¸åŒçš„ä¸»ç‰ˆæœ¬æ—¶ï¼Œæµå¤åˆ¶æ‰èµ·ä½œç”¨ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œå…¶ä»–ç‰ˆæœ¬ä¹Ÿåº”åŒ¹é…ã€‚ </p><br><h3 id="replikaciya-mezhdu-versiyami-postgresql-10-i-11"> åœ¨PostgreSQL 10å’Œ11ä¹‹é—´å¤åˆ¶ </h3><br><p> ä»PostgreSQL 10å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨é€»è¾‘å¤åˆ¶ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥è½»æ¾åœ°åœ¨PostgreSQL 11ä¸­å¤åˆ¶PostgreSQL 10æ•°æ®åº“ã€‚é€»è¾‘å¤åˆ¶ä½¿ç”¨å‘å¸ƒå’Œè®¢é˜…æ¨¡å‹ã€‚ æäº¤æ›´æ”¹çš„èŠ‚ç‚¹å°†æˆä¸ºå‘å¸ƒè€…ã€‚ è®¢é˜…è¿™äº›æ›´æ”¹çš„èŠ‚ç‚¹å°†æˆä¸ºè®¢æˆ·ã€‚ æ¯ä¸ªå‡ºç‰ˆç‰©å¯ä»¥æœ‰å¤šä¸ªè®¢é˜…ã€‚ </p><br><h3 id="publikaciya"> è¿‡å¸ </h3><br><p> å‘å¸ƒæ˜¯ç”±ä¸€ç»„è¡¨åˆ›å»ºçš„ä¸€ç»„æ›´æ”¹ã€‚ å®ƒç§°ä¸º<strong>å˜æ›´</strong> <strong>é›†</strong>æˆ–<strong>å¤åˆ¶é›†</strong> ã€‚ å‘å¸ƒåªèƒ½åŒ…å«è¡¨ï¼Œè€Œä¸èƒ½åŒ…å«å…¶ä»–å¯¹è±¡ã€‚ è¿™äº›è¡¨ä¸­çš„DMLå¯ä»¥å¤åˆ¶ï¼Œä½†DDLæ— æ³•å¤åˆ¶ã€‚ </p><br><p> åœ¨å‡ºç‰ˆç‰©ä¸­ï¼Œæ‚¨å¯ä»¥é€‰æ‹©è¦å¤åˆ¶çš„DMLç±»å‹ï¼šINSERTï¼ŒDELETEï¼ŒUPDATEæˆ–ALLã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œé€‰æ‹©å…¨éƒ¨ã€‚ è¯¥è¡¨å¿…é¡»å…·æœ‰ä¸€ä¸ªå‰¯æœ¬æ ‡è¯†ç¬¦ï¼Œä»¥ä¾¿å°†UPDATEå’ŒDELETEæ“ä½œå¤åˆ¶åˆ°è®¢é˜…æœåŠ¡å™¨ã€‚ å‰¯æœ¬æ ‡è¯†ç¬¦å¯å¸®åŠ©æ‚¨æŸ¥æ‰¾å·²æ›´æ–°æˆ–åˆ é™¤çš„è¡Œã€‚ </p><br><p> è¯¥è¡¨çš„ä¸»é”®æ˜¯é»˜è®¤å‰¯æœ¬æ ‡è¯†ç¬¦ã€‚ æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿æ ‡è¯†ç¬¦æˆä¸ºå…·æœ‰NOT NULLå€¼çš„å”¯ä¸€ç´¢å¼•ã€‚ å¦‚æœæ‚¨æ²¡æœ‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼ˆæ²¡æœ‰NO NULLå€¼ï¼‰ï¼Œè¯·å°†copy_identityè®¾ç½®ä¸ºFULLã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPostgresä½¿ç”¨æ•´ä¸ªå­—ç¬¦ä¸²ä½œä¸ºé”®ã€‚ ä½†è¿™ä¸æ˜¯å¾ˆåˆç†ã€‚ </p><br><p> å¦‚æœåœ¨æ‰§è¡ŒUPDATEæˆ–DELETEæ“ä½œåé»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰ä¸»é”®å’Œå‰¯æœ¬æ ‡è¯†ç¬¦çš„è¡¨æ·»åŠ åˆ°å‘å¸ƒï¼Œåˆ™å¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚ </p><br><h3 id="podpiska"> è®¢é˜…æ–¹å¼ </h3><br><p> è®¢æˆ·å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªå‡ºç‰ˆç‰©ã€‚ åœ¨æ·»åŠ è®¢é˜…ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²åœ¨è®¢é˜…è€…èŠ‚ç‚¹ä¸Šåˆ›å»ºå¤åˆ¶çš„è¡¨ã€‚ ä¸ºæ­¤ï¼Œä»…å°†æ–¹æ¡ˆä»å‘å¸ƒè€…è½¬å‚¨åˆ°è®¢é˜…è€…ã€‚ </p><br><h3 id="primer-logicheskoy-replikacii"> é€»è¾‘å¤åˆ¶ç¤ºä¾‹ </h3><br><p>  <strong>ä»¥ä¸‹ç¤ºä¾‹ä»…åœ¨PostgreSQLç‰ˆæœ¬10å’Œ11ä¹‹é—´æè¿°äº†é€»è¾‘å¤åˆ¶ã€‚</strong> </p><br><p> åœ¨å‘å¸ƒè€…ç½‘ç«™ä¸Šåˆ›å»ºå‡ºç‰ˆç‰©ã€‚ å°†æ‰€æœ‰æˆ–ä»…æŸäº›è¡¨æ·»åŠ åˆ°å‡ºç‰ˆç‰©ã€‚ </p><br><pre><code class="plaintext hljs">-- For adding ALL Tables in Database CREATE PUBLICATION percpub FOR ALL TABLES; -- For adding Selected Tables in Database CREATE PUBLICATION percpub FOR TABLE scott.employee scott.departments;</code> </pre> <br><p> åœ¨è®¢é˜…è€…ç«™ç‚¹ä¸Šï¼Œåˆ›å»ºå¯¹æ­¤å‡ºç‰ˆç‰©çš„è®¢é˜…ã€‚ å¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨åˆ›å»ºè®¢é˜…ä¹‹å‰ï¼Œå°†è¡¨è¿›è¡ŒDDLè½¬å‚¨åˆ°è®¢é˜…æœåŠ¡å™¨ã€‚ </p><br><pre> <code class="plaintext hljs">$ pg_dump -h publisher_server_ip -p 5432 -d percona -Fc -s -U postgres | pg_restore -d percona -h subscriber_node_ip -p 5432 -U postgres CREATE SUBSCRIPTION percsub CONNECTION 'host=publisher_server_ip dbname=percona user=postgres password=secret port=5432' PUBLICATION percpub;</code> </pre> <br><p> æ­¤å‘½ä»¤è¿˜å°†å¤åˆ¶è¡¨ä¸­çš„ç°æœ‰æ•°æ®ã€‚ å¦‚æœè¦ç¦ç”¨å¤åˆ¶ç°æœ‰æ•°æ®ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œå¹¶ä¸”ä»…å¤åˆ¶å¯¹å‘å¸ƒè€…çš„æ›´æ”¹ã€‚ </p><br><pre> <code class="plaintext hljs">CREATE SUBSCRIPTION percsub CONNECTION 'host=publisher_server_ip dbname=percona user=postgres password=oracle port=5432' PUBLICATION percpub WITH (copy_data = false);</code> </pre> <br><p> åœ¨å‘å¸ƒè€…èŠ‚ç‚¹ä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·Ÿè¸ªå¤åˆ¶ï¼š </p><br><pre> <code class="plaintext hljs">$ psql \x select * from pg_stat_replication;</code> </pre> <br><h3 id="replikaciya-mezhdu-postgresql-94-i-postgresql-11"> åœ¨PostgreSQL 9.4å’ŒPostgreSQL 11ä¹‹é—´å¤åˆ¶ </h3><br><p>  PostgreSQL 10ä¹‹å‰çš„ç‰ˆæœ¬è¯¥æ€ä¹ˆåŠï¼Ÿ å¯¹äºç‰ˆæœ¬9.4åˆ°11ï¼Œæœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ‰©å±•å<code>pglogical</code> ã€‚ ä½¿ç”¨pgologicï¼Œæ‚¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼å°†PostgreSQL 9.4å¤åˆ¶åˆ°PostgreSQL 11ã€‚ </p><br><p> ä»¥ä¸‹æ˜¯ä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">pgologic</a>æ‰©å±•ååœ¨PG 9.4å’ŒPG 11ä¹‹é—´è®¾ç½®å¤åˆ¶çš„ä¸€èˆ¬è¯´æ˜ã€‚ </p><br><p>  <strong>æ­¥éª¤1.å°†</strong> pgserver_94è§†ä¸ºå…·æœ‰PostgreSQL 9.4ä¸Šçš„percona_94æ•°æ®åº“çš„æºæœåŠ¡å™¨ã€‚ åˆ›å»ºä»¥ä¸‹æ‰©å±•åã€‚ <br> ä»£å· </p><br><pre> <code class="plaintext hljs">[pgserver_94:] $psql -d percona_94 -c "CREATE EXTENSION pglogical_origin" CREATE EXTENSION [pgserver_94:] $psql -d percona_94 -c "CREATE EXTENSION pglogical" CREATE EXTENSION</code> </pre> <br><p>  <strong>æ­¥éª¤2.</strong>ç°åœ¨ï¼Œå°†æ‰€æœ‰æˆ–éƒ¨åˆ†è¡¨æ·»åŠ åˆ°æ¨¡å¼æˆ–å‡ ä¸ªæ¨¡å¼ä¸­è¿›è¡Œå¤åˆ¶ã€‚ åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæ‚¨ä¼šçœ‹åˆ°é”™è¯¯ï¼Œå› ä¸ºå…¶ä¸­ä¸€ä¸ªè¡¨æ²¡æœ‰ä¸»é”®ã€‚ </p><br><pre> <code class="plaintext hljs">[pgserver_94:] $psql -d percona_94 psql (9.4.21) Type "help" for help. percona_94=# SELECT pglogical.create_node(node_name := 'provider1',dsn := 'host=192.168.0.24 port=5432 dbname=percona_94'); create_node ------------- 2976894835 (1 row) percona_94=# SELECT pglogical.replication_set_add_all_tables('default', ARRAY['public']); ERROR: table pgbench_history cannot be added to replication set default DETAIL: table does not have PRIMARY KEY and given replication set is configured to replicate UPDATEs and/or DELETEs HINT: Add a PRIMARY KEY to the table percona_94=# ALTER TABLE pgbench_history ADD PRIMARY KEY (tid,aid,delta); ALTER TABLE percona_94=# SELECT pglogical.replication_set_add_all_tables('default', ARRAY['public']); replication_set_add_all_tables -------------------------------- t (1 row)</code> </pre> <br><p>  <strong>æ­¥éª¤3.</strong>åœ¨è®¢æˆ·èŠ‚ç‚¹ä¸Šï¼Œå³PostgreSQL 11æ•°æ®åº“ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ã€‚ </p><br><pre> <code class="plaintext hljs">[pgserver_11:] $psql -d percona_11 psql (11.2) Type "help" for help. percona_11=# SELECT pglogical.create_node(node_name := 'subscriber1',dsn := 'host=127.0.0.1 port=5432 dbname=percona_11 password=secret'); create_node ------------- 330520249 (1 row) percona_11=# SELECT pglogical.create_subscription(subscription_name := 'subscription1',provider_dsn := 'host=192.168.0.24 port=5432 dbname=percona_94 password=secret'); create_subscription --------------------- 1763399739 (1 row)</code> </pre> <br><p>  <strong>æ­¥éª¤4.</strong>ç„¶åé€šè¿‡å‘å‡ ä¸ªè¡¨å‘é€è¯·æ±‚æ¥æ£€æŸ¥å¤åˆ¶çŠ¶æ€ï¼Œpgologicæ€»æ˜¯æ›´æ–°ï¼š </p><br><pre> <code class="plaintext hljs">percona_11=# select * from pglogical.local_sync_status; sync_kind | sync_subid | sync_nspname | sync_relname | sync_status | sync_statuslsn -----------+------------+--------------+------------------+-------------+---------------- f | 1763399739 | public | pgbench_accounts | r | 0/2EB7D48 f | 1763399739 | public | pgbench_history | r | 0/2EB7D48 f | 1763399739 | public | pgbench_tellers | r | 0/2EB7D48 f | 1763399739 | public | pgbench_branches | r | 0/2EB7D48 d | 1763399739 | | | r | 0/0 (5 rows) percona_11=# select * from pglogical.subscription; sub_id | sub_name | sub_origin | sub_target | sub_origin_if | sub_target_if | sub_enabled | sub_slot_name | sub_rep lication_sets | sub_forward_origins | sub_apply_delay ------------+---------------+------------+------------+---------------+---------------+-------------+----------------------------------------+---------------- -----------------------+---------------------+----------------- 1763399739 | subscription1 | 2976894835 | 330520249 | 2402836775 | 2049915666 | t | pgl_percona_11_provider1_subscription1 | {default,defaul t_insert_only,ddl_sql} | {all} | 00:00:00 (1 row)</code> </pre> <br><h3 id="vybor-pervichnogo-klyucha"> ä¸»é”®é€‰æ‹© </h3><br><p> åœ¨ç¬¬äºŒæ­¥ä¸­ï¼Œæ‚¨çœ‹åˆ°äº†å¦‚ä½•é€šè¿‡ä¸ºæ²¡æœ‰ä¸€ä¸ªè¡¨çš„ä¸»é”®åˆ›å»ºä¸»é”®çš„æ–¹å¼å°†æ‰€æœ‰è¡¨æ·»åŠ åˆ°å¤åˆ¶é›†ä¸­ã€‚ æˆ‘å¯èƒ½ä¸ºæ­¤è¡¨é€‰æ‹©äº†é”™è¯¯çš„ä¸»é”®ï¼Œä½†è¿™ä»…ç”¨äºæ¼”ç¤ºã€‚ é€‰æ‹©ä¸»é”®æ—¶ï¼Œè¯·ç¡®ä¿å®ƒæ˜¯æ­£ç¡®çš„ã€‚ å®ƒå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸åŒ…å«NULLå€¼çš„åˆ—ã€‚ å¦‚æœæ‰¾ä¸åˆ°æ­£ç¡®çš„ä¸»é”®ï¼Œåˆ™å¯èƒ½å¯¼è‡´åº”ç”¨ç¨‹åºåœæœºã€‚ è¿™æ˜¯å¯èƒ½å‘ç”Ÿçš„ç¤ºä¾‹é”™è¯¯ï¼š </p><br><pre> <code class="plaintext hljs">[pgserver_94:] $pgbench -c 10 -T 300 -n percona_94 Client 7 aborted in state 12: ERROR: duplicate key value violates unique constraint "pgbench_history_pkey" DETAIL: Key (tid, aid, delta)=(7, 63268, 2491) already exists.</code> </pre> <br><p> è¿™æ˜¯ä½¿ç”¨pgologicåœ¨æ—§ç‰ˆæœ¬å’Œæ–°ç‰ˆæœ¬PostgreSQLä¹‹é—´åˆ›å»ºå¤åˆ¶çš„æ–¹æ³•ã€‚ è®¾ç½®å¤åˆ¶åï¼Œåªéœ€å°†åº”ç”¨ç¨‹åºåˆ‡æ¢åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä»¥ä½¿åœæœºæ—¶é—´æœ€å°‘ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN457512/">https://habr.com/ru/post/zh-CN457512/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN457490/index.html">æ‰å…‹ä¼¯æ ¼çš„Aisioshechka-ç®€è¦ä»‹ç»å¤©ç§¤åº§æ¡ˆä»¶</a></li>
<li><a href="../zh-CN457496/index.html">â€œæ‰¾åˆ°äº”ä¸ªå·®å¼‚ã€‚â€ å¯æ‰©å±•æ€§å’Œä¸–ä»£å·®å¼‚-æ–°ä¸€æ‰¹æµ‹è¯•</a></li>
<li><a href="../zh-CN457500/index.html">æˆ‘ä»¬å¦‚ä½•ä¸ºæœåŠ¡ç«™è¿›è¡Œè‡ªåŠ¨é©¾é©¶</a></li>
<li><a href="../zh-CN457508/index.html">è‚²å„¿ä¸æœºå™¨å­¦ä¹ ï¼šæ¯”è¾ƒå¹´è½»çš„æ¯äº²</a></li>
<li><a href="../zh-CN457510/index.html">ä½¿ç”¨mcrouteræ¥æ°´å¹³æ‰©å±•memcached</a></li>
<li><a href="../zh-CN457514/index.html">å†…ä¸‡æ ¼</a></li>
<li><a href="../zh-CN457516/index.html">ç¼–å†™å¨èƒæ¨¡å‹</a></li>
<li><a href="../zh-CN457518/index.html">ç­‰ç¦»å­ç°é‡‘é“¾ä½œä¸ºè§£å†³åŒºå—é“¾å¯æ‰©å±•æ€§éš¾é¢˜çš„è§£å†³æ–¹æ¡ˆ</a></li>
<li><a href="../zh-CN457522/index.html">æé«˜æ‚¨çš„é‚®ä»¶åˆ—è¡¨æœåŠ¡æˆ–ä½¿ç”¨ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Ÿ æˆ‘åœ¨UniSenderäº”å¹´æ¥å­¦åˆ°çš„ä¸œè¥¿</a></li>
<li><a href="../zh-CN457524/index.html">æ·±åº¦ç›¸æœº-é™éŸ³æ—‹è½¬ï¼ˆå½“æœºå™¨äººå¯ä»¥çœ‹åˆ°æ—¶ï¼‰ç¬¬1éƒ¨åˆ†</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>