<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë£ üèº üë∂üèΩ Cara mengatur PVS-Studio di Travis CI menggunakan contoh emulator konsol game PSP üë¨ üôçüèæ ‚õπüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Travis CI adalah layanan web terdistribusi untuk membangun dan menguji perangkat lunak yang menggunakan GitHub sebagai layanan hosting kode sumber. Se...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara mengatur PVS-Studio di Travis CI menggunakan contoh emulator konsol game PSP</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/464641/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/622/289/29e/62228929e341faee94fa7a2084abb6bb.png" alt="PPSSPP"></div><br>  Travis CI adalah layanan web terdistribusi untuk membangun dan menguji perangkat lunak yang menggunakan GitHub sebagai layanan hosting kode sumber.  Selain skrip di atas, Anda dapat menambahkan skrip Anda sendiri, berkat opsi konfigurasi yang luas.  Pada artikel ini kita akan mengatur Travis CI untuk bekerja dengan PVS-Studio dengan contoh kode PPSSPP. <br><a name="habracut"></a><br><h2>  Pendahuluan </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Travis CI</a> adalah layanan web untuk membangun dan menguji perangkat lunak.  Biasanya digunakan dalam kombinasi dengan praktik integrasi berkelanjutan. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PPSSPP</a> adalah emulator konsol game PSP.  Program ini mampu meniru peluncuran game apa pun dengan gambar cakram yang dirancang untuk Sony PSP.  Program ini dirilis pada 1 November 2012. PPSSPP didistribusikan di bawah lisensi GPL v2.  Siapa pun dapat melakukan perbaikan pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kode sumber</a> proyek. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio</a> - penganalisa kode statis untuk mencari kesalahan dan potensi kerentanan dalam kode program.  Pada artikel ini, kami akan meluncurkan PVS-Studio di cloud alih-alih secara lokal di komputer pengembang untuk berbagai tujuan dan akan mencari kesalahan di PPSSPP. <br><br><h2>  Travis ci mengatur </h2><br>  Kami akan membutuhkan repositori di GitHub di mana proyek yang kami butuhkan berada, serta kunci untuk PVS-Studio (Anda bisa mendapatkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kunci percobaan</a> atau yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gratis untuk proyek-proyek Sumber Terbuka</a> ). <br><br>  Mari kita pergi ke situs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Travis CI</a> .  Setelah otorisasi dengan bantuan akun GitHub, kami akan memiliki daftar repositori: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/52c/7ee/2c4/52c7ee2c426d0700d2f80e6a2081d344.png"></div><br><br>  Untuk pengujian, saya membuat garpu PPSSPP. <br><br>  Kami mengaktifkan repositori yang ingin kami bangun: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/615/ec9/200/615ec9200b31f85474f6a443bb9755c5.png"></div><br><br>  Saat ini, Travis CI tidak dapat membangun proyek kami karena tidak ada instruksi untuk membangunnya.  Itu sebabnya saatnya untuk konfigurasi. <br><br>  Selama analisis kita akan memerlukan beberapa variabel, misalnya, kunci untuk PVS-Studio, yang tidak diinginkan untuk ditentukan dalam file konfigurasi.  Jadi, mari kita tambahkan variabel lingkungan dengan mengkonfigurasi build di Travis CI: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e7/f4f/a27/8e7f4fa27ce4f7ac89dd5f0b330762f6.png"></div><br><br>  Kami akan membutuhkan: <br><br><ul><li>  PVS_USERNAME - nama pengguna </li><li>  PVS_KEY - kunci </li><li>  MAIL_USER - email yang akan digunakan untuk mengirim laporan </li><li>  MAIL_PASSWORD - kata sandi email </li></ul><br>  Dua yang terakhir adalah opsional.  Mereka akan digunakan untuk mengirim hasilnya melalui surat.  Jika Anda ingin mengirim laporan dengan cara lain, Anda tidak perlu menentukannya. <br><br>  Jadi, kami telah menambahkan variabel lingkungan yang kami butuhkan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5f6/c83/158/5f6c83158ee2e9bba6b6cba0d579cf3d.png"></div><br>  Sekarang mari kita membuat file <i>.travis.yml</i> dan meletakkannya di root proyek.  PPSSPP sudah memiliki file konfigurasi untuk Travis CI, namun itu terlalu besar dan tidak cocok untuk contoh, jadi kami harus menyederhanakannya dan hanya menyisakan elemen dasar. <br><br>  Pertama, mari kita tentukan bahasa pemrograman, versi Ubuntu Linux yang ingin kita gunakan pada mesin virtual, dan paket yang diperlukan untuk membangun: <br><br><pre><code class="plaintext hljs">language: cpp dist: xenial addons: apt: update: true packages: - ant - aria2 - build-essential - cmake - libgl1-mesa-dev - libglu1-mesa-dev - libsdl2-dev - pv - sendemail - software-properties-common sources: - sourceline: 'ppa:ubuntu-toolchain-r/test' - sourceline: 'ppa:ubuntu-sdk-team/ppa'</code> </pre> <br>  Semua paket tambahan hanya diperlukan untuk PPSSPP. <br><br>  Sekarang tentukan matriks bangunan: <br><br><pre> <code class="plaintext hljs">matrix: include: - os: linux compiler: "gcc" env: PPSSPP_BUILD_TYPE=Linux PVS_ANALYZE=Yes - os: linux compiler: "clang" env: PPSSPP_BUILD_TYPE=Linux</code> </pre> <br>  Sedikit lebih banyak tentang bagian <i>matriks</i> .  Di Travis CI ada dua cara untuk membuat opsi membangun: yang pertama adalah menentukan kompiler, jenis sistem operasi, variabel lingkungan dll.  dengan daftar, setelah itu matriks semua kombinasi yang mungkin akan dihasilkan;  yang kedua adalah indikasi eksplisit dari matriks.  Tentu saja, Anda dapat menggabungkan kedua pendekatan ini dan menambahkan kasus unik, atau, sebaliknya, mengecualikannya dengan menggunakan bagian <i>mengecualikan</i> .  Anda dapat membaca lebih lanjut tentang ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi Travis CI</a> . <br><br>  Satu-satunya hal yang harus dilakukan adalah menentukan instruksi pembangunan spesifik proyek: <br><br><pre> <code class="plaintext hljs">before_install: - travis_retry bash .travis.sh travis_before_install install: - travis_retry bash .travis.sh travis_install script: - bash .travis.sh travis_script after_success: - bash .travis.sh travis_after_success</code> </pre> <br>  Travis CI memungkinkan Anda untuk menambahkan perintah Anda sendiri untuk berbagai tahap kehidupan mesin virtual.  Bagian <i>before_install</i> berjalan sebelum menginstal paket.  Kemudian <i>instal</i> , yang mengikuti instalasi paket dari daftar <i>addons.apt</i> yang telah kami tentukan di atas.  Build itu sendiri terjadi dalam <i>skrip</i> .  Jika semuanya telah berhasil, kita masuk ke <i>after_success</i> (di sinilah kita akan memulai analisis statis).  Ini bukan semua langkah yang dapat Anda modifikasi, jika Anda membutuhkan lebih banyak, Anda harus melihat dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi tentang Travis CI</a> . <br><br>  Untuk kenyamanan membaca perintah dimasukkan ke dalam <i>skrip</i> terpisah <i>.travis.sh</i> , yang ditempatkan di root proyek. <br><br>  Jadi, kami memiliki file berikut <i>.travis.yml</i> : <br><br><pre> <code class="plaintext hljs">language: cpp dist: xenial addons: apt: update: true packages: - ant - aria2 - build-essential - cmake - libgl1-mesa-dev - libglu1-mesa-dev - libsdl2-dev - pv - sendemail - software-properties-common sources: - sourceline: 'ppa:ubuntu-toolchain-r/test' - sourceline: 'ppa:ubuntu-sdk-team/ppa' matrix: include: - os: linux compiler: "gcc" env: PVS_ANALYZE=Yes - os: linux compiler: "clang" before_install: - travis_retry bash .travis.sh travis_before_install install: - travis_retry bash .travis.sh travis_install script: - bash .travis.sh travis_script after_success: - bash .travis.sh travis_after_success</code> </pre> <br>  Sebelum menginstal paket, mari kita perbarui submodules.  Ini diperlukan untuk membangun PPSSPP.  Tambahkan fungsi pertama ke <i>.travis.sh</i> (perhatikan ekstensi): <br><br><pre> <code class="plaintext hljs">travis_before_install() { git submodule update --init --recursive }</code> </pre> <br>  Sekarang kami datang langsung untuk menyiapkan peluncuran otomatis PVS-Studio di Travis CI.  Pertama, kita perlu menginstal paket PVS-Studio ke dalam sistem: <br><br><pre> <code class="plaintext hljs">travis_install() { if [ "$CXX" = "g++" ]; then sudo apt-get install -qq g++-4.8 fi if [ "$PVS_ANALYZE" = "Yes" ]; then wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update -qq sudo apt-get install -qq pvs-studio \ libio-socket-ssl-perl \ libnet-ssleay-perl fi download_extract \ "https://cmake.org/files/v3.6/cmake-3.6.2-Linux-x86_64.tar.gz" \ cmake-3.6.2-Linux-x86_64.tar.gz }</code> </pre> <br>  Pada awal fungsi <i>travis_install</i> kita menginstal kompiler yang kita perlukan menggunakan variabel lingkungan.  Kemudian, jika variabel <i>$ PVS_ANALYZE</i> menyimpan nilai <i>Ya</i> (kami tentukan di bagian <i>env</i> ketika mengkonfigurasi matriks build), kami menginstal paket <i>pvs-studio</i> .  Selain itu, ada juga paket <i>libio-socket-ssl-perl</i> dan <i>libnet-ssleay-perl</i> , tetapi mereka diperlukan untuk mengirim hasilnya melalui surat, jadi mereka tidak perlu jika Anda memilih cara lain untuk pengiriman laporan. <br><br>  Fungsi download_extract mengunduh dan membongkar arsip yang ditentukan: <br><br><pre> <code class="plaintext hljs">download_extract() { aria2c -x 16 $1 -o $2 tar -xf $2 }</code> </pre> <br>  Saatnya membangun proyek.  Ini terjadi di bagian <i>skrip</i> : <br><br><pre> <code class="plaintext hljs">travis_script() { if [ -d cmake-3.6.2-Linux-x86_64 ]; then export PATH=$(pwd)/cmake-3.6.2-Linux-x86_64/bin:$PATH fi CMAKE_ARGS="-DHEADLESS=ON ${CMAKE_ARGS}" if [ "$PVS_ANALYZE" = "Yes" ]; then CMAKE_ARGS="-DCMAKE_EXPORT_COMPILE_COMMANDS=On ${CMAKE_ARGS}" fi cmake $CMAKE_ARGS CMakeLists.txt make }</code> </pre> <br>  Sebenarnya, ini adalah konfigurasi asli yang disederhanakan, kecuali untuk baris-baris ini: <br><br><pre> <code class="plaintext hljs">if [ "$PVS_ANALYZE" = "Yes" ]; then CMAKE_ARGS="-DCMAKE_EXPORT_COMPILE_COMMANDS=On ${CMAKE_ARGS}" fi</code> </pre> <br>  Di bagian kode ini, kita menetapkan flag ekspor perintah kompilasi untuk <i>cmake</i> .  Ini diperlukan untuk penganalisa kode statis.  Anda dapat membaca lebih lanjut tentang hal ini di artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Cara meluncurkan PVS-Studio di Linux dan macOS</a> ". <br><br>  Jika build berhasil, kita akan sampai ke <i>after_success</i> tempat kita akan menjalankan analisis statis: <br><br><pre> <code class="plaintext hljs">travis_after_success() { if [ "$PVS_ANALYZE" = "Yes" ]; then pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic \ -o PVS-Studio-${CC}.log \ --disableLicenseExpirationCheck plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html sendemail -t mail@domain.com \ -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" \ -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" \ -s smtp.gmail.com:587 \ -xu $MAIL_USER \ -xp $MAIL_PASSWORD \ -o tls=yes \ -f $MAIL_USER \ -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html fi }</code> </pre> <br>  Mari kita perhatikan baris berikut secara rinci: <br><br><pre> <code class="plaintext hljs">pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic \ -o PVS-Studio-${CC}.log \ --disableLicenseExpirationCheck plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html</code> </pre> <br>  Baris pertama menghasilkan file lisensi dari nama pengguna dan kunci yang kami tentukan di awal konfigurasi variabel lingkungan Travis CI. <br><br>  Baris kedua memulai analisis secara langsung.  Flag <i>-j &lt;N&gt;</i> menetapkan jumlah utas analisis, flag <i>-l &lt;file&gt;</i> menetapkan lisensi, flag <i>-o &lt;file&gt;</i> mengatur file untuk menampilkan log, dan flag - <i>disableLicenseExpirationCheck</i> diperlukan untuk versi percobaan , karena secara default <i>pvs-studio-analyzer</i> akan memperingatkan pengguna tentang berakhirnya lisensi.  Untuk mencegah hal ini terjadi, Anda dapat menentukan bendera ini. <br><br>  File log berisi output yang tidak diproses yang tidak dapat dibaca tanpa konversi, jadi pertama-tama Anda harus membuat file tersebut dapat dibaca.  Mari kita jalankan log melalui <i>plog-converter</i> dan dapatkan file html di output. <br><br>  Dalam contoh ini saya memutuskan untuk mengirim laporan melalui surat menggunakan perintah <i>sendemail</i> . <br><br>  Hasilnya adalah <i>file .travis.sh</i> berikut: <br><br><pre> <code class="plaintext hljs">#/bin/bash travis_before_install() { git submodule update --init --recursive } download_extract() { aria2c -x 16 $1 -o $2 tar -xf $2 } travis_install() { if [ "$CXX" = "g++" ]; then sudo apt-get install -qq g++-4.8 fi if [ "$PVS_ANALYZE" = "Yes" ]; then wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update -qq sudo apt-get install -qq pvs-studio \ libio-socket-ssl-perl \ libnet-ssleay-perl fi download_extract \ "https://cmake.org/files/v3.6/cmake-3.6.2-Linux-x86_64.tar.gz" \ cmake-3.6.2-Linux-x86_64.tar.gz } travis_script() { if [ -d cmake-3.6.2-Linux-x86_64 ]; then export PATH=$(pwd)/cmake-3.6.2-Linux-x86_64/bin:$PATH fi CMAKE_ARGS="-DHEADLESS=ON ${CMAKE_ARGS}" if [ "$PVS_ANALYZE" = "Yes" ]; then CMAKE_ARGS="-DCMAKE_EXPORT_COMPILE_COMMANDS=On ${CMAKE_ARGS}" fi cmake $CMAKE_ARGS CMakeLists.txt make } travis_after_success() { if [ "$PVS_ANALYZE" = "Yes" ]; then pvs-studio-analyzer credentials $PVS_USERNAME $PVS_KEY -o PVS-Studio.lic pvs-studio-analyzer analyze -j2 -l PVS-Studio.lic \ -o PVS-Studio-${CC}.log \ --disableLicenseExpirationCheck plog-converter -t html PVS-Studio-${CC}.log -o PVS-Studio-${CC}.html sendemail -t mail@domain.com \ -u "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" \ -m "PVS-Studio $CC report, commit:$TRAVIS_COMMIT" \ -s smtp.gmail.com:587 \ -xu $MAIL_USER \ -xp $MAIL_PASSWORD \ -o tls=yes \ -f $MAIL_USER \ -a PVS-Studio-${CC}.log PVS-Studio-${CC}.html fi } set -e set -x $1;</code> </pre> <br>  Saatnya untuk menambahkan perubahan ke repositori git, dan kemudian Travis CI akan secara otomatis memulai pembuatan.  Klik "ppsspp" untuk membuat laporan: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/705/1e1/7d8/7051e17d8fc919dd7801679b6815e8e1.png"></div><br>  Kami akan melihat gambaran umum bangunan saat ini: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/434/49e/fc3/43449efc3a67070eb47d9603a4c05bb6.png"></div><br><br>  Jika build berhasil diselesaikan, kami akan menerima email dengan hasil analisis statis.  Tentu saja, mengirim melalui surat bukan satu-satunya cara untuk mendapatkan laporan.  Anda dapat memilih metode implementasi apa pun.  Tetapi penting untuk diingat bahwa tidak mungkin mendapatkan akses ke file mesin virtual setelah pembangunan selesai. <br><br><h2>  Tinjauan singkat kesalahan </h2><br>  Kami telah berhasil menyelesaikan bagian yang paling sulit.  Mari kita sekarang memastikan bahwa semua upaya kita telah dibenarkan.  Mari kita pertimbangkan beberapa poin menarik dari laporan analisis statis yang datang kepada saya melalui surat (bukan apa-apa yang saya tentukan). <br><br><h3>  Optimalisasi berbahaya </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sha1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *input, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ilen, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> output[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20</span></span></span></span><span class="hljs-function"><span class="hljs-params">] )</span></span></span><span class="hljs-function"> </span></span>{ sha1_context ctx; sha1_starts( &amp;ctx ); sha1_update( &amp;ctx, input, ilen ); sha1_finish( &amp;ctx, output ); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>( &amp;ctx, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>( sha1_context ) ); }</code> </pre> <br>  Peringatan PVS-Studio: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V597</a> Kompiler dapat menghapus panggilan fungsi 'memset', yang digunakan untuk membersihkan buffer 'sum'.  Fungsi RtlSecureZeroMemory () harus digunakan untuk menghapus data pribadi.  sha1.cpp 325 <br><br>  Fragmen kode ini terletak di modul hashing aman, tetapi berisi cacat keamanan serius ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-14</a> ).  Mari kita pertimbangkan daftar assembler yang dihasilkan ketika versi Debug mengkompilasi: <br><br><pre> <code class="plaintext hljs">; Line 355 mov r8d, 20 xor edx, edx lea rcx, QWORD PTR sum$[rsp] call memset ; Line 356</code> </pre> <br>  Semuanya baik-baik saja dan fungsi <i>memset</i> dijalankan, sehingga menghapus data penting dalam RAM, tetapi Anda tidak harus senang lagi.  Mari kita pertimbangkan daftar assembler dari versi Rilis dengan optimisasi: <br><pre> <code class="plaintext hljs">; 354 : ; 355 : memset( sum, 0, sizeof( sum ) ); ; 356 :}</code> </pre> <br>  Seperti yang dapat Anda lihat dari daftar, kompiler mengabaikan panggilan <i>memset</i> .  Ini terkait dengan fakta bahwa fungsi <i>sha1</i> tidak lagi memanggil struktur <i>ctx</i> setelah memanggil <i>memset</i> .  Itu sebabnya kompiler tidak melihat adanya arti membuang waktu prosesor pada menimpa memori yang tidak digunakan di masa depan.  Anda dapat memperbaikinya dengan menggunakan fungsi <i>RtlSecureZeroMemory</i> atau fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">serupa</a> . <br><br>  Benar: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sha1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *input, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ilen, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> output[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">20</span></span></span></span><span class="hljs-function"><span class="hljs-params">] )</span></span></span><span class="hljs-function"> </span></span>{ sha1_context ctx; sha1_starts( &amp;ctx ); sha1_update( &amp;ctx, input, ilen ); sha1_finish( &amp;ctx, output ); RtlSecureZeroMemory(&amp;ctx, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>( sha1_context ) ); }</code> </pre> <br><h3>  Perbandingan yang tidak perlu </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> u32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sceAudioOutputPannedBlocking</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u32 chan, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> leftvol, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rightvol, u32 samplePtr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// For some reason, this is the only one that checks for negative. if (leftvol &gt; 0xFFFF || rightvol &gt; 0xFFFF || leftvol &lt; 0 || rightvol &lt; 0) { .... } else { if (leftvol &gt;= 0) { chans[chan].leftVolume = leftvol; } if (rightvol &gt;= 0) { chans[chan].rightVolume = rightvol; } chans[chan].sampleAddress = samplePtr; result = __AudioEnqueue(chans[chan], chan, true); } }</span></span></code> </pre> <br>  Peringatan PVS-Studio: Ekspresi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V547</a> 'leftvol&gt; = 0' selalu benar.  sceAudio.cpp 120 <br><br>  Perhatikan cabang yang lain untuk yang pertama <i>jika</i> .  Kode akan dieksekusi hanya jika semua kondisi <i>tersisa&gt; 0xFFFFF ||</i>  <i>rightvol&gt; 0xFFFF ||</i>  <i>leftvol &lt;0 ||</i>  <i>rightvol &lt;0</i> salah.  Oleh karena itu, kita mendapatkan pernyataan berikut yang akan benar untuk cabang lain: <i>leftvol &lt;= 0xFFFFF, rightvol &lt;= 0xFFFFF, leftvol&gt; = 0 dan rightvol&gt; = 0</i> .  Perhatikan dua pernyataan terakhir.  Apakah masuk akal untuk memeriksa kondisi apa yang diperlukan untuk mengeksekusi fragmen kode ini? <br><br>  Jadi kami dapat dengan tenang menghapus operator bersyarat ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> u32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sceAudioOutputPannedBlocking</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u32 chan, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> leftvol, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rightvol, u32 samplePtr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// For some reason, this is the only one that checks for negative. if (leftvol &gt; 0xFFFF || rightvol &gt; 0xFFFF || leftvol &lt; 0 || rightvol &lt; 0) { .... } else { chans[chan].leftVolume = leftvol; chans[chan].rightVolume = rightvol; chans[chan].sampleAddress = samplePtr; result = __AudioEnqueue(chans[chan], chan, true); } }</span></span></code> </pre> <br>  Skenario lain.  Di belakang kondisi yang berlebihan ini ada beberapa kesalahan.  Mungkin kita sudah memeriksa apa yang tidak kita butuhkan ... <br><br><h3>  Ctrl + C Ctrl + V menyerang balik </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> u32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scePsmfSetPsmf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u32 psmfStruct, u32 psmfData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Memory::IsValidAddress(psmfData) || !Memory::IsValidAddress(psmfData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hleReportError(ME, SCE_KERNEL_ERROR_ILLEGAL_ADDRESS, <span class="hljs-string"><span class="hljs-string">"bad address"</span></span>); } .... }</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V501</a> Ada sub-ekspresi identik '! Memori :: IsValidAddress (psmfData)' di kiri dan di kanan '||'  operator.  scePsmf.cpp 703 <br><br>  Catat cek di dalam <i>jika</i> .  Bukankah aneh bagi Anda bahwa kami memeriksa apakah alamat <i>psmfData</i> valid dua kali lipat?  Jadi saya merasa aneh ... Sebenarnya, kami memiliki kesalahan cetak sebelum kami, tentu saja, dan idenya adalah untuk memeriksa kedua parameter input. <br><br>  Varian yang benar adalah: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> u32 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scePsmfSetPsmf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(u32 psmfStruct, u32 psmfData)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Memory::IsValidAddress(psmfStruct) || !Memory::IsValidAddress(psmfData)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hleReportError(ME, SCE_KERNEL_ERROR_ILLEGAL_ADDRESS, <span class="hljs-string"><span class="hljs-string">"bad address"</span></span>); } .... }</code> </pre> <br><h3>  Variabel yang terlupakan </h3><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ud_translate_att</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">; .... </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (size == </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">8</span></span></span></span><span class="hljs-function"><span class="hljs-params">) { ud_asmprintf(u, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"b"</span></span></span></span><span class="hljs-function"><span class="hljs-params">); } </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">else</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (size == </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">16</span></span></span></span><span class="hljs-function"><span class="hljs-params">) { ud_asmprintf(u, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"w"</span></span></span></span><span class="hljs-function"><span class="hljs-params">); } </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">else</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span></span><span class="hljs-function"><span class="hljs-params"> (size == </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">64</span></span></span></span><span class="hljs-function"><span class="hljs-params">) { ud_asmprintf(u, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"q"</span></span></span></span><span class="hljs-function"><span class="hljs-params">); } .... }</span></span></span></span></code> </pre> <br>  Peringatan PVS-Studio: Ekspresi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V547</a> 'size == 8' selalu salah.  syn-att.c 195 <br><br>  Kesalahan ini terletak di folder <i>ext</i> , jadi itu tidak benar-benar berlaku untuk proyek, tetapi kesalahan itu ditemukan sebelum saya menyadarinya, jadi saya memutuskan untuk menyimpannya.  Namun, artikel ini bukan tentang tinjauan kesalahan tetapi tentang integrasi dengan Travis CI dan tidak ada konfigurasi penganalisa yang dilakukan. <br><br>  Variabel <i>ukuran</i> diinisialisasi dengan konstanta, tetapi tidak digunakan sama sekali dalam kode hingga <i>jika</i> operator yang, tentu saja, menghasilkan informasi <i>palsu</i> sambil memeriksa kondisi karena, seperti yang kita ingat, <i>ukurannya</i> sama dengan nol.  Pemeriksaan selanjutnya juga tidak masuk akal. <br><br>  Rupanya, pembuat fragmen kode lupa untuk menimpa variabel <i>ukuran</i> sebelum itu. <br><br><h3>  Berhenti </h3><br>  Di situlah kita akan berhenti dengan kesalahan.  Tujuan artikel ini adalah untuk menunjukkan bagaimana PVS-Studio bekerja dengan Travis CI dan tidak menganalisis proyek selengkap mungkin.  Jika Anda ingin kesalahan yang lebih besar dan lebih indah, Anda selalu dapat melihatnya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> :). <br><br><h2>  Kesimpulan </h2><br>  Menggunakan layanan web untuk membangun proyek bersama dengan praktik analisis tambahan memungkinkan Anda mendeteksi banyak masalah setelah penggabungan kode.  Namun, satu build mungkin tidak cukup, sehingga pengaturan pengujian bersama dengan analisis statis akan secara signifikan meningkatkan kualitas kode. <br><br><h2>  Tautan yang bermanfaat </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Meluncurkan PVS-Studio di Linux dan macOS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Meluncurkan PVS-Studio di Docker</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Dokumentasi Travis CI</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id464641/">https://habr.com/ru/post/id464641/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id464629/index.html">Analis Keamanan Informasi - siapa dia? Perendaman dalam profesi</a></li>
<li><a href="../id464631/index.html">Walmart menggugat Tesla setelah beberapa kebakaran akibat panel surya Solar City</a></li>
<li><a href="../id464635/index.html">BIZERBA VS MES. Apa yang harus diinvestasikan oleh produsen?</a></li>
<li><a href="../id464637/index.html">Apa yang akan terjadi pada konferensi UseData Conf 2019?</a></li>
<li><a href="../id464639/index.html">Berikan diri Anda waktu untuk pemulihan - ini adalah kunci stabilitas psikologis</a></li>
<li><a href="../id464643/index.html">Bukan pemindaian tunggal, atau bagaimana membangun proses manajemen kerentanan dalam 9 langkah</a></li>
<li><a href="../id464645/index.html">Bagaimana mengkonfigurasi PVS-Studio di Travis CI menggunakan emulator konsol game PSP sebagai contoh</a></li>
<li><a href="../id464647/index.html">Surat Kabar Harry Potter</a></li>
<li><a href="../id464649/index.html">Sistem Kolaborasi Dokumen untuk Zimbra Open-Source Edition</a></li>
<li><a href="../id464651/index.html">Perpustakaan generator kode assembler untuk mikrokontroler AVR. Bagian 5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>