<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤ŸğŸ» ğŸŒ¨ï¸ ğŸ¤¸ğŸ» æµè¡Œçš„åä½œå¼ŠBattlEyeçš„é€†å‘å·¥ç¨‹ ğŸ¤µğŸ¼ ğŸ‘¦ğŸ¾ ğŸ‘°ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="BattlEyeä¸»è¦æ˜¯å¾·å›½ç¬¬ä¸‰æ–¹åä½œå¼Šæ¸¸æˆï¼Œä¸»è¦ç”±32å²çš„Bastian Heiko Suterå¼€å‘ ã€‚ å®ƒä¸ºæ¸¸æˆå‘è¡Œå•†æä¾›ï¼ˆæˆ–è¯•å›¾å‘å…¶æä¾›ï¼‰ä½¿ç”¨é€šç”¨ä¿æŠ¤æœºåˆ¶çš„æ˜“äºä½¿ç”¨çš„é˜²ä½œå¼Šç³»ç»Ÿï¼Œä»¥åŠé’ˆå¯¹ç‰¹å®šæ¸¸æˆçš„ä½œå¼Šæ£€æµ‹ä»¥ä¼˜åŒ–å®‰å…¨æ€§ã€‚ å¦‚äº§å“ç½‘ç«™ä¸Šæ‰€è¿°ï¼Œå®ƒå§‹ç»ˆå¤„äºç°ä»£æŠ€æœ¯çš„æœ€å‰æ²¿ï¼Œå¹¶ä½¿ç”¨åˆ›æ–°çš„ä¿æŠ¤å’Œæ£€æµ‹æ–¹æ³•ï¼› ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æµè¡Œçš„åä½œå¼ŠBattlEyeçš„é€†å‘å·¥ç¨‹</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/483068/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ps/ae/ij/psaeijpcayldgrqiqeiq6l83nue.jpeg"></div><br>  BattlEyeä¸»è¦æ˜¯å¾·å›½ç¬¬ä¸‰æ–¹åä½œå¼Šæ¸¸æˆï¼Œä¸»è¦ç”±32å²çš„<em>Bastian Heiko Suterå¼€å‘</em> ã€‚ å®ƒä¸ºæ¸¸æˆå‘è¡Œå•†æä¾›ï¼ˆæˆ–è¯•å›¾å‘å…¶æä¾›ï¼‰ä½¿ç”¨é€šç”¨ä¿æŠ¤æœºåˆ¶çš„æ˜“äºä½¿ç”¨çš„é˜²ä½œå¼Šç³»ç»Ÿï¼Œä»¥åŠé’ˆå¯¹ç‰¹å®šæ¸¸æˆçš„ä½œå¼Šæ£€æµ‹ä»¥ä¼˜åŒ–å®‰å…¨æ€§ã€‚ å¦‚äº§å“ç½‘ç«™ä¸Šæ‰€è¿°ï¼Œå®ƒå§‹ç»ˆå¤„äºç°ä»£æŠ€æœ¯çš„æœ€å‰æ²¿ï¼Œå¹¶ä½¿ç”¨åˆ›æ–°çš„ä¿æŠ¤å’Œæ£€æµ‹æ–¹æ³•ï¼› æ˜¾ç„¶ï¼Œè¿™æ˜¯å¼€å‘å•†çš„å›½ç±<code>QUALITY MADE IN GERMANY</code> ï¼š <code>QUALITY MADE IN GERMANY</code> ã€‚  BattlEyeç”±è®¸å¤šå…ƒç´ ç»„æˆï¼Œè¿™äº›å…ƒç´ å¯ä»¥ä¸€èµ·åœ¨ä¸ºä½¿ç”¨äº§å“ä»˜è´¹çš„æ¸¸æˆä¸­æ‰¾åˆ°ä½œå¼Šè€…ã€‚ å››ä¸ªä¸»è¦å…ƒç´ æ˜¯ï¼š <br><br><ul><li> æœåŠ¡ <ul><li> ä¸BattlEye <em>BEServer</em>æœåŠ¡å™¨é€šä¿¡çš„Windowsç³»ç»ŸæœåŠ¡ï¼Œè¯¥æœåŠ¡å™¨æä¾›ä¸<em>BEDaisy</em>å’Œ<em>BEClientçš„</em>å®¢æˆ·ç«¯-æœåŠ¡å™¨é€šä¿¡ã€‚ </li></ul></li><li> è´è¿ªè¥¿ <ul><li>  Windowså†…æ ¸é©±åŠ¨ç¨‹åºï¼Œè®°å½•é¢„é˜²æ€§äº‹ä»¶å¤„ç†æœºåˆ¶å’Œå¾®å‹è¿‡æ»¤å™¨ï¼Œä»¥é˜²æ­¢ä½œå¼Šè€…éæ³•ä¿®æ”¹æ¸¸æˆ </li></ul></li><li>  Becient <ul><li> åŠ¨æ€è¿æ¥çš„Windowsåº“ï¼Œè´Ÿè´£å¤§å¤šæ•°æ£€æµ‹å‘é‡ï¼ŒåŒ…æ‹¬æœ¬æ–‡ä¸­ä»‹ç»çš„é‚£äº›å‘é‡ã€‚ åˆå§‹åŒ–åï¼Œå®ƒä¼šé™„åŠ åˆ°æ¸¸æˆè¿‡ç¨‹ä¸­ã€‚ </li></ul></li><li> è§‚å¯Ÿè€… <ul><li> ä¸“æœ‰çš„åç«¯æœåŠ¡å™¨ï¼Œè´Ÿè´£æ”¶é›†ä¿¡æ¯å¹¶é’ˆå¯¹ä½œå¼Šè€…é‡‡å–ç‰¹å®šæªæ–½ã€‚ </li></ul></li></ul><br><h1>  Shellcode </h1><br> æœ€è¿‘ï¼ŒInternetä¸Šå‡ºç°äº†BattlEye shellä»£ç çš„è½¬å‚¨ï¼Œæˆ‘ä»¬å†³å®šå†™ä¸€äº›æœ‰å…³BattlEyeå½“å‰ç‰ˆæœ¬çš„ç¡®åˆ‡ä¿¡æ¯ã€‚ æˆ‘ä»¬å·²ç»å…­ä¸ªæœˆæ²¡æœ‰åˆ†æBattlEyeäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸Šä¸€æ¬¡å¯¹shellcodeçš„è½¬å‚¨å¾ˆå¯èƒ½å·²ç»è¿‡æ—¶äº†ã€‚ å‡è®¾BattlEyeä»…å®Œæˆäº†å¤–å£³ä»£ç å¹¶ä¸”æ²¡æœ‰åˆ é™¤å…ˆå‰çš„æ£€æµ‹è¿‡ç¨‹ï¼Œä»…ä»æœ€åä¸€æ¬¡è½¬å‚¨çš„å†…å­˜ä¸­æ¢å¤äº†ä»£ç çš„å„ä¸ªéƒ¨åˆ†ã€‚ <br><a name="habracut"></a><br><h1> æ€ä¹ˆäº† </h1><br> æ®ç§°ï¼ŒBattlEyeå°†shellcodeä»å…¶æœåŠ¡å™¨æµå¼ä¼ è¾“åˆ°åä¸ºBEServiceçš„WindowsæœåŠ¡ã€‚ è¯¥æœåŠ¡ä¸æ¸¸æˆå†…çš„BEClientæ¨¡å—è¿›è¡Œé€šä¿¡ã€‚ æ•°æ®äº¤æ¢é€šè¿‡<code>\.namedpipeBattleye</code> ï¼Œç›´åˆ°2018å¹´æœªåŠ å¯†ã€‚ ç°åœ¨ï¼Œæ‰€æœ‰ä¼ è¾“çš„æ•°æ®éƒ½ä½¿ç”¨å…·æœ‰éå¸¸å°çš„å¯†é’¥çš„xoråŠ å¯†å™¨è¿›è¡Œäº†åŠ å¯†ï¼Œè¿™ä½¿å¾—æ‰§è¡Œä¼—æ‰€å‘¨çŸ¥çš„çº¯æ–‡æœ¬æ”»å‡»å˜å¾—å¼‚å¸¸å®¹æ˜“ã€‚ å½“å°†å¤–å£³ç¨‹åºä»£ç ä¼ è¾“åˆ°å®¢æˆ·ç«¯æ—¶ï¼Œå®ƒä¼šåœ¨æ‰€æœ‰å·²çŸ¥æ¨¡å—ä¹‹å¤–å®šä½å¹¶æ‰§è¡Œï¼Œè¿™ä½¿ç¡®å®šå˜å¾—å®¹æ˜“ã€‚ è¦åˆ›å»ºshellcodeè½¬å‚¨ï¼Œæ‚¨å¯ä»¥å¤„ç†æ ‡å‡†Windows APIå‡½æ•°ï¼ˆä¾‹å¦‚CreateFileï¼ŒReadFileç­‰ï¼‰ï¼Œå¹¶è½¬å‚¨æ‰€æœ‰å·²çŸ¥æ¨¡å—ä¹‹å¤–çš„æ‰€æœ‰è°ƒç”¨æ¨¡å—çš„ç›¸åº”å­˜å‚¨åŒºï¼ˆè¯·æ±‚è¿”å›åœ°å€çš„å­˜å‚¨ä¿¡æ¯ï¼‰ï¼Œæˆ–è€…å®šæœŸæ‰«ææ¸¸æˆçš„è™šæ‹Ÿå†…å­˜ç©ºé—´ï¼Œä»¥æŸ¥æ‰¾æ‰€æœ‰å·²çŸ¥æ¨¡å—å¤–éƒ¨çš„å¯æ‰§è¡Œå†…å­˜ï¼Œå¹¶å°†å…¶è½¬å‚¨åˆ°ç£ç›˜ã€‚ åŒæ—¶ï¼Œæ‚¨éœ€è¦è·Ÿè¸ªå“ªäº›åŒºåŸŸå·²ç»è¢«è½¬å‚¨ï¼Œå› æ­¤ï¼Œæ‚¨å°†ä¸ä¼šå¾—åˆ°å¾ˆå¤šç›¸åŒçš„è½¬å‚¨ã€‚ <br><br><h1> è§£è¯´ </h1><br> ä¸ºäº†ç¾è§‚èµ·è§ï¼Œ <strong>å¼ºçƒˆ</strong>ä¿®æ”¹äº†æœ¬æ–‡ä¸­æä¾›çš„ä¼ªä»£ç çš„ç‰‡æ®µã€‚ æ‚¨å°†æ— æ³•è½¬å‚¨BattlEyeå¤–å£³ç¨‹åºä»£ç å¹¶ç«‹å³è¯†åˆ«è¿™äº›éƒ¨åˆ†ã€‚  shellcodeä¸åŒ…å«å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”æœ¬æ–‡ä¸­éƒ¨ç½²äº†è®¸å¤šç®—æ³•ã€‚ ä½†æ˜¯å®é™…ä¸Šï¼Œè¿™å¹¶ä¸é‡è¦ï¼Œå› ä¸ºå½“æ‚¨é˜…è¯»å®Œæœ‰å…³è¿™ä¸ªå¯æ€•çš„ä¸Šå¤çš„èµ„æ–™åï¼Œæ‚¨å°†æœ‰æœºä¼šè§£å†³å®ƒï¼ˆ <br><br><h2> å†…å­˜æ’åº </h2><br> åä½œå¼Šä¸­æœ€å¸¸è§çš„æ£€æµ‹æœºåˆ¶æ˜¯å†…å­˜æšä¸¾å’Œå†…å­˜æ‰«æï¼Œä»¥æœç´¢<em>å·²çŸ¥çš„</em>ä½œå¼Šå›¾åƒã€‚ å®ƒå¾ˆå®¹æ˜“å®ç°ï¼Œå¹¶ä¸”å¦‚è¿‡å»æ‰€ç¤ºï¼Œä½¿ç”¨æ­£ç¡®çš„æ–¹æ³•ï¼Œå¦‚æœæ‚¨æ²¡æœ‰å¿˜è®°æ±‡ç¼–ç¨‹åºçš„åŸºç¡€çŸ¥è¯†å¹¶å°†å¸¸ç”¨åŠŸèƒ½çš„åºè¨€åˆ—å…¥é»‘åå•ï¼Œåˆ™éå¸¸æœ‰æ•ˆã€‚ <br><br>  Battleyeä¼šéå†æ¸¸æˆè¿›ç¨‹çš„æ•´ä¸ªåœ°å€ç©ºé—´ï¼ˆåœ¨æ­¤æƒ…å†µä¸‹ä¸ºå½“å‰è¿›ç¨‹ï¼‰ï¼Œå¹¶å¯¹é¡µé¢æ€§èƒ½è¿›è¡Œå„ç§æ£€æŸ¥ï¼Œå¹¶åœ¨ç›¸åº”çš„å†…å­˜ç©ºé—´ä¹‹å¤–æŸ¥æ‰¾shellä»£ç ã€‚ <br><br> è¿™æ˜¯åœ¨Battleyeä¸­å®ç°çš„æ–¹å¼ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// MEMORY ENUMERATION for (current_address = 0 // QUERY MEMORY_BASIC_INFORMATION NtQueryVirtualMemory(GetCurrentProcess(), current_address, 0, &amp;memory_information, 0x30, &amp;return_length) &gt;= 0 current_address = memory_information.base_address + memory_information.region_size) { const auto outside_of_shellcode = memory_information.base_address &gt; shellcode_entry || memory_information.base_address + memory_information.region_size &lt;= shellcode_entry const auto executable_memory = memory_information.state == MEM_COMMIT &amp;&amp; (memory_information.protect == PAGE_EXECUTE || memory_information.protect == PAGE_EXECUTE_READ || memory_information.protect == PAGE_EXECUTE_READWRITE const auto unknown_whitelist = memory_information.protect != PAGE_EXECUTE_READWRITE || memory_information.region_size != 100000000 if (!executable_memory || !outside_of_shellcode || !unknown_whitelist) continue // RUN CHECKS memory::anomaly_check(memory_information memory::pattern_check(current_address, memory_information memory::module_specific_check_microsoft(memory_information memory::guard_check(current_address, memory_information memory::module_specific_check_unknown(memory_information }</span></span></code> </pre> <br><h1> è®°å¿†å¼‚å¸¸ </h1><br>  BattlEyeæ ‡è®°å†…å­˜åœ°å€ç©ºé—´ä¸­çš„æ‰€æœ‰å¼‚å¸¸ï¼Œä¸»è¦æ˜¯ä¸åŠ è½½çš„æ˜ åƒä¸å¯¹åº”çš„å¯æ‰§è¡Œæ¨¡å—çš„å†…å­˜ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> memory::anomaly_check(MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-comment"><span class="hljs-comment">// REPORT ANY EXECUTABLE PAGE OUTSIDE OF KNOWN MODULES if (memory_information.type == MEM_PRIVATE || memory_information.type == MEM_MAPPED) { if ((memory_information.base_address &amp; 0xFF0000000000) != 0x7F0000000000 &amp;&amp; // UPPER EQUALS 0x7F (memory_information.base_address &amp; 0xFFF000000000) != 0x7F000000000 &amp;&amp; // UPPER EQUALS 0x7F0 (memory_information.base_address &amp; 0xFFFFF0000000) != 0x70000000 &amp;&amp; // UPPER EQUALS 0x70000 memory_information.base_address != 0x3E0000)) { memory_report.unknown = 0 memory_report.report_id = 0x2F memory_report.base_address = memory_information.base_address memory_report.region_size = memory_information.region_size memory_report.memory_info = memory_information.type | memory_information.protect | memory_information.state battleye::report(&amp;memory_report, sizeof(memory_report), 0 } } }</span></span></code> </pre> <br><h1> æ‰«æå›¾æ¡ˆ </h1><br> å¦‚ä¸Šæ‰€è¿°ï¼ŒBattlEyeè¿˜æ‰«ææœ¬åœ°è¿›ç¨‹çš„å†…å­˜ä»¥æŸ¥æ‰¾å„ç§æ¸…æ™°å®šä¹‰çš„æ¨¡å¼ï¼Œå¦‚ä»¥ä¸‹æ‰€ç¤ºçš„å®ç°æ‰€ç¤ºã€‚ <br><br> è¯»å–æ­¤ä¼ªä»£ç æ—¶ï¼Œæ‚¨å¯ä»¥çŒœæµ‹<strong>å¯ä»¥é€šè¿‡</strong>é‡å†™æ¯ä¸ªå·²åŠ è½½æ¨¡å—çš„ä»£ç åŒºåŸŸ<strong>æ¥è§„é¿è¿™äº›æ£€æŸ¥</strong> ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šæ‰«ææœç´¢å·²çŸ¥å›¾åƒä¸­çš„å›¾æ¡ˆã€‚ ä¸ºäº†ä¸è¿›è¡Œå®Œæ•´æ€§æ£€æŸ¥ï¼Œæ‚¨éœ€è¦ä¸‹è½½æ‰€æœ‰æ‰“åŒ…å’Œåˆ—å…¥ç™½åå•çš„åŒºåŸŸï¼Œå¹¶é‡å†™æ ‡è®°ä¸º<em>RWXçš„</em>ä»£ç åŒºåŸŸï¼Œå› ä¸ºå¦‚æœä¸æ¨¡æ‹Ÿæ‰“åŒ…ç¨‹åºï¼Œæˆ‘ä»¬å°†æ— æ³•æ‰§è¡Œå®Œæ•´æ€§æ£€æŸ¥ã€‚ åœ¨å½“å‰ç‰ˆæœ¬çš„BattlEye shellcodeä¸­ï¼Œè¿™äº›å†…å­˜æ¨¡å¼æ˜¯ç¡¬ç¼–ç çš„ï¼š <br><br><pre> <code class="cpp hljs">[<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>] ojectsPUBGChinese [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>] BattleGroundsPrivate_CheatESP [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span>] [%<span class="hljs-number"><span class="hljs-number">.0</span></span>fm] %s [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>E] <span class="hljs-number"><span class="hljs-number">0000</span></span>Neck0000Chest0000000Mouse <span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">3F</span></span>] PlayerESPColor [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span>] Aimbot: %d02D3E2041 [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>] HackMachine [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>A] VisualHacks.net [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span>] <span class="hljs-number"><span class="hljs-number">3E232</span></span>F653E31314E4E563D4276282A3A2E463F757523286752552E6F30584748 [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">4F</span></span>] DLLInjection-master\x64\Release\ [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">52</span></span>] NameESP [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span>] Skullhack [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span>] .rdata$zzzdbg [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span>] AimBot [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">39</span></span>] EB4941803C123F755C623FEB388D41D0FBEC93C977583E930EB683E1DF [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">5F</span></span>] <span class="hljs-number"><span class="hljs-number">55E9</span></span> [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">5F</span></span>] <span class="hljs-number"><span class="hljs-number">57E9</span></span> [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">5F</span></span>] <span class="hljs-number"><span class="hljs-number">60E9</span></span> [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">68</span></span>] D3D11Present initialised [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>E] [ %<span class="hljs-number"><span class="hljs-number">.0</span></span>fM ] [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">74</span></span>] [hp:%d]%dm [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>] <span class="hljs-number"><span class="hljs-number">48836424380488</span></span>D4C2458488B5424504C8BC848894C24304C8BC7488D4C2460 [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>] <span class="hljs-number"><span class="hljs-number">741F</span></span>BA80000FF15607E0085C07510F2F1087801008B8788100EB [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>] <span class="hljs-number"><span class="hljs-number">40F</span></span>2AA156F8D2894E9AB4489535D34F9CPOSITION0000COL [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>A] FFE090 [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">79</span></span>] %s00%d00POSITION0000COLOR0000000 [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">36</span></span>] <span class="hljs-number"><span class="hljs-number">8E85765</span></span>DCDDA452E75BA12B4C7B94872116DB948A1DAA6B948A7676BB948902C [<span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span>A] n&lt;assembly xmlsn=<span class="hljs-string"><span class="hljs-string">'urn:schemas-mi</span></span></code> </pre> <br> è¿™äº›å­˜å‚¨æ¨¡å¼è¿˜åŒ…å«ä¸€ä¸ªä¸¤å­—èŠ‚çš„æ ‡å¤´ï¼Œå³æœªçŸ¥é™æ€å€¼<code>05</code>å’Œå”¯ä¸€æ ‡è¯†ç¬¦ã€‚ <br><br> æˆ‘ä»¬ä¸ä¼šçœ‹åˆ°çš„æ˜¯BattlEyeè¿˜åŠ¨æ€åœ°ä»<em>BEServer</em>æµåŒ–æ¨¡å¼å¹¶å°†å…¶å‘é€ç»™<em>BEClient</em> ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ä¸åœ¨æœ¬æ–‡ä¸­è®¨è®ºã€‚ <br><br> é€šè¿‡ä»¥ä¸‹ç®—æ³•å¯¹å®ƒä»¬è¿›è¡Œè¿­ä»£æ‰«æï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> memory::pattern_check(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* current_address, MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> is_user32 = memory_information.allocation_base == GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span> <span class="hljs-comment"><span class="hljs-comment">// ONLY SCAN PRIVATE MEMORY AND USER32 CODE SECTION if (memory_information.type != MEM_PRIVATE &amp;&amp; !is_user32) continue for (address = current_address address != memory_information.base_address + memory_information.region_size address += PAGE_SIZE) // PAGE_SIZE { // READ ENTIRE PAGE FROM LOCAL PROCESS INTO BUFFER if (NtReadVirtualMemory(GetCurrentProcess(), address, buffer, PAGE_SIZE, 0) &lt; 0) continue for (pattern_index = 0 pattern_index &lt; 0x1C/*PATTERN COUNT*/ ++pattern_index) { if (pattern[pattern_index].header == 0x57A &amp;&amp; !is_user32) // ONLY DO FFE090 SEARCHES WHEN IN USER32 continue for (offset = 0 pattern[pattern_index].length + offset &lt;= PAGE_SIZE ++offset) { const auto pattern_matches = memory::pattern_match(&amp;address[offset], pattern[pattern_index // BASIC PATTERN MATCH if (pattern_matches) { // PATTERN FOUND IN MEMORY pattern_report.unknown = 0 pattern_report.report_id = 0x35 pattern_report.type = pattern[index].header pattern_report.data = &amp;address[offset pattern_report.base_address = memory_information.base_address pattern_report.region_size = memory_information.region_size pattern_report.memory_info = memory_information.type | memory_information.protect | memory_information.state battleye::report(&amp;pattern_report, sizeof(pattern_report), 0 } } } } }</span></span></code> </pre> <br><h1> éªŒè¯ç‰¹å®šæ¨¡å—ï¼ˆMicrosoftï¼‰ </h1><br> æ¨¡å—æ£€æŸ¥æŠ¥å‘Šæ¸¸æˆä¸­åŠ è½½çš„ç‰¹å®šæ¨¡å—çš„å­˜åœ¨ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> memory::module_specific_check_microsoft(MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> executable = memory_information.protect == PAGE_EXECUTE || memory_information.protect == PAGE_EXECUTE_READ || memory_information.protect == PAGE_EXECUTE_READWRITE <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> allocated = memory_information.state == MEM_COMMIT <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!allocated || !executable) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> mmres_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"mmres.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> mshtml_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"mshtml.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mmres_handle &amp;&amp; mmres_handle == memory_information.allocation_base) { battleye_module_anomaly_report module_anomaly_report module_anomaly_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> module_anomaly_report.report_id = <span class="hljs-number"><span class="hljs-number">0x5B</span></span> module_anomaly_report.identifier = <span class="hljs-number"><span class="hljs-number">0x3480</span></span> module_anomaly_report.region_size = memory_information.region_size battleye::report(&amp;module_anomaly_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(module_anomaly_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mshtml_handle &amp;&amp; mshtml_handle == memory_information.allocation_base) { battleye_module_anomaly_report module_anomaly_report module_anomaly_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> module_anomaly_report.report_id = <span class="hljs-number"><span class="hljs-number">0x5B</span></span> module_anomaly_report.identifier = <span class="hljs-number"><span class="hljs-number">0xB480</span></span> module_anomaly_report.region_size = memory_information.region_size battleye::report(&amp;module_anomaly_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(module_anomaly_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h1> æ£€æŸ¥ç‰¹å®šæ¨¡å—ï¼ˆæœªçŸ¥ï¼‰ </h1><br> ç³»ç»Ÿå·²æ·»åŠ äº†å¯¹ç‰¹å®šæ¨¡å—çš„æ£€æŸ¥ï¼Œè¿™è¡¨æ˜æœåŠ¡å™¨å·²åŠ è½½æ»¡è¶³ä»¥ä¸‹<em>ä»»ä½•</em>æ¡ä»¶çš„æ¨¡å—ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> memory::module_specific_check_unknown(MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> dos_header = (DOS_HEADER*)module_handle <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pe_header = (PE_HEADER*)(module_handle + dos_header-&gt;e_lfanew <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> is_image = memory_information.state == MEM_COMMIT &amp;&amp; memory_information.type == MEM_IMAGE <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_image) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> is_base = memory_information.base_address == memory_information.allocation_base <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!is_base) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> match_1 = time_date_stamp == <span class="hljs-number"><span class="hljs-number">0x5B12C900</span></span> &amp;&amp; *(__int8*)(memory_information.base_address + <span class="hljs-number"><span class="hljs-number">0x1000</span></span>) == <span class="hljs-number"><span class="hljs-number">0x00</span></span> &amp;&amp; *(__int32*)(memory_information.base_address + <span class="hljs-number"><span class="hljs-number">0x501000</span></span>) != <span class="hljs-number"><span class="hljs-number">0x353E900</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> match_2 = time_date_stamp == <span class="hljs-number"><span class="hljs-number">0x5A180C35</span></span> &amp;&amp; *(__int8*)(memory_information.base_address + <span class="hljs-number"><span class="hljs-number">0x1000</span></span>) != <span class="hljs-number"><span class="hljs-number">0x00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> match_2 = time_date_stamp == <span class="hljs-number"><span class="hljs-number">0xFC9B9325</span></span> &amp;&amp; *(__int8*)(memory_information.base_address + <span class="hljs-number"><span class="hljs-number">0x6D3000</span></span>) != <span class="hljs-number"><span class="hljs-number">0x00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!match_1 &amp;&amp; !match_2 &amp;&amp; !match_3) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> buffer_offset = <span class="hljs-number"><span class="hljs-number">0x00</span></span> <span class="hljs-comment"><span class="hljs-comment">// OFFSET DEPENDS ON WHICH MODULE MATCHES, RESPECTIVELY 0x501000, 0x1000 AND 0x6D3000 unknown_module_report.unknown1 = 0 unknown_module_report.report_id = 0x46 unknown_module_report.unknown2 = 1 unknown_module_report.data = *(__int128*)(memory_information.base_address + buffer_offset battleye::report(&amp;unknown_module_report, sizeof(unknown_module_report), 0 }</span></span></code> </pre> <br> æˆ‘ä»¬ä¸çŸ¥é“å“ªä¸ªæ¨¡å—æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬æ€€ç–‘è¿™æ˜¯å°è¯•æ£€æµ‹éå¸¸æœ‰é™çš„ä¸€ç»„ç‰¹å®šä½œå¼Šæ¨¡å—çš„å°è¯•ã€‚ <br><br> é™„å½•ï¼š@ how02é€šçŸ¥æˆ‘ä»¬ï¼Œ <code>action_x64.dll</code>æ¨¡å—çš„<code>0x5B12C900</code>å¹¶åŒ…å«å¯å†™å…¥çš„ä»£ç åŒºåŸŸï¼› å¦‚å‰æ‰€è¿°ï¼Œè¿™å¯ç”¨äºåˆ©ç”¨ã€‚ <br><br><h1> è®°å¿†ä¿æŠ¤ </h1><br>  BattlEyeè¿˜å®ç°äº†ä¸€ä¸ªéå¸¸å¯ç–‘çš„æ£€æµ‹è¿‡ç¨‹ï¼Œåœ¨æˆ‘ä»¬çœ‹æ¥ï¼Œè¯¥è¿‡ç¨‹å°†æŸ¥æ‰¾å…·æœ‰<em>PAGE_GUARD</em>æ ‡å¿—<em>è®¾ç½®çš„</em>å†…å­˜ï¼Œè€Œæ— éœ€å®é™…æ£€æŸ¥æ˜¯å¦å·²<em>è®¾ç½®PAGE_GUARD</em>æ ‡å¿—ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> memory::guard_check(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* current_address, MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memory_information.protect != PAGE_NOACCESS) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> bad_ptr = IsBadReadPtr(current_address, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(temporary_buffer <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> read = NtReadVirtualMemory( GetCurrentProcess(), current_address, temporary_buffer, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(temporary_buffer), <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (read &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || bad_ptr) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> query = NtQueryVirtualMemory( GetCurrentProcess(), current_address, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;new_memory_information, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(new_memory_information), &amp;return_length memory_guard_report.guard = query &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || new_memory_information.state != memory_information.state || new_memory_information.protect != memory_information.protect <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (memory_guard_report.guard) { memory_guard_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> memory_guard_report.report_id = <span class="hljs-number"><span class="hljs-number">0x21</span></span> memory_guard_report.base_address = memory_information.base_address memory_guard_report.region_size = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)memory_information.region_size memory_guard_report.memory_info = memory_information.type | memory_information.protect | memory_information.state battleye::report(&amp;memory_guard_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(memory_guard_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } } } }</code> </pre> <br><h2> çª—å£æ’åº </h2><br> å¤–å£³ç¨‹åºä»£ç BattlEyeéå†æ¸¸æˆä¸­å½“å‰å¯è§çš„æ¯ä¸ªçª—å£ï¼Œç»•è¿‡çª—å£çš„ä¸Šä¸‹ï¼ˆæŒ‰zå€¼ï¼‰ã€‚ æ­¤æšä¸¾æ’é™¤äº†æ¸¸æˆå†…éƒ¨çš„çª—å£<code>GetWindowThreadProcessId</code> ï¼Œè¿™æ˜¯é€šè¿‡è°ƒç”¨<code>GetWindowThreadProcessId</code>æ¥ç¡®å®šçš„ã€‚ å› æ­¤ï¼Œæ‚¨å¯ä»¥å°†ç›¸åº”çš„å‡½æ•°ç»‘å®šåˆ°çª—å£çš„å‡æ‰€æœ‰è€…ï¼Œä»¥ä¾¿<strong>BattlEyeä¸ä¼šæ£€æŸ¥window</strong> ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> window_handler::enumerate() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> window_handle = GetTopWindow window_handle window_handle = GetWindow(window_handle, GW_HWNDNEXT), <span class="hljs-comment"><span class="hljs-comment">// GET WINDOW BELOW ++window_handler::windows_enumerated) // INCREMENT GLOBAL COUNT FOR LATER USAGE { auto window_process_pid = 0 GetWindowThreadProcessId(window_handle, &amp;window_process_pid if (window_process_pid == GetCurrentProcessId()) continue // APPEND INFORMATION TO THE MISC. REPORT, THIS IS EXPLAINED LATER IN THE ARTICLE window_handler::handle_summary(window_handle constexpr auto max_character_count = 0x80 const auto length = GetWindowTextA(window_handle, window_title_report.window_title, max_character_count // DOES WINDOW TITLE MATCH ANY OF THE BLACKLISTED TITLES? if (!contains(window_title_report.window_title, "CheatAut") &amp;&amp; !contains(window_title_report.window_title, "pubg_kh") &amp;&amp; !contains(window_title_report.window_title, "conl -") &amp;&amp; !contains(window_title_report.window_title, "PerfectA") &amp;&amp; !contains(window_title_report.window_title, "AIMWA") &amp;&amp; !contains(window_title_report.window_title, "PUBG AIM") &amp;&amp; !contains(window_title_report.window_title, "HyperChe")) continue // REPORT WINDOW window_title_report.unknown_1 = 0 window_title_report.report_id = 0x33 battleye::report(&amp;window_title_report, sizeof(window_title_report) + length, 0 } }</span></span></code> </pre> <br><h2> æœç´¢å¼‚å¸¸ </h2><br> å¦‚æœæ£€æŸ¥çš„çª—å£å°‘äºä¸¤ä¸ªï¼Œåˆ™å°†é€šçŸ¥å‘é€åˆ°æœåŠ¡å™¨ã€‚ è¿™æ ·åšå¯èƒ½æ˜¯ä¸ºäº†é˜²æ­¢ä¿®è¡¥ç›¸åº”çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½ä¸å…è®¸BattlEye shellä»£ç æ£€æŸ¥ä»»ä½•çª—å£ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> window_handler::check_count() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (window_handler::windows_enumerated &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-comment"><span class="hljs-comment">// WINDOW ENUMERATION FAILED, MOST LIKELY DUE TO HOOK window_anomaly_report.unknown_1 = 0 window_anomaly_report.report_id = 0x44 window_anomaly_report.enumerated_windows = windows_enumerated battleye::report(&amp;window_anomaly_report, sizeof(window_anomaly_report), 0 }</span></span></code> </pre> <br><h2> æµç¨‹åˆ†ç±» </h2><br> é€šè¿‡è°ƒç”¨<code>CreateToolhelp32Snapshot</code>è¿­ä»£æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œä½†<strong>ä¸ä¼šå¤„ç†ä»»ä½•é”™è¯¯</strong> ï¼Œå› æ­¤éå¸¸æ˜“äºä¿®è¡¥ï¼Œå¹¶é¿å…äº†ä»¥ä¸‹æ£€æµ‹æ­¥éª¤ï¼š <br><br><h1> è·¯å¾„æ£€æŸ¥ </h1><br> å¦‚æœæ˜ åƒè‡³å°‘åœ¨ä¸¤ä¸ªå­ç›®å½•ä¸­ï¼ˆä»ç£ç›˜æ ¹ç›®å½•å¼€å§‹è®¡æ•°ï¼‰ï¼Œå¹¶ä¸”å½“å¯¹åº”æ˜ åƒçš„è·¯å¾„ä¸­è‡³å°‘åŒ…å«ä»¥ä¸‹å‡ è¡Œæ—¶ï¼Œç³»ç»Ÿå°†æ ‡è®°è¿›ç¨‹ï¼š <br><br><pre> <code class="cpp hljs">Desktop Temp FileRec Documents Downloads Roaming tmp.ex notepad. ...\. cmd.ex</code> </pre> <br> å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ä¸ä»¥ä¸‹è¡Œä¹‹ä¸€ç›¸å¯¹åº”ï¼Œåˆ™æœåŠ¡å™¨ä¼šæ”¶åˆ°æœ‰å…³å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„çš„é€šçŸ¥ï¼Œä»¥åŠæœ‰å…³çˆ¶è¿›ç¨‹æ˜¯å¦ä¸ºä»¥ä¸‹æ–‡ä»¶ä¹‹ä¸€çš„ä¿¡æ¯ï¼ˆåŒ…å«å‘é€ç»™æœåŠ¡å™¨çš„ç›¸åº”æ ‡å¿—ä½ï¼‰ï¼š <br><br><pre> <code class="cpp hljs">steam.exe [<span class="hljs-number"><span class="hljs-number">0x01</span></span>] explorer.exe [<span class="hljs-number"><span class="hljs-number">0x02</span></span>] lsass.exe [<span class="hljs-number"><span class="hljs-number">0x08</span></span>] cmd.exe [<span class="hljs-number"><span class="hljs-number">0x10</span></span>]</code> </pre> <br> å¦‚æœå®¢æˆ·ç«¯æ— æ³•ä½¿ç”¨é€‚å½“çš„<code>QueryLimitedInformation</code>æƒé™æ‰“å¼€æè¿°ç¬¦ï¼Œåˆ™å®ƒå°†è®¾ç½®æ ‡å¿—ä½<code>0x04</code> ï¼Œå¦‚æœ<code>OpenProcess</code>è°ƒç”¨å¤±è´¥æ—¶çš„é”™è¯¯åŸå› ä¸æ˜¯<code>ERROR_ACCESS_DENIED</code> ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬æä¾›ç›¸åº”æ ‡å¿—å€¼çš„æœ€åä¸€ä¸ªæšä¸¾å®¹å™¨ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> BATTLEYE_PROCESS_FLAG { STEAM = <span class="hljs-number"><span class="hljs-number">0x1</span></span>, EXPLORER = <span class="hljs-number"><span class="hljs-number">0x2</span></span>, ERROR = <span class="hljs-number"><span class="hljs-number">0x4</span></span>, LSASS = <span class="hljs-number"><span class="hljs-number">0x8</span></span>, CMD = <span class="hljs-number"><span class="hljs-number">0x10</span></span> }</code> </pre> <br> å¦‚æœçˆ¶è¿›ç¨‹æ˜¯Steamï¼Œåˆ™ç«‹å³ä¸ºç”¨æˆ·è®¾ç½®æ ‡å¿—ï¼Œå¹¶é€šè¿‡é€šçŸ¥ID <code>0x40</code>é€šçŸ¥æœåŠ¡å™¨ <br><br><h1> å›¾ç‰‡åç§° </h1><br> å¦‚æœè¯¥è¿‡ç¨‹ç¬¦åˆä¸‹é¢åˆ—å‡ºçš„è®¸å¤šæ ‡å‡†ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œé‚£ä¹ˆæ‚¨å°†ç«‹å³è®¾ç½®ä¸€ä¸ªæ ‡å¿—ï¼Œå¹¶å°†å…¶æŠ¥å‘Šç»™æœåŠ¡å™¨ï¼Œé€šçŸ¥IDä¸º<code>0x38</code> <br><br><pre> <code class="cpp hljs">   <span class="hljs-string"><span class="hljs-string">"Loadlibr"</span></span>    <span class="hljs-string"><span class="hljs-string">"Rng "</span></span>    <span class="hljs-string"><span class="hljs-string">"A0E7FFFFFF81"</span></span>    <span class="hljs-string"><span class="hljs-string">"RNG "</span></span>    <span class="hljs-string"><span class="hljs-string">"90E54355"</span></span>    <span class="hljs-string"><span class="hljs-string">"2.6.ex"</span></span>    <span class="hljs-string"><span class="hljs-string">"TempFile.exe"</span></span></code> </pre> <br><h1>  Steamæ¸¸æˆå åŠ  </h1><br>  BattlEyeç›‘è§†Steamæ¸¸æˆå åŠ è¿‡ç¨‹ï¼Œè¯¥è¿‡ç¨‹è´Ÿè´£å¤§å¤šæ•°Steamç”¨æˆ·å·²çŸ¥çš„æ¸¸æˆå†…å åŠ ã€‚  Steam Gameså åŠ å±‚çš„å®Œæ•´ä¸»æœºåæ˜¯<code>gameoverlayui.exe</code> ; ä¼—æ‰€å‘¨çŸ¥ï¼Œå®ƒç»å¸¸ç”¨äºæ¸²æŸ“æ¼æ´ï¼Œå› ä¸ºåœ¨æ¸¸æˆçª—å£ä¸­å¾ˆå®¹æ˜“è¢«é»‘å®¢å…¥ä¾µå’Œæ‰§è¡Œéæ³•æ¸²æŸ“ã€‚ éªŒè¯å…·æœ‰ä»¥ä¸‹æ¡ä»¶ï¼š <br><br><pre> <code class="cpp hljs">file size != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; image name contains (<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> insensitive) gameoverlayu</code> </pre> <br> ä¸“é—¨é’ˆå¯¹Steamæ¸¸æˆè¿›è¡Œçš„å…¶ä»–æ£€æŸ¥å‡ ä¹ä¸é’ˆå¯¹æ¸¸æˆè¿‡ç¨‹æœ¬èº«æ‰§è¡Œçš„è¿‡ç¨‹ç›¸åŒï¼Œå› æ­¤åœ¨ä¼ªä»£ç ä¸­è¢«çœç•¥äº†ã€‚ <br><br><h1>  Steamè¦†ç›–å†…å­˜æ‰«æ </h1><br> ä¼šè¦†ç›–Steamæ¸¸æˆçš„å åŠ è¿‡ç¨‹ï¼Œä»¥æŸ¥çœ‹å›¾æ¡ˆå’Œå¼‚å¸¸æƒ…å†µã€‚ æˆ‘ä»¬æ— æ³•æ·±å…¥ç ”ç©¶å…”å­æ´ï¼Œä¹Ÿæ— æ³•å‘ç°è¿™äº›æ¨¡å¼çš„ç”¨é€”ï¼Œå› ä¸ºå®ƒä»¬éå¸¸ç¬¼ç»Ÿå¹¶ä¸”å¾ˆå¯èƒ½ä¸ä½œå¼Šæ¨¡å—ç›¸å…³è”ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> gameoverlay::pattern_scan(MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-comment"><span class="hljs-comment">// PATTERNS: // Home // F1 // FFFF83C48C30000000000 // \.pipe%s // C760000C64730 // 60C01810033D2 // ... // PATTERN SCAN, ALMOST IDENTICAL CODE TO THE AFOREMENTIONED PATTERN SCANNING ROUTINE gameoverlay_memory_report.unknown_1 = 0 gameoverlay_memory_report.report_id = 0x35 gameoverlay_memory_report.identifier = 0x56C gameoverlay_memory_report.data = &amp;buffer[offset gameoverlay_memory_report.base_address = memory_information.base_address gameoverlay_memory_report.region_size = (int)memory_information.region_size gameoverlay_memory_report.memory_info = memory_information.type | memory_information.protect | memory_information.state battleye::report(&amp;gameoverlay_memory_report, sizeof(gameoverlay_memory_report), 0 }</span></span></code> </pre> <br> æ‰«æè¿‡ç¨‹è¿˜ä¼šä»¥ä¸‹è½½çš„å›¾åƒä¹‹å¤–çš„å¯æ‰§è¡Œä»£ç çš„å½¢å¼æŸ¥æ‰¾ä»»ä½•å¼‚å¸¸ï¼Œè¿™è¡¨æ˜ç ´è§£è€…å°†ä»£ç æ³¨å…¥äº†è¦†ç›–è¿‡ç¨‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> gameoverlay::memory_anomaly_scan(MEMORY_BASIC_INFORMATION memory_information) { <span class="hljs-comment"><span class="hljs-comment">// ... // ALMOST IDENTICAL ANOMALY SCAN COMPARED TO MEMORY ENUMERATION ROUTINE OF GAME PROCESS gameoverlay_report.unknown = 0 gameoverlay_report.report_id = 0x3B gameoverlay_report.base_address = memory_information.base_address gameoverlay_report.region_size = memory_information.region_size gameoverlay_report.memory_info = memory_information.type | memory_information.protect | memory_information.state battleye::report(&amp;gameoverlay_report, sizeof(gameoverlay_report), 0 }</span></span></code> </pre> <br><h1>  Steamæ¸¸æˆè¦†ç›–ä¿æŠ¤ </h1><br> å¦‚æœè¦†ç›–Steamæ¸¸æˆçš„è¿›ç¨‹å—åˆ°Windowsè¿›ç¨‹ï¼ˆä¾‹å¦‚<em>Lightï¼ˆWinTcbï¼‰ï¼‰</em>çš„æŸç§ä¿æŠ¤ï¼Œåˆ™æœåŠ¡å™¨å°†æ”¶åˆ°æœ‰å…³å®ƒçš„é€šçŸ¥ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> gameoverlay::protection_check(HANDLE process_handle) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> process_protection = <span class="hljs-number"><span class="hljs-number">0</span></span> NtQueryInformationProcess( process_handle, ProcessProtectionInformation, &amp;process_protection, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(process_protection), <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (process_protection == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// NO PROTECTION return gameoverlay_protected_report.unknown = 0 gameoverlay_protected_report.report_id = 0x35 gameoverlay_protected_report.identifier = 0x5B1 gameoverlay_protected_report.data = process_protection battleye::report(&amp;gameoverlay_protected_report, sizeof(gameoverlay_protected_report), 0 }</span></span></code> </pre> <br> å¦å¤–ï¼Œå¦‚æœç›¸åº”çš„<em>OpenProcess</em>è°ƒç”¨å°†<em>ERROR_ACCESS_DENIED</em>è¿”å›åˆ°å åŠ è¿‡ç¨‹ï¼Œåˆ™ä¼šå‘é€æœ‰å…³IDä¸º<code>3B</code>çš„ç”¨æˆ·çš„é€šçŸ¥ã€‚ <br><br><h1> åˆ†ç±»æ¨¡å— </h1><br> è¿˜æœç´¢Steamæ¸¸æˆè¦†ç›–è¿‡ç¨‹æ¨¡å—ï¼Œå°¤å…¶<code>gameoverlayui.dll</code> <code>vgui2_s.dll</code>å’Œ<code>gameoverlayui.dll</code> ã€‚ ä»<code>gameoverlayui.dll</code>å¼€å§‹ï¼Œå¯¹è¿™äº›æ¨¡å—è¿›è¡Œäº†å‡ æ¬¡æ£€æŸ¥ã€‚ <br><br> å¦‚æœæ»¡è¶³æ­¤æ¡ä»¶ï¼š <code>[gameoverlayui.dll+6C779] == 08BE55DC3CCCCB8????????C3CCCCCC</code> ï¼Œåˆ™<code>[gameoverlayui.dll+6C779] == 08BE55DC3CCCCB8????????C3CCCCCC</code>æ‰«æä»¥å­—èŠ‚ä¸ºå•ä½å­˜å‚¨çš„åœ°å€å¤„çš„vtable <code>????????</code>  ã€‚ å¦‚æœè¿™äº›vtableå…ƒç´ ä¸­çš„ä»»ä½•ä¸€ä¸ªåœ¨æºæ¨¡å—gameoverlayui.dllä¹‹å¤–æˆ–æŒ‡å‘<code>int 3</code>æŒ‡ä»¤ï¼Œåˆ™å°†å‘ç”¨æˆ·æŠ¥å‘Šé€šçŸ¥IDä¸º<code>3B</code>çš„æœåŠ¡å™¨ã€‚ <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> gameoverlay::scan_vtable(HANDLE process_handle, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* buffer, MODULEENTRY32 module_entry) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> function_buffer[<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (vtable_index = <span class="hljs-number"><span class="hljs-number">0</span></span> vtable_index &lt; <span class="hljs-number"><span class="hljs-number">20</span></span> vtable_index += <span class="hljs-number"><span class="hljs-number">4</span></span>) { NtReadVirtualMemory( process_handle, *(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)&amp;buffer[vtable_index], &amp;function_buffer, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(function_buffer), <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)&amp;buffer[vtable_index] &lt; module_entry.modBaseAddr || *(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)&amp;buffer[vtable_index] &gt;= module_entry.modBaseAddr + module_entry.modBaseSize || function_buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">0xCC</span></span> ) <span class="hljs-comment"><span class="hljs-comment">// FUNCTION PADDING { gameoverlay_vtable_report.report_id = 0x3B gameoverlay_vtable_report.vtable_index = vtable_index gameoverlay_vtable_report.address = buffer[vtable_index battleye::report(&amp;gameoverlay_vtable_report, sizeof(gameoverlay_vtable_report), 0 } } }</span></span></code> </pre> <br> è¿˜å¯¹<code>vgui2_s.dll</code>æ¨¡å—æ‰§è¡Œäº†ç‰¹å®šçš„éªŒè¯è¿‡ç¨‹ï¼š <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> vgui::scan() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!equals(vgui_buffer, <span class="hljs-string"><span class="hljs-string">"6A08B31FF561C8BD??????????FF96????????8BD????????8B1FF90"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> could_read = NtReadVirtualMemory( process_handle, module_entry.modBaseAddr + <span class="hljs-number"><span class="hljs-number">0x48338</span></span>, vgui_buffer, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pattern_offset = <span class="hljs-number"><span class="hljs-number">0x48378</span></span> <span class="hljs-comment"><span class="hljs-comment">// IF READ DID NOT FAIL AND PATTERN IS FOUND if (could_read &amp;&amp; equals(vgui_buffer, "6A46A06A26A")) { vgui_report.unknown_1 = 0 vgui_report.report_id = 0x3B vgui_report.unknown_2 = 0 vgui_report.address = LODWORD(module_entry.modBaseAddr) + pattern_offset // READ TARGET BUFFER INTO REPORT NtReadVirtualMemory( process_handle, module_entry.modBaseAddr + pattern_offset, vgui_report.buffer, sizeof(vgui_report.buffer), 0 battleye::report(&amp;vgui_report, sizeof(vgui_report), 0 } } else if ( // READ ADDRESS FROM CODE NtReadVirtualMemory(process_handle, *(int*)&amp;vgui_buffer[9], vgui_buffer, 4, 0) &gt;= 0 &amp;&amp; // READ POINTER TO CLASS NtReadVirtualMemory(process_handle, *(int*)vgui_buffer, vgui_buffer, 4, 0) &gt;= 0 &amp;&amp; // READ POINTER TO VIRTUAL TABLE NtReadVirtualMemory(process_handle, *(int*)vgui_buffer, vgui_buffer, sizeof(vgui_buffer), 0) &gt;= 0) { for (vtable_index = 0 vtable_index &lt; 984 vtable_index += 4 ) // 984/4 VTABLE ENTRY COUNT { NtReadVirtualMemory(process_handle, *(int*)&amp;vgui_buffer[vtable_index], &amp;vtable_entry, sizeof(vtable_entry), 0 if (*(int*)&amp;vgui_buffer[vtable_index] &lt; module_entry.modBaseAddr || *(int*)&amp;vgui_buffer[vtable_index] &gt;= module_entry.modBaseAddr + module_entry.modBaseSize || vtable_entry == 0xCC ) { vgui_vtable_report.unknown = 0 vgui_vtable_report.report_id = 0x3B vgui_vtable_report.vtable_index = vtable_index vgui_vtable_report.address = *(int*)&amp;vgui_buffer[vtable_index battleye::report(&amp;vgui_vtable_report, sizeof(vgui_vtable_report), 0 } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ­¤è¿‡ç¨‹æ£€æŸ¥offsetçš„å˜åŒ–ï¼Œoffset </font></font><code>48378</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ˜¯ä»£ç åŒºåŸŸçš„ä½ç½®ï¼š</font></font><br><br><pre> <code class="cpp hljs">push <span class="hljs-number"><span class="hljs-number">04</span></span> push offset aCBuildslaveSte_4 ; <span class="hljs-string"><span class="hljs-string">"c:\buildslave\steam_rel_client_win32"</span></span>... push offset aAssertionFaile_7 ; <span class="hljs-string"><span class="hljs-string">"Assertion Failed: IsValidIndex(elem)"</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç„¶åï¼Œè¯¥è¿‡ç¨‹å°†æ£€æŸ¥éå¸¸å…·ä½“ä¸”çœ‹ä¼¼æ— ç”¨çš„æ›´æ”¹ï¼š </font></font><br><br><pre> <code class="cpp hljs">push <span class="hljs-number"><span class="hljs-number">04</span></span> push <span class="hljs-number"><span class="hljs-number">00</span></span> push <span class="hljs-number"><span class="hljs-number">02</span></span> push ??</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æˆ‘ä»¬æ‰¾ä¸åˆ°ä¸ä¸Šè¿°ä¸¤é¡¹æ£€æŸ¥ä¸­çš„ç¬¬ä¸€é¡¹éƒ½ä¸åŒ¹é…çš„vgui2_s.dllå‰¯æœ¬ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•æ‰¾åˆ°å®ƒæ£€æŸ¥çš„vtableã€‚ </font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> è’¸æ±½è¦†ç›–æµ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> åœ¨å åŠ Steamæ¸¸æˆè¿‡ç¨‹ä¸­çš„æµä¹Ÿä¼šç§»åŠ¨ï¼š </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> gameoverlay::check_thread(THREADENTRY32 thread_entry) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> tread_handle = OpenThread(THREAD_SUSPEND_RESUME|THREAD_GET_CONTEXT, <span class="hljs-number"><span class="hljs-number">0</span></span>, thread_entry.th32ThreadID <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (thread_handle) { suspend_count = ResumeThread(thread_handle <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (suspend_count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { SuspendThread(thread_handle gameoverlay_thread_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> gameoverlay_thread_report.report_id = <span class="hljs-number"><span class="hljs-number">0x3B</span></span> gameoverlay_thread_report.suspend_count = suspend_count battleye::report(&amp;gameoverlay_thread_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(gameoverlay_thread_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetThreadContext(thread_handle, &amp;context) &amp;&amp; context.Dr7) { gameoverlay_debug_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> gameoverlay_debug_report.report_id = <span class="hljs-number"><span class="hljs-number">0x3B</span></span> gameoverlay_debug_report.debug_register = context.Dr0 battleye::report(&amp;gameoverlay_debug_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(gameoverlay_debug_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æœ€å°äºŒä¹˜ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsass.exe</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">è¿›ç¨‹</font><font style="vertical-align: inherit;">ï¼ˆä¹Ÿç§°ä¸ºâ€œæœ¬åœ°å®‰å…¨æˆæƒâ€è¿›ç¨‹ï¼‰</font><font style="vertical-align: inherit;">çš„å†…å­˜åœ°å€ç©ºé—´</font><font style="vertical-align: inherit;">ä¹Ÿå°†è¢«æ‰«æï¼Œå¹¶å°†æ‰€æœ‰å¼‚å¸¸æŠ¥å‘Šç»™æœåŠ¡å™¨ï¼Œå°±åƒä¹‹å‰çš„ä¸¤æ¬¡æ£€æŸ¥ä¸€æ ·ï¼š</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (equals(process_entry.executable_path, <span class="hljs-string"><span class="hljs-string">"lsass.exe"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> lsass_handle = OpenProcess(QueryInformation, <span class="hljs-number"><span class="hljs-number">0</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)process_entry.th32ProcessID <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lsass_handle) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (address = <span class="hljs-number"><span class="hljs-number">0</span></span> NtQueryVirtualMemory(lsass_handle, address, <span class="hljs-number"><span class="hljs-number">0</span></span>, &amp;lsass_memory_info, <span class="hljs-number"><span class="hljs-number">0x30</span></span>, &amp;bytes_needed) &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> address = lsass_memory_info.base_address + lsass_memory_info.region_size) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lsass_memory_info.state == MEM_COMMIT &amp;&amp; lsass_memory_info.type == MEM_PRIVATE &amp;&amp; (lsass_memory_info.protect == PAGE_EXECUTE || lsass_memory_info.protect == PAGE_EXECUTE_READ || lsass_memory_info.protect == PAGE_EXECUTE_READWRITE)) { <span class="hljs-comment"><span class="hljs-comment">// FOUND EXECUTABLE MEMORY OUTSIDE OF MODULES lsass_report.unknown = 0 lsass_report.report_id = 0x42 lsass_report.base_address = lsass_memory_info.base_address lsass_report.region_size = lsass_memory_info.region_size lsass_report.memory_info = lsass_memory_info.type | lsass_memory_info.protect | lsass_memory_info.state battleye::report(&amp;lsass_report, sizeof(lsass_report), 0 } } CloseHandle(lsass_handle } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LSASSä»¥å‰æ›¾åœ¨æ¼æ´åˆ©ç”¨ç¨‹åºä¸­ç”¨äºæ‰§è¡Œå†…å­˜æ“ä½œï¼Œå› ä¸ºä»»ä½•éœ€è¦Internetè¿æ¥çš„è¿›ç¨‹éƒ½å¿…é¡»æä¾›LSASSè®¿é—®æƒé™ã€‚</font><font style="vertical-align: inherit;">BattlEyeå½“å‰æ­£åœ¨é€šè¿‡æ‰‹åŠ¨ä»è¯»å–/å†™å…¥æ“ä½œä¸­æ¸…é™¤è¿›ç¨‹å¥æŸ„ï¼Œç„¶å</font><font style="vertical-align: inherit;">é™„åŠ </font></font><code>ReadProcessMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ </font></font><code>WriteProcessMemory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ï¼Œå°†è°ƒç”¨é‡å®šå‘åˆ°å…¶BEDaisyé©±åŠ¨ç¨‹åºæ¥</font><font style="vertical-align: inherit;">å¤„ç†æ­¤é—®é¢˜</font><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ¥ä¸‹æ¥ï¼ŒBEDaisyå†³å®šå­˜å‚¨æ“ä½œæ˜¯å¦åˆæ³•ã€‚</font><font style="vertical-align: inherit;">å¦‚æœä»–è®¤ä¸ºè¯¥æ“ä½œæ˜¯åˆæ³•çš„ï¼Œåˆ™ç»§ç»­è¿›è¡Œæ“ä½œï¼Œå¦åˆ™æœ‰æ„åœ°å°†æœºå™¨æ‰“å¼€è“å±ã€‚</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å„ç§é€šçŸ¥ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BattlEyeæ”¶é›†å„ç§ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¸é€šçŸ¥IDä¸€èµ·å‘é€åˆ°æœåŠ¡å™¨</font></font><code>3C</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">æ­¤ä¿¡æ¯åŒ…å«ä»¥ä¸‹å…ƒç´ ï¼š</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¸¦æœ‰</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WS_EX_TOPMOST</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ ‡å¿—</font><font style="vertical-align: inherit;">æˆ–å…¶ç±»ä¼¼ç‰©çš„</font><font style="vertical-align: inherit;">ä»»ä½•çª—å£</font><font style="vertical-align: inherit;">ï¼š</font></font><ul><li>   (Unicode) </li><li>    (Unicode) </li><li> Window style </li><li> Window extended style </li><li>   </li><li>    - </li><li>   - </li></ul></li><li>        (VM_WRITE|VM_READ) <ul><li>   </li><li>    </li><li>   </li><li>    </li></ul></li><li>    : <br><ul><li> â€¦.ContentPaksTslGame-WindowsNoEditor_assets_world.pak </li><li> â€¦.ContentPaksTslGame-WindowsNoEditor_ui.pak </li><li> â€¦.ContentPaksTslGame-WindowsNoEditor_sound.pak </li></ul><br></li><li>    : <br><ul><li> â€¦.BLGameCookedContentScriptBLGame.u </li></ul></li><li>    NtGetContextThread <br><ul><li>     (E9),       </li></ul></li></ul><br><h2> NoEye </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BattlEyeå®ç°äº†ä¸€ä¸ªç›¸å½“æ‡’æƒ°çš„æ£€æŸ¥ï¼Œä»¥æ£€æµ‹å¯è®¿é—®çš„å…¬å…±Rootkitç»•è¿‡ç§°ä¸ºNoEyeçš„åä½œå¼Šï¼š</font><font style="vertical-align: inherit;">å¦‚æœåœ¨ç£ç›˜ä¸Šæ‰¾åˆ°äº†è¯¥åº“ï¼Œåˆ™</font><font style="vertical-align: inherit;">ç³»ç»Ÿä½¿ç”¨</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetFileAttributesExAæ¥</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥æ–‡ä»¶å¤§å°</font></font><code>BE_DLL.dll</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> noeye::detect() { <span class="hljs-function"><span class="hljs-function">WIN32_FILE_ATTRIBUTE_DATA file_information </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(GetFileAttributesExA(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"BE_DLL.dll"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, &amp;file_information))</span></span></span><span class="hljs-function"> </span></span>{ noeye_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> noeye_report.report_id = <span class="hljs-number"><span class="hljs-number">0x3D</span></span> noeye_report.file_size = file_information.nFileSizeLow battleye::report(&amp;noeye_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(noeye_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é©±åŠ¨ç¨‹åºå¯ç”¨æ€§ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ£€æŸ¥å“”å£°å’Œç©ºè®¾å¤‡ï¼›</font><font style="vertical-align: inherit;">å¦‚æœæœ‰ï¼Œå°†ç”Ÿæˆé€šçŸ¥ã€‚</font><font style="vertical-align: inherit;">åœ¨æ­£å¸¸çŠ¶æ€ä¸‹ï¼Œè¿™ä¸¤ä¸ªè®¾å¤‡åœ¨ç³»ç»Ÿä¸­ä¸å¯ç”¨ï¼Œè¿™å¯èƒ½è¡¨æ˜æœ‰äººæ‰‹åŠ¨æ‰“å¼€äº†è¯¥è®¾å¤‡ã€‚</font><font style="vertical-align: inherit;">æ­¤æŠ€æœ¯ç§°ä¸ºé©±åŠ¨ç¨‹åºè®¾å¤‡åŠ«æŒã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ä¸ºäº†ç¡®ä¿ä¸æ¶æ„é©±åŠ¨ç¨‹åºäº¤æ¢IOCTLæ•°æ®ï¼Œè€Œæ— éœ€ä¸ºæ­¤é©±åŠ¨ç¨‹åºä½¿ç”¨å•ç‹¬çš„é©±åŠ¨ç¨‹åºå¯¹è±¡ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> driver::check_beep() { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> handle = CreateFileA(<span class="hljs-string"><span class="hljs-string">"\\.\Beep"</span></span>, GENERIC_READ, FILE_SHARE_READ | FILE_SHARE_WRITE, <span class="hljs-number"><span class="hljs-number">0</span></span>, OPEN_EXISTING, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handle != INVALID_HANDLE_VALUE) { beep_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> beep_report.report_id = <span class="hljs-number"><span class="hljs-number">0x3E</span></span> battleye::report(&amp;beep_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(beep_report), <span class="hljs-number"><span class="hljs-number">0</span></span> CloseHandle(handle } }</code> </pre> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> driver::check_null() { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> handle = CreateFileA(<span class="hljs-string"><span class="hljs-string">"\\.\Null"</span></span>, GENERIC_READ, FILE_SHARE_READ | FILE_SHARE_WRITE, <span class="hljs-number"><span class="hljs-number">0</span></span>, OPEN_EXISTING, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handle != INVALID_HANDLE_VALUE) { null_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> null_report.report_id = <span class="hljs-number"><span class="hljs-number">0x3E</span></span> battleye::report(&amp;null_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(null_report), <span class="hljs-number"><span class="hljs-number">0</span></span> CloseHandle(handle } }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¡çœ ä¸‰è§’æ´² </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å¦å¤–ï¼ŒBattlEyeå¯ä»¥ä»å½“å‰çº¿ç¨‹è¯·æ±‚ä¸€ç§’é’Ÿçš„ä¸æ´»åŠ¨çŠ¶æ€ï¼Œå¹¶æµ‹é‡ä¸æ´»åŠ¨ï¼ˆç¡çœ ï¼‰å‰åçš„å‘¨æœŸæ•°ä¹‹å·®ï¼š </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> sleep::check_delta() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> tick_count = GetTickCount Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> tick_delta = GetTickCount() - tick_count <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tick_delta &gt;= <span class="hljs-number"><span class="hljs-number">1200</span></span>) { sleep_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> sleep_report.report_id = <span class="hljs-number"><span class="hljs-number">0x45</span></span> sleep_report.delta = tick_delta battleye::report(&amp;sleep_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(sleep_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7zip </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BattlEyeä¸­æ·»åŠ äº†ä¸€ä¸ªéå¸¸æ‡’æƒ°çš„å®Œæ•´æ€§æ£€æŸ¥ï¼Œå› æ­¤ç”¨æˆ·æ— æ³•å°†7zipåº“åŠ è½½åˆ°æ¸¸æˆè¿›ç¨‹å’Œè¦†ç›–åŒºåŸŸä¸­ã€‚</font><font style="vertical-align: inherit;">è¿™æ˜¯ç”±ç”¨æˆ·å®Œæˆçš„ï¼Œç›®çš„æ˜¯é™ä½å…ˆå‰æè¿°çš„æ¨¡å¼æ‰«æå’Œå¼‚å¸¸æ£€æµ‹çš„ä¸¥é‡æ€§ã€‚</font><font style="vertical-align: inherit;">BattlEyeåªæ˜¯å†³å®šä¸ºæ­¤ç‰¹å®šçš„7zipåº“æ·»åŠ å®Œæ•´æ€§æ£€æŸ¥ã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_7zip() { <span class="hljs-keyword"><span class="hljs-keyword">constexpr</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> sz_7zipdll = <span class="hljs-string"><span class="hljs-string">"..\..\Plugins\ZipUtility\ThirdParty\7zpp\dll\Win64\7z.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(sz_7zipdll <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle &amp;&amp; *(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1000</span></span>) != <span class="hljs-number"><span class="hljs-number">0xFF1441C7</span></span>) { sevenzip_report.unknown_1 = <span class="hljs-number"><span class="hljs-number">0</span></span> sevenzip_report.report_id = <span class="hljs-number"><span class="hljs-number">0x46</span></span> sevenzip_report.unknown_2 = <span class="hljs-number"><span class="hljs-number">0</span></span> sevenzip_report.data1 = *(__int64*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1000</span></span> sevenzip_report.data2 = *(__int64*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1008</span></span> battleye::report(&amp;sevenzip_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(sevenzip_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç¡¬ä»¶æŠ½è±¡å±‚ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> BattlEyeæ£€æŸ¥æ˜¯å¦å­˜åœ¨åŠ¨æ€é“¾æ¥çš„Windowsç¡¬ä»¶æŠ½è±¡å±‚åº“ï¼ˆhal.dllï¼‰ï¼Œå¹¶å‘ŠçŸ¥æœåŠ¡å™¨æ˜¯å¦åœ¨æ¸¸æˆä¸­åŠ è½½äº†è¯¥åº“ã€‚ </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_hal() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"hal.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { hal_report.unknown_1 = <span class="hljs-number"><span class="hljs-number">0</span></span> hal_report.report_id = <span class="hljs-number"><span class="hljs-number">0x46</span></span> hal_report.unknown_2 = <span class="hljs-number"><span class="hljs-number">2</span></span> hal_report.data1 = *(__int64*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1000</span></span> hal_report.data2 = *(__int64*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1008</span></span> battleye::report(&amp;hal_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(hal_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> å›¾åƒæ£€æŸ¥ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BattlEyeè¿˜æ£€æŸ¥åŠ è½½åˆ°æ¸¸æˆä¸­çš„å„ç§å›¾åƒã€‚</font><font style="vertical-align: inherit;">è¿™äº›æ¨¡å—è¢«è®¤ä¸ºæ˜¯ç»è¿‡ç­¾åçš„å›¾åƒï¼Œå®ƒä»¬ä»¥æŸç§æ–¹å¼è¢«æ“çºµï¼Œå°†å…¶è¡Œä¸ºæ”¹å˜ä¸ºæ¶æ„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½å†è°ˆè®ºå®ƒä»¬äº†ï¼Œè€Œä»…æ˜¯å…³äºå®ƒä»¬çš„æ£€æµ‹ï¼š</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nvToolsExt64_1 </font></font></h1><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_nvtoolsext64_1 { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"nvToolsExt64_1.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { nvtools_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> nvtools_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> nvtools_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5A8</span></span> nvtools_report.size_of_image = (PE_HEADER*)(module_handle + (DOS_HEADER*)(module_handle)-&gt;e_lfanew))-&gt;SizeOfImage battleye::report(&amp;nvtools_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(nvtools_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ws2detour_x96 </font></font></h1><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_ws2detour_x96 { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"ws2detour_x96.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { ws2detour_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> ws2detour_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> ws2detour_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5B5</span></span> ws2detour_report.size_of_image = (PE_HEADER*)(module_handle + (DOS_HEADER*)(module_handle)-&gt;e_lfanew))-&gt;SizeOfImage battleye::report(&amp;ws2detour_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(ws2detour_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ç½‘ç»œdllx64 </font></font></h1><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_networkdllx64 { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"networkdllx64.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> dos_header = (DOS_HEADER*)module_handle <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> pe_header = (PE_HEADER*)(module_handle + dos_header-&gt;e_lfanew <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> size_of_image = pe_header-&gt;SizeOfImage <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (size_of_image &lt; <span class="hljs-number"><span class="hljs-number">0x200000</span></span> || size_of_image &gt;= <span class="hljs-number"><span class="hljs-number">0x400000</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pe_header-&gt;sections[DEBUG_DIRECTORY].size == <span class="hljs-number"><span class="hljs-number">0x1B20</span></span>) { networkdll64_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> networkdll64_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> networkdll64_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5B7</span></span> networkdll64_report.data = pe_header-&gt;TimeDatestamp battleye::report(&amp;networkdll64_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(networkdll64_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { networkdll64_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> networkdll64_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> networkdll64_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5B7</span></span> networkdll64_report.data = pe_header-&gt;sections[DEBUG_DIRECTORY].size battleye::report(&amp;networkdll64_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(networkdll64_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nxdetours_64 </font></font></h1><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_nxdetours_64 { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"nxdetours_64.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { nxdetours64_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> nxdetours64_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> nxdetours64_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5B8</span></span> nxdetours64_report.size_of_image = (PE_HEADER*)(module_handle + (DOS_HEADER*)(module_handle)-&gt;e_lfanew))-&gt;SizeOfImage battleye::report(&amp;nxdetours64_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(nxdetours64_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nvç¼–è¯‘å™¨ </font></font></h1><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_nvcompiler { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"nvcompiler.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { nvcompiler_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> nvcompiler_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> nvcompiler_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5BC</span></span> nvcompiler_report.data = *(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1000</span></span> battleye::report(&amp;nvcompiler_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(nvcompiler_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> wmp </font></font></h1><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">module</span></span>::check_wmp { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> module_handle = GetModuleHandleA(<span class="hljs-string"><span class="hljs-string">"wmp.dll"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (module_handle) { wmp_report.unknown = <span class="hljs-number"><span class="hljs-number">0</span></span> wmp_report.report_id = <span class="hljs-number"><span class="hljs-number">0x48</span></span> wmp_report.module_id = <span class="hljs-number"><span class="hljs-number">0x5BE</span></span> wmp_report.data = *(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>*)(module_handle + <span class="hljs-number"><span class="hljs-number">0x1000</span></span> battleye::report(&amp;wmp_report, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(wmp_report), <span class="hljs-number"><span class="hljs-number">0</span></span> } }</code> </pre> <br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ¨¡å—æšä¸¾æ ‡è¯†ç¬¦ </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä½œä¸ºå‚è€ƒï¼Œæˆ‘ä»¬ç»™å‡ºäº†æ¨¡å—çš„æšä¸¾IDï¼š </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> module_id { nvtoolsext64 = <span class="hljs-number"><span class="hljs-number">0x5A8</span></span>, ws2detour_x96 = <span class="hljs-number"><span class="hljs-number">0x5B5</span></span>, networkdll64 = <span class="hljs-number"><span class="hljs-number">0x5B7</span></span>, nxdetours_64 = <span class="hljs-number"><span class="hljs-number">0x5B8</span></span>, nvcompiler = <span class="hljs-number"><span class="hljs-number">0x5BC</span></span>, wmp = <span class="hljs-number"><span class="hljs-number">0x5BE</span></span></code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> æ‰«æTCPè¡¨ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BattlEye shellcodeæœç´¢æ•´ä¸ªç³»ç»Ÿçš„TCPè¿æ¥åˆ—è¡¨ï¼ˆç§°ä¸ºTCPè¡¨ï¼‰ï¼Œå¹¶æŠ¥å‘Šç”¨æˆ·æ˜¯å¦å·²è¿æ¥åˆ°å±äºå¾·å›½ä»˜è´¹ç½‘ç«™çš„Cloudflareç½‘å…³IPåœ°å€ä¸­çš„è‡³å°‘ä¸€ä¸ª-cheatç§°ä¸º</font></font><a href="https://xera.ph/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xera.ph</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚æ­¤æœºåˆ¶å·²æ·»åŠ åˆ°å¤–å£³ç¨‹åºä»£ç ä¸­ï¼Œä»¥æ£€æµ‹åœ¨æ¸¸æˆè¿è¡Œæ—¶æ­£åœ¨è¿è¡Œå¯åŠ¨å™¨çš„ç”¨æˆ·ï¼Œä»è€Œä½¿å…¶æ˜“äºè¯†åˆ«ã€‚è¿™ç§æœºåˆ¶çš„å”¯ä¸€é—®é¢˜æ˜¯Cloudflareç½‘å…³çš„IPåœ°å€å¯ä»¥ç¨åæ›´æ”¹æ‰€æœ‰è€…ã€‚å¹¶ä¸”ï¼Œå¦‚æœä»–ä»¬çš„æ–°æ‰€æœ‰è€…åˆ†å‘é€šè¿‡ç‰¹å®šç«¯å£è¿æ¥åˆ°å…¶æœåŠ¡å™¨çš„è½¯ä»¶ï¼Œé‚£ä¹ˆæ¯«æ— ç–‘é—®ä¼šå‡ºç°è¯¯æŠ¥åæ¬ºè¯ˆè§¦å‘ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ä»˜è´¹ä½œå¼Š</font><em><font style="vertical-align: inherit;">xera.ph</font></em><font style="vertical-align: inherit;">æœåŠ¡æä¾›å•†</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç”¨æˆ·</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œä»–ä»¬ä¸€ç›´åœ¨æŠ¥å‘Šè‡ªå·±è¢«æ•è·ï¼Œå¼€å‘äººå‘˜æ— æ³•ä»¥ä»»ä½•æ–¹å¼å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xera.ph</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">çš„å¼€å‘äººå‘˜è”ç³»ï¼Œ</font><font style="vertical-align: inherit;">ä»¥å‘ŠçŸ¥ä»–ä»¬ä»–ä»¬çš„æ„šè ¢è¡Œä¸ºï¼Œä½†æ˜¯ä»–ä»¬è¯¯è§£äº†æˆ‘ä»¬ï¼Œå¹¶å‘æˆ‘ä»¬å‘é€äº†å…è´¹å‰¯æœ¬ï¼Œå´æ²¡æœ‰æƒ³åˆ°æˆ‘ä»¬å¯ä»¥é»‘å®¢å¹¶é‡Šæ”¾å®ƒã€‚</font><font style="vertical-align: inherit;">æˆ‘ä»¬ä¸ä¼šè¿™æ ·åšï¼Œä½†æ‚¨å¯èƒ½ä¸åº”è¯¥å…è´¹å‘å‚ä¸é€†å‘å·¥ç¨‹çš„äººå‘˜å…è´¹å‘é€ä¸“æœ‰è®¸å¯çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å¸Œæœ›å®ƒä»¬ä¸ä¼šè¢«ç›—ç‰ˆã€‚</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> network::scan_tcp_table { <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(local_port_buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(local_port_buffer <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (iteration_index = <span class="hljs-number"><span class="hljs-number">0</span></span> iteration_index &lt; <span class="hljs-number"><span class="hljs-number">500</span></span> ++iteration_index) { <span class="hljs-comment"><span class="hljs-comment">// GET NECESSARY SIZE OF TCP TABLE auto table_size = 0 GetExtendedTcpTable(0, &amp;table_size, false, AF_INET, TCP_TABLE_OWNER_MODULE_ALL, 0 // ALLOCATE BUFFER OF PROPER SIZE FOR TCP TABLE auto allocated_ip_table = (MIB_TCPTABLE_OWNER_MODULE*)malloc(table_size if (GetExtendedTcpTable(allocated_ip_table, &amp;table_size, false, AF_INET, TCP_TABLE_OWNER_MODULE_ALL, 0) != NO_ERROR) goto cleanup for (entry_index = 0 entry_index &lt; allocated_ip_table-&gt;dwNumEntries ++entry_index) { const auto ip_address_match_1 = allocated_ip_table-&gt;table[entry_index].dwRemoteAddr == 0x656B1468 // 104.20.107.101 const auto ip_address_match_2 = allocated_ip_table-&gt;table[entry_index].dwRemoteAddr == 0x656C1468 // 104.20.108.101 const auto port_match = allocated_ip_table-&gt;table[entry_index].dwRemotePort == 20480 if ( (!ip_address_match_1 &amp;&amp; !ip_address_match_2) || !port_match) continue for (port_index = 0 port_index &lt; 10 &amp;&amp; allocated_ip_table-&gt;table[entry_index].dwLocalPort != local_port_buffer[port_index ++port_index) { if (local_port_buffer[port_index]) continue tcp_table_report.unknown = 0 tcp_table_report.report_id = 0x48 tcp_table_report.module_id = 0x5B9 tcp_table_report.data = BYTE1(allocated_ip_table-&gt;table[entry_index].dwLocalPort) | (LOBYTE(allocated_ip_table-&gt;table[entry_index.dwLocalPort) &lt;&lt; 8 battleye::report(&amp;tcp_table_report, sizeof(tcp_table_report), 0 local_port_buffer[port_index] = allocated_ip_table-&gt;table[entry_index].dwLocalPort break } } cleanup: // FREE TABLE AND SLEEP free(allocated_ip_table Sleep(10 } }</span></span></code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> é€šçŸ¥ç±»å‹ </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ä»¥ä¸‹æ˜¯Shellä»£ç ä¸­æ‰€æœ‰å·²çŸ¥é€šçŸ¥ç±»å‹çš„å‚è€ƒï¼š </font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> BATTLEYE_REPORT_ID { MEMORY_GUARD = <span class="hljs-number"><span class="hljs-number">0x21</span></span>, MEMORY_SUSPICIOUS = <span class="hljs-number"><span class="hljs-number">0x2F</span></span>, WINDOW_TITLE = <span class="hljs-number"><span class="hljs-number">0x33</span></span>, MEMORY = <span class="hljs-number"><span class="hljs-number">0x35</span></span>, PROCESS_ANOMALY = <span class="hljs-number"><span class="hljs-number">0x38</span></span>, DRIVER_BEEP_PRESENCE = <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, DRIVER_NULL_PRESENCE = <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, MISCELLANEOUS_ANOMALY = <span class="hljs-number"><span class="hljs-number">0x3B</span></span>, PROCESS_SUSPICIOUS = <span class="hljs-number"><span class="hljs-number">0x40</span></span>, LSASS_MEMORY = <span class="hljs-number"><span class="hljs-number">0x42</span></span>, SLEEP_ANOMALY = <span class="hljs-number"><span class="hljs-number">0x45</span></span>, MEMORY_MODULE_SPECIFIC = <span class="hljs-number"><span class="hljs-number">0x46</span></span>, GENERIC_ANOMALY = <span class="hljs-number"><span class="hljs-number">0x48</span></span>, MEMORY_MODULE_SPECIFIC2 = <span class="hljs-number"><span class="hljs-number">0x5B</span></span>, }</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN483068/">https://habr.com/ru/post/zh-CN483068/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN483054/index.html">â€œå°†ä¸ä¼šå‘ç”Ÿå¤§å± æ€â€-The Wormç¿»è¯‘çš„æ•…äº‹</a></li>
<li><a href="../zh-CN483056/index.html">æ•°æ®åº“ä¸­çš„é€»è¾‘å­—æ®µï¼Œæ˜¯å¦æœ‰è§£è¯ï¼Ÿ</a></li>
<li><a href="../zh-CN483058/index.html">å‡æœŸè°ƒæŸ¥ç»“æœ</a></li>
<li><a href="../zh-CN483064/index.html">Vueæ˜¯æ‰€æœ‰æ³•è§„ä¸Šæœ€å°çš„akaå°åšå®¢</a></li>
<li><a href="../zh-CN483066/index.html">æ¯”å°”Â·ç›–èŒ¨çš„ä¼ ç»Ÿäº”æœ¬ä¹¦</a></li>
<li><a href="../zh-CN483074/index.html">TensorRT 6.xxx-æ·±åº¦å­¦ä¹ æ¨¡å‹çš„é«˜æ€§èƒ½æ¨ç†ï¼ˆå¯¹è±¡æ£€æµ‹å’Œåˆ†æ®µï¼‰</a></li>
<li><a href="../zh-CN483076/index.html">2020å¹´ç”¨äºAndroid Appå¼€å‘çš„é¡¶çº§ç¼–ç¨‹è¯­è¨€</a></li>
<li><a href="../zh-CN483078/index.html">æ·±åº¦å¼ºåŒ–å­¦ä¹ ï¼šå¦‚ä½•æ•™èœ˜è››èµ°è·¯</a></li>
<li><a href="../zh-CN483082/index.html">æ¼æ´æœå¯»æ•ˆç‡æé«˜7ï¼…</a></li>
<li><a href="../zh-CN483084/index.html">å…·æœ‰è·Ÿè¸ªåŠŸèƒ½çš„ç›¸æœº</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>