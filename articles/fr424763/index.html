<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ–•ğŸ½ ğŸˆµ ğŸ¸ Un Ã©diteur de texte n'est pas votre plus haute mathÃ©matique, vous devez penser ici ğŸ‘©ğŸ»â€ğŸ¨ ğŸ“ª ğŸ¤²ğŸ»</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les Ã©diteurs de texte modernes peuvent non seulement Ã©mettre un bip et ne pas quitter le programme. Il s'avÃ¨re qu'un mÃ©tabolisme trÃ¨s complexe bout en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un Ã©diteur de texte n'est pas votre plus haute mathÃ©matique, vous devez penser ici</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/424763/"> Les Ã©diteurs de texte modernes peuvent non seulement Ã©mettre un bip et ne pas quitter le programme.  Il s'avÃ¨re qu'un mÃ©tabolisme trÃ¨s complexe bout en eux.  Vous voulez savoir quelles astuces sont effectuÃ©es pour recalculer rapidement les coordonnÃ©es, comment les styles, les plis et les enveloppements logiciels sont attachÃ©s au texte et comment tout est mis Ã  jour, qu'est-ce que la structure de donnÃ©es fonctionnelles et la file d'attente prioritaire ont Ã  voir avec cela, ainsi que comment tromper l'utilisateur - bienvenue au chat! <br><br><img src="https://habrastorage.org/webt/sr/i0/vg/sri0vg3jog_-mc16jc5zz-wjxw0.jpeg"><br><br>  L'article est basÃ© sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport d'</a> Alexei Kudryavtsev avec Joker 2017. Alexei Ã©crit Intellij IDEA dans JetBrains depuis environ 10 ans.  Sous la coupe, vous trouverez la vidÃ©o et la transcription textuelle du rapport. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YzWr9CN6cGQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h1>  Structures de donnÃ©es Ã  l'intÃ©rieur des Ã©diteurs de texte </h1><br>  Pour comprendre comment l'Ã©diteur fonctionne, Ã©crivons-le. <br><br><img src="https://habrastorage.org/webt/q9/nb/-n/q9nb-nr675yuu19v6loydkq3nrm.png"><br><br>  VoilÃ , notre Ã©diteur le plus simple est prÃªt. <br><br>  Ã€ l'intÃ©rieur de l'Ã©diteur, le texte est plus facile Ã  stocker dans un tableau de caractÃ¨res ou, ce qui est le mÃªme (en termes d'organisation de la mÃ©moire), dans la classe Java StringBuffer.  Pour obtenir du caractÃ¨re par dÃ©calage, nous appelons la mÃ©thode StringBuffer.charAt (i).  Et pour y insÃ©rer le caractÃ¨re que nous avons tapÃ© sur le clavier, nous appelons la mÃ©thode StringBuffer.insert (), qui insÃ¨re le caractÃ¨re quelque part au milieu. <br><br>  Ce qui est le plus intÃ©ressant, malgrÃ© toute la simplicitÃ© et l'idiotie de cet Ã©diteur, c'est la meilleure idÃ©e que l'on puisse inventer.  C'est Ã  la fois simple et presque toujours rapide. <br><br>  Malheureusement, un problÃ¨me d'Ã©chelle se pose avec cet Ã©diteur.  Imaginez que nous y imprimions beaucoup de texte et que nous allons insÃ©rer une autre lettre au milieu.  Les Ã©vÃ©nements suivants se produiront.  Nous devons de toute urgence libÃ©rer de l'espace pour cette lettre en dÃ©plaÃ§ant toutes les autres lettres d'un caractÃ¨re vers l'avant.  Pour ce faire, nous dÃ©calons cette lettre d'une position, puis de la suivante et ainsi de suite, jusqu'Ã  la fin du texte. <br><br>  Voici Ã  quoi cela ressemblerait en mÃ©moire: <br><br><img src="https://habrastorage.org/webt/ec/uk/r4/ecukr4oxdmj0tlxojojwuf9k8i4.gif"><br><br>  DÃ©caler tous ces mÃ©gaoctets n'est pas trÃ¨s bon: c'est lent.  Bien sÃ»r, pour un ordinateur moderne, c'est une affaire insignifiante - une sorte de mÃ©gaoctets pathÃ©tiques pour se dÃ©placer d'avant en arriÃ¨re.  Mais pour un changement de texte trÃ¨s actif, cela peut Ãªtre perceptible. <br><br>  Pour rÃ©soudre ce problÃ¨me d'insertion d'un personnage au milieu, il y a longtemps est venu une solution de contournement appelÃ©e "Gap Buffer". <br><br><h3>  Tampon d'espace </h3><br>  L'Ã©cart est l'Ã©cart.  Le tampon est, comme vous pouvez l'imaginer, un tampon.  La structure de donnÃ©es Gap Buffer est un tel tampon vide que nous gardons au milieu de notre texte, juste au cas oÃ¹.  Si nous avions besoin d'imprimer quelque chose, nous utilisons ce petit tampon de texte pour une saisie rapide. <br><br><img src="https://habrastorage.org/webt/vc/ca/v4/vccav4jbt0zboaf_fuo985dzerc.png"><br><br>  La structure des donnÃ©es a un peu changÃ© - le tableau est restÃ© en place, mais deux pointeurs sont apparus: au dÃ©but du tampon et Ã  sa fin.  Pour prendre un caractÃ¨re de l'Ã©diteur Ã  un certain dÃ©calage, nous devons comprendre s'il se trouve avant ou aprÃ¨s ce tampon et corriger lÃ©gÃ¨rement le dÃ©calage.  Et pour insÃ©rer un personnage, nous devons d'abord dÃ©placer le Gap Buffer Ã  cet endroit et le remplir avec ces caractÃ¨res.  Et, bien sÃ»r, si nous allons au-delÃ  de notre tampon, recrÃ©ez-le d'une maniÃ¨re ou d'une autre.  Voici Ã  quoi cela ressemble dans l'image. <br><br><img src="https://habrastorage.org/webt/bu/4a/gs/bu4ags_jk9vobq_9rxegbww01nw.gif"><br><br>  Comme vous pouvez le voir, nous nous dÃ©plaÃ§ons d'abord pendant longtemps sur un petit tampon d'espace (rectangle bleu) vers l'emplacement d'Ã©dition (en Ã©changeant simplement les caractÃ¨res Ã  partir de ses bords gauche et droit Ã  leur tour).  Ensuite, nous utilisons ce tampon, en tapant des caractÃ¨res lÃ -bas. <br><br>  Comme vous pouvez le constater, il n'y a pas de mouvement de mÃ©gaoctets de caractÃ¨res, l'insert est trÃ¨s rapide, pendant un temps constant, et il semble que tout le monde soit content.  Tout semble aller bien, mais si notre processeur est trÃ¨s lent, un temps assez important est perdu pour dÃ©placer le tampon d'Ã©cart et le texte d'avant en arriÃ¨re.  Cela Ã©tait particuliÃ¨rement visible lors de trÃ¨s petits mÃ©gahertz. <br><br><h3>  Table des piÃ¨ces </h3><br>  Juste Ã  ce moment-lÃ , une sociÃ©tÃ© appelÃ©e Microsoft a Ã©crit un Ã©diteur de texte Word.  Ils ont dÃ©cidÃ© d'appliquer une autre idÃ©e pour accÃ©lÃ©rer l'Ã©dition appelÃ©e Â«Tableau de piÃ¨cesÂ», c'est-Ã -dire Â«Tableau de piÃ¨cesÂ».  Et ils ont proposÃ© de sauvegarder le texte de l'Ã©diteur dans le mÃªme tableau de caractÃ¨res le plus simple, qui ne changera pas, et de mettre toutes ses modifications dans un tableau sÃ©parÃ© de ces piÃ¨ces trÃ¨s modifiÃ©es. <br><br><img src="https://habrastorage.org/webt/gf/gt/gu/gfgtgutww7ymm-bx-4v7tytyjt4.png"><br><br>  Ainsi, si nous avons besoin de trouver un caractÃ¨re par dÃ©calage, nous devons trouver cette piÃ¨ce que nous avons Ã©ditÃ©e et en extraire ce personnage, et s'il n'est pas lÃ , alors aller au texte d'origine.  L'insertion d'un symbole devient plus facile, il suffit de crÃ©er et d'ajouter cette nouvelle piÃ¨ce au tableau.  Voici Ã  quoi cela ressemble dans l'image: <br><br><img src="https://habrastorage.org/webt/94/8w/3u/948w3uylg_cuxh8mywws-owxs_i.gif"><br><br>  Ici, nous voulions supprimer l'espace au dÃ©calage 5. Pour ce faire, nous ajoutons deux nouveaux morceaux Ã  la table des tranches: l'un indique le premier fragment ("Bummer"), et le second indique le fragment aprÃ¨s modification ("mouton").  Il s'avÃ¨re que l'Ã©cart entre eux disparaÃ®t, ces deux piÃ¨ces sont collÃ©es ensemble, et nous obtenons dÃ©jÃ  un nouveau texte sans espace: Â«OblomovtsyÂ».  Ensuite, nous ajoutons le nouveau texte ("souffrant d'oblomovisme") Ã  la fin.  Utilisez un tampon supplÃ©mentaire et ajoutez une nouvelle tranche Ã  la table des piÃ¨ces qui pointe vers ce texte le plus rÃ©cent ajoutÃ©. <br><br>  Comme vous pouvez le voir, il n'y a pas de mouvement de va-et-vient, tout le texte reste en place.  La mauvaise nouvelle est qu'il devient de plus en plus difficile d'accÃ©der au symbole, car trier toutes ces piÃ¨ces est assez difficile. <br><br>  Pour rÃ©sumer. <br><br>  Ce qui est bien avec <b>Piece Table</b> : <br><br><ul><li>  IntÃ©grez rapidement; </li><li>  Annulation facile; </li><li>  Ajouter uniquement. </li></ul><br>  Ce qui est mauvais: <br><br><ul><li>  Il est terriblement difficile d'accÃ©der Ã  un document; </li><li>  C'est terriblement difficile Ã  mettre en Å“uvre. </li></ul><br>  Voyons qui nous utilisons habituellement quoi. <br><br>  NetBeans, Eclipse et Emacs utilisent Gap Buffer - bravo!  Vi ne dÃ©range pas et utilise juste une liste de lignes.  Word utilise la table des piÃ¨ces (ils ont rÃ©cemment prÃ©sentÃ© leurs anciennes sortes et lÃ  vous pouvez mÃªme comprendre quelque chose). <br><br>  Atom est plus intÃ©ressant.  Jusqu'Ã  rÃ©cemment, ils ne se gÃªnaient pas et utilisaient une liste de lignes JavaScript.  Et puis ils ont dÃ©cidÃ© de tout rÃ©Ã©crire en C ++ et ont accumulÃ© une structure assez compliquÃ©e, qui semble Ãªtre similaire Ã  la table des morceaux.  Mais ces piÃ¨ces ne sont pas stockÃ©es dans la liste, mais dans l'arborescence et dans ce que l'on appelle l'arborescence splay - il s'agit d'une arborescence qui s'auto-ajuste lorsqu'elle est insÃ©rÃ©e dans celle-ci, afin que les insertions rÃ©centes soient plus rapides.  Ils ont fait une chose trÃ¨s compliquÃ©e. <br><br>  Qu'est-ce qu'Intellij IDEA utilise? <br>  Non, pas de tampon d'Ã©cart.  Non, vous vous trompez aussi, pas une table Ã  piÃ¨ces. <br>  Oui, tout Ã  fait, votre propre vÃ©lo. <br><br>  Le fait est que les exigences de l'EDI pour le stockage de texte sont lÃ©gÃ¨rement diffÃ©rentes de celles d'un Ã©diteur de texte standard.  L'IDE a besoin de support pour diverses choses dÃ©licates comme la compÃ©titivitÃ©, c'est-Ã -dire l'accÃ¨s parallÃ¨le au texte depuis l'Ã©diteur.  Par exemple, afin que de nombreux produits de boulangerie diffÃ©rents puissent le lire et faire quelque chose.  (L'inspection est un petit morceau de code qui analyse le programme d'une maniÃ¨re ou d'une autre - par exemple, Ã  la recherche d'endroits qui lÃ¨vent une exception NullPointerException).  IDE a Ã©galement besoin d'un support de version texte modifiable.  Plusieurs versions sont simultanÃ©ment en mÃ©moire pendant que vous travaillez avec un document afin que ces longs processus continuent d'analyser l'ancienne version. <br><br><h1>  Les problÃ¨mes </h1><br><h3>  CompÃ©titivitÃ© / versioning </h3><br>  Afin de maintenir le parallÃ©lisme, les opÃ©rations de texte sont gÃ©nÃ©ralement enveloppÃ©es de Â«synchronisÃ©Â» ou de verrous de lecture / Ã©criture.  Malheureusement, cela n'Ã©volue pas trÃ¨s bien.  Une autre approche est le texte immuable, c'est-Ã -dire un rÃ©fÃ©rentiel de texte immuable. <br><br><img src="https://habrastorage.org/webt/ov/ia/sa/oviasaeniuwmhiaebpsic_mxm88.png"><br><br>  Voici Ã  quoi ressemble un Ã©diteur avec un document immuable comme structure de donnÃ©es de support. <br><br>  Comment fonctionne la structure des donnÃ©es? <br><br>  Au lieu d'un tableau de caractÃ¨res, nous aurons un nouvel objet de type ImmutableText, qui stocke du texte sous la forme d'un arbre, oÃ¹ de petites sous-chaÃ®nes sont stockÃ©es dans les feuilles.  En accÃ©dant Ã  un certain dÃ©calage, il essaie d'atteindre la toute derniÃ¨re feuille de cet arbre, et on lui demandera dÃ©jÃ  le symbole auquel nous faisions rÃ©fÃ©rence.  Et lorsque vous insÃ©rez du texte, il crÃ©e un nouvel arbre et l'enregistre Ã  l'ancien emplacement. <br><br><img src="https://habrastorage.org/webt/_2/xx/rh/_2xxrh9kohjwodn3ub-gyt2z8la.gif"><br><br>  Par exemple, nous avons un document avec le texte Â«sans caloriesÂ».  Il est implÃ©mentÃ© comme un arbre avec deux feuilles de substitutions "DÃ©mon" et "hypercalorique".  Lorsque nous voulons insÃ©rer la ligne Â«jolieÂ» au milieu, une nouvelle version de notre document est crÃ©Ã©e.  Et prÃ©cisÃ©ment, une nouvelle racine est crÃ©Ã©e, Ã  laquelle trois feuilles sont dÃ©jÃ  attachÃ©es: Â«DÃ©monÂ», Â«assezÂ» et Â«hypercaloriqueÂ».  De plus, deux de ces nouvelles fiches peuvent faire rÃ©fÃ©rence Ã  la premiÃ¨re version de notre document.  Et pour la feuille dans laquelle nous avons insÃ©rÃ© la ligne Â«jolieÂ», un nouveau sommet est allouÃ©.  Ici, la premiÃ¨re version et la deuxiÃ¨me version sont disponibles en mÃªme temps et elles sont toutes immuables, immuables.  Tout a l'air bien. <br><br>  Qui utilise quelles structures dÃ©licates? <br><br><img src="https://habrastorage.org/webt/yf/mt/eh/yfmtehxbzlale_95bblpk2msh2k.jpeg"><br><br>  Par exemple, dans GNOME, certains de leurs widgets standard utilisent une structure appelÃ©e Rope.  Xi-Editor, le nouvel Ã©diteur brillant de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Raf Levien</a> , utilise Persistent Rope.  Et Intellij IDEA utilise cet arbre immuable.  DerriÃ¨re tous ces noms, en fait, se trouve plus ou moins la mÃªme structure de donnÃ©es avec une reprÃ©sentation arborescente du texte.  Sauf que GtkTextBuffer utilise Mutable Rope, c'est-Ã -dire un arbre avec des sommets mutables, et Intellij IDEA et Xi-Editor - Immutable. <br><br>  La prochaine chose Ã  considÃ©rer lors du dÃ©veloppement d'un rÃ©fÃ©rentiel de caractÃ¨res dans les IDE modernes est appelÃ©e multicats.  Cette fonction vous permet d'imprimer Ã  plusieurs endroits Ã  la fois, en utilisant plusieurs chariots. <br><br><img src="https://habrastorage.org/webt/qb/ak/9t/qbak9tqjnu7v_iiciaouw-qqeug.gif"><br><br>  Nous pouvons imprimer quelque chose et en mÃªme temps, Ã  plusieurs endroits du document, nous insÃ©rons ce que nous y avons imprimÃ©.  Si nous regardons comment nos structures de donnÃ©es, que nous avons examinÃ©es, rÃ©agissent aux multicarets, nous verrons quelque chose d'intÃ©ressant. <br><br><img src="https://habrastorage.org/webt/ty/4p/8k/ty4p8kuqs1rgeanxr9y3n9i8wz4.jpeg"><br><br>  Si nous insÃ©rons un caractÃ¨re dans notre tout premier Ã©diteur primitif, il faudra naturellement un temps linÃ©aire pour dÃ©placer un groupe de caractÃ¨res dans les deux sens.  Ceci est Ã©crit comme O (N).  Pour l'Ã©diteur basÃ© sur Gap Buffer, Ã  son tour, un temps constant est nÃ©cessaire, pour lequel il a Ã©tÃ© inventÃ©. <br><br>  Pour un arbre immuable, le temps dÃ©pend logarithmiquement de la taille, car vous devez d'abord aller du haut de l'arbre Ã  sa feuille - c'est le logarithme, puis pour tous les sommets sur le chemin pour crÃ©er de nouveaux sommets pour le nouvel arbre - c'est encore le logarithme.  Le tableau des piÃ¨ces nÃ©cessite Ã©galement une constante. <br>  Mais tout change un peu si nous essayons de mesurer le temps d'insertion d'un personnage dans un Ã©diteur Ã  plusieurs chariots, c'est-Ã -dire l'insertion simultanÃ©e Ã  plusieurs endroits.  Ã€ premiÃ¨re vue, le temps semble augmenter proportionnellement d'un facteur C - le nombre d'endroits oÃ¹ le symbole est insÃ©rÃ©.  C'est exactement ce qui se passe, Ã  l'exception de Gap Buffer.  Dans son cas, le temps, au lieu de C fois, augmente de faÃ§on inattendue des temps C * L incomprÃ©hensibles, oÃ¹ L est la distance moyenne entre les chariots.  Pourquoi cela se produit-il? <br><br>  Imaginez que nous devons insÃ©rer la ligne Â«, onÂ» Ã  deux endroits dans notre document. <br><br><img src="https://habrastorage.org/webt/ec/n3/jd/ecn3jdpnsvqscfbvjxivopbs5uq.gif"><br><br>  C'est ce qui se passe dans l'Ã©diteur en ce moment. <br><br><ul><li>  CrÃ©ez un tampon d'espace dans l'Ã©diteur (un petit rectangle bleu dans l'image); </li><li>  Nous commenÃ§ons deux voitures (lignes verticales noires en gras); </li><li>  Nous essayons d'imprimer; </li><li>  InsÃ©rez une virgule dans notre tampon d'espace; </li><li>  Vous devez maintenant l'insÃ©rer Ã  la place du deuxiÃ¨me chariot; </li><li>  Pour ce faire, nous devons dÃ©placer notre tampon d'espace Ã  la position du chariot suivant; </li><li>  Imprime une virgule Ã  la deuxiÃ¨me place; </li><li>  Vous devez maintenant insÃ©rer le caractÃ¨re suivant Ã  la position du premier chariot; </li><li>  Et nous devons repousser notre Gap Buffer; </li><li>  InsÃ©rez la lettre "n"; </li><li>  Et nous dÃ©plaÃ§ons notre tampon de longue souffrance Ã  la place de la deuxiÃ¨me voiture; </li><li>  Nous y insÃ©rons notre "n"; </li><li>  Reculez le tampon pour insÃ©rer le caractÃ¨re suivant. </li></ul><br>  Sentez-vous oÃ¹ tout va? <br><br>  Oui, il s'avÃ¨re qu'en raison de ces nombreux mouvements de va-et-vient du tampon, notre temps total augmente.  HonnÃªtement, ce n'est pas qu'il soit directement horrifiÃ© car il a augmentÃ© - dÃ©placer des mÃ©gaoctets pathÃ©tiques, des gigaoctets d'avant en arriÃ¨re pour un ordinateur moderne n'est pas un problÃ¨me, mais il est intÃ©ressant de noter que cette structure de donnÃ©es fonctionne radicalement diffÃ©remment dans le cas des multicats. <br><br><h3>  Trop de lignes?  LineSet! </h3><br>  Quels sont les autres problÃ¨mes dans un Ã©diteur de texte classique?  Le problÃ¨me le plus difficile est le dÃ©filement, c'est-Ã -dire le redessin de l'Ã©diteur tout en dÃ©plaÃ§ant le chariot sur la ligne suivante. <br><br><img src="https://habrastorage.org/webt/yt/0d/rn/yt0drnu1rsxyciwb4pruefmufyu.gif"><br><br>  Lorsque l'Ã©diteur dÃ©file, nous devons comprendre Ã  partir de quelle ligne, Ã  partir de quel symbole nous devons commencer Ã  dessiner le texte dans notre petite fenÃªtre.  Pour ce faire, nous devons comprendre rapidement quelle ligne correspond Ã  quel dÃ©calage. <br><br><img src="https://habrastorage.org/webt/kn/ak/gm/knakgm1aq7-wnjwbruefxeyouh0.png"><br><br>  Il existe une interface Ã©vidente pour cela, lorsque nous devons comprendre son dÃ©calage dans le texte par numÃ©ro de ligne.  Et vice versa, par le dÃ©calage dans le texte pour comprendre dans quelle ligne il se trouve.  Comment cela peut-il se faire rapidement? <br><br>  Par exemple, comme ceci: <br><br>  Organisez ces lignes en un arbre et marquez chaque sommet de cet arbre en dÃ©calant le dÃ©but de la ligne et en dÃ©calant la fin de la ligne.  Et puis, afin de comprendre par le dÃ©calage dans quelle ligne il se trouve, il vous suffit d'exÃ©cuter une recherche logarithmique dans cet arbre et de le trouver. <br><br><img src="https://habrastorage.org/webt/x1/jq/3w/x1jq3w1gwiytzsrdytznnltc_l0.png"><br><br>  Une autre faÃ§on est encore plus simple. <br><br>  Ã‰crivez dans le tableau le dÃ©calage du dÃ©but des lignes et de la fin des lignes.  Et puis, pour trouver le dÃ©calage du dÃ©but et de la fin par le numÃ©ro de ligne, vous devrez accÃ©der Ã  l'index. <br><br><img src="https://habrastorage.org/webt/wq/ls/wy/wqlswyl-k5brg4fsbgoxaqxkj1u.png"><br><br>  Fait intÃ©ressant, dans le monde rÃ©el, les deux mÃ©thodes sont utilisÃ©es. <br><br><img src="https://habrastorage.org/webt/ii/w6/qu/iiw6quo2j0clh8xnovh0mfn5ow0.jpeg"><br><br>  Par exemple, Eclipse utilise une telle structure en bois qui, comme vous pouvez le voir, fonctionne dans un temps logarithmique pour la lecture et la mise Ã  jour.  Et IDEA utilise une structure de table, pour laquelle la lecture est une constante rapide, c'est une inversion d'index dans une table, mais la reconstruction est plutÃ´t lente, car vous devez reconstruire la table entiÃ¨re lorsque vous modifiez la longueur d'une ligne. <br><br><h3>  Encore trop de lignes?  Des plis! </h3><br>  Quoi d'autre est mauvais qui tombe sur les Ã©diteurs de texte?  Par exemple, des pliages.  Ce sont des morceaux de texte que vous pouvez Â«rÃ©duireÂ» et montrer Ã  la place. <br><br><img src="https://habrastorage.org/webt/tp/g1/fc/tpg1fcoak4ahpzd1mbf9wex_jvi.png"><br><br>  Ces points sur un fond vert dans l'image cachent beaucoup de symboles derriÃ¨re nous, mais si nous ne sommes pas intÃ©ressÃ©s Ã  les regarder (comme dans le cas, par exemple, des documents Java ou des listes d'importation les plus longs et ennuyeux), nous les masquons, les rÃ©duisons ellipses. <br><br>  Et lÃ  encore, vous devez comprendre quand elle se termine et quand la rÃ©gion que nous devons montrer commence, et comment la mettre Ã  jour rapidement?  Comment cela est organisÃ©, je le dirai un peu plus tard. <br><br><h3>  Trop longues lignes?  Enveloppement doux! </h3><br><img src="https://habrastorage.org/webt/yu/lb/hg/yulbhgos7wf3ilx0gqtxg2lrkpq.jpeg"><br><br>  De plus, les Ã©diteurs modernes ne peuvent pas vivre sans enveloppe souple.  L'image montre que le dÃ©veloppeur a ouvert le fichier JavaScript aprÃ¨s la minimisation et l'a immÃ©diatement regrettÃ©.  Cette Ã©norme ligne JavaScript, lorsque nous essayons de l'afficher dans l'Ã©diteur, ne rentrera dans aucun Ã©cran.  Par consÃ©quent, un emballage doux le dÃ©chire de force en plusieurs lignes et le pousse dans l'Ã©cran. <br>  Comment c'est organisÃ© - plus tard. <br><br><h3>  Trop peu de beautÃ© </h3><br><img src="https://habrastorage.org/webt/md/yh/d0/mdyhd06genl8kiaehxjectze9g4.jpeg"><br><br>  Et enfin, je veux aussi apporter de la beautÃ© aux Ã©diteurs de texte.  Par exemple, mettez en surbrillance certains mots.  Dans l'image ci-dessus, les mots clÃ©s sont mis en Ã©vidence en bleu gras, certaines mÃ©thodes statiques en italique, certaines annotations - Ã©galement dans une couleur diffÃ©rente. <br><br>  Alors, comment conservez-vous et traitez-vous encore les pliages, les emballages souples et les surlignages? <br>  Il s'avÃ¨re que tout cela, en principe, est une seule et mÃªme tÃ¢che. <br><br><h3>  Trop peu de beautÃ©?  Surligneurs de gamme! </h3><br><img src="https://habrastorage.org/webt/jj/rl/t7/jjrlt7sisz9curcqa5lotpzjfya.jpeg"><br><br>  Pour prendre en charge toutes ces fonctionnalitÃ©s, tout ce que nous devons Ãªtre en mesure de faire est de coller certains attributs de texte Ã  un dÃ©calage donnÃ© dans le texte, par exemple, la couleur, la police ou le texte Ã  plier.  De plus, ces attributs de texte doivent Ãªtre mis Ã  jour tout le temps Ã  cet endroit afin qu'ils survivent Ã  toutes sortes d'insertions et de suppressions. <br><br>  Comment cela est-il gÃ©nÃ©ralement mis en Å“uvre?  Naturellement, sous la forme d'un arbre. <br><br><h3>  ProblÃ¨me: trop de beautÃ©?  Arbre d'intervalle! </h3><br><img src="https://habrastorage.org/webt/0e/ux/le/0euxleajuom5pdsa02kwxuudyny.jpeg"><br><br>  Par exemple, nous avons ici plusieurs reflets jaunes que nous voulons conserver dans le texte.  Nous ajoutons les intervalles de ces faits saillants dans un arbre de recherche, le soi-disant arbre d'intervalle.  Il s'agit du mÃªme arbre de recherche, mais un peu plus dÃ©licat car nous devons stocker des intervalles plutÃ´t que des nombres. <br><br>  Et comme il y a des intervalles sains et petits, comment les trier, les comparer les uns aux autres et les mettre dans un arbre est une tÃ¢che plutÃ´t simple.  Bien que trÃ¨s connu en informatique.  Ensuite, regardez Ã  votre guise comment cela fonctionne.  Donc, nous prenons et mettons tous nos intervalles dans un arbre, puis chaque changement de texte quelque part au milieu conduit Ã  un changement logarithmique dans cet arbre.  Par exemple, l'insertion d'un caractÃ¨re devrait entraÃ®ner la mise Ã  jour de tous les intervalles Ã  droite de ce caractÃ¨re.  Pour ce faire, nous trouvons tous les sommets dominants de ce symbole et indiquons que tous leurs sommets doivent Ãªtre dÃ©placÃ©s d'un symbole vers la droite. <br><br><h3>  Toujours envie de beautÃ©?  Ligatures! </h3><br><img src="https://habrastorage.org/webt/iv/j-/tb/ivj-tb9_w2ata-tiwclrmqfjs_a.jpeg"><br><br>  Il y a encore une chose si terrible - les ligatures, que je voudrais Ã©galement soutenir.  Ce sont des beautÃ©s diffÃ©rentes, comme le signe Â«! =Â» Est dessinÃ© sous la forme d'un grand glyphe Â«pas Ã©galÂ» et ainsi de suite.  Heureusement, nous comptons ici sur un mÃ©canisme de swing pour supporter ces ligatures.  Et, selon notre expÃ©rience, il travaille apparemment de la maniÃ¨re la plus simple.  Ã€ l'intÃ©rieur de la police, une liste de toutes ces paires de caractÃ¨res est stockÃ©e, qui, lorsqu'elles sont combinÃ©es ensemble, forment une sorte de ligature dÃ©licate.  Ensuite, lors du tracÃ© de la ligne, Swing itÃ¨re simplement sur toutes ces paires, trouve celles nÃ©cessaires et les dessine en consÃ©quence.  Si vous avez beaucoup de ligatures dans la police, alors, apparemment, son affichage ralentira proportionnellement. <br><br><h3>  Basculement des freins </h3><br>  Et le plus important - un autre problÃ¨me rencontrÃ© dans les Ã©diteurs complexes modernes est l'optimisation du basculement, c'est-Ã -dire l'appui sur les touches et l'affichage du rÃ©sultat. <br><br><img src="https://habrastorage.org/webt/fq/yb/wi/fqybwipttxn9pvl3phzc5qts6_k.jpeg"><br><br>  Si vous entrez dans Intellij IDEA et voyez ce qui se passe lorsque vous appuyez sur un bouton, il se trouve que l'horreur suivante se produit: <br><br><ul><li>  En cliquant sur un bouton, nous devons voir si nous sommes dans la fenÃªtre de complÃ©tion pour fermer le menu de fin si, par exemple, nous tapons du "Enter". </li><li>  Vous devez voir si le fichier est sous un systÃ¨me de contrÃ´le de version dÃ©licat, comme Perforce, qui doit prendre des mesures pour commencer la modification. </li><li>  VÃ©rifiez s'il y a une rÃ©gion spÃ©ciale dans le document qui ne peut pas Ãªtre imprimÃ©e, comme certains textes gÃ©nÃ©rÃ©s automatiquement. </li><li>  Si le document est bloquÃ© par une opÃ©ration qui n'est pas terminÃ©e, vous devez terminer la mise en forme et continuer ensuite. </li><li>  injected-,      ,       ,   -  . </li><li>     auto popup handler,    , ,       . </li><li>   info  ,     ,    .     selection remove,    selection  ,   .    selection ,    . </li><li>     typed handler,       ,      . </li><li>    . </li><li>  undo,  virtual space'   write action. </li><li> ,     . </li></ul><br>  Hourra! <br><br> , ,   .  ,    . ,    listener  ,   ,  - .  editor view.  -   listener'. <br><br>      ,   ,  -      DocumentListener? <br><br>  Editor.documentChanged()   : <br><br><ul><li>  error stripe; </li><li>  gutter size, ; </li><li>  editor component size,    ; </li><li>      ; </li><li>  soft wrap,    ; </li><li>  repaint(). </li></ul><br>  repaint() â€”     Swing,        .   ,   Repaint     Swing. <br><br>   -       ,   repaint   ,    : <br><br><img src="https://habrastorage.org/webt/je/qh/cy/jeqhcytdxkun3ft_r7azwrby2eu.jpeg"><br><br>    paint-,   ,        . <br><br>  , ,   ? <br><br><img src="https://habrastorage.org/webt/sm/mo/xq/smmoxqrmfayyfodciwe75svwdzw.jpeg"><br><br>  ,  ,  .    Intellij IDEA   . <br><br><img src="https://habrastorage.org/webt/5u/x8/as/5ux8ashfsenwboudd_u07ubtjmk.jpeg"><br><br>    ,  -   - ,    ,         ,    .  !  ,    ,    ,   -  â€” !      ,  -    .    .      Â«Zero latency typingÂ». <br><br><h1>   </h1><br>      â€”    . <br><br>   ?       ,  â€”  ,        Google Docs -    -  . <br><br>  : <br><br><ul><li>  ; </li><li>  . </li></ul><br>   ,        ,          . <br><br>  -          .    ,  ,     .   .   â€”   , Â«intention preservationÂ».  ,   -  ,          ,     ,   .    â€” .  ,            -       ,   . <br><br><h3> Operation transformation </h3><br><img src="https://habrastorage.org/webt/h9/e8/pq/h9e8pqu3ljnoh4y70_759peizn0.jpeg"><br><br>  ,       ,  Â«operation transformationÂ».   .    , - :     ,     .  Operation transformation       .   ,    ,   ,    - . ,        .    ,    -         .  ,      ,    . <br><br>       ,   ,    ,   .     Â«TP2 puzzleÂ». <br><br><img src="https://habrastorage.org/webt/c1/5i/cs/c15icsdnqbjqykloe_pfbxahz-e.jpeg"><br><br>       - ,    ,     .  ,    Operation transformation       ,  ,  ,     (Â«Â»).       (Â«Â»).   ,   .    ,         Operation transformation,  -       . <br><br>          ,  Google Docs, Google Wave  -   Etherpad.   Operation transformation    . <br><br><h3> Conflict-free replicated data type </h3><br>      : Â«  ,  OT!Â»     ,      ,  . ,  ,    ,              ,      100%         .   Â«CRDTÂ» (Conflict-free replicated data type). <br><br><img src="https://habrastorage.org/webt/kn/82/9n/kn829n91st7gpykcp905spuy_ki.jpeg"><br><br>   ,    ,          . ,     , ,   .   ,       . -            (  ),  ()      (  ). <br><br><img src="https://habrastorage.org/webt/vs/9-/i7/vs9-i7bdfpjonh_z1cgie6qj4kk.jpeg"><br><br>           ? <br><br>  Oui ,     G-counter',   ,   .      ,       .        Â«+1Â»  ,  Â«+1Â»  , ,       â€”   Â«2Â».  ,          ,     .      G-counter,     ,       .       G-counter,    .    ,     ,       .       .    â€”   . ,       CRDT. ,   . <br><br><h3> Conflict-free replicated inserts </h3><br><img src="https://habrastorage.org/webt/pz/bg/ta/pzbgta8bteajr0embilmbnpxifc.jpeg"><br><br> ,     ,      ,    . , ,        . <br><br>   ,     ,     -  - , ,  ,  ,        .   ,      ,     ,     ,     . , ,  ,     ,     2    Â«Â»,    ,    Â«Â»   Â«Â»   Â«Â». <br><br><h3> Conflict-free replicated deletes </h3><br><img src="https://habrastorage.org/webt/jt/w1/fb/jtw1fbphe5mjcyhbye4ua-mjf7s.jpeg"><br><br>      .        ,    ,     ,  - .   ,       ,     .  ,       ,        ,    . <br>  ,      . <br><br><h3> Conflict-free replicated edits </h3><br> ,   , CRDT  - , ,  Xi-Editor,          Fuchsia.  ,     ,    . <br><br><h1>  Fermeture Ã©clair </h1><br>      ,          Â«ZipperÂ».  ,      ,      . ,  ,        .    , ( Â«Â» ,   ,     Â«  Â»). ,      -     .      ,       - ,   .        Zipper. <br><br>           ,     .    . <br><br><img src="https://habrastorage.org/webt/ap/ne/p2/apnep2miklsburr5xhtqgcwbzri.gif"><br><br>  Zipper   ,      (Â«  Â»).     Zipper'       .    â€”     .       (),   ,          . ,    Zipper,   -        ,   .  ,     ,   ,   ( ).      ,        ( ).   ,                .    ,        . <br><br>  ,        . <br><br>       ? -,   ,    ,    ,    .  ,       ,   .  -,    ,      .     .  Je vous remercie <br><br> â†’ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> <br> â†’ <a href=""></a> <br><br><h1>  Les rÃ©fÃ©rences </h1><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Zipper data structure</a> <br> <a href="">  CRDT in Xi Editor</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">       </a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   </a> <br><br>     ,         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> Visual Studio Code editor  Piece Table</a> . <br>  ,   -   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> . <br><br><blockquote> Vous voulez des rapports encore plus puissants, y compris Java 11?  Ensuite, nous vous attendons au <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Joker 2018</a> .  Intervenants cette annÃ©e: Josh Long, John McClean, Marcus Hirth, Robert Scholte et d'autres intervenants tout aussi cool.  Il reste 17 jours avant la confÃ©rence.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Billets</a> sur le site. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr424763/">https://habr.com/ru/post/fr424763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr424751/index.html">Fonctionnement du systÃ¨me biomÃ©trique unifiÃ©</a></li>
<li><a href="../fr424753/index.html">NouveautÃ©s de YouTrack 2018.3</a></li>
<li><a href="../fr424755/index.html">L'argent aime le projet de loi: comment les voitures trient les factures</a></li>
<li><a href="../fr424757/index.html">Le condensÃ© des Ã©vÃ©nements pour les professionnels des RH dans le domaine des TI en octobre 2018</a></li>
<li><a href="../fr424761/index.html">Introduction au dÃ©marrage du noyau Linux et aux processus de dÃ©marrage</a></li>
<li><a href="../fr424765/index.html">Gestion des Ã©tats dans les applications Flutter</a></li>
<li><a href="../fr424767/index.html">Nous faisons un gÃ¢teau de Habr. Encore une fois</a></li>
<li><a href="../fr424771/index.html">ExpÃ©rience personnelle: d'une idÃ©e et d'une feuille blanche Ã  une version provisoire d'un site</a></li>
<li><a href="../fr424773/index.html">Biopharma et modÃ©lisation numÃ©rique: expÃ©rience et pratique d'Amgen</a></li>
<li><a href="../fr424777/index.html">Utilisation de Consul pour faire Ã©voluer les services avec Ã©tat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>