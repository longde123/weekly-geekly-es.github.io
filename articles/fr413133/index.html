<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úãüèæ üë©‚Äçüíª üßëüèΩ Antipatterns populaires: pagination ü§Ωüèº üë©üèæ‚ÄçüöÄ üññüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je m'appelle Dmitry Karlovsky et je ... n'aime pas lire des livres, car pendant que vous tournez la page, vous sortez d'une histoire fascinan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Antipatterns populaires: pagination</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413133/"><p>  Bonjour, je m'appelle Dmitry Karlovsky et je ... n'aime pas lire des livres, car pendant que vous tournez la page, vous sortez d'une histoire fascinante.  Et cela m√©rite une petite h√©sitation lorsque vous oubliez la fin de la derni√®re phrase de la page pr√©c√©dente, et vous devez revenir en arri√®re pour la relire.  Et si ce n'est pas si effrayant avec des livres physiques, alors avec la publication d'un serveur de repos, tout est beaucoup plus triste - apr√®s tout, il y a maintenant des donn√©es sur la page, et apr√®s une seconde, c'est compl√®tement diff√©rent.  R√©fl√©chissons √† la fa√ßon dont cela s'est produit, qui est √† bl√¢mer et surtout - que faire. </p><br><p><img src="https://habrastorage.org/webt/v7/fn/sv/v7fnsvuaiwms-qzqkljva1dasym.png" alt="Puginateurs divers"></p><a name="habracut"></a><br><h2 id="problema">  Le probl√®me </h2><br><p>  Nous devons donc √©mettre tous les messages de la requ√™te "pagination", en commen√ßant par les plus r√©cents (les <strong>derniers chang√©s par le haut</strong> ) ou dans un ordre d√©licat.  Tout va bien, tant que nous avons moins d'une centaine de ces messages - nous faisons simplement une s√©lection dans la base de donn√©es et renvoyons les donn√©es: </p><br><p>  Demande du client: </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /message/<span class="hljs-type"><span class="hljs-type">text</span></span>=/</code> </pre> <br><p>  Demande de base de donn√©es: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Message <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> LICENE <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">changed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  Sch√©ma de r√©ponse JSON pour le client: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Array</span></span>&lt;{ <span class="hljs-attribute"><span class="hljs-attribute">id </span></span>: number , text : string }&gt;</code> </pre> <br><p>  Mais le nombre de messages augmente et nous avons les probl√®mes suivants: </p><br><ol><li>  Les requ√™tes de base de donn√©es deviennent plus lentes √† mesure que davantage de donn√©es doivent √™tre r√©cup√©r√©es. </li><li>  L'envoi de donn√©es sur le r√©seau prend de plus en plus de temps. </li><li>  Le rendu de ces donn√©es sur le client s'allonge de plus en plus. </li></ol><br><p>  A partir d'un certain seuil, les retards deviennent si importants qu'il devient impossible d'utiliser notre site.  Si, bien s√ªr, il ne s'√©tait pas encore couch√©, fatigu√© d'un grand nombre de lourdes demandes parall√®les. </p><br><p>  La solution la plus simple, qui vient peut-√™tre d'abord √† l'esprit, et vous pouvez la trouver maintenant dans n'importe quel grille-pain - pour diffuser des donn√©es non pas en masse, mais divis√©es en pages.  Tout ce que nous devons faire est de simplement jeter un param√®tre suppl√©mentaire du client dans la demande de base de donn√©es: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /message/<span class="hljs-type"><span class="hljs-type">text</span></span>=/page=<span class="hljs-number"><span class="hljs-number">5</span></span>/</code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Message <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> LICENE <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">changed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SKIP</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> * <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Message <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> LICENE <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br><pre> <code class="hljs css">{ <span class="hljs-attribute"><span class="hljs-attribute">pageItems </span></span>: Array&lt;{ id : number , text : string }&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">totalCount</span></span> : <span class="hljs-selector-tag"><span class="hljs-selector-tag">number</span></span> }</code> </pre> <br><p>  Eh bien, oui, nous devions toujours recompter tous les messages afin que le client puisse dessiner une liste de pages ou calculer la hauteur du d√©filement virtuel, mais au moins nous n'avions pas besoin d'obtenir tous ces 100500 messages de la base de donn√©es. </p><br><p>  Et tout irait bien si nous avions une sorte de forum non populaire pendant longtemps, des sujets plus pertinents.  Mais ils nous √©crivent et nous √©crivent, √©crivent et √©crivent, et pendant que l'utilisateur lit la cinqui√®me page, la liste des messages change au-del√† de la reconnaissance: de nouveaux sont ajout√©s et les anciens sont supprim√©s.  Ainsi, nous obtenons deux types de probl√®mes du point de vue de l'utilisateur: </p><br><ol><li>  Sur la page suivante, des messages peuvent appara√Ætre √† nouveau qui √©taient d√©j√† sur le pr√©c√©dent. </li><li>  L'utilisateur ne verra pas du tout certains messages, car il a r√©ussi √† passer de la page 6 √† 5 exactement entre la transition de l'utilisateur de 5 √† 6. </li></ol><br><p>  De plus, nous avons toujours des probl√®mes de performances.  Chaque transition vers la page suivante conduit au fait que nous devons effectuer jusqu'√† deux requ√™tes de recherche dans la base de donn√©es avec un nombre croissant d'√©l√©ments ignor√©s des pages pr√©c√©dentes. </p><br><p>  Oui, et une impl√©mentation comp√©tente du c√¥t√© client n'est pas si simple - vous devez toujours √™tre pr√©par√© au fait que toute r√©ponse du serveur peut renvoyer un nouveau nombre total de messages, ce qui signifie que nous devrons redessiner le paginateur et rediriger vers une autre page si la page actuelle est soudainement est vide.  Et bien s√ªr, vous ne pouvez pas tomber en cas de doublons. </p><br><p>  En outre, le client doit parfois mettre √† jour les r√©sultats de la recherche, mais la charge recevra toujours les donn√©es qu'elle peut d√©j√† avoir des demandes pr√©c√©dentes. </p><br><p>  Comme vous pouvez le voir, la pagination pose de nombreux probl√®mes.  N'y a-t-il vraiment pas de meilleure solution? </p><br><h2 id="reshenie">  Solution </h2><br><p>  Tout d'abord, notons que lorsque vous travaillez avec la base de donn√©es, il y a 2 op√©rations qui sont essentiellement diff√©rentes: </p><br><ol><li>  Cherchez.  Op√©ration relativement lourde de recherche de pointeurs vers des donn√©es pour une requ√™te. </li><li>  √âchantillonnage.  Une op√©ration relativement simple d'obtention de donn√©es. </li></ol><br><p>  Ce serait id√©al: </p><br><ol><li>  Une fois la recherche et un endroit pour se souvenir de ses r√©sultats sous la forme d'un instantan√© √† un certain moment. </li><li>  S√©lectionnez rapidement les donn√©es en petites portions selon les besoins. </li></ol><br><p>  O√π stocker les instantan√©s?  il y a 2 options: </p><br><ol><li>  Sur le serveur.  Mais ensuite, nous les obstruons avec un tas d'ordures avec des r√©sultats de recherche qui doivent √™tre nettoy√©s au fil du temps. </li><li>  Au client.  Mais vous devez ensuite transf√©rer imm√©diatement tous les instantan√©s au client. </li></ol><br><p>  Estimons la taille de l'instantan√©, qui n'est qu'une liste d'identifiants.  Il est peu probable que l'utilisateur ait eu la patience de rouler au moins 100 pages sans utiliser de filtrage et de tri.  Disons que nous avons 20 √©l√©ments par page.  Chaque identifiant n'occupera pas plus de 10 octets dans la repr√©sentation json.  Multipliez et obtenez pas plus de 20 Ko.  Et probablement beaucoup moins.  Il serait raisonnable de fixer une limite stricte sur la taille de la sortie en, disons, 1000 √©l√©ments. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /message/<span class="hljs-type"><span class="hljs-type">text</span></span>=/</code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Message <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> LICENE <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">changed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre> <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>&lt;number&gt;</code> </pre> <br><p>  D√©sormais, le client peut dessiner au moins un paginateur, au moins un parchemin virtuel, ne demandant des donn√©es que pour les identifiants qui l'int√©ressent. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /message=<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">48</span></span>,<span class="hljs-number"><span class="hljs-number">47</span></span>,<span class="hljs-number"><span class="hljs-number">46</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">42</span></span>,<span class="hljs-number"><span class="hljs-number">41</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">39</span></span>,<span class="hljs-number"><span class="hljs-number">37</span></span>/</code> </pre> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Message <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> [<span class="hljs-number"><span class="hljs-number">49</span></span>,<span class="hljs-number"><span class="hljs-number">48</span></span>,<span class="hljs-number"><span class="hljs-number">47</span></span>,<span class="hljs-number"><span class="hljs-number">46</span></span>,<span class="hljs-number"><span class="hljs-number">45</span></span>,<span class="hljs-number"><span class="hljs-number">42</span></span>,<span class="hljs-number"><span class="hljs-number">41</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>,<span class="hljs-number"><span class="hljs-number">39</span></span>,<span class="hljs-number"><span class="hljs-number">37</span></span>]</code> </pre> <br><pre> <code class="hljs vbscript"><span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>&lt; { id : number , text : <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> } | { id : number , <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> : <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> } &gt;</code> </pre> <br><p>  Ce que nous obtenons finalement: </p><br><ol><li>  API normalis√©e: recherchez s√©par√©ment, s√©lectionnez les donn√©es s√©par√©ment. </li><li>  R√©duisez le nombre de requ√™tes de recherche. </li><li>  Vous ne pouvez pas demander des donn√©es qui ont d√©j√† √©t√© t√©l√©charg√©es ou les mettre √† jour en arri√®re-plan. </li><li>  Code relativement simple et universel c√¥t√© client. </li></ol><br><p>  Parmi les lacunes, on peut noter que: </p><br><ol><li>  Pour afficher quelque chose, l'utilisateur doit effectuer au moins 2 demandes cons√©cutives. </li><li>  Il est n√©cessaire de traiter le cas lorsque l'identifiant est, et les donn√©es sur celui-ci ne sont plus disponibles. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413133/">https://habr.com/ru/post/fr413133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413121/index.html">Visite photo du coworking √† Moscou #tceh</a></li>
<li><a href="../fr413123/index.html">JOIN dans les bases de donn√©es NoSQL</a></li>
<li><a href="../fr413125/index.html">La th√©rapie g√©nique donne aux petits patients atteints d'atrophie musculaire une chance de survivre</a></li>
<li><a href="../fr413127/index.html">Quelques mots sur les performances r√©elles de l'hyperviseur</a></li>
<li><a href="../fr413129/index.html">25 erreurs d'un programmeur d√©butant</a></li>
<li><a href="../fr413135/index.html">Mission de test de r√©vision de code des d√©veloppeurs juniors de React</a></li>
<li><a href="../fr413137/index.html">Classer de grandes quantit√©s de donn√©es sur Apache Spark √† l'aide de mod√®les d'apprentissage automatique arbitraires</a></li>
<li><a href="../fr413139/index.html">Voitures √©lectriques: la r√©volution arrive</a></li>
<li><a href="../fr413141/index.html">Classer de grandes quantit√©s de donn√©es sur Apache Spark √† l'aide de mod√®les d'apprentissage automatique arbitraires</a></li>
<li><a href="../fr413143/index.html">Bobby Urban Lite: le nouveau sac √† dos urbain de XD Design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>