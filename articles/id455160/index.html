<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëãüèº üñ§ üë©üèº‚Äçüöí Entity Framework 6 dengan Pencarian Teks Lengkap via LINQ üêº ü¶Ö üôáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya ingin berbagi kruk saya dalam memecahkan masalah yang agak dangkal: bagaimana membuat teman pencarian MSSQL teks lengkap dengan Entity Framework....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entity Framework 6 dengan Pencarian Teks Lengkap via LINQ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/455160/"><p>  Saya ingin berbagi kruk saya dalam memecahkan masalah yang agak dangkal: bagaimana membuat teman pencarian MSSQL teks lengkap dengan Entity Framework.  Topiknya sangat khusus, tetapi menurut saya itu relevan hari ini.  Bagi yang berminat, saya minta kucing. </p><a name="habracut"></a><br><h1 id="vse-nachalos-s-boli">  Semuanya dimulai dengan rasa sakit </h1><br><p>  Saya mengembangkan proyek dalam C # (ASP.NET) dan kadang-kadang menulis layanan microser.  Dalam kebanyakan kasus, saya menggunakan database MSSQL untuk bekerja dengan data.  Kerangka Entity digunakan sebagai tautan antara database dan proyek saya.  Dengan EF, saya mendapatkan banyak peluang untuk bekerja dengan data, menghasilkan kueri yang tepat, mengatur beban di server.  Mekanisme ajaib LINQ hanya memikat dengan kemampuannya.  Selama bertahun-tahun, saya tidak lagi membayangkan cara yang lebih cepat dan nyaman untuk bekerja dengan database.  Tetapi seperti hampir semua ORM, EF memiliki sejumlah kelemahan.  Pertama, ini adalah kinerja, tetapi ini adalah topik dari artikel terpisah.  Dan kedua, itu mencakup kemampuan dari database itu sendiri. </p><br><p> MSSQL memiliki pencarian teks lengkap bawaan yang berfungsi di luar kotak.  Untuk melakukan kueri teks lengkap, Anda dapat menggunakan predikat bawaan (CONTAINS dan FREETEXT) atau fungsi (CONTAINSTABLE dan FREETEXTTABLE).  Hanya ada satu masalah: EF tidak mendukung permintaan teks lengkap, dari kata sama sekali! </p><br><p>  Saya akan memberikan contoh dari pengalaman nyata.  Misalkan saya memiliki tabel artikel - Artikel, dan saya membuat kelas untuknya yang menggambarkan tabel ini: </p><br><pre><code class="plaintext hljs">/// c# public partial class Article { public int Id { get; set; } public System.DateTime Date { get; set; } public string Text { get; set; } public bool Active { get; set; } }</code> </pre> <br><p>  Maka saya perlu memilih artikel-artikel ini, katakanlah, hasilkan 10 artikel terakhir yang diterbitkan: </p><br><pre> <code class="plaintext hljs">/// c# dbEntities db = new dbEntities(); var articles = db.Article .Where(n =&gt; n.Active) .OrderByDescending(n =&gt; n.Date) .Take(10) .ToArray();</code> </pre> <br><p>  Semuanya sangat indah sampai tugas menambahkan pencarian teks lengkap muncul.  Karena tidak ada dukungan untuk fungsi pemilihan teks lengkap di EF (.NET core 2.1 sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">memilikinya</a> ), masih menggunakan beberapa perpustakaan pihak ketiga atau menulis kueri dalam SQL murni. </p><br><p>  Permintaan SQL dari contoh di atas tidak begitu rumit: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">10</span></span>) [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Extent1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dbo].[Article] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent1] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> [Extent1].[Active] = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  Dalam proyek nyata, banyak hal tidak begitu sederhana.  Permintaan ke basis data jauh lebih rumit dan sulit untuk mempertahankannya secara manual.  Akibatnya, pertama kali saya menulis kueri menggunakan LINQ, lalu saya mendapatkan teks yang dihasilkan dari kueri SQL ke database, dan sudah memperkenalkan kondisi pemilihan data teks lengkap ke dalamnya.  Kemudian saya mengirimkannya ke <code>db.Database.SqlQuery</code> dan menerima data yang saya butuhkan.  Ini semua baik, tentu saja, selama permintaan tidak perlu menggantung selusin filter yang berbeda dengan kondisi dan join-us yang kompleks. </p><br><p>  Jadi - Saya memiliki rasa sakit tertentu.  Kita harus menyelesaikannya! </p><br><h1 id="v-poiskah-resheniya">  Mencari solusi </h1><br><p>  Sekali lagi, duduk di pencarian favorit saya dengan harapan menemukan setidaknya beberapa solusi, saya menemukan <a href="">repositori ini</a> .  Dengan solusi ini, dukungan predikat LINQ (CONTAINS dan FREETEXT) dapat diimplementasikan.  Berkat dukungan EF 6 dari antarmuka <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code>IDbCommandInterceptor</code></a> khusus, yang memungkinkan Anda untuk mencegat permintaan SQL yang sudah jadi, solusi ini diimplementasikan sebelum mengirimnya ke basis data.  String penanda yang dibuat khusus diganti ke dalam bidang <code>Contains</code> , dan kemudian setelah membuat permintaan, tempat ini diganti dengan predikat Contoh: </p><br><pre> <code class="plaintext hljs">/// c# var text = FullTextSearchModelUtil.Contains("code"); db.Tables.Where(c=&gt;c.Fullname.Contains(text));</code> </pre> <br><p>  Namun, jika pemilihan data perlu diurutkan berdasarkan peringkat pertandingan, maka solusi ini tidak akan berfungsi lagi dan Anda harus menulis kueri SQL secara manual.  Intinya, solusi ini menggantikan LIKE seperti biasa dengan pemilihan predikat. </p><br><p>  Jadi, pada tahap ini, saya punya pertanyaan: apakah mungkin untuk mengimplementasikan pencarian teks lengkap nyata menggunakan fungsi MS SQL bawaan (CONTAINSTABLE dan FREETEXTTABLE) sehingga semua ini dapat dihasilkan melalui LINQ dan bahkan dengan dukungan untuk menyortir kueri berdasarkan peringkat pertandingan?  Ternyata, Anda bisa! </p><br><h1 id="realizaciya">  Implementasi </h1><br><p>  Untuk memulainya, perlu mengembangkan logika untuk menulis permintaan itu sendiri menggunakan LINQ.  Karena dalam query SQL nyata dengan pilihan teks lengkap, BERGABUNG paling sering digunakan untuk bergabung dengan tabel virtual dengan peringkat, saya memutuskan untuk pergi dengan cara yang sama dalam permintaan LINQ. </p><br><p>  Berikut adalah contoh dari permintaan LINQ tersebut: </p><br><pre> <code class="plaintext hljs">/// c# var queryFts = db.FTS_Int.Where(n =&gt; n.Query.Contains(queryText)); var query = db.Article .Join(queryFts, article =&gt; article.Id, fts =&gt; fts.Key, (article, fts) =&gt; new { article.Id, article.Text, fts.Key, fts.Rank, }) .OrderByDescending(n =&gt; n.Rank);</code> </pre> <br><p>  Kode seperti itu belum bisa dikompilasi, tetapi sudah secara visual memecahkan masalah mengurutkan data yang dihasilkan berdasarkan peringkat.  Tetap mempraktikkannya. </p><br><p>  Kelas tambahan <code>FTS_Int</code> digunakan dalam permintaan ini: </p><br><pre> <code class="plaintext hljs">/// c# public partial class FTS_Int { public int Key { get; set; } public int Rank { get; set; } public string Query { get; set; } }</code> </pre> <br><p>  Nama tidak dipilih secara kebetulan, karena kolom kunci di kelas ini harus bertepatan dengan centang pada kolom kunci di tabel pencarian (dalam contoh saya, dengan <code>[Article].[Id]</code> ketik <code>int</code> ).  Jika Anda perlu membuat kueri di tabel lain dengan jenis kolom kunci lainnya, saya berasumsi untuk hanya menyalin kelas yang sama dan membuat Kunci dari jenis yang diperlukan. </p><br><p>  Kondisi untuk pembentukan kueri teks lengkap seharusnya diteruskan dalam variabel <code>queryText</code> .  Untuk membentuk teks variabel ini, fungsi terpisah diimplementasikan: </p><br><pre> <code class="plaintext hljs">/// c# string queryText = FtsSearch.Query( dbContext: db, //   ,       ftsEnum: FtsEnum.CONTAINS, //  : CONTAINS  FREETEXT tableQuery: typeof(News), //       tableFts: typeof(FTS_Int), //    search: "text"); //   </code> </pre> <br><p>  Pemenuhan permintaan yang siap dan akuisisi data: </p><br><pre> <code class="plaintext hljs">/// c# var result = FtsSearch.Execute(() =&gt; query.ToList());</code> </pre> <br><p>  Fungsi akhir <code>FtsSearch.Execute</code> wrapper digunakan untuk menghubungkan sementara antarmuka <code>IDbCommandInterceptor</code> .  Dalam contoh yang disediakan oleh tautan di atas, penulis lebih suka menggunakan algoritma substitusi kueri secara konstan untuk semua permintaan.  Akibatnya, setelah menghubungkan mekanisme penggantian permintaan, setiap permintaan mencari kombinasi yang diperlukan untuk penggantian.  Opsi ini tampak boros bagi saya, oleh karena itu, pelaksanaan permintaan data itu sendiri dilakukan dalam fungsi yang dikirimkan, yang sebelum panggilan menghubungkan permintaan penggantian otomatis dan, setelah panggilan, memutusnya. </p><br><h1 id="primenenie">  Aplikasi </h1><br><p>  Saya menggunakan kelas model data generasi otomatis dari database menggunakan file edmx.  Karena Anda tidak bisa menggunakan kelas <code>FTS_Int</code> dibuat di EF karena kurangnya metadata yang diperlukan di <code>DbContext</code> , saya membuat tabel nyata sesuai dengan modelnya (mungkin seseorang tahu cara yang lebih baik, saya akan senang atas bantuan Anda dalam komentar): </p><br><p>  <em>Cuplikan layar dari tabel yang dibuat di file edmx</em> </p><br><p><img src="https://habrastorage.org/webt/p3/my/mm/p3mymmi7n_n6kpsxqibzdrrixfi.png"></p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> [dbo].[FTS_Int] ( [<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, [<span class="hljs-keyword"><span class="hljs-keyword">Query</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">NVARCHAR</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> [PK_FTS_Int] PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> CLUSTERED ([<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">ASC</span></span>) );</code> </pre> <br><p>  Setelah itu, ketika memperbarui file edmx dari database, tambahkan tabel yang dibuat dan dapatkan kelas yang dihasilkan: </p><br><pre> <code class="plaintext hljs">/// c# public partial class FTS_Int { public int Key { get; set; } public int Rank { get; set; } public string Query { get; set; } }</code> </pre> <br><p>  Tidak ada permintaan akan dibuat untuk tabel ini, itu hanya diperlukan agar metadata terbentuk dengan benar untuk membuat kueri.  Contoh terakhir menggunakan kueri basis data teks lengkap: </p><br><pre> <code class="plaintext hljs">/// c# string queryText = FtsSearch.Query( dbContext: db, ftsEnum: FtsEnum.CONTAINS, tableQuery: typeof(Article), tableFts: typeof(FTS_Int), search: "text"); var queryFts = db.FTS_Int.Where(n =&gt; n.Query.Contains(queryText)); var query = db.Article .Where(n =&gt; n.Active) .Join(queryFts, article =&gt; article.Id, fts =&gt; fts.Key, (article, fts) =&gt; new { article, fts.Rank, }) .OrderByDescending(n =&gt; n.Rank) .Take(10) .Select(n =&gt; n.article); var result = FtsSearch.Execute(() =&gt; query.ToList());</code> </pre> <br><p>  Ada juga dukungan untuk permintaan asinkron: </p><br><pre> <code class="plaintext hljs">/// c# var result = await FtsSearch.ExecuteAsync(async () =&gt; await query.ToListAsync());</code> </pre> <br><p>  Permintaan SQL yang dihasilkan sebelum AutoCorrect: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">10</span></span>) [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Project1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Extent1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active], [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dbo].[Article] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> [dbo].[FTS_Int] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ([Extent1].[Active] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ([Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Query</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> @p__linq__0 ESCAPE N<span class="hljs-string"><span class="hljs-string">'~'</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Project1] <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  Permintaan SQL yang dihasilkan setelah koreksi otomatis: </p><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> TOP (<span class="hljs-number"><span class="hljs-number">10</span></span>) [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Project1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Project1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>], [Extent1].[<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-built_in"><span class="hljs-built_in">Text</span></span>], [Extent1].[Active] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Active], [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> [dbo].[Article] <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent1] <span class="hljs-keyword"><span class="hljs-keyword">INNER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> CONTAINSTABLE([dbo].[Article],(*),<span class="hljs-string"><span class="hljs-string">'text'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Extent2] <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> [Extent1].[<span class="hljs-keyword"><span class="hljs-keyword">Id</span></span>] = [Extent2].[<span class="hljs-keyword"><span class="hljs-keyword">Key</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> ([Extent1].[Active] = <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [Project1] <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> [Project1].[<span class="hljs-keyword"><span class="hljs-keyword">Rank</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre> <br><p>  Secara default, pencarian teks lengkap bekerja pada semua kolom tabel: </p><br><pre> <code class="sql hljs">CONTAINSTABLE([dbo].[Article],(*),'text')</code> </pre> <br><p>  Jika Anda hanya perlu memilih bidang tertentu, Anda bisa menentukannya dalam parameter bidang fungsi <code>FtsSearch.Query</code> . </p><br><h1 id="itogo">  Total </h1><br><p>  Hasilnya adalah dukungan pencarian teks lengkap di LINQ. </p><br><p>  Nuansa pendekatan ini. </p><br><ol><li><p>  Parameter pencarian di fungsi <code>FtsSearch.Query</code> tidak menggunakan pemeriksaan atau pembungkus apa pun untuk melindungi dari injeksi SQL.  Nilai variabel ini diteruskan seperti halnya ke teks permintaan.  Jika Anda punya ide tentang ini, tulis di komentar.  Saya menggunakan ekspresi reguler yang biasanya hanya menghapus semua karakter selain huruf dan angka. </p><br></li><li><p>  Anda juga perlu mempertimbangkan fitur membangun ekspresi untuk kueri teks lengkap.  Parameter berfungsi </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> CONTAINSTABLE([dbo].[News],(*),' ')</code> </pre> <br><p>  Ini memiliki format yang tidak valid karena MS SQL membutuhkan pemisahan kata dengan literal logis.  Agar permintaan berhasil diselesaikan, Anda harus memperbaikinya seperti ini: </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> CONTAINSTABLE([dbo].[News],(*),' and ')</code> </pre> <br><p>  atau ubah fungsi pengambilan data </p><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> FREETEXTTABLE([dbo].[News],(*),' ')</code> </pre> <br><p>  Untuk informasi lebih lanjut tentang fitur membuat kueri, lebih baik merujuk ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi resmi</a> . </p><br></li><li><p>  Pencatatan standar dengan solusi ini tidak berfungsi dengan benar.  Logger khusus telah ditambahkan untuk ini: </p><br><pre> <code class="plaintext hljs">/// c# db.Database.Log = (val) =&gt; Console.WriteLine(val);</code> </pre> <br><p>  Jika Anda melihat kueri yang dihasilkan ke database, maka itu akan dihasilkan sebelum memproses fungsi penggantian otomatis. </p><br></li></ol><br><p>  Selama pengujian, saya memeriksa pertanyaan yang lebih kompleks dengan beberapa pilihan dari tabel yang berbeda dan tidak ada masalah. </p><br><p>  Sumber <a href="">GitHub</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id455160/">https://habr.com/ru/post/id455160/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id455146/index.html">Replikasi tingkat tinggi di Tarantool DBMS</a></li>
<li><a href="../id455148/index.html">Kami menyelesaikan tugas pengambilan keputusan berdasarkan data</a></li>
<li><a href="../id455152/index.html">Tingkatkan aplikasi seluler Anda menggunakan teknologi pembelajaran mesin</a></li>
<li><a href="../id455156/index.html">Tugas sequencing domestik (Juni, 2019)</a></li>
<li><a href="../id455158/index.html">Keajaiban metodologi akuntansi: dana depresiasi</a></li>
<li><a href="../id455164/index.html">Elena Balashova: "Para aktivis mengajukan pertanyaan bahwa data portal GIS kami harus terbuka untuk OpenStreetMap"</a></li>
<li><a href="../id455166/index.html">VPN pada router Beeline untuk memotong kunci</a></li>
<li><a href="../id455168/index.html">Demo 492 byte pada ATtiny5</a></li>
<li><a href="../id455170/index.html">Arsitektur baru untuk akses byte ke SSD - cara kerjanya</a></li>
<li><a href="../id455172/index.html">Pohon pencarian biner seimbang: implementasi pada Julia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>