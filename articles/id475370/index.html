<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍⚕️ 🏡 👨🏼‍💼 Algoritma Kahan: Cara Mendapatkan Perbedaan Produk yang Tepat 👰🏽 👩🏽‍💻 📹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saya baru-baru ini kembali ke analisis kesalahan titik apung untuk memperbaiki beberapa detail dalam edisi berikutnya buku Rendering Berbasis Fisik . ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Algoritma Kahan: Cara Mendapatkan Perbedaan Produk yang Tepat</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475370/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/16f/68a/389/16f68a389af6cb230a839586345c4bf5.png" alt="gambar"></div><br>  Saya baru-baru ini kembali ke analisis kesalahan titik apung untuk memperbaiki beberapa detail dalam edisi berikutnya buku <em>Rendering Berbasis Fisik</em> .  Angka floating-point adalah bidang perhitungan yang menarik, penuh kejutan (baik dan buruk), serta trik rumit untuk menghilangkan kejutan yang tidak menyenangkan. <br><br>  Dalam prosesnya, saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting</a> ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di StackOverflow</a> , dari mana saya belajar tentang algoritma yang elegan untuk perhitungan yang tepat <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">a</span><span class="MJXp-mtext" id="MJXp-Span-3">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">b</span><span class="MJXp-mo" id="MJXp-Span-9" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">c</span><span class="MJXp-mtext" id="MJXp-Span-11">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-1"> a \ kali b-c \ kali d </script>  . <br><br>  Tetapi sebelum melanjutkan dengan algoritma, Anda perlu memahami apa yang begitu licik dalam berekspresi <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-17"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">a</span><span class="MJXp-mtext" id="MJXp-Span-19">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">b</span><span class="MJXp-mo" id="MJXp-Span-25" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">c</span><span class="MJXp-mtext" id="MJXp-Span-27">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-2"> a \ kali b-c \ kali d </script>  ?  Ambil <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-33"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">a</span><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-36">33962.035</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-3"> a = 33962.035 </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-37"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">b</span><span class="MJXp-mo" id="MJXp-Span-39" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-40" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-41">30438</span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-43">8</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-4"> b = -30438,8 </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-44"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">c</span><span class="MJXp-mo" id="MJXp-Span-46" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-47">41563</span><span class="MJXp-mo" id="MJXp-Span-48" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-49">4</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> c = 41563,4 </script>  dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-50"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">d</span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-53" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-54">24871.969</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-6"> d = -24871.969 </script>  .  (Ini adalah nilai nyata yang saya dapatkan selama peluncuran <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pbrt</a></em> .) Untuk nilai float 32-bit, kita dapatkan: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">a</span><span class="MJXp-mtext" id="MJXp-Span-57">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">b</span><span class="MJXp-mo" id="MJXp-Span-63" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-64" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-65">1.03376365</span><span class="MJXp-mtext" id="MJXp-Span-66">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-67">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">i</span><span class="MJXp-msubsup" id="MJXp-Span-71"><span class="MJXp-mn" id="MJXp-Span-72" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-73" style="vertical-align: 0.5em;">9</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-7"> a \ kali b = -1.03376365 \ kali 10 ^ 9 </script>  dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-74"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75">c</span><span class="MJXp-mtext" id="MJXp-Span-76">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81">d</span><span class="MJXp-mo" id="MJXp-Span-82" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-84">1.03376352</span><span class="MJXp-mtext" id="MJXp-Span-85">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89">i</span><span class="MJXp-msubsup" id="MJXp-Span-90"><span class="MJXp-mn" id="MJXp-Span-91" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-92" style="vertical-align: 0.5em;">9</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> c \ kali d = -1.03376352 \ kali 10 ^ 9 </script>  .  Kami melakukan pengurangan, dan kami mendapatkannya <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-93"><span class="MJXp-mo" id="MJXp-Span-94" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-95">128</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> -128 </script>  .  Tetapi jika Anda melakukan perhitungan dengan presisi ganda, dan pada akhirnya mengubahnya menjadi mengambang, Anda dapatkan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-96"><span class="MJXp-mo" id="MJXp-Span-97" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-98">75</span><span class="MJXp-mo" id="MJXp-Span-99" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-100">1656</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> -75,1656 </script>  .  Apa yang terjadi <br><br>  Masalahnya adalah bahwa nilai setiap pekerjaan dapat jauh melampaui garis bawah <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="MJXp-mo" id="MJXp-Span-102" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-103">1</span><span class="MJXp-mtext" id="MJXp-Span-104">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-105">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">i</span><span class="MJXp-msubsup" id="MJXp-Span-109"><span class="MJXp-mn" id="MJXp-Span-110" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-111" style="vertical-align: 0.5em;">9</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> -1 \ kali 10 ^ 9 </script>  , di mana jarak antara nilai floating point yang diwakili sangat besar - 64. Artinya, saat pembulatan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-112"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-113">a</span><span class="MJXp-mtext" id="MJXp-Span-114">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">b</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> a \ kali b </script>  dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-120"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">c</span><span class="MJXp-mtext" id="MJXp-Span-122">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> c \ kali d </script>  secara individual, ke float representable terdekat, mereka berubah menjadi angka yang merupakan kelipatan dari 64. Pada gilirannya, perbedaan mereka akan menjadi kelipatan dari 64, dan tidak akan ada harapan bahwa itu akan menjadi <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-128"><span class="MJXp-mo" id="MJXp-Span-129" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-130">75</span><span class="MJXp-mo" id="MJXp-Span-131" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-132">1656</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> -75,1656 </script>  lebih dekat dari <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-133"><span class="MJXp-mo" id="MJXp-Span-134" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-135">64</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> -64 </script>  .  Dalam kasus kami, hasilnya bahkan lebih jauh karena bagaimana keduanya bekerja <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-136"><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0.111em;">−</span><span class="MJXp-mn" id="MJXp-Span-138">1</span><span class="MJXp-mtext" id="MJXp-Span-139">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">i</span><span class="MJXp-msubsup" id="MJXp-Span-144"><span class="MJXp-mn" id="MJXp-Span-145" style="margin-right: 0.05em;">10</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-146" style="vertical-align: 0.5em;">9</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> -1 \ kali 10 ^ 9 </script>  .  Kita akan secara langsung menghadapi pengurangan bencana tua yang baik <sup>1</sup> . <br><a name="habracut"></a><br>  Ini adalah solusi yang lebih baik daripada <sup>2</sup> : <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DifferenceOfProducts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> c, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> d)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cd = c * d; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> err = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::fma(-c, d, cd); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dop = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::fma(a, b, -cd); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dop + err; }</code> </pre> <br>  <code>DifferenceOfProducts()</code> menghitung <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-147"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-148">a</span><span class="MJXp-mtext" id="MJXp-Span-149">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">b</span><span class="MJXp-mo" id="MJXp-Span-155" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">c</span><span class="MJXp-mtext" id="MJXp-Span-157">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-162">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> a \ kali b-c \ kali d </script>  dengan cara yang menghindari kontraksi bencana.  Teknik ini pertama kali dijelaskan oleh William Kahan yang legendaris dalam artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">On Cost of Floating-PointComputasi Tanpa Aritmatika Ekstra Tepat</a> .  Perlu dicatat bahwa karya Kahan menarik untuk dibaca secara keseluruhan, mereka memiliki banyak komentar tentang keadaan dunia saat ini poin mengambang, serta pertimbangan matematika dan teknis.  Inilah salah satu temuannya: <br><br><blockquote>  Kita yang telah berjuang dengan perubahan aritmatika floating point dan "optimisasi" kompiler yang buruk dapat dengan bangga bangga dengan kemenangan dalam pertempuran ini.  Tetapi jika kita meneruskan kelanjutan pertempuran ini untuk generasi masa depan, ini akan bertentangan dengan esensi seluruh peradaban.  Pengalaman kami mengatakan bahwa bahasa pemrograman dan sistem pengembangan adalah sumber dari terlalu banyak kekacauan yang harus kita tangani.  Terlalu banyak kesalahan dapat ditiadakan, serta beberapa "optimasi" menarik yang aman untuk bilangan bulat, tetapi kadang-kadang terbukti berakibat fatal untuk angka floating point. </blockquote><br>  Setelah membayar upeti untuk kecerdasannya, mari kita kembali ke <code>DifferenceOfProducts()</code> : dasar dari penguasaan fungsi ini adalah penggunaan penggandaan multiply-add, instruksi FMA <sup>3</sup> .  Dari sudut pandang matematika, <code>FMA(a,b,c)</code> adalah <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-163"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">a</span><span class="MJXp-mtext" id="MJXp-Span-165">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-170">b</span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> a \ kali b + c </script>  Karena itu, pada awalnya tampaknya operasi ini hanya berguna sebagai optimasi mikro: satu instruksi, bukan dua.  Namun fma <br>  Ini memiliki properti khusus - itu hanya membulatkan sekali. <br><br>  Seperti biasa <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">a</span><span class="MJXp-mtext" id="MJXp-Span-175">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">b</span><span class="MJXp-mo" id="MJXp-Span-181" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> a \ kali b + c </script>  pertama kali dihitung <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-183"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-184">a</span><span class="MJXp-mtext" id="MJXp-Span-185">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-190">b</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> a \ kali b </script>  , dan kemudian nilai ini, yang dalam kasus umum tidak dapat direpresentasikan dalam format floating point, dibulatkan ke float terdekat.  Kemudian untuk nilai bulat ini ditambahkan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> c </script>  , dan hasil ini kembali dibulatkan ke pelampung terdekat.  FMA diimplementasikan sedemikian rupa sehingga pembulatan dilakukan hanya pada akhirnya - nilai menengah <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-193"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">a</span><span class="MJXp-mtext" id="MJXp-Span-195">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">b</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> a \ kali b </script>  mempertahankan akurasi yang cukup, jadi setelah menambahkannya <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-201"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> c </script>  hasil akhir akan paling mendekati nilai sebenarnya <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-203"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">a</span><span class="MJXp-mtext" id="MJXp-Span-205">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">b</span><span class="MJXp-mo" id="MJXp-Span-211" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">c</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> a \ kali b + c </script>  nilai float. <br><br>  Setelah berurusan dengan FMA, kami akan kembali ke <code>DifferenceOfProducts()</code> .  Sekali lagi, saya akan menunjukkan dua baris pertama: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cd = c * d; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> err = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::fma(-c, d, cd);</code> </pre> <br>  Yang pertama menghitung nilai bulat <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-213"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">c</span><span class="MJXp-mtext" id="MJXp-Span-215">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> c \ kali d </script>  dan yang kedua ... kurangi <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-221"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-222">c</span><span class="MJXp-mtext" id="MJXp-Span-223">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> c \ kali d </script>  dari pekerjaan mereka?  Jika Anda tidak tahu cara kerja FMA, maka Anda mungkin berpikir bahwa <code>err</code> akan selalu menjadi nol.  Tetapi ketika bekerja dengan FMA, baris kedua sebenarnya mengekstraksi nilai kesalahan pembulatan dalam nilai yang dihitung <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-229"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">c</span><span class="MJXp-mtext" id="MJXp-Span-231">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-236">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> c \ kali d </script>  dan menyimpannya untuk <code>err</code> .  Setelah itu, hasilnya sangat sederhana: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dop = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::fma(a, b, -cd); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dop + err;</code> </pre> <br>  FMA kedua menghitung perbedaan antara karya-karya menggunakan FMA, melakukan pembulatan hanya di bagian paling akhir.  Akibatnya, tahan terhadap pengurangan bencana, tetapi perlu bekerja dengan nilai bulat. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-237"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238">c</span><span class="MJXp-mtext" id="MJXp-Span-239">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">k</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-241">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-243">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> c \ kali d </script>  .  <code>return</code> "memperbaiki" masalah ini, menambahkan kesalahan yang disorot di baris kedua.  Dalam sebuah artikel oleh Jeannenrod et al.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ditunjukkan</a> bahwa hasilnya benar hingga 1,5 ulps (ukuran presisi unit), yang sangat bagus: FMA dan operasi floating point sederhana akurat hingga 0,5 ulps, sehingga algoritmenya hampir sempurna. <br><br><h2>  Kami menggunakan palu baru </h2><br>  Ketika Anda mulai mencari cara untuk menggunakan <code>DifferenceOfProducts()</code> , ternyata sangat berguna.  Menghitung pembeda persamaan kuadrat?  Call <code>DifferenceOfProducts(b, b, 4 * a, c)</code> <sup>4</sup> .  Menghitung determinan matriks 2x2?  Algoritma akan menyelesaikan masalah ini.  Dalam versi <em>pbrt</em> berikutnya <em>,</em> saya menemukan sekitar 80 kegunaan untuk itu.  Dari mereka semua, fungsi produk vektor adalah yang paling dicintai.  Itu selalu menjadi sumber masalah, karena itu Anda harus mengangkat tangan dan menggunakan ganda dalam implementasi untuk menghindari pengurangan bencana: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> Vector3f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cross</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3f &amp;v1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3f &amp;v2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v1x = v1.x, v1y = v1.y, v1z = v1.z; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> v2x = v2.x, v2y = v2.y, v2z = v2.z; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector3f(v1y * v2z - v1z * v2y, v1z * v2x - v1x * v2z, v1x * v2y - v1y * v2x); }</code> </pre> <br>  Dan sekarang kita dapat terus bekerja dengan float dan menggunakan <code>DifferenceOfProducts()</code> . <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> Vector3f </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cross</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3f &amp;v1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Vector3f &amp;v2)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Vector3f(DifferenceOfProducts(v1.y, v2.z, v1.z, v2.y), DifferenceOfProducts(v1.z, v2.x, v1.x, v2.z), DifferenceOfProducts(v1.x, v2.y, v1.y, v2.x)); }</code> </pre> <br>  Contoh licik dari awal posting sebenarnya adalah bagian dari karya vektor.  Pada tahap tertentu, kode <em>pbrt perlu</em> menghitung produk vektor dari vektor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-245"><span class="MJXp-mo" id="MJXp-Span-246" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-247">33962.035</span><span class="MJXp-mo" id="MJXp-Span-248" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-249">41563.4</span><span class="MJXp-mo" id="MJXp-Span-250" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-251">7706.415</span><span class="MJXp-mo" id="MJXp-Span-252" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> (33962.035, 41563.4, 7706.415) </script>  dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-253"><span class="MJXp-mo" id="MJXp-Span-254" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-255" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-256">24871.969</span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-258" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-259">30438.8</span><span class="MJXp-mo" id="MJXp-Span-260" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-262">5643.727</span><span class="MJXp-mo" id="MJXp-Span-263" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> (- 24871.969, -30438.8, -5643.727) </script>  .  Ketika dihitung menggunakan float, kita akan mendapatkan vektor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-264"><span class="MJXp-mo" id="MJXp-Span-265" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-266">1552</span><span class="MJXp-mo" id="MJXp-Span-267" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-268" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-269">1248</span><span class="MJXp-mo" id="MJXp-Span-270" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-271" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-272">128</span><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> (1552, -1248, -128) </script>  .  (Aturan umum: jika dalam perhitungan titik apung di mana angka besar terlibat, Anda tidak mendapatkan nilai integer yang begitu besar, maka ini adalah tanda yang hampir pasti bahwa pengurangan bencana telah terjadi.) <br><br>  Dengan presisi ganda, produk vektor adalah <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-274"><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-276">1556.0276</span><span class="MJXp-mo" id="MJXp-Span-277" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-278" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-279">1257.5151</span><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-281" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-282">75.1656</span><span class="MJXp-mo" id="MJXp-Span-283" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> (1556.0276, -1257.5151, -75.1656) </script>  .  Kita melihatnya dengan pelampung <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> x </script>  terlihat normal <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-286"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> y </script>  sudah sangat buruk juga <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-288"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-289">z</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> z </script>  menjadi bencana yang telah menjadi motivasi untuk menemukan solusi.  Dan hasil apa yang akan kita dapatkan dengan <code>DifferenceOfProducts()</code> dan nilai float? <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-290"><span class="MJXp-mo" id="MJXp-Span-291" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-292">1556.0276</span><span class="MJXp-mo" id="MJXp-Span-293" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-294" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-295">1257.5153</span><span class="MJXp-mo" id="MJXp-Span-296" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0.267em; margin-right: 0.267em;">−</span><span class="MJXp-mn" id="MJXp-Span-298">75.1656</span><span class="MJXp-mo" id="MJXp-Span-299" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> (1556.0276, -1257.5153, -75.1656) </script>  .  Nilai-nilai <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-300"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> x </script>  dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-302"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-303">z</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38"> z </script>  sesuai dengan presisi ganda, dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-304"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-305">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> y </script>  sedikit diimbangi - karenanya ulp ekstra berasal dari. <br><br>  Bagaimana dengan kecepatan?  <code>DifferenceOfProducts()</code> melakukan dua FMA, serta multiplikasi dan penambahan.  Algoritma naif dapat diimplementasikan dengan satu FMA dan satu multiplikasi, yang, tampaknya, akan memakan waktu setengah.  Namun dalam praktiknya, ternyata setelah mendapatkan nilai dari register, itu tidak masalah: dalam tolok ukur sintetis yang dipegang di laptop saya, <code>DifferenceOfProducts()</code> hanya 1,09 kali lebih mahal daripada algoritma naif.  Operasi presisi ganda lebih lambat 2,98 kali. <br><br>  Segera setelah Anda mengetahui tentang kemungkinan pengurangan bencana, semua jenis ekspresi yang tampak tidak bersalah dalam kode mulai tampak mencurigakan.  <code>DifferenceOfProducts()</code> tampaknya menjadi obat yang baik untuk sebagian besar dari mereka.  Mudah digunakan, dan kami tidak punya alasan khusus untuk tidak menggunakannya. <br><br><h2>  Catatan </h2><br><ol><li>  Pengurangan katastropik tidak menjadi masalah ketika mengurangi jumlah dengan tanda yang berbeda atau ketika menambahkan nilai dengan tanda yang sama.  Namun, ini bisa menjadi masalah saat menambahkan nilai dengan tanda yang berbeda.  Artinya, jumlahnya harus dipertimbangkan dengan kecurigaan yang sama dengan perbedaan. </li><li>  Sebagai latihan untuk pembaca, saya sarankan untuk menulis fungsi <code>SumOfProducts()</code> , yang memberikan perlindungan terhadap kontraksi bencana.  Jika Anda ingin menyulitkan tugas, maka jelaskan mengapa di <code>DifferenceOfProducts()</code> , <code>dop + err == dop</code> , karena tanda-tanda <code>a*b</code> dan <code>c*d</code> berbeda. </li><li>  Instruksi FMA telah tersedia di GPU selama lebih dari satu dekade, dan pada sebagian besar CPU setidaknya selama lima tahun.  Mungkin perlu menambahkan flag compiler ke CPU untuk secara langsung membuatnya ketika menggunakan <code>std::fma()</code> ;  dalam gcc dan dentang, <code>-march=native</code> karya <code>-march=native</code> . </li><li>  Dalam format floating point IEEE, perkalian dengan kekuatan dua dilakukan persis, sehingga <code>4 * a</code> tidak menyebabkan kesalahan pembulatan, kecuali terjadi overflow. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id475370/">https://habr.com/ru/post/id475370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id475346/index.html">Ketika militer AS mencoba membaca pikiran</a></li>
<li><a href="../id475354/index.html">Selamat Hari Spesialis Keamanan</a></li>
<li><a href="../id475358/index.html">Analisis gaji di sektor TI Armenia plus lowongan terbuka di perusahaan-perusahaan TI TOP10</a></li>
<li><a href="../id475366/index.html">Droidcon London 2019: tren baru dan laporan paling menarik</a></li>
<li><a href="../id475368/index.html">Cara menghitung efektivitas iklan</a></li>
<li><a href="../id475372/index.html">Domain front-end berdasarkan TLS 1.3</a></li>
<li><a href="../id475378/index.html">“Kami tidak dapat menyerahkan hak data pribadi kepada perusahaan besar” - mantan pemimpin redaksi Wired UK tentang masa depan teknologi</a></li>
<li><a href="../id475386/index.html">Perhatian, FAS: bagaimana tidak melanggar UU Periklanan. Memo Pengiklan</a></li>
<li><a href="../id475388/index.html">Minggu Keamanan 46: mikrofon, laser, dan keamanan mesin yang terlatih</a></li>
<li><a href="../id475390/index.html">Cara membuat aplikasi web pertama Anda menggunakan Go</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>