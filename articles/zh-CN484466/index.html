<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ†” ğŸ™ŒğŸ¿ ğŸ‘§ğŸ¿ æ¯ä¸ªäººéƒ½åº”è¯¥çŸ¥é“çš„å¸¸è§JavaScriptæ‰¿è¯º ğŸ¤µğŸ¾ ğŸ”„ ğŸ’¬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="æœ‹å‹ä»¬ï¼Œç¾å¥½çš„ä¸€å¤©ï¼ 

 æˆ‘å‘æ‚¨ä»‹ç»Apal Shahæ–‡ç« çš„ç¿»è¯‘ï¼Œ â€œæ¯ä¸ªåˆå­¦è€…éƒ½åº”è¯¥çŸ¥é“å¹¶é¿å…çš„å¸¸è§Javascript Promiseé”™è¯¯ ã€‚ â€ 

 æ¯ä¸ªäººéƒ½åº”è¯¥çŸ¥é“çš„å¸¸è§JavaScriptæ‰¿è¯º 
 åœ¨å­¦ä¹ JavaScriptå’ŒPromiseæ—¶ï¼Œæˆ‘æƒ³äº†è§£è¿™äº›é”™è¯¯ã€‚ 

 æ¯å½“æœ‰å¼€å‘äººå‘˜æ‰“...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æ¯ä¸ªäººéƒ½åº”è¯¥çŸ¥é“çš„å¸¸è§JavaScriptæ‰¿è¯º</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484466/"><img src="https://habrastorage.org/webt/dc/lq/9d/dclq9djzk7v2ojkzdgcu-9fes4w.jpeg"><br><br> æœ‹å‹ä»¬ï¼Œç¾å¥½çš„ä¸€å¤©ï¼ <br><br> æˆ‘å‘æ‚¨ä»‹ç»Apal Shahæ–‡ç« çš„ç¿»è¯‘ï¼Œ <a href="https://gosink.in/common-javascript-promise-mistakes-beginners/" rel="nofollow">â€œæ¯ä¸ªåˆå­¦è€…éƒ½åº”è¯¥çŸ¥é“å¹¶é¿å…çš„å¸¸è§Javascript Promiseé”™è¯¯</a> ã€‚ <a href="https://gosink.in/common-javascript-promise-mistakes-beginners/" rel="nofollow">â€</a> <br><br><h2> æ¯ä¸ªäººéƒ½åº”è¯¥çŸ¥é“çš„å¸¸è§JavaScriptæ‰¿è¯º </h2><br> åœ¨å­¦ä¹ JavaScriptå’ŒPromiseæ—¶ï¼Œæˆ‘æƒ³äº†è§£è¿™äº›é”™è¯¯ã€‚ <br><br> æ¯å½“æœ‰å¼€å‘äººå‘˜æ‰“ç”µè¯ç»™æˆ‘å¹¶æŠ±æ€¨ä»–çš„ä»£ç æ— æ³•æ­£å¸¸å·¥ä½œæˆ–æ‰§è¡Œç¼“æ…¢æ—¶ï¼Œæˆ‘é¦–å…ˆè¦æ³¨æ„è¿™äº›é”™è¯¯ã€‚ å½“æˆ‘4å¹´å‰å¼€å§‹ç¼–ç¨‹æ—¶ï¼Œæˆ‘å¹¶ä¸äº†è§£å®ƒä»¬ï¼Œå¹¶ä¸”ä¹ æƒ¯äºå¿½ç•¥å®ƒä»¬ã€‚ ä½†æ˜¯ï¼Œåœ¨åˆ†é…ç»™ä¸€ä¸ªåœ¨å‡ åˆ†é’Ÿå†…å¤„ç†å¤§çº¦ä¸€ç™¾ä¸‡ä¸ªè¯·æ±‚çš„é¡¹ç›®ä¹‹åï¼Œæˆ‘åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ä¼˜åŒ–æˆ‘çš„ä»£ç ï¼ˆå› ä¸ºæˆ‘ä»¬è¾¾åˆ°äº†æ— æ³•è¿›ä¸€æ­¥å‚ç›´æ‰©å±•çš„æ°´å¹³ï¼‰ã€‚ <br><br> å› æ­¤ï¼Œåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³è°ˆè°ˆåœ¨JSä¸­ä½¿ç”¨promiseæ—¶æœ€å¸¸è§çš„é”™è¯¯ï¼Œè®¸å¤šäººæ²¡æœ‰æ³¨æ„ã€‚ <br><a name="habracut"></a><br><h3> é”™è¯¯1ï¼šåœ¨Promiseä¸­ä½¿ç”¨try / catchå— </h3><br> åœ¨promiseä¸­ä½¿ç”¨try / catchå—æ˜¯ä¸åˆ‡å®é™…çš„ï¼Œå› ä¸ºå¦‚æœæ‚¨çš„ä»£ç å¼•å‘é”™è¯¯ï¼ˆåœ¨promiseå†…éƒ¨ï¼‰ï¼Œåˆ™promiseæœ¬èº«çš„é”™è¯¯å¤„ç†ç¨‹åºå°†æ‹¦æˆªè¯¥é”™è¯¯ã€‚ <br><br> è¿™æ˜¯å…³äºä»€ä¹ˆçš„ï¼š <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = someFunction() <span class="hljs-comment"><span class="hljs-comment">//   resolve() } catch(e) { reject(e) } }) .then(data =&gt; console.log(data)) .catch(error =&gt; console.log(error))</span></span></code> </pre> <br> ç›¸åï¼Œè®©ä»£ç å¤„ç†æ‰¿è¯ºä¹‹å¤–çš„é”™è¯¯ï¼š <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = someFunction() <span class="hljs-comment"><span class="hljs-comment">//   resolve(data) }) .then(data =&gt; console.log(data)) .catch(error =&gt; console.log(error))</span></span></code> </pre><br> é™¤éå¦‚ä¸‹æ‰€è¿°ï¼Œå¦åˆ™å®ƒå°†å§‹ç»ˆæœ‰æ•ˆã€‚ <br><br><h3> é”™è¯¯2ã€‚åœ¨Promiseä¸­ä½¿ç”¨å¼‚æ­¥å‡½æ•° </h3><br> ä½¿ç”¨å¼‚æ­¥åŠŸèƒ½æ—¶ï¼ŒPromiseä¸­ä¼šå‡ºç°ä¸€äº›ä¸æ„‰å¿«çš„å‰¯ä½œç”¨ã€‚ <br><br> å‡è®¾æ‚¨å†³å®šæ‰§è¡Œä¸€äº›å¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨è¯ºè¨€ä¸­æ·»åŠ å…³é”®å­—â€œ asyncâ€ï¼Œå¹¶ä¸”æ‚¨çš„ä»£ç å°†å¼•å‘é”™è¯¯ã€‚ ä½†æ˜¯ï¼Œç°åœ¨æ‚¨æ— æ³•ä½¿ç”¨.catchï¼ˆï¼‰æˆ–awaitå¤„ç†æ­¤é”™è¯¯ï¼š <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//       new Promise(async() =&gt; { throw new Error('message') }).catch(e =&gt; console.log(e.message)) //        (async() =&gt; { try { await new Promise(async() =&gt; { throw new Error('message') }) } catch(e) { console.log(e.message) } })();</span></span></code> </pre><br> æ¯å½“æˆ‘åœ¨promiseä¸­é‡åˆ°å¼‚æ­¥å‡½æ•°æ—¶ï¼Œæˆ‘éƒ½ä¼šå°è¯•å°†å®ƒä»¬åˆ†å¼€ã€‚ æˆ‘åœ¨10ä¸ªæ¡ˆä¾‹ä¸­æœ‰9ä¸ªå¾—åˆ°äº†å®ƒã€‚ ä½†æ˜¯ï¼Œè¿™å¹¶ä¸æ€»æ˜¯å¯èƒ½çš„ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½åœ¨promiseä¸­ä½¿ç”¨try / catchå—ï¼ˆæ˜¯çš„ï¼Œè¿™ä¸ç¬¬ä¸€ä¸ªé”™è¯¯ç›¸çŸ›ç›¾ï¼Œä½†è¿™æ˜¯å”¯ä¸€çš„å‡ºè·¯ï¼‰ï¼š <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span>(resolve, reject) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'message'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(error) { reject(error) } }).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e.message)) <span class="hljs-comment"><span class="hljs-comment">//   async/await (async() =&gt; { try { await new Promise(async(resolve, reject) =&gt; { try { throw new Error('message') } catch(error) { reject(error) } }) } catch(e) { console.log(e.message) } })();</span></span></code> </pre><br><h3> é”™è¯¯3ã€‚å¿˜è®°.catchï¼ˆï¼‰ </h3><br> è¿™æ˜¯ç›´åˆ°æµ‹è¯•å¼€å§‹æ‚¨éƒ½ä¸æ€€ç–‘å­˜åœ¨çš„é”™è¯¯ä¹‹ä¸€ã€‚ æˆ–è€…ï¼Œå¦‚æœæ‚¨æ˜¯ä¸ç›¸ä¿¡æµ‹è¯•çš„æ— ç¥è®ºè€…ï¼Œé‚£ä¹ˆæ‚¨çš„ä»£ç è‚¯å®šä¼šåœ¨<a href="https://dic.academic.ru/dic.nsf/ruwiki/1328397" rel="nofollow">ç”Ÿäº§ç¯å¢ƒä¸­</a>å´©æºƒã€‚ å› ä¸ºç”Ÿäº§ä¸¥æ ¼éµå¾ª<a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD_%25D0%259C%25D0%25B5%25D1%2580%25D1%2584%25D0%25B8" rel="nofollow">å¢¨è²å®šå¾‹</a> ï¼Œè¯¥<a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD_%25D0%259C%25D0%25B5%25D1%2580%25D1%2584%25D0%25B8" rel="nofollow">å®šå¾‹</a>æŒ‡å‡ºï¼šâ€œä»»ä½•å¯èƒ½å‡ºé”™çš„åœ°æ–¹éƒ½ä¼šå‡ºé”™â€ï¼ˆæ‚¨å¯ä»¥ç¿»è¯‘ä¸ºï¼šâ€œå¦‚æœæŸäº›åœ°æ–¹å¯èƒ½å‡ºé”™ï¼Œé‚£ä¹ˆå®ƒå°†å‘ç”Ÿâ€ï¼›ä¿„è¯­ä¸­çš„ç±»æ¯”æ˜¯â€œå‘é„™çš„æ³•å¾‹â€ï¼‰ -å¤§çº¦ <br><br> ä¸ºäº†ä½¿ä»£ç æ›´åŠ ä¼˜é›…ï¼Œæ‚¨å¯ä»¥å°†promiseå°è£…åœ¨try / catchä¸­ï¼Œè€Œä¸æ˜¯ä½¿ç”¨.thenï¼ˆï¼‰ã€‚Catchï¼ˆï¼‰ã€‚ <br><br><h3> é”™è¯¯4ã€‚è¯·å‹¿ä½¿ç”¨Promise.allï¼ˆï¼‰ </h3><br>  Promise.allï¼ˆï¼‰æ˜¯æ‚¨çš„æœ‹å‹ã€‚ <br><br> å¦‚æœæ‚¨æ˜¯ä¸“ä¸šçš„å¼€å‘äººå‘˜ï¼Œæ‚¨å¯èƒ½ç†è§£æˆ‘æƒ³è¯´çš„è¯ã€‚ å¦‚æœæ‚¨æœ‰å¤šä¸ªå½¼æ­¤ä¸ä¾èµ–çš„æ‰¿è¯ºï¼Œåˆ™å¯ä»¥åŒæ—¶æ‰§è¡Œå®ƒä»¬ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œpromiseæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦é¡ºåºæ‰§è¡Œå®ƒä»¬ï¼ˆä½¿ç”¨awaitï¼‰ï¼Œåˆ™å°†èŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚  Promise.allï¼ˆï¼‰å¯ä»¥å¤§å¤§å‡å°‘å»¶è¿Ÿï¼š <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {promisify} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sleep = promisify(setTimeout) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f3</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">3000</span></span>) } <span class="hljs-comment"><span class="hljs-comment">//   (async() =&gt; { console.time('sequential') await f1() await f2() await f3() console.timeEnd('sequential') //  6  })();</span></span></code> </pre><br> ç°åœ¨æœ‰äº†Promise.allï¼ˆï¼‰ï¼š <br><pre> <code class="javascript hljs">(<span class="hljs-keyword"><span class="hljs-keyword">async</span></span>() =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.time(<span class="hljs-string"><span class="hljs-string">'concurrent'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all([f1(), f2(), f3()]) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.timeEnd(<span class="hljs-string"><span class="hljs-string">'concurrent'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  3  })();</span></span></code> </pre><br><h3> é”™è¯¯5ã€‚Promise.raceï¼ˆï¼‰çš„ä½¿ç”¨ä¸å½“ </h3><br>  Promise.raceï¼ˆï¼‰å¹¶ä¸æ€»æ˜¯ä½¿æ‚¨çš„ä»£ç æ›´å¿«ã€‚ <br><br> å¯èƒ½çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä½†ç¡®å®å¦‚æ­¤ã€‚ æˆ‘å¹¶ä¸æ˜¯è¯´Promise.raceï¼ˆï¼‰æ˜¯ä¸€ç§æ— ç”¨çš„æ–¹æ³•ï¼Œä½†æ˜¯æ‚¨å¿…é¡»æ¸…æ¥šåœ°ç†è§£ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å®ƒã€‚ <br><br> ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨è§£å†³ä»»ä½•æ‰¿è¯ºåä½¿ç”¨Promise.raceï¼ˆï¼‰è¿è¡Œä»£ç ã€‚ ä½†è¿™å¹¶ä¸æ„å‘³ç€éµå¾ªæ‰¿è¯ºçš„ä»£ç çš„æ‰§è¡Œå°†åœ¨å…¶ä¸­ä¸€ä¸ªæ‰¿è¯ºè§£å†³ä¹‹åç«‹å³å¼€å§‹ã€‚  Promise.raceï¼ˆï¼‰å°†ç­‰å¾…æ‰€æœ‰promiseè§£æï¼Œç„¶åæ‰é‡Šæ”¾æµï¼š <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {promisify} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'util'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sleep = promisify(setTimeout) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f3</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sleep(<span class="hljs-number"><span class="hljs-number">3000</span></span>) } (<span class="hljs-keyword"><span class="hljs-keyword">async</span></span>() =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.time(<span class="hljs-string"><span class="hljs-string">'race'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.race([f1(), f2(), f3()]) })(); process.on(<span class="hljs-string"><span class="hljs-string">'exit'</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.timeEnd(<span class="hljs-string"><span class="hljs-string">'race'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//  3 ,    ! })</span></span></code> </pre><br><h3> é”™è¯¯6ã€‚æ»¥ç”¨æ‰¿è¯º </h3><br> æ‰¿è¯ºä¼šä½¿ä»£ç å˜æ…¢ï¼Œå› æ­¤è¯·ä¸è¦æ»¥ç”¨å®ƒä»¬ã€‚ <br><br> é€šå¸¸ï¼Œæ‚¨å¿…é¡»çœ‹åˆ°å¼€å‘äººå‘˜ä½¿ç”¨è¾ƒé•¿çš„.thenï¼ˆï¼‰é“¾æ¥ä½¿ä»–ä»¬çš„ä»£ç çœ‹èµ·æ¥æ›´å¥½ã€‚ ç”±äºè¯¥é“¾å˜å¾—å¤ªé•¿ï¼Œæ‚¨å°†æ²¡æœ‰æ—¶é—´çœ¨çœ¼ã€‚ ä¸ºäº†ä»è§†è§‰ä¸ŠéªŒè¯è¿™ç§æƒ…å†µçš„è´Ÿé¢åæœï¼Œæœ‰å¿…è¦ï¼ˆæˆ‘å°†è¿›ä¸€æ­¥åç¦»åŸæ–‡ï¼Œä»¥ä¾¿æ¯”æ–‡ç« ä¸­æ›´è¯¦ç»†åœ°æè¿°è¯¥è¿‡ç¨‹-å¤§çº¦Transï¼‰ï¼š <br><br>  1ï¼‰åˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å†…å®¹çš„script.jsæ–‡ä»¶ï¼ˆå¸¦æœ‰é¢å¤–çš„æ‰¿è¯ºï¼‰ï¼š <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  ,    const user = { name: 'John Doe', age: 50, } resolve(user) }).then(userObj =&gt; { const {age} = userObj return age }).then(age =&gt; { if(age &gt; 25) { return true } throw new Error('Age is less than 25') }).then(() =&gt; { console.log('Age is greater than 25') }).catch(e =&gt; { console.log(e.message) })</span></span></code> </pre><br>  2ï¼‰æ‰“å¼€å‘½ä»¤è¡Œï¼ˆå¯¹äºWindowsç”¨æˆ·ï¼šåœ¨åŒ…å«æ‰€éœ€æ–‡ä»¶çš„æ–‡ä»¶å¤¹ä¸­æ‰“å¼€å‘½ä»¤è¡Œï¼ŒæŒ‰ä½Shiftï¼Œå•å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©â€œæ‰“å¼€å‘½ä»¤çª—å£â€ï¼‰ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œscript.jsï¼ˆå¿…é¡»å®‰è£…Nodeã€‚ jsï¼‰ï¼š <br><pre> <code class="javascript hljs">node --trace-events-enabled script.js</code> </pre><br>  3ï¼‰Node.jsä½¿ç”¨è„šæœ¬åœ¨æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹ä¸ºnode_trace.1.txtï¼‰ï¼› <br><br>  4ï¼‰æ‰“å¼€Chromeï¼ˆå› ä¸ºå®ƒåªèƒ½åœ¨å…¶ä¸­ä½¿ç”¨ï¼‰ï¼Œåœ¨åœ°å€æ ä¸­è¾“å…¥â€œ chromeï¼š//è·Ÿè¸ªâ€ï¼› <br><br>  5ï¼‰ç‚¹å‡»Loadï¼ŒåŠ è½½Node.jsåˆ›å»ºçš„æ—¥å¿—æ–‡ä»¶ï¼› <br><br>  6ï¼‰æ‰“å¼€Promiseé€‰é¡¹å¡ã€‚ <br><br> æˆ‘ä»¬çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š <br><img src="https://habrastorage.org/webt/hg/hf/t4/hghft4f5rd2v0v0hxcwahgkgkbs.png"><br><br> ç»¿è‰²å—æ˜¯æ‰¿è¯ºï¼Œæ¯ä¸ªå—éƒ½éœ€è¦å‡ æ¯«ç§’æ‰èƒ½å®Œæˆã€‚ å› æ­¤ï¼Œæ‰¿è¯ºè¶Šå¤šï¼Œå±¥è¡Œçš„æ—¶é—´å°±è¶Šé•¿ã€‚ <br><br> æˆ‘ä»¬é‡å†™script.jsï¼š <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">resolve, reject</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> user = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'John Doe'</span></span>, <span class="hljs-attr"><span class="hljs-attr">age</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(user.age &gt; <span class="hljs-number"><span class="hljs-number">25</span></span>) { resolve() } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { reject(<span class="hljs-string"><span class="hljs-string">'Age is less than 25'</span></span>) } }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Age is greater than 25'</span></span>) }).catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e.message) })</code> </pre><br> é‡å¤â€œè·Ÿè¸ªâ€ã€‚ <br><br> æˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š <br><img src="https://habrastorage.org/webt/5r/g6/0b/5rg60bujijqeshcr9z7omfd9tzs.png"><br><br> ç»¿è‰²å—ï¼ˆæ‰¿è¯ºï¼‰è¾ƒå°‘ï¼Œè¿™æ„å‘³ç€ä»£ç æ‰§è¡Œæ—¶é—´å·²å‡å°‘ã€‚ <br><br> å› æ­¤ï¼Œä»…åœ¨éœ€è¦æ‰§è¡Œä¸€äº›å¼‚æ­¥ä»£ç æ—¶ï¼Œæ‰åº”ä½¿ç”¨å¤šä¸ªPromiseã€‚ <br><br> è°¢è°¢æ‚¨çš„å…³æ³¨ã€‚ å‘¨æœ«æ„‰å¿«ï¼ æˆ‘å°†å¾ˆé«˜å…´æ”¶åˆ°ä»»ä½•è¯„è®ºã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN484466/">https://habr.com/ru/post/zh-CN484466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN484454/index.html">å“ˆå¸ƒæ‹‰ä¾¦æ¢ï¼šä½ çš„ç…§ç‰‡ä¸¢äº†</a></li>
<li><a href="../zh-CN484456/index.html">ReactJSï¼ŒæœåŠ¡å™¨ç«¯æ¸²æŸ“å’Œå¤„ç†é¡µé¢å…ƒæ ‡è®°çš„ä¸€äº›æŠ€å·§</a></li>
<li><a href="../zh-CN484458/index.html">è¿™ä¸ªè‡ªç”±èŒä¸šè€…åäº†-ä¸‹ä¸€ä¸ªç»™æˆ‘</a></li>
<li><a href="../zh-CN484462/index.html">æŠ„è¢­Githubï¼šæœç´¢è¦å¼€å‘çš„â€œç§˜å¯†â€</a></li>
<li><a href="../zh-CN484464/index.html">æ—¥æœ¬æ‘©æ‰˜è½¦æ‹å–ï¼Œè¿™ä¸€åˆ‡å¦‚ä½•å‘ç”Ÿ</a></li>
<li><a href="../zh-CN484468/index.html">çº¢è‰²ä¼ä¸šæ–‡åŒ–æ˜¯ä¿„ç½—æ–¯å•†ä¸šçš„ä¸»è¦é—®é¢˜ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰</a></li>
<li><a href="../zh-CN484470/index.html">JavaScriptä¸­çš„å¯æ‰©å±•æ‰©å±•</a></li>
<li><a href="../zh-CN484472/index.html">ä½¿ç”¨asyncioåœ¨MicroPython v.1.12ä¸Šåˆ›å»ºå¼‚æ­¥è®¾å¤‡é©±åŠ¨ç¨‹åº</a></li>
<li><a href="../zh-CN484480/index.html">ç¾å›½5å¤§ç§‘æŠ€å…¬å¸çš„æ€»å¸‚å€¼è¶…è¿‡5ä¸‡äº¿ç¾å…ƒ</a></li>
<li><a href="../zh-CN484482/index.html">å…³äºæ°´å¤„ç†çš„å°å‹æ•™è‚²è®¡åˆ’</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>