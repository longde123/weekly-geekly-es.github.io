<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚èÆÔ∏è üë©üèæ‚Äçüè≠ üôà Reconnaissance d'objets en temps r√©el sur iOS √† l'aide de YOLOv3 üöµüèª üÉè üéÆ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! 

 Dans cet article, nous allons √©crire un petit programme pour r√©soudre le probl√®me de la d√©tection et de la reconnaissance d'objets ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Reconnaissance d'objets en temps r√©el sur iOS √† l'aide de YOLOv3</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460869/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gr/ah/g9/grahg9mh7movhc2fcbn7m-yfoxu.png"></div><br>  Bonjour √† tous! <br><br>  Dans cet article, nous allons √©crire un petit programme pour r√©soudre le probl√®me de la d√©tection et de la reconnaissance d'objets (d√©tection d'objets) en temps r√©el.  Le programme sera √©crit dans le langage de programmation Swift pour la plate-forme iOS.  Pour d√©tecter des objets, nous utiliserons un r√©seau neuronal convolutif avec une architecture appel√©e YOLOv3.  Dans l'article, nous apprendrons comment travailler dans iOS avec des r√©seaux de neurones en utilisant le framework CoreML, un peu de compr√©hension de ce qu'est le r√©seau YOLOv3 et comment utiliser et traiter les sorties de ce r√©seau.  Nous allons √©galement v√©rifier le fonctionnement du programme et comparer plusieurs variantes de YOLOv3: YOLOv3-tiny et YOLOv3-416. <br><br>  Les sources seront disponibles √† la fin de l'article, afin que chacun puisse tester le fonctionnement du r√©seau neuronal sur son appareil. <br><a name="habracut"></a><br><h2>  D√©tection d'objets </h2><br>  Pour commencer, nous allons bri√®vement comprendre quelle est la t√¢che de d√©tecter des objets (d√©tection d'objets) dans l'image et quels outils sont utilis√©s pour cela aujourd'hui.  Je comprends que beaucoup connaissent bien ce sujet, mais je me permets quand m√™me d'en parler un peu. <br><br>  Maintenant, de nombreuses t√¢ches dans le domaine de la vision par ordinateur sont r√©solues √† l'aide de r√©seaux de neurones convolutifs (Convolutional Neural Networks), ci-apr√®s CNN.  En raison de leur structure, ils extraient bien les caract√©ristiques de l'image.  Les CNN sont utilis√©s dans la classification, la reconnaissance, la segmentation et bien d'autres. <br><br>  Architectures CNN populaires pour la reconnaissance d'objets: <br><br><ul><li>  <b>R-CNN.</b>  On peut dire le premier mod√®le √† r√©soudre ce probl√®me.  Fonctionne comme un classificateur d'image ordinaire.  Diff√©rentes r√©gions de l'image sont transmises √† l'entr√©e du r√©seau et des pr√©dictions sont faites pour elles.  Tr√®s lent car il ex√©cute une seule image plusieurs milliers de fois. </li><li>  <b>R-CNN rapide.</b>  Une version am√©lior√©e et plus rapide de R-CNN fonctionne sur un principe similaire, mais d'abord l'image enti√®re est envoy√©e √† l'entr√©e CNN, puis les r√©gions sont g√©n√©r√©es √† partir de la repr√©sentation interne re√ßue.  Mais toujours assez lent pour les t√¢ches en temps r√©el. </li><li>  <b>R-CNN plus rapide.</b>  La principale diff√©rence avec les pr√©c√©dents est qu'au lieu de l'algorithme de recherche s√©lective, il utilise un r√©seau de neurones pour s√©lectionner des r√©gions pour les ¬´m√©moriser¬ª. </li><li>  <b>YOLO.</b>  Un principe de fonctionnement compl√®tement diff√©rent des pr√©c√©dents n'utilise pas du tout les r√©gions.  Le plus rapide.  Plus de d√©tails √† ce sujet seront discut√©s dans l'article. </li><li>  <b>SSD</b>  Il est similaire en principe √† YOLO, mais utilise VGG16 comme r√©seau pour extraire des fonctionnalit√©s.  Aussi assez rapide et adapt√© au travail en temps r√©el. </li><li>  <b>R√©seaux de pyramides (FPN).</b>  Un autre type de r√©seau tel que Single Shot Detector, en raison des fonctionnalit√©s d'extraction des fonctionnalit√©s, est meilleur que le SSD reconna√Æt les petits objets. </li><li>  <b>RetinaNet.</b>  Il utilise une combinaison de FPN + ResNet et, gr√¢ce √† une fonction d'erreur sp√©ciale (perte focale), donne une pr√©cision plus √©lev√©e. </li></ul><br>  Dans cet article, nous utiliserons l'architecture YOLO, √† savoir sa derni√®re modification, YOLOv3. <br><br><h2>  Pourquoi YOLO? </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i4/fy/lq/i4fylqlbpgsp-mu3w6k96zd5e1u.jpeg"></div><br><br>  YOLO ou You Only Look Once est l'architecture tr√®s populaire de CNN, qui est utilis√©e pour reconna√Ætre plusieurs objets dans une image.  Des informations plus compl√®tes √† ce sujet peuvent √™tre obtenues sur le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> , au m√™me endroit, vous pouvez trouver des publications dans lesquelles la th√©orie et la composante math√©matique de ce r√©seau sont d√©crites en d√©tail, ainsi que le processus de sa formation. <br><br>  La principale caract√©ristique de cette architecture par rapport aux autres est que la plupart des syst√®mes appliquent CNN plusieurs fois √† diff√©rentes r√©gions de l'image; dans YOLO, CNN est appliqu√© une fois √† l'image enti√®re √† la fois.  Le r√©seau divise l'image en une sorte de grille et pr√©dit des bo√Ætes englobantes et la probabilit√© qu'il y ait un objet souhait√© pour chaque section. <br><br>  Les avantages de cette approche sont que le r√©seau regarde la totalit√© de l'image √† la fois et prend en compte le contexte lors de la d√©tection et de la reconnaissance d'un objet.  YOLO est √©galement 1000 fois plus rapide que R-CNN et environ 100 fois plus rapide que Fast R-CNN.  Dans cet article, nous allons lancer un r√©seau sur un appareil mobile pour le traitement en ligne, c'est donc la qualit√© la plus importante pour nous. <br><br>  Des informations plus d√©taill√©es sur la comparaison des architectures peuvent √™tre trouv√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br><h4>  YOLOv3 </h4><br>  YOLOv3 est une version avanc√©e de l'architecture YOLO.  Il se compose de 106 couches convolutives et d√©tecte mieux les petits objets par rapport √† son pr√©d√©cesseur YOLOv2.  La principale caract√©ristique de YOLOv3 est qu'il y a trois couches √† la sortie, chacune √©tant con√ßue pour d√©tecter des objets de diff√©rentes tailles. <br>  L'image ci-dessous montre sa structure sch√©matique: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cl/rf/_j/clrf_jqzkt1qfszivfchhxkujv4.png"></div><br><br>  <b>YOLOv3-tiny</b> - Une version recadr√©e de l'architecture YOLOv3, se compose de moins de couches (il n'y a que 2 couches de sortie).  Il pr√©dit des objets plus petits et est destin√© aux petits ensembles de donn√©es.  Mais, en raison de la structure tronqu√©e, les poids du r√©seau occupent une petite quantit√© de m√©moire (~ 35 Mo) et produisent un FPS plus √©lev√©.  Par cons√©quent, une telle architecture est pr√©f√©rable pour une utilisation sur un appareil mobile. <br><br><h2>  Nous √©crivons un programme de reconnaissance d'objets </h2><br>  La partie amusante commence! <br><br>  Cr√©ons une application qui reconna√Ætra divers objets dans l'image en temps r√©el √† l'aide de l'appareil photo du t√©l√©phone.  Tout le code sera √©crit dans le langage de programmation Swift 4.2 et ex√©cut√© sur un appareil iOS. <br><br>  Dans ce tutoriel, nous prendrons un r√©seau pr√™t √† l'emploi avec des √©chelles pr√©-form√©es sur un jeu de donn√©es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">COCO</a> .  Il pr√©sente 80 classes diff√©rentes.  Par cons√©quent, notre neurone sera capable de reconna√Ætre 80 objets diff√©rents. <br><br><h4>  De Darknet √† CoreML </h4><br>  L'architecture YOLOv3 d'origine est impl√©ment√©e √† l'aide du framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Darknet</a> . <br><br>  Sur iOS, √† partir de la version 11.0, il existe une merveilleuse biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CoreML</a> qui vous permet d'ex√©cuter des mod√®les d'apprentissage automatique directement sur l'appareil.  Mais il y a une limitation: le <b>programme ne peut √™tre ex√©cut√© que sur un appareil ex√©cutant iOS 11 et sup√©rieur.</b> <br><br>  Le probl√®me est que CoreML ne comprend que le format sp√©cifique du mod√®le <i>.coreml</i> .  Pour les biblioth√®ques les plus populaires, telles que Tensorflow, Keras ou XGBoost, il est possible de convertir directement au format CoreML.  Mais pour Darknet, une telle possibilit√© n'existe pas.  Afin de convertir le mod√®le enregistr√© et form√© de Darknet en CoreML, vous pouvez utiliser diverses options, par exemple, enregistrer Darknet en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ONNX</a> , puis le convertir d'ONNX en CoreML. <br><br>  Nous utiliserons une mani√®re plus simple et nous utiliserons l'impl√©mentation Keras de YOLOv3.  L'algorithme d'action est le suivant: chargez les poids Darknet dans le mod√®le Keras, enregistrez-le au format Keras et convertissez-le directement en CoreML √† partir de cela. <br><br><ol><li>  <b>T√©l√©chargez Darknet.</b>  T√©l√©chargez ici les fichiers du mod√®le Darknet-YOLOv3 form√©.  Dans cet article, j'utiliserai deux architectures: YOLOv3-416 et YOLOv3-tiny.  Nous aurons besoin des fichiers cfg et des poids. </li><li>  <b>De Darknet √† Keras.</b>  Tout d'abord, clonez le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel</a> , acc√©dez au dossier repo et ex√©cutez la commande: <br><br><pre><code class="bash hljs">python convert.py yolov3.cfg yolov3.weights yolo.h5</code> </pre> <br>  o√π yolov3.cfg et yolov3.weights ont t√©l√©charg√© des fichiers Darknet.  Par cons√©quent, nous devrions avoir un fichier avec l'extension <i>.h5</i> - il s'agit du mod√®le YOLOv3 enregistr√© au format Keras. </li><li>  <b>De Keras √† CoreML.</b>  La derni√®re √©tape est rest√©e.  Afin de convertir le mod√®le en CoreML, vous devez ex√©cuter le script python (vous devez d'abord installer la biblioth√®que coremltools pour python): <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> coremltools coreml_model = coremltools.converters.keras.convert( <span class="hljs-string"><span class="hljs-string">'yolo.h5'</span></span>, input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, image_input_names=<span class="hljs-string"><span class="hljs-string">'image'</span></span>, input_name_shape_dict={<span class="hljs-string"><span class="hljs-string">'image'</span></span>: [<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">416</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]}, <span class="hljs-comment"><span class="hljs-comment">#      image_scale=1/255.) coreml_model.input_description['image'] = 'Input image' coreml_model.save('yolo.mlmodel')</span></span></code> </pre> </li></ol><br>  Les √©tapes d√©crites ci-dessus doivent √™tre effectu√©es pour les deux mod√®les YOLOv3-416 et YOLOv3-tiny. <br>  Lorsque nous avons fait tout cela, nous avons deux fichiers: yolo.mlmodel et yolo-tiny.mlmodel.  Vous pouvez maintenant commencer √† √©crire le code de l'application elle-m√™me. <br><br><h4>  Cr√©ation d'une application iOS </h4><br>  Je ne d√©crirai pas tout le code de l'application, vous pouvez le voir dans le r√©f√©rentiel, dont un lien sera donn√© √† la fin de l'article.  Permettez-moi de dire que nous avons trois UIViewController-a: OnlineViewController, PhotoViewController et SettingsViewController.  Le premier est la sortie de la cam√©ra et la d√©tection en ligne d'objets pour chaque image.  Dans le second, vous pouvez prendre une photo ou s√©lectionner une photo dans la galerie et tester le r√©seau sur ces images.  Le troisi√®me contient les param√®tres, vous pouvez choisir le mod√®le YOLOv3-416 ou YOLOv3-minuscule, ainsi que les seuils IoU (intersection sur l'union) et la confiance de l'objet (la probabilit√© qu'il y ait un objet dans la section d'image actuelle). <br><br>  <b>Chargement de mod√®les dans CoreML</b> <br><br>  Apr√®s avoir converti le mod√®le form√© du format Darknet en CoreML, nous avons un fichier avec l'extension <i>.mlmodel</i> .  Dans mon cas, j'ai cr√©√© deux fichiers: <i>yolo.mlmodel</i> et <i>yolo-tiny.mlmodel</i> , pour les mod√®les YOLOv3-416 et YOLOv3-tiny, respectivement.  Vous pouvez maintenant charger ces fichiers dans un projet dans Xcode. <br><br>  Nous cr√©ons la classe ModelProvider; elle stockera le mod√®le et les m√©thodes actuels pour invoquer de mani√®re asynchrone le r√©seau neuronal pour ex√©cution.  Le mod√®le est charg√© de cette mani√®re: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(type: YOLOType)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">YOLO</span></span>(type: type) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assertionFailure</span></span>(<span class="hljs-string"><span class="hljs-string">"error creating model"</span></span>) } }</code> </pre><br>  La classe YOLO est directement responsable du chargement des fichiers <i>.mlmodel</i> et de la gestion des sorties de mod√®le.  T√©l√©chargez les fichiers mod√®les: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url: <span class="hljs-type"><span class="hljs-type">URL?</span></span> = <span class="hljs-literal"><span class="hljs-literal">nil</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.type = type <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> type { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_Tiny: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo-tiny"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = tiny_anchors <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> .v3_416: url = <span class="hljs-type"><span class="hljs-type">Bundle</span></span>.main.url(forResource: <span class="hljs-string"><span class="hljs-string">"yolo"</span></span>, withExtension:<span class="hljs-string"><span class="hljs-string">"mlmodelc"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors = anchors_416 } <span class="hljs-keyword"><span class="hljs-keyword">guard</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> modelURL = url <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelFileNotFound } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { model = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-type"><span class="hljs-type">MLModel</span></span>(contentsOf: modelURL) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> error { <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.modelCreationError }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">Code complet du fournisseur de mod√®le.</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CoreML protocol ModelProviderDelegate: class { func show(predictions: [YOLO.Prediction]?, stat: ModelProvider.Statistics, error: YOLOError?) } @available(macOS 10.13, iOS 11.0, tvOS 11.0, watchOS 4.0, *) class ModelProvider { struct Statistics { var timeForFrame: Float var fps: Float } static let shared = ModelProvider(modelType: Settings.shared.modelType) var model: YOLO! weak var delegate: ModelProviderDelegate? var predicted = 0 var timeOfFirstFrameInSecond = CACurrentMediaTime() init(modelType type: YOLOType) { loadModel(type: type) } func reloadModel(type: YOLOType) { loadModel(type: type) } private func loadModel(type: YOLOType) { do { self.model = try YOLO(type: type) } catch { assertionFailure("error creating model") } } func predict(frame: UIImage) { DispatchQueue.global().async { do { let startTime = CACurrentMediaTime() let predictions = try self.model.predict(frame: frame) let elapsed = CACurrentMediaTime() - startTime self.showResultOnMain(predictions: predictions, elapsed: Float(elapsed), error: nil) } catch let error as YOLOError { self.showResultOnMain(predictions: nil, elapsed: -1, error: error) } catch { self.showResultOnMain(predictions: nil, elapsed: -1, error: YOLOError.unknownError) } } } private func showResultOnMain(predictions: [YOLO.Prediction]?, elapsed: Float, error: YOLOError?) { if let delegate = self.delegate { DispatchQueue.main.async { let fps = self.measureFPS() delegate.show(predictions: predictions, stat: ModelProvider.Statistics(timeForFrame: elapsed, fps: fps), error: error) } } } private func measureFPS() -&gt; Float { predicted += 1 let elapsed = CACurrentMediaTime() - timeOfFirstFrameInSecond let currentFPSDelivered = Double(predicted) / elapsed if elapsed &gt; 1 { predicted = 0 timeOfFirstFrameInSecond = CACurrentMediaTime() } return Float(currentFPSDelivered) } }</code> </pre><br></div></div><br>  <b>Traitement de sortie de r√©seau neuronal</b> <br><br>  Voyons maintenant comment traiter les sorties du r√©seau neuronal et obtenir les bo√Ætes de d√©limitation correspondantes.  Dans Xcode, si vous s√©lectionnez un fichier de mod√®le, vous pouvez voir ce qu'il est et voir les couches de sortie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m_/3b/vz/m_3bvzkroynfyfkpv1fal-ydf_k.png"></div><br>  <i>Entr√©e et sortie YOLOv3-tiny.</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0l/nl/hy/0lnlhydblax7trhpzdte8bojc0y.png"></div><br>  <i>Entr√©e et sortie YOLOv3-416.</i> <br><br>  Comme vous pouvez le voir dans l'image ci-dessus, nous en avons trois pour YOLOv3-416 et deux pour les couches de sortie minuscules YOLOv3 dans chacune desquelles des bo√Ætes englobantes pour divers objets sont pr√©vues. <br>  Dans ce cas, il s'agit d'un tableau r√©gulier de nombres, voyons comment l'analyser. <br><br>  Le mod√®le YOLOv3 utilise trois couches en sortie pour diviser l'image en une grille diff√©rente, les tailles de cellule de ces grilles ont les valeurs suivantes: 8, 16 et 32. Supposons que nous ayons une image de 416x416 pixels en entr√©e, alors les matrices de sortie (grilles) auront une taille de 52x52 , 26x26 et 13x13 (416/8 = 52, 416/16 = 26 et 416/32 = 13).  Dans le cas de YOLOv3-tiny, tout est pareil, mais au lieu de trois grilles, nous en avons deux: 16 et 32, c'est-√†-dire des matrices de dimensions 26x26 et 13x13. <br><br>  Apr√®s avoir d√©marr√© le mod√®le CoreML charg√©, nous obtenons deux (ou trois) objets de la classe MLMultiArray sur la sortie.  Et si vous regardez la propri√©t√© de forme de ces objets, nous verrons l'image suivante (pour YOLOv3-tiny): <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="6.033ex" viewBox="0 -832 33095.6 2597.7" role="img" focusable="false" style="vertical-align: -4.101ex; max-width: 638px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(13126,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-36" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-5D" x="6563" y="0"></use></g><g transform="translate(13126,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-5B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31" x="278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31" x="1224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="1724" y="0"></use><g transform="translate(2169,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-35" x="1001" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="3671" y="0"></use><g transform="translate(4116,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="5117" y="0"></use><g transform="translate(5562,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-33" x="500" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-5D" x="6563" y="0"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> [1, 1, 255, 26, 26] \\ [1, 1, 255, 13, 13] </script></p><br>  Comme pr√©vu, la dimension des matrices sera 26x26 et 13x13. Mais que signifiera le nombre 255?  Comme mentionn√© pr√©c√©demment, les couches de sortie sont des matrices 52x52, 26x26 et 13x13.  Le fait est que chaque √©l√©ment de cette matrice n'est pas un nombre, c'est un vecteur.  Autrement dit, la couche de sortie est une matrice tridimensionnelle.  Ce vecteur a la dimension B x (5 + C), o√π B est le nombre de bo√Ætes englobantes dans la cellule, C est le nombre de classes.  D'o√π vient le chiffre 5?  La raison en est la suivante: pour chaque case-a, la probabilit√© est pr√©dite qu'il existe un objet (confiance d'objet) - c'est un nombre, et les quatre autres sont x, y, largeur et hauteur pour la case-a pr√©dite.  La figure ci-dessous montre une repr√©sentation sch√©matique de ce vecteur: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3d/j3/rl/3dj3rlk_te-4x-pthae9mreq7k0.png"></div><br>  <i>Repr√©sentation sch√©matique de la couche de sortie (carte d'entit√©s).</i> <br><br>  Pour notre r√©seau form√© dans 80 classes, 3 box-a sont pr√©dits pour chaque cellule de la grille de partition, pour chacune d'entre elles - 80 probabilit√©s de classe + confiance d'objet + 4 nombres responsables de la position et de la taille de cette box-a.  Total: 3 x (5 + 80) = 255. <br><br>  Pour obtenir ces valeurs de la classe MLMultiArray, il est pr√©f√©rable d'utiliser un pointeur brut vers un tableau de donn√©es et une arithm√©tique d'adresse: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-comment"><span class="hljs-comment">//    if out.strides.count &lt; 3 { throw YOLOError.strideOutOfBounds } let channelStride = out.strides[out.strides.count-3].intValue let yStride = out.strides[out.strides.count-2].intValue let xStride = out.strides[out.strides.count-1].intValue func offset(ch: Int, x: Int, y: Int) -&gt; Int { //     return ch * channelStride + y * yStride + x * xStride }</span></span></code> </pre><br>  Vous devez maintenant traiter un vecteur de 255 √©l√©ments.  Pour chaque case, vous devez obtenir une distribution de probabilit√© pour 80 classes, vous pouvez le faire en utilisant la fonction softmax. <br><br><div class="spoiler">  <b class="spoiler_title">Qu'est-ce que softmax</b> <div class="spoiler_text">  La fonction convertit un vecteur <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.354ex" height="2.074ex" viewBox="0 -772.3 4027.5 892.8" role="img" focusable="false" style="vertical-align: -0.28ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-62" x="3025" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="3455" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> \ mathbb x </script>  dimension K en un vecteur de la m√™me dimension, o√π chaque coordonn√©e <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.154ex" height="2.349ex" viewBox="0 -772.3 4371.8 1011.3" role="img" focusable="false" style="vertical-align: -0.555ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="1128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="1658" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="2019" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-62" x="2596" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-62" x="3025" y="0"></use><g transform="translate(3455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="809" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb x_i </script>  le vecteur r√©sultant est repr√©sent√© par un nombre r√©el dans l'intervalle [0,1] et la somme des coordonn√©es est 1. <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="41.144ex" height="3.037ex" viewBox="0 -890.8 17714.6 1307.5" role="img" focusable="false" style="vertical-align: -0.968ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="3593" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="4471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="5001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="5362" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-62" x="5939" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-62" x="6368" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="6798" y="0"></use><g transform="translate(7370,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-29" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="550" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="8382" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-66" x="9688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-72" x="10238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="10690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="11219" y="0"></use><g transform="translate(11653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="809" y="-213"></use></g></g><g transform="translate(12868,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="719" y="0"></use><g transform="translate(1292,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-4B" x="1242" y="488"></use><g transform="translate(878,-327)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="521" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-31" x="1300" y="0"></use></g></g><g transform="translate(3543,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6B" x="809" y="-213"></use></g></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> \ sigma (\ mathbb {x}) _ i = \ frac {e ^ {x_i}} {\ sum_ {k = 1} ^ {K} {e ^ {x_k}}} </script></p>  o√π K est la dimension du vecteur. <br></div></div><br>  Fonction Softmax sur Swift: <br><br><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">softmax</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Float])</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> len = vDSP_Length(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> = <span class="hljs-type"><span class="hljs-type">Int32</span></span>(x.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) vvexpf(&amp;x, x, &amp;<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum: <span class="hljs-type"><span class="hljs-type">Float</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> vDSP_sve(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, len) vDSP_vsdiv(x, <span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sum, &amp;x, <span class="hljs-number"><span class="hljs-number">1</span></span>, len) }</code> </pre><br>  Pour obtenir les coordonn√©es et les tailles de la bo√Æte englobante-a, vous devez utiliser les formules: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.867ex" height="13.262ex" viewBox="0 -832 33095.6 5710.1" role="img" focusable="false" style="vertical-align: -11.33ex; max-width: 638px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(10430,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="850" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="2156" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="2626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-67" x="2971" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="3452" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="4330" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-28" x="4860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="5499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="5933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="6509" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="7039" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="7542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="8009" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="8538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="9111" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-29" x="9683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2B" x="10295" y="0"></use><g transform="translate(11296,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="613" y="-213"></use></g></g><g transform="translate(10532,-1433)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-79" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="2081" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="2551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-67" x="2896" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="3377" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="4255" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-28" x="4785" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="5424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="5858" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="6434" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="6964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="7934" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="8463" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-79" x="9036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-29" x="9533" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2B" x="10145" y="0"></use><g transform="translate(11146,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-79" x="613" y="-213"></use></g></g><g transform="translate(13029,-3064)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="994" y="0"></use><g transform="translate(2050,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-77" x="712" y="-213"></use></g><g transform="translate(3160,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="787" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="1363" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="1893" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="2396" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="2863" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="3392" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-77" x="3965" y="0"></use></g></g></g><g transform="translate(13198,-4593)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="854" y="0"></use><g transform="translate(1910,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="712" y="-213"></use></g><g transform="translate(2921,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="0" y="0"></use><g transform="translate(466,412)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="787" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="1363" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="1893" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="2396" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="2863" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="3392" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="3965" y="0"></use></g></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> x = \ sigma (\ chapeau x) + c_x \\ y = \ sigma (\ chapeau y) + c_y \\ w = p_we ^ {\ chapeau w} \\ h = p_he ^ {\ chapeau h} </script></p><br>  o√π <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="44.465ex" height="2.419ex" viewBox="0 -780.1 19144.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="1260" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="1789" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="2293" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="2759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="3289" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="3861" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="4434" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="5129" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="5562" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="6139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="6668" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="7172" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="7638" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="8168" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-79" x="8740" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="9238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="9933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="10366" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="10943" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="11472" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="11976" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="12442" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="12972" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-77" x="13544" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="14261" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="14956" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="15390" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="15966" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="16496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="16999" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="17466" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-75" x="17995" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="18568" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \ chapeau x, \ chapeau y, \ chapeau w, \ chapeau h </script>  - coordonn√©es x, y pr√©vues, largeur et hauteur, respectivement, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="9.999ex" height="2.66ex" viewBox="0 -832 4305 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="3343" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-29" x="3915" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> \ sigma (x) </script>  Est la fonction sigmo√Øde, et <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.05ex" height="1.817ex" viewBox="-38.5 -520.7 2605 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-77" x="712" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2C" x="1110" y="0"></use><g transform="translate(1555,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-68" x="712" y="-213"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-8"> p_w, p_h </script>  - valeurs des ancres (ancres) pour trois bo√Ætes.  Ces valeurs sont d√©termin√©es lors de la formation et sont d√©finies dans le fichier Helpers.swift: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> anchors1: [<span class="hljs-type"><span class="hljs-type">Float</span></span>] = [<span class="hljs-number"><span class="hljs-number">116</span></span>,<span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">156</span></span>,<span class="hljs-number"><span class="hljs-number">198</span></span>, <span class="hljs-number"><span class="hljs-number">373</span></span>,<span class="hljs-number"><span class="hljs-number">326</span></span>] <span class="hljs-comment"><span class="hljs-comment">//     let anchors2: [Float] = [30,61, 62,45, 59,119] //     let anchors3: [Float] = [10,13, 16,30, 33,23] //    </span></span></code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/zf/pv/ngzfpvvch8bhnkdapz6url5ok-w.png"></div><br>  <i>Repr√©sentation sch√©matique du calcul de la position d'une bo√Æte englobante.</i> <br><br><div class="spoiler">  <b class="spoiler_title">Code complet pour le traitement des couches de sortie.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(output out: MLMultiArray, name: String)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>] { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> predictions = [<span class="hljs-type"><span class="hljs-type">Prediction</span></span>]() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> grid = out.shape[out.shape.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> gridSize = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.inputSize / <span class="hljs-type"><span class="hljs-type">Float</span></span>(grid) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> classesCount = labels.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(out.shape) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pointer = <span class="hljs-type"><span class="hljs-type">UnsafeMutablePointer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Double</span></span>&gt;(<span class="hljs-type"><span class="hljs-type">OpaquePointer</span></span>(out.dataPointer)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt; <span class="hljs-number"><span class="hljs-number">3</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">YOLOError</span></span>.strideOutOfBounds } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> channelStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">3</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> yStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">2</span></span>].intValue <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> xStride = out.strides[out.strides.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span>-<span class="hljs-number"><span class="hljs-number">1</span></span>].intValue <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">offset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ch: Int, x: Int, y: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ch * channelStride + y * yStride + x * xStride } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; grid { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> box_i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.boxesPerCell { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boxOffset = box_i * (classesCount + <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbx = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bby = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">1</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbw = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">2</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bbh = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">3</span></span>, x: x, y: y)]) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidence = sigmoid(<span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">4</span></span>, x: x, y: y)])) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidence &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> x_pos = (sigmoid(bbx) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(x)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> y_pos = (sigmoid(bby) + <span class="hljs-type"><span class="hljs-type">Float</span></span>(y)) * gridSize <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> width = exp(bbw) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i] <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> height = exp(bbh) * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.anchors[name]![<span class="hljs-number"><span class="hljs-number">2</span></span> * box_i + <span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ..&lt; <span class="hljs-number"><span class="hljs-number">80</span></span> { classes[<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>] = <span class="hljs-type"><span class="hljs-type">Float</span></span>(pointer[offset(ch: boxOffset + <span class="hljs-number"><span class="hljs-number">5</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, x: x, y: y)]) } softmax(&amp;classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (detectedClass, bestClassScore) = argmax(classes) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> confidenceInClass = bestClassScore * confidence <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> confidenceInClass &lt; confidenceThreshold { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> } predictions.append(<span class="hljs-type"><span class="hljs-type">Prediction</span></span>(classIndex: detectedClass, score: confidenceInClass, rect: <span class="hljs-type"><span class="hljs-type">CGRect</span></span>(x: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(x_pos - width / <span class="hljs-number"><span class="hljs-number">2</span></span>), y: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(y_pos - height / <span class="hljs-number"><span class="hljs-number">2</span></span>), width: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(width), height: <span class="hljs-type"><span class="hljs-type">CGFloat</span></span>(height)))) } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> predictions }</code> </pre><br></div></div><br>  <b>Suppression non max</b> <br><br>  Une fois que vous avez re√ßu les coordonn√©es et les tailles des bo√Ætes englobantes et les probabilit√©s correspondantes pour tous les objets trouv√©s dans l'image, vous pouvez commencer √† les dessiner au-dessus de l'image.  Mais il y a un probl√®me!  Une telle situation peut se produire lorsque plusieurs cases avec des probabilit√©s plut√¥t √©lev√©es sont pr√©dites pour un objet.  Que faire dans ce cas?  Ici, un algorithme assez simple appel√© suppression non maximale vient √† notre aide. <br><br>  L'algorithme est le suivant: <br><br><ol><li>  Nous recherchons une bo√Æte englobante avec la plus forte probabilit√© d'appartenir √† l'objet. </li><li>  Nous parcourons toutes les bo√Ætes englobantes qui appartiennent √©galement √† cet objet. </li><li>  Nous les supprimons si Intersection over Union (IoU) avec la premi√®re bo√Æte englobante est sup√©rieur au seuil sp√©cifi√©. </li></ol><br>  L'IoU est calcul√© √† l'aide d'une formule simple: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="64.978ex" height="2.66ex" viewBox="0 -883.9 27976.6 1145.2" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6F" x="504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-55" x="990" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-3D" x="4047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-66" x="5353" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-72" x="5904" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="6355" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="6885" y="0"></use><g transform="translate(7318,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-5A" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6F" x="723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6E" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="1809" y="0"></use><g transform="translate(2276,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2032" x="741" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="3095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6E" x="3440" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="4041" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="4402" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-72" x="4869" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="5320" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="5790" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="6256" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="6690" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="7051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6F" x="7397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6E" x="7882" y="0"></use></g></g><g transform="translate(17813,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-78" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="1650" y="0"></use><g transform="translate(2012,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-5A" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6F" x="723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6E" x="1209" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-65" x="1809" y="0"></use><g transform="translate(2276,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-64" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMAIN-2032" x="741" y="583"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="3095" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="3624" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-73" x="4094" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6F" x="4563" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-63" x="5049" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="5482" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-61" x="5828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-74" x="6357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-69" x="6719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6F" x="7064" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=https://habr.com/ru/post/460869/&amp;usg=ALkJrhjk0-XTqNi5pJNw8eMiXK0JFVeyiA#MJMATHI-6E" x="7550" y="0"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> \ text {IoU} = \ frac {\ text {Zone d'intersection}} {\ text {Zone d'association}} </script></p><div class="spoiler">  <b class="spoiler_title">Calcul de l'IoU.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IOU</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a: CGRect, b: CGRect)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Float</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaA = a.width * a.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaA &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaB = b.width * b.height <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> areaB &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersection = a.intersection(b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> intersectionArea = intersection.width * intersection.height <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Float</span></span>(intersectionArea / (areaA + areaB - intersectionArea)) }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Suppression non max.</b> <div class="spoiler_text"><pre> <code class="swift hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nonMaxSuppression</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(boxes: </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">inout</span></span></span></span><span class="hljs-function"><span class="hljs-params"> [Prediction], threshold: Float)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> i &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> j &lt; boxes.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> iou = <span class="hljs-type"><span class="hljs-type">YOLO</span></span>.<span class="hljs-type"><span class="hljs-type">IOU</span></span>(a: boxes[i].rect, b: boxes[j].rect) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> iou &gt; threshold { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].score &gt; boxes[j].score { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: j) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> boxes[i].classIndex == boxes[j].classIndex { boxes.remove(at: i) j = i + <span class="hljs-number"><span class="hljs-number">1</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { j += <span class="hljs-number"><span class="hljs-number">1</span></span> } } i += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre><br></div></div><br>  Apr√®s cela, le travail directement avec les r√©sultats de la pr√©diction du r√©seau neuronal peut √™tre consid√©r√© comme termin√©.  Ensuite, vous devez √©crire des fonctions et des classes pour obtenir les images de la cam√©ra, afficher l'image √† l'√©cran et rendre les zones de d√©limitation pr√©vues.  Je ne d√©crirai pas tout ce code dans cet article, mais il peut √™tre consult√© dans le r√©f√©rentiel. <br><br>  Il convient √©galement de mentionner que j'ai ajout√© un peu de lissage des cadres de d√©limitation lors du traitement des images en ligne, dans ce cas, il s'agit de la moyenne habituelle de la position et de la taille du carr√© pr√©dit sur les 30 derni√®res images. <br><br><h4>  Test du programme </h4><br>  Nous testons maintenant l'application. <br><br>  Permettez-moi de vous rappeler √† nouveau: il y a trois ViewControllers dans l'application, un pour le traitement des photos ou des instantan√©s, un pour le traitement des flux vid√©o en ligne et un troisi√®me pour la configuration du r√©seau. <br><br>  Commen√ßons par le troisi√®me.  Vous pouvez y choisir l'un des deux mod√®les YOLOv3-tiny ou YOLOv3-416, choisir le seuil de confiance et le seuil IoU, vous pouvez √©galement activer ou d√©sactiver l'anticr√©nelage en ligne. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/zq/tz/sbzqtzy6hai51objkormfzvtbuq.jpeg"></div><br>  Voyons maintenant comment le neurone entra√Æn√© fonctionne avec des images r√©elles, pour cela nous prenons une photo de la galerie et la passons √† travers le r√©seau.  L'image ci-dessous montre les r√©sultats de YOLOv3-tiny avec diff√©rents param√®tres. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nr/j3/fj/nrj3fjpw0yvxgl2cigujbcb-1p4.png"></div><br>  <i>Diff√©rents modes de fonctionnement de YOLOv3-tiny.</i>  <i>L'image de gauche montre le mode de fonctionnement habituel.</i>  <i>Au milieu - le seuil IoU = 1 i.e.</i>  <i>comme si la suppression Non-max √©tait manquante.</i>  <i>√Ä droite se trouve un seuil bas de confiance des objets, c'est-√†-dire</i>  <i>toutes les zones de d√©limitation possibles sont affich√©es.</i> <br><br>  Ce qui suit est le r√©sultat de YOLOv3-416.  Vous remarquerez peut-√™tre que, par rapport √† YOLOv3-tiny, les cadres r√©sultants sont plus corrects, ainsi que les objets plus petits de l'image sont reconnus, ce qui correspond au travail du troisi√®me calque de sortie. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wc/nj/xq/wcnjxqeygnuriffqpatmtvevyfo.png"></div><br>  <i>Image trait√©e √† l'aide de YOLOv3-416.</i> <br><br>  Lorsque le mode de fonctionnement en ligne a √©t√© activ√©, chaque trame a √©t√© trait√©e et une pr√©diction a √©t√© faite pour elle, des <b>tests ont √©t√© effectu√©s sur l'iPhone XS,</b> donc le r√©sultat √©tait tout √† fait acceptable pour les deux options de r√©seau.  <b>YOLOv3-tiny produit en moyenne 30 √† 32 ips, YOLOv3-416 - de 23 √† 25 ips.</b>  L'appareil sur lequel il a √©t√© test√© est assez productif, donc sur les mod√®les pr√©c√©dents les r√©sultats peuvent diff√©rer, auquel cas il est bien s√ªr pr√©f√©rable d'utiliser YOLOv3-tiny.  Un autre point important: yolo-tiny.mlmodel (YOLOv3-tiny) prend environ 35 Mo, tandis que yolo.mlmodel (YOLOv3 -16) p√®se environ 250 Mo, ce qui est une diff√©rence tr√®s importante. <br><br><h2>  Conclusion </h2><br>  En cons√©quence, une application iOS a √©t√© √©crite qui, √† l'aide d'un r√©seau de neurones, peut reconna√Ætre des objets dans l'image.  Nous avons vu comment travailler avec la biblioth√®que CoreML et comment l'utiliser pour ex√©cuter divers mod√®les pr√©-form√©s (√† propos, vous pouvez √©galement vous entra√Æner avec).  Le probl√®me de reconnaissance d'objets a √©t√© r√©solu en utilisant le r√©seau YOLOv3.  Sur iPhone XS, ce r√©seau (YOLOv3-tiny) est capable de traiter des images √† une fr√©quence de ~ 30 images par seconde, ce qui est largement suffisant pour un fonctionnement en temps r√©el. <br><br>  Le code d'application complet peut √™tre consult√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460869/">https://habr.com/ru/post/fr460869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460859/index.html">Conf√©rence IThink # 3 √† Kharkov - bas√©e sur la WWDC 2019</a></li>
<li><a href="../fr460861/index.html">Port√©e lexicale JavaScript et fermeture</a></li>
<li><a href="../fr460863/index.html">D√©tails du crash de Cloudflare 2 juillet 2019</a></li>
<li><a href="../fr460865/index.html">Les gens sur la lune. Les sources</a></li>
<li><a href="../fr460867/index.html">Sourcery pour convertir automatiquement en structures d'objets Realm</a></li>
<li><a href="../fr460873/index.html">Pourquoi Turok: Dinosaur Hunter pour N64 a des ann√©es d'avance sur son temps</a></li>
<li><a href="../fr460875/index.html">Comment nous, chez QIWI, sommes arriv√©s √† un style commun d'interaction entre View et ViewModel au sein de MVVM</a></li>
<li><a href="../fr460877/index.html">Kubernetes-adventure Dailymotion: construction d'infrastructures dans les nuages ‚Äã‚Äã+ sur site</a></li>
<li><a href="../fr460879/index.html">DUMP Kazan 2019 - Conf√©rence des d√©veloppeurs du Tatarstan. Nous acceptons les demandes de rapports</a></li>
<li><a href="../fr460881/index.html">Difficult√©s d'application des technologies OCR dans les syst√®mes DLP, ou comment nous pr√©parons l'OCR</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>