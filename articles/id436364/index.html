<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧛 👩🏾‍🤝‍👨🏼 💰 Liveprof akan menunjukkan kapan dan mengapa kinerja aplikasi PHP Anda telah berubah 💆🏿 👇 🕵🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Halo, Habr! Nama saya Timur Shagiakhmetov, saya adalah pengembang PHP di Badoo . 

 Kinerja aplikasi adalah salah satu kriteria paling penting untuk k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Liveprof akan menunjukkan kapan dan mengapa kinerja aplikasi PHP Anda telah berubah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/436364/"><img src="https://habrastorage.org/webt/sm/5p/or/sm5porzvybv5m_8ngvmgicgmeui.jpeg"><br><br>  Halo, Habr!  Nama saya Timur Shagiakhmetov, saya adalah pengembang PHP di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Badoo</a> . <br><br>  Kinerja aplikasi adalah salah satu kriteria paling penting untuk kualitas pekerjaan seorang programmer.  Dalam hal mengoptimalkan aplikasi PHP, asisten adalah profiler. <br><br>  Baru-baru ini, kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berbicara</a> tentang alat apa yang kami gunakan untuk membuat profil.  Izinkan saya mengingatkan Anda: salah satu alat untuk analisis kinerja, ketika tidak jelas bagian kode mana yang memengaruhi peningkatan waktu pembuatan respons, adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">XHProf</a> .  Ini adalah ekstensi untuk PHP yang memungkinkan Anda membuat kode profil di server tempur dan kemudian memperbaikinya. <br><br>  Tetapi saya juga ingin memiliki riwayat perubahan kinerja sehingga Anda dapat melacak apa dan kapan terpengaruh kemundurannya, bukan?  Untuk melakukan ini, sekitar setahun yang lalu, kami mengembangkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Liveprof</a> , sebuah alat untuk secara otomatis membuat profil semua permintaan dengan antarmuka untuk menganalisis perubahan dalam kinerja aplikasi. <br><br>  Alat kami memungkinkan Anda untuk menganalisis perubahan kinerja bagian mana pun dari kode, menemukan tempat di mana ia paling banyak mengalami penurunan.  Pada saat yang sama, ia tidak perlu dihidupkan secara khusus dan menunggu statistik terakumulasi - selalu aktif dan mengumpulkan data untuk sebagian kecil dari semua permintaan. <br><br>  Pada artikel ini saya akan berbicara tentang detail implementasi dan fitur menggunakan alat ini. <br><a name="habracut"></a><br><h2>  Sedikit tentang XHProf </h2><br>  Pertama, beberapa kata tentang fitur XHProf itu sendiri.  Ini adalah profiler untuk PHP yang ditulis dalam C sebagai ekstensi.  Ini dikembangkan di Facebook dan diterbitkan dalam domain publik.  Ini memiliki beberapa fork ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">uprofiler</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tideways</a> ), sepenuhnya kompatibel di tingkat format data output. <br><br>  XHProf mengatur penghitung waktu di sekitar semua panggilan fungsi / metode.  Penggunaannya melibatkan beberapa overhead.  Tetapi mereka tidak begitu besar dan memungkinkan menggunakannya dalam produksi. <br><br>  Hasil XHProf adalah array elemen dalam format berikut: <br><br><pre><code class="php hljs">$data = [ <span class="hljs-string"><span class="hljs-string">'parentMethodName==&gt;childMethodName'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'ct'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">'wt'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-string"><span class="hljs-string">'cpu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-string"><span class="hljs-string">'mu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">528</span></span> <span class="hljs-string"><span class="hljs-string">'pmu'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ] ];</code> </pre> <br>  dimana <br><br>  <code><b>parentMethodName</b></code> dan <code><b>childMethodName</b></code> adalah metode induk dan anak, masing-masing; <br>  <code><b>ct</b></code> - jumlah panggilan dalam konteks permintaan; <br>  <code><b>wt</b></code> - meminta waktu eksekusi (terdiri dari waktu yang dihabiskan oleh prosesor dan waktu untuk menunggu I / O atau respons dari layanan lain); <br>  <code><b>cpu</b></code> - waktu yang dihabiskan oleh prosesor untuk memproses permintaan; <br>  <code><b>mu</b></code> - perubahan konsumsi memori setelah pemanggilan metode; <br>  <code><b>pmu</b></code> - perubahan konsumsi memori puncak setelah pemanggilan metode. <br><br>  Beberapa opsi lain juga dimungkinkan. <br><br>  XHProf juga berisi alat untuk memvisualisasikan hasil yang diperoleh.  Untuk setiap operasi pembuatan profil, kami mendapatkan tabel dengan serangkaian parameter untuk setiap metode. <br><br>  Sebagai contoh <br><br><div class="spoiler">  <b class="spoiler_title">hasil semacam gelembung</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $count)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $array = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $count; $i++) { $array[] = rand(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $array; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BubbleSorter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len ; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $len - $i - <span class="hljs-number"><span class="hljs-number">1</span></span>; $j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$j] &gt; $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;swap($array[$j], $array[$j + <span class="hljs-number"><span class="hljs-number">1</span></span>]); } } } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">swap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$a, &amp;$b)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $tmp = $a; $a = $b; $b = $tmp; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSorted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ $len = count($array); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $len - <span class="hljs-number"><span class="hljs-number">1</span></span>; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($array[$i] &gt; $array[$i + <span class="hljs-number"><span class="hljs-number">1</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArrayPrinter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $array, string $delimiter = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">' '</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> implode($delimiter, $array) . PHP_EOL; } } xhprof_enable(); $n = <span class="hljs-number"><span class="hljs-number">10</span></span>; $arrayGenerator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayGenerator(); $array = $arrayGenerator-&gt;getRandomArray($n); $sorter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BubbleSorter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$sorter-&gt;isSorted($array)) { $sorter-&gt;sort($array); } $printer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ArrayPrinter(); $printer-&gt;print($array); $xhprof_data = xhprof_disable();</code> </pre><br></div></div><br><img src="https://habrastorage.org/webt/ip/cw/vi/ipcwviocimg7kjon1memwwziho8.png"><br><br>  Anda dapat masuk ke dalam setiap metode untuk mengetahui metode mana yang telah menggunakan berapa banyak sumber daya. <br><br>  Anda juga dapat melihat grafik panggilan dengan menyoroti metode paling intensif sumber daya: <br><br><img src="https://habrastorage.org/webt/zq/yw/pl/zqywplc0eibbdxdotsr3f0bed_o.png"><br><br>  XHProf berguna untuk menganalisis kinerja setiap permintaan secara manual.  Tetapi penting juga bagi kita untuk melihat gambaran besarnya.  Anda perlu memahami bagaimana kinerja berubah dari waktu ke waktu.  Untuk melakukan ini, alat dikembangkan yang profilnya meminta dalam mode otomatis dan memungkinkan Anda untuk menganalisisnya di antarmuka web. <br><br><h2>  Liveprof: hasil agregat dan menyimpan sejarah </h2><br>  Bagaimana cara mendapatkan riwayat profil? <br><br>  Pertama, Anda perlu mengkonfigurasi peluncuran otomatis profiler dan menyimpan hasilnya.  Kinerja tidak konstan, dan berfluktuasi dari peluncuran ke peluncuran.  Untuk menghindari pengaruh fluktuasi seperti itu, kami menggunakan data rata-rata dari beberapa kueri.  Sebagai hasilnya, kami mendapatkan hasil teragregasi untuk setiap kueri, misalnya, minimum, maksimum, rata-rata dan persentil ke-95.  Ini membantu menemukan hal-hal sulit yang mungkin tidak dipanggil untuk setiap permintaan. <br><br>  Alat kami memiliki kelebihan dan keterbatasan. <br><br><h3>  Apa yang dapat dilakukan agregator: </h3><br><ol><li>  Pembuatan profil otomatis dari setiap permintaan Nth. <br></li><li>  Agregasi harian dari profil yang dikumpulkan. <br></li><li>  Kemampuan untuk melihat grafik perubahan di setiap parameter yang diukur oleh profiler.  Misalnya, wt, cpu, mu, pmu yang dijelaskan di atas. <br></li><li>  Lihat perubahan kinerja metode apa pun untuk interval tertentu. <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grafik api</a> berdasarkan data agregat terbaru. <br></li><li>  Temukan kueri yang memanggil metode tertentu <br></li></ol><br><h3>  Keterbatasan: </h3><br><ol><li>  Karena alat kami adalah agregat, Anda tidak dapat mengetahui kinerja satu kueri (misalnya, yang paling lambat) - kami mendapatkan hasil rata-rata selama hari terakhir.  Tetapi ini cukup untuk mengevaluasi dinamika kinerja keseluruhan.  Jika ada permintaan yang tergelincir dalam kecepatan eksekusi, maka nilai rata-rata, persentil ke-95 dan waktu eksekusi maksimum akan berubah. <br></li><li>  Anda tidak dapat secara ambigu memulihkan tumpukan panggilan penuh, karena XHProf hanya mengembalikan pasangan orangtua-anak yang unik dengan jumlah nilai sumber daya yang dikeluarkan. <br></li><li>  Minta runtime error terkait dengan overhead XHProf.  Perbedaannya tidak begitu besar, tetapi harus diperhitungkan saat mengukur waktu eksekusi permintaan. <br></li></ol><br><h3>  Cara menggunakan profiler </h3><br><ol><li>  Pertama, profiler harus terhubung ke situs atau skrip.  Cara paling nyaman untuk menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">alat ini adalah meluncurkan profiler secara otomatis</a> : <br><br><pre> <code class="plaintext hljs">php composer.phar require badoo/liveprof # Run a script to configure database LIVE_PROFILER_CONNECTION_URL=mysql://db_user:db_password@db_mysql:3306/Profiler?charset=utf8 php vendor/badoo/liveprof/bin/install.php</code> </pre><br>  Ini mendukung versi PHP dimulai dengan 5.4, dan penggunaannya penuh dengan overhead minimal, yang memungkinkan Anda untuk menggunakannya di lingkungan pertempuran.  Alat ini secara otomatis mendeteksi ekstensi profiler yang digunakan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">XHProf</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">uprofiler</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tideways</a> .  Saat memulai, Anda perlu menentukan parameter untuk menghubungkan ke basis data dan pengaturan profil. <br><br>  Contoh penggunaan dalam kode dengan pengaturan default: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>; \Badoo\LiveProfiler\LiveProfiler::getInstance()-&gt;start(); <span class="hljs-comment"><span class="hljs-comment">// Code is here</span></span></code> </pre> <br>  Hasil profil disimpan ke database.  Sekali sehari, proses agregasi dilakukan.  Untuk melakukan ini, pilih semua catatan untuk permintaan spesifik per hari dan hitung fungsi agregat untuk masing-masing parameter.  Fungsi agregasi dapat diperluas atau didefinisikan ulang. <br><br>  Berikut ini sekarang tersedia: <br><br><ul><li>  setidaknya per hari; </li><li>  maksimum per hari; </li><li>  rata-rata harian </li><li>  Persentil ke-95 hari itu. </li></ul><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Klien web</a> agregator digunakan untuk mengonfigurasi agregasi dan melihat hasilnya.  Cara termudah untuk menginstalnya dalam wadah buruh pelabuhan: <br><br><pre> <code class="php hljs">git <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> https:<span class="hljs-comment"><span class="hljs-comment">//github.com/badoo/liveprof-ui.git cd liveprof-ui docker-compose up web</span></span></code> </pre> </li><li>  Sebelum mulai pertama, Anda perlu mengkonfigurasi parameter koneksi database, daftar bidang dan fungsi agregat yang digunakan dalam file konfigurasi src / config / services.yaml.  Kemudian jalankan skrip instalasi: <br><br><pre> <code class="php hljs">docker-compose exec web bash install.sh</code> </pre> </li><li>  Hal ini diperlukan untuk mendaftar secara otomatis menjalankan skrip agregasi dan pembersihan data lama di mahkota: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># script aggregates all profiles for previous day, add it if you don't use a queue for aggregation jobs (parameter aggregator.use_jobs_in_aggregation=false) 0 2 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:aggregate-all-profiles' web # script removes old aggregated data, by default &gt; 200 days 0 1 * * * docker-compose -f %PATH_TO_PROJECT%/docker-compose.yml run --rm --entrypoint '/usr/local/bin/php /app/bin/cli.php cron:remove-old-profiles' web 200</span></span></code> </pre> <br></li><li>  Untuk mengisi dengan data uji, Anda dapat menjalankan skrip: <br><br><pre> <code class="php hljs">docker-compose exec web php /app/bin/cli.php example:a-week-degradation</code> </pre> </li></ol><br><h2>  Deskripsi Antarmuka </h2><br>  Antarmuka web tersedia di: 127.0.0.1:8000. <br><br>  Secara default, halaman dengan daftar kueri gabungan terbuka.  Memudahkan untuk menemukan kueri yang diminati, mengurutkan semua kueri berdasarkan parameter apa pun, dan juga menggabungkan kembali kueri tertentu untuk melihat hasil terbaru: <br><br><img src="https://habrastorage.org/webt/qj/-d/6b/qj-d6bj1095huwhvqmzdwim1g6k.png"><br><br>  Halaman dengan daftar metode dan grafik perubahan kinerja adalah yang paling banyak digunakan saat bekerja dengan alat ini.  Ini memungkinkan Anda untuk pergi melalui tumpukan panggilan, menonton konsumsi setiap parameter, serta grafik perubahan kinerja untuk interval tertentu: <br><br><img src="https://habrastorage.org/webt/-6/ag/u4/-6agu45zuu1qs77tckpkngabjwq.png"><br><br>  <i>Halaman dengan daftar lengkap metode yang dipanggil memungkinkan Anda menemukan metode yang diinginkan dengan cepat dan melihat grafik dengan masuk ke halaman grafik:</i> <br><br><img src="https://habrastorage.org/webt/nj/g-/f_/njg-f_48jsuo8mcmlxuq1ukxj_4.png"><br>  <i>Halaman dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">grafik nyala dari</a> permintaan agregat terakhir memungkinkan Anda untuk mengidentifikasi bagian terberat secara visual.</i> <br><br>  Menggunakan XHProf memberikan beberapa batasan pada keakuratan hasil.  Ini disebabkan oleh fakta bahwa profiler tidak mengembalikan pohon panggilan lengkap, tetapi hanya pasangan orangtua-anak.  Selain itu, jika beberapa metode dipanggil dari berbagai tempat aplikasi, maka sebagai hasilnya kita mendapatkan jumlah waktu yang dihabiskan.  Untuk grafik nyala, Anda harus memiliki pohon panggilan yang lengkap.  Ketika mengembalikan pohon seperti itu, nilai parameter dinormalisasi dengan mempertimbangkan waktu yang dihabiskan oleh orang tua. <br><br><img src="https://habrastorage.org/webt/vp/lp/xr/vplpxry-gjd-lq774gg3ji9cooo.png"><br>  <i>Halaman dengan daftar metode yang menjadi lebih lambat selama interval yang dipilih.</i> <br><br>  Juga, untuk setiap metode, Anda dapat melihat panggilan anak mana yang paling mempengaruhi kinerja.  Misalnya, pada tangkapan layar di bawah ini, Anda dapat melihat bahwa metode <code>ServiceApi::getAvailableServices()</code> mulai berjalan lebih lambat 116 ms.  Alasan untuk ini adalah penambahan panggilan ke <code>ServiceApi::getGifts()</code> (ubah 56 ms) dan peningkatan jumlah panggilan ke metode <code>ServiceApi::getConfigForList()</code> dari 1 menjadi 5 (50 ms lainnya): <br><br> <a href=""><img src="https://habrastorage.org/webt/rv/mc/dd/rvmcddru-ay4x9cb45xsvey_tka.png"></a> <br><br>  Jika sebelumnya tidak diketahui permintaan mana yang kinerjanya paling berubah, maka halaman dengan daftar metode yang menjadi lebih lambat tanpa merujuk ke permintaan tertentu akan membantu: <br><br><img src="https://habrastorage.org/webt/-6/0b/3s/-60b3svwq_rg9z7wbzmzmpriapc.png"><br>  <i>Halaman yang mencari kueri yang memanggil metode tertentu.</i> <br><br>  Ini memungkinkan Anda untuk membandingkan waktu eksekusi dalam permintaan yang berbeda.  Juga berguna dalam menemukan kode yang tidak digunakan: <br><br><img src="https://habrastorage.org/webt/hq/du/lv/hqdulvav1asbj9nczgowuk1mvak.png"><br><br><h3>  Fitur Kustomisasi </h3><br>  Alat ini memiliki banyak peluang untuk penyesuaian: <br><br><ul><li>  Anda dapat menambahkan fungsi agregat Anda sendiri yang menghitung nilai tertentu berdasarkan array nilai parameter yang diteruskan; <br></li><li>  Anda dapat mengubah database untuk menyimpan profil dan hasil agregat (SQLite, MySQL, dan PostgreSQL sekarang didukung, tetapi Anda dapat menggunakan yang lain dari daftar yang tersedia untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Doctrine DBAL</a> ); <br></li><li>  Anda dapat mengganti manajer koneksi basis data dan mengimplementasikan metode Anda untuk mendapatkan data; <br></li><li>  Anda dapat menggunakan antarmuka web sebagai proyek mandiri dan di dalam kerangka kerja apa pun (misalnya, panel kontrol situs).  Contoh: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profileListAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{      &lt;i&gt;<span class="hljs-comment"><span class="hljs-comment">//Some custom logic before&lt;/i&gt;   $this-&gt;checkPermissions();   $App = new \Badoo\LiveProfilerUI\LiveProfilerUI();   $Page = $App-&gt;getPage('profile_method_list_page');   return $Page-&gt;setData($data)-&gt;render(); }</span></span></code> </pre> </li></ul><br><h2>  Kesimpulan </h2><br>  Saya harap alat kami akan bermanfaat bagi pengembang lain.  Ini akan memungkinkan untuk memeriksa perubahan kinerja bagian mana pun dari kode tanpa menggunakan penghitung waktu tambahan.  Ini juga akan memudahkan proses optimasi, karena sekarang Anda dapat melihat apa yang mempengaruhi penurunan kinerja aplikasi dari waktu ke waktu. <br><br>  Ini tersedia di GitHub: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/badoo/liveprof</a> , antarmuka webnya adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/badoo/liveprof-ui</a> . <br><br>  Alat sedang dalam pengembangan aktif dan mungkin mengandung beberapa kesalahan.  Semoga dengan partisipasi masyarakat, ini akan menjadi lebih baik.  Rencana tersebut termasuk menambahkan dukungan untuk profiler lain selain XHProf, serta memperluas daftar database yang didukung. <br><br>  Kirimi kami umpan balik dan pertanyaan tentang penggunaan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Telegram</a> , bug, dan tarik permintaan - langsung ke <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> .  Kami menerima komentar dan saran! <br><br>  Terima kasih khusus kepada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Gregory</a> untuk ide dan implementasi pertama. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id436364/">https://habr.com/ru/post/id436364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id436352/index.html">Intisari berita PostgreSQL. Edisi No14</a></li>
<li><a href="../id436354/index.html">Militer AS mengabaikan masalah keamanan siber</a></li>
<li><a href="../id436356/index.html">[Menarik dari belakang bukit] Bagaimana kita menghentikan ketergantungan teknologi?</a></li>
<li><a href="../id436358/index.html">Mengapa pengembang senior mengajar siswa</a></li>
<li><a href="../id436360/index.html">Gotta Go Fast: Membangun untuk Kecepatan di iOS. Bagian 1</a></li>
<li><a href="../id436370/index.html">Infrastruktur Kunci Publik X509 v.3 Rantai Sertifikat Root</a></li>
<li><a href="../id436372/index.html">Plugin Isometrik untuk Unity3D</a></li>
<li><a href="../id436374/index.html">Tren desain UI dan UX 2019</a></li>
<li><a href="../id436376/index.html">Sekilas tentang robot semua medan EZ-Robot Roli Rover</a></li>
<li><a href="../id436378/index.html">bobaos.pub - KNX TP / UART, Raspberry Pi dan Redis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>