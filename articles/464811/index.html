<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ò¢Ô∏è üë∏üèª üôáüèº Apple Music para el desarrollador üéÖ üöù üóæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Palabras introductorias 


 No importa cu√°nto rega√±en a Apple por la naturaleza cerrada de la plataforma y el ecosistema en s√≠, algunas de sus solucio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apple Music para el desarrollador</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/464811/"><h2 id="vvodnye-slova">  Palabras introductorias </h2><br><p>  No importa cu√°nto rega√±en a Apple por la naturaleza cerrada de la plataforma y el ecosistema en s√≠, algunas de sus soluciones son una excepci√≥n.  Hay muchos servicios de transmisi√≥n en el mercado, pero proporcionar un SDK completo para la transmisi√≥n de productos de terceros es extremadamente peque√±o, para el mercado ruso la lista de SDK disponibles oficialmente se limita a Deezer y Apple Music.  Por supuesto, cuando Spotify llegue a nuestro mercado, habr√° m√°s SDK disponibles, pero hasta ahora hay dos jugadores y solo uno de ellos tiene una amplia base de usuarios. </p><br><p> Dio la casualidad de que ten√≠a experiencia con el SDK de Deezer para Android y en este momento estoy trabajando activamente con el SDK de Apple Music ( <em>MusicKit</em> ) para iOS.  Y la principal diferencia con la experiencia con Deezer es que MusicKit es la punta del iceberg, tambi√©n es una API disponible p√∫blicamente.  A diferencia de Deezer, donde repetir la mayor parte de la funcionalidad de la aplicaci√≥n oficial es solo un proceso largo, es imposible repetir la funcionalidad incluso de las p√°ginas web de Apple Music utilizando solo la API p√∫blica.  Incluso si Apple usa MusicKit en sus soluciones, adem√°s de esto, usa muchas solicitudes de API indocumentadas y API privadas que no est√°n permitidas para los mortales. </p><br><p>  En el art√≠culo hablar√© sobre trabajar con MusicKit desde el punto de vista del desarrollador en el contexto de la implementaci√≥n de " <em>tareas simples</em> ": buscar en el cat√°logo, mostrar im√°genes en los resultados de b√∫squeda, obtener canciones, recomendaciones e incluso reproducir alg√∫n tipo de m√∫sica.  Mirando hacia el futuro, dir√© que gran parte de lo anterior ser√° cierto para trabajar con Apple Music en Android y Javascript. </p><br><p>  Si es necesario, estoy listo para dar respuestas detalladas con un c√≥digo para preguntas en los comentarios. </p><a name="habracut"></a><br><h2 id="otdelim-muh-ot-kotlet">  Separa las moscas de las chuletas </h2><br><p>  Cuando trabaje con MusicKit en iOS, deber√° interactuar con las siguientes entidades: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StoreKit</a> para obtener autorizaci√≥n en Apple Music y ofrecer una suscripci√≥n al servicio ( <em>referencia si puede suscribirse al programa de Afiliados</em> ) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API HTTP</a> para buscar y recuperar diversa informaci√≥n de un directorio </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">iTunes Search API</a> para buscar en el directorio de iTunes (una <em>alternativa muy √∫til a la API HTTP</em> ).  Apple indica un l√≠mite de un m√°ximo de 20 solicitudes por minuto, esto suele ser suficiente cuando se realizan solicitudes desde dispositivos de usuario </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Media Player</a> para jugar y administrar la cola </li></ul><br><p>  Adem√°s, cuando se conecta a un programa de afiliados, puede solicitar acceso al volcado de metadatos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enterprise Partner Feed</a> , que Apple recomienda usar en lugar de solicitudes frecuentes a la API de b√∫squeda de iTunes. </p><br><p>  Y por si acaso, Music.app es la aplicaci√≥n Music en dispositivos iOS, que es el reproductor oficial de Apple Music. </p><br><p>  Fuentes de informaci√≥n, en orden decreciente de su utilidad: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Documentaci√≥n oficial</a> </li><li>  Buscar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">toda la documentaci√≥n de</a> Apple </li><li>  Experimento cient√≠fico M√©todo <sup>1</sup> con API HTTP </li><li>  Consola de desarrollador en su navegador favorito, anclado a la p√°gina web de la entidad de inter√©s en Apple Music </li><li>  Foros de desarrolladores de Apple </li><li>  Stackoverflow </li></ul><br><h2 id="poisk-kartinki">  Buscar  Im√°genes </h2><br><p> La forma m√°s obvia de verificar si se puede hacer algo en su aplicaci√≥n es el hecho de que algo como esto est√° disponible en la aplicaci√≥n oficial.  Aqu√≠ tomamos, por ejemplo, una b√∫squeda.  Estamos buscando el grupo "The Police" y en <code>Music.app</code> tenemos una foto del grupo con un Sting sonriente: </p><br><img alt="b√∫squeda policial" src="https://habrastorage.org/webt/wn/jo/31/wnjo31ts3vxptbekvmhgdmxttqq.png" width="200"><br><p>  Genial, usaremos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la API de b√∫squeda</a> .  En la emisi√≥n, tenemos la clave de <code>artwork</code> con un enlace de <code>url</code> incrustado para todo excepto artistas.  Es extra√±o  Comprueba de nuevo, en Music.app todo est√° ah√≠.  Adem√°s, la interfaz web tambi√©n tiene una fotograf√≠a, y un enlace a la p√°gina web est√° disponible en la API del motor de b√∫squeda json. </p><br><p>  La API de b√∫squeda de iTunes tampoco <code>artistLinkUrl</code> imagen, pero tambi√©n incluye la direcci√≥n de la p√°gina web con la clave <code>artistLinkUrl</code> en la <code>artistLinkUrl</code> . </p><br><p>  Bueno, qu√© hacer, debe descargar la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina web</a> y obtener la direcci√≥n de la imagen, afortunadamente, los desarrolladores se encargaron y registraron la direcci√≥n de la imagen en la metainformaci√≥n: </p><br><pre> <code class="plaintext hljs">&lt;meta property="og:image" content="https://is5-ssl.mzstatic.com/image/thumb/Features113/v4/bb/a2/66/bba266dd-570b-bff7-d7c6-777982582964/mzl.tdrwskof.jpg/1200x630cw.png" id="ember52310559" class="ember-view"&gt;</code> </pre> <br><p>  Hablando formalmente, ya hemos violado las reglas de Apple que proh√≠ben "raspar" sus p√°ginas web.  De hecho, todas las aplicaciones de terceros hacen esto, excepto aquellas que buscan im√°genes que utilizan servicios de terceros. </p><br><p>  Hay una desventaja m√°s: solicitamos una p√°gina de varios cientos de kilobytes de tama√±o.  Para una aplicaci√≥n que ya maneja grandes cantidades de datos ( <em>reproducir m√∫sica</em> ), es tolerable ( <em>especialmente si considera que los datos se transmiten en forma comprimida</em> ), pero en el caso general no es muy. </p><br><p>  Los tama√±os de las im√°genes se pueden ajustar a sus necesidades: en la <code>url</code> hay plantillas para reemplazar ( <code>{w}</code> , <code>{h}</code> ), y en la p√°gina web el enlace a la imagen tiene el mismo formato, por lo que no hay dificultad para obtener la imagen del tama√±o correcto.  Si desea obtener una imagen redondeada, debe agregar <code>cw</code> antes de la extensi√≥n. </p><br><h3 id="bonus-pro-kartinki-dlya-otobrazheniya-v-pleere">  Bono sobre im√°genes para mostrar en el reproductor </h3><br><p>  Durante la reproducci√≥n, el reproductor de <code>Media Player</code> funciona en la construcci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>MPMediaItem</code></a> , que, en particular, proporciona un objeto <code>Artwork</code> .  Es muy conveniente para mostrar una imagen de una pista en el reproductor.  El √∫nico problema es que, en la pr√°ctica, este objeto, sea lo que sea que se diga, no proporciona im√°genes para transmitir m√∫sica ( <em>que es cualquier m√∫sica de Apple Music</em> ), por lo que debe "reproducir" el elemento <code>MPMediaItem</code> reproduce con las canciones que se agregaron a la cola y se descargaron La imagen es similar a los √°lbumes. </p><br><h2 id="poisk-po-zhanram">  B√∫squeda por g√©nero </h2><br><p>  ITunes y la aplicaci√≥n Apple Music tienen listas de g√©neros y canciones principales.  Encontrar un g√©nero no deber√≠a ser dif√≠cil, porque podemos buscar cualquier cosa. </p><br><p>  Esto est√° lejos del caso.  La API no busca por g√©nero y no proporciona una lista de g√©neros.  Es posible solicitar informaci√≥n ( <em>de nombre √∫til</em> ) de un g√©nero por su identificador, <br>  pero la mayor parte de la informaci√≥n en la API contiene solo el nombre del g√©nero, no el identificador. </p><br><p>  El beneficio para iTunes es la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">descarga de todos los g√©neros</a> ( <em>todos ellos, incluidos los "g√©neros" de las aplicaciones m√≥viles</em> ).  Los identificadores de g√©neros ( <em>como otros identificadores de iTunes</em> ) corresponden completamente a los identificadores en Apple Music.  La descarga est√° disponible para todas las regiones (la <em>regi√≥n se indica en la clave <code>cc</code> , no en el <code>storefront</code> como en la API de Apple Music</em> ), pero de hecho solo los nombres difieren ( <em>se traducen</em> ).  La estructura de los g√©neros es jer√°rquica y hay repeticiones de los nombres de los g√©neros. </p><br><p>  En general, una b√∫squeda por g√©nero debe hacerse localmente, y tenga en cuenta que el funk jazz, jazz funk y jazz funk son lo mismo.  No es dif√≠cil, pero no es tan simple como pedirle a la API de b√∫squeda que busque por g√©nero. </p><br><p>  Despu√©s de haber encontrado un g√©nero, puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitar una tabla</a> (una <em>lista de las canciones m√°s populares</em> ) para este g√©nero.  Para g√©neros raros, es muy posible obtener el lanzamiento de solo 3 canciones. </p><br><p>  Dato curioso: para algunos √°lbumes y artistas ( <em>Ed Sheeran de los famosos</em> ), solo uno de los g√©neros simplemente indica el g√©nero de nivel superior de "M√∫sica".  Si desea hacer recomendaciones basadas en g√©neros, entonces este g√©nero debe ignorarse. </p><br><h2 id="pesni-artistov">  Canciones de artista </h2><br><p>  Cuando una aplicaci√≥n necesita reproducir canciones de un artista ( <em>grupo musical</em> ) con mayor frecuencia, esto significa que es necesario reproducir canciones <em>populares</em> de este grupo.  Apple Music permite solicitar canciones como un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace de</a> "canciones" <sup>2</sup> para el artista.  La salida tiene un m√°ximo de 20 canciones <sup>3</sup> , claramente ordenadas por popularidad. </p><br><p>  A veces todav√≠a quieres obtener un poco m√°s de canciones.  Con grupos muy populares, hay una opci√≥n para obtener listas de reproducci√≥n como " <em>[Nombre del artista]:</em> <em>Essentials</em> " y " <em>[Nombre del artista]: Detalles</em> " (" <em>[Nombre del artista]: Pr√≥ximos pasos</em> "), pero En general, esta opci√≥n no es adecuada.  Otra opci√≥n: tomar 20 canciones populares y terminar el resto de los √°lbumes, el beneficio de Apple Music hace posible obtener de inmediato todos los √°lbumes de artistas ( <em>enlaces como <code>albums</code></em> ) y todas las canciones en ellos ( <code>include="tracks"</code> ) en una sola solicitud. </p><br><p>  Pero si obtienes todas las canciones del artista, surge otro problema: debes seleccionar las populares de todas estas canciones.  Desafortunadamente, la API de informaci√≥n de popularidad no proporciona <sup>4</sup> .  Puede tomar canciones aleatorias de toda la lista, pero en la pr√°ctica este enfoque conduce a la reproducci√≥n frecuente de grabaciones completamente interesantes ( <em>transcripciones en vivo, grabaciones de ensayos, parodias, etc.</em> ), lo que es especialmente notable en grupos muy populares <sup>5</sup> . </p><br><p>  Tratemos de obtener canciones populares de una manera diferente.  Incluso antes de la llegada de MusicKit, Apple comenz√≥ a proporcionar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">API de b√∫squeda</a> en iTunes Store.  Como ya se mencion√≥, el cat√°logo en Apple Music e iTunes Store son los mismos <sup>6</sup> y, en consecuencia, los identificadores de las canciones tambi√©n son los mismos.  Esta API devuelve 50 canciones de forma predeterminada, pero puede solicitar hasta 200 canciones.  Los resultados tambi√©n est√°n ordenados por popularidad. </p><br><p>  Curiosamente, la propia Apple no utiliza ninguna de estas opciones en su propia interfaz web.  Utilizan la API <sup>7</sup> no documentada ( <em>lectura, privada</em> ), en la emisi√≥n de la cual falta todo lo que falta, incluido el identificador ( <em>y no solo el nombre</em> ) del g√©nero y el √≠ndice de popularidad.  No me atrev√≠ a usar esta API en la pr√°ctica <sup>8</sup> , ya que los identificadores de g√©nero se pueden obtener mediante la b√∫squeda inversa por nombres de g√©nero <sup>9</sup> , y el √≠ndice de popularidad num√©rico no es tan importante cuando obtienes una lista de canciones ordenadas por popularidad. </p><br><p>  El hecho curioso que llamo el " <em>problema de Hugh Laurie</em> " es que el cat√°logo de Apple Music tiene toneladas de contenido no musical.  En particular, varias compilaciones de programas de comedia y stand-ups.  Esto est√° bien, por un lado ( <em>pagamos por la m√∫sica, pero tambi√©n tuvimos di√°logos divertidos con Stephen Fry que puedes escuchar antes de irte a la cama</em> ), y por otro lado, conduce a alg√∫n tipo de charla cuando se nos pide que enciendas la m√∫sica.  En consecuencia, cuando el contexto operativo de la aplicaci√≥n indica directamente que el usuario quiere escuchar m√∫sica, uno tiene que eliminar independientemente de la lista de " <em>canciones</em> " aquellos cuyos g√©neros se designan como " <em>palabra hablada</em> " y " <em>comedia</em> ". </p><br><h2 id="rekomendacii">  Recomendaciones </h2><br><p>  Reproducir recomendaciones (tambi√©n son " <em>canciones similares</em> ", " <em>estaciones de radio</em> ", " <em>te gustar√°</em> ", etc.) se ha convertido en la funcionalidad b√°sica de los reproductores de transmisi√≥n.  Convencionalmente, las recomendaciones se pueden dividir en dos tipos <sup>10</sup> : para el usuario ( <em>basado en el historial de escucha, compras y me gusta</em> ) y para el objeto musical ( <em>artista, pista, menos frecuentemente √°lbum y lista de reproducci√≥n</em> ). </p><br><p>  Con las preferencias del usuario en Apple Music, formalmente, <sup>11</sup> todo est√° bien: puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitar una lista de</a> recomendaciones personales, que incluye " <em>mezclas personales</em> " ( <em>listas de reproducci√≥n</em> ) y √°lbumes recomendados.  De los √°lbumes, se puede obtener una lista de canciones utilizando las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>API   ( tracks</code> )</a> , para listas de reproducci√≥n de manera similar.  Tenga en cuenta que las pistas pueden incluir no solo canciones ( <code>type = "songs"</code> ), sino tambi√©n videoclips, por lo que el filtrado adicional de los datos recibidos no afectar√°. </p><br><p>  Con otras recomendaciones, todo es un poco m√°s complicado.  Si mira Music.app, se muestran " <em>artistas similares</em> " all√≠ y puede encender la " <em>estaci√≥n de radio</em> " para este artista.  Este √∫ltimo pierde la mezcla del artista y las recomendaciones para √©l. </p><br><img alt="polic√≠a similar" src="https://habrastorage.org/webt/lr/yr/e2/lryre2qusu_88h-xyvna4_gs8kc.png" width="200"><br><p>  Parece que todo es simple: para los artistas probablemente haya una conexi√≥n de " <em>artistas similares</em> ".  Me apresuro a molestar, no hay tal conexi√≥n.  Tampoco hay informaci√≥n de similitud en el esquema de datos de Enterprise Partner Feed. </p><br><p>  Bien, ¬øpodemos solicitar una " <em>estaci√≥n de radio</em> " para el artista y obtener una lista de canciones?  Y de nuevo, no, realmente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">podemos</a> solicitar una estaci√≥n de radio, su identificador est√° en la emisi√≥n de las conexiones del artista.  Pero en la informaci√≥n de la estaci√≥n no hay informaci√≥n sobre las canciones, √°lbumes o artistas que se est√°n reproduciendo, solo hay un objeto de servicio con informaci√≥n para reproducir <code>playParams</code> .  La idea con <code>playParams</code> simple: <code>playParams</code> este diccionario <sup>12</sup> en la cola de reproducci√≥n y escuchamos. </p><br><p>  Todo esto es bueno si desea reproducir solo una estaci√≥n de radio ( <em>como lo hace Music.app</em> ), pero ¬øqu√© <em>sucede</em> si desea mezclar canciones de la estaci√≥n de radio <sup>13</sup> con algo m√°s?  Obviamente, de alguna manera necesitamos obtener una lista de artistas similares. </p><br><p>  En <code>Media Player</code> , las colas de reproducci√≥n juegan un papel importante, en particular <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MPMusicPlayerControllerMutableQueue</a> .  La cola le permite: insertar descriptores despu√©s de cierto objeto jugable, eliminar objetos especificados y tambi√©n obtener una lista de todos los objetos en la cola.  Al consultar los objetos para obtener resultados, debemos obtener una matriz de <code>MPMediaItem</code> .  Y <code>MPMediaItem</code> , en particular, incluye el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">identificador de la canci√≥n</a> .  Solo hay un problema: los constructores de colas no son una API p√∫blica, lo traducir√©: <code>Media Player</code> puede proporcionar una cola lista (a veces <em>editable</em> ), pero es imposible crearla usted mismo <sup>14</sup> . </p><br><p>  Bueno, cavar un poco hacia las muletas puede ser √∫til.  Si <code>Media Player</code> me puede dar una cola variable, entonces necesito tomarla.  Para hacer esto, tendr√° que trabajar con el reproductor actual ( <em>singleton</em> ), por lo que debe actuar r√°pidamente, de lo contrario, el usuario puede perder algo incorrecto y el reproductor a√∫n tendr√° tiempo para precargar las canciones que hasta ahora son innecesarias.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cambiamos la</a> cola de reproducci√≥n actual ( <em>agregamos el descriptor de la estaci√≥n</em> ), miramos lo que sucedi√≥, revertimos los cambios en la cola con una nueva transacci√≥n ( <em>eliminamos lo que realmente se agreg√≥ a la cola</em> ). </p><br><p>  Desafortunadamente, encontramos que solo dos objetos <code>MPMediaItem</code> se <code>MPMediaItem</code> a la cola.  Ambas parecen canciones ( <em>hay el nombre del artista, el nombre de la pista, la duraci√≥n de la pista</em> ), pero no incluyen el identificador de la canci√≥n.  Si miras Music.app, encontramos que todo converge all√≠: al encender la estaci√≥n de radio se reproducir√° la canci√≥n, y en la cola solo habr√° una canci√≥n para reproducir.  Cuando pasa a la siguiente canci√≥n, la cola se actualiza. </p><br><p>  No tiene sentido tratar de construir muletas con m√°s estaciones de radio; tienes que usar otras opciones. </p><br><p>  Recuerde que, en Music.app y la interfaz web, se muestran artistas similares.  Artistas similares solo est√°n disponibles para las bandas m√°s populares <sup>15</sup> .  Nuevamente, debe recurrir al m√©todo prohibido de analizar una p√°gina web.  De los profesionales: ya estamos descargando una p√°gina web para obtener una imagen, de modo que podamos obtener artistas similares de ella de inmediato. </p><br><p>  En el c√≥digo de la p√°gina html, vemos un gran objeto json, del cual primero obtenemos los identificadores de artistas similares ( <code>["data"]["relationships"]["artistContemporaries"]</code> ): </p><br><img alt="datos de la p√°gina web" src="https://habrastorage.org/webt/xg/o-/yx/xgo-yxn-dh73gqcd8zieowzam3y.png" width="200"><br><p>  y luego usando estos identificadores obtenemos los datos del artista del mismo json ( <code>["included"]</code> con el tipo de <code>lockup/artist</code> ): </p><br><img alt="p√°gina web incluida" src="https://habrastorage.org/webt/j8/du/my/j8dumysqer6_oh9wlj_8geroip4.png" width="300"><br><p>  Al tener los identificadores de los artistas, podemos solicitar sus pistas.  La API le permite solicitar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√∫ltiples artistas</a> por sus identificadores en una sola solicitud con enlaces habilitados.  Por desgracia, en la pr√°ctica, la API devuelve un error que indica la imposibilidad de agregar una lista de pistas al resultado.  Esto solo se puede hacer solicitando artistas uno a la vez o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">solicitando directamente canciones</a> para un solo artista.  En este caso, puede usar la API de b√∫squeda de iTunes ya mencionada, que le dar√° un poco m√°s de informaci√≥n √∫til. </p><br><p>  Las listas de " <em>artistas similares</em> " en Apple Music son bastante buenas, pero en la pr√°ctica a menudo resultan estar vac√≠as.  En el caso de una lista vac√≠a de recomendaciones, debe utilizar servicios de terceros.  Cl√°sicos - Last.fm, un poco m√°s sofisticado - Spotify.  Los resultados de ambos deben coincidir con los objetos del cat√°logo de Apple Music.  La soluci√≥n "en la frente" es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buscar a cada artista</a> por nombre con exactamente un resultado y luego recibir las canciones como se describi√≥ anteriormente.  Las soluciones son un poco m√°s interesantes, pero es m√°s costoso usar musicbrainz para combinar.  Musicbrainz proporciona informaci√≥n sobre identificadores <sup>16</sup> en otros servicios, es decir  Puede asociar un identificador en Spotify con un identificador en Apple Music.  La situaci√≥n con Last.fm es a√∫n mejor: Last.fm devuelve identificadores de musicbrainz en la lista de recomendaciones.  La sobrecarga radica en los l√≠mites del uso de musicbrainz, con mucho tr√°fico que tiene que levantar su propio clon de musicbrainz (afortunadamente, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esto es posible</a> ) o desarrollar su propia API alrededor de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una base de datos</a> , cuyos volcados se pueden descargar f√°cilmente. </p><br><p>  Para los grupos nuevos, incluso Last.fm no dar√° recomendaciones, las opciones alternativas ser√°n recomendaciones de "g√©nero".  Tomamos los g√©neros del artista ( <em>en base al nombre obtenemos identificadores de la lista ya cargada de todos los g√©neros</em> ), obtenemos la tabla para cada g√©nero, mezclamos las canciones recibidas.  Esto es mejor que nada. </p><br><h2 id="dve-veschi-nerazluchnye-pleer-i-ochered">  Dos cosas son inseparables: jugador y cola </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Media Player</a> es responsable de reproducir en iOS desde Apple Music; le permite trabajar con m√∫sica de Apple Music y el directorio personal del usuario <sup>17</sup> .  El marco es de alto nivel y en la situaci√≥n de trabajar con contenido de transmisi√≥n para bajar a un nivel inferior a <sup>18</sup> no funcionar√°. </p><br><p>  El marco proporciona dos reproductores con una interfaz de software com√∫n: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">uno</a> reproduce m√∫sica directamente en la aplicaci√≥n Music.app y el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">otro</a> funciona de manera m√°s o menos independiente.  Usar el primero para algo serio no tiene sentido <sup>19</sup> .  Y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n</a> descaradamente miente <sup>20</sup> que el segundo jugador no funciona en segundo plano </p><br><p>  Desde el punto de vista arquitect√≥nico, trabajar con este asunto es simple: le decimos al jugador qu√© reproducir ( <em>por ejemplo, llenar la cola, en funci√≥n de una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">serie de identificadores de canci√≥n</a></em> ) y controlar la reproducci√≥n ( <em>reproducir, pausar, siguiente, anterior</em> ). </p><br><p>  No hay un control directo de la cola de reproducci√≥n, debe realizar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cambio transaccional</a> , lo que lleva tiempo.  Adem√°s, a menudo se llama al controlador HandHandler con un error de tiempo de espera, que se traduce como " <em>No s√© si pude hacer algo o si estoy haciendo otra cosa, pero estoy cansado de esperar por m√≠ mismo</em> ".  La mayor√≠a de las veces, la transacci√≥n va bien y los errores que llegan al controlador deben ignorarse.  Algunos de los cambios se pueden hacer a un nivel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ligeramente superior</a> , sin embargo, si ya tuvo que usar cambios transaccionales, entonces es mejor usarlos para todo. </p><br><p>  En general, las colas son bastante flexibles, y si no es probable que su aplicaci√≥n funcione alguna vez con otros servicios de transmisi√≥n <sup>21</sup> , puede hacer muchas cosas interesantes con las colas, en particular, indicar a qu√© hora comienza a reproducirse cada elemento y durante cu√°nto tiempo. </p><br><p>  De los otros " <em>inconvenientes</em> " de un enfoque de tan alto nivel, vale la pena se√±alar la incapacidad para procesar las acciones del usuario.  Al presionar al usuario en el auricular del bot√≥n " <em>siguiente pista</em> " no se solicitar√° el programa " <em>qu√© debo hacer</em> ", el jugador sabe mejor qu√© hacer y cambiar√° la canci√≥n √©l mismo.  Por lo tanto, solo puede ver los cambios realmente completados en el estado del jugador y tomar algunas decisiones despu√©s del hecho. </p><br><p>  Por otro lado, no tiene que hacer mucho: la informaci√≥n sobre c√≥mo jugar en la pantalla de bloqueo simplemente est√° all√≠ y todos los botones funcionan, Apple Watch y Siri pueden controlar la reproducci√≥n, y la transmisi√≥n a trav√©s de AirPlay a Apple TV funciona desde la caja <sup>22</sup> . </p><br><p>  Es posible repetir la funcionalidad y la interfaz de la cola Music.app en su aplicaci√≥n, pero la aparente simplicidad de los elementos de arrastrar y soltar de la cola en realidad resulta ser un malabarismo de transacciones para cambiar la cola y sincronizar la cola deseada y la cola real de <sup>23</sup> jugadores. </p><br><h2 id="para-slov-pro-sdk-dlya-drugih-platform">  Algunas palabras sobre SDK para otras plataformas </h2><br><p>  De hecho, trabajar con la API no es diferente en otras plataformas, pero los SDK no se copian completamente con iOS y, en algunos lugares, son m√°s convenientes <sup>24</sup> , aunque la idea general de una cola en t√°ndem y un reproductor persiste. </p><br><p>  Por lo tanto, en Android, puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">obtener la cola actual</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mover los elementos de la cola</a> sin trucos con un cambio transaccional de la misma ( <em>eliminar de la cola y agregar al lugar correcto con los dedos cruzados</em> ). </p><br><p>  MusicKit JS tambi√©n proporciona <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√©todos de envoltura especiales</a> para trabajar con la API de Apple Music, <br>  pero al usar envoltorios no se puede prescindir de leer la documentaci√≥n de la API en s√≠.  Trabajar con la cola y el reproductor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no</a> es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s conveniente que el SDK de iOS</a> , pero con peque√±os complementos <a href="">puede ser soportable</a> . </p><br><h2 id="para-slov-o-simulyatore">  Unas palabras sobre el simulador </h2><br><p>  Puede trabajar en el simulador con MusicKit solo en el contexto de la comunicaci√≥n con la API HTTP, pero incluso en este caso tendr√° que estabilizar el token del usuario para realizar solicitudes y no hacerlo a trav√©s de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StoreKit</a> .  Es completamente imposible reproducir m√∫sica de Apple Music en el simulador, porque falta la aplicaci√≥n Music.app. </p><br><p>  De hecho, debe desarrollar sus propios complementos a trav√©s del SDK y, cuando se ejecuta en el simulador, utilizar implementaciones alternativas ( <em>simuladas</em> ).  De hecho, durante el desarrollo, el simulador es √∫til solo para trabajar en la interfaz de usuario.  La abstracci√≥n propia tambi√©n ser√° √∫til en capturas de pantalla autom√°ticas para la aplicaci√≥n ( <em>y de hecho al crear capturas de pantalla usando un simulador</em> ), ya que tener ambas generaciones de iPad Pros "grandes" en el arsenal solo para tomar capturas de pantalla de tu jugador en ambos es extremadamente poco rentable y est√∫pido . </p><br><p>  Como experimento interesante, pero no muy √∫til, puede realizar una implementaci√≥n alternativa de su propio reproductor de alto nivel basado en MusicKit JS. </p><br><h2 id="pro-enterprise-partner-feed">  Acerca del feed de socios empresariales </h2><br><p>  Por un lado, Apple proporciona un volcado de metadatos a pedido y dice que lo use para reducir la carga en la API y obtener informaci√≥n que la API no tiene.  Por otro lado, tenemos un problema claro con las gallinas y los huevos: el acceso al programa de Afiliados se proporciona especificando un enlace a la aplicaci√≥n.  Es bastante dif√≠cil desarrollar una aplicaci√≥n utilizando los datos que solo se pueden obtener con la aplicaci√≥n publicada en la App Store. </p><br><p>  Y, por supuesto, los datos no dan la primera esquina.  Cada aplicaci√≥n se verifica dentro de los cinco d√≠as h√°biles.  Al momento de escribir esto, no he logrado tener un volcado de metadatos en mis manos.  Apple envolvi√≥ mi solicitud sin especificar los motivos exactos.  ,  -     " <em>Apple Music</em> "    ,    Apple   .   - ,      -, <em>       </em> . ,       Apple    ,    ,     . </p><br><p>       ,        ,         .             Apple Music    ( <em>      ,       </em> ),     . ,     ,     Apple Music  .         ,      ,      . </p><br><p>   Enterprise Partner Feed     : </p><br><ul><li>          Apple Music API  iTunes Search API </li><li>      (" <em> </em> "),   -   </li><li>        </li></ul><br><h2 id="ochevidnye-sovety">   </h2><br><p>    ,  -  : </p><br><ol><li>   .     ,   ,     .   <br>     ,   .         ,    -     </li><li>   -  ,   ,            . ,       -  ,             -. </li><li> ,  SDK         ,      .  Apple <sup>25</sup>   SDK     <sup>26</sup> ,         ,   ,     API  ,   SDK    . </li><li>      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>   " <em>code level</em> "      .      " <em>Q&amp;A</em> "  " <em>Tech Notes</em> ",     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a> ,      - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . </li><li>      . ,  ,       .  API ( <em>Last.fm, musicbrainz, iTunes Search API    </em> )    IP   .       Apple Music      .        " <em></em> "       ,         <sup>27</sup> . </li><li> ,   Apple Music API,       ,   . - App Store   ,      ( <em>    </em> )     , ,  ( <em>        </em> ).     <sup>28</sup>   ,    ,          ,            <sup>29</sup> .   Apple      <sup>30</sup> . </li><li> ,  - Apple Music ‚Äî   Ember.    ,   ,     html         DOM   Javascript. </li><li>   -,   ,          .          ,    . </li></ol><br><h2 id="posleslovie">  </h2><br><p>     SDK,        batch   API,          ,    ¬´ ¬ª  Apple Music.  ,     ,        SDK   .          SDK,             . </p><br><p> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . </p><br><h2 id="bespoleznye-primechaniya">   </h2><br><p> <sup>1</sup>    ( <em> </em> ) </p><br><p> <sup>2</sup> ,       </p><br><p> <sup>3</sup> ,  Music.app  -        ( <em>   </em> ),    API   ( <em>   ""</em> )  </p><br><p> <sup>4</sup>    <code>limit</code>  : <code>Specified limit for relationship 'songs' exceeds maximum of 20</code> </p><br><p> <sup>5</sup> The Beatles </p><br><p> <sup>6</sup>    ,      Apple Music   iTunes Store.   API iTunes Store   `isStreamablez,        Apple Music  . </p><br><p> <sup>7</sup>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://itunes.apple.com/WebObjects/MZStore.woa/wa/viewArtistSeeAll?cc=ru&amp;ids=424279384&amp;section=0</a> </p><br><p> <sup>8</sup>  ,     ,  ,     iTunes    ( <em></em> )   iTunes Store </p><br><p> <sup>9</sup>             </p><br><p> <sup>10</sup>  ,       ! </p><br><p> <sup>11</sup> ,    Apple Music      :   ,        ,      </p><br><p> <sup>12</sup> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MPMusicPlayerPlayParametersQueueDescriptor</a> </p><br><p> <sup>13</sup>   Apple Music   ,    ( <em></em> )   .        . </p><br><p> <sup>14</sup> , ,    App Store </p><br><p> <sup>15</sup>    ( <em></em> )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">( <em></em> )</a>  ( <em></em> )    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">( <em></em> )</a> .       . </p><br><p> <sup>16</sup>       -,         </p><br><p> <sup>17</sup>     ,     iTunes Store    iTunes Match </p><br><p> <sup>18</sup>        API URL   </p><br><p> <sup>19</sup>  ‚Äî   -,       . ,  . </p><br><p> <sup>20</sup>  : ( <em>When your app moves to the background, the music player stops playing the current media.</em> ).       <code>AVPlayer</code> ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a>  <code>Info.plist</code>            . </p><br><p> <sup>21</sup>              . </p><br><p> <sup>22</sup>      ,    <code>MPMediaItem</code>    </p><br><p> <sup>23</sup>           </p><br><p> <sup>24</sup>     ,   SDK    ,     ,       .    iOS <code>Media Player</code>    ,     API  . </p><br><p> <sup>25</sup>         ,      ‚Äî      ,       . </p><br><p> <sup>26</sup>     SDK       ,    Apple Music. Apple    ,   . </p><br><p> <sup>27</sup>       ,      ‚Äî   . ,     Enterprise Partner Feed, musicbrainz,          API.  ,       ( <em>       </em> )    .      ,         . </p><br><p> <sup>28</sup> RIP </p><br><p> <sup>29</sup>   API  Bing </p><br><p> <sup>30</sup>        </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/464811/">https://habr.com/ru/post/464811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../464791/index.html">Kubernetes para el autom√≥vil: c√≥mo abrir el acceso del desarrollador a la computadora de a bordo y hacerla segura</a></li>
<li><a href="../464795/index.html">Merry Quartusel, o c√≥mo el procesador ha llegado a tal vida</a></li>
<li><a href="../464803/index.html">"Ocultar www": por qu√© los desarrolladores de navegador convencionales se negaron nuevamente a mostrar el subdominio</a></li>
<li><a href="../464805/index.html">Escribir una serpiente en ipad (pythonista)</a></li>
<li><a href="../464809/index.html">C√≥mo probamos la tecnolog√≠a de reconocimiento facial y qu√© result√≥ de ella</a></li>
<li><a href="../464813/index.html">Reemplazando los dise√±os de Punto Switcher, Birman con un script en autohotkey</a></li>
<li><a href="../464823/index.html">Consideramos el salario promedio de un "cient√≠fico de datos". Parsim hh.ru usando pandas / python</a></li>
<li><a href="../464825/index.html">Preparaci√≥n de la aplicaci√≥n para Android Q. Parte 2</a></li>
<li><a href="../464831/index.html">Agregue la funcionalidad de Razor Pages a .NET est√°ndar</a></li>
<li><a href="../464833/index.html">Cuente Scoring de la Fer o un estudio sobre calificaci√≥n crediticia como parte de la ampliaci√≥n de los horizontes. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>