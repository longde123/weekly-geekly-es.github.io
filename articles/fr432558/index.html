<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏿‍🤝‍👨🏻 👐🏻 ✔️ Modèle architectural «Visitor» dans les univers «iOS» et «Swift» 👩🏼 🏐 🌕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="«Visiteur» est l'un des modèles de comportement décrits dans le manuel «Gang of Four», «GoF», «Design Patterns: Elements of Reusable Object-Oriented S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Modèle architectural «Visitor» dans les univers «iOS» et «Swift»</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/432558/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Visiteur»</a> est l'un des modèles de comportement décrits dans le manuel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Gang of Four», «GoF», «Design Patterns: Elements of Reusable Object-Oriented Software ”)</a> . <br><a name="habracut"></a><blockquote>  En bref, le modèle peut être utile lorsqu'il est nécessaire de pouvoir effectuer des actions du même type sur un groupe d'objets de types différents non connectés les uns aux autres.  Ou, en d'autres termes, pour étendre les fonctionnalités de cette série de types avec une certaine opération du même type ou ayant une seule source.  Dans le même temps, la structure et la mise en œuvre des types extensibles ne devraient pas être affectées. </blockquote> La façon la plus simple d'expliquer l'idée est avec un exemple. <br><br>  <i>Je voudrais immédiatement faire une réserve que l'exemple est fictif et composé à des fins académiques.</i>  <i>C'est-à-dire</i>  <i>ce matériel est destiné à présenter la réception de la POO et non à discuter de problèmes hautement spécialisés.</i> <br><br>  <i>Je voudrais également attirer l'attention sur le fait que le code dans les exemples a été écrit afin d'étudier la technique de conception.</i>  <i>Je connais ses défauts (de code) et les possibilités de l'améliorer pour une utilisation dans des projets réels.</i> <br><br><h3>  Exemple </h3><br>  Supposons que vous ayez un sous-type de <code>UITableViewController</code> qui utilise plusieurs sous-types de <code>UITableViewCell</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirstCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewCell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecondCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewCell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThirdCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewCell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TableVC</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() tableView.register(<span class="hljs-type"><span class="hljs-type">FirstCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forCellReuseIdentifier: <span class="hljs-string"><span class="hljs-string">"FirstCell"</span></span>) tableView.register(<span class="hljs-type"><span class="hljs-type">SecondCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forCellReuseIdentifier: <span class="hljs-string"><span class="hljs-string">"SecondCell"</span></span>) tableView.register(<span class="hljs-type"><span class="hljs-type">ThirdCell</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forCellReuseIdentifier: <span class="hljs-string"><span class="hljs-string">"ThirdCell"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">FirstCell</span></span>() <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">SecondCell</span></span>() <span class="hljs-comment"><span class="hljs-comment">/**/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">ThirdCell</span></span>() } }</code> </pre><br>  Supposons que les cellules de différents sous-types aient des hauteurs différentes. <br><br>  Bien entendu, le calcul de la hauteur peut être placé directement dans l'implémentation de chaque type de cellule.  Mais que se passe-t-il si la hauteur de la cellule dépend non seulement de son propre type, mais aussi de toute condition extérieure?  Par exemple, un type de cellule peut être utilisé dans différents tableaux avec différentes hauteurs.  Dans ce cas, nous ne voulons absolument pas que les sous-classes <code>UITableViewCell</code> soient conscientes des besoins de leur «superview» ou «view controller». <br><br>  Ensuite, le calcul de la hauteur peut être effectué dans les méthodes <code>UITableViewController</code> : soit initialiser <code>UITableViewCell</code> avec la valeur de hauteur, soit <code>UITableViewCell</code> instance <code>UITableViewCell</code> en un sous-type spécifique et renvoyer différentes valeurs dans la méthode <code>tableView(_:heightForRowAt:)</code> .  Mais cette approche peut aussi devenir inflexible et se transformer en une longue séquence d'opérateurs «si» ou en une construction encombrante de «commutateur». <br><br><h4>  Résolution du problème à l'aide du modèle "Visiteur" </h4><br>  <i>Bien sûr, non seulement le modèle «Visiteur» est capable de résoudre ce problème, mais il est capable de le faire avec élégance.</i> <br><br>  Pour ce faire, dans un premier temps, nous allons créer un type qui sera, en fait, un «visiteur» de types de cellules et un objet dont la responsabilité est uniquement de calculer la hauteur de la cellule du tableau: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeightResultVisitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ell: FirstCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ell: SecondCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20.0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ell: ThirdCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30.0</span></span> } }</code> </pre><br>  Le type connaît chaque sous-type utilisé et renvoie la valeur souhaitée pour chacun d'eux. <br><br>  Deuxièmement, chaque sous-type de <code>UITableViewCell</code> doit pouvoir "recevoir" ce "visiteur".  Pour ce faire, nous allons déclarer un protocole avec une telle méthode de "réception", qui sera implémentée par tous les types de cellules utilisés: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeightResultVisitable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: HeightResultVisitor)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirstCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeightResultVisitable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: HeightResultVisitor)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecondCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeightResultVisitable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: HeightResultVisitor)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThirdCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeightResultVisitable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: HeightResultVisitor)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } }</code> </pre><br>  À l'intérieur de la sous-classe <code>UITableViewController</code> , la fonctionnalité peut être utilisée comme suit: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, heightForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.cellForRow(at: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">HeightResultVisitable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell.accept(<span class="hljs-type"><span class="hljs-type">HeightResultVisitor</span></span>()) }</code> </pre><br><h4>  Ça pourrait être mieux! </h4><br>  Très probablement, nous ne voulons pas qu'un tel code soit attaché de manière rigide à une fonctionnalité spécifique.  Peut-être que nous voulons pouvoir ajouter de nouvelles fonctionnalités à notre ensemble de cellules, mais pas seulement en ce qui concerne leur hauteur, mais, par exemple, la couleur d'arrière-plan, le texte à l'intérieur de la cellule, etc., et ne pas être liés au type de la valeur de retour.  Les protocoles avec type <code>associatedtype</code> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Protocole avec type associé», «PAT»</a> ) vous aideront ici: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CellVisitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">associatedtype</span></span> <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: FirstCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: SecondCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: ThirdCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> }</code> </pre><br>  Son implémentation pour le retour de la hauteur de cellule: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeightResultCellVisitor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CellVisitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: FirstCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">10.0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: SecondCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">20.0</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: ThirdCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">30.0</span></span> } }</code> </pre><br>  Du côté «hôte», il suffit de n'avoir qu'un protocole commun et sa seule implémentation - pour tout «visiteur» de ce type.  Seules les parties «visiteurs» seront conscientes des différents types de valeurs de retour. <br><br>  Le protocole pour le "visiteur récepteur" (dans le livre "GoF" ce côté est appelé "Element") prendra la forme: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitable</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ell</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Self</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewCell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-function">&lt;V: CellVisitor&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: V)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">VT</span></span> }</code> </pre><br>  (Il peut n'y avoir aucune restriction pour le type d'implémentation. Mais dans cet exemple, il n'est pas logique d'implémenter ce protocole par des sous-classes de <code>UITableViewCell</code> .) <br><br>  Et son implémentation dans les sous-types de <code>UITableViewCell</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FirstCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitable</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-function">&lt;V: CellVisitor&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: V)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">VT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SecondCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitable</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-function">&lt;V: CellVisitor&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: V)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">VT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ThirdCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Visitable</span></span></span><span class="hljs-class"></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">accept</span></span></span><span class="hljs-function">&lt;V: CellVisitor&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> visitor: V)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">VT</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> visitor.visit(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } }</code> </pre><br>  Et enfin, utilisez: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, heightForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">CGFloat</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.cellForRow(at: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">Visitable</span></span>ell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell.accept(<span class="hljs-type"><span class="hljs-type">HeightResultCellVisitor</span></span>()) }</code> </pre><blockquote>  Ainsi, nous pourrons créer, en utilisant différentes implémentations du «visiteur», en général, presque n'importe quoi, et rien ne sera exigé du «côté récepteur» pour supporter la nouvelle fonctionnalité.  Cette fête ne saura même pas exactement ce que "l'invité" a accordé. </blockquote><h3>  Un autre exemple </h3><br>  Essayons de changer la couleur d'arrière-plan de la cellule en utilisant un "visiteur" similaire: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ColorResultCellVisitor</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CellVisitor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: FirstCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIColor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .black } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: SecondCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIColor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .white } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: ThirdCell)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UIColor</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .red } }</code> </pre><br>  Un exemple d'utilisation de ce visiteur: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, willDisplay cell: UITableViewCell, forRowAt indexPath: IndexPath)</span></span></span></span> { cell.contentView.backgroundColor = (cell <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">Visitable</span></span>ell).accept(<span class="hljs-type"><span class="hljs-type">ColorResultCellVisitor</span></span>()) }</code> </pre><br>  Quelque chose dans ce code devrait être déroutant ... Au début, il était dit que le "visiteur" était capable d'ajouter des fonctionnalités à la classe de l'extérieur.  Est-il donc possible de "cacher" en elle toutes les fonctionnalités de changement de la couleur d'arrière-plan de la cellule, et pas seulement d'en tirer la valeur?  Tu peux.  Le type <code>associatedtype</code> prendra alors la valeur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><code>Void</code> (aka <code>()</code> - un tuple vide)</a> : <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BackgroundColorSetter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CellVisitor</span></span></span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: FirstCell)</span></span></span></span> { cell.contentView.backgroundColor = .black } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: SecondCell)</span></span></span></span> { cell.contentView.backgroundColor = .white } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">visit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cell: ThirdCell)</span></span></span></span> { cell.contentView.backgroundColor = .red } }</code> </pre><br>  Utilisation: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, willDisplay cell: UITableViewCell, forRowAt indexPath: IndexPath)</span></span></span></span> { (cell <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>! <span class="hljs-type"><span class="hljs-type">Visitable</span></span>ell).accept(<span class="hljs-type"><span class="hljs-type">BackgroundColorSetter</span></span>()) }</code> </pre><br><br><h3>  Au lieu d'une conclusion </h3><br><br>  Vous pouvez aimer le motif presque à première vue, cependant, vous devez l'utiliser avec soin.  Son apparition dans le code peut souvent être le signe de défauts plus généraux de l'architecture.  Peut-être que vous essayez de connecter des choses qui ne devraient pas l'être.  Peut-être que la fonctionnalité ajoutée vaut la peine de mettre un niveau d'abstraction plus haut d'une manière ou d'une autre. <br><br><blockquote>  D'une manière ou d'une autre, presque n'importe quel modèle a ses avantages et ses inconvénients, et avant de l'utiliser, vous devez toujours réfléchir et prendre une décision consciemment.  Les modèles sont, d'une part, un moyen de généraliser les techniques de programmation pour faciliter la lecture et la discussion du code.  Et de l'autre - un moyen de résoudre un problème (parfois introduit artificiellement).  Et, bien sûr, dans tous les cas, n'apportez pas fanatiquement le code à tous les modèles connus juste pour le fait même de leur utilisation. </blockquote><br><br>  Je suppose que j'ai fini!  Tout beau code et moins de "bugs"! <br><br>  <b>Mes autres articles sur les modèles de conception:</b> <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">«Le modèle architectural de l'itérateur dans l'univers Swift»</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Méthode d'usine et usine abstraite dans l'univers Swift et iOS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"Motif architectural" Builder "dans l'univers de" Swift "et" iOS "/" macOS "</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr432558/">https://habr.com/ru/post/fr432558/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432548/index.html">Un exemple d'utilisation d'une bibliothèque Java pour créer un bot Telegram</a></li>
<li><a href="../fr432550/index.html">Présentation de 3CX v16 Alpha et de la mise à jour de WebMeeting 3CX</a></li>
<li><a href="../fr432552/index.html">"L'esprit est en ligne." Formule de conscience</a></li>
<li><a href="../fr432554/index.html">Douglas Engelbart: Renforcer la société du «QI collectif»</a></li>
<li><a href="../fr432556/index.html">Technologie brevetée Tesla pour le positionnement des véhicules</a></li>
<li><a href="../fr432560/index.html">Typographie sur le web. Conférence Yandex à FrontTalks 2018</a></li>
<li><a href="../fr432562/index.html">Techday Make IT Real - 17 décembre, Moscou</a></li>
<li><a href="../fr432564/index.html">Rust 2018 est sorti ... mais qu'est-ce que c'est?</a></li>
<li><a href="../fr432566/index.html">Deux mondes ou «ingénieurs ont quelque chose à dire». Sur les différents types de tâches complexes et les processus qui leur sont associés</a></li>
<li><a href="../fr432568/index.html">«Quand vous êtes le rédacteur en chef de Rusbase»: un nouveau podcast sur l'utilisation du contenu et une carrière dans les médias technologiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>