<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌🏻 👨🏿‍🌾 ⚠️ 我与Haiku的第六天：在资源，图标和程序包的掩护下 🛀🏽 🌨️ 🧓🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR ：Haiku是专门为PC设计的操作系统，因此它有一些技巧可以使其工作环境比其他环境更好。 但是它是如何工作的呢？ 


 我最近发现了Haiku，这是一个出乎意料的好系统。 它的运行如此平稳仍然令人惊讶，特别是与Linux桌面环境相比。 今天，我在引擎盖下看。 在需要深入了解的地方，我...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>我与Haiku的第六天：在资源，图标和程序包的掩护下</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/464819/"><p><img src="https://habrastorage.org/webt/q_/aq/lh/q_aqlhqw47jrxex8_ohur7lifyw.jpeg"></p><br><p>  <strong>TL; DR</strong> ：Haiku是专门为PC设计的操作系统，因此它有一些技巧可以使其工作环境比其他环境更好。 但是它是如何工作的呢？ </p><a name="habracut"></a><br><p> 我<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">最近</a>发现了Haiku，这是一个出乎意料的好系统。 它的运行如此平稳仍然令人惊讶，特别是与Linux桌面环境相比。 今天，我在引擎盖下看。 在需要深入了解的地方，我将与原始Macintosh，Mac OS X和Linux工作环境（freedesktop.org的XDG标准）进行比较。 </p><br><h2 id="resursy-v-faylah-elf">  ELF文件中的资源 </h2><br><p> 昨天，我了解到IconOMatic可以将图标保存在ELF可执行文件的rdef资源中。 今天，我想看看它是如何工作的。 </p><br><p> 资源？  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">引用</a>来自Macintosh Finder程序的原始作者和Macintosh Resource Manager的“父亲”的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">布鲁斯·霍恩</a> （ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Bruce Horne）</a> ： </p><br><blockquote> 我担心传统代码编写的硬性。 对我来说，将应用程序冻结在代码中而无权动态更改任何东西的想法是最疯狂的。 在运行时阶段应尽可能进行更改。 当然，应用程序代码本身不能更改，但是可以在不重新编译代码的情况下更改某些内容？ </blockquote><p>在原始的Macintosh上，他们使这些文件具有“数据部分”和“资源部分”，这使得保存各种内容（例如图标，翻译等）变得极为容易。 在可执行文件中。 </p><br><p> 在Mac上， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ResEdit</a>用于此目的，这是一个图形程序-用于-突然-编辑资源。 </p><br><p><img src="https://habrastorage.org/webt/vj/g5/mc/vjg5mcnlsryzdkwslw9yo1xrcsi.gif"><br>  <em>原始Macintosh上的ResEdit</em> </p><br><p>结果，就可以编辑图标，菜单项，翻译等。 足够容易，但是它们仍然可以“随身携带”应用程序。 <br> 无论如何，这种方法都有一个很大的缺点：它只能在Apple文件系统上工作，这是Apple切换到Mac OS X时放弃“资源部分”的原因之一。 <br> 在Mac OS X上，Apple需要独立于文件系统的解决方案，因此他们采用了软件包（来自NeXT）的概念，即文件管理器将其视为“不透明对象”的目录，例如文件，而不是目录。 任何带有<code>.app</code>格式应用程序的软件包都具有一个<code>Info.plist</code>文件（类似于Apple的JSON或YAML），其中包含应用程序元数据。 </p><br><p><img src="https://habrastorage.org/webt/mu/tm/6f/mutm6f85f_8bzohhmb9csh_2ufq.png"><br>  <em>Mac OS X应用程序包中Info.plist文件的键。</em> </p><br><p> 资源（例如图标，UI文件等）作为文件存储在包中。 该概念实际上已恢复为NeXT的基础知识。 </p><br><p><img src="https://habrastorage.org/webt/gy/yr/kh/gyyrkhxdze3m_g4h5jkyems0uko.png"><br>  <em>1989年在NeXTSTEP 1.0上使用Mathematica.app：在终端中显示为包含文件的目录，但在图形文件管理器中显示为单个对象。</em> </p><br><p> 回到Haiku所基于的BeOS。 从PEF（PowerPC）转换为<abbr title="可执行和可链接格式">ELF</abbr> （x86）（Linux上使用的相同）时，其开发人员决定在ELF文件的末尾添加一个资源部分。 为此，没有使用我们自己的适当的ELF节，只是将其附加到ELF文件的末尾。 结果， <code>strip</code>程序和其他不知道这一点的binutils都将其切断了。 因此，在BeOS的ELF文件中添加资源时，最好不要使用Linux工具。 </p><br><p>  Haiku现在发生了什么？ 原则上，大致相同。 </p><br><p> 从理论上讲，您可以将资源放在ELF的右侧。 根据irc.freenode.net网络上#haiku频道上的开发人员的说法： </p><br><blockquote> 使用ELF，该部分会更有意义……我们不这样做的唯一原因是因为他们是在BeOS上完成的， <br> 现在不值得更改。 </blockquote><br><h3 id="upravlenie-resursami"> 资源管理 </h3><br><p> 资源以结构化的“资源”格式编写：实际上，这是资源的列表，其中包含大小和内容。 我记得<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">格式为ar</a> 。 <br> 如何查看Haiku中的资源？ 是否有类似ResEdit的内容？ <br> 根据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> ： </p><br><blockquote> 要查看应用程序包中提供的资源，您可以将可执行文件拖到诸如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Resourcer</a>的程序上。 您也可以转到终端并运行<code>listres _</code>命令。 </blockquote><p>  HaikuDepot中有一个Resourcer，但是对我来说它崩溃了。 </p><br><p> 如何管理ELF文件中的资源？ 使用<code>rsrc</code>和<code>rdef</code> 。  <code>rdef</code>文件收集在<code>rsrc</code> 。  <code>rdef</code>文件以纯文本格式存储，因此使用它要容易得多。  <code>rsrc</code>文件<code>rsrc</code>附加到ELF文件的末尾。 让我们尝试玩： </p><br><pre> <code class="plaintext hljs">~&gt; rc -h Haiku Resource Compiler 1.1To compile an rdef script into a resource file: rc [options] [-o &lt;file&gt;] &lt;file&gt;...To convert a resource file back into an rdef script: rc [options] [-o &lt;file&gt;] -d &lt;file&gt;...Options: -d --decompile create an rdef script from a resource file --auto-names construct resource names from ID symbols -h --help show this message -I --include &lt;dir&gt; add &lt;dir&gt; to the list of include paths -m --merge do not erase existing contents of output file -o --output specify output file name, default is out.xxx -q --quiet do not display any error messages -V --version show software version and license</code> </pre> <br><p> 您可以使用<code>xres</code>程序来验证和管理： </p><br><pre> <code class="plaintext hljs">/&gt; xres Usage: xres ( -h | --help ) xres -l &lt;file&gt; ... xres &lt;command&gt; ...The first form prints this help text and exits.The second form lists the resources of all given files.The third form manipulates the resources of one or more files according to the given commands. (...)</code> </pre> <br><p> 好吧，我们尝试一下吗？ </p><br><pre> <code class="plaintext hljs">/&gt; xres -l /Haiku/system/apps/WebPositive/Haiku/system/apps/WebPositive resources:type ID size name ------ ----------- ----------- -------------------- 'MIMS' 1 36 BEOS:APP_SIG 'APPF' 1 4 BEOS:APP_FLAGS 'MSGG' 1 421 BEOS:FILE_TYPES 'VICN' 101 7025 BEOS:ICON 'VICN' 201 91 kActionBack 'VICN' 202 91 kActionForward 'VICN' 203 300 kActionForward2 'VICN' 204 101 kActionStop 'VICN' 206 243 kActionGoStart 'MSGG' 205 1342 kActionGo 'APPV' 1 680 BEOS:APP_VERSION</code> </pre> <br><p> 您可以<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关资源和<code>rdef</code>格式的更多信息。 </p><br><h3 id="standartnye-tipy-resursov"> 标准资源类型 </h3><br><p> 尽管您可以在资源中放入任何内容，但是有一些定义的标准类型： </p><br><ul><li>  <code>app_signature</code> ：应用程序的MIME类型，用于匹配打开的文件，启动，IPC等。 </li><li>  <code>app_name_catalog_entry</code> ：由于应用程序名称通常为英文，因此您可以在此处指定翻译名称的位置，因此如果需要，不同语言的用户将看到翻译后的应用程序名称。 </li><li>  <code>app_version</code> ：正是您的想法 </li><li>  <code>app_flags</code> ：告诉<code>registrar</code>如何处理该申请。 我认为乍一看还有更多的东西。 例如，有<code>B_SINGLE_LAUNCH</code> ，它会根据用户的要求每次都强制系统启动一个新的应用程序进程（大多数Linux应用程序使用相同的原理）。 有<code>B_MULTIPLE_LAUNCH</code>强制为<em>每个文件</em>启动一个进程。 最后，还有<code>B_EXCLUSIVE_LAUNCH</code> ，它强制系统一次仅启动一个进程，而不管用户启动它的频率如何（例如，Firefox也可以在Linux上启动；使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">QtSingleApplication</a>函数在Qt应用程序中也可以实现相同的结果）。 当用户再次尝试运行具有<code>B_EXCLUSIVE_LAUNCH</code>应用程序时， <code>B_EXCLUSIVE_LAUNCH</code>收到通知：例如，它们获得用户希望在其帮助下打开的文件路径。 </li><li>  <code>vector_icon</code> ：矢量应用程序图标（BeOS中没有矢量图标，大多数应用程序在可执行文件中有两个栅格图标）。 </li></ul><br><p> 当然，您可以添加具有任何所需ID和类型的资源，然后使用<code>BResources</code>类在应用程序本身或其他应用程序中读取它们。 但是首先，让我们关注一下迷人的图标主题。 </p><br><h3 id="vektornye-ikonki-v-stile-haiku">  Haiku风格的矢量图标。 </h3><br><p> 当然，不仅Haiku选择了最佳的图标格式，在这一部分中Linux工作环境的情况也远非理想： </p><br><pre> <code class="plaintext hljs">me@host:~$ ls /usr/share/icons/hicolor/ 128x128 256x256 512x512 index.theme 160x160 28x28 64x64 scalable 16x16 32x32 72x72 symbolic 192x192 36x36 8x8 22x22 42x42 96x96 24x24 48x48 icon-theme.cache</code> </pre> <br><p> 看着这个，您已经可以感觉到它的一部分了。 </p><br><p> 当然，您可以理解，其中包含一个可扩展的矢量图标。 那为什么还有别的呢？ 因为以小尺寸绘制矢量图形的结果可能不理想。 我想针对各种尺寸优化各种选项。 在Linux工作环境中，这是通过在文件系统上散布具有不同大小的图标来实现的。 </p><br><pre> <code class="plaintext hljs">me@host:~$ find /usr/share/icons/ -name 'firefox.*' /usr/share/icons/HighContrast/16x16/apps/firefox.png /usr/share/icons/HighContrast/22x22/apps/firefox.png /usr/share/icons/HighContrast/24x24/apps/firefox.png /usr/share/icons/HighContrast/256x256/apps/firefox.png /usr/share/icons/HighContrast/32x32/apps/firefox.png /usr/share/icons/HighContrast/48x48/apps/firefox.png /usr/share/icons/elementary-xfce/apps/128/firefox.png /usr/share/icons/elementary-xfce/apps/16/firefox.png /usr/share/icons/elementary-xfce/apps/22/firefox.png /usr/share/icons/elementary-xfce/apps/24/firefox.png /usr/share/icons/elementary-xfce/apps/32/firefox.png /usr/share/icons/elementary-xfce/apps/48/firefox.png /usr/share/icons/elementary-xfce/apps/64/firefox.png /usr/share/icons/elementary-xfce/apps/96/firefox.png /usr/share/icons/hicolor/128x128/apps/firefox.png</code> </pre> <br><p> 请注意：没有不同版本的Firefox的概念。 因此，在系统中存在多个版本的应用程序时，您无法巧妙地处理这种情况。 </p><br><p><img src="https://habrastorage.org/webt/q7/ru/ul/q7ruul0hbp0pcgpc0wa5qubwwz8.png"><br>  <em>不同版本的不同Firefox图标。</em>  <em>没有各种拐杖，就不可能在Linux上进行处理。</em> </p><br><p>  Mac OS X处理起来更加复杂： </p><br><pre> <code class="plaintext hljs">Mac:~ me$ find /Applications/Firefox.app | grep icns /Applications/Firefox.app/Contents/MacOS/crashreporter.app /Contents/Resources/crashreporter.icns /Applications/Firefox.app/Contents/MacOS/updater.app/Contents/Resources/updater.icns /Applications/Firefox.app/Contents/Resources/document.icns /Applications/Firefox.app/Contents/Resources/firefox.icns</code> </pre> <br><p> 可以看出， <code>Firefox.app</code>软件包中有一个包含所有大小的<code>firefox.icns</code>文件，因此同一应用程序的不同版本具有不同的图标。 <br> 好多了！ 图标随应用程序一起移动，所有资源都在一个文件中。 </p><br><p> 回到Hai句。 一个令人鼓舞的决定，无一例外。 根据<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文档</a> ： </p><br><blockquote> 开发了一种针对<abbr title="Haiku矢量图标格式">HVIF</abbr>格式进行了高度优化的特殊功能，以实现小尺寸和快速渲染。 因此，我们的图标在很大程度上要比栅格或广泛使用的SVG格式的图标小得多。 </blockquote><p> 并且它们进行了优化： </p><br><p><img src="https://habrastorage.org/webt/yp/ca/po/ypcapoxrkbqe4nti2_ed1gltt7w.png"><br>  <em>与其他格式相比，HVIF中的图标大小。</em> </p><br><p> 区别是一个数量级！ </p><br><p> 但是魔术并没有就此结束。 即使是矢量格式，相同的HVIF也会根据显示的大小显示不同级别的细节。 </p><br><p><img src="https://habrastorage.org/webt/fy/qw/_o/fyqw_ouuhgrrasjvix4bvfgsekg.png"><br>  <em>根据渲染大小的不同，细节水平（LOD）</em> </p><br><p> 现在，了解缺点：您无法使用SVG，将其放入ImageMagick并在此处结束，您需要经历几个周期才能创建HVIF格式的图标。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里是</a>解释。 但是，IconOMatic不能完美导入SVG。 大约有90％的SVG零件是有可能进口的，其余的10％则需要手动调整和更改。 您可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Lea Ganson的</a>博客上了解有关HVIF如何发挥作用的更多信息<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">。</a> </p><br><h3 id="dobavlenie-ikonki-v-prilozhenie"> 向应用程序添加图标 </h3><br><p> 现在，考虑到收到的所有信息，我可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">上次</a>创建的包中添加一个图标。 <br> 好吧，由于我并不是真的很想为我的“ Hello World” QtQuickApp绘制自己的图标-我将其从Qt Creator中拉出来。 </p><br><pre> <code class="plaintext hljs">/Haiku/home&gt; xres /Haiku/system/apps/QtCreator/bin/Qt\ Creator -o /Haiku/home/QtQuickApp/QtQuickApp -a VICN:101:BEOS:ICON /Haiku/system/apps/QtCreator/bin/Qt\ Creator</code> </pre> <br><p> 让我们检查一下图标是否已复制： </p><br><pre> <code class="plaintext hljs">/Haiku/home&gt; xres -l /Haiku/home/QtQuickApp/QtQuickApp/Haiku/home/QtQuickApp/QtQuickApp resources:type ID size name ------ ----------- ----------- -------------------- 'VICN' 101 152238 BEOS:ICON</code> </pre> <br><p> 看起来不错，但是为什么在复制新图标时却没有出现？ </p><br><p><img src="https://habrastorage.org/webt/9k/no/a2/9knoa2ohfsjzcyiuv4wtrua32vw.png"><br>  <em>复制的VICN：101：BEOS：图标尚未在文件管理器中用作应用程序的图标</em> </p><br><p> 我想念什么？ </p><br><p> 开发者评论： </p><br><blockquote> 必须使用所有资源创建一个<code>rdef</code>文件，然后运行<code>rc .rdef</code> ，这将创建一个<code>.rsrc</code>文件。 然后，您需要运行<code>resattr -o _ .rsrc</code> 。 至少，我使用类似的命令将图标添加到脚本中。 </blockquote><p> 好吧，我想创建一个资源，而不是一个属性。 我直接感到困惑。 </p><br><h3 id="umnoe-keshirovanie-s-ispolzovaniem-faylovoy-sistemy"> 智能文件系统缓存 </h3><br><p> 打开和读取ELF属性的速度很慢。 正如我在上面所写，图标是作为资源写入文件本身的。 此方法更可靠，可让您在复制到另一个文件系统中幸免。 但是，然后它也被复制到文件系统属性，例如<code>BEOS:ICON</code> 。 这仅适用于某些文件系统，例如BFS。 从此扩展属性中读取系统显示的图标（在Tracker和Deskbar中），因为这样的解决方案可以快速工作。 在某些地方（速度并不重要，例如，典型的“关于”窗口），系统直接从文件中的资源接收图标。 但这还不是终点。 记住，在Mac上，用户可以用自己的图标替换应用程序图标，目录和文档，因为在Mac上可以做这些“重要”的事情，例如， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">用以前的图标替换新的Slack图标</a> 。 在Haiku上，您应该将资源（文件中）作为应用程序随附的源图标，并将属性（BFS文​​件系统中）作为允许用户根据需要进行更改的内容（尽管有提示，用于将用户图标插入图标顶部的图形界面是默认值尚未实现）。 </p><br><h3 id="proverka-atributov-faylovoy-sistemy"> 检查文件系统属性 </h3><br><p> 使用<code>resaddr</code>可以检查和设置文件系统的属性。 </p><br><pre> <code class="plaintext hljs">/&gt; resattr Usage: resattr [ &lt;options&gt; ] -o &lt;outFile&gt; [ &lt;inFile&gt; ... ] Reads resources from zero or more input files and adds them as attributes to the specified output file, or (in reverse mode) reads attributes from zero or more input files and adds them as resources to the specified output file. If not existent the output file is created as an empty file. (...)</code> </pre> <br><p> 本质上，这是一种“胶水”，可以在（可靠）资源和（快速）文件系统属性之间进行来回转换。 并且由于系统假定接收到资源并自动执行复制，因此我将不再为此担心。 </p><br><h2 id="volshebstvo-hpkg-paketov"> 神奇的hpkg软件包 </h2><br><p> 当前（通常） <code>.hpkg</code>软件包用于获取Haiku <code>.hpkg</code> 。 不要被一个简单的名字所迷惑：.hpkg格式的工作方式与您遇到的具有相似名称的其他格式完全不同，它具有真正的超能力。 </p><br><p> 对于传统的数据包格式，由于这个事实，我很不高兴：您下载了一个（程序包），而另一个安装在系统上（程序包中的文件）。 以传统方式安装软件包时，很难管理文件（例如，删除文件）。 所有这些都是因为软件包内容<em>分散在整个文件系统中</em> ，包括普通用户可能没有写访问权的地方。 相同的程序生成一类完整的程序，即程序<em>包管理器</em> 。 但是，将已经安装的软件（例如，转移到另一台计算机，可移动磁盘或文件服务器）变得更加困难，即使不是不可能。 在典型的基于Linux的系统中，很容易存在数十万到数百万个单独的文件。 不用说，它既脆弱又缓慢，例如，在系统的初始安装过程中，常规软件包的安装，更新和删除过程中以及将引导卷（根分区）复制到另一种介质时。 </p><br><p> 我正在研究AppImage项目，这是最终用户应用程序的部分拐杖。 这是一种软件分发格式，可将应用程序及其所有依赖项收集到在应用程序启动时安装的单个文件系统映像中。 由于同一ImageMagick突然变成单个文件，在文件管理器中由凡人管理，因此它大大简化了事情。 提议的方法仅适用于软件，这反映在项目的名称中，并且也有其自己的缺点，因为为Linux提供软件的人总是向我敞开大门。 </p><br><p> 回到Hai句。 您是否设法在传统包装系统和基于图像的软件的交付之间找到最佳平衡？ 其<code>.hpkg</code>软件包实际上是压缩的文件系统映像。 系统启动时，内核会使用大约以下内核消息挂载所有已安装的和活动的软件包： </p><br><pre> <code class="plaintext hljs">KERN: package_daemon [16042853: 924] active package: "gawk-4.2.1-1-x86_64.hpkg" KERN: package_daemon [16043023: 924] active package: "ca_root_certificates_java-2019_01_23-1-any.hpkg" KERN: package_daemon [16043232: 924] active package: "python-2.7.16-3-x86_64.hpkg" KERN: package_daemon [16043405: 924] active package: "openjdk12_default-12.0.1.12-1-x86_64.hpkg" KERN: package_daemon [16043611: 924] active package: "llvm_libs-5.0.0-3-x86_64.hpkg"</code> </pre> <br><p> 酷吧？ 等等，它会更凉！ </p><br><p> 有一个非常特殊的包： </p><br><pre> <code class="plaintext hljs">KERN: package_daemon [16040020: 924] active package: "haiku-r1~beta1_hrev53242-1-x86_64.hpkg"</code> </pre> <br><p> 它包含一个非常小的操作系统，包括内核。 信不信由你，即使内核本身也不是从引导卷（根分区）中提取的，而是从<code>.hpkg</code>软件包中精心加载到其位置的。 哇！ 我已经提到，对我来说，Haiku的整体复杂性和连贯性的一部分是由于这样一个事实，即来自内核和基本用户空间的整个系统以及工作环境的软件包和基础结构的管理是由一个团队共同开发的。 想象一下，运行这样一个基于Linux的组需要多少不同的组和命令<em>[我想象一个PuppyLinux项目-大约。</em>  <em>翻译者]</em> 。 然后想象一下这种方法在发行版中实施需要多长时间。 他们说：承担一项简单的任务，将任务分配给不同的表演者，它将变得如此复杂，以至于无法解决。 在这种情况下，句睁开了我的眼睛。 我认为这正是Linux上正在发生的事情（在这种情况下，Linux是Linux / GNU / dpkg / apt / systemd / Xorg / dbus / Gtk / GNOME / XDG / Ubuntu堆栈的统称）。 </p><br><h3 id="otkat-sistemy-s-ispolzovaniem-hpkg"> 使用hpkg进行系统回滚 </h3><br><p> 以下情况多久发生一次：更新成功，然后事实证明某些事情没有按预期进行？ 如果使用常规的软件包管理器，则很难将系统状态恢复到安装新软件包之前的时间点（例如，在出现问题的情况下）。 某些系统以文件系统快照的形式提供解决方法，但是它们非常繁琐，并且并非在所有系统上都使用。 在Haiku，可以使用<code>.hpkg</code>软件包解决此问题。 只要系统中的软件包发生更改，旧软件包就不会被删除，而是永久存储在系统中，形式为<code>/Haiku/system/packages/administrative/state-&lt;...&gt;/</code> 。 不完整的操作<code>/Haiku/system/packages/administrative/transaction-&lt;...&gt;/</code>其数据存储在<code>/Haiku/system/packages/administrative/transaction-&lt;...&gt;/</code>子目录中。 </p><br><p><img src="https://habrastorage.org/webt/u3/dm/2m/u3dm2m7c7oofelzibwk9rvxfm3i.png"><br>  <em>内容<code>/Haiku/system/packages/administrative</code> 。</em>  <em>目录“ state ...”包含文本文件，其名称为活动软件包的名称，“ transaction ...”-软件包本身。</em> </p><br><p>  “旧的活动状态”，即 在每次操作之后，在文件管理器中的<code>/Haiku/system/packages/administrative/state-&lt;...&gt;/activated-packages</code>文本文件中写入更改之前处于活动状态的<code>.hpkg</code>软件包列表。 以类似的方式，新的“活动状态”被写入文本文件<code>/Haiku/system/packages/administrative/activated-packages</code> 。 </p><br><p>  <code>/Haiku/system/packages/administrative/state-&lt;...&gt;/</code>目录仅包含带有此状态的活动软件包列表的文本文件（如果安装了软件包而未卸载），并且如果软件包被删除或更新，则状态目录包含旧版本的软件包。 </p><br><p> 当基于软件包列表加载系统时，将决定激活（安装）软件包。 好简单！ 如果在下载过程中出现问题，可以告诉下载管理器使用其他旧列表。 问题解决了！ </p><br><p><img src="https://habrastorage.org/webt/bi/vi/ww/biviwwsxnsv8fba4_r31syeoay0.png"><br>  <em>Haiku引导程序。</em>  <em>每个入口点都显示一个相应的“活动状态”</em> </p><br><p> 我喜欢将简单的文本文件作为“活动状态”列表的方法，在其中<code>.hpkg</code>可理解的<code>.hpkg</code>名称。 这与为文件系统中的机器而非人创建的OSTree或Flatpak <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">堆</a>形成鲜明对比（与Microsoft GUID处于同一级别）。 </p><br><p><img src="https://habrastorage.org/webt/e0/rk/mu/e0rkmuxplihduscyhdg-cji8jw8.png"><br>  <em>每个时间点的活动软件包列表</em> </p><br><h3 id="konfiguracionnye-dannye"> 配置数据 </h3><br><p> 显然，目录<code>/Haiku/system/packages/administrative/writable-files</code>包含软件包的配置文件，但可写。 毕竟，您还记得， <code>.hpkg</code>仅安装用于读取。 因此，在写入之前必须从软件包中复制这些文件。 有道理。 </p><br><h2 id="integraciya-gui-dlya-sistemy-hpkg">  .hpkg系统的GUI集成 </h2><br><p> 现在，让我们看看这些出色的<code>.hpkg</code>软件包如何<code>.hpkg</code>与用户工作区（UX）的集成。 毕竟，Haiku毕竟是供个人使用的。 就个人而言，我通过将用户体验与Macintosh上的<code>.app</code>软件包与<code>.hpkg</code>上的相同体验进行比较来设定较高的<code>.hpkg</code> 。 我什至不会将这种情况与Linux上的工作环境进行比较，因为与其他任何环境相比，这绝对是可怕的。 </p><br><p> 想到以下情况： </p><br><ul><li> 我想查看软件包<code>.hpkg</code>的内容 </li><li>     </li><li>     </li><li>    -,       </li><li>    -,       </li><li>      ,        Haiku ( ,          .) </li><li>      (,   )    ,     ( ) ( ,  ,      ). </li></ul><br><p>          . , . </p><br><h3 id="proverka-soderzhimogo-paketa">    </h3><br><p> <em> Mac</em>               Finder.       ! ( ,    <code>.pkg</code>   ,    ,          ). </p><br><p> <em> Haiku</em>       ,    "Contents"   ,  .            . <br>    ,     ()   <code>.hpkg</code>     ,          . ( ,   <code>.hpkg</code>   <code>Expander</code> ,         ). </p><br><p><img src="https://habrastorage.org/webt/fw/u4/wx/fwu4wxplw4lmuhlen-dsdpis15w.png"><br> <em>  HaikuDepot     ,     ,  ,    README.md</em> </p><br><p>    Mac ,     HaikuDepot     . </p><br><h3 id="ustanovka-paketa-cherez-gui">    GUI </h3><br><p> <em> Mac</em> ,    <code>.dmg</code>   <code>.app</code> .     ,    ,  ,    <code>/Applications</code>  Finder.      ,   ,       . - Apple ""   <code>/Applications</code> ( NeXT   ,   ),             <code>$HOME/Applications</code> ,    . </p><br><p> <em> Haiku</em> ,    ,    "Install",  .   ,   ,     ,   HaikuPorts,     .  Linux     ,     ,     —  ,      .  ,   Haiku. </p><br><p><img src="https://habrastorage.org/webt/zw/su/db/zwsudbvupiak8naq9g4qab3yan8.png"><br> <em>   'sanity'     ,   ,     ( ,      ).    Linux  .</em> </p><br><p>    —   ,   <code>.hpkg</code>    <code>/Haiku/system/packages</code> (  , -),   <code>/Haiku/home/config/packages</code> (  ;     —      "config"   ,        "settings").           Haiku (,     —   , ,          ). </p><br><p>     Haiku,        ,     . </p><br><h3 id="udalenie-paketa-iz-gui">    GUI </h3><br><p> <em> Mac</em> ,      ,    . ! </p><br><p> <em> Haiku</em> , -,  ,     ,          (  ).     <code>/Haiku/system/packages</code> (   -),   <code>/Haiku/home/config/packages</code> (  ,  "config" —  ?).      ,    . <br> ! ,     .      : </p><br><p><img src="https://habrastorage.org/webt/7n/ua/pe/7nuape6gmsog1zgxh-voua6zpkq.png"><br> <em>  ,       <code>/Haiku/system/packages</code></em> </p><br><p>         ", "  QtQuickApp. <em>     ,</em>         —    <code>.hpkg</code>   <em>" "</em> .    ,    "",  -. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">mr. waddlesplash</a> : </p><br><blockquote>     10 .       ,        .         . </blockquote><p> , ,   ,  HaikuDepot?      <code>/Haiku/system/packages</code> , ,    "Uninstall". -,  () «Install». «Uninstall»,  ? </p><br><p>    ,  ,    "Install"    .  : </p><br><p><img src="https://habrastorage.org/webt/tx/gb/ce/txgbce2ggdrtjsbxvcub5-eli7e.png"><br> <em> ,       .</em> </p><br><p>  : </p><br><p><img src="https://habrastorage.org/webt/ll/wq/yh/llwqyhzagntx2gg2spqpvh-rc9g.png"><br> <em>  "Apply changes"    —  </em> </p><br><p> ,    ,     . <em>[   , — .</em>  <em>译者]</em> </p><br><blockquote>  :   "Uninstall",      <code>/Haiku/system/packages</code> ,   <code>/Haiku/home/config/packages</code> . </blockquote><p>    ,   HaikuDepot,          . </p><br><p>     Mac.    ,        Haiku  ,   Mac. (     : "       HaikuDepot,     ++",  ?) </p><br><h3 id="udalenie-chego-libo-iz-paketa">  -   </h3><br><p>     ,    <code>.hpkg</code> ,     (,   " "  - ). </p><br><p> <em> Mac</em> ,         <code>.dmg</code> ,     <code>.app</code> .   <code>.dmg</code>    ,      <code>/Applications</code> .  ,      ,   ,      Apple. (  ,      Mac. ,  ,  AppImage      ,    .     =   . !) </p><br><p> <em> Haiku</em> ,     <code>apps/</code>  <code>packages/</code> ,    ,      .    ,     <code>apps/</code>  : </p><br><p><img src="https://habrastorage.org/webt/uf/il/ae/ufilaefiaf2mx92ktdfaedeesps.png"><br> <em>      ,    <code>.hpkg</code></em> </p><br><p>    (        ,   ),      . </p><br><blockquote>  :     GUI  <code>.hpkg</code> </blockquote><p>      ,  Alt+D.   "         ".   ,  <code>/system</code> ( <code>/system/packages</code>  <code>/system/settings</code> )    packagefs (,      <code>df</code> ?).  ,   <code>mount</code>    (        ), <code>mountvolume</code>    (     loop  <code>.hpkg</code>   ""),      . </p><br><p>      ,  AppImage ( ,   ,  ).   ,   ,    Haiku  ,   Mac. </p><br><p> <em>:  ,   ""    «». ,    ""  «":         ,      ( , ,   ).      ?</em> </p><br><h3 id="kopirovanie-soderzhimogo-paketa-na-druguyu-sistemu">       </h3><br><p> <em> Mac</em> ,    <code>.app</code> ,      —   . </p><br><p> <em> Haiku</em> ,  ,     . </p><br><blockquote>  :       ```.hpkg ,   ,   . </blockquote><p>      Mac.     ,   .  Haiku    <code>.hpkg</code>  ,      ... </p><br><h3 id="skachivanie-paketa-so-vsemi-ego-zavisimostyami">       </h3><br><p>        . ,   (,    ,  Windows, Mac  Linux)   .   ,        -,     ,         ,    [ ,    Windows… — . ]. </p><br><p>    ,  ,       Windows  Linux. </p><br><p> <em> Mac</em>    ,    —  <code>.dmg</code> .      ,  ,    MacOS -.       ,    ,   java. </p><br><p> <em> Haiku</em>   <code>.hpkg</code> , ,     java,   ,  java   ,      .          <code>.hpkg</code> ,  ,    Haiku - , ,      Haiku? </p><br><p>        Mac. </p><br><p>  mr. waddlesplash: </p><br><blockquote>  ,             <code>.hpkg</code>  -,     Haiku,   15 .         ,      .      . </blockquote><p>        . </p><br><h3 id="peremeschenie-paketov-v-obosoblennoe-mesto">      </h3><br><p>     ,     <code>.hpkg</code> (,   )   ,        ( ).    (    )   — ,        () ,     .         ,    . </p><br><p> <em> Mac</em>     <code>.app</code>        Finder,    .                . ! </p><br><p> <em> Haiku</em> ,   ,       <code>.hpkg</code>       ,           ,     .   ,   ,   GUI. </p><br><p>     Mac. </p><br><p>  mr. waddlesplash: </p><br><blockquote>      .     ,    ,   .       . </blockquote><p>      . </p><br><p>     :    ( LAN )  , ,   (,  Zeroconf),            .  ,       <code>app_flags</code> . </p><br><h3 id="itogovyy-otchet-po-integracii-sistemy-hpkg-c-gui">      hpkg c GUI </h3><br><p>  ,    -    <code>.hpkg</code>  GUI     .   ,   ,      UX... </p><br><h2 id="esche-odna-vesch-kernel-debug-land">   : Kernel Debug Land </h2><br><p>     kernel panic    ,   <code>syslog | grep usb</code> . ,  Haiku    Kernel Debug Land.       ,           kernel panic? ,  Alt+PrintScn+D ( Debug).    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Programmer's Key</a> ,    Macintosh    (   , ). </p><br><h2 id="zaklyuchenie"> 结论 </h2><br><p>   ,    Haiku   ,                 . <br>     Linux/GNU/dpkg/apt/systemd/Xorg/dbus/Gtk/GNOME/XDG/Ubuntu,         ,        . <br>    ,   <code>.hpkg</code>      , Snappy, Flatpak, AppImage,  btrfs,      " "  Mac. </p><br><p>  - ""  ,   ,   <code>.hpkg</code>  , —    .    ,     .      Mac. </p><br><p> ,         ,  ,     ( Gtk, Electron —   ,      ),    3d   ,       .           .     , ,   . </p><br><p>     ,       <em> Haiku   </em> . </p><br><h2 id="sluchaynye-problemy">   </h2><br><p>    ,     ? </p><br><ul><li> BeScreenCapture      GIF,   Peek.      ffmpeg,    Haiku. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . </li><li>           ,      </li><li>          WonderBrush,   —     </li><li>          Haiku,   ,       .         Krita,     (.        ).       . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> . </li></ul><br><p> 自己尝试！ 毕竟，Haiku项目<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">每天都会</a>从DVD或USB提供下载图像。 要安装，只需下载图像并使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Etcher</a>将其写入USB闪存驱动器 </p><br><p> 有问题吗？ 我们邀请您访问俄语<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">电报频道</a> 。 </p><br><p> 错误概述： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">如何在C和C ++中扎根。</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Haiku OS食谱集</a> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> :       Haiku. </p><br><p>  : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="></a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN464819/">https://habr.com/ru/post/zh-CN464819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN464803/index.html">“隐藏www”：为什么主流浏览器开发人员再次拒绝显示该子域</a></li>
<li><a href="../zh-CN464805/index.html">在ipad上写蛇（pythonista）</a></li>
<li><a href="../zh-CN464809/index.html">我们如何测试人脸识别技术以及它的结果</a></li>
<li><a href="../zh-CN464811/index.html">适用于开发人员的Apple Music</a></li>
<li><a href="../zh-CN464813/index.html">用autohotkey上的脚本替换Punto Switcher，Birman布局</a></li>
<li><a href="../zh-CN464823/index.html">我们考虑了“数据科学家”的平均工资。 使用熊猫/ python的Parsim hh.ru</a></li>
<li><a href="../zh-CN464825/index.html">为Android Q准备应用程序。第2部分</a></li>
<li><a href="../zh-CN464831/index.html">将Razor Pages功能添加到标准.NET</a></li>
<li><a href="../zh-CN464833/index.html">伯爵计分（Scoring de la Fer）或一项信用评分研究是拓宽视野的一部分。 第二部分</a></li>
<li><a href="../zh-CN464837/index.html">从恒河到伏尔加河：如何使河流免遭污染？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>