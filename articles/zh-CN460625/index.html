<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏽‍💻 👇🏾 📞 因为我没有在Telegram的JavaScript开发人员竞赛中获得第一名 👩🏽‍🎓 👵🏼 👨🏼‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Telegram的活跃用户，尤其是那些订阅了Pavel Durov的用户，可能听说过Telegram在您的这些Internet站点上举行了针对iOS，Android和JavaScript开发人员以及设计师的竞赛这一事实。 尽管这是一次具有丰厚奖金分布的史诗般的活动（其中一名参与者获得了5万美元的奖金...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>因为我没有在Telegram的JavaScript开发人员竞赛中获得第一名</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/460625/">  Telegram的活跃用户，尤其是那些订阅了Pavel Durov的用户，可能听说过Telegram在您的这些Internet站点上举行了针对iOS，Android和JavaScript开发人员以及设计师的竞赛这一事实。 尽管这是一次具有丰厚奖金分布的史诗般的活动（其中一名参与者获得了5万美元的奖金，并且编写了最快，最简单的Android应用程序），但他们至少在Runet上几乎不写任何东西。 我的处女作将尝试解决这种情况。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b51/6e9/071/b516e9071bc91d08b80222b9e9bfbcbd.png"></div><a name="habracut"></a><br> 由于我是全栈JavaScript开发人员（准确地说是TypeScript开发人员），所以我决定进行自我测试。 马尼拉不仅是一项奖金，而且是格式本身：这不是一场编程比赛，在这场比赛中抽象性和思考速度至关重要。 复杂的一切在这里都很重要：经验，中期的开发速度，UI问题的品味，整个计算机科学的知识以及自我批评。 根据比赛的条款，有必要开发一个用于显示以下平台之一的图形的库：iOS，Android或Web。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z7/jx/um/z7jxumisjsnktyff0u06fsyutma.jpeg"></div><br> 不同平台的开发人员没有竞争，每个平台都有自己的赢家。 主要标准是：工作速度（包括在较旧的设备上），与设计的一致性，流畅的动画和最小的应用程序大小。 现有的解决方案和库已经无法使用，所有内容都必须从头开始编写。 <br><br> 在此之前，我参加了针对开发人员的竞赛，在竞赛中，所有任务的分配时间均不超过5个小时，这些时间不得不花很大的压力。 尽管Telegram并不需要那么费力才能完成任务，但这是我必须参加的最困难的比赛之一。 看起来似乎并不复杂的任务是如此之大，以至于如果我付了钱，我可以将这些“图形”裁剪几个月，试图在代码性能与其体系结构和谐之间找到折衷方案。 它为解决方案分配了三周（ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">最多</a> <b>：</b>两周，感谢<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">vlad2711</a>的修正）。 一些竞争对手专门请假，以腾出更多时间参加比赛，我决定像往常一样在晚上和周末将比赛的发展与“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Ontanta</a> ”的工作结合起来。 <br><br><h1>  CANVAS与SVG </h1><br> 我们所有人面临的最重要的建筑问题是图形渲染工具的选择。 当前，网络标准为我们提供了两种方法：通过生成实时的svg图形和优质的旧画布。 这是各自的优缺点。 <br><br><h3> 帆布 </h3><br>  <b>+</b>绝对的多功能性-能够更改画布上任何像素的颜色，您可以绘制任何想要的东西。 <br>  <b>+</b> [潜力]高性能-如果您可以准备画布，则可以显示出良好的性能。 使用webgl会很棒，但是它对智能手机的支持很差。 <br><br>  <b>-</b>所有计算和所有手工渲染-与SVG不同，折线的中间点可以设置一次，然后您可以操纵视图框沿折线的各个部分移动“相机”，使用画布，一切都变得更加复杂：这里没有“相机”，有仅从左上角开始的坐标； 如果需要“移动”图表的当前查看区域，则必须重新计算其所有点相对于查看区域的新位置的所有坐标。 换句话说，在svg中开箱即用的viewbox需要在canvas中手动实现。 <br>  <b>-</b>整个动画是手动的-在上一段的基础上，通过重新计算坐标，颜色和透明度值并每秒重绘整个场景第N次来实现所有可能的动画，并且重新计数和重绘场景的次数越多，动画就越平滑。 <br><br><h3>  SVG </h3><br>  <b>+</b>简单渲染-只需将必要的线条，形状等添加到SVG中，即可通过操纵视口，颜色和透明度设置来浏览图形。 <br>  <b>+</b>动画的简单实现-再次基于上一段，Ne足以为视图框，颜色和透明度每秒指定新值，并且图像将自己重绘，浏览器将负责此操作。 另外，不要忘记SVG中的形状和基元可以在CSS中设置样式，因此可以使用CSS3动画对其进行动画处理，这为以最少的努力获得炫酷的动画提供了最大的可能性。 <br>  <b>+</b>默认情况下具有良好的性能-如果您可以轻松地在画布上放一些缓慢的东西并消耗数百个资源，那么基于SVG的结果将始终看起来非常轻巧，体面和流畅。 <br><br> 但是硬币有另一面。 <br><br>  <b>-</b>适度的优化机会-由于我们不是在绘制svg，而是在浏览器中绘制，因此无法控制此过程-如果您想提高性能（例如，已经缓存单个绘制的元素），则无法以任何方式进行。 这很可能已经由浏览器完成，但是直到最后我们才能确定。 <br>  <b>-</b>有限的工具-在SVG中，我们不再控制画布的每个像素，而是在向量基元的框架内进行思考和编码。 但是，对于这项任务而言，这是一个微不足道的负号，在竞争任务的背景下施加了一些又微不足道的限制。 <br><br> 我从来不必担心选择工具，因为我有一个令人恶心的角色特征-我是一个极简主义者，过去只在工作中使用我最喜欢的工具。 碰巧的是，从学生时代开始，当我在玩DirectDraw时，我最喜欢的工具始终是一张画布，上面可以“做你想做的事”。 解决竞争问题的画布确实很不错，但实际上它只发挥了我的一个优点：最广泛的优化机会，因为主要标准仍然是应用程序性能。 <br><br><h1> 好的代码不好 </h1><br> 任务很明确：您需要在正确的位置和正确的时间在画布上绘制点。 仍然需要编写代码。 同样，这一次有必要选择，在以程序样式编写带有一个“ footfoot”的高效紧凑代码之间，或者不是非常高效，甚至在我最喜欢的面向对象的紧凑环境中进行选择。 您可能已经猜到我选择了第二个选项，并用另一个我喜欢的类型-TypeScript对其进行了调味。 <br><br> 而且这种选择不是很正确。 由于使用了抽象和封装，因此并不总是能够保存，传输和重用中间计算结果，从而对性能产生不良影响。 而且由于这种方法的广泛使用，如果没有这种方法，JS中的OOP是不可能的，因此代码的精简性很差，而大小也很重要。 <br><br> 现在是时候提供指向github的链接了： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">github.com/native-elements/telechart</a> 。 如果有兴趣，我建议您注意提交的历史记录；它会记录优化过程和每秒未能挤出两次额外渲染帧的失败尝试。 <br><br> 好吧，在比赛中我没有领奖。 而且这个问题，就像我们程序员经常遇到的那样，事实证明不是经验不足，机智或速度不足，而是自我批评不足：我设法做到这一点的事实并看起来像图片中的事实，我很高兴，但是至于渲染刹车，我以为我已经尽力了，其余的大概也一样。 我很to愧谈论这件事，但是我确信我会获得第一或第二名。 实际上，事实证明，我编写了一个刹车和越野车程序，不是最糟糕的，但远非最好的。 当我看到其他开发人员的工作时，我意识到我没有机会，只能咬肘。 如果我对自己的工作不偏不倚，我将从事生产力，这是竞争任务中最重要的部分。 <br><br> 我不厌倦的职业生涯中最有价值的教训之一是，与例如艺术家不同，一个好的工程师有义务客观地评估他的作品质量，放弃自信，因为他的作品的结果不仅应该取悦眼睛但应该可以正常运作。 <br><br> 这是比赛的第一阶段。 优胜者得到了丰厚的回报。 令我高兴的是，故事并没有就此结束，因为第二阶段已宣布： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tq/ge/fb/tqgefbqq70vn363qi-f9ef1d9my.jpeg"></div><br> 有必要在短短一周内实施其他类型的图表来完善您的工艺。 我将立即显示发生了什么，下面将告诉您它是如何发生的。 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3ea/607/144/3ea6071449116820be794f886f9ebc21.png"></div><br> 就我而言，在添加新功能之前，我必须了解旧功能的性能。 我解决的第一个问题是 <br><br>  <b>抽搐动画</b> <br><br> 即使您有足够的能力每秒产生60帧，如果元素的位置或其透明度不是由动画开始以来经过的时间决定的，则动画也不会平滑。 这是由于滴答之间的时间间隔不相等：例如，一个滴答在10毫秒后起作用，第二个滴答在40毫秒之后起作用，而对于第一个和第二个滴答，对象向左移动了1个像素-也就是说，其移动速度不断浮动，在视觉上看起来像是“抽搐”。 换句话说，您需要做一些错误的事情： <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> left = <span class="hljs-number"><span class="hljs-number">10</span></span>, interval = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { left += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (left &gt;= <span class="hljs-number"><span class="hljs-number">90</span></span>) { clearInterval(interval) } }, <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre> <br> 依此类推： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> left = <span class="hljs-number"><span class="hljs-number">10</span></span>, startLeft = <span class="hljs-number"><span class="hljs-number">10</span></span>, targetLeft = <span class="hljs-number"><span class="hljs-number">90</span></span>, startTime = <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now(), duration = <span class="hljs-number"><span class="hljs-number">1000</span></span>, interval = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { left = startLeft + (targetLeft - startLeft) * (<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() - startTime) / duration <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (left &gt;= targetLeft) { left = targetLeft clearInterval(interval) } })</code> </pre><br> 由于代码中包含许多动画参数，因此我拍摄了一个<a href="">通用类</a> ， <a href="">该类</a>使任务更加容易，并且还增加了动画效果。 它很容易使用： <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> left = Telemation.create(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span>) … drawVerticalLine(left.value) <span class="hljs-comment"><span class="hljs-comment">//      ,  .</span></span></code> </pre> <br> 然后60 fps规则开始起作用。  PC游戏玩家会理解我：要使动画看起来完美，它必须以至少60 fps的速度渲染。 因此，帧的每个渲染应不超过1/60秒。 这需要强大的硬件和良好的代码。 <br><br> 进一步的研究表明 <br><br>  <b>如果画布上方有html元素，则绘画画布的速度会降低</b> 。 <br><br> 最初，我使用“空” html元素来实现对当前视口的控制： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac7/3f2/3b4/ac73f23b4010f587f19950259c95ac03.png"></div><br> 这些元素放置在画布上，尽管它们没有内容，但仅用于跟踪鼠标事件，作为实验结果，事实证明它们的存在会降低渲染性能。 通过删除它们并使确定用于控制观看区域的事件的逻辑复杂化，我提高了渲染帧的速度。 <br><br> 仍然需要从演奏棺材的盖子上拉出最后一个钉子：我做到了 <br><br>  <b>小地图缓存</b> <br><br> 在此之前，对于小地图，每帧都要绘制一条线。 这是一项昂贵的操作，因为它显示了整个年度的时间表（每行365点）。 我从一开始就懒于实现的显而易见的解决方案是为小型地图绘制一次图形线，将结果保存到缓存中，并在将来使用此缓存。 经过优化后，应用程序性能不再令人尴尬。 <br><br><h1> 接下来呢？ </h1><br> 仍然有许多成功而不是非常不理想的性能：尝试缓存坐标计算的结果，使用CanvasRenderingContext2D lineJoin参数进行实验（更快的斜接），但是它们并不那么有趣，因为它们没有显着提高性能或根本没有提高性能。 <br><br> 在这八天中，我花了五天时间来加速代码，而只花了三天时间来完成新功能。 是的，我只花了三天时间就添加了新类型的图表，在这里，OOP变得非常方便，代码库略有增加。 我没有足够的时间来完成奖励任务（另加5张图表）。 我相信我花了五天时间来消除自信心的后果，我可以花时间解决奖金问题。 <br><br> 尽管如此，我的工作还是取得了结果：第四名和一千美元的“安慰”奖： <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f59/2c6/cdc/f592c6cdc54f45723ddc6747d3c5c3f0.png"></div><br> 顺便说一句，比赛继续进行，但是没有我。 <br><br> 我的参与使我感到高兴：除了有趣和有趣的冒险之外，我还获得了很好的专业经验和生活课程。 <br><br> 另外，我在开发公司时间跟踪器时使用了该库，我也计划在不久的将来讨论该库。 <br><br> 为了讨论，我提出以下问题：为什么电报需要所有这些？ 我相信，只要有足够的钱，Telegram就会获得世界上最好的显示图表的图书馆：数百次尝试做得更好的最好结果。 竞争原则可以使您获得如此高的质量，以至于没人可以不花钱就下订单。 <br><br> 和一些链接： <br><br><ul><li> 比赛结果： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">t.me/contest/81</a> </li><li> 所有比赛参赛者： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">common.dev/chart-js</a> </li><li> 我在竞赛网站上的页面： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Competition.dev/chart-js/entry74</a> </li><li> 我的应用程序： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">jschart.usercontent.dev/entry74</a> </li><li> 如果没有电报，则可以在这里看到： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">asyncoders.com/telechart/index.html</a> </li></ul><br><div class="spoiler">  <b class="spoiler_title">还有一点空缺</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">JS开发人员（云方向）</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">系统架构师</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">系统分析师</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">领先的系统工程师Vmware</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">开发人员1C</a> </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN460625/">https://habr.com/ru/post/zh-CN460625/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN460611/index.html">故障转移：完美主义毁了我们，并且……懒惰</a></li>
<li><a href="../zh-CN460615/index.html">在《工业忍者》问世之后：如何在Positive Hack Days 9中入侵PLC</a></li>
<li><a href="../zh-CN460617/index.html">关于RTOS的全部真相。 第30条。 Nucleus SE初始化和启动过程</a></li>
<li><a href="../zh-CN460621/index.html">井字游戏第4部分：使用HTTP与Flask后端交互</a></li>
<li><a href="../zh-CN460623/index.html">关于朱利安·阿桑奇的酷刑</a></li>
<li><a href="../zh-CN460627/index.html">vGPU-使用不可忽略</a></li>
<li><a href="../zh-CN460629/index.html">2名矿工拥有相同世界的概率</a></li>
<li><a href="../zh-CN460631/index.html">80天徽章周围：OFFZONE的另一侧</a></li>
<li><a href="../zh-CN460633/index.html">RSTP和专有扩展环冗余的实现细节</a></li>
<li><a href="../zh-CN460635/index.html">CLRium＃6：并发与并行。 两天：从处理器到异步/等待</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>