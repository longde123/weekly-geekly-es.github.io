<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè° üçò ‚úãüèø Guia de notifica√ß√µes de assinaturas da Apple para iOS. Eles s√£o realmente bons? üë®üèª‚Äçüéì üë©üèΩ‚Äçü§ù‚Äçüë©üèº üò∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Portanto, voc√™ tem um aplicativo com assinaturas renov√°veis ‚Äã‚Äãautom√°ticas. Funciona muito bem, os usu√°rios emitem incontrolavelmente assinaturas premi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guia de notifica√ß√µes de assinaturas da Apple para iOS. Eles s√£o realmente bons?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/apphud/blog/453770/"><p><img src="https://habrastorage.org/getpro/habr/post_images/fa5/f52/a07/fa5f52a07612fe9b040dad35421024ec.jpg"></p><br><p>  Portanto, voc√™ tem um aplicativo com assinaturas renov√°veis ‚Äã‚Äãautom√°ticas.  Funciona muito bem, os usu√°rios emitem incontrolavelmente assinaturas premium e escrevem cr√≠ticas elogiosas.  Beleza! </p><br><p>  Ol√° pessoal, meu nome √© Denis, sou gerente de projetos do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apphud</a> , um servi√ßo de an√°lise de assinaturas renov√°veis ‚Äã‚Äãautomaticamente para aplicativos iOS. </p><br><p>  Como gerente de projeto, √© vital que voc√™ fique a par das principais m√©tricas do produto.  Um dos mais importantes √© o valor do tempo de vida √∫til (LTV) - a renda m√©dia de cada usu√°rio durante todo o tempo usando o aplicativo.  Mas como calcul√°-lo no caso de assinaturas renov√°veis ‚Äã‚Äãautomaticamente no iOS?  Como rastrear o tempo de renova√ß√£o, cancelamento, renova√ß√£o de uma assinatura por um usu√°rio? <a name="habracut"></a></p><br><p>  At√© recentemente (ou seja, at√© 2017), a √∫nica maneira de fazer isso era a chamada Pesquisa de status de assinaturas.  A qualquer momento, voc√™ pode obter informa√ß√µes sobre o status da assinatura enviando o recibo necess√°rio para o URL: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://buy.itunes.apple.com/verifyReceipt</a> .  Depois de receb√™-lo, voc√™ pode visualizar informa√ß√µes b√°sicas sobre a assinatura, incluindo a data de t√©rmino.  √â verdade que voc√™ ainda n√£o ter√° seu custo. </p><br><p>  Para implementar a pesquisa de status, voc√™ deve: </p><br><ol><li>  transferir e armazenar no servidor todas as verifica√ß√µes de todas as assinaturas de cada usu√°rio, </li><li>  implementar l√≥gica complexa do servidor, que verificar√° <strong>regularmente</strong> essas verifica√ß√µes. </li></ol><br><p>  Isso √© complicado.  Mas em 2017, a Apple parece resolver esse problema.  Na WWDC, aplaudindo de p√©, eles apresentam notifica√ß√µes de atualiza√ß√£o de status das assinaturas da Apple. </p><br><h2 id="chto-takoe-subscriptions-notifications">  O que s√£o notifica√ß√µes de inscri√ß√µes? </h2><br><p>  As Notifica√ß√µes de atualiza√ß√£o de status das assinaturas Apple s√£o um mecanismo para enviar webhooks ao servidor Apple quando ocorrem eventos de assinatura renov√°veis ‚Äã‚Äãautomaticamente.  Para habilit√°-los, voc√™ deve primeiro configurar seu servidor para aceit√°-los: o servidor deve suportar o protocolo App Transport Security (geralmente tudo funciona por padr√£o).  Depois disso, acesse a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">App Store Connect</a> e, na se√ß√£o "App Store" das configura√ß√µes do seu aplicativo, insira um link para o qual a Apple enviar√° uma solicita√ß√£o POST sempre que ocorrer um evento: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/011/e97/844/011e97844357cc016a2a8258bacfd354.png" alt="Configurar notifica√ß√µes de atualiza√ß√£o de status das assinaturas Apple"></p><br><blockquote>  Observe que a Apple recomenda o uso de Notifica√ß√µes de assinaturas em conjunto com a Pesquisa de status.  Mau sinal ... </blockquote><p>  Feito!  Agora voc√™ deve receber notifica√ß√µes sempre que, por exemplo, uma assinatura for emitida, renovada ou cancelada. </p><br><h2 id="raznovidnosti-uvedomleniy">  Variedades de notifica√ß√µes </h2><br><p>  A Apple envia 6 tipos de notifica√ß√µes que ocorrem em v√°rios eventos.  Vamos analisar cada um deles. </p><br><h3 id="initial_buy">  INITIAL_BUY </h3><br><p>  A Apple envia esta notifica√ß√£o quando um usu√°rio se inscreve pela primeira vez em um <strong>grupo de</strong> assinaturas. </p><br><blockquote>  Voc√™ pode ler mais sobre grupos de assinaturas em nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> . </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/bce/b16/6de/bceb166ded34b6e3efe67b0fbd22ae01.png" alt="Evento INITIAL_BUY"></p><br><h3 id="cancel">  CANCELAR </h3><br><p>  Este evento √© despachado quando o usu√°rio cancela a assinatura atrav√©s do suporte Apple Care e reembolsa a compra.  Enfatizamos que <strong>n√£o se</strong> trata do cancelamento usual da assinatura por meio das configura√ß√µes do iOS. </p><br><blockquote> <code>CANCEL</code> evento <code>CANCEL</code> n√£o √© despachado durante o cancelamento normal atrav√©s das configura√ß√µes do iOS. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/52c/692/9ce/52c6929ced9ea6d4d887581722f5612a.png" alt="CANCELAR Evento"></p><br><h3 id="did_change_renewal_status">  DID_CHANGE_RENEWAL_STATUS </h3><br><p>  Este evento foi adicionado recentemente.  √â enviado quando o usu√°rio desconecta ou (novamente) ativa a renova√ß√£o da assinatura por meio das configura√ß√µes do iOS, do aplicativo App Store ou do suporte da Apple: </p><br><blockquote>  N√£o confunda este evento com o evento <code>CANCEL</code> que √© acionado quando voc√™ cancela sua assinatura e reembolsa atrav√©s do suporte Apple Care. </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/987/be2/829/987be28296f3367163ff3af07a4fb29a.png" alt="Evento DID_CHANGE_RENEWAL_STATUS"></p><br><h3 id="renewal">  RENOVA√á√ÉO </h3><br><p>  A primeira coisa que vem √† mente quando voc√™ v√™ o nome deste evento: a Apple envia quando a renova√ß√£o √© renovada automaticamente.  N√£o importa como! </p><br><p>  O evento <code>RENEWAL</code> despachado quando: </p><br><ol><li><p>  a assinatura do usu√°rio foi cancelada automaticamente <strong>devido a problemas com o cart√£o banc√°rio do usu√°rio ...</strong> </p><br></li><li><p>  e depois disso, o usu√°rio renovou a assinatura novamente.  √â nesse ponto que o evento <code>RENEWAL</code> √© <code>RENEWAL</code> . </p><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e56/ed6/4e9/e56ed64e9a4f804a69c32b15df6e614f.jpg"></p><br><blockquote>  Um <code>RENEWAL</code> RENOVA√á√ÉO <strong>n√£o</strong> <code>RENEWAL</code> <strong>enviado</strong> no caso de uma renova√ß√£o regular de uma assinatura.  Em vez disso, a Apple sugere verificar a verifica√ß√£o da assinatura atrav√©s de <code>/VerifyReceipt</code> antes e ap√≥s a renova√ß√£o esperada e analisar a <code>expiration_date</code> resultante </blockquote><p><img src="https://habrastorage.org/getpro/habr/post_images/2d9/e2d/544/2d9e2d5440a690903f0182b5c08cc9a4.png" alt="Evento RENOVA√á√ÉO"></p><br><h3 id="interactive_renewal">  INTERACTIVE_RENEWAL </h3><br><p>  Este evento √© despachado se: </p><br><ol><li><p>  O usu√°rio cancelou a assinatura e <strong>algum tempo depois disso ...</strong> </p><br></li><li><p>  assinatura renovada pelo usu√°rio.  √â neste momento que <code>INTERACTIVE_RENEWAL</code> enviado. </p><br><blockquote>  A nova assinatura (indicada na cl√°usula 2) pode ser diferente da assinatura da cl√°usula 1, mas ambas devem pertencer ao mesmo grupo de compras.  Por exemplo, um usu√°rio pode cancelar a inscri√ß√£o no plano tarif√°rio Bronze e, ap√≥s algum tempo, renovar sua assinatura escolhendo o plano Gold.  Nesse caso, a Apple enviar√° o evento <code>INTERACTIVE_RENEWAL</code> ao seu servidor (desde que as assinaturas Bronze e Gold perten√ßam ao mesmo grupo de compras).  Voc√™ pode ler mais sobre grupos de assinaturas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </blockquote><br></li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7b0/d77/fe3/7b0d77fe3921cf4bf9c4d9b4a04bec03.png" alt="Evento INTERACTIVE_RENEWAL"></p><br><h3 id="did_change_renewal_pref">  DID_CHANGE_RENEWAL_PREF </h3><br><p>  <code>DID_CHANGE_RENEWAL_PREF</code> enviado quando um usu√°rio alterna de uma assinatura para outra dentro do mesmo grupo de compras: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ab1/8d5/359/ab18d53594ec3b04615f38598aa0c787.png" alt="Evento DID_CHANGE_RENEWAL_PREF"></p><br><h3 id="chto-v-itoge">  Qual √© o resultado? </h3><br><p>  A Apple oferece at√© 6 eventos, mas nenhum deles √© enviado ao renovar automaticamente uma assinatura no modo normal.  Por que eles fizeram isso?  Claro.  Al√©m disso, os nomes desses eventos s√£o enganosos. </p><br><p>  A tabela abaixo resume os eventos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ba/c0f/fc1/3bac0ffc178eaad092d199d6dd0e8d19.png"></p><br><h2 id="kak-ispolzovat-apple-subscriptions-notifications">  Como usar as notifica√ß√µes de assinaturas da Apple? </h2><br><p>  Devido ao fato de que o evento mais importante que voc√™ precisa calcular para LTV - renova√ß√£o da assinatura no modo normal - n√£o foi enviado, voc√™ ainda precisa usar a Status Polling.  Existe a possibilidade de a Apple adicionar este evento em um futuro pr√≥ximo, mas mesmo que isso aconte√ßa, voc√™ ainda n√£o pode ficar sem o seu pr√≥prio servidor.  Este servidor atuar√° como uma "camada" entre a Apple e outro sistema de an√°lise (por exemplo, Amplitude, Flurry ou Mixpanel).  Ao receber eventos e verificar cheques, voc√™ enviar√° informa√ß√µes sobre renova√ß√µes, cancelamentos e reembolsos. </p><br><blockquote><h1 id="odnazhdy-my-stolknulis-s-etoy-problemoy-i-reshili-razrabotat-servis-kotoryy-by-reshil-eti-problemy-tak-rodilas-ideya-servisa-nad-kotorym-my-seychas-rabotaem--servisa-analitiki-podpisok-dlya-ios-kotoryy-zapolnyaet-bresh-v-otpravke-sobytiy-so-storony-apple">  Uma vez que encontramos esse problema e decidimos desenvolver um servi√ßo que resolveria esses problemas.  Portanto, nasceu a id√©ia do servi√ßo em que estamos trabalhando agora - o servi√ßo de an√°lise de assinaturas para iOS, que preenche a lacuna no envio de eventos da Apple. </h1><br></blockquote><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  As notifica√ß√µes de assinaturas da Apple n√£o s√£o t√£o boas quanto parecem, porque somente com elas voc√™ n√£o consegue resolver o problema principal: descobrir quanto dinheiro um usu√°rio traz para voc√™.  A Apple pode facilitar a vida dos desenvolvedores no futuro, mas uma coisa √© certa: a implementa√ß√£o atual das Notifica√ß√µes de assinaturas √© extremamente √≥bvia e parece muletas. </p><br><blockquote>  Deseja implementar assinaturas no seu aplicativo iOS em 10 minutos?  Integre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Apphud</a> e: <br><ul><li>  Fa√ßa compras usando apenas um m√©todo; </li><li>  rastreia automaticamente o status da assinatura de cada usu√°rio; </li><li>  Integre facilmente as ofertas de assinatura </li><li>  enviar eventos de assinatura para Amplitude, Mixpanel, Slack e Telegram, levando em considera√ß√£o a moeda local do usu√°rio; </li><li>  diminua a taxa de rotatividade de aplicativos e retorne usu√°rios n√£o inscritos. </li></ul><br></blockquote><br><h2 id="chto-pochitat">  O que ler? </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">7 coisas a saber sobre assinaturas renov√°veis ‚Äã‚Äãautomaticamente</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de ofertas introdut√≥rias no iOS</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Guia de notifica√ß√µes da atualiza√ß√£o de status da Apple</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt453770/">https://habr.com/ru/post/pt453770/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt453756/index.html">Problemas da metodologia atual para determinar amea√ßas atuais do FSTEC</a></li>
<li><a href="../pt453760/index.html">Campo de treinamento em circuito para tanques e processadores</a></li>
<li><a href="../pt453764/index.html">Amn√©sia volunt√°ria: manipula√ß√µes do hipocampo para remover mem√≥rias dolorosas</a></li>
<li><a href="../pt453766/index.html">R√°dio definido por software - como funciona? Parte 6</a></li>
<li><a href="../pt453768/index.html">Vis√£o geral dos servi√ßos SMS: Servi√ßos populares</a></li>
<li><a href="../pt453772/index.html">Projeto Athena - Reinventando o Notebook</a></li>
<li><a href="../pt453776/index.html">Bombeamos designers da empresa: do j√∫nior ao diretor de arte</a></li>
<li><a href="../pt453778/index.html">Como criamos um banco on-line para empresas. Parte Um: Rebranding</a></li>
<li><a href="../pt453780/index.html">Como escolher um telefone SIP Grandstream - em geral e em particular?</a></li>
<li><a href="../pt453782/index.html">Infinito UIScrollView</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>