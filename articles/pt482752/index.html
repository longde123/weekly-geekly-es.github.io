<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåÜ üíÇ ‚ôèÔ∏è "Novas √©picas". N√≥s comemos o elefante em partes üëßüèæ üëù ‚ôéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Neste artigo, configurarei um ambiente de trabalho para o desenvolvimento do jogo "Epics", al√©m de dividir o jogo em partes adequadas para uso no Open...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Novas √©picas". N√≥s comemos o elefante em partes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/482752/"><p><img src="https://habrastorage.org/webt/gd/be/ip/gdbeip7f5h-k71jqzl7gmb1axva.jpeg"></p><br><p>  Neste artigo, configurarei um ambiente de trabalho para o desenvolvimento do jogo "Epics", al√©m de dividir o jogo em partes adequadas para uso no OpenFaaS.  Farei todas as manipula√ß√µes no Linux, o Kubernetes ser√° implantado no minikube usando o VirtualBox.  Na minha m√°quina de trabalho, existem 2 n√∫cleos de processador e 12 GB de RAM, eu uso o SSD como um disco do sistema.  Usarei o debian 8 como o principal sistema de desenvolvimento, com os pacotes emacs, sudo, git e virtualbox instalados; instalarei o restante baixando do GitHub e de outras fontes.  Instalaremos esses aplicativos em / usr / local / bin, a menos que especificado de outra forma.  Vamos come√ßar! </p><a name="habracut"></a><br><h2 id="podgotovka-rabochego-okruzheniya">  Prepara√ß√£o do ambiente de trabalho </h2><br><h3 id="ustanovka-go">  Ir instala√ß√£o </h3><br><p>  Siga as instru√ß√µes do site oficial: </p><br><pre><code class="plaintext hljs">$ curl -L0 https://dl.google.com/go/go1.13.5.linux-amd64.tar.gz -o go.tar.gz $ sudo tar -C /usr/local -xzf go.tar.gz $ echo 'export PATH=$PATH:/usr/local/go/bin' &gt;&gt; ~/.profile</code> </pre> <br><p>  Verifique o desempenho: </p><br><pre> <code class="plaintext hljs">$ mkdir -p ~/go/src/hello &amp;&amp; cd ~/go/src/hello $ echo 'package main import "fmt" func main() { fmt.Printf("hello, world\n") }' &gt; hello.go $ go build $ ./hello hello, world</code> </pre> <br><h3 id="ustanovka-faas-cli">  Instalar faas-cli </h3><br><p>  Siga as instru√ß√µes do site oficial: </p><br><pre> <code class="plaintext hljs">$ curl -sSL https://cli.openfaas.com | sudo -E sh x86_64 Downloading package https://github.com/openfaas/faas-cli/releases/download/0.11.3/faas-cli as /tmp/faas-cli Download complete. Running with sufficient permissions to attempt to move faas-cli to /usr/local/bin New version of faas-cli installed to /usr/local/bin Creating alias 'faas' for 'faas-cli'. ___ _____ ____ / _ \ _ __ ___ _ __ | ___|_ _ __ _/ ___| | | | | '_ \ / _ \ '_ \| |_ / _` |/ _` \___ \ | |_| | |_) | __/ | | | _| (_| | (_| |___) | \___/| .__/ \___|_| |_|_| \__,_|\__,_|____/ |_| CLI: commit: 73004c23e5a4d3fdb7352f953247473477477a64 version: 0.11.3</code> </pre> <br><p>  Al√©m disso, voc√™ pode ativar a conclus√£o do bash: </p><br><pre> <code class="plaintext hljs">faas-cli completion --shell bash | sudo tee /etc/bash_completion.d/faas-cli</code> </pre> <br><h3 id="ustanovka-i-nastroyka-kubernetes">  Instale e configure o Kubernetes </h3><br><p>  O Minikube √© suficiente para o desenvolvimento, por isso vamos instal√°-lo e kubelet em / usr / local / bin, tamb√©m instalaremos o helm para instalar aplicativos: </p><br><pre> <code class="plaintext hljs">$ curl https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64 -o minikube &amp;&amp; chmod +x minikube &amp;&amp; sudo mv minikube /usr/local/bin/ $ curl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl -o kubectl &amp;&amp; chmod +x kubectl &amp;&amp; sudo mv kubectl /usr/local/bin/ $ curl https://get.helm.sh/helm-v3.0.2-linux-amd64.tar.gz | tar -xzvf - linux-amd64/helm --strip-components=1; sudo mv helm /usr/local/bin</code> </pre> <br><p>  Inicie o minikube: </p><br><pre> <code class="plaintext hljs">$ minikube start minikube v1.6.2 on Debian 8.11 Automatically selected the 'virtualbox' driver (alternates: []) Downloading VM boot image ... &gt; minikube-v1.6.0.iso.sha256: 65 B / 65 B [--------------] 100.00% ? p/s 0s &gt; minikube-v1.6.0.iso: 150.93 MiB / 150.93 MiB [-] 100.00% 5.67 MiB p/s 27s Creating virtualbox VM (CPUs=2, Memory=8192MB, Disk=20000MB) ... Preparing Kubernetes v1.17.0 on Docker '19.03.5' ... Downloading kubeadm v1.17.0 Downloading kubelet v1.17.0 Pulling images ... Launching Kubernetes ... Waiting for cluster to come online ... Done! kubectl is now configured to use "minikube"</code> </pre> <br><p>  Verificamos: </p><br><pre> <code class="plaintext hljs">$ kubectl get pods --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system coredns-6955765f44-knlcb 1/1 Running 0 29m kube-system coredns-6955765f44-t9cpn 1/1 Running 0 29m kube-system etcd-minikube 1/1 Running 0 28m kube-system kube-addon-manager-minikube 1/1 Running 0 28m kube-system kube-apiserver-minikube 1/1 Running 0 28m kube-system kube-controller-manager-minikube 1/1 Running 0 28m kube-system kube-proxy-hv2wc 1/1 Running 0 29m kube-system kube-scheduler-minikube 1/1 Running 0 28m kube-system storage-provisioner 1/1 Running 1 29m</code> </pre> <br><h3 id="ustanovka-openfaas">  Instale o OpenFaaS </h3><br><p>  Os desenvolvedores recomendam a cria√ß√£o de 2 namespace para o trabalho: </p><br><pre> <code class="plaintext hljs">$ kubectl apply -f https://raw.githubusercontent.com/openfaas/faas-netes/master/namespaces.yml namespace/openfaas created namespace/openfaas-fn created</code> </pre> <br><p>  Adicione um reposit√≥rio para o helm: </p><br><pre> <code class="plaintext hljs">$ helm repo add openfaas https://openfaas.github.io/faas-netes/ "openfaas" has been added to your repositories</code> </pre> <br><p>  O gr√°fico tem a capacidade de definir uma senha antes da instala√ß√£o, us√°-la e salvar os dados de acesso na forma de um segredo do k8s: </p><br><pre> <code class="plaintext hljs">$ PASSWORD=verysecurerandompasswordstring $ kubectl -n openfaas create secret generic basic-auth --from-literal=basic-auth-user=admin --from-literal=basic-auth-password="$PASSWORD" secret/basic-auth created</code> </pre> <br><p>  Implantando: </p><br><pre> <code class="plaintext hljs">$ helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the "openfaas" chart repository Update Complete. Happy Helming! $ helm upgrade openfaas --install openfaas/openfaas --namespace openfaas --set functionNamespace=openfaas-fn --set generateBasicAuth=false Release "openfaas" does not exist. Installing it now. NAME: openfaas LAST DEPLOYED: Fri Dec 25 10:28:22 2019 NAMESPACE: openfaas STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: To verify that openfaas has started, run: kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas"</code> </pre> <br><p>  Ap√≥s algum tempo, execute o comando proposto: </p><br><pre> <code class="plaintext hljs">$ kubectl -n openfaas get deployments -l "release=openfaas, app=openfaas" NAME READY UP-TO-DATE AVAILABLE AGE alertmanager 1/1 1 1 114s basic-auth-plugin 1/1 1 1 114s faas-idler 1/1 1 1 114s gateway 1/1 1 1 114s nats 1/1 1 1 114s prometheus 1/1 1 1 114s queue-worker 1/1 1 1 114s</code> </pre> <br><p>  Verifique o desempenho: </p><br><pre> <code class="plaintext hljs">$ kubectl rollout status -n openfaas deploy/gateway deployment "gateway" successfully rolled out $ kubectl port-forward -n openfaas svc/gateway 8080:8080 &amp; [1] 6985 Forwarding from 127.0.0.1:8080 -&gt; 8080 $ echo -n $PASSWORD | faas-cli login --username admin --password-stdin Calling the OpenFaaS server to validate the credentials... Handling connection for 8080 WARNING! Communication is not secure, please consider using HTTPS. Letsencrypt.org offers free SSL/TLS certificates. credentials saved for admin http://127.0.0.1:8080 $ faas-cli list Function Invocations Replicas</code> </pre> <br><h3 id="ustanovka-mongodb">  Instale o Mongodb </h3><br><p>  Colocamos tudo usando o leme: </p><br><pre> <code class="plaintext hljs">$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/ "stable" has been added to your repositories $ helm install stable/mongodb --generate-name NAME: mongodb-1577466908 LAST DEPLOYED: Fri Dec 25 11:15:11 2019 NAMESPACE: default STATUS: deployed REVISION: 1 TEST SUITE: None NOTES: ** Please be patient while the chart is being deployed ** MongoDB can be accessed via port 27017 on the following DNS name from within your cluster: mongodb-1577466908.default.svc.cluster.local To get the root password run: export MONGODB_ROOT_PASSWORD=$(kubectl get secret --namespace default mongodb-1577466908 -o jsonpath="{.data.mongodb-root-password}" | base64 --decode) To connect to your database run the following command: kubectl run --namespace default mongodb-1577466908-client --rm --tty -i --restart='Never' --image bitnami/mongodb --command -- mongo admin --host mongodb-1577466908 --authenticationDatabase admin -u root -p $MONGODB_ROOT_PASSWORD To connect to your database from outside the cluster execute the following commands: kubectl port-forward --namespace default svc/mongodb-1577466908 27017:27017 &amp; mongo --host 127.0.0.1 --authenticationDatabase admin -p $MONGODB_ROOT_PASSWORD</code> </pre> <br><p>  Verificamos: </p><br><pre> <code class="plaintext hljs">kubectl run --namespace default mongodb-1577466908-client --rm --tty -i --restart='Never' --image bitnami/mongodb --command -- mongo admin --host mongodb-1577466908 --authenticationDatabase admin -u root -p $(kubectl get secret --namespace default mongodb-1577466908 -o jsonpath="{.data.mongodb-root-password}" | base64 --decode) If you don't see a command prompt, try pressing enter. &gt; db.version(); 4.0.14</code> </pre> <br><p>  Pressione ctrl + D para sair do cont√™iner. </p><br><h3 id="nastroyka-emacs">  Configura√ß√£o do Emacs </h3><br><p>  Em princ√≠pio, tudo j√° estava configurado para <a href="http://reangdblog.blogspot.com/2016/06/emacs-ide-go.html">este artigo</a> , ent√£o n√£o vou pintar em detalhes. </p><br><h2 id="razbienie-igry-na-funkcii">  Dividindo o jogo em fun√ß√µes </h2><br><p>  A intera√ß√£o com as fun√ß√µes √© realizada via protocolo http; a autentica√ß√£o de ponta a ponta entre diferentes fun√ß√µes √© fornecida pelo JWT.  O Mongodb √© usado para armazenar tokens, bem como o estado do jogo, dados do jogador, sequ√™ncias de movimentos de todos os jogos e outras informa√ß√µes.  Vamos dar uma olhada nos recursos mais interessantes. </p><br><h3 id="registraciya">  Registo </h3><br><p>  Na entrada desta fun√ß√£o est√° JSON com um apelido de jogo e senha.  Quando essa fun√ß√£o √© chamada, a aus√™ncia desse alias √© verificada no banco de dados; se for verificada com √™xito, o alias e o hash da senha s√£o inseridos no banco de dados.  O registro √© necess√°rio para a participa√ß√£o ativa no jogo. </p><br><h3 id="vhod">  Entrar </h3><br><p>  Na entrada da fun√ß√£o est√° JSON com um alias e uma senha do jogo, se houver um alias no banco de dados e a senha for verificada com √™xito com a senha armazenada anteriormente no banco de dados, o JWT ser√° retornado, que dever√° ser passado para outras fun√ß√µes quando elas forem chamadas.  V√°rios registros de servi√ßo tamb√©m s√£o inseridos no banco de dados, por exemplo, a hora do √∫ltimo login, etc. </p><br><h3 id="prosmotr-spiska-igr">  Ver lista de jogos </h3><br><p>  Qualquer usu√°rio n√£o autorizado pode solicitar uma lista de todos os jogos, exceto os ativos.  Um usu√°rio autorizado tamb√©m v√™ uma lista de jogos ativos.  O resultado da fun√ß√£o √© JSON contendo listas de jogos (identificador de jogo, nome leg√≠vel por humanos, etc.). </p><br><h3 id="sozdanie-igry">  Cria√ß√£o de jogos </h3><br><p>  A fun√ß√£o funciona apenas com usu√°rios autorizados, o n√∫mero m√°ximo de jogadores e os par√¢metros do jogo (por exemplo, quais personagens ativar neste jogo, n√∫mero m√°ximo de jogadores etc.) s√£o aceitos na entrada.  Um par√¢metro separado do jogo √© a presen√ßa de uma senha para ingressar, o que permite criar jogos n√£o p√∫blicos.  Por padr√£o, um jogo p√∫blico √© criado.  O resultado da execu√ß√£o da fun√ß√£o √© JSON, no qual h√° um campo de sucesso na cria√ß√£o, um identificador exclusivo para o jogo, al√©m de outros par√¢metros. </p><br><h3 id="prisoedinenie-k-igre">  Entrando no jogo </h3><br><p>  A fun√ß√£o funciona apenas com usu√°rios autorizados, na entrada - o identificador do jogo e sua senha, se for um jogo n√£o p√∫blico, na sa√≠da - JSON com os par√¢metros do jogo.  O usu√°rio autorizado que entrou no jogo, assim como o criador do jogo, √© chamado de participantes no jogo. </p><br><h3 id="prosmotr-sobytiy-igry">  Ver eventos do jogo </h3><br><p>  Qualquer usu√°rio n√£o autorizado pode solicitar uma lista de eventos de jogos inativos, e um usu√°rio autorizado pode obter uma lista de eventos e qualquer jogo ativo.  Um par√¢metro adicional para a fun√ß√£o pode ser o n√∫mero do evento que o usu√°rio j√° possui.  Nesse caso, apenas os eventos que ocorreram posteriormente ser√£o retornados na lista.  Ao iniciar esta fun√ß√£o periodicamente, um usu√°rio autorizado assiste o que est√° acontecendo no jogo.  Essa fun√ß√£o tamb√©m retorna uma solicita√ß√£o para uma a√ß√£o √† qual o usu√°rio pode responder usando a fun√ß√£o de enviar um evento do jogo. </p><br><h3 id="otpravka-sobytiya-igry">  Envio de evento de jogo </h3><br><p>  A fun√ß√£o funciona apenas para os participantes do jogo: a capacidade de iniciar um jogo, fazer uma jogada, votar, escrever uma mensagem de texto que aparece na lista de eventos do jogo etc. √© implementada. <br>  O usu√°rio autorizado que criou o jogo inicia a distribui√ß√£o de pap√©is para todos os participantes do jogo, incluindo eles mesmos, eles devem confirmar seu papel usando a mesma fun√ß√£o.  Uma vez confirmadas todas as fun√ß√µes, o jogo entra automaticamente no modo noturno. </p><br><h3 id="statistika-igry">  Estat√≠sticas do jogo </h3><br><p>  A fun√ß√£o funciona apenas para os participantes do jogo, mostra o estado do jogo, a lista e o n√∫mero de jogadores (pseud√¥nimos), fun√ß√µes e status (movimento realizado ou n√£o), al√©m de outras informa√ß√µes.  Quanto √† fun√ß√£o anterior, tudo funciona apenas para os participantes do jogo. </p><br><h3 id="periodicheski-zapuskaemye-funkcii">  Fun√ß√µes de execu√ß√£o peri√≥dica </h3><br><p>  Se o jogo n√£o tiver sido iniciado por algum tempo especificado durante a cria√ß√£o do jogo, ele ser√° automaticamente removido da lista de jogos ativos usando a fun√ß√£o de varredura. </p><br><p>  Outra tarefa peri√≥dica √© a altern√¢ncia for√ßada do modo de jogo da noite para o dia e de volta para jogos nos quais isso n√£o aconteceu durante o turno (por exemplo, um jogador que precisa responder a um evento do jogo n√£o enviou sua decis√£o por qualquer motivo). </p><br><h2 id="anons">  An√∫ncio </h2><br><ul><li>  <a href="https://habr.com/ru/company/southbridge/blog/482010/">1. Introdu√ß√£o</a> </li><li>  Configurando o ambiente de desenvolvimento, dividindo a tarefa em fun√ß√µes </li><li>  Trabalhar no back-end </li><li>  Trabalho de front-end </li><li>  Configura√ß√£o de CI \ CD, organiza√ß√£o de teste </li><li>  Iniciando uma sess√£o de avalia√ß√£o do jogo </li><li>  Sum√°rio </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482752/">https://habr.com/ru/post/pt482752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482736/index.html">Usando o TSDuck para monitorar fluxos de IP (TS)</a></li>
<li><a href="../pt482740/index.html">Entrevista para a posi√ß√£o de um poeta</a></li>
<li><a href="../pt482742/index.html">Entrando no mercado ocidental: como interagir com os clientes</a></li>
<li><a href="../pt482744/index.html">Encontrando uma bala de prata: muni√ß√£o incomum</a></li>
<li><a href="../pt482748/index.html">Criando um neg√≥cio de reserva de t√°xi em Dubai: como iniciar um aplicativo de t√°xi centrado no cliente como Careem & Hala?</a></li>
<li><a href="../pt482756/index.html">√â um futuro verde nebuloso?</a></li>
<li><a href="../pt482758/index.html">No caminho para o teclado perfeito</a></li>
<li><a href="../pt482762/index.html">42.000.000.000 de visitas. O PornHub resumiu 2019</a></li>
<li><a href="../pt482764/index.html">O Rhasspy √© um kit de ferramentas de fala de c√≥digo aberto e totalmente offline. Reconhecimento da l√≠ngua russa. Sem vazamentos para a nuvem</a></li>
<li><a href="../pt482772/index.html">Aplica√ß√µes Web progressivas em 2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>